"use strict";(self.n52dyox90qa=self.n52dyox90qa||[]).push([[49],{14216:(E,t,z)=>{z.r(t),z.d(t,{_HDRTextureLoader:()=>H});var A=z(11812);class X{static ConvertPanoramaToCubemap(E,t,z,A){let X=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!E)throw"ConvertPanoramaToCubemap: input cannot be null";if(E.length!=t*z*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(A,this.FACE_FRONT,E,t,z,X),back:this.CreateCubemapTexture(A,this.FACE_BACK,E,t,z,X),left:this.CreateCubemapTexture(A,this.FACE_LEFT,E,t,z,X),right:this.CreateCubemapTexture(A,this.FACE_RIGHT,E,t,z,X),up:this.CreateCubemapTexture(A,this.FACE_UP,E,t,z,X),down:this.CreateCubemapTexture(A,this.FACE_DOWN,E,t,z,X),size:A,type:1,format:4,gammaSpace:!1}}static CreateCubemapTexture(E,t,z,A,X){let R=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const u=new ArrayBuffer(E*E*4*3),p=new Float32Array(u),C=R?Math.max(1,Math.round(A/4/E)):1,Z=1/C,H=Z*Z,h=t[1].Wt(t[0]).scale(Z/E),d=t[3].Wt(t[2]).scale(Z/E),y=1/E;let O=0;for(let c=0;c<E;c++)for(let R=0;R<C;R++){let R=t[0],u=t[2];for(let t=0;t<E;t++)for(let Z=0;Z<C;Z++){const C=u.Wt(R).scale(O).add(R);C.normalize();const Z=this.CalcProjectionSpherical(C,z,A,X);p[c*E*3+3*t+0]+=Z.r*H,p[c*E*3+3*t+1]+=Z.g*H,p[c*E*3+3*t+2]+=Z.b*H,R=R.add(h),u=u.add(d)}O+=y*Z}return p}static CalcProjectionSpherical(E,t,z,A){let X=Math.atan2(E.z,E.x);const R=Math.acos(E.y);for(;X<-Math.PI;)X+=2*Math.PI;for(;X>Math.PI;)X-=2*Math.PI;let u=X/Math.PI;const p=R/Math.PI;u=.5*u+.5;let C=Math.round(u*z);C<0?C=0:C>=z&&(C=z-1);let Z=Math.round(p*A);Z<0?Z=0:Z>=A&&(Z=A-1);const H=A-Z-1;return{r:t[H*z*3+3*C+0],g:t[H*z*3+3*C+1],b:t[H*z*3+3*C+2]}}}function R(E,t,z,A,X,R){X>0?(X=function(E,t){return t>1023?E*Math.pow(2,1023)*Math.pow(2,t-1023):t<-1074?E*Math.pow(2,-1074)*Math.pow(2,t+1074):E*Math.pow(2,t)}(1,X-136),E[R+0]=t*X,E[R+1]=z*X,E[R+2]=A*X):(E[R+0]=0,E[R+1]=0,E[R+2]=0)}function u(E,t){let z="",A="";for(let X=t;X<E.length-t&&(A=String.fromCharCode(E[X]),"\n"!=A);X++)z+=A;return z}function p(E){let t=0,z=0,A=u(E,0);if("#"!=A[0]||"?"!=A[1])throw"Bad HDR Format.";let X=!1,R=!1,p=0;do{p+=A.length+1,A=u(E,p),"FORMAT=32-bit_rle_rgbe"==A?R=!0:0==A.length&&(X=!0)}while(!X);if(!R)throw"HDR Bad header format, unsupported FORMAT";p+=A.length+1,A=u(E,p);const C=/^-Y (.*) \+X (.*)$/g.exec(A);if(!C||C.length<3)throw"HDR Bad header format, no size";if(z=parseInt(C[2]),t=parseInt(C[1]),z<8||z>32767)throw"HDR Bad header format, unsupported size";return p+=A.length+1,{height:t,width:z,dataPosition:p}}function C(E,t){return function(E,t){let z=t.height;const A=t.width;let X,u,p,C,H,h=t.dataPosition,d=0,y=0,O=0;const c=new ArrayBuffer(4*A),a=new Uint8Array(c),L=new ArrayBuffer(t.width*t.height*4*3),mE=new Float32Array(L);for(;z>0;){if(X=E[h++],u=E[h++],p=E[h++],C=E[h++],2!=X||2!=u||128&p||t.width<8||t.width>32767)return Z(E,t);if((p<<8|C)!=A)throw"HDR Bad header format, wrong scan line width";for(d=0,O=0;O<4;O++)for(y=(O+1)*A;d<y;)if(X=E[h++],u=E[h++],X>128){if(H=X-128,0==H||H>y-d)throw"HDR Bad Format, bad scanline data (run)";for(;H-- >0;)a[d++]=u}else{if(H=X,0==H||H>y-d)throw"HDR Bad Format, bad scanline data (non-run)";if(a[d++]=u,--H>0)for(let t=0;t<H;t++)a[d++]=E[h++]}for(O=0;O<A;O++)X=a[O],u=a[O+A],p=a[O+2*A],C=a[O+3*A],R(mE,X,u,p,C,(t.height-z)*A*3+3*O);z--}return mE}(E,t)}function Z(E,t){let z=t.height;const A=t.width;let X,u,p,C,Z,H=t.dataPosition;const h=new ArrayBuffer(t.width*t.height*4*3),d=new Float32Array(h);for(;z>0;){for(Z=0;Z<t.width;Z++)X=E[H++],u=E[H++],p=E[H++],C=E[H++],R(d,X,u,p,C,(t.height-z)*A*3+3*Z);z--}return d}X.FACE_LEFT=[new A.Lt(-1,-1,-1),new A.Lt(1,-1,-1),new A.Lt(-1,1,-1),new A.Lt(1,1,-1)],X.FACE_RIGHT=[new A.Lt(1,-1,1),new A.Lt(-1,-1,1),new A.Lt(1,1,1),new A.Lt(-1,1,1)],X.FACE_FRONT=[new A.Lt(1,-1,-1),new A.Lt(1,-1,1),new A.Lt(1,1,-1),new A.Lt(1,1,1)],X.FACE_BACK=[new A.Lt(-1,-1,1),new A.Lt(-1,-1,-1),new A.Lt(-1,1,1),new A.Lt(-1,1,-1)],X.FACE_DOWN=[new A.Lt(1,1,-1),new A.Lt(1,1,1),new A.Lt(-1,1,-1),new A.Lt(-1,1,1)],X.FACE_UP=[new A.Lt(-1,-1,-1),new A.Lt(-1,-1,1),new A.Lt(1,-1,-1),new A.Lt(1,-1,1)];class H{constructor(){this.supportCascades=!1}loadCubeData(){throw".hdr not supported in Cube."}loadData(E,t,z){const A=new Uint8Array(E.buffer,E.byteOffset,E.byteLength),X=p(A),R=C(A,X),u=X.width*X.height,Z=new Float32Array(4*u);for(let p=0;p<u;p+=1)Z[4*p]=R[3*p],Z[4*p+1]=R[3*p+1],Z[4*p+2]=R[3*p+2],Z[4*p+3]=1;z(X.width,X.height,t.generateMipMaps,!1,(()=>{const E=t.getEngine();t.type=1,t.format=5,t._gammaSpace=!1,E._uploadDataToTextureDirectly(t,Z)}))}}}}]);