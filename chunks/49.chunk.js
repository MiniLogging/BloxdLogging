"use strict";(self.v2pspxy442l=self.v2pspxy442l||[]).push([[49],{14896:(l,a,N)=>{N.r(a),N.d(a,{_HDRTextureLoader:()=>J});var U=N(12447);class c{static ConvertPanoramaToCubemap(l,a,N,U){let c=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!l)throw"ConvertPanoramaToCubemap: input cannot be null";if(l.length!=a*N*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(U,this.FACE_FRONT,l,a,N,c),back:this.CreateCubemapTexture(U,this.FACE_BACK,l,a,N,c),left:this.CreateCubemapTexture(U,this.FACE_LEFT,l,a,N,c),right:this.CreateCubemapTexture(U,this.FACE_RIGHT,l,a,N,c),up:this.CreateCubemapTexture(U,this.FACE_UP,l,a,N,c),down:this.CreateCubemapTexture(U,this.FACE_DOWN,l,a,N,c),size:U,type:1,format:4,gammaSpace:!1}}static CreateCubemapTexture(l,a,N,U,c){let K=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const Z=new ArrayBuffer(l*l*4*3),w=new Float32Array(Z),S=K?Math.max(1,Math.round(U/4/l)):1,T=1/S,J=T*T,n=a[1].Wa(a[0]).scale(T/l),y=a[3].Wa(a[2]).scale(T/l),H=1/l;let u=0;for(let W=0;W<l;W++)for(let K=0;K<S;K++){let K=a[0],Z=a[2];for(let a=0;a<l;a++)for(let T=0;T<S;T++){const S=Z.Wa(K).scale(u).add(K);S.normalize();const T=this.CalcProjectionSpherical(S,N,U,c);w[W*l*3+3*a+0]+=T.r*J,w[W*l*3+3*a+1]+=T.g*J,w[W*l*3+3*a+2]+=T.b*J,K=K.add(n),Z=Z.add(y)}u+=H*T}return w}static CalcProjectionSpherical(l,a,N,U){let c=Math.atan2(l.z,l.x);const K=Math.acos(l.y);for(;c<-Math.PI;)c+=2*Math.PI;for(;c>Math.PI;)c-=2*Math.PI;let Z=c/Math.PI;const w=K/Math.PI;Z=.5*Z+.5;let S=Math.round(Z*N);S<0?S=0:S>=N&&(S=N-1);let T=Math.round(w*U);T<0?T=0:T>=U&&(T=U-1);const J=U-T-1;return{r:a[J*N*3+3*S+0],g:a[J*N*3+3*S+1],b:a[J*N*3+3*S+2]}}}function K(l,a,N,U,c,K){c>0?(c=function(l,a){return a>1023?l*Math.pow(2,1023)*Math.pow(2,a-1023):a<-1074?l*Math.pow(2,-1074)*Math.pow(2,a+1074):l*Math.pow(2,a)}(1,c-136),l[K+0]=a*c,l[K+1]=N*c,l[K+2]=U*c):(l[K+0]=0,l[K+1]=0,l[K+2]=0)}function Z(l,a){let N="",U="";for(let c=a;c<l.length-a&&(U=String.fromCharCode(l[c]),"\n"!=U);c++)N+=U;return N}function w(l){let a=0,N=0,U=Z(l,0);if("#"!=U[0]||"?"!=U[1])throw"Bad HDR Format.";let c=!1,K=!1,w=0;do{w+=U.length+1,U=Z(l,w),"FORMAT=32-bit_rle_rgbe"==U?K=!0:0==U.length&&(c=!0)}while(!c);if(!K)throw"HDR Bad header format, unsupported FORMAT";w+=U.length+1,U=Z(l,w);const S=/^-Y (.*) \+X (.*)$/g.exec(U);if(!S||S.length<3)throw"HDR Bad header format, no size";if(N=parseInt(S[2]),a=parseInt(S[1]),N<8||N>32767)throw"HDR Bad header format, unsupported size";return w+=U.length+1,{height:a,width:N,dataPosition:w}}function S(l,a){return function(l,a){let N=a.height;const U=a.width;let c,Z,w,S,J,n=a.dataPosition,y=0,H=0,u=0;const W=new ArrayBuffer(4*U),B=new Uint8Array(W),Y=new ArrayBuffer(a.width*a.height*4*3),C=new Float32Array(Y);for(;N>0;){if(c=l[n++],Z=l[n++],w=l[n++],S=l[n++],2!=c||2!=Z||128&w||a.width<8||a.width>32767)return T(l,a);if((w<<8|S)!=U)throw"HDR Bad header format, wrong scan line width";for(y=0,u=0;u<4;u++)for(H=(u+1)*U;y<H;)if(c=l[n++],Z=l[n++],c>128){if(J=c-128,0==J||J>H-y)throw"HDR Bad Format, bad scanline data (run)";for(;J-- >0;)B[y++]=Z}else{if(J=c,0==J||J>H-y)throw"HDR Bad Format, bad scanline data (non-run)";if(B[y++]=Z,--J>0)for(let a=0;a<J;a++)B[y++]=l[n++]}for(u=0;u<U;u++)c=B[u],Z=B[u+U],w=B[u+2*U],S=B[u+3*U],K(C,c,Z,w,S,(a.height-N)*U*3+3*u);N--}return C}(l,a)}function T(l,a){let N=a.height;const U=a.width;let c,Z,w,S,T,J=a.dataPosition;const n=new ArrayBuffer(a.width*a.height*4*3),y=new Float32Array(n);for(;N>0;){for(T=0;T<a.width;T++)c=l[J++],Z=l[J++],w=l[J++],S=l[J++],K(y,c,Z,w,S,(a.height-N)*U*3+3*T);N--}return y}c.FACE_LEFT=[new U.ua(-1,-1,-1),new U.ua(1,-1,-1),new U.ua(-1,1,-1),new U.ua(1,1,-1)],c.FACE_RIGHT=[new U.ua(1,-1,1),new U.ua(-1,-1,1),new U.ua(1,1,1),new U.ua(-1,1,1)],c.FACE_FRONT=[new U.ua(1,-1,-1),new U.ua(1,-1,1),new U.ua(1,1,-1),new U.ua(1,1,1)],c.FACE_BACK=[new U.ua(-1,-1,1),new U.ua(-1,-1,-1),new U.ua(-1,1,1),new U.ua(-1,1,-1)],c.FACE_DOWN=[new U.ua(1,1,-1),new U.ua(1,1,1),new U.ua(-1,1,-1),new U.ua(-1,1,1)],c.FACE_UP=[new U.ua(-1,-1,-1),new U.ua(-1,-1,1),new U.ua(1,-1,-1),new U.ua(1,-1,1)];class J{constructor(){this.supportCascades=!1}loadCubeData(){throw".hdr not supported in Cube."}loadData(l,a,N){const U=new Uint8Array(l.buffer,l.byteOffset,l.byteLength),c=w(U),K=S(U,c),Z=c.width*c.height,T=new Float32Array(4*Z);for(let w=0;w<Z;w+=1)T[4*w]=K[3*w],T[4*w+1]=K[3*w+1],T[4*w+2]=K[3*w+2],T[4*w+3]=1;N(c.width,c.height,a.generateMipMaps,!1,(()=>{const l=a.getEngine();a.type=1,a.format=5,a._gammaSpace=!1,l._uploadDataToTextureDirectly(a,T)}))}}}}]);