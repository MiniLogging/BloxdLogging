"use strict";(self.uw9p3pwwsje=self.uw9p3pwwsje||[]).push([[49],{15169:(D,h,o)=>{o.r(h),o.d(h,{_HDRTextureLoader:()=>k});var H=o(12831);class g{static ConvertPanoramaToCubemap(D,h,o,H){let g=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!D)throw"ConvertPanoramaToCubemap: input cannot be null";if(D.length!=h*o*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(H,this.FACE_FRONT,D,h,o,g),back:this.CreateCubemapTexture(H,this.FACE_BACK,D,h,o,g),left:this.CreateCubemapTexture(H,this.FACE_LEFT,D,h,o,g),right:this.CreateCubemapTexture(H,this.FACE_RIGHT,D,h,o,g),up:this.CreateCubemapTexture(H,this.FACE_UP,D,h,o,g),down:this.CreateCubemapTexture(H,this.FACE_DOWN,D,h,o,g),size:H,type:1,format:4,gammaSpace:!1}}static CreateCubemapTexture(D,h,o,H,g){let j=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const M=new ArrayBuffer(D*D*4*3),R=new Float32Array(M),t=j?Math.max(1,Math.round(H/4/D)):1,S=1/t,k=S*S,K=h[1].Nh(h[0]).scale(S/D),Q=h[3].Nh(h[2]).scale(S/D),v=1/D;let r=0;for(let B=0;B<D;B++)for(let j=0;j<t;j++){let j=h[0],M=h[2];for(let h=0;h<D;h++)for(let S=0;S<t;S++){const t=M.Nh(j).scale(r).add(j);t.normalize();const S=this.CalcProjectionSpherical(t,o,H,g);R[B*D*3+3*h+0]+=S.r*k,R[B*D*3+3*h+1]+=S.g*k,R[B*D*3+3*h+2]+=S.b*k,j=j.add(K),M=M.add(Q)}r+=v*S}return R}static CalcProjectionSpherical(D,h,o,H){let g=Math.atan2(D.z,D.x);const j=Math.acos(D.y);for(;g<-Math.PI;)g+=2*Math.PI;for(;g>Math.PI;)g-=2*Math.PI;let M=g/Math.PI;const R=j/Math.PI;M=.5*M+.5;let t=Math.round(M*o);t<0?t=0:t>=o&&(t=o-1);let S=Math.round(R*H);S<0?S=0:S>=H&&(S=H-1);const k=H-S-1;return{r:h[k*o*3+3*t+0],g:h[k*o*3+3*t+1],b:h[k*o*3+3*t+2]}}}function j(D,h,o,H,g,j){g>0?(g=function(D,h){return h>1023?D*Math.pow(2,1023)*Math.pow(2,h-1023):h<-1074?D*Math.pow(2,-1074)*Math.pow(2,h+1074):D*Math.pow(2,h)}(1,g-136),D[j+0]=h*g,D[j+1]=o*g,D[j+2]=H*g):(D[j+0]=0,D[j+1]=0,D[j+2]=0)}function M(D,h){let o="",H="";for(let g=h;g<D.length-h&&(H=String.fromCharCode(D[g]),"\n"!=H);g++)o+=H;return o}function R(D){let h=0,o=0,H=M(D,0);if("#"!=H[0]||"?"!=H[1])throw"Bad HDR Format.";let g=!1,j=!1,R=0;do{R+=H.length+1,H=M(D,R),"FORMAT=32-bit_rle_rgbe"==H?j=!0:0==H.length&&(g=!0)}while(!g);if(!j)throw"HDR Bad header format, unsupported FORMAT";R+=H.length+1,H=M(D,R);const t=/^-Y (.*) \+X (.*)$/g.exec(H);if(!t||t.length<3)throw"HDR Bad header format, no size";if(o=parseInt(t[2]),h=parseInt(t[1]),o<8||o>32767)throw"HDR Bad header format, unsupported size";return R+=H.length+1,{height:h,width:o,dataPosition:R}}function t(D,h){return function(D,h){let o=h.height;const H=h.width;let g,M,R,t,k,K=h.dataPosition,Q=0,v=0,r=0;const B=new ArrayBuffer(4*H),s=new Uint8Array(B),U=new ArrayBuffer(h.width*h.height*4*3),q=new Float32Array(U);for(;o>0;){if(g=D[K++],M=D[K++],R=D[K++],t=D[K++],2!=g||2!=M||128&R||h.width<8||h.width>32767)return S(D,h);if((R<<8|t)!=H)throw"HDR Bad header format, wrong scan line width";for(Q=0,r=0;r<4;r++)for(v=(r+1)*H;Q<v;)if(g=D[K++],M=D[K++],g>128){if(k=g-128,0==k||k>v-Q)throw"HDR Bad Format, bad scanline data (run)";for(;k-- >0;)s[Q++]=M}else{if(k=g,0==k||k>v-Q)throw"HDR Bad Format, bad scanline data (non-run)";if(s[Q++]=M,--k>0)for(let h=0;h<k;h++)s[Q++]=D[K++]}for(r=0;r<H;r++)g=s[r],M=s[r+H],R=s[r+2*H],t=s[r+3*H],j(q,g,M,R,t,(h.height-o)*H*3+3*r);o--}return q}(D,h)}function S(D,h){let o=h.height;const H=h.width;let g,M,R,t,S,k=h.dataPosition;const K=new ArrayBuffer(h.width*h.height*4*3),Q=new Float32Array(K);for(;o>0;){for(S=0;S<h.width;S++)g=D[k++],M=D[k++],R=D[k++],t=D[k++],j(Q,g,M,R,t,(h.height-o)*H*3+3*S);o--}return Q}g.FACE_LEFT=[new H.Gh(-1,-1,-1),new H.Gh(1,-1,-1),new H.Gh(-1,1,-1),new H.Gh(1,1,-1)],g.FACE_RIGHT=[new H.Gh(1,-1,1),new H.Gh(-1,-1,1),new H.Gh(1,1,1),new H.Gh(-1,1,1)],g.FACE_FRONT=[new H.Gh(1,-1,-1),new H.Gh(1,-1,1),new H.Gh(1,1,-1),new H.Gh(1,1,1)],g.FACE_BACK=[new H.Gh(-1,-1,1),new H.Gh(-1,-1,-1),new H.Gh(-1,1,1),new H.Gh(-1,1,-1)],g.FACE_DOWN=[new H.Gh(1,1,-1),new H.Gh(1,1,1),new H.Gh(-1,1,-1),new H.Gh(-1,1,1)],g.FACE_UP=[new H.Gh(-1,-1,-1),new H.Gh(-1,-1,1),new H.Gh(1,-1,-1),new H.Gh(1,-1,1)];class k{constructor(){this.supportCascades=!1}loadCubeData(){throw".hdr not supported in Cube."}loadData(D,h,o){const H=new Uint8Array(D.buffer,D.byteOffset,D.byteLength),g=R(H),j=t(H,g),M=g.width*g.height,S=new Float32Array(4*M);for(let R=0;R<M;R+=1)S[4*R]=j[3*R],S[4*R+1]=j[3*R+1],S[4*R+2]=j[3*R+2],S[4*R+3]=1;o(g.width,g.height,h.generateMipMaps,!1,(()=>{const D=h.getEngine();h.type=1,h.format=5,h._gammaSpace=!1,D._uploadDataToTextureDirectly(h,S)}))}}}}]);