"use strict";(self["5dou0t7wntc"]=self["5dou0t7wntc"]||[]).push([[49],{14184:(K,O,F)=>{F.r(O),F.d(O,{_HDRTextureLoader:()=>M});var f=F(11713);class r{static ConvertPanoramaToCubemap(K,O,F,f){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!K)throw"ConvertPanoramaToCubemap: input cannot be null";if(K.length!=O*F*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(f,this.FACE_FRONT,K,O,F,r),back:this.CreateCubemapTexture(f,this.FACE_BACK,K,O,F,r),left:this.CreateCubemapTexture(f,this.FACE_LEFT,K,O,F,r),right:this.CreateCubemapTexture(f,this.FACE_RIGHT,K,O,F,r),up:this.CreateCubemapTexture(f,this.FACE_UP,K,O,F,r),down:this.CreateCubemapTexture(f,this.FACE_DOWN,K,O,F,r),size:f,type:1,format:4,gammaSpace:!1}}static CreateCubemapTexture(K,O,F,f,r){let l=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const q=new ArrayBuffer(K*K*4*3),J=new Float32Array(q),c=l?Math.max(1,Math.round(f/4/K)):1,E=1/c,M=E*E,t=O[1].oO(O[0]).scale(E/K),j=O[3].oO(O[2]).scale(E/K),X=1/K;let u=0;for(let T=0;T<K;T++)for(let l=0;l<c;l++){let l=O[0],q=O[2];for(let O=0;O<K;O++)for(let E=0;E<c;E++){const c=q.oO(l).scale(u).add(l);c.normalize();const E=this.CalcProjectionSpherical(c,F,f,r);J[T*K*3+3*O+0]+=E.r*M,J[T*K*3+3*O+1]+=E.g*M,J[T*K*3+3*O+2]+=E.b*M,l=l.add(t),q=q.add(j)}u+=X*E}return J}static CalcProjectionSpherical(K,O,F,f){let r=Math.atan2(K.z,K.x);const l=Math.acos(K.y);for(;r<-Math.PI;)r+=2*Math.PI;for(;r>Math.PI;)r-=2*Math.PI;let q=r/Math.PI;const J=l/Math.PI;q=.5*q+.5;let c=Math.round(q*F);c<0?c=0:c>=F&&(c=F-1);let E=Math.round(J*f);E<0?E=0:E>=f&&(E=f-1);const M=f-E-1;return{r:O[M*F*3+3*c+0],g:O[M*F*3+3*c+1],b:O[M*F*3+3*c+2]}}}function l(K,O,F,f,r,l){r>0?(r=function(K,O){return O>1023?K*Math.pow(2,1023)*Math.pow(2,O-1023):O<-1074?K*Math.pow(2,-1074)*Math.pow(2,O+1074):K*Math.pow(2,O)}(1,r-136),K[l+0]=O*r,K[l+1]=F*r,K[l+2]=f*r):(K[l+0]=0,K[l+1]=0,K[l+2]=0)}function q(K,O){let F="",f="";for(let r=O;r<K.length-O&&(f=String.fromCharCode(K[r]),"\n"!=f);r++)F+=f;return F}function J(K){let O=0,F=0,f=q(K,0);if("#"!=f[0]||"?"!=f[1])throw"Bad HDR Format.";let r=!1,l=!1,J=0;do{J+=f.length+1,f=q(K,J),"FORMAT=32-bit_rle_rgbe"==f?l=!0:0==f.length&&(r=!0)}while(!r);if(!l)throw"HDR Bad header format, unsupported FORMAT";J+=f.length+1,f=q(K,J);const c=/^-Y (.*) \+X (.*)$/g.exec(f);if(!c||c.length<3)throw"HDR Bad header format, no size";if(F=parseInt(c[2]),O=parseInt(c[1]),F<8||F>32767)throw"HDR Bad header format, unsupported size";return J+=f.length+1,{height:O,width:F,dataPosition:J}}function c(K,O){return function(K,O){let F=O.height;const f=O.width;let r,q,J,c,M,t=O.dataPosition,j=0,X=0,u=0;const T=new ArrayBuffer(4*f),o=new Uint8Array(T),k=new ArrayBuffer(O.width*O.height*4*3),N=new Float32Array(k);for(;F>0;){if(r=K[t++],q=K[t++],J=K[t++],c=K[t++],2!=r||2!=q||128&J||O.width<8||O.width>32767)return E(K,O);if((J<<8|c)!=f)throw"HDR Bad header format, wrong scan line width";for(j=0,u=0;u<4;u++)for(X=(u+1)*f;j<X;)if(r=K[t++],q=K[t++],r>128){if(M=r-128,0==M||M>X-j)throw"HDR Bad Format, bad scanline data (run)";for(;M-- >0;)o[j++]=q}else{if(M=r,0==M||M>X-j)throw"HDR Bad Format, bad scanline data (non-run)";if(o[j++]=q,--M>0)for(let O=0;O<M;O++)o[j++]=K[t++]}for(u=0;u<f;u++)r=o[u],q=o[u+f],J=o[u+2*f],c=o[u+3*f],l(N,r,q,J,c,(O.height-F)*f*3+3*u);F--}return N}(K,O)}function E(K,O){let F=O.height;const f=O.width;let r,q,J,c,E,M=O.dataPosition;const t=new ArrayBuffer(O.width*O.height*4*3),j=new Float32Array(t);for(;F>0;){for(E=0;E<O.width;E++)r=K[M++],q=K[M++],J=K[M++],c=K[M++],l(j,r,q,J,c,(O.height-F)*f*3+3*E);F--}return j}r.FACE_LEFT=[new f.TO(-1,-1,-1),new f.TO(1,-1,-1),new f.TO(-1,1,-1),new f.TO(1,1,-1)],r.FACE_RIGHT=[new f.TO(1,-1,1),new f.TO(-1,-1,1),new f.TO(1,1,1),new f.TO(-1,1,1)],r.FACE_FRONT=[new f.TO(1,-1,-1),new f.TO(1,-1,1),new f.TO(1,1,-1),new f.TO(1,1,1)],r.FACE_BACK=[new f.TO(-1,-1,1),new f.TO(-1,-1,-1),new f.TO(-1,1,1),new f.TO(-1,1,-1)],r.FACE_DOWN=[new f.TO(1,1,-1),new f.TO(1,1,1),new f.TO(-1,1,-1),new f.TO(-1,1,1)],r.FACE_UP=[new f.TO(-1,-1,-1),new f.TO(-1,-1,1),new f.TO(1,-1,-1),new f.TO(1,-1,1)];class M{constructor(){this.supportCascades=!1}loadCubeData(){throw".hdr not supported in Cube."}loadData(K,O,F){const f=new Uint8Array(K.buffer,K.byteOffset,K.byteLength),r=J(f),l=c(f,r),q=r.width*r.height,E=new Float32Array(4*q);for(let J=0;J<q;J+=1)E[4*J]=l[3*J],E[4*J+1]=l[3*J+1],E[4*J+2]=l[3*J+2],E[4*J+3]=1;F(r.width,r.height,O.generateMipMaps,!1,(()=>{const K=O.getEngine();O.type=1,O.format=5,O._gammaSpace=!1,K._uploadDataToTextureDirectly(O,E)}))}}}}]);