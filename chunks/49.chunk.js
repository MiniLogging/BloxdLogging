"use strict";(self["9s4i8ue3jq"]=self["9s4i8ue3jq"]||[]).push([[49],{15233:(a,c,o)=>{o.r(c),o.d(c,{_HDRTextureLoader:()=>C});var s=o(12810);class q{static ConvertPanoramaToCubemap(a,c,o,s){let q=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!a)throw"ConvertPanoramaToCubemap: input cannot be null";if(a.length!=c*o*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(s,this.FACE_FRONT,a,c,o,q),back:this.CreateCubemapTexture(s,this.FACE_BACK,a,c,o,q),left:this.CreateCubemapTexture(s,this.FACE_LEFT,a,c,o,q),right:this.CreateCubemapTexture(s,this.FACE_RIGHT,a,c,o,q),up:this.CreateCubemapTexture(s,this.FACE_UP,a,c,o,q),down:this.CreateCubemapTexture(s,this.FACE_DOWN,a,c,o,q),size:s,type:1,format:4,gammaSpace:!1}}static CreateCubemapTexture(a,c,o,s,q){let t=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const i=new ArrayBuffer(a*a*4*3),p=new Float32Array(i),G=t?Math.max(1,Math.round(s/4/a)):1,T=1/G,C=T*T,j=c[1].vc(c[0]).scale(T/a),L=c[3].vc(c[2]).scale(T/a),e=1/a;let g=0;for(let M=0;M<a;M++)for(let t=0;t<G;t++){let t=c[0],i=c[2];for(let c=0;c<a;c++)for(let T=0;T<G;T++){const G=i.vc(t).scale(g).add(t);G.normalize();const T=this.CalcProjectionSpherical(G,o,s,q);p[M*a*3+3*c+0]+=T.r*C,p[M*a*3+3*c+1]+=T.g*C,p[M*a*3+3*c+2]+=T.b*C,t=t.add(j),i=i.add(L)}g+=e*T}return p}static CalcProjectionSpherical(a,c,o,s){let q=Math.atan2(a.z,a.x);const t=Math.acos(a.y);for(;q<-Math.PI;)q+=2*Math.PI;for(;q>Math.PI;)q-=2*Math.PI;let i=q/Math.PI;const p=t/Math.PI;i=.5*i+.5;let G=Math.round(i*o);G<0?G=0:G>=o&&(G=o-1);let T=Math.round(p*s);T<0?T=0:T>=s&&(T=s-1);const C=s-T-1;return{r:c[C*o*3+3*G+0],g:c[C*o*3+3*G+1],b:c[C*o*3+3*G+2]}}}function t(a,c,o,s,q,t){q>0?(q=function(a,c){return c>1023?a*Math.pow(2,1023)*Math.pow(2,c-1023):c<-1074?a*Math.pow(2,-1074)*Math.pow(2,c+1074):a*Math.pow(2,c)}(1,q-136),a[t+0]=c*q,a[t+1]=o*q,a[t+2]=s*q):(a[t+0]=0,a[t+1]=0,a[t+2]=0)}function i(a,c){let o="",s="";for(let q=c;q<a.length-c&&(s=String.fromCharCode(a[q]),"\n"!=s);q++)o+=s;return o}function p(a){let c=0,o=0,s=i(a,0);if("#"!=s[0]||"?"!=s[1])throw"Bad HDR Format.";let q=!1,t=!1,p=0;do{p+=s.length+1,s=i(a,p),"FORMAT=32-bit_rle_rgbe"==s?t=!0:0==s.length&&(q=!0)}while(!q);if(!t)throw"HDR Bad header format, unsupported FORMAT";p+=s.length+1,s=i(a,p);const G=/^-Y (.*) \+X (.*)$/g.exec(s);if(!G||G.length<3)throw"HDR Bad header format, no size";if(o=parseInt(G[2]),c=parseInt(G[1]),o<8||o>32767)throw"HDR Bad header format, unsupported size";return p+=s.length+1,{height:c,width:o,dataPosition:p}}function G(a,c){return function(a,c){let o=c.height;const s=c.width;let q,i,p,G,C,j=c.dataPosition,L=0,e=0,g=0;const M=new ArrayBuffer(4*s),N=new Uint8Array(M),y=new ArrayBuffer(c.width*c.height*4*3),k=new Float32Array(y);for(;o>0;){if(q=a[j++],i=a[j++],p=a[j++],G=a[j++],2!=q||2!=i||128&p||c.width<8||c.width>32767)return T(a,c);if((p<<8|G)!=s)throw"HDR Bad header format, wrong scan line width";for(L=0,g=0;g<4;g++)for(e=(g+1)*s;L<e;)if(q=a[j++],i=a[j++],q>128){if(C=q-128,0==C||C>e-L)throw"HDR Bad Format, bad scanline data (run)";for(;C-- >0;)N[L++]=i}else{if(C=q,0==C||C>e-L)throw"HDR Bad Format, bad scanline data (non-run)";if(N[L++]=i,--C>0)for(let c=0;c<C;c++)N[L++]=a[j++]}for(g=0;g<s;g++)q=N[g],i=N[g+s],p=N[g+2*s],G=N[g+3*s],t(k,q,i,p,G,(c.height-o)*s*3+3*g);o--}return k}(a,c)}function T(a,c){let o=c.height;const s=c.width;let q,i,p,G,T,C=c.dataPosition;const j=new ArrayBuffer(c.width*c.height*4*3),L=new Float32Array(j);for(;o>0;){for(T=0;T<c.width;T++)q=a[C++],i=a[C++],p=a[C++],G=a[C++],t(L,q,i,p,G,(c.height-o)*s*3+3*T);o--}return L}q.FACE_LEFT=[new s.Hc(-1,-1,-1),new s.Hc(1,-1,-1),new s.Hc(-1,1,-1),new s.Hc(1,1,-1)],q.FACE_RIGHT=[new s.Hc(1,-1,1),new s.Hc(-1,-1,1),new s.Hc(1,1,1),new s.Hc(-1,1,1)],q.FACE_FRONT=[new s.Hc(1,-1,-1),new s.Hc(1,-1,1),new s.Hc(1,1,-1),new s.Hc(1,1,1)],q.FACE_BACK=[new s.Hc(-1,-1,1),new s.Hc(-1,-1,-1),new s.Hc(-1,1,1),new s.Hc(-1,1,-1)],q.FACE_DOWN=[new s.Hc(1,1,-1),new s.Hc(1,1,1),new s.Hc(-1,1,-1),new s.Hc(-1,1,1)],q.FACE_UP=[new s.Hc(-1,-1,-1),new s.Hc(-1,-1,1),new s.Hc(1,-1,-1),new s.Hc(1,-1,1)];class C{constructor(){this.supportCascades=!1}loadCubeData(){throw".hdr not supported in Cube."}loadData(a,c,o){const s=new Uint8Array(a.buffer,a.byteOffset,a.byteLength),q=p(s),t=G(s,q),i=q.width*q.height,T=new Float32Array(4*i);for(let p=0;p<i;p+=1)T[4*p]=t[3*p],T[4*p+1]=t[3*p+1],T[4*p+2]=t[3*p+2],T[4*p+3]=1;o(q.width,q.height,c.generateMipMaps,!1,(()=>{const a=c.getEngine();c.type=1,c.format=5,c._gammaSpace=!1,a._uploadDataToTextureDirectly(c,T)}))}}}}]);