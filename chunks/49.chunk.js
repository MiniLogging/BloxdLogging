"use strict";(self.g111kvdsqxc=self.g111kvdsqxc||[]).push([[49],{13730:(K,H,M)=>{M.r(H),M.d(H,{_HDRTextureLoader:()=>f});var q=M(11290);class w{static ConvertPanoramaToCubemap(K,H,M,q){let w=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!K)throw"ConvertPanoramaToCubemap: input cannot be null";if(K.length!=H*M*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(q,this.FACE_FRONT,K,H,M,w),back:this.CreateCubemapTexture(q,this.FACE_BACK,K,H,M,w),left:this.CreateCubemapTexture(q,this.FACE_LEFT,K,H,M,w),right:this.CreateCubemapTexture(q,this.FACE_RIGHT,K,H,M,w),up:this.CreateCubemapTexture(q,this.FACE_UP,K,H,M,w),down:this.CreateCubemapTexture(q,this.FACE_DOWN,K,H,M,w),size:q,type:1,format:4,gammaSpace:!1}}static CreateCubemapTexture(K,H,M,q,w){let u=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const y=new ArrayBuffer(K*K*4*3),h=new Float32Array(y),W=u?Math.max(1,Math.round(q/4/K)):1,I=1/W,f=I*I,z=H[1].LH(H[0]).scale(I/K),G=H[3].LH(H[2]).scale(I/K),a=1/K;let v=0;for(let O=0;O<K;O++)for(let u=0;u<W;u++){let u=H[0],y=H[2];for(let H=0;H<K;H++)for(let I=0;I<W;I++){const W=y.LH(u).scale(v).add(u);W.normalize();const I=this.CalcProjectionSpherical(W,M,q,w);h[O*K*3+3*H+0]+=I.r*f,h[O*K*3+3*H+1]+=I.g*f,h[O*K*3+3*H+2]+=I.b*f,u=u.add(z),y=y.add(G)}v+=a*I}return h}static CalcProjectionSpherical(K,H,M,q){let w=Math.atan2(K.z,K.x);const u=Math.acos(K.y);for(;w<-Math.PI;)w+=2*Math.PI;for(;w>Math.PI;)w-=2*Math.PI;let y=w/Math.PI;const h=u/Math.PI;y=.5*y+.5;let W=Math.round(y*M);W<0?W=0:W>=M&&(W=M-1);let I=Math.round(h*q);I<0?I=0:I>=q&&(I=q-1);const f=q-I-1;return{r:H[f*M*3+3*W+0],g:H[f*M*3+3*W+1],b:H[f*M*3+3*W+2]}}}function u(K,H,M,q,w,u){w>0?(w=function(K,H){return H>1023?K*Math.pow(2,1023)*Math.pow(2,H-1023):H<-1074?K*Math.pow(2,-1074)*Math.pow(2,H+1074):K*Math.pow(2,H)}(1,w-136),K[u+0]=H*w,K[u+1]=M*w,K[u+2]=q*w):(K[u+0]=0,K[u+1]=0,K[u+2]=0)}function y(K,H){let M="",q="";for(let w=H;w<K.length-H&&(q=String.fromCharCode(K[w]),"\n"!=q);w++)M+=q;return M}function h(K){let H=0,M=0,q=y(K,0);if("#"!=q[0]||"?"!=q[1])throw"Bad HDR Format.";let w=!1,u=!1,h=0;do{h+=q.length+1,q=y(K,h),"FORMAT=32-bit_rle_rgbe"==q?u=!0:0==q.length&&(w=!0)}while(!w);if(!u)throw"HDR Bad header format, unsupported FORMAT";h+=q.length+1,q=y(K,h);const W=/^-Y (.*) \+X (.*)$/g.exec(q);if(!W||W.length<3)throw"HDR Bad header format, no size";if(M=parseInt(W[2]),H=parseInt(W[1]),M<8||M>32767)throw"HDR Bad header format, unsupported size";return h+=q.length+1,{height:H,width:M,dataPosition:h}}function W(K,H){return function(K,H){let M=H.height;const q=H.width;let w,y,h,W,f,z=H.dataPosition,G=0,a=0,v=0;const O=new ArrayBuffer(4*q),L=new Uint8Array(O),S=new ArrayBuffer(H.width*H.height*4*3),B=new Float32Array(S);for(;M>0;){if(w=K[z++],y=K[z++],h=K[z++],W=K[z++],2!=w||2!=y||128&h||H.width<8||H.width>32767)return I(K,H);if((h<<8|W)!=q)throw"HDR Bad header format, wrong scan line width";for(G=0,v=0;v<4;v++)for(a=(v+1)*q;G<a;)if(w=K[z++],y=K[z++],w>128){if(f=w-128,0==f||f>a-G)throw"HDR Bad Format, bad scanline data (run)";for(;f-- >0;)L[G++]=y}else{if(f=w,0==f||f>a-G)throw"HDR Bad Format, bad scanline data (non-run)";if(L[G++]=y,--f>0)for(let H=0;H<f;H++)L[G++]=K[z++]}for(v=0;v<q;v++)w=L[v],y=L[v+q],h=L[v+2*q],W=L[v+3*q],u(B,w,y,h,W,(H.height-M)*q*3+3*v);M--}return B}(K,H)}function I(K,H){let M=H.height;const q=H.width;let w,y,h,W,I,f=H.dataPosition;const z=new ArrayBuffer(H.width*H.height*4*3),G=new Float32Array(z);for(;M>0;){for(I=0;I<H.width;I++)w=K[f++],y=K[f++],h=K[f++],W=K[f++],u(G,w,y,h,W,(H.height-M)*q*3+3*I);M--}return G}w.FACE_LEFT=[new q.OH(-1,-1,-1),new q.OH(1,-1,-1),new q.OH(-1,1,-1),new q.OH(1,1,-1)],w.FACE_RIGHT=[new q.OH(1,-1,1),new q.OH(-1,-1,1),new q.OH(1,1,1),new q.OH(-1,1,1)],w.FACE_FRONT=[new q.OH(1,-1,-1),new q.OH(1,-1,1),new q.OH(1,1,-1),new q.OH(1,1,1)],w.FACE_BACK=[new q.OH(-1,-1,1),new q.OH(-1,-1,-1),new q.OH(-1,1,1),new q.OH(-1,1,-1)],w.FACE_DOWN=[new q.OH(1,1,-1),new q.OH(1,1,1),new q.OH(-1,1,-1),new q.OH(-1,1,1)],w.FACE_UP=[new q.OH(-1,-1,-1),new q.OH(-1,-1,1),new q.OH(1,-1,-1),new q.OH(1,-1,1)];class f{constructor(){this.supportCascades=!1}loadCubeData(){throw".hdr not supported in Cube."}loadData(K,H,M){const q=new Uint8Array(K.buffer,K.byteOffset,K.byteLength),w=h(q),u=W(q,w),y=w.width*w.height,I=new Float32Array(4*y);for(let h=0;h<y;h+=1)I[4*h]=u[3*h],I[4*h+1]=u[3*h+1],I[4*h+2]=u[3*h+2],I[4*h+3]=1;M(w.width,w.height,H.generateMipMaps,!1,(()=>{const K=H.getEngine();H.type=1,H.format=5,H._gammaSpace=!1,K._uploadDataToTextureDirectly(H,I)}))}}}}]);