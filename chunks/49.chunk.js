"use strict";(self["1xyrlsr8vb9"]=self["1xyrlsr8vb9"]||[]).push([[49],{14636:(I,O,C)=>{C.r(O),C.d(O,{_HDRTextureLoader:()=>N});var j=C(12272);class K{static ConvertPanoramaToCubemap(I,O,C,j){let K=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!I)throw"ConvertPanoramaToCubemap: input cannot be null";if(I.length!=O*C*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(j,this.FACE_FRONT,I,O,C,K),back:this.CreateCubemapTexture(j,this.FACE_BACK,I,O,C,K),left:this.CreateCubemapTexture(j,this.FACE_LEFT,I,O,C,K),right:this.CreateCubemapTexture(j,this.FACE_RIGHT,I,O,C,K),up:this.CreateCubemapTexture(j,this.FACE_UP,I,O,C,K),down:this.CreateCubemapTexture(j,this.FACE_DOWN,I,O,C,K),size:j,type:1,format:4,gammaSpace:!1}}static CreateCubemapTexture(I,O,C,j,K){let i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const y=new ArrayBuffer(I*I*4*3),S=new Float32Array(y),U=i?Math.max(1,Math.round(j/4/I)):1,p=1/U,N=p*p,Q=O[1].EO(O[0]).scale(p/I),s=O[3].EO(O[2]).scale(p/I),Z=1/I;let q=0;for(let mI=0;mI<I;mI++)for(let i=0;i<U;i++){let i=O[0],y=O[2];for(let O=0;O<I;O++)for(let p=0;p<U;p++){const U=y.EO(i).scale(q).add(i);U.normalize();const p=this.CalcProjectionSpherical(U,C,j,K);S[mI*I*3+3*O+0]+=p.r*N,S[mI*I*3+3*O+1]+=p.g*N,S[mI*I*3+3*O+2]+=p.b*N,i=i.add(Q),y=y.add(s)}q+=Z*p}return S}static CalcProjectionSpherical(I,O,C,j){let K=Math.atan2(I.z,I.x);const i=Math.acos(I.y);for(;K<-Math.PI;)K+=2*Math.PI;for(;K>Math.PI;)K-=2*Math.PI;let y=K/Math.PI;const S=i/Math.PI;y=.5*y+.5;let U=Math.round(y*C);U<0?U=0:U>=C&&(U=C-1);let p=Math.round(S*j);p<0?p=0:p>=j&&(p=j-1);const N=j-p-1;return{r:O[N*C*3+3*U+0],g:O[N*C*3+3*U+1],b:O[N*C*3+3*U+2]}}}function i(I,O,C,j,K,i){K>0?(K=function(I,O){return O>1023?I*Math.pow(2,1023)*Math.pow(2,O-1023):O<-1074?I*Math.pow(2,-1074)*Math.pow(2,O+1074):I*Math.pow(2,O)}(1,K-136),I[i+0]=O*K,I[i+1]=C*K,I[i+2]=j*K):(I[i+0]=0,I[i+1]=0,I[i+2]=0)}function y(I,O){let C="",j="";for(let K=O;K<I.length-O&&(j=String.fromCharCode(I[K]),"\n"!=j);K++)C+=j;return C}function S(I){let O=0,C=0,j=y(I,0);if("#"!=j[0]||"?"!=j[1])throw"Bad HDR Format.";let K=!1,i=!1,S=0;do{S+=j.length+1,j=y(I,S),"FORMAT=32-bit_rle_rgbe"==j?i=!0:0==j.length&&(K=!0)}while(!K);if(!i)throw"HDR Bad header format, unsupported FORMAT";S+=j.length+1,j=y(I,S);const U=/^-Y (.*) \+X (.*)$/g.exec(j);if(!U||U.length<3)throw"HDR Bad header format, no size";if(C=parseInt(U[2]),O=parseInt(U[1]),C<8||C>32767)throw"HDR Bad header format, unsupported size";return S+=j.length+1,{height:O,width:C,dataPosition:S}}function U(I,O){return function(I,O){let C=O.height;const j=O.width;let K,y,S,U,N,Q=O.dataPosition,s=0,Z=0,q=0;const mI=new ArrayBuffer(4*j),E=new Uint8Array(mI),h=new ArrayBuffer(O.width*O.height*4*3),r=new Float32Array(h);for(;C>0;){if(K=I[Q++],y=I[Q++],S=I[Q++],U=I[Q++],2!=K||2!=y||128&S||O.width<8||O.width>32767)return p(I,O);if((S<<8|U)!=j)throw"HDR Bad header format, wrong scan line width";for(s=0,q=0;q<4;q++)for(Z=(q+1)*j;s<Z;)if(K=I[Q++],y=I[Q++],K>128){if(N=K-128,0==N||N>Z-s)throw"HDR Bad Format, bad scanline data (run)";for(;N-- >0;)E[s++]=y}else{if(N=K,0==N||N>Z-s)throw"HDR Bad Format, bad scanline data (non-run)";if(E[s++]=y,--N>0)for(let O=0;O<N;O++)E[s++]=I[Q++]}for(q=0;q<j;q++)K=E[q],y=E[q+j],S=E[q+2*j],U=E[q+3*j],i(r,K,y,S,U,(O.height-C)*j*3+3*q);C--}return r}(I,O)}function p(I,O){let C=O.height;const j=O.width;let K,y,S,U,p,N=O.dataPosition;const Q=new ArrayBuffer(O.width*O.height*4*3),s=new Float32Array(Q);for(;C>0;){for(p=0;p<O.width;p++)K=I[N++],y=I[N++],S=I[N++],U=I[N++],i(s,K,y,S,U,(O.height-C)*j*3+3*p);C--}return s}K.FACE_LEFT=[new j.mC(-1,-1,-1),new j.mC(1,-1,-1),new j.mC(-1,1,-1),new j.mC(1,1,-1)],K.FACE_RIGHT=[new j.mC(1,-1,1),new j.mC(-1,-1,1),new j.mC(1,1,1),new j.mC(-1,1,1)],K.FACE_FRONT=[new j.mC(1,-1,-1),new j.mC(1,-1,1),new j.mC(1,1,-1),new j.mC(1,1,1)],K.FACE_BACK=[new j.mC(-1,-1,1),new j.mC(-1,-1,-1),new j.mC(-1,1,1),new j.mC(-1,1,-1)],K.FACE_DOWN=[new j.mC(1,1,-1),new j.mC(1,1,1),new j.mC(-1,1,-1),new j.mC(-1,1,1)],K.FACE_UP=[new j.mC(-1,-1,-1),new j.mC(-1,-1,1),new j.mC(1,-1,-1),new j.mC(1,-1,1)];class N{constructor(){this.supportCascades=!1}loadCubeData(){throw".hdr not supported in Cube."}loadData(I,O,C){const j=new Uint8Array(I.buffer,I.byteOffset,I.byteLength),K=S(j),i=U(j,K),y=K.width*K.height,p=new Float32Array(4*y);for(let S=0;S<y;S+=1)p[4*S]=i[3*S],p[4*S+1]=i[3*S+1],p[4*S+2]=i[3*S+2],p[4*S+3]=1;C(K.width,K.height,O.generateMipMaps,!1,(()=>{const I=O.getEngine();O.type=1,O.format=5,O._gammaSpace=!1,I._uploadDataToTextureDirectly(O,p)}))}}}}]);