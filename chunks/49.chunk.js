"use strict";(self["3nlrbof8msu"]=self["3nlrbof8msu"]||[]).push([[49],{15184:(t,b,Z)=>{Z.r(b),Z.d(b,{_HDRTextureLoader:()=>g});var J=Z(12735);class S{static ConvertPanoramaToCubemap(t,b,Z,J){let S=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!t)throw"ConvertPanoramaToCubemap: input cannot be null";if(t.length!=b*Z*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(J,this.FACE_FRONT,t,b,Z,S),back:this.CreateCubemapTexture(J,this.FACE_BACK,t,b,Z,S),left:this.CreateCubemapTexture(J,this.FACE_LEFT,t,b,Z,S),right:this.CreateCubemapTexture(J,this.FACE_RIGHT,t,b,Z,S),up:this.CreateCubemapTexture(J,this.FACE_UP,t,b,Z,S),down:this.CreateCubemapTexture(J,this.FACE_DOWN,t,b,Z,S),size:J,type:1,format:4,gammaSpace:!1}}static CreateCubemapTexture(t,b,Z,J,S){let P=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const v=new ArrayBuffer(t*t*4*3),h=new Float32Array(v),C=P?Math.max(1,Math.round(J/4/t)):1,Y=1/C,g=Y*Y,I=b[1].SZ(b[0]).scale(Y/t),r=b[3].SZ(b[2]).scale(Y/t),M=1/t;let T=0;for(let a=0;a<t;a++)for(let P=0;P<C;P++){let P=b[0],v=b[2];for(let b=0;b<t;b++)for(let Y=0;Y<C;Y++){const C=v.SZ(P).scale(T).add(P);C.normalize();const Y=this.CalcProjectionSpherical(C,Z,J,S);h[a*t*3+3*b+0]+=Y.r*g,h[a*t*3+3*b+1]+=Y.g*g,h[a*t*3+3*b+2]+=Y.b*g,P=P.add(I),v=v.add(r)}T+=M*Y}return h}static CalcProjectionSpherical(t,b,Z,J){let S=Math.atan2(t.z,t.x);const P=Math.acos(t.y);for(;S<-Math.PI;)S+=2*Math.PI;for(;S>Math.PI;)S-=2*Math.PI;let v=S/Math.PI;const h=P/Math.PI;v=.5*v+.5;let C=Math.round(v*Z);C<0?C=0:C>=Z&&(C=Z-1);let Y=Math.round(h*J);Y<0?Y=0:Y>=J&&(Y=J-1);const g=J-Y-1;return{r:b[g*Z*3+3*C+0],g:b[g*Z*3+3*C+1],b:b[g*Z*3+3*C+2]}}}function P(t,b,Z,J,S,P){S>0?(S=function(t,b){return b>1023?t*Math.pow(2,1023)*Math.pow(2,b-1023):b<-1074?t*Math.pow(2,-1074)*Math.pow(2,b+1074):t*Math.pow(2,b)}(1,S-136),t[P+0]=b*S,t[P+1]=Z*S,t[P+2]=J*S):(t[P+0]=0,t[P+1]=0,t[P+2]=0)}function v(t,b){let Z="",J="";for(let S=b;S<t.length-b&&(J=String.fromCharCode(t[S]),"\n"!=J);S++)Z+=J;return Z}function h(t){let b=0,Z=0,J=v(t,0);if("#"!=J[0]||"?"!=J[1])throw"Bad HDR Format.";let S=!1,P=!1,h=0;do{h+=J.length+1,J=v(t,h),"FORMAT=32-bit_rle_rgbe"==J?P=!0:0==J.length&&(S=!0)}while(!S);if(!P)throw"HDR Bad header format, unsupported FORMAT";h+=J.length+1,J=v(t,h);const C=/^-Y (.*) \+X (.*)$/g.exec(J);if(!C||C.length<3)throw"HDR Bad header format, no size";if(Z=parseInt(C[2]),b=parseInt(C[1]),Z<8||Z>32767)throw"HDR Bad header format, unsupported size";return h+=J.length+1,{height:b,width:Z,dataPosition:h}}function C(t,b){return function(t,b){let Z=b.height;const J=b.width;let S,v,h,C,g,I=b.dataPosition,r=0,M=0,T=0;const a=new ArrayBuffer(4*J),k=new Uint8Array(a),u=new ArrayBuffer(b.width*b.height*4*3),l=new Float32Array(u);for(;Z>0;){if(S=t[I++],v=t[I++],h=t[I++],C=t[I++],2!=S||2!=v||128&h||b.width<8||b.width>32767)return Y(t,b);if((h<<8|C)!=J)throw"HDR Bad header format, wrong scan line width";for(r=0,T=0;T<4;T++)for(M=(T+1)*J;r<M;)if(S=t[I++],v=t[I++],S>128){if(g=S-128,0==g||g>M-r)throw"HDR Bad Format, bad scanline data (run)";for(;g-- >0;)k[r++]=v}else{if(g=S,0==g||g>M-r)throw"HDR Bad Format, bad scanline data (non-run)";if(k[r++]=v,--g>0)for(let b=0;b<g;b++)k[r++]=t[I++]}for(T=0;T<J;T++)S=k[T],v=k[T+J],h=k[T+2*J],C=k[T+3*J],P(l,S,v,h,C,(b.height-Z)*J*3+3*T);Z--}return l}(t,b)}function Y(t,b){let Z=b.height;const J=b.width;let S,v,h,C,Y,g=b.dataPosition;const I=new ArrayBuffer(b.width*b.height*4*3),r=new Float32Array(I);for(;Z>0;){for(Y=0;Y<b.width;Y++)S=t[g++],v=t[g++],h=t[g++],C=t[g++],P(r,S,v,h,C,(b.height-Z)*J*3+3*Y);Z--}return r}S.FACE_LEFT=[new J.JZ(-1,-1,-1),new J.JZ(1,-1,-1),new J.JZ(-1,1,-1),new J.JZ(1,1,-1)],S.FACE_RIGHT=[new J.JZ(1,-1,1),new J.JZ(-1,-1,1),new J.JZ(1,1,1),new J.JZ(-1,1,1)],S.FACE_FRONT=[new J.JZ(1,-1,-1),new J.JZ(1,-1,1),new J.JZ(1,1,-1),new J.JZ(1,1,1)],S.FACE_BACK=[new J.JZ(-1,-1,1),new J.JZ(-1,-1,-1),new J.JZ(-1,1,1),new J.JZ(-1,1,-1)],S.FACE_DOWN=[new J.JZ(1,1,-1),new J.JZ(1,1,1),new J.JZ(-1,1,-1),new J.JZ(-1,1,1)],S.FACE_UP=[new J.JZ(-1,-1,-1),new J.JZ(-1,-1,1),new J.JZ(1,-1,-1),new J.JZ(1,-1,1)];class g{constructor(){this.supportCascades=!1}loadCubeData(){throw".hdr not supported in Cube."}loadData(t,b,Z){const J=new Uint8Array(t.buffer,t.byteOffset,t.byteLength),S=h(J),P=C(J,S),v=S.width*S.height,Y=new Float32Array(4*v);for(let h=0;h<v;h+=1)Y[4*h]=P[3*h],Y[4*h+1]=P[3*h+1],Y[4*h+2]=P[3*h+2],Y[4*h+3]=1;Z(S.width,S.height,b.generateMipMaps,!1,(()=>{const t=b.getEngine();b.type=1,b.format=5,b._gammaSpace=!1,t._uploadDataToTextureDirectly(b,Y)}))}}}}]);