"use strict";(self["269hv5nclphh"]=self["269hv5nclphh"]||[]).push([[49],{14851:(E,H,d)=>{d.r(H),d.d(H,{_HDRTextureLoader:()=>S});var n=d(12384);class Z{static ConvertPanoramaToCubemap(E,H,d,n){let Z=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!E)throw"ConvertPanoramaToCubemap: input cannot be null";if(E.length!=H*d*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(n,this.FACE_FRONT,E,H,d,Z),back:this.CreateCubemapTexture(n,this.FACE_BACK,E,H,d,Z),left:this.CreateCubemapTexture(n,this.FACE_LEFT,E,H,d,Z),right:this.CreateCubemapTexture(n,this.FACE_RIGHT,E,H,d,Z),up:this.CreateCubemapTexture(n,this.FACE_UP,E,H,d,Z),down:this.CreateCubemapTexture(n,this.FACE_DOWN,E,H,d,Z),size:n,type:1,format:4,gammaSpace:!1}}static CreateCubemapTexture(E,H,d,n,Z){let I=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const g=new ArrayBuffer(E*E*4*3),l=new Float32Array(g),r=I?Math.max(1,Math.round(n/4/E)):1,t=1/r,S=t*t,M=H[1].RH(H[0]).scale(t/E),V=H[3].RH(H[2]).scale(t/E),C=1/E;let w=0;for(let R=0;R<E;R++)for(let I=0;I<r;I++){let I=H[0],g=H[2];for(let H=0;H<E;H++)for(let t=0;t<r;t++){const r=g.RH(I).scale(w).add(I);r.normalize();const t=this.CalcProjectionSpherical(r,d,n,Z);l[R*E*3+3*H+0]+=t.r*S,l[R*E*3+3*H+1]+=t.g*S,l[R*E*3+3*H+2]+=t.b*S,I=I.add(M),g=g.add(V)}w+=C*t}return l}static CalcProjectionSpherical(E,H,d,n){let Z=Math.atan2(E.z,E.x);const I=Math.acos(E.y);for(;Z<-Math.PI;)Z+=2*Math.PI;for(;Z>Math.PI;)Z-=2*Math.PI;let g=Z/Math.PI;const l=I/Math.PI;g=.5*g+.5;let r=Math.round(g*d);r<0?r=0:r>=d&&(r=d-1);let t=Math.round(l*n);t<0?t=0:t>=n&&(t=n-1);const S=n-t-1;return{r:H[S*d*3+3*r+0],g:H[S*d*3+3*r+1],b:H[S*d*3+3*r+2]}}}function I(E,H,d,n,Z,I){Z>0?(Z=function(E,H){return H>1023?E*Math.pow(2,1023)*Math.pow(2,H-1023):H<-1074?E*Math.pow(2,-1074)*Math.pow(2,H+1074):E*Math.pow(2,H)}(1,Z-136),E[I+0]=H*Z,E[I+1]=d*Z,E[I+2]=n*Z):(E[I+0]=0,E[I+1]=0,E[I+2]=0)}function g(E,H){let d="",n="";for(let Z=H;Z<E.length-H&&(n=String.fromCharCode(E[Z]),"\n"!=n);Z++)d+=n;return d}function l(E){let H=0,d=0,n=g(E,0);if("#"!=n[0]||"?"!=n[1])throw"Bad HDR Format.";let Z=!1,I=!1,l=0;do{l+=n.length+1,n=g(E,l),"FORMAT=32-bit_rle_rgbe"==n?I=!0:0==n.length&&(Z=!0)}while(!Z);if(!I)throw"HDR Bad header format, unsupported FORMAT";l+=n.length+1,n=g(E,l);const r=/^-Y (.*) \+X (.*)$/g.exec(n);if(!r||r.length<3)throw"HDR Bad header format, no size";if(d=parseInt(r[2]),H=parseInt(r[1]),d<8||d>32767)throw"HDR Bad header format, unsupported size";return l+=n.length+1,{height:H,width:d,dataPosition:l}}function r(E,H){return function(E,H){let d=H.height;const n=H.width;let Z,g,l,r,S,M=H.dataPosition,V=0,C=0,w=0;const R=new ArrayBuffer(4*n),Q=new Uint8Array(R),L=new ArrayBuffer(H.width*H.height*4*3),D=new Float32Array(L);for(;d>0;){if(Z=E[M++],g=E[M++],l=E[M++],r=E[M++],2!=Z||2!=g||128&l||H.width<8||H.width>32767)return t(E,H);if((l<<8|r)!=n)throw"HDR Bad header format, wrong scan line width";for(V=0,w=0;w<4;w++)for(C=(w+1)*n;V<C;)if(Z=E[M++],g=E[M++],Z>128){if(S=Z-128,0==S||S>C-V)throw"HDR Bad Format, bad scanline data (run)";for(;S-- >0;)Q[V++]=g}else{if(S=Z,0==S||S>C-V)throw"HDR Bad Format, bad scanline data (non-run)";if(Q[V++]=g,--S>0)for(let H=0;H<S;H++)Q[V++]=E[M++]}for(w=0;w<n;w++)Z=Q[w],g=Q[w+n],l=Q[w+2*n],r=Q[w+3*n],I(D,Z,g,l,r,(H.height-d)*n*3+3*w);d--}return D}(E,H)}function t(E,H){let d=H.height;const n=H.width;let Z,g,l,r,t,S=H.dataPosition;const M=new ArrayBuffer(H.width*H.height*4*3),V=new Float32Array(M);for(;d>0;){for(t=0;t<H.width;t++)Z=E[S++],g=E[S++],l=E[S++],r=E[S++],I(V,Z,g,l,r,(H.height-d)*n*3+3*t);d--}return V}Z.FACE_LEFT=[new n.wH(-1,-1,-1),new n.wH(1,-1,-1),new n.wH(-1,1,-1),new n.wH(1,1,-1)],Z.FACE_RIGHT=[new n.wH(1,-1,1),new n.wH(-1,-1,1),new n.wH(1,1,1),new n.wH(-1,1,1)],Z.FACE_FRONT=[new n.wH(1,-1,-1),new n.wH(1,-1,1),new n.wH(1,1,-1),new n.wH(1,1,1)],Z.FACE_BACK=[new n.wH(-1,-1,1),new n.wH(-1,-1,-1),new n.wH(-1,1,1),new n.wH(-1,1,-1)],Z.FACE_DOWN=[new n.wH(1,1,-1),new n.wH(1,1,1),new n.wH(-1,1,-1),new n.wH(-1,1,1)],Z.FACE_UP=[new n.wH(-1,-1,-1),new n.wH(-1,-1,1),new n.wH(1,-1,-1),new n.wH(1,-1,1)];class S{constructor(){this.supportCascades=!1}loadCubeData(){throw".hdr not supported in Cube."}loadData(E,H,d){const n=new Uint8Array(E.buffer,E.byteOffset,E.byteLength),Z=l(n),I=r(n,Z),g=Z.width*Z.height,t=new Float32Array(4*g);for(let l=0;l<g;l+=1)t[4*l]=I[3*l],t[4*l+1]=I[3*l+1],t[4*l+2]=I[3*l+2],t[4*l+3]=1;d(Z.width,Z.height,H.generateMipMaps,!1,(()=>{const E=H.getEngine();H.type=1,H.format=5,H._gammaSpace=!1,E._uploadDataToTextureDirectly(H,t)}))}}}}]);