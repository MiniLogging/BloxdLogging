"use strict";(self.wy695la1oic=self.wy695la1oic||[]).push([[49],{13864:(S,v,D)=>{D.r(v),D.d(v,{_HDRTextureLoader:()=>h});var z=D(11371);class e{static ConvertPanoramaToCubemap(S,v,D,z){let e=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!S)throw"ConvertPanoramaToCubemap: input cannot be null";if(S.length!=v*D*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(z,this.FACE_FRONT,S,v,D,e),back:this.CreateCubemapTexture(z,this.FACE_BACK,S,v,D,e),left:this.CreateCubemapTexture(z,this.FACE_LEFT,S,v,D,e),right:this.CreateCubemapTexture(z,this.FACE_RIGHT,S,v,D,e),up:this.CreateCubemapTexture(z,this.FACE_UP,S,v,D,e),down:this.CreateCubemapTexture(z,this.FACE_DOWN,S,v,D,e),size:z,type:1,format:4,gammaSpace:!1}}static CreateCubemapTexture(S,v,D,z,e){let N=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const m=new ArrayBuffer(S*S*4*3),B=new Float32Array(m),g=N?Math.max(1,Math.round(z/4/S)):1,E=1/g,h=E*E,A=v[1].Ov(v[0]).scale(E/S),w=v[3].Ov(v[2]).scale(E/S),n=1/S;let R=0;for(let O=0;O<S;O++)for(let N=0;N<g;N++){let N=v[0],m=v[2];for(let v=0;v<S;v++)for(let E=0;E<g;E++){const g=m.Ov(N).scale(R).add(N);g.normalize();const E=this.CalcProjectionSpherical(g,D,z,e);B[O*S*3+3*v+0]+=E.r*h,B[O*S*3+3*v+1]+=E.g*h,B[O*S*3+3*v+2]+=E.b*h,N=N.add(A),m=m.add(w)}R+=n*E}return B}static CalcProjectionSpherical(S,v,D,z){let e=Math.atan2(S.z,S.x);const N=Math.acos(S.y);for(;e<-Math.PI;)e+=2*Math.PI;for(;e>Math.PI;)e-=2*Math.PI;let m=e/Math.PI;const B=N/Math.PI;m=.5*m+.5;let g=Math.round(m*D);g<0?g=0:g>=D&&(g=D-1);let E=Math.round(B*z);E<0?E=0:E>=z&&(E=z-1);const h=z-E-1;return{r:v[h*D*3+3*g+0],g:v[h*D*3+3*g+1],b:v[h*D*3+3*g+2]}}}function N(S,v,D,z,e,N){e>0?(e=function(S,v){return v>1023?S*Math.pow(2,1023)*Math.pow(2,v-1023):v<-1074?S*Math.pow(2,-1074)*Math.pow(2,v+1074):S*Math.pow(2,v)}(1,e-136),S[N+0]=v*e,S[N+1]=D*e,S[N+2]=z*e):(S[N+0]=0,S[N+1]=0,S[N+2]=0)}function m(S,v){let D="",z="";for(let e=v;e<S.length-v&&(z=String.fromCharCode(S[e]),"\n"!=z);e++)D+=z;return D}function B(S){let v=0,D=0,z=m(S,0);if("#"!=z[0]||"?"!=z[1])throw"Bad HDR Format.";let e=!1,N=!1,B=0;do{B+=z.length+1,z=m(S,B),"FORMAT=32-bit_rle_rgbe"==z?N=!0:0==z.length&&(e=!0)}while(!e);if(!N)throw"HDR Bad header format, unsupported FORMAT";B+=z.length+1,z=m(S,B);const g=/^-Y (.*) \+X (.*)$/g.exec(z);if(!g||g.length<3)throw"HDR Bad header format, no size";if(D=parseInt(g[2]),v=parseInt(g[1]),D<8||D>32767)throw"HDR Bad header format, unsupported size";return B+=z.length+1,{height:v,width:D,dataPosition:B}}function g(S,v){return function(S,v){let D=v.height;const z=v.width;let e,m,B,g,h,A=v.dataPosition,w=0,n=0,R=0;const O=new ArrayBuffer(4*z),I=new Uint8Array(O),K=new ArrayBuffer(v.width*v.height*4*3),q=new Float32Array(K);for(;D>0;){if(e=S[A++],m=S[A++],B=S[A++],g=S[A++],2!=e||2!=m||128&B||v.width<8||v.width>32767)return E(S,v);if((B<<8|g)!=z)throw"HDR Bad header format, wrong scan line width";for(w=0,R=0;R<4;R++)for(n=(R+1)*z;w<n;)if(e=S[A++],m=S[A++],e>128){if(h=e-128,0==h||h>n-w)throw"HDR Bad Format, bad scanline data (run)";for(;h-- >0;)I[w++]=m}else{if(h=e,0==h||h>n-w)throw"HDR Bad Format, bad scanline data (non-run)";if(I[w++]=m,--h>0)for(let v=0;v<h;v++)I[w++]=S[A++]}for(R=0;R<z;R++)e=I[R],m=I[R+z],B=I[R+2*z],g=I[R+3*z],N(q,e,m,B,g,(v.height-D)*z*3+3*R);D--}return q}(S,v)}function E(S,v){let D=v.height;const z=v.width;let e,m,B,g,E,h=v.dataPosition;const A=new ArrayBuffer(v.width*v.height*4*3),w=new Float32Array(A);for(;D>0;){for(E=0;E<v.width;E++)e=S[h++],m=S[h++],B=S[h++],g=S[h++],N(w,e,m,B,g,(v.height-D)*z*3+3*E);D--}return w}e.FACE_LEFT=[new z.Rv(-1,-1,-1),new z.Rv(1,-1,-1),new z.Rv(-1,1,-1),new z.Rv(1,1,-1)],e.FACE_RIGHT=[new z.Rv(1,-1,1),new z.Rv(-1,-1,1),new z.Rv(1,1,1),new z.Rv(-1,1,1)],e.FACE_FRONT=[new z.Rv(1,-1,-1),new z.Rv(1,-1,1),new z.Rv(1,1,-1),new z.Rv(1,1,1)],e.FACE_BACK=[new z.Rv(-1,-1,1),new z.Rv(-1,-1,-1),new z.Rv(-1,1,1),new z.Rv(-1,1,-1)],e.FACE_DOWN=[new z.Rv(1,1,-1),new z.Rv(1,1,1),new z.Rv(-1,1,-1),new z.Rv(-1,1,1)],e.FACE_UP=[new z.Rv(-1,-1,-1),new z.Rv(-1,-1,1),new z.Rv(1,-1,-1),new z.Rv(1,-1,1)];class h{constructor(){this.supportCascades=!1}loadCubeData(){throw".hdr not supported in Cube."}loadData(S,v,D){const z=new Uint8Array(S.buffer,S.byteOffset,S.byteLength),e=B(z),N=g(z,e),m=e.width*e.height,E=new Float32Array(4*m);for(let B=0;B<m;B+=1)E[4*B]=N[3*B],E[4*B+1]=N[3*B+1],E[4*B+2]=N[3*B+2],E[4*B+3]=1;D(e.width,e.height,v.generateMipMaps,!1,(()=>{const S=v.getEngine();v.type=1,v.format=5,v._gammaSpace=!1,S._uploadDataToTextureDirectly(v,E)}))}}}}]);