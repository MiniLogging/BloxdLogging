"use strict";(self.hmihoa2fs98=self.hmihoa2fs98||[]).push([[49],{14104:(b,d,P)=>{P.r(d),P.d(d,{_HDRTextureLoader:()=>x});var G=P(11681);class W{static ConvertPanoramaToCubemap(b,d,P,G){let W=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!b)throw"ConvertPanoramaToCubemap: input cannot be null";if(b.length!=d*P*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(G,this.FACE_FRONT,b,d,P,W),back:this.CreateCubemapTexture(G,this.FACE_BACK,b,d,P,W),left:this.CreateCubemapTexture(G,this.FACE_LEFT,b,d,P,W),right:this.CreateCubemapTexture(G,this.FACE_RIGHT,b,d,P,W),up:this.CreateCubemapTexture(G,this.FACE_UP,b,d,P,W),down:this.CreateCubemapTexture(G,this.FACE_DOWN,b,d,P,W),size:G,type:1,format:4,gammaSpace:!1}}static CreateCubemapTexture(b,d,P,G,W){let i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const q=new ArrayBuffer(b*b*4*3),C=new Float32Array(q),J=i?Math.max(1,Math.round(G/4/b)):1,L=1/J,x=L*L,Y=d[1].Rd(d[0]).scale(L/b),s=d[3].Rd(d[2]).scale(L/b),E=1/b;let w=0;for(let t=0;t<b;t++)for(let i=0;i<J;i++){let i=d[0],q=d[2];for(let d=0;d<b;d++)for(let L=0;L<J;L++){const J=q.Rd(i).scale(w).add(i);J.normalize();const L=this.CalcProjectionSpherical(J,P,G,W);C[t*b*3+3*d+0]+=L.r*x,C[t*b*3+3*d+1]+=L.g*x,C[t*b*3+3*d+2]+=L.b*x,i=i.add(Y),q=q.add(s)}w+=E*L}return C}static CalcProjectionSpherical(b,d,P,G){let W=Math.atan2(b.z,b.x);const i=Math.acos(b.y);for(;W<-Math.PI;)W+=2*Math.PI;for(;W>Math.PI;)W-=2*Math.PI;let q=W/Math.PI;const C=i/Math.PI;q=.5*q+.5;let J=Math.round(q*P);J<0?J=0:J>=P&&(J=P-1);let L=Math.round(C*G);L<0?L=0:L>=G&&(L=G-1);const x=G-L-1;return{r:d[x*P*3+3*J+0],g:d[x*P*3+3*J+1],b:d[x*P*3+3*J+2]}}}function i(b,d,P,G,W,i){W>0?(W=function(b,d){return d>1023?b*Math.pow(2,1023)*Math.pow(2,d-1023):d<-1074?b*Math.pow(2,-1074)*Math.pow(2,d+1074):b*Math.pow(2,d)}(1,W-136),b[i+0]=d*W,b[i+1]=P*W,b[i+2]=G*W):(b[i+0]=0,b[i+1]=0,b[i+2]=0)}function q(b,d){let P="",G="";for(let W=d;W<b.length-d&&(G=String.fromCharCode(b[W]),"\n"!=G);W++)P+=G;return P}function C(b){let d=0,P=0,G=q(b,0);if("#"!=G[0]||"?"!=G[1])throw"Bad HDR Format.";let W=!1,i=!1,C=0;do{C+=G.length+1,G=q(b,C),"FORMAT=32-bit_rle_rgbe"==G?i=!0:0==G.length&&(W=!0)}while(!W);if(!i)throw"HDR Bad header format, unsupported FORMAT";C+=G.length+1,G=q(b,C);const J=/^-Y (.*) \+X (.*)$/g.exec(G);if(!J||J.length<3)throw"HDR Bad header format, no size";if(P=parseInt(J[2]),d=parseInt(J[1]),P<8||P>32767)throw"HDR Bad header format, unsupported size";return C+=G.length+1,{height:d,width:P,dataPosition:C}}function J(b,d){return function(b,d){let P=d.height;const G=d.width;let W,q,C,J,x,Y=d.dataPosition,s=0,E=0,w=0;const t=new ArrayBuffer(4*G),r=new Uint8Array(t),B=new ArrayBuffer(d.width*d.height*4*3),n=new Float32Array(B);for(;P>0;){if(W=b[Y++],q=b[Y++],C=b[Y++],J=b[Y++],2!=W||2!=q||128&C||d.width<8||d.width>32767)return L(b,d);if((C<<8|J)!=G)throw"HDR Bad header format, wrong scan line width";for(s=0,w=0;w<4;w++)for(E=(w+1)*G;s<E;)if(W=b[Y++],q=b[Y++],W>128){if(x=W-128,0==x||x>E-s)throw"HDR Bad Format, bad scanline data (run)";for(;x-- >0;)r[s++]=q}else{if(x=W,0==x||x>E-s)throw"HDR Bad Format, bad scanline data (non-run)";if(r[s++]=q,--x>0)for(let d=0;d<x;d++)r[s++]=b[Y++]}for(w=0;w<G;w++)W=r[w],q=r[w+G],C=r[w+2*G],J=r[w+3*G],i(n,W,q,C,J,(d.height-P)*G*3+3*w);P--}return n}(b,d)}function L(b,d){let P=d.height;const G=d.width;let W,q,C,J,L,x=d.dataPosition;const Y=new ArrayBuffer(d.width*d.height*4*3),s=new Float32Array(Y);for(;P>0;){for(L=0;L<d.width;L++)W=b[x++],q=b[x++],C=b[x++],J=b[x++],i(s,W,q,C,J,(d.height-P)*G*3+3*L);P--}return s}W.FACE_LEFT=[new G.ed(-1,-1,-1),new G.ed(1,-1,-1),new G.ed(-1,1,-1),new G.ed(1,1,-1)],W.FACE_RIGHT=[new G.ed(1,-1,1),new G.ed(-1,-1,1),new G.ed(1,1,1),new G.ed(-1,1,1)],W.FACE_FRONT=[new G.ed(1,-1,-1),new G.ed(1,-1,1),new G.ed(1,1,-1),new G.ed(1,1,1)],W.FACE_BACK=[new G.ed(-1,-1,1),new G.ed(-1,-1,-1),new G.ed(-1,1,1),new G.ed(-1,1,-1)],W.FACE_DOWN=[new G.ed(1,1,-1),new G.ed(1,1,1),new G.ed(-1,1,-1),new G.ed(-1,1,1)],W.FACE_UP=[new G.ed(-1,-1,-1),new G.ed(-1,-1,1),new G.ed(1,-1,-1),new G.ed(1,-1,1)];class x{constructor(){this.supportCascades=!1}loadCubeData(){throw".hdr not supported in Cube."}loadData(b,d,P){const G=new Uint8Array(b.buffer,b.byteOffset,b.byteLength),W=C(G),i=J(G,W),q=W.width*W.height,L=new Float32Array(4*q);for(let C=0;C<q;C+=1)L[4*C]=i[3*C],L[4*C+1]=i[3*C+1],L[4*C+2]=i[3*C+2],L[4*C+3]=1;P(W.width,W.height,d.generateMipMaps,!1,(()=>{const b=d.getEngine();d.type=1,d.format=5,d._gammaSpace=!1,b._uploadDataToTextureDirectly(d,L)}))}}}}]);