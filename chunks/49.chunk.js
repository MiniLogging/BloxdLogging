"use strict";(self.bjbkv7h3qsd=self.bjbkv7h3qsd||[]).push([[49],{13647:(G,A,j)=>{j.r(A),j.d(A,{_HDRTextureLoader:()=>h});var u=j(11218);class k{static ConvertPanoramaToCubemap(G,A,j,u){let k=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!G)throw"ConvertPanoramaToCubemap: input cannot be null";if(G.length!=A*j*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(u,this.FACE_FRONT,G,A,j,k),back:this.CreateCubemapTexture(u,this.FACE_BACK,G,A,j,k),left:this.CreateCubemapTexture(u,this.FACE_LEFT,G,A,j,k),right:this.CreateCubemapTexture(u,this.FACE_RIGHT,G,A,j,k),up:this.CreateCubemapTexture(u,this.FACE_UP,G,A,j,k),down:this.CreateCubemapTexture(u,this.FACE_DOWN,G,A,j,k),size:u,type:1,format:4,gammaSpace:!1}}static CreateCubemapTexture(G,A,j,u,k){let B=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const x=new ArrayBuffer(G*G*4*3),s=new Float32Array(x),O=B?Math.max(1,Math.round(u/4/G)):1,d=1/O,h=d*d,H=A[1].CA(A[0]).scale(d/G),F=A[3].CA(A[2]).scale(d/G),R=1/G;let U=0;for(let S=0;S<G;S++)for(let B=0;B<O;B++){let B=A[0],x=A[2];for(let A=0;A<G;A++)for(let d=0;d<O;d++){const O=x.CA(B).scale(U).add(B);O.normalize();const d=this.CalcProjectionSpherical(O,j,u,k);s[S*G*3+3*A+0]+=d.r*h,s[S*G*3+3*A+1]+=d.g*h,s[S*G*3+3*A+2]+=d.b*h,B=B.add(H),x=x.add(F)}U+=R*d}return s}static CalcProjectionSpherical(G,A,j,u){let k=Math.atan2(G.z,G.x);const B=Math.acos(G.y);for(;k<-Math.PI;)k+=2*Math.PI;for(;k>Math.PI;)k-=2*Math.PI;let x=k/Math.PI;const s=B/Math.PI;x=.5*x+.5;let O=Math.round(x*j);O<0?O=0:O>=j&&(O=j-1);let d=Math.round(s*u);d<0?d=0:d>=u&&(d=u-1);const h=u-d-1;return{r:A[h*j*3+3*O+0],g:A[h*j*3+3*O+1],b:A[h*j*3+3*O+2]}}}function B(G,A,j,u,k,B){k>0?(k=function(G,A){return A>1023?G*Math.pow(2,1023)*Math.pow(2,A-1023):A<-1074?G*Math.pow(2,-1074)*Math.pow(2,A+1074):G*Math.pow(2,A)}(1,k-136),G[B+0]=A*k,G[B+1]=j*k,G[B+2]=u*k):(G[B+0]=0,G[B+1]=0,G[B+2]=0)}function x(G,A){let j="",u="";for(let k=A;k<G.length-A&&(u=String.fromCharCode(G[k]),"\n"!=u);k++)j+=u;return j}function s(G){let A=0,j=0,u=x(G,0);if("#"!=u[0]||"?"!=u[1])throw"Bad HDR Format.";let k=!1,B=!1,s=0;do{s+=u.length+1,u=x(G,s),"FORMAT=32-bit_rle_rgbe"==u?B=!0:0==u.length&&(k=!0)}while(!k);if(!B)throw"HDR Bad header format, unsupported FORMAT";s+=u.length+1,u=x(G,s);const O=/^-Y (.*) \+X (.*)$/g.exec(u);if(!O||O.length<3)throw"HDR Bad header format, no size";if(j=parseInt(O[2]),A=parseInt(O[1]),j<8||j>32767)throw"HDR Bad header format, unsupported size";return s+=u.length+1,{height:A,width:j,dataPosition:s}}function O(G,A){return function(G,A){let j=A.height;const u=A.width;let k,x,s,O,h,H=A.dataPosition,F=0,R=0,U=0;const S=new ArrayBuffer(4*u),C=new Uint8Array(S),t=new ArrayBuffer(A.width*A.height*4*3),Y=new Float32Array(t);for(;j>0;){if(k=G[H++],x=G[H++],s=G[H++],O=G[H++],2!=k||2!=x||128&s||A.width<8||A.width>32767)return d(G,A);if((s<<8|O)!=u)throw"HDR Bad header format, wrong scan line width";for(F=0,U=0;U<4;U++)for(R=(U+1)*u;F<R;)if(k=G[H++],x=G[H++],k>128){if(h=k-128,0==h||h>R-F)throw"HDR Bad Format, bad scanline data (run)";for(;h-- >0;)C[F++]=x}else{if(h=k,0==h||h>R-F)throw"HDR Bad Format, bad scanline data (non-run)";if(C[F++]=x,--h>0)for(let A=0;A<h;A++)C[F++]=G[H++]}for(U=0;U<u;U++)k=C[U],x=C[U+u],s=C[U+2*u],O=C[U+3*u],B(Y,k,x,s,O,(A.height-j)*u*3+3*U);j--}return Y}(G,A)}function d(G,A){let j=A.height;const u=A.width;let k,x,s,O,d,h=A.dataPosition;const H=new ArrayBuffer(A.width*A.height*4*3),F=new Float32Array(H);for(;j>0;){for(d=0;d<A.width;d++)k=G[h++],x=G[h++],s=G[h++],O=G[h++],B(F,k,x,s,O,(A.height-j)*u*3+3*d);j--}return F}k.FACE_LEFT=[new u.SA(-1,-1,-1),new u.SA(1,-1,-1),new u.SA(-1,1,-1),new u.SA(1,1,-1)],k.FACE_RIGHT=[new u.SA(1,-1,1),new u.SA(-1,-1,1),new u.SA(1,1,1),new u.SA(-1,1,1)],k.FACE_FRONT=[new u.SA(1,-1,-1),new u.SA(1,-1,1),new u.SA(1,1,-1),new u.SA(1,1,1)],k.FACE_BACK=[new u.SA(-1,-1,1),new u.SA(-1,-1,-1),new u.SA(-1,1,1),new u.SA(-1,1,-1)],k.FACE_DOWN=[new u.SA(1,1,-1),new u.SA(1,1,1),new u.SA(-1,1,-1),new u.SA(-1,1,1)],k.FACE_UP=[new u.SA(-1,-1,-1),new u.SA(-1,-1,1),new u.SA(1,-1,-1),new u.SA(1,-1,1)];class h{constructor(){this.supportCascades=!1}loadCubeData(){throw".hdr not supported in Cube."}loadData(G,A,j){const u=new Uint8Array(G.buffer,G.byteOffset,G.byteLength),k=s(u),B=O(u,k),x=k.width*k.height,d=new Float32Array(4*x);for(let s=0;s<x;s+=1)d[4*s]=B[3*s],d[4*s+1]=B[3*s+1],d[4*s+2]=B[3*s+2],d[4*s+3]=1;j(k.width,k.height,A.generateMipMaps,!1,(()=>{const G=A.getEngine();A.type=1,A.format=5,A._gammaSpace=!1,G._uploadDataToTextureDirectly(A,d)}))}}}}]);