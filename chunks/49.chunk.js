"use strict";(self.h6ljd275xwr=self.h6ljd275xwr||[]).push([[49],{13855:(n,y,H)=>{H.r(y),H.d(y,{_HDRTextureLoader:()=>q});var o=H(11288);class G{static ConvertPanoramaToCubemap(n,y,H,o){let G=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!n)throw"ConvertPanoramaToCubemap: input cannot be null";if(n.length!=y*H*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(o,this.FACE_FRONT,n,y,H,G),back:this.CreateCubemapTexture(o,this.FACE_BACK,n,y,H,G),left:this.CreateCubemapTexture(o,this.FACE_LEFT,n,y,H,G),right:this.CreateCubemapTexture(o,this.FACE_RIGHT,n,y,H,G),up:this.CreateCubemapTexture(o,this.FACE_UP,n,y,H,G),down:this.CreateCubemapTexture(o,this.FACE_DOWN,n,y,H,G),size:o,type:1,format:4,gammaSpace:!1}}static CreateCubemapTexture(n,y,H,o,G){let h=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const k=new ArrayBuffer(n*n*4*3),i=new Float32Array(k),B=h?Math.max(1,Math.round(o/4/n)):1,V=1/B,q=V*V,b=y[1].Qy(y[0]).scale(V/n),A=y[3].Qy(y[2]).scale(V/n),U=1/n;let T=0;for(let W=0;W<n;W++)for(let h=0;h<B;h++){let h=y[0],k=y[2];for(let y=0;y<n;y++)for(let V=0;V<B;V++){const B=k.Qy(h).scale(T).add(h);B.normalize();const V=this.CalcProjectionSpherical(B,H,o,G);i[W*n*3+3*y+0]+=V.r*q,i[W*n*3+3*y+1]+=V.g*q,i[W*n*3+3*y+2]+=V.b*q,h=h.add(b),k=k.add(A)}T+=U*V}return i}static CalcProjectionSpherical(n,y,H,o){let G=Math.atan2(n.z,n.x);const h=Math.acos(n.y);for(;G<-Math.PI;)G+=2*Math.PI;for(;G>Math.PI;)G-=2*Math.PI;let k=G/Math.PI;const i=h/Math.PI;k=.5*k+.5;let B=Math.round(k*H);B<0?B=0:B>=H&&(B=H-1);let V=Math.round(i*o);V<0?V=0:V>=o&&(V=o-1);const q=o-V-1;return{r:y[q*H*3+3*B+0],g:y[q*H*3+3*B+1],b:y[q*H*3+3*B+2]}}}function h(n,y,H,o,G,h){G>0?(G=function(n,y){return y>1023?n*Math.pow(2,1023)*Math.pow(2,y-1023):y<-1074?n*Math.pow(2,-1074)*Math.pow(2,y+1074):n*Math.pow(2,y)}(1,G-136),n[h+0]=y*G,n[h+1]=H*G,n[h+2]=o*G):(n[h+0]=0,n[h+1]=0,n[h+2]=0)}function k(n,y){let H="",o="";for(let G=y;G<n.length-y&&(o=String.fromCharCode(n[G]),"\n"!=o);G++)H+=o;return H}function i(n){let y=0,H=0,o=k(n,0);if("#"!=o[0]||"?"!=o[1])throw"Bad HDR Format.";let G=!1,h=!1,i=0;do{i+=o.length+1,o=k(n,i),"FORMAT=32-bit_rle_rgbe"==o?h=!0:0==o.length&&(G=!0)}while(!G);if(!h)throw"HDR Bad header format, unsupported FORMAT";i+=o.length+1,o=k(n,i);const B=/^-Y (.*) \+X (.*)$/g.exec(o);if(!B||B.length<3)throw"HDR Bad header format, no size";if(H=parseInt(B[2]),y=parseInt(B[1]),H<8||H>32767)throw"HDR Bad header format, unsupported size";return i+=o.length+1,{height:y,width:H,dataPosition:i}}function B(n,y){return function(n,y){let H=y.height;const o=y.width;let G,k,i,B,q,b=y.dataPosition,A=0,U=0,T=0;const W=new ArrayBuffer(4*o),z=new Uint8Array(W),Q=new ArrayBuffer(y.width*y.height*4*3),l=new Float32Array(Q);for(;H>0;){if(G=n[b++],k=n[b++],i=n[b++],B=n[b++],2!=G||2!=k||128&i||y.width<8||y.width>32767)return V(n,y);if((i<<8|B)!=o)throw"HDR Bad header format, wrong scan line width";for(A=0,T=0;T<4;T++)for(U=(T+1)*o;A<U;)if(G=n[b++],k=n[b++],G>128){if(q=G-128,0==q||q>U-A)throw"HDR Bad Format, bad scanline data (run)";for(;q-- >0;)z[A++]=k}else{if(q=G,0==q||q>U-A)throw"HDR Bad Format, bad scanline data (non-run)";if(z[A++]=k,--q>0)for(let y=0;y<q;y++)z[A++]=n[b++]}for(T=0;T<o;T++)G=z[T],k=z[T+o],i=z[T+2*o],B=z[T+3*o],h(l,G,k,i,B,(y.height-H)*o*3+3*T);H--}return l}(n,y)}function V(n,y){let H=y.height;const o=y.width;let G,k,i,B,V,q=y.dataPosition;const b=new ArrayBuffer(y.width*y.height*4*3),A=new Float32Array(b);for(;H>0;){for(V=0;V<y.width;V++)G=n[q++],k=n[q++],i=n[q++],B=n[q++],h(A,G,k,i,B,(y.height-H)*o*3+3*V);H--}return A}G.FACE_LEFT=[new o.zy(-1,-1,-1),new o.zy(1,-1,-1),new o.zy(-1,1,-1),new o.zy(1,1,-1)],G.FACE_RIGHT=[new o.zy(1,-1,1),new o.zy(-1,-1,1),new o.zy(1,1,1),new o.zy(-1,1,1)],G.FACE_FRONT=[new o.zy(1,-1,-1),new o.zy(1,-1,1),new o.zy(1,1,-1),new o.zy(1,1,1)],G.FACE_BACK=[new o.zy(-1,-1,1),new o.zy(-1,-1,-1),new o.zy(-1,1,1),new o.zy(-1,1,-1)],G.FACE_DOWN=[new o.zy(1,1,-1),new o.zy(1,1,1),new o.zy(-1,1,-1),new o.zy(-1,1,1)],G.FACE_UP=[new o.zy(-1,-1,-1),new o.zy(-1,-1,1),new o.zy(1,-1,-1),new o.zy(1,-1,1)];class q{constructor(){this.supportCascades=!1}loadCubeData(){throw".hdr not supported in Cube."}loadData(n,y,H){const o=new Uint8Array(n.buffer,n.byteOffset,n.byteLength),G=i(o),h=B(o,G),k=G.width*G.height,V=new Float32Array(4*k);for(let i=0;i<k;i+=1)V[4*i]=h[3*i],V[4*i+1]=h[3*i+1],V[4*i+2]=h[3*i+2],V[4*i+3]=1;H(G.width,G.height,y.generateMipMaps,!1,(()=>{const n=y.getEngine();y.type=1,y.format=5,y._gammaSpace=!1,n._uploadDataToTextureDirectly(y,V)}))}}}}]);