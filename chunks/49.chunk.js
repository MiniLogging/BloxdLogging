"use strict";(self.fyqbdzs5tyo=self.fyqbdzs5tyo||[]).push([[49],{13657:(V,I,A)=>{A.r(I),A.d(I,{_HDRTextureLoader:()=>X});var B=A(11231);class F{static ConvertPanoramaToCubemap(V,I,A,B){let F=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!V)throw"ConvertPanoramaToCubemap: input cannot be null";if(V.length!=I*A*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(B,this.FACE_FRONT,V,I,A,F),back:this.CreateCubemapTexture(B,this.FACE_BACK,V,I,A,F),left:this.CreateCubemapTexture(B,this.FACE_LEFT,V,I,A,F),right:this.CreateCubemapTexture(B,this.FACE_RIGHT,V,I,A,F),up:this.CreateCubemapTexture(B,this.FACE_UP,V,I,A,F),down:this.CreateCubemapTexture(B,this.FACE_DOWN,V,I,A,F),size:B,type:1,format:4,gammaSpace:!1}}static CreateCubemapTexture(V,I,A,B,F){let E=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const Y=new ArrayBuffer(V*V*4*3),H=new Float32Array(Y),c=E?Math.max(1,Math.round(B/4/V)):1,b=1/c,X=b*b,P=I[1].uI(I[0]).scale(b/V),J=I[3].uI(I[2]).scale(b/V),G=1/V;let w=0;for(let t=0;t<V;t++)for(let E=0;E<c;E++){let E=I[0],Y=I[2];for(let I=0;I<V;I++)for(let b=0;b<c;b++){const c=Y.uI(E).scale(w).add(E);c.normalize();const b=this.CalcProjectionSpherical(c,A,B,F);H[t*V*3+3*I+0]+=b.r*X,H[t*V*3+3*I+1]+=b.g*X,H[t*V*3+3*I+2]+=b.b*X,E=E.add(P),Y=Y.add(J)}w+=G*b}return H}static CalcProjectionSpherical(V,I,A,B){let F=Math.atan2(V.z,V.x);const E=Math.acos(V.y);for(;F<-Math.PI;)F+=2*Math.PI;for(;F>Math.PI;)F-=2*Math.PI;let Y=F/Math.PI;const H=E/Math.PI;Y=.5*Y+.5;let c=Math.round(Y*A);c<0?c=0:c>=A&&(c=A-1);let b=Math.round(H*B);b<0?b=0:b>=B&&(b=B-1);const X=B-b-1;return{r:I[X*A*3+3*c+0],g:I[X*A*3+3*c+1],b:I[X*A*3+3*c+2]}}}function E(V,I,A,B,F,E){F>0?(F=function(V,I){return I>1023?V*Math.pow(2,1023)*Math.pow(2,I-1023):I<-1074?V*Math.pow(2,-1074)*Math.pow(2,I+1074):V*Math.pow(2,I)}(1,F-136),V[E+0]=I*F,V[E+1]=A*F,V[E+2]=B*F):(V[E+0]=0,V[E+1]=0,V[E+2]=0)}function Y(V,I){let A="",B="";for(let F=I;F<V.length-I&&(B=String.fromCharCode(V[F]),"\n"!=B);F++)A+=B;return A}function H(V){let I=0,A=0,B=Y(V,0);if("#"!=B[0]||"?"!=B[1])throw"Bad HDR Format.";let F=!1,E=!1,H=0;do{H+=B.length+1,B=Y(V,H),"FORMAT=32-bit_rle_rgbe"==B?E=!0:0==B.length&&(F=!0)}while(!F);if(!E)throw"HDR Bad header format, unsupported FORMAT";H+=B.length+1,B=Y(V,H);const c=/^-Y (.*) \+X (.*)$/g.exec(B);if(!c||c.length<3)throw"HDR Bad header format, no size";if(A=parseInt(c[2]),I=parseInt(c[1]),A<8||A>32767)throw"HDR Bad header format, unsupported size";return H+=B.length+1,{height:I,width:A,dataPosition:H}}function c(V,I){return function(V,I){let A=I.height;const B=I.width;let F,Y,H,c,X,P=I.dataPosition,J=0,G=0,w=0;const t=new ArrayBuffer(4*B),u=new Uint8Array(t),W=new ArrayBuffer(I.width*I.height*4*3),g=new Float32Array(W);for(;A>0;){if(F=V[P++],Y=V[P++],H=V[P++],c=V[P++],2!=F||2!=Y||128&H||I.width<8||I.width>32767)return b(V,I);if((H<<8|c)!=B)throw"HDR Bad header format, wrong scan line width";for(J=0,w=0;w<4;w++)for(G=(w+1)*B;J<G;)if(F=V[P++],Y=V[P++],F>128){if(X=F-128,0==X||X>G-J)throw"HDR Bad Format, bad scanline data (run)";for(;X-- >0;)u[J++]=Y}else{if(X=F,0==X||X>G-J)throw"HDR Bad Format, bad scanline data (non-run)";if(u[J++]=Y,--X>0)for(let I=0;I<X;I++)u[J++]=V[P++]}for(w=0;w<B;w++)F=u[w],Y=u[w+B],H=u[w+2*B],c=u[w+3*B],E(g,F,Y,H,c,(I.height-A)*B*3+3*w);A--}return g}(V,I)}function b(V,I){let A=I.height;const B=I.width;let F,Y,H,c,b,X=I.dataPosition;const P=new ArrayBuffer(I.width*I.height*4*3),J=new Float32Array(P);for(;A>0;){for(b=0;b<I.width;b++)F=V[X++],Y=V[X++],H=V[X++],c=V[X++],E(J,F,Y,H,c,(I.height-A)*B*3+3*b);A--}return J}F.FACE_LEFT=[new B.tI(-1,-1,-1),new B.tI(1,-1,-1),new B.tI(-1,1,-1),new B.tI(1,1,-1)],F.FACE_RIGHT=[new B.tI(1,-1,1),new B.tI(-1,-1,1),new B.tI(1,1,1),new B.tI(-1,1,1)],F.FACE_FRONT=[new B.tI(1,-1,-1),new B.tI(1,-1,1),new B.tI(1,1,-1),new B.tI(1,1,1)],F.FACE_BACK=[new B.tI(-1,-1,1),new B.tI(-1,-1,-1),new B.tI(-1,1,1),new B.tI(-1,1,-1)],F.FACE_DOWN=[new B.tI(1,1,-1),new B.tI(1,1,1),new B.tI(-1,1,-1),new B.tI(-1,1,1)],F.FACE_UP=[new B.tI(-1,-1,-1),new B.tI(-1,-1,1),new B.tI(1,-1,-1),new B.tI(1,-1,1)];class X{constructor(){this.supportCascades=!1}loadCubeData(){throw".hdr not supported in Cube."}loadData(V,I,A){const B=new Uint8Array(V.buffer,V.byteOffset,V.byteLength),F=H(B),E=c(B,F),Y=F.width*F.height,b=new Float32Array(4*Y);for(let H=0;H<Y;H+=1)b[4*H]=E[3*H],b[4*H+1]=E[3*H+1],b[4*H+2]=E[3*H+2],b[4*H+3]=1;A(F.width,F.height,I.generateMipMaps,!1,(()=>{const V=I.getEngine();I.type=1,I.format=5,I._gammaSpace=!1,V._uploadDataToTextureDirectly(I,b)}))}}}}]);