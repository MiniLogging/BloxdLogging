"use strict";(self.r00gjvkwa6=self.r00gjvkwa6||[]).push([[49],{13752:(H,O,S)=>{S.r(O),S.d(O,{_HDRTextureLoader:()=>o});var t=S(11301);class q{static ConvertPanoramaToCubemap(H,O,S,t){let q=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!H)throw"ConvertPanoramaToCubemap: input cannot be null";if(H.length!=O*S*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(t,this.FACE_FRONT,H,O,S,q),back:this.CreateCubemapTexture(t,this.FACE_BACK,H,O,S,q),left:this.CreateCubemapTexture(t,this.FACE_LEFT,H,O,S,q),right:this.CreateCubemapTexture(t,this.FACE_RIGHT,H,O,S,q),up:this.CreateCubemapTexture(t,this.FACE_UP,H,O,S,q),down:this.CreateCubemapTexture(t,this.FACE_DOWN,H,O,S,q),size:t,type:1,format:4,gammaSpace:!1}}static CreateCubemapTexture(H,O,S,t,q){let p=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const G=new ArrayBuffer(H*H*4*3),U=new Float32Array(G),V=p?Math.max(1,Math.round(t/4/H)):1,w=1/V,o=w*w,h=O[1].XO(O[0]).scale(w/H),a=O[3].XO(O[2]).scale(w/H),j=1/H;let e=0;for(let X=0;X<H;X++)for(let p=0;p<V;p++){let p=O[0],G=O[2];for(let O=0;O<H;O++)for(let w=0;w<V;w++){const V=G.XO(p).scale(e).add(p);V.normalize();const w=this.CalcProjectionSpherical(V,S,t,q);U[X*H*3+3*O+0]+=w.r*o,U[X*H*3+3*O+1]+=w.g*o,U[X*H*3+3*O+2]+=w.b*o,p=p.add(h),G=G.add(a)}e+=j*w}return U}static CalcProjectionSpherical(H,O,S,t){let q=Math.atan2(H.z,H.x);const p=Math.acos(H.y);for(;q<-Math.PI;)q+=2*Math.PI;for(;q>Math.PI;)q-=2*Math.PI;let G=q/Math.PI;const U=p/Math.PI;G=.5*G+.5;let V=Math.round(G*S);V<0?V=0:V>=S&&(V=S-1);let w=Math.round(U*t);w<0?w=0:w>=t&&(w=t-1);const o=t-w-1;return{r:O[o*S*3+3*V+0],g:O[o*S*3+3*V+1],b:O[o*S*3+3*V+2]}}}function p(H,O,S,t,q,p){q>0?(q=function(H,O){return O>1023?H*Math.pow(2,1023)*Math.pow(2,O-1023):O<-1074?H*Math.pow(2,-1074)*Math.pow(2,O+1074):H*Math.pow(2,O)}(1,q-136),H[p+0]=O*q,H[p+1]=S*q,H[p+2]=t*q):(H[p+0]=0,H[p+1]=0,H[p+2]=0)}function G(H,O){let S="",t="";for(let q=O;q<H.length-O&&(t=String.fromCharCode(H[q]),"\n"!=t);q++)S+=t;return S}function U(H){let O=0,S=0,t=G(H,0);if("#"!=t[0]||"?"!=t[1])throw"Bad HDR Format.";let q=!1,p=!1,U=0;do{U+=t.length+1,t=G(H,U),"FORMAT=32-bit_rle_rgbe"==t?p=!0:0==t.length&&(q=!0)}while(!q);if(!p)throw"HDR Bad header format, unsupported FORMAT";U+=t.length+1,t=G(H,U);const V=/^-Y (.*) \+X (.*)$/g.exec(t);if(!V||V.length<3)throw"HDR Bad header format, no size";if(S=parseInt(V[2]),O=parseInt(V[1]),S<8||S>32767)throw"HDR Bad header format, unsupported size";return U+=t.length+1,{height:O,width:S,dataPosition:U}}function V(H,O){return function(H,O){let S=O.height;const t=O.width;let q,G,U,V,o,h=O.dataPosition,a=0,j=0,e=0;const X=new ArrayBuffer(4*t),E=new Uint8Array(X),y=new ArrayBuffer(O.width*O.height*4*3),T=new Float32Array(y);for(;S>0;){if(q=H[h++],G=H[h++],U=H[h++],V=H[h++],2!=q||2!=G||128&U||O.width<8||O.width>32767)return w(H,O);if((U<<8|V)!=t)throw"HDR Bad header format, wrong scan line width";for(a=0,e=0;e<4;e++)for(j=(e+1)*t;a<j;)if(q=H[h++],G=H[h++],q>128){if(o=q-128,0==o||o>j-a)throw"HDR Bad Format, bad scanline data (run)";for(;o-- >0;)E[a++]=G}else{if(o=q,0==o||o>j-a)throw"HDR Bad Format, bad scanline data (non-run)";if(E[a++]=G,--o>0)for(let O=0;O<o;O++)E[a++]=H[h++]}for(e=0;e<t;e++)q=E[e],G=E[e+t],U=E[e+2*t],V=E[e+3*t],p(T,q,G,U,V,(O.height-S)*t*3+3*e);S--}return T}(H,O)}function w(H,O){let S=O.height;const t=O.width;let q,G,U,V,w,o=O.dataPosition;const h=new ArrayBuffer(O.width*O.height*4*3),a=new Float32Array(h);for(;S>0;){for(w=0;w<O.width;w++)q=H[o++],G=H[o++],U=H[o++],V=H[o++],p(a,q,G,U,V,(O.height-S)*t*3+3*w);S--}return a}q.FACE_LEFT=[new t.eO(-1,-1,-1),new t.eO(1,-1,-1),new t.eO(-1,1,-1),new t.eO(1,1,-1)],q.FACE_RIGHT=[new t.eO(1,-1,1),new t.eO(-1,-1,1),new t.eO(1,1,1),new t.eO(-1,1,1)],q.FACE_FRONT=[new t.eO(1,-1,-1),new t.eO(1,-1,1),new t.eO(1,1,-1),new t.eO(1,1,1)],q.FACE_BACK=[new t.eO(-1,-1,1),new t.eO(-1,-1,-1),new t.eO(-1,1,1),new t.eO(-1,1,-1)],q.FACE_DOWN=[new t.eO(1,1,-1),new t.eO(1,1,1),new t.eO(-1,1,-1),new t.eO(-1,1,1)],q.FACE_UP=[new t.eO(-1,-1,-1),new t.eO(-1,-1,1),new t.eO(1,-1,-1),new t.eO(1,-1,1)];class o{constructor(){this.supportCascades=!1}loadCubeData(){throw".hdr not supported in Cube."}loadData(H,O,S){const t=new Uint8Array(H.buffer,H.byteOffset,H.byteLength),q=U(t),p=V(t,q),G=q.width*q.height,w=new Float32Array(4*G);for(let U=0;U<G;U+=1)w[4*U]=p[3*U],w[4*U+1]=p[3*U+1],w[4*U+2]=p[3*U+2],w[4*U+3]=1;S(q.width,q.height,O.generateMipMaps,!1,(()=>{const H=O.getEngine();O.type=1,O.format=5,O._gammaSpace=!1,H._uploadDataToTextureDirectly(O,w)}))}}}}]);