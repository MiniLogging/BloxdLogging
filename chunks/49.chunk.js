"use strict";(self.vb3rpbgyozo=self.vb3rpbgyozo||[]).push([[49],{15204:(q,I,l)=>{l.r(I),l.d(I,{_HDRTextureLoader:()=>Z});var w=l(12747);class t{static ConvertPanoramaToCubemap(q,I,l,w){let t=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!q)throw"ConvertPanoramaToCubemap: input cannot be null";if(q.length!=I*l*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(w,this.FACE_FRONT,q,I,l,t),back:this.CreateCubemapTexture(w,this.FACE_BACK,q,I,l,t),left:this.CreateCubemapTexture(w,this.FACE_LEFT,q,I,l,t),right:this.CreateCubemapTexture(w,this.FACE_RIGHT,q,I,l,t),up:this.CreateCubemapTexture(w,this.FACE_UP,q,I,l,t),down:this.CreateCubemapTexture(w,this.FACE_DOWN,q,I,l,t),size:w,type:1,format:4,gammaSpace:!1}}static CreateCubemapTexture(q,I,l,w,t){let O=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const c=new ArrayBuffer(q*q*4*3),a=new Float32Array(c),F=O?Math.max(1,Math.round(w/4/q)):1,s=1/F,Z=s*s,r=I[1].TI(I[0]).scale(s/q),x=I[3].TI(I[2]).scale(s/q),o=1/q;let d=0;for(let T=0;T<q;T++)for(let O=0;O<F;O++){let O=I[0],c=I[2];for(let I=0;I<q;I++)for(let s=0;s<F;s++){const F=c.TI(O).scale(d).add(O);F.normalize();const s=this.CalcProjectionSpherical(F,l,w,t);a[T*q*3+3*I+0]+=s.r*Z,a[T*q*3+3*I+1]+=s.g*Z,a[T*q*3+3*I+2]+=s.b*Z,O=O.add(r),c=c.add(x)}d+=o*s}return a}static CalcProjectionSpherical(q,I,l,w){let t=Math.atan2(q.z,q.x);const O=Math.acos(q.y);for(;t<-Math.PI;)t+=2*Math.PI;for(;t>Math.PI;)t-=2*Math.PI;let c=t/Math.PI;const a=O/Math.PI;c=.5*c+.5;let F=Math.round(c*l);F<0?F=0:F>=l&&(F=l-1);let s=Math.round(a*w);s<0?s=0:s>=w&&(s=w-1);const Z=w-s-1;return{r:I[Z*l*3+3*F+0],g:I[Z*l*3+3*F+1],b:I[Z*l*3+3*F+2]}}}function O(q,I,l,w,t,O){t>0?(t=function(q,I){return I>1023?q*Math.pow(2,1023)*Math.pow(2,I-1023):I<-1074?q*Math.pow(2,-1074)*Math.pow(2,I+1074):q*Math.pow(2,I)}(1,t-136),q[O+0]=I*t,q[O+1]=l*t,q[O+2]=w*t):(q[O+0]=0,q[O+1]=0,q[O+2]=0)}function c(q,I){let l="",w="";for(let t=I;t<q.length-I&&(w=String.fromCharCode(q[t]),"\n"!=w);t++)l+=w;return l}function a(q){let I=0,l=0,w=c(q,0);if("#"!=w[0]||"?"!=w[1])throw"Bad HDR Format.";let t=!1,O=!1,a=0;do{a+=w.length+1,w=c(q,a),"FORMAT=32-bit_rle_rgbe"==w?O=!0:0==w.length&&(t=!0)}while(!t);if(!O)throw"HDR Bad header format, unsupported FORMAT";a+=w.length+1,w=c(q,a);const F=/^-Y (.*) \+X (.*)$/g.exec(w);if(!F||F.length<3)throw"HDR Bad header format, no size";if(l=parseInt(F[2]),I=parseInt(F[1]),l<8||l>32767)throw"HDR Bad header format, unsupported size";return a+=w.length+1,{height:I,width:l,dataPosition:a}}function F(q,I){return function(q,I){let l=I.height;const w=I.width;let t,c,a,F,Z,r=I.dataPosition,x=0,o=0,d=0;const T=new ArrayBuffer(4*w),V=new Uint8Array(T),U=new ArrayBuffer(I.width*I.height*4*3),B=new Float32Array(U);for(;l>0;){if(t=q[r++],c=q[r++],a=q[r++],F=q[r++],2!=t||2!=c||128&a||I.width<8||I.width>32767)return s(q,I);if((a<<8|F)!=w)throw"HDR Bad header format, wrong scan line width";for(x=0,d=0;d<4;d++)for(o=(d+1)*w;x<o;)if(t=q[r++],c=q[r++],t>128){if(Z=t-128,0==Z||Z>o-x)throw"HDR Bad Format, bad scanline data (run)";for(;Z-- >0;)V[x++]=c}else{if(Z=t,0==Z||Z>o-x)throw"HDR Bad Format, bad scanline data (non-run)";if(V[x++]=c,--Z>0)for(let I=0;I<Z;I++)V[x++]=q[r++]}for(d=0;d<w;d++)t=V[d],c=V[d+w],a=V[d+2*w],F=V[d+3*w],O(B,t,c,a,F,(I.height-l)*w*3+3*d);l--}return B}(q,I)}function s(q,I){let l=I.height;const w=I.width;let t,c,a,F,s,Z=I.dataPosition;const r=new ArrayBuffer(I.width*I.height*4*3),x=new Float32Array(r);for(;l>0;){for(s=0;s<I.width;s++)t=q[Z++],c=q[Z++],a=q[Z++],F=q[Z++],O(x,t,c,a,F,(I.height-l)*w*3+3*s);l--}return x}t.FACE_LEFT=[new w.dI(-1,-1,-1),new w.dI(1,-1,-1),new w.dI(-1,1,-1),new w.dI(1,1,-1)],t.FACE_RIGHT=[new w.dI(1,-1,1),new w.dI(-1,-1,1),new w.dI(1,1,1),new w.dI(-1,1,1)],t.FACE_FRONT=[new w.dI(1,-1,-1),new w.dI(1,-1,1),new w.dI(1,1,-1),new w.dI(1,1,1)],t.FACE_BACK=[new w.dI(-1,-1,1),new w.dI(-1,-1,-1),new w.dI(-1,1,1),new w.dI(-1,1,-1)],t.FACE_DOWN=[new w.dI(1,1,-1),new w.dI(1,1,1),new w.dI(-1,1,-1),new w.dI(-1,1,1)],t.FACE_UP=[new w.dI(-1,-1,-1),new w.dI(-1,-1,1),new w.dI(1,-1,-1),new w.dI(1,-1,1)];class Z{constructor(){this.supportCascades=!1}loadCubeData(){throw".hdr not supported in Cube."}loadData(q,I,l){const w=new Uint8Array(q.buffer,q.byteOffset,q.byteLength),t=a(w),O=F(w,t),c=t.width*t.height,s=new Float32Array(4*c);for(let a=0;a<c;a+=1)s[4*a]=O[3*a],s[4*a+1]=O[3*a+1],s[4*a+2]=O[3*a+2],s[4*a+3]=1;l(t.width,t.height,I.generateMipMaps,!1,(()=>{const q=I.getEngine();I.type=1,I.format=5,I._gammaSpace=!1,q._uploadDataToTextureDirectly(I,s)}))}}}}]);