"use strict";(self["9x1utqq1axc"]=self["9x1utqq1axc"]||[]).push([[49],{14777:(y,c,A)=>{A.r(c),A.d(c,{_HDRTextureLoader:()=>q});var l=A(12325);class w{static ConvertPanoramaToCubemap(y,c,A,l){let w=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!y)throw"ConvertPanoramaToCubemap: input cannot be null";if(y.length!=c*A*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(l,this.FACE_FRONT,y,c,A,w),back:this.CreateCubemapTexture(l,this.FACE_BACK,y,c,A,w),left:this.CreateCubemapTexture(l,this.FACE_LEFT,y,c,A,w),right:this.CreateCubemapTexture(l,this.FACE_RIGHT,y,c,A,w),up:this.CreateCubemapTexture(l,this.FACE_UP,y,c,A,w),down:this.CreateCubemapTexture(l,this.FACE_DOWN,y,c,A,w),size:l,type:1,format:4,gammaSpace:!1}}static CreateCubemapTexture(y,c,A,l,w){let N=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const p=new ArrayBuffer(y*y*4*3),W=new Float32Array(p),h=N?Math.max(1,Math.round(l/4/y)):1,I=1/h,q=I*I,o=c[1].xc(c[0]).scale(I/y),O=c[3].xc(c[2]).scale(I/y),L=1/y;let i=0;for(let H=0;H<y;H++)for(let N=0;N<h;N++){let N=c[0],p=c[2];for(let c=0;c<y;c++)for(let I=0;I<h;I++){const h=p.xc(N).scale(i).add(N);h.normalize();const I=this.CalcProjectionSpherical(h,A,l,w);W[H*y*3+3*c+0]+=I.r*q,W[H*y*3+3*c+1]+=I.g*q,W[H*y*3+3*c+2]+=I.b*q,N=N.add(o),p=p.add(O)}i+=L*I}return W}static CalcProjectionSpherical(y,c,A,l){let w=Math.atan2(y.z,y.x);const N=Math.acos(y.y);for(;w<-Math.PI;)w+=2*Math.PI;for(;w>Math.PI;)w-=2*Math.PI;let p=w/Math.PI;const W=N/Math.PI;p=.5*p+.5;let h=Math.round(p*A);h<0?h=0:h>=A&&(h=A-1);let I=Math.round(W*l);I<0?I=0:I>=l&&(I=l-1);const q=l-I-1;return{r:c[q*A*3+3*h+0],g:c[q*A*3+3*h+1],b:c[q*A*3+3*h+2]}}}function N(y,c,A,l,w,N){w>0?(w=function(y,c){return c>1023?y*Math.pow(2,1023)*Math.pow(2,c-1023):c<-1074?y*Math.pow(2,-1074)*Math.pow(2,c+1074):y*Math.pow(2,c)}(1,w-136),y[N+0]=c*w,y[N+1]=A*w,y[N+2]=l*w):(y[N+0]=0,y[N+1]=0,y[N+2]=0)}function p(y,c){let A="",l="";for(let w=c;w<y.length-c&&(l=String.fromCharCode(y[w]),"\n"!=l);w++)A+=l;return A}function W(y){let c=0,A=0,l=p(y,0);if("#"!=l[0]||"?"!=l[1])throw"Bad HDR Format.";let w=!1,N=!1,W=0;do{W+=l.length+1,l=p(y,W),"FORMAT=32-bit_rle_rgbe"==l?N=!0:0==l.length&&(w=!0)}while(!w);if(!N)throw"HDR Bad header format, unsupported FORMAT";W+=l.length+1,l=p(y,W);const h=/^-Y (.*) \+X (.*)$/g.exec(l);if(!h||h.length<3)throw"HDR Bad header format, no size";if(A=parseInt(h[2]),c=parseInt(h[1]),A<8||A>32767)throw"HDR Bad header format, unsupported size";return W+=l.length+1,{height:c,width:A,dataPosition:W}}function h(y,c){return function(y,c){let A=c.height;const l=c.width;let w,p,W,h,q,o=c.dataPosition,O=0,L=0,i=0;const H=new ArrayBuffer(4*l),P=new Uint8Array(H),D=new ArrayBuffer(c.width*c.height*4*3),t=new Float32Array(D);for(;A>0;){if(w=y[o++],p=y[o++],W=y[o++],h=y[o++],2!=w||2!=p||128&W||c.width<8||c.width>32767)return I(y,c);if((W<<8|h)!=l)throw"HDR Bad header format, wrong scan line width";for(O=0,i=0;i<4;i++)for(L=(i+1)*l;O<L;)if(w=y[o++],p=y[o++],w>128){if(q=w-128,0==q||q>L-O)throw"HDR Bad Format, bad scanline data (run)";for(;q-- >0;)P[O++]=p}else{if(q=w,0==q||q>L-O)throw"HDR Bad Format, bad scanline data (non-run)";if(P[O++]=p,--q>0)for(let c=0;c<q;c++)P[O++]=y[o++]}for(i=0;i<l;i++)w=P[i],p=P[i+l],W=P[i+2*l],h=P[i+3*l],N(t,w,p,W,h,(c.height-A)*l*3+3*i);A--}return t}(y,c)}function I(y,c){let A=c.height;const l=c.width;let w,p,W,h,I,q=c.dataPosition;const o=new ArrayBuffer(c.width*c.height*4*3),O=new Float32Array(o);for(;A>0;){for(I=0;I<c.width;I++)w=y[q++],p=y[q++],W=y[q++],h=y[q++],N(O,w,p,W,h,(c.height-A)*l*3+3*I);A--}return O}w.FACE_LEFT=[new l.gc(-1,-1,-1),new l.gc(1,-1,-1),new l.gc(-1,1,-1),new l.gc(1,1,-1)],w.FACE_RIGHT=[new l.gc(1,-1,1),new l.gc(-1,-1,1),new l.gc(1,1,1),new l.gc(-1,1,1)],w.FACE_FRONT=[new l.gc(1,-1,-1),new l.gc(1,-1,1),new l.gc(1,1,-1),new l.gc(1,1,1)],w.FACE_BACK=[new l.gc(-1,-1,1),new l.gc(-1,-1,-1),new l.gc(-1,1,1),new l.gc(-1,1,-1)],w.FACE_DOWN=[new l.gc(1,1,-1),new l.gc(1,1,1),new l.gc(-1,1,-1),new l.gc(-1,1,1)],w.FACE_UP=[new l.gc(-1,-1,-1),new l.gc(-1,-1,1),new l.gc(1,-1,-1),new l.gc(1,-1,1)];class q{constructor(){this.supportCascades=!1}loadCubeData(){throw".hdr not supported in Cube."}loadData(y,c,A){const l=new Uint8Array(y.buffer,y.byteOffset,y.byteLength),w=W(l),N=h(l,w),p=w.width*w.height,I=new Float32Array(4*p);for(let W=0;W<p;W+=1)I[4*W]=N[3*W],I[4*W+1]=N[3*W+1],I[4*W+2]=N[3*W+2],I[4*W+3]=1;A(w.width,w.height,c.generateMipMaps,!1,(()=>{const y=c.getEngine();c.type=1,c.format=5,c._gammaSpace=!1,y._uploadDataToTextureDirectly(c,I)}))}}}}]);