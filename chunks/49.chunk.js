"use strict";(self.b15p7b72fr8=self.b15p7b72fr8||[]).push([[49],{15048:(s,k,h)=>{h.r(k),h.d(k,{_HDRTextureLoader:()=>c});var A=h(12590);class g{static ConvertPanoramaToCubemap(s,k,h,A){let g=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!s)throw"ConvertPanoramaToCubemap: input cannot be null";if(s.length!=k*h*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(A,this.FACE_FRONT,s,k,h,g),back:this.CreateCubemapTexture(A,this.FACE_BACK,s,k,h,g),left:this.CreateCubemapTexture(A,this.FACE_LEFT,s,k,h,g),right:this.CreateCubemapTexture(A,this.FACE_RIGHT,s,k,h,g),up:this.CreateCubemapTexture(A,this.FACE_UP,s,k,h,g),down:this.CreateCubemapTexture(A,this.FACE_DOWN,s,k,h,g),size:A,type:1,format:4,gammaSpace:!1}}static CreateCubemapTexture(s,k,h,A,g){let ms=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const i=new ArrayBuffer(s*s*4*3),K=new Float32Array(i),H=ms?Math.max(1,Math.round(A/4/s)):1,O=1/H,c=O*O,S=k[1].Rk(k[0]).scale(O/s),a=k[3].Rk(k[2]).scale(O/s),r=1/s;let d=0;for(let E=0;E<s;E++)for(let ms=0;ms<H;ms++){let ms=k[0],i=k[2];for(let k=0;k<s;k++)for(let O=0;O<H;O++){const H=i.Rk(ms).scale(d).add(ms);H.normalize();const O=this.CalcProjectionSpherical(H,h,A,g);K[E*s*3+3*k+0]+=O.r*c,K[E*s*3+3*k+1]+=O.g*c,K[E*s*3+3*k+2]+=O.b*c,ms=ms.add(S),i=i.add(a)}d+=r*O}return K}static CalcProjectionSpherical(s,k,h,A){let g=Math.atan2(s.z,s.x);const ms=Math.acos(s.y);for(;g<-Math.PI;)g+=2*Math.PI;for(;g>Math.PI;)g-=2*Math.PI;let i=g/Math.PI;const K=ms/Math.PI;i=.5*i+.5;let H=Math.round(i*h);H<0?H=0:H>=h&&(H=h-1);let O=Math.round(K*A);O<0?O=0:O>=A&&(O=A-1);const c=A-O-1;return{r:k[c*h*3+3*H+0],g:k[c*h*3+3*H+1],b:k[c*h*3+3*H+2]}}}function ms(s,k,h,A,g,ms){g>0?(g=function(s,k){return k>1023?s*Math.pow(2,1023)*Math.pow(2,k-1023):k<-1074?s*Math.pow(2,-1074)*Math.pow(2,k+1074):s*Math.pow(2,k)}(1,g-136),s[ms+0]=k*g,s[ms+1]=h*g,s[ms+2]=A*g):(s[ms+0]=0,s[ms+1]=0,s[ms+2]=0)}function i(s,k){let h="",A="";for(let g=k;g<s.length-k&&(A=String.fromCharCode(s[g]),"\n"!=A);g++)h+=A;return h}function K(s){let k=0,h=0,A=i(s,0);if("#"!=A[0]||"?"!=A[1])throw"Bad HDR Format.";let g=!1,ms=!1,K=0;do{K+=A.length+1,A=i(s,K),"FORMAT=32-bit_rle_rgbe"==A?ms=!0:0==A.length&&(g=!0)}while(!g);if(!ms)throw"HDR Bad header format, unsupported FORMAT";K+=A.length+1,A=i(s,K);const H=/^-Y (.*) \+X (.*)$/g.exec(A);if(!H||H.length<3)throw"HDR Bad header format, no size";if(h=parseInt(H[2]),k=parseInt(H[1]),h<8||h>32767)throw"HDR Bad header format, unsupported size";return K+=A.length+1,{height:k,width:h,dataPosition:K}}function H(s,k){return function(s,k){let h=k.height;const A=k.width;let g,i,K,H,c,S=k.dataPosition,a=0,r=0,d=0;const E=new ArrayBuffer(4*A),j=new Uint8Array(E),P=new ArrayBuffer(k.width*k.height*4*3),R=new Float32Array(P);for(;h>0;){if(g=s[S++],i=s[S++],K=s[S++],H=s[S++],2!=g||2!=i||128&K||k.width<8||k.width>32767)return O(s,k);if((K<<8|H)!=A)throw"HDR Bad header format, wrong scan line width";for(a=0,d=0;d<4;d++)for(r=(d+1)*A;a<r;)if(g=s[S++],i=s[S++],g>128){if(c=g-128,0==c||c>r-a)throw"HDR Bad Format, bad scanline data (run)";for(;c-- >0;)j[a++]=i}else{if(c=g,0==c||c>r-a)throw"HDR Bad Format, bad scanline data (non-run)";if(j[a++]=i,--c>0)for(let k=0;k<c;k++)j[a++]=s[S++]}for(d=0;d<A;d++)g=j[d],i=j[d+A],K=j[d+2*A],H=j[d+3*A],ms(R,g,i,K,H,(k.height-h)*A*3+3*d);h--}return R}(s,k)}function O(s,k){let h=k.height;const A=k.width;let g,i,K,H,O,c=k.dataPosition;const S=new ArrayBuffer(k.width*k.height*4*3),a=new Float32Array(S);for(;h>0;){for(O=0;O<k.width;O++)g=s[c++],i=s[c++],K=s[c++],H=s[c++],ms(a,g,i,K,H,(k.height-h)*A*3+3*O);h--}return a}g.FACE_LEFT=[new A.Pk(-1,-1,-1),new A.Pk(1,-1,-1),new A.Pk(-1,1,-1),new A.Pk(1,1,-1)],g.FACE_RIGHT=[new A.Pk(1,-1,1),new A.Pk(-1,-1,1),new A.Pk(1,1,1),new A.Pk(-1,1,1)],g.FACE_FRONT=[new A.Pk(1,-1,-1),new A.Pk(1,-1,1),new A.Pk(1,1,-1),new A.Pk(1,1,1)],g.FACE_BACK=[new A.Pk(-1,-1,1),new A.Pk(-1,-1,-1),new A.Pk(-1,1,1),new A.Pk(-1,1,-1)],g.FACE_DOWN=[new A.Pk(1,1,-1),new A.Pk(1,1,1),new A.Pk(-1,1,-1),new A.Pk(-1,1,1)],g.FACE_UP=[new A.Pk(-1,-1,-1),new A.Pk(-1,-1,1),new A.Pk(1,-1,-1),new A.Pk(1,-1,1)];class c{constructor(){this.supportCascades=!1}loadCubeData(){throw".hdr not supported in Cube."}loadData(s,k,h){const A=new Uint8Array(s.buffer,s.byteOffset,s.byteLength),g=K(A),ms=H(A,g),i=g.width*g.height,O=new Float32Array(4*i);for(let K=0;K<i;K+=1)O[4*K]=ms[3*K],O[4*K+1]=ms[3*K+1],O[4*K+2]=ms[3*K+2],O[4*K+3]=1;h(g.width,g.height,k.generateMipMaps,!1,(()=>{const s=k.getEngine();k.type=1,k.format=5,k._gammaSpace=!1,s._uploadDataToTextureDirectly(k,O)}))}}}}]);