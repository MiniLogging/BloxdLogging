"use strict";(self.zcqpiao938m=self.zcqpiao938m||[]).push([[49],{14259:(C,U,K)=>{K.r(U),K.d(U,{_HDRTextureLoader:()=>j});var m=K(11827);class O{static ConvertPanoramaToCubemap(C,U,K,m){let O=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!C)throw"ConvertPanoramaToCubemap: input cannot be null";if(C.length!=U*K*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(m,this.FACE_FRONT,C,U,K,O),back:this.CreateCubemapTexture(m,this.FACE_BACK,C,U,K,O),left:this.CreateCubemapTexture(m,this.FACE_LEFT,C,U,K,O),right:this.CreateCubemapTexture(m,this.FACE_RIGHT,C,U,K,O),up:this.CreateCubemapTexture(m,this.FACE_UP,C,U,K,O),down:this.CreateCubemapTexture(m,this.FACE_DOWN,C,U,K,O),size:m,type:1,format:4,gammaSpace:!1}}static CreateCubemapTexture(C,U,K,m,O){let X=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const A=new ArrayBuffer(C*C*4*3),e=new Float32Array(A),t=X?Math.max(1,Math.round(m/4/C)):1,z=1/t,j=z*z,p=U[1].vU(U[0]).scale(z/C),E=U[3].vU(U[2]).scale(z/C),u=1/C;let b=0;for(let v=0;v<C;v++)for(let X=0;X<t;X++){let X=U[0],A=U[2];for(let U=0;U<C;U++)for(let z=0;z<t;z++){const t=A.vU(X).scale(b).add(X);t.normalize();const z=this.CalcProjectionSpherical(t,K,m,O);e[v*C*3+3*U+0]+=z.r*j,e[v*C*3+3*U+1]+=z.g*j,e[v*C*3+3*U+2]+=z.b*j,X=X.add(p),A=A.add(E)}b+=u*z}return e}static CalcProjectionSpherical(C,U,K,m){let O=Math.atan2(C.z,C.x);const X=Math.acos(C.y);for(;O<-Math.PI;)O+=2*Math.PI;for(;O>Math.PI;)O-=2*Math.PI;let A=O/Math.PI;const e=X/Math.PI;A=.5*A+.5;let t=Math.round(A*K);t<0?t=0:t>=K&&(t=K-1);let z=Math.round(e*m);z<0?z=0:z>=m&&(z=m-1);const j=m-z-1;return{r:U[j*K*3+3*t+0],g:U[j*K*3+3*t+1],b:U[j*K*3+3*t+2]}}}function X(C,U,K,m,O,X){O>0?(O=function(C,U){return U>1023?C*Math.pow(2,1023)*Math.pow(2,U-1023):U<-1074?C*Math.pow(2,-1074)*Math.pow(2,U+1074):C*Math.pow(2,U)}(1,O-136),C[X+0]=U*O,C[X+1]=K*O,C[X+2]=m*O):(C[X+0]=0,C[X+1]=0,C[X+2]=0)}function A(C,U){let K="",m="";for(let O=U;O<C.length-U&&(m=String.fromCharCode(C[O]),"\n"!=m);O++)K+=m;return K}function e(C){let U=0,K=0,m=A(C,0);if("#"!=m[0]||"?"!=m[1])throw"Bad HDR Format.";let O=!1,X=!1,e=0;do{e+=m.length+1,m=A(C,e),"FORMAT=32-bit_rle_rgbe"==m?X=!0:0==m.length&&(O=!0)}while(!O);if(!X)throw"HDR Bad header format, unsupported FORMAT";e+=m.length+1,m=A(C,e);const t=/^-Y (.*) \+X (.*)$/g.exec(m);if(!t||t.length<3)throw"HDR Bad header format, no size";if(K=parseInt(t[2]),U=parseInt(t[1]),K<8||K>32767)throw"HDR Bad header format, unsupported size";return e+=m.length+1,{height:U,width:K,dataPosition:e}}function t(C,U){return function(C,U){let K=U.height;const m=U.width;let O,A,e,t,j,p=U.dataPosition,E=0,u=0,b=0;const v=new ArrayBuffer(4*m),Q=new Uint8Array(v),V=new ArrayBuffer(U.width*U.height*4*3),f=new Float32Array(V);for(;K>0;){if(O=C[p++],A=C[p++],e=C[p++],t=C[p++],2!=O||2!=A||128&e||U.width<8||U.width>32767)return z(C,U);if((e<<8|t)!=m)throw"HDR Bad header format, wrong scan line width";for(E=0,b=0;b<4;b++)for(u=(b+1)*m;E<u;)if(O=C[p++],A=C[p++],O>128){if(j=O-128,0==j||j>u-E)throw"HDR Bad Format, bad scanline data (run)";for(;j-- >0;)Q[E++]=A}else{if(j=O,0==j||j>u-E)throw"HDR Bad Format, bad scanline data (non-run)";if(Q[E++]=A,--j>0)for(let U=0;U<j;U++)Q[E++]=C[p++]}for(b=0;b<m;b++)O=Q[b],A=Q[b+m],e=Q[b+2*m],t=Q[b+3*m],X(f,O,A,e,t,(U.height-K)*m*3+3*b);K--}return f}(C,U)}function z(C,U){let K=U.height;const m=U.width;let O,A,e,t,z,j=U.dataPosition;const p=new ArrayBuffer(U.width*U.height*4*3),E=new Float32Array(p);for(;K>0;){for(z=0;z<U.width;z++)O=C[j++],A=C[j++],e=C[j++],t=C[j++],X(E,O,A,e,t,(U.height-K)*m*3+3*z);K--}return E}O.FACE_LEFT=[new m.bU(-1,-1,-1),new m.bU(1,-1,-1),new m.bU(-1,1,-1),new m.bU(1,1,-1)],O.FACE_RIGHT=[new m.bU(1,-1,1),new m.bU(-1,-1,1),new m.bU(1,1,1),new m.bU(-1,1,1)],O.FACE_FRONT=[new m.bU(1,-1,-1),new m.bU(1,-1,1),new m.bU(1,1,-1),new m.bU(1,1,1)],O.FACE_BACK=[new m.bU(-1,-1,1),new m.bU(-1,-1,-1),new m.bU(-1,1,1),new m.bU(-1,1,-1)],O.FACE_DOWN=[new m.bU(1,1,-1),new m.bU(1,1,1),new m.bU(-1,1,-1),new m.bU(-1,1,1)],O.FACE_UP=[new m.bU(-1,-1,-1),new m.bU(-1,-1,1),new m.bU(1,-1,-1),new m.bU(1,-1,1)];class j{constructor(){this.supportCascades=!1}loadCubeData(){throw".hdr not supported in Cube."}loadData(C,U,K){const m=new Uint8Array(C.buffer,C.byteOffset,C.byteLength),O=e(m),X=t(m,O),A=O.width*O.height,z=new Float32Array(4*A);for(let e=0;e<A;e+=1)z[4*e]=X[3*e],z[4*e+1]=X[3*e+1],z[4*e+2]=X[3*e+2],z[4*e+3]=1;K(O.width,O.height,U.generateMipMaps,!1,(()=>{const C=U.getEngine();U.type=1,U.format=5,U._gammaSpace=!1,C._uploadDataToTextureDirectly(U,z)}))}}}}]);