"use strict";(self.hwpa2z1pqte=self.hwpa2z1pqte||[]).push([[49],{15381:(h,R,l)=>{l.r(R),l.d(R,{_HDRTextureLoader:()=>u});var j=l(12900);class a{static ConvertPanoramaToCubemap(h,R,l,j){let a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!h)throw"ConvertPanoramaToCubemap: input cannot be null";if(h.length!=R*l*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(j,this.FACE_FRONT,h,R,l,a),back:this.CreateCubemapTexture(j,this.FACE_BACK,h,R,l,a),left:this.CreateCubemapTexture(j,this.FACE_LEFT,h,R,l,a),right:this.CreateCubemapTexture(j,this.FACE_RIGHT,h,R,l,a),up:this.CreateCubemapTexture(j,this.FACE_UP,h,R,l,a),down:this.CreateCubemapTexture(j,this.FACE_DOWN,h,R,l,a),size:j,type:1,format:4,gammaSpace:!1}}static CreateCubemapTexture(h,R,l,j,a){let D=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const U=new ArrayBuffer(h*h*4*3),F=new Float32Array(U),w=D?Math.max(1,Math.round(j/4/h)):1,mh=1/w,u=mh*mh,c=R[1].fR(R[0]).scale(mh/h),J=R[3].fR(R[2]).scale(mh/h),q=1/h;let Q=0;for(let Y=0;Y<h;Y++)for(let D=0;D<w;D++){let D=R[0],U=R[2];for(let R=0;R<h;R++)for(let mh=0;mh<w;mh++){const w=U.fR(D).scale(Q).add(D);w.normalize();const mh=this.CalcProjectionSpherical(w,l,j,a);F[Y*h*3+3*R+0]+=mh.r*u,F[Y*h*3+3*R+1]+=mh.g*u,F[Y*h*3+3*R+2]+=mh.b*u,D=D.add(c),U=U.add(J)}Q+=q*mh}return F}static CalcProjectionSpherical(h,R,l,j){let a=Math.atan2(h.z,h.x);const D=Math.acos(h.y);for(;a<-Math.PI;)a+=2*Math.PI;for(;a>Math.PI;)a-=2*Math.PI;let U=a/Math.PI;const F=D/Math.PI;U=.5*U+.5;let w=Math.round(U*l);w<0?w=0:w>=l&&(w=l-1);let mh=Math.round(F*j);mh<0?mh=0:mh>=j&&(mh=j-1);const u=j-mh-1;return{r:R[u*l*3+3*w+0],g:R[u*l*3+3*w+1],b:R[u*l*3+3*w+2]}}}function D(h,R,l,j,a,D){a>0?(a=function(h,R){return R>1023?h*Math.pow(2,1023)*Math.pow(2,R-1023):R<-1074?h*Math.pow(2,-1074)*Math.pow(2,R+1074):h*Math.pow(2,R)}(1,a-136),h[D+0]=R*a,h[D+1]=l*a,h[D+2]=j*a):(h[D+0]=0,h[D+1]=0,h[D+2]=0)}function U(h,R){let l="",j="";for(let a=R;a<h.length-R&&(j=String.fromCharCode(h[a]),"\n"!=j);a++)l+=j;return l}function F(h){let R=0,l=0,j=U(h,0);if("#"!=j[0]||"?"!=j[1])throw"Bad HDR Format.";let a=!1,D=!1,F=0;do{F+=j.length+1,j=U(h,F),"FORMAT=32-bit_rle_rgbe"==j?D=!0:0==j.length&&(a=!0)}while(!a);if(!D)throw"HDR Bad header format, unsupported FORMAT";F+=j.length+1,j=U(h,F);const w=/^-Y (.*) \+X (.*)$/g.exec(j);if(!w||w.length<3)throw"HDR Bad header format, no size";if(l=parseInt(w[2]),R=parseInt(w[1]),l<8||l>32767)throw"HDR Bad header format, unsupported size";return F+=j.length+1,{height:R,width:l,dataPosition:F}}function w(h,R){return function(h,R){let l=R.height;const j=R.width;let a,U,F,w,u,c=R.dataPosition,J=0,q=0,Q=0;const Y=new ArrayBuffer(4*j),s=new Uint8Array(Y),t=new ArrayBuffer(R.width*R.height*4*3),f=new Float32Array(t);for(;l>0;){if(a=h[c++],U=h[c++],F=h[c++],w=h[c++],2!=a||2!=U||128&F||R.width<8||R.width>32767)return mh(h,R);if((F<<8|w)!=j)throw"HDR Bad header format, wrong scan line width";for(J=0,Q=0;Q<4;Q++)for(q=(Q+1)*j;J<q;)if(a=h[c++],U=h[c++],a>128){if(u=a-128,0==u||u>q-J)throw"HDR Bad Format, bad scanline data (run)";for(;u-- >0;)s[J++]=U}else{if(u=a,0==u||u>q-J)throw"HDR Bad Format, bad scanline data (non-run)";if(s[J++]=U,--u>0)for(let R=0;R<u;R++)s[J++]=h[c++]}for(Q=0;Q<j;Q++)a=s[Q],U=s[Q+j],F=s[Q+2*j],w=s[Q+3*j],D(f,a,U,F,w,(R.height-l)*j*3+3*Q);l--}return f}(h,R)}function mh(h,R){let l=R.height;const j=R.width;let a,U,F,w,mh,u=R.dataPosition;const c=new ArrayBuffer(R.width*R.height*4*3),J=new Float32Array(c);for(;l>0;){for(mh=0;mh<R.width;mh++)a=h[u++],U=h[u++],F=h[u++],w=h[u++],D(J,a,U,F,w,(R.height-l)*j*3+3*mh);l--}return J}a.FACE_LEFT=[new j.tR(-1,-1,-1),new j.tR(1,-1,-1),new j.tR(-1,1,-1),new j.tR(1,1,-1)],a.FACE_RIGHT=[new j.tR(1,-1,1),new j.tR(-1,-1,1),new j.tR(1,1,1),new j.tR(-1,1,1)],a.FACE_FRONT=[new j.tR(1,-1,-1),new j.tR(1,-1,1),new j.tR(1,1,-1),new j.tR(1,1,1)],a.FACE_BACK=[new j.tR(-1,-1,1),new j.tR(-1,-1,-1),new j.tR(-1,1,1),new j.tR(-1,1,-1)],a.FACE_DOWN=[new j.tR(1,1,-1),new j.tR(1,1,1),new j.tR(-1,1,-1),new j.tR(-1,1,1)],a.FACE_UP=[new j.tR(-1,-1,-1),new j.tR(-1,-1,1),new j.tR(1,-1,-1),new j.tR(1,-1,1)];class u{constructor(){this.supportCascades=!1}loadCubeData(){throw".hdr not supported in Cube."}loadData(h,R,l){const j=new Uint8Array(h.buffer,h.byteOffset,h.byteLength),a=F(j),D=w(j,a),U=a.width*a.height,mh=new Float32Array(4*U);for(let F=0;F<U;F+=1)mh[4*F]=D[3*F],mh[4*F+1]=D[3*F+1],mh[4*F+2]=D[3*F+2],mh[4*F+3]=1;l(a.width,a.height,R.generateMipMaps,!1,(()=>{const h=R.getEngine();R.type=1,R.format=5,R._gammaSpace=!1,h._uploadDataToTextureDirectly(R,mh)}))}}}}]);