"use strict";(self.rvold1i0ywi=self.rvold1i0ywi||[]).push([[49],{13710:(F,b,Q)=>{Q.r(b),Q.d(b,{_HDRTextureLoader:()=>G});var C=Q(11309);class z{static ConvertPanoramaToCubemap(F,b,Q,C){let z=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!F)throw"ConvertPanoramaToCubemap: input cannot be null";if(F.length!=b*Q*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(C,this.FACE_FRONT,F,b,Q,z),back:this.CreateCubemapTexture(C,this.FACE_BACK,F,b,Q,z),left:this.CreateCubemapTexture(C,this.FACE_LEFT,F,b,Q,z),right:this.CreateCubemapTexture(C,this.FACE_RIGHT,F,b,Q,z),up:this.CreateCubemapTexture(C,this.FACE_UP,F,b,Q,z),down:this.CreateCubemapTexture(C,this.FACE_DOWN,F,b,Q,z),size:C,type:1,format:4,gammaSpace:!1}}static CreateCubemapTexture(F,b,Q,C,z){let t=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const g=new ArrayBuffer(F*F*4*3),W=new Float32Array(g),Z=t?Math.max(1,Math.round(C/4/F)):1,q=1/Z,G=q*q,K=b[1].WQ(b[0]).scale(q/F),e=b[3].WQ(b[2]).scale(q/F),N=1/F;let y=0;for(let E=0;E<F;E++)for(let t=0;t<Z;t++){let t=b[0],g=b[2];for(let b=0;b<F;b++)for(let q=0;q<Z;q++){const Z=g.WQ(t).scale(y).add(t);Z.normalize();const q=this.CalcProjectionSpherical(Z,Q,C,z);W[E*F*3+3*b+0]+=q.r*G,W[E*F*3+3*b+1]+=q.g*G,W[E*F*3+3*b+2]+=q.b*G,t=t.add(K),g=g.add(e)}y+=N*q}return W}static CalcProjectionSpherical(F,b,Q,C){let z=Math.atan2(F.z,F.x);const t=Math.acos(F.y);for(;z<-Math.PI;)z+=2*Math.PI;for(;z>Math.PI;)z-=2*Math.PI;let g=z/Math.PI;const W=t/Math.PI;g=.5*g+.5;let Z=Math.round(g*Q);Z<0?Z=0:Z>=Q&&(Z=Q-1);let q=Math.round(W*C);q<0?q=0:q>=C&&(q=C-1);const G=C-q-1;return{r:b[G*Q*3+3*Z+0],g:b[G*Q*3+3*Z+1],b:b[G*Q*3+3*Z+2]}}}function t(F,b,Q,C,z,t){z>0?(z=function(F,b){return b>1023?F*Math.pow(2,1023)*Math.pow(2,b-1023):b<-1074?F*Math.pow(2,-1074)*Math.pow(2,b+1074):F*Math.pow(2,b)}(1,z-136),F[t+0]=b*z,F[t+1]=Q*z,F[t+2]=C*z):(F[t+0]=0,F[t+1]=0,F[t+2]=0)}function g(F,b){let Q="",C="";for(let z=b;z<F.length-b&&(C=String.fromCharCode(F[z]),"\n"!=C);z++)Q+=C;return Q}function W(F){let b=0,Q=0,C=g(F,0);if("#"!=C[0]||"?"!=C[1])throw"Bad HDR Format.";let z=!1,t=!1,W=0;do{W+=C.length+1,C=g(F,W),"FORMAT=32-bit_rle_rgbe"==C?t=!0:0==C.length&&(z=!0)}while(!z);if(!t)throw"HDR Bad header format, unsupported FORMAT";W+=C.length+1,C=g(F,W);const Z=/^-Y (.*) \+X (.*)$/g.exec(C);if(!Z||Z.length<3)throw"HDR Bad header format, no size";if(Q=parseInt(Z[2]),b=parseInt(Z[1]),Q<8||Q>32767)throw"HDR Bad header format, unsupported size";return W+=C.length+1,{height:b,width:Q,dataPosition:W}}function Z(F,b){return function(F,b){let Q=b.height;const C=b.width;let z,g,W,Z,G,K=b.dataPosition,e=0,N=0,y=0;const E=new ArrayBuffer(4*C),c=new Uint8Array(E),X=new ArrayBuffer(b.width*b.height*4*3),L=new Float32Array(X);for(;Q>0;){if(z=F[K++],g=F[K++],W=F[K++],Z=F[K++],2!=z||2!=g||128&W||b.width<8||b.width>32767)return q(F,b);if((W<<8|Z)!=C)throw"HDR Bad header format, wrong scan line width";for(e=0,y=0;y<4;y++)for(N=(y+1)*C;e<N;)if(z=F[K++],g=F[K++],z>128){if(G=z-128,0==G||G>N-e)throw"HDR Bad Format, bad scanline data (run)";for(;G-- >0;)c[e++]=g}else{if(G=z,0==G||G>N-e)throw"HDR Bad Format, bad scanline data (non-run)";if(c[e++]=g,--G>0)for(let b=0;b<G;b++)c[e++]=F[K++]}for(y=0;y<C;y++)z=c[y],g=c[y+C],W=c[y+2*C],Z=c[y+3*C],t(L,z,g,W,Z,(b.height-Q)*C*3+3*y);Q--}return L}(F,b)}function q(F,b){let Q=b.height;const C=b.width;let z,g,W,Z,q,G=b.dataPosition;const K=new ArrayBuffer(b.width*b.height*4*3),e=new Float32Array(K);for(;Q>0;){for(q=0;q<b.width;q++)z=F[G++],g=F[G++],W=F[G++],Z=F[G++],t(e,z,g,W,Z,(b.height-Q)*C*3+3*q);Q--}return e}z.FACE_LEFT=[new C.gQ(-1,-1,-1),new C.gQ(1,-1,-1),new C.gQ(-1,1,-1),new C.gQ(1,1,-1)],z.FACE_RIGHT=[new C.gQ(1,-1,1),new C.gQ(-1,-1,1),new C.gQ(1,1,1),new C.gQ(-1,1,1)],z.FACE_FRONT=[new C.gQ(1,-1,-1),new C.gQ(1,-1,1),new C.gQ(1,1,-1),new C.gQ(1,1,1)],z.FACE_BACK=[new C.gQ(-1,-1,1),new C.gQ(-1,-1,-1),new C.gQ(-1,1,1),new C.gQ(-1,1,-1)],z.FACE_DOWN=[new C.gQ(1,1,-1),new C.gQ(1,1,1),new C.gQ(-1,1,-1),new C.gQ(-1,1,1)],z.FACE_UP=[new C.gQ(-1,-1,-1),new C.gQ(-1,-1,1),new C.gQ(1,-1,-1),new C.gQ(1,-1,1)];class G{constructor(){this.supportCascades=!1}loadCubeData(){throw".hdr not supported in Cube."}loadData(F,b,Q){const C=new Uint8Array(F.buffer,F.byteOffset,F.byteLength),z=W(C),t=Z(C,z),g=z.width*z.height,q=new Float32Array(4*g);for(let W=0;W<g;W+=1)q[4*W]=t[3*W],q[4*W+1]=t[3*W+1],q[4*W+2]=t[3*W+2],q[4*W+3]=1;Q(z.width,z.height,b.generateMipMaps,!1,(()=>{const F=b.getEngine();b.type=1,b.format=5,b._gammaSpace=!1,F._uploadDataToTextureDirectly(b,q)}))}}}}]);