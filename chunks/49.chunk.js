"use strict";(self.zy41qorie9=self.zy41qorie9||[]).push([[49],{14587:(Z,l,C)=>{C.r(l),C.d(l,{_HDRTextureLoader:()=>d});var B=C(12442);class x{static ConvertPanoramaToCubemap(Z,l,C,B){let x=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!Z)throw"ConvertPanoramaToCubemap: input cannot be null";if(Z.length!=l*C*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(B,this.FACE_FRONT,Z,l,C,x),back:this.CreateCubemapTexture(B,this.FACE_BACK,Z,l,C,x),left:this.CreateCubemapTexture(B,this.FACE_LEFT,Z,l,C,x),right:this.CreateCubemapTexture(B,this.FACE_RIGHT,Z,l,C,x),up:this.CreateCubemapTexture(B,this.FACE_UP,Z,l,C,x),down:this.CreateCubemapTexture(B,this.FACE_DOWN,Z,l,C,x),size:B,type:1,format:4,gammaSpace:!1}}static CreateCubemapTexture(Z,l,C,B,x){let b=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const K=new ArrayBuffer(Z*Z*4*3),f=new Float32Array(K),W=b?Math.max(1,Math.round(B/4/Z)):1,J=1/W,d=J*J,E=l[1].zl(l[0]).scale(J/Z),G=l[3].zl(l[2]).scale(J/Z),a=1/Z;let q=0;for(let z=0;z<Z;z++)for(let b=0;b<W;b++){let b=l[0],K=l[2];for(let l=0;l<Z;l++)for(let J=0;J<W;J++){const W=K.zl(b).scale(q).add(b);W.normalize();const J=this.CalcProjectionSpherical(W,C,B,x);f[z*Z*3+3*l+0]+=J.r*d,f[z*Z*3+3*l+1]+=J.g*d,f[z*Z*3+3*l+2]+=J.b*d,b=b.add(E),K=K.add(G)}q+=a*J}return f}static CalcProjectionSpherical(Z,l,C,B){let x=Math.atan2(Z.z,Z.x);const b=Math.acos(Z.y);for(;x<-Math.PI;)x+=2*Math.PI;for(;x>Math.PI;)x-=2*Math.PI;let K=x/Math.PI;const f=b/Math.PI;K=.5*K+.5;let W=Math.round(K*C);W<0?W=0:W>=C&&(W=C-1);let J=Math.round(f*B);J<0?J=0:J>=B&&(J=B-1);const d=B-J-1;return{r:l[d*C*3+3*W+0],g:l[d*C*3+3*W+1],b:l[d*C*3+3*W+2]}}}function b(Z,l,C,B,x,b){x>0?(x=function(Z,l){return l>1023?Z*Math.pow(2,1023)*Math.pow(2,l-1023):l<-1074?Z*Math.pow(2,-1074)*Math.pow(2,l+1074):Z*Math.pow(2,l)}(1,x-136),Z[b+0]=l*x,Z[b+1]=C*x,Z[b+2]=B*x):(Z[b+0]=0,Z[b+1]=0,Z[b+2]=0)}function K(Z,l){let C="",B="";for(let x=l;x<Z.length-l&&(B=String.fromCharCode(Z[x]),"\n"!=B);x++)C+=B;return C}function f(Z){let l=0,C=0,B=K(Z,0);if("#"!=B[0]||"?"!=B[1])throw"Bad HDR Format.";let x=!1,b=!1,f=0;do{f+=B.length+1,B=K(Z,f),"FORMAT=32-bit_rle_rgbe"==B?b=!0:0==B.length&&(x=!0)}while(!x);if(!b)throw"HDR Bad header format, unsupported FORMAT";f+=B.length+1,B=K(Z,f);const W=/^-Y (.*) \+X (.*)$/g.exec(B);if(!W||W.length<3)throw"HDR Bad header format, no size";if(C=parseInt(W[2]),l=parseInt(W[1]),C<8||C>32767)throw"HDR Bad header format, unsupported size";return f+=B.length+1,{height:l,width:C,dataPosition:f}}function W(Z,l){return function(Z,l){let C=l.height;const B=l.width;let x,K,f,W,d,E=l.dataPosition,G=0,a=0,q=0;const z=new ArrayBuffer(4*B),Y=new Uint8Array(z),P=new ArrayBuffer(l.width*l.height*4*3),S=new Float32Array(P);for(;C>0;){if(x=Z[E++],K=Z[E++],f=Z[E++],W=Z[E++],2!=x||2!=K||128&f||l.width<8||l.width>32767)return J(Z,l);if((f<<8|W)!=B)throw"HDR Bad header format, wrong scan line width";for(G=0,q=0;q<4;q++)for(a=(q+1)*B;G<a;)if(x=Z[E++],K=Z[E++],x>128){if(d=x-128,0==d||d>a-G)throw"HDR Bad Format, bad scanline data (run)";for(;d-- >0;)Y[G++]=K}else{if(d=x,0==d||d>a-G)throw"HDR Bad Format, bad scanline data (non-run)";if(Y[G++]=K,--d>0)for(let l=0;l<d;l++)Y[G++]=Z[E++]}for(q=0;q<B;q++)x=Y[q],K=Y[q+B],f=Y[q+2*B],W=Y[q+3*B],b(S,x,K,f,W,(l.height-C)*B*3+3*q);C--}return S}(Z,l)}function J(Z,l){let C=l.height;const B=l.width;let x,K,f,W,J,d=l.dataPosition;const E=new ArrayBuffer(l.width*l.height*4*3),G=new Float32Array(E);for(;C>0;){for(J=0;J<l.width;J++)x=Z[d++],K=Z[d++],f=Z[d++],W=Z[d++],b(G,x,K,f,W,(l.height-C)*B*3+3*J);C--}return G}x.FACE_LEFT=[new B.ql(-1,-1,-1),new B.ql(1,-1,-1),new B.ql(-1,1,-1),new B.ql(1,1,-1)],x.FACE_RIGHT=[new B.ql(1,-1,1),new B.ql(-1,-1,1),new B.ql(1,1,1),new B.ql(-1,1,1)],x.FACE_FRONT=[new B.ql(1,-1,-1),new B.ql(1,-1,1),new B.ql(1,1,-1),new B.ql(1,1,1)],x.FACE_BACK=[new B.ql(-1,-1,1),new B.ql(-1,-1,-1),new B.ql(-1,1,1),new B.ql(-1,1,-1)],x.FACE_DOWN=[new B.ql(1,1,-1),new B.ql(1,1,1),new B.ql(-1,1,-1),new B.ql(-1,1,1)],x.FACE_UP=[new B.ql(-1,-1,-1),new B.ql(-1,-1,1),new B.ql(1,-1,-1),new B.ql(1,-1,1)];class d{constructor(){this.supportCascades=!1}loadCubeData(){throw".hdr not supported in Cube."}loadData(Z,l,C){const B=new Uint8Array(Z.buffer,Z.byteOffset,Z.byteLength),x=f(B),b=W(B,x),K=x.width*x.height,J=new Float32Array(4*K);for(let f=0;f<K;f+=1)J[4*f]=b[3*f],J[4*f+1]=b[3*f+1],J[4*f+2]=b[3*f+2],J[4*f+3]=1;C(x.width,x.height,l.generateMipMaps,!1,(()=>{const Z=l.getEngine();l.type=1,l.format=5,l._gammaSpace=!1,Z._uploadDataToTextureDirectly(l,J)}))}}}}]);