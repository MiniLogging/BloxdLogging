"use strict";(self.uji65st81d=self.uji65st81d||[]).push([[49],{14828:(V,h,mV)=>{mV.r(h),mV.d(h,{_HDRTextureLoader:()=>o});var t=mV(12422);class L{static ConvertPanoramaToCubemap(V,h,mV,t){let L=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!V)throw"ConvertPanoramaToCubemap: input cannot be null";if(V.length!=h*mV*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(t,this.FACE_FRONT,V,h,mV,L),back:this.CreateCubemapTexture(t,this.FACE_BACK,V,h,mV,L),left:this.CreateCubemapTexture(t,this.FACE_LEFT,V,h,mV,L),right:this.CreateCubemapTexture(t,this.FACE_RIGHT,V,h,mV,L),up:this.CreateCubemapTexture(t,this.FACE_UP,V,h,mV,L),down:this.CreateCubemapTexture(t,this.FACE_DOWN,V,h,mV,L),size:t,type:1,format:4,gammaSpace:!1}}static CreateCubemapTexture(V,h,mV,t,L){let N=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const A=new ArrayBuffer(V*V*4*3),k=new Float32Array(A),C=N?Math.max(1,Math.round(t/4/V)):1,K=1/C,o=K*K,n=h[1].Mh(h[0]).scale(K/V),q=h[3].Mh(h[2]).scale(K/V),x=1/V;let R=0;for(let d=0;d<V;d++)for(let N=0;N<C;N++){let N=h[0],A=h[2];for(let h=0;h<V;h++)for(let K=0;K<C;K++){const C=A.Mh(N).scale(R).add(N);C.normalize();const K=this.CalcProjectionSpherical(C,mV,t,L);k[d*V*3+3*h+0]+=K.r*o,k[d*V*3+3*h+1]+=K.g*o,k[d*V*3+3*h+2]+=K.b*o,N=N.add(n),A=A.add(q)}R+=x*K}return k}static CalcProjectionSpherical(V,h,mV,t){let L=Math.atan2(V.z,V.x);const N=Math.acos(V.y);for(;L<-Math.PI;)L+=2*Math.PI;for(;L>Math.PI;)L-=2*Math.PI;let A=L/Math.PI;const k=N/Math.PI;A=.5*A+.5;let C=Math.round(A*mV);C<0?C=0:C>=mV&&(C=mV-1);let K=Math.round(k*t);K<0?K=0:K>=t&&(K=t-1);const o=t-K-1;return{r:h[o*mV*3+3*C+0],g:h[o*mV*3+3*C+1],b:h[o*mV*3+3*C+2]}}}function N(V,h,mV,t,L,N){L>0?(L=function(V,h){return h>1023?V*Math.pow(2,1023)*Math.pow(2,h-1023):h<-1074?V*Math.pow(2,-1074)*Math.pow(2,h+1074):V*Math.pow(2,h)}(1,L-136),V[N+0]=h*L,V[N+1]=mV*L,V[N+2]=t*L):(V[N+0]=0,V[N+1]=0,V[N+2]=0)}function A(V,h){let mV="",t="";for(let L=h;L<V.length-h&&(t=String.fromCharCode(V[L]),"\n"!=t);L++)mV+=t;return mV}function k(V){let h=0,mV=0,t=A(V,0);if("#"!=t[0]||"?"!=t[1])throw"Bad HDR Format.";let L=!1,N=!1,k=0;do{k+=t.length+1,t=A(V,k),"FORMAT=32-bit_rle_rgbe"==t?N=!0:0==t.length&&(L=!0)}while(!L);if(!N)throw"HDR Bad header format, unsupported FORMAT";k+=t.length+1,t=A(V,k);const C=/^-Y (.*) \+X (.*)$/g.exec(t);if(!C||C.length<3)throw"HDR Bad header format, no size";if(mV=parseInt(C[2]),h=parseInt(C[1]),mV<8||mV>32767)throw"HDR Bad header format, unsupported size";return k+=t.length+1,{height:h,width:mV,dataPosition:k}}function C(V,h){return function(V,h){let mV=h.height;const t=h.width;let L,A,k,C,o,n=h.dataPosition,q=0,x=0,R=0;const d=new ArrayBuffer(4*t),s=new Uint8Array(d),M=new ArrayBuffer(h.width*h.height*4*3),c=new Float32Array(M);for(;mV>0;){if(L=V[n++],A=V[n++],k=V[n++],C=V[n++],2!=L||2!=A||128&k||h.width<8||h.width>32767)return K(V,h);if((k<<8|C)!=t)throw"HDR Bad header format, wrong scan line width";for(q=0,R=0;R<4;R++)for(x=(R+1)*t;q<x;)if(L=V[n++],A=V[n++],L>128){if(o=L-128,0==o||o>x-q)throw"HDR Bad Format, bad scanline data (run)";for(;o-- >0;)s[q++]=A}else{if(o=L,0==o||o>x-q)throw"HDR Bad Format, bad scanline data (non-run)";if(s[q++]=A,--o>0)for(let h=0;h<o;h++)s[q++]=V[n++]}for(R=0;R<t;R++)L=s[R],A=s[R+t],k=s[R+2*t],C=s[R+3*t],N(c,L,A,k,C,(h.height-mV)*t*3+3*R);mV--}return c}(V,h)}function K(V,h){let mV=h.height;const t=h.width;let L,A,k,C,K,o=h.dataPosition;const n=new ArrayBuffer(h.width*h.height*4*3),q=new Float32Array(n);for(;mV>0;){for(K=0;K<h.width;K++)L=V[o++],A=V[o++],k=V[o++],C=V[o++],N(q,L,A,k,C,(h.height-mV)*t*3+3*K);mV--}return q}L.FACE_LEFT=[new t.sh(-1,-1,-1),new t.sh(1,-1,-1),new t.sh(-1,1,-1),new t.sh(1,1,-1)],L.FACE_RIGHT=[new t.sh(1,-1,1),new t.sh(-1,-1,1),new t.sh(1,1,1),new t.sh(-1,1,1)],L.FACE_FRONT=[new t.sh(1,-1,-1),new t.sh(1,-1,1),new t.sh(1,1,-1),new t.sh(1,1,1)],L.FACE_BACK=[new t.sh(-1,-1,1),new t.sh(-1,-1,-1),new t.sh(-1,1,1),new t.sh(-1,1,-1)],L.FACE_DOWN=[new t.sh(1,1,-1),new t.sh(1,1,1),new t.sh(-1,1,-1),new t.sh(-1,1,1)],L.FACE_UP=[new t.sh(-1,-1,-1),new t.sh(-1,-1,1),new t.sh(1,-1,-1),new t.sh(1,-1,1)];class o{constructor(){this.supportCascades=!1}loadCubeData(){throw".hdr not supported in Cube."}loadData(V,h,mV){const t=new Uint8Array(V.buffer,V.byteOffset,V.byteLength),L=k(t),N=C(t,L),A=L.width*L.height,K=new Float32Array(4*A);for(let k=0;k<A;k+=1)K[4*k]=N[3*k],K[4*k+1]=N[3*k+1],K[4*k+2]=N[3*k+2],K[4*k+3]=1;mV(L.width,L.height,h.generateMipMaps,!1,(()=>{const V=h.getEngine();h.type=1,h.format=5,h._gammaSpace=!1,V._uploadDataToTextureDirectly(h,K)}))}}}}]);