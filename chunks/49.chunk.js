"use strict";(self.vfdo5lmva5i=self.vfdo5lmva5i||[]).push([[49],{14260:(w,o,H)=>{H.r(o),H.d(o,{_HDRTextureLoader:()=>A});var h=H(11720);class E{static ConvertPanoramaToCubemap(w,o,H,h){let E=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!w)throw"ConvertPanoramaToCubemap: input cannot be null";if(w.length!=o*H*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(h,this.FACE_FRONT,w,o,H,E),back:this.CreateCubemapTexture(h,this.FACE_BACK,w,o,H,E),left:this.CreateCubemapTexture(h,this.FACE_LEFT,w,o,H,E),right:this.CreateCubemapTexture(h,this.FACE_RIGHT,w,o,H,E),up:this.CreateCubemapTexture(h,this.FACE_UP,w,o,H,E),down:this.CreateCubemapTexture(h,this.FACE_DOWN,w,o,H,E),size:h,type:1,format:4,gammaSpace:!1}}static CreateCubemapTexture(w,o,H,h,E){let e=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const D=new ArrayBuffer(w*w*4*3),t=new Float32Array(D),X=e?Math.max(1,Math.round(h/4/w)):1,L=1/X,A=L*L,y=o[1].so(o[0]).scale(L/w),z=o[3].so(o[2]).scale(L/w),C=1/w;let Q=0;for(let M=0;M<w;M++)for(let e=0;e<X;e++){let e=o[0],D=o[2];for(let o=0;o<w;o++)for(let L=0;L<X;L++){const X=D.so(e).scale(Q).add(e);X.normalize();const L=this.CalcProjectionSpherical(X,H,h,E);t[M*w*3+3*o+0]+=L.r*A,t[M*w*3+3*o+1]+=L.g*A,t[M*w*3+3*o+2]+=L.b*A,e=e.add(y),D=D.add(z)}Q+=C*L}return t}static CalcProjectionSpherical(w,o,H,h){let E=Math.atan2(w.z,w.x);const e=Math.acos(w.y);for(;E<-Math.PI;)E+=2*Math.PI;for(;E>Math.PI;)E-=2*Math.PI;let D=E/Math.PI;const t=e/Math.PI;D=.5*D+.5;let X=Math.round(D*H);X<0?X=0:X>=H&&(X=H-1);let L=Math.round(t*h);L<0?L=0:L>=h&&(L=h-1);const A=h-L-1;return{r:o[A*H*3+3*X+0],g:o[A*H*3+3*X+1],b:o[A*H*3+3*X+2]}}}function e(w,o,H,h,E,e){E>0?(E=function(w,o){return o>1023?w*Math.pow(2,1023)*Math.pow(2,o-1023):o<-1074?w*Math.pow(2,-1074)*Math.pow(2,o+1074):w*Math.pow(2,o)}(1,E-136),w[e+0]=o*E,w[e+1]=H*E,w[e+2]=h*E):(w[e+0]=0,w[e+1]=0,w[e+2]=0)}function D(w,o){let H="",h="";for(let E=o;E<w.length-o&&(h=String.fromCharCode(w[E]),"\n"!=h);E++)H+=h;return H}function t(w){let o=0,H=0,h=D(w,0);if("#"!=h[0]||"?"!=h[1])throw"Bad HDR Format.";let E=!1,e=!1,t=0;do{t+=h.length+1,h=D(w,t),"FORMAT=32-bit_rle_rgbe"==h?e=!0:0==h.length&&(E=!0)}while(!E);if(!e)throw"HDR Bad header format, unsupported FORMAT";t+=h.length+1,h=D(w,t);const X=/^-Y (.*) \+X (.*)$/g.exec(h);if(!X||X.length<3)throw"HDR Bad header format, no size";if(H=parseInt(X[2]),o=parseInt(X[1]),H<8||H>32767)throw"HDR Bad header format, unsupported size";return t+=h.length+1,{height:o,width:H,dataPosition:t}}function X(w,o){return function(w,o){let H=o.height;const h=o.width;let E,D,t,X,A,y=o.dataPosition,z=0,C=0,Q=0;const M=new ArrayBuffer(4*h),i=new Uint8Array(M),s=new ArrayBuffer(o.width*o.height*4*3),V=new Float32Array(s);for(;H>0;){if(E=w[y++],D=w[y++],t=w[y++],X=w[y++],2!=E||2!=D||128&t||o.width<8||o.width>32767)return L(w,o);if((t<<8|X)!=h)throw"HDR Bad header format, wrong scan line width";for(z=0,Q=0;Q<4;Q++)for(C=(Q+1)*h;z<C;)if(E=w[y++],D=w[y++],E>128){if(A=E-128,0==A||A>C-z)throw"HDR Bad Format, bad scanline data (run)";for(;A-- >0;)i[z++]=D}else{if(A=E,0==A||A>C-z)throw"HDR Bad Format, bad scanline data (non-run)";if(i[z++]=D,--A>0)for(let o=0;o<A;o++)i[z++]=w[y++]}for(Q=0;Q<h;Q++)E=i[Q],D=i[Q+h],t=i[Q+2*h],X=i[Q+3*h],e(V,E,D,t,X,(o.height-H)*h*3+3*Q);H--}return V}(w,o)}function L(w,o){let H=o.height;const h=o.width;let E,D,t,X,L,A=o.dataPosition;const y=new ArrayBuffer(o.width*o.height*4*3),z=new Float32Array(y);for(;H>0;){for(L=0;L<o.width;L++)E=w[A++],D=w[A++],t=w[A++],X=w[A++],e(z,E,D,t,X,(o.height-H)*h*3+3*L);H--}return z}E.FACE_LEFT=[new h.io(-1,-1,-1),new h.io(1,-1,-1),new h.io(-1,1,-1),new h.io(1,1,-1)],E.FACE_RIGHT=[new h.io(1,-1,1),new h.io(-1,-1,1),new h.io(1,1,1),new h.io(-1,1,1)],E.FACE_FRONT=[new h.io(1,-1,-1),new h.io(1,-1,1),new h.io(1,1,-1),new h.io(1,1,1)],E.FACE_BACK=[new h.io(-1,-1,1),new h.io(-1,-1,-1),new h.io(-1,1,1),new h.io(-1,1,-1)],E.FACE_DOWN=[new h.io(1,1,-1),new h.io(1,1,1),new h.io(-1,1,-1),new h.io(-1,1,1)],E.FACE_UP=[new h.io(-1,-1,-1),new h.io(-1,-1,1),new h.io(1,-1,-1),new h.io(1,-1,1)];class A{constructor(){this.supportCascades=!1}loadCubeData(){throw".hdr not supported in Cube."}loadData(w,o,H){const h=new Uint8Array(w.buffer,w.byteOffset,w.byteLength),E=t(h),e=X(h,E),D=E.width*E.height,L=new Float32Array(4*D);for(let t=0;t<D;t+=1)L[4*t]=e[3*t],L[4*t+1]=e[3*t+1],L[4*t+2]=e[3*t+2],L[4*t+3]=1;H(E.width,E.height,o.generateMipMaps,!1,(()=>{const w=o.getEngine();o.type=1,o.format=5,o._gammaSpace=!1,w._uploadDataToTextureDirectly(o,L)}))}}}}]);