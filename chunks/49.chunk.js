"use strict";(self["7c63p8lin4r"]=self["7c63p8lin4r"]||[]).push([[49],{15011:(z,u,U)=>{U.r(u),U.d(u,{_HDRTextureLoader:()=>S});var J=U(12914);class v{static ConvertPanoramaToCubemap(z,u,U,J){let v=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!z)throw"ConvertPanoramaToCubemap: input cannot be null";if(z.length!=u*U*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(J,this.FACE_FRONT,z,u,U,v),back:this.CreateCubemapTexture(J,this.FACE_BACK,z,u,U,v),left:this.CreateCubemapTexture(J,this.FACE_LEFT,z,u,U,v),right:this.CreateCubemapTexture(J,this.FACE_RIGHT,z,u,U,v),up:this.CreateCubemapTexture(J,this.FACE_UP,z,u,U,v),down:this.CreateCubemapTexture(J,this.FACE_DOWN,z,u,U,v),size:J,type:1,format:4,gammaSpace:!1}}static CreateCubemapTexture(z,u,U,J,v){let f=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const g=new ArrayBuffer(z*z*4*3),w=new Float32Array(g),P=f?Math.max(1,Math.round(J/4/z)):1,R=1/P,S=R*R,d=u[1].Cu(u[0]).scale(R/z),mz=u[3].Cu(u[2]).scale(R/z),Z=1/z;let A=0;for(let E=0;E<z;E++)for(let f=0;f<P;f++){let f=u[0],g=u[2];for(let u=0;u<z;u++)for(let R=0;R<P;R++){const P=g.Cu(f).scale(A).add(f);P.normalize();const R=this.CalcProjectionSpherical(P,U,J,v);w[E*z*3+3*u+0]+=R.r*S,w[E*z*3+3*u+1]+=R.g*S,w[E*z*3+3*u+2]+=R.b*S,f=f.add(d),g=g.add(mz)}A+=Z*R}return w}static CalcProjectionSpherical(z,u,U,J){let v=Math.atan2(z.z,z.x);const f=Math.acos(z.y);for(;v<-Math.PI;)v+=2*Math.PI;for(;v>Math.PI;)v-=2*Math.PI;let g=v/Math.PI;const w=f/Math.PI;g=.5*g+.5;let P=Math.round(g*U);P<0?P=0:P>=U&&(P=U-1);let R=Math.round(w*J);R<0?R=0:R>=J&&(R=J-1);const S=J-R-1;return{r:u[S*U*3+3*P+0],g:u[S*U*3+3*P+1],b:u[S*U*3+3*P+2]}}}function f(z,u,U,J,v,f){v>0?(v=function(z,u){return u>1023?z*Math.pow(2,1023)*Math.pow(2,u-1023):u<-1074?z*Math.pow(2,-1074)*Math.pow(2,u+1074):z*Math.pow(2,u)}(1,v-136),z[f+0]=u*v,z[f+1]=U*v,z[f+2]=J*v):(z[f+0]=0,z[f+1]=0,z[f+2]=0)}function g(z,u){let U="",J="";for(let v=u;v<z.length-u&&(J=String.fromCharCode(z[v]),"\n"!=J);v++)U+=J;return U}function w(z){let u=0,U=0,J=g(z,0);if("#"!=J[0]||"?"!=J[1])throw"Bad HDR Format.";let v=!1,f=!1,w=0;do{w+=J.length+1,J=g(z,w),"FORMAT=32-bit_rle_rgbe"==J?f=!0:0==J.length&&(v=!0)}while(!v);if(!f)throw"HDR Bad header format, unsupported FORMAT";w+=J.length+1,J=g(z,w);const P=/^-Y (.*) \+X (.*)$/g.exec(J);if(!P||P.length<3)throw"HDR Bad header format, no size";if(U=parseInt(P[2]),u=parseInt(P[1]),U<8||U>32767)throw"HDR Bad header format, unsupported size";return w+=J.length+1,{height:u,width:U,dataPosition:w}}function P(z,u){return function(z,u){let U=u.height;const J=u.width;let v,g,w,P,S,d=u.dataPosition,mz=0,Z=0,A=0;const E=new ArrayBuffer(4*J),C=new Uint8Array(E),r=new ArrayBuffer(u.width*u.height*4*3),M=new Float32Array(r);for(;U>0;){if(v=z[d++],g=z[d++],w=z[d++],P=z[d++],2!=v||2!=g||128&w||u.width<8||u.width>32767)return R(z,u);if((w<<8|P)!=J)throw"HDR Bad header format, wrong scan line width";for(mz=0,A=0;A<4;A++)for(Z=(A+1)*J;mz<Z;)if(v=z[d++],g=z[d++],v>128){if(S=v-128,0==S||S>Z-mz)throw"HDR Bad Format, bad scanline data (run)";for(;S-- >0;)C[mz++]=g}else{if(S=v,0==S||S>Z-mz)throw"HDR Bad Format, bad scanline data (non-run)";if(C[mz++]=g,--S>0)for(let u=0;u<S;u++)C[mz++]=z[d++]}for(A=0;A<J;A++)v=C[A],g=C[A+J],w=C[A+2*J],P=C[A+3*J],f(M,v,g,w,P,(u.height-U)*J*3+3*A);U--}return M}(z,u)}function R(z,u){let U=u.height;const J=u.width;let v,g,w,P,R,S=u.dataPosition;const d=new ArrayBuffer(u.width*u.height*4*3),mz=new Float32Array(d);for(;U>0;){for(R=0;R<u.width;R++)v=z[S++],g=z[S++],w=z[S++],P=z[S++],f(mz,v,g,w,P,(u.height-U)*J*3+3*R);U--}return mz}v.FACE_LEFT=[new J.Eu(-1,-1,-1),new J.Eu(1,-1,-1),new J.Eu(-1,1,-1),new J.Eu(1,1,-1)],v.FACE_RIGHT=[new J.Eu(1,-1,1),new J.Eu(-1,-1,1),new J.Eu(1,1,1),new J.Eu(-1,1,1)],v.FACE_FRONT=[new J.Eu(1,-1,-1),new J.Eu(1,-1,1),new J.Eu(1,1,-1),new J.Eu(1,1,1)],v.FACE_BACK=[new J.Eu(-1,-1,1),new J.Eu(-1,-1,-1),new J.Eu(-1,1,1),new J.Eu(-1,1,-1)],v.FACE_DOWN=[new J.Eu(1,1,-1),new J.Eu(1,1,1),new J.Eu(-1,1,-1),new J.Eu(-1,1,1)],v.FACE_UP=[new J.Eu(-1,-1,-1),new J.Eu(-1,-1,1),new J.Eu(1,-1,-1),new J.Eu(1,-1,1)];class S{constructor(){this.supportCascades=!1}loadCubeData(){throw".hdr not supported in Cube."}loadData(z,u,U){const J=new Uint8Array(z.buffer,z.byteOffset,z.byteLength),v=w(J),f=P(J,v),g=v.width*v.height,R=new Float32Array(4*g);for(let w=0;w<g;w+=1)R[4*w]=f[3*w],R[4*w+1]=f[3*w+1],R[4*w+2]=f[3*w+2],R[4*w+3]=1;U(v.width,v.height,u.generateMipMaps,!1,(()=>{const z=u.getEngine();u.type=1,u.format=5,u._gammaSpace=!1,z._uploadDataToTextureDirectly(u,R)}))}}}}]);