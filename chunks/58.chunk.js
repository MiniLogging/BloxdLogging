"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[58],{14109:(q,f,j)=>{j.r(f),j.d(f,{AnimationGroup:()=>N,TargetedAnimation:()=>O});var d=j(11609),g=j(10982),h=j(10980),L=j(11202),Q=j(12628),H=j(10941);class r{get currentFrame(){return this._currentFrame}get weight(){return this._weight}get currentValue(){return this._currentValue}get targetPath(){return this._targetPath}get target(){return this._currentActiveTarget}get isAdditive(){return this._host&&this._host.isAdditive}constructor(q,f,j,g){if(this._events=new Array,this._currentFrame=0,this._originalValue=new Array,this._originalBlendValue=null,this._offsetsCache={},this._highLimitsCache={},this._stopped=!1,this._blendingFactor=0,this._currentValue=null,this._currentActiveTarget=null,this._directTarget=null,this._targetPath="",this._weight=1,this._absoluteFrameOffset=0,this._previousElapsedTime=0,this._yoyoDirection=1,this._previousAbsoluteFrame=0,this._targetIsArray=!1,this._coreRuntimeAnimation=null,this._animation=f,this._target=q,this._scene=j,this._host=g,this._activeTargets=[],f._runtimeAnimations.push(this),this._animationState={key:0,repeatCount:0,loopMode:this._getCorrectLoopMode()},this._animation.dataType===d.e.ANIMATIONTYPE_MATRIX&&(this._animationState.workValue=H.b.Zero()),this._keys=this._animation.getKeys(),this._minFrame=this._keys[0].frame,this._maxFrame=this._keys[this._keys.length-1].frame,this._minValue=this._keys[0].value,this._maxValue=this._keys[this._keys.length-1].value,0!==this._minFrame){const q={frame:0,value:this._minValue};this._keys.splice(0,0,q)}if(this._target instanceof Array){let q=0;for(const f of this._target)this._preparePath(f,q),this._getOriginalValues(q),q++;this._targetIsArray=!0}else this._preparePath(this._target),this._getOriginalValues(),this._targetIsArray=!1,this._directTarget=this._activeTargets[0];const h=f.getEvents();if(h&&h.length>0)for(const d of h)this._events.push(d._clone());this._enableBlending=q&&q.animationPropertiesOverride?q.animationPropertiesOverride.enableBlending:this._animation.enableBlending}_preparePath(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const j=this._animation.targetPropertyPath;if(j.length>1){let d=q;for(let q=0;q<j.length-1;q++){const f=j[q];if(d=d[f],void 0===d)throw new Error(`Invalid property (${f}) in property path (${j.join(".")})`)}this._targetPath=j[j.length-1],this._activeTargets[f]=d}else this._targetPath=j[0],this._activeTargets[f]=q;if(void 0===this._activeTargets[f][this._targetPath])throw new Error(`Invalid property (${this._targetPath}) in property path (${j.join(".")})`)}get animation(){return this._animation}reset(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])if(this._target instanceof Array){let q=0;for(const f of this._target)void 0!==this._originalValue[q]&&this._setValue(f,this._activeTargets[q],this._originalValue[q],-1,q),q++}else void 0!==this._originalValue[0]&&this._setValue(this._target,this._directTarget,this._originalValue[0],-1,0);this._offsetsCache={},this._highLimitsCache={},this._currentFrame=0,this._blendingFactor=0;for(let q=0;q<this._events.length;q++)this._events[q].isDone=!1}isStopped(){return this._stopped}dispose(){const q=this._animation.runtimeAnimations.indexOf(this);q>-1&&this._animation.runtimeAnimations.splice(q,1)}setValue(q,f){if(this._targetIsArray)for(let j=0;j<this._target.length;j++){const d=this._target[j];this._setValue(d,this._activeTargets[j],q,f,j)}else this._setValue(this._target,this._directTarget,q,f,0)}_getOriginalValues(){let q,f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const j=this._activeTargets[f];q=j.getLocalMatrix&&"_matrix"===this._targetPath?j.getLocalMatrix():j[this._targetPath],q&&q.clone?this._originalValue[f]=q.clone():this._originalValue[f]=q}_registerTargetForLateAnimationBinding(q,f){const j=q.target;this._scene._registeredForLateAnimationBindings.pushNoDuplicate(j),j._lateAnimationHolders||(j._lateAnimationHolders={}),j._lateAnimationHolders[q.targetPath]||(j._lateAnimationHolders[q.targetPath]={totalWeight:0,totalAdditiveWeight:0,animations:[],additiveAnimations:[],originalValue:f}),q.isAdditive?(j._lateAnimationHolders[q.targetPath].additiveAnimations.push(q),j._lateAnimationHolders[q.targetPath].totalAdditiveWeight+=q.weight):(j._lateAnimationHolders[q.targetPath].animations.push(q),j._lateAnimationHolders[q.targetPath].totalWeight+=q.weight)}_setValue(q,f,j,g,h){if(this._currentActiveTarget=f,this._weight=g,this._enableBlending&&this._blendingFactor<=1){if(!this._originalBlendValue){const q=f[this._targetPath];q.clone?this._originalBlendValue=q.clone():this._originalBlendValue=q}this._originalBlendValue.m?d.e.AllowMatrixDecomposeForInterpolation?this._currentValue?H.b.DecomposeLerpToRef(this._originalBlendValue,j,this._blendingFactor,this._currentValue):this._currentValue=H.b.DecomposeLerp(this._originalBlendValue,j,this._blendingFactor):this._currentValue?H.b.LerpToRef(this._originalBlendValue,j,this._blendingFactor,this._currentValue):this._currentValue=H.b.Lerp(this._originalBlendValue,j,this._blendingFactor):this._currentValue=d.e._UniversalLerp(this._originalBlendValue,j,this._blendingFactor);const g=q&&q.animationPropertiesOverride?q.animationPropertiesOverride.blendingSpeed:this._animation.blendingSpeed;this._blendingFactor+=g}else this._currentValue?this._currentValue.H?this._currentValue.H(j):this._currentValue=j:null!==j&&void 0!==j&&j.clone?this._currentValue=j.clone():this._currentValue=j;-1!==g?this._registerTargetForLateAnimationBinding(this,this._originalValue[h]):this._animationState.loopMode===d.e.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT?this._currentValue.addToRef?this._currentValue.addToRef(this._originalValue[h],f[this._targetPath]):f[this._targetPath]=this._originalValue[h]+this._currentValue:f[this._targetPath]=this._currentValue,q.zu&&q.zu(this._animation.targetProperty)}_getCorrectLoopMode(){return this._target&&this._target.animationPropertiesOverride?this._target.animationPropertiesOverride.loopMode:this._animation.loopMode}goToFrame(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;const j=this._animation.getKeys();q<j[0].frame?q=j[0].frame:q>j[j.length-1].frame&&(q=j[j.length-1].frame);const d=this._events;if(d.length)for(let h=0;h<d.length;h++)d[h].onlyOnce||(d[h].isDone=d[h].frame<q);this._currentFrame=q;const g=this._animation._interpolate(q,this._animationState);this.setValue(g,f)}_prepareForSpeedRatioChange(q){const f=this._previousElapsedTime*(this._animation.framePerSecond*q)/1e3;this._absoluteFrameOffset=this._previousAbsoluteFrame-f}animate(q,f,j,g,h){let L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:-1;const Q=this._animation,H=Q.targetPropertyPath;if(!H||H.length<1)return this._stopped=!0,!1;let r,u=!0;const X=this._events;let z=0;if(this._coreRuntimeAnimation)z=j-f,r=this._coreRuntimeAnimation.currentFrame,this._currentFrame=r,this._animationState.repeatCount=this._coreRuntimeAnimation._animationState.repeatCount,this._animationState.highLimitValue=this._coreRuntimeAnimation._animationState.highLimitValue,this._animationState.offsetValue=this._coreRuntimeAnimation._animationState.offsetValue;else{let L;(f<this._minFrame||f>this._maxFrame)&&(f=this._minFrame),(j<this._minFrame||j>this._maxFrame)&&(j=this._maxFrame),z=j-f;let H=q*(Q.framePerSecond*h)/1e3+this._absoluteFrameOffset,B=0,D=!1;const i=g&&this._animationState.loopMode===d.e.ANIMATIONLOOPMODE_YOYO;if(i){const q=(H-f)/z,j=Math.sin(q*Math.PI);H=Math.abs(j)*z+f;const d=j>=0?1:-1;this._yoyoDirection!==d&&(D=!0),this._yoyoDirection=d}if(this._previousElapsedTime=q,this._previousAbsoluteFrame=H,!g&&j>=f&&(H>=z&&h>0||H<=0&&h<0))u=!1,B=Q._getKeyValue(this._maxValue);else if(!g&&f>=j&&(H<=z&&h<0||H>=0&&h>0))u=!1,B=Q._getKeyValue(this._minValue);else if(this._animationState.loopMode!==d.e.ANIMATIONLOOPMODE_CYCLE){const q=j.toString()+f.toString();if(!this._offsetsCache[q]){this._animationState.repeatCount=0,this._animationState.loopMode=d.e.ANIMATIONLOOPMODE_CYCLE;const g=Q._interpolate(f,this._animationState),h=Q._interpolate(j,this._animationState);switch(this._animationState.loopMode=this._getCorrectLoopMode(),Q.dataType){case d.e.ANIMATIONTYPE_FLOAT:this._offsetsCache[q]=h-g;break;case d.e.ANIMATIONTYPE_QUATERNION:case d.e.ANIMATIONTYPE_VECTOR3:case d.e.ANIMATIONTYPE_VECTOR2:case d.e.ANIMATIONTYPE_SIZE:case d.e.ANIMATIONTYPE_COLOR3:this._offsetsCache[q]=h.ej(g)}this._highLimitsCache[q]=h}B=this._highLimitsCache[q],L=this._offsetsCache[q]}if(void 0===L)switch(Q.dataType){case d.e.ANIMATIONTYPE_FLOAT:L=0;break;case d.e.ANIMATIONTYPE_QUATERNION:L=d.k;break;case d.e.ANIMATIONTYPE_VECTOR3:L=d.o;break;case d.e.ANIMATIONTYPE_VECTOR2:L=d.n;break;case d.e.ANIMATIONTYPE_SIZE:L=d.l;break;case d.e.ANIMATIONTYPE_COLOR3:L=d.i;break;case d.e.ANIMATIONTYPE_COLOR4:L=d.j}if(this._host&&this._host.syncRoot){const q=this._host.syncRoot;r=f+z*((q.masterFrame-q.fromFrame)/(q.toFrame-q.fromFrame))}else r=H>0&&f>j||H<0&&f<j?u&&0!==z?j+H%z:f:u&&0!==z?f+H%z:j;if(!i&&(h>0&&this.currentFrame>r||h<0&&this.currentFrame<r)||i&&D){this._onLoop();for(let q=0;q<X.length;q++)X[q].onlyOnce||(X[q].isDone=!1);this._animationState.key=h>0?0:Q.getKeys().length-1}this._currentFrame=r,this._animationState.repeatCount=0===z?0:H/z|0,this._animationState.highLimitValue=B,this._animationState.offsetValue=L}const B=Q._interpolate(r,this._animationState);if(this.setValue(B,L),X.length)for(let d=0;d<X.length;d++)if(z>=0&&r>=X[d].frame&&X[d].frame>=f||z<0&&r<=X[d].frame&&X[d].frame<=f){const q=X[d];q.isDone||(q.onlyOnce&&(X.splice(d,1),d--),q.isDone=!0,q.action(r))}return u||(this._stopped=!0),u}}var u=j(11013);class X{get syncRoot(){return this._syncRoot}get masterFrame(){return 0===this._runtimeAnimations.length?0:this._runtimeAnimations[0].currentFrame}get weight(){return this._weight}set weight(q){this._weight=-1!==q?Math.min(Math.max(q,0),1):-1}get speedRatio(){return this._speedRatio}set speedRatio(q){for(let f=0;f<this._runtimeAnimations.length;f++){this._runtimeAnimations[f]._prepareForSpeedRatioChange(q)}this._speedRatio=q,null!==this._goToFrame&&this.goToFrame(this._goToFrame)}get elapsedTime(){return null===this._localDelayOffset?0:this._scene._animationTime-this._localDelayOffset}constructor(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,h=arguments.length>4&&void 0!==arguments[4]&&arguments[4],L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,Q=arguments.length>6?arguments[6]:void 0,H=arguments.length>7?arguments[7]:void 0,r=arguments.length>8?arguments[8]:void 0,u=arguments.length>9&&void 0!==arguments[9]&&arguments[9],X=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0;this.target=f,this.fromFrame=j,this.toFrame=d,this.loopAnimation=h,this.onAnimationEnd=Q,this.onAnimationLoop=r,this.isAdditive=u,this.playOrder=X,this._localDelayOffset=null,this._pausedDelay=null,this._manualJumpDelay=null,this._runtimeAnimations=new Array,this.XH=!1,this._speedRatio=1,this._weight=-1,this._previousWeight=-1,this._syncRoot=null,this._frameToSyncFromJump=null,this._goToFrame=null,this.disposeOnEnd=!0,this.animationStarted=!1,this.onAnimationEndObservable=new g.d,this.onAnimationLoopObservable=new g.d,this._scene=q,H&&this.appendAnimations(f,H),this._speedRatio=L,q._activeAnimatables.push(this)}syncWith(q){if(this._syncRoot=q,q){const q=this._scene._activeAnimatables.indexOf(this);q>-1&&(this._scene._activeAnimatables.splice(q,1),this._scene._activeAnimatables.push(this))}return this}getAnimations(){return this._runtimeAnimations}appendAnimations(q,f){for(let j=0;j<f.length;j++){const d=f[j],g=new r(q,d,this._scene,this);g._onLoop=()=>{this.onAnimationLoopObservable.notifyObservers(this),this.onAnimationLoop&&this.onAnimationLoop()},this._runtimeAnimations.push(g)}}getAnimationByTargetProperty(q){const f=this._runtimeAnimations;for(let j=0;j<f.length;j++)if(f[j].animation.targetProperty===q)return f[j].animation;return null}getRuntimeAnimationByTargetProperty(q){const f=this._runtimeAnimations;for(let j=0;j<f.length;j++)if(f[j].animation.targetProperty===q)return f[j];return null}reset(){const q=this._runtimeAnimations;for(let f=0;f<q.length;f++)q[f].reset(!0);this._localDelayOffset=null,this._pausedDelay=null}enableBlending(q){const f=this._runtimeAnimations;for(let j=0;j<f.length;j++)f[j].animation.enableBlending=!0,f[j].animation.blendingSpeed=q}disableBlending(){const q=this._runtimeAnimations;for(let f=0;f<q.length;f++)q[f].animation.enableBlending=!1}goToFrame(q){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const j=this._runtimeAnimations;if(j[0]){const f=j[0].animation.framePerSecond;this._frameToSyncFromJump=this._frameToSyncFromJump??j[0].currentFrame;const d=0===this.speedRatio?0:(q-this._frameToSyncFromJump)/f*1e3/this.speedRatio;this._manualJumpDelay=-d}for(let d=0;d<j.length;d++)j[d].goToFrame(q,f?this._weight:-1);this._goToFrame=q}get paused(){return this.XH}pause(){this.XH||(this.XH=!0)}restart(){this.XH=!1}_raiseOnAnimationEnd(){this.onAnimationEnd&&this.onAnimationEnd(),this.onAnimationEndObservable.notifyObservers(this)}stop(q,f){let j=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(q||f){const g=this._scene._activeAnimatables.indexOf(this);if(g>-1){const h=this._runtimeAnimations;for(let j=h.length-1;j>=0;j--){const d=h[j];q&&d.animation.name!=q||(f&&!f(d.target)||(d.dispose(),h.splice(j,1)))}0==h.length&&(j||this._scene._activeAnimatables.splice(g,1),d||this._raiseOnAnimationEnd())}}else{const q=this._scene._activeAnimatables.indexOf(this);if(q>-1){j||this._scene._activeAnimatables.splice(q,1);const f=this._runtimeAnimations;for(let q=0;q<f.length;q++)f[q].dispose();this._runtimeAnimations.length=0,d||this._raiseOnAnimationEnd()}}}async waitAsync(){return await new Promise((q=>{this.onAnimationEndObservable.add((()=>{q(this)}),void 0,void 0,this,!0)}))}_animate(q){if(this.XH)return this.animationStarted=!1,null===this._pausedDelay&&(this._pausedDelay=q),!0;if(null===this._localDelayOffset?(this._localDelayOffset=q,this._pausedDelay=null):null!==this._pausedDelay&&(this._localDelayOffset+=q-this._pausedDelay,this._pausedDelay=null),null!==this._manualJumpDelay&&(this._localDelayOffset+=this.speedRatio<0?-this._manualJumpDelay:this._manualJumpDelay,this._manualJumpDelay=null,this._frameToSyncFromJump=null),this._goToFrame=null,0===this._weight&&0===this._previousWeight)return!0;this._previousWeight=this._weight;let f=!1;const j=this._runtimeAnimations;let d;for(d=0;d<j.length;d++){const g=j[d].animate(q-this._localDelayOffset,this.fromFrame,this.toFrame,this.loopAnimation,this._speedRatio,this._weight);f=f||g}if(this.animationStarted=f,!f){if(this.disposeOnEnd)for(d=this._scene._activeAnimatables.indexOf(this),this._scene._activeAnimatables.splice(d,1),d=0;d<j.length;d++)j[d].dispose();this._raiseOnAnimationEnd(),this.disposeOnEnd&&(this.onAnimationEnd=null,this.onAnimationLoop=null,this.onAnimationLoopObservable.clear(),this.onAnimationEndObservable.clear())}return f}}function z(q){if(0===q.totalWeight&&0===q.totalAdditiveWeight)return q.originalValue;let f=1;const j=H.f.kf[0],d=H.f.kf[1],g=H.f.Quaternion[0];let h=0;const L=q.animations[0],Q=q.originalValue;let r=1,u=!1;if(q.totalWeight<1)r=1-q.totalWeight,Q.decompose(d,g,j);else{if(h=1,f=q.totalWeight,r=L.weight/f,1==r){if(!q.totalAdditiveWeight)return L.currentValue;u=!0}L.currentValue.decompose(d,g,j)}if(!u){d.scaleInPlace(r),j.scaleInPlace(r),g.scaleInPlace(r);for(let L=h;L<q.animations.length;L++){const h=q.animations[L];if(0===h.weight)continue;r=h.weight/f;const Q=H.f.kf[2],u=H.f.kf[3],X=H.f.Quaternion[1];h.currentValue.decompose(u,X,Q),u.scaleAndAddToRef(r,d),X.scaleAndAddToRef(H.e.Dot(g,X)>0?r:-r,g),Q.scaleAndAddToRef(r,j)}g.normalize()}for(let z=0;z<q.additiveAnimations.length;z++){const f=q.additiveAnimations[z];if(0===f.weight)continue;const h=H.f.kf[2],L=H.f.kf[3],Q=H.f.Quaternion[1];f.currentValue.decompose(L,Q,h),L.multiplyToRef(d,L),H.j.LerpToRef(d,L,f.weight,d),g.multiplyToRef(Q,Q),H.e.SlerpToRef(g,Q,f.weight,g),h.scaleAndAddToRef(f.weight,j)}const X=L?L._animationState.workValue:H.f.Matrix[0].clone();return H.b.ComposeToRef(d,g,j,X),X}function B(q,f){if(0===q.totalWeight&&0===q.totalAdditiveWeight)return f;const j=q.animations[0],d=q.originalValue;let g=f;if(0===q.totalWeight&&q.totalAdditiveWeight>0)g.H(d);else if(1===q.animations.length){if(H.e.SlerpToRef(d,j.currentValue,Math.min(1,q.totalWeight),g),0===q.totalAdditiveWeight)return g}else if(q.animations.length>1){let j,h,L=1;if(q.totalWeight<1){const f=1-q.totalWeight;j=[],h=[],j.push(d),h.push(f)}else{if(2===q.animations.length&&(H.e.SlerpToRef(q.animations[0].currentValue,q.animations[1].currentValue,q.animations[1].weight/q.totalWeight,f),0===q.totalAdditiveWeight))return f;j=[],h=[],L=q.totalWeight}for(let f=0;f<q.animations.length;f++){const d=q.animations[f];j.push(d.currentValue),h.push(d.weight/L)}let Q=0;for(let q=0;q<j.length;)q?(Q+=h[q],H.e.SlerpToRef(g,j[q],h[q]/Q,g),q++):(H.e.SlerpToRef(j[q],j[q+1],h[q+1]/(h[q]+h[q+1]),f),g=f,Q=h[q]+h[q+1],q+=2)}for(let h=0;h<q.additiveAnimations.length;h++){const f=q.additiveAnimations[h];0!==f.weight&&(g.multiplyToRef(f.currentValue,H.f.Quaternion[0]),H.e.SlerpToRef(g,H.f.Quaternion[0],f.weight,g))}return g}var D,i,t=j(11506);D=t.b,(i=Q.e)&&(i.prototype.copyAnimationRange=function(q,f,j){let g=arguments.length>3&&void 0!==arguments[3]&&arguments[3],h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;0===this.animations.length&&(this.animations.push(new d.e(this.name,"_matrix",q.animations[0].framePerSecond,d.e.ANIMATIONTYPE_MATRIX,0)),this.animations[0].setKeys([]));const L=q.animations[0].getRange(f);if(!L)return!1;const Q=L.from,H=L.to,r=q.animations[0].getKeys(),u=q.length,X=q.getParent(),z=this.getParent(),B=g&&X&&u&&this.length&&u!==this.length,D=B&&z&&X?z.length/X.length:1,i=g&&!z&&h&&(1!==h.x||1!==h.y||1!==h.z),t=this.animations[0].getKeys();let O,N,w;for(let d=0,E=r.length;d<E;d++)O=r[d],O.frame>=Q&&O.frame<=H&&(g?(w=O.value.clone(),B?(N=w.getTranslation(),w.setTranslation(N.scaleInPlace(D))):i&&h?(N=w.getTranslation(),w.setTranslation(N.multiplyInPlace(h))):w=O.value):w=O.value,t.push({frame:O.frame+j,value:w}));return this.animations[0].createRange(f,Q+j,H+j),!0}),D&&(D.prototype._animate=function(q){if(!this.animationsEnabled)return;const f=u.c.Now;if(!this._animationTimeLast){if(this._pendingData.length>0)return;this._animationTimeLast=f}this.deltaTime=void 0!==q?q:this.useConstantAnimationDeltaTime?16:(f-this._animationTimeLast)*this.animationTimeScale,this._animationTimeLast=f;const j=this._activeAnimatables;if(0===j.length)return;this._animationTime+=this.deltaTime;const g=this._animationTime;for(let d=0;d<j.length;d++){const q=j[d];!q._animate(g)&&q.disposeOnEnd&&d--}!function(q){if(q._registeredForLateAnimationBindings.length){for(let f=0;f<q._registeredForLateAnimationBindings.length;f++){const j=q._registeredForLateAnimationBindings.data[f];for(const q in j._lateAnimationHolders){const f=j._lateAnimationHolders[q],g=f.animations[0],h=f.originalValue;if(void 0===h||null===h)continue;const L=d.e.AllowMatrixDecomposeForInterpolation&&h.m;let Q=j[q];if(L)Q=z(f);else if(void 0!==h.w)Q=B(f,Q||H.e.Identity());else{let q=0,j=1;const L=g&&g._animationState.loopMode===d.e.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT;if(f.totalWeight<1)Q=L?h.clone?h.clone():h:g&&h.scale?h.scale(1-f.totalWeight):g?h*(1-f.totalWeight):h.clone?h.clone():h;else if(g){j=f.totalWeight;const d=g.weight/j;Q=1!==d?g.currentValue.scale?g.currentValue.scale(d):g.currentValue*d:g.currentValue,L&&(Q.addToRef?Q.addToRef(h,Q):Q+=h),q=1}for(let d=q;d<f.animations.length;d++){const q=f.animations[d],g=q.weight/j;g&&(q.currentValue.scaleAndAddToRef?q.currentValue.scaleAndAddToRef(g,Q):Q+=q.currentValue*g)}for(let d=0;d<f.additiveAnimations.length;d++){const q=f.additiveAnimations[d],j=q.weight;j&&(q.currentValue.scaleAndAddToRef?q.currentValue.scaleAndAddToRef(j,Q):Q+=q.currentValue*j)}}j[q]=Q}j._lateAnimationHolders={}}q._registeredForLateAnimationBindings.reset()}}(this)},D.prototype.sortActiveAnimatables=function(){this._activeAnimatables.sort(((q,f)=>q.playOrder-f.playOrder))},D.prototype.beginWeightedAnimation=function(q,f,j){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,g=arguments.length>4?arguments[4]:void 0,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,L=arguments.length>6?arguments[6]:void 0,Q=arguments.length>7?arguments[7]:void 0,H=arguments.length>8?arguments[8]:void 0,r=arguments.length>9?arguments[9]:void 0,u=arguments.length>10&&void 0!==arguments[10]&&arguments[10];const X=this.beginAnimation(q,f,j,g,h,L,Q,!1,H,r,u);return X.weight=d,X},D.prototype.beginAnimation=function(q,f,j,d){let g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,h=arguments.length>5?arguments[5]:void 0,L=arguments.length>6?arguments[6]:void 0,Q=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],H=arguments.length>8?arguments[8]:void 0,r=arguments.length>9?arguments[9]:void 0,u=arguments.length>10&&void 0!==arguments[10]&&arguments[10];if(g<0){const q=f;f=j,j=q,g=-g}f>j&&(g=-g),Q&&this.stopAnimation(q,void 0,H),L||(L=new X(this,q,f,j,d,g,h,void 0,r,u));const z=!H||H(q);if(q.animations&&z&&L.appendAnimations(q,q.animations),q.getAnimatables){const u=q.getAnimatables();for(let q=0;q<u.length;q++)this.beginAnimation(u[q],f,j,d,g,h,L,Q,H,r)}return L.reset(),L},D.prototype.beginHierarchyAnimation=function(q,f,j,d,g){let h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,L=arguments.length>6?arguments[6]:void 0,Q=arguments.length>7?arguments[7]:void 0,H=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],r=arguments.length>9?arguments[9]:void 0,u=arguments.length>11&&void 0!==arguments[11]&&arguments[11];const X=q.getDescendants(f),z=[];z.push(this.beginAnimation(q,j,d,g,h,L,Q,H,r,void 0,u));for(const B of X)z.push(this.beginAnimation(B,j,d,g,h,L,Q,H,r,void 0,u));return z},D.prototype.beginDirectAnimation=function(q,f,j,d,g){let h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;if(h<0){const q=j;j=d,d=q,h=-h}return j>d&&(h=-h),new X(this,q,j,d,g,h,arguments.length>6?arguments[6]:void 0,f,arguments.length>7?arguments[7]:void 0,arguments.length>8&&void 0!==arguments[8]&&arguments[8])},D.prototype.beginDirectHierarchyAnimation=function(q,f,j,d,g,h,L,Q,H){let r=arguments.length>9&&void 0!==arguments[9]&&arguments[9];const u=q.getDescendants(f),X=[];X.push(this.beginDirectAnimation(q,j,d,g,h,L,Q,H,r));for(const z of u)X.push(this.beginDirectAnimation(z,j,d,g,h,L,Q,H,r));return X},D.prototype.getAnimatableByTarget=function(q){for(let f=0;f<this._activeAnimatables.length;f++)if(this._activeAnimatables[f].target===q)return this._activeAnimatables[f];return null},D.prototype.getAllAnimatablesByTarget=function(q){const f=[];for(let j=0;j<this._activeAnimatables.length;j++)this._activeAnimatables[j].target===q&&f.push(this._activeAnimatables[j]);return f},D.prototype.stopAnimation=function(q,f,j){const d=this.getAllAnimatablesByTarget(q);for(const g of d)g.stop(f,j)},D.prototype.stopAllAnimations=function(){if(this._activeAnimatables){for(let q=0;q<this._activeAnimatables.length;q++)this._activeAnimatables[q].stop(void 0,void 0,!0);this._activeAnimatables.length=0}for(const q of this.animationGroups)q.stop()});class O{getClassName(){return"TargetedAnimation"}serialize(){const q={};return q.animation=this.animation.serialize(),q.targetId=this.target.id,q}}class N{get mask(){return this._mask}set mask(q){this._mask!==q&&(this._mask=q,this.syncWithMask(!0))}syncWithMask(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.mask||q){this._numActiveAnimatables=0;for(let q=0;q<this._animatables.length;++q){const f=this._animatables[q];!this.mask||this.mask.disabled||this.mask.retainsTarget(f.target.name)?(this._numActiveAnimatables++,f.paused&&f.restart()):f.paused||f.pause()}}else this._numActiveAnimatables=this._targetedAnimations.length}removeUnmaskedAnimations(){if(this.mask&&!this.mask.disabled){for(let q=0;q<this._animatables.length;++q){const f=this._animatables[q];this.mask.retainsTarget(f.target.name)||(f.stop(),this._animatables.splice(q,1),--q)}for(let q=0;q<this._targetedAnimations.length;q++){const f=this._targetedAnimations[q];this.mask.retainsTarget(f.target.name)||(this._targetedAnimations.splice(q,1),--q)}}}get from(){return this._from}set from(q){if(this._from!==q){this._from=q;for(let q=0;q<this._animatables.length;q++){this._animatables[q].fromFrame=this._from}}}get to(){return this._to}set to(q){if(this._to!==q){this._to=q;for(let q=0;q<this._animatables.length;q++){this._animatables[q].toFrame=this._to}}}get isStarted(){return this._isStarted}get isPlaying(){return this._isStarted&&!this._isPaused}get speedRatio(){return this._speedRatio}set speedRatio(q){if(this._speedRatio!==q){this._speedRatio=q;for(let q=0;q<this._animatables.length;q++){this._animatables[q].speedRatio=this._speedRatio}}}get loopAnimation(){return this._loopAnimation}set loopAnimation(q){if(this._loopAnimation!==q){this._loopAnimation=q;for(let q=0;q<this._animatables.length;q++){this._animatables[q].loopAnimation=this._loopAnimation}}}get isAdditive(){return this._isAdditive}set isAdditive(q){if(this._isAdditive!==q){this._isAdditive=q;for(let q=0;q<this._animatables.length;q++){this._animatables[q].isAdditive=this._isAdditive}}}get weight(){return this._weight}set weight(q){this._weight!==q&&(this._weight=q,this.setWeightForAllAnimatables(this._weight))}get targetedAnimations(){return this._targetedAnimations}get animatables(){return this._animatables}get children(){return this._targetedAnimations}get playOrder(){return this._playOrder}set playOrder(q){if(this._playOrder!==q&&(this._playOrder=q,this._animatables.length>0)){for(let q=0;q<this._animatables.length;q++)this._animatables[q].playOrder=this._playOrder;this._scene.sortActiveAnimatables()}}get enableBlending(){return this._enableBlending}set enableBlending(q){if(this._enableBlending!==q&&(this._enableBlending=q,null!==q))for(let f=0;f<this._targetedAnimations.length;++f)this._targetedAnimations[f].animation.enableBlending=q}get blendingSpeed(){return this._blendingSpeed}set blendingSpeed(q){if(this._blendingSpeed!==q&&(this._blendingSpeed=q,null!==q))for(let f=0;f<this._targetedAnimations.length;++f)this._targetedAnimations[f].animation.blendingSpeed=q}getLength(q,f){q=q??this._from;return((f=f??this._to)-q)/(this.targetedAnimations[0].animation.framePerSecond*this._speedRatio)}static MergeAnimationGroups(q){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],j=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=arguments.length>3?arguments[3]:void 0;if(0===q.length)return null;d=d??q[0].weight;let g=Number.MAX_VALUE,h=-Number.MAX_VALUE;if(j)for(const Q of q)Q.from<g&&(g=Q.from),Q.to>h&&(h=Q.to);const L=new N(q[0].name+"_merged",q[0]._scene,d);for(const Q of q){j&&Q.normalize(g,h);for(const q of Q.targetedAnimations)L.addTargetedAnimation(q.animation,q.target);f&&Q.dispose()}return L}constructor(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.name=q,this._targetedAnimations=new Array,this._animatables=new Array,this._from=Number.MAX_VALUE,this._to=-Number.MAX_VALUE,this._speedRatio=1,this._loopAnimation=!1,this._isAdditive=!1,this._weight=-1,this._playOrder=0,this._enableBlending=null,this._blendingSpeed=null,this._numActiveAnimatables=0,this._shouldStart=!0,this._parentContainer=null,this.onAnimationEndObservable=new g.d,this.onAnimationLoopObservable=new g.d,this.onAnimationGroupLoopObservable=new g.d,this.onAnimationGroupEndObservable=new g.d,this.onAnimationGroupPauseObservable=new g.d,this.onAnimationGroupPlayObservable=new g.d,this.metadata=null,this._mask=null,this._animationLoopFlags=[],this._scene=f||h.d.LastCreatedScene,this._weight=j,this._playOrder=d,this.uniqueId=this._scene.getUniqueId(),this._scene.addAnimationGroup(this)}addTargetedAnimation(q,f){const j=new O;j.animation=q,j.target=f;const d=q.getKeys();return this._from>d[0].frame&&(this._from=d[0].frame),this._to<d[d.length-1].frame&&(this._to=d[d.length-1].frame),null!==this._enableBlending&&(q.enableBlending=this._enableBlending),null!==this._blendingSpeed&&(q.blendingSpeed=this._blendingSpeed),this._targetedAnimations.push(j),this._shouldStart=!0,j}removeTargetedAnimation(q){for(let f=this._targetedAnimations.length-1;f>-1;f--){this._targetedAnimations[f].animation===q&&this._targetedAnimations.splice(f,1)}}normalize(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null==q&&(q=this._from),null==f&&(f=this._to);for(let j=0;j<this._targetedAnimations.length;j++){const d=this._targetedAnimations[j].animation.getKeys(),g=d[0],h=d[d.length-1];if(g.frame>q){const f={frame:q,value:g.value,inTangent:g.inTangent,outTangent:g.outTangent,interpolation:g.interpolation};d.splice(0,0,f)}if(h.frame<f){const q={frame:f,value:h.value,inTangent:h.inTangent,outTangent:h.outTangent,interpolation:h.interpolation};d.push(q)}}return this._from=q,this._to=f,this}_processLoop(q,f,j){q.onAnimationLoop=()=>{this.onAnimationLoopObservable.notifyObservers(f),this._animationLoopFlags[j]||(this._animationLoopFlags[j]=!0,this._animationLoopCount++,this._animationLoopCount===this._numActiveAnimatables&&(this.onAnimationGroupLoopObservable.notifyObservers(this),this._animationLoopCount=0,this._animationLoopFlags.length=0))}}start(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,j=arguments.length>2?arguments[2]:void 0,d=arguments.length>3?arguments[3]:void 0,g=arguments.length>4?arguments[4]:void 0;if(this._isStarted||0===this._targetedAnimations.length)return this;this._loopAnimation=q,this._shouldStart=!1,this._animationLoopCount=0,this._animationLoopFlags.length=0;for(let h=0;h<this._targetedAnimations.length;h++){const L=this._targetedAnimations[h],Q=this._scene.beginDirectAnimation(L.target,[L.animation],void 0!==j?j:this._from,void 0!==d?d:this._to,q,f,void 0,void 0,void 0!==g?g:this._isAdditive);Q.weight=this._weight,Q.playOrder=this._playOrder,Q.onAnimationEnd=()=>{this.onAnimationEndObservable.notifyObservers(L),this._checkAnimationGroupEnded(Q)},this._processLoop(Q,L,h),this._animatables.push(Q)}return this.syncWithMask(),this._scene.sortActiveAnimatables(),this._speedRatio=f,this._isStarted=!0,this._isPaused=!1,this.onAnimationGroupPlayObservable.notifyObservers(this),this}pause(){if(!this._isStarted)return this;this._isPaused=!0;for(let q=0;q<this._animatables.length;q++){this._animatables[q].pause()}return this.onAnimationGroupPauseObservable.notifyObservers(this),this}play(q){return this.isStarted&&this._animatables.length&&!this._shouldStart?(void 0!==q&&(this.loopAnimation=q),this.restart()):(this.stop(),this.start(q,this._speedRatio)),this}reset(){if(!this._isStarted)return this.play(),this.goToFrame(0),this.stop(!0),this;for(let q=0;q<this._animatables.length;q++){this._animatables[q].reset()}return this}restart(){if(!this._isStarted)return this;for(let q=0;q<this._animatables.length;q++){this._animatables[q].restart()}return this.syncWithMask(),this._isPaused=!1,this.onAnimationGroupPlayObservable.notifyObservers(this),this}stop(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this._isStarted)return this;const f=this._animatables.slice();for(let d=0;d<f.length;d++)f[d].stop(void 0,void 0,!0,q);let j=0;for(let d=0;d<this._scene._activeAnimatables.length;d++){const f=this._scene._activeAnimatables[d];f._runtimeAnimations.length>0?this._scene._activeAnimatables[j++]=f:q&&this._checkAnimationGroupEnded(f,q)}return this._scene._activeAnimatables.length=j,this._isStarted=!1,this}setWeightForAllAnimatables(q){for(let f=0;f<this._animatables.length;f++){this._animatables[f].weight=q}return this}syncAllAnimationsWith(q){for(let f=0;f<this._animatables.length;f++){this._animatables[f].syncWith(q)}return this}goToFrame(q){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._isStarted)return this;for(let j=0;j<this._animatables.length;j++){this._animatables[j].goToFrame(q,f)}return this}getCurrentFrame(){var q;return(null===(q=this.animatables[0])||void 0===q?void 0:q.masterFrame)||0}dispose(){this.isStarted&&this.stop(),this._targetedAnimations.length=0,this._animatables.length=0;const q=this._scene.animationGroups.indexOf(this);if(q>-1&&this._scene.animationGroups.splice(q,1),this._parentContainer){const q=this._parentContainer.animationGroups.indexOf(this);q>-1&&this._parentContainer.animationGroups.splice(q,1),this._parentContainer=null}this.onAnimationEndObservable.clear(),this.onAnimationGroupEndObservable.clear(),this.onAnimationGroupPauseObservable.clear(),this.onAnimationGroupPlayObservable.clear(),this.onAnimationLoopObservable.clear(),this.onAnimationGroupLoopObservable.clear()}_checkAnimationGroupEnded(q){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const j=this._animatables.indexOf(q);j>-1&&this._animatables.splice(j,1),this._animatables.length===this._targetedAnimations.length-this._numActiveAnimatables&&(this._isStarted=!1,f||this.onAnimationGroupEndObservable.notifyObservers(this),this._animatables.length=0)}clone(q,f){let j=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const d=new N(q||this.name,this._scene,this._weight,this._playOrder);d._from=this.from,d._to=this.to,d._speedRatio=this.speedRatio,d._loopAnimation=this.loopAnimation,d._isAdditive=this.isAdditive,d._enableBlending=this.enableBlending,d._blendingSpeed=this.blendingSpeed,d.metadata=this.metadata,d.mask=this.mask;for(const g of this._targetedAnimations)d.addTargetedAnimation(j?g.animation.clone():g.animation,f?f(g.target):g.target);return d}serialize(){const q={};q.name=this.name,q.from=this.from,q.to=this.to,q.speedRatio=this.speedRatio,q.loopAnimation=this.loopAnimation,q.isAdditive=this.isAdditive,q.weight=this.weight,q.playOrder=this.playOrder,q.enableBlending=this.enableBlending,q.blendingSpeed=this.blendingSpeed,q.targetedAnimations=[];for(let f=0;f<this.targetedAnimations.length;f++){const j=this.targetedAnimations[f];q.targetedAnimations[f]=j.serialize()}return L.c&&L.c.HasTags(this)&&(q.tags=L.c.GetTags(this)),this.metadata&&(q.metadata=this.metadata),q}static Parse(q,f){const j=new N(q.name,f,q.weight,q.playOrder);for(let g=0;g<q.targetedAnimations.length;g++){const h=q.targetedAnimations[g],L=d.e.Parse(h.animation),Q=h.targetId;if("influence"===h.animation.property){const q=f.getMorphTargetById(Q);q&&j.addTargetedAnimation(L,q)}else{const q=f.getNodeById(Q);null!=q&&j.addTargetedAnimation(L,q)}}return L.c&&L.c.AddTagsTo(j,q.tags),null!==q.from&&null!==q.to&&j.normalize(q.from,q.to),void 0!==q.speedRatio&&(j._speedRatio=q.speedRatio),void 0!==q.loopAnimation&&(j._loopAnimation=q.loopAnimation),void 0!==q.isAdditive&&(j._isAdditive=q.isAdditive),void 0!==q.weight&&(j._weight=q.weight),void 0!==q.playOrder&&(j._playOrder=q.playOrder),void 0!==q.enableBlending&&(j._enableBlending=q.enableBlending),void 0!==q.blendingSpeed&&(j._blendingSpeed=q.blendingSpeed),void 0!==q.metadata&&(j.metadata=q.metadata),j}static MakeAnimationAdditive(q,f,j){let g;g="object"===typeof f?f:{referenceFrame:f,range:j,cloneOriginalAnimationGroup:arguments.length>3&&void 0!==arguments[3]&&arguments[3],clonedAnimationName:arguments.length>4?arguments[4]:void 0};let h=q;g.cloneOriginalAnimationGroup&&(h=q.clone(g.clonedAnimationGroupName||h.name));const L=h.targetedAnimations;for(let Q=0;Q<L.length;Q++){const q=L[Q];q.animation=d.e.MakeAnimationAdditive(q.animation,g)}if(h.isAdditive=!0,g.clipKeys){let q=Number.MAX_VALUE,f=-Number.MAX_VALUE;const j=h.targetedAnimations;for(let d=0;d<j.length;d++){const g=j[d].animation.getKeys();q>g[0].frame&&(q=g[0].frame),f<g[g.length-1].frame&&(f=g[g.length-1].frame)}h._from=q,h._to=f}return h}static ClipKeys(q,f,j,d,g){const h=q.clone(d||q.name);return N.ClipKeysInPlace(h,f,j,g)}static ClipKeysInPlace(q,f,j,d){return N.ClipInPlace(q,f,j,d,!1)}static ClipFrames(q,f,j,d,g){const h=q.clone(d||q.name);return N.ClipFramesInPlace(h,f,j,g)}static ClipFramesInPlace(q,f,j,d){return N.ClipInPlace(q,f,j,d,!0)}static ClipInPlace(q,f,j,d){let g=arguments.length>4&&void 0!==arguments[4]&&arguments[4],h=Number.MAX_VALUE,L=-Number.MAX_VALUE;const Q=q.targetedAnimations;for(let H=0;H<Q.length;H++){const q=Q[H],r=d?q.animation:q.animation.clone();g&&(r.createKeyForFrame(f),r.createKeyForFrame(j));const u=r.getKeys(),X=[];let z=Number.MAX_VALUE;for(let d=0;d<u.length;d++){const q=u[d];if(!g&&d>=f&&d<=j||g&&q.frame>=f&&q.frame<=j){const f={frame:q.frame,value:q.value.clone?q.value.clone():q.value,inTangent:q.inTangent,outTangent:q.outTangent,interpolation:q.interpolation,lockedTangent:q.lockedTangent};z===Number.MAX_VALUE&&(z=f.frame),f.frame-=z,X.push(f)}}0!==X.length?(h>X[0].frame&&(h=X[0].frame),L<X[X.length-1].frame&&(L=X[X.length-1].frame),r.setKeys(X,!0),q.animation=r):(Q.splice(H,1),H--)}return q._from=h,q._to=L,q}getClassName(){return"AnimationGroup"}toString(q){let f="Name: "+this.name;return f+=", type: "+this.getClassName(),q&&(f+=", from: "+this._from,f+=", to: "+this._to,f+=", isStarted: "+this._isStarted,f+=", speedRatio: "+this._speedRatio,f+=", targetedAnimations length: "+this._targetedAnimations.length,f+=", animatables length: "+this._animatables),f}}}}]);