"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[58],{14348:(w,p,e)=>{e.r(p),e.d(p,{AnimationGroup:()=>O,TargetedAnimation:()=>s});var r=e(11713),I=e(11056),d=e(11051),f=e(11304),q=e(12794),E=e(11023);class j{get currentFrame(){return this._currentFrame}get weight(){return this._weight}get currentValue(){return this._currentValue}get targetPath(){return this._targetPath}get target(){return this._currentActiveTarget}get isAdditive(){return this._host&&this._host.isAdditive}constructor(w,p,e,I){if(this._events=new Array,this._currentFrame=0,this._originalValue=new Array,this._originalBlendValue=null,this._offsetsCache={},this._highLimitsCache={},this._stopped=!1,this._blendingFactor=0,this._currentValue=null,this._currentActiveTarget=null,this._directTarget=null,this._targetPath="",this._weight=1,this._absoluteFrameOffset=0,this._previousElapsedTime=0,this._yoyoDirection=1,this._previousAbsoluteFrame=0,this._targetIsArray=!1,this._coreRuntimeAnimation=null,this._animation=p,this._target=w,this._scene=e,this._host=I,this._activeTargets=[],p._runtimeAnimations.push(this),this._animationState={key:0,repeatCount:0,loopMode:this._getCorrectLoopMode()},this._animation.dataType===r.c.ANIMATIONTYPE_MATRIX&&(this._animationState.workValue=E.b.Zero()),this._keys=this._animation.getKeys(),this._minFrame=this._keys[0].frame,this._maxFrame=this._keys[this._keys.length-1].frame,this._minValue=this._keys[0].value,this._maxValue=this._keys[this._keys.length-1].value,0!==this._minFrame){const w={frame:0,value:this._minValue};this._keys.splice(0,0,w)}if(this._target instanceof Array){let w=0;for(const p of this._target)this._preparePath(p,w),this._getOriginalValues(w),w++;this._targetIsArray=!0}else this._preparePath(this._target),this._getOriginalValues(),this._targetIsArray=!1,this._directTarget=this._activeTargets[0];const d=p.getEvents();if(d&&d.length>0)for(const r of d)this._events.push(r._clone());this._enableBlending=w&&w.animationPropertiesOverride?w.animationPropertiesOverride.enableBlending:this._animation.enableBlending}_preparePath(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const e=this._animation.targetPropertyPath;if(e.length>1){let r=w;for(let w=0;w<e.length-1;w++){const p=e[w];if(r=r[p],void 0===r)throw new Error(`Invalid property (${p}) in property path (${e.join(".")})`)}this._targetPath=e[e.length-1],this._activeTargets[p]=r}else this._targetPath=e[0],this._activeTargets[p]=w;if(void 0===this._activeTargets[p][this._targetPath])throw new Error(`Invalid property (${this._targetPath}) in property path (${e.join(".")})`)}get animation(){return this._animation}reset(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])if(this._target instanceof Array){let w=0;for(const p of this._target)void 0!==this._originalValue[w]&&this._setValue(p,this._activeTargets[w],this._originalValue[w],-1,w),w++}else void 0!==this._originalValue[0]&&this._setValue(this._target,this._directTarget,this._originalValue[0],-1,0);this._offsetsCache={},this._highLimitsCache={},this._currentFrame=0,this._blendingFactor=0;for(let w=0;w<this._events.length;w++)this._events[w].isDone=!1}isStopped(){return this._stopped}dispose(){const w=this._animation.runtimeAnimations.indexOf(this);w>-1&&this._animation.runtimeAnimations.splice(w,1)}setValue(w,p){if(this._targetIsArray)for(let e=0;e<this._target.length;e++){const r=this._target[e];this._setValue(r,this._activeTargets[e],w,p,e)}else this._setValue(this._target,this._directTarget,w,p,0)}_getOriginalValues(){let w,p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const e=this._activeTargets[p];w=e.getLocalMatrix&&"_matrix"===this._targetPath?e.getLocalMatrix():e[this._targetPath],w&&w.clone?this._originalValue[p]=w.clone():this._originalValue[p]=w}_registerTargetForLateAnimationBinding(w,p){const e=w.target;this._scene._registeredForLateAnimationBindings.pushNoDuplicate(e),e._lateAnimationHolders||(e._lateAnimationHolders={}),e._lateAnimationHolders[w.targetPath]||(e._lateAnimationHolders[w.targetPath]={totalWeight:0,totalAdditiveWeight:0,animations:[],additiveAnimations:[],originalValue:p}),w.isAdditive?(e._lateAnimationHolders[w.targetPath].additiveAnimations.push(w),e._lateAnimationHolders[w.targetPath].totalAdditiveWeight+=w.weight):(e._lateAnimationHolders[w.targetPath].animations.push(w),e._lateAnimationHolders[w.targetPath].totalWeight+=w.weight)}_setValue(w,p,e,I,d){if(this._currentActiveTarget=p,this._weight=I,this._enableBlending&&this._blendingFactor<=1){if(!this._originalBlendValue){const w=p[this._targetPath];w.clone?this._originalBlendValue=w.clone():this._originalBlendValue=w}this._originalBlendValue.m?r.c.AllowMatrixDecomposeForInterpolation?this._currentValue?E.b.DecomposeLerpToRef(this._originalBlendValue,e,this._blendingFactor,this._currentValue):this._currentValue=E.b.DecomposeLerp(this._originalBlendValue,e,this._blendingFactor):this._currentValue?E.b.LerpToRef(this._originalBlendValue,e,this._blendingFactor,this._currentValue):this._currentValue=E.b.Lerp(this._originalBlendValue,e,this._blendingFactor):this._currentValue=r.c._UniversalLerp(this._originalBlendValue,e,this._blendingFactor);const I=w&&w.animationPropertiesOverride?w.animationPropertiesOverride.blendingSpeed:this._animation.blendingSpeed;this._blendingFactor+=I}else this._currentValue?this._currentValue.X?this._currentValue.X(e):this._currentValue=e:null!==e&&void 0!==e&&e.clone?this._currentValue=e.clone():this._currentValue=e;-1!==I?this._registerTargetForLateAnimationBinding(this,this._originalValue[d]):this._animationState.loopMode===r.c.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT?this._currentValue.addToRef?this._currentValue.addToRef(this._originalValue[d],p[this._targetPath]):p[this._targetPath]=this._originalValue[d]+this._currentValue:p[this._targetPath]=this._currentValue,w.kX&&w.kX(this._animation.targetProperty)}_getCorrectLoopMode(){return this._target&&this._target.animationPropertiesOverride?this._target.animationPropertiesOverride.loopMode:this._animation.loopMode}goToFrame(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;const e=this._animation.getKeys();w<e[0].frame?w=e[0].frame:w>e[e.length-1].frame&&(w=e[e.length-1].frame);const r=this._events;if(r.length)for(let d=0;d<r.length;d++)r[d].onlyOnce||(r[d].isDone=r[d].frame<w);this._currentFrame=w;const I=this._animation._interpolate(w,this._animationState);this.setValue(I,p)}_prepareForSpeedRatioChange(w){const p=this._previousElapsedTime*(this._animation.framePerSecond*w)/1e3;this._absoluteFrameOffset=this._previousAbsoluteFrame-p}animate(w,p,e,I,d){let f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:-1;const q=this._animation,E=q.targetPropertyPath;if(!E||E.length<1)return this._stopped=!0,!1;let j,X=!0;const k=this._events;let m=0;if(this._coreRuntimeAnimation)m=e-p,j=this._coreRuntimeAnimation.currentFrame,this._currentFrame=j,this._animationState.repeatCount=this._coreRuntimeAnimation._animationState.repeatCount,this._animationState.highLimitValue=this._coreRuntimeAnimation._animationState.highLimitValue,this._animationState.offsetValue=this._coreRuntimeAnimation._animationState.offsetValue;else{let f;(p<this._minFrame||p>this._maxFrame)&&(p=this._minFrame),(e<this._minFrame||e>this._maxFrame)&&(e=this._maxFrame),m=e-p;let E=w*(q.framePerSecond*d)/1e3+this._absoluteFrameOffset,J=0,K=!1;const y=I&&this._animationState.loopMode===r.c.ANIMATIONLOOPMODE_YOYO;if(y){const w=(E-p)/m,e=Math.sin(w*Math.PI);E=Math.abs(e)*m+p;const r=e>=0?1:-1;this._yoyoDirection!==r&&(K=!0),this._yoyoDirection=r}if(this._previousElapsedTime=w,this._previousAbsoluteFrame=E,!I&&e>=p&&(E>=m&&d>0||E<=0&&d<0))X=!1,J=q._getKeyValue(this._maxValue);else if(!I&&p>=e&&(E<=m&&d<0||E>=0&&d>0))X=!1,J=q._getKeyValue(this._minValue);else if(this._animationState.loopMode!==r.c.ANIMATIONLOOPMODE_CYCLE){const w=e.toString()+p.toString();if(!this._offsetsCache[w]){this._animationState.repeatCount=0,this._animationState.loopMode=r.c.ANIMATIONLOOPMODE_CYCLE;const I=q._interpolate(p,this._animationState),d=q._interpolate(e,this._animationState);switch(this._animationState.loopMode=this._getCorrectLoopMode(),q.dataType){case r.c.ANIMATIONTYPE_FLOAT:this._offsetsCache[w]=d-I;break;case r.c.ANIMATIONTYPE_QUATERNION:case r.c.ANIMATIONTYPE_VECTOR3:case r.c.ANIMATIONTYPE_VECTOR2:case r.c.ANIMATIONTYPE_SIZE:case r.c.ANIMATIONTYPE_COLOR3:this._offsetsCache[w]=d.Je(I)}this._highLimitsCache[w]=d}J=this._highLimitsCache[w],f=this._offsetsCache[w]}if(void 0===f)switch(q.dataType){case r.c.ANIMATIONTYPE_FLOAT:f=0;break;case r.c.ANIMATIONTYPE_QUATERNION:f=r.k;break;case r.c.ANIMATIONTYPE_VECTOR3:f=r.r;break;case r.c.ANIMATIONTYPE_VECTOR2:f=r.n;break;case r.c.ANIMATIONTYPE_SIZE:f=r.l;break;case r.c.ANIMATIONTYPE_COLOR3:f=r.e;break;case r.c.ANIMATIONTYPE_COLOR4:f=r.i}if(this._host&&this._host.syncRoot){const w=this._host.syncRoot;j=p+m*((w.masterFrame-w.fromFrame)/(w.toFrame-w.fromFrame))}else j=E>0&&p>e||E<0&&p<e?X&&0!==m?e+E%m:p:X&&0!==m?p+E%m:e;if(!y&&(d>0&&this.currentFrame>j||d<0&&this.currentFrame<j)||y&&K){this._onLoop();for(let w=0;w<k.length;w++)k[w].onlyOnce||(k[w].isDone=!1);this._animationState.key=d>0?0:q.getKeys().length-1}this._currentFrame=j,this._animationState.repeatCount=0===m?0:E/m|0,this._animationState.highLimitValue=J,this._animationState.offsetValue=f}const J=q._interpolate(j,this._animationState);if(this.setValue(J,f),k.length)for(let r=0;r<k.length;r++)if(m>=0&&j>=k[r].frame&&k[r].frame>=p||m<0&&j<=k[r].frame&&k[r].frame<=p){const w=k[r];w.isDone||(w.onlyOnce&&(k.splice(r,1),r--),w.isDone=!0,w.action(j))}return X||(this._stopped=!0),X}}var X=e(11088);class k{get syncRoot(){return this._syncRoot}get masterFrame(){return 0===this._runtimeAnimations.length?0:this._runtimeAnimations[0].currentFrame}get weight(){return this._weight}set weight(w){this._weight=-1!==w?Math.min(Math.max(w,0),1):-1}get speedRatio(){return this._speedRatio}set speedRatio(w){for(let p=0;p<this._runtimeAnimations.length;p++){this._runtimeAnimations[p]._prepareForSpeedRatioChange(w)}this._speedRatio=w,null!==this._goToFrame&&this.goToFrame(this._goToFrame)}get elapsedTime(){return null===this._localDelayOffset?0:this._scene._animationTime-this._localDelayOffset}constructor(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,d=arguments.length>4&&void 0!==arguments[4]&&arguments[4],f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,q=arguments.length>6?arguments[6]:void 0,E=arguments.length>7?arguments[7]:void 0,j=arguments.length>8?arguments[8]:void 0,X=arguments.length>9&&void 0!==arguments[9]&&arguments[9],k=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0;this.target=p,this.fromFrame=e,this.toFrame=r,this.loopAnimation=d,this.onAnimationEnd=q,this.onAnimationLoop=j,this.isAdditive=X,this.playOrder=k,this._localDelayOffset=null,this._pausedDelay=null,this._manualJumpDelay=null,this._runtimeAnimations=new Array,this.qE=!1,this._speedRatio=1,this._weight=-1,this._previousWeight=-1,this._syncRoot=null,this._frameToSyncFromJump=null,this._goToFrame=null,this.disposeOnEnd=!0,this.animationStarted=!1,this.onAnimationEndObservable=new I.d,this.onAnimationLoopObservable=new I.d,this._scene=w,E&&this.appendAnimations(p,E),this._speedRatio=f,w._activeAnimatables.push(this)}syncWith(w){if(this._syncRoot=w,w){const w=this._scene._activeAnimatables.indexOf(this);w>-1&&(this._scene._activeAnimatables.splice(w,1),this._scene._activeAnimatables.push(this))}return this}getAnimations(){return this._runtimeAnimations}appendAnimations(w,p){for(let e=0;e<p.length;e++){const r=p[e],I=new j(w,r,this._scene,this);I._onLoop=()=>{this.onAnimationLoopObservable.notifyObservers(this),this.onAnimationLoop&&this.onAnimationLoop()},this._runtimeAnimations.push(I)}}getAnimationByTargetProperty(w){const p=this._runtimeAnimations;for(let e=0;e<p.length;e++)if(p[e].animation.targetProperty===w)return p[e].animation;return null}getRuntimeAnimationByTargetProperty(w){const p=this._runtimeAnimations;for(let e=0;e<p.length;e++)if(p[e].animation.targetProperty===w)return p[e];return null}reset(){const w=this._runtimeAnimations;for(let p=0;p<w.length;p++)w[p].reset(!0);this._localDelayOffset=null,this._pausedDelay=null}enableBlending(w){const p=this._runtimeAnimations;for(let e=0;e<p.length;e++)p[e].animation.enableBlending=!0,p[e].animation.blendingSpeed=w}disableBlending(){const w=this._runtimeAnimations;for(let p=0;p<w.length;p++)w[p].animation.enableBlending=!1}goToFrame(w){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const e=this._runtimeAnimations;if(e[0]){const p=e[0].animation.framePerSecond;this._frameToSyncFromJump=this._frameToSyncFromJump??e[0].currentFrame;const r=0===this.speedRatio?0:(w-this._frameToSyncFromJump)/p*1e3/this.speedRatio;this._manualJumpDelay=-r}for(let r=0;r<e.length;r++)e[r].goToFrame(w,p?this._weight:-1);this._goToFrame=w}get paused(){return this.qE}pause(){this.qE||(this.qE=!0)}restart(){this.qE=!1}_raiseOnAnimationEnd(){this.onAnimationEnd&&this.onAnimationEnd(),this.onAnimationEndObservable.notifyObservers(this)}stop(w,p){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(w||p){const I=this._scene._activeAnimatables.indexOf(this);if(I>-1){const d=this._runtimeAnimations;for(let e=d.length-1;e>=0;e--){const r=d[e];w&&r.animation.name!=w||(p&&!p(r.target)||(r.dispose(),d.splice(e,1)))}0==d.length&&(e||this._scene._activeAnimatables.splice(I,1),r||this._raiseOnAnimationEnd())}}else{const w=this._scene._activeAnimatables.indexOf(this);if(w>-1){e||this._scene._activeAnimatables.splice(w,1);const p=this._runtimeAnimations;for(let w=0;w<p.length;w++)p[w].dispose();this._runtimeAnimations.length=0,r||this._raiseOnAnimationEnd()}}}async waitAsync(){return await new Promise((w=>{this.onAnimationEndObservable.add((()=>{w(this)}),void 0,void 0,this,!0)}))}_animate(w){if(this.qE)return this.animationStarted=!1,null===this._pausedDelay&&(this._pausedDelay=w),!0;if(null===this._localDelayOffset?(this._localDelayOffset=w,this._pausedDelay=null):null!==this._pausedDelay&&(this._localDelayOffset+=w-this._pausedDelay,this._pausedDelay=null),null!==this._manualJumpDelay&&(this._localDelayOffset+=this.speedRatio<0?-this._manualJumpDelay:this._manualJumpDelay,this._manualJumpDelay=null,this._frameToSyncFromJump=null),this._goToFrame=null,0===this._weight&&0===this._previousWeight)return!0;this._previousWeight=this._weight;let p=!1;const e=this._runtimeAnimations;let r;for(r=0;r<e.length;r++){const I=e[r].animate(w-this._localDelayOffset,this.fromFrame,this.toFrame,this.loopAnimation,this._speedRatio,this._weight);p=p||I}if(this.animationStarted=p,!p){if(this.disposeOnEnd)for(r=this._scene._activeAnimatables.indexOf(this),this._scene._activeAnimatables.splice(r,1),r=0;r<e.length;r++)e[r].dispose();this._raiseOnAnimationEnd(),this.disposeOnEnd&&(this.onAnimationEnd=null,this.onAnimationLoop=null,this.onAnimationLoopObservable.clear(),this.onAnimationEndObservable.clear())}return p}}function m(w){if(0===w.totalWeight&&0===w.totalAdditiveWeight)return w.originalValue;let p=1;const e=E.d.ne[0],r=E.d.ne[1],I=E.d.Quaternion[0];let d=0;const f=w.animations[0],q=w.originalValue;let j=1,X=!1;if(w.totalWeight<1)j=1-w.totalWeight,q.decompose(r,I,e);else{if(d=1,p=w.totalWeight,j=f.weight/p,1==j){if(!w.totalAdditiveWeight)return f.currentValue;X=!0}f.currentValue.decompose(r,I,e)}if(!X){r.scaleInPlace(j),e.scaleInPlace(j),I.scaleInPlace(j);for(let f=d;f<w.animations.length;f++){const d=w.animations[f];if(0===d.weight)continue;j=d.weight/p;const q=E.d.ne[2],X=E.d.ne[3],k=E.d.Quaternion[1];d.currentValue.decompose(X,k,q),X.scaleAndAddToRef(j,r),k.scaleAndAddToRef(E.c.Dot(I,k)>0?j:-j,I),q.scaleAndAddToRef(j,e)}I.normalize()}for(let m=0;m<w.additiveAnimations.length;m++){const p=w.additiveAnimations[m];if(0===p.weight)continue;const d=E.d.ne[2],f=E.d.ne[3],q=E.d.Quaternion[1];p.currentValue.decompose(f,q,d),f.multiplyToRef(r,f),E.k.LerpToRef(r,f,p.weight,r),I.multiplyToRef(q,q),E.c.SlerpToRef(I,q,p.weight,I),d.scaleAndAddToRef(p.weight,e)}const k=f?f._animationState.workValue:E.d.Matrix[0].clone();return E.b.ComposeToRef(r,I,e,k),k}function J(w,p){if(0===w.totalWeight&&0===w.totalAdditiveWeight)return p;const e=w.animations[0],r=w.originalValue;let I=p;if(0===w.totalWeight&&w.totalAdditiveWeight>0)I.X(r);else if(1===w.animations.length){if(E.c.SlerpToRef(r,e.currentValue,Math.min(1,w.totalWeight),I),0===w.totalAdditiveWeight)return I}else if(w.animations.length>1){let e,d,f=1;if(w.totalWeight<1){const p=1-w.totalWeight;e=[],d=[],e.push(r),d.push(p)}else{if(2===w.animations.length&&(E.c.SlerpToRef(w.animations[0].currentValue,w.animations[1].currentValue,w.animations[1].weight/w.totalWeight,p),0===w.totalAdditiveWeight))return p;e=[],d=[],f=w.totalWeight}for(let p=0;p<w.animations.length;p++){const r=w.animations[p];e.push(r.currentValue),d.push(r.weight/f)}let q=0;for(let w=0;w<e.length;)w?(q+=d[w],E.c.SlerpToRef(I,e[w],d[w]/q,I),w++):(E.c.SlerpToRef(e[w],e[w+1],d[w+1]/(d[w]+d[w+1]),p),I=p,q=d[w]+d[w+1],w+=2)}for(let d=0;d<w.additiveAnimations.length;d++){const p=w.additiveAnimations[d];0!==p.weight&&(I.multiplyToRef(p.currentValue,E.d.Quaternion[0]),E.c.SlerpToRef(I,E.d.Quaternion[0],p.weight,I))}return I}var K,y,c=e(11590);K=c.c,(y=q.e)&&(y.prototype.copyAnimationRange=function(w,p,e){let I=arguments.length>3&&void 0!==arguments[3]&&arguments[3],d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;0===this.animations.length&&(this.animations.push(new r.c(this.name,"_matrix",w.animations[0].framePerSecond,r.c.ANIMATIONTYPE_MATRIX,0)),this.animations[0].setKeys([]));const f=w.animations[0].getRange(p);if(!f)return!1;const q=f.from,E=f.to,j=w.animations[0].getKeys(),X=w.length,k=w.getParent(),m=this.getParent(),J=I&&k&&X&&this.length&&X!==this.length,K=J&&m&&k?m.length/k.length:1,y=I&&!m&&d&&(1!==d.x||1!==d.y||1!==d.z),c=this.animations[0].getKeys();let s,O,a;for(let r=0,A=j.length;r<A;r++)s=j[r],s.frame>=q&&s.frame<=E&&(I?(a=s.value.clone(),J?(O=a.getTranslation(),a.setTranslation(O.scaleInPlace(K))):y&&d?(O=a.getTranslation(),a.setTranslation(O.multiplyInPlace(d))):a=s.value):a=s.value,c.push({frame:s.frame+e,value:a}));return this.animations[0].createRange(p,q+e,E+e),!0}),K&&(K.prototype._animate=function(w){if(!this.animationsEnabled)return;const p=X.b.Now;if(!this._animationTimeLast){if(this._pendingData.length>0)return;this._animationTimeLast=p}this.deltaTime=void 0!==w?w:this.useConstantAnimationDeltaTime?16:(p-this._animationTimeLast)*this.animationTimeScale,this._animationTimeLast=p;const e=this._activeAnimatables;if(0===e.length)return;this._animationTime+=this.deltaTime;const I=this._animationTime;for(let r=0;r<e.length;r++){const w=e[r];!w._animate(I)&&w.disposeOnEnd&&r--}!function(w){if(w._registeredForLateAnimationBindings.length){for(let p=0;p<w._registeredForLateAnimationBindings.length;p++){const e=w._registeredForLateAnimationBindings.data[p];for(const w in e._lateAnimationHolders){const p=e._lateAnimationHolders[w],I=p.animations[0],d=p.originalValue;if(void 0===d||null===d)continue;const f=r.c.AllowMatrixDecomposeForInterpolation&&d.m;let q=e[w];if(f)q=m(p);else if(void 0!==d.w)q=J(p,q||E.c.Identity());else{let w=0,e=1;const f=I&&I._animationState.loopMode===r.c.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT;if(p.totalWeight<1)q=f?d.clone?d.clone():d:I&&d.scale?d.scale(1-p.totalWeight):I?d*(1-p.totalWeight):d.clone?d.clone():d;else if(I){e=p.totalWeight;const r=I.weight/e;q=1!==r?I.currentValue.scale?I.currentValue.scale(r):I.currentValue*r:I.currentValue,f&&(q.addToRef?q.addToRef(d,q):q+=d),w=1}for(let r=w;r<p.animations.length;r++){const w=p.animations[r],I=w.weight/e;I&&(w.currentValue.scaleAndAddToRef?w.currentValue.scaleAndAddToRef(I,q):q+=w.currentValue*I)}for(let r=0;r<p.additiveAnimations.length;r++){const w=p.additiveAnimations[r],e=w.weight;e&&(w.currentValue.scaleAndAddToRef?w.currentValue.scaleAndAddToRef(e,q):q+=w.currentValue*e)}}e[w]=q}e._lateAnimationHolders={}}w._registeredForLateAnimationBindings.reset()}}(this)},K.prototype.sortActiveAnimatables=function(){this._activeAnimatables.sort(((w,p)=>w.playOrder-p.playOrder))},K.prototype.beginWeightedAnimation=function(w,p,e){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,I=arguments.length>4?arguments[4]:void 0,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,f=arguments.length>6?arguments[6]:void 0,q=arguments.length>7?arguments[7]:void 0,E=arguments.length>8?arguments[8]:void 0,j=arguments.length>9?arguments[9]:void 0,X=arguments.length>10&&void 0!==arguments[10]&&arguments[10];const k=this.beginAnimation(w,p,e,I,d,f,q,!1,E,j,X);return k.weight=r,k},K.prototype.beginAnimation=function(w,p,e,r){let I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,d=arguments.length>5?arguments[5]:void 0,f=arguments.length>6?arguments[6]:void 0,q=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],E=arguments.length>8?arguments[8]:void 0,j=arguments.length>9?arguments[9]:void 0,X=arguments.length>10&&void 0!==arguments[10]&&arguments[10];if(I<0){const w=p;p=e,e=w,I=-I}p>e&&(I=-I),q&&this.stopAnimation(w,void 0,E),f||(f=new k(this,w,p,e,r,I,d,void 0,j,X));const m=!E||E(w);if(w.animations&&m&&f.appendAnimations(w,w.animations),w.getAnimatables){const X=w.getAnimatables();for(let w=0;w<X.length;w++)this.beginAnimation(X[w],p,e,r,I,d,f,q,E,j)}return f.reset(),f},K.prototype.beginHierarchyAnimation=function(w,p,e,r,I){let d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,f=arguments.length>6?arguments[6]:void 0,q=arguments.length>7?arguments[7]:void 0,E=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],j=arguments.length>9?arguments[9]:void 0,X=arguments.length>11&&void 0!==arguments[11]&&arguments[11];const k=w.getDescendants(p),m=[];m.push(this.beginAnimation(w,e,r,I,d,f,q,E,j,void 0,X));for(const J of k)m.push(this.beginAnimation(J,e,r,I,d,f,q,E,j,void 0,X));return m},K.prototype.beginDirectAnimation=function(w,p,e,r,I){let d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;if(d<0){const w=e;e=r,r=w,d=-d}return e>r&&(d=-d),new k(this,w,e,r,I,d,arguments.length>6?arguments[6]:void 0,p,arguments.length>7?arguments[7]:void 0,arguments.length>8&&void 0!==arguments[8]&&arguments[8])},K.prototype.beginDirectHierarchyAnimation=function(w,p,e,r,I,d,f,q,E){let j=arguments.length>9&&void 0!==arguments[9]&&arguments[9];const X=w.getDescendants(p),k=[];k.push(this.beginDirectAnimation(w,e,r,I,d,f,q,E,j));for(const m of X)k.push(this.beginDirectAnimation(m,e,r,I,d,f,q,E,j));return k},K.prototype.getAnimatableByTarget=function(w){for(let p=0;p<this._activeAnimatables.length;p++)if(this._activeAnimatables[p].target===w)return this._activeAnimatables[p];return null},K.prototype.getAllAnimatablesByTarget=function(w){const p=[];for(let e=0;e<this._activeAnimatables.length;e++)this._activeAnimatables[e].target===w&&p.push(this._activeAnimatables[e]);return p},K.prototype.stopAnimation=function(w,p,e){const r=this.getAllAnimatablesByTarget(w);for(const I of r)I.stop(p,e)},K.prototype.stopAllAnimations=function(){if(this._activeAnimatables){for(let w=0;w<this._activeAnimatables.length;w++)this._activeAnimatables[w].stop(void 0,void 0,!0);this._activeAnimatables.length=0}for(const w of this.animationGroups)w.stop()});class s{getClassName(){return"TargetedAnimation"}serialize(){const w={};return w.animation=this.animation.serialize(),w.targetId=this.target.id,w}}class O{get mask(){return this._mask}set mask(w){this._mask!==w&&(this._mask=w,this.syncWithMask(!0))}syncWithMask(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.mask||w){this._numActiveAnimatables=0;for(let w=0;w<this._animatables.length;++w){const p=this._animatables[w];!this.mask||this.mask.disabled||this.mask.retainsTarget(p.target.name)?(this._numActiveAnimatables++,p.paused&&p.restart()):p.paused||p.pause()}}else this._numActiveAnimatables=this._targetedAnimations.length}removeUnmaskedAnimations(){if(this.mask&&!this.mask.disabled){for(let w=0;w<this._animatables.length;++w){const p=this._animatables[w];this.mask.retainsTarget(p.target.name)||(p.stop(),this._animatables.splice(w,1),--w)}for(let w=0;w<this._targetedAnimations.length;w++){const p=this._targetedAnimations[w];this.mask.retainsTarget(p.target.name)||(this._targetedAnimations.splice(w,1),--w)}}}get from(){return this._from}set from(w){if(this._from!==w){this._from=w;for(let w=0;w<this._animatables.length;w++){this._animatables[w].fromFrame=this._from}}}get to(){return this._to}set to(w){if(this._to!==w){this._to=w;for(let w=0;w<this._animatables.length;w++){this._animatables[w].toFrame=this._to}}}get isStarted(){return this._isStarted}get isPlaying(){return this._isStarted&&!this._isPaused}get speedRatio(){return this._speedRatio}set speedRatio(w){if(this._speedRatio!==w){this._speedRatio=w;for(let w=0;w<this._animatables.length;w++){this._animatables[w].speedRatio=this._speedRatio}}}get loopAnimation(){return this._loopAnimation}set loopAnimation(w){if(this._loopAnimation!==w){this._loopAnimation=w;for(let w=0;w<this._animatables.length;w++){this._animatables[w].loopAnimation=this._loopAnimation}}}get isAdditive(){return this._isAdditive}set isAdditive(w){if(this._isAdditive!==w){this._isAdditive=w;for(let w=0;w<this._animatables.length;w++){this._animatables[w].isAdditive=this._isAdditive}}}get weight(){return this._weight}set weight(w){this._weight!==w&&(this._weight=w,this.setWeightForAllAnimatables(this._weight))}get targetedAnimations(){return this._targetedAnimations}get animatables(){return this._animatables}get children(){return this._targetedAnimations}get playOrder(){return this._playOrder}set playOrder(w){if(this._playOrder!==w&&(this._playOrder=w,this._animatables.length>0)){for(let w=0;w<this._animatables.length;w++)this._animatables[w].playOrder=this._playOrder;this._scene.sortActiveAnimatables()}}get enableBlending(){return this._enableBlending}set enableBlending(w){if(this._enableBlending!==w&&(this._enableBlending=w,null!==w))for(let p=0;p<this._targetedAnimations.length;++p)this._targetedAnimations[p].animation.enableBlending=w}get blendingSpeed(){return this._blendingSpeed}set blendingSpeed(w){if(this._blendingSpeed!==w&&(this._blendingSpeed=w,null!==w))for(let p=0;p<this._targetedAnimations.length;++p)this._targetedAnimations[p].animation.blendingSpeed=w}getLength(w,p){w=w??this._from;return((p=p??this._to)-w)/(this.targetedAnimations[0].animation.framePerSecond*this._speedRatio)}static MergeAnimationGroups(w){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0;if(0===w.length)return null;r=r??w[0].weight;let I=Number.MAX_VALUE,d=-Number.MAX_VALUE;if(e)for(const q of w)q.from<I&&(I=q.from),q.to>d&&(d=q.to);const f=new O(w[0].name+"_merged",w[0]._scene,r);for(const q of w){e&&q.normalize(I,d);for(const w of q.targetedAnimations)f.addTargetedAnimation(w.animation,w.target);p&&q.dispose()}return f}constructor(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.name=w,this._targetedAnimations=new Array,this._animatables=new Array,this._from=Number.MAX_VALUE,this._to=-Number.MAX_VALUE,this._speedRatio=1,this._loopAnimation=!1,this._isAdditive=!1,this._weight=-1,this._playOrder=0,this._enableBlending=null,this._blendingSpeed=null,this._numActiveAnimatables=0,this._shouldStart=!0,this._parentContainer=null,this.onAnimationEndObservable=new I.d,this.onAnimationLoopObservable=new I.d,this.onAnimationGroupLoopObservable=new I.d,this.onAnimationGroupEndObservable=new I.d,this.onAnimationGroupPauseObservable=new I.d,this.onAnimationGroupPlayObservable=new I.d,this.metadata=null,this._mask=null,this._animationLoopFlags=[],this._scene=p||d.d.LastCreatedScene,this._weight=e,this._playOrder=r,this.uniqueId=this._scene.getUniqueId(),this._scene.addAnimationGroup(this)}addTargetedAnimation(w,p){const e=new s;e.animation=w,e.target=p;const r=w.getKeys();return this._from>r[0].frame&&(this._from=r[0].frame),this._to<r[r.length-1].frame&&(this._to=r[r.length-1].frame),null!==this._enableBlending&&(w.enableBlending=this._enableBlending),null!==this._blendingSpeed&&(w.blendingSpeed=this._blendingSpeed),this._targetedAnimations.push(e),this._shouldStart=!0,e}removeTargetedAnimation(w){for(let p=this._targetedAnimations.length-1;p>-1;p--){this._targetedAnimations[p].animation===w&&this._targetedAnimations.splice(p,1)}}normalize(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null==w&&(w=this._from),null==p&&(p=this._to);for(let e=0;e<this._targetedAnimations.length;e++){const r=this._targetedAnimations[e].animation.getKeys(),I=r[0],d=r[r.length-1];if(I.frame>w){const p={frame:w,value:I.value,inTangent:I.inTangent,outTangent:I.outTangent,interpolation:I.interpolation};r.splice(0,0,p)}if(d.frame<p){const w={frame:p,value:d.value,inTangent:d.inTangent,outTangent:d.outTangent,interpolation:d.interpolation};r.push(w)}}return this._from=w,this._to=p,this}_processLoop(w,p,e){w.onAnimationLoop=()=>{this.onAnimationLoopObservable.notifyObservers(p),this._animationLoopFlags[e]||(this._animationLoopFlags[e]=!0,this._animationLoopCount++,this._animationLoopCount===this._numActiveAnimatables&&(this.onAnimationGroupLoopObservable.notifyObservers(this),this._animationLoopCount=0,this._animationLoopFlags.length=0))}}start(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0],p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,e=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,I=arguments.length>4?arguments[4]:void 0;if(this._isStarted||0===this._targetedAnimations.length)return this;this._loopAnimation=w,this._shouldStart=!1,this._animationLoopCount=0,this._animationLoopFlags.length=0;for(let d=0;d<this._targetedAnimations.length;d++){const f=this._targetedAnimations[d],q=this._scene.beginDirectAnimation(f.target,[f.animation],void 0!==e?e:this._from,void 0!==r?r:this._to,w,p,void 0,void 0,void 0!==I?I:this._isAdditive);q.weight=this._weight,q.playOrder=this._playOrder,q.onAnimationEnd=()=>{this.onAnimationEndObservable.notifyObservers(f),this._checkAnimationGroupEnded(q)},this._processLoop(q,f,d),this._animatables.push(q)}return this.syncWithMask(),this._scene.sortActiveAnimatables(),this._speedRatio=p,this._isStarted=!0,this._isPaused=!1,this.onAnimationGroupPlayObservable.notifyObservers(this),this}pause(){if(!this._isStarted)return this;this._isPaused=!0;for(let w=0;w<this._animatables.length;w++){this._animatables[w].pause()}return this.onAnimationGroupPauseObservable.notifyObservers(this),this}play(w){return this.isStarted&&this._animatables.length&&!this._shouldStart?(void 0!==w&&(this.loopAnimation=w),this.restart()):(this.stop(),this.start(w,this._speedRatio)),this}reset(){if(!this._isStarted)return this.play(),this.goToFrame(0),this.stop(!0),this;for(let w=0;w<this._animatables.length;w++){this._animatables[w].reset()}return this}restart(){if(!this._isStarted)return this;for(let w=0;w<this._animatables.length;w++){this._animatables[w].restart()}return this.syncWithMask(),this._isPaused=!1,this.onAnimationGroupPlayObservable.notifyObservers(this),this}stop(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this._isStarted)return this;const p=this._animatables.slice();for(let r=0;r<p.length;r++)p[r].stop(void 0,void 0,!0,w);let e=0;for(let r=0;r<this._scene._activeAnimatables.length;r++){const p=this._scene._activeAnimatables[r];p._runtimeAnimations.length>0?this._scene._activeAnimatables[e++]=p:w&&this._checkAnimationGroupEnded(p,w)}return this._scene._activeAnimatables.length=e,this._isStarted=!1,this}setWeightForAllAnimatables(w){for(let p=0;p<this._animatables.length;p++){this._animatables[p].weight=w}return this}syncAllAnimationsWith(w){for(let p=0;p<this._animatables.length;p++){this._animatables[p].syncWith(w)}return this}goToFrame(w){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._isStarted)return this;for(let e=0;e<this._animatables.length;e++){this._animatables[e].goToFrame(w,p)}return this}getCurrentFrame(){var w;return(null===(w=this.animatables[0])||void 0===w?void 0:w.masterFrame)||0}dispose(){this.isStarted&&this.stop(),this._targetedAnimations.length=0,this._animatables.length=0;const w=this._scene.animationGroups.indexOf(this);if(w>-1&&this._scene.animationGroups.splice(w,1),this._parentContainer){const w=this._parentContainer.animationGroups.indexOf(this);w>-1&&this._parentContainer.animationGroups.splice(w,1),this._parentContainer=null}this.onAnimationEndObservable.clear(),this.onAnimationGroupEndObservable.clear(),this.onAnimationGroupPauseObservable.clear(),this.onAnimationGroupPlayObservable.clear(),this.onAnimationLoopObservable.clear(),this.onAnimationGroupLoopObservable.clear()}_checkAnimationGroupEnded(w){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const e=this._animatables.indexOf(w);e>-1&&this._animatables.splice(e,1),this._animatables.length===this._targetedAnimations.length-this._numActiveAnimatables&&(this._isStarted=!1,p||this.onAnimationGroupEndObservable.notifyObservers(this),this._animatables.length=0)}clone(w,p){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=new O(w||this.name,this._scene,this._weight,this._playOrder);r._from=this.from,r._to=this.to,r._speedRatio=this.speedRatio,r._loopAnimation=this.loopAnimation,r._isAdditive=this.isAdditive,r._enableBlending=this.enableBlending,r._blendingSpeed=this.blendingSpeed,r.metadata=this.metadata,r.mask=this.mask;for(const I of this._targetedAnimations)r.addTargetedAnimation(e?I.animation.clone():I.animation,p?p(I.target):I.target);return r}serialize(){const w={};w.name=this.name,w.from=this.from,w.to=this.to,w.speedRatio=this.speedRatio,w.loopAnimation=this.loopAnimation,w.isAdditive=this.isAdditive,w.weight=this.weight,w.playOrder=this.playOrder,w.enableBlending=this.enableBlending,w.blendingSpeed=this.blendingSpeed,w.targetedAnimations=[];for(let p=0;p<this.targetedAnimations.length;p++){const e=this.targetedAnimations[p];w.targetedAnimations[p]=e.serialize()}return f.b&&f.b.HasTags(this)&&(w.tags=f.b.GetTags(this)),this.metadata&&(w.metadata=this.metadata),w}static Parse(w,p){const e=new O(w.name,p,w.weight,w.playOrder);for(let I=0;I<w.targetedAnimations.length;I++){const d=w.targetedAnimations[I],f=r.c.Parse(d.animation),q=d.targetId;if("influence"===d.animation.property){const w=p.getMorphTargetById(q);w&&e.addTargetedAnimation(f,w)}else{const w=p.getNodeById(q);null!=w&&e.addTargetedAnimation(f,w)}}return f.b&&f.b.AddTagsTo(e,w.tags),null!==w.from&&null!==w.to&&e.normalize(w.from,w.to),void 0!==w.speedRatio&&(e._speedRatio=w.speedRatio),void 0!==w.loopAnimation&&(e._loopAnimation=w.loopAnimation),void 0!==w.isAdditive&&(e._isAdditive=w.isAdditive),void 0!==w.weight&&(e._weight=w.weight),void 0!==w.playOrder&&(e._playOrder=w.playOrder),void 0!==w.enableBlending&&(e._enableBlending=w.enableBlending),void 0!==w.blendingSpeed&&(e._blendingSpeed=w.blendingSpeed),void 0!==w.metadata&&(e.metadata=w.metadata),e}static MakeAnimationAdditive(w,p,e){let I;I="object"===typeof p?p:{referenceFrame:p,range:e,cloneOriginalAnimationGroup:arguments.length>3&&void 0!==arguments[3]&&arguments[3],clonedAnimationName:arguments.length>4?arguments[4]:void 0};let d=w;I.cloneOriginalAnimationGroup&&(d=w.clone(I.clonedAnimationGroupName||d.name));const f=d.targetedAnimations;for(let q=0;q<f.length;q++){const w=f[q];w.animation=r.c.MakeAnimationAdditive(w.animation,I)}if(d.isAdditive=!0,I.clipKeys){let w=Number.MAX_VALUE,p=-Number.MAX_VALUE;const e=d.targetedAnimations;for(let r=0;r<e.length;r++){const I=e[r].animation.getKeys();w>I[0].frame&&(w=I[0].frame),p<I[I.length-1].frame&&(p=I[I.length-1].frame)}d._from=w,d._to=p}return d}static ClipKeys(w,p,e,r,I){const d=w.clone(r||w.name);return O.ClipKeysInPlace(d,p,e,I)}static ClipKeysInPlace(w,p,e,r){return O.ClipInPlace(w,p,e,r,!1)}static ClipFrames(w,p,e,r,I){const d=w.clone(r||w.name);return O.ClipFramesInPlace(d,p,e,I)}static ClipFramesInPlace(w,p,e,r){return O.ClipInPlace(w,p,e,r,!0)}static ClipInPlace(w,p,e,r){let I=arguments.length>4&&void 0!==arguments[4]&&arguments[4],d=Number.MAX_VALUE,f=-Number.MAX_VALUE;const q=w.targetedAnimations;for(let E=0;E<q.length;E++){const w=q[E],j=r?w.animation:w.animation.clone();I&&(j.createKeyForFrame(p),j.createKeyForFrame(e));const X=j.getKeys(),k=[];let m=Number.MAX_VALUE;for(let r=0;r<X.length;r++){const w=X[r];if(!I&&r>=p&&r<=e||I&&w.frame>=p&&w.frame<=e){const p={frame:w.frame,value:w.value.clone?w.value.clone():w.value,inTangent:w.inTangent,outTangent:w.outTangent,interpolation:w.interpolation,lockedTangent:w.lockedTangent};m===Number.MAX_VALUE&&(m=p.frame),p.frame-=m,k.push(p)}}0!==k.length?(d>k[0].frame&&(d=k[0].frame),f<k[k.length-1].frame&&(f=k[k.length-1].frame),j.setKeys(k,!0),w.animation=j):(q.splice(E,1),E--)}return w._from=d,w._to=f,w}getClassName(){return"AnimationGroup"}toString(w){let p="Name: "+this.name;return p+=", type: "+this.getClassName(),w&&(p+=", from: "+this._from,p+=", to: "+this._to,p+=", isStarted: "+this._isStarted,p+=", speedRatio: "+this._speedRatio,p+=", targetedAnimations length: "+this._targetedAnimations.length,p+=", animatables length: "+this._animatables),p}}}}]);