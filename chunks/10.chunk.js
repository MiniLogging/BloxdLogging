/*! For license information please see y2yh1e.10.853d25df.chunk.js.LICENSE.txt */
(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[10],{12729:(v,T,X)=>{"use strict";var O=X(12734),u=X(12743),B=X(12746);X.g.__TYPEDARRAY_POOL||(X.g.__TYPEDARRAY_POOL={UINT8:u([32,0]),UINT16:u([32,0]),UINT32:u([32,0]),INT8:u([32,0]),INT16:u([32,0]),INT32:u([32,0]),FLOAT:u([32,0]),DOUBLE:u([32,0]),DATA:u([32,0]),UINT8C:u([32,0]),BUFFER:u([32,0])});var m="undefined"!==typeof Uint8ClampedArray,A=X.g.__TYPEDARRAY_POOL;A.UINT8C||(A.UINT8C=u([32,0])),A.BUFFER||(A.BUFFER=u([32,0]));var x=A.DATA,f=A.BUFFER;function M(v){if(v){var T=v.length||v.byteLength,X=O.log2(T);x[X].push(v)}}function H(v){v=O.nextPow2(v);var T=O.log2(v),X=x[T];return X.length>0?X.pop():new ArrayBuffer(v)}function n(v){return new Uint8Array(H(v),0,v)}function V(v){return new Uint16Array(H(2*v),0,v)}function D(v){return new Uint32Array(H(4*v),0,v)}function s(v){return new Int8Array(H(v),0,v)}function F(v){return new Int16Array(H(2*v),0,v)}function k(v){return new Int32Array(H(4*v),0,v)}function b(v){return new Float32Array(H(4*v),0,v)}function l(v){return new Float64Array(H(8*v),0,v)}function Q(v){return m?new Uint8ClampedArray(H(v),0,v):n(v)}function K(v){return new DataView(H(v),0,v)}T.free=function(v){if(B(v))f[O.log2(v.length)].push(v);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(v)&&(v=v.buffer),!v)return;var T=v.length||v.byteLength,X=0|O.log2(T);x[X].push(v)}},T.freeUint8=T.freeUint16=T.freeUint32=T.freeInt8=T.freeInt16=T.freeInt32=T.freeFloat32=T.freeFloat=T.freeFloat64=T.freeDouble=T.freeUint8Clamped=T.freeDataView=function(v){M(v.buffer)},T.freeArrayBuffer=M,T.freeBuffer=function(v){f[O.log2(v.length)].push(v)},T.malloc=function(v,T){if(void 0===T||"arraybuffer"===T)return H(v);switch(T){case"uint8":return n(v);case"uint16":return V(v);case"uint32":return D(v);case"int8":return s(v);case"int16":return F(v);case"int32":return k(v);case"float":case"float32":return b(v);case"double":case"float64":return l(v);case"uint8_clamped":return Q(v);case"buffer":throw"Buffer not supported";case"data":case"dataview":return K(v);default:return null}return null},T.mallocArrayBuffer=H,T.mallocUint8=n,T.mallocUint16=V,T.mallocUint32=D,T.mallocInt8=s,T.mallocInt16=F,T.mallocInt32=k,T.mallocFloat32=T.mallocFloat=b,T.mallocFloat64=T.mallocDouble=l,T.mallocUint8Clamped=Q,T.mallocDataView=K,T.clearCache=function(){for(var v=0;v<32;++v)A.UINT8[v].length=0,A.UINT16[v].length=0,A.UINT32[v].length=0,A.INT8[v].length=0,A.INT16[v].length=0,A.INT32[v].length=0,A.FLOAT[v].length=0,A.DOUBLE[v].length=0,A.UINT8C[v].length=0,x[v].length=0,f[v].length=0}},12835:(v,T,X)=>{v.exports=u;var O=X(12261);function u(v,T){if(!(this instanceof u))return new u(v,T);var X=O.create();O.add(X,v,T),this.base=O.min(O.create(),v,X),this.Jh=O.clone(T),this.max=O.max(O.create(),v,X),this.mag=O.length(this.Jh)}var B=u.prototype;B.width=function(){return this.Jh[0]},B.height=function(){return this.Jh[1]},B.depth=function(){return this.Jh[2]},B.x0=function(){return this.base[0]},B.y0=function(){return this.base[1]},B.z0=function(){return this.base[2]},B.x1=function(){return this.max[0]},B.y1=function(){return this.max[1]},B.z1=function(){return this.max[2]},B.translate=function(v){return O.add(this.max,this.max,v),O.add(this.base,this.base,v),this},B.setPosition=function(v){return O.add(this.max,v,this.Jh),O.j(this.base,v),this},B.expand=function(v){var T=O.create(),X=O.create();return O.max(T,v.max,this.max),O.min(X,v.base,this.base),O.Xc(T,T,X),new u(X,T)},B.intersects=function(v){return!(v.base[0]>this.max[0])&&(!(v.base[1]>this.max[1])&&(!(v.base[2]>this.max[2])&&(!(v.max[0]<this.base[0])&&(!(v.max[1]<this.base[1])&&!(v.max[2]<this.base[2])))))},B.touches=function(v){var T=this.union(v);return null!==T&&(0==T.width()||0==T.height()||0==T.depth())},B.union=function(v){if(!this.intersects(v))return null;var T=Math.max(v.base[0],this.base[0]),X=Math.max(v.base[1],this.base[1]),O=Math.max(v.base[2],this.base[2]);return new u([T,X,O],[Math.min(v.max[0],this.max[0])-T,Math.min(v.max[1],this.max[1])-X,Math.min(v.max[2],this.max[2])-O])}},12734:(v,T)=>{"use strict";function X(v){var T=32;return(v&=-v)&&T--,65535&v&&(T-=16),16711935&v&&(T-=8),252645135&v&&(T-=4),858993459&v&&(T-=2),1431655765&v&&(T-=1),T}T.INT_BITS=32,T.INT_MAX=2147483647,T.INT_MIN=-1<<31,T.sign=function(v){return(v>0)-(v<0)},T.abs=function(v){var T=v>>31;return(v^T)-T},T.min=function(v,T){return T^(v^T)&-(v<T)},T.max=function(v,T){return v^(v^T)&-(v<T)},T.isPow2=function(v){return!(v&v-1)&&!!v},T.log2=function(v){var T,X;return T=(v>65535)<<4,T|=X=((v>>>=T)>255)<<3,T|=X=((v>>>=X)>15)<<2,(T|=X=((v>>>=X)>3)<<1)|(v>>>=X)>>1},T.log10=function(v){return v>=1e9?9:v>=1e8?8:v>=1e7?7:v>=1e6?6:v>=1e5?5:v>=1e4?4:v>=1e3?3:v>=100?2:v>=10?1:0},T.popCount=function(v){return 16843009*((v=(858993459&(v-=v>>>1&1431655765))+(v>>>2&858993459))+(v>>>4)&252645135)>>>24},T.countTrailingZeros=X,T.nextPow2=function(v){return v+=0===v,--v,v|=v>>>1,v|=v>>>2,v|=v>>>4,v|=v>>>8,(v|=v>>>16)+1},T.prevPow2=function(v){return v|=v>>>1,v|=v>>>2,v|=v>>>4,v|=v>>>8,(v|=v>>>16)-(v>>>1)},T.parity=function(v){return v^=v>>>16,v^=v>>>8,v^=v>>>4,27030>>>(v&=15)&1};var O=new Array(256);!function(v){for(var T=0;T<256;++T){var X=T,O=T,u=7;for(X>>>=1;X;X>>>=1)O<<=1,O|=1&X,--u;v[T]=O<<u&255}}(O),T.reverse=function(v){return O[255&v]<<24|O[v>>>8&255]<<16|O[v>>>16&255]<<8|O[v>>>24&255]},T.interleave2=function(v,T){return(v=1431655765&((v=858993459&((v=252645135&((v=16711935&((v&=65535)|v<<8))|v<<4))|v<<2))|v<<1))|(T=1431655765&((T=858993459&((T=252645135&((T=16711935&((T&=65535)|T<<8))|T<<4))|T<<2))|T<<1))<<1},T.deinterleave2=function(v,T){return(v=65535&((v=16711935&((v=252645135&((v=858993459&((v=v>>>T&1431655765)|v>>>1))|v>>>2))|v>>>4))|v>>>16))<<16>>16},T.interleave3=function(v,T,X){return v=1227133513&((v=3272356035&((v=251719695&((v=4278190335&((v&=1023)|v<<16))|v<<8))|v<<4))|v<<2),(v|=(T=1227133513&((T=3272356035&((T=251719695&((T=4278190335&((T&=1023)|T<<16))|T<<8))|T<<4))|T<<2))<<1)|(X=1227133513&((X=3272356035&((X=251719695&((X=4278190335&((X&=1023)|X<<16))|X<<8))|X<<4))|X<<2))<<2},T.deinterleave3=function(v,T){return(v=1023&((v=4278190335&((v=251719695&((v=3272356035&((v=v>>>T&1227133513)|v>>>2))|v>>>4))|v>>>8))|v>>>16))<<22>>22},T.nextCombination=function(v){var T=v|v-1;return T+1|(~T&-~T)-1>>>X(v)+1}},12721:(v,T,X)=>{"use strict";v.exports=function(v,T,X){switch(arguments.length){case 1:return O=[],f(u=v,u,M,!0),O;case 2:return"function"===typeof T?f(v,v,T,!0):function(v,T){return O=[],f(v,T,M,!1),O}(v,T);case 3:return f(v,T,X,!1);default:throw new Error("box-intersect: Invalid arguments")}var u};var O,u=X(12729),B=X(12755),m=X(12766);function A(v,T){for(var X=0;X<v;++X)if(!(T[X]<=T[X+v]))return!0;return!1}function x(v,T,X,O){for(var u=0,B=0,m=0,x=v.length;m<x;++m){var f=v[m];if(!A(T,f)){for(var M=0;M<2*T;++M)X[u++]=f[M];O[B++]=m}}return B}function f(v,T,X,O){var A=v.length,f=T.length;if(!(A<=0||f<=0)){var M=v[0].length>>>1;if(!(M<=0)){var H,n=u.mallocDouble(2*M*A),V=u.mallocInt32(A);if((A=x(v,M,n,V))>0){if(1===M&&O)B.init(A),H=B.sweepComplete(M,X,0,A,n,V,0,A,n,V);else{var D=u.mallocDouble(2*M*f),s=u.mallocInt32(f);(f=x(T,M,D,s))>0&&(B.init(A+f),H=1===M?B.sweepBipartite(M,X,0,A,n,V,0,f,D,s):m(M,X,O,A,n,V,f,D,s),u.free(D),u.free(s))}u.free(n),u.free(V)}return H}}}function M(v,T){O.push([v,T])}},12768:(v,T)=>{"use strict";var X="d",O="ax",u="fp",B="es",m="rs",A="re",x="rb",f="bs",M="be",H="bb",n=[X,O,"vv",m,A,x,"ri",f,M,H,"bi"];function V(v){var T="bruteForce"+(v?"Full":"Partial"),O=[],m=n.slice();v||m.splice(3,0,u);var A=["function "+T+"("+m.join()+"){"];function x(T,u){var m=function(v,T,O){var u="bruteForce"+(v?"Red":"Blue")+(T?"Flip":"")+(O?"Full":""),m=["function ",u,"(",n.join(),"){","var ",B,"=2*",X,";"],A="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",x="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(O?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return v?m.push(A,"Q",":",x):m.push(x,"Q",":",A),O?m.push("if(y1<x0||x1<y0)continue;"):T?m.push("if(y0<=x0||x1<y0)continue;"):m.push("if(y0<x0||x1<y0)continue;"),m.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),T?m.push("yi,xi"):m.push("xi,yi"),m.push(");if(rv!==void 0)return rv;}}}"),{name:u,code:m.join("")}}(T,u,v);O.push(m.code),A.push("return "+m.name+"("+n.join()+");")}A.push("if(re-rs>be-bs){"),v?(x(!0,!1),A.push("}else{"),x(!1,!1)):(A.push("if(fp){"),x(!0,!0),A.push("}else{"),x(!0,!1),A.push("}}else{if(fp){"),x(!1,!0),A.push("}else{"),x(!1,!1),A.push("}")),A.push("}}return "+T);var f=O.join("")+A.join("");return new Function(f)()}T.partial=V(!1),T.full=V(!0)},12766:(v,T,X)=>{"use strict";v.exports=function(v,T,X,B,M,Z,U,J,y){!function(v,T){var X=8*u.log2(T+1)*(v+1)|0,B=u.nextPow2(Q*X);p.length<B&&(O.free(p),p=O.mallocInt32(B));var m=u.nextPow2(K*X);G.length<m&&(O.free(G),G=O.mallocDouble(m))}(v,B+U);var P,a=0,E=2*v;L(a++,0,0,B,0,U,X?16:0,-1/0,1/0),X||L(a++,0,0,U,0,B,1,-1/0,1/0);for(;a>0;){var i=(a-=1)*Q,t=p[i],C=p[i+1],c=p[i+2],N=p[i+3],d=p[i+4],I=p[i+5],W=a*K,g=G[W],j=G[W+1],e=1&I,h=!!(16&I),S=M,w=Z,z=J,R=y;if(e&&(S=J,w=y,z=M,R=Z),!(2&I&&C>=(c=F(v,t,C,c,S,w,j)))&&!(4&I&&(C=k(v,t,C,c,S,w,g))>=c)){var Y=c-C,q=d-N;if(h){if(v*Y*(Y+q)<V){if(void 0!==(P=x.scanComplete(v,t,T,C,c,S,w,N,d,z,R)))return P;continue}}else{if(v*Math.min(Y,q)<H){if(void 0!==(P=m(v,t,T,e,C,c,S,w,N,d,z,R)))return P;continue}if(v*Y*q<n){if(void 0!==(P=x.scanBipartite(v,t,T,e,C,c,S,w,N,d,z,R)))return P;continue}}var vv=D(v,t,C,c,S,w,g,j);if(C<vv)if(v*(vv-C)<H){if(void 0!==(P=A(v,t+1,T,C,vv,S,w,N,d,z,R)))return P}else if(t===v-2){if(void 0!==(P=e?x.sweepBipartite(v,T,N,d,z,R,C,vv,S,w):x.sweepBipartite(v,T,C,vv,S,w,N,d,z,R)))return P}else L(a++,t+1,C,vv,N,d,e,-1/0,1/0),L(a++,t+1,N,d,C,vv,1^e,-1/0,1/0);if(vv<c){var Tv=f(v,t,N,d,z,R),Xv=z[E*Tv+t],Ov=s(v,t,Tv,d,z,R,Xv);if(Ov<d&&L(a++,t,vv,c,Ov,d,(4|e)+(h?16:0),Xv,j),N<Tv&&L(a++,t,vv,c,N,Tv,(2|e)+(h?16:0),g,Xv),Tv+1===Ov){if(void 0!==(P=h?o(v,t,T,vv,c,S,w,Tv,z,R[Tv]):r(v,t,T,e,vv,c,S,w,Tv,z,R[Tv])))return P}else if(Tv<Ov){var uv;if(h){if(vv<(uv=b(v,t,vv,c,S,w,Xv))){var Bv=s(v,t,vv,uv,S,w,Xv);if(t===v-2){if(vv<Bv&&void 0!==(P=x.sweepComplete(v,T,vv,Bv,S,w,Tv,Ov,z,R)))return P;if(Bv<uv&&void 0!==(P=x.sweepBipartite(v,T,Bv,uv,S,w,Tv,Ov,z,R)))return P}else vv<Bv&&L(a++,t+1,vv,Bv,Tv,Ov,16,-1/0,1/0),Bv<uv&&(L(a++,t+1,Bv,uv,Tv,Ov,0,-1/0,1/0),L(a++,t+1,Tv,Ov,Bv,uv,1,-1/0,1/0))}}else vv<(uv=e?l(v,t,vv,c,S,w,Xv):b(v,t,vv,c,S,w,Xv))&&(t===v-2?P=e?x.sweepBipartite(v,T,Tv,Ov,z,R,vv,uv,S,w):x.sweepBipartite(v,T,vv,uv,S,w,Tv,Ov,z,R):(L(a++,t+1,vv,uv,Tv,Ov,e,-1/0,1/0),L(a++,t+1,Tv,Ov,vv,uv,1^e,-1/0,1/0)))}}}}};var O=X(12729),u=X(12734),B=X(12768),m=B.partial,A=B.full,x=X(12755),f=X(12774),M=X(12777),H=128,n=1<<22,V=1<<22,D=M("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),s=M("lo===p0",["p0"]),F=M("lo<p0",["p0"]),k=M("hi<=p0",["p0"]),b=M("lo<=p0&&p0<=hi",["p0"]),l=M("lo<p0&&p0<=hi",["p0"]),Q=6,K=2,p=O.mallocInt32(1024),G=O.mallocDouble(1024);function L(v,T,X,O,u,B,m,A,x){var f=Q*v;p[f]=T,p[f+1]=X,p[f+2]=O,p[f+3]=u,p[f+4]=B,p[f+5]=m;var M=K*v;G[M]=A,G[M+1]=x}function r(v,T,X,O,u,B,m,A,x,f,M){var H=2*v,n=x*H,V=f[n+T];v:for(var D=u,s=u*H;D<B;++D,s+=H){var F=m[s+T],k=m[s+T+v];if(!(V<F||k<V)&&(!O||V!==F)){for(var b,l=A[D],Q=T+1;Q<v;++Q){F=m[s+Q],k=m[s+Q+v];var K=f[n+Q],p=f[n+Q+v];if(k<K||p<F)continue v}if(void 0!==(b=O?X(M,l):X(l,M)))return b}}}function o(v,T,X,O,u,B,m,A,x,f){var M=2*v,H=A*M,n=x[H+T];v:for(var V=O,D=O*M;V<u;++V,D+=M){var s=m[V];if(s!==f){var F=B[D+T],k=B[D+T+v];if(!(n<F||k<n)){for(var b=T+1;b<v;++b){F=B[D+b],k=B[D+b+v];var l=x[H+b],Q=x[H+b+v];if(k<l||Q<F)continue v}var K=X(s,f);if(void 0!==K)return K}}}}},12774:(v,T,X)=>{"use strict";v.exports=function(v,T,X,m,A,x){if(m<=X+1)return X;var f=X,M=m,H=m+X>>>1,n=2*v,V=H,D=A[n*H+T];for(;f<M;){if(M-f<u){B(v,T,f,M,A,x),D=A[n*H+T];break}var s=M-f,F=Math.random()*s+f|0,k=A[n*F+T],b=Math.random()*s+f|0,l=A[n*b+T],Q=Math.random()*s+f|0,K=A[n*Q+T];k<=l?K>=l?(V=b,D=l):k>=K?(V=F,D=k):(V=Q,D=K):l>=K?(V=b,D=l):K>=k?(V=F,D=k):(V=Q,D=K);for(var p=n*(M-1),G=n*V,L=0;L<n;++L,++p,++G){var r=A[p];A[p]=A[G],A[G]=r}var o=x[M-1];x[M-1]=x[V],x[V]=o;for(p=n*(M-1),G=n*(V=O(v,T,f,M-1,A,x,D)),L=0;L<n;++L,++p,++G){r=A[p];A[p]=A[G],A[G]=r}o=x[M-1];if(x[M-1]=x[V],x[V]=o,H<V){for(M=V-1;f<M&&A[n*(M-1)+T]===D;)M-=1;M+=1}else{if(!(V<H))break;for(f=V+1;f<M&&A[n*f+T]===D;)f+=1}}return O(v,T,X,H,A,x,A[n*H+T])};var O=X(12777)("lo<p0",["p0"]),u=8;function B(v,T,X,O,u,B){for(var m=2*v,A=m*(X+1)+T,x=X+1;x<O;++x,A+=m)for(var f=u[A],M=x,H=m*(x-1);M>X&&u[H+T]>f;--M,H-=m){for(var n=H,V=H+m,D=0;D<m;++D,++n,++V){var s=u[n];u[n]=u[V],u[V]=s}var F=B[M];B[M]=B[M-1],B[M-1]=F}}},12777:v=>{"use strict";v.exports=function(v,X){var O="abcdef".split("").concat(X),u=[];v.indexOf("lo")>=0&&u.push("lo=e[k+n]");v.indexOf("hi")>=0&&u.push("hi=e[k+o]");return O.push(T.replace("_",u.join()).replace("$",v)),Function.apply(void 0,O)};var T="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},12758:v=>{"use strict";v.exports=function(v,O){O<=4*T?X(0,O-1,v):f(0,O-1,v)};var T=32;function X(v,T,X){for(var O=2*(v+1),u=v+1;u<=T;++u){for(var B=X[O++],m=X[O++],A=u,x=O-2;A-- >v;){var f=X[x-2],M=X[x-1];if(f<B)break;if(f===B&&M<m)break;X[x]=f,X[x+1]=M,x-=2}X[x]=B,X[x+1]=m}}function O(v,T,X){T*=2;var O=X[v*=2],u=X[v+1];X[v]=X[T],X[v+1]=X[T+1],X[T]=O,X[T+1]=u}function u(v,T,X){T*=2,X[v*=2]=X[T],X[v+1]=X[T+1]}function B(v,T,X,O){T*=2,X*=2;var u=O[v*=2],B=O[v+1];O[v]=O[T],O[v+1]=O[T+1],O[T]=O[X],O[T+1]=O[X+1],O[X]=u,O[X+1]=B}function m(v,T,X,O,u){T*=2,u[v*=2]=u[T],u[T]=X,u[v+1]=u[T+1],u[T+1]=O}function A(v,T,X){T*=2;var O=X[v*=2],u=X[T];return!(O<u)&&(O!==u||X[v+1]>X[T+1])}function x(v,T,X,O){var u=O[v*=2];return u<T||u===T&&O[v+1]<X}function f(v,M,H){var n=(M-v+1)/6|0,V=v+n,D=M-n,s=v+M>>1,F=s-n,k=s+n,b=V,l=F,Q=s,K=k,p=D,G=v+1,L=M-1,r=0;A(b,l,H)&&(r=b,b=l,l=r),A(K,p,H)&&(r=K,K=p,p=r),A(b,Q,H)&&(r=b,b=Q,Q=r),A(l,Q,H)&&(r=l,l=Q,Q=r),A(b,K,H)&&(r=b,b=K,K=r),A(Q,K,H)&&(r=Q,Q=K,K=r),A(l,p,H)&&(r=l,l=p,p=r),A(l,Q,H)&&(r=l,l=Q,Q=r),A(K,p,H)&&(r=K,K=p,p=r);for(var o=H[2*l],Z=H[2*l+1],U=H[2*K],J=H[2*K+1],y=2*b,P=2*Q,a=2*p,E=2*V,i=2*s,t=2*D,C=0;C<2;++C){var c=H[y+C],N=H[P+C],d=H[a+C];H[E+C]=c,H[i+C]=N,H[t+C]=d}u(F,v,H),u(k,M,H);for(var I=G;I<=L;++I)if(x(I,o,Z,H))I!==G&&O(I,G,H),++G;else if(!x(I,U,J,H))for(;;){if(x(L,U,J,H)){x(L,o,Z,H)?(B(I,G,L,H),++G,--L):(O(I,L,H),--L);break}if(--L<I)break}m(v,G-1,o,Z,H),m(M,L+1,U,J,H),G-2-v<=T?X(v,G-2,H):f(v,G-2,H),M-(L+2)<=T?X(L+2,M,H):f(L+2,M,H),L-G<=T?X(G,L,H):f(G,L,H)}},12755:(v,T,X)=>{"use strict";v.exports={init:function(v){var T=u.nextPow2(v);x.length<T&&(O.free(x),x=O.mallocInt32(T));f.length<T&&(O.free(f),f=O.mallocInt32(T));M.length<T&&(O.free(M),M=O.mallocInt32(T));H.length<T&&(O.free(H),H=O.mallocInt32(T));n.length<T&&(O.free(n),n=O.mallocInt32(T));V.length<T&&(O.free(V),V=O.mallocInt32(T));var X=8*T;D.length<X&&(O.free(D),D=O.mallocDouble(X))},sweepBipartite:function(v,T,X,O,u,A,n,V,k,b){for(var l=0,Q=2*v,K=v-1,p=Q-1,G=X;G<O;++G){var L=A[G],r=Q*G;D[l++]=u[r+K],D[l++]=-(L+1),D[l++]=u[r+p],D[l++]=L}for(G=n;G<V;++G){L=b[G]+m;var o=Q*G;D[l++]=k[o+K],D[l++]=-L,D[l++]=k[o+p],D[l++]=L}var Z=l>>>1;B(D,Z);var U=0,J=0;for(G=0;G<Z;++G){var y=0|D[2*G+1];if(y>=m)s(M,H,J--,y=y-m|0);else if(y>=0)s(x,f,U--,y);else if(y<=-m){y=-y-m|0;for(var P=0;P<U;++P){if(void 0!==(a=T(x[P],y)))return a}F(M,H,J++,y)}else{y=-y-1|0;for(P=0;P<J;++P){var a;if(void 0!==(a=T(y,M[P])))return a}F(x,f,U++,y)}}},sweepComplete:function(v,T,X,O,u,m,A,k,b,l){for(var Q=0,K=2*v,p=v-1,G=K-1,L=X;L<O;++L){var r=m[L]+1<<1,o=K*L;D[Q++]=u[o+p],D[Q++]=-r,D[Q++]=u[o+G],D[Q++]=r}for(L=A;L<k;++L){r=l[L]+1<<1;var Z=K*L;D[Q++]=b[Z+p],D[Q++]=1|-r,D[Q++]=b[Z+G],D[Q++]=1|r}var U=Q>>>1;B(D,U);var J=0,y=0,P=0;for(L=0;L<U;++L){var a=0|D[2*L+1],E=1&a;if(L<U-1&&a>>1===D[2*L+3]>>1&&(E=2,L+=1),a<0){for(var i=-(a>>1)-1,t=0;t<P;++t){if(void 0!==(C=T(n[t],i)))return C}if(0!==E)for(t=0;t<J;++t){if(void 0!==(C=T(x[t],i)))return C}if(1!==E)for(t=0;t<y;++t){var C;if(void 0!==(C=T(M[t],i)))return C}0===E?F(x,f,J++,i):1===E?F(M,H,y++,i):2===E&&F(n,V,P++,i)}else{i=(a>>1)-1;0===E?s(x,f,J--,i):1===E?s(M,H,y--,i):2===E&&s(n,V,P--,i)}}},scanBipartite:function(v,T,X,O,u,A,M,H,n,V,k,b){var l=0,Q=2*v,K=T,p=T+v,G=1,L=1;O?L=m:G=m;for(var r=u;r<A;++r){var o=r+G,Z=Q*r;D[l++]=M[Z+K],D[l++]=-o,D[l++]=M[Z+p],D[l++]=o}for(r=n;r<V;++r){o=r+L;var U=Q*r;D[l++]=k[U+K],D[l++]=-o}var J=l>>>1;B(D,J);var y=0;for(r=0;r<J;++r){var P=0|D[2*r+1];if(P<0){var a=!1;if((o=-P)>=m?(a=!O,o-=m):(a=!!O,o-=1),a)F(x,f,y++,o);else{var E=b[o],i=Q*o,t=k[i+T+1],C=k[i+T+1+v];v:for(var c=0;c<y;++c){var N=x[c],d=Q*N;if(!(C<M[d+T+1]||M[d+T+1+v]<t)){for(var I=T+2;I<v;++I)if(k[i+I+v]<M[d+I]||M[d+I+v]<k[i+I])continue v;var W,g=H[N];if(void 0!==(W=O?X(E,g):X(g,E)))return W}}}}else s(x,f,y--,P-G)}},scanComplete:function(v,T,X,O,u,A,f,M,H,n,V){for(var s=0,F=2*v,k=T,b=T+v,l=O;l<u;++l){var Q=l+m,K=F*l;D[s++]=A[K+k],D[s++]=-Q,D[s++]=A[K+b],D[s++]=Q}for(l=M;l<H;++l){Q=l+1;var p=F*l;D[s++]=n[p+k],D[s++]=-Q}var G=s>>>1;B(D,G);var L=0;for(l=0;l<G;++l){var r=0|D[2*l+1];if(r<0){if((Q=-r)>=m)x[L++]=Q-m;else{var o=V[Q-=1],Z=F*Q,U=n[Z+T+1],J=n[Z+T+1+v];v:for(var y=0;y<L;++y){var P=x[y],a=f[P];if(a===o)break;var E=F*P;if(!(J<A[E+T+1]||A[E+T+1+v]<U)){for(var i=T+2;i<v;++i)if(n[Z+i+v]<A[E+i]||A[E+i+v]<n[Z+i])continue v;var t=X(a,o);if(void 0!==t)return t}}}}else{for(Q=r-m,y=L-1;y>=0;--y)if(x[y]===Q){for(i=y+1;i<L;++i)x[i-1]=x[i];break}--L}}}};var O=X(12729),u=X(12734),B=X(12758),m=1<<28,A=1024,x=O.mallocInt32(A),f=O.mallocInt32(A),M=O.mallocInt32(A),H=O.mallocInt32(A),n=O.mallocInt32(A),V=O.mallocInt32(A),D=O.mallocDouble(8192);function s(v,T,X,O){var u=T[O],B=v[X-1];v[u]=B,T[B]=u}function F(v,T,X,O){v[X]=O,T[O]=X}},12743:v=>{"use strict";function T(v,X,O){var u=0|v[O];if(u<=0)return[];var B,m=new Array(u);if(O===v.length-1)for(B=0;B<u;++B)m[B]=X;else for(B=0;B<u;++B)m[B]=T(v,X,O+1);return m}v.exports=function(v,X){switch("undefined"===typeof X&&(X=0),typeof v){case"number":if(v>0)return function(v,T){var X,O;for(X=new Array(v),O=0;O<v;++O)X[O]=T;return X}(0|v,X);break;case"object":if("number"===typeof v.length)return T(v,X,0)}return[]}},12686:(v,T,X)=>{v.exports=function(){var v=this;this.components={},this.comps=this.components;var T=this.components,X=1,u={},B=[],m=[],A={timeout:!1,removals:[],multiComps:[]};function x(v,X){var O=T[X],B=u[X],m=B.hash[v];m&&(B.remove(v),O.ab&&(O.multi?(m.forEach((T=>{T&&O.ab(v,T)})),m.length=0):O.ab(v,m)),A.removals.push(B),f())}function f(){A.timeout||(A.timeout=!0,setTimeout(M,1))}function M(){A.timeout=!1,H()}function H(){A.multiComps.length&&function(v){for(var T=0;T<v.length;T++){var{entID:X,data:O}=v[T],u=O.hash[X];if(u){for(var B=0;B<u.length;B++)u[B]||(u.splice(B,1),B--);0===u.length&&(O.remove(X),A.removals.push(O))}}v.length=0}(A.multiComps),A.removals.length&&function(v){for(var T=0;T<v.length;T++){v[T].flush()}v.length=0}(A.removals)}this.Ti=u,this._systems=B,this._renderSystems=m,this.Mh=function(T){var O=X++;return Array.isArray(T)&&T.forEach((T=>v.lf(O,T))),O},this.deleteEntity=function(T){return Object.keys(u).forEach((v=>{u[v].hash[T]&&x(T,v)})),v},this.Zh=function(v){if(!v)throw new Error("Missing component definition");var X=v.name;if(!X)throw new Error("Component definition must have a name property.");if("string"!==typeof X)throw new Error("Component name must be a string.");if(""===X)throw new Error("Component name must be a non-empty string.");if(u[X])throw new Error(`Component ${X} already exists.`);var A={};return A.name=X,A.multi=!!v.multi,A.order=isNaN(v.order)?99:v.order,A.stateConstructor=v.stateConstructor||null,A.state=v.state||{},A.Uf=v.Uf||null,A.ab=v.ab||null,A.system=v.system||null,A.kh=v.kh||null,T[X]=A,u[X]=new O,u[X]._pendingMultiCleanup=!1,u[X]._multiCleanupIDs=A.multi?[]:null,A.system&&(B.push(X),B.sort(((v,X)=>T[v].order-T[X].order))),A.kh&&(m.push(X),m.sort(((v,X)=>T[v].order-T[X].order))),X},this.overwriteComponent=function(v,X){var O=T[v];if(!O)throw new Error(`Unknown component: ${v}`);if(!X)throw new Error("Missing component definition");if(O.name!==X.name)throw new Error("Overwriting component must use the same name property.");var A={};A.name=v,A.multi=!!X.multi,A.order=isNaN(X.order)?99:X.order,A.state=X.state||{},A.Uf=X.Uf||null,A.ab=X.ab||null,A.system=X.system||null,A.kh=X.kh||null,T[v]=A,u[v]._pendingMultiCleanup=!1,u[v]._multiCleanupIDs=A.multi?[]:null;var x=B.indexOf(v);A.system&&x<0&&B.push(v),!A.system&&x>=0&&B.splice(x,1),B.sort(((v,X)=>T[v].order-T[X].order));var f=m.indexOf(v);A.kh&&f<0&&m.push(v),!A.kh&&f>=0&&m.splice(f,1),m.sort(((v,X)=>T[v].order-T[X].order));var M=A.state;return this.ph(v).forEach((v=>{for(var T in M)T in v||(v[T]=M[T]);A.Uf&&A.Uf(v.ih,v)})),v},this.deleteComponent=function(X){var O=u[X];if(!O)throw new Error(`Unknown component: ${X}`);O.flush(),O.list.forEach((v=>{v&&x(v.ih||v[0].ih,X)}));var A=B.indexOf(X),f=m.indexOf(X);return A>-1&&B.splice(A,1),f>-1&&m.splice(f,1),u[X].dispose(),delete u[X],delete T[X],v},this.lf=function(v,X,O){var B,m=T[X],A=u[X];if(!A)throw new Error(`Unknown component: ${X}.`);if(A.hash[v]&&!m.multi)throw new Error(`Entity ${v} already has component: ${X}.`);if(m.stateConstructor){if(!(B=new m.stateConstructor).hasOwnProperty("ih"))throw new Error(`Component ${m.name} stateConstructor type does not have property __id`)}else B=Object.assign({},{ih:v},m.state,O);if(B.ih=v,m.multi){var x=A.hash[v];x||(x=[],A.add(v,x)),x.push(B)}else A.add(v,B);return m.Uf&&m.Uf(v,B),this},this.Zf=function(v,T){var X=u[T];if(!X)throw new Error(`Unknown component: ${T}.`);return!!X.hash[v]},this.Qf=function(T,X){if(!u[X])throw new Error(`Unknown component: ${X}.`);return x(T,X),v},this.getState=function(v,T){var X=u[T];if(!X)throw new Error(`Unknown component: ${T}.`);return X.hash[v]},this.ph=function(v){var T=u[v];if(!T)throw new Error(`Unknown component: ${v}.`);return H(),T.list},this.Bk=function(v){if(!u[v])throw new Error(`Unknown component: ${v}.`);var T=u[v].hash;return v=>T[v]},this.Ek=function(v){if(!u[v])throw new Error(`Unknown component: ${v}.`);var T=u[v].hash;return v=>!!T[v]},this.Nf=function(X){H();for(var O=0;O<B.length;O++){var m=B[O],A=T[m],x=u[m];A.system(X,x.list),H()}return v},this.render=function(X){H();for(var O=0;O<m.length;O++){var B=m[O],A=T[B],x=u[B];A.kh(X,x.list),H()}return v},this.removeMultiComponent=function(X,O,B){var m=T[O],x=u[O];if(!x)throw new Error(`Unknown component: ${O}.`);if(!m.multi)throw new Error("removeMultiComponent called on non-multi component");return function(v,T,X,O){var u=X.hash[v];if(u){var B=u[O];B&&(u[O]=null,T.ab&&T.ab(v,B),A.multiComps.push({entID:v,data:X}),f())}}(X,m,x,B),v}};var O=X(12691)},12691:v=>{function T(v,T){var X=v._map[T];if(delete v.hash[T],delete v._map[T],X===v.list.length-1)v.list.pop();else{var O=v.list.pop();if(v.list[X]=O,null===O||null===O[0]){var u=v.list.length;for(var B in v._map)if(v._map[B]===u)return void(v._map[B]=X)}else{var m=O.ih||O[0].ih;v._map[m]=X}}}v.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(v,T){if("number"===typeof this._map[v]){var X=this._map[v];this.hash[v]=T,this.list[X]=T}else this._map[v]=this.list.length,this.hash[v]=T,this.list.push(T)}remove(v){var T=this._map[v];this.hash[v]=null,this.list[T]=null,this._pendingRemovals.push(v)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var v=0;v<this._pendingRemovals.length;v++){var X=this._pendingRemovals[v];null===this.hash[X]&&T(this,X)}this._pendingRemovals.length=0}}},12637:v=>{"use strict";var T,X="object"===typeof Reflect?Reflect:null,O=function(v,T,X){return Function.prototype.apply.call(v,T,X)};T=X&&"function"===typeof X.ownKeys?X.ownKeys:Object.getOwnPropertySymbols?function(v){return Object.getOwnPropertyNames(v).concat(Object.getOwnPropertySymbols(v))}:function(v){return Object.getOwnPropertyNames(v)};var u=Number.isNaN||function(v){return v!==v};function B(){B.init.call(this)}v.exports=B,v.exports.once=function(v,T){return new Promise((function(X,O){function u(X){v.removeListener(T,B),O(X)}function B(){"function"===typeof v.removeListener&&v.removeListener("error",u),X([].slice.call(arguments))}s(v,T,B,{once:!0}),"error"!==T&&function(v,T,X){"function"===typeof v.on&&s(v,"error",T,X)}(v,u,{once:!0})}))},B.EventEmitter=B,B.prototype._events=void 0,B.prototype._eventsCount=0,B.prototype._maxListeners=void 0;var m=10;function A(v){if("function"!==typeof v)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof v)}function x(v){return void 0===v._maxListeners?B.defaultMaxListeners:v._maxListeners}function f(v,T,X,O){var u,B,m,f;if(A(X),void 0===(B=v._events)?(B=v._events=Object.create(null),v._eventsCount=0):(void 0!==B.newListener&&(v.emit("newListener",T,X.listener?X.listener:X),B=v._events),m=B[T]),void 0===m)m=B[T]=X,++v._eventsCount;else if("function"===typeof m?m=B[T]=O?[X,m]:[m,X]:O?m.unshift(X):m.push(X),(u=x(v))>0&&m.length>u&&!m.warned){m.warned=!0;var M=new Error("Possible EventEmitter memory leak detected. "+m.length+" "+String(T)+" listeners added. Use emitter.setMaxListeners() to increase limit");M.name="MaxListenersExceededWarning",M.k=v,M.type=T,M.count=m.length,f=M,console&&console.warn&&console.warn(f)}return v}function M(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function H(v,T,X){var O={fired:!1,wrapFn:void 0,target:v,type:T,listener:X},u=M.bind(O);return u.listener=X,O.wrapFn=u,u}function n(v,T,X){var O=v._events;if(void 0===O)return[];var u=O[T];return void 0===u?[]:"function"===typeof u?X?[u.listener||u]:[u]:X?function(v){for(var T=new Array(v.length),X=0;X<T.length;++X)T[X]=v[X].listener||v[X];return T}(u):D(u,u.length)}function V(v){var T=this._events;if(void 0!==T){var X=T[v];if("function"===typeof X)return 1;if(void 0!==X)return X.length}return 0}function D(v,T){for(var X=new Array(T),O=0;O<T;++O)X[O]=v[O];return X}function s(v,T,X,O){if("function"===typeof v.on)O.once?v.once(T,X):v.on(T,X);else{if("function"!==typeof v.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof v);v.addEventListener(T,(function u(B){O.once&&v.removeEventListener(T,u),X(B)}))}}Object.defineProperty(B,"defaultMaxListeners",{enumerable:!0,get:function(){return m},set:function(v){if("number"!==typeof v||v<0||u(v))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+v+".");m=v}}),B.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},B.prototype.setMaxListeners=function(v){if("number"!==typeof v||v<0||u(v))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+v+".");return this._maxListeners=v,this},B.prototype.getMaxListeners=function(){return x(this)},B.prototype.emit=function(v){for(var T=[],X=1;X<arguments.length;X++)T.push(arguments[X]);var u="error"===v,B=this._events;if(void 0!==B)u=u&&void 0===B.error;else if(!u)return!1;if(u){var m;if(T.length>0&&(m=T[0]),m instanceof Error)throw m;var A=new Error("Unhandled error."+(m?" ("+m.message+")":""));throw A.context=m,A}var x=B[v];if(void 0===x)return!1;if("function"===typeof x)O(x,this,T);else{var f=x.length,M=D(x,f);for(X=0;X<f;++X)O(M[X],this,T)}return!0},B.prototype.addListener=function(v,T){return f(this,v,T,!1)},B.prototype.on=B.prototype.addListener,B.prototype.prependListener=function(v,T){return f(this,v,T,!0)},B.prototype.once=function(v,T){return A(T),this.on(v,H(this,v,T)),this},B.prototype.prependOnceListener=function(v,T){return A(T),this.prependListener(v,H(this,v,T)),this},B.prototype.removeListener=function(v,T){var X,O,u,B,m;if(A(T),void 0===(O=this._events))return this;if(void 0===(X=O[v]))return this;if(X===T||X.listener===T)0===--this._eventsCount?this._events=Object.create(null):(delete O[v],O.removeListener&&this.emit("removeListener",v,X.listener||T));else if("function"!==typeof X){for(u=-1,B=X.length-1;B>=0;B--)if(X[B]===T||X[B].listener===T){m=X[B].listener,u=B;break}if(u<0)return this;0===u?X.shift():function(v,T){for(;T+1<v.length;T++)v[T]=v[T+1];v.pop()}(X,u),1===X.length&&(O[v]=X[0]),void 0!==O.removeListener&&this.emit("removeListener",v,m||T)}return this},B.prototype.off=B.prototype.removeListener,B.prototype.removeAllListeners=function(v){var T,X,O;if(void 0===(X=this._events))return this;if(void 0===X.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==X[v]&&(0===--this._eventsCount?this._events=Object.create(null):delete X[v]),this;if(0===arguments.length){var u,B=Object.keys(X);for(O=0;O<B.length;++O)"removeListener"!==(u=B[O])&&this.removeAllListeners(u);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(T=X[v]))this.removeListener(v,T);else if(void 0!==T)for(O=T.length-1;O>=0;O--)this.removeListener(v,T[O]);return this},B.prototype.listeners=function(v){return n(this,v,!0)},B.prototype.rawListeners=function(v){return n(this,v,!1)},B.listenerCount=function(v,T){return"function"===typeof v.listenerCount?v.listenerCount(T):V.call(v,T)},B.prototype.listenerCount=V,B.prototype.eventNames=function(){return this._eventsCount>0?T(this._events):[]}},12959:v=>{"use strict";v.exports=function(v,T,X,O,u,B){var m=+T[0],A=+T[1],x=+T[2],f=+X[0],M=+X[1],H=+X[2],n=Math.sqrt(f*f+M*M+H*H);if(0===n)throw new Error("Can't raycast along a zero vector");return function(v,T,X,O,u,B,m,A,x,f){for(var M=0,H=Math.floor,n=0|H(T),V=0|H(X),D=0|H(O),s=u>0?1:-1,F=B>0?1:-1,k=m>0?1:-1,b=Math.abs(1/u),l=Math.abs(1/B),Q=Math.abs(1/m),K=b<1/0?b*(s>0?n+1-T:T-n):1/0,p=l<1/0?l*(F>0?V+1-X:X-V):1/0,G=Q<1/0?Q*(k>0?D+1-O:O-D):1/0,L=-1;M<=A;){var r=v(n,V,D);if(r)return x&&(x[0]=T+M*u,x[1]=X+M*B,x[2]=O+M*m),f&&(f[0]=f[1]=f[2]=0,0===L&&(f[0]=-s),1===L&&(f[1]=-F),2===L&&(f[2]=-k)),r;K<p?K<G?(n+=s,M=K,K+=b,L=0):(D+=k,M=G,G+=Q,L=2):p<G?(V+=F,M=p,p+=l,L=1):(D+=k,M=G,G+=Q,L=2)}return x&&(x[0]=T+M*u,x[1]=X+M*B,x[2]=O+M*m),f&&(f[0]=f[1]=f[2]=0),0}(v,m,A,x,f/=n,M/=n,H/=n,O="undefined"===typeof O?64:+O,u,B)}},12992:(v,T,X)=>{"use strict";X.d(T,{c:()=>B});var O=X(12637);function u(){this.Bj=!1,this.stopPropagation=!1,this.Cj=!1,this.disabled=!1}class B{constructor(v,T){this.version="0.7.0";var X=Object.assign({},new u,T||{});this.element=v||document,this.Bj=!!X.Bj,this.stopPropagation=!!X.stopPropagation,this.Cj=!!X.Cj,this.disabled=!!X.disabled,this.filterEvents=(v,T)=>!0,this.down=new O.EventEmitter,this.up=new O.EventEmitter,this.state={},this.$g={dx:0,dy:0,sk:0,Zg:0,tk:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?A(this):document.addEventListener("DOMContentLoaded",(v=>{A(this)}),{once:!0})}bind(v){for(var T=arguments.length,X=new Array(T>1?T-1:0),O=1;O<T;O++)X[O-1]=arguments[O];X.forEach((T=>{var X=this._keyBindmap[T]||[];X.includes(v)||(X.push(v),this._keyBindmap[T]=X)})),this.state[v]=!!this.state[v],this.pressCount[v]=this.pressCount[v]||0,this.releaseCount[v]=this.releaseCount[v]||0}unbind(v){for(var T in this._keyBindmap){var X=this._keyBindmap[T],O=X.indexOf(v);O>-1&&X.splice(O,1)}}getBindings(){var v={};for(var T in this._keyBindmap){this._keyBindmap[T].forEach((X=>{v[X]=v[X]||[],v[X].push(T)}))}return v}Nf(){m(this.$g),m(this.pressCount),m(this.releaseCount)}}function m(v){for(var T in v)v[T]=0}function A(v){window.addEventListener("keydown",D.bind(null,v,!0),!1),window.addEventListener("keyup",D.bind(null,v,!1),!1);var T={passive:!0};v.element.addEventListener("touchstart",H.bind(void 0,v),{passive:!1}),v.element.addEventListener("touchend",V.bind(void 0,v),T),v.element.addEventListener("mousedown",s.bind(null,v,!0),T),window.document.addEventListener("mouseup",s.bind(null,v,!1),T),v.element.addEventListener("touchmove",F.bind(null,v),T),v.element.addEventListener("mousemove",F.bind(null,v),T),window.PointerEvent,v.element.addEventListener("wheel",k.bind(null,v),T),v.element.addEventListener("contextmenu",b.bind(null,v),!1),window.addEventListener("blur",l.bind(null,v),!1)}var x=0,f=0,M=null;function H(v,T){T.preventDefault(),n(T)}function n(v){let T=!1;for(let X=0;X<v.touches.length;++X)if(v.touches[X].identifier===M){T=!0;break}if(!T){const T=v.changedTouches[0];x=T.clientX,f=T.clientY,M=T.identifier}}function V(v,T){for(var X=T.changedTouches,O=0;O<X.length;++O)X[O].identifier===M&&(M=null)}function D(v,T,X){Q(X.code,T,v,X)}function s(v,T,X){if("pointerId"in X)if(T){if(null!==v._touches.currID)return;v._touches.currID=X.pointerId}else{if(v._touches.currID!==X.pointerId)return;v._touches.currID=null}return Q("Mouse"+("button"in X?X.button+1:1),T,v,X),!1}function F(v,T){var X=T.movementX||T.mozMovementX||0,O=T.movementY||T.mozMovementY||0;if(T.touches&&0===(X|O)){var u=function(v){n(v);for(let T=0;T<v.changedTouches.length;++T)if(v.changedTouches[T].identifier==M){const X=v.changedTouches[T],O=[X.clientX-x,X.clientY-f];return x=X.clientX,f=X.clientY,O}return console.error(`Did not find touch id ${M}`),[0,0]}(T);X=u[0],O=u[1]}v.$g.dx+=X,v.$g.dy+=O}function k(v,T){var X=1;switch(T.deltaMode){case 0:X=1;break;case 1:X=12;break;case 2:X=v.element.clientHeight||window.innerHeight}v.$g.sk+=(T.deltaX||0)*X,v.$g.Zg+=(T.deltaY||0)*X,v.$g.tk+=(T.deltaZ||0)*X}function b(v,T){if(!v.Cj)return T.preventDefault(),!1}function l(v){for(var T in v._keyStates)v._keyStates[T]&&(/^Mouse\d/.test(T)||Q(T,!1,v,{code:T,note:"This is a mocked KeyboardEvent made by the 'game-inputs' module",preventDefault:()=>{},stopPropagation:()=>{}}))}function Q(v,T,X,O){var u=X._keyBindmap[v];u&&(K(X._keyStates[v],T)&&(X._keyStates[v]=T,u.forEach((v=>{(!X.filterEvents||X.filterEvents(O,v))&&function(v,T,X,O){var u=T?X.pressCount:X.releaseCount;u[v]=(u[v]||0)+1;var B=X._bindPressCount[v]||0;(B+=T?1:-1)<0&&(B=0);X._bindPressCount[v]=B;var m=X.state[v];if(K(m,B)){X.state[v]=B>0;var A=T?X.down:X.up;X.disabled||A.emit(v,O)}}(v,T,X,O)}))),"button"in O||(X.Bj&&!O.defaultPrevented&&O.preventDefault(),X.stopPropagation&&O.stopPropagation()))}function K(v,T){return v?!T:T}},12326:v=>{v.exports=function(v,T,X){return v[0]=T[0]+X[0],v[1]=T[1]+X[1],v[2]=T[2]+X[2],v}},12277:(v,T,X)=>{v.exports=function(v,T){var X=O(v[0],v[1],v[2]),m=O(T[0],T[1],T[2]);u(X,X),u(m,m);var A=B(X,m);return A>1?0:Math.acos(A)};var O=X(12281),u=X(12289),B=X(12296)},12381:v=>{v.exports=function(v,T){return v[0]=Math.ceil(T[0]),v[1]=Math.ceil(T[1]),v[2]=Math.ceil(T[2]),v}},12271:v=>{v.exports=function(v){var T=new Float32Array(3);return T[0]=v[0],T[1]=v[1],T[2]=v[2],T}},12303:v=>{v.exports=function(v,T){return v[0]=T[0],v[1]=T[1],v[2]=T[2],v}},12269:v=>{v.exports=function(){var v=new Float32Array(3);return v[0]=0,v[1]=0,v[2]=0,v}},12449:v=>{v.exports=function(v,T,X){var O=T[0],u=T[1],B=T[2],m=X[0],A=X[1],x=X[2];return v[0]=u*x-B*A,v[1]=B*m-O*x,v[2]=O*A-u*m,v}},12412:(v,T,X)=>{v.exports=X(12405)},12405:v=>{v.exports=function(v,T){var X=T[0]-v[0],O=T[1]-v[1],u=T[2]-v[2];return Math.sqrt(X*X+O*O+u*u)}},12359:(v,T,X)=>{v.exports=X(12354)},12354:v=>{v.exports=function(v,T,X){return v[0]=T[0]/X[0],v[1]=T[1]/X[1],v[2]=T[2]/X[2],v}},12296:v=>{v.exports=function(v,T){return v[0]*T[0]+v[1]*T[1]+v[2]*T[2]}},12265:v=>{v.exports=1e-6},12313:(v,T,X)=>{v.exports=function(v,T){var X=v[0],u=v[1],B=v[2],m=T[0],A=T[1],x=T[2];return Math.abs(X-m)<=O*Math.max(1,Math.abs(X),Math.abs(m))&&Math.abs(u-A)<=O*Math.max(1,Math.abs(u),Math.abs(A))&&Math.abs(B-x)<=O*Math.max(1,Math.abs(B),Math.abs(x))};var O=X(12265)},12318:v=>{v.exports=function(v,T){return v[0]===T[0]&&v[1]===T[1]&&v[2]===T[2]}},12373:v=>{v.exports=function(v,T){return v[0]=Math.floor(T[0]),v[1]=Math.floor(T[1]),v[2]=Math.floor(T[2]),v}},12496:(v,T,X)=>{v.exports=function(v,T,X,u,B,m){var A,x;T||(T=3);X||(X=0);x=u?Math.min(u*T+X,v.length):v.length;for(A=X;A<x;A+=T)O[0]=v[A],O[1]=v[A+1],O[2]=v[A+2],B(O,O,m),v[A]=O[0],v[A+1]=O[1],v[A+2]=O[2];return v};var O=X(12269)()},12281:v=>{v.exports=function(v,T,X){var O=new Float32Array(3);return O[0]=v,O[1]=T,O[2]=X,O}},12261:(v,T,X)=>{v.exports={EPSILON:X(12265),create:X(12269),clone:X(12271),angle:X(12277),Tc:X(12281),j:X(12303),set:X(12309),equals:X(12313),exactEquals:X(12318),add:X(12326),Xc:X(12332),sub:X(12335),multiply:X(12344),mul:X(12351),divide:X(12354),div:X(12359),min:X(12361),max:X(12370),floor:X(12373),ceil:X(12381),round:X(12386),scale:X(12391),$c:X(12397),distance:X(12405),dist:X(12412),ad:X(12414),sqrDist:X(12420),length:X(12422),len:X(12425),squaredLength:X(12429),ed:X(12437),negate:X(12439),inverse:X(12447),normalize:X(12289),dot:X(12296),cross:X(12449),fd:X(12455),random:X(12460),transformMat4:X(12468),transformMat3:X(12470),transformQuat:X(12476),gd:X(12484),jd:X(12486),md:X(12492),forEach:X(12496)}},12447:v=>{v.exports=function(v,T){return v[0]=1/T[0],v[1]=1/T[1],v[2]=1/T[2],v}},12425:(v,T,X)=>{v.exports=X(12422)},12422:v=>{v.exports=function(v){var T=v[0],X=v[1],O=v[2];return Math.sqrt(T*T+X*X+O*O)}},12455:v=>{v.exports=function(v,T,X,O){var u=T[0],B=T[1],m=T[2];return v[0]=u+O*(X[0]-u),v[1]=B+O*(X[1]-B),v[2]=m+O*(X[2]-m),v}},12370:v=>{v.exports=function(v,T,X){return v[0]=Math.max(T[0],X[0]),v[1]=Math.max(T[1],X[1]),v[2]=Math.max(T[2],X[2]),v}},12361:v=>{v.exports=function(v,T,X){return v[0]=Math.min(T[0],X[0]),v[1]=Math.min(T[1],X[1]),v[2]=Math.min(T[2],X[2]),v}},12351:(v,T,X)=>{v.exports=X(12344)},12344:v=>{v.exports=function(v,T,X){return v[0]=T[0]*X[0],v[1]=T[1]*X[1],v[2]=T[2]*X[2],v}},12439:v=>{v.exports=function(v,T){return v[0]=-T[0],v[1]=-T[1],v[2]=-T[2],v}},12289:v=>{v.exports=function(v,T){var X=T[0],O=T[1],u=T[2],B=X*X+O*O+u*u;B>0&&(B=1/Math.sqrt(B),v[0]=T[0]*B,v[1]=T[1]*B,v[2]=T[2]*B);return v}},12460:v=>{v.exports=function(v,T){T=T||1;var X=2*Math.random()*Math.PI,O=2*Math.random()-1,u=Math.sqrt(1-O*O)*T;return v[0]=Math.cos(X)*u,v[1]=Math.sin(X)*u,v[2]=O*T,v}},12484:v=>{v.exports=function(v,T,X,O){var u=X[1],B=X[2],m=T[1]-u,A=T[2]-B,x=Math.sin(O),f=Math.cos(O);return v[0]=T[0],v[1]=u+m*f-A*x,v[2]=B+m*x+A*f,v}},12486:v=>{v.exports=function(v,T,X,O){var u=X[0],B=X[2],m=T[0]-u,A=T[2]-B,x=Math.sin(O),f=Math.cos(O);return v[0]=u+A*x+m*f,v[1]=T[1],v[2]=B+A*f-m*x,v}},12492:v=>{v.exports=function(v,T,X,O){var u=X[0],B=X[1],m=T[0]-u,A=T[1]-B,x=Math.sin(O),f=Math.cos(O);return v[0]=u+m*f-A*x,v[1]=B+m*x+A*f,v[2]=T[2],v}},12386:v=>{v.exports=function(v,T){return v[0]=Math.round(T[0]),v[1]=Math.round(T[1]),v[2]=Math.round(T[2]),v}},12391:v=>{v.exports=function(v,T,X){return v[0]=T[0]*X,v[1]=T[1]*X,v[2]=T[2]*X,v}},12397:v=>{v.exports=function(v,T,X,O){return v[0]=T[0]+X[0]*O,v[1]=T[1]+X[1]*O,v[2]=T[2]+X[2]*O,v}},12309:v=>{v.exports=function(v,T,X,O){return v[0]=T,v[1]=X,v[2]=O,v}},12420:(v,T,X)=>{v.exports=X(12414)},12437:(v,T,X)=>{v.exports=X(12429)},12414:v=>{v.exports=function(v,T){var X=T[0]-v[0],O=T[1]-v[1],u=T[2]-v[2];return X*X+O*O+u*u}},12429:v=>{v.exports=function(v){var T=v[0],X=v[1],O=v[2];return T*T+X*X+O*O}},12335:(v,T,X)=>{v.exports=X(12332)},12332:v=>{v.exports=function(v,T,X){return v[0]=T[0]-X[0],v[1]=T[1]-X[1],v[2]=T[2]-X[2],v}},12470:v=>{v.exports=function(v,T,X){var O=T[0],u=T[1],B=T[2];return v[0]=O*X[0]+u*X[3]+B*X[6],v[1]=O*X[1]+u*X[4]+B*X[7],v[2]=O*X[2]+u*X[5]+B*X[8],v}},12468:v=>{v.exports=function(v,T,X){var O=T[0],u=T[1],B=T[2],m=X[3]*O+X[7]*u+X[11]*B+X[15];return m=m||1,v[0]=(X[0]*O+X[4]*u+X[8]*B+X[12])/m,v[1]=(X[1]*O+X[5]*u+X[9]*B+X[13])/m,v[2]=(X[2]*O+X[6]*u+X[10]*B+X[14])/m,v}},12476:v=>{v.exports=function(v,T,X){var O=T[0],u=T[1],B=T[2],m=X[0],A=X[1],x=X[2],f=X[3],M=f*O+A*B-x*u,H=f*u+x*O-m*B,n=f*B+m*u-A*O,V=-m*O-A*u-x*B;return v[0]=M*f+V*-m+H*-x-n*-A,v[1]=H*f+V*-A+n*-m-M*-x,v[2]=n*f+V*-x+M*-A-H*-m,v}},12662:v=>{"use strict";v.exports=function(v){for(var T=new Array(v),X=0;X<v;++X)T[X]=X;return T}},12746:v=>{v.exports=function(v){return null!=v&&null!=v.constructor&&"function"===typeof v.constructor.isBuffer&&v.constructor.isBuffer(v)}},12962:(v,T,X)=>{"use strict";X.d(T,{c:()=>O});class O{constructor(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.si=!1,this.ti=!1,this.qi=30,this.ri=0,this.Ci=!1,this.fullscreen=!1,this.wi=function(v){},this.xi=function(){},this.Ai=function(){},this.bb=function(){},this.yi=function(v){},this.onFullscreenChanged=function(v){},f((()=>{!function(v,T){v._nowObject=performance||Date,v._lastTick=0,v._renderAccum=0,v._rt=0,v._frameCB=A.bind(null,v),requestAnimationFrame(v._frameCB),T>0&&(v._intervalCB=m.bind(null,v),v._interval=setInterval(v._intervalCB,Math.max(T,1e3/v.qi/2)))}(this,T),function(v,T){if(!T)return;var X=!1,O=!1;document.addEventListener("pointerlockchange",(O=>{X=document.pointerLockElement===T,v.yi(X)})),document.addEventListener("fullscreenchange",(X=>{O=document.fullscreenElement===T,v.onFullscreenChanged(O)})),Object.defineProperty(v,"Ci",{get:()=>X,set:v=>{v&&!X?x(T):X&&!v&&function(v){v.exitPointerLock&&v.exitPointerLock()}(document)}}),Object.defineProperty(v,"fullscreen",{get:()=>O,set:v=>{v&&!O?T.requestFullscreen():O&&!v&&document.exitFullscreen()}}),T.addEventListener("click",(u=>{v.si&&!X&&x(T),v.ti&&!O&&T.requestFullscreen()}));var u=()=>v.bb();if(window.ResizeObserver){new ResizeObserver(u).observe(T)}else window.addEventListener("resize",u)}(this,v),this.Ai()}))}}var u=3,B=20;function m(v){for(var T=1e3/v.qi,X=v._nowObject.now()+B,O=0;v._nowObject.now()>=v._lastTick+T&&v._nowObject.now()<X&&++O<=u;)v.wi(T),v._lastTick+=T;var m=5*(T+5),A=v._nowObject.now();if(A-v._lastTick>m)for(;A>=v._lastTick+T;)v._lastTick+=T}function A(v){requestAnimationFrame(v._frameCB),m(v);var T=v._nowObject.now(),X=T-v._rt;if(v._rt=T,v.ri>0){v._renderAccum+=X;var O=1e3/v.ri;if(v._renderAccum<O)return;v._renderAccum=Math.min(v._renderAccum-O,O)}var u=1e3/v.qi,B=(T-v._lastTick)/u;v.xi(X,B,u)}function x(v){v.requestPointerLock&&v.requestPointerLock()}var f=v=>{if("loading"===document.readyState){var T=()=>{document.removeEventListener("readystatechange",T),v()};document.addEventListener("readystatechange",T)}else setTimeout(v,1)}},12657:(v,T,X)=>{var O=X(12662),u=X(12671),B="undefined"!==typeof Float64Array;function m(v,T){return v[0]-T[0]}function A(){var v,T=this.stride,X=new Array(T.length);for(v=0;v<X.length;++v)X[v]=[Math.abs(T[v]),v];X.sort(m);var O=new Array(X.length);for(v=0;v<O.length;++v)O[v]=X[v][1];return O}function x(v,T){var X=["View",T,"d",v].join("");T<0&&(X="View_Nil"+v);var u="generic"===v;if(-1===T){var B="function "+X+"(a){this.data=a;};var proto="+X+".prototype;proto.dtype='"+v+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+X+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+X+"(a){return new "+X+"(a);}";return new Function(B)()}if(0===T){B="function "+X+"(a,d) {this.data = a;this.offset = d};var proto="+X+".prototype;proto.dtype='"+v+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+X+"_copy() {return new "+X+"(this.data,this.offset)};proto.pick=function "+X+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+X+"_get(){return "+(u?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+X+"_set(v){return "+(u?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+X+"(a,b,c,d){return new "+X+"(a,d)}";return new Function("TrivialArray",B)(f[v][0])}B=["'use strict'"];var m=O(T),x=m.map((function(v){return"i"+v})),M="this.offset+"+m.map((function(v){return"this.stride["+v+"]*i"+v})).join("+"),H=m.map((function(v){return"b"+v})).join(","),n=m.map((function(v){return"c"+v})).join(",");B.push("function "+X+"(a,"+H+","+n+",d){this.data=a","this.shape=["+H+"]","this.stride=["+n+"]","this.offset=d|0}","var proto="+X+".prototype","proto.dtype='"+v+"'","proto.dimension="+T),B.push("Object.defineProperty(proto,'size',{get:function "+X+"_size(){return "+m.map((function(v){return"this.shape["+v+"]"})).join("*"),"}})"),1===T?B.push("proto.order=[0]"):(B.push("Object.defineProperty(proto,'order',{get:"),T<4?(B.push("function "+X+"_order(){"),2===T?B.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===T&&B.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):B.push("ORDER})")),B.push("proto.set=function "+X+"_set("+x.join(",")+",v){"),u?B.push("return this.data.set("+M+",v)}"):B.push("return this.data["+M+"]=v}"),B.push("proto.get=function "+X+"_get("+x.join(",")+"){"),u?B.push("return this.data.get("+M+")}"):B.push("return this.data["+M+"]}"),B.push("proto.index=function "+X+"_index(",x.join(),"){return "+M+"}"),B.push("proto.hi=function "+X+"_hi("+x.join(",")+"){return new "+X+"(this.data,"+m.map((function(v){return["(typeof i",v,"!=='number'||i",v,"<0)?this.shape[",v,"]:i",v,"|0"].join("")})).join(",")+","+m.map((function(v){return"this.stride["+v+"]"})).join(",")+",this.offset)}");var V=m.map((function(v){return"a"+v+"=this.shape["+v+"]"})),D=m.map((function(v){return"c"+v+"=this.stride["+v+"]"}));B.push("proto.lo=function "+X+"_lo("+x.join(",")+"){var b=this.offset,d=0,"+V.join(",")+","+D.join(","));for(var s=0;s<T;++s)B.push("if(typeof i"+s+"==='number'&&i"+s+">=0){d=i"+s+"|0;b+=c"+s+"*d;a"+s+"-=d}");B.push("return new "+X+"(this.data,"+m.map((function(v){return"a"+v})).join(",")+","+m.map((function(v){return"c"+v})).join(",")+",b)}"),B.push("proto.step=function "+X+"_step("+x.join(",")+"){var "+m.map((function(v){return"a"+v+"=this.shape["+v+"]"})).join(",")+","+m.map((function(v){return"b"+v+"=this.stride["+v+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(s=0;s<T;++s)B.push("if(typeof i"+s+"==='number'){d=i"+s+"|0;if(d<0){c+=b"+s+"*(a"+s+"-1);a"+s+"=ceil(-a"+s+"/d)}else{a"+s+"=ceil(a"+s+"/d)}b"+s+"*=d}");B.push("return new "+X+"(this.data,"+m.map((function(v){return"a"+v})).join(",")+","+m.map((function(v){return"b"+v})).join(",")+",c)}");var F=new Array(T),k=new Array(T);for(s=0;s<T;++s)F[s]="a[i"+s+"]",k[s]="b[i"+s+"]";B.push("proto.transpose=function "+X+"_transpose("+x+"){"+x.map((function(v,T){return v+"=("+v+"===undefined?"+T+":"+v+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+X+"(this.data,"+F.join(",")+","+k.join(",")+",this.offset)}"),B.push("proto.pick=function "+X+"_pick("+x+"){var a=[],b=[],c=this.offset");for(s=0;s<T;++s)B.push("if(typeof i"+s+"==='number'&&i"+s+">=0){c=(c+this.stride["+s+"]*i"+s+")|0}else{a.push(this.shape["+s+"]);b.push(this.stride["+s+"])}");return B.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),B.push("return function construct_"+X+"(data,shape,stride,offset){return new "+X+"(data,"+m.map((function(v){return"shape["+v+"]"})).join(",")+","+m.map((function(v){return"stride["+v+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",B.join("\n"))(f[v],A)}var f={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};v.exports=function(v,T,X,O){if(void 0===v)return(0,f.array[0])([]);"number"===typeof v&&(v=[v]),void 0===T&&(T=[v.length]);var m=T.length;if(void 0===X){X=new Array(m);for(var A=m-1,M=1;A>=0;--A)X[A]=M,M*=T[A]}if(void 0===O){O=0;for(A=0;A<m;++A)X[A]<0&&(O-=(T[A]-1)*X[A])}for(var H=function(v){if(u(v))return"buffer";if(B)switch(Object.prototype.toString.call(v)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(v)?"array":"generic"}(v),n=f[H];n.length<=m+1;)n.push(x(H,n.length-1));return(0,n[m+1])(v,T,X,O)}},12671:v=>{function T(v){return!!v.constructor&&"function"===typeof v.constructor.isBuffer&&v.constructor.isBuffer(v)}v.exports=function(v){return null!=v&&(T(v)||function(v){return"function"===typeof v.readFloatLE&&"function"===typeof v.slice&&T(v.slice(0,0))}(v)||!!v._isBuffer)}},12840:v=>{"use strict";var T=[],X=[],O=[],u=[],B=[],m=[],A=[],x=[],f=[],M=[],H=[],n=[];v.exports=function(v,V,D,s,F,k){for(var b=A,l=f,Q=M,K=n,p=0;p<3;p++)b[p]=+D[p],Q[p]=+V.max[p],l[p]=+V.base[p];k||(k=1e-10);var G=function(v,A,f,M,n,V){var D=T,s=X,F=O,k=u,b=B,l=m,Q=x,K=Math.floor,p=0,G=0,L=0,r=0,o=0;if(Z(),0===L)return 0;for(r=y();G<=L;){if(U(r)&&J())return p;r=y()}for(p+=L,o=0;o<3;o++)M[o]+=f[o],n[o]+=f[o];return p;function Z(){if(G=0,0!==(L=Math.sqrt(f[0]*f[0]+f[1]*f[1]+f[2]*f[2])))for(var v=0;v<3;v++){var T=f[v]>=0;k[v]=T?1:-1;var X=T?n[v]:M[v];D[v]=T?M[v]:n[v],s[v]=P(X,k[v]),F[v]=a(D[v],k[v]),Q[v]=f[v]/L,b[v]=Math.abs(1/Q[v]);var O=T?s[v]+1-X:X-s[v];l[v]=b[v]<1/0?b[v]*O:1/0}}function U(T){for(var X=k[0],O=0===T?s[0]:F[0],u=s[0]+X,B=k[1],m=1===T?s[1]:F[1],A=s[1]+B,x=k[2],f=2===T?s[2]:F[2],M=s[2]+x,H=O;H!=u;H+=X)for(var n=m;n!=A;n+=B)for(var V=f;V!=M;V+=x)if(v(H,n,V))return!0;return!1}function J(){p+=G;var v=k[r],T=G/L,X=H;for(o=0;o<3;o++){var O=f[o]*T;M[o]+=O,n[o]+=O,X[o]=f[o]-O}if(v>0?n[r]=Math.round(n[r]):M[r]=Math.round(M[r]),A(p,r,v,X))return!0;for(o=0;o<3;o++)f[o]=X[o];return Z(),0===L}function y(){var v=l[0]<l[1]?l[0]<l[2]?0:2:l[1]<l[2]?1:2,T=l[v]-G;for(G=l[v],s[v]+=k[v],l[v]+=b[v],o=0;o<3;o++)D[o]+=T*Q[o],F[o]=a(D[o],k[o]);return v}function P(v,T){return K(v-T*V)}function a(v,T){return K(v+T*V)}}(v,s,b,l,Q,k);if(!F){for(p=0;p<3;p++)K[p]=D[p]>0?Q[p]-V.max[p]:l[p]-V.base[p];V.translate(K)}return G}},13e3:(v,T,X)=>{"use strict";X.d(T,{c:()=>H});var O=X(12835),u=X(12261);class B{constructor(v,T,X,B,m,A,x){this.oh=new O(v.base,v.Jh),this.mass=T,this.friction=X,this.restitution=B,this.Xb=m,this.Mk=A,this.jc=!!x,this.Ih=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.zl=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.wg=u.create(),this.hh=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=u.create(),this._impulses=u.create(),this._sleepFrameCount=10}loadFromCopy(v){u.j(this.oh.base,v.oh.base),u.j(this.oh.Jh,v.oh.Jh),u.j(this.oh.max,v.oh.max),this.oh.mag=v.oh.mag,this.mass=v.mass,this.friction=v.friction,this.restitution=v.restitution,this.Xb=v.Xb,this.Mk=v.Mk,this.jc=v.jc,this.Ih=v.Ih,this.fluidDrag=v.fluidDrag,this.zl=v.zl,this.preventFallOffEdge=v.preventFallOffEdge,this.rolledBackLastTick=v.rolledBackLastTick,u.j(this.wg,v.wg),u.j(this.hh,v.hh),this.inFluid=v.inFluid,this._ratioInFluid=v._ratioInFluid,u.j(this._forces,v._forces),u.j(this._impulses,v._impulses),this._sleepFrameCount=v._sleepFrameCount}setPosition(v){m(v),u.Xc(v,v,this.oh.base),this.oh.translate(v),this.Bg()}cb(){return u.clone(this.oh.base)}applyForce(v){m(v),u.add(this._forces,this._forces,v),this.Bg()}applyImpulse(v){m(v),u.add(this._impulses,this._impulses,v),this.Bg()}Bg(){this._sleepFrameCount=10}atRestX(){return this.hh[0]}atRestY(){return this.hh[1]}atRestZ(){return this.hh[2]}}var m=v=>{};var A=X(12835),x=X(12261),f=X(12840);function M(){this.Ih=.1,this.fluidDrag=.4,this.Mc=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function H(v,T,X){v=Object.assign(new M,v),this.gravity=v.gravity||[0,-10,0],this.Ih=v.Ih||.1,this.Mc=v.Mc||2,this.fluidDrag=v.fluidDrag||.4,this.minBounceImpulse=v.minBounceImpulse,this.bodies=[],this.hk=v.hk,this.testSolid=T,this.testFluid=X}H.prototype.Tk=function(v,T,X,O,u,m){v=v||new A([0,0,0],[1,1,1]),"undefined"==typeof T&&(T=1),"undefined"==typeof X&&(X=1),"undefined"==typeof O&&(O=0),"undefined"==typeof u&&(u=1);var x=new B(v,T,X,O,u,m);return this.bodies.push(x),x},H.prototype.Uk=function(v){var T=this.bodies.indexOf(v);T<0||(this.bodies.splice(T,1),v.oh=v.Mk=null)};var n=x.create(),V=x.create(),D=x.create(),s=x.create(),F=x.create(),k=x.create(),b=x.create(),l=new A([0,0,0],[1,1,1]),Q=new B(l,1,1,0,1,(()=>{}),!1);function K(v,T,X){return T=X,T*=1-(1-v.ratioInFluid)**2}H.prototype.Nf=function(v){v/=1e3;var T=c(0,x.squaredLength(this.gravity));this.bodies.forEach((X=>function(v,T,X,O){x.j(F,T.hh),v.hk&&Q.loadFromCopy(T);if(T.mass<=0)return x.set(T.wg,0,0,0),x.set(T._forces,0,0,0),void x.set(T._impulses,0,0,0);var u=O||0===T.Xb;if(function(v,T,X,O){if(T._sleepFrameCount>0)return!1;if(O)return!0;var u=!1,B=.5*X*X*T.Xb;return x.scale(C,v.gravity,B),f(v.testSolid,T.oh,C,(function(){return u=!0,!0}),!0),u}(v,T,X,u))return;T._sleepFrameCount--,function(v,T){var X=T.oh,O=Math.floor(X.base[0]),u=Math.floor(X.base[2]),B=Math.floor(X.base[1]),m=Math.floor(X.max[1]);if(!v.testFluid(O,B,u))return T.inFluid=!1,void(T.ratioInFluid=0);var A=1,f=B+1;for(;f<=m&&v.testFluid(O,f,u);)A++,f++;var M=(B+A-X.base[1])/X.Jh[1];M>1&&(M=1);var H=X.Jh[0]*X.Jh[1]*X.Jh[2]*M,n=G;x.scale(n,v.gravity,-v.Mc*H*T.Xb),T.applyForce(n),T.inFluid=!0,T.ratioInFluid=M}(v,T),d(T._forces),d(T._impulses),d(T.wg),d(T.hh),x.scale(n,T._forces,1/T.mass),x.$c(n,n,v.gravity,T.Xb),x.scale(V,T._impulses,1/T.mass),x.$c(V,V,n,X),x.add(T.wg,T.wg,V),T.friction&&(L(v,0,T,V,X),L(v,1,T,V,X),L(v,2,T,V,X));var B=T.fluidDrag>=0?T.fluidDrag:v.fluidDrag,m=T.Ih>=0?T.Ih:v.Ih,A=m,M=m;T.inFluid&&(A=K(T,A,T.fluidDragHoriz>=0?T.fluidDragHoriz:B),M=K(T,M,T.fluidDragVert>=0?T.fluidDragVert:B));A=Math.max(1-A*X/T.mass,0),M=Math.max(1-M*X/T.mass,0),x.set(p,A,M,A),x.multiply(T.wg,T.wg,p),x.scale(D,T.wg,X),x.set(T._forces,0,0,0),x.set(T._impulses,0,0,0),T.jc&&N(Z,T.oh);x.j(k,D),x.set(b,0,0,0),T.preventFallOffEdge&&function(v,T,X,O){if(!T.hh[1]||X[1]>0)return;var u=E;N(u,T.oh);for(var B=0;B<3;B+=2){x.set(a,0,0,0),a[B]=X[B];var m=!0;(m=(m=(m=(m=m&&!t(v,u.base[0]+a[0]+1e-5,u.base[1],u.base[2]+a[2]+1e-5))&&!t(v,u.max[0]+a[0]-1e-5,u.base[1],u.base[2]+a[2]+1e-5))&&!t(v,u.base[0]+a[0]+1e-5,u.base[1],u.max[2]+a[2]-1e-5))&&!t(v,u.max[0]+a[0]-1e-5,u.base[1],u.max[2]+a[2]-1e-5))?(O[B]=X[B]>0?1:-1,X[B]=0):0===B&&(x.set(i,X[0],0,0),o(v,u,i,O,T.slideOnCollision))}}(v,T,D,b);o(v,T.oh,D,T.hh,T.slideOnCollision),T.jc&&function(v,T,X,O){if(T.hh[1]>=0&&!T.inFluid)return;var u=0!==T.hh[0],B=0!==T.hh[2];if(!u&&!B)return;var m=Math.abs(O[0]/O[2]),A=4;if(!u&&m>A)return;if(!B&&m<1/A)return;x.add(J,X.base,O);var M=v.testSolid;f(M,X,O,(function(v,T,X,O){if(1!==T)return!0;O[T]=0}));var H=X.base[1],n=T.inFluid?1.951:1.001,V=Math.floor(H+n)-H;x.set(y,0,V,0);var D=!1;if(f(M,X,y,(function(v,T,X,O){return D=!0,!0})),D)return;x.Xc(P,J,X.base),P[1]=0,o(v,X,P,U,!0);var s=c(X.base[0],J[0]),F=c(X.base[2],J[2]);if(u&&!s&&(!F||!B))return;if(B&&(!s||!u)&&!F)return;var k=!0;if(k=k&&!t(v,X.base[0]+1e-5,X.base[1],X.base[2]+1e-5),k=k&&!t(v,X.max[0]-1e-5,X.base[1],X.base[2]+1e-5),k=k&&!t(v,X.base[0]+1e-5,X.base[1],X.max[2]-1e-5),k=k&&!t(v,X.max[0]-1e-5,X.base[1],X.max[2]-1e-5),k)return;N(T.oh,X),T.hh[0]=U[0],T.hh[2]=U[2],T.zl&&T.zl()}(v,T,Z,k);for(var H=0;H<3;++H)T.hh[H]=T.hh[H]||b[H],s[H]=0,T.hh[H]&&(F[H]||(s[H]=-T.wg[H]),T.wg[H]=0);var l=x.length(s);l>.001&&(x.scale(s,s,T.mass),T.Mk&&T.Mk(s),T.restitution>0&&l>v.minBounceImpulse&&(x.scale(s,s,T.restitution),T.applyImpulse(s)));var r=x.squaredLength(T.wg);r>1e-5&&T.Bg();v.hk&&v.hk(T)?(T.loadFromCopy(Q),T.rolledBackLastTick=!0):T.rolledBackLastTick=!1}(this,X,v,T)))};var p=x.create([0,0,0]);var G=x.create();function L(v,T,X,O,u){var B=X.hh[T],m=O[T];if(!X.alwaysApplyHorizFriction||1!==T){if(0===B)return;if(B*m<=0)return}x.j(r,X.wg),r[T]=0;var A=x.length(r);if(!c(A,0)){var f=Math.abs(X.friction*v.gravity[T]*u),M=A>f?(A-f)/A:0;X.wg[(T+1)%3]*=M,X.wg[(T+2)%3]*=M}}var r=x.create();function o(v,T,X,O,u){return x.set(O,0,0,0),f(v.testSolid,T,X,(function(v,T,X,B){O[T]=X,B[T]=0,u||(B[0]=0,B[1]=0,B[2]=0)}))}var Z=new A([],[]),U=x.create(),J=x.create(),y=x.create(),P=x.create();var a=x.create(),E=new A([],[]),i=x.create();function t(v,T,X,O){return v.testSolid(Math.floor(T),Math.floor(X-1),Math.floor(O))}var C=x.create();function c(v,T){return Math.abs(v-T)<1e-5}function N(v,T){for(var X=0;X<3;X++)v.base[X]=T.base[X],v.max[X]=T.max[X],v.Jh[X]=T.Jh[X]}var d=function(v){}},11697:function(v,T){!function(v){"use strict";var T=function(v,X){return T=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(v,T){v.__proto__=T}||function(v,T){for(var X in T)Object.prototype.hasOwnProperty.call(T,X)&&(v[X]=T[X])},T(v,X)};function X(v,X){if("function"!==typeof X&&null!==X)throw new TypeError("Class extends value "+String(X)+" is not a constructor or null");function O(){this.constructor=v}T(v,X),v.prototype=null===X?Object.create(X):(O.prototype=X.prototype,new O)}function O(v,T,X,O){var u,B=arguments.length,m=B<3?T:null===O?O=Object.getOwnPropertyDescriptor(T,X):O;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)m=Reflect.decorate(v,T,X,O);else for(var A=v.length-1;A>=0;A--)(u=v[A])&&(m=(B<3?u(m):B>3?u(T,X,m):u(T,X))||m);return B>3&&m&&Object.defineProperty(T,X,m),m}function u(v,T,X){if(X||2===arguments.length)for(var O,u=0,B=T.length;u<B;u++)!O&&u in T||(O||(O=Array.prototype.slice.call(T,0,u)),O[u]=T[u]);return v.concat(O||Array.prototype.slice.call(T))}var B,m=255,A=213;v.OPERATION=void 0,(B=v.OPERATION||(v.OPERATION={}))[B.ADD=128]="ADD",B[B.REPLACE=0]="REPLACE",B[B.DELETE=64]="DELETE",B[B.DELETE_AND_ADD=192]="DELETE_AND_ADD",B[B.TOUCH=1]="TOUCH",B[B.CLEAR=10]="CLEAR";var x=function(){function T(v,T,X){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=v,this.setParent(T,X)}return T.prototype.setParent=function(v,T,X){var O=this;if(this.indexes||(this.indexes=this.ref instanceof Pv?this.ref._definition.indexes:{}),this.parent=v,this.parentIndex=X,T)if(this.root=T,this.ref instanceof Pv){var u=this.ref._definition;for(var B in u.schema){var m=this.ref[B];if(m&&m.$changes){var A=u.indexes[B];m.$changes.setParent(this.ref,T,A)}}}else"object"===typeof this.ref&&this.ref.forEach((function(v,T){if(v instanceof Pv){var X=v.$changes,u=O.ref.$changes.indexes[T];X.setParent(O.ref,O.root,u)}}))},T.prototype.operation=function(v){this.changes.set(--this.currentCustomOperation,v)},T.prototype.change=function(T,X){void 0===X&&(X=v.OPERATION.ADD);var O="number"===typeof T?T:this.indexes[T];this.assertValidIndex(O,T);var u=this.changes.get(O);u&&u.op!==v.OPERATION.DELETE&&u.op!==v.OPERATION.TOUCH||this.changes.set(O,{op:u&&u.op===v.OPERATION.DELETE?v.OPERATION.DELETE_AND_ADD:X,index:O}),this.allChanges.add(O),this.changed=!0,this.touchParents()},T.prototype.touch=function(T){var X="number"===typeof T?T:this.indexes[T];this.assertValidIndex(X,T),this.changes.has(X)||this.changes.set(X,{op:v.OPERATION.TOUCH,index:X}),this.allChanges.add(X),this.touchParents()},T.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},T.prototype.getType=function(v){if(this.ref._definition)return(T=this.ref._definition).schema[T.fieldsByIndex[v]];var T,X=(T=this.parent._definition).schema[T.fieldsByIndex[this.parentIndex]];return Object.values(X)[0]},T.prototype.getChildrenFilter=function(){var v=this.parent._definition.childFilters;return v&&v[this.parentIndex]},T.prototype.getValue=function(v){return this.ref.getByIndex(v)},T.prototype.delete=function(T){var X="number"===typeof T?T:this.indexes[T];if(void 0!==X){var O=this.getValue(X);this.changes.set(X,{op:v.OPERATION.DELETE,index:X}),this.allChanges.delete(X),delete this.caches[X],O&&O.$changes&&(O.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(T," (").concat(X,")"))},T.prototype.discard=function(T,X){var O=this;void 0===T&&(T=!1),void 0===X&&(X=!1),this.ref instanceof Pv||this.changes.forEach((function(T){if(T.op===v.OPERATION.DELETE){var X=O.ref.getIndex(T.index);delete O.indexes[X]}})),this.changes.clear(),this.changed=T,X&&this.allChanges.clear(),this.currentCustomOperation=0},T.prototype.discardAll=function(){var v=this;this.changes.forEach((function(T){var X=v.getValue(T.index);X&&X.$changes&&X.$changes.discardAll()})),this.discard()},T.prototype.cache=function(v,T){this.caches[v]=T},T.prototype.clone=function(){return new T(this.ref,this.parent,this.root)},T.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},T.prototype.assertValidIndex=function(v,T){if(void 0===v)throw new Error('ChangeTree: missing index for field "'.concat(T,'"'))},T}();function f(v,T,X,O){return v[T]||(v[T]=[]),v[T].push(X),null===O||void 0===O||O.forEach((function(v,T){return X(v,T)})),function(){return H(v[T],v[T].indexOf(X))}}function M(T){var X=this,O="string"!==typeof this.$changes.getType();this.$items.forEach((function(u,B){T.push({refId:X.$changes.refId,op:v.OPERATION.DELETE,field:B,value:void 0,previousValue:u}),O&&X.$changes.root.removeRef(u.$changes.refId)}))}function H(v,T){if(-1===T||T>=v.length)return!1;for(var X=v.length-1,O=T;O<X;O++)v[O]=v[O+1];return v.length=X,!0}var n=function(v,T){var X=v.toString(),O=T.toString();return X<O?-1:X>O?1:0};function V(v){return v.$proxy=!0,v=new Proxy(v,{get:function(v,T){return"symbol"===typeof T||isNaN(T)?v[T]:v.at(T)},set:function(v,T,X){if("symbol"===typeof T||isNaN(T))v[T]=X;else{var O=Array.from(v.$items.keys()),u=parseInt(O[T]||T);void 0===X||null===X?v.deleteAt(u):v.setAt(u,X)}return!0},deleteProperty:function(v,T){return"number"===typeof T?v.deleteAt(T):delete v[T],!0}})}var D=function(){function T(){for(var v=[],T=0;T<arguments.length;T++)v[T]=arguments[T];this.$changes=new x(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,v)}return T.prototype.Uf=function(T,X){return void 0===X&&(X=!0),f(this.$callbacks||(this.$callbacks=[]),v.OPERATION.ADD,T,X?this.$items:void 0)},T.prototype.ab=function(T){return f(this.$callbacks||(this.$callbacks=[]),v.OPERATION.DELETE,T)},T.prototype.onChange=function(T){return f(this.$callbacks||(this.$callbacks=[]),v.OPERATION.REPLACE,T)},T.is=function(v){return Array.isArray(v)||void 0!==v.array},Object.defineProperty(T.prototype,"length",{get:function(){return this.$items.size},set:function(v){0===v?this.clear():this.splice(v,this.length-v)},enumerable:!1,configurable:!0}),T.prototype.push=function(){for(var v,T=this,X=[],O=0;O<arguments.length;O++)X[O]=arguments[O];return X.forEach((function(X){v=T.$refId++,T.setAt(v,X)})),v},T.prototype.pop=function(){var v=Array.from(this.$indexes.values()).pop();if(void 0!==v){this.$changes.delete(v),this.$indexes.delete(v);var T=this.$items.get(v);return this.$items.delete(v),T}},T.prototype.at=function(v){var T=Array.from(this.$items.keys())[v];return this.$items.get(T)},T.prototype.setAt=function(T,X){var O,u;if(void 0!==X&&null!==X){if(this.$items.get(T)!==X){void 0!==X.$changes&&X.$changes.setParent(this,this.$changes.root,T);var B=null!==(u=null===(O=this.$changes.indexes[T])||void 0===O?void 0:O.op)&&void 0!==u?u:v.OPERATION.ADD;this.$changes.indexes[T]=T,this.$indexes.set(T,T),this.$items.set(T,X),this.$changes.change(T,B)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},T.prototype.deleteAt=function(v){var T=Array.from(this.$items.keys())[v];return void 0!==T&&this.$deleteAt(T)},T.prototype.$deleteAt=function(v){return this.$changes.delete(v),this.$indexes.delete(v),this.$items.delete(v)},T.prototype.clear=function(T){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),T&&M.call(this,T),this.$items.clear(),this.$changes.operation({index:0,op:v.OPERATION.CLEAR}),this.$changes.touchParents()},T.prototype.concat=function(){for(var v,X=[],O=0;O<arguments.length;O++)X[O]=arguments[O];return new(T.bind.apply(T,u([void 0],(v=Array.from(this.$items.values())).concat.apply(v,X),!1)))},T.prototype.join=function(v){return Array.from(this.$items.values()).join(v)},T.prototype.reverse=function(){var v=this,T=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(X,O){v.setAt(T[O],X)})),this},T.prototype.shift=function(){var v=Array.from(this.$items.keys()).shift();if(void 0!==v){var T=this.$items.get(v);return this.$deleteAt(v),T}},T.prototype.slice=function(v,X){var O=new T;return O.push.apply(O,Array.from(this.$items.values()).slice(v,X)),O},T.prototype.sort=function(v){var T=this;void 0===v&&(v=n);var X=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(v).forEach((function(v,O){T.setAt(X[O],v)})),this},T.prototype.splice=function(v,T){void 0===T&&(T=this.length-v);for(var X=Array.from(this.$items.keys()),O=[],u=v;u<v+T;u++)O.push(this.$items.get(X[u])),this.$deleteAt(X[u]);return O},T.prototype.unshift=function(){for(var v=this,T=[],X=0;X<arguments.length;X++)T[X]=arguments[X];var O=this.length,u=T.length,B=Array.from(this.$items.values());return T.forEach((function(T,X){v.setAt(X,T)})),B.forEach((function(T,X){v.setAt(u+X,T)})),O+u},T.prototype.indexOf=function(v,T){return Array.from(this.$items.values()).indexOf(v,T)},T.prototype.lastIndexOf=function(v,T){return void 0===T&&(T=this.length-1),Array.from(this.$items.values()).lastIndexOf(v,T)},T.prototype.every=function(v,T){return Array.from(this.$items.values()).every(v,T)},T.prototype.some=function(v,T){return Array.from(this.$items.values()).some(v,T)},T.prototype.forEach=function(v,T){Array.from(this.$items.values()).forEach(v,T)},T.prototype.map=function(v,T){return Array.from(this.$items.values()).map(v,T)},T.prototype.filter=function(v,T){return Array.from(this.$items.values()).filter(v,T)},T.prototype.reduce=function(v,T){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},T.prototype.reduceRight=function(v,T){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},T.prototype.find=function(v,T){return Array.from(this.$items.values()).find(v,T)},T.prototype.findIndex=function(v,T){return Array.from(this.$items.values()).findIndex(v,T)},T.prototype.fill=function(v,T,X){throw new Error("ArraySchema#fill() not implemented")},T.prototype.copyWithin=function(v,T,X){throw new Error("ArraySchema#copyWithin() not implemented")},T.prototype.toString=function(){return this.$items.toString()},T.prototype.toLocaleString=function(){return this.$items.toLocaleString()},T.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(T,Symbol.species,{get:function(){return T},enumerable:!1,configurable:!0}),T.prototype.entries=function(){return this.$items.entries()},T.prototype.keys=function(){return this.$items.keys()},T.prototype.values=function(){return this.$items.values()},T.prototype.includes=function(v,T){return Array.from(this.$items.values()).includes(v,T)},T.prototype.flatMap=function(v,T){throw new Error("ArraySchema#flatMap() is not supported.")},T.prototype.flat=function(v){throw new Error("ArraySchema#flat() is not supported.")},T.prototype.findLast=function(){var v=Array.from(this.$items.values());return v.findLast.apply(v,arguments)},T.prototype.findLastIndex=function(){var v=Array.from(this.$items.values());return v.findLastIndex.apply(v,arguments)},T.prototype.setIndex=function(v,T){this.$indexes.set(v,T)},T.prototype.getIndex=function(v){return this.$indexes.get(v)},T.prototype.getByIndex=function(v){return this.$items.get(this.$indexes.get(v))},T.prototype.deleteByIndex=function(v){var T=this.$indexes.get(v);this.$items.delete(T),this.$indexes.delete(v)},T.prototype.toArray=function(){return Array.from(this.$items.values())},T.prototype.toJSON=function(){return this.toArray().map((function(v){return"function"===typeof v.toJSON?v.toJSON():v}))},T.prototype.clone=function(v){return v?new(T.bind.apply(T,u([void 0],Array.from(this.$items.values()),!1))):new(T.bind.apply(T,u([void 0],this.map((function(v){return v.$changes?v.clone():v})),!1)))},T}();function s(v){return v.$proxy=!0,v=new Proxy(v,{get:function(v,T){return"symbol"!==typeof T&&"undefined"===typeof v[T]?v.get(T):v[T]},set:function(v,T,X){return"symbol"!==typeof T&&-1===T.indexOf("$")&&"Uf"!==T&&"ab"!==T&&"onChange"!==T?v.set(T,X):v[T]=X,!0},deleteProperty:function(v,T){return v.delete(T),!0}})}var F=function(){function T(v){var X=this;if(this.$changes=new x(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,v)if(v instanceof Map||v instanceof T)v.forEach((function(v,T){return X.set(T,v)}));else for(var O in v)this.set(O,v[O])}return T.prototype.Uf=function(T,X){return void 0===X&&(X=!0),f(this.$callbacks||(this.$callbacks=[]),v.OPERATION.ADD,T,X?this.$items:void 0)},T.prototype.ab=function(T){return f(this.$callbacks||(this.$callbacks=[]),v.OPERATION.DELETE,T)},T.prototype.onChange=function(T){return f(this.$callbacks||(this.$callbacks=[]),v.OPERATION.REPLACE,T)},T.is=function(v){return void 0!==v.map},T.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(T.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(T,Symbol.species,{get:function(){return T},enumerable:!1,configurable:!0}),T.prototype.set=function(T,X){if(void 0===X||null===X)throw new Error("MapSchema#set('".concat(T,"', ").concat(X,"): trying to set ").concat(X," value on '").concat(T,"'."));T=T.toString();var O="undefined"!==typeof this.$changes.indexes[T],u=O?this.$changes.indexes[T]:this.$refId++,B=O?v.OPERATION.REPLACE:v.OPERATION.ADD,m=void 0!==X.$changes;if(m&&X.$changes.setParent(this,this.$changes.root,u),O){if(!m&&this.$items.get(T)===X)return;m&&this.$items.get(T)!==X&&(B=v.OPERATION.ADD)}else this.$changes.indexes[T]=u,this.$indexes.set(u,T);return this.$items.set(T,X),this.$changes.change(T,B),this},T.prototype.get=function(v){return this.$items.get(v)},T.prototype.delete=function(v){return this.$changes.delete(v),this.$items.delete(v)},T.prototype.clear=function(T){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),T&&M.call(this,T),this.$items.clear(),this.$changes.operation({index:0,op:v.OPERATION.CLEAR}),this.$changes.touchParents()},T.prototype.has=function(v){return this.$items.has(v)},T.prototype.forEach=function(v){this.$items.forEach(v)},T.prototype.entries=function(){return this.$items.entries()},T.prototype.keys=function(){return this.$items.keys()},T.prototype.values=function(){return this.$items.values()},Object.defineProperty(T.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),T.prototype.setIndex=function(v,T){this.$indexes.set(v,T)},T.prototype.getIndex=function(v){return this.$indexes.get(v)},T.prototype.getByIndex=function(v){return this.$items.get(this.$indexes.get(v))},T.prototype.deleteByIndex=function(v){var T=this.$indexes.get(v);this.$items.delete(T),this.$indexes.delete(v)},T.prototype.toJSON=function(){var v={};return this.forEach((function(T,X){v[X]="function"===typeof T.toJSON?T.toJSON():T})),v},T.prototype.clone=function(v){var X;return v?X=Object.assign(new T,this):(X=new T,this.forEach((function(v,T){v.$changes?X.set(T,v.clone()):X.set(T,v)}))),X},T}(),k={};function b(v,T){k[v]=T}function l(v){return k[v]}var Q=function(){function v(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return v.create=function(T){var X=new v;return X.schema=Object.assign({},T&&T.schema||{}),X.indexes=Object.assign({},T&&T.indexes||{}),X.fieldsByIndex=Object.assign({},T&&T.fieldsByIndex||{}),X.descriptors=Object.assign({},T&&T.descriptors||{}),X.deprecated=Object.assign({},T&&T.deprecated||{}),X},v.prototype.addField=function(v,T){var X=this.getNextFieldIndex();this.fieldsByIndex[X]=v,this.indexes[v]=X,this.schema[v]=Array.isArray(T)?{array:T[0]}:T},v.prototype.hasField=function(v){return void 0!==this.indexes[v]},v.prototype.addFilter=function(v,T){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[v]]=T,this.indexesWithFilters.push(this.indexes[v]),!0},v.prototype.addChildrenFilter=function(v,T){var X=this.indexes[v],O=this.schema[v];if(l(Object.keys(O)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[X]=T,!0;console.warn("@filterChildren: field '".concat(v,"' can't have children. Ignoring filter."))},v.prototype.getChildrenFilter=function(v){return this.childFilters&&this.childFilters[this.indexes[v]]},v.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},v}();function K(v){return v._context&&v._context.useFilters}var p=function(){function v(){this.types={},this.schemas=new Map,this.useFilters=!1}return v.prototype.has=function(v){return this.schemas.has(v)},v.prototype.get=function(v){return this.types[v]},v.prototype.add=function(v,T){void 0===T&&(T=this.schemas.size),v._definition=Q.create(v._definition),v._typeid=T,this.types[T]=v,this.schemas.set(v,T)},v.create=function(T){return void 0===T&&(T={}),function(X){return T.context||(T.context=new v),L(X,T)}},v}(),G=new p;function L(v,T){return void 0===T&&(T={}),function(X,O){var B=T.context||G,m=X.constructor;if(m._context=B,!v)throw new Error("".concat(m.name,': @type() reference provided for "').concat(O,"\" is undefined. Make sure you don't have any circular dependencies."));B.has(m)||B.add(m);var A=m._definition;if(A.addField(O,v),A.descriptors[O]){if(A.deprecated[O])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(O,"' definition on '").concat(m.name,"'.\nCheck @type() annotation"))}catch(k){var x=k.stack.split("\n")[4].trim();throw new Error("".concat(k.message," ").concat(x))}}var f=D.is(v),M=!f&&F.is(v);if("string"!==typeof v&&!Pv.is(v)){var H=Object.values(v)[0];"string"===typeof H||B.has(H)||B.add(H)}if(T.manual)A.descriptors[O]={enumerable:!0,configurable:!0,writable:!0};else{var n="_".concat(O);A.descriptors[n]={enumerable:!1,configurable:!1,writable:!0},A.descriptors[O]={get:function(){return this[n]},set:function(v){v!==this[n]&&(void 0!==v&&null!==v?(!f||v instanceof D||(v=new(D.bind.apply(D,u([void 0],v,!1)))),!M||v instanceof F||(v=new F(v)),void 0===v.$proxy&&(M?v=s(v):f&&(v=V(v))),this.$changes.change(O),v.$changes&&v.$changes.setParent(this,this.$changes.root,this._definition.indexes[O])):this[n]&&this.$changes.delete(O),this[n]=v)},enumerable:!0,configurable:!0}}}}function r(v){return function(T,X){var O=T.constructor;O._definition.addFilter(X,v)&&(O._context.useFilters=!0)}}function o(v){return function(T,X){var O=T.constructor;O._definition.addChildrenFilter(X,v)&&(O._context.useFilters=!0)}}function Z(v){return void 0===v&&(v=!0),function(T,X){var O=T.constructor._definition;O.deprecated[X]=!0,v&&(O.descriptors[X]={get:function(){throw new Error("".concat(X," is deprecated."))},set:function(v){},enumerable:!1,configurable:!0})}}function U(v,T,X){for(var O in void 0===X&&(X={}),X.context||(X.context=v._context||X.context||G),T)L(T[O],X)(v.prototype,O);return v}function J(v){for(var T=0,X=0,O=0,u=v.length;O<u;O++)(T=v.charCodeAt(O))<128?X+=1:T<2048?X+=2:T<55296||T>=57344?X+=3:(O++,X+=4);return X}function y(v,T,X){for(var O=0,u=0,B=X.length;u<B;u++)(O=X.charCodeAt(u))<128?v[T++]=O:O<2048?(v[T++]=192|O>>6,v[T++]=128|63&O):O<55296||O>=57344?(v[T++]=224|O>>12,v[T++]=128|O>>6&63,v[T++]=128|63&O):(u++,O=65536+((1023&O)<<10|1023&X.charCodeAt(u)),v[T++]=240|O>>18,v[T++]=128|O>>12&63,v[T++]=128|O>>6&63,v[T++]=128|63&O)}function P(v,T){v.push(255&T)}function a(v,T){v.push(255&T)}function E(v,T){v.push(255&T),v.push(T>>8&255)}function i(v,T){v.push(255&T),v.push(T>>8&255)}function t(v,T){v.push(255&T),v.push(T>>8&255),v.push(T>>16&255),v.push(T>>24&255)}function C(v,T){var X=T>>24,O=T>>16,u=T>>8,B=T;v.push(255&B),v.push(255&u),v.push(255&O),v.push(255&X)}function c(v,T){var X=Math.floor(T/Math.pow(2,32));C(v,T>>>0),C(v,X)}function N(v,T){var X=T/Math.pow(2,32)|0;C(v,T>>>0),C(v,X)}function d(v,T){e(v,T)}function I(v,T){h(v,T)}var W=new Int32Array(2),g=new Float32Array(W.buffer),j=new Float64Array(W.buffer);function e(v,T){g[0]=T,t(v,W[0])}function h(v,T){j[0]=T,t(v,W[0]),t(v,W[1])}function S(v,T){return a(v,T?1:0)}function w(v,T){T||(T="");var X=J(T),O=0;if(X<32)v.push(160|X),O=1;else if(X<256)v.push(217),a(v,X),O=2;else if(X<65536)v.push(218),i(v,X),O=3;else{if(!(X<4294967296))throw new Error("String too long");v.push(219),C(v,X),O=5}return y(v,v.length,T),O+X}function z(v,T){return isNaN(T)?z(v,0):isFinite(T)?T!==(0|T)?(v.push(203),h(v,T),9):T>=0?T<128?(a(v,T),1):T<256?(v.push(204),a(v,T),2):T<65536?(v.push(205),i(v,T),3):T<4294967296?(v.push(206),C(v,T),5):(v.push(207),N(v,T),9):T>=-32?(v.push(224|T+32),1):T>=-128?(v.push(208),P(v,T),2):T>=-32768?(v.push(209),E(v,T),3):T>=-2147483648?(v.push(210),t(v,T),5):(v.push(211),c(v,T),9):z(v,T>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var R=Object.freeze({__proto__:null,utf8Write:y,int8:P,uint8:a,int16:E,uint16:i,int32:t,uint32:C,int64:c,uint64:N,float32:d,float64:I,writeFloat32:e,writeFloat64:h,boolean:S,string:w,number:z});function Y(v,T,X){for(var O="",u=0,B=T,m=T+X;B<m;B++){var A=v[B];0!==(128&A)?192!==(224&A)?224!==(240&A)?240!==(248&A)?console.error("Invalid byte "+A.toString(16)):(u=(7&A)<<18|(63&v[++B])<<12|(63&v[++B])<<6|63&v[++B])>=65536?(u-=65536,O+=String.fromCharCode(55296+(u>>>10),56320+(1023&u))):O+=String.fromCharCode(u):O+=String.fromCharCode((15&A)<<12|(63&v[++B])<<6|63&v[++B]):O+=String.fromCharCode((31&A)<<6|63&v[++B]):O+=String.fromCharCode(A)}return O}function q(v,T){return vv(v,T)<<24>>24}function vv(v,T){return v[T.offset++]}function Tv(v,T){return Xv(v,T)<<16>>16}function Xv(v,T){return v[T.offset++]|v[T.offset++]<<8}function Ov(v,T){return v[T.offset++]|v[T.offset++]<<8|v[T.offset++]<<16|v[T.offset++]<<24}function uv(v,T){return Ov(v,T)>>>0}function Bv(v,T){return nv(v,T)}function mv(v,T){return Vv(v,T)}function Av(v,T){var X=uv(v,T);return Ov(v,T)*Math.pow(2,32)+X}function xv(v,T){var X=uv(v,T);return uv(v,T)*Math.pow(2,32)+X}var fv=new Int32Array(2),Mv=new Float32Array(fv.buffer),Hv=new Float64Array(fv.buffer);function nv(v,T){return fv[0]=Ov(v,T),Mv[0]}function Vv(v,T){return fv[0]=Ov(v,T),fv[1]=Ov(v,T),Hv[0]}function Dv(v,T){return vv(v,T)>0}function sv(v,T){var X,O=v[T.offset++];O<192?X=31&O:217===O?X=vv(v,T):218===O?X=Xv(v,T):219===O&&(X=uv(v,T));var u=Y(v,T.offset,X);return T.offset+=X,u}function Fv(v,T){var X=v[T.offset];return X<192&&X>160||217===X||218===X||219===X}function kv(v,T){var X=v[T.offset++];return X<128?X:202===X?nv(v,T):203===X?Vv(v,T):204===X?vv(v,T):205===X?Xv(v,T):206===X?uv(v,T):207===X?xv(v,T):208===X?q(v,T):209===X?Tv(v,T):210===X?Ov(v,T):211===X?Av(v,T):X>223?-1*(255-X+1):void 0}function bv(v,T){var X=v[T.offset];return X<128||X>=202&&X<=211}function lv(v,T){return v[T.offset]<160}function Qv(v,T){return v[T.offset-1]===m&&(v[T.offset]<128||v[T.offset]>=202&&v[T.offset]<=211)}var Kv=Object.freeze({__proto__:null,int8:q,uint8:vv,int16:Tv,uint16:Xv,int32:Ov,uint32:uv,float32:Bv,float64:mv,int64:Av,uint64:xv,readFloat32:nv,readFloat64:Vv,boolean:Dv,string:sv,stringCheck:Fv,number:kv,numberCheck:bv,arrayCheck:lv,switchStructureCheck:Qv}),pv=function(){function T(v){var T=this;this.$changes=new x(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,v&&v.forEach((function(v){return T.add(v)}))}return T.prototype.Uf=function(T,X){return void 0===X&&(X=!0),f(this.$callbacks||(this.$callbacks=[]),v.OPERATION.ADD,T,X?this.$items:void 0)},T.prototype.ab=function(T){return f(this.$callbacks||(this.$callbacks=[]),v.OPERATION.DELETE,T)},T.prototype.onChange=function(T){return f(this.$callbacks||(this.$callbacks=[]),v.OPERATION.REPLACE,T)},T.is=function(v){return void 0!==v.collection},T.prototype.add=function(v){var T=this.$refId++;return void 0!==v.$changes&&v.$changes.setParent(this,this.$changes.root,T),this.$changes.indexes[T]=T,this.$indexes.set(T,T),this.$items.set(T,v),this.$changes.change(T),T},T.prototype.at=function(v){var T=Array.from(this.$items.keys())[v];return this.$items.get(T)},T.prototype.entries=function(){return this.$items.entries()},T.prototype.delete=function(v){for(var T,X,O=this.$items.entries();(X=O.next())&&!X.done;)if(v===X.value[1]){T=X.value[0];break}return void 0!==T&&(this.$changes.delete(T),this.$indexes.delete(T),this.$items.delete(T))},T.prototype.clear=function(T){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),T&&M.call(this,T),this.$items.clear(),this.$changes.operation({index:0,op:v.OPERATION.CLEAR}),this.$changes.touchParents()},T.prototype.has=function(v){return Array.from(this.$items.values()).some((function(T){return T===v}))},T.prototype.forEach=function(v){var T=this;this.$items.forEach((function(X,O,u){return v(X,O,T)}))},T.prototype.values=function(){return this.$items.values()},Object.defineProperty(T.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),T.prototype.setIndex=function(v,T){this.$indexes.set(v,T)},T.prototype.getIndex=function(v){return this.$indexes.get(v)},T.prototype.getByIndex=function(v){return this.$items.get(this.$indexes.get(v))},T.prototype.deleteByIndex=function(v){var T=this.$indexes.get(v);this.$items.delete(T),this.$indexes.delete(v)},T.prototype.toArray=function(){return Array.from(this.$items.values())},T.prototype.toJSON=function(){var v=[];return this.forEach((function(T,X){v.push("function"===typeof T.toJSON?T.toJSON():T)})),v},T.prototype.clone=function(v){var X;return v?X=Object.assign(new T,this):(X=new T,this.forEach((function(v){v.$changes?X.add(v.clone()):X.add(v)}))),X},T}(),Gv=function(){function T(v){var T=this;this.$changes=new x(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,v&&v.forEach((function(v){return T.add(v)}))}return T.prototype.Uf=function(T,X){return void 0===X&&(X=!0),f(this.$callbacks||(this.$callbacks=[]),v.OPERATION.ADD,T,X?this.$items:void 0)},T.prototype.ab=function(T){return f(this.$callbacks||(this.$callbacks=[]),v.OPERATION.DELETE,T)},T.prototype.onChange=function(T){return f(this.$callbacks||(this.$callbacks=[]),v.OPERATION.REPLACE,T)},T.is=function(v){return void 0!==v.set},T.prototype.add=function(T){var X,O;if(this.has(T))return!1;var u=this.$refId++;void 0!==T.$changes&&T.$changes.setParent(this,this.$changes.root,u);var B=null!==(O=null===(X=this.$changes.indexes[u])||void 0===X?void 0:X.op)&&void 0!==O?O:v.OPERATION.ADD;return this.$changes.indexes[u]=u,this.$indexes.set(u,u),this.$items.set(u,T),this.$changes.change(u,B),u},T.prototype.entries=function(){return this.$items.entries()},T.prototype.delete=function(v){for(var T,X,O=this.$items.entries();(X=O.next())&&!X.done;)if(v===X.value[1]){T=X.value[0];break}return void 0!==T&&(this.$changes.delete(T),this.$indexes.delete(T),this.$items.delete(T))},T.prototype.clear=function(T){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),T&&M.call(this,T),this.$items.clear(),this.$changes.operation({index:0,op:v.OPERATION.CLEAR}),this.$changes.touchParents()},T.prototype.has=function(v){for(var T,X=this.$items.values(),O=!1;(T=X.next())&&!T.done;)if(v===T.value){O=!0;break}return O},T.prototype.forEach=function(v){var T=this;this.$items.forEach((function(X,O,u){return v(X,O,T)}))},T.prototype.values=function(){return this.$items.values()},Object.defineProperty(T.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),T.prototype.setIndex=function(v,T){this.$indexes.set(v,T)},T.prototype.getIndex=function(v){return this.$indexes.get(v)},T.prototype.getByIndex=function(v){return this.$items.get(this.$indexes.get(v))},T.prototype.deleteByIndex=function(v){var T=this.$indexes.get(v);this.$items.delete(T),this.$indexes.delete(v)},T.prototype.toArray=function(){return Array.from(this.$items.values())},T.prototype.toJSON=function(){var v=[];return this.forEach((function(T,X){v.push("function"===typeof T.toJSON?T.toJSON():T)})),v},T.prototype.clone=function(v){var X;return v?X=Object.assign(new T,this):(X=new T,this.forEach((function(v){v.$changes?X.add(v.clone()):X.add(v)}))),X},T}(),Lv=function(){function v(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return v.prototype.addRefId=function(v){this.refIds.has(v)||(this.refIds.add(v),this.containerIndexes.set(v,new Set))},v.get=function(T){return void 0===T.$filterState&&(T.$filterState=new v),T.$filterState},v}(),rv=function(){function v(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return v.prototype.getNextUniqueId=function(){return this.nextUniqueId++},v.prototype.addRef=function(v,T,X){void 0===X&&(X=!0),this.refs.set(v,T),X&&(this.refCounts[v]=(this.refCounts[v]||0)+1)},v.prototype.removeRef=function(v){this.refCounts[v]=this.refCounts[v]-1,this.deletedRefs.add(v)},v.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},v.prototype.garbageCollectDeletedRefs=function(){var v=this;this.deletedRefs.forEach((function(T){if(!(v.refCounts[T]>0)){var X=v.refs.get(T);if(X instanceof Pv)for(var O in X._definition.schema)"string"!==typeof X._definition.schema[O]&&X[O]&&X[O].$changes&&v.removeRef(X[O].$changes.refId);else{var u=X.$changes.parent._definition,B=u.schema[u.fieldsByIndex[X.$changes.parentIndex]];"function"===typeof Object.values(B)[0]&&Array.from(X.values()).forEach((function(T){return v.removeRef(T.$changes.refId)}))}v.refs.delete(T),delete v.refCounts[T]}})),this.deletedRefs.clear()},v}(),ov=function(v){function T(){return null!==v&&v.apply(this,arguments)||this}return X(T,v),T}(Error);function Zv(v,T,X,O){var u,B=!1;switch(T){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":u="number",isNaN(v)&&console.log('trying to encode "NaN" in '.concat(X.constructor.name,"#").concat(O));break;case"string":u="string",B=!0;break;case"boolean":return}if(typeof v!==u&&(!B||B&&null!==v)){var m="'".concat(JSON.stringify(v),"'").concat(v&&v.constructor&&" (".concat(v.constructor.name,")")||"");throw new ov("a '".concat(u,"' was expected, but ").concat(m," was provided in ").concat(X.constructor.name,"#").concat(O))}}function Uv(v,T,X,O){if(!(v instanceof T))throw new ov("a '".concat(T.name,"' was expected, but '").concat(v.constructor.name,"' was provided in ").concat(X.constructor.name,"#").concat(O))}function Jv(v,T,X,O,u){Zv(X,v,O,u);var B=R[v];if(!B)throw new ov("a '".concat(v,"' was expected, but ").concat(X," was provided in ").concat(O.constructor.name,"#").concat(u));B(T,X)}function yv(v,T,X){return Kv[v](T,X)}var Pv=function(){function T(){for(var v=[],T=0;T<arguments.length;T++)v[T]=arguments[T];Object.defineProperties(this,{$changes:{value:new x(this,void 0,new rv),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var X=this._definition.descriptors;X&&Object.defineProperties(this,X),v[0]&&this.assign(v[0])}return T.onError=function(v){console.error(v)},T.is=function(v){return v._definition&&void 0!==v._definition.schema},T.prototype.onChange=function(T){return f(this.$callbacks||(this.$callbacks=[]),v.OPERATION.REPLACE,T)},T.prototype.ab=function(T){return f(this.$callbacks||(this.$callbacks=[]),v.OPERATION.DELETE,T)},T.prototype.assign=function(v){return Object.assign(this,v),this},Object.defineProperty(T.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),T.prototype.setDirty=function(v,T){this.$changes.change(v,T)},T.prototype.listen=function(v,T,X){var O=this;return void 0===X&&(X=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[v]||(this.$callbacks[v]=[]),this.$callbacks[v].push(T),X&&void 0!==this[v]&&T(this[v],void 0),function(){return H(O.$callbacks[v],O.$callbacks[v].indexOf(T))}},T.prototype.decode=function(X,O,u){var B;void 0===O&&(O={offset:0}),void 0===u&&(u=this);var A=[],x=this.$changes.root,f=X.length,M=0;for(x.refs.set(M,this);O.offset<f;){var H=X[O.offset++];if(H!=m){var n=u.$changes,V=void 0!==u._definition,s=V?H>>6<<6:H;if(s!==v.OPERATION.CLEAR){var k=V?H%(s||255):kv(X,O),b=V?u._definition.fieldsByIndex[k]:"",Q=n.getType(k),K=void 0,p=void 0,G=void 0;if(V?p=u["_".concat(b)]:(p=u.getByIndex(k),(s&v.OPERATION.ADD)===v.OPERATION.ADD?(G=u instanceof F?sv(X,O):k,u.setIndex(k,G)):G=u.getIndex(k)),(s&v.OPERATION.DELETE)===v.OPERATION.DELETE&&(s!==v.OPERATION.DELETE_AND_ADD&&u.deleteByIndex(k),p&&p.$changes&&x.removeRef(p.$changes.refId),K=null),void 0!==b){if(s===v.OPERATION.DELETE);else if(T.is(Q)){var L=kv(X,O);if(K=x.refs.get(L),s!==v.OPERATION.REPLACE){var r=this.getSchemaType(X,O,Q);K||((K=this.createTypeInstance(r)).$changes.refId=L,p&&(K.$callbacks=p.$callbacks,p.$changes.refId&&L!==p.$changes.refId&&x.removeRef(p.$changes.refId))),x.addRef(L,K,K!==p)}}else if("string"===typeof Q)K=yv(Q,X,O);else{var o=l(Object.keys(Q)[0]),Z=kv(X,O),U=x.refs.has(Z)?p||x.refs.get(Z):new o.constructor;if((K=U.clone(!0)).$changes.refId=Z,p&&(K.$callbacks=p.$callbacks,p.$changes.refId&&Z!==p.$changes.refId)){x.removeRef(p.$changes.refId);for(var J=p.entries(),y=void 0;(y=J.next())&&!y.done;){var P=(B=y.value)[0],a=B[1];A.push({refId:Z,op:v.OPERATION.DELETE,field:P,value:void 0,previousValue:a})}}x.addRef(Z,K,U!==p)}if(null!==K&&void 0!==K)if(K.$changes&&K.$changes.setParent(n.ref,n.root,k),u instanceof T)u[b]=K;else if(u instanceof F)P=G,u.$items.set(P,K),u.$changes.allChanges.add(k);else if(u instanceof D)u.setAt(k,K);else if(u instanceof pv){var E=u.add(K);u.setIndex(k,E)}else u instanceof Gv&&!1!==(E=u.add(K))&&u.setIndex(k,E);p!==K&&A.push({refId:M,op:s,field:b,dynamicIndex:G,value:K,previousValue:p})}else{console.warn("@colyseus/schema: definition mismatch");for(var i={offset:O.offset};O.offset<f&&(!Qv(X,O)||(i.offset=O.offset+1,!x.refs.has(kv(X,i))));)O.offset++}}else u.clear(A)}else{M=kv(X,O);var t=x.refs.get(M);if(!t)throw new Error('"refId" not found: '.concat(M));u=t}}return this._triggerChanges(A),x.garbageCollectDeletedRefs(),A},T.prototype.encode=function(X,O,u){void 0===X&&(X=!1),void 0===O&&(O=[]),void 0===u&&(u=!1);for(var B=this.$changes,A=new WeakSet,x=[B],f=1,M=0;M<f;M++){var H=x[M],n=H.ref,V=n instanceof T;H.ensureRefId(),A.add(H),H!==B&&(H.changed||X)&&(a(O,m),z(O,H.refId));for(var D=X?Array.from(H.allChanges):Array.from(H.changes.values()),s=0,k=D.length;s<k;s++){var b=X?{op:v.OPERATION.ADD,index:D[s]}:D[s],Q=b.index,K=V?n._definition.fieldsByIndex&&n._definition.fieldsByIndex[Q]:Q,p=O.length;if(b.op!==v.OPERATION.TOUCH)if(V)a(O,Q|b.op);else{if(a(O,b.op),b.op===v.OPERATION.CLEAR)continue;z(O,Q)}if(V||(b.op&v.OPERATION.ADD)!=v.OPERATION.ADD||n instanceof F&&w(O,H.ref.$indexes.get(Q)),b.op!==v.OPERATION.DELETE){var G=H.getType(Q),L=H.getValue(Q);if(L&&L.$changes&&!A.has(L.$changes)&&(x.push(L.$changes),L.$changes.ensureRefId(),f++),b.op!==v.OPERATION.TOUCH){if(T.is(G))Uv(L,G,n,K),z(O,L.$changes.refId),(b.op&v.OPERATION.ADD)===v.OPERATION.ADD&&this.tryEncodeTypeId(O,G,L.constructor);else if("string"===typeof G)Jv(G,O,L,n,K);else{var r=l(Object.keys(G)[0]);Uv(n["_".concat(K)],r.constructor,n,K),z(O,L.$changes.refId)}u&&H.cache(Q,O.slice(p))}}}X||u||H.discard()}return O},T.prototype.encodeAll=function(v){return this.encode(!0,[],v)},T.prototype.applyFilters=function(X,O){var u,B;void 0===O&&(O=!1);for(var A=this,x=new Set,f=Lv.get(X),M=[this.$changes],H=1,n=[],V=function(V){var D=M[V];if(x.has(D.refId))return"continue";var s=D.ref,k=s instanceof T;a(n,m),z(n,D.refId);var b=f.refIds.has(D),l=O||!b;f.addRefId(D);var Q=f.containerIndexes.get(D),K=l?Array.from(D.allChanges):Array.from(D.changes.values());!O&&k&&s._definition.indexesWithFilters&&s._definition.indexesWithFilters.forEach((function(T){!Q.has(T)&&D.allChanges.has(T)&&(l?K.push(T):K.push({op:v.OPERATION.ADD,index:T}))}));for(var p=0,G=K.length;p<G;p++){var L=l?{op:v.OPERATION.ADD,index:K[p]}:K[p];if(L.op!==v.OPERATION.CLEAR){var r=L.index;if(L.op!==v.OPERATION.DELETE){var o=D.getValue(r),Z=D.getType(r);if(k){if((U=s._definition.filters&&s._definition.filters[r])&&!U.call(s,X,o,A)){o&&o.$changes&&x.add(o.$changes.refId);continue}}else{var U,J=D.parent;if((U=D.getChildrenFilter())&&!U.call(J,X,s.$indexes.get(r),o,A)){o&&o.$changes&&x.add(o.$changes.refId);continue}}if(o.$changes&&(M.push(o.$changes),H++),L.op!==v.OPERATION.TOUCH)if(L.op===v.OPERATION.ADD||k)n.push.apply(n,null!==(u=D.caches[r])&&void 0!==u?u:[]),Q.add(r);else if(Q.has(r))n.push.apply(n,null!==(B=D.caches[r])&&void 0!==B?B:[]);else{if(Q.add(r),a(n,v.OPERATION.ADD),z(n,r),s instanceof F){var y=D.ref.$indexes.get(r);w(n,y)}o.$changes?z(n,o.$changes.refId):R[Z](n,o)}else o.$changes&&!k&&(a(n,v.OPERATION.ADD),z(n,r),s instanceof F&&(y=D.ref.$indexes.get(r),w(n,y)),z(n,o.$changes.refId))}else k?a(n,L.op|r):(a(n,L.op),z(n,r))}else a(n,L.op)}},D=0;D<H;D++)V(D);return n},T.prototype.clone=function(){var v,T=new this.constructor,X=this._definition.schema;for(var O in X)"object"===typeof this[O]&&"function"===typeof(null===(v=this[O])||void 0===v?void 0:v.clone)?T[O]=this[O].clone():T[O]=this[O];return T},T.prototype.toJSON=function(){var v=this._definition.schema,T=this._definition.deprecated,X={};for(var O in v)T[O]||null===this[O]||"undefined"===typeof this[O]||(X[O]="function"===typeof this[O].toJSON?this[O].toJSON():this["_".concat(O)]);return X},T.prototype.discardAllChanges=function(){this.$changes.discardAll()},T.prototype.getByIndex=function(v){return this[this._definition.fieldsByIndex[v]]},T.prototype.deleteByIndex=function(v){this[this._definition.fieldsByIndex[v]]=void 0},T.prototype.tryEncodeTypeId=function(v,T,X){T._typeid!==X._typeid&&(a(v,A),z(v,X._typeid))},T.prototype.getSchemaType=function(v,T,X){var O;return v[T.offset]===A&&(T.offset++,O=this.constructor._context.get(kv(v,T))),O||X},T.prototype.createTypeInstance=function(v){var T=new v;return T.$changes.root=this.$changes.root,T},T.prototype._triggerChanges=function(X){for(var O,u,B,m,A,x,f,M,H,n=new Set,V=this.$changes.root.refs,D=function(D){var s=X[D],F=s.refId,k=V.get(F),b=k.$callbacks;if((s.op&v.OPERATION.DELETE)===v.OPERATION.DELETE&&s.previousValue instanceof T&&(null===(u=null===(O=s.previousValue.$callbacks)||void 0===O?void 0:O[v.OPERATION.DELETE])||void 0===u||u.forEach((function(v){return v()}))),!b)return"continue";if(k instanceof T){if(!n.has(F))try{null===(B=null===b||void 0===b?void 0:b[v.OPERATION.REPLACE])||void 0===B||B.forEach((function(v){return v()}))}catch(l){T.onError(l)}try{b.hasOwnProperty(s.field)&&(null===(m=b[s.field])||void 0===m||m.forEach((function(v){return v(s.value,s.previousValue)})))}catch(l){T.onError(l)}}else s.op===v.OPERATION.ADD&&void 0===s.previousValue?null===(A=b[v.OPERATION.ADD])||void 0===A||A.forEach((function(v){var T;return v(s.value,null!==(T=s.dynamicIndex)&&void 0!==T?T:s.field)})):s.op===v.OPERATION.DELETE?void 0!==s.previousValue&&(null===(x=b[v.OPERATION.DELETE])||void 0===x||x.forEach((function(v){var T;return v(s.previousValue,null!==(T=s.dynamicIndex)&&void 0!==T?T:s.field)}))):s.op===v.OPERATION.DELETE_AND_ADD&&(void 0!==s.previousValue&&(null===(f=b[v.OPERATION.DELETE])||void 0===f||f.forEach((function(v){var T;return v(s.previousValue,null!==(T=s.dynamicIndex)&&void 0!==T?T:s.field)}))),null===(M=b[v.OPERATION.ADD])||void 0===M||M.forEach((function(v){var T;return v(s.value,null!==(T=s.dynamicIndex)&&void 0!==T?T:s.field)}))),s.value!==s.previousValue&&(null===(H=b[v.OPERATION.REPLACE])||void 0===H||H.forEach((function(v){var T;return v(s.value,null!==(T=s.dynamicIndex)&&void 0!==T?T:s.field)})));n.add(F)},s=0;s<X.length;s++)D(s)},T._definition=Q.create(),T}();function av(v){for(var T=[v.$changes],X=1,O={},u=O,B=function(v){var X=T[v];X.changes.forEach((function(v){var T=X.ref,O=v.index,B=T._definition?T._definition.fieldsByIndex[O]:T.$indexes.get(O);u[B]=X.getValue(O)}))},m=0;m<X;m++)B(m);return O}var Ev={context:new p},iv=function(v){function T(){return null!==v&&v.apply(this,arguments)||this}return X(T,v),O([L("string",Ev)],T.prototype,"name",void 0),O([L("string",Ev)],T.prototype,"type",void 0),O([L("number",Ev)],T.prototype,"referencedType",void 0),T}(Pv),tv=function(v){function T(){var T=null!==v&&v.apply(this,arguments)||this;return T.fields=new D,T}return X(T,v),O([L("number",Ev)],T.prototype,"id",void 0),O([L([iv],Ev)],T.prototype,"fields",void 0),T}(Pv),Cv=function(v){function T(){var T=null!==v&&v.apply(this,arguments)||this;return T.types=new D,T}return X(T,v),T.encode=function(v){var X=v.constructor,O=new T;O.rootType=X._typeid;var u=function(v,T){for(var X in T){var u=new iv;u.name=X;var B=void 0;if("string"===typeof T[X])B=T[X];else{var m=T[X],A=void 0;Pv.is(m)?(B="ref",A=T[X]):"string"===typeof m[B=Object.keys(m)[0]]?B+=":"+m[B]:A=m[B],u.referencedType=A?A._typeid:-1}u.type=B,v.fields.push(u)}O.types.push(v)},B=X._context.types;for(var m in B){var A=new tv;A.id=Number(m),u(A,B[m]._definition.schema)}return O.encodeAll()},T.decode=function(v,O){var u=new p,B=new T;B.decode(v,O);var m=B.types.reduce((function(v,T){var O=function(v){function T(){return null!==v&&v.apply(this,arguments)||this}return X(T,v),T}(Pv),B=T.id;return v[B]=O,u.add(O,B),v}),{});B.types.forEach((function(v){var T=m[v.id];v.fields.forEach((function(v){var X;if(void 0!==v.referencedType){var O=v.type,B=m[v.referencedType];if(!B){var A=v.type.split(":");O=A[0],B=A[1]}"ref"===O?L(B,{context:u})(T.prototype,v.name):L(((X={})[O]=B,X),{context:u})(T.prototype,v.name)}else L(v.type,{context:u})(T.prototype,v.name)}))}));var A=m[B.rootType],x=new A;for(var f in A._definition.schema){var M=A._definition.schema[f];"string"!==typeof M&&(x[f]="function"===typeof M?new M:new(l(Object.keys(M)[0]).constructor))}return x},O([L([tv],Ev)],T.prototype,"types",void 0),O([L("number",Ev)],T.prototype,"rootType",void 0),T}(Pv);b("map",{constructor:F}),b("array",{constructor:D}),b("set",{constructor:Gv}),b("collection",{constructor:pv}),v.ArraySchema=D,v.CollectionSchema=pv,v.Context=p,v.MapSchema=F,v.Reflection=Cv,v.ReflectionField=iv,v.ReflectionType=tv,v.Schema=Pv,v.SchemaDefinition=Q,v.SetSchema=Gv,v.decode=Kv,v.defineTypes=U,v.deprecated=Z,v.dumpChanges=av,v.encode=R,v.filter=r,v.filterChildren=o,v.hasFilter=K,v.registerType=b,v.type=L,Object.defineProperty(v,"__esModule",{value:!0})}(T)},12881:v=>{"use strict";v.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12873:(v,T,X)=>{var O=X(12881),u=X(12889),B=Object.hasOwnProperty,m=Object.create(null);for(var A in O)B.call(O,A)&&(m[O[A]]=A);var x=v.exports={to:{},get:{}};function f(v,T,X){return Math.min(Math.max(T,v),X)}function M(v){var T=Math.round(v).toString(16).toUpperCase();return T.length<2?"0"+T:T}x.get=function(v){var T,X;switch(v.substring(0,3).toLowerCase()){case"hsl":T=x.get.hsl(v),X="hsl";break;case"hwb":T=x.get.hwb(v),X="hwb";break;default:T=x.get.rgb(v),X="rgb"}return T?{model:X,value:T}:null},x.get.rgb=function(v){if(!v)return null;var T,X,u,m=[0,0,0,1];if(T=v.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(u=T[2],T=T[1],X=0;X<3;X++){var A=2*X;m[X]=parseInt(T.slice(A,A+2),16)}u&&(m[3]=parseInt(u,16)/255)}else if(T=v.match(/^#([a-f0-9]{3,4})$/i)){for(u=(T=T[1])[3],X=0;X<3;X++)m[X]=parseInt(T[X]+T[X],16);u&&(m[3]=parseInt(u+u,16)/255)}else if(T=v.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(X=0;X<3;X++)m[X]=parseInt(T[X+1],0);T[4]&&(T[5]?m[3]=.01*parseFloat(T[4]):m[3]=parseFloat(T[4]))}else{if(!(T=v.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(T=v.match(/^(\w+)$/))?"transparent"===T[1]?[0,0,0,0]:B.call(O,T[1])?((m=O[T[1]])[3]=1,m):null:null;for(X=0;X<3;X++)m[X]=Math.round(2.55*parseFloat(T[X+1]));T[4]&&(T[5]?m[3]=.01*parseFloat(T[4]):m[3]=parseFloat(T[4]))}for(X=0;X<3;X++)m[X]=f(m[X],0,255);return m[3]=f(m[3],0,1),m},x.get.hsl=function(v){if(!v)return null;var T=v.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(T){var X=parseFloat(T[4]);return[(parseFloat(T[1])%360+360)%360,f(parseFloat(T[2]),0,100),f(parseFloat(T[3]),0,100),f(isNaN(X)?1:X,0,1)]}return null},x.get.hwb=function(v){if(!v)return null;var T=v.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(T){var X=parseFloat(T[4]);return[(parseFloat(T[1])%360+360)%360,f(parseFloat(T[2]),0,100),f(parseFloat(T[3]),0,100),f(isNaN(X)?1:X,0,1)]}return null},x.to.hex=function(){var v=u(arguments);return"#"+M(v[0])+M(v[1])+M(v[2])+(v[3]<1?M(Math.round(255*v[3])):"")},x.to.rgb=function(){var v=u(arguments);return v.length<4||1===v[3]?"rgb("+Math.round(v[0])+", "+Math.round(v[1])+", "+Math.round(v[2])+")":"rgba("+Math.round(v[0])+", "+Math.round(v[1])+", "+Math.round(v[2])+", "+v[3]+")"},x.to.rgb.percent=function(){var v=u(arguments),T=Math.round(v[0]/255*100),X=Math.round(v[1]/255*100),O=Math.round(v[2]/255*100);return v.length<4||1===v[3]?"rgb("+T+"%, "+X+"%, "+O+"%)":"rgba("+T+"%, "+X+"%, "+O+"%, "+v[3]+")"},x.to.hsl=function(){var v=u(arguments);return v.length<4||1===v[3]?"hsl("+v[0]+", "+v[1]+"%, "+v[2]+"%)":"hsla("+v[0]+", "+v[1]+"%, "+v[2]+"%, "+v[3]+")"},x.to.hwb=function(){var v=u(arguments),T="";return v.length>=4&&1!==v[3]&&(T=", "+v[3]),"hwb("+v[0]+", "+v[1]+"%, "+v[2]+"%"+T+")"},x.to.keyword=function(v){return m[v.slice(0,3)]}},12869:(v,T,X)=>{const O=X(12873),u=X(12902),B=["keyword","gray","hex"],m={};for(const V of Object.keys(u))m[[...u[V].labels].sort().join("")]=V;const A={};function x(v,T){if(!(this instanceof x))return new x(v,T);if(T&&T in B&&(T=null),T&&!(T in u))throw new Error("Unknown model: "+T);let X,f;if(null==v)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(v instanceof x)this.model=v.model,this.color=[...v.color],this.valpha=v.valpha;else if("string"===typeof v){const T=O.get(v);if(null===T)throw new Error("Unable to parse color from string: "+v);this.model=T.model,f=u[this.model].channels,this.color=T.value.slice(0,f),this.valpha="number"===typeof T.value[f]?T.value[f]:1}else if(v.length>0){this.model=T||"rgb",f=u[this.model].channels;const X=Array.prototype.slice.call(v,0,f);this.color=n(X,f),this.valpha="number"===typeof v[f]?v[f]:1}else if("number"===typeof v)this.model="rgb",this.color=[v>>16&255,v>>8&255,255&v],this.valpha=1;else{this.valpha=1;const T=Object.keys(v);"alpha"in v&&(T.splice(T.indexOf("alpha"),1),this.valpha="number"===typeof v.alpha?v.alpha:0);const O=T.sort().join("");if(!(O in m))throw new Error("Unable to parse color from object: "+JSON.stringify(v));this.model=m[O];const{labels:B}=u[this.model],A=[];for(X=0;X<B.length;X++)A.push(v[B[X]]);this.color=n(A)}if(A[this.model])for(f=u[this.model].channels,X=0;X<f;X++){const v=A[this.model][X];v&&(this.color[X]=v(this.color[X]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}x.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(v){let T=this.model in O.to?this:this.rgb();T=T.round("number"===typeof v?v:1);const X=1===T.valpha?T.color:[...T.color,this.valpha];return O.to[T.model](X)},percentString(v){const T=this.rgb().round("number"===typeof v?v:1),X=1===T.valpha?T.color:[...T.color,this.valpha];return O.to.rgb.percent(X)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const v={},{channels:T}=u[this.model],{labels:X}=u[this.model];for(let O=0;O<T;O++)v[X[O]]=this.color[O];return 1!==this.valpha&&(v.alpha=this.valpha),v},unitArray(){const v=this.rgb().color;return v[0]/=255,v[1]/=255,v[2]/=255,1!==this.valpha&&v.push(this.valpha),v},unitObject(){const v=this.rgb().object();return v.r/=255,v.g/=255,v.b/=255,1!==this.valpha&&(v.alpha=this.valpha),v},round(v){return v=Math.max(v||0,0),new x([...this.color.map(f(v)),this.valpha],this.model)},alpha(v){return void 0!==v?new x([...this.color,Math.max(0,Math.min(1,v))],this.model):this.valpha},red:M("rgb",0,H(255)),green:M("rgb",1,H(255)),blue:M("rgb",2,H(255)),hue:M(["hsl","hsv","hsl","hwb","hcg"],0,(v=>(v%360+360)%360)),saturationl:M("hsl",1,H(100)),lightness:M("hsl",2,H(100)),saturationv:M("hsv",1,H(100)),value:M("hsv",2,H(100)),chroma:M("hcg",1,H(100)),gray:M("hcg",2,H(100)),white:M("hwb",1,H(100)),wblack:M("hwb",2,H(100)),cyan:M("cmyk",0,H(100)),magenta:M("cmyk",1,H(100)),yellow:M("cmyk",2,H(100)),black:M("cmyk",3,H(100)),x:M("xyz",0,H(95.047)),y:M("xyz",1,H(100)),z:M("xyz",2,H(108.833)),l:M("lab",0,H(100)),a:M("lab",1),b:M("lab",2),keyword(v){return void 0!==v?new x(v):u[this.model].keyword(this.color)},hex(v){return void 0!==v?new x(v):O.to.hex(this.rgb().round().color)},hexa(v){if(void 0!==v)return new x(v);const T=this.rgb().round().color;let X=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===X.length&&(X="0"+X),O.to.hex(T)+X},rgbNumber(){const v=this.rgb().color;return(255&v[0])<<16|(255&v[1])<<8|255&v[2]},luminosity(){const v=this.rgb().color,T=[];for(const[X,O]of v.entries()){const v=O/255;T[X]=v<=.04045?v/12.92:((v+.055)/1.055)**2.4}return.2126*T[0]+.7152*T[1]+.0722*T[2]},contrast(v){const T=this.luminosity(),X=v.luminosity();return T>X?(T+.05)/(X+.05):(X+.05)/(T+.05)},level(v){const T=this.contrast(v);return T>=7?"AAA":T>=4.5?"AA":""},isDark(){const v=this.rgb().color;return(2126*v[0]+7152*v[1]+722*v[2])/1e4<128},isLight(){return!this.isDark()},negate(){const v=this.rgb();for(let T=0;T<3;T++)v.color[T]=255-v.color[T];return v},lighten(v){const T=this.hsl();return T.color[2]+=T.color[2]*v,T},darken(v){const T=this.hsl();return T.color[2]-=T.color[2]*v,T},saturate(v){const T=this.hsl();return T.color[1]+=T.color[1]*v,T},desaturate(v){const T=this.hsl();return T.color[1]-=T.color[1]*v,T},whiten(v){const T=this.hwb();return T.color[1]+=T.color[1]*v,T},blacken(v){const T=this.hwb();return T.color[2]+=T.color[2]*v,T},grayscale(){const v=this.rgb().color,T=.3*v[0]+.59*v[1]+.11*v[2];return x.rgb(T,T,T)},fade(v){return this.alpha(this.valpha-this.valpha*v)},opaquer(v){return this.alpha(this.valpha+this.valpha*v)},rotate(v){const T=this.hsl();let X=T.color[0];return X=(X+v)%360,X=X<0?360+X:X,T.color[0]=X,T},mix(v,T){if(!v||!v.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof v);const X=v.rgb(),O=this.rgb(),u=void 0===T?.5:T,B=2*u-1,m=X.alpha()-O.alpha(),A=((B*m===-1?B:(B+m)/(1+B*m))+1)/2,f=1-A;return x.rgb(A*X.red()+f*O.red(),A*X.green()+f*O.green(),A*X.blue()+f*O.blue(),X.alpha()*u+O.alpha()*(1-u))}};for(const V of Object.keys(u)){if(B.includes(V))continue;const{channels:v}=u[V];x.prototype[V]=function(){if(this.model===V)return new x(this);for(var v=arguments.length,T=new Array(v),X=0;X<v;X++)T[X]=arguments[X];return T.length>0?new x(T,V):new x([...(O=u[this.model][V].raw(this.color),Array.isArray(O)?O:[O]),this.valpha],V);var O},x[V]=function(){for(var T=arguments.length,X=new Array(T),O=0;O<T;O++)X[O]=arguments[O];let u=X[0];return"number"===typeof u&&(u=n(X,v)),new x(u,V)}}function f(v){return function(T){return function(v,T){return Number(v.toFixed(T))}(T,v)}}function M(v,T,X){v=Array.isArray(v)?v:[v];for(const O of v)(A[O]||(A[O]=[]))[T]=X;return v=v[0],function(O){let u;return void 0!==O?(X&&(O=X(O)),u=this[v](),u.color[T]=O,u):(u=this[v]().color[T],X&&(u=X(u)),u)}}function H(v){return function(T){return Math.max(0,Math.min(v,T))}}function n(v,T){for(let X=0;X<T;X++)"number"!==typeof v[X]&&(v[X]=0);return v}v.exports=x},12909:(v,T,X)=>{const O=X(12917),u={};for(const m of Object.keys(O))u[O[m]]=m;const B={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};v.exports=B;for(const m of Object.keys(B)){if(!("channels"in B[m]))throw new Error("missing channels property: "+m);if(!("labels"in B[m]))throw new Error("missing channel labels property: "+m);if(B[m].labels.length!==B[m].channels)throw new Error("channel and label counts mismatch: "+m);const{channels:v,labels:T}=B[m];delete B[m].channels,delete B[m].labels,Object.defineProperty(B[m],"channels",{value:v}),Object.defineProperty(B[m],"labels",{value:T})}B.rgb.hsl=function(v){const T=v[0]/255,X=v[1]/255,O=v[2]/255,u=Math.min(T,X,O),B=Math.max(T,X,O),m=B-u;let A,x;B===u?A=0:T===B?A=(X-O)/m:X===B?A=2+(O-T)/m:O===B&&(A=4+(T-X)/m),A=Math.min(60*A,360),A<0&&(A+=360);const f=(u+B)/2;return x=B===u?0:f<=.5?m/(B+u):m/(2-B-u),[A,100*x,100*f]},B.rgb.hsv=function(v){let T,X,O,u,B;const m=v[0]/255,A=v[1]/255,x=v[2]/255,f=Math.max(m,A,x),M=f-Math.min(m,A,x),H=function(v){return(f-v)/6/M+.5};return 0===M?(u=0,B=0):(B=M/f,T=H(m),X=H(A),O=H(x),m===f?u=O-X:A===f?u=1/3+T-O:x===f&&(u=2/3+X-T),u<0?u+=1:u>1&&(u-=1)),[360*u,100*B,100*f]},B.rgb.hwb=function(v){const T=v[0],X=v[1];let O=v[2];const u=B.rgb.hsl(v)[0],m=1/255*Math.min(T,Math.min(X,O));return O=1-1/255*Math.max(T,Math.max(X,O)),[u,100*m,100*O]},B.rgb.cmyk=function(v){const T=v[0]/255,X=v[1]/255,O=v[2]/255,u=Math.min(1-T,1-X,1-O);return[100*((1-T-u)/(1-u)||0),100*((1-X-u)/(1-u)||0),100*((1-O-u)/(1-u)||0),100*u]},B.rgb.keyword=function(v){const T=u[v];if(T)return T;let X,B=1/0;for(const u of Object.keys(O)){const T=O[u],x=(A=T,((m=v)[0]-A[0])**2+(m[1]-A[1])**2+(m[2]-A[2])**2);x<B&&(B=x,X=u)}var m,A;return X},B.keyword.rgb=function(v){return O[v]},B.rgb.xyz=function(v){let T=v[0]/255,X=v[1]/255,O=v[2]/255;T=T>.04045?((T+.055)/1.055)**2.4:T/12.92,X=X>.04045?((X+.055)/1.055)**2.4:X/12.92,O=O>.04045?((O+.055)/1.055)**2.4:O/12.92;return[100*(.4124*T+.3576*X+.1805*O),100*(.2126*T+.7152*X+.0722*O),100*(.0193*T+.1192*X+.9505*O)]},B.rgb.lab=function(v){const T=B.rgb.xyz(v);let X=T[0],O=T[1],u=T[2];X/=95.047,O/=100,u/=108.883,X=X>.008856?X**(1/3):7.787*X+16/116,O=O>.008856?O**(1/3):7.787*O+16/116,u=u>.008856?u**(1/3):7.787*u+16/116;return[116*O-16,500*(X-O),200*(O-u)]},B.hsl.rgb=function(v){const T=v[0]/360,X=v[1]/100,O=v[2]/100;let u,B,m;if(0===X)return m=255*O,[m,m,m];u=O<.5?O*(1+X):O+X-O*X;const A=2*O-u,x=[0,0,0];for(let f=0;f<3;f++)B=T+1/3*-(f-1),B<0&&B++,B>1&&B--,m=6*B<1?A+6*(u-A)*B:2*B<1?u:3*B<2?A+(u-A)*(2/3-B)*6:A,x[f]=255*m;return x},B.hsl.hsv=function(v){const T=v[0];let X=v[1]/100,O=v[2]/100,u=X;const B=Math.max(O,.01);O*=2,X*=O<=1?O:2-O,u*=B<=1?B:2-B;return[T,100*(0===O?2*u/(B+u):2*X/(O+X)),100*((O+X)/2)]},B.hsv.rgb=function(v){const T=v[0]/60,X=v[1]/100;let O=v[2]/100;const u=Math.floor(T)%6,B=T-Math.floor(T),m=255*O*(1-X),A=255*O*(1-X*B),x=255*O*(1-X*(1-B));switch(O*=255,u){case 0:return[O,x,m];case 1:return[A,O,m];case 2:return[m,O,x];case 3:return[m,A,O];case 4:return[x,m,O];case 5:return[O,m,A]}},B.hsv.hsl=function(v){const T=v[0],X=v[1]/100,O=v[2]/100,u=Math.max(O,.01);let B,m;m=(2-X)*O;const A=(2-X)*u;return B=X*u,B/=A<=1?A:2-A,B=B||0,m/=2,[T,100*B,100*m]},B.hwb.rgb=function(v){const T=v[0]/360;let X=v[1]/100,O=v[2]/100;const u=X+O;let B;u>1&&(X/=u,O/=u);const m=Math.floor(6*T),A=1-O;B=6*T-m,0!==(1&m)&&(B=1-B);const x=X+B*(A-X);let f,M,H;switch(m){default:case 6:case 0:f=A,M=x,H=X;break;case 1:f=x,M=A,H=X;break;case 2:f=X,M=A,H=x;break;case 3:f=X,M=x,H=A;break;case 4:f=x,M=X,H=A;break;case 5:f=A,M=X,H=x}return[255*f,255*M,255*H]},B.cmyk.rgb=function(v){const T=v[0]/100,X=v[1]/100,O=v[2]/100,u=v[3]/100;return[255*(1-Math.min(1,T*(1-u)+u)),255*(1-Math.min(1,X*(1-u)+u)),255*(1-Math.min(1,O*(1-u)+u))]},B.xyz.rgb=function(v){const T=v[0]/100,X=v[1]/100,O=v[2]/100;let u,B,m;return u=3.2406*T+-1.5372*X+-.4986*O,B=-.9689*T+1.8758*X+.0415*O,m=.0557*T+-.204*X+1.057*O,u=u>.0031308?1.055*u**(1/2.4)-.055:12.92*u,B=B>.0031308?1.055*B**(1/2.4)-.055:12.92*B,m=m>.0031308?1.055*m**(1/2.4)-.055:12.92*m,u=Math.min(Math.max(0,u),1),B=Math.min(Math.max(0,B),1),m=Math.min(Math.max(0,m),1),[255*u,255*B,255*m]},B.xyz.lab=function(v){let T=v[0],X=v[1],O=v[2];T/=95.047,X/=100,O/=108.883,T=T>.008856?T**(1/3):7.787*T+16/116,X=X>.008856?X**(1/3):7.787*X+16/116,O=O>.008856?O**(1/3):7.787*O+16/116;return[116*X-16,500*(T-X),200*(X-O)]},B.lab.xyz=function(v){let T,X,O;X=(v[0]+16)/116,T=v[1]/500+X,O=X-v[2]/200;const u=X**3,B=T**3,m=O**3;return X=u>.008856?u:(X-16/116)/7.787,T=B>.008856?B:(T-16/116)/7.787,O=m>.008856?m:(O-16/116)/7.787,T*=95.047,X*=100,O*=108.883,[T,X,O]},B.lab.lch=function(v){const T=v[0],X=v[1],O=v[2];let u;u=360*Math.atan2(O,X)/2/Math.PI,u<0&&(u+=360);return[T,Math.sqrt(X*X+O*O),u]},B.lch.lab=function(v){const T=v[0],X=v[1],O=v[2]/360*2*Math.PI;return[T,X*Math.cos(O),X*Math.sin(O)]},B.rgb.ansi16=function(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[X,O,u]=v;let m=null===T?B.rgb.hsv(v)[2]:T;if(m=Math.round(m/50),0===m)return 30;let A=30+(Math.round(u/255)<<2|Math.round(O/255)<<1|Math.round(X/255));return 2===m&&(A+=60),A},B.hsv.ansi16=function(v){return B.rgb.ansi16(B.hsv.rgb(v),v[2])},B.rgb.ansi256=function(v){const T=v[0],X=v[1],O=v[2];if(T===X&&X===O)return T<8?16:T>248?231:Math.round((T-8)/247*24)+232;return 16+36*Math.round(T/255*5)+6*Math.round(X/255*5)+Math.round(O/255*5)},B.ansi16.rgb=function(v){let T=v%10;if(0===T||7===T)return v>50&&(T+=3.5),T=T/10.5*255,[T,T,T];const X=.5*(1+~~(v>50));return[(1&T)*X*255,(T>>1&1)*X*255,(T>>2&1)*X*255]},B.ansi256.rgb=function(v){if(v>=232){const T=10*(v-232)+8;return[T,T,T]}let T;v-=16;return[Math.floor(v/36)/5*255,Math.floor((T=v%36)/6)/5*255,T%6/5*255]},B.rgb.hex=function(v){const T=(((255&Math.round(v[0]))<<16)+((255&Math.round(v[1]))<<8)+(255&Math.round(v[2]))).toString(16).toUpperCase();return"000000".substring(T.length)+T},B.hex.rgb=function(v){const T=v.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!T)return[0,0,0];let X=T[0];3===T[0].length&&(X=X.split("").map((v=>v+v)).join(""));const O=parseInt(X,16);return[O>>16&255,O>>8&255,255&O]},B.rgb.hcg=function(v){const T=v[0]/255,X=v[1]/255,O=v[2]/255,u=Math.max(Math.max(T,X),O),B=Math.min(Math.min(T,X),O),m=u-B;let A,x;return A=m<1?B/(1-m):0,x=m<=0?0:u===T?(X-O)/m%6:u===X?2+(O-T)/m:4+(T-X)/m,x/=6,x%=1,[360*x,100*m,100*A]},B.hsl.hcg=function(v){const T=v[1]/100,X=v[2]/100,O=X<.5?2*T*X:2*T*(1-X);let u=0;return O<1&&(u=(X-.5*O)/(1-O)),[v[0],100*O,100*u]},B.hsv.hcg=function(v){const T=v[1]/100,X=v[2]/100,O=T*X;let u=0;return O<1&&(u=(X-O)/(1-O)),[v[0],100*O,100*u]},B.hcg.rgb=function(v){const T=v[0]/360,X=v[1]/100,O=v[2]/100;if(0===X)return[255*O,255*O,255*O];const u=[0,0,0],B=T%1*6,m=B%1,A=1-m;let x=0;switch(Math.floor(B)){case 0:u[0]=1,u[1]=m,u[2]=0;break;case 1:u[0]=A,u[1]=1,u[2]=0;break;case 2:u[0]=0,u[1]=1,u[2]=m;break;case 3:u[0]=0,u[1]=A,u[2]=1;break;case 4:u[0]=m,u[1]=0,u[2]=1;break;default:u[0]=1,u[1]=0,u[2]=A}return x=(1-X)*O,[255*(X*u[0]+x),255*(X*u[1]+x),255*(X*u[2]+x)]},B.hcg.hsv=function(v){const T=v[1]/100,X=T+v[2]/100*(1-T);let O=0;return X>0&&(O=T/X),[v[0],100*O,100*X]},B.hcg.hsl=function(v){const T=v[1]/100,X=v[2]/100*(1-T)+.5*T;let O=0;return X>0&&X<.5?O=T/(2*X):X>=.5&&X<1&&(O=T/(2*(1-X))),[v[0],100*O,100*X]},B.hcg.hwb=function(v){const T=v[1]/100,X=T+v[2]/100*(1-T);return[v[0],100*(X-T),100*(1-X)]},B.hwb.hcg=function(v){const T=v[1]/100,X=1-v[2]/100,O=X-T;let u=0;return O<1&&(u=(X-O)/(1-O)),[v[0],100*O,100*u]},B.apple.rgb=function(v){return[v[0]/65535*255,v[1]/65535*255,v[2]/65535*255]},B.rgb.apple=function(v){return[v[0]/255*65535,v[1]/255*65535,v[2]/255*65535]},B.gray.rgb=function(v){return[v[0]/100*255,v[0]/100*255,v[0]/100*255]},B.gray.hsl=function(v){return[0,0,v[0]]},B.gray.hsv=B.gray.hsl,B.gray.hwb=function(v){return[0,100,v[0]]},B.gray.cmyk=function(v){return[0,0,0,v[0]]},B.gray.lab=function(v){return[v[0],0,0]},B.gray.hex=function(v){const T=255&Math.round(v[0]/100*255),X=((T<<16)+(T<<8)+T).toString(16).toUpperCase();return"000000".substring(X.length)+X},B.rgb.gray=function(v){return[(v[0]+v[1]+v[2])/3/255*100]}},12902:(v,T,X)=>{const O=X(12909),u=X(12919),B={};Object.keys(O).forEach((v=>{B[v]={},Object.defineProperty(B[v],"channels",{value:O[v].channels}),Object.defineProperty(B[v],"labels",{value:O[v].labels});const T=u(v);Object.keys(T).forEach((X=>{const O=T[X];B[v][X]=function(v){const T=function(){for(var T=arguments.length,X=new Array(T),O=0;O<T;O++)X[O]=arguments[O];const u=X[0];if(void 0===u||null===u)return u;u.length>1&&(X=u);const B=v(X);if("object"===typeof B)for(let v=B.length,m=0;m<v;m++)B[m]=Math.round(B[m]);return B};return"conversion"in v&&(T.conversion=v.conversion),T}(O),B[v][X].raw=function(v){const T=function(){for(var T=arguments.length,X=new Array(T),O=0;O<T;O++)X[O]=arguments[O];const u=X[0];return void 0===u||null===u?u:(u.length>1&&(X=u),v(X))};return"conversion"in v&&(T.conversion=v.conversion),T}(O)}))})),v.exports=B},12919:(v,T,X)=>{const O=X(12909);function u(v){const T=function(){const v={},T=Object.keys(O);for(let X=T.length,O=0;O<X;O++)v[T[O]]={distance:-1,parent:null};return v}(),X=[v];for(T[v].distance=0;X.length;){const v=X.pop(),u=Object.keys(O[v]);for(let O=u.length,B=0;B<O;B++){const O=u[B],m=T[O];-1===m.distance&&(m.distance=T[v].distance+1,m.parent=v,X.unshift(O))}}return T}function B(v,T){return function(X){return T(v(X))}}function m(v,T){const X=[T[v].parent,v];let u=O[T[v].parent][v],m=T[v].parent;for(;T[m].parent;)X.unshift(T[m].parent),u=B(O[T[m].parent][m],u),m=T[m].parent;return u.conversion=X,u}v.exports=function(v){const T=u(v),X={},O=Object.keys(T);for(let u=O.length,B=0;B<u;B++){const v=O[B];null!==T[v].parent&&(X[v]=m(v,T))}return X}},12917:v=>{"use strict";v.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},11706:function(v,T,X){"use strict";var O=this&&this.__createBinding||(Object.create?function(v,T,X,O){void 0===O&&(O=X);var u=Object.getOwnPropertyDescriptor(T,X);u&&!("get"in u?!T.__esModule:u.writable||u.configurable)||(u={enumerable:!0,get:function(){return T[X]}}),Object.defineProperty(v,O,u)}:function(v,T,X,O){void 0===O&&(O=X),v[O]=T[X]}),u=this&&this.__setModuleDefault||(Object.create?function(v,T){Object.defineProperty(v,"default",{enumerable:!0,value:T})}:function(v,T){v.default=T}),B=this&&this.__importStar||function(v){if(v&&v.__esModule)return v;var T={};if(null!=v)for(var X in v)"default"!==X&&Object.prototype.hasOwnProperty.call(v,X)&&O(T,v,X);return u(T,v),T},m=this&&this.__awaiter||function(v,T,X,O){return new(X||(X=Promise))((function(u,B){function m(v){try{x(O.next(v))}catch(T){B(T)}}function A(v){try{x(O.throw(v))}catch(T){B(T)}}function x(v){var T;v.done?u(v.value):(T=v.value,T instanceof X?T:new X((function(v){v(T)}))).then(m,A)}x((O=O.apply(v,T||[])).next())}))};Object.defineProperty(T,"__esModule",{value:!0}),T.Auth=T.Platform=void 0;const A=B(X(11652)),x=X(11709),f="colyseus-auth-token";!function(v){v.ios="ios",v.android="android"}(T.Platform||(T.Platform={}));T.Auth=class{constructor(v){this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=v.replace("ws","http"),(0,x.getItem)(f,(v=>this.token=v))}get hasToken(){return!!this.token}login(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return m(this,void 0,void 0,(function*(){const T=Object.assign({},v);this.hasToken&&(T.token=this.token);const X=yield this.request("post","/auth",T);this.token=X.token,(0,x.setItem)(f,this.token);for(let v in X)this.hasOwnProperty(v)&&(this[v]=X[v]);return this.registerPingService(),this}))}save(){return m(this,void 0,void 0,(function*(){return yield this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone}),this}))}getFriends(){return m(this,void 0,void 0,(function*(){return yield this.request("get","/friends/all")}))}getOnlineFriends(){return m(this,void 0,void 0,(function*(){return yield this.request("get","/friends/online")}))}getFriendRequests(){return m(this,void 0,void 0,(function*(){return yield this.request("get","/friends/requests")}))}sendFriendRequest(v){return m(this,void 0,void 0,(function*(){return yield this.request("post","/friends/requests",{userId:v})}))}acceptFriendRequest(v){return m(this,void 0,void 0,(function*(){return yield this.request("put","/friends/requests",{userId:v})}))}declineFriendRequest(v){return m(this,void 0,void 0,(function*(){return yield this.request("del","/friends/requests",{userId:v})}))}blockUser(v){return m(this,void 0,void 0,(function*(){return yield this.request("post","/friends/block",{userId:v})}))}unblockUser(v){return m(this,void 0,void 0,(function*(){return yield this.request("put","/friends/block",{userId:v})}))}request(v,T){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},O=arguments.length>3?arguments[3]:void 0,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return m(this,void 0,void 0,(function*(){u.Accept="application/json",this.hasToken&&(u.Authorization="Bearer "+this.token);const B=[];for(const v in X)B.push(`${v}=${X[v]}`);const m=B.length>0?`?${B.join("&")}`:"",x={headers:u};return O&&(x.body=O),(yield A[v](`${this.endpoint}${T}${m}`,x)).data}))}logout(){this.token=void 0,(0,x.removeItem)(f),this.unregisterPingService()}registerPingService(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;this.unregisterPingService(),this.keepOnlineInterval=setInterval((()=>this.request("get","/auth")),v)}unregisterPingService(){clearInterval(this.keepOnlineInterval)}}},11647:function(v,T,X){"use strict";var O,u=this&&this.__awaiter||function(v,T,X,O){return new(X||(X=Promise))((function(u,B){function m(v){try{x(O.next(v))}catch(T){B(T)}}function A(v){try{x(O.throw(v))}catch(T){B(T)}}function x(v){var T;v.done?u(v.value):(T=v.value,T instanceof X?T:new X((function(v){v(T)}))).then(m,A)}x((O=O.apply(v,T||[])).next())}))};Object.defineProperty(T,"__esModule",{value:!0}),T.Client=T.MatchMakeError=void 0;const B=X(11652),m=X(11655),A=X(11659);class x extends Error{constructor(v,T){super(v),this.code=T,Object.setPrototypeOf(this,x.prototype)}}T.MatchMakeError=x;const f="undefined"!==typeof window&&"undefined"!==typeof(null===(O=null===window||void 0===window?void 0:window.location)||void 0===O?void 0:O.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";T.Client=class{constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f;if("string"===typeof v){const T=new URL(v),X="https:"===T.protocol||"wss:"===T.protocol,O=Number(T.port||(X?443:80));this.settings={hostname:T.hostname,pathname:"/"!==T.pathname?T.pathname:"",port:O,secure:X}}else void 0===v.port&&(v.port=v.secure?443:80),void 0===v.pathname&&(v.pathname=""),this.settings=v}joinOrCreate(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},X=arguments.length>2?arguments[2]:void 0;return u(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",v,T,X)}))}create(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},X=arguments.length>2?arguments[2]:void 0;return u(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",v,T,X)}))}join(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},X=arguments.length>2?arguments[2]:void 0;return u(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",v,T,X)}))}joinById(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},X=arguments.length>2?arguments[2]:void 0;return u(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",v,T,X)}))}reconnect(v,T){return u(this,void 0,void 0,(function*(){if("string"===typeof v&&"string"===typeof T)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[X,O]=v.split(":");return yield this.createMatchMakeRequest("reconnect",X,{reconnectionToken:O},T)}))}getAvailableRooms(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return u(this,void 0,void 0,(function*(){return(yield(0,B.get)(this.getHttpEndpoint(`${v}`),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(v,T,X){return u(this,void 0,void 0,(function*(){const O=this.createRoom(v.room.name,T);O.roomId=v.room.roomId,O.sessionId=v.sessionId;const B={sessionId:O.sessionId};v.reconnectionToken&&(B.reconnectionToken=v.reconnectionToken);const A=X||O;return O.connect(this.buildEndpoint(v.room,B),v.devMode&&(()=>u(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${O.roomId}'...`);let X=0;const B=()=>u(this,void 0,void 0,(function*(){X++;try{yield this.consumeSeatReservation(v,T,A),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${O.roomId}'`)}catch(u){X<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${X} out of 8)`),setTimeout(B,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(B,2e3)}))),A),new Promise(((v,T)=>{const X=(v,X)=>T(new m.ServerError(v,X));A.onError.once(X),A.onJoin.once((()=>{A.onError.remove(X),v(A)}))}))}))}createMatchMakeRequest(v,T){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},O=arguments.length>3?arguments[3]:void 0,m=arguments.length>4?arguments[4]:void 0;return u(this,void 0,void 0,(function*(){const u=(yield(0,B.post)(this.getHttpEndpoint(`${v}/${T}`),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(X)})).data;if(u.error)throw new x(u.error,u.code);return"reconnect"===v&&(u.reconnectionToken=X.reconnectionToken),yield this.consumeSeatReservation(u,O,m)}))}createRoom(v,T){return new A.Room(v,T)}buildEndpoint(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const X=[];for(const u in T)T.hasOwnProperty(u)&&X.push(`${u}=${T[u]}`);let O=this.settings.secure?"wss://":"ws://";return v.publicAddress?O+=`${v.publicAddress}`:O+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`,`${O}/${v.processId}/${v.roomId}?${X.join("&")}`}getHttpEndpoint(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}/matchmake/${v}`}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},11669:(v,T,X)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.Connection=void 0;const O=X(11672);T.Connection=class{constructor(){this.events={},this.transport=new O.WebSocketTransport(this.events)}send(v){this.transport.send(v)}connect(v){this.transport.connect(v)}close(v,T){this.transport.close(v,T)}get isOpen(){return this.transport.isOpen}}},11680:(v,T)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.utf8Length=T.utf8Read=T.ErrorCode=T.Protocol=void 0,function(v){v[v.HANDSHAKE=9]="HANDSHAKE",v[v.JOIN_ROOM=10]="JOIN_ROOM",v[v.ERROR=11]="ERROR",v[v.LEAVE_ROOM=12]="LEAVE_ROOM",v[v.ROOM_DATA=13]="ROOM_DATA",v[v.ROOM_STATE=14]="ROOM_STATE",v[v.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",v[v.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",v[v.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(T.Protocol||(T.Protocol={})),function(v){v[v.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",v[v.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",v[v.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",v[v.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",v[v.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",v[v.AUTH_FAILED=4215]="AUTH_FAILED",v[v.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(T.ErrorCode||(T.ErrorCode={})),T.utf8Read=function(v,T){const X=v[T++];for(var O="",u=0,B=T,m=T+X;B<m;B++){var A=v[B];if(0!==(128&A))if(192!==(224&A))if(224!==(240&A)){if(240!==(248&A))throw new Error("Invalid byte "+A.toString(16));(u=(7&A)<<18|(63&v[++B])<<12|(63&v[++B])<<6|63&v[++B])>=65536?(u-=65536,O+=String.fromCharCode(55296+(u>>>10),56320+(1023&u))):O+=String.fromCharCode(u)}else O+=String.fromCharCode((15&A)<<12|(63&v[++B])<<6|63&v[++B]);else O+=String.fromCharCode((31&A)<<6|63&v[++B]);else O+=String.fromCharCode(A)}return O},T.utf8Length=function(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",T=0,X=0;for(let O=0,u=v.length;O<u;O++)T=v.charCodeAt(O),T<128?X+=1:T<2048?X+=2:T<55296||T>=57344?X+=3:(O++,X+=4);return X+1}},11659:function(v,T,X){"use strict";var O=this&&this.__createBinding||(Object.create?function(v,T,X,O){void 0===O&&(O=X);var u=Object.getOwnPropertyDescriptor(T,X);u&&!("get"in u?!T.__esModule:u.writable||u.configurable)||(u={enumerable:!0,get:function(){return T[X]}}),Object.defineProperty(v,O,u)}:function(v,T,X,O){void 0===O&&(O=X),v[O]=T[X]}),u=this&&this.__setModuleDefault||(Object.create?function(v,T){Object.defineProperty(v,"default",{enumerable:!0,value:T})}:function(v,T){v.default=T}),B=this&&this.__importStar||function(v){if(v&&v.__esModule)return v;var T={};if(null!=v)for(var X in v)"default"!==X&&Object.prototype.hasOwnProperty.call(v,X)&&O(T,v,X);return u(T,v),T};Object.defineProperty(T,"__esModule",{value:!0}),T.Room=void 0;const m=B(X(11665)),A=X(11669),x=X(11680),f=X(11684),M=X(11686),H=X(11691),n=X(11697),V=X(11655);class D{constructor(v,T){this.onStateChange=(0,H.createSignal)(),this.onError=(0,H.createSignal)(),this.onLeave=(0,H.createSignal)(),this.onJoin=(0,H.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,M.createNanoEvents)(),this.roomId=null,this.name=v,T&&(this.serializer=new((0,f.getSerializer)("schema")),this.rootSchema=T,this.serializer.state=new T),this.onError(((v,T)=>{var X;return null===(X=console.warn)||void 0===X?void 0:X.call(console,`colyseus.js - onError => (${v}) ${T}`)})),this.onLeave((()=>this.removeAllListeners()))}get id(){return this.roomId}connect(v,T){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;const O=new A.Connection;X.connection=O,O.events.onmessage=D.prototype.onMessageCallback.bind(X),O.events.onclose=function(v){var O;if(!X.hasJoined)return null===(O=console.warn)||void 0===O||O.call(console,`Room connection was closed unexpectedly (${v.code}): ${v.reason}`),void X.onError.invoke(v.code,v.reason);v.code===V.CloseCode.DEVMODE_RESTART&&T?T():(X.onLeave.invoke(v.code),X.destroy())},O.events.onerror=function(v){var T;null===(T=console.warn)||void 0===T||T.call(console,`Room, onError (${v.code}): ${v.reason}`),X.onError.invoke(v.code,v.reason)},O.connect(v)}leave(){let v=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((T=>{this.onLeave((v=>T(v))),this.connection?v?this.connection.send([x.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(V.CloseCode.CONSENTED)}))}onMessage(v,T){return this.onMessageHandlers.on(this.getMessageHandlerKey(v),T)}send(v,T){const X=[x.Protocol.ROOM_DATA];let O;if("string"===typeof v?n.encode.string(X,v):n.encode.number(X,v),void 0!==T){const v=m.encode(T);O=new Uint8Array(X.length+v.byteLength),O.set(new Uint8Array(X),0),O.set(new Uint8Array(v),X.length)}else O=new Uint8Array(X);this.connection.send(O.buffer)}sendBytes(v,T){const X=[x.Protocol.ROOM_DATA_BYTES];let O;"string"===typeof v?n.encode.string(X,v):n.encode.number(X,v),O=new Uint8Array(X.length+(T.byteLength||T.length)),O.set(new Uint8Array(X),0),O.set(new Uint8Array(T),X.length),this.connection.send(O.buffer)}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(v){const T=Array.from(new Uint8Array(v.data)),X=T[0];if(X===x.Protocol.JOIN_ROOM){let v=1;const X=(0,x.utf8Read)(T,v);if(v+=(0,x.utf8Length)(X),this.serializerId=(0,x.utf8Read)(T,v),v+=(0,x.utf8Length)(this.serializerId),!this.serializer){const v=(0,f.getSerializer)(this.serializerId);this.serializer=new v}T.length>v&&this.serializer.handshake&&this.serializer.handshake(T,{offset:v}),this.reconnectionToken=`${this.roomId}:${X}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([x.Protocol.JOIN_ROOM])}else if(X===x.Protocol.ERROR){const v={offset:1},X=n.decode.number(T,v),O=n.decode.string(T,v);this.onError.invoke(X,O)}else if(X===x.Protocol.LEAVE_ROOM)this.leave();else if(X===x.Protocol.ROOM_DATA_SCHEMA){const v={offset:1},X=this.serializer.getState().constructor._context.get(n.decode.number(T,v)),O=new X;O.decode(T,v),this.dispatchMessage(X,O)}else if(X===x.Protocol.ROOM_STATE)T.shift(),this.setState(T);else if(X===x.Protocol.ROOM_STATE_PATCH)T.shift(),this.patch(T);else if(X===x.Protocol.ROOM_DATA){const X={offset:1},O=n.decode.stringCheck(T,X)?n.decode.string(T,X):n.decode.number(T,X),u=T.length>X.offset?m.decode(v.data,X.offset):void 0;this.dispatchMessage(O,u)}else if(X===x.Protocol.ROOM_DATA_BYTES){const v={offset:1},X=n.decode.stringCheck(T,v)?n.decode.string(T,v):n.decode.number(T,v);this.dispatchMessage(X,new Uint8Array(T.slice(v.offset)))}}setState(v){this.serializer.setState(v),this.onStateChange.invoke(this.serializer.getState())}patch(v){this.serializer.patch(v),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(v,T){var X;const O=this.getMessageHandlerKey(v);this.onMessageHandlers.events[O]?this.onMessageHandlers.emit(O,T):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",v,T):null===(X=console.warn)||void 0===X||X.call(console,`colyseus.js: onMessage() not registered for type '${v}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(v){switch(typeof v){case"function":return`$${v._typeid}`;case"string":return v;case"number":return`i${v}`;default:throw new Error("invalid message type.")}}}T.Room=D},11709:(v,T)=>{"use strict";let X;function O(){return X||(X="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!==typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(v,T){this.cache[v]=T},getItem:function(v){this.cache[v]},removeItem:function(v){delete this.cache[v]}}),X}Object.defineProperty(T,"__esModule",{value:!0}),T.getItem=T.removeItem=T.setItem=void 0,T.setItem=function(v,T){O().setItem(v,T)},T.removeItem=function(v){O().removeItem(v)},T.getItem=function(v,T){const X=O().getItem(v);"undefined"!==typeof Promise&&X instanceof Promise?X.then((v=>T(v))):T(X)}},11686:(v,T)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.createNanoEvents=void 0;T.createNanoEvents=()=>({emit(v){let T=this.events[v]||[];for(var X=arguments.length,O=new Array(X>1?X-1:0),u=1;u<X;u++)O[u-1]=arguments[u];for(let B=0,m=T.length;B<m;B++)T[B](...O)},events:{},on(v,T){var X;return(null===(X=this.events[v])||void 0===X?void 0:X.push(T))||(this.events[v]=[T]),()=>{var X;this.events[v]=null===(X=this.events[v])||void 0===X?void 0:X.filter((v=>T!==v))}}})},11691:(v,T)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.createSignal=T.EventEmitter=void 0;class X{constructor(){this.handlers=[]}register(v){return this.handlers.push(v),this}invoke(){for(var v=arguments.length,T=new Array(v),X=0;X<v;X++)T[X]=arguments[X];this.handlers.forEach((v=>v.apply(this,T)))}invokeAsync(){for(var v=arguments.length,T=new Array(v),X=0;X<v;X++)T[X]=arguments[X];return Promise.all(this.handlers.map((v=>v.apply(this,T))))}remove(v){const T=this.handlers.indexOf(v);this.handlers[T]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}T.EventEmitter=X,T.createSignal=function(){const v=new X;function T(T){return v.register(T,null===this)}return T.once=T=>{const X=function(){for(var O=arguments.length,u=new Array(O),B=0;B<O;B++)u[B]=arguments[B];T.apply(this,u),v.remove(X)};v.register(X)},T.remove=T=>v.remove(T),T.invoke=function(){return v.invoke(...arguments)},T.invokeAsync=function(){return v.invokeAsync(...arguments)},T.clear=()=>v.clear(),T}},11655:(v,T)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.ServerError=T.CloseCode=void 0,function(v){v[v.CONSENTED=4e3]="CONSENTED",v[v.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(T.CloseCode||(T.CloseCode={}));class X extends Error{constructor(v,T){super(T),this.name="ServerError",this.code=v}}T.ServerError=X},11638:(v,T,X)=>{"use strict";T.b=void 0,X(11640);var O=X(11647);Object.defineProperty(T,"b",{enumerable:!0,get:function(){return O.Client}});var u=X(11680);var B=X(11659);var m=X(11706);const A=X(11715);const x=X(11723),f=X(11684);(0,f.registerSerializer)("schema",A.SchemaSerializer),(0,f.registerSerializer)("none",x.NoneSerializer)},11640:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=v=>null!==v&&"object"===typeof v&&v.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},11665:(v,T)=>{"use strict";function X(v,T){if(this._offset=T,v instanceof ArrayBuffer)this._buffer=v,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(v))throw new Error("Invalid argument");this._buffer=v.buffer,this._view=new DataView(this._buffer,v.byteOffset,v.byteLength)}}Object.defineProperty(T,"__esModule",{value:!0}),T.decode=T.encode=void 0,X.prototype._array=function(v){for(var T=new Array(v),X=0;X<v;X++)T[X]=this._parse();return T},X.prototype._map=function(v){for(var T={},X=0;X<v;X++)T[this._parse()]=this._parse();return T},X.prototype._str=function(v){var T=function(v,T,X){for(var O="",u=0,B=T,m=T+X;B<m;B++){var A=v.getUint8(B);if(0!==(128&A))if(192!==(224&A))if(224!==(240&A)){if(240!==(248&A))throw new Error("Invalid byte "+A.toString(16));(u=(7&A)<<18|(63&v.getUint8(++B))<<12|(63&v.getUint8(++B))<<6|63&v.getUint8(++B))>=65536?(u-=65536,O+=String.fromCharCode(55296+(u>>>10),56320+(1023&u))):O+=String.fromCharCode(u)}else O+=String.fromCharCode((15&A)<<12|(63&v.getUint8(++B))<<6|63&v.getUint8(++B));else O+=String.fromCharCode((31&A)<<6|63&v.getUint8(++B));else O+=String.fromCharCode(A)}return O}(this._view,this._offset,v);return this._offset+=v,T},X.prototype._bin=function(v){var T=this._buffer.slice(this._offset,this._offset+v);return this._offset+=v,T},X.prototype._parse=function(){var v,T=this._view.getUint8(this._offset++),X=0,O=0,u=0,B=0;if(T<192)return T<128?T:T<144?this._map(15&T):T<160?this._array(15&T):this._str(31&T);if(T>223)return-1*(255-T+1);switch(T){case 192:return null;case 194:return!1;case 195:return!0;case 196:return X=this._view.getUint8(this._offset),this._offset+=1,this._bin(X);case 197:return X=this._view.getUint16(this._offset),this._offset+=2,this._bin(X);case 198:return X=this._view.getUint32(this._offset),this._offset+=4,this._bin(X);case 199:if(X=this._view.getUint8(this._offset),O=this._view.getInt8(this._offset+1),this._offset+=2,-1===O){var m=this._view.getUint32(this._offset);return u=this._view.getInt32(this._offset+4),B=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*u+B)+m/1e6)}return[O,this._bin(X)];case 200:return X=this._view.getUint16(this._offset),O=this._view.getInt8(this._offset+2),this._offset+=3,[O,this._bin(X)];case 201:return X=this._view.getUint32(this._offset),O=this._view.getInt8(this._offset+4),this._offset+=5,[O,this._bin(X)];case 202:return v=this._view.getFloat32(this._offset),this._offset+=4,v;case 203:return v=this._view.getFloat64(this._offset),this._offset+=8,v;case 204:return v=this._view.getUint8(this._offset),this._offset+=1,v;case 205:return v=this._view.getUint16(this._offset),this._offset+=2,v;case 206:return v=this._view.getUint32(this._offset),this._offset+=4,v;case 207:return u=this._view.getUint32(this._offset)*Math.pow(2,32),B=this._view.getUint32(this._offset+4),this._offset+=8,u+B;case 208:return v=this._view.getInt8(this._offset),this._offset+=1,v;case 209:return v=this._view.getInt16(this._offset),this._offset+=2,v;case 210:return v=this._view.getInt32(this._offset),this._offset+=4,v;case 211:return u=this._view.getInt32(this._offset)*Math.pow(2,32),B=this._view.getUint32(this._offset+4),this._offset+=8,u+B;case 212:return O=this._view.getInt8(this._offset),this._offset+=1,0===O?void(this._offset+=1):[O,this._bin(1)];case 213:return O=this._view.getInt8(this._offset),this._offset+=1,[O,this._bin(2)];case 214:return O=this._view.getInt8(this._offset),this._offset+=1,-1===O?(v=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*v)):[O,this._bin(4)];case 215:return O=this._view.getInt8(this._offset),this._offset+=1,0===O?(u=this._view.getInt32(this._offset)*Math.pow(2,32),B=this._view.getUint32(this._offset+4),this._offset+=8,new Date(u+B)):-1===O?(u=this._view.getUint32(this._offset),B=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&u)+B)+(u>>>2)/1e6)):[O,this._bin(8)];case 216:return O=this._view.getInt8(this._offset),this._offset+=1,[O,this._bin(16)];case 217:return X=this._view.getUint8(this._offset),this._offset+=1,this._str(X);case 218:return X=this._view.getUint16(this._offset),this._offset+=2,this._str(X);case 219:return X=this._view.getUint32(this._offset),this._offset+=4,this._str(X);case 220:return X=this._view.getUint16(this._offset),this._offset+=2,this._array(X);case 221:return X=this._view.getUint32(this._offset),this._offset+=4,this._array(X);case 222:return X=this._view.getUint16(this._offset),this._offset+=2,this._map(X);case 223:return X=this._view.getUint32(this._offset),this._offset+=4,this._map(X)}throw new Error("Could not parse")},T.decode=function(v){var T=new X(v,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),O=T._parse();if(T._offset!==v.byteLength)throw new Error(v.byteLength-T._offset+" trailing bytes");return O};function O(v,T,X){for(var O=0,u=0,B=X.length;u<B;u++)(O=X.charCodeAt(u))<128?v.setUint8(T++,O):O<2048?(v.setUint8(T++,192|O>>6),v.setUint8(T++,128|63&O)):O<55296||O>=57344?(v.setUint8(T++,224|O>>12),v.setUint8(T++,128|O>>6&63),v.setUint8(T++,128|63&O)):(u++,O=65536+((1023&O)<<10|1023&X.charCodeAt(u)),v.setUint8(T++,240|O>>18),v.setUint8(T++,128|O>>12&63),v.setUint8(T++,128|O>>6&63),v.setUint8(T++,128|63&O))}function u(v,T,X){var O=typeof X,B=0,m=0,A=0,x=0,f=0,M=0;if("string"===O){if(f=function(v){for(var T=0,X=0,O=0,u=v.length;O<u;O++)(T=v.charCodeAt(O))<128?X+=1:T<2048?X+=2:T<55296||T>=57344?X+=3:(O++,X+=4);return X}(X),f<32)v.push(160|f),M=1;else if(f<256)v.push(217,f),M=2;else if(f<65536)v.push(218,f>>8,f),M=3;else{if(!(f<4294967296))throw new Error("String too long");v.push(219,f>>24,f>>16,f>>8,f),M=5}return T.push({_str:X,_length:f,_offset:v.length}),M+f}if("number"===O)return Math.floor(X)===X&&isFinite(X)?X>=0?X<128?(v.push(X),1):X<256?(v.push(204,X),2):X<65536?(v.push(205,X>>8,X),3):X<4294967296?(v.push(206,X>>24,X>>16,X>>8,X),5):(A=X/Math.pow(2,32)|0,x=X>>>0,v.push(207,A>>24,A>>16,A>>8,A,x>>24,x>>16,x>>8,x),9):X>=-32?(v.push(X),1):X>=-128?(v.push(208,X),2):X>=-32768?(v.push(209,X>>8,X),3):X>=-2147483648?(v.push(210,X>>24,X>>16,X>>8,X),5):(A=Math.floor(X/Math.pow(2,32)),x=X>>>0,v.push(211,A>>24,A>>16,A>>8,A,x>>24,x>>16,x>>8,x),9):(v.push(203),T.push({_float:X,_length:8,_offset:v.length}),9);if("object"===O){if(null===X)return v.push(192),1;if(Array.isArray(X)){if((f=X.length)<16)v.push(144|f),M=1;else if(f<65536)v.push(220,f>>8,f),M=3;else{if(!(f<4294967296))throw new Error("Array too large");v.push(221,f>>24,f>>16,f>>8,f),M=5}for(B=0;B<f;B++)M+=u(v,T,X[B]);return M}if(X instanceof Date){var H=X.getTime(),n=Math.floor(H/1e3),V=1e6*(H-1e3*n);return n>=0&&V>=0&&n<=17179869183?0===V&&n<=4294967295?(v.push(214,255,n>>24,n>>16,n>>8,n),6):(A=n/4294967296,x=4294967295&n,v.push(215,255,V>>22,V>>14,V>>6,A,x>>24,x>>16,x>>8,x),10):(A=Math.floor(n/4294967296),x=n>>>0,v.push(199,12,255,V>>24,V>>16,V>>8,V,A>>24,A>>16,A>>8,A,x>>24,x>>16,x>>8,x),15)}if(X instanceof ArrayBuffer){if((f=X.byteLength)<256)v.push(196,f),M=2;else if(f<65536)v.push(197,f>>8,f),M=3;else{if(!(f<4294967296))throw new Error("Buffer too large");v.push(198,f>>24,f>>16,f>>8,f),M=5}return T.push({_bin:X,_length:f,_offset:v.length}),M+f}if("function"===typeof X.toJSON)return u(v,T,X.toJSON());var D=[],s="",F=Object.keys(X);for(B=0,m=F.length;B<m;B++)void 0!==X[s=F[B]]&&"function"!==typeof X[s]&&D.push(s);if((f=D.length)<16)v.push(128|f),M=1;else if(f<65536)v.push(222,f>>8,f),M=3;else{if(!(f<4294967296))throw new Error("Object too large");v.push(223,f>>24,f>>16,f>>8,f),M=5}for(B=0;B<f;B++)M+=u(v,T,s=D[B]),M+=u(v,T,X[s]);return M}if("boolean"===O)return v.push(X?195:194),1;if("undefined"===O)return v.push(192),1;if("function"===typeof X.toJSON)return u(v,T,X.toJSON());throw new Error("Could not encode")}T.encode=function(v){var T=[],X=[],B=u(T,X,v),m=new ArrayBuffer(B),A=new DataView(m),x=0,f=0,M=-1;X.length>0&&(M=X[0]._offset);for(var H,n=0,V=0,D=0,s=T.length;D<s;D++)if(A.setUint8(f+D,T[D]),D+1===M){if(n=(H=X[x])._length,V=f+M,H._bin)for(var F=new Uint8Array(H._bin),k=0;k<n;k++)A.setUint8(V+k,F[k]);else H._str?O(A,V,H._str):void 0!==H._float&&A.setFloat64(V,H._float);f+=n,X[++x]&&(M=X[x]._offset)}return m}},11723:(v,T)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.NoneSerializer=void 0;T.NoneSerializer=class{setState(v){}getState(){return null}patch(v){}teardown(){}handshake(v){}}},11715:(v,T,X)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.SchemaSerializer=void 0;const O=X(11697);T.SchemaSerializer=class{setState(v){return this.state.decode(v)}getState(){return this.state}patch(v){return this.state.decode(v)}teardown(){var v,T;null===(T=null===(v=this.state)||void 0===v?void 0:v.$changes)||void 0===T||T.root.clearRefs()}handshake(v,T){if(this.state){(new O.Reflection).decode(v,T)}else this.state=O.Reflection.decode(v,T)}}},11684:(v,T)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.getSerializer=T.registerSerializer=void 0;const X={};T.registerSerializer=function(v,T){X[v]=T},T.getSerializer=function(v){const T=X[v];if(!T)throw new Error("missing serializer: "+v);return T}},11672:function(v,T,X){"use strict";var O=this&&this.__importDefault||function(v){return v&&v.__esModule?v:{default:v}};Object.defineProperty(T,"__esModule",{value:!0}),T.WebSocketTransport=void 0;const u=O(X(11677)),B=globalThis.WebSocket||u.default;T.WebSocketTransport=class{constructor(v){this.events=v}send(v){v instanceof ArrayBuffer?this.ws.send(v):Array.isArray(v)&&this.ws.send(new Uint8Array(v).buffer)}connect(v){this.ws=new B(v,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(v,T){this.ws.close(v,T)}get isOpen(){return this.ws.readyState===B.OPEN}}},11677:v=>{"use strict";v.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},11773:v=>{"use strict";v.exports=function(v){for(var T=new Array(v),X=0;X<v;++X)T[X]=X;return T}},11778:v=>{function T(v){return!!v.constructor&&"function"===typeof v.constructor.isBuffer&&v.constructor.isBuffer(v)}v.exports=function(v){return null!=v&&(T(v)||function(v){return"function"===typeof v.readFloatLE&&"function"===typeof v.slice&&T(v.slice(0,0))}(v)||!!v._isBuffer)}},11771:(v,T,X)=>{var O=X(11773),u=X(11778),B="undefined"!==typeof Float64Array;function m(v,T){return v[0]-T[0]}function A(){var v,T=this.stride,X=new Array(T.length);for(v=0;v<X.length;++v)X[v]=[Math.abs(T[v]),v];X.sort(m);var O=new Array(X.length);for(v=0;v<O.length;++v)O[v]=X[v][1];return O}function x(v,T){var X=["View",T,"d",v].join("");T<0&&(X="View_Nil"+v);var u="generic"===v;if(-1===T){var B="function "+X+"(a){this.data=a;};var proto="+X+".prototype;proto.dtype='"+v+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+X+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+X+"(a){return new "+X+"(a);}";return new Function(B)()}if(0===T){B="function "+X+"(a,d) {this.data = a;this.offset = d};var proto="+X+".prototype;proto.dtype='"+v+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+X+"_copy() {return new "+X+"(this.data,this.offset)};proto.pick=function "+X+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+X+"_get(){return "+(u?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+X+"_set(v){return "+(u?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+X+"(a,b,c,d){return new "+X+"(a,d)}";return new Function("TrivialArray",B)(f[v][0])}B=["'use strict'"];var m=O(T),x=m.map((function(v){return"i"+v})),M="this.offset+"+m.map((function(v){return"this.stride["+v+"]*i"+v})).join("+"),H=m.map((function(v){return"b"+v})).join(","),n=m.map((function(v){return"c"+v})).join(",");B.push("function "+X+"(a,"+H+","+n+",d){this.data=a","this.shape=["+H+"]","this.stride=["+n+"]","this.offset=d|0}","var proto="+X+".prototype","proto.dtype='"+v+"'","proto.dimension="+T),B.push("Object.defineProperty(proto,'size',{get:function "+X+"_size(){return "+m.map((function(v){return"this.shape["+v+"]"})).join("*"),"}})"),1===T?B.push("proto.order=[0]"):(B.push("Object.defineProperty(proto,'order',{get:"),T<4?(B.push("function "+X+"_order(){"),2===T?B.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===T&&B.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):B.push("ORDER})")),B.push("proto.set=function "+X+"_set("+x.join(",")+",v){"),u?B.push("return this.data.set("+M+",v)}"):B.push("return this.data["+M+"]=v}"),B.push("proto.get=function "+X+"_get("+x.join(",")+"){"),u?B.push("return this.data.get("+M+")}"):B.push("return this.data["+M+"]}"),B.push("proto.index=function "+X+"_index(",x.join(),"){return "+M+"}"),B.push("proto.hi=function "+X+"_hi("+x.join(",")+"){return new "+X+"(this.data,"+m.map((function(v){return["(typeof i",v,"!=='number'||i",v,"<0)?this.shape[",v,"]:i",v,"|0"].join("")})).join(",")+","+m.map((function(v){return"this.stride["+v+"]"})).join(",")+",this.offset)}");var V=m.map((function(v){return"a"+v+"=this.shape["+v+"]"})),D=m.map((function(v){return"c"+v+"=this.stride["+v+"]"}));B.push("proto.lo=function "+X+"_lo("+x.join(",")+"){var b=this.offset,d=0,"+V.join(",")+","+D.join(","));for(var s=0;s<T;++s)B.push("if(typeof i"+s+"==='number'&&i"+s+">=0){d=i"+s+"|0;b+=c"+s+"*d;a"+s+"-=d}");B.push("return new "+X+"(this.data,"+m.map((function(v){return"a"+v})).join(",")+","+m.map((function(v){return"c"+v})).join(",")+",b)}"),B.push("proto.step=function "+X+"_step("+x.join(",")+"){var "+m.map((function(v){return"a"+v+"=this.shape["+v+"]"})).join(",")+","+m.map((function(v){return"b"+v+"=this.stride["+v+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(s=0;s<T;++s)B.push("if(typeof i"+s+"==='number'){d=i"+s+"|0;if(d<0){c+=b"+s+"*(a"+s+"-1);a"+s+"=ceil(-a"+s+"/d)}else{a"+s+"=ceil(a"+s+"/d)}b"+s+"*=d}");B.push("return new "+X+"(this.data,"+m.map((function(v){return"a"+v})).join(",")+","+m.map((function(v){return"b"+v})).join(",")+",c)}");var F=new Array(T),k=new Array(T);for(s=0;s<T;++s)F[s]="a[i"+s+"]",k[s]="b[i"+s+"]";B.push("proto.transpose=function "+X+"_transpose("+x+"){"+x.map((function(v,T){return v+"=("+v+"===undefined?"+T+":"+v+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+X+"(this.data,"+F.join(",")+","+k.join(",")+",this.offset)}"),B.push("proto.pick=function "+X+"_pick("+x+"){var a=[],b=[],c=this.offset");for(s=0;s<T;++s)B.push("if(typeof i"+s+"==='number'&&i"+s+">=0){c=(c+this.stride["+s+"]*i"+s+")|0}else{a.push(this.shape["+s+"]);b.push(this.stride["+s+"])}");return B.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),B.push("return function construct_"+X+"(data,shape,stride,offset){return new "+X+"(data,"+m.map((function(v){return"shape["+v+"]"})).join(",")+","+m.map((function(v){return"stride["+v+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",B.join("\n"))(f[v],A)}var f={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};v.exports=function(v,T,X,O){if(void 0===v)return(0,f.array[0])([]);"number"===typeof v&&(v=[v]),void 0===T&&(T=[v.length]);var m=T.length;if(void 0===X){X=new Array(m);for(var A=m-1,M=1;A>=0;--A)X[A]=M,M*=T[A]}if(void 0===O){O=0;for(A=0;A<m;++A)X[A]<0&&(O-=(T[A]-1)*X[A])}for(var H=function(v){if(u(v))return"buffer";if(B)switch(Object.prototype.toString.call(v)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(v)?"array":"generic"}(v),n=f[H];n.length<=m+1;)n.push(x(H,n.length-1));return(0,n[m+1])(v,T,X,O)}},11741:v=>{var T;self,T=()=>(()=>{"use strict";var v={d:(T,X)=>{for(var O in X)v.o(X,O)&&!v.o(T,O)&&Object.defineProperty(T,O,{enumerable:!0,get:X[O]})},o:(v,T)=>Object.prototype.hasOwnProperty.call(v,T)},T={};v.d(T,{default:()=>a});var X,O=function(v,T){var X=T.x-v.x,O=T.y-v.y;return Math.sqrt(X*X+O*O)},u=function(v){return v*(Math.PI/180)},B=new Map,m=function(v){B.has(v)&&clearTimeout(B.get(v)),B.set(v,setTimeout(v,100))},A=function(v,T,X){for(var O,u=T.split(/[ ,]+/g),B=0;B<u.length;B+=1)O=u[B],v.addEventListener?v.addEventListener(O,X,!1):v.attachEvent&&v.attachEvent(O,X)},x=function(v,T,X){for(var O,u=T.split(/[ ,]+/g),B=0;B<u.length;B+=1)O=u[B],v.removeEventListener?v.removeEventListener(O,X):v.detachEvent&&v.detachEvent(O,X)},f=function(v){return v.preventDefault(),v.type.match(/^touch/)?v.changedTouches:v},M=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},H=function(v,T){T.top||T.right||T.bottom||T.left?(v.style.top=T.top,v.style.right=T.right,v.style.bottom=T.bottom,v.style.left=T.left):(v.style.left=T.x+"px",v.style.top=T.y+"px")},n=function(v,T,X){var O=V(v);for(var u in O)if(O.hasOwnProperty(u))if("string"==typeof T)O[u]=T+" "+X;else{for(var B="",m=0,A=T.length;m<A;m+=1)B+=T[m]+" "+X+", ";O[u]=B.slice(0,-2)}return O},V=function(v){var T={};return T[v]="",["webkit","Moz","o"].forEach((function(X){T[X+v.charAt(0).toUpperCase()+v.slice(1)]=""})),T},D=function(v,T){for(var X in T)T.hasOwnProperty(X)&&(v[X]=T[X]);return v},s=function(v,T){if(v.length)for(var X=0,O=v.length;X<O;X+=1)T(v[X]);else T(v)},F="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,k=window.matchMedia("(any-hover: none)").matches,b=!!("ontouchstart"in window),l=!!window.PointerEvent,Q=!!window.MSPointerEvent,K={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},p={start:"mousedown",move:"mousemove",end:"mouseup"},G={};function L(){}F&&!k?X=K:l?X={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:Q?X={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:b?(X=K,G=p):X=p,L.prototype.on=function(v,T){var X,O=this,u=v.split(/[ ,]+/g);O._handlers_=O._handlers_||{};for(var B=0;B<u.length;B+=1)X=u[B],O._handlers_[X]=O._handlers_[X]||[],O._handlers_[X].push(T);return O},L.prototype.off=function(v,T){var X=this;return X._handlers_=X._handlers_||{},void 0===v?X._handlers_={}:void 0===T?X._handlers_[v]=null:X._handlers_[v]&&X._handlers_[v].indexOf(T)>=0&&X._handlers_[v].splice(X._handlers_[v].indexOf(T),1),X},L.prototype.trigger=function(v,T){var X,O=this,u=v.split(/[ ,]+/g);O._handlers_=O._handlers_||{};for(var B=0;B<u.length;B+=1)X=u[B],O._handlers_[X]&&O._handlers_[X].length&&O._handlers_[X].forEach((function(v){v.call(O,{type:X,target:O},T)}))},L.prototype.config=function(v){var T=this;T.options=T.defaults||{},v&&(T.options=function(v,T){var X={};for(var O in v)v.hasOwnProperty(O)&&T.hasOwnProperty(O)?X[O]=T[O]:v.hasOwnProperty(O)&&(X[O]=v[O]);return X}(T.options,v))},L.prototype.bindEvt=function(v,T){var O=this;return O._domHandlers_=O._domHandlers_||{},O._domHandlers_[T]=function(){"function"==typeof O["on"+T]?O["on"+T].apply(O,arguments):console.warn('[WARNING] : Missing "on'+T+'" handler.')},A(v,X[T],O._domHandlers_[T]),G[T]&&A(v,G[T],O._domHandlers_[T]),O},L.prototype.unbindEvt=function(v,T){var O=this;return O._domHandlers_=O._domHandlers_||{},x(v,X[T],O._domHandlers_[T]),G[T]&&x(v,G[T],O._domHandlers_[T]),delete O._domHandlers_[T],this};const r=L;function o(v,T){return this.identifier=T.identifier,this.position=T.position,this.frontPosition=T.frontPosition,this.collection=v,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(T),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=o.id,o.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}o.prototype=new r,o.constructor=o,o.id=0,o.prototype.buildEl=function(v){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},o.prototype.stylize=function(){if(this.options.dataOnly)return this;var v=this.options.fadeTime+"ms",T=function(){var v=V("borderRadius");for(var T in v)v.hasOwnProperty(T)&&(v[T]="50%");return v}(),X=n("transition","opacity",v),O={};return O.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},O.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},O.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},D(O.el,X),"circle"===this.options.shape&&D(O.back,T),D(O.front,T),this.applyStyles(O),this},o.prototype.applyStyles=function(v){for(var T in this.ui)if(this.ui.hasOwnProperty(T))for(var X in v[T])this.ui[T].style[X]=v[T][X];return this},o.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},o.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},o.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},o.prototype.show=function(v){var T=this;return T.options.dataOnly||(clearTimeout(T.removeTimeout),clearTimeout(T.showTimeout),clearTimeout(T.restTimeout),T.addToDom(),T.restCallback(),setTimeout((function(){T.ui.el.style.opacity=1}),0),T.showTimeout=setTimeout((function(){T.trigger("shown",T.instance),"function"==typeof v&&v.call(this)}),T.options.fadeTime)),T},o.prototype.hide=function(v){var T=this;if(T.options.dataOnly)return T;if(T.ui.el.style.opacity=T.options.restOpacity,clearTimeout(T.removeTimeout),clearTimeout(T.showTimeout),clearTimeout(T.restTimeout),T.removeTimeout=setTimeout((function(){var X="dynamic"===T.options.mode?"none":"block";T.ui.el.style.display=X,"function"==typeof v&&v.call(T),T.trigger("hidden",T.instance)}),T.options.fadeTime),T.options.restJoystick){var X=T.options.restJoystick,O={};O.x=!0===X||!1!==X.x?0:T.instance.frontPosition.x,O.y=!0===X||!1!==X.y?0:T.instance.frontPosition.y,T.setPosition(v,O)}return T},o.prototype.setPosition=function(v,T){var X=this;X.frontPosition={x:T.x,y:T.y};var O=X.options.fadeTime+"ms",u={};u.front=n("transition",["transform"],O);var B={front:{}};B.front={transform:"translate("+X.frontPosition.x+"px,"+X.frontPosition.y+"px)"},X.applyStyles(u),X.applyStyles(B),X.restTimeout=setTimeout((function(){"function"==typeof v&&v.call(X),X.restCallback()}),X.options.fadeTime)},o.prototype.restCallback=function(){var v=this,T={};T.front=n("transition","none",""),v.applyStyles(T),v.trigger("rested",v.instance)},o.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},o.prototype.computeDirection=function(v){var T,X,O,u=v.angle.radian,B=Math.PI/4,m=Math.PI/2;if(u>B&&u<3*B&&!v.lockX?T="up":u>-B&&u<=B&&!v.lockY?T="left":u>3*-B&&u<=-B&&!v.lockX?T="down":v.lockY||(T="right"),v.lockY||(X=u>-m&&u<m?"left":"right"),v.lockX||(O=u>0?"up":"down"),v.force>this.options.threshold){var A,x={};for(A in this.direction)this.direction.hasOwnProperty(A)&&(x[A]=this.direction[A]);var f={};for(A in this.direction={x:X,y:O,angle:T},v.direction=this.direction,x)x[A]===this.direction[A]&&(f[A]=!0);if(f.x&&f.y&&f.angle)return v;f.x&&f.y||this.trigger("plain",v),f.x||this.trigger("plain:"+X,v),f.y||this.trigger("plain:"+O,v),f.angle||this.trigger("dir dir:"+T,v)}else this.resetDirection();return v};const Z=o;function U(v,T){var X=this;X.nipples=[],X.idles=[],X.actives=[],X.ids=[],X.pressureIntervals={},X.manager=v,X.id=U.id,U.id+=1,X.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},X.config(T),"static"!==X.options.mode&&"semi"!==X.options.mode||(X.options.multitouch=!1),X.options.multitouch||(X.options.maxNumberOfNipples=1);var O=getComputedStyle(X.options.zone.parentElement);return O&&"flex"===O.display&&(X.parentIsFlex=!0),X.updateBox(),X.prepareNipples(),X.Dj(),X.begin(),X.nipples}U.prototype=new r,U.constructor=U,U.id=0,U.prototype.prepareNipples=function(){var v=this,T=v.nipples;T.on=v.on.bind(v),T.off=v.off.bind(v),T.options=v.options,T.destroy=v.destroy.bind(v),T.ids=v.ids,T.id=v.id,T.processOnMove=v.processOnMove.bind(v),T.processOnEnd=v.processOnEnd.bind(v),T.get=function(v){if(void 0===v)return T[0];for(var X=0,O=T.length;X<O;X+=1)if(T[X].identifier===v)return T[X];return!1}},U.prototype.Dj=function(){var v=this;v.bindEvt(v.options.zone,"start"),v.options.zone.style.touchAction="none",v.options.zone.style.msTouchAction="none"},U.prototype.begin=function(){var v=this,T=v.options;if("static"===T.mode){var X=v.createNipple(T.position,v.manager.getIdentifier());X.add(),v.idles.push(X)}},U.prototype.createNipple=function(v,T){var X=this,O=X.manager.scroll,u={},B=X.options,m=X.parentIsFlex?O.x:O.x+X.box.left,A=X.parentIsFlex?O.y:O.y+X.box.top;if(v.x&&v.y)u={x:v.x-m,y:v.y-A};else if(v.top||v.right||v.bottom||v.left){var x=document.createElement("DIV");x.style.display="hidden",x.style.top=v.top,x.style.right=v.right,x.style.bottom=v.bottom,x.style.left=v.left,x.style.position="absolute",B.zone.appendChild(x);var f=x.getBoundingClientRect();B.zone.removeChild(x),u=v,v={x:f.left+O.x,y:f.top+O.y}}var M=new Z(X,{color:B.color,size:B.size,threshold:B.threshold,fadeTime:B.fadeTime,dataOnly:B.dataOnly,restJoystick:B.restJoystick,restOpacity:B.restOpacity,mode:B.mode,identifier:T,position:v,zone:B.zone,frontPosition:{x:0,y:0},shape:B.shape});return B.dataOnly||(H(M.ui.el,u),H(M.ui.front,M.frontPosition)),X.nipples.push(M),X.trigger("added "+M.identifier+":added",M),X.manager.trigger("added "+M.identifier+":added",M),X.bindNipple(M),M},U.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},U.prototype.bindNipple=function(v){var T,X=this,O=function(v,O){T=v.type+" "+O.id+":"+v.type,X.trigger(T,O)};v.on("destroyed",X.onDestroyed.bind(X)),v.on("shown hidden rested dir plain",O),v.on("dir:up dir:right dir:down dir:left",O),v.on("plain:up plain:right plain:down plain:left",O)},U.prototype.pressureFn=function(v,T,X){var O=this,u=0;clearInterval(O.pressureIntervals[X]),O.pressureIntervals[X]=setInterval(function(){var X=v.force||v.pressure||v.webkitForce||0;X!==u&&(T.trigger("pressure",X),O.trigger("pressure "+T.identifier+":pressure",X),u=X)}.bind(O),100)},U.prototype.onstart=function(v){var T=this,X=T.options,O=v;return v=f(v),T.updateBox(),s(v,(function(u){T.actives.length<X.maxNumberOfNipples?T.processOnStart(u):O.type.match(/^touch/)&&(Object.keys(T.manager.ids).forEach((function(X){if(Object.values(O.touches).findIndex((function(v){return v.identifier===X}))<0){var u=[v[0]];u.identifier=X,T.processOnEnd(u)}})),T.actives.length<X.maxNumberOfNipples&&T.processOnStart(u))})),T.manager.bindDocument(),!1},U.prototype.processOnStart=function(v){var T,X=this,u=X.options,B=X.manager.getIdentifier(v),m=v.force||v.pressure||v.webkitForce||0,A={x:v.pageX,y:v.pageY},x=X.getOrCreate(B,A);x.identifier!==B&&X.manager.removeIdentifier(x.identifier),x.identifier=B;var f=function(T){T.trigger("start",T),X.trigger("start "+T.id+":start",T),T.show(),m>0&&X.pressureFn(v,T,T.identifier),X.processOnMove(v)};if((T=X.idles.indexOf(x))>=0&&X.idles.splice(T,1),X.actives.push(x),X.ids.push(x.identifier),"semi"!==u.mode)f(x);else{if(!(O(A,x.position)<=u.catchDistance))return x.destroy(),void X.processOnStart(v);f(x)}return x},U.prototype.getOrCreate=function(v,T){var X,O=this,u=O.options;return/(semi|static)/.test(u.mode)?(X=O.idles[0])?(O.idles.splice(0,1),X):"semi"===u.mode?O.createNipple(T,v):(console.warn("Coudln't find the needed nipple."),!1):X=O.createNipple(T,v)},U.prototype.processOnMove=function(v){var T=this,X=T.options,B=T.manager.getIdentifier(v),m=T.nipples.get(B),A=T.manager.scroll;if(function(v){return isNaN(v.buttons)?0!==v.pressure:0!==v.buttons}(v)){if(!m)return console.error("Found zombie joystick with ID "+B),void T.manager.removeIdentifier(B);if(X.dynamicPage){var x=m.el.getBoundingClientRect();m.position={x:A.x+x.left,y:A.y+x.top}}m.identifier=B;var f=m.options.size/2,M={x:v.pageX,y:v.pageY};X.lockX&&(M.y=m.position.y),X.lockY&&(M.x=m.position.x);var H,n,V,D,s,F,k,b,l,Q,K=O(M,m.position),p=(H=M,V=(n=m.position).x-H.x,D=n.y-H.y,function(v){return v*(180/Math.PI)}(Math.atan2(D,V))),G=u(p),L=K/f,r={distance:K,position:M};if("circle"===m.options.shape?(s=Math.min(K,f),k=m.position,b=s,Q={x:0,y:0},l=u(l=p),Q.x=k.x-b*Math.cos(l),Q.y=k.y-b*Math.sin(l),F=Q):(F=function(v,T,X){return{x:Math.min(Math.max(v.x,T.x-X),T.x+X),y:Math.min(Math.max(v.y,T.y-X),T.y+X)}}(M,m.position,f),s=O(F,m.position)),X.follow){if(K>f){var o=M.x-F.x,Z=M.y-F.y;m.position.x+=o,m.position.y+=Z,m.el.style.top=m.position.y-(T.box.top+A.y)+"px",m.el.style.left=m.position.x-(T.box.left+A.x)+"px",K=O(M,m.position)}}else M=F,K=s;var U=M.x-m.position.x,J=M.y-m.position.y;m.frontPosition={x:U,y:J},X.dataOnly||(m.ui.front.style.transform="translate("+U+"px,"+J+"px)");var y={identifier:m.identifier,position:M,force:L,pressure:v.force||v.pressure||v.webkitForce||0,distance:K,angle:{radian:G,degree:p},vector:{x:U/f,y:-J/f},raw:r,instance:m,lockX:X.lockX,lockY:X.lockY};(y=m.computeDirection(y)).angle={radian:u(180-p),degree:180-p},m.trigger("move",y),T.trigger("move "+m.id+":move",y)}else this.processOnEnd(v)},U.prototype.processOnEnd=function(v){var T=this,X=T.options,O=T.manager.getIdentifier(v),u=T.nipples.get(O),B=T.manager.removeIdentifier(u.identifier);u&&(X.dataOnly||u.hide((function(){"dynamic"===X.mode&&(u.trigger("removed",u),T.trigger("removed "+u.id+":removed",u),T.manager.trigger("removed "+u.id+":removed",u),u.destroy())})),clearInterval(T.pressureIntervals[u.identifier]),u.resetDirection(),u.trigger("end",u),T.trigger("end "+u.id+":end",u),T.ids.indexOf(u.identifier)>=0&&T.ids.splice(T.ids.indexOf(u.identifier),1),T.actives.indexOf(u)>=0&&T.actives.splice(T.actives.indexOf(u),1),/(semi|static)/.test(X.mode)?T.idles.push(u):T.nipples.indexOf(u)>=0&&T.nipples.splice(T.nipples.indexOf(u),1),T.manager.unbindDocument(),/(semi|static)/.test(X.mode)&&(T.manager.ids[B.id]=B.identifier))},U.prototype.onDestroyed=function(v,T){var X=this;X.nipples.indexOf(T)>=0&&X.nipples.splice(X.nipples.indexOf(T),1),X.actives.indexOf(T)>=0&&X.actives.splice(X.actives.indexOf(T),1),X.idles.indexOf(T)>=0&&X.idles.splice(X.idles.indexOf(T),1),X.ids.indexOf(T.identifier)>=0&&X.ids.splice(X.ids.indexOf(T.identifier),1),X.manager.removeIdentifier(T.identifier),X.manager.unbindDocument()},U.prototype.destroy=function(){var v=this;for(var T in v.unbindEvt(v.options.zone,"start"),v.nipples.forEach((function(v){v.destroy()})),v.pressureIntervals)v.pressureIntervals.hasOwnProperty(T)&&clearInterval(v.pressureIntervals[T]);v.trigger("destroyed",v.nipples),v.manager.unbindDocument(),v.off()};const J=U;function y(v){var T=this;T.ids={},T.index=0,T.collections=[],T.scroll=M(),T.config(v),T.prepareCollections();var X=function(){var v;T.collections.forEach((function(X){X.forEach((function(X){v=X.el.getBoundingClientRect(),X.position={x:T.scroll.x+v.left,y:T.scroll.y+v.top}}))}))};A(window,"resize",(function(){m(X)}));var O=function(){T.scroll=M()};return A(window,"scroll",(function(){m(O)})),T.collections}y.prototype=new r,y.constructor=y,y.prototype.prepareCollections=function(){var v=this;v.collections.create=v.create.bind(v),v.collections.on=v.on.bind(v),v.collections.off=v.off.bind(v),v.collections.destroy=v.destroy.bind(v),v.collections.get=function(T){var X;return v.collections.every((function(v){return!(X=v.get(T))})),X}},y.prototype.create=function(v){return this.createCollection(v)},y.prototype.createCollection=function(v){var T=this,X=new J(T,v);return T.bindCollection(X),T.collections.push(X),X},y.prototype.bindCollection=function(v){var T,X=this,O=function(v,O){T=v.type+" "+O.id+":"+v.type,X.trigger(T,O)};v.on("destroyed",X.onDestroyed.bind(X)),v.on("shown hidden rested dir plain",O),v.on("dir:up dir:right dir:down dir:left",O),v.on("plain:up plain:right plain:down plain:left",O)},y.prototype.bindDocument=function(){var v=this;v.binded||(v.bindEvt(document,"move").bindEvt(document,"end"),v.binded=!0)},y.prototype.unbindDocument=function(v){var T=this;Object.keys(T.ids).length&&!0!==v||(T.unbindEvt(document,"move").unbindEvt(document,"end"),T.binded=!1)},y.prototype.getIdentifier=function(v){var T;return v?void 0===(T=void 0===v.identifier?v.pointerId:v.identifier)&&(T=this.latest||0):T=this.index,void 0===this.ids[T]&&(this.ids[T]=this.index,this.index+=1),this.latest=T,this.ids[T]},y.prototype.removeIdentifier=function(v){var T={};for(var X in this.ids)if(this.ids[X]===v){T.id=X,T.identifier=this.ids[X],delete this.ids[X];break}return T},y.prototype.onmove=function(v){return this.onAny("move",v),!1},y.prototype.onend=function(v){return this.onAny("end",v),!1},y.prototype.oncancel=function(v){return this.onAny("end",v),!1},y.prototype.onAny=function(v,T){var X,O=this,u="processOn"+v.charAt(0).toUpperCase()+v.slice(1);T=f(T);var B=function(v,T,X){X.ids.indexOf(T)>=0&&(X[u](v),v._found_=!0)};return s(T,(function(v){X=O.getIdentifier(v),s(O.collections,B.bind(null,v,X)),v._found_||O.removeIdentifier(X)})),!1},y.prototype.destroy=function(){var v=this;v.unbindDocument(!0),v.ids={},v.index=0,v.collections.forEach((function(v){v.destroy()})),v.off()},y.prototype.onDestroyed=function(v,T){var X=this;if(X.collections.indexOf(T)<0)return!1;X.collections.splice(X.collections.indexOf(T),1)};var P=new y;const a={create:function(v){return P.create(v)},factory:P};return T.default})(),v.exports=T()},11788:(v,T,X)=>{"use strict";const{Deflate:O,deflate:u,deflateRaw:B,gzip:m}=X(11795),{Inflate:A,inflate:x,inflateRaw:f,ungzip:M}=X(11845),H=X(11818);v.exports.Deflate=O,v.exports.deflate=u,v.exports.deflateRaw=B,v.exports.gzip=m,v.exports.Inflate=A,v.exports.inflate=x,v.exports.inflateRaw=f,v.exports.ungzip=M,v.exports.constants=H},11795:(v,T,X)=>{"use strict";const O=X(11800),u=X(11827),B=X(11836),m=X(11816),A=X(11841),x=Object.prototype.toString,{Z_NO_FLUSH:f,Z_SYNC_FLUSH:M,Z_FULL_FLUSH:H,Z_FINISH:n,Z_OK:V,Z_STREAM_END:D,Z_DEFAULT_COMPRESSION:s,Z_DEFAULT_STRATEGY:F,Z_DEFLATED:k}=X(11818);function b(v){this.options=u.assign({level:s,method:k,Ja:16384,windowBits:15,memLevel:8,strategy:F},v||{});let T=this.options;T.raw&&T.windowBits>0?T.windowBits=-T.windowBits:T.gzip&&T.windowBits>0&&T.windowBits<16&&(T.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new A,this.strm.avail_out=0;let X=O.deflateInit2(this.strm,T.level,T.method,T.windowBits,T.memLevel,T.strategy);if(X!==V)throw new Error(m[X]);if(T.header&&O.deflateSetHeader(this.strm,T.header),T.dictionary){let v;if(v="string"===typeof T.dictionary?B.string2buf(T.dictionary):"[object ArrayBuffer]"===x.call(T.dictionary)?new Uint8Array(T.dictionary):T.dictionary,X=O.deflateSetDictionary(this.strm,v),X!==V)throw new Error(m[X]);this._dict_set=!0}}function l(v,T){const X=new b(T);if(X.push(v,!0),X.err)throw X.msg||m[X.err];return X.result}b.prototype.push=function(v,T){const X=this.strm,u=this.options.Ja;let m,A;if(this.ended)return!1;for(A=T===~~T?T:!0===T?n:f,"string"===typeof v?X.input=B.string2buf(v):"[object ArrayBuffer]"===x.call(v)?X.input=new Uint8Array(v):X.input=v,X.next_in=0,X.avail_in=X.input.length;;)if(0===X.avail_out&&(X.output=new Uint8Array(u),X.next_out=0,X.avail_out=u),(A===M||A===H)&&X.avail_out<=6)this.onData(X.output.subarray(0,X.next_out)),X.avail_out=0;else{if(m=O.deflate(X,A),m===D)return X.next_out>0&&this.onData(X.output.subarray(0,X.next_out)),m=O.deflateEnd(this.strm),this.onEnd(m),this.ended=!0,m===V;if(0!==X.avail_out){if(A>0&&X.next_out>0)this.onData(X.output.subarray(0,X.next_out)),X.avail_out=0;else if(0===X.avail_in)break}else this.onData(X.output)}return!0},b.prototype.onData=function(v){this.chunks.push(v)},b.prototype.onEnd=function(v){v===V&&(this.result=u.flattenChunks(this.chunks)),this.chunks=[],this.err=v,this.msg=this.strm.msg},v.exports.Deflate=b,v.exports.deflate=l,v.exports.deflateRaw=function(v,T){return(T=T||{}).raw=!0,l(v,T)},v.exports.gzip=function(v,T){return(T=T||{}).gzip=!0,l(v,T)},v.exports.constants=X(11818)},11845:(v,T,X)=>{"use strict";const O=X(11853),u=X(11827),B=X(11836),m=X(11816),A=X(11841),x=X(11875),f=Object.prototype.toString,{Z_NO_FLUSH:M,Z_FINISH:H,Z_OK:n,Z_STREAM_END:V,Z_NEED_DICT:D,Z_STREAM_ERROR:s,Z_DATA_ERROR:F,Z_MEM_ERROR:k}=X(11818);function b(v){this.options=u.assign({Ja:65536,windowBits:15,to:""},v||{});const T=this.options;T.raw&&T.windowBits>=0&&T.windowBits<16&&(T.windowBits=-T.windowBits,0===T.windowBits&&(T.windowBits=-15)),!(T.windowBits>=0&&T.windowBits<16)||v&&v.windowBits||(T.windowBits+=32),T.windowBits>15&&T.windowBits<48&&0===(15&T.windowBits)&&(T.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new A,this.strm.avail_out=0;let X=O.inflateInit2(this.strm,T.windowBits);if(X!==n)throw new Error(m[X]);if(this.header=new x,O.inflateGetHeader(this.strm,this.header),T.dictionary&&("string"===typeof T.dictionary?T.dictionary=B.string2buf(T.dictionary):"[object ArrayBuffer]"===f.call(T.dictionary)&&(T.dictionary=new Uint8Array(T.dictionary)),T.raw&&(X=O.inflateSetDictionary(this.strm,T.dictionary),X!==n)))throw new Error(m[X])}function l(v,T){const X=new b(T);if(X.push(v),X.err)throw X.msg||m[X.err];return X.result}b.prototype.push=function(v,T){const X=this.strm,u=this.options.Ja,m=this.options.dictionary;let A,x,b;if(this.ended)return!1;for(x=T===~~T?T:!0===T?H:M,"[object ArrayBuffer]"===f.call(v)?X.input=new Uint8Array(v):X.input=v,X.next_in=0,X.avail_in=X.input.length;;){for(0===X.avail_out&&(X.output=new Uint8Array(u),X.next_out=0,X.avail_out=u),A=O.inflate(X,x),A===D&&m&&(A=O.inflateSetDictionary(X,m),A===n?A=O.inflate(X,x):A===F&&(A=D));X.avail_in>0&&A===V&&X.state.wrap>0&&0!==v[X.next_in];)O.inflateReset(X),A=O.inflate(X,x);switch(A){case s:case F:case D:case k:return this.onEnd(A),this.ended=!0,!1}if(b=X.avail_out,X.next_out&&(0===X.avail_out||A===V))if("string"===this.options.to){let v=B.utf8border(X.output,X.next_out),T=X.next_out-v,O=B.buf2string(X.output,v);X.next_out=T,X.avail_out=u-T,T&&X.output.set(X.output.subarray(v,v+T),0),this.onData(O)}else this.onData(X.output.length===X.next_out?X.output:X.output.subarray(0,X.next_out));if(A!==n||0!==b){if(A===V)return A=O.inflateEnd(this.strm),this.onEnd(A),this.ended=!0,!0;if(0===X.avail_in)break}}return!0},b.prototype.onData=function(v){this.chunks.push(v)},b.prototype.onEnd=function(v){v===n&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=u.flattenChunks(this.chunks)),this.chunks=[],this.err=v,this.msg=this.strm.msg},v.exports.Inflate=b,v.exports.inflate=l,v.exports.inflateRaw=function(v,T){return(T=T||{}).raw=!0,l(v,T)},v.exports.ungzip=l,v.exports.constants=X(11818)},11827:v=>{"use strict";const T=(v,T)=>Object.prototype.hasOwnProperty.call(v,T);v.exports.assign=function(v){const X=Array.prototype.slice.call(arguments,1);for(;X.length;){const O=X.shift();if(O){if("object"!==typeof O)throw new TypeError(O+"must be non-object");for(const X in O)T(O,X)&&(v[X]=O[X])}}return v},v.exports.flattenChunks=v=>{let T=0;for(let O=0,u=v.length;O<u;O++)T+=v[O].length;const X=new Uint8Array(T);for(let O=0,u=0,B=v.length;O<B;O++){let T=v[O];X.set(T,u),u+=T.length}return X}},11836:v=>{"use strict";let T=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(O){T=!1}const X=new Uint8Array(256);for(let u=0;u<256;u++)X[u]=u>=252?6:u>=248?5:u>=240?4:u>=224?3:u>=192?2:1;X[254]=X[254]=1,v.exports.string2buf=v=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(v);let T,X,O,u,B,m=v.length,A=0;for(u=0;u<m;u++)X=v.charCodeAt(u),55296===(64512&X)&&u+1<m&&(O=v.charCodeAt(u+1),56320===(64512&O)&&(X=65536+(X-55296<<10)+(O-56320),u++)),A+=X<128?1:X<2048?2:X<65536?3:4;for(T=new Uint8Array(A),B=0,u=0;B<A;u++)X=v.charCodeAt(u),55296===(64512&X)&&u+1<m&&(O=v.charCodeAt(u+1),56320===(64512&O)&&(X=65536+(X-55296<<10)+(O-56320),u++)),X<128?T[B++]=X:X<2048?(T[B++]=192|X>>>6,T[B++]=128|63&X):X<65536?(T[B++]=224|X>>>12,T[B++]=128|X>>>6&63,T[B++]=128|63&X):(T[B++]=240|X>>>18,T[B++]=128|X>>>12&63,T[B++]=128|X>>>6&63,T[B++]=128|63&X);return T};v.exports.buf2string=(v,O)=>{const u=O||v.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(v.subarray(0,O));let B,m;const A=new Array(2*u);for(m=0,B=0;B<u;){let T=v[B++];if(T<128){A[m++]=T;continue}let O=X[T];if(O>4)A[m++]=65533,B+=O-1;else{for(T&=2===O?31:3===O?15:7;O>1&&B<u;)T=T<<6|63&v[B++],O--;O>1?A[m++]=65533:T<65536?A[m++]=T:(T-=65536,A[m++]=55296|T>>10&1023,A[m++]=56320|1023&T)}}return((v,X)=>{if(X<65534&&v.subarray&&T)return String.fromCharCode.apply(null,v.length===X?v:v.subarray(0,X));let O="";for(let T=0;T<X;T++)O+=String.fromCharCode(v[T]);return O})(A,m)},v.exports.utf8border=(v,T)=>{(T=T||v.length)>v.length&&(T=v.length);let O=T-1;for(;O>=0&&128===(192&v[O]);)O--;return O<0||0===O?T:O+X[v[O]]>T?O:T}},11806:v=>{"use strict";v.exports=(v,T,X,O)=>{let u=65535&v,B=v>>>16&65535,m=0;for(;0!==X;){m=X>2e3?2e3:X,X-=m;do{u=u+T[O++]|0,B=B+u|0}while(--m);u%=65521,B%=65521}return u|B<<16}},11818:v=>{"use strict";v.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},11813:v=>{"use strict";const T=new Uint32Array((()=>{let v,T=[];for(var X=0;X<256;X++){v=X;for(var O=0;O<8;O++)v=1&v?3988292384^v>>>1:v>>>1;T[X]=v}return T})());v.exports=(v,X,O,u)=>{const B=T,m=u+O;v^=-1;for(let T=u;T<m;T++)v=v>>>8^B[255&(v^X[T])];return~v}},11800:(v,T,X)=>{"use strict";const{_tr_init:O,_tr_stored_block:u,_tr_flush_block:B,_tr_tally:m,_tr_align:A}=X(11804),x=X(11806),f=X(11813),M=X(11816),{Z_NO_FLUSH:H,Z_PARTIAL_FLUSH:n,Z_FULL_FLUSH:V,Z_FINISH:D,Z_BLOCK:s,Z_OK:F,Z_STREAM_END:k,Z_STREAM_ERROR:b,Z_DATA_ERROR:l,Z_BUF_ERROR:Q,Z_DEFAULT_COMPRESSION:K,Z_FILTERED:p,Z_HUFFMAN_ONLY:G,Z_RLE:L,Z_FIXED:r,Z_DEFAULT_STRATEGY:o,Z_UNKNOWN:Z,Z_DEFLATED:U}=X(11818),J=258,y=262,P=103,a=113,E=666,i=(v,T)=>(v.msg=M[T],T),t=v=>(v<<1)-(v>4?9:0),C=v=>{let T=v.length;for(;--T>=0;)v[T]=0};let c=(v,T,X)=>(T<<v.hash_shift^X)&v.hash_mask;const N=v=>{const T=v.state;let X=T.pending;X>v.avail_out&&(X=v.avail_out),0!==X&&(v.output.set(T.pending_buf.subarray(T.pending_out,T.pending_out+X),v.next_out),v.next_out+=X,T.pending_out+=X,v.total_out+=X,v.avail_out-=X,T.pending-=X,0===T.pending&&(T.pending_out=0))},d=(v,T)=>{B(v,v.block_start>=0?v.block_start:-1,v.strstart-v.block_start,T),v.block_start=v.strstart,N(v.strm)},I=(v,T)=>{v.pending_buf[v.pending++]=T},W=(v,T)=>{v.pending_buf[v.pending++]=T>>>8&255,v.pending_buf[v.pending++]=255&T},g=(v,T,X,O)=>{let u=v.avail_in;return u>O&&(u=O),0===u?0:(v.avail_in-=u,T.set(v.input.subarray(v.next_in,v.next_in+u),X),1===v.state.wrap?v.adler=x(v.adler,T,u,X):2===v.state.wrap&&(v.adler=f(v.adler,T,u,X)),v.next_in+=u,v.total_in+=u,u)},j=(v,T)=>{let X,O,u=v.max_chain_length,B=v.strstart,m=v.prev_length,A=v.nice_match;const x=v.strstart>v.w_size-y?v.strstart-(v.w_size-y):0,f=v.window,M=v.w_mask,H=v.prev,n=v.strstart+J;let V=f[B+m-1],D=f[B+m];v.prev_length>=v.good_match&&(u>>=2),A>v.lookahead&&(A=v.lookahead);do{if(X=T,f[X+m]===D&&f[X+m-1]===V&&f[X]===f[B]&&f[++X]===f[B+1]){B+=2,X++;do{}while(f[++B]===f[++X]&&f[++B]===f[++X]&&f[++B]===f[++X]&&f[++B]===f[++X]&&f[++B]===f[++X]&&f[++B]===f[++X]&&f[++B]===f[++X]&&f[++B]===f[++X]&&B<n);if(O=J-(n-B),B=n-J,O>m){if(v.match_start=T,m=O,O>=A)break;V=f[B+m-1],D=f[B+m]}}}while((T=H[T&M])>x&&0!==--u);return m<=v.lookahead?m:v.lookahead},e=v=>{const T=v.w_size;let X,O,u,B,m;do{if(B=v.window_size-v.lookahead-v.strstart,v.strstart>=T+(T-y)){v.window.set(v.window.subarray(T,T+T),0),v.match_start-=T,v.strstart-=T,v.block_start-=T,O=v.hash_size,X=O;do{u=v.head[--X],v.head[X]=u>=T?u-T:0}while(--O);O=T,X=O;do{u=v.prev[--X],v.prev[X]=u>=T?u-T:0}while(--O);B+=T}if(0===v.strm.avail_in)break;if(O=g(v.strm,v.window,v.strstart+v.lookahead,B),v.lookahead+=O,v.lookahead+v.insert>=3)for(m=v.strstart-v.insert,v.ins_h=v.window[m],v.ins_h=c(v,v.ins_h,v.window[m+1]);v.insert&&(v.ins_h=c(v,v.ins_h,v.window[m+3-1]),v.prev[m&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=m,m++,v.insert--,!(v.lookahead+v.insert<3)););}while(v.lookahead<y&&0!==v.strm.avail_in)},h=(v,T)=>{let X,O;for(;;){if(v.lookahead<y){if(e(v),v.lookahead<y&&T===H)return 1;if(0===v.lookahead)break}if(X=0,v.lookahead>=3&&(v.ins_h=c(v,v.ins_h,v.window[v.strstart+3-1]),X=v.prev[v.strstart&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=v.strstart),0!==X&&v.strstart-X<=v.w_size-y&&(v.match_length=j(v,X)),v.match_length>=3)if(O=m(v,v.strstart-v.match_start,v.match_length-3),v.lookahead-=v.match_length,v.match_length<=v.max_lazy_match&&v.lookahead>=3){v.match_length--;do{v.strstart++,v.ins_h=c(v,v.ins_h,v.window[v.strstart+3-1]),X=v.prev[v.strstart&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=v.strstart}while(0!==--v.match_length);v.strstart++}else v.strstart+=v.match_length,v.match_length=0,v.ins_h=v.window[v.strstart],v.ins_h=c(v,v.ins_h,v.window[v.strstart+1]);else O=m(v,0,v.window[v.strstart]),v.lookahead--,v.strstart++;if(O&&(d(v,!1),0===v.strm.avail_out))return 1}return v.insert=v.strstart<2?v.strstart:2,T===D?(d(v,!0),0===v.strm.avail_out?3:4):v.last_lit&&(d(v,!1),0===v.strm.avail_out)?1:2},S=(v,T)=>{let X,O,u;for(;;){if(v.lookahead<y){if(e(v),v.lookahead<y&&T===H)return 1;if(0===v.lookahead)break}if(X=0,v.lookahead>=3&&(v.ins_h=c(v,v.ins_h,v.window[v.strstart+3-1]),X=v.prev[v.strstart&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=v.strstart),v.prev_length=v.match_length,v.prev_match=v.match_start,v.match_length=2,0!==X&&v.prev_length<v.max_lazy_match&&v.strstart-X<=v.w_size-y&&(v.match_length=j(v,X),v.match_length<=5&&(v.strategy===p||3===v.match_length&&v.strstart-v.match_start>4096)&&(v.match_length=2)),v.prev_length>=3&&v.match_length<=v.prev_length){u=v.strstart+v.lookahead-3,O=m(v,v.strstart-1-v.prev_match,v.prev_length-3),v.lookahead-=v.prev_length-1,v.prev_length-=2;do{++v.strstart<=u&&(v.ins_h=c(v,v.ins_h,v.window[v.strstart+3-1]),X=v.prev[v.strstart&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=v.strstart)}while(0!==--v.prev_length);if(v.match_available=0,v.match_length=2,v.strstart++,O&&(d(v,!1),0===v.strm.avail_out))return 1}else if(v.match_available){if(O=m(v,0,v.window[v.strstart-1]),O&&d(v,!1),v.strstart++,v.lookahead--,0===v.strm.avail_out)return 1}else v.match_available=1,v.strstart++,v.lookahead--}return v.match_available&&(O=m(v,0,v.window[v.strstart-1]),v.match_available=0),v.insert=v.strstart<2?v.strstart:2,T===D?(d(v,!0),0===v.strm.avail_out?3:4):v.last_lit&&(d(v,!1),0===v.strm.avail_out)?1:2};function w(v,T,X,O,u){this.good_length=v,this.max_lazy=T,this.nice_length=X,this.max_chain=O,this.func=u}const z=[new w(0,0,0,0,((v,T)=>{let X=65535;for(X>v.pending_buf_size-5&&(X=v.pending_buf_size-5);;){if(v.lookahead<=1){if(e(v),0===v.lookahead&&T===H)return 1;if(0===v.lookahead)break}v.strstart+=v.lookahead,v.lookahead=0;const O=v.block_start+X;if((0===v.strstart||v.strstart>=O)&&(v.lookahead=v.strstart-O,v.strstart=O,d(v,!1),0===v.strm.avail_out))return 1;if(v.strstart-v.block_start>=v.w_size-y&&(d(v,!1),0===v.strm.avail_out))return 1}return v.insert=0,T===D?(d(v,!0),0===v.strm.avail_out?3:4):(v.strstart>v.block_start&&(d(v,!1),v.strm.avail_out),1)})),new w(4,4,8,4,h),new w(4,5,16,8,h),new w(4,6,32,32,h),new w(4,4,16,16,S),new w(8,16,32,32,S),new w(8,16,128,128,S),new w(8,32,128,256,S),new w(32,128,258,1024,S),new w(32,258,258,4096,S)];function R(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=U,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),C(this.dyn_ltree),C(this.dyn_dtree),C(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),C(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),C(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Y=v=>{if(!v||!v.state)return i(v,b);v.total_in=v.total_out=0,v.data_type=Z;const T=v.state;return T.pending=0,T.pending_out=0,T.wrap<0&&(T.wrap=-T.wrap),T.status=T.wrap?42:a,v.adler=2===T.wrap?0:1,T.last_flush=H,O(T),F},q=v=>{const T=Y(v);var X;return T===F&&((X=v.state).window_size=2*X.w_size,C(X.head),X.max_lazy_match=z[X.level].max_lazy,X.good_match=z[X.level].good_length,X.nice_match=z[X.level].nice_length,X.max_chain_length=z[X.level].max_chain,X.strstart=0,X.block_start=0,X.lookahead=0,X.insert=0,X.match_length=X.prev_length=2,X.match_available=0,X.ins_h=0),T},vv=(v,T,X,O,u,B)=>{if(!v)return b;let m=1;if(T===K&&(T=6),O<0?(m=0,O=-O):O>15&&(m=2,O-=16),u<1||u>9||X!==U||O<8||O>15||T<0||T>9||B<0||B>r)return i(v,b);8===O&&(O=9);const A=new R;return v.state=A,A.strm=v,A.wrap=m,A.gzhead=null,A.w_bits=O,A.w_size=1<<A.w_bits,A.w_mask=A.w_size-1,A.hash_bits=u+7,A.hash_size=1<<A.hash_bits,A.hash_mask=A.hash_size-1,A.hash_shift=~~((A.hash_bits+3-1)/3),A.window=new Uint8Array(2*A.w_size),A.head=new Uint16Array(A.hash_size),A.prev=new Uint16Array(A.w_size),A.lit_bufsize=1<<u+6,A.pending_buf_size=4*A.lit_bufsize,A.pending_buf=new Uint8Array(A.pending_buf_size),A.d_buf=1*A.lit_bufsize,A.l_buf=3*A.lit_bufsize,A.level=T,A.strategy=B,A.method=X,q(v)};v.exports.deflateInit=(v,T)=>vv(v,T,U,15,8,o),v.exports.deflateInit2=vv,v.exports.deflateReset=q,v.exports.deflateResetKeep=Y,v.exports.deflateSetHeader=(v,T)=>v&&v.state?2!==v.state.wrap?b:(v.state.gzhead=T,F):b,v.exports.deflate=(v,T)=>{let X,O;if(!v||!v.state||T>s||T<0)return v?i(v,b):b;const B=v.state;if(!v.output||!v.input&&0!==v.avail_in||B.status===E&&T!==D)return i(v,0===v.avail_out?Q:b);B.strm=v;const x=B.last_flush;if(B.last_flush=T,42===B.status)if(2===B.wrap)v.adler=0,I(B,31),I(B,139),I(B,8),B.gzhead?(I(B,(B.gzhead.text?1:0)+(B.gzhead.hcrc?2:0)+(B.gzhead.extra?4:0)+(B.gzhead.name?8:0)+(B.gzhead.comment?16:0)),I(B,255&B.gzhead.time),I(B,B.gzhead.time>>8&255),I(B,B.gzhead.time>>16&255),I(B,B.gzhead.time>>24&255),I(B,9===B.level?2:B.strategy>=G||B.level<2?4:0),I(B,255&B.gzhead.os),B.gzhead.extra&&B.gzhead.extra.length&&(I(B,255&B.gzhead.extra.length),I(B,B.gzhead.extra.length>>8&255)),B.gzhead.hcrc&&(v.adler=f(v.adler,B.pending_buf,B.pending,0)),B.gzindex=0,B.status=69):(I(B,0),I(B,0),I(B,0),I(B,0),I(B,0),I(B,9===B.level?2:B.strategy>=G||B.level<2?4:0),I(B,3),B.status=a);else{let T=U+(B.w_bits-8<<4)<<8,X=-1;X=B.strategy>=G||B.level<2?0:B.level<6?1:6===B.level?2:3,T|=X<<6,0!==B.strstart&&(T|=32),T+=31-T%31,B.status=a,W(B,T),0!==B.strstart&&(W(B,v.adler>>>16),W(B,65535&v.adler)),v.adler=1}if(69===B.status)if(B.gzhead.extra){for(X=B.pending;B.gzindex<(65535&B.gzhead.extra.length)&&(B.pending!==B.pending_buf_size||(B.gzhead.hcrc&&B.pending>X&&(v.adler=f(v.adler,B.pending_buf,B.pending-X,X)),N(v),X=B.pending,B.pending!==B.pending_buf_size));)I(B,255&B.gzhead.extra[B.gzindex]),B.gzindex++;B.gzhead.hcrc&&B.pending>X&&(v.adler=f(v.adler,B.pending_buf,B.pending-X,X)),B.gzindex===B.gzhead.extra.length&&(B.gzindex=0,B.status=73)}else B.status=73;if(73===B.status)if(B.gzhead.name){X=B.pending;do{if(B.pending===B.pending_buf_size&&(B.gzhead.hcrc&&B.pending>X&&(v.adler=f(v.adler,B.pending_buf,B.pending-X,X)),N(v),X=B.pending,B.pending===B.pending_buf_size)){O=1;break}O=B.gzindex<B.gzhead.name.length?255&B.gzhead.name.charCodeAt(B.gzindex++):0,I(B,O)}while(0!==O);B.gzhead.hcrc&&B.pending>X&&(v.adler=f(v.adler,B.pending_buf,B.pending-X,X)),0===O&&(B.gzindex=0,B.status=91)}else B.status=91;if(91===B.status)if(B.gzhead.comment){X=B.pending;do{if(B.pending===B.pending_buf_size&&(B.gzhead.hcrc&&B.pending>X&&(v.adler=f(v.adler,B.pending_buf,B.pending-X,X)),N(v),X=B.pending,B.pending===B.pending_buf_size)){O=1;break}O=B.gzindex<B.gzhead.comment.length?255&B.gzhead.comment.charCodeAt(B.gzindex++):0,I(B,O)}while(0!==O);B.gzhead.hcrc&&B.pending>X&&(v.adler=f(v.adler,B.pending_buf,B.pending-X,X)),0===O&&(B.status=P)}else B.status=P;if(B.status===P&&(B.gzhead.hcrc?(B.pending+2>B.pending_buf_size&&N(v),B.pending+2<=B.pending_buf_size&&(I(B,255&v.adler),I(B,v.adler>>8&255),v.adler=0,B.status=a)):B.status=a),0!==B.pending){if(N(v),0===v.avail_out)return B.last_flush=-1,F}else if(0===v.avail_in&&t(T)<=t(x)&&T!==D)return i(v,Q);if(B.status===E&&0!==v.avail_in)return i(v,Q);if(0!==v.avail_in||0!==B.lookahead||T!==H&&B.status!==E){let X=B.strategy===G?((v,T)=>{let X;for(;;){if(0===v.lookahead&&(e(v),0===v.lookahead)){if(T===H)return 1;break}if(v.match_length=0,X=m(v,0,v.window[v.strstart]),v.lookahead--,v.strstart++,X&&(d(v,!1),0===v.strm.avail_out))return 1}return v.insert=0,T===D?(d(v,!0),0===v.strm.avail_out?3:4):v.last_lit&&(d(v,!1),0===v.strm.avail_out)?1:2})(B,T):B.strategy===L?((v,T)=>{let X,O,u,B;const A=v.window;for(;;){if(v.lookahead<=J){if(e(v),v.lookahead<=J&&T===H)return 1;if(0===v.lookahead)break}if(v.match_length=0,v.lookahead>=3&&v.strstart>0&&(u=v.strstart-1,O=A[u],O===A[++u]&&O===A[++u]&&O===A[++u])){B=v.strstart+J;do{}while(O===A[++u]&&O===A[++u]&&O===A[++u]&&O===A[++u]&&O===A[++u]&&O===A[++u]&&O===A[++u]&&O===A[++u]&&u<B);v.match_length=J-(B-u),v.match_length>v.lookahead&&(v.match_length=v.lookahead)}if(v.match_length>=3?(X=m(v,1,v.match_length-3),v.lookahead-=v.match_length,v.strstart+=v.match_length,v.match_length=0):(X=m(v,0,v.window[v.strstart]),v.lookahead--,v.strstart++),X&&(d(v,!1),0===v.strm.avail_out))return 1}return v.insert=0,T===D?(d(v,!0),0===v.strm.avail_out?3:4):v.last_lit&&(d(v,!1),0===v.strm.avail_out)?1:2})(B,T):z[B.level].func(B,T);if(3!==X&&4!==X||(B.status=E),1===X||3===X)return 0===v.avail_out&&(B.last_flush=-1),F;if(2===X&&(T===n?A(B):T!==s&&(u(B,0,0,!1),T===V&&(C(B.head),0===B.lookahead&&(B.strstart=0,B.block_start=0,B.insert=0))),N(v),0===v.avail_out))return B.last_flush=-1,F}return T!==D?F:B.wrap<=0?k:(2===B.wrap?(I(B,255&v.adler),I(B,v.adler>>8&255),I(B,v.adler>>16&255),I(B,v.adler>>24&255),I(B,255&v.total_in),I(B,v.total_in>>8&255),I(B,v.total_in>>16&255),I(B,v.total_in>>24&255)):(W(B,v.adler>>>16),W(B,65535&v.adler)),N(v),B.wrap>0&&(B.wrap=-B.wrap),0!==B.pending?F:k)},v.exports.deflateEnd=v=>{if(!v||!v.state)return b;const T=v.state.status;return 42!==T&&69!==T&&73!==T&&91!==T&&T!==P&&T!==a&&T!==E?i(v,b):(v.state=null,T===a?i(v,l):F)},v.exports.deflateSetDictionary=(v,T)=>{let X=T.length;if(!v||!v.state)return b;const O=v.state,u=O.wrap;if(2===u||1===u&&42!==O.status||O.lookahead)return b;if(1===u&&(v.adler=x(v.adler,T,X,0)),O.wrap=0,X>=O.w_size){0===u&&(C(O.head),O.strstart=0,O.block_start=0,O.insert=0);let v=new Uint8Array(O.w_size);v.set(T.subarray(X-O.w_size,X),0),T=v,X=O.w_size}const B=v.avail_in,m=v.next_in,A=v.input;for(v.avail_in=X,v.next_in=0,v.input=T,e(O);O.lookahead>=3;){let v=O.strstart,T=O.lookahead-2;do{O.ins_h=c(O,O.ins_h,O.window[v+3-1]),O.prev[v&O.w_mask]=O.head[O.ins_h],O.head[O.ins_h]=v,v++}while(--T);O.strstart=v,O.lookahead=2,e(O)}return O.strstart+=O.lookahead,O.block_start=O.strstart,O.insert=O.lookahead,O.lookahead=0,O.match_length=O.prev_length=2,O.match_available=0,v.next_in=m,v.input=A,v.avail_in=B,O.wrap=u,F},v.exports.deflateInfo="pako deflate (from Nodeca project)"},11875:v=>{"use strict";v.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},11860:v=>{"use strict";v.exports=function(v,T){let X,O,u,B,m,A,x,f,M,H,n,V,D,s,F,k,b,l,Q,K,p,G,L,r;const o=v.state;X=v.next_in,L=v.input,O=X+(v.avail_in-5),u=v.next_out,r=v.output,B=u-(T-v.avail_out),m=u+(v.avail_out-257),A=o.dmax,x=o.wsize,f=o.whave,M=o.wnext,H=o.window,n=o.hold,V=o.bits,D=o.lencode,s=o.distcode,F=(1<<o.lenbits)-1,k=(1<<o.distbits)-1;v:do{V<15&&(n+=L[X++]<<V,V+=8,n+=L[X++]<<V,V+=8),b=D[n&F];T:for(;;){if(l=b>>>24,n>>>=l,V-=l,l=b>>>16&255,0===l)r[u++]=65535&b;else{if(!(16&l)){if(0===(64&l)){b=D[(65535&b)+(n&(1<<l)-1)];continue T}if(32&l){o.mode=12;break v}v.msg="invalid literal/length code",o.mode=30;break v}Q=65535&b,l&=15,l&&(V<l&&(n+=L[X++]<<V,V+=8),Q+=n&(1<<l)-1,n>>>=l,V-=l),V<15&&(n+=L[X++]<<V,V+=8,n+=L[X++]<<V,V+=8),b=s[n&k];X:for(;;){if(l=b>>>24,n>>>=l,V-=l,l=b>>>16&255,!(16&l)){if(0===(64&l)){b=s[(65535&b)+(n&(1<<l)-1)];continue X}v.msg="invalid distance code",o.mode=30;break v}if(K=65535&b,l&=15,V<l&&(n+=L[X++]<<V,V+=8,V<l&&(n+=L[X++]<<V,V+=8)),K+=n&(1<<l)-1,K>A){v.msg="invalid distance too far back",o.mode=30;break v}if(n>>>=l,V-=l,l=u-B,K>l){if(l=K-l,l>f&&o.sane){v.msg="invalid distance too far back",o.mode=30;break v}if(p=0,G=H,0===M){if(p+=x-l,l<Q){Q-=l;do{r[u++]=H[p++]}while(--l);p=u-K,G=r}}else if(M<l){if(p+=x+M-l,l-=M,l<Q){Q-=l;do{r[u++]=H[p++]}while(--l);if(p=0,M<Q){l=M,Q-=l;do{r[u++]=H[p++]}while(--l);p=u-K,G=r}}}else if(p+=M-l,l<Q){Q-=l;do{r[u++]=H[p++]}while(--l);p=u-K,G=r}for(;Q>2;)r[u++]=G[p++],r[u++]=G[p++],r[u++]=G[p++],Q-=3;Q&&(r[u++]=G[p++],Q>1&&(r[u++]=G[p++]))}else{p=u-K;do{r[u++]=r[p++],r[u++]=r[p++],r[u++]=r[p++],Q-=3}while(Q>2);Q&&(r[u++]=r[p++],Q>1&&(r[u++]=r[p++]))}break}}break}}while(X<O&&u<m);Q=V>>3,X-=Q,V-=Q<<3,n&=(1<<V)-1,v.next_in=X,v.next_out=u,v.avail_in=X<O?O-X+5:5-(X-O),v.avail_out=u<m?m-u+257:257-(u-m),o.hold=n,o.bits=V}},11853:(v,T,X)=>{"use strict";const O=X(11806),u=X(11813),B=X(11860),m=X(11869),{Z_FINISH:A,Z_BLOCK:x,Z_TREES:f,Z_OK:M,Z_STREAM_END:H,Z_NEED_DICT:n,Z_STREAM_ERROR:V,Z_DATA_ERROR:D,Z_MEM_ERROR:s,Z_BUF_ERROR:F,Z_DEFLATED:k}=X(11818),b=12,l=30,Q=v=>(v>>>24&255)+(v>>>8&65280)+((65280&v)<<8)+((255&v)<<24);function K(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const p=v=>{if(!v||!v.state)return V;const T=v.state;return v.total_in=v.total_out=T.total=0,v.msg="",T.wrap&&(v.adler=1&T.wrap),T.mode=1,T.last=0,T.havedict=0,T.dmax=32768,T.head=null,T.hold=0,T.bits=0,T.lencode=T.lendyn=new Int32Array(852),T.distcode=T.distdyn=new Int32Array(592),T.sane=1,T.back=-1,M},G=v=>{if(!v||!v.state)return V;const T=v.state;return T.wsize=0,T.whave=0,T.wnext=0,p(v)},L=(v,T)=>{let X;if(!v||!v.state)return V;const O=v.state;return T<0?(X=0,T=-T):(X=1+(T>>4),T<48&&(T&=15)),T&&(T<8||T>15)?V:(null!==O.window&&O.wbits!==T&&(O.window=null),O.wrap=X,O.wbits=T,G(v))},r=(v,T)=>{if(!v)return V;const X=new K;v.state=X,X.window=null;const O=L(v,T);return O!==M&&(v.state=null),O};let o,Z,U=!0;const J=v=>{if(U){o=new Int32Array(512),Z=new Int32Array(32);let T=0;for(;T<144;)v.lens[T++]=8;for(;T<256;)v.lens[T++]=9;for(;T<280;)v.lens[T++]=7;for(;T<288;)v.lens[T++]=8;for(m(1,v.lens,0,288,o,0,v.work,{bits:9}),T=0;T<32;)v.lens[T++]=5;m(2,v.lens,0,32,Z,0,v.work,{bits:5}),U=!1}v.lencode=o,v.lenbits=9,v.distcode=Z,v.distbits=5},y=(v,T,X,O)=>{let u;const B=v.state;return null===B.window&&(B.wsize=1<<B.wbits,B.wnext=0,B.whave=0,B.window=new Uint8Array(B.wsize)),O>=B.wsize?(B.window.set(T.subarray(X-B.wsize,X),0),B.wnext=0,B.whave=B.wsize):(u=B.wsize-B.wnext,u>O&&(u=O),B.window.set(T.subarray(X-O,X-O+u),B.wnext),(O-=u)?(B.window.set(T.subarray(X-O,X),0),B.wnext=O,B.whave=B.wsize):(B.wnext+=u,B.wnext===B.wsize&&(B.wnext=0),B.whave<B.wsize&&(B.whave+=u))),0};v.exports.inflateReset=G,v.exports.inflateReset2=L,v.exports.inflateResetKeep=p,v.exports.inflateInit=v=>r(v,15),v.exports.inflateInit2=r,v.exports.inflate=(v,T)=>{let X,K,p,G,L,r,o,Z,U,P,a,E,i,t,C,c,N,d,I,W,g,j,e=0;const h=new Uint8Array(4);let S,w;const z=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!v||!v.state||!v.output||!v.input&&0!==v.avail_in)return V;X=v.state,X.mode===b&&(X.mode=13),L=v.next_out,p=v.output,o=v.avail_out,G=v.next_in,K=v.input,r=v.avail_in,Z=X.hold,U=X.bits,P=r,a=o,j=M;v:for(;;)switch(X.mode){case 1:if(0===X.wrap){X.mode=13;break}for(;U<16;){if(0===r)break v;r--,Z+=K[G++]<<U,U+=8}if(2&X.wrap&&35615===Z){X.check=0,h[0]=255&Z,h[1]=Z>>>8&255,X.check=u(X.check,h,2,0),Z=0,U=0,X.mode=2;break}if(X.flags=0,X.head&&(X.head.done=!1),!(1&X.wrap)||(((255&Z)<<8)+(Z>>8))%31){v.msg="incorrect header check",X.mode=l;break}if((15&Z)!==k){v.msg="unknown compression method",X.mode=l;break}if(Z>>>=4,U-=4,g=8+(15&Z),0===X.wbits)X.wbits=g;else if(g>X.wbits){v.msg="invalid window size",X.mode=l;break}X.dmax=1<<X.wbits,v.adler=X.check=1,X.mode=512&Z?10:b,Z=0,U=0;break;case 2:for(;U<16;){if(0===r)break v;r--,Z+=K[G++]<<U,U+=8}if(X.flags=Z,(255&X.flags)!==k){v.msg="unknown compression method",X.mode=l;break}if(57344&X.flags){v.msg="unknown header flags set",X.mode=l;break}X.head&&(X.head.text=Z>>8&1),512&X.flags&&(h[0]=255&Z,h[1]=Z>>>8&255,X.check=u(X.check,h,2,0)),Z=0,U=0,X.mode=3;case 3:for(;U<32;){if(0===r)break v;r--,Z+=K[G++]<<U,U+=8}X.head&&(X.head.time=Z),512&X.flags&&(h[0]=255&Z,h[1]=Z>>>8&255,h[2]=Z>>>16&255,h[3]=Z>>>24&255,X.check=u(X.check,h,4,0)),Z=0,U=0,X.mode=4;case 4:for(;U<16;){if(0===r)break v;r--,Z+=K[G++]<<U,U+=8}X.head&&(X.head.xflags=255&Z,X.head.os=Z>>8),512&X.flags&&(h[0]=255&Z,h[1]=Z>>>8&255,X.check=u(X.check,h,2,0)),Z=0,U=0,X.mode=5;case 5:if(1024&X.flags){for(;U<16;){if(0===r)break v;r--,Z+=K[G++]<<U,U+=8}X.length=Z,X.head&&(X.head.extra_len=Z),512&X.flags&&(h[0]=255&Z,h[1]=Z>>>8&255,X.check=u(X.check,h,2,0)),Z=0,U=0}else X.head&&(X.head.extra=null);X.mode=6;case 6:if(1024&X.flags&&(E=X.length,E>r&&(E=r),E&&(X.head&&(g=X.head.extra_len-X.length,X.head.extra||(X.head.extra=new Uint8Array(X.head.extra_len)),X.head.extra.set(K.subarray(G,G+E),g)),512&X.flags&&(X.check=u(X.check,K,E,G)),r-=E,G+=E,X.length-=E),X.length))break v;X.length=0,X.mode=7;case 7:if(2048&X.flags){if(0===r)break v;E=0;do{g=K[G+E++],X.head&&g&&X.length<65536&&(X.head.name+=String.fromCharCode(g))}while(g&&E<r);if(512&X.flags&&(X.check=u(X.check,K,E,G)),r-=E,G+=E,g)break v}else X.head&&(X.head.name=null);X.length=0,X.mode=8;case 8:if(4096&X.flags){if(0===r)break v;E=0;do{g=K[G+E++],X.head&&g&&X.length<65536&&(X.head.comment+=String.fromCharCode(g))}while(g&&E<r);if(512&X.flags&&(X.check=u(X.check,K,E,G)),r-=E,G+=E,g)break v}else X.head&&(X.head.comment=null);X.mode=9;case 9:if(512&X.flags){for(;U<16;){if(0===r)break v;r--,Z+=K[G++]<<U,U+=8}if(Z!==(65535&X.check)){v.msg="header crc mismatch",X.mode=l;break}Z=0,U=0}X.head&&(X.head.hcrc=X.flags>>9&1,X.head.done=!0),v.adler=X.check=0,X.mode=b;break;case 10:for(;U<32;){if(0===r)break v;r--,Z+=K[G++]<<U,U+=8}v.adler=X.check=Q(Z),Z=0,U=0,X.mode=11;case 11:if(0===X.havedict)return v.next_out=L,v.avail_out=o,v.next_in=G,v.avail_in=r,X.hold=Z,X.bits=U,n;v.adler=X.check=1,X.mode=b;case b:if(T===x||T===f)break v;case 13:if(X.last){Z>>>=7&U,U-=7&U,X.mode=27;break}for(;U<3;){if(0===r)break v;r--,Z+=K[G++]<<U,U+=8}switch(X.last=1&Z,Z>>>=1,U-=1,3&Z){case 0:X.mode=14;break;case 1:if(J(X),X.mode=20,T===f){Z>>>=2,U-=2;break v}break;case 2:X.mode=17;break;case 3:v.msg="invalid block type",X.mode=l}Z>>>=2,U-=2;break;case 14:for(Z>>>=7&U,U-=7&U;U<32;){if(0===r)break v;r--,Z+=K[G++]<<U,U+=8}if((65535&Z)!==(Z>>>16^65535)){v.msg="invalid stored block lengths",X.mode=l;break}if(X.length=65535&Z,Z=0,U=0,X.mode=15,T===f)break v;case 15:X.mode=16;case 16:if(E=X.length,E){if(E>r&&(E=r),E>o&&(E=o),0===E)break v;p.set(K.subarray(G,G+E),L),r-=E,G+=E,o-=E,L+=E,X.length-=E;break}X.mode=b;break;case 17:for(;U<14;){if(0===r)break v;r--,Z+=K[G++]<<U,U+=8}if(X.nlen=257+(31&Z),Z>>>=5,U-=5,X.ndist=1+(31&Z),Z>>>=5,U-=5,X.ncode=4+(15&Z),Z>>>=4,U-=4,X.nlen>286||X.ndist>30){v.msg="too many length or distance symbols",X.mode=l;break}X.have=0,X.mode=18;case 18:for(;X.have<X.ncode;){for(;U<3;){if(0===r)break v;r--,Z+=K[G++]<<U,U+=8}X.lens[z[X.have++]]=7&Z,Z>>>=3,U-=3}for(;X.have<19;)X.lens[z[X.have++]]=0;if(X.lencode=X.lendyn,X.lenbits=7,S={bits:X.lenbits},j=m(0,X.lens,0,19,X.lencode,0,X.work,S),X.lenbits=S.bits,j){v.msg="invalid code lengths set",X.mode=l;break}X.have=0,X.mode=19;case 19:for(;X.have<X.nlen+X.ndist;){for(;e=X.lencode[Z&(1<<X.lenbits)-1],C=e>>>24,c=e>>>16&255,N=65535&e,!(C<=U);){if(0===r)break v;r--,Z+=K[G++]<<U,U+=8}if(N<16)Z>>>=C,U-=C,X.lens[X.have++]=N;else{if(16===N){for(w=C+2;U<w;){if(0===r)break v;r--,Z+=K[G++]<<U,U+=8}if(Z>>>=C,U-=C,0===X.have){v.msg="invalid bit length repeat",X.mode=l;break}g=X.lens[X.have-1],E=3+(3&Z),Z>>>=2,U-=2}else if(17===N){for(w=C+3;U<w;){if(0===r)break v;r--,Z+=K[G++]<<U,U+=8}Z>>>=C,U-=C,g=0,E=3+(7&Z),Z>>>=3,U-=3}else{for(w=C+7;U<w;){if(0===r)break v;r--,Z+=K[G++]<<U,U+=8}Z>>>=C,U-=C,g=0,E=11+(127&Z),Z>>>=7,U-=7}if(X.have+E>X.nlen+X.ndist){v.msg="invalid bit length repeat",X.mode=l;break}for(;E--;)X.lens[X.have++]=g}}if(X.mode===l)break;if(0===X.lens[256]){v.msg="invalid code -- missing end-of-block",X.mode=l;break}if(X.lenbits=9,S={bits:X.lenbits},j=m(1,X.lens,0,X.nlen,X.lencode,0,X.work,S),X.lenbits=S.bits,j){v.msg="invalid literal/lengths set",X.mode=l;break}if(X.distbits=6,X.distcode=X.distdyn,S={bits:X.distbits},j=m(2,X.lens,X.nlen,X.ndist,X.distcode,0,X.work,S),X.distbits=S.bits,j){v.msg="invalid distances set",X.mode=l;break}if(X.mode=20,T===f)break v;case 20:X.mode=21;case 21:if(r>=6&&o>=258){v.next_out=L,v.avail_out=o,v.next_in=G,v.avail_in=r,X.hold=Z,X.bits=U,B(v,a),L=v.next_out,p=v.output,o=v.avail_out,G=v.next_in,K=v.input,r=v.avail_in,Z=X.hold,U=X.bits,X.mode===b&&(X.back=-1);break}for(X.back=0;e=X.lencode[Z&(1<<X.lenbits)-1],C=e>>>24,c=e>>>16&255,N=65535&e,!(C<=U);){if(0===r)break v;r--,Z+=K[G++]<<U,U+=8}if(c&&0===(240&c)){for(d=C,I=c,W=N;e=X.lencode[W+((Z&(1<<d+I)-1)>>d)],C=e>>>24,c=e>>>16&255,N=65535&e,!(d+C<=U);){if(0===r)break v;r--,Z+=K[G++]<<U,U+=8}Z>>>=d,U-=d,X.back+=d}if(Z>>>=C,U-=C,X.back+=C,X.length=N,0===c){X.mode=26;break}if(32&c){X.back=-1,X.mode=b;break}if(64&c){v.msg="invalid literal/length code",X.mode=l;break}X.extra=15&c,X.mode=22;case 22:if(X.extra){for(w=X.extra;U<w;){if(0===r)break v;r--,Z+=K[G++]<<U,U+=8}X.length+=Z&(1<<X.extra)-1,Z>>>=X.extra,U-=X.extra,X.back+=X.extra}X.was=X.length,X.mode=23;case 23:for(;e=X.distcode[Z&(1<<X.distbits)-1],C=e>>>24,c=e>>>16&255,N=65535&e,!(C<=U);){if(0===r)break v;r--,Z+=K[G++]<<U,U+=8}if(0===(240&c)){for(d=C,I=c,W=N;e=X.distcode[W+((Z&(1<<d+I)-1)>>d)],C=e>>>24,c=e>>>16&255,N=65535&e,!(d+C<=U);){if(0===r)break v;r--,Z+=K[G++]<<U,U+=8}Z>>>=d,U-=d,X.back+=d}if(Z>>>=C,U-=C,X.back+=C,64&c){v.msg="invalid distance code",X.mode=l;break}X.offset=N,X.extra=15&c,X.mode=24;case 24:if(X.extra){for(w=X.extra;U<w;){if(0===r)break v;r--,Z+=K[G++]<<U,U+=8}X.offset+=Z&(1<<X.extra)-1,Z>>>=X.extra,U-=X.extra,X.back+=X.extra}if(X.offset>X.dmax){v.msg="invalid distance too far back",X.mode=l;break}X.mode=25;case 25:if(0===o)break v;if(E=a-o,X.offset>E){if(E=X.offset-E,E>X.whave&&X.sane){v.msg="invalid distance too far back",X.mode=l;break}E>X.wnext?(E-=X.wnext,i=X.wsize-E):i=X.wnext-E,E>X.length&&(E=X.length),t=X.window}else t=p,i=L-X.offset,E=X.length;E>o&&(E=o),o-=E,X.length-=E;do{p[L++]=t[i++]}while(--E);0===X.length&&(X.mode=21);break;case 26:if(0===o)break v;p[L++]=X.length,o--,X.mode=21;break;case 27:if(X.wrap){for(;U<32;){if(0===r)break v;r--,Z|=K[G++]<<U,U+=8}if(a-=o,v.total_out+=a,X.total+=a,a&&(v.adler=X.check=X.flags?u(X.check,p,a,L-a):O(X.check,p,a,L-a)),a=o,(X.flags?Z:Q(Z))!==X.check){v.msg="incorrect data check",X.mode=l;break}Z=0,U=0}X.mode=28;case 28:if(X.wrap&&X.flags){for(;U<32;){if(0===r)break v;r--,Z+=K[G++]<<U,U+=8}if(Z!==(4294967295&X.total)){v.msg="incorrect length check",X.mode=l;break}Z=0,U=0}X.mode=29;case 29:j=H;break v;case l:j=D;break v;case 31:return s;default:return V}return v.next_out=L,v.avail_out=o,v.next_in=G,v.avail_in=r,X.hold=Z,X.bits=U,(X.wsize||a!==v.avail_out&&X.mode<l&&(X.mode<27||T!==A))&&y(v,v.output,v.next_out,a-v.avail_out)?(X.mode=31,s):(P-=v.avail_in,a-=v.avail_out,v.total_in+=P,v.total_out+=a,X.total+=a,X.wrap&&a&&(v.adler=X.check=X.flags?u(X.check,p,a,v.next_out-a):O(X.check,p,a,v.next_out-a)),v.data_type=X.bits+(X.last?64:0)+(X.mode===b?128:0)+(20===X.mode||15===X.mode?256:0),(0===P&&0===a||T===A)&&j===M&&(j=F),j)},v.exports.inflateEnd=v=>{if(!v||!v.state)return V;let T=v.state;return T.window&&(T.window=null),v.state=null,M},v.exports.inflateGetHeader=(v,T)=>{if(!v||!v.state)return V;const X=v.state;return 0===(2&X.wrap)?V:(X.head=T,T.done=!1,M)},v.exports.inflateSetDictionary=(v,T)=>{const X=T.length;let u,B,m;return v&&v.state?(u=v.state,0!==u.wrap&&11!==u.mode?V:11===u.mode&&(B=1,B=O(B,T,X,0),B!==u.check)?D:(m=y(v,T,X,X),m?(u.mode=31,s):(u.havedict=1,M))):V},v.exports.inflateInfo="pako inflate (from Nodeca project)"},11869:v=>{"use strict";const T=15,X=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),O=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),u=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),B=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);v.exports=(v,m,A,x,f,M,H,n)=>{const V=n.bits;let D,s,F,k,b,l,Q=0,K=0,p=0,G=0,L=0,r=0,o=0,Z=0,U=0,J=0,y=null,P=0;const a=new Uint16Array(16),E=new Uint16Array(16);let i,t,C,c=null,N=0;for(Q=0;Q<=T;Q++)a[Q]=0;for(K=0;K<x;K++)a[m[A+K]]++;for(L=V,G=T;G>=1&&0===a[G];G--);if(L>G&&(L=G),0===G)return f[M++]=20971520,f[M++]=20971520,n.bits=1,0;for(p=1;p<G&&0===a[p];p++);for(L<p&&(L=p),Z=1,Q=1;Q<=T;Q++)if(Z<<=1,Z-=a[Q],Z<0)return-1;if(Z>0&&(0===v||1!==G))return-1;for(E[1]=0,Q=1;Q<T;Q++)E[Q+1]=E[Q]+a[Q];for(K=0;K<x;K++)0!==m[A+K]&&(H[E[m[A+K]]++]=K);if(0===v?(y=c=H,l=19):1===v?(y=X,P-=257,c=O,N-=257,l=256):(y=u,c=B,l=-1),J=0,K=0,Q=p,b=M,r=L,o=0,F=-1,U=1<<L,k=U-1,1===v&&U>852||2===v&&U>592)return 1;for(;;){i=Q-o,H[K]<l?(t=0,C=H[K]):H[K]>l?(t=c[N+H[K]],C=y[P+H[K]]):(t=96,C=0),D=1<<Q-o,s=1<<r,p=s;do{s-=D,f[b+(J>>o)+s]=i<<24|t<<16|C}while(0!==s);for(D=1<<Q-1;J&D;)D>>=1;if(0!==D?(J&=D-1,J+=D):J=0,K++,0===--a[Q]){if(Q===G)break;Q=m[A+H[K]]}if(Q>L&&(J&k)!==F){for(0===o&&(o=L),b+=p,r=Q-o,Z=1<<r;r+o<G&&(Z-=a[r+o],!(Z<=0));)r++,Z<<=1;if(U+=1<<r,1===v&&U>852||2===v&&U>592)return 1;F=J&k,f[F]=L<<24|r<<16|b-M}}return 0!==J&&(f[b+J]=Q-o<<24|64<<16),n.bits=L,0}},11816:v=>{"use strict";v.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},11804:v=>{"use strict";function T(v){let T=v.length;for(;--T>=0;)v[T]=0}const X=256,O=286,u=30,B=15,m=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),A=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),x=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),f=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),M=new Array(576);T(M);const H=new Array(60);T(H);const n=new Array(512);T(n);const V=new Array(256);T(V);const D=new Array(29);T(D);const s=new Array(u);function F(v,T,X,O,u){this.static_tree=v,this.extra_bits=T,this.extra_base=X,this.elems=O,this.max_length=u,this.has_stree=v&&v.length}let k,b,l;function Q(v,T){this.dyn_tree=v,this.max_code=0,this.stat_desc=T}T(s);const K=v=>v<256?n[v]:n[256+(v>>>7)],p=(v,T)=>{v.pending_buf[v.pending++]=255&T,v.pending_buf[v.pending++]=T>>>8&255},G=(v,T,X)=>{v.bi_valid>16-X?(v.bi_buf|=T<<v.bi_valid&65535,p(v,v.bi_buf),v.bi_buf=T>>16-v.bi_valid,v.bi_valid+=X-16):(v.bi_buf|=T<<v.bi_valid&65535,v.bi_valid+=X)},L=(v,T,X)=>{G(v,X[2*T],X[2*T+1])},r=(v,T)=>{let X=0;do{X|=1&v,v>>>=1,X<<=1}while(--T>0);return X>>>1},o=(v,T,X)=>{const O=new Array(16);let u,m,A=0;for(u=1;u<=B;u++)O[u]=A=A+X[u-1]<<1;for(m=0;m<=T;m++){let T=v[2*m+1];0!==T&&(v[2*m]=r(O[T]++,T))}},Z=v=>{let T;for(T=0;T<O;T++)v.dyn_ltree[2*T]=0;for(T=0;T<u;T++)v.dyn_dtree[2*T]=0;for(T=0;T<19;T++)v.bl_tree[2*T]=0;v.dyn_ltree[512]=1,v.opt_len=v.static_len=0,v.last_lit=v.matches=0},U=v=>{v.bi_valid>8?p(v,v.bi_buf):v.bi_valid>0&&(v.pending_buf[v.pending++]=v.bi_buf),v.bi_buf=0,v.bi_valid=0},J=(v,T,X,O)=>{const u=2*T,B=2*X;return v[u]<v[B]||v[u]===v[B]&&O[T]<=O[X]},y=(v,T,X)=>{const O=v.heap[X];let u=X<<1;for(;u<=v.heap_len&&(u<v.heap_len&&J(T,v.heap[u+1],v.heap[u],v.depth)&&u++,!J(T,O,v.heap[u],v.depth));)v.heap[X]=v.heap[u],X=u,u<<=1;v.heap[X]=O},P=(v,T,O)=>{let u,B,x,f,M=0;if(0!==v.last_lit)do{u=v.pending_buf[v.d_buf+2*M]<<8|v.pending_buf[v.d_buf+2*M+1],B=v.pending_buf[v.l_buf+M],M++,0===u?L(v,B,T):(x=V[B],L(v,x+X+1,T),f=m[x],0!==f&&(B-=D[x],G(v,B,f)),u--,x=K(u),L(v,x,O),f=A[x],0!==f&&(u-=s[x],G(v,u,f)))}while(M<v.last_lit);L(v,256,T)},a=(v,T)=>{const X=T.dyn_tree,O=T.stat_desc.static_tree,u=T.stat_desc.has_stree,m=T.stat_desc.elems;let A,x,f,M=-1;for(v.heap_len=0,v.heap_max=573,A=0;A<m;A++)0!==X[2*A]?(v.heap[++v.heap_len]=M=A,v.depth[A]=0):X[2*A+1]=0;for(;v.heap_len<2;)f=v.heap[++v.heap_len]=M<2?++M:0,X[2*f]=1,v.depth[f]=0,v.opt_len--,u&&(v.static_len-=O[2*f+1]);for(T.max_code=M,A=v.heap_len>>1;A>=1;A--)y(v,X,A);f=m;do{A=v.heap[1],v.heap[1]=v.heap[v.heap_len--],y(v,X,1),x=v.heap[1],v.heap[--v.heap_max]=A,v.heap[--v.heap_max]=x,X[2*f]=X[2*A]+X[2*x],v.depth[f]=(v.depth[A]>=v.depth[x]?v.depth[A]:v.depth[x])+1,X[2*A+1]=X[2*x+1]=f,v.heap[1]=f++,y(v,X,1)}while(v.heap_len>=2);v.heap[--v.heap_max]=v.heap[1],((v,T)=>{const X=T.dyn_tree,O=T.max_code,u=T.stat_desc.static_tree,m=T.stat_desc.has_stree,A=T.stat_desc.extra_bits,x=T.stat_desc.extra_base,f=T.stat_desc.max_length;let M,H,n,V,D,s,F=0;for(V=0;V<=B;V++)v.bl_count[V]=0;for(X[2*v.heap[v.heap_max]+1]=0,M=v.heap_max+1;M<573;M++)H=v.heap[M],V=X[2*X[2*H+1]+1]+1,V>f&&(V=f,F++),X[2*H+1]=V,H>O||(v.bl_count[V]++,D=0,H>=x&&(D=A[H-x]),s=X[2*H],v.opt_len+=s*(V+D),m&&(v.static_len+=s*(u[2*H+1]+D)));if(0!==F){do{for(V=f-1;0===v.bl_count[V];)V--;v.bl_count[V]--,v.bl_count[V+1]+=2,v.bl_count[f]--,F-=2}while(F>0);for(V=f;0!==V;V--)for(H=v.bl_count[V];0!==H;)n=v.heap[--M],n>O||(X[2*n+1]!==V&&(v.opt_len+=(V-X[2*n+1])*X[2*n],X[2*n+1]=V),H--)}})(v,T),o(X,M,v.bl_count)},E=(v,T,X)=>{let O,u,B=-1,m=T[1],A=0,x=7,f=4;for(0===m&&(x=138,f=3),T[2*(X+1)+1]=65535,O=0;O<=X;O++)u=m,m=T[2*(O+1)+1],++A<x&&u===m||(A<f?v.bl_tree[2*u]+=A:0!==u?(u!==B&&v.bl_tree[2*u]++,v.bl_tree[32]++):A<=10?v.bl_tree[34]++:v.bl_tree[36]++,A=0,B=u,0===m?(x=138,f=3):u===m?(x=6,f=3):(x=7,f=4))},i=(v,T,X)=>{let O,u,B=-1,m=T[1],A=0,x=7,f=4;for(0===m&&(x=138,f=3),O=0;O<=X;O++)if(u=m,m=T[2*(O+1)+1],!(++A<x&&u===m)){if(A<f)do{L(v,u,v.bl_tree)}while(0!==--A);else 0!==u?(u!==B&&(L(v,u,v.bl_tree),A--),L(v,16,v.bl_tree),G(v,A-3,2)):A<=10?(L(v,17,v.bl_tree),G(v,A-3,3)):(L(v,18,v.bl_tree),G(v,A-11,7));A=0,B=u,0===m?(x=138,f=3):u===m?(x=6,f=3):(x=7,f=4)}};let t=!1;const C=(v,T,X,O)=>{G(v,0+(O?1:0),3),((v,T,X,O)=>{U(v),O&&(p(v,X),p(v,~X)),v.pending_buf.set(v.window.subarray(T,T+X),v.pending),v.pending+=X})(v,T,X,!0)};v.exports._tr_init=v=>{t||((()=>{let v,T,X,f,Q;const K=new Array(16);for(X=0,f=0;f<28;f++)for(D[f]=X,v=0;v<1<<m[f];v++)V[X++]=f;for(V[X-1]=f,Q=0,f=0;f<16;f++)for(s[f]=Q,v=0;v<1<<A[f];v++)n[Q++]=f;for(Q>>=7;f<u;f++)for(s[f]=Q<<7,v=0;v<1<<A[f]-7;v++)n[256+Q++]=f;for(T=0;T<=B;T++)K[T]=0;for(v=0;v<=143;)M[2*v+1]=8,v++,K[8]++;for(;v<=255;)M[2*v+1]=9,v++,K[9]++;for(;v<=279;)M[2*v+1]=7,v++,K[7]++;for(;v<=287;)M[2*v+1]=8,v++,K[8]++;for(o(M,287,K),v=0;v<u;v++)H[2*v+1]=5,H[2*v]=r(v,5);k=new F(M,m,257,O,B),b=new F(H,A,0,u,B),l=new F(new Array(0),x,0,19,7)})(),t=!0),v.l_desc=new Q(v.dyn_ltree,k),v.d_desc=new Q(v.dyn_dtree,b),v.bl_desc=new Q(v.bl_tree,l),v.bi_buf=0,v.bi_valid=0,Z(v)},v.exports._tr_stored_block=C,v.exports._tr_flush_block=(v,T,O,u)=>{let B,m,A=0;v.level>0?(2===v.strm.data_type&&(v.strm.data_type=(v=>{let T,O=4093624447;for(T=0;T<=31;T++,O>>>=1)if(1&O&&0!==v.dyn_ltree[2*T])return 0;if(0!==v.dyn_ltree[18]||0!==v.dyn_ltree[20]||0!==v.dyn_ltree[26])return 1;for(T=32;T<X;T++)if(0!==v.dyn_ltree[2*T])return 1;return 0})(v)),a(v,v.l_desc),a(v,v.d_desc),A=(v=>{let T;for(E(v,v.dyn_ltree,v.l_desc.max_code),E(v,v.dyn_dtree,v.d_desc.max_code),a(v,v.bl_desc),T=18;T>=3&&0===v.bl_tree[2*f[T]+1];T--);return v.opt_len+=3*(T+1)+5+5+4,T})(v),B=v.opt_len+3+7>>>3,m=v.static_len+3+7>>>3,m<=B&&(B=m)):B=m=O+5,O+4<=B&&-1!==T?C(v,T,O,u):4===v.strategy||m===B?(G(v,2+(u?1:0),3),P(v,M,H)):(G(v,4+(u?1:0),3),((v,T,X,O)=>{let u;for(G(v,T-257,5),G(v,X-1,5),G(v,O-4,4),u=0;u<O;u++)G(v,v.bl_tree[2*f[u]+1],3);i(v,v.dyn_ltree,T-1),i(v,v.dyn_dtree,X-1)})(v,v.l_desc.max_code+1,v.d_desc.max_code+1,A+1),P(v,v.dyn_ltree,v.dyn_dtree)),Z(v),u&&U(v)},v.exports._tr_tally=(v,T,O)=>(v.pending_buf[v.d_buf+2*v.last_lit]=T>>>8&255,v.pending_buf[v.d_buf+2*v.last_lit+1]=255&T,v.pending_buf[v.l_buf+v.last_lit]=255&O,v.last_lit++,0===T?v.dyn_ltree[2*O]++:(v.matches++,T--,v.dyn_ltree[2*(V[O]+X+1)]++,v.dyn_dtree[2*K(T)]++),v.last_lit===v.lit_bufsize-1),v.exports._tr_align=v=>{G(v,2,3),L(v,256,M),(v=>{16===v.bi_valid?(p(v,v.bi_buf),v.bi_buf=0,v.bi_valid=0):v.bi_valid>=8&&(v.pending_buf[v.pending++]=255&v.bi_buf,v.bi_buf>>=8,v.bi_valid-=8)})(v)}},11841:v=>{"use strict";v.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},12248:v=>{function T(v,T,X){for(var O=v.length,u=-1/0,B=1/0,m=0;m<O;m++){var A=(X[0][m]-v[m])/T[m],x=(X[1][m]-v[m])/T[m];if(A>x){var f=A;A=x,x=f}if(x<u||A>B)return 1/0;A>u&&(u=A),x<B&&(B=x)}return u>B?1/0:u}v.exports=function(v,X,O,u){var B=T(X,O,u);if(B===1/0)v=null;else{v=v||[];for(var m=0;m<X.length;m++)v[m]=X[m]+O[m]*B}return v},v.exports.distance=T},12928:(v,T,X)=>{"use strict";X.d(T,{e:()=>m});var O=X(26);const u=O.useLayoutEffect;const B=function(v){var T=(0,O.useRef)(v);return u((function(){T.current=v})),T};var m=function(v){var T=B(v);(0,O.useEffect)((function(){var v=function(v){var X;if(null!=T.current&&(X=T.current(v)),v.defaultPrevented&&(v.returnValue=""),"string"===typeof X)return v.returnValue=X,X};return window.addEventListener("beforeunload",v),function(){window.removeEventListener("beforeunload",v)}}),[])}},12889:(v,T,X)=>{"use strict";var O=X(12898),u=Array.prototype.concat,B=Array.prototype.slice,m=v.exports=function(v){for(var T=[],X=0,m=v.length;X<m;X++){var A=v[X];O(A)?T=u.call(T,B.call(A)):T.push(A)}return T};m.wrap=function(v){return function(){return v(m(arguments))}}},12898:v=>{v.exports=function(v){return!(!v||"string"===typeof v)&&(v instanceof Array||Array.isArray(v)||v.length>=0&&(v.splice instanceof Function||Object.getOwnPropertyDescriptor(v,v.length-1)&&"String"!==v.constructor.name))}},11756:(v,T,X)=>{var O=X(11764);function u(v){for(var T,X,u=0,B=v.length,m=0;m<v.length;){for(T=v[m],X=0;m<B&&v[m]===T;)++m,++X;u+=O.log2(X)/7|0,u+=O.log2(T>>>0)/7|0,u+=2}return u}T.size=u,T.encode=function(v,T){T||(T=new Uint8Array(u(v)));for(var X,O,B=0,m=T.length,A=0;A<v.length;){for(X=v[A],O=0;A<v.length&&v[A]===X;)++A,++O;for(;B<m&&O>=128;)T[B++]=128+(127&O),O>>>=7;if(B>=m)throw new Error("RLE buffer overflow");for(T[B++]=O,X>>>=0;B<m&&X>=128;)T[B++]=128+(127&X),X>>>=7;if(B>=m)throw new Error("RLE buffer overflow");T[B++]=X}return T},T.decode=function(v,T){for(var X,O,u,B,m=T.length,A=v.length,x=0,f=0;f<A;){for(X=0,O=0;f<A&&v[f]>=128;)X+=(127&v[f++])<<O,O+=7;if(X+=v[f++]<<O,f>=A)throw new Error("RLE buffer underrun");if(x+X>m)throw new Error("Chunk buffer overflow");for(u=0,O=0;f<A&&v[f]>=128;)u+=(127&v[f++])<<O,O+=7;if(f>=A)throw new Error("RLE buffer underrun");for(u+=v[f++]<<O,B=0;B<X;++B)T[x++]=u}return T}},11764:(v,T)=>{"use strict";function X(v){var T=32;return(v&=-v)&&T--,65535&v&&(T-=16),16711935&v&&(T-=8),252645135&v&&(T-=4),858993459&v&&(T-=2),1431655765&v&&(T-=1),T}T.INT_BITS=32,T.INT_MAX=2147483647,T.INT_MIN=-1<<31,T.sign=function(v){return(v>0)-(v<0)},T.abs=function(v){var T=v>>31;return(v^T)-T},T.min=function(v,T){return T^(v^T)&-(v<T)},T.max=function(v,T){return v^(v^T)&-(v<T)},T.isPow2=function(v){return!(v&v-1)&&!!v},T.log2=function(v){var T,X;return T=(v>65535)<<4,T|=X=((v>>>=T)>255)<<3,T|=X=((v>>>=X)>15)<<2,(T|=X=((v>>>=X)>3)<<1)|(v>>>=X)>>1},T.log10=function(v){return v>=1e9?9:v>=1e8?8:v>=1e7?7:v>=1e6?6:v>=1e5?5:v>=1e4?4:v>=1e3?3:v>=100?2:v>=10?1:0},T.popCount=function(v){return 16843009*((v=(858993459&(v-=v>>>1&1431655765))+(v>>>2&858993459))+(v>>>4)&252645135)>>>24},T.countTrailingZeros=X,T.nextPow2=function(v){return v+=0===v,--v,v|=v>>>1,v|=v>>>2,v|=v>>>4,v|=v>>>8,(v|=v>>>16)+1},T.prevPow2=function(v){return v|=v>>>1,v|=v>>>2,v|=v>>>4,v|=v>>>8,(v|=v>>>16)-(v>>>1)},T.parity=function(v){return v^=v>>>16,v^=v>>>8,v^=v>>>4,27030>>>(v&=15)&1};var O=new Array(256);!function(v){for(var T=0;T<256;++T){var X=T,O=T,u=7;for(X>>>=1;X;X>>>=1)O<<=1,O|=1&X,--u;v[T]=O<<u&255}}(O),T.reverse=function(v){return O[255&v]<<24|O[v>>>8&255]<<16|O[v>>>16&255]<<8|O[v>>>24&255]},T.interleave2=function(v,T){return(v=1431655765&((v=858993459&((v=252645135&((v=16711935&((v&=65535)|v<<8))|v<<4))|v<<2))|v<<1))|(T=1431655765&((T=858993459&((T=252645135&((T=16711935&((T&=65535)|T<<8))|T<<4))|T<<2))|T<<1))<<1},T.deinterleave2=function(v,T){return(v=65535&((v=16711935&((v=252645135&((v=858993459&((v=v>>>T&1431655765)|v>>>1))|v>>>2))|v>>>4))|v>>>16))<<16>>16},T.interleave3=function(v,T,X){return v=1227133513&((v=3272356035&((v=251719695&((v=4278190335&((v&=1023)|v<<16))|v<<8))|v<<4))|v<<2),(v|=(T=1227133513&((T=3272356035&((T=251719695&((T=4278190335&((T&=1023)|T<<16))|T<<8))|T<<4))|T<<2))<<1)|(X=1227133513&((X=3272356035&((X=251719695&((X=4278190335&((X&=1023)|X<<16))|X<<8))|X<<4))|X<<2))<<2},T.deinterleave3=function(v,T){return(v=1023&((v=4278190335&((v=251719695&((v=3272356035&((v=v>>>T&1227133513)|v>>>2))|v>>>4))|v>>>8))|v>>>16))<<22>>22},T.nextCombination=function(v){var T=v|v-1;return T+1|(~T&-~T)-1>>>X(v)+1}},11783:v=>{"use strict";v.exports=function(v,T,X,O){var u=self||window;try{try{var B;try{B=new u.Blob([v])}catch(f){(B=new(u.BlobBuilder||u.WebKitBlobBuilder||u.MozBlobBuilder||u.MSBlobBuilder)).append(v),B=B.getBlob()}var m=u.URL||u.webkitURL,A=m.createObjectURL(B),x=new u[T](A,X);return m.revokeObjectURL(A),x}catch(f){return new u[T]("data:application/javascript,".concat(encodeURIComponent(v)),X)}}catch(f){if(!O)throw Error("Inline worker is not supported");return new u[T](O,X)}}},12236:(v,T,X)=>{"use strict";function O(v,T,X,O,u){var B={};return Object.keys(O).forEach((function(v){B[v]=O[v]})),B.enumerable=!!B.enumerable,B.configurable=!!B.configurable,("value"in B||B.initializer)&&(B.writable=!0),B=X.slice().reverse().reduce((function(X,O){return O(v,T,X)||X}),B),u&&void 0!==B.initializer&&(B.value=B.initializer?B.initializer.call(u):void 0,B.initializer=void 0),void 0===B.initializer&&(Object.defineProperty(v,T,B),B=null),B}X.d(T,{d:()=>O})},12230:(v,T,X)=>{"use strict";function O(v,T,X,O){X&&Object.defineProperty(v,T,{enumerable:X.enumerable,configurable:X.configurable,writable:X.writable,value:X.initializer?X.initializer.call(O):void 0})}X.d(T,{e:()=>O})},12532:(v,T,X)=>{"use strict";X.d(T,{e:()=>l,h:()=>F,l:()=>k,o:()=>n,q:()=>s,t:()=>D,v:()=>V});var O=X(1006),u=X(1170),B=X(1040),m=X(1023),A=X(12536),x=X(11928),f=X(1154),M=X(1070),H=X(1156);const n=Object.freeze(new O.f(0,0,0,0)),V=Object.freeze(O.l.Zero()),D=Object.freeze(O.i.Zero()),s=Object.freeze(f.e.Zero()),F=Object.freeze(u.d.Black()),k=Object.freeze(new u.g(0,0,0,0)),b={key:0,repeatCount:0,loopMode:2};class l{static _PrepareAnimation(v,T,X,B,m,A,x,M){let H;if(!isNaN(parseFloat(m))&&isFinite(m)?H=l.ANIMATIONTYPE_FLOAT:m instanceof O.f?H=l.ANIMATIONTYPE_QUATERNION:m instanceof O.l?H=l.ANIMATIONTYPE_VECTOR3:m instanceof O.i?H=l.ANIMATIONTYPE_VECTOR2:m instanceof u.d?H=l.ANIMATIONTYPE_COLOR3:m instanceof u.g?H=l.ANIMATIONTYPE_COLOR4:m instanceof f.e&&(H=l.ANIMATIONTYPE_SIZE),void 0==H)return null;const n=new l(v,T,X,H,x),V=[{frame:0,value:m},{frame:B,value:A}];return n.setKeys(V),void 0!==M&&n.setEasingFunction(M),n}static CreateAnimation(v,T,X,O){const u=new l(v+"Animation",v,X,T,l.ANIMATIONLOOPMODE_CONSTANT);return u.setEasingFunction(O),u}static CreateAndStartAnimation(v,T,X,O,u,B,m,A,x,f,M){const H=l._PrepareAnimation(v,X,O,u,B,m,A,x);return H?(T.va&&(M=T.va()),M?M.beginDirectAnimation(T,[H],0,u,1===H.loopMode,1,f):null):null}static CreateAndStartHierarchyAnimation(v,T,X,O,u,B,m,A,x,f,M){const H=l._PrepareAnimation(v,O,u,B,m,A,x,f);if(!H)return null;return T.va().beginDirectHierarchyAnimation(T,X,[H],0,B,1===H.loopMode,1,M)}static CreateMergeAndStartAnimation(v,T,X,O,u,B,m,A,x,f){const M=l._PrepareAnimation(v,X,O,u,B,m,A,x);return M?(T.animations.push(M),T.va().beginAnimation(T,0,u,1===M.loopMode,1,f)):null}static MakeAnimationAdditive(v,T,X){let u;u="object"===typeof T?T:{referenceFrame:T??0,range:X,cloneOriginalAnimation:arguments.length>3&&void 0!==arguments[3]&&arguments[3],clonedAnimationName:arguments.length>4?arguments[4]:void 0};let B=v;if(u.cloneOriginalAnimation&&(B=v.clone(),B.name=u.clonedAnimationName||B.name),!B._keys.length)return B;const m=u.referenceFrame&&u.referenceFrame>=0?u.referenceFrame:0;let A=0;const x=B._keys[0];let f=B._keys.length-1;const M=B._keys[f],H={referenceValue:x.value,referencePosition:O.g.Vd[0],referenceQuaternion:O.g.Quaternion[0],referenceScaling:O.g.Vd[1],keyPosition:O.g.Vd[2],keyQuaternion:O.g.Quaternion[1],keyScaling:O.g.Vd[3]};let n=x.frame,V=M.frame;if(u.range){const v=B.getRange(u.range);v&&(n=v.from,V=v.to)}else n=u.fromFrame??n,V=u.toFrame??V;if(n!==x.frame&&(A=B.createKeyForFrame(n)),V!==M.frame&&(f=B.createKeyForFrame(V)),1===B._keys.length){const v=B._getKeyValue(B._keys[0]);H.referenceValue=v.clone?v.clone():v}else if(m<=x.frame){const v=B._getKeyValue(x.value);H.referenceValue=v.clone?v.clone():v}else if(m>=M.frame){const v=B._getKeyValue(M.value);H.referenceValue=v.clone?v.clone():v}else{b.key=0;const v=B._interpolate(m,b);H.referenceValue=v.clone?v.clone():v}B.dataType===l.ANIMATIONTYPE_QUATERNION?H.referenceValue.normalize().conjugateInPlace():B.dataType===l.ANIMATIONTYPE_MATRIX&&(H.referenceValue.decompose(H.referenceScaling,H.referenceQuaternion,H.referencePosition),H.referenceQuaternion.normalize().conjugateInPlace());let D=Number.MAX_VALUE;const s=u.clipKeys?[]:null;for(let F=A;F<=f;F++){let v=B._keys[F];if((s||u.cloneOriginalAnimation)&&(v={frame:v.frame,value:v.value.clone?v.value.clone():v.value,inTangent:v.inTangent,outTangent:v.outTangent,interpolation:v.interpolation,lockedTangent:v.lockedTangent},s&&(D===Number.MAX_VALUE&&(D=v.frame),v.frame-=D,s.push(v))),!F||B.dataType===l.ANIMATIONTYPE_FLOAT||v.value!==x.value)switch(B.dataType){case l.ANIMATIONTYPE_MATRIX:v.value.decompose(H.keyScaling,H.keyQuaternion,H.keyPosition),H.keyPosition.Kd(H.referencePosition),H.keyScaling.divideInPlace(H.referenceScaling),H.referenceQuaternion.multiplyToRef(H.keyQuaternion,H.keyQuaternion),O.b.ComposeToRef(H.keyScaling,H.keyQuaternion,H.keyPosition,v.value);break;case l.ANIMATIONTYPE_QUATERNION:H.referenceValue.multiplyToRef(v.value,v.value);break;case l.ANIMATIONTYPE_VECTOR2:case l.ANIMATIONTYPE_VECTOR3:case l.ANIMATIONTYPE_COLOR3:case l.ANIMATIONTYPE_COLOR4:v.value.subtractToRef(H.referenceValue,v.value);break;case l.ANIMATIONTYPE_SIZE:v.value.width-=H.referenceValue.width,v.value.height-=H.referenceValue.height;break;default:v.value-=H.referenceValue}}return s&&B.setKeys(s,!0),B}static TransitionTo(v,T,X,O,u,B,m){let A=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;if(m<=0)return X[v]=T,A&&A(),null;const x=u*(m/1e3);B.setKeys([{frame:0,value:X[v].clone?X[v].clone():X[v]},{frame:x,value:T}]),X.animations||(X.animations=[]),X.animations.push(B);const f=O.beginAnimation(X,0,x,!1);return f.onAnimationEnd=A,f}get runtimeAnimations(){return this._runtimeAnimations}get hasRunningRuntimeAnimations(){for(const v of this._runtimeAnimations)if(!v.isStopped())return!0;return!1}constructor(v,T,X,O,u,B){this.name=v,this.targetProperty=T,this.framePerSecond=X,this.dataType=O,this.loopMode=u,this.enableBlending=B,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=T.split("."),this.dataType=O,this.loopMode=void 0===u?l.ANIMATIONLOOPMODE_CYCLE:u,this.uniqueId=l._UniqueIdGenerator++}toString(v){let T="Name: "+this.name+", property: "+this.targetProperty;if(T+=", datatype: "+["Float","Vd","Quaternion","Matrix","he","Vector2"][this.dataType],T+=", nKeys: "+(this._keys?this._keys.length:"none"),T+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),v){T+=", Ranges: {";let v=!0;for(const X in this._ranges)v&&(T+=", ",v=!1),T+=X;T+="}"}return T}addEvent(v){this._events.push(v),this._events.sort(((v,T)=>v.frame-T.frame))}removeEvents(v){for(let T=0;T<this._events.length;T++)this._events[T].frame===v&&(this._events.splice(T,1),T--)}getEvents(){return this._events}createRange(v,T,X){this._ranges[v]||(this._ranges[v]=new A.b(v,T,X))}deleteRange(v){let T=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const X=this._ranges[v];if(X){if(T){const v=X.from,T=X.to;for(let X=this._keys.length-1;X>=0;X--)this._keys[X].frame>=v&&this._keys[X].frame<=T&&this._keys.splice(X,1)}this._ranges[v]=null}}getRange(v){return this._ranges[v]}getKeys(){return this._keys}getHighestFrame(){let v=0;for(let T=0,X=this._keys.length;T<X;T++)v<this._keys[T].frame&&(v=this._keys[T].frame);return v}getEasingFunction(){return this._easingFunction}setEasingFunction(v){this._easingFunction=v}floatInterpolateFunction(v,T,X){return(0,B.n)(v,T,X)}floatInterpolateFunctionWithTangents(v,T,X,O,u){return(0,B.e)(v,T,X,O,u)}quaternionInterpolateFunction(v,T,X){return O.f.Slerp(v,T,X)}quaternionInterpolateFunctionWithTangents(v,T,X,u,B){return O.f.Hermite(v,T,X,u,B).normalize()}vector3InterpolateFunction(v,T,X){return O.l.Lerp(v,T,X)}vector3InterpolateFunctionWithTangents(v,T,X,u,B){return O.l.Hermite(v,T,X,u,B)}vector2InterpolateFunction(v,T,X){return O.i.Lerp(v,T,X)}vector2InterpolateFunctionWithTangents(v,T,X,u,B){return O.i.Hermite(v,T,X,u,B)}sizeInterpolateFunction(v,T,X){return f.e.Lerp(v,T,X)}color3InterpolateFunction(v,T,X){return u.d.Lerp(v,T,X)}color3InterpolateFunctionWithTangents(v,T,X,O,B){return u.d.Hermite(v,T,X,O,B)}color4InterpolateFunction(v,T,X){return u.g.Lerp(v,T,X)}color4InterpolateFunctionWithTangents(v,T,X,O,B){return u.g.Hermite(v,T,X,O,B)}_getKeyValue(v){return"function"===typeof v?v():v}evaluate(v){return b.key=0,this._interpolate(v,b)}_interpolate(v,T){let X=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(T.loopMode===l.ANIMATIONLOOPMODE_CONSTANT&&T.repeatCount>0)return T.highLimitValue.clone?T.highLimitValue.clone():T.highLimitValue;const O=this._keys,u=O.length;let B=T.key;for(;B>=0&&v<O[B].frame;)--B;for(;B+1<=u-1&&v>=O[B+1].frame;)++B;if(T.key=B,B<0)return X?void 0:this._getKeyValue(O[0].value);if(B+1>u-1)return X?void 0:this._getKeyValue(O[u-1].value);const m=O[B],A=O[B+1];if(X&&(v===m.frame||v===A.frame))return;const x=this._getKeyValue(m.value),f=this._getKeyValue(A.value);if(1===m.interpolation)return A.frame>v?x:f;const M=void 0!==m.outTangent&&void 0!==A.inTangent,H=A.frame-m.frame;let b=(v-m.frame)/H;const Q=m.easingFunction||this.getEasingFunction();switch(null!==Q&&(b=Q.ease(b)),this.dataType){case l.ANIMATIONTYPE_FLOAT:{const v=M?this.floatInterpolateFunctionWithTangents(x,m.outTangent*H,f,A.inTangent*H,b):this.floatInterpolateFunction(x,f,b);switch(T.loopMode){case l.ANIMATIONLOOPMODE_CYCLE:case l.ANIMATIONLOOPMODE_CONSTANT:case l.ANIMATIONLOOPMODE_YOYO:return v;case l.ANIMATIONLOOPMODE_RELATIVE:case l.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return(T.offsetValue??0)*T.repeatCount+v}break}case l.ANIMATIONTYPE_QUATERNION:{const v=M?this.quaternionInterpolateFunctionWithTangents(x,m.outTangent.scale(H),f,A.inTangent.scale(H),b):this.quaternionInterpolateFunction(x,f,b);switch(T.loopMode){case l.ANIMATIONLOOPMODE_CYCLE:case l.ANIMATIONLOOPMODE_CONSTANT:case l.ANIMATIONLOOPMODE_YOYO:return v;case l.ANIMATIONLOOPMODE_RELATIVE:case l.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return v.addInPlace((T.offsetValue||n).scale(T.repeatCount))}return v}case l.ANIMATIONTYPE_VECTOR3:{const v=M?this.vector3InterpolateFunctionWithTangents(x,m.outTangent.scale(H),f,A.inTangent.scale(H),b):this.vector3InterpolateFunction(x,f,b);switch(T.loopMode){case l.ANIMATIONLOOPMODE_CYCLE:case l.ANIMATIONLOOPMODE_CONSTANT:case l.ANIMATIONLOOPMODE_YOYO:return v;case l.ANIMATIONLOOPMODE_RELATIVE:case l.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return v.add((T.offsetValue||V).scale(T.repeatCount))}break}case l.ANIMATIONTYPE_VECTOR2:{const v=M?this.vector2InterpolateFunctionWithTangents(x,m.outTangent.scale(H),f,A.inTangent.scale(H),b):this.vector2InterpolateFunction(x,f,b);switch(T.loopMode){case l.ANIMATIONLOOPMODE_CYCLE:case l.ANIMATIONLOOPMODE_CONSTANT:case l.ANIMATIONLOOPMODE_YOYO:return v;case l.ANIMATIONLOOPMODE_RELATIVE:case l.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return v.add((T.offsetValue||D).scale(T.repeatCount))}break}case l.ANIMATIONTYPE_SIZE:switch(T.loopMode){case l.ANIMATIONLOOPMODE_CYCLE:case l.ANIMATIONLOOPMODE_CONSTANT:case l.ANIMATIONLOOPMODE_YOYO:return this.sizeInterpolateFunction(x,f,b);case l.ANIMATIONLOOPMODE_RELATIVE:case l.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return this.sizeInterpolateFunction(x,f,b).add((T.offsetValue||s).scale(T.repeatCount))}break;case l.ANIMATIONTYPE_COLOR3:{const v=M?this.color3InterpolateFunctionWithTangents(x,m.outTangent.scale(H),f,A.inTangent.scale(H),b):this.color3InterpolateFunction(x,f,b);switch(T.loopMode){case l.ANIMATIONLOOPMODE_CYCLE:case l.ANIMATIONLOOPMODE_CONSTANT:case l.ANIMATIONLOOPMODE_YOYO:return v;case l.ANIMATIONLOOPMODE_RELATIVE:case l.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return v.add((T.offsetValue||F).scale(T.repeatCount))}break}case l.ANIMATIONTYPE_COLOR4:{const v=M?this.color4InterpolateFunctionWithTangents(x,m.outTangent.scale(H),f,A.inTangent.scale(H),b):this.color4InterpolateFunction(x,f,b);switch(T.loopMode){case l.ANIMATIONLOOPMODE_CYCLE:case l.ANIMATIONLOOPMODE_CONSTANT:case l.ANIMATIONLOOPMODE_YOYO:return v;case l.ANIMATIONLOOPMODE_RELATIVE:case l.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return v.add((T.offsetValue||k).scale(T.repeatCount))}break}case l.ANIMATIONTYPE_MATRIX:switch(T.loopMode){case l.ANIMATIONLOOPMODE_CYCLE:case l.ANIMATIONLOOPMODE_CONSTANT:case l.ANIMATIONLOOPMODE_YOYO:return l.AllowMatricesInterpolation?this.matrixInterpolateFunction(x,f,b,T.workValue):x;case l.ANIMATIONLOOPMODE_RELATIVE:case l.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return x}}return 0}matrixInterpolateFunction(v,T,X,u){return l.AllowMatrixDecomposeForInterpolation?u?(O.b.DecomposeLerpToRef(v,T,X,u),u):O.b.DecomposeLerp(v,T,X):u?(O.b.LerpToRef(v,T,X,u),u):O.b.Lerp(v,T,X)}clone(){const v=new l(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(v.enableBlending=this.enableBlending,v.blendingSpeed=this.blendingSpeed,this._keys&&v.setKeys(this._keys),this._ranges){v._ranges={};for(const T in this._ranges){const X=this._ranges[T];X&&(v._ranges[T]=X.clone())}}return v}setKeys(v){let T=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._keys=T?v:v.slice(0)}createKeyForFrame(v){b.key=0;const T=this._interpolate(v,b,!0);if(!T)return this._keys[b.key].frame===v?b.key:b.key+1;const X={frame:v,value:T.clone?T.clone():T};return this._keys.splice(b.key+1,0,X),b.key+1}serialize(){const v={};v.name=this.name,v.property=this.targetProperty,v.framePerSecond=this.framePerSecond,v.dataType=this.dataType,v.loopBehavior=this.loopMode,v.enableBlending=this.enableBlending,v.blendingSpeed=this.blendingSpeed;const T=this.dataType;v.keys=[];const X=this.getKeys();for(let O=0;O<X.length;O++){const u=X[O],B={};switch(B.frame=u.frame,T){case l.ANIMATIONTYPE_FLOAT:B.values=[u.value],void 0!==u.inTangent&&B.values.push(u.inTangent),void 0!==u.outTangent&&(void 0===u.inTangent&&B.values.push(void 0),B.values.push(u.outTangent)),void 0!==u.interpolation&&(void 0===u.inTangent&&B.values.push(void 0),void 0===u.outTangent&&B.values.push(void 0),B.values.push(u.interpolation));break;case l.ANIMATIONTYPE_QUATERNION:case l.ANIMATIONTYPE_MATRIX:case l.ANIMATIONTYPE_VECTOR3:case l.ANIMATIONTYPE_COLOR3:case l.ANIMATIONTYPE_COLOR4:B.values=u.value.Pd(),void 0!=u.inTangent&&B.values.push(u.inTangent.Pd()),void 0!=u.outTangent&&(void 0===u.inTangent&&B.values.push(void 0),B.values.push(u.outTangent.Pd())),void 0!==u.interpolation&&(void 0===u.inTangent&&B.values.push(void 0),void 0===u.outTangent&&B.values.push(void 0),B.values.push(u.interpolation))}v.keys.push(B)}v.ranges=[];for(const O in this._ranges){const T=this._ranges[O];if(!T)continue;const X={};X.name=O,X.from=T.from,X.to=T.to,v.ranges.push(X)}return v}static _UniversalLerp(v,T,X){const O=v.constructor;return O.Lerp?O.Lerp(v,T,X):O.Slerp?O.Slerp(v,T,X):v.toFixed?v*(1-X)+X*T:T}static Parse(v){const T=new l(v.name,v.property,v.framePerSecond,v.dataType,v.loopBehavior),X=v.dataType,B=[];let m,A;for(v.enableBlending&&(T.enableBlending=v.enableBlending),v.blendingSpeed&&(T.blendingSpeed=v.blendingSpeed),A=0;A<v.keys.length;A++){const T=v.keys[A];let x,f,M;switch(X){case l.ANIMATIONTYPE_FLOAT:m=T.values[0],T.values.length>=2&&(x=T.values[1]),T.values.length>=3&&(f=T.values[2]),T.values.length>=4&&(M=T.values[3]);break;case l.ANIMATIONTYPE_QUATERNION:if(m=O.f.Ld(T.values),T.values.length>=8){const v=O.f.Ld(T.values.slice(4,8));v.equals(O.f.Zero())||(x=v)}if(T.values.length>=12){const v=O.f.Ld(T.values.slice(8,12));v.equals(O.f.Zero())||(f=v)}T.values.length>=13&&(M=T.values[12]);break;case l.ANIMATIONTYPE_MATRIX:m=O.b.Ld(T.values),T.values.length>=17&&(M=T.values[16]);break;case l.ANIMATIONTYPE_COLOR3:m=u.d.Ld(T.values),T.values[3]&&(x=u.d.Ld(T.values[3])),T.values[4]&&(f=u.d.Ld(T.values[4])),T.values[5]&&(M=T.values[5]);break;case l.ANIMATIONTYPE_COLOR4:m=u.g.Ld(T.values),T.values[4]&&(x=u.g.Ld(T.values[4])),T.values[5]&&(f=u.g.Ld(T.values[5])),T.values[6]&&(M=u.g.Ld(T.values[6]));break;case l.ANIMATIONTYPE_VECTOR3:default:m=O.l.Ld(T.values),T.values[3]&&(x=O.l.Ld(T.values[3])),T.values[4]&&(f=O.l.Ld(T.values[4])),T.values[5]&&(M=T.values[5])}const H={};H.frame=T.frame,H.value=m,void 0!=x&&(H.inTangent=x),void 0!=f&&(H.outTangent=f),void 0!=M&&(H.interpolation=M),B.push(H)}if(T.setKeys(B),v.ranges)for(A=0;A<v.ranges.length;A++)m=v.ranges[A],T.createRange(m.name,m.from,m.to);return T}static AppendSerializedAnimations(v,T){H.e.AppendSerializedAnimations(v,T)}static ParseFromFileAsync(v,T){return new Promise(((X,O)=>{const u=new M.b;u.addEventListener("readystatechange",(()=>{if(4==u.readyState)if(200==u.status){let T=JSON.parse(u.responseText);if(T.animations&&(T=T.animations),T.length){const v=[];for(const X of T)v.push(this.Parse(X));X(v)}else{const O=this.Parse(T);v&&(O.name=v),X(O)}}else O("Unable to load the animation")})),u.open("GET",T),u.send()}))}static ParseFromSnippetAsync(v){return new Promise(((T,X)=>{const O=new M.b;O.addEventListener("readystatechange",(()=>{if(4==O.readyState)if(200==O.status){const X=JSON.parse(JSON.parse(O.responseText).jsonPayload);if(X.animations){const O=JSON.parse(X.animations),u=[];for(const T of O.animations){const X=this.Parse(T);X.snippetId=v,u.push(X)}T(u)}else{const O=JSON.parse(X.animation),u=this.Parse(O);u.snippetId=v,T(u)}}else X("Unable to load the snippet "+v)})),O.open("GET",this.SnippetUrl+"/"+v.replace(/#/g,"/")),O.send()}))}}l._UniqueIdGenerator=0,l.AllowMatricesInterpolation=!1,l.AllowMatrixDecomposeForInterpolation=!0,l.SnippetUrl="https://snippet.babylonjs.com",l.ANIMATIONTYPE_FLOAT=0,l.ANIMATIONTYPE_VECTOR3=1,l.ANIMATIONTYPE_QUATERNION=2,l.ANIMATIONTYPE_MATRIX=3,l.ANIMATIONTYPE_COLOR3=4,l.ANIMATIONTYPE_COLOR4=7,l.ANIMATIONTYPE_VECTOR2=5,l.ANIMATIONTYPE_SIZE=6,l.ANIMATIONLOOPMODE_RELATIVE=0,l.ANIMATIONLOOPMODE_CYCLE=1,l.ANIMATIONLOOPMODE_CONSTANT=2,l.ANIMATIONLOOPMODE_YOYO=4,l.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT=5,l.CreateFromSnippetAsync=l.ParseFromSnippetAsync,(0,m.f)("BABYLON.Animation",l),x.e._AnimationRangeFactory=(v,T,X)=>new A.b(v,T,X)},12536:(v,T,X)=>{"use strict";X.d(T,{b:()=>O});class O{constructor(v,T,X){this.name=v,this.from=T,this.to=X}clone(){return new O(this.name,this.from,this.to)}}},12530:(v,T,X)=>{"use strict";X.d(T,{c:()=>m});var O=X(1006),u=X(1019),B=X(11928);class m extends B.e{get _matrix(){return this._compose(),this.Tj}set _matrix(v){(v.updateFlag!==this.Tj.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.Tj.p(v),this._markAsDirtyAndDecompose())}constructor(v,T){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,A=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(v,T.va(),!1),this.name=v,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=T,this.Tj=(null===u||void 0===u?void 0:u.clone())??O.b.Identity(),this._restMatrix=B??this.Tj.clone(),this._bindMatrix=m??this.Tj.clone(),this._index=A,this._absoluteMatrix=new O.b,this._absoluteBindMatrix=new O.b,this._absoluteInverseBindMatrix=new O.b,this._finalMatrix=new O.b,T.bones.push(this),this.setParent(X,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(v){this.setParent(v)}setParent(v){let T=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==v){if(this.parent){const v=this.parent.children.indexOf(this);-1!==v&&this.parent.children.splice(v,1)}this._parentNode=v,this.parent&&this.parent.children.push(this),T&&this._updateAbsoluteBindMatrices(),this.Oe()}}getLocalMatrix(){return this._compose(),this.Tj}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(v){this._restMatrix.p(v)}setRestPose(v){this.setRestMatrix(v)}getBindPose(){return this.getBindMatrix()}setBindMatrix(v){this.ne(v)}setBindPose(v){this.setBindMatrix(v)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const v=O.g.Vd[0],T=O.g.Quaternion[0],X=O.g.Vd[1];this.getRestMatrix().decompose(v,T,X),this._linkedTransformNode.position.p(X),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??O.f.Identity(),this._linkedTransformNode.rotationQuaternion.p(T),this._linkedTransformNode.Zd.p(v)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(v){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=v,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.Lg}set position(v){this._decompose(),this.Lg.p(v),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(v){this.setRotation(v)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(v){this.setRotationQuaternion(v)}get Zd(){return this.getScale()}set Zd(v){this.setScale(v)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=O.l.Zero(),this._localRotation=O.f.Zero(),this.Lg=O.l.Zero()),this.Tj.decompose(this._localScaling,this._localRotation,this.Lg))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,O.b.ComposeToRef(this._localScaling,this._localRotation,this.Lg,this.Tj)):this._needToCompose=!1)}ne(v){let T=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],X=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.p(v),T&&this._updateAbsoluteBindMatrices(),X?this._matrix=v:this.Oe()}_updateAbsoluteBindMatrices(v){let T=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(v||(v=this._bindMatrix),this.parent?v.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.p(v),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),T)for(let X=0;X<this.children.length;X++)this.children[X]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}Oe(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.Oe(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.Oe(),this._needToDecompose=!0}_updatePosition(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,X=arguments.length>2?arguments[2]:void 0,u=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const B=this.getLocalMatrix();if(0==T)u?(B.addAtIndex(12,v.x),B.addAtIndex(13,v.y),B.addAtIndex(14,v.z)):B.setTranslationFromFloats(v.x,v.y,v.z);else{let T=null;X&&(T=X.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const A=m._TmpMats[0],x=m._TmpVecs[0];this.parent?X&&T?(A.p(this.parent.getAbsoluteMatrix()),A.multiplyToRef(T,A)):A.p(this.parent.getAbsoluteMatrix()):O.b.IdentityToRef(A),u&&A.setTranslationFromFloats(0,0,0),A.invert(),O.l.TransformCoordinatesToRef(v,A,x),u?(B.addAtIndex(12,x.x),B.addAtIndex(13,x.y),B.addAtIndex(14,x.z)):B.setTranslationFromFloats(x.x,x.y,x.z)}this._markAsDirtyAndDecompose()}translate(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,X=arguments.length>2?arguments[2]:void 0;this._updatePosition(v,T,X,!0)}setPosition(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,X=arguments.length>2?arguments[2]:void 0;this._updatePosition(v,T,X,!1)}setAbsolutePosition(v,T){this.setPosition(v,1,T)}scale(v,T,X){let u=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const B=this.getLocalMatrix(),A=m._TmpMats[0];O.b.ScalingToRef(v,T,X,A),A.multiplyToRef(B,B),A.invert();for(const O of this.children){const u=O.getLocalMatrix();u.multiplyToRef(A,u),u.multiplyAtIndex(12,v),u.multiplyAtIndex(13,T),u.multiplyAtIndex(14,X),O._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),u)for(const O of this.children)O.scale(v,T,X,u)}setScale(v){this._decompose(),this._localScaling.p(v),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(v){this._decompose(),v.p(this._localScaling)}setYawPitchRoll(v,T,X){let u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,B=arguments.length>4?arguments[4]:void 0;if(0===u){const A=m._TmpQuat;return O.f.RotationYawPitchRollToRef(v,T,X,A),void this.setRotationQuaternion(A,u,B)}const A=m._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(A,B))return;const x=m._TmpMats[1];O.b.RotationYawPitchRollToRef(v,T,X,x),A.multiplyToRef(x,x),this._rotateWithMatrix(x,u,B)}rotate(v,T){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,u=arguments.length>3?arguments[3]:void 0;const B=m._TmpMats[0];B.setTranslationFromFloats(0,0,0),O.b.RotationAxisToRef(v,T,B),this._rotateWithMatrix(B,X,u)}setAxisAngle(v,T){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,u=arguments.length>3?arguments[3]:void 0;if(0===X){const B=m._TmpQuat;return O.f.RotationAxisToRef(v,T,B),void this.setRotationQuaternion(B,X,u)}const B=m._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(B,u))return;const A=m._TmpMats[1];O.b.RotationAxisToRef(v,T,A),B.multiplyToRef(A,A),this._rotateWithMatrix(A,X,u)}setRotation(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,X=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(v.y,v.x,v.z,T,X)}setRotationQuaternion(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,X=arguments.length>2?arguments[2]:void 0;if(0===T)return this._decompose(),this._localRotation.p(v),void this._markAsDirtyAndCompose();const u=m._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(u,X))return;const B=m._TmpMats[1];O.b.FromQuaternionToRef(v,B),u.multiplyToRef(B,B),this._rotateWithMatrix(B,T,X)}setRotationMatrix(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,X=arguments.length>2?arguments[2]:void 0;if(0===T){const u=m._TmpQuat;return O.f.FromRotationMatrixToRef(v,u),void this.setRotationQuaternion(u,T,X)}const u=m._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(u,X))return;const B=m._TmpMats[1];B.p(v),u.multiplyToRef(v,B),this._rotateWithMatrix(B,T,X)}_rotateWithMatrix(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,X=arguments.length>2?arguments[2]:void 0;const O=this.getLocalMatrix(),u=O.m[12],B=O.m[13],A=O.m[14],x=this.getParent(),f=m._TmpMats[3],M=m._TmpMats[4];x&&1==T?(X?(f.p(X.getWorldMatrix()),x.getAbsoluteMatrix().multiplyToRef(f,f)):f.p(x.getAbsoluteMatrix()),M.p(f),M.invert(),O.multiplyToRef(f,O),O.multiplyToRef(v,O),O.multiplyToRef(M,O)):1==T&&X?(f.p(X.getWorldMatrix()),M.p(f),M.invert(),O.multiplyToRef(f,O),O.multiplyToRef(v,O),O.multiplyToRef(M,O)):O.multiplyToRef(v,O),O.setTranslationFromFloats(u,B,A),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(v,T){const X=m._TmpMats[2];return v.p(this.getAbsoluteMatrix()),T?(v.multiplyToRef(T.getWorldMatrix(),v),O.b.ScalingToRef(T.Zd.x,T.Zd.y,T.Zd.z,X)):O.b.IdentityToRef(X),v.invert(),!isNaN(v.m[0])&&(X.multiplyAtIndex(0,this._scalingDeterminant),v.multiplyToRef(X,v),!0)}cb(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const X=O.l.Zero();return this.getPositionToRef(v,T,X),X}getPositionToRef(){let v=arguments.length>1?arguments[1]:void 0,T=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const v=this.getLocalMatrix();T.x=v.m[12],T.y=v.m[13],T.z=v.m[14]}else{let X=null;v&&(X=v.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let O=m._TmpMats[0];v&&X?(O.p(this.getAbsoluteMatrix()),O.multiplyToRef(X,O)):O=this.getAbsoluteMatrix(),T.x=O.m[12],T.y=O.m[13],T.z=O.m[14]}}getAbsolutePosition(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const T=O.l.Zero();return this.getPositionToRef(1,v,T),T}getAbsolutePositionToRef(v,T){this.getPositionToRef(1,v,T)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.Tj.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.p(this.Tj);const v=this._skeleton.getPoseMatrix();v&&this._absoluteMatrix.multiplyToRef(v,this._absoluteMatrix)}const v=this.children,T=v.length;for(let X=0;X<T;X++)v[X].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}Zc(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const X=O.l.Zero();return this.getDirectionToRef(v,T,X),X}getDirectionToRef(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,X=arguments.length>2?arguments[2]:void 0,u=null;T&&(u=T.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const B=m._TmpMats[0];B.p(this.getAbsoluteMatrix()),T&&u&&B.multiplyToRef(u,B),O.l.TransformNormalToRef(v,B,X),X.normalize()}getRotation(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const X=O.l.Zero();return this.getRotationToRef(v,T,X),X}getRotationToRef(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,X=arguments.length>2?arguments[2]:void 0;const O=m._TmpQuat;this.getRotationQuaternionToRef(v,T,O),O.toEulerAnglesToRef(X)}getRotationQuaternion(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const X=O.f.Identity();return this.getRotationQuaternionToRef(v,T,X),X}getRotationQuaternionToRef(){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,T=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),T.p(this._localRotation);else{const X=m._TmpMats[0],O=this.getAbsoluteMatrix();v?O.multiplyToRef(v.getWorldMatrix(),X):X.p(O),X.multiplyAtIndex(0,this._scalingDeterminant),X.multiplyAtIndex(1,this._scalingDeterminant),X.multiplyAtIndex(2,this._scalingDeterminant),X.decompose(void 0,T,void 0)}}getRotationMatrix(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,T=arguments.length>1?arguments[1]:void 0;const X=O.b.Identity();return this.getRotationMatrixToRef(v,T,X),X}getRotationMatrixToRef(){let v=arguments.length>1?arguments[1]:void 0,T=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(T);else{const X=m._TmpMats[0],O=this.getAbsoluteMatrix();v?O.multiplyToRef(v.getWorldMatrix(),X):X.p(O),X.multiplyAtIndex(0,this._scalingDeterminant),X.multiplyAtIndex(1,this._scalingDeterminant),X.multiplyAtIndex(2,this._scalingDeterminant),X.getRotationMatrixToRef(T)}}getAbsolutePositionFromLocal(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const X=O.l.Zero();return this.getAbsolutePositionFromLocalToRef(v,T,X),X}getAbsolutePositionFromLocalToRef(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,X=arguments.length>2?arguments[2]:void 0,u=null;T&&(u=T.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const B=m._TmpMats[0];B.p(this.getAbsoluteMatrix()),T&&u&&B.multiplyToRef(u,B),O.l.TransformCoordinatesToRef(v,B,X)}getLocalPositionFromAbsolute(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const X=O.l.Zero();return this.getLocalPositionFromAbsoluteToRef(v,T,X),X}getLocalPositionFromAbsoluteToRef(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,X=arguments.length>2?arguments[2]:void 0,u=null;T&&(u=T.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const B=m._TmpMats[0];B.p(this.getAbsoluteMatrix()),T&&u&&B.multiplyToRef(u,B),B.invert(),O.l.TransformCoordinatesToRef(v,B,X)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}}m._TmpVecs=(0,u.d)(2,O.l.Zero),m._TmpQuat=O.f.Identity(),m._TmpMats=(0,u.d)(5,O.b.Identity)},12923:(v,T,X)=>{"use strict";X.d(T,{d:()=>P});var O=X(985),u=X(994),B=X(1001),m=X(1006),A=X(11928),x=X(11911),f=X(1292),M=X(1133),H=X(1015);class n{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(v){this._zoomStopsAnimation=v}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(v){this._idleRotationSpeed=v}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(v){this._idleRotationWaitTime=v}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(v){this._idleRotationSpinupTime=v}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(v){this._attachedCamera=v;const T=this._attachedCamera.va();this._onPrePointerObservableObserver=T.onPrePointerObservable.add((v=>{v.type!==f.d.POINTERDOWN?v.type===f.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=v.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const v=M.b.Now;let T=0;null!=this._lastFrameTime&&(T=v-this._lastFrameTime),this._lastFrameTime=v,this._applyUserInteraction();const X=v-this._lastInteractionTime-this._idleRotationWaitTime,O=Math.max(Math.min(X/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*O,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(T/1e3))}))}detach(){if(!this._attachedCamera)return;const v=this._attachedCamera.va();this._onPrePointerObservableObserver&&v.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(v){this._lastInteractionTime=v??M.b.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<H.c}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let v=!1;return this._lastFrameRadius===this._attachedCamera.i&&0!==this._attachedCamera.inertialRadiusOffset&&(v=!0),this._lastFrameRadius=this._attachedCamera.i,this._zoomStopsAnimation?v:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=M.b.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}X(1499);class V{constructor(){this._easingMode=V.EASINGMODE_EASEIN}setEasingMode(v){const T=Math.min(Math.max(v,0),2);this._easingMode=T}getEasingMode(){return this._easingMode}easeInCore(v){throw new Error("You must implement this method")}ease(v){switch(this._easingMode){case V.EASINGMODE_EASEIN:return this.easeInCore(v);case V.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-v)}return v>=.5?.5*(1-this.easeInCore(2*(1-v)))+.5:.5*this.easeInCore(2*v)}}V.EASINGMODE_EASEIN=0,V.EASINGMODE_EASEOUT=1,V.EASINGMODE_EASEINOUT=2;var D=X(12532);class s{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(v){if(this._autoTransitionRange===v)return;this._autoTransitionRange=v;const T=this._attachedCamera;T&&(v?this._onMeshTargetChangedObserver=T.onMeshTargetChangedObservable.add((v=>{if(v&&(v.Ke(!0),v.getBoundingInfo)){const T=v.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*T,this.upperRadiusTransitionRange=.05*T}})):this._onMeshTargetChangedObserver&&T.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(v){this._attachedCamera=v,this._onAfterCheckInputsObserver=v.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(v){return!!this._attachedCamera&&(this._attachedCamera.i===v&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(v){if(!this._attachedCamera)return;this._radiusBounceTransition||(s.EasingFunction.setEasingMode(s.EasingMode),this._radiusBounceTransition=D.e.CreateAnimation("i",D.e.ANIMATIONTYPE_FLOAT,60,s.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const T=D.e.TransitionTo("i",this._attachedCamera.i+v,this._attachedCamera,this._attachedCamera.va(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));T&&this._animatables.push(T)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}s.EasingFunction=new class extends V{constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=v}easeInCore(v){const T=Math.max(0,this.amplitude);return Math.pow(v,3)-v*T*Math.sin(3.141592653589793*v)}}(.3),s.EasingMode=V.EASINGMODE_EASEOUT;class F{constructor(){this.onTargetFramingAnimationEndObservable=new B.b,this._mode=F.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(v){this._mode=v}get mode(){return this._mode}set radiusScale(v){this._radiusScale=v}get radiusScale(){return this._radiusScale}set positionScale(v){this._positionScale=v}get positionScale(){return this._positionScale}set defaultElevation(v){this._defaultElevation=v}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(v){this._elevationReturnTime=v}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(v){this._elevationReturnWaitTime=v}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(v){this._zoomStopsAnimation=v}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(v){this._framingTime=v}get framingTime(){return this._framingTime}init(){}attach(v){this._attachedCamera=v;const T=this._attachedCamera.va();F.EasingFunction.setEasingMode(F.EasingMode),this._onPrePointerObservableObserver=T.onPrePointerObservable.add((v=>{v.type!==f.d.POINTERDOWN?v.type===f.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=v.onMeshTargetChangedObservable.add((v=>{v&&v.getBoundingInfo&&this.zoomOnMesh(v,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=v.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const v=this._attachedCamera.va();this._onPrePointerObservableObserver&&v.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(v){let T=arguments.length>1&&void 0!==arguments[1]&&arguments[1],X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;v.Ke(!0);const O=v.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(O.minimumWorld,O.maximumWorld,T,X)}zoomOnMeshHierarchy(v){let T=arguments.length>1&&void 0!==arguments[1]&&arguments[1],X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;v.Ke(!0);const O=v.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(O.min,O.max,T,X)}zoomOnMeshesHierarchy(v){let T=arguments.length>1&&void 0!==arguments[1]&&arguments[1],X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const O=new m.l(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),u=new m.l(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let B=0;B<v.length;B++){const T=v[B].getHierarchyBoundingVectors(!0);m.l.CheckExtends(T.min,O,u),m.l.CheckExtends(T.max,O,u)}this.zoomOnBoundingInfo(O,u,T,X)}zoomOnBoundingInfo(v,T){let X,O=arguments.length>2&&void 0!==arguments[2]&&arguments[2],u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const B=v.y,A=B+(T.y-B)*this._positionScale,x=T.Xc(v).scale(.5);if(O)X=new m.l(0,A,0);else{const T=v.add(x);X=new m.l(T.x,A,T.z)}this._vectorTransition||(this._vectorTransition=D.e.CreateAnimation("target",D.e.ANIMATIONTYPE_VECTOR3,60,F.EasingFunction)),this._betaIsAnimating=!0;let f=D.e.TransitionTo("target",X,this._attachedCamera,this._attachedCamera.va(),60,this._vectorTransition,this._framingTime);f&&this._animatables.push(f);let M=0;if(this._mode===F.FitFrustumSidesMode){const X=this._calculateLowerRadiusFromModelBoundingSphere(v,T);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=x.length()+this._attachedCamera.ij),M=X}else this._mode===F.IgnoreBoundsSizeMode&&(M=this._calculateLowerRadiusFromModelBoundingSphere(v,T),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.ij));if(this.autoCorrectCameraLimitsAndSensibility){const X=T.Xc(v).length();this._attachedCamera.panningSensibility=5e3/X,this._attachedCamera.wheelPrecision=100/M}return this._radiusTransition||(this._radiusTransition=D.e.CreateAnimation("i",D.e.ANIMATIONTYPE_FLOAT,60,F.EasingFunction)),f=D.e.TransitionTo("i",M,this._attachedCamera,this._attachedCamera.va(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),u&&u(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),f&&this._animatables.push(f),!0}_calculateLowerRadiusFromModelBoundingSphere(v,T){const X=this._attachedCamera;if(!X)return 0;let O=X._calculateLowerRadiusFromModelBoundingSphere(v,T,this._radiusScale);return X.lowerRadiusLimit&&this._mode===F.IgnoreBoundsSizeMode&&(O=O<X.lowerRadiusLimit?X.lowerRadiusLimit:O),X.upperRadiusLimit&&(O=O>X.upperRadiusLimit?X.upperRadiusLimit:O),O}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const v=M.b.Now-this._lastInteractionTime,T=.5*Math.PI-this._defaultElevation,X=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>X&&v>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=D.e.CreateAnimation("beta",D.e.ANIMATIONTYPE_FLOAT,60,F.EasingFunction));const v=D.e.TransitionTo("beta",T,this._attachedCamera,this._attachedCamera.va(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));v&&this._animatables.push(v)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=M.b.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}F.EasingFunction=new class extends V{constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=v}easeInCore(v){return this.exponent<=0?v:(Math.exp(this.exponent*v)-1)/(Math.exp(this.exponent)-1)}},F.EasingMode=V.EASINGMODE_EASEINOUT,F.IgnoreBoundsSizeMode=0,F.FitFrustumSidesMode=1;var k=X(11921),b=X(12522),l=X(12528),Q=X(1217);class K{constructor(){this._currentActiveButton=-1,this.buttons=[0,1,2]}attachControl(v){v=Q.c.BackCompatCameraNoPreventDefault(arguments);const T=this.camera.getEngine(),X=T.getInputElement();let O=0,u=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=B=>{var m,A;const x=B.event,M="touch"===x.pointerType;if(B.type!==f.d.POINTERMOVE&&-1===this.buttons.indexOf(x.button))return;const H=x.target;if(this._altKey=x.altKey,this._ctrlKey=x.ctrlKey,this._metaKey=x.metaKey,this._shiftKey=x.shiftKey,this._buttonsPressed=x.buttons,T.isPointerLock){const v=x.movementX,T=x.movementY;this.onTouch(null,v,T),this._pointA=null,this._pointB=null}else{if(B.type!==f.d.POINTERDOWN&&B.type!==f.d.POINTERDOUBLETAP&&M&&(null===(m=this._pointA)||void 0===m?void 0:m.pointerId)!==x.pointerId&&(null===(A=this._pointB)||void 0===A?void 0:A.pointerId)!==x.pointerId)return;if(B.type!==f.d.POINTERDOWN||-1!==this._currentActiveButton&&!M)if(B.type===f.d.POINTERDOUBLETAP)this.onDoubleTap(x.pointerType);else if(B.type!==f.d.POINTERUP||this._currentActiveButton!==x.button&&!M){if(B.type===f.d.POINTERMOVE)if(v||x.preventDefault(),this._pointA&&null===this._pointB){const v=x.clientX-this._pointA.x,T=x.clientY-this._pointA.y;this._pointA.x=x.clientX,this._pointA.y=x.clientY,this.onTouch(this._pointA,v,T)}else if(this._pointA&&this._pointB){const v=this._pointA.pointerId===x.pointerId?this._pointA:this._pointB;v.x=x.clientX,v.y=x.clientY;const T=this._pointA.x-this._pointB.x,X=this._pointA.y-this._pointB.y,m=T*T+X*X,A={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:x.pointerId,type:B.type};this.onMultiTouch(this._pointA,this._pointB,O,m,u,A),u=A,O=m}}else{try{null===H||void 0===H||H.releasePointerCapture(x.pointerId)}catch(n){}M||(this._pointB=null),T._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==x.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==x.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==O||u)&&(this.onMultiTouch(this._pointA,this._pointB,O,0,u,null),O=0,u=null),this._currentActiveButton=-1,this.onButtonUp(x),v||x.preventDefault()}else{try{null===H||void 0===H||H.setPointerCapture(x.pointerId)}catch(n){}if(null===this._pointA)this._pointA={x:x.clientX,y:x.clientY,pointerId:x.pointerId,type:x.pointerType};else{if(null!==this._pointB)return;this._pointB={x:x.clientX,y:x.clientY,pointerId:x.pointerId,type:x.pointerType}}-1!==this._currentActiveButton||M||(this._currentActiveButton=x.button),this.onButtonDown(x),v||(x.preventDefault(),X&&X.focus())}}},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,f.d.POINTERDOWN|f.d.POINTERUP|f.d.POINTERMOVE|f.d.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,O=0,u=null,this.onLostFocus()},this._contextMenuBind=v=>this.onContextMenu(v),X&&X.addEventListener("contextmenu",this._contextMenuBind,!1);const B=this.camera.va().getEngine().getHostWindow();B&&Q.c.RegisterTopRootEvents(B,[{name:"blur",handler:this._onLostFocus}])}re(){if(this._onLostFocus){const v=this.camera.va().getEngine().getHostWindow();v&&Q.c.UnregisterTopRootEvents(v,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const v=this.camera.va().getEngine().getInputElement();v&&v.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentActiveButton=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(v){}onTouch(v,T,X){}onMultiTouch(v,T,X,O,u,B){}onContextMenu(v){v.preventDefault()}onButtonDown(v){}onButtonUp(v){}onLostFocus(){}}(0,O.c)([(0,u.G)()],K.prototype,"buttons",void 0);class p extends K{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(v,T){if(0!==this.panningSensibility&&v&&T){const X=T.x-v.x,O=T.y-v.y;this.camera.inertialPanningX+=-X/this.panningSensibility,this.camera.inertialPanningY+=O/this.panningSensibility}}_computePinchZoom(v,T){const X=this.camera.i||p.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.i=X*Math.sqrt(v)/Math.sqrt(T):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(T-v)*X*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(T-v)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(v,T,X){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-T/this.panningSensibility,this.camera.inertialPanningY+=X/this.panningSensibility):(this.camera.inertialAlphaOffset-=T/this.angularSensibilityX,this.camera.inertialBetaOffset-=X/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(v,T,X,O,u,B){0===X&&null===u||0===O&&null===B||(this.multiTouchPanAndZoom?(this._computePinchZoom(X,O),this._computeMultiTouchPanning(u,B)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(O)-Math.sqrt(X))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(X,O),this._isPinching=!0):this._computeMultiTouchPanning(u,B)):this.multiTouchPanning?this._computeMultiTouchPanning(u,B):this.pinchZoom&&this._computePinchZoom(X,O))}onButtonDown(v){this._isPanClick=v.button===this.camera._panningMouseButton}onButtonUp(v){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}p.MinimumRadiusForPinch=.001,(0,O.c)([(0,u.G)()],p.prototype,"buttons",void 0),(0,O.c)([(0,u.G)()],p.prototype,"angularSensibilityX",void 0),(0,O.c)([(0,u.G)()],p.prototype,"angularSensibilityY",void 0),(0,O.c)([(0,u.G)()],p.prototype,"pinchPrecision",void 0),(0,O.c)([(0,u.G)()],p.prototype,"pinchDeltaPercentage",void 0),(0,O.c)([(0,u.G)()],p.prototype,"useNaturalPinchZoom",void 0),(0,O.c)([(0,u.G)()],p.prototype,"pinchZoom",void 0),(0,O.c)([(0,u.G)()],p.prototype,"panningSensibility",void 0),(0,O.c)([(0,u.G)()],p.prototype,"multiTouchPanning",void 0),(0,O.c)([(0,u.G)()],p.prototype,"multiTouchPanAndZoom",void 0),l.c.ArcRotateCameraPointersInput=p;var G=X(1300);class L{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(v){v=Q.c.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((T=>{const X=T.event;if(!X.metaKey)if(T.type===G.b.KEYDOWN){if(this._ctrlPressed=X.ctrlKey,this._altPressed=X.altKey,-1!==this.keysUp.indexOf(X.keyCode)||-1!==this.keysDown.indexOf(X.keyCode)||-1!==this.keysLeft.indexOf(X.keyCode)||-1!==this.keysRight.indexOf(X.keyCode)||-1!==this.keysReset.indexOf(X.keyCode)){-1===this._keys.indexOf(X.keyCode)&&this._keys.push(X.keyCode),X.preventDefault&&(v||X.preventDefault())}}else if(-1!==this.keysUp.indexOf(X.keyCode)||-1!==this.keysDown.indexOf(X.keyCode)||-1!==this.keysLeft.indexOf(X.keyCode)||-1!==this.keysRight.indexOf(X.keyCode)||-1!==this.keysReset.indexOf(X.keyCode)){const T=this._keys.indexOf(X.keyCode);T>=0&&this._keys.splice(T,1),X.preventDefault&&(v||X.preventDefault())}})))}re(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const v=this.camera;for(let T=0;T<this._keys.length;T++){const X=this._keys[T];-1!==this.keysLeft.indexOf(X)?this._ctrlPressed&&this.camera._useCtrlForPanning?v.inertialPanningX-=1/this.panningSensibility:v.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(X)?this._ctrlPressed&&this.camera._useCtrlForPanning?v.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?v.inertialRadiusOffset+=1/this.zoomingSensibility:v.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(X)?this._ctrlPressed&&this.camera._useCtrlForPanning?v.inertialPanningX+=1/this.panningSensibility:v.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(X)?this._ctrlPressed&&this.camera._useCtrlForPanning?v.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?v.inertialRadiusOffset-=1/this.zoomingSensibility:v.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(X)&&v.useInputToRestoreState&&v.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,O.c)([(0,u.G)()],L.prototype,"keysUp",void 0),(0,O.c)([(0,u.G)()],L.prototype,"keysDown",void 0),(0,O.c)([(0,u.G)()],L.prototype,"keysLeft",void 0),(0,O.c)([(0,u.G)()],L.prototype,"keysRight",void 0),(0,O.c)([(0,u.G)()],L.prototype,"keysReset",void 0),(0,O.c)([(0,u.G)()],L.prototype,"panningSensibility",void 0),(0,O.c)([(0,u.G)()],L.prototype,"zoomingSensibility",void 0),(0,O.c)([(0,u.G)()],L.prototype,"useAltToZoom",void 0),(0,O.c)([(0,u.G)()],L.prototype,"angularSpeed",void 0),l.c.ArcRotateCameraKeyboardMoveInput=L;var r=X(1187),o=X(1308),Z=X(1040);class U{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new m.l(0,0,0),this._globalOffset=new m.l(0,0,0),this._inertialPanning=m.l.Zero()}_computeDeltaFromMouseWheelLegacyEvent(v,T){let X=0;const O=.01*v*this.wheelDeltaPercentage*T;return X=v>0?O/(1+this.wheelDeltaPercentage):O*(1+this.wheelDeltaPercentage),X}attachControl(v){v=Q.c.BackCompatCameraNoPreventDefault(arguments),this._wheel=T=>{if(T.type!==f.d.POINTERWHEEL)return;const X=T.event;let O=0;const u=X.deltaMode===o.d.DOM_DELTA_LINE?40:1,B=-X.deltaY*u;if(this.customComputeDeltaFromMouseWheel)O=this.customComputeDeltaFromMouseWheel(B,this,X);else if(this.wheelDeltaPercentage){if(O=this._computeDeltaFromMouseWheelLegacyEvent(B,this.camera.i),O>0){let v=this.camera.i,T=this.camera.inertialRadiusOffset+O;for(let X=0;X<20&&Math.abs(T)>.001;X++)v-=T,T*=this.camera.inertia;v=(0,Z.c)(v,0,Number.MAX_VALUE),O=this._computeDeltaFromMouseWheelLegacyEvent(B,v)}}else O=B/(40*this.wheelPrecision);O&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(O)):this.camera.inertialRadiusOffset+=O),X.preventDefault&&(v||X.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,f.d.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.Td(0)}re(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const v=this.camera;0+v.inertialAlphaOffset+v.inertialBetaOffset+v.inertialRadiusOffset&&(this._updateHitPlane(),v.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(v.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const v=this.camera,T=v.target.Xc(v.position);this._hitPlane=r.d.FromPositionAndNormal(v.target,T)}_getPosition(){const v=this.camera,T=v.va(),X=T.createPickingRay(T.pointerX,T.pointerY,m.b.Identity(),v,!1);0===v.targetScreenOffset.x&&0===v.targetScreenOffset.y||(this._viewOffset.set(v.targetScreenOffset.x,v.targetScreenOffset.y,0),v.getViewMatrix().invertToRef(v._cameraTransformMatrix),this._globalOffset=m.l.TransformNormal(this._viewOffset,v._cameraTransformMatrix),X.origin.addInPlace(this._globalOffset));let O=0;return this._hitPlane&&(O=X.intersectsPlane(this._hitPlane)??0),X.origin.addInPlace(X.direction.scaleInPlace(O))}_zoomToMouse(v){const T=this.camera,X=1-T.inertia;if(T.lowerRadiusLimit){const O=T.lowerRadiusLimit??0;T.i-(T.inertialRadiusOffset+v)/X<O&&(v=(T.i-O)*X-T.inertialRadiusOffset)}if(T.upperRadiusLimit){const O=T.upperRadiusLimit??0;T.i-(T.inertialRadiusOffset+v)/X>O&&(v=(T.i-O)*X-T.inertialRadiusOffset)}const O=v/X/T.i,u=this._getPosition(),B=m.g.Vd[6];u.subtractToRef(T.target,B),B.scaleInPlace(O),B.scaleInPlace(X),this._inertialPanning.addInPlace(B),T.inertialRadiusOffset+=v}_zeroIfClose(v){Math.abs(v.x)<H.c&&(v.x=0),Math.abs(v.y)<H.c&&(v.y=0),Math.abs(v.z)<H.c&&(v.z=0)}}(0,O.c)([(0,u.G)()],U.prototype,"wheelPrecision",void 0),(0,O.c)([(0,u.G)()],U.prototype,"zoomToMouseLocation",void 0),(0,O.c)([(0,u.G)()],U.prototype,"wheelDeltaPercentage",void 0),l.c.ArcRotateCameraMouseWheelInput=U;class J extends l.e{constructor(v){super(v)}addMouseWheel(){return this.add(new U),this}addPointers(){return this.add(new p),this}addKeyboard(){return this.add(new L),this}}var y=X(1023);A.e.AddNodeConstructor("ArcRotateCamera",((v,T)=>()=>new P(v,0,0,1,m.l.Zero(),T)));class P extends b.d{get target(){return this._target}set target(v){this.setTarget(v)}get targetHost(){return this._targetHost}set targetHost(v){v&&this.setTarget(v)}getTarget(){return this.target}get position(){return this._position}set position(v){this.setPosition(v)}set upVector(v){this._upToYMatrix||(this._yToUpMatrix=new m.b,this._upToYMatrix=new m.b,this._upVector=m.l.Zero()),v.normalize(),this._upVector.p(v),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){m.b.RotationAlignToRef(m.l.UpReadOnly,this._upVector,this._yToUpMatrix),m.b.RotationAlignToRef(this._upVector,m.l.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const v=this.inputs.attached.pointers;return v?v.angularSensibilityX:0}set angularSensibilityX(v){const T=this.inputs.attached.pointers;T&&(T.angularSensibilityX=v)}get angularSensibilityY(){const v=this.inputs.attached.pointers;return v?v.angularSensibilityY:0}set angularSensibilityY(v){const T=this.inputs.attached.pointers;T&&(T.angularSensibilityY=v)}get pinchPrecision(){const v=this.inputs.attached.pointers;return v?v.pinchPrecision:0}set pinchPrecision(v){const T=this.inputs.attached.pointers;T&&(T.pinchPrecision=v)}get pinchDeltaPercentage(){const v=this.inputs.attached.pointers;return v?v.pinchDeltaPercentage:0}set pinchDeltaPercentage(v){const T=this.inputs.attached.pointers;T&&(T.pinchDeltaPercentage=v)}get useNaturalPinchZoom(){const v=this.inputs.attached.pointers;return!!v&&v.useNaturalPinchZoom}set useNaturalPinchZoom(v){const T=this.inputs.attached.pointers;T&&(T.useNaturalPinchZoom=v)}get panningSensibility(){const v=this.inputs.attached.pointers;return v?v.panningSensibility:0}set panningSensibility(v){const T=this.inputs.attached.pointers;T&&(T.panningSensibility=v)}get keysUp(){const v=this.inputs.attached.keyboard;return v?v.keysUp:[]}set keysUp(v){const T=this.inputs.attached.keyboard;T&&(T.keysUp=v)}get keysDown(){const v=this.inputs.attached.keyboard;return v?v.keysDown:[]}set keysDown(v){const T=this.inputs.attached.keyboard;T&&(T.keysDown=v)}get keysLeft(){const v=this.inputs.attached.keyboard;return v?v.keysLeft:[]}set keysLeft(v){const T=this.inputs.attached.keyboard;T&&(T.keysLeft=v)}get keysRight(){const v=this.inputs.attached.keyboard;return v?v.keysRight:[]}set keysRight(v){const T=this.inputs.attached.keyboard;T&&(T.keysRight=v)}get wheelPrecision(){const v=this.inputs.attached.mousewheel;return v?v.wheelPrecision:0}set wheelPrecision(v){const T=this.inputs.attached.mousewheel;T&&(T.wheelPrecision=v)}get zoomToMouseLocation(){const v=this.inputs.attached.mousewheel;return!!v&&v.zoomToMouseLocation}set zoomToMouseLocation(v){const T=this.inputs.attached.mousewheel;T&&(T.zoomToMouseLocation=v)}get wheelDeltaPercentage(){const v=this.inputs.attached.mousewheel;return v?v.wheelDeltaPercentage:0}set wheelDeltaPercentage(v){const T=this.inputs.attached.mousewheel;T&&(T.wheelDeltaPercentage=v)}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(v){v!==this.useBouncingBehavior&&(v?(this._bouncingBehavior=new s,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(v){v!==this.useFramingBehavior&&(v?(this._framingBehavior=new F,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(v){v!==this.useAutoRotationBehavior&&(v?(this._autoRotationBehavior=new n,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(v,T,X,O,u,A){var x;let f=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(v,m.l.Zero(),A,f),x=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=m.l.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=m.i.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._viewMatrix=new m.b,this.panningAxis=new m.l(1,1,0),this._transformedDirection=new m.l,this.mapPanning=!1,this._progressiveRestore=!1,this.onMeshTargetChangedObservable=new B.b,this.checkCollisions=!1,this.collisionRadius=new m.l(.5,.5,.5),this._previousPosition=m.l.Zero(),this._collisionVelocity=m.l.Zero(),this._newPosition=m.l.Zero(),this._computationVector=m.l.Zero(),this._onCollisionPositionChange=function(v,T){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;X?(x.setPosition(T),x.Mk&&x.Mk(X)):x._previousPosition.p(x._position);const O=Math.cos(x.alpha),u=Math.sin(x.alpha),B=Math.cos(x.beta);let m=Math.sin(x.beta);0===m&&(m=1e-4);const A=x._getTargetPosition();x._computationVector.Sd(x.i*O*m,x.i*B,x.i*u*m),A.addToRef(x._computationVector,x._newPosition),x._position.p(x._newPosition);let f=x.upVector;x.allowUpsideDown&&x.beta<0&&(f=f.clone(),f=f.negate()),x._computeViewMatrix(x._position,A,f),x._viewMatrix.addAtIndex(12,x.targetScreenOffset.x),x._viewMatrix.addAtIndex(13,x.targetScreenOffset.y),x._collisionTriggered=!1},this._target=m.l.Zero(),u&&this.setTarget(u),this.alpha=T,this.beta=X,this.i=O,this.getViewMatrix(),this.inputs=new J(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new m.l(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.i=void 0,this._cache.targetScreenOffset=m.i.Zero()}_updateCache(v){v||super._updateCache(),this._cache._target.p(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.i=this.i,this._cache.targetScreenOffset.p(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const v=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?v.addToRef(this._targetBoundingCenter,this._target):this._target.p(v)}const v=this._getLockedTargetPosition();return v||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.i,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>H.c&&this.restoreStateInterpolationFactor<1?(this._progressiveRestore=!0,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.i=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.i===this.i&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(v,T){let X=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const u=arguments;T=Q.c.BackCompatCameraNoPreventDefault(u),this._useCtrlForPanning=X,this._panningMouseButton=O,"boolean"===typeof u[0]&&(u.length>1&&(this._useCtrlForPanning=u[1]),u.length>2&&(this._panningMouseButton=u[2])),this.inputs.attachElement(T),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}re(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),this._progressiveRestore){const v=this._scene.getEngine().getDeltaTime()/1e3,T=1-Math.pow(2,-v/this.restoreStateInterpolationFactor);this.setTarget(m.l.Lerp(this.getTarget(),this._storedTarget,T)),m.f.RotationAlphaBetaGammaToRef(this._storedAlpha,this._storedBeta,0,m.g.Quaternion[0]),m.f.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,m.g.Quaternion[1]),m.f.SlerpToRef(m.g.Quaternion[1],m.g.Quaternion[0],T,m.g.Quaternion[2]),m.g.Quaternion[2].normalize(),m.g.Quaternion[2].toAlphaBetaGammaToRef(m.g.Vd[0]),this.alpha=m.g.Vd[0].x,this.beta=m.g.Vd[0].y,this.i+=(this._storedRadius-this.i)*T,m.i.LerpToRef(this.targetScreenOffset,this._storedTargetScreenOffset,T,this.targetScreenOffset),(m.l.DistanceSquared(this.getTarget(),this._storedTarget)<H.c&&m.g.Quaternion[2].equalsWithEpsilon(m.g.Quaternion[0])&&Math.pow(this._storedRadius-this.i,2)<H.c&&m.i.Distance(this.targetScreenOffset,this._storedTargetScreenOffset)<H.c||0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset||0!==this.inertialPanningX||0!==this.inertialPanningY)&&(this._progressiveRestore=!1)}if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){const v=this.invertRotation?-1:1,T=this._calculateHandednessMultiplier();let X=this.inertialAlphaOffset*T;this.beta<0&&(X*=-1),this.alpha+=X*v,this.beta+=this.inertialBetaOffset*v,this.i-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<H.c&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<H.c&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*H.c&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){const v=new m.l(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),v.multiplyInPlace(this.panningAxis),m.l.TransformNormalToRef(v,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const v=this.upVector,T=m.l.CrossToRef(this._transformedDirection,v,this._transformedDirection);m.l.CrossToRef(v,T,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);m.l.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.p(this._transformedDirection)}else{if(this.parent){const v=m.g.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(v),v.transposeToRef(v),m.l.TransformCoordinatesToRef(this._transformedDirection,v,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*H.c&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*H.c&&(this.inertialPanningY=0)}this._checkLimits(),super._checkInputs()}}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.i<this.lowerRadiusLimit&&(this.i=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.i>this.upperRadiusLimit&&(this.i=this.upperRadiusLimit,this.inertialRadiusOffset=0)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||m.l.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.i=this._computationVector.length(),0===this.i&&(this.i=1e-4);const v=this.alpha;0===this._computationVector.x&&0===this._computationVector.z?this.alpha=Math.PI/2:this.alpha=Math.acos(this._computationVector.x/Math.sqrt(Math.pow(this._computationVector.x,2)+Math.pow(this._computationVector.z,2))),this._computationVector.z<0&&(this.alpha=2*Math.PI-this.alpha);const T=Math.round((v-this.alpha)/(2*Math.PI));this.alpha+=2*T*Math.PI,this.beta=Math.acos(this._computationVector.y/this.i),this._checkLimits()}setPosition(v){this._position.equals(v)||(this._position.p(v),this.rebuildAnglesAndRadius())}setTarget(v){let T=arguments.length>1&&void 0!==arguments[1]&&arguments[1],X=arguments.length>2&&void 0!==arguments[2]&&arguments[2],O=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(O=this.overrideCloneAlphaBetaRadius??O,v.Ke)T&&v.getBoundingInfo?this._targetBoundingCenter=v.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,v.Ke(),this._targetHost=v,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const T=v,O=this._getTargetPosition();if(O&&!X&&O.equals(T))return;this._targetHost=null,this._target=T,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}O||this.rebuildAnglesAndRadius()}_getViewMatrix(){const v=Math.cos(this.alpha),T=Math.sin(this.alpha),X=Math.cos(this.beta);let O=Math.sin(this.beta);0===O&&(O=1e-4),0===this.i&&(this.i=1e-4);const u=this._getTargetPosition();if(this._computationVector.Sd(this.i*v*O,this.i*X,this.i*T*O),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||m.l.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),u.addToRef(this._computationVector,this._newPosition),this.va().collisionsEnabled&&this.checkCollisions){const v=this.va().collisionCoordinator;this._collider||(this._collider=v.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,v.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.p(this._newPosition);let v=this.upVector;this.allowUpsideDown&&O<0&&(v=v.negate()),this._computeViewMatrix(this._position,u,v),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget=u,this._viewMatrix}zoomOn(v){let T=arguments.length>1&&void 0!==arguments[1]&&arguments[1];v=v||this.va().meshes;const X=x.d.MinMax(v);let O=this._calculateLowerRadiusFromModelBoundingSphere(X.min,X.max);O=Math.max(Math.min(O,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.i=O*this.zoomOnFactor,this.focusOn({min:X.min,max:X.max,distance:O},T)}focusOn(v){let T,X,O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===v.min){const O=v||this.va().meshes;T=x.d.MinMax(O),X=m.l.Distance(T.min,T.max)}else{T=v,X=v.distance}this._target=x.d.Center(T),O||(this.maxZ=2*X)}createRigCamera(v,T){let X=0;switch(this.cameraRigMode){case k.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case k.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case k.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case k.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case k.e.RIG_MODE_VR:X=this._cameraRigParams.stereoHalfAngle*(0===T?1:-1);break;case k.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:X=this._cameraRigParams.stereoHalfAngle*(0===T?-1:1)}const O=new P(v,this.alpha+X,this.beta,this.i,this._target,this.va());return O._cameraRigParams={},O.isRigCamera=!0,O.rigParent=this,O.upVector=this.upVector,O.mode=this.mode,O.orthoLeft=this.orthoLeft,O.orthoRight=this.orthoRight,O.orthoBottom=this.orthoBottom,O.orthoTop=this.orthoTop,O}_updateRigCameras(){const v=this._rigCameras[0],T=this._rigCameras[1];switch(v.beta=T.beta=this.beta,this.cameraRigMode){case k.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case k.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case k.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case k.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case k.e.RIG_MODE_VR:v.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,T.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case k.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:v.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,T.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(v,T){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const O=m.l.Distance(v,T),u=this.va().getEngine().getAspectRatio(this),B=Math.tan(this.fov/2),A=B*u,x=.5*O*X,f=x*Math.sqrt(1+1/(A*A)),M=x*Math.sqrt(1+1/(B*B));return Math.max(f,M)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,O.c)([(0,u.G)()],P.prototype,"alpha",void 0),(0,O.c)([(0,u.G)()],P.prototype,"beta",void 0),(0,O.c)([(0,u.G)()],P.prototype,"i",void 0),(0,O.c)([(0,u.G)()],P.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,O.c)([(0,u.E)("target")],P.prototype,"_target",void 0),(0,O.c)([(0,u.u)("targetHost")],P.prototype,"_targetHost",void 0),(0,O.c)([(0,u.G)()],P.prototype,"inertialAlphaOffset",void 0),(0,O.c)([(0,u.G)()],P.prototype,"inertialBetaOffset",void 0),(0,O.c)([(0,u.G)()],P.prototype,"inertialRadiusOffset",void 0),(0,O.c)([(0,u.G)()],P.prototype,"lowerAlphaLimit",void 0),(0,O.c)([(0,u.G)()],P.prototype,"upperAlphaLimit",void 0),(0,O.c)([(0,u.G)()],P.prototype,"lowerBetaLimit",void 0),(0,O.c)([(0,u.G)()],P.prototype,"upperBetaLimit",void 0),(0,O.c)([(0,u.G)()],P.prototype,"lowerRadiusLimit",void 0),(0,O.c)([(0,u.G)()],P.prototype,"upperRadiusLimit",void 0),(0,O.c)([(0,u.G)()],P.prototype,"inertialPanningX",void 0),(0,O.c)([(0,u.G)()],P.prototype,"inertialPanningY",void 0),(0,O.c)([(0,u.G)()],P.prototype,"pinchToPanMaxDistance",void 0),(0,O.c)([(0,u.G)()],P.prototype,"panningDistanceLimit",void 0),(0,O.c)([(0,u.E)()],P.prototype,"panningOriginTarget",void 0),(0,O.c)([(0,u.G)()],P.prototype,"panningInertia",void 0),(0,O.c)([(0,u.G)()],P.prototype,"zoomToMouseLocation",null),(0,O.c)([(0,u.G)()],P.prototype,"zoomOnFactor",void 0),(0,O.c)([(0,u.D)()],P.prototype,"targetScreenOffset",void 0),(0,O.c)([(0,u.G)()],P.prototype,"allowUpsideDown",void 0),(0,O.c)([(0,u.G)()],P.prototype,"useInputToRestoreState",void 0),(0,O.c)([(0,u.G)()],P.prototype,"restoreStateInterpolationFactor",void 0),(0,y.f)("BABYLON.ArcRotateCamera",P)},11921:(v,T,X)=>{"use strict";X.d(T,{e:()=>F});var O=X(985),u=X(994),B=X(1207),m=X(1217),A=X(1001),x=X(1006),f=X(11928),M=X(1103),H=X(1023),n=X(1095),V=X(1504),D=X(1324),s=X(1156);class F extends f.e{get position(){return this._position}set position(v){this._position=v}set upVector(v){this._upVector=v}get upVector(){return this._upVector}get screenArea(){let v=0,T=0;if(this.mode===F.PERSPECTIVE_CAMERA)this.fovMode===F.FOVMODE_VERTICAL_FIXED?(T=2*this.ij*Math.tan(this.fov/2),v=this.getEngine().getAspectRatio(this)*T):(v=2*this.ij*Math.tan(this.fov/2),T=v/this.getEngine().getAspectRatio(this));else{const X=this.getEngine().getRenderWidth()/2,O=this.getEngine().getRenderHeight()/2;v=(this.orthoRight??X)-(this.orthoLeft??-X),T=(this.orthoTop??O)-(this.orthoBottom??-O)}return v*T}set orthoLeft(v){this._orthoLeft=v;for(const T of this._rigCameras)T.orthoLeft=v}get orthoLeft(){return this._orthoLeft}set orthoRight(v){this._orthoRight=v;for(const T of this._rigCameras)T.orthoRight=v}get orthoRight(){return this._orthoRight}set orthoBottom(v){this._orthoBottom=v;for(const T of this._rigCameras)T.orthoBottom=v}get orthoBottom(){return this._orthoBottom}set orthoTop(v){this._orthoTop=v;for(const T of this._rigCameras)T.orthoTop=v}get orthoTop(){return this._orthoTop}set mode(v){this._mode=v;for(const T of this._rigCameras)T.mode=v}get mode(){return this._mode}get hasMoved(){return this._hasMoved}constructor(v,T,X){let O=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];super(v,X,!1),this._position=x.l.Zero(),this._upVector=x.l.Up(),this.oblique=null,this._orthoLeft=null,this._orthoRight=null,this._orthoBottom=null,this._orthoTop=null,this.fov=.8,this.projectionPlaneTilt=0,this.ij=1,this.maxZ=1e4,this.inertia=.9,this._mode=F.PERSPECTIVE_CAMERA,this.isIntermediate=!1,this.viewport=new V.d(0,0,1,1),this.layerMask=268435455,this.fovMode=F.FOVMODE_VERTICAL_FIXED,this.cameraRigMode=F.RIG_MODE_NONE,this.customRenderTargets=[],this.outputRenderTarget=null,this.onViewMatrixChangedObservable=new A.b,this.onProjectionMatrixChangedObservable=new A.b,this.onAfterCheckInputsObservable=new A.b,this.onRestoreStateObservable=new A.b,this.isRigCamera=!1,this._hasMoved=!1,this._rigCameras=new Array,this._skipRendering=!1,this._projectionMatrix=new x.b,this._postProcesses=new Array,this._activeMeshes=new B.d(256),this._globalPosition=x.l.Zero(),this._computedViewMatrix=x.b.Identity(),this._doNotComputeProjectionMatrix=!1,this._transformMatrix=x.b.Zero(),this._refreshFrustumPlanes=!0,this._absoluteRotation=x.f.Identity(),this._isCamera=!0,this._isLeftCamera=!1,this._isRightCamera=!1,this.va().addCamera(this),O&&!this.va().activeCamera&&(this.va().activeCamera=this),this.position=T,this.renderPassId=this.va().getEngine().createRenderPassId(`Camera ${v}`)}storeState(){return this._stateStored=!0,this._storedFov=this.fov,this}hasStateStored(){return!!this._stateStored}_restoreStateValues(){return!!this._stateStored&&(this.fov=this._storedFov,!0)}restoreState(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)}getClassName(){return"Uh"}toString(v){let T="Name: "+this.name;if(T+=", type: "+this.getClassName(),this.animations)for(let X=0;X<this.animations.length;X++)T+=", animation[0]: "+this.animations[X].toString(v);return T}applyVerticalCorrection(){const v=this.absoluteRotation.toEulerAngles();this.projectionPlaneTilt=this._scene.useRightHandedSystem?-v.x:v.x}get globalPosition(){return this._globalPosition}getActiveMeshes(){return this._activeMeshes}isActiveMesh(v){return-1!==this._activeMeshes.indexOf(v)}isReady(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(v)for(const T of this._postProcesses)if(T&&!T.isReady())return!1;return super.isReady(v)}_initCache(){super._initCache(),this._cache.position=new x.l(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new x.l(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.ij=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.obliqueAngle=void 0,this._cache.obliqueLength=void 0,this._cache.obliqueOffset=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0}_updateCache(v){v||super._updateCache(),this._cache.position.p(this.position),this._cache.upVector.p(this.upVector)}_isSynchronized(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()}_isSynchronizedViewMatrix(){return!!super._isSynchronized()&&(this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent())}_isSynchronizedProjectionMatrix(){let v=this._cache.mode===this.mode&&this._cache.ij===this.ij&&this._cache.maxZ===this.maxZ;if(!v)return!1;const T=this.getEngine();return this.mode===F.PERSPECTIVE_CAMERA?v=this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===T.getAspectRatio(this)&&this._cache.projectionPlaneTilt===this.projectionPlaneTilt:(v=this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===T.getRenderWidth()&&this._cache.renderHeight===T.getRenderHeight(),this.oblique&&(v=v&&this._cache.obliqueAngle===this.oblique.angle&&this._cache.obliqueLength===this.oblique.length&&this._cache.obliqueOffset===this.oblique.offset)),v}attachControl(v,T){}re(v){}update(){this._hasMoved=!1,this._checkInputs(),this.cameraRigMode!==F.RIG_MODE_NONE&&this._updateRigCameras(),this.getViewMatrix(),this.getProjectionMatrix()}_checkInputs(){this.onAfterCheckInputsObservable.notifyObservers(this)}get rigCameras(){return this._rigCameras}get rigPostProcess(){return this._rigPostProcess}_getFirstPostProcess(){for(let v=0;v<this._postProcesses.length;v++)if(null!==this._postProcesses[v])return this._postProcesses[v];return null}_cascadePostProcessesToRigCams(){const v=this._getFirstPostProcess();v&&v.markTextureDirty();for(let T=0,X=this._rigCameras.length;T<X;T++){const v=this._rigCameras[T],X=v._rigPostProcess;if(X){"pass"===X.getEffectName()&&(v.isIntermediate=0===this._postProcesses.length),v._postProcesses=this._postProcesses.slice(0).concat(X),X.markTextureDirty()}else v._postProcesses=this._postProcesses.slice(0)}}attachPostProcess(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return!v.isReusable()&&this._postProcesses.indexOf(v)>-1?(M.d.Error("You're trying to reuse a post process not defined as reusable."),0):(null==T||T<0?this._postProcesses.push(v):null===this._postProcesses[T]?this._postProcesses[T]=v:this._postProcesses.splice(T,0,v),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.Oe(),this._postProcesses.indexOf(v))}detachPostProcess(v){const T=this._postProcesses.indexOf(v);-1!==T&&(this._postProcesses[T]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.Oe(),this._cascadePostProcessesToRigCams()}getWorldMatrix(){return this._isSynchronizedViewMatrix()||this.getViewMatrix(),this._worldMatrix}_getViewMatrix(){return x.b.Identity()}getViewMatrix(v){return!v&&this._isSynchronizedViewMatrix()||(this._hasMoved=!0,this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.va().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix)),this._computedViewMatrix}freezeProjectionMatrix(v){this._doNotComputeProjectionMatrix=!0,void 0!==v&&(this._projectionMatrix=v)}unfreezeProjectionMatrix(){this._doNotComputeProjectionMatrix=!1}getProjectionMatrix(v){if(this._doNotComputeProjectionMatrix||!v&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.ij=this.ij,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;const T=this.getEngine(),X=this.va(),O=T.useReverseDepthBuffer;if(this.mode===F.PERSPECTIVE_CAMERA){let v;this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=T.getAspectRatio(this),this._cache.projectionPlaneTilt=this.projectionPlaneTilt,this.ij<=0&&(this.ij=.1),v=X.useRightHandedSystem?x.b.PerspectiveFovRHToRef:x.b.PerspectiveFovLHToRef,v(this.fov,T.getAspectRatio(this),O?this.maxZ:this.ij,O?this.ij:this.maxZ,this._projectionMatrix,this.fovMode===F.FOVMODE_VERTICAL_FIXED,T.isNDCHalfZRange,this.projectionPlaneTilt,O)}else{var u,B,m;const v=T.getRenderWidth()/2,A=T.getRenderHeight()/2;X.useRightHandedSystem?this.oblique?x.b.ObliqueOffCenterRHToRef(this.orthoLeft??-v,this.orthoRight??v,this.orthoBottom??-A,this.orthoTop??A,O?this.maxZ:this.ij,O?this.ij:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,T.isNDCHalfZRange):x.b.OrthoOffCenterRHToRef(this.orthoLeft??-v,this.orthoRight??v,this.orthoBottom??-A,this.orthoTop??A,O?this.maxZ:this.ij,O?this.ij:this.maxZ,this._projectionMatrix,T.isNDCHalfZRange):this.oblique?x.b.ObliqueOffCenterLHToRef(this.orthoLeft??-v,this.orthoRight??v,this.orthoBottom??-A,this.orthoTop??A,O?this.maxZ:this.ij,O?this.ij:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,T.isNDCHalfZRange):x.b.OrthoOffCenterLHToRef(this.orthoLeft??-v,this.orthoRight??v,this.orthoBottom??-A,this.orthoTop??A,O?this.maxZ:this.ij,O?this.ij:this.maxZ,this._projectionMatrix,T.isNDCHalfZRange),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.obliqueAngle=null===(u=this.oblique)||void 0===u?void 0:u.angle,this._cache.obliqueLength=null===(B=this.oblique)||void 0===B?void 0:B.length,this._cache.obliqueOffset=null===(m=this.oblique)||void 0===m?void 0:m.offset,this._cache.renderWidth=T.getRenderWidth(),this._cache.renderHeight=T.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix}getTransformationMatrix(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix}_computeObliqueDistance(v){return(this.i||(this.target?x.l.Distance(this.position,this.target):this.position.length()))+v}_updateFrustumPlanes(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?D.b.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=D.b.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)}isInFrustum(v){let T=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._updateFrustumPlanes(),T&&this.rigCameras.length>0){let T=!1;return this.rigCameras.forEach((X=>{X._updateFrustumPlanes(),T=T||v.isInFrustum(X._frustumPlanes)})),T}return v.isInFrustum(this._frustumPlanes)}isCompletelyInFrustum(v){return this._updateFrustumPlanes(),v.isCompletelyInFrustum(this._frustumPlanes)}getForwardRay(){throw(0,n.d)("Ray")}getForwardRayToRef(v){throw(0,n.d)("Ray")}dispose(v){let T=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.va().stopAnimation(this),this.va().removeCamera(this);this._rigCameras.length>0;){const v=this._rigCameras.pop();v&&v.dispose()}if(this._parentContainer){const v=this._parentContainer.cameras.indexOf(this);v>-1&&this._parentContainer.cameras.splice(v,1),this._parentContainer=null}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses.length=0;else if(this.cameraRigMode!==F.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses.length=0;else{let v=this._postProcesses.length;for(;--v>=0;){const T=this._postProcesses[v];T&&T.dispose(this)}}let X=this.customRenderTargets.length;for(;--X>=0;)this.customRenderTargets[X].dispose();this.customRenderTargets.length=0,this._activeMeshes.dispose(),this.va().getEngine().releaseRenderPassId(this.renderPassId),super.dispose(v,T)}get isLeftCamera(){return this._isLeftCamera}get isRightCamera(){return this._isRightCamera}get leftCamera(){return this._rigCameras.length<1?null:this._rigCameras[0]}get rightCamera(){return this._rigCameras.length<2?null:this._rigCameras[1]}getLeftTarget(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()}getRightTarget(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()}setCameraRigMode(v,T){if(this.cameraRigMode!==v){for(;this._rigCameras.length>0;){const v=this._rigCameras.pop();v&&v.dispose()}if(this.cameraRigMode=v,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=T.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=m.c.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==F.RIG_MODE_NONE){const v=this.createRigCamera(this.name+"_L",0);v&&(v._isLeftCamera=!0);const T=this.createRigCamera(this.name+"_R",1);T&&(T._isRightCamera=!0),v&&T&&(this._rigCameras.push(v),this._rigCameras.push(T))}this._setRigMode(T),this._cascadePostProcessesToRigCams(),this.update()}}_setRigMode(v){}_getVRProjectionMatrix(){return x.b.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.ij,this.maxZ,this._cameraRigParams.vrWorkMatrix,!0,this.getEngine().isNDCHalfZRange),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix}setCameraRigParameter(v,T){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[v]=T,"interaxialDistance"===v&&(this._cameraRigParams.stereoHalfAngle=m.c.ToRadians(T/.0637))}createRigCamera(v,T){return null}_updateRigCameras(){for(let v=0;v<this._rigCameras.length;v++)this._rigCameras[v].ij=this.ij,this._rigCameras[v].maxZ=this.maxZ,this._rigCameras[v].fov=this.fov,this._rigCameras[v].upVector.p(this.upVector);this.cameraRigMode===F.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)}_setupInputs(){}serialize(){const v=s.e.Serialize(this);return v.uniqueId=this.uniqueId,v.type=this.getClassName(),this.parent&&this.parent._serializeAsParent(v),this.inputs&&this.inputs.serialize(v),s.e.AppendSerializedAnimations(this,v),v.ranges=this.serializeAnimationRanges(),v.isEnabled=this.isEnabled(),v}clone(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const X=s.e.Clone(F.GetConstructorFromName(this.getClassName(),v,this.va(),this.interaxialDistance,this.isStereoscopicSideBySide),this);return X.name=v,X.parent=T,this.onClonedObservable.notifyObservers(X),X}Zc(v){const T=x.l.Zero();return this.getDirectionToRef(v,T),T}get absoluteRotation(){return this.getWorldMatrix().decompose(void 0,this._absoluteRotation),this._absoluteRotation}getDirectionToRef(v,T){x.l.TransformNormalToRef(v,this.getWorldMatrix(),T)}static GetConstructorFromName(v,T,X){let O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,u=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const B=f.e.Construct(v,T,X,{interaxial_distance:O,isStereoscopicSideBySide:u});return B||(()=>F._CreateDefaultParsedCamera(T,X))}Ke(){return this.getWorldMatrix()}static Parse(v,T){const X=v.type,O=F.GetConstructorFromName(X,v.name,T,v.interaxial_distance,v.isStereoscopicSideBySide),u=s.e.Parse(O,v,T);if(void 0!==v.parentId&&(u._waitingParentId=v.parentId),void 0!==v.parentInstanceIndex&&(u._waitingParentInstanceIndex=v.parentInstanceIndex),u.inputs&&(u.inputs.parse(v),u._setupInputs()),v.upVector&&(u.upVector=x.l.Ld(v.upVector)),u.setPosition&&(u.position.Sd(0,0,0),u.setPosition(x.l.Ld(v.position))),v.target&&u.setTarget&&u.setTarget(x.l.Ld(v.target)),v.cameraRigMode){const T=v.interaxial_distance?{interaxialDistance:v.interaxial_distance}:{};u.setCameraRigMode(v.cameraRigMode,T)}if(v.animations){for(let T=0;T<v.animations.length;T++){const X=v.animations[T],O=(0,H.c)("BABYLON.Animation");O&&u.animations.push(O.Parse(X))}f.e.ParseAnimationRanges(u,v,T)}return v.autoAnimate&&T.beginAnimation(u,v.autoAnimateFrom,v.autoAnimateTo,v.autoAnimateLoop,v.autoAnimateSpeed||1),void 0!==v.isEnabled&&u.Qg(v.isEnabled),u}_calculateHandednessMultiplier(){let v=this.va().useRightHandedSystem?-1:1;return this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(v*=-1),v}}F._CreateDefaultParsedCamera=(v,T)=>{throw(0,n.d)("UniversalCamera")},F.PERSPECTIVE_CAMERA=0,F.ORTHOGRAPHIC_CAMERA=1,F.FOVMODE_VERTICAL_FIXED=0,F.FOVMODE_HORIZONTAL_FIXED=1,F.RIG_MODE_NONE=0,F.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,F.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,F.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,F.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,F.RIG_MODE_STEREOSCOPIC_INTERLACED=14,F.RIG_MODE_VR=20,F.RIG_MODE_CUSTOM=22,F.ForceAttachControlToAlwaysPreventDefault=!1,(0,O.c)([(0,u.E)("position")],F.prototype,"_position",void 0),(0,O.c)([(0,u.E)("upVector")],F.prototype,"_upVector",void 0),(0,O.c)([(0,u.G)()],F.prototype,"orthoLeft",null),(0,O.c)([(0,u.G)()],F.prototype,"orthoRight",null),(0,O.c)([(0,u.G)()],F.prototype,"orthoBottom",null),(0,O.c)([(0,u.G)()],F.prototype,"orthoTop",null),(0,O.c)([(0,u.G)()],F.prototype,"fov",void 0),(0,O.c)([(0,u.G)()],F.prototype,"projectionPlaneTilt",void 0),(0,O.c)([(0,u.G)()],F.prototype,"ij",void 0),(0,O.c)([(0,u.G)()],F.prototype,"maxZ",void 0),(0,O.c)([(0,u.G)()],F.prototype,"inertia",void 0),(0,O.c)([(0,u.G)()],F.prototype,"mode",null),(0,O.c)([(0,u.G)()],F.prototype,"layerMask",void 0),(0,O.c)([(0,u.G)()],F.prototype,"fovMode",void 0),(0,O.c)([(0,u.G)()],F.prototype,"cameraRigMode",void 0),(0,O.c)([(0,u.G)()],F.prototype,"interaxialDistance",void 0),(0,O.c)([(0,u.G)()],F.prototype,"isStereoscopicSideBySide",void 0)},12528:(v,T,X)=>{"use strict";X.d(T,{c:()=>m,e:()=>A});var O=X(1103),u=X(1156),B=X(11921),m={};class A{constructor(v){this.attachedToElement=!1,this.attached={},this.camera=v,this.checkInputs=()=>{}}add(v){const T=v.getSimpleName();this.attached[T]?O.d.Warn("camera input of type "+T+" already exists on camera"):(this.attached[T]=v,v.camera=this.camera,v.checkInputs&&(this.checkInputs=this._addCheckInputs(v.checkInputs.bind(v))),this.attachedToElement&&v.attachControl(this.noPreventDefault))}remove(v){for(const T in this.attached){const X=this.attached[T];if(X===v)return X.re(),X.camera=null,delete this.attached[T],void this.rebuildInputCheck()}}removeByType(v){for(const T in this.attached){const X=this.attached[T];X.getClassName()===v&&(X.re(),X.camera=null,delete this.attached[T],this.rebuildInputCheck())}}_addCheckInputs(v){const T=this.checkInputs;return()=>{T(),v()}}attachInput(v){this.attachedToElement&&v.attachControl(this.noPreventDefault)}attachElement(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){v=!B.e.ForceAttachControlToAlwaysPreventDefault&&v,this.attachedToElement=!0,this.noPreventDefault=v;for(const T in this.attached)this.attached[T].attachControl(v)}}detachElement(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const T in this.attached)this.attached[T].re(),v&&(this.attached[T].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const v in this.attached){const T=this.attached[v];T.checkInputs&&(this.checkInputs=this._addCheckInputs(T.checkInputs.bind(T)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(v){const T={};for(const X in this.attached){const v=this.attached[X],O=u.e.Serialize(v);T[v.getClassName()]=O}v.inputsmgr=T}parse(v){const T=v.inputsmgr;if(T){this.clear();for(const v in T){const X=m[v];if(X){const O=T[v],B=u.e.Parse((()=>new X),O,null);this.add(B)}}}else for(const X in this.attached){const T=m[this.attached[X].getClassName()];if(T){const O=u.e.Parse((()=>new T),v,null);this.remove(this.attached[X]),this.add(O)}}}}},12513:(v,T,X)=>{"use strict";X.d(T,{c:()=>p});var O=X(985),u=X(994),B=X(1006),m=X(12522),A=X(12528),x=X(1300),f=X(1217);class M{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(v){v=f.c.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((T=>{const X=T.event;if(!X.metaKey)if(T.type===x.b.KEYDOWN){if(-1!==this.keysUp.indexOf(X.keyCode)||-1!==this.keysDown.indexOf(X.keyCode)||-1!==this.keysLeft.indexOf(X.keyCode)||-1!==this.keysRight.indexOf(X.keyCode)||-1!==this.keysUpward.indexOf(X.keyCode)||-1!==this.keysDownward.indexOf(X.keyCode)||-1!==this.keysRotateLeft.indexOf(X.keyCode)||-1!==this.keysRotateRight.indexOf(X.keyCode)||-1!==this.keysRotateUp.indexOf(X.keyCode)||-1!==this.keysRotateDown.indexOf(X.keyCode)){-1===this._keys.indexOf(X.keyCode)&&this._keys.push(X.keyCode),v||X.preventDefault()}}else if(-1!==this.keysUp.indexOf(X.keyCode)||-1!==this.keysDown.indexOf(X.keyCode)||-1!==this.keysLeft.indexOf(X.keyCode)||-1!==this.keysRight.indexOf(X.keyCode)||-1!==this.keysUpward.indexOf(X.keyCode)||-1!==this.keysDownward.indexOf(X.keyCode)||-1!==this.keysRotateLeft.indexOf(X.keyCode)||-1!==this.keysRotateRight.indexOf(X.keyCode)||-1!==this.keysRotateUp.indexOf(X.keyCode)||-1!==this.keysRotateDown.indexOf(X.keyCode)){const T=this._keys.indexOf(X.keyCode);T>=0&&this._keys.splice(T,1),v||X.preventDefault()}})))}re(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const v=this.camera;for(let T=0;T<this._keys.length;T++){const X=this._keys[T],O=v._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(X)?v._localDirection.Sd(-O,0,0):-1!==this.keysUp.indexOf(X)?v._localDirection.Sd(0,0,O):-1!==this.keysRight.indexOf(X)?v._localDirection.Sd(O,0,0):-1!==this.keysDown.indexOf(X)?v._localDirection.Sd(0,0,-O):-1!==this.keysUpward.indexOf(X)?v._localDirection.Sd(0,O,0):-1!==this.keysDownward.indexOf(X)?v._localDirection.Sd(0,-O,0):-1!==this.keysRotateLeft.indexOf(X)?(v._localDirection.Sd(0,0,0),v.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(X)?(v._localDirection.Sd(0,0,0),v.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(X)?(v._localDirection.Sd(0,0,0),v.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(X)&&(v._localDirection.Sd(0,0,0),v.cameraRotation.x+=this._getLocalRotation()),v.va().useRightHandedSystem&&(v._localDirection.z*=-1),v.getViewMatrix().invertToRef(v._cameraTransformMatrix),B.l.TransformNormalToRef(v._localDirection,v._cameraTransformMatrix,v._transformedDirection),v.cameraDirection.addInPlace(v._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const v=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*v}}(0,O.c)([(0,u.G)()],M.prototype,"keysUp",void 0),(0,O.c)([(0,u.G)()],M.prototype,"keysUpward",void 0),(0,O.c)([(0,u.G)()],M.prototype,"keysDown",void 0),(0,O.c)([(0,u.G)()],M.prototype,"keysDownward",void 0),(0,O.c)([(0,u.G)()],M.prototype,"keysLeft",void 0),(0,O.c)([(0,u.G)()],M.prototype,"keysRight",void 0),(0,O.c)([(0,u.G)()],M.prototype,"rotationSpeed",void 0),(0,O.c)([(0,u.G)()],M.prototype,"keysRotateLeft",void 0),(0,O.c)([(0,u.G)()],M.prototype,"keysRotateRight",void 0),(0,O.c)([(0,u.G)()],M.prototype,"keysRotateUp",void 0),(0,O.c)([(0,u.G)()],M.prototype,"keysRotateDown",void 0),A.c.FreeCameraKeyboardMoveInput=M;var H=X(1001),n=X(1292);class V{constructor(){let v=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=v,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new H.b,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(v){v=f.c.BackCompatCameraNoPreventDefault(arguments);const T=this.camera.getEngine(),X=T.getInputElement();this._pointerInput||(this._pointerInput=O=>{const u=O.event,B="touch"===u.pointerType;if(!this.touchEnabled&&B)return;if(O.type!==n.d.POINTERMOVE&&-1===this.buttons.indexOf(u.button))return;const m=u.target;if(O.type===n.d.POINTERDOWN){if(B&&-1!==this._activePointerId||!B&&-1!==this._currentActiveButton)return;this._activePointerId=u.pointerId;try{null===m||void 0===m||m.setPointerCapture(u.pointerId)}catch(A){}-1===this._currentActiveButton&&(this._currentActiveButton=u.button),this._previousPosition={x:u.clientX,y:u.clientY},v||(u.preventDefault(),X&&X.focus()),T.isPointerLock&&this._onMouseMove&&this._onMouseMove(O.event)}else if(O.type===n.d.POINTERUP){if(B&&this._activePointerId!==u.pointerId||!B&&this._currentActiveButton!==u.button)return;try{null===m||void 0===m||m.releasePointerCapture(u.pointerId)}catch(A){}this._currentActiveButton=-1,this._previousPosition=null,v||u.preventDefault(),this._activePointerId=-1}else if(O.type===n.d.POINTERMOVE&&(this._activePointerId===u.pointerId||!B))if(T.isPointerLock&&this._onMouseMove)this._onMouseMove(O.event);else if(this._previousPosition){const T=this.camera._calculateHandednessMultiplier(),X=(u.clientX-this._previousPosition.x)*T,O=u.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=X/this.angularSensibility,this.camera.cameraRotation.x+=O/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:X,offsetY:O}),this._previousPosition={x:u.clientX,y:u.clientY},v||u.preventDefault()}}),this._onMouseMove=X=>{if(!T.isPointerLock)return;const O=this.camera._calculateHandednessMultiplier(),u=X.movementX*O;this.camera.cameraRotation.y+=u/this.angularSensibility;const B=X.movementY;this.camera.cameraRotation.x+=B/this.angularSensibility,this._previousPosition=null,v||X.preventDefault()},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,n.d.POINTERDOWN|n.d.POINTERUP|n.d.POINTERMOVE),X&&(this._contextMenuBind=v=>this.onContextMenu(v),X.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(v){v.preventDefault()}re(){if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const v=this.camera.getEngine().getInputElement();v&&v.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,O.c)([(0,u.G)()],V.prototype,"buttons",void 0),(0,O.c)([(0,u.G)()],V.prototype,"angularSensibility",void 0),A.c.FreeCameraMouseInput=V;var D,s=X(1308);class F{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new H.b,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(v){v=f.c.BackCompatCameraNoPreventDefault(arguments),this._wheel=T=>{if(T.type!==n.d.POINTERWHEEL)return;const X=T.event,O=X.deltaMode===s.d.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*O*X.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*O*X.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*O*X.deltaZ/this._normalize,X.preventDefault&&(v||X.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,n.d.POINTERWHEEL)}re(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,O.c)([(0,u.G)()],F.prototype,"wheelPrecisionX",void 0),(0,O.c)([(0,u.G)()],F.prototype,"wheelPrecisionY",void 0),(0,O.c)([(0,u.G)()],F.prototype,"wheelPrecisionZ",void 0),function(v){v[v.MoveRelative=0]="MoveRelative",v[v.RotateRelative=1]="RotateRelative",v[v.MoveScene=2]="MoveScene"}(D||(D={}));class k extends F{constructor(){super(...arguments),this._moveRelative=B.l.Zero(),this._rotateRelative=B.l.Zero(),this._moveScene=B.l.Zero(),this._wheelXAction=D.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=D.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(v){null===v&&this._wheelXAction!==D.MoveRelative||(this._wheelXAction=D.MoveRelative,this._wheelXActionCoordinate=v)}get wheelXMoveRelative(){return this._wheelXAction!==D.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(v){null===v&&this._wheelYAction!==D.MoveRelative||(this._wheelYAction=D.MoveRelative,this._wheelYActionCoordinate=v)}get wheelYMoveRelative(){return this._wheelYAction!==D.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(v){null===v&&this._wheelZAction!==D.MoveRelative||(this._wheelZAction=D.MoveRelative,this._wheelZActionCoordinate=v)}get wheelZMoveRelative(){return this._wheelZAction!==D.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(v){null===v&&this._wheelXAction!==D.RotateRelative||(this._wheelXAction=D.RotateRelative,this._wheelXActionCoordinate=v)}get wheelXRotateRelative(){return this._wheelXAction!==D.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(v){null===v&&this._wheelYAction!==D.RotateRelative||(this._wheelYAction=D.RotateRelative,this._wheelYActionCoordinate=v)}get wheelYRotateRelative(){return this._wheelYAction!==D.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(v){null===v&&this._wheelZAction!==D.RotateRelative||(this._wheelZAction=D.RotateRelative,this._wheelZActionCoordinate=v)}get wheelZRotateRelative(){return this._wheelZAction!==D.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(v){null===v&&this._wheelXAction!==D.MoveScene||(this._wheelXAction=D.MoveScene,this._wheelXActionCoordinate=v)}get wheelXMoveScene(){return this._wheelXAction!==D.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(v){null===v&&this._wheelYAction!==D.MoveScene||(this._wheelYAction=D.MoveScene,this._wheelYActionCoordinate=v)}get wheelYMoveScene(){return this._wheelYAction!==D.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(v){null===v&&this._wheelZAction!==D.MoveScene||(this._wheelZAction=D.MoveScene,this._wheelZActionCoordinate=v)}get wheelZMoveScene(){return this._wheelZAction!==D.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.Td(0),this._rotateRelative.Td(0),this._moveScene.Td(0),this._updateCamera(),this.camera.va().useRightHandedSystem&&(this._moveRelative.z*=-1);const v=B.b.Zero();this.camera.getViewMatrix().invertToRef(v);const T=B.l.Zero();B.l.TransformNormalToRef(this._moveRelative,v,T),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(T),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(v,T,X){if(0===v)return;if(null===T||null===X)return;let O=null;switch(T){case D.MoveRelative:O=this._moveRelative;break;case D.RotateRelative:O=this._rotateRelative;break;case D.MoveScene:O=this._moveScene}switch(X){case 0:O.set(v,0,0);break;case 1:O.set(0,v,0);break;case 2:O.set(0,0,v)}}}(0,O.c)([(0,u.G)()],k.prototype,"wheelXMoveRelative",null),(0,O.c)([(0,u.G)()],k.prototype,"wheelYMoveRelative",null),(0,O.c)([(0,u.G)()],k.prototype,"wheelZMoveRelative",null),(0,O.c)([(0,u.G)()],k.prototype,"wheelXRotateRelative",null),(0,O.c)([(0,u.G)()],k.prototype,"wheelYRotateRelative",null),(0,O.c)([(0,u.G)()],k.prototype,"wheelZRotateRelative",null),(0,O.c)([(0,u.G)()],k.prototype,"wheelXMoveScene",null),(0,O.c)([(0,u.G)()],k.prototype,"wheelYMoveScene",null),(0,O.c)([(0,u.G)()],k.prototype,"wheelZMoveScene",null),A.c.FreeCameraMouseWheelInput=k;class b{constructor(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=v,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=f.c.IsSafari()}attachControl(v){v=f.c.BackCompatCameraNoPreventDefault(arguments);let T=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=X=>{const O=X.event,u="mouse"===O.pointerType||this._isSafari&&"undefined"===typeof O.pointerType;if(this.allowMouse||!u)if(X.type===n.d.POINTERDOWN){if(v||O.preventDefault(),this._pointerPressed.push(O.pointerId),1!==this._pointerPressed.length)return;T={x:O.clientX,y:O.clientY}}else if(X.type===n.d.POINTERUP){v||O.preventDefault();const X=this._pointerPressed.indexOf(O.pointerId);if(-1===X)return;if(this._pointerPressed.splice(X,1),0!=X)return;T=null,this._offsetX=null,this._offsetY=null}else if(X.type===n.d.POINTERMOVE){if(v||O.preventDefault(),!T)return;if(0!=this._pointerPressed.indexOf(O.pointerId))return;this._offsetX=O.clientX-T.x,this._offsetY=-(O.clientY-T.y)}}),this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,n.d.POINTERDOWN|n.d.POINTERUP|n.d.POINTERMOVE),this._onLostFocus){const v=this.camera.getEngine().getInputElement();v&&v.addEventListener("blur",this._onLostFocus)}}re(){if(this._pointerInput){if(this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const v=this.camera.getEngine().getInputElement();v&&v.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const v=this.camera,T=v._calculateHandednessMultiplier();v.cameraRotation.y=T*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)v.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const T=v._computeLocalCameraSpeed(),X=new B.l(0,0,0!==this.touchMoveSensibility?T*this._offsetY/this.touchMoveSensibility:0);B.b.RotationYawPitchRollToRef(v.rotation.y,v.rotation.x,0,v._cameraRotationMatrix),v.cameraDirection.addInPlace(B.l.TransformCoordinates(X,v._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,O.c)([(0,u.G)()],b.prototype,"touchAngularSensibility",void 0),(0,O.c)([(0,u.G)()],b.prototype,"touchMoveSensibility",void 0),A.c.FreeCameraTouchInput=b;class l extends A.e{constructor(v){super(v),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new M),this}addMouse(){let v=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new V(v),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new k,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new b),this}clear(){super.clear(),this._mouseInput=null}}var Q=X(1023),K=X(1111);class p extends m.d{get angularSensibility(){const v=this.inputs.attached.mouse;return v?v.angularSensibility:0}set angularSensibility(v){const T=this.inputs.attached.mouse;T&&(T.angularSensibility=v)}get keysUp(){const v=this.inputs.attached.keyboard;return v?v.keysUp:[]}set keysUp(v){const T=this.inputs.attached.keyboard;T&&(T.keysUp=v)}get keysUpward(){const v=this.inputs.attached.keyboard;return v?v.keysUpward:[]}set keysUpward(v){const T=this.inputs.attached.keyboard;T&&(T.keysUpward=v)}get keysDown(){const v=this.inputs.attached.keyboard;return v?v.keysDown:[]}set keysDown(v){const T=this.inputs.attached.keyboard;T&&(T.keysDown=v)}get keysDownward(){const v=this.inputs.attached.keyboard;return v?v.keysDownward:[]}set keysDownward(v){const T=this.inputs.attached.keyboard;T&&(T.keysDownward=v)}get keysLeft(){const v=this.inputs.attached.keyboard;return v?v.keysLeft:[]}set keysLeft(v){const T=this.inputs.attached.keyboard;T&&(T.keysLeft=v)}get keysRight(){const v=this.inputs.attached.keyboard;return v?v.keysRight:[]}set keysRight(v){const T=this.inputs.attached.keyboard;T&&(T.keysRight=v)}get keysRotateLeft(){const v=this.inputs.attached.keyboard;return v?v.keysRotateLeft:[]}set keysRotateLeft(v){const T=this.inputs.attached.keyboard;T&&(T.keysRotateLeft=v)}get keysRotateRight(){const v=this.inputs.attached.keyboard;return v?v.keysRotateRight:[]}set keysRotateRight(v){const T=this.inputs.attached.keyboard;T&&(T.keysRotateRight=v)}get keysRotateUp(){const v=this.inputs.attached.keyboard;return v?v.keysRotateUp:[]}set keysRotateUp(v){const T=this.inputs.attached.keyboard;T&&(T.keysRotateUp=v)}get keysRotateDown(){const v=this.inputs.attached.keyboard;return v?v.keysRotateDown:[]}set keysRotateDown(v){const T=this.inputs.attached.keyboard;T&&(T.keysRotateDown=v)}constructor(v,T,X){var O;super(v,T,X,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),O=this,this.ellipsoid=new B.l(.5,1,.5),this.ellipsoidOffset=new B.l(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=B.l.Zero(),this._diffPosition=B.l.Zero(),this._newPosition=B.l.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(v,T){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;O._newPosition.p(T),O._newPosition.subtractToRef(O._oldPosition,O._diffPosition),O._diffPosition.length()>K.e.CollisionsEpsilon&&(O.position.addToRef(O._diffPosition,O._deferredPositionUpdate),O._deferOnly?O._deferredUpdated=!0:O.position.p(O._deferredPositionUpdate),O.Mk&&X&&O.Mk(X))},this.inputs=new l(this),this.inputs.addKeyboard().addMouse()}attachControl(v,T){T=f.c.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(T)}re(){this.inputs.detachElement(),this.cameraDirection=new B.l(0,0,0),this.cameraRotation=new B.i(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(v){this._collisionMask=isNaN(v)?-1:v}_collideWithWorld(v){let T;T=this.parent?B.l.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,T.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const X=this.va().collisionCoordinator;this._collider||(this._collider=X.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let O=v;this.applyGravity&&(O=v.add(this.va().gravity)),X.getNewPosition(this._oldPosition,O,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=B.l.Zero(),this._transformedDirection=B.l.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(v){this._needMoveForGravity=v}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.va().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"fb"}}(0,O.c)([(0,u.E)()],p.prototype,"ellipsoid",void 0),(0,O.c)([(0,u.E)()],p.prototype,"ellipsoidOffset",void 0),(0,O.c)([(0,u.G)()],p.prototype,"checkCollisions",void 0),(0,O.c)([(0,u.G)()],p.prototype,"applyGravity",void 0),(0,Q.f)("BABYLON.FreeCamera",p)},12522:(v,T,X)=>{"use strict";X.d(T,{d:()=>f});var O=X(985),u=X(994),B=X(11921),m=X(1006),A=X(1015),x=X(1495);X(11928).e.AddNodeConstructor("TargetCamera",((v,T)=>()=>new f(v,m.l.Zero(),T)));class f extends B.e{constructor(v,T,X){super(v,T,X,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),this._tmpUpVector=m.l.Zero(),this._tmpTargetVector=m.l.Zero(),this.cameraDirection=new m.l(0,0,0),this.cameraRotation=new m.i(0,0),this.ignoreParentScaling=!1,this.updateUpVectorFromRotation=!1,this._tmpQuaternion=new m.f,this.rotation=new m.l(0,0,0),this.speed=2,this.noRotationConstraint=!1,this.invertRotation=!1,this.inverseRotationSpeed=.2,this.lockedTarget=null,this._currentTarget=m.l.Zero(),this._initialFocalDistance=1,this._viewMatrix=m.b.Zero(),this._camMatrix=m.b.Zero(),this._cameraTransformMatrix=m.b.Zero(),this._cameraRotationMatrix=m.b.Zero(),this._referencePoint=new m.l(0,0,1),this._transformedReferencePoint=m.l.Zero(),this._deferredPositionUpdate=new m.l,this._deferredRotationQuaternionUpdate=new m.f,this._deferredRotationUpdate=new m.l,this._deferredUpdated=!1,this._deferOnly=!1,this._defaultUp=m.l.Up(),this._cachedRotationZ=0,this._cachedQuaternionRotationZ=0}getFrontPosition(v){this.getWorldMatrix();const T=this.getTarget().Xc(this.position);return T.normalize(),T.scaleInPlace(v),this.globalPosition.add(T)}_getLockedTargetPosition(){if(!this.lockedTarget)return null;if(this.lockedTarget.absolutePosition){const v=this.lockedTarget;v.Ke().getTranslationToRef(v.absolutePosition)}return this.lockedTarget.absolutePosition||this.lockedTarget}storeState(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),super.storeState()}_restoreStateValues(){return!!super._restoreStateValues()&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.Sd(0,0,0),this.cameraRotation.Sd(0,0),!0)}_initCache(){super._initCache(),this._cache.lockedTarget=new m.l(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new m.l(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new m.f(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}_updateCache(v){v||super._updateCache();const T=this._getLockedTargetPosition();T?this._cache.lockedTarget?this._cache.lockedTarget.p(T):this._cache.lockedTarget=T.clone():this._cache.lockedTarget=null,this._cache.rotation.p(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.p(this.rotationQuaternion)}_isSynchronizedViewMatrix(){if(!super._isSynchronizedViewMatrix())return!1;const v=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(v):!v)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))}_computeLocalCameraSpeed(){const v=this.getEngine();return this.speed*Math.sqrt(v.getDeltaTime()/(100*v.getFps()))}setTarget(v){this.upVector.normalize(),this._initialFocalDistance=v.Xc(this.position).length(),this.position.z===v.z&&(this.position.z+=A.c),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),m.b.LookAtLHToRef(this.position,v,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);const T=v.Xc(this.position);T.x>=0?this.rotation.y=-Math.atan(T.z/T.x)+Math.PI/2:this.rotation.y=-Math.atan(T.z/T.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&m.f.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)}get target(){return this.getTarget()}set target(v){this.setTarget(v)}getTarget(){return this._currentTarget}_decideIfNeedsToMove(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(m.g.Matrix[0]),m.l.TransformNormalToRef(this.cameraDirection,m.g.Matrix[0],m.g.Vd[0]),this._deferredPositionUpdate.addInPlace(m.g.Vd[0]),void(this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate));this._deferredPositionUpdate.addInPlace(this.cameraDirection),this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate)}_checkInputs(){const v=this.invertRotation?-this.inverseRotationSpeed:1,T=this._decideIfNeedsToMove(),X=this.cameraRotation.x||this.cameraRotation.y;if(this._deferredUpdated=!1,this._deferredRotationUpdate.p(this.rotation),this._deferredPositionUpdate.p(this.position),this.rotationQuaternion&&this._deferredRotationQuaternionUpdate.p(this.rotationQuaternion),T&&this._updatePosition(),X){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this._deferredRotationUpdate),this._deferredRotationUpdate.x+=this.cameraRotation.x*v,this._deferredRotationUpdate.y+=this.cameraRotation.y*v,!this.noRotationConstraint){const v=1.570796;this._deferredRotationUpdate.x>v&&(this._deferredRotationUpdate.x=v),this._deferredRotationUpdate.x<-v&&(this._deferredRotationUpdate.x=-v)}if(this._deferOnly?this._deferredUpdated=!0:this.rotation.p(this._deferredRotationUpdate),this.rotationQuaternion){this._deferredRotationUpdate.lengthSquared()&&(m.f.RotationYawPitchRollToRef(this._deferredRotationUpdate.y,this._deferredRotationUpdate.x,this._deferredRotationUpdate.z,this._deferredRotationQuaternionUpdate),this._deferOnly?this._deferredUpdated=!0:this.rotationQuaternion.p(this._deferredRotationQuaternionUpdate))}}T&&(Math.abs(this.cameraDirection.x)<this.speed*A.c&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*A.c&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*A.c&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),X&&(Math.abs(this.cameraRotation.x)<this.speed*A.c&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*A.c&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),super._checkInputs()}_updateCameraRotationMatrix(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):m.b.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)}_rotateUpVectorWithCameraRotationMatrix(){return m.l.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this}_getViewMatrix(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),m.l.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?x.c.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(m.f.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),x.c.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix}_computeViewMatrix(v,T,X){if(this.ignoreParentScaling){if(this.parent){const O=this.parent.getWorldMatrix();m.l.TransformCoordinatesToRef(v,O,this._globalPosition),m.l.TransformCoordinatesToRef(T,O,this._tmpTargetVector),m.l.TransformNormalToRef(X,O,this._tmpUpVector),this._markSyncedWithParent()}else this._globalPosition.p(v),this._tmpTargetVector.p(T),this._tmpUpVector.p(X);this.va().useRightHandedSystem?m.b.LookAtRHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix):m.b.LookAtLHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix)}else if(this.va().useRightHandedSystem?m.b.LookAtRHToRef(v,T,X,this._viewMatrix):m.b.LookAtLHToRef(v,T,X,this._viewMatrix),this.parent){const v=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(v,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.p(v)}createRigCamera(v,T){if(this.cameraRigMode!==B.e.RIG_MODE_NONE){const T=new f(v,this.position.clone(),this.va());return T.isRigCamera=!0,T.rigParent=this,this.cameraRigMode===B.e.RIG_MODE_VR&&(this.rotationQuaternion||(this.rotationQuaternion=new m.f),T._cameraRigParams={},T.rotationQuaternion=new m.f),T.mode=this.mode,T.orthoLeft=this.orthoLeft,T.orthoRight=this.orthoRight,T.orthoTop=this.orthoTop,T.orthoBottom=this.orthoBottom,T}return null}_updateRigCameras(){const v=this._rigCameras[0],T=this._rigCameras[1];switch(this.Ke(),this.cameraRigMode){case B.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case B.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case B.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case B.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case B.e.RIG_MODE_STEREOSCOPIC_INTERLACED:{const X=this.cameraRigMode===B.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,O=this.cameraRigMode===B.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*X,v),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*O,T);break}case B.e.RIG_MODE_VR:v.rotationQuaternion?(v.rotationQuaternion.p(this.rotationQuaternion),T.rotationQuaternion.p(this.rotationQuaternion)):(v.rotation.p(this.rotation),T.rotation.p(this.rotation)),v.position.p(this.position),T.position.p(this.position)}super._updateRigCameras()}_getRigCamPositionAndTarget(v,T){this.getTarget().subtractToRef(this.position,f._TargetFocalPoint),f._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);const X=f._TargetFocalPoint.addInPlace(this.position);m.b.TranslationToRef(-X.x,-X.y,-X.z,f._TargetTransformMatrix),f._TargetTransformMatrix.multiplyToRef(m.b.RotationAxis(T.upVector,v),f._RigCamTransformMatrix),m.b.TranslationToRef(X.x,X.y,X.z,f._TargetTransformMatrix),f._RigCamTransformMatrix.multiplyToRef(f._TargetTransformMatrix,f._RigCamTransformMatrix),m.l.TransformCoordinatesToRef(this.position,f._RigCamTransformMatrix,T.position),T.setTarget(X)}getClassName(){return"TargetCamera"}}f._RigCamTransformMatrix=new m.b,f._TargetTransformMatrix=new m.b,f._TargetFocalPoint=new m.l,(0,O.c)([(0,u.E)()],f.prototype,"rotation",void 0),(0,O.c)([(0,u.G)()],f.prototype,"speed",void 0),(0,O.c)([(0,u.u)("lockedTargetId")],f.prototype,"lockedTarget",void 0)},12970:(v,T,X)=>{"use strict";X.d(T,{b:()=>B});var O=X(1207),u=X(12977);class B{constructor(v,T){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=X,this.Fi=[],this._maxBlockCapacity=T||64,this._selectionContent=new O.c(1024),this._creationFunc=v}update(v,T,X){u.e._CreateBlocks(v,T,X,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}Ge(v){for(let T=0;T<this.Yh.length;T++){this.Yh[T].addEntry(v)}}Je(v){for(let T=0;T<this.Yh.length;T++){this.Yh[T].removeEntry(v)}}select(v,T){this._selectionContent.reset();for(let X=0;X<this.Yh.length;X++){this.Yh[X].select(v,this._selectionContent,T)}return T?this._selectionContent.concat(this.Fi):this._selectionContent.concatWithNoDuplicate(this.Fi),this._selectionContent}intersects(v,T,X){this._selectionContent.reset();for(let O=0;O<this.Yh.length;O++){this.Yh[O].intersects(v,T,this._selectionContent,X)}return X?this._selectionContent.concat(this.Fi):this._selectionContent.concatWithNoDuplicate(this.Fi),this._selectionContent}intersectsRay(v){this._selectionContent.reset();for(let T=0;T<this.Yh.length;T++){this.Yh[T].intersectsRay(v,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.Fi),this._selectionContent}}B.CreationFuncForMeshes=(v,T)=>{const X=v.getBoundingInfo();!v.isBlocked&&X.boundingBox.intersectsMinMax(T.Ji,T.Ki)&&T.entries.push(v)},B.CreationFuncForSubMeshes=(v,T)=>{v.getBoundingInfo().boundingBox.intersectsMinMax(T.Ji,T.Ki)&&T.entries.push(v)}},12977:(v,T,X)=>{"use strict";X.d(T,{e:()=>B});var O=X(1006),u=X(1373);class B{constructor(v,T,X,O,u,B){this.entries=[],this.Li=new Array,this._capacity=X,this._depth=O,this._maxDepth=u,this._creationFunc=B,this._minPoint=v,this._maxPoint=T,this.Li.push(v.clone()),this.Li.push(T.clone()),this.Li.push(v.clone()),this.Li[2].x=T.x,this.Li.push(v.clone()),this.Li[3].y=T.y,this.Li.push(v.clone()),this.Li[4].z=T.z,this.Li.push(T.clone()),this.Li[5].z=v.z,this.Li.push(T.clone()),this.Li[6].x=v.x,this.Li.push(T.clone()),this.Li[7].y=v.y}get Re(){return this._capacity}get Ji(){return this._minPoint}get Ki(){return this._maxPoint}addEntry(v){if(this.Yh)for(let T=0;T<this.Yh.length;T++){this.Yh[T].addEntry(v)}else this._creationFunc(v,this),this.entries.length>this.Re&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(v){if(this.Yh){for(let T=0;T<this.Yh.length;T++){this.Yh[T].removeEntry(v)}return}const T=this.entries.indexOf(v);T>-1&&this.entries.splice(T,1)}addEntries(v){for(let T=0;T<v.length;T++){const X=v[T];this.addEntry(X)}}select(v,T,X){if(u.c.IsInFrustum(this.Li,v)){if(this.Yh){for(let O=0;O<this.Yh.length;O++){this.Yh[O].select(v,T,X)}return}X?T.concat(this.entries):T.concatWithNoDuplicate(this.entries)}}intersects(v,T,X,O){if(u.c.IntersectsSphere(this._minPoint,this._maxPoint,v,T)){if(this.Yh){for(let u=0;u<this.Yh.length;u++){this.Yh[u].intersects(v,T,X,O)}return}O?X.concat(this.entries):X.concatWithNoDuplicate(this.entries)}}intersectsRay(v,T){if(v.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.Yh){for(let X=0;X<this.Yh.length;X++){this.Yh[X].intersectsRay(v,T)}return}T.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){B._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(v,T,X,u,m,A,x,f){x.Yh=new Array;const M=new O.l((T.x-v.x)/2,(T.y-v.y)/2,(T.z-v.z)/2);for(let O=0;O<2;O++)for(let T=0;T<2;T++)for(let H=0;H<2;H++){const n=v.add(M.multiplyByFloats(O,T,H)),V=v.add(M.multiplyByFloats(O+1,T+1,H+1)),D=new B(n,V,u,m+1,A,f);D.addEntries(X),x.Yh.push(D)}}}},12984:(v,T,X)=>{"use strict";X.d(T,{b:()=>M});var O=X(1209),u=X(1006),B=X(11951),m=X(12109),A=X(1290),x=X(12970),f=X(1034);O.e.prototype.createOrUpdateSelectionOctree=function(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,X=this._getComponent(A.d.NAME_OCTREE);X||(X=new M(this),this.xe(X)),this.Di||(this.Di=new x.b(x.b.CreationFuncForMeshes,v,T));const O=this.getWorldExtends();return this.Di.update(O.min,O.max,this.meshes),this.Di},Object.defineProperty(O.e.prototype,"selectionOctree",{get:function(){return this.Di},enumerable:!0,configurable:!0}),B.c.prototype.createOrUpdateSubmeshesOctree=function(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const X=this.va();let O=X._getComponent(A.d.NAME_OCTREE);O||(O=new M(X),X.xe(O)),this._submeshesOctree||(this._submeshesOctree=new x.b(x.b.CreationFuncForSubMeshes,v,T)),this.Ke(!0);const u=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(u.minimumWorld,u.maximumWorld,this.Ce),this._submeshesOctree};class M{constructor(v){this.name=A.d.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new m.e(u.l.Zero(),new u.l(1,1,1)),(v=v||f.c.LastCreatedScene)&&(this.Fe=v,this.Fe.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.Fe.getActiveSubMeshCandidates=v=>this.getActiveSubMeshCandidates(v),this.Fe.getCollidingSubMeshCandidates=(v,T)=>this.getCollidingSubMeshCandidates(v,T),this.Fe.getIntersectingSubMeshCandidates=(v,T)=>this.getIntersectingSubMeshCandidates(v,T))}register(){this.Fe.onMeshRemovedObservable.add((v=>{const T=this.Fe.selectionOctree;if(void 0!==T&&null!==T){const X=T.Fi.indexOf(v);-1!==X&&T.Fi.splice(X,1)}})),this.Fe.onMeshImportedObservable.add((v=>{const T=this.Fe.selectionOctree;void 0!==T&&null!==T&&T.Ge(v)}))}getActiveMeshCandidates(){var v;return(null===(v=this.Fe.Di)||void 0===v?void 0:v.select(this.Fe.frustumPlanes))||this.Fe._getDefaultMeshCandidates()}getActiveSubMeshCandidates(v){if(v._submeshesOctree&&v.useOctreeForRenderingSelection){return v._submeshesOctree.select(this.Fe.frustumPlanes)}return this.Fe._getDefaultSubMeshCandidates(v)}getIntersectingSubMeshCandidates(v,T){if(v._submeshesOctree&&v.useOctreeForPicking){m.e.TransformToRef(T,v.getWorldMatrix(),this._tempRay);return v._submeshesOctree.intersectsRay(this._tempRay)}return this.Fe._getDefaultSubMeshCandidates(v)}getCollidingSubMeshCandidates(v,T){if(v._submeshesOctree&&v.useOctreeForCollisions){const X=T._velocityWorldLength+Math.max(T._radius.x,T._radius.y,T._radius.z);return v._submeshesOctree.intersects(T._basePointWorld,X)}return this.Fe._getDefaultSubMeshCandidates(v)}rebuild(){}dispose(){}}},12109:(v,T,X)=>{"use strict";X.d(T,{e:()=>V});var O=X(1209),u=X(11921),B=X(1015),m=X(1006),A=X(1019),x=X(1363),f=X(1257),M=X(1034),H=X(1310);const n={internalPickerForMesh:void 0};class V{constructor(v,T){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:B.c;this.origin=v,this.direction=T,this.length=X,this.epsilon=O}clone(){return new V(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(v,T){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const O=V._TmpVector3[0].Sd(v.x-X,v.y-X,v.z-X),u=V._TmpVector3[1].Sd(T.x+X,T.y+X,T.z+X);let B,m,A,x,f=0,M=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<O.x||this.origin.x>u.x)return!1}else if(B=1/this.direction.x,m=(O.x-this.origin.x)*B,A=(u.x-this.origin.x)*B,A===-1/0&&(A=1/0),m>A&&(x=m,m=A,A=x),f=Math.max(m,f),M=Math.min(A,M),f>M)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<O.y||this.origin.y>u.y)return!1}else if(B=1/this.direction.y,m=(O.y-this.origin.y)*B,A=(u.y-this.origin.y)*B,A===-1/0&&(A=1/0),m>A&&(x=m,m=A,A=x),f=Math.max(m,f),M=Math.min(A,M),f>M)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<O.z||this.origin.z>u.z)return!1}else if(B=1/this.direction.z,m=(O.z-this.origin.z)*B,A=(u.z-this.origin.z)*B,A===-1/0&&(A=1/0),m>A&&(x=m,m=A,A=x),f=Math.max(m,f),M=Math.min(A,M),f>M)return!1;return!0}intersectsBox(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(v.minimum,v.maximum,T)}intersectsSphere(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const X=v.center.x-this.origin.x,O=v.center.y-this.origin.y,u=v.center.z-this.origin.z,B=X*X+O*O+u*u,m=v.i+T,A=m*m;if(B<=A)return!0;const x=X*this.direction.x+O*this.direction.y+u*this.direction.z;if(x<0)return!1;return B-x*x<=A}intersectsTriangle(v,T,X){const O=V._TmpVector3[0],u=V._TmpVector3[1],B=V._TmpVector3[2],A=V._TmpVector3[3],f=V._TmpVector3[4];T.subtractToRef(v,O),X.subtractToRef(v,u),m.l.CrossToRef(this.direction,u,B);const M=m.l.Dot(O,B);if(0===M)return null;const H=1/M;this.origin.subtractToRef(v,A);const n=m.l.Dot(A,B)*H;if(n<-this.epsilon||n>1+this.epsilon)return null;m.l.CrossToRef(A,O,f);const D=m.l.Dot(this.direction,f)*H;if(D<-this.epsilon||n+D>1+this.epsilon)return null;const s=m.l.Dot(u,f)*H;return s>this.length?null:new x.c(1-n-D,n,s)}intersectsPlane(v){let T;const X=m.l.Dot(v.Wd,this.direction);if(Math.abs(X)<9.99999997475243e-7)return null;{const O=m.l.Dot(v.Wd,this.origin);return T=(-v.d-O)/X,T<0?T<-9.99999997475243e-7?null:0:T}}intersectsAxis(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(v){case"y":{const v=(this.origin.y-T)/this.direction.y;return v>0?null:new m.l(this.origin.x+this.direction.x*-v,T,this.origin.z+this.direction.z*-v)}case"x":{const v=(this.origin.x-T)/this.direction.x;return v>0?null:new m.l(T,this.origin.y+this.direction.y*-v,this.origin.z+this.direction.z*-v)}case"z":{const v=(this.origin.z-T)/this.direction.z;return v>0?null:new m.l(this.origin.x+this.direction.x*-v,this.origin.y+this.direction.y*-v,T)}default:return null}}intersectsMesh(v,T,X){let O=arguments.length>3&&void 0!==arguments[3]&&arguments[3],u=arguments.length>4?arguments[4]:void 0,B=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const A=m.g.Matrix[0];return v.getWorldMatrix().invertToRef(A),this._tmpRay?V.TransformToRef(this,A,this._tmpRay):this._tmpRay=V.Transform(this,A),v.intersects(this._tmpRay,T,X,O,u,B)}intersectsMeshes(v,T,X){X?X.length=0:X=[];for(let O=0;O<v.length;O++){const u=this.intersectsMesh(v[O],T);u.hit&&X.push(u)}return X.sort(this._comparePickingInfo),X}_comparePickingInfo(v,T){return v.distance<T.distance?-1:v.distance>T.distance?1:0}intersectionSegment(v,T,X){const O=this.origin,u=m.g.Vd[0],B=m.g.Vd[1],A=m.g.Vd[2],x=m.g.Vd[3];T.subtractToRef(v,u),this.direction.scaleToRef(V._Rayl,A),O.addToRef(A,B),v.subtractToRef(O,x);const f=m.l.Dot(u,u),M=m.l.Dot(u,A),H=m.l.Dot(A,A),n=m.l.Dot(u,x),D=m.l.Dot(A,x),s=f*H-M*M;let F,k,b=s,l=s;s<V._Smallnum?(F=0,b=1,k=D,l=H):(F=M*D-H*n,k=f*D-M*n,F<0?(F=0,k=D,l=H):F>b&&(F=b,k=D+M,l=H)),k<0?(k=0,-n<0?F=0:-n>f?F=b:(F=-n,b=f)):k>l&&(k=l,-n+M<0?F=0:-n+M>f?F=b:(F=-n+M,b=f));const Q=Math.abs(F)<V._Smallnum?0:F/b,K=Math.abs(k)<V._Smallnum?0:k/l,p=m.g.Vd[4];A.scaleToRef(K,p);const G=m.g.Vd[5];u.scaleToRef(Q,G),G.addInPlace(x);const L=m.g.Vd[6];G.subtractToRef(p,L);return K>0&&K<=this.length&&L.lengthSquared()<X*X?G.length():-1}update(v,T,X,O,u,B,A){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){V._RayDistant||(V._RayDistant=V.Zero()),V._RayDistant.unprojectRayToRef(v,T,X,O,m.b.IdentityReadOnly,B,A);const x=m.g.Matrix[0];u.invertToRef(x),V.TransformToRef(V._RayDistant,x,this)}else this.unprojectRayToRef(v,T,X,O,u,B,A);return this}static Zero(){return new V(m.l.Zero(),m.l.Zero())}static CreateNew(v,T,X,O,u,B,m){return V.Zero().update(v,T,X,O,u,B,m)}static CreateNewFromTo(v,T){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:m.b.IdentityReadOnly;const O=new V(new m.l(0,0,0),new m.l(0,0,0));return V.CreateFromToToRef(v,T,O,X)}static CreateFromToToRef(v,T,X){let O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:m.b.IdentityReadOnly;X.origin.p(v);const u=T.subtractToRef(v,X.direction),B=Math.sqrt(u.x*u.x+u.y*u.y+u.z*u.z);return X.length=B,X.direction.normalize(),V.TransformToRef(X,O,X)}static Transform(v,T){const X=new V(new m.l(0,0,0),new m.l(0,0,0));return V.TransformToRef(v,T,X),X}static TransformToRef(v,T,X){m.l.TransformCoordinatesToRef(v.origin,T,X.origin),m.l.TransformNormalToRef(v.direction,T,X.direction),X.length=v.length,X.epsilon=v.epsilon;const O=X.direction,u=O.length();if(0!==u&&1!==u){const v=1/u;O.x*=v,O.y*=v,O.z*=v,X.length*=u}return X}unprojectRayToRef(v,T,X,O,u,B,A){const x=m.g.Matrix[0];u.multiplyToRef(B,x),x.multiplyToRef(A,x),x.invert();const f=M.c.LastCreatedEngine,H=m.g.Vd[0];H.x=v/X*2-1,H.y=-(T/O*2-1),H.z=null!==f&&void 0!==f&&f.useReverseDepthBuffer?1:null!==f&&void 0!==f&&f.isNDCHalfZRange?0:-1;const n=m.g.Vd[1].Sd(H.x,H.y,1-1e-8),V=m.g.Vd[2],D=m.g.Vd[3];m.l._UnprojectFromInvertedMatrixToRef(H,x,V),m.l._UnprojectFromInvertedMatrixToRef(n,x,D),this.origin.p(V),D.subtractToRef(V,this.direction),this.direction.normalize()}}function D(v,T,X,O,u){let B=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const m=V.Zero();return s(v,T,X,O,m,u,B),m}function s(v,T,X,O,u,B){let A=arguments.length>6&&void 0!==arguments[6]&&arguments[6],x=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const f=v.getEngine();if(!B&&!(B=v.activeCamera))return v;const M=B.viewport,H=f.getRenderHeight(),{x:n,y:V,width:D,height:s}=M.toGlobal(f.getRenderWidth(),H),F=1/f.getHardwareScalingLevel();return T=T*F-n,X=X*F-(H-V-s),u.update(T,X,D,s,O||m.b.IdentityReadOnly,A?m.b.IdentityReadOnly:B.getViewMatrix(),B.getProjectionMatrix(),x),v}function F(v,T,X,O,u){if(!f.d)return v;const B=v.getEngine();if(!u&&!(u=v.activeCamera))throw new Error("Active camera not set");const A=u.viewport,x=B.getRenderHeight(),{x:M,y:H,width:n,height:V}=A.toGlobal(B.getRenderWidth(),x),D=m.b.Identity(),s=1/B.getHardwareScalingLevel();return T=T*s-M,X=X*s-(x-H-V),O.update(T,X,n,V,D,D,u.getProjectionMatrix()),v}function k(v,T,X,O,u,B,m,A){const x=T(O,X.enableDistantPicking),f=X.intersects(x,u,m,B,O,A);return f&&f.hit?!u&&null!=v&&f.distance>=v.distance?null:f:null}function b(v,T,X,O,u,B){let A=null;const x=!!(v.activeCameras&&v.activeCameras.length>1&&v.cameraToUseForPointers!==v.activeCamera),M=v.cameraToUseForPointers||v.activeCamera,H=n.internalPickerForMesh||k;for(let f=0;f<v.meshes.length;f++){const n=v.meshes[f];if(X){if(!X(n,-1))continue}else if(!n.isEnabled()||!n.isVisible||!n.pe)continue;const V=x&&n.isWorldMatrixCameraDependent(),D=n.Ke(V,M);if(n.hasThinInstances&&n.thinInstanceEnablePicking){const v=H(A,T,n,D,!0,!0,B);if(v){if(u)return v;const x=m.g.Matrix[1],f=n.thinInstanceGetWorldMatrices();for(let v=0;v<f.length;v++){if(X&&!X(n,v))continue;f[v].multiplyToRef(D,x);const m=H(A,T,n,x,O,u,B,!0);if(m&&(A=m,A.thinInstanceIndex=v,O))return A}}}else{const v=H(A,T,n,D,O,u,B);if(v&&(A=v,O))return A}}return A||new f.d}function l(v,T,X,O){if(!f.d)return null;const u=[],B=!!(v.activeCameras&&v.activeCameras.length>1&&v.cameraToUseForPointers!==v.activeCamera),A=v.cameraToUseForPointers||v.activeCamera,x=n.internalPickerForMesh||k;for(let f=0;f<v.meshes.length;f++){const M=v.meshes[f];if(X){if(!X(M,-1))continue}else if(!M.isEnabled()||!M.isVisible||!M.pe)continue;const H=B&&M.isWorldMatrixCameraDependent(),n=M.Ke(H,A);if(M.hasThinInstances&&M.thinInstanceEnablePicking){if(x(null,T,M,n,!0,!0,O)){const v=m.g.Matrix[1],B=M.thinInstanceGetWorldMatrices();for(let m=0;m<B.length;m++){if(X&&!X(M,m))continue;B[m].multiplyToRef(n,v);const A=x(null,T,M,v,!1,!1,O,!0);A&&(A.thinInstanceIndex=m,u.push(A))}}}else{const v=x(null,T,M,n,!1,!1,O);v&&u.push(v)}}return u}function Q(v,T){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,O=arguments.length>3?arguments[3]:void 0,u=arguments.length>4?arguments[4]:void 0;O||(O=v.getWorldMatrix()),T.length=X,u?T.origin.p(u):T.origin.p(v.position);const B=m.g.Vd[2];B.set(0,0,v._scene.useRightHandedSystem?-1:1);const A=m.g.Vd[3];return m.l.TransformNormalToRef(B,O,A),m.l.NormalizeToRef(A,T.direction),T}var K,p;V._TmpVector3=(0,A.d)(6,m.l.Zero),V._RayDistant=V.Zero(),V._Smallnum=1e-8,V._Rayl=1e9,K=O.e,(p=u.e)&&(p.prototype.getForwardRay=function(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,T=arguments.length>1?arguments[1]:void 0,X=arguments.length>2?arguments[2]:void 0;return Q(this,new V(m.l.Zero(),m.l.Zero(),v),v,T,X)},p.prototype.getForwardRayToRef=function(v){return Q(this,v,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),K&&(H.d._IsPickingAvailable=!0,K.prototype.createPickingRay=function(v,T,X,O){return D(this,v,T,X,O,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),O.e.prototype.createPickingRayToRef=function(v,T,X,O,u){return s(this,v,T,X,O,u,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},O.e.prototype.createPickingRayInCameraSpace=function(v,T,X){return function(v,T,X,O){const u=V.Zero();return F(v,T,X,u,O),u}(this,v,T,X)},O.e.prototype.createPickingRayInCameraSpaceToRef=function(v,T,X,O){return F(this,v,T,X,O)},O.e.prototype.pickWithBoundingInfo=function(v,T,X,O,u){return function(v,T,X,O,u,B){if(!f.d)return null;const A=b(v,(O=>(v._tempPickingRay||(v._tempPickingRay=V.Zero()),s(v,T,X,O,v._tempPickingRay,B||null),v._tempPickingRay)),O,u,!0);return A&&(A.ray=D(v,T,X,m.b.Identity(),B||null)),A}(this,v,T,X,O,u)},O.e.prototype.oe=function(v,T,X,O,u,B){return function(v,T,X,O,u,B,A){const x=b(v,((O,u)=>(v._tempPickingRay||(v._tempPickingRay=V.Zero()),s(v,T,X,O,v._tempPickingRay,B||null,!1,u),v._tempPickingRay)),O,u,!1,A);return x&&(x.ray=D(v,T,X,m.b.Identity(),B||null)),x}(this,v,T,X,O,u,B)},O.e.prototype.pickWithRay=function(v,T,X,O){return function(v,T,X,O,u){const B=b(v,(X=>(v._pickWithRayInverseMatrix||(v._pickWithRayInverseMatrix=m.b.Identity()),X.invertToRef(v._pickWithRayInverseMatrix),v._cachedRayForTransform||(v._cachedRayForTransform=V.Zero()),V.TransformToRef(T,v._pickWithRayInverseMatrix,v._cachedRayForTransform),v._cachedRayForTransform)),X,O,!1,u);return B&&(B.ray=T),B}(this,v,T,X,O)},O.e.prototype.multiPick=function(v,T,X,O,u){return function(v,T,X,O,u,B){return l(v,(O=>D(v,T,X,O,u||null)),O,B)}(this,v,T,X,O,u)},O.e.prototype.multiPickWithRay=function(v,T,X){return function(v,T,X,O){return l(v,(X=>(v._pickWithRayInverseMatrix||(v._pickWithRayInverseMatrix=m.b.Identity()),X.invertToRef(v._pickWithRayInverseMatrix),v._cachedRayForTransform||(v._cachedRayForTransform=V.Zero()),V.TransformToRef(T,v._pickWithRayInverseMatrix,v._cachedRayForTransform),v._cachedRayForTransform)),X,O)}(this,v,T,X)}},12989:(v,T,X)=>{"use strict";X(1103);var O=X(1441);X(1140),X(1267),X(1032),X(1475),X(1447);O.e},11780:(v,T,X)=>{"use strict";X.r(T),X.d(T,{SceneInstrumentation:()=>B});var O=X(1217),u=X(1319);class B{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(v){v!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=v,v?(this._onBeforeActiveMeshesEvaluationObserver=this.Fe.onBeforeActiveMeshesEvaluationObservable.add((()=>{O.c.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.Fe.onAfterActiveMeshesEvaluationObservable.add((()=>{O.c.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.Fe.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Fe.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(v){v!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=v,v?(this._onBeforeRenderTargetsRenderObserver=this.Fe.onBeforeRenderTargetsRenderObservable.add((()=>{O.c.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.Fe.onAfterRenderTargetsRenderObservable.add((()=>{O.c.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.Fe.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Fe.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(v){v!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=v,v?(this._onBeforeParticlesRenderingObserver=this.Fe.onBeforeParticlesRenderingObservable.add((()=>{O.c.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.Fe.onAfterParticlesRenderingObservable.add((()=>{O.c.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.Fe.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Fe.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(v){v!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=v,this.Fe.spriteManagers&&(v?(this._onBeforeSpritesRenderingObserver=this.Fe.onBeforeSpritesRenderingObservable.add((()=>{O.c.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.Fe.onAfterSpritesRenderingObservable.add((()=>{O.c.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.Fe.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.Fe.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(v){v!==this._capturePhysicsTime&&this.Fe.onBeforePhysicsObservable&&(this._capturePhysicsTime=v,v?(this._onBeforePhysicsObserver=this.Fe.onBeforePhysicsObservable.add((()=>{O.c.StartPerformanceCounter("gb"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.Fe.onAfterPhysicsObservable.add((()=>{O.c.EndPerformanceCounter("gb"),this._physicsTime.endMonitoring()}))):(this.Fe.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.Fe.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(v){v!==this._captureAnimationsTime&&(this._captureAnimationsTime=v,v?this._onAfterAnimationsObserver=this.Fe.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.Fe.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(v){this._captureFrameTime=v}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(v){this._captureInterFrameTime=v}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(v){v!==this._captureRenderTime&&(this._captureRenderTime=v,v?(this._onBeforeDrawPhaseObserver=this.Fe.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),O.c.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.Fe.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),O.c.EndPerformanceCounter("Main render")}))):(this.Fe.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Fe.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(v){v!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=v,v?(this._onBeforeCameraRenderObserver=this.Fe.onBeforeCameraRenderObservable.add((v=>{this._cameraRenderTime.beginMonitoring(),O.c.StartPerformanceCounter(`Rendering camera ${v.name}`)})),this._onAfterCameraRenderObserver=this.Fe.onAfterCameraRenderObservable.add((v=>{this._cameraRenderTime.endMonitoring(!1),O.c.EndPerformanceCounter(`Rendering camera ${v.name}`)}))):(this.Fe.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Fe.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.Fe.getEngine()._drawCalls}constructor(v){this.Fe=v,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new u.d,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new u.d,this._captureFrameTime=!1,this._frameTime=new u.d,this._captureRenderTime=!1,this._renderTime=new u.d,this._captureInterFrameTime=!1,this._interFrameTime=new u.d,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new u.d,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new u.d,this._capturePhysicsTime=!1,this._physicsTime=new u.d,this._captureAnimationsTime=!1,this._animationsTime=new u.d,this._captureCameraRenderTime=!1,this._cameraRenderTime=new u.d,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._onBeforeAnimationsObserver=v.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(O.c.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.Fe.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=v.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(O.c.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.ge(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.ge(),this._captureParticlesRenderTime&&this._particlesRenderTime.ge(),this._captureSpritesRenderTime&&this._spritesRenderTime.ge(),this._captureRenderTime&&this._renderTime.ge(),this._captureCameraRenderTime&&this._cameraRenderTime.ge()}))}dispose(){this.Fe.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.Fe.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Fe.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.Fe.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Fe.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.Fe.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.Fe.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Fe.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.Fe.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.Fe.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.Fe.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Fe.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.Fe.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.Fe.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.Fe.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.Fe.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Fe.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.Fe=null}}},12593:(v,T,X)=>{"use strict";X.d(T,{c:()=>M});var O=X(985),u=X(994),B=X(1006),m=X(11928),A=X(12571),x=X(12597),f=X(1023);m.e.AddNodeConstructor("Light_Type_1",((v,T)=>()=>new M(v,B.l.Zero(),T)));class M extends x.c{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(v){this._shadowFrustumSize=v,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(v){this._shadowOrthoScale=v,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(v){this._orthoLeft=v}get orthoRight(){return this._orthoRight}set orthoRight(v){this._orthoRight=v}get orthoTop(){return this._orthoTop}set orthoTop(v){this._orthoTop=v}get orthoBottom(){return this._orthoBottom}set orthoBottom(v){this._orthoBottom=v}constructor(v,T,X){super(v,X),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=T.scale(-1),this.direction=T}getClassName(){return"hb"}getTypeID(){return A.d.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(v,T,X){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(v):this._setDefaultAutoExtendShadowProjectionMatrix(v,T,X)}_setDefaultFixedFrustumShadowProjectionMatrix(v){const T=this.va().activeCamera;T&&B.b.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:T.ij,void 0!==this.shadowMaxZ?this.shadowMaxZ:T.maxZ,v,this.va().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(v,T,X){const O=this.va().activeCamera;if(!O)return;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const v=B.l.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let O=Number.MAX_VALUE,u=-Number.MAX_VALUE;for(let m=0;m<X.length;m++){const A=X[m];if(!A)continue;const x=A.getBoundingInfo().boundingBox;for(let X=0;X<x.vectorsWorld.length;X++)B.l.TransformCoordinatesToRef(x.vectorsWorld[X],T,v),v.x<this._orthoLeft&&(this._orthoLeft=v.x),v.y<this._orthoBottom&&(this._orthoBottom=v.y),v.x>this._orthoRight&&(this._orthoRight=v.x),v.y>this._orthoTop&&(this._orthoTop=v.y),this.autoCalcShadowZBounds&&(v.z<O&&(O=v.z),v.z>u&&(u=v.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=O,this._shadowMaxZ=u)}const u=this._orthoRight-this._orthoLeft,m=this._orthoTop-this._orthoBottom,A=void 0!==this.shadowMinZ?this.shadowMinZ:O.ij,x=void 0!==this.shadowMaxZ?this.shadowMaxZ:O.maxZ,f=this.va().getEngine().useReverseDepthBuffer;B.b.OrthoOffCenterLHToRef(this._orthoLeft-u*this.shadowOrthoScale,this._orthoRight+u*this.shadowOrthoScale,this._orthoBottom-m*this.shadowOrthoScale,this._orthoTop+m*this.shadowOrthoScale,f?x:A,f?A:x,v,this.va().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(v,T){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,T),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,T),this)}transferToNodeMaterialEffect(v,T){return this.computeTransformedInformation()?(v.setFloat3(T,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(v.setFloat3(T,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(v){const T=this._scene.getEngine();return!T.useReverseDepthBuffer&&T.isNDCHalfZRange?0:1}getDepthMaxZ(v){const T=this._scene.getEngine();return T.useReverseDepthBuffer&&T.isNDCHalfZRange?0:1}prepareLightSpecificDefines(v,T){v["DIRLIGHT"+T]=!0}}(0,O.c)([(0,u.G)()],M.prototype,"shadowFrustumSize",null),(0,O.c)([(0,u.G)()],M.prototype,"shadowOrthoScale",null),(0,O.c)([(0,u.G)()],M.prototype,"autoUpdateExtends",void 0),(0,O.c)([(0,u.G)()],M.prototype,"autoCalcShadowZBounds",void 0),(0,O.c)([(0,u.G)("orthoLeft")],M.prototype,"_orthoLeft",void 0),(0,O.c)([(0,u.G)("orthoRight")],M.prototype,"_orthoRight",void 0),(0,O.c)([(0,u.G)("orthoTop")],M.prototype,"_orthoTop",void 0),(0,O.c)([(0,u.G)("orthoBottom")],M.prototype,"_orthoBottom",void 0),(0,f.f)("BABYLON.DirectionalLight",M)},12925:(v,T,X)=>{"use strict";X.d(T,{b:()=>M});var O=X(985),u=X(994),B=X(1006),m=X(1170),A=X(11928),x=X(12571),f=X(1023);A.e.AddNodeConstructor("Light_Type_3",((v,T)=>()=>new M(v,B.l.Zero(),T)));class M extends x.d{constructor(v,T,X){super(v,X),this.groundColor=new m.d(0,0,0),this.direction=T||B.l.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"jb"}setDirectionToTarget(v){return this.direction=B.l.Normalize(v.Xc(B.l.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(v,T){const X=B.l.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",X.x,X.y,X.z,0,T),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.mj),T),this}transferToNodeMaterialEffect(v,T){const X=B.l.Normalize(this.direction);return v.setFloat3(T,X.x,X.y,X.z),this}Ke(){return this._worldMatrix||(this._worldMatrix=B.b.Identity()),this._worldMatrix}getTypeID(){return x.d.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(v,T){v["HEMILIGHT"+T]=!0}}(0,O.c)([(0,u.k)()],M.prototype,"groundColor",void 0),(0,O.c)([(0,u.E)()],M.prototype,"direction",void 0),(0,f.f)("BABYLON.HemisphericLight",M)},12571:(v,T,X)=>{"use strict";X.d(T,{d:()=>n});var O=X(985),u=X(994),B=X(1006),m=X(1170),A=X(11928),x=X(1251),f=X(1023),M=X(1340),H=X(1156);class n extends A.e{get range(){return this._range}set range(v){this._range=v,this._inverseSquaredRange=1/(this.range*this.range)}get intensityMode(){return this._intensityMode}set intensityMode(v){this._intensityMode=v,this._computePhotometricScale()}get i(){return this._radius}set i(v){this._radius=v,this._computePhotometricScale()}get shadowEnabled(){return this._shadowEnabled}set shadowEnabled(v){this._shadowEnabled!==v&&(this._shadowEnabled=v,this._markMeshesAsLightDirty())}get includedOnlyMeshes(){return this._includedOnlyMeshes}set includedOnlyMeshes(v){this._includedOnlyMeshes=v,this._hookArrayForIncludedOnly(v)}get excludedMeshes(){return this._excludedMeshes}set excludedMeshes(v){this._excludedMeshes=v,this._hookArrayForExcluded(v)}get excludeWithLayerMask(){return this._excludeWithLayerMask}set excludeWithLayerMask(v){this._excludeWithLayerMask=v,this._resyncMeshes()}get includeOnlyWithLayerMask(){return this._includeOnlyWithLayerMask}set includeOnlyWithLayerMask(v){this._includeOnlyWithLayerMask=v,this._resyncMeshes()}get lightmapMode(){return this._lightmapMode}set lightmapMode(v){this._lightmapMode!==v&&(this._lightmapMode=v,this._markMeshesAsLightDirty())}getViewMatrix(v){return null}getProjectionMatrix(v,T){return null}constructor(v,T){super(v,T,!1),this.Vh=new m.d(1,1,1),this.df=new m.d(1,1,1),this.falloffType=n.FALLOFF_DEFAULT,this.mj=1,this._range=Number.MAX_VALUE,this._inverseSquaredRange=0,this._photometricScale=1,this._intensityMode=n.INTENSITYMODE_AUTOMATIC,this._radius=1e-5,this.renderPriority=0,this._shadowEnabled=!0,this._excludeWithLayerMask=0,this._includeOnlyWithLayerMask=0,this._lightmapMode=0,this._shadowGenerators=null,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,this._isLight=!0,this.va().addLight(this),this._uniformBuffer=new x.c(this.va().getEngine(),void 0,void 0,v),this._buildUniformLayout(),this.includedOnlyMeshes=[],this.excludedMeshes=[],this._resyncMeshes()}transferTexturesToEffect(v,T){return this}_bindLight(v,T,X,O){let u=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const B=v.toString();let A=!1;if(this._uniformBuffer.bindToEffect(X,"Light"+B),this._renderId!==T.getRenderId()||this._lastUseSpecular!==O||!this._uniformBuffer.useUbo){this._renderId=T.getRenderId(),this._lastUseSpecular=O;const v=this.getScaledIntensity();this.transferToEffect(X,B),this.Vh.scaleToRef(v,m.k.he[0]),this._uniformBuffer.updateColor4("vLightDiffuse",m.k.he[0],this.range,B),O&&(this.df.scaleToRef(v,m.k.he[1]),this._uniformBuffer.updateColor4("vLightSpecular",m.k.he[1],this.i,B)),A=!0}if(this.transferTexturesToEffect(X,B),T.shadowsEnabled&&this.shadowEnabled&&u){const v=this.getShadowGenerator(T.activeCamera)??this.getShadowGenerator();v&&(v.bindShadowLight(B,X),A=!0)}A?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()}getClassName(){return"Light"}toString(v){let T="Name: "+this.name;if(T+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(let X=0;X<this.animations.length;X++)T+=", animation[0]: "+this.animations[X].toString(v);return T}_syncParentEnabledState(){super._syncParentEnabledState(),this.u()||this._resyncMeshes()}Qg(v){super.Qg(v),this._resyncMeshes()}getShadowGenerator(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===this._shadowGenerators?null:this._shadowGenerators.get(v)??null}getShadowGenerators(){return this._shadowGenerators}getAbsolutePosition(){return B.l.Zero()}canAffectMesh(v){return!v||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(v))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(v))&&((0===this.includeOnlyWithLayerMask||0!==(this.includeOnlyWithLayerMask&v.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&v.layerMask)))}dispose(v){let T=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._shadowGenerators){const v=this._shadowGenerators.values();for(let T=v.next();!0!==T.done;T=v.next()){T.value.dispose()}this._shadowGenerators=null}if(this.va().stopAnimation(this),this._parentContainer){const v=this._parentContainer.lights.indexOf(this);v>-1&&this._parentContainer.lights.splice(v,1),this._parentContainer=null}for(const X of this.va().meshes)X._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.va().removeLight(this),super.dispose(v,T)}getTypeID(){return 0}getScaledIntensity(){return this._photometricScale*this.mj}clone(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const X=n.GetConstructorFromName(this.getTypeID(),v,this.va());if(!X)return null;const O=H.e.Clone(X,this);return v&&(O.name=v),T&&(O.parent=T),O.Qg(this.isEnabled()),this.onClonedObservable.notifyObservers(O),O}serialize(){const v=H.e.Serialize(this);return v.uniqueId=this.uniqueId,v.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(v),this.excludedMeshes.length>0&&(v.excludedMeshesIds=[],this.excludedMeshes.forEach((T=>{v.excludedMeshesIds.push(T.id)}))),this.includedOnlyMeshes.length>0&&(v.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach((T=>{v.includedOnlyMeshesIds.push(T.id)}))),H.e.AppendSerializedAnimations(this,v),v.ranges=this.serializeAnimationRanges(),v.isEnabled=this.isEnabled(),v}static GetConstructorFromName(v,T,X){const O=A.e.Construct("Light_Type_"+v,T,X);return O||null}static Parse(v,T){const X=n.GetConstructorFromName(v.type,v.name,T);if(!X)return null;const O=H.e.Parse(X,v,T);if(v.excludedMeshesIds&&(O._excludedMeshesIds=v.excludedMeshesIds),v.includedOnlyMeshesIds&&(O._includedOnlyMeshesIds=v.includedOnlyMeshesIds),void 0!==v.parentId&&(O._waitingParentId=v.parentId),void 0!==v.parentInstanceIndex&&(O._waitingParentInstanceIndex=v.parentInstanceIndex),void 0!==v.falloffType&&(O.falloffType=v.falloffType),void 0!==v.lightmapMode&&(O.lightmapMode=v.lightmapMode),v.animations){for(let T=0;T<v.animations.length;T++){const X=v.animations[T],u=(0,f.c)("BABYLON.Animation");u&&O.animations.push(u.Parse(X))}A.e.ParseAnimationRanges(O,v,T)}return v.autoAnimate&&T.beginAnimation(O,v.autoAnimateFrom,v.autoAnimateTo,v.autoAnimateLoop,v.autoAnimateSpeed||1),void 0!==v.isEnabled&&O.Qg(v.isEnabled),O}_hookArrayForExcluded(v){var T=this;const X=v.push;v.push=function(){for(var O=arguments.length,u=new Array(O),B=0;B<O;B++)u[B]=arguments[B];const m=X.apply(v,u);for(const v of u)v._resyncLightSource(T);return m};const O=v.splice;v.splice=(T,X)=>{const u=O.apply(v,[T,X]);for(const v of u)v._resyncLightSource(this);return u};for(const u of v)u._resyncLightSource(this)}_hookArrayForIncludedOnly(v){var T=this;const X=v.push;v.push=function(){for(var O=arguments.length,u=new Array(O),B=0;B<O;B++)u[B]=arguments[B];const m=X.apply(v,u);return T._resyncMeshes(),m};const O=v.splice;v.splice=(T,X)=>{const u=O.apply(v,[T,X]);return this._resyncMeshes(),u},this._resyncMeshes()}_resyncMeshes(){for(const v of this.va().meshes)v._resyncLightSource(this)}_markMeshesAsLightDirty(){for(const v of this.va().meshes)-1!==v.lightSources.indexOf(this)&&v._markSubMeshesAsLightDirty()}_computePhotometricScale(){this._photometricScale=this._getPhotometricScale(),this.va().resetCachedMaterial()}_getPhotometricScale(){let v=0;const T=this.getTypeID();let X=this.intensityMode;switch(X===n.INTENSITYMODE_AUTOMATIC&&(X=T===n.LIGHTTYPEID_DIRECTIONALLIGHT?n.INTENSITYMODE_ILLUMINANCE:n.INTENSITYMODE_LUMINOUSINTENSITY),T){case n.LIGHTTYPEID_POINTLIGHT:case n.LIGHTTYPEID_SPOTLIGHT:switch(X){case n.INTENSITYMODE_LUMINOUSPOWER:v=1/(4*Math.PI);break;case n.INTENSITYMODE_LUMINOUSINTENSITY:v=1;break;case n.INTENSITYMODE_LUMINANCE:v=this.i*this.i}break;case n.LIGHTTYPEID_DIRECTIONALLIGHT:switch(X){case n.INTENSITYMODE_ILLUMINANCE:v=1;break;case n.INTENSITYMODE_LUMINANCE:{let T=this.i;T=Math.max(T,.001);v=2*Math.PI*(1-Math.cos(T));break}}break;case n.LIGHTTYPEID_HEMISPHERICLIGHT:v=1}return v}_reorderLightsInScene(){const v=this.va();0!=this._renderPriority&&(v.requireLightSorting=!0),this.va().sortLightsByPriority()}}n.FALLOFF_DEFAULT=M.b.FALLOFF_DEFAULT,n.FALLOFF_PHYSICAL=M.b.FALLOFF_PHYSICAL,n.FALLOFF_GLTF=M.b.FALLOFF_GLTF,n.FALLOFF_STANDARD=M.b.FALLOFF_STANDARD,n.LIGHTMAP_DEFAULT=M.b.LIGHTMAP_DEFAULT,n.LIGHTMAP_SPECULAR=M.b.LIGHTMAP_SPECULAR,n.LIGHTMAP_SHADOWSONLY=M.b.LIGHTMAP_SHADOWSONLY,n.INTENSITYMODE_AUTOMATIC=M.b.INTENSITYMODE_AUTOMATIC,n.INTENSITYMODE_LUMINOUSPOWER=M.b.INTENSITYMODE_LUMINOUSPOWER,n.INTENSITYMODE_LUMINOUSINTENSITY=M.b.INTENSITYMODE_LUMINOUSINTENSITY,n.INTENSITYMODE_ILLUMINANCE=M.b.INTENSITYMODE_ILLUMINANCE,n.INTENSITYMODE_LUMINANCE=M.b.INTENSITYMODE_LUMINANCE,n.LIGHTTYPEID_POINTLIGHT=M.b.LIGHTTYPEID_POINTLIGHT,n.LIGHTTYPEID_DIRECTIONALLIGHT=M.b.LIGHTTYPEID_DIRECTIONALLIGHT,n.LIGHTTYPEID_SPOTLIGHT=M.b.LIGHTTYPEID_SPOTLIGHT,n.LIGHTTYPEID_HEMISPHERICLIGHT=M.b.LIGHTTYPEID_HEMISPHERICLIGHT,(0,O.c)([(0,u.k)()],n.prototype,"diffuse",void 0),(0,O.c)([(0,u.k)()],n.prototype,"specular",void 0),(0,O.c)([(0,u.G)()],n.prototype,"falloffType",void 0),(0,O.c)([(0,u.G)()],n.prototype,"intensity",void 0),(0,O.c)([(0,u.G)()],n.prototype,"range",null),(0,O.c)([(0,u.G)()],n.prototype,"intensityMode",null),(0,O.c)([(0,u.G)()],n.prototype,"i",null),(0,O.c)([(0,u.G)()],n.prototype,"_renderPriority",void 0),(0,O.c)([(0,u.e)("_reorderLightsInScene")],n.prototype,"renderPriority",void 0),(0,O.c)([(0,u.G)("shadowEnabled")],n.prototype,"_shadowEnabled",void 0),(0,O.c)([(0,u.G)("excludeWithLayerMask")],n.prototype,"_excludeWithLayerMask",void 0),(0,O.c)([(0,u.G)("includeOnlyWithLayerMask")],n.prototype,"_includeOnlyWithLayerMask",void 0),(0,O.c)([(0,u.G)("lightmapMode")],n.prototype,"_lightmapMode",void 0)},12597:(v,T,X)=>{"use strict";X.d(T,{c:()=>x});var O=X(985),u=X(994),B=X(1006),m=X(12571),A=X(1495);class x extends m.d{constructor(){super(...arguments),this._needProjectionMatrixCompute=!0,this._viewMatrix=B.b.Identity(),this._projectionMatrix=B.b.Identity()}_setPosition(v){this._position=v}get position(){return this._position}set position(v){this._setPosition(v)}_setDirection(v){this._direction=v}get direction(){return this._direction}set direction(v){this._setDirection(v)}get shadowMinZ(){return this._shadowMinZ}set shadowMinZ(v){this._shadowMinZ=v,this.forceProjectionMatrixCompute()}get shadowMaxZ(){return this._shadowMaxZ}set shadowMaxZ(v){this._shadowMaxZ=v,this.forceProjectionMatrixCompute()}computeTransformedInformation(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=B.l.Zero()),B.l.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=B.l.Zero()),B.l.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)}getDepthScale(){return 50}getShadowDirection(v){return this.transformedDirection?this.transformedDirection:this.direction}getAbsolutePosition(){return this.transformedPosition?this.transformedPosition:this.position}setDirectionToTarget(v){return this.direction=B.l.Normalize(v.Xc(this.position)),this.direction}getRotation(){this.direction.normalize();const v=B.l.Cross(this.direction,A.c.Y),T=B.l.Cross(v,this.direction);return B.l.RotationFromAxis(v,T,this.direction)}needCube(){return!1}needProjectionMatrixCompute(){return this._needProjectionMatrixCompute}forceProjectionMatrixCompute(){this._needProjectionMatrixCompute=!0}_initCache(){super._initCache(),this._cache.position=B.l.Zero()}_isSynchronized(){return!!this._cache.position.equals(this.position)}Ke(v){return!v&&this.isSynchronized()?(this._currentRenderId=this.va().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.p(this.position),this._worldMatrix||(this._worldMatrix=B.b.Identity()),B.b.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)}getDepthMinZ(v){return void 0!==this.shadowMinZ?this.shadowMinZ:v.ij}getDepthMaxZ(v){return void 0!==this.shadowMaxZ?this.shadowMaxZ:v.maxZ}setShadowProjectionMatrix(v,T,X){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(T,X,v):this._setDefaultShadowProjectionMatrix(v,T,X),this}_syncParentEnabledState(){super._syncParentEnabledState(),this.parent&&this.parent.getWorldMatrix||(this.transformedPosition=null,this.transformedDirection=null)}getViewMatrix(v){const T=B.g.Vd[0];let X=this.position;this.computeTransformedInformation()&&(X=this.transformedPosition),B.l.NormalizeToRef(this.getShadowDirection(v),T),1===Math.abs(B.l.Dot(T,B.l.Up()))&&(T.z=1e-13);const O=B.g.Vd[1];return X.addToRef(T,O),B.b.LookAtLHToRef(X,O,B.l.Up(),this._viewMatrix),this._viewMatrix}getProjectionMatrix(v,T){return this.setShadowProjectionMatrix(this._projectionMatrix,v??this._viewMatrix,T??[]),this._projectionMatrix}}(0,O.c)([(0,u.E)()],x.prototype,"position",null),(0,O.c)([(0,u.E)()],x.prototype,"direction",null),(0,O.c)([(0,u.G)()],x.prototype,"shadowMinZ",null),(0,O.c)([(0,u.G)()],x.prototype,"shadowMaxZ",null)},12102:(v,T,X)=>{"use strict";X.d(T,{d:()=>m,h:()=>B,i:()=>A});const O={},u={};function B(v,T){O[v]=T}function m(v,T){u[v]=T}function A(v){return u[v]?u[v]:null}},12032:(v,T,X)=>{"use strict";X.d(T,{d:()=>a,e:()=>p});var O,u=X(1217),B=X(1001),m=X(1209),A=X(1034),x=X(1103),f=X(11945),M=X(1061),H=X(1076),n=X(1053),V=X(1111);!function(v){v[v.Clean=0]="Clean",v[v.Stop=1]="Stop",v[v.Sync=2]="Sync",v[v.NoSync=3]="NoSync"}(O||(O={}));const D=new B.b,s={};let F=!1;function k(){return s[".babylon"]}function b(v){const T=s[v];return T||(x.d.Warn("Unable to find a plugin to load "+v+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),k())}function l(v,T,X){let O="Unable to load from "+(v.rawData?"binary data":v.url);return T?O+=`: ${T}`:X&&(O+=`: ${X}`),O}function Q(v,T,X,O,u,B,m,A,x){var f;const H="data:"===(n=v.url).substring(0,5)?n.substring(5):null;var n;if(v.rawData&&!m)throw"When using ArrayBufferView to load data the file extension must be provided.";const F=m?b(m):H?function(v){for(const T in s){const X=s[T].plugin;if(X.canDirectLoad&&X.canDirectLoad(v))return s[T]}return k()}(v.url):function(v){const T=v.indexOf("?");-1!==T&&(v=v.substring(0,T));const X=v.lastIndexOf(".");return b(v.substring(X,v.length).toLowerCase())}(v.url);if(!F)throw new Error(`No plugin or fallback for ${m??v.url}`);if(!1===(null===x||void 0===x||null===(f=x[F.plugin.name])||void 0===f?void 0:f.enabled))throw new Error(`The '${F.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(v.rawData&&!F.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(v=>{if(F.plugin.createPlugin){const T=F.plugin.createPlugin(x??{});return T instanceof Promise?(T.then(v).catch((v=>{u("Error instantiating plugin.",v)})),null):(v(T),T)}return v(F.plugin),F.plugin})((x=>{var f;if(!x)throw`The loader plugin corresponding to the '${m}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(D.notifyObservers(x),H&&(x.canDirectLoad&&x.canDirectLoad(v.url)||!(0,M.k)(v.url))){if(x.directLoad){const v=x.directLoad(T,H);v instanceof Promise?v.then((v=>{X(x,v)})).catch((v=>{u("Error in directLoad of _loadData: "+v,v)})):X(x,v)}else X(x,H);return}const n=F.isBinary,s=(v,O)=>{T.u?u("Scene has been disposed"):X(x,v,O)};let k=null,b=!1;null===(f=x.ae)||void 0===f||f.add((()=>{b=!0,k&&(k.abort(),k=null),B()}));const l=()=>{if(b)return;const X=(v,T)=>{u(null===v||void 0===v?void 0:v.statusText,T)};if(!x.loadFile&&v.rawData)throw"Plugin does not support loading ArrayBufferView.";k=x.loadFile?x.loadFile(T,v.rawData||v.file||v.url,v.rootUrl,s,O,n,X,A):T._loadFile(v.file||v.url,s,O,!0,n,X)},Q=T.getEngine();let K=Q.enableOfflineSupport;if(K){let X=!1;for(const O of T.disableOfflineSupportExceptionRules)if(O.test(v.url)){X=!0;break}K=!X}K&&V.e.OfflineProviderFactory?T.offlineProvider=V.e.OfflineProviderFactory(v.url,l,Q.disableManifestCheck):l()}))}function K(v,T){let X,O,B=null,m=null;if(T)if(T.name)X=`file:${T.name}`,O=T.name,B=T;else if(ArrayBuffer.isView(T))X="",O=(0,n.c)(),m=T;else if(T.startsWith("data:"))X=T,O="";else if(v){const B=T;if("/"===B.substring(0,1))return u.c.Error("Wrong sceneFilename parameter"),null;X=v+B,O=B}else X=T,O=u.c.GetFilename(T),v=u.c.GetFolderPath(T);else X=v,O=u.c.GetFilename(v),v=u.c.GetFolderPath(v);return{url:X,rootUrl:v,name:O,file:B,rawData:m}}function p(v){if("string"===typeof v.extensions){const T=v.extensions;s[T.toLowerCase()]={plugin:v,isBinary:!1}}else{const T=v.extensions;Object.keys(T).forEach((X=>{s[X.toLowerCase()]={plugin:v,isBinary:T[X].isBinary}}))}}function G(v,T){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:A.c.LastCreatedScene,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,m=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,f=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,M=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",n=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!O)return x.d.Error("No scene available to import mesh to"),null;const V=K(T,X);if(!V)return null;const D={};O.addPendingData(D);const s=()=>{O.removePendingData(D)},F=(v,T)=>{const X=l(V,v,T);m?m(O,X,new H.f(X,H.e.SceneLoaderError,T)):x.d.Error(X),s()},k=B?v=>{try{B(v)}catch(T){F("Error in onProgress callback: "+T,T)}}:void 0,b=(v,T,X,B,m,A,x,f)=>{if(O.importedMeshesFiles.push(V.url),u)try{u(v,T,X,B,m,A,x,f)}catch(M){F("Error in onSuccess callback: "+M,M)}O.removePendingData(D)};return Q(V,O,((T,X,u)=>{if(T.rewriteRootURL&&(V.rootUrl=T.rewriteRootURL(V.rootUrl,u)),T.importMesh){const u=[],B=[],m=[];if(!T.importMesh(v,O,X,V.rootUrl,u,B,m,F))return;O.loadingPluginName=T.name,b(u,B,m,[],[],[],[],[])}else{T.importMeshAsync(v,O,X,V.rootUrl,k,V.name).then((v=>{O.loadingPluginName=T.name,b(v.meshes,v.Ae,v.skeletons,v.animationGroups,v.transformNodes,v.geometries,v.lights,v.spriteManagers)})).catch((v=>{F(v.message,v)}))}}),k,F,s,f,M,n)}function L(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:A.c.LastCreatedEngine,O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,x=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,f=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,M=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",H=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};return X?o(v,T,new m.e(X),O,B,x,f,M,H):(u.c.Error("No engine available"),null)}function r(v,T,X,O,u,B,m){return new Promise(((A,x)=>{L(v,T,X,(v=>{A(v)}),O,((v,T,X)=>{x(X||new Error(T))}),u,B,m)}))}function o(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:A.c.LastCreatedScene,O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,m=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,M=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",n=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!X)return x.d.Error("No scene available to append to"),null;const V=K(v,T);if(!V)return null;const D={};X.addPendingData(D);const s=()=>{X.removePendingData(D)};f.c.ShowLoadingScreen&&!F&&(F=!0,X.getEngine().displayLoadingUI(),X.executeWhenReady((()=>{X.getEngine().hideLoadingUI(),F=!1})));const k=(v,T)=>{const O=l(V,v,T);B?B(X,O,new H.f(O,H.e.SceneLoaderError,T)):x.d.Error(O),s()},b=u?v=>{try{u(v)}catch(T){k("Error in onProgress callback",T)}}:void 0,p=()=>{if(O)try{O(X)}catch(v){k("Error in onSuccess callback",v)}X.removePendingData(D)};return Q(V,X,((v,T)=>{if(v.load){if(!v.load(X,T,V.rootUrl,k))return;X.loadingPluginName=v.name,p()}else{v.loadAsync(X,T,V.rootUrl,b,V.name).then((()=>{X.loadingPluginName=v.name,p()})).catch((v=>{k(v.message,v)}))}}),b,k,s,m,M,n)}function Z(v,T,X,O,u,B,m){return new Promise(((A,x)=>{o(v,T,X,(v=>{A(v)}),O,((v,T,X)=>{x(X||new Error(T))}),u,B,m)}))}function U(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:A.c.LastCreatedScene,O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,m=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,f=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",M=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!X)return x.d.Error("No scene available to load asset container to"),null;const n=K(v,T);if(!n)return null;const V={};X.addPendingData(V);const D=()=>{X.removePendingData(V)},s=(v,T)=>{const O=l(n,v,T);B?B(X,O,new H.f(O,H.e.SceneLoaderError,T)):x.d.Error(O),D()},F=u?v=>{try{u(v)}catch(T){s("Error in onProgress callback",T)}}:void 0,k=v=>{if(O)try{O(v)}catch(T){s("Error in onSuccess callback",T)}X.removePendingData(V)};return Q(n,X,((v,T)=>{if(v.loadAssetContainer){const O=v.loadAssetContainer(X,T,n.rootUrl,s);if(!O)return;O.populateRootNodes(),X.loadingPluginName=v.name,k(O)}else if(v.loadAssetContainerAsync){v.loadAssetContainerAsync(X,T,n.rootUrl,F,n.name).then((T=>{T.populateRootNodes(),X.loadingPluginName=v.name,k(T)})).catch((v=>{s(v.message,v)}))}else s("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),F,s,D,m,f,M)}function J(v,T,X,O,u,B,m){return new Promise(((A,x)=>{U(v,T,X,(v=>{A(v)}),O,((v,T,X)=>{x(X||new Error(T))}),u,B,m)}))}function y(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:A.c.LastCreatedScene,O=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,m=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,f=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,M=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,H=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,n=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",V=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!X)return void x.d.Error("No scene available to load animations to");if(O){for(const v of X.animatables)v.reset();X.stopAllAnimations(),X.animationGroups.slice().forEach((v=>{v.dispose()}));X.getNodes().forEach((v=>{v.animations&&(v.animations=[])}))}else switch(u){case 0:X.animationGroups.slice().forEach((v=>{v.dispose()}));break;case 1:X.animationGroups.forEach((v=>{v.stop()}));break;case 2:X.animationGroups.forEach((v=>{v.reset(),v.restart()}));break;case 3:break;default:return void x.d.Error("Unknown animation group loading mode value '"+u+"'")}const D=X.animatables.length;U(v,T,X,(v=>{v.mergeAnimationsTo(X,X.animatables.slice(D),B),v.dispose(),X.onAnimationFileImportedObservable.notifyObservers(X),m&&m(X)}),f,M,H,n,V)}function P(v,T,X,O,u,B,m,A,x,f){return new Promise(((M,H)=>{y(v,T,X,O,u,B,(v=>{M(v)}),m,((v,T,X)=>{H(X||new Error(T))}),A,x,f)}))}class a{static get ForceFullSceneLoadingForIncremental(){return f.c.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(v){f.c.ForceFullSceneLoadingForIncremental=v}static get ShowLoadingScreen(){return f.c.ShowLoadingScreen}static set ShowLoadingScreen(v){f.c.ShowLoadingScreen=v}static get loggingLevel(){return f.c.loggingLevel}static set loggingLevel(v){f.c.loggingLevel=v}static get CleanBoneMatrixWeights(){return f.c.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(v){f.c.CleanBoneMatrixWeights=v}static GetDefaultPlugin(){return k()}static GetPluginForExtension(v){var T;return null===(T=b(v))||void 0===T?void 0:T.plugin}static IsPluginForExtensionAvailable(v){return function(v){return!!s[v]}(v)}static RegisterPlugin(v){p(v)}static ImportMesh(v,T,X,O,u,B,m,A,x){return G(v,T,X,O,u,B,m,A,x)}static ImportMeshAsync(v,T,X,O,u,B,m){return function(v,T,X,O,u,B,m,A){return new Promise(((x,f)=>{G(v,T,X,O,((v,T,X,O,u,B,m,A)=>{x({meshes:v,Ae:T,skeletons:X,animationGroups:O,transformNodes:u,geometries:B,lights:m,spriteManagers:A})}),u,((v,T,X)=>{f(X||new Error(T))}),B,m,A)}))}(v,T,X,O,u,B,m)}static Load(v,T,X,O,u,B,m,A){return L(v,T,X,O,u,B,m,A)}static LoadAsync(v,T,X,O,u,B){return r(v,T,X,O,u,B)}static Append(v,T,X,O,u,B,m,A){return o(v,T,X,O,u,B,m,A)}static AppendAsync(v,T,X,O,u,B){return Z(v,T,X,O,u,B)}static LoadAssetContainer(v,T,X,O,u,B,m,A){return U(v,T,X,O,u,B,m,A)}static LoadAssetContainerAsync(v,T,X,O,u,B){return J(v,T,X,O,u,B)}static ImportAnimations(v,T,X,O,u,B,m,A,x,f,M){y(v,T,X,O,u,B,m,A,x,f,M)}static ImportAnimationsAsync(v,T,X,O,u,B,m,A,x,f,M){return P(v,T,X,O,u,B,A,f,M)}}a.NO_LOGGING=0,a.MINIMAL_LOGGING=1,a.SUMMARY_LOGGING=2,a.DETAILED_LOGGING=3,a.OnPluginActivatedObservable=D},11945:(v,T,X)=>{"use strict";X.d(T,{c:()=>O});class O{static get ForceFullSceneLoadingForIncremental(){return O._ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(v){O._ForceFullSceneLoadingForIncremental=v}static get ShowLoadingScreen(){return O._ShowLoadingScreen}static set ShowLoadingScreen(v){O._ShowLoadingScreen=v}static get loggingLevel(){return O._LoggingLevel}static set loggingLevel(v){O._LoggingLevel=v}static get CleanBoneMatrixWeights(){return O._CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(v){O._CleanBoneMatrixWeights=v}}O._ForceFullSceneLoadingForIncremental=!1,O._ShowLoadingScreen=!0,O._CleanBoneMatrixWeights=!1,O._LoggingLevel=0},12549:(v,T,X)=>{"use strict";X.d(T,{e:()=>d});var O=X(985),u=X(994),B=X(1103),m=X(1207),A=X(12543),x=X(1209),f=X(1006),M=X(1261),H=X(1403),n=X(1423);class V extends H.c{constructor(){super(...arguments),this.BRDF_V_HEIGHT_CORRELATED=!1,this.MS_BRDF_ENERGY_CONSERVATION=!1,this.SPHERICAL_HARMONICS=!1,this.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1}}class D extends n.b{_markAllSubMeshesAsMiscDirty(){this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(v){let T=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(v,"PBRBRDF",90,new V,T),this._useEnergyConservation=D.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=D.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=D.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=D.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=D.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=D.DEFAULT_USE_SPHERICAL_HARMONICS,this._useSpecularGlossinessInputEnergyConservation=D.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this.useSpecularGlossinessInputEnergyConservation=D.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this._internalMarkAllSubMeshesAsMiscDirty=v._dirtyCallbacks[16],this._enable(!0)}prepareDefines(v){v.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,v.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,v.SPHERICAL_HARMONICS=this._useSphericalHarmonics,v.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation}getClassName(){return"PBRBRDFConfiguration"}}D.DEFAULT_USE_ENERGY_CONSERVATION=!0,D.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,D.DEFAULT_USE_SPHERICAL_HARMONICS=!0,D.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0,(0,O.c)([(0,u.G)(),(0,u.e)("_markAllSubMeshesAsMiscDirty")],D.prototype,"useEnergyConservation",void 0),(0,O.c)([(0,u.G)(),(0,u.e)("_markAllSubMeshesAsMiscDirty")],D.prototype,"useSmithVisibilityHeightCorrelated",void 0),(0,O.c)([(0,u.G)(),(0,u.e)("_markAllSubMeshesAsMiscDirty")],D.prototype,"useSphericalHarmonics",void 0),(0,O.c)([(0,u.G)(),(0,u.e)("_markAllSubMeshesAsMiscDirty")],D.prototype,"useSpecularGlossinessInputEnergyConservation",void 0);var s=X(1343),F=X(1170),k=X(1236),b=X(1352),l=X(1409),Q=X(978),K=X(1412),p=(X(10851),X(1416)),G=X(1397);class L extends H.c{constructor(){super(...arguments),this.CLEARCOAT=!1,this.CLEARCOAT_DEFAULTIOR=!1,this.CLEARCOAT_TEXTURE=!1,this.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this.CLEARCOAT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,this.CLEARCOAT_BUMP=!1,this.CLEARCOAT_BUMPDIRECTUV=0,this.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,this.CLEARCOAT_REMAP_F0=!1,this.CLEARCOAT_TINT=!1,this.CLEARCOAT_TINT_TEXTURE=!1,this.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TINT_GAMMATEXTURE=!1}}class r extends n.b{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(v){let T=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(v,"PBRClearCoat",100,new L,T),this._isEnabled=!1,this.isEnabled=!1,this.mj=1,this.roughness=0,this._indexOfRefraction=r._DefaultIndexOfRefraction,this.indexOfRefraction=r._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._textureRoughness=null,this.textureRoughness=null,this._remapF0OnInterfaceChange=!0,this.remapF0OnInterfaceChange=!0,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=F.d.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=v._dirtyCallbacks[1]}isReadyForSubMesh(v,T,X){if(!this._isEnabled)return!0;const O=this._material._disableBumpMap;if(v._areTexturesDirty&&T.texturesEnabled){if(this._texture&&K.d.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&K.d.ClearCoatTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1;if(X.getCaps().standardDerivatives&&this._bumpTexture&&K.d.ClearCoatBumpTextureEnabled&&!O&&!this._bumpTexture.isReady())return!1;if(this._isTintEnabled&&this._tintTexture&&K.d.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(v,T){this._isEnabled?(v.CLEARCOAT=!0,v.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,v.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange,v._areTexturesDirty&&T.texturesEnabled&&(this._texture&&K.d.ClearCoatTextureEnabled?(0,G.J)(this._texture,v,"CLEARCOAT_TEXTURE"):v.CLEARCOAT_TEXTURE=!1,this._textureRoughness&&K.d.ClearCoatTextureEnabled?(0,G.J)(this._textureRoughness,v,"CLEARCOAT_TEXTURE_ROUGHNESS"):v.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this._bumpTexture&&K.d.ClearCoatBumpTextureEnabled?(0,G.J)(this._bumpTexture,v,"CLEARCOAT_BUMP"):v.CLEARCOAT_BUMP=!1,v.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===r._DefaultIndexOfRefraction,this._isTintEnabled?(v.CLEARCOAT_TINT=!0,this._tintTexture&&K.d.ClearCoatTintTextureEnabled?((0,G.J)(this._tintTexture,v,"CLEARCOAT_TINT_TEXTURE"),v.CLEARCOAT_TINT_GAMMATEXTURE=this._tintTexture.gammaSpace):v.CLEARCOAT_TINT_TEXTURE=!1):(v.CLEARCOAT_TINT=!1,v.CLEARCOAT_TINT_TEXTURE=!1))):(v.CLEARCOAT=!1,v.CLEARCOAT_TEXTURE=!1,v.CLEARCOAT_TEXTURE_ROUGHNESS=!1,v.CLEARCOAT_BUMP=!1,v.CLEARCOAT_TINT=!1,v.CLEARCOAT_TINT_TEXTURE=!1,v.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,v.CLEARCOAT_DEFAULTIOR=!1,v.CLEARCOAT_TEXTUREDIRECTUV=0,v.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,v.CLEARCOAT_BUMPDIRECTUV=0,v.CLEARCOAT_REMAP_F0=!1,v.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,v.CLEARCOAT_TINT_GAMMATEXTURE=!1)}bindForSubMesh(v,T,X,O){if(!this._isEnabled)return;const u=O.materialDefines,B=this._material.isFrozen,m=this._material._disableBumpMap,A=this._material._invertNormalMapX,x=this._material._invertNormalMapY;if(!v.useUbo||!B||!v.isSync){var f,M,H,n;if((this._texture||this._textureRoughness)&&K.d.ClearCoatTextureEnabled)v.updateFloat4("vClearCoatInfos",(null===(f=this._texture)||void 0===f?void 0:f.coordinatesIndex)??0,(null===(M=this._texture)||void 0===M?void 0:M.level)??0,(null===(H=this._textureRoughness)||void 0===H?void 0:H.coordinatesIndex)??0,(null===(n=this._textureRoughness)||void 0===n?void 0:n.level)??0),this._texture&&(0,G.p)(this._texture,v,"clearCoat"),this._textureRoughness&&!u.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,G.p)(this._textureRoughness,v,"clearCoatRoughness");this._bumpTexture&&X.getCaps().standardDerivatives&&K.d.ClearCoatTextureEnabled&&!m&&(v.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),(0,G.p)(this._bumpTexture,v,"clearCoatBump"),T._mirroredCameraPosition?v.updateFloat2("vClearCoatTangentSpaceParams",A?1:-1,x?1:-1):v.updateFloat2("vClearCoatTangentSpaceParams",A?-1:1,x?-1:1)),this._tintTexture&&K.d.ClearCoatTintTextureEnabled&&(v.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),(0,G.p)(this._tintTexture,v,"clearCoatTint")),v.updateFloat2("vClearCoatParams",this.mj,this.roughness);const O=1-this._indexOfRefraction,B=1+this._indexOfRefraction,V=Math.pow(-O/B,2),D=1/this._indexOfRefraction;v.updateFloat4("vClearCoatRefractionParams",V,D,O,B),this._isTintEnabled&&(v.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),v.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}T.texturesEnabled&&(this._texture&&K.d.ClearCoatTextureEnabled&&v.setTexture("clearCoatSampler",this._texture),this._textureRoughness&&!u.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&K.d.ClearCoatTextureEnabled&&v.setTexture("clearCoatRoughnessSampler",this._textureRoughness),this._bumpTexture&&X.getCaps().standardDerivatives&&K.d.ClearCoatBumpTextureEnabled&&!m&&v.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&K.d.ClearCoatTintTextureEnabled&&v.setTexture("clearCoatTintSampler",this._tintTexture))}hasTexture(v){return this._texture===v||(this._textureRoughness===v||(this._bumpTexture===v||this._tintTexture===v))}getActiveTextures(v){this._texture&&v.push(this._texture),this._textureRoughness&&v.push(this._textureRoughness),this._bumpTexture&&v.push(this._bumpTexture),this._tintTexture&&v.push(this._tintTexture)}getAnimatables(v){this._texture&&this._texture.animations&&this._texture.animations.length>0&&v.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&v.push(this._textureRoughness),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&v.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&v.push(this._tintTexture)}dispose(v){var T,X,O,u;v&&(null===(T=this._texture)||void 0===T||T.dispose(),null===(X=this._textureRoughness)||void 0===X||X.dispose(),null===(O=this._bumpTexture)||void 0===O||O.dispose(),null===(u=this._tintTexture)||void 0===u||u.dispose())}getClassName(){return"PBRClearCoatConfiguration"}addFallbacks(v,T,X){return v.CLEARCOAT_BUMP&&T.addFallback(X++,"CLEARCOAT_BUMP"),v.CLEARCOAT_TINT&&T.addFallback(X++,"CLEARCOAT_TINT"),v.CLEARCOAT&&T.addFallback(X++,"CLEARCOAT"),X}getSamplers(v){v.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler")}getUniforms(){return{ubo:[{name:"vClearCoatParams",size:2,type:"vec2"},{name:"vClearCoatRefractionParams",size:4,type:"vec4"},{name:"vClearCoatInfos",size:4,type:"vec4"},{name:"clearCoatMatrix",size:16,type:"mat4"},{name:"clearCoatRoughnessMatrix",size:16,type:"mat4"},{name:"vClearCoatBumpInfos",size:2,type:"vec2"},{name:"vClearCoatTangentSpaceParams",size:2,type:"vec2"},{name:"clearCoatBumpMatrix",size:16,type:"mat4"},{name:"vClearCoatTintParams",size:4,type:"vec4"},{name:"clearCoatColorAtDistance",size:1,type:"float"},{name:"vClearCoatTintInfos",size:2,type:"vec2"},{name:"clearCoatTintMatrix",size:16,type:"mat4"}]}}}r._DefaultIndexOfRefraction=1.5,(0,O.c)([(0,u.G)(),(0,u.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"isEnabled",void 0),(0,O.c)([(0,u.G)()],r.prototype,"intensity",void 0),(0,O.c)([(0,u.G)()],r.prototype,"roughness",void 0),(0,O.c)([(0,u.G)(),(0,u.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"indexOfRefraction",void 0),(0,O.c)([(0,u.z)(),(0,u.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"texture",void 0),(0,O.c)([(0,u.G)(),(0,u.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useRoughnessFromMainTexture",void 0),(0,O.c)([(0,u.z)(),(0,u.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"textureRoughness",void 0),(0,O.c)([(0,u.G)(),(0,u.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"remapF0OnInterfaceChange",void 0),(0,O.c)([(0,u.z)(),(0,u.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"bumpTexture",void 0),(0,O.c)([(0,u.G)(),(0,u.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"isTintEnabled",void 0),(0,O.c)([(0,u.k)()],r.prototype,"tintColor",void 0),(0,O.c)([(0,u.G)()],r.prototype,"tintColorAtDistance",void 0),(0,O.c)([(0,u.G)()],r.prototype,"tintThickness",void 0),(0,O.c)([(0,u.z)(),(0,u.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"tintTexture",void 0);class o extends H.c{constructor(){super(...arguments),this.IRIDESCENCE=!1,this.IRIDESCENCE_TEXTURE=!1,this.IRIDESCENCE_TEXTUREDIRECTUV=0,this.IRIDESCENCE_THICKNESS_TEXTURE=!1,this.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0}}class Z extends n.b{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(v){let T=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(v,"PBRIridescence",110,new o,T),this._isEnabled=!1,this.isEnabled=!1,this.mj=1,this.minimumThickness=Z._DefaultMinimumThickness,this.maximumThickness=Z._DefaultMaximumThickness,this.indexOfRefraction=Z._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._thicknessTexture=null,this.thicknessTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=v._dirtyCallbacks[1]}isReadyForSubMesh(v,T){if(!this._isEnabled)return!0;if(v._areTexturesDirty&&T.texturesEnabled){if(this._texture&&K.d.IridescenceTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._thicknessTexture&&K.d.IridescenceTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(v,T){this._isEnabled?(v.IRIDESCENCE=!0,v._areTexturesDirty&&T.texturesEnabled&&(this._texture&&K.d.IridescenceTextureEnabled?(0,G.J)(this._texture,v,"IRIDESCENCE_TEXTURE"):v.IRIDESCENCE_TEXTURE=!1,this._thicknessTexture&&K.d.IridescenceTextureEnabled?(0,G.J)(this._thicknessTexture,v,"IRIDESCENCE_THICKNESS_TEXTURE"):v.IRIDESCENCE_THICKNESS_TEXTURE=!1)):(v.IRIDESCENCE=!1,v.IRIDESCENCE_TEXTURE=!1,v.IRIDESCENCE_THICKNESS_TEXTURE=!1,v.IRIDESCENCE_TEXTUREDIRECTUV=0,v.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0)}bindForSubMesh(v,T){if(!this._isEnabled)return;const X=this._material.isFrozen;if(!v.useUbo||!X||!v.isSync){var O,u,B,m;if((this._texture||this._thicknessTexture)&&K.d.IridescenceTextureEnabled)v.updateFloat4("vIridescenceInfos",(null===(O=this._texture)||void 0===O?void 0:O.coordinatesIndex)??0,(null===(u=this._texture)||void 0===u?void 0:u.level)??0,(null===(B=this._thicknessTexture)||void 0===B?void 0:B.coordinatesIndex)??0,(null===(m=this._thicknessTexture)||void 0===m?void 0:m.level)??0),this._texture&&(0,G.p)(this._texture,v,"iridescence"),this._thicknessTexture&&(0,G.p)(this._thicknessTexture,v,"iridescenceThickness");v.updateFloat4("vIridescenceParams",this.mj,this.indexOfRefraction,this.minimumThickness,this.maximumThickness)}T.texturesEnabled&&(this._texture&&K.d.IridescenceTextureEnabled&&v.setTexture("iridescenceSampler",this._texture),this._thicknessTexture&&K.d.IridescenceTextureEnabled&&v.setTexture("iridescenceThicknessSampler",this._thicknessTexture))}hasTexture(v){return this._texture===v||this._thicknessTexture===v}getActiveTextures(v){this._texture&&v.push(this._texture),this._thicknessTexture&&v.push(this._thicknessTexture)}getAnimatables(v){this._texture&&this._texture.animations&&this._texture.animations.length>0&&v.push(this._texture),this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&v.push(this._thicknessTexture)}dispose(v){var T,X;v&&(null===(T=this._texture)||void 0===T||T.dispose(),null===(X=this._thicknessTexture)||void 0===X||X.dispose())}getClassName(){return"PBRIridescenceConfiguration"}addFallbacks(v,T,X){return v.IRIDESCENCE&&T.addFallback(X++,"IRIDESCENCE"),X}getSamplers(v){v.push("iridescenceSampler","iridescenceThicknessSampler")}getUniforms(){return{ubo:[{name:"vIridescenceParams",size:4,type:"vec4"},{name:"vIridescenceInfos",size:4,type:"vec4"},{name:"iridescenceMatrix",size:16,type:"mat4"},{name:"iridescenceThicknessMatrix",size:16,type:"mat4"}]}}}Z._DefaultMinimumThickness=100,Z._DefaultMaximumThickness=400,Z._DefaultIndexOfRefraction=1.3,(0,O.c)([(0,u.G)(),(0,u.e)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"isEnabled",void 0),(0,O.c)([(0,u.G)()],Z.prototype,"intensity",void 0),(0,O.c)([(0,u.G)()],Z.prototype,"minimumThickness",void 0),(0,O.c)([(0,u.G)()],Z.prototype,"maximumThickness",void 0),(0,O.c)([(0,u.G)()],Z.prototype,"indexOfRefraction",void 0),(0,O.c)([(0,u.z)(),(0,u.e)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"texture",void 0),(0,O.c)([(0,u.z)(),(0,u.e)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"thicknessTexture",void 0);class U extends H.c{constructor(){super(...arguments),this.ANISOTROPIC=!1,this.ANISOTROPIC_TEXTURE=!1,this.ANISOTROPIC_TEXTUREDIRECTUV=0,this.ANISOTROPIC_LEGACY=!1,this.MAINUV1=!1}}class J extends n.b{set angle(v){this.direction.x=Math.cos(v),this.direction.y=Math.sin(v)}get angle(){return Math.atan2(this.direction.y,this.direction.x)}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markAllSubMeshesAsMiscDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(v){let T=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(v,"PBRAnisotropic",110,new U,T),this._isEnabled=!1,this.isEnabled=!1,this.mj=1,this.direction=new f.i(1,0),this._texture=null,this.texture=null,this._legacy=!1,this.legacy=!1,this._internalMarkAllSubMeshesAsTexturesDirty=v._dirtyCallbacks[1],this._internalMarkAllSubMeshesAsMiscDirty=v._dirtyCallbacks[16]}isReadyForSubMesh(v,T){return!this._isEnabled||!(v._areTexturesDirty&&T.texturesEnabled&&this._texture&&K.d.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())}prepareDefinesBeforeAttributes(v,T,X){this._isEnabled?(v.ANISOTROPIC=this._isEnabled,this._isEnabled&&!X.isVerticesDataPresent(M.e.TangentKind)&&(v._needUVs=!0,v.MAINUV1=!0),v._areTexturesDirty&&T.texturesEnabled&&(this._texture&&K.d.AnisotropicTextureEnabled?(0,G.J)(this._texture,v,"ANISOTROPIC_TEXTURE"):v.ANISOTROPIC_TEXTURE=!1),v._areMiscDirty&&(v.ANISOTROPIC_LEGACY=this._legacy)):(v.ANISOTROPIC=!1,v.ANISOTROPIC_TEXTURE=!1,v.ANISOTROPIC_TEXTUREDIRECTUV=0,v.ANISOTROPIC_LEGACY=!1)}bindForSubMesh(v,T){if(!this._isEnabled)return;const X=this._material.isFrozen;v.useUbo&&X&&v.isSync||(this._texture&&K.d.AnisotropicTextureEnabled&&(v.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),(0,G.p)(this._texture,v,"anisotropy")),v.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.mj)),T.texturesEnabled&&this._texture&&K.d.AnisotropicTextureEnabled&&v.setTexture("anisotropySampler",this._texture)}hasTexture(v){return this._texture===v}getActiveTextures(v){this._texture&&v.push(this._texture)}getAnimatables(v){this._texture&&this._texture.animations&&this._texture.animations.length>0&&v.push(this._texture)}dispose(v){v&&this._texture&&this._texture.dispose()}getClassName(){return"PBRAnisotropicConfiguration"}addFallbacks(v,T,X){return v.ANISOTROPIC&&T.addFallback(X++,"ANISOTROPIC"),X}getSamplers(v){v.push("anisotropySampler")}getUniforms(){return{ubo:[{name:"vAnisotropy",size:3,type:"vec3"},{name:"vAnisotropyInfos",size:2,type:"vec2"},{name:"anisotropyMatrix",size:16,type:"mat4"}]}}parse(v,T,X){super.parse(v,T,X),void 0===v.legacy&&(this.legacy=!0)}}(0,O.c)([(0,u.G)(),(0,u.e)("_markAllSubMeshesAsTexturesDirty")],J.prototype,"isEnabled",void 0),(0,O.c)([(0,u.G)()],J.prototype,"intensity",void 0),(0,O.c)([(0,u.D)()],J.prototype,"direction",void 0),(0,O.c)([(0,u.z)(),(0,u.e)("_markAllSubMeshesAsTexturesDirty")],J.prototype,"texture",void 0),(0,O.c)([(0,u.G)(),(0,u.e)("_markAllSubMeshesAsMiscDirty")],J.prototype,"legacy",void 0);class y extends H.c{constructor(){super(...arguments),this.SHEEN=!1,this.SHEEN_TEXTURE=!1,this.SHEEN_GAMMATEXTURE=!1,this.SHEEN_TEXTURE_ROUGHNESS=!1,this.SHEEN_TEXTUREDIRECTUV=0,this.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0,this.SHEEN_LINKWITHALBEDO=!1,this.SHEEN_ROUGHNESS=!1,this.SHEEN_ALBEDOSCALING=!1,this.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1}}class P extends n.b{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(v){let T=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(v,"Sheen",120,new y,T),this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.mj=1,this.color=F.d.White(),this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._roughness=null,this.roughness=null,this._textureRoughness=null,this.textureRoughness=null,this._albedoScaling=!1,this.albedoScaling=!1,this._internalMarkAllSubMeshesAsTexturesDirty=v._dirtyCallbacks[1]}isReadyForSubMesh(v,T){if(!this._isEnabled)return!0;if(v._areTexturesDirty&&T.texturesEnabled){if(this._texture&&K.d.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&K.d.SheenTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(v,T){this._isEnabled?(v.SHEEN=!0,v.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,v.SHEEN_ROUGHNESS=null!==this._roughness,v.SHEEN_ALBEDOSCALING=this._albedoScaling,v.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,v._areTexturesDirty&&T.texturesEnabled&&(this._texture&&K.d.SheenTextureEnabled?((0,G.J)(this._texture,v,"SHEEN_TEXTURE"),v.SHEEN_GAMMATEXTURE=this._texture.gammaSpace):v.SHEEN_TEXTURE=!1,this._textureRoughness&&K.d.SheenTextureEnabled?(0,G.J)(this._textureRoughness,v,"SHEEN_TEXTURE_ROUGHNESS"):v.SHEEN_TEXTURE_ROUGHNESS=!1)):(v.SHEEN=!1,v.SHEEN_TEXTURE=!1,v.SHEEN_TEXTURE_ROUGHNESS=!1,v.SHEEN_LINKWITHALBEDO=!1,v.SHEEN_ROUGHNESS=!1,v.SHEEN_ALBEDOSCALING=!1,v.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,v.SHEEN_GAMMATEXTURE=!1,v.SHEEN_TEXTUREDIRECTUV=0,v.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0)}bindForSubMesh(v,T,X,O){if(!this._isEnabled)return;const u=O.materialDefines,B=this._material.isFrozen;if(!v.useUbo||!B||!v.isSync){var m,A,x,f;if((this._texture||this._textureRoughness)&&K.d.SheenTextureEnabled)v.updateFloat4("vSheenInfos",(null===(m=this._texture)||void 0===m?void 0:m.coordinatesIndex)??0,(null===(A=this._texture)||void 0===A?void 0:A.level)??0,(null===(x=this._textureRoughness)||void 0===x?void 0:x.coordinatesIndex)??0,(null===(f=this._textureRoughness)||void 0===f?void 0:f.level)??0),this._texture&&(0,G.p)(this._texture,v,"sheen"),this._textureRoughness&&!u.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,G.p)(this._textureRoughness,v,"sheenRoughness");v.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.mj),null!==this._roughness&&v.updateFloat("vSheenRoughness",this._roughness)}T.texturesEnabled&&(this._texture&&K.d.SheenTextureEnabled&&v.setTexture("sheenSampler",this._texture),this._textureRoughness&&!u.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&K.d.SheenTextureEnabled&&v.setTexture("sheenRoughnessSampler",this._textureRoughness))}hasTexture(v){return this._texture===v||this._textureRoughness===v}getActiveTextures(v){this._texture&&v.push(this._texture),this._textureRoughness&&v.push(this._textureRoughness)}getAnimatables(v){this._texture&&this._texture.animations&&this._texture.animations.length>0&&v.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&v.push(this._textureRoughness)}dispose(v){var T,X;v&&(null===(T=this._texture)||void 0===T||T.dispose(),null===(X=this._textureRoughness)||void 0===X||X.dispose())}getClassName(){return"PBRSheenConfiguration"}addFallbacks(v,T,X){return v.SHEEN&&T.addFallback(X++,"SHEEN"),X}getSamplers(v){v.push("sheenSampler","sheenRoughnessSampler")}getUniforms(){return{ubo:[{name:"vSheenColor",size:4,type:"vec4"},{name:"vSheenRoughness",size:1,type:"float"},{name:"vSheenInfos",size:4,type:"vec4"},{name:"sheenMatrix",size:16,type:"mat4"},{name:"sheenRoughnessMatrix",size:16,type:"mat4"}]}}}(0,O.c)([(0,u.G)(),(0,u.e)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"isEnabled",void 0),(0,O.c)([(0,u.G)(),(0,u.e)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"linkSheenWithAlbedo",void 0),(0,O.c)([(0,u.G)()],P.prototype,"intensity",void 0),(0,O.c)([(0,u.k)()],P.prototype,"color",void 0),(0,O.c)([(0,u.z)(),(0,u.e)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"texture",void 0),(0,O.c)([(0,u.G)(),(0,u.e)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"useRoughnessFromMainTexture",void 0),(0,O.c)([(0,u.G)(),(0,u.e)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"roughness",void 0),(0,O.c)([(0,u.z)(),(0,u.e)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"textureRoughness",void 0),(0,O.c)([(0,u.G)(),(0,u.e)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"albedoScaling",void 0);class a extends H.c{constructor(){super(...arguments),this.SUBSURFACE=!1,this.SS_REFRACTION=!1,this.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_TRANSLUCENCY=!1,this.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_SCATTERING=!1,this.SS_DISPERSION=!1,this.SS_THICKNESSANDMASK_TEXTURE=!1,this.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,this.SS_HAS_THICKNESS=!1,this.SS_REFRACTIONINTENSITY_TEXTURE=!1,this.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,this.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,this.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,this.SS_REFRACTIONMAP_3D=!1,this.SS_REFRACTIONMAP_OPPOSITEZ=!1,this.SS_LODINREFRACTIONALPHA=!1,this.SS_GAMMAREFRACTION=!1,this.SS_RGBDREFRACTION=!1,this.SS_LINEARSPECULARREFRACTION=!1,this.SS_LINKREFRACTIONTOTRANSPARENCY=!1,this.SS_ALBEDOFORREFRACTIONTINT=!1,this.SS_ALBEDOFORTRANSLUCENCYTINT=!1,this.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.SS_USE_THICKNESS_AS_DEPTH=!1,this.SS_USE_GLTF_TEXTURES=!1}}class E extends n.b{get scatteringDiffusionProfile(){return this._scene.subSurfaceConfiguration?this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex]:null}set scatteringDiffusionProfile(v){this._scene.enableSubSurfaceForPrePass()&&v&&(this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(v))}get volumeIndexOfRefraction(){return this._volumeIndexOfRefraction>=1?this._volumeIndexOfRefraction:this._indexOfRefraction}set volumeIndexOfRefraction(v){this._volumeIndexOfRefraction=v>=1?v:-1}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markScenePrePassDirty(){this._internalMarkAllSubMeshesAsTexturesDirty(),this._internalMarkScenePrePassDirty()}isCompatible(){return!0}constructor(v){let T=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(v,"PBRSubSurface",130,new a,T),this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isDispersionEnabled=!1,this.isDispersionEnabled=!1,this._isScatteringEnabled=!1,this.isScatteringEnabled=!1,this._scatteringDiffusionProfileIndex=0,this.refractionIntensity=1,this.translucencyIntensity=1,this.useAlbedoToTintRefraction=!1,this.useAlbedoToTintTranslucency=!1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1.5,this.indexOfRefraction=1.5,this._volumeIndexOfRefraction=-1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.useThicknessAsDepth=!1,this.tintColor=F.d.White(),this.tintColorAtDistance=1,this.dispersion=0,this.diffusionDistance=F.d.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._refractionIntensityTexture=null,this.refractionIntensityTexture=null,this._translucencyIntensityTexture=null,this.translucencyIntensityTexture=null,this.translucencyColor=null,this._translucencyColorTexture=null,this.translucencyColorTexture=null,this._useGltfStyleTextures=!0,this.useGltfStyleTextures=!0,this._scene=v.va(),this.registerForExtraEvents=!0,this._internalMarkAllSubMeshesAsTexturesDirty=v._dirtyCallbacks[1],this._internalMarkScenePrePassDirty=v._dirtyCallbacks[32]}isReadyForSubMesh(v,T){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return!0;if(v._areTexturesDirty&&T.texturesEnabled){if(this._thicknessTexture&&K.d.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;if(this._translucencyColorTexture&&K.d.TranslucencyColorTextureEnabled&&!this._translucencyColorTexture.isReadyOrNotBlocking())return!1;if(this._translucencyIntensityTexture&&K.d.TranslucencyIntensityTextureEnabled&&!this._translucencyIntensityTexture.isReadyOrNotBlocking())return!1;const v=this._getRefractionTexture(T);if(v&&K.d.RefractionTextureEnabled&&!v.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(v,T){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return v.SUBSURFACE=!1,v.SS_DISPERSION=!1,v.SS_TRANSLUCENCY=!1,v.SS_SCATTERING=!1,v.SS_REFRACTION=!1,v.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,v.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,v.SS_THICKNESSANDMASK_TEXTURE=!1,v.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,v.SS_HAS_THICKNESS=!1,v.SS_REFRACTIONINTENSITY_TEXTURE=!1,v.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,v.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,v.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,v.SS_REFRACTIONMAP_3D=!1,v.SS_REFRACTIONMAP_OPPOSITEZ=!1,v.SS_LODINREFRACTIONALPHA=!1,v.SS_GAMMAREFRACTION=!1,v.SS_RGBDREFRACTION=!1,v.SS_LINEARSPECULARREFRACTION=!1,v.SS_LINKREFRACTIONTOTRANSPARENCY=!1,v.SS_ALBEDOFORREFRACTIONTINT=!1,v.SS_ALBEDOFORTRANSLUCENCYTINT=!1,v.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,v.SS_USE_THICKNESS_AS_DEPTH=!1,v.SS_USE_GLTF_TEXTURES=!1,v.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,void(v.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0);if(v._areTexturesDirty){if(v.SUBSURFACE=!0,v.SS_DISPERSION=this._isDispersionEnabled,v.SS_TRANSLUCENCY=this._isTranslucencyEnabled,v.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,v.SS_SCATTERING=this._isScatteringEnabled,v.SS_THICKNESSANDMASK_TEXTURE=!1,v.SS_REFRACTIONINTENSITY_TEXTURE=!1,v.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,v.SS_HAS_THICKNESS=!1,v.SS_USE_GLTF_TEXTURES=!1,v.SS_REFRACTION=!1,v.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,v.SS_REFRACTIONMAP_3D=!1,v.SS_GAMMAREFRACTION=!1,v.SS_RGBDREFRACTION=!1,v.SS_LINEARSPECULARREFRACTION=!1,v.SS_REFRACTIONMAP_OPPOSITEZ=!1,v.SS_LODINREFRACTIONALPHA=!1,v.SS_LINKREFRACTIONTOTRANSPARENCY=!1,v.SS_ALBEDOFORREFRACTIONTINT=!1,v.SS_ALBEDOFORTRANSLUCENCYTINT=!1,v.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,v.SS_USE_THICKNESS_AS_DEPTH=!1,v.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,v._areTexturesDirty&&T.texturesEnabled&&(this._thicknessTexture&&K.d.ThicknessTextureEnabled&&(0,G.J)(this._thicknessTexture,v,"SS_THICKNESSANDMASK_TEXTURE"),this._refractionIntensityTexture&&K.d.RefractionIntensityTextureEnabled&&(0,G.J)(this._refractionIntensityTexture,v,"SS_REFRACTIONINTENSITY_TEXTURE"),this._translucencyIntensityTexture&&K.d.TranslucencyIntensityTextureEnabled&&(0,G.J)(this._translucencyIntensityTexture,v,"SS_TRANSLUCENCYINTENSITY_TEXTURE"),this._translucencyColorTexture&&K.d.TranslucencyColorTextureEnabled&&(0,G.J)(this._translucencyColorTexture,v,"SS_TRANSLUCENCYCOLOR_TEXTURE")),v.SS_HAS_THICKNESS=this.maximumThickness-this.minimumThickness!==0,v.SS_USE_GLTF_TEXTURES=this._useGltfStyleTextures,v.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._refractionIntensityTexture,v.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._translucencyIntensityTexture,this._isRefractionEnabled&&T.texturesEnabled){const X=this._getRefractionTexture(T);X&&K.d.RefractionTextureEnabled&&(v.SS_REFRACTION=!0,v.SS_REFRACTIONMAP_3D=X.isCube,v.SS_GAMMAREFRACTION=X.gammaSpace,v.SS_RGBDREFRACTION=X.isRGBD,v.SS_LINEARSPECULARREFRACTION=X.linearSpecularLOD,v.SS_REFRACTIONMAP_OPPOSITEZ=this._scene.useRightHandedSystem&&X.isCube?!X.invertZ:X.invertZ,v.SS_LODINREFRACTIONALPHA=X.lodLevelInAlpha,v.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency,v.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction,v.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=X.isCube&&X.boundingBoxSize,v.SS_USE_THICKNESS_AS_DEPTH=this.useThicknessAsDepth)}this._isTranslucencyEnabled&&(v.SS_ALBEDOFORTRANSLUCENCYTINT=this.useAlbedoToTintTranslucency)}}hardBindForSubMesh(v,T,X,O){if(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled)if(0===this.maximumThickness&&0===this.minimumThickness)v.updateFloat2("vThicknessParam",0,0);else{O.getRenderingMesh().getWorldMatrix().decompose(f.g.Vd[0]);const T=Math.max(Math.abs(f.g.Vd[0].x),Math.abs(f.g.Vd[0].y),Math.abs(f.g.Vd[0].z));v.updateFloat2("vThicknessParam",this.minimumThickness*T,(this.maximumThickness-this.minimumThickness)*T)}}bindForSubMesh(v,T,X,O){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return;const u=O.materialDefines,B=this._material.isFrozen,m=this._material.realTimeFiltering,A=u.LODBASEDMICROSFURACE,x=this._getRefractionTexture(T);if(!v.useUbo||!B||!v.isSync){if(this._thicknessTexture&&K.d.ThicknessTextureEnabled&&(v.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),(0,G.p)(this._thicknessTexture,v,"thickness")),this._refractionIntensityTexture&&K.d.RefractionIntensityTextureEnabled&&u.SS_REFRACTIONINTENSITY_TEXTURE&&(v.updateFloat2("vRefractionIntensityInfos",this._refractionIntensityTexture.coordinatesIndex,this._refractionIntensityTexture.level),(0,G.p)(this._refractionIntensityTexture,v,"refractionIntensity")),this._translucencyColorTexture&&K.d.TranslucencyColorTextureEnabled&&u.SS_TRANSLUCENCYCOLOR_TEXTURE&&(v.updateFloat2("vTranslucencyColorInfos",this._translucencyColorTexture.coordinatesIndex,this._translucencyColorTexture.level),(0,G.p)(this._translucencyColorTexture,v,"translucencyColor")),this._translucencyIntensityTexture&&K.d.TranslucencyIntensityTextureEnabled&&u.SS_TRANSLUCENCYINTENSITY_TEXTURE&&(v.updateFloat2("vTranslucencyIntensityInfos",this._translucencyIntensityTexture.coordinatesIndex,this._translucencyIntensityTexture.level),(0,G.p)(this._translucencyIntensityTexture,v,"translucencyIntensity")),x&&K.d.RefractionTextureEnabled){v.ne("refractionMatrix",x.getRefractionTextureMatrix());let T=1;x.isCube||x.depth&&(T=x.depth);const X=x.getSize().width,O=this.volumeIndexOfRefraction;if(v.updateFloat4("vRefractionInfos",x.level,1/O,T,this._invertRefractionY?-1:1),v.updateFloat4("vRefractionMicrosurfaceInfos",X,x.lodGenerationScale,x.lodGenerationOffset,1/this.indexOfRefraction),m&&v.updateFloat2("vRefractionFilteringInfo",X,Math.log2(X)),x.boundingBoxSize){const T=x;v.updateVector3("vRefractionPosition",T.boundingBoxPosition),v.updateVector3("vRefractionSize",T.boundingBoxSize)}}this._isScatteringEnabled&&v.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex),v.updateColor3("vDiffusionDistance",this.diffusionDistance),v.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintColorAtDistance)),v.updateColor4("vTranslucencyColor",this.translucencyColor??this.tintColor,0),v.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0),v.updateFloat("dispersion",this.dispersion)}T.texturesEnabled&&(this._thicknessTexture&&K.d.ThicknessTextureEnabled&&v.setTexture("thicknessSampler",this._thicknessTexture),this._refractionIntensityTexture&&K.d.RefractionIntensityTextureEnabled&&u.SS_REFRACTIONINTENSITY_TEXTURE&&v.setTexture("refractionIntensitySampler",this._refractionIntensityTexture),this._translucencyIntensityTexture&&K.d.TranslucencyIntensityTextureEnabled&&u.SS_TRANSLUCENCYINTENSITY_TEXTURE&&v.setTexture("translucencyIntensitySampler",this._translucencyIntensityTexture),this._translucencyColorTexture&&K.d.TranslucencyColorTextureEnabled&&u.SS_TRANSLUCENCYCOLOR_TEXTURE&&v.setTexture("translucencyColorSampler",this._translucencyColorTexture),x&&K.d.RefractionTextureEnabled&&(A?v.setTexture("refractionSampler",x):(v.setTexture("refractionSampler",x._lodTextureMid||x),v.setTexture("refractionSamplerLow",x._lodTextureLow||x),v.setTexture("refractionSamplerHigh",x._lodTextureHigh||x))))}_getRefractionTexture(v){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?v.environmentTexture:null}get disableAlphaBlending(){return this._isRefractionEnabled&&this._linkRefractionWithTransparency}fillRenderTargetTextures(v){K.d.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&v.push(this._refractionTexture)}hasTexture(v){return this._thicknessTexture===v||(this._refractionTexture===v||(this._refractionIntensityTexture===v||(this._translucencyIntensityTexture===v||this._translucencyColorTexture===v)))}hasRenderTargetTextures(){return!!(K.d.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)}getActiveTextures(v){this._thicknessTexture&&v.push(this._thicknessTexture),this._refractionTexture&&v.push(this._refractionTexture),this._translucencyColorTexture&&v.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&v.push(this._translucencyIntensityTexture)}getAnimatables(v){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&v.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&v.push(this._refractionTexture),this._translucencyColorTexture&&this._translucencyColorTexture.animations&&this._translucencyColorTexture.animations.length>0&&v.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.animations&&this._translucencyIntensityTexture.animations.length>0&&v.push(this._translucencyIntensityTexture)}dispose(v){v&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose(),this._translucencyColorTexture&&this._translucencyColorTexture.dispose(),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.dispose())}getClassName(){return"PBRSubSurfaceConfiguration"}addFallbacks(v,T,X){return v.SS_SCATTERING&&T.addFallback(X++,"SS_SCATTERING"),v.SS_TRANSLUCENCY&&T.addFallback(X++,"SS_TRANSLUCENCY"),X}getSamplers(v){v.push("thicknessSampler","refractionIntensitySampler","translucencyIntensitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh","translucencyColorSampler")}getUniforms(){return{ubo:[{name:"vRefractionMicrosurfaceInfos",size:4,type:"vec4"},{name:"vRefractionFilteringInfo",size:2,type:"vec2"},{name:"vTranslucencyIntensityInfos",size:2,type:"vec2"},{name:"vRefractionInfos",size:4,type:"vec4"},{name:"refractionMatrix",size:16,type:"mat4"},{name:"vThicknessInfos",size:2,type:"vec2"},{name:"vRefractionIntensityInfos",size:2,type:"vec2"},{name:"thicknessMatrix",size:16,type:"mat4"},{name:"refractionIntensityMatrix",size:16,type:"mat4"},{name:"translucencyIntensityMatrix",size:16,type:"mat4"},{name:"vThicknessParam",size:2,type:"vec2"},{name:"vDiffusionDistance",size:3,type:"vec3"},{name:"vTintColor",size:4,type:"vec4"},{name:"vSubSurfaceIntensity",size:3,type:"vec3"},{name:"vRefractionPosition",size:3,type:"vec3"},{name:"vRefractionSize",size:3,type:"vec3"},{name:"scatteringDiffusionProfile",size:1,type:"float"},{name:"dispersion",size:1,type:"float"},{name:"vTranslucencyColor",size:4,type:"vec4"},{name:"vTranslucencyColorInfos",size:2,type:"vec2"},{name:"translucencyColorMatrix",size:16,type:"mat4"}]}}}(0,O.c)([(0,u.G)(),(0,u.e)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"isRefractionEnabled",void 0),(0,O.c)([(0,u.G)(),(0,u.e)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"isTranslucencyEnabled",void 0),(0,O.c)([(0,u.G)(),(0,u.e)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"isDispersionEnabled",void 0),(0,O.c)([(0,u.G)(),(0,u.e)("_markScenePrePassDirty")],E.prototype,"isScatteringEnabled",void 0),(0,O.c)([(0,u.G)()],E.prototype,"_scatteringDiffusionProfileIndex",void 0),(0,O.c)([(0,u.G)()],E.prototype,"refractionIntensity",void 0),(0,O.c)([(0,u.G)()],E.prototype,"translucencyIntensity",void 0),(0,O.c)([(0,u.G)()],E.prototype,"useAlbedoToTintRefraction",void 0),(0,O.c)([(0,u.G)()],E.prototype,"useAlbedoToTintTranslucency",void 0),(0,O.c)([(0,u.z)(),(0,u.e)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"thicknessTexture",void 0),(0,O.c)([(0,u.z)(),(0,u.e)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"refractionTexture",void 0),(0,O.c)([(0,u.G)(),(0,u.e)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"indexOfRefraction",void 0),(0,O.c)([(0,u.G)()],E.prototype,"_volumeIndexOfRefraction",void 0),(0,O.c)([(0,u.e)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"volumeIndexOfRefraction",null),(0,O.c)([(0,u.G)(),(0,u.e)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"invertRefractionY",void 0),(0,O.c)([(0,u.G)(),(0,u.e)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"linkRefractionWithTransparency",void 0),(0,O.c)([(0,u.G)()],E.prototype,"minimumThickness",void 0),(0,O.c)([(0,u.G)()],E.prototype,"maximumThickness",void 0),(0,O.c)([(0,u.G)()],E.prototype,"useThicknessAsDepth",void 0),(0,O.c)([(0,u.k)()],E.prototype,"tintColor",void 0),(0,O.c)([(0,u.G)()],E.prototype,"tintColorAtDistance",void 0),(0,O.c)([(0,u.G)()],E.prototype,"dispersion",void 0),(0,O.c)([(0,u.k)()],E.prototype,"diffusionDistance",void 0),(0,O.c)([(0,u.G)(),(0,u.e)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"useMaskFromThicknessTexture",void 0),(0,O.c)([(0,u.z)(),(0,u.e)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"refractionIntensityTexture",void 0),(0,O.c)([(0,u.z)(),(0,u.e)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"translucencyIntensityTexture",void 0),(0,O.c)([(0,u.k)()],E.prototype,"translucencyColor",void 0),(0,O.c)([(0,u.z)(),(0,u.e)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"translucencyColorTexture",void 0),(0,O.c)([(0,u.G)(),(0,u.e)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"useGltfStyleTextures",void 0);var i=X(1419),t=X(1400),C=X(1431);const c={effect:null,subMesh:null};class N extends H.c{constructor(v){super(v),this.PBR=!0,this.NUM_SAMPLES="0",this.REALTIME_FILTERING=!1,this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.ALBEDO=!1,this.GAMMAALBEDO=!1,this.ALBEDODIRECTUV=0,this.VERTEXCOLOR=!1,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.AMBIENTINGRAYSCALE=!1,this.OPACITY=!1,this.VERTEXALPHA=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHABLEND=!1,this.ALPHAFROMALBEDO=!1,this.ALPHATESTVALUE="0.5",this.SPECULAROVERALPHA=!1,this.RADIANCEOVERALPHA=!1,this.ALPHAFRESNEL=!1,this.LINEARALPHAFRESNEL=!1,this.PREMULTIPLYALPHA=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.GAMMAEMISSIVE=!1,this.REFLECTIVITY=!1,this.REFLECTIVITY_GAMMA=!1,this.REFLECTIVITYDIRECTUV=0,this.SPECULARTERM=!1,this.MICROSURFACEFROMREFLECTIVITYMAP=!1,this.MICROSURFACEAUTOMATIC=!1,this.LODBASEDMICROSFURACE=!1,this.MICROSURFACEMAP=!1,this.MICROSURFACEMAPDIRECTUV=0,this.METALLICWORKFLOW=!1,this.ROUGHNESSSTOREINMETALMAPALPHA=!1,this.ROUGHNESSSTOREINMETALMAPGREEN=!1,this.METALLNESSSTOREINMETALMAPBLUE=!1,this.AOSTOREINMETALMAPRED=!1,this.METALLIC_REFLECTANCE=!1,this.METALLIC_REFLECTANCE_GAMMA=!1,this.METALLIC_REFLECTANCEDIRECTUV=0,this.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=!1,this.REFLECTANCE=!1,this.REFLECTANCE_GAMMA=!1,this.REFLECTANCEDIRECTUV=0,this.ENVIRONMENTBRDF=!1,this.ENVIRONMENTBRDF_RGBD=!1,this.NORMAL=!1,this.TANGENT=!1,this.BUMP=!1,this.BUMPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.NORMALXYSCALE=!0,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.USELIGHTMAPASSHADOWMAP=!1,this.GAMMALIGHTMAP=!1,this.RGBDLIGHTMAP=!1,this.REFLECTION=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.INVERTCUBICMAP=!1,this.USESPHERICALFROMREFLECTIONMAP=!1,this.USEIRRADIANCEMAP=!1,this.USESPHERICALINVERTEX=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.LODINREFLECTIONALPHA=!1,this.GAMMAREFLECTION=!1,this.RGBDREFLECTION=!1,this.LINEARSPECULARREFLECTION=!1,this.RADIANCEOCCLUSION=!1,this.HORIZONOCCLUSION=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.NONUNIFORMSCALING=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.EXPOSURE=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.USEPHYSICALLIGHTFALLOFF=!1,this.USEGLTFLIGHTFALLOFF=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.LOGARITHMICDEPTH=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.FORCENORMALFORWARD=!1,this.SPECULARAA=!1,this.UNLIT=!1,this.DECAL_AFTER_DETAIL=!1,this.DEBUGMODE=0,this.rebuild()}reset(){super.reset(),this.ALPHATESTVALUE="0.5",this.PBR=!0,this.NORMALXYSCALE=!0}}class d extends l.e{get realTimeFiltering(){return this._realTimeFiltering}set realTimeFiltering(v){this._realTimeFiltering=v,this.Oe(1)}get realTimeFilteringQuality(){return this._realTimeFilteringQuality}set realTimeFilteringQuality(v){this._realTimeFilteringQuality=v,this.Oe(1)}get canRenderToMRT(){return!0}_attachImageProcessingConfiguration(v){v!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=v||this.va().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}constructor(v,T){super(v,T,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||d.ForceGLSL),this._directIntensity=1,this._emissiveIntensity=1,this._environmentIntensity=1,this._specularIntensity=1,this._lightingInfos=new f.o(this._directIntensity,this._emissiveIntensity,this._environmentIntensity,this._specularIntensity),this._disableBumpMap=!1,this._albedoTexture=null,this._ambientTexture=null,this._ambientTextureStrength=1,this._ambientTextureImpactOnAnalyticalLights=d.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._reflectivityTexture=null,this._metallicTexture=null,this._metallic=null,this._roughness=null,this._metallicF0Factor=1,this._metallicReflectanceColor=F.d.White(),this._useOnlyMetallicFromMetallicReflectanceTexture=!1,this._metallicReflectanceTexture=null,this._reflectanceTexture=null,this._microSurfaceTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._ambientColor=new F.d(0,0,0),this._albedoColor=new F.d(1,1,1),this._reflectivityColor=new F.d(1,1,1),this._reflectionColor=new F.d(1,1,1),this._emissiveColor=new F.d(0,0,0),this._microSurface=.9,this._useLightmapAsShadowmap=!1,this._useHorizonOcclusion=!0,this._useRadianceOcclusion=!0,this._useAlphaFromAlbedoTexture=!1,this._useSpecularOverAlpha=!0,this._useMicroSurfaceFromReflectivityMapAlpha=!1,this._useRoughnessFromMetallicTextureAlpha=!0,this._useRoughnessFromMetallicTextureGreen=!1,this._useMetallnessFromMetallicTextureBlue=!1,this._useAmbientOcclusionFromMetallicTextureRed=!1,this._useAmbientInGrayScale=!1,this._useAutoMicroSurfaceFromReflectivityMap=!1,this._lightFalloff=d.LIGHTFALLOFF_PHYSICAL,this._useRadianceOverAlpha=!0,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this._parallaxScaleBias=.05,this._disableLighting=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._alphaCutOff=.4,this._forceAlphaTest=!1,this._useAlphaFresnel=!1,this._useLinearAlphaFresnel=!1,this._environmentBRDFTexture=null,this._forceIrradianceInFragment=!1,this._realTimeFiltering=!1,this._realTimeFilteringQuality=8,this._forceNormalForward=!1,this._enableSpecularAntiAliasing=!1,this._imageProcessingObserver=null,this._renderTargets=new m.d(16),this._globalAmbientColor=new F.d(0,0,0),this._unlit=!1,this._applyDecalMapAfterDetailMap=!1,this._debugMode=0,this._shadersLoaded=!1,this._breakShaderLoadedCheck=!1,this.debugMode=0,this.debugLimit=-1,this.debugFactor=1,this._cacheHasRenderTargetTextures=!1,this.brdf=new D(this),this.clearCoat=new r(this),this.iridescence=new Z(this),this.anisotropy=new J(this),this.sheen=new P(this),this.subSurface=new E(this),this.detailMap=new i.d(this),this._attachImageProcessingConfiguration(null),this.getRenderTargetTextures=()=>(this._renderTargets.reset(),K.d.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets),this._environmentBRDFTexture=(0,A.d)(this.va()),this.prePassConfiguration=new s.b}get hasRenderTargetTextures(){return!!(K.d.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures}get isPrePassCapable(){return!this.disableDepthWrite}getClassName(){return"PBRBaseMaterial"}get _disableAlphaBlending(){var v;return this._transparencyMode===d.PBRMATERIAL_OPAQUE||this._transparencyMode===d.PBRMATERIAL_ALPHATEST||(null===(v=this.subSurface)||void 0===v?void 0:v.disableAlphaBlending)}needAlphaBlending(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())}needAlphaTesting(){var v;return!!this._forceAlphaTest||(null===(v=this.subSurface)||void 0===v||!v.disableAlphaBlending)&&(this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===d.PBRMATERIAL_ALPHATEST))}_shouldUseAlphaFromAlbedoTexture(){return null!=this._albedoTexture&&this._albedoTexture.yd&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==d.PBRMATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._albedoTexture&&this._albedoTexture.yd||null!=this._opacityTexture}getAlphaTestTexture(){return this._albedoTexture}isReadyForSubMesh(v,T,X){this._uniformBufferLayoutBuilt||this.buildUniformLayout();const O=T._drawWrapper;if(O.effect&&this.isFrozen&&O._wasPreviouslyReady&&O._wasPreviouslyUsingInstances===X)return!0;T.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),T.materialDefines=new N(this._eventInfo.defineNames));const u=T.materialDefines;if(this._isReadyForSubMesh(T))return!0;const m=this.va(),A=m.getEngine();if(u._areTexturesDirty&&(this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,m.texturesEnabled)){if(this._albedoTexture&&K.d.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&K.d.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&K.d.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;const v=this._getReflectionTexture();if(v&&K.d.ReflectionTextureEnabled){if(!v.isReadyOrNotBlocking())return!1;var x;if(v.irradianceTexture){if(!v.irradianceTexture.isReadyOrNotBlocking())return!1}else if(!v.sphericalPolynomial&&null!==(x=v.getInternalTexture())&&void 0!==x&&x._sphericalPolynomialPromise)return!1}if(this._lightmapTexture&&K.d.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&K.d.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(K.d.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._metallicReflectanceTexture&&!this._metallicReflectanceTexture.isReadyOrNotBlocking())return!1;if(this._reflectanceTexture&&!this._reflectanceTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(A.getCaps().standardDerivatives&&this._bumpTexture&&K.d.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;if(this._environmentBRDFTexture&&K.d.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=u,this._eventInfo.subMesh=T,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(u._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;A.getCaps().standardDerivatives||v.isVerticesDataPresent(M.e.NormalKind)||(v.createNormals(!0),B.d.Warn("PBRMaterial: Normals have been created for the mesh: "+v.name));const f=T.effect,H=u._areLightsDisposed;let n=this._prepareEffect(v,u,this.onCompiled,this.onError,X,null,T.getRenderingMesh().hasThinInstances),V=!1;if(n)if(this._onEffectCreatedObservable&&(c.effect=n,c.subMesh=T,this._onEffectCreatedObservable.notifyObservers(c)),this.allowShaderHotSwapping&&f&&!n.isReady()){if(n=f,u.markAsUnprocessed(),V=this.isFrozen,H)return u._areLightsDisposed=!0,!1}else m.resetCachedMaterial(),T.setEffect(n,u,this._materialContext);return!(!T.effect||!T.effect.isReady())&&(u._renderId=m.getRenderId(),O._wasPreviouslyReady=!V,O._wasPreviouslyUsingInstances=!!X,this._checkScenePerformancePriority(),!0)}isMetallicWorkflow(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)}_prepareEffect(v,T){let O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,A=arguments.length>6?arguments[6]:void 0;if(this._prepareDefines(v,T,B,m,A),!T.isDirty)return null;T.markAsProcessed();const x=this.va().getEngine(),f=new p.d;let H=0;T.USESPHERICALINVERTEX&&f.addFallback(H++,"USESPHERICALINVERTEX"),T.FOG&&f.addFallback(H,"FOG"),T.SPECULARAA&&f.addFallback(H,"SPECULARAA"),T.POINTSIZE&&f.addFallback(H,"POINTSIZE"),T.LOGARITHMICDEPTH&&f.addFallback(H,"LOGARITHMICDEPTH"),T.PARALLAX&&f.addFallback(H,"PARALLAX"),T.PARALLAX_RHS&&f.addFallback(H,"PARALLAX_RHS"),T.PARALLAXOCCLUSION&&f.addFallback(H++,"PARALLAXOCCLUSION"),T.ENVIRONMENTBRDF&&f.addFallback(H++,"ENVIRONMENTBRDF"),T.TANGENT&&f.addFallback(H++,"TANGENT"),T.BUMP&&f.addFallback(H++,"BUMP"),H=(0,G.q)(T,f,this._maxSimultaneousLights,H++),T.SPECULARTERM&&f.addFallback(H++,"SPECULARTERM"),T.USESPHERICALFROMREFLECTIONMAP&&f.addFallback(H++,"USESPHERICALFROMREFLECTIONMAP"),T.USEIRRADIANCEMAP&&f.addFallback(H++,"USEIRRADIANCEMAP"),T.LIGHTMAP&&f.addFallback(H++,"LIGHTMAP"),T.NORMAL&&f.addFallback(H++,"NORMAL"),T.AMBIENT&&f.addFallback(H++,"AMBIENT"),T.EMISSIVE&&f.addFallback(H++,"EMISSIVE"),T.VERTEXCOLOR&&f.addFallback(H++,"VERTEXCOLOR"),T.MORPHTARGETS&&f.addFallback(H++,"MORPHTARGETS"),T.MULTIVIEW&&f.addFallback(0,"MULTIVIEW");const n=[M.e.PositionKind];T.NORMAL&&n.push(M.e.NormalKind),T.TANGENT&&n.push(M.e.TangentKind);for(let X=1;X<=6;++X)T["UV"+X]&&n.push(`uv${1===X?"":X}`);T.VERTEXCOLOR&&n.push(M.e.ColorKind),(0,G.w)(n,v,T,f),(0,G.z)(n,T),(0,G.A)(n,v,T),(0,G.t)(n,v,T);let V="pbr";const D=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vReflectionFilteringInfo","vMetallicReflectanceInfos","vReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","albedoMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","reflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vTangentSpaceParams","boneTextureWidth","vDebugMode","morphTargetTextureInfo","morphTargetTextureIndices"],F=["albedoSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler","reflectanceSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],b=["Material","Scene","Mesh"],l={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:T.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=f,this._eventInfo.fallbackRank=H,this._eventInfo.defines=T,this._eventInfo.uniforms=D,this._eventInfo.attributes=n,this._eventInfo.samplers=F,this._eventInfo.uniformBuffersNames=b,this._eventInfo.customCode=void 0,this._eventInfo.mesh=v,this._eventInfo.indexParameters=l,this._callbackPluginEventGeneric(128,this._eventInfo),C.d.AddUniformsAndSamplers(D,F),s.b.AddUniforms(D),s.b.AddSamplers(F),(0,t.c)(D),k.e&&(k.e.PrepareUniforms(D,T),k.e.PrepareSamplers(F,T)),(0,G.V)({uniformsNames:D,uniformBuffersNames:b,samplers:F,defines:T,maxSimultaneousLights:this._maxSimultaneousLights});const Q={};this.customShaderNameResolve&&(V=this.customShaderNameResolve(V,D,b,F,T,n,Q));const K=T.toString(),L=x.createEffect(V,{attributes:n,uniformsNames:D,uniformBuffersNames:b,samplers:F,defines:K,fallbacks:f,onCompiled:O,onError:u,indexParameters:l,processFinalCode:Q.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:T.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this.shaderLanguage?await Promise.all([Promise.all([X.e(15),X.e(44)]).then(X.bind(X,13209)),Promise.all([X.e(16),X.e(45)]).then(X.bind(X,13227))]):await Promise.all([Promise.all([X.e(21),X.e(46)]).then(X.bind(X,13230)),Promise.all([X.e(23),X.e(47)]).then(X.bind(X,13242))]),this._shadersLoaded=!0}},x);return this._eventInfo.customCode=void 0,L}_prepareDefines(v,T){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,u=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const B=this.va(),m=B.getEngine();(0,G.I)(B,v,T,!0,this._maxSimultaneousLights,this._disableLighting),T._needNormals=!0,(0,G.N)(B,T);const A=this.needAlphaBlendingForMesh(v)&&this.va().useOrderIndependentTransparency;if((0,G.R)(B,T,this.canRenderToMRT&&!A),(0,G.P)(B,T,A),C.d.PrepareDefines(m.currentRenderPassId,v,T),T.METALLICWORKFLOW=this.isMetallicWorkflow(),T._areTexturesDirty){T._needUVs=!1;for(let v=1;v<=6;++v)T["MAINUV"+v]=!1;if(B.texturesEnabled){T.ALBEDODIRECTUV=0,T.AMBIENTDIRECTUV=0,T.OPACITYDIRECTUV=0,T.EMISSIVEDIRECTUV=0,T.REFLECTIVITYDIRECTUV=0,T.MICROSURFACEMAPDIRECTUV=0,T.METALLIC_REFLECTANCEDIRECTUV=0,T.REFLECTANCEDIRECTUV=0,T.BUMPDIRECTUV=0,T.LIGHTMAPDIRECTUV=0,m.getCaps().textureLOD&&(T.LODBASEDMICROSFURACE=!0),this._albedoTexture&&K.d.DiffuseTextureEnabled?((0,G.J)(this._albedoTexture,T,"ALBEDO"),T.GAMMAALBEDO=this._albedoTexture.gammaSpace):T.ALBEDO=!1,this._ambientTexture&&K.d.AmbientTextureEnabled?((0,G.J)(this._ambientTexture,T,"AMBIENT"),T.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):T.AMBIENT=!1,this._opacityTexture&&K.d.OpacityTextureEnabled?((0,G.J)(this._opacityTexture,T,"OPACITY"),T.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):T.OPACITY=!1;const v=this._getReflectionTexture();if(v&&K.d.ReflectionTextureEnabled){switch(T.REFLECTION=!0,T.GAMMAREFLECTION=v.gammaSpace,T.RGBDREFLECTION=v.isRGBD,T.LODINREFLECTIONALPHA=v.lodLevelInAlpha,T.LINEARSPECULARREFLECTION=v.linearSpecularLOD,this.realTimeFiltering&&this.realTimeFilteringQuality>0?(T.NUM_SAMPLES=""+this.realTimeFilteringQuality,m._features.needTypeSuffixInShaderConstants&&(T.NUM_SAMPLES=T.NUM_SAMPLES+"u"),T.REALTIME_FILTERING=!0):T.REALTIME_FILTERING=!1,T.INVERTCUBICMAP=v.coordinatesMode===Q.e.INVCUBIC_MODE,T.REFLECTIONMAP_3D=v.isCube,T.REFLECTIONMAP_OPPOSITEZ=T.REFLECTIONMAP_3D&&this.va().useRightHandedSystem?!v.invertZ:v.invertZ,T.REFLECTIONMAP_CUBIC=!1,T.REFLECTIONMAP_EXPLICIT=!1,T.REFLECTIONMAP_PLANAR=!1,T.REFLECTIONMAP_PROJECTION=!1,T.REFLECTIONMAP_SKYBOX=!1,T.REFLECTIONMAP_SPHERICAL=!1,T.REFLECTIONMAP_EQUIRECTANGULAR=!1,T.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,T.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,v.coordinatesMode){case Q.e.EXPLICIT_MODE:T.REFLECTIONMAP_EXPLICIT=!0;break;case Q.e.PLANAR_MODE:T.REFLECTIONMAP_PLANAR=!0;break;case Q.e.PROJECTION_MODE:T.REFLECTIONMAP_PROJECTION=!0;break;case Q.e.SKYBOX_MODE:T.REFLECTIONMAP_SKYBOX=!0;break;case Q.e.SPHERICAL_MODE:T.REFLECTIONMAP_SPHERICAL=!0;break;case Q.e.EQUIRECTANGULAR_MODE:T.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case Q.e.FIXED_EQUIRECTANGULAR_MODE:T.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case Q.e.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:T.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case Q.e.CUBIC_MODE:case Q.e.INVCUBIC_MODE:default:T.REFLECTIONMAP_CUBIC=!0,T.USE_LOCAL_REFLECTIONMAP_CUBIC=!!v.boundingBoxSize}v.coordinatesMode!==Q.e.SKYBOX_MODE&&(v.irradianceTexture?(T.USEIRRADIANCEMAP=!0,T.USESPHERICALFROMREFLECTIONMAP=!1):v.isCube&&(T.USESPHERICALFROMREFLECTIONMAP=!0,T.USEIRRADIANCEMAP=!1,this._forceIrradianceInFragment||this.realTimeFiltering||this._twoSidedLighting||m.getCaps().maxVaryingVectors<=8?T.USESPHERICALINVERTEX=!1:T.USESPHERICALINVERTEX=!0))}else T.REFLECTION=!1,T.REFLECTIONMAP_3D=!1,T.REFLECTIONMAP_SPHERICAL=!1,T.REFLECTIONMAP_PLANAR=!1,T.REFLECTIONMAP_CUBIC=!1,T.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,T.REFLECTIONMAP_PROJECTION=!1,T.REFLECTIONMAP_SKYBOX=!1,T.REFLECTIONMAP_EXPLICIT=!1,T.REFLECTIONMAP_EQUIRECTANGULAR=!1,T.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,T.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,T.INVERTCUBICMAP=!1,T.USESPHERICALFROMREFLECTIONMAP=!1,T.USEIRRADIANCEMAP=!1,T.USESPHERICALINVERTEX=!1,T.REFLECTIONMAP_OPPOSITEZ=!1,T.LODINREFLECTIONALPHA=!1,T.GAMMAREFLECTION=!1,T.RGBDREFLECTION=!1,T.LINEARSPECULARREFLECTION=!1;this._lightmapTexture&&K.d.LightmapTextureEnabled?((0,G.J)(this._lightmapTexture,T,"LIGHTMAP"),T.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,T.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,T.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):T.LIGHTMAP=!1,this._emissiveTexture&&K.d.EmissiveTextureEnabled?((0,G.J)(this._emissiveTexture,T,"EMISSIVE"),T.GAMMAEMISSIVE=this._emissiveTexture.gammaSpace):T.EMISSIVE=!1,K.d.SpecularTextureEnabled?(this._metallicTexture?((0,G.J)(this._metallicTexture,T,"REFLECTIVITY"),T.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,T.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,T.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,T.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed,T.REFLECTIVITY_GAMMA=!1):this._reflectivityTexture?((0,G.J)(this._reflectivityTexture,T,"REFLECTIVITY"),T.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,T.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap,T.REFLECTIVITY_GAMMA=this._reflectivityTexture.gammaSpace):T.REFLECTIVITY=!1,this._metallicReflectanceTexture||this._reflectanceTexture?(T.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=this._useOnlyMetallicFromMetallicReflectanceTexture,this._metallicReflectanceTexture?((0,G.J)(this._metallicReflectanceTexture,T,"METALLIC_REFLECTANCE"),T.METALLIC_REFLECTANCE_GAMMA=this._metallicReflectanceTexture.gammaSpace):T.METALLIC_REFLECTANCE=!1,this._reflectanceTexture&&(!this._metallicReflectanceTexture||this._metallicReflectanceTexture&&this._useOnlyMetallicFromMetallicReflectanceTexture)?((0,G.J)(this._reflectanceTexture,T,"REFLECTANCE"),T.REFLECTANCE_GAMMA=this._reflectanceTexture.gammaSpace):T.REFLECTANCE=!1):(T.METALLIC_REFLECTANCE=!1,T.REFLECTANCE=!1),this._microSurfaceTexture?(0,G.J)(this._microSurfaceTexture,T,"MICROSURFACEMAP"):T.MICROSURFACEMAP=!1):(T.REFLECTIVITY=!1,T.MICROSURFACEMAP=!1),m.getCaps().standardDerivatives&&this._bumpTexture&&K.d.BumpTextureEnabled&&!this._disableBumpMap?((0,G.J)(this._bumpTexture,T,"BUMP"),this._useParallax&&this._albedoTexture&&K.d.DiffuseTextureEnabled?(T.PARALLAX=!0,T.PARALLAX_RHS=B.useRightHandedSystem,T.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):T.PARALLAX=!1,T.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):(T.BUMP=!1,T.PARALLAX=!1,T.PARALLAX_RHS=!1,T.PARALLAXOCCLUSION=!1,T.OBJECTSPACE_NORMALMAP=!1),this._environmentBRDFTexture&&K.d.ReflectionTextureEnabled?(T.ENVIRONMENTBRDF=!0,T.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(T.ENVIRONMENTBRDF=!1,T.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?T.ALPHAFROMALBEDO=!0:T.ALPHAFROMALBEDO=!1}T.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===d.LIGHTFALLOFF_STANDARD?(T.USEPHYSICALLIGHTFALLOFF=!1,T.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===d.LIGHTFALLOFF_GLTF?(T.USEPHYSICALLIGHTFALLOFF=!1,T.USEGLTFLIGHTFALLOFF=!0):(T.USEPHYSICALLIGHTFALLOFF=!0,T.USEGLTFLIGHTFALLOFF=!1),T.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.Xe&&this._twoSidedLighting?T.TWOSIDEDLIGHTING=!0:T.TWOSIDEDLIGHTING=!1,T.SPECULARAA=m.getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(T._areTexturesDirty||T._areMiscDirty)&&(T.ALPHATESTVALUE=`${this._alphaCutOff}${this._alphaCutOff%1===0?".":""}`,T.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,T.ALPHABLEND=this.needAlphaBlendingForMesh(v),T.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,T.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),T._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(T),T.FORCENORMALFORWARD=this._forceNormalForward,T.RADIANCEOCCLUSION=this._useRadianceOcclusion,T.HORIZONOCCLUSION=this._useHorizonOcclusion,T._areMiscDirty&&((0,G.L)(v,B,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(v)||this._forceAlphaTest,T,this._applyDecalMapAfterDetailMap),T.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!v.isVerticesDataPresent(M.e.NormalKind),T.DEBUGMODE=this._debugMode),(0,G.H)(B,m,this,T,!!X,O,u),this._eventInfo.defines=T,this._eventInfo.mesh=v,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,G.E)(v,T,!0,!0,!0,this._transparencyMode!==d.PBRMATERIAL_OPAQUE),this._callbackPluginEventPrepareDefines(this._eventInfo)}forceCompilation(v,T,X){const O={clipPlane:!1,useInstances:!1,...X};this._uniformBufferLayoutBuilt||this.buildUniformLayout(),this._callbackPluginEventGeneric(4,this._eventInfo);(()=>{if(this._breakShaderLoadedCheck)return;const X=new N(this._eventInfo.defineNames),u=this._prepareEffect(v,X,void 0,void 0,O.useInstances,O.clipPlane,v.hasThinInstances);this._onEffectCreatedObservable&&(c.effect=u,c.subMesh=null,this._onEffectCreatedObservable.notifyObservers(c)),u.isReady()?T&&T(this):u.onCompileObservable.add((()=>{T&&T(this)}))})()}buildUniformLayout(){const v=this._uniformBuffer;v.addUniform("vAlbedoInfos",2),v.addUniform("vAmbientInfos",4),v.addUniform("vOpacityInfos",2),v.addUniform("vEmissiveInfos",2),v.addUniform("vLightmapInfos",2),v.addUniform("vReflectivityInfos",3),v.addUniform("vMicroSurfaceSamplerInfos",2),v.addUniform("vReflectionInfos",2),v.addUniform("vReflectionFilteringInfo",2),v.addUniform("vReflectionPosition",3),v.addUniform("vReflectionSize",3),v.addUniform("vBumpInfos",3),v.addUniform("albedoMatrix",16),v.addUniform("ambientMatrix",16),v.addUniform("opacityMatrix",16),v.addUniform("emissiveMatrix",16),v.addUniform("lightmapMatrix",16),v.addUniform("reflectivityMatrix",16),v.addUniform("microSurfaceSamplerMatrix",16),v.addUniform("bumpMatrix",16),v.addUniform("vTangentSpaceParams",2),v.addUniform("reflectionMatrix",16),v.addUniform("vReflectionColor",3),v.addUniform("vAlbedoColor",4),v.addUniform("vLightingIntensity",4),v.addUniform("vReflectionMicrosurfaceInfos",3),v.addUniform("pointSize",1),v.addUniform("vReflectivityColor",4),v.addUniform("vEmissiveColor",3),v.addUniform("vAmbientColor",3),v.addUniform("vDebugMode",2),v.addUniform("vMetallicReflectanceFactors",4),v.addUniform("vMetallicReflectanceInfos",2),v.addUniform("metallicReflectanceMatrix",16),v.addUniform("vReflectanceInfos",2),v.addUniform("reflectanceMatrix",16),v.addUniform("vSphericalL00",3),v.addUniform("vSphericalL1_1",3),v.addUniform("vSphericalL10",3),v.addUniform("vSphericalL11",3),v.addUniform("vSphericalL2_2",3),v.addUniform("vSphericalL2_1",3),v.addUniform("vSphericalL20",3),v.addUniform("vSphericalL21",3),v.addUniform("vSphericalL22",3),v.addUniform("vSphericalX",3),v.addUniform("vSphericalY",3),v.addUniform("vSphericalZ",3),v.addUniform("vSphericalXX_ZZ",3),v.addUniform("vSphericalYY_ZZ",3),v.addUniform("vSphericalZZ",3),v.addUniform("vSphericalXY",3),v.addUniform("vSphericalYZ",3),v.addUniform("vSphericalZX",3),super.buildUniformLayout()}bindForSubMesh(v,T,X){const O=this.va(),u=X.materialDefines;if(!u)return;const B=X.effect;if(!B)return;this._activeEffect=B,T.getMeshUniformBuffer().bindToEffect(B,"Mesh"),T.transferToEffect(v);const m=O.getEngine();this._uniformBuffer.bindToEffect(B,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,O,T,v,this.isFrozen),C.d.Bind(m.currentRenderPassId,this._activeEffect,T,v),this._eventInfo.subMesh=X,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),u.OBJECTSPACE_NORMALMAP&&(v.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const A=this._mustRebind(O,B,X,T.visibility);(0,G.c)(T,this._activeEffect,this.prePassConfiguration);let f=null;const M=this._uniformBuffer;if(A){if(this.bindViewProjection(B),f=this._getReflectionTexture(),!M.useUbo||!this.isFrozen||!M.isSync||X._drawWrapper._forceRebindOnNextCall){var H;if(O.texturesEnabled){if(this._albedoTexture&&K.d.DiffuseTextureEnabled&&(M.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),(0,G.p)(this._albedoTexture,M,"albedo")),this._ambientTexture&&K.d.AmbientTextureEnabled&&(M.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),(0,G.p)(this._ambientTexture,M,"ambient")),this._opacityTexture&&K.d.OpacityTextureEnabled&&(M.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,G.p)(this._opacityTexture,M,"opacity")),f&&K.d.ReflectionTextureEnabled){if(M.ne("reflectionMatrix",f.getReflectionTextureMatrix()),M.updateFloat2("vReflectionInfos",f.level,0),f.boundingBoxSize){const v=f;M.updateVector3("vReflectionPosition",v.boundingBoxPosition),M.updateVector3("vReflectionSize",v.boundingBoxSize)}if(this.realTimeFiltering){const v=f.getSize().width;M.updateFloat2("vReflectionFilteringInfo",v,Math.log2(v))}if(!u.USEIRRADIANCEMAP){const v=f.sphericalPolynomial;if(u.USESPHERICALFROMREFLECTIONMAP&&v)if(u.SPHERICAL_HARMONICS){const T=v.preScaledHarmonics;M.updateVector3("vSphericalL00",T.l00),M.updateVector3("vSphericalL1_1",T.l1_1),M.updateVector3("vSphericalL10",T.l10),M.updateVector3("vSphericalL11",T.l11),M.updateVector3("vSphericalL2_2",T.l2_2),M.updateVector3("vSphericalL2_1",T.l2_1),M.updateVector3("vSphericalL20",T.l20),M.updateVector3("vSphericalL21",T.l21),M.updateVector3("vSphericalL22",T.l22)}else M.updateFloat3("vSphericalX",v.x.x,v.x.y,v.x.z),M.updateFloat3("vSphericalY",v.y.x,v.y.y,v.y.z),M.updateFloat3("vSphericalZ",v.z.x,v.z.y,v.z.z),M.updateFloat3("vSphericalXX_ZZ",v.xx.x-v.zz.x,v.xx.y-v.zz.y,v.xx.z-v.zz.z),M.updateFloat3("vSphericalYY_ZZ",v.yy.x-v.zz.x,v.yy.y-v.zz.y,v.yy.z-v.zz.z),M.updateFloat3("vSphericalZZ",v.zz.x,v.zz.y,v.zz.z),M.updateFloat3("vSphericalXY",v.xy.x,v.xy.y,v.xy.z),M.updateFloat3("vSphericalYZ",v.yz.x,v.yz.y,v.yz.z),M.updateFloat3("vSphericalZX",v.zx.x,v.zx.y,v.zx.z)}M.updateFloat3("vReflectionMicrosurfaceInfos",f.getSize().width,f.lodGenerationScale,f.lodGenerationOffset)}this._emissiveTexture&&K.d.EmissiveTextureEnabled&&(M.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,G.p)(this._emissiveTexture,M,"emissive")),this._lightmapTexture&&K.d.LightmapTextureEnabled&&(M.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,G.p)(this._lightmapTexture,M,"lightmap")),K.d.SpecularTextureEnabled&&(this._metallicTexture?(M.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),(0,G.p)(this._metallicTexture,M,"reflectivity")):this._reflectivityTexture&&(M.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),(0,G.p)(this._reflectivityTexture,M,"reflectivity")),this._metallicReflectanceTexture&&(M.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level),(0,G.p)(this._metallicReflectanceTexture,M,"metallicReflectance")),this._reflectanceTexture&&u.REFLECTANCE&&(M.updateFloat2("vReflectanceInfos",this._reflectanceTexture.coordinatesIndex,this._reflectanceTexture.level),(0,G.p)(this._reflectanceTexture,M,"reflectance")),this._microSurfaceTexture&&(M.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),(0,G.p)(this._microSurfaceTexture,M,"microSurfaceSampler"))),this._bumpTexture&&m.getCaps().standardDerivatives&&K.d.BumpTextureEnabled&&!this._disableBumpMap&&(M.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),(0,G.p)(this._bumpTexture,M,"bump"),O._mirroredCameraPosition?M.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):M.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&M.updateFloat("pointSize",this.pointSize),u.METALLICWORKFLOW){var n;F.k.he[0].r=void 0===this._metallic||null===this._metallic?1:this._metallic,F.k.he[0].g=void 0===this._roughness||null===this._roughness?1:this._roughness,M.updateColor4("vReflectivityColor",F.k.he[0],1);const v=(null===(n=this.subSurface)||void 0===n?void 0:n._indexOfRefraction)??1.5,T=1,X=Math.pow((v-T)/(v+T),2);this._metallicReflectanceColor.scaleToRef(X*this._metallicF0Factor,F.k.he[0]);const O=this._metallicF0Factor;M.updateColor4("vMetallicReflectanceFactors",F.k.he[0],O)}else M.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);M.updateColor3("vEmissiveColor",K.d.EmissiveTextureEnabled?this._emissiveColor:F.d.BlackReadOnly),M.updateColor3("vReflectionColor",this._reflectionColor),!u.SS_REFRACTION&&null!==(H=this.subSurface)&&void 0!==H&&H._linkRefractionWithTransparency?M.updateColor4("vAlbedoColor",this._albedoColor,1):M.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*O.environmentIntensity,this._lightingInfos.w=this._specularIntensity,M.updateVector4("vLightingIntensity",this._lightingInfos),O.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor),M.updateColor3("vAmbientColor",this._globalAmbientColor),M.updateFloat2("vDebugMode",this.debugLimit,this.debugFactor)}O.texturesEnabled&&(this._albedoTexture&&K.d.DiffuseTextureEnabled&&M.setTexture("albedoSampler",this._albedoTexture),this._ambientTexture&&K.d.AmbientTextureEnabled&&M.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&K.d.OpacityTextureEnabled&&M.setTexture("opacitySampler",this._opacityTexture),f&&K.d.ReflectionTextureEnabled&&(u.LODBASEDMICROSFURACE?M.setTexture("reflectionSampler",f):(M.setTexture("reflectionSampler",f._lodTextureMid||f),M.setTexture("reflectionSamplerLow",f._lodTextureLow||f),M.setTexture("reflectionSamplerHigh",f._lodTextureHigh||f)),u.USEIRRADIANCEMAP&&M.setTexture("irradianceSampler",f.irradianceTexture)),u.ENVIRONMENTBRDF&&M.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&K.d.EmissiveTextureEnabled&&M.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&K.d.LightmapTextureEnabled&&M.setTexture("lightmapSampler",this._lightmapTexture),K.d.SpecularTextureEnabled&&(this._metallicTexture?M.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&M.setTexture("reflectivitySampler",this._reflectivityTexture),this._metallicReflectanceTexture&&M.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture),this._reflectanceTexture&&u.REFLECTANCE&&M.setTexture("reflectanceSampler",this._reflectanceTexture),this._microSurfaceTexture&&M.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&m.getCaps().standardDerivatives&&K.d.BumpTextureEnabled&&!this._disableBumpMap&&M.setTexture("bumpSampler",this._bumpTexture)),this.va().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(T)&&this.va().depthPeelingRenderer.bind(B),this._eventInfo.subMesh=X,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,t.g)(this._activeEffect,this,O),this.bindEyePosition(B)}else O.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(A||!this.isFrozen){var V;if(O.lightsEnabled&&!this._disableLighting&&(0,G.f)(O,T,this._activeEffect,u,this._maxSimultaneousLights),(O.fogEnabled&&T.applyFog&&O.fogMode!==x.e.FOGMODE_NONE||f||this.subSurface.refractionTexture||T.receiveShadows||u.PREPASS)&&this.bindView(B),(0,G.e)(O,T,this._activeEffect,!0),u.NUM_MORPH_INFLUENCERS&&(0,G.m)(T,this._activeEffect),u.BAKED_VERTEX_ANIMATION_TEXTURE)null===(V=T.bakedVertexAnimationManager)||void 0===V||V.bind(B,u.INSTANCES);this._imageProcessingConfiguration.bind(this._activeEffect),(0,G.i)(u,this._activeEffect,O)}this._afterBind(T,this._activeEffect,X),M.update()}getAnimatables(){const v=super.getAnimatables();return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&v.push(this._albedoTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&v.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&v.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&v.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&v.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?v.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&v.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&v.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&v.push(this._lightmapTexture),this._metallicReflectanceTexture&&this._metallicReflectanceTexture.animations&&this._metallicReflectanceTexture.animations.length>0&&v.push(this._metallicReflectanceTexture),this._reflectanceTexture&&this._reflectanceTexture.animations&&this._reflectanceTexture.animations.length>0&&v.push(this._reflectanceTexture),this._microSurfaceTexture&&this._microSurfaceTexture.animations&&this._microSurfaceTexture.animations.length>0&&v.push(this._microSurfaceTexture),v}_getReflectionTexture(){return this._reflectionTexture?this._reflectionTexture:this.va().environmentTexture}getActiveTextures(){const v=super.getActiveTextures();return this._albedoTexture&&v.push(this._albedoTexture),this._ambientTexture&&v.push(this._ambientTexture),this._opacityTexture&&v.push(this._opacityTexture),this._reflectionTexture&&v.push(this._reflectionTexture),this._emissiveTexture&&v.push(this._emissiveTexture),this._reflectivityTexture&&v.push(this._reflectivityTexture),this._metallicTexture&&v.push(this._metallicTexture),this._metallicReflectanceTexture&&v.push(this._metallicReflectanceTexture),this._reflectanceTexture&&v.push(this._reflectanceTexture),this._microSurfaceTexture&&v.push(this._microSurfaceTexture),this._bumpTexture&&v.push(this._bumpTexture),this._lightmapTexture&&v.push(this._lightmapTexture),v}hasTexture(v){return!!super.hasTexture(v)||(this._albedoTexture===v||(this._ambientTexture===v||(this._opacityTexture===v||(this._reflectionTexture===v||(this._emissiveTexture===v||(this._reflectivityTexture===v||(this._metallicTexture===v||(this._metallicReflectanceTexture===v||(this._reflectanceTexture===v||(this._microSurfaceTexture===v||(this._bumpTexture===v||this._lightmapTexture===v)))))))))))}setPrePassRenderer(){var v;if(null===(v=this.subSurface)||void 0===v||!v.isScatteringEnabled)return!1;const T=this.va().enableSubSurfaceForPrePass();return T&&(T.enabled=!0),!0}dispose(v,T){var X,O,u,B,m,A,x,f,M,H,n,V;(this._breakShaderLoadedCheck=!0,T)&&(this._environmentBRDFTexture&&this.va().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),null===(X=this._albedoTexture)||void 0===X||X.dispose(),null===(O=this._ambientTexture)||void 0===O||O.dispose(),null===(u=this._opacityTexture)||void 0===u||u.dispose(),null===(B=this._reflectionTexture)||void 0===B||B.dispose(),null===(m=this._emissiveTexture)||void 0===m||m.dispose(),null===(A=this._metallicTexture)||void 0===A||A.dispose(),null===(x=this._reflectivityTexture)||void 0===x||x.dispose(),null===(f=this._bumpTexture)||void 0===f||f.dispose(),null===(M=this._lightmapTexture)||void 0===M||M.dispose(),null===(H=this._metallicReflectanceTexture)||void 0===H||H.dispose(),null===(n=this._reflectanceTexture)||void 0===n||n.dispose(),null===(V=this._microSurfaceTexture)||void 0===V||V.dispose());this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(v,T)}}d.PBRMATERIAL_OPAQUE=b.d.MATERIAL_OPAQUE,d.PBRMATERIAL_ALPHATEST=b.d.MATERIAL_ALPHATEST,d.PBRMATERIAL_ALPHABLEND=b.d.MATERIAL_ALPHABLEND,d.PBRMATERIAL_ALPHATESTANDBLEND=b.d.MATERIAL_ALPHATESTANDBLEND,d.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,d.LIGHTFALLOFF_PHYSICAL=0,d.LIGHTFALLOFF_GLTF=1,d.LIGHTFALLOFF_STANDARD=2,d.ForceGLSL=!1,(0,O.c)([(0,u.p)()],d.prototype,"_imageProcessingConfiguration",void 0),(0,O.c)([(0,u.e)("_markAllSubMeshesAsMiscDirty")],d.prototype,"debugMode",void 0)},12578:(v,T,X)=>{"use strict";X.d(T,{b:()=>n});var O=X(985),u=X(994),B=X(1217),m=X(1006),A=X(1047),x=X(978),f=X(1023),M=X(1001),H=X(1156);X(1550);class n extends A.d{set boundingBoxSize(v){if(this._boundingBoxSize&&this._boundingBoxSize.equals(v))return;this._boundingBoxSize=v;const T=this.va();T&&T.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(v){this._rotationY=v,this.setReflectionTextureMatrix(m.b.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(v,T,X){let O="";return v.forEach((v=>O+=v)),new n(O,T,null,X,v)}static CreateFromPrefilteredData(v,T){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,O=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const u=T.useDelayedTextureLoading;T.useDelayedTextureLoading=!1;const B=new n(v,T,null,!1,null,null,null,void 0,!0,X,O);return T.useDelayedTextureLoading=u,B}constructor(v,T){var X;let O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,u=arguments.length>3&&void 0!==arguments[3]&&arguments[3],B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,A=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,f=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,H=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,n=arguments.length>8&&void 0!==arguments[8]&&arguments[8],V=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,D=arguments.length>10&&void 0!==arguments[10]&&arguments[10],s=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,F=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,k=arguments.length>13?arguments[13]:void 0,b=arguments.length>14?arguments[14]:void 0;super(T),this.onLoadObservable=new M.b,this.boundingBoxPosition=m.l.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new m.b,this._buffer=null,this.name=v,this.url=v,this._noMipmap=u,this.yd=!1,this.isCube=!0,this._textureMatrix=m.b.Identity(),this.coordinatesMode=x.e.CUBIC_MODE;let l=null,Q=null;null===O||Array.isArray(O)?(this._noMipmap=u,this._format=H,this._createPolynomials=D,l=O,this._loaderOptions=k,this._useSRGBBuffer=b,this._lodScale=s,this._lodOffset=F):(l=O.extensions??null,this._noMipmap=O.noMipmap??!1,B=O.files??null,Q=O.buffer??null,this._format=O.format??5,n=O.prefiltered??!1,V=O.forcedExtension??null,this._createPolynomials=O.createPolynomials??!1,this._lodScale=O.lodScale??.8,this._lodOffset=O.lodOffset??0,this._loaderOptions=O.loaderOptions,this._useSRGBBuffer=O.useSRGBBuffer,A=O.X??null,f=O.onError??null),(v||B)&&this.updateURL(v,V,A,n,f,l,null===(X=this.va())||void 0===X?void 0:X.useDelayedTextureLoading,B,Q)}getClassName(){return"CubeTexture"}updateURL(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,O=arguments.length>3&&void 0!==arguments[3]&&arguments[3],u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,m=arguments.length>6&&void 0!==arguments[6]&&arguments[6],A=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,x=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=v),this.url=v,T&&(this._forcedExtension=T);const f=v.lastIndexOf("."),M=T||(f>-1?v.substring(f).toLowerCase():""),H=0===M.indexOf(".dds"),n=0===M.indexOf(".env"),V=0===M.indexOf(".basis");if(n?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=O,O&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),A)this._files=A;else if(V||n||H||B||(B=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,B){for(let T=0;T<B.length;T++)this._files.push(v+B[T]);this._extensions=B}this._buffer=x,m?(this.delayLoadState=4,this._delayedOnLoad=X,this._delayedOnError=u):this._loadTexture(X,u)}delayLoad(v){4===this.delayLoadState&&(v&&(this._forcedExtension=v),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(v){var T,X;if(v.updateFlag===this._textureMatrix.updateFlag)return;v.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(X=this.va())||void 0===X||X.markAllMaterialsAsDirty(1,(v=>-1!==v.getActiveTextures().indexOf(this))));if(this._textureMatrix=v,null===(T=this.va())||void 0===T||!T.useRightHandedSystem)return;const O=m.g.Vd[0],u=m.g.Quaternion[0],B=m.g.Vd[1];this._textureMatrix.decompose(O,u,B),u.z*=-1,u.w*=-1,m.b.ComposeToRef(O,u,B,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var v;return null!==(v=this.va())&&void 0!==v&&v.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const X=this.va(),O=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const u=()=>{var T;(this.onLoadObservable.notifyObservers(this),O)&&(O.dispose(),null===(T=this.va())||void 0===T||T.markAllMaterialsAsDirty(1));v&&v()},m=(v,X)=>{this._loadingError=!0,this._errorObject={message:v,exception:X},T&&T(v,X),x.e.OnTextureLoadErrorObservable.notifyObservers(this)};var A;this._texture?this._texture.isReady?B.c.SetImmediate((()=>u())):this._texture.onLoadedObservable.add((()=>u())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,X,this._lodScale,this._lodOffset,v,m,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,X,this._files,this._noMipmap,v,m,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(A=this._texture)||void 0===A||A.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(v,T,X){const O=H.e.Parse((()=>{let O=!1;return v.prefiltered&&(O=v.prefiltered),new n(X+(v.url??v.name),T,v.extensions,!1,v.files||null,null,null,void 0,O,v.forcedExtension)}),v,T);if(v.boundingBoxPosition&&(O.boundingBoxPosition=m.l.Ld(v.boundingBoxPosition)),v.boundingBoxSize&&(O.boundingBoxSize=m.l.Ld(v.boundingBoxSize)),v.animations)for(let u=0;u<v.animations.length;u++){const T=v.animations[u],X=(0,f.c)("BABYLON.Animation");X&&O.animations.push(X.Parse(T))}return O}clone(){let v=0;const T=H.e.Clone((()=>{const T=new n(this.url,this.va()||this._getEngine(),this._extensions,this._noMipmap,this._files);return v=T.uniqueId,T}),this);return T.uniqueId=v,T}}(0,O.c)([(0,u.G)()],n.prototype,"url",void 0),(0,O.c)([(0,u.E)()],n.prototype,"boundingBoxPosition",void 0),(0,O.c)([(0,u.E)()],n.prototype,"boundingBoxSize",null),(0,O.c)([(0,u.G)("rotationY")],n.prototype,"rotationY",null),(0,O.c)([(0,u.G)("files")],n.prototype,"_files",void 0),(0,O.c)([(0,u.G)("forcedExtension")],n.prototype,"_forcedExtension",void 0),(0,O.c)([(0,u.G)("extensions")],n.prototype,"_extensions",void 0),(0,O.c)([(0,u.t)("textureMatrix")],n.prototype,"_textureMatrix",void 0),(0,O.c)([(0,u.t)("textureMatrixRefraction")],n.prototype,"_textureMatrixRefraction",void 0),x.e._CubeTextureParser=n.Parse,(0,f.f)("BABYLON.CubeTexture",n)},12942:(v,T,X)=>{"use strict";X.d(T,{e:()=>x});var O=X(1103),u=X(978),B=X(1227),m=X(1443),A=X(1140);m.ThinEngine.prototype.createDynamicTexture=function(v,T,X,O){const u=new A.d(this,4);return u.baseWidth=v,u.baseHeight=T,X&&(v=this.needPOTTextures?(0,B.f)(v,this._caps.maxTextureSize):v,T=this.needPOTTextures?(0,B.f)(T,this._caps.maxTextureSize):T),u.width=v,u.height=T,u.isReady=!1,u.generateMipMaps=X,u.samplingMode=O,this.updateTextureSamplingMode(O,u),this._internalTexturesCache.push(u),u},m.ThinEngine.prototype.updateDynamicTexture=function(v,T,X){let O=arguments.length>3&&void 0!==arguments[3]&&arguments[3],u=arguments.length>4?arguments[4]:void 0,B=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!v)return;const m=this._gl,A=m.TEXTURE_2D,x=this._bindTextureDirectly(A,v,!0,B);this._unpackFlipY(void 0===X?v.invertY:X),O&&m.pixelStorei(m.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const f=this._getWebGLTextureType(v.type),M=this._getInternalFormat(u||v.format),H=this._getRGBABufferInternalSizedFormat(v.type,M);m.texImage2D(A,0,H,M,f,T),v.generateMipMaps&&m.generateMipmap(A),x||this._bindTextureDirectly(A,null),O&&m.pixelStorei(m.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),u&&(v.format=u),v._dynamicTextureSource=T,v._premulAlpha=O,v.invertY=X||!1,v.isReady=!0};class x extends u.e{constructor(v,T,X){let O=arguments.length>3&&void 0!==arguments[3]&&arguments[3],B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,A=arguments.length>6?arguments[6]:void 0;const x=!X||X._isScene;super(null,x?X:null===X||void 0===X?void 0:X.Fe,x?!O:X,A,B,void 0,void 0,void 0,void 0,m),this.name=v,this.wrapU=u.e.CLAMP_ADDRESSMODE,this.wrapV=u.e.CLAMP_ADDRESSMODE,this._generateMipMaps=O;const f=this._getEngine();if(!f)return;if(T.getContext)this._canvas=T,this._ownCanvas=!1,this._texture=f.createDynamicTexture(this._canvas.width,this._canvas.height,O,B);else{this._canvas=f.createCanvas(1,1),this._ownCanvas=!0;const v=T;v.width||0===v.width?this._texture=f.createDynamicTexture(v.width,v.height,O,B):this._texture=f.createDynamicTexture(T,T,O,B)}const M=this.getSize();this._canvas.width!==M.width&&(this._canvas.width=M.width),this._canvas.height!==M.height&&(this._canvas.height=M.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(v){this._canvas.width=v.width,this._canvas.height=v.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(v.width,v.height,this._generateMipMaps,this.samplingMode)}scale(v){const T=this.getSize();T.width*=v,T.height*=v,this._recreate(T)}scaleTo(v,T){const X=this.getSize();X.width=v,X.height=T,this._recreate(X)}getContext(){return this._context}clear(v){const T=this.getSize();v&&(this._context.fillStyle=v),this._context.clearRect(0,0,T.width,T.height)}update(v){let T=arguments.length>1&&void 0!==arguments[1]&&arguments[1],X=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===v||v,T,this._format||void 0,void 0,X)}drawText(v,T,X,O,u,B,m){let A=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const x=this.getSize();if(B&&(this._context.fillStyle=B,this._context.fillRect(0,0,x.width,x.height)),this._context.font=O,null===T||void 0===T){const X=this._context.measureText(v);T=(x.width-X.width)/2}if(null===X||void 0===X){const v=parseInt(O.replace(/\D/g,""));X=x.height/2+v/3.65}this._context.fillStyle=u||"",this._context.fillText(v,T,X),A&&this.update(m)}dispose(){var v,T;(super.dispose(),this._ownCanvas)&&(null===(v=this._canvas)||void 0===v||null===(T=v.remove)||void 0===T||T.call(v));this._canvas=null,this._context=null}clone(){const v=this.va();if(!v)return this;const T=this.getSize(),X=new x(this.name,T,v,this._generateMipMaps);return X.yd=this.yd,X.level=this.level,X.wrapU=this.wrapU,X.wrapV=this.wrapV,X}serialize(){const v=this.va();v&&!v.isReady()&&O.d.Warn("The scene must be ready before serializing the dynamic texture");const T=super.serialize();return x._IsCanvasElement(this._canvas)&&(T.base64String=this._canvas.toDataURL()),T.invertY=this._invertY,T.samplingMode=this.samplingMode,T}static _IsCanvasElement(v){return void 0!==v.toDataURL}_rebuild(){this.update()}}},12091:(v,T,X)=>{"use strict";X.d(T,{d:()=>u});var O=X(978);class u extends O.e{constructor(v,T,X,u,B){let m=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],A=arguments.length>6&&void 0!==arguments[6]&&arguments[6],x=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,f=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,M=arguments.length>9?arguments[9]:void 0,H=arguments.length>10?arguments[10]:void 0;super(null,B,!m,A,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,M),this.format=u,this._engine&&(this._engine._caps.textureFloatLinearFiltering||1!==f||(x=1),this._engine._caps.textureHalfFloatLinearFiltering||2!==f||(x=1),this._texture=this._engine.createRawTexture(v,T,X,u,m,A,x,null,f,M??0,H??!1),this.wrapU=O.e.CLAMP_ADDRESSMODE,this.wrapV=O.e.CLAMP_ADDRESSMODE)}update(v){this._getEngine().updateRawTexture(this._texture,v,this._texture.format,this._texture.invertY,null,this._texture.type,this._texture._useSRGBBuffer)}clone(){if(!this._texture)return super.clone();const v=new u(null,this.getSize().width,this.getSize().height,this.format,this.va(),this._texture.generateMipMaps,this._invertY,this.samplingMode,this._texture.type,this._texture._creationFlags,this._useSRGBBuffer);return v._texture=this._texture,this._texture.incrementReferences(),v}static CreateLuminanceTexture(v,T,X,O){return new u(v,T,X,1,O,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateLuminanceAlphaTexture(v,T,X,O){return new u(v,T,X,2,O,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateAlphaTexture(v,T,X,O){return new u(v,T,X,0,O,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateRGBTexture(v,T,X,O){return new u(v,T,X,4,O,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBATexture(v,T,X,O){return new u(v,T,X,5,O,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBAStorageTexture(v,T,X,O){return new u(v,T,X,5,O,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,1,arguments.length>8&&void 0!==arguments[8]&&arguments[8])}static CreateRTexture(v,T,X,B){let m=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],A=arguments.length>5&&void 0!==arguments[5]&&arguments[5],x=arguments.length>6&&void 0!==arguments[6]?arguments[6]:O.e.TRILINEAR_SAMPLINGMODE;return new u(v,T,X,6,B,m,A,x,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1)}static CreateRStorageTexture(v,T,X,B){let m=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],A=arguments.length>5&&void 0!==arguments[5]&&arguments[5],x=arguments.length>6&&void 0!==arguments[6]?arguments[6]:O.e.TRILINEAR_SAMPLINGMODE;return new u(v,T,X,6,B,m,A,x,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,1)}}},11964:(v,T,X)=>{"use strict";X.d(T,{c:()=>m});var O=X(1352),u=X(1163),B=X(1023);class m extends O.d{get Og(){return this._subMaterials}set Og(v){this._subMaterials=v,this._hookArray(v)}getChildren(){return this.Og}constructor(v,T){super(v,T,!0),this._waitingSubMaterialsUniqueIds=[],this.va().addMultiMaterial(this),this.Og=[],this._storeEffectOnSubMeshes=!0}_hookArray(v){var T=this;const X=v.push;v.push=function(){for(var O=arguments.length,u=new Array(O),B=0;B<O;B++)u[B]=arguments[B];const m=X.apply(v,u);return T._markAllSubMeshesAsTexturesDirty(),m};const O=v.splice;v.splice=(T,X)=>{const u=O.apply(v,[T,X]);return this._markAllSubMeshesAsTexturesDirty(),u}}getSubMaterial(v){return v<0||v>=this.Og.length?this.va().defaultMaterial:this.Og[v]}getActiveTextures(){return super.getActiveTextures().concat(...this.Og.map((v=>v?v.getActiveTextures():[])))}hasTexture(v){if(super.hasTexture(v))return!0;for(let X=0;X<this.Og.length;X++){var T;if(null!==(T=this.Og[X])&&void 0!==T&&T.hasTexture(v))return!0}return!1}getClassName(){return"MultiMaterial"}isReadyForSubMesh(v,T,X){for(let O=0;O<this.Og.length;O++){const u=this.Og[O];if(u){if(u._storeEffectOnSubMeshes){if(!u.isReadyForSubMesh(v,T,X))return!1;continue}if(!u.isReady(v))return!1}}return!0}clone(v,T){const X=new m(v,this.va());for(let O=0;O<this.Og.length;O++){let u=null;const B=this.Og[O];u=T&&B?B.clone(v+"-"+B.name):this.Og[O],X.Og.push(u)}return X}serialize(){const v={};v.name=this.name,v.id=this.id,v.uniqueId=this.uniqueId,u.d&&(v.tags=u.d.GetTags(this)),v.materialsUniqueIds=[],v.materials=[];for(let T=0;T<this.Og.length;T++){const X=this.Og[T];X?(v.materialsUniqueIds.push(X.uniqueId),v.materials.push(X.id)):(v.materialsUniqueIds.push(null),v.materials.push(null))}return v}dispose(v,T,X){const O=this.va();if(!O)return;if(X)for(let B=0;B<this.Og.length;B++){const X=this.Og[B];X&&X.dispose(v,T)}const u=O.multiMaterials.indexOf(this);u>=0&&O.multiMaterials.splice(u,1),super.dispose(v,T)}static ParseMultiMaterial(v,T){const X=new m(v.name,T);return X.id=v.id,X._loadedUniqueId=v.uniqueId,u.d&&u.d.AddTagsTo(X,v.tags),v.materialsUniqueIds?X._waitingSubMaterialsUniqueIds=v.materialsUniqueIds:v.materials.forEach((v=>X.Og.push(T.getLastMaterialById(v)))),X}}(0,B.f)("BABYLON.MultiMaterial",m)},11972:(v,T,X)=>{"use strict";X.d(T,{e:()=>M,i:()=>f});var O=X(1006),u=X(1170),B=X(11911),m=X(11937),A=X(1194);X(11979);function x(v){let T=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const X=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],B=[];let x=[];const f=v.width||v.size||1,M=v.height||v.size||1,H=v.depth||v.size||1,n=v.wrap||!1;let V=void 0===v.topBaseAt?1:v.topBaseAt,D=void 0===v.bottomBaseAt?0:v.bottomBaseAt;V=(V+4)%4,D=(D+4)%4;let s=[2,0,3,1][V],F=[2,0,1,3][D],k=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(n){T=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],k=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let v=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],X=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const O=[17,18,19,16],u=[22,23,20,21];for(;s>0;)v.unshift(v.pop()),O.unshift(O.pop()),s--;for(;F>0;)X.unshift(X.pop()),u.unshift(u.pop()),F--;v=v.flat(),X=X.flat(),k=k.concat(v).concat(X),T.push(O[0],O[2],O[3],O[0],O[1],O[2]),T.push(u[0],u[2],u[3],u[0],u[1],u[2])}const b=[f/2,M/2,H/2];x=k.reduce(((v,T,X)=>v.concat(T*b[X%3])),[]);const l=0===v.sideOrientation?0:v.sideOrientation||m.e.DEFAULTSIDE,Q=v.faceUV||new Array(6),K=v.faceColors,p=[];for(let m=0;m<6;m++)void 0===Q[m]&&(Q[m]=new O.o(0,0,1,1)),K&&void 0===K[m]&&(K[m]=new u.g(1,1,1,1));for(let O=0;O<6;O++)if(B.push(Q[O].z,A.d?1-Q[O].w:Q[O].w),B.push(Q[O].x,A.d?1-Q[O].w:Q[O].w),B.push(Q[O].x,A.d?1-Q[O].y:Q[O].y),B.push(Q[O].z,A.d?1-Q[O].y:Q[O].y),K)for(let v=0;v<4;v++)p.push(K[O].r,K[O].g,K[O].b,K[O].a);m.e._ComputeSides(l,x,T,X,B,v.frontUVs,v.backUVs);const G=new m.e;if(G.indices=T,G.xa=x,G.ya=X,G.Aa=B,K){const v=l===m.e.DOUBLESIDE?p.concat(p):p;G.za=v}return G}function f(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const O=new B.d(v,X);T.sideOrientation=B.d._GetDefaultSideOrientation(T.sideOrientation),O._originalBuilderSideOrientation=T.sideOrientation;return x(T).Ca(O,T.updatable),O}const M={CreateBox:f};m.e.CreateBox=x,B.d.CreateBox=function(v,T){return f(v,{size:T,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},12106:(v,T,X)=>{"use strict";X.d(T,{c:()=>A});var O=X(11911),u=X(11937),B=X(1194);function m(v){const T=[],X=[],O=[],m=[],A=v.i||.5,x=v.Xk||64,f=v.arc&&(v.arc<=0||v.arc>1)?1:v.arc||1,M=0===v.sideOrientation?0:v.sideOrientation||u.e.DEFAULTSIDE;T.push(0,0,0),m.push(.5,.5);const H=2*Math.PI*f,n=1===f?H/x:H/(x-1);let V=0;for(let u=0;u<x;u++){const v=Math.cos(V),X=Math.sin(V),O=(v+1)/2,u=(1-X)/2;T.push(A*v,A*X,0),m.push(O,B.d?1-u:u),V+=n}1===f&&(T.push(T[3],T[4],T[5]),m.push(m[2],B.d?1-m[3]:m[3]));const D=T.length/3;for(let u=1;u<D-1;u++)X.push(u+1,0,u);u.e.ComputeNormals(T,X,O),u.e._ComputeSides(M,T,X,O,m,v.frontUVs,v.backUVs);const s=new u.e;return s.indices=X,s.xa=T,s.ya=O,s.Aa=m,s}function A(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const u=new O.d(v,X);T.sideOrientation=O.d._GetDefaultSideOrientation(T.sideOrientation),u._originalBuilderSideOrientation=T.sideOrientation;return m(T).Ca(u,T.updatable),u}u.e.kb=m,O.d.kb=function(v,T,X){return A(v,{i:T,Xk:X,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},11979:(v,T,X)=>{"use strict";X.d(T,{f:()=>F,d:()=>b,j:()=>k});var O=X(1006),u=X(1170),B=X(11911),m=X(11937),A=X(1261);B.d._GroundMeshParser=(v,T)=>x.Parse(v,T);class x extends B.d{constructor(v,T){super(v,T),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=v,this._subdivisionsY=v,this.subdivide(v);const X=this;X.createOrUpdateSubmeshesOctree&&X.createOrUpdateSubmeshesOctree(T)}getHeightAtCoordinates(v,T){const X=this.getWorldMatrix(),u=O.g.Matrix[5];X.invertToRef(u);const B=O.g.Vd[8];if(O.l.TransformCoordinatesFromFloatsToRef(v,0,T,u,B),v=B.x,T=B.z,v<this._minX||v>=this._maxX||T<=this._minZ||T>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const m=this._getFacetAt(v,T),A=-(m.x*v+m.z*T+m.w)/m.y;return O.l.TransformCoordinatesFromFloatsToRef(0,A,0,X,B),B.y}getNormalAtCoordinates(v,T){const X=new O.l(0,1,0);return this.getNormalAtCoordinatesToRef(v,T,X),X}getNormalAtCoordinatesToRef(v,T,X){const u=this.getWorldMatrix(),B=O.g.Matrix[5];u.invertToRef(B);const m=O.g.Vd[8];if(O.l.TransformCoordinatesFromFloatsToRef(v,0,T,B,m),v=m.x,T=m.z,v<this._minX||v>this._maxX||T<this._minZ||T>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const A=this._getFacetAt(v,T);return O.l.TransformNormalFromFloatsToRef(A.x,A.y,A.z,u,X),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(v,T){const X=Math.floor((v+this._maxX)*this._subdivisionsX/this._width),O=Math.floor(-(T+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),u=this._heightQuads[O*this._subdivisionsX+X];let B;return B=T<u.slope.x*v+u.slope.y?u.facet1:u.facet2,B}_initHeightQuads(){const v=this._subdivisionsX,T=this._subdivisionsY;this._heightQuads=new Array;for(let X=0;X<T;X++)for(let T=0;T<v;T++){const u={slope:O.i.Zero(),facet1:new O.o(0,0,0,0),facet2:new O.o(0,0,0,0)};this._heightQuads[X*v+T]=u}return this}_computeHeightQuads(){const v=this.getVerticesData(A.e.PositionKind);if(!v)return this;const T=O.g.Vd[3],X=O.g.Vd[2],u=O.g.Vd[1],B=O.g.Vd[0],m=O.g.Vd[4],x=O.g.Vd[5],f=O.g.Vd[6],M=O.g.Vd[7],H=O.g.Vd[8];let n=0,V=0,D=0,s=0,F=0,k=0,b=0;const l=this._subdivisionsX,Q=this._subdivisionsY;for(let A=0;A<Q;A++)for(let Q=0;Q<l;Q++){n=3*Q,V=A*(l+1)*3,D=(A+1)*(l+1)*3,T.x=v[V+n],T.y=v[V+n+1],T.z=v[V+n+2],X.x=v[V+n+3],X.y=v[V+n+4],X.z=v[V+n+5],u.x=v[D+n],u.y=v[D+n+1],u.z=v[D+n+2],B.x=v[D+n+3],B.y=v[D+n+4],B.z=v[D+n+5],s=(B.z-T.z)/(B.x-T.x),F=T.z-s*T.x,X.subtractToRef(T,m),u.subtractToRef(T,x),B.subtractToRef(T,f),O.l.CrossToRef(f,x,M),O.l.CrossToRef(m,f,H),M.normalize(),H.normalize(),k=-(M.x*T.x+M.y*T.y+M.z*T.z),b=-(H.x*X.x+H.y*X.y+H.z*X.z);const K=this._heightQuads[A*l+Q];K.slope.Sd(s,F),K.facet1.Sd(M.x,M.y,M.z,k),K.facet2.Sd(H.x,H.y,H.z,b)}return this}serialize(v){super.serialize(v),v.subdivisionsX=this._subdivisionsX,v.subdivisionsY=this._subdivisionsY,v.minX=this._minX,v.maxX=this._maxX,v.ij=this._minZ,v.maxZ=this._maxZ,v.width=this._width,v.height=this._height}static Parse(v,T){const X=new x(v.name,T);return X._subdivisionsX=v.subdivisionsX||1,X._subdivisionsY=v.subdivisionsY||1,X._minX=v.minX,X._maxX=v.maxX,X._minZ=v.ij,X._maxZ=v.maxZ,X._width=v.width,X._height=v.height,X}}var f=X(1217),M=X(1034),H=X(1015),n=X(1194);function V(v){const T=[],X=[],u=[],B=[];let A,x;const f=v.width||v.size||1,M=v.height||v.size||1,H=0|(v.subdivisionsX||v.subdivisions||1),V=0|(v.subdivisionsY||v.subdivisions||1);for(A=0;A<=V;A++)for(x=0;x<=H;x++){const v=new O.l(x*f/H-f/2,0,(V-A)*M/V-M/2),T=new O.l(0,1,0);X.push(v.x,v.y,v.z),u.push(T.x,T.y,T.z),B.push(x/H,n.d?A/V:1-A/V)}for(A=0;A<V;A++)for(x=0;x<H;x++)T.push(x+1+(A+1)*(H+1)),T.push(x+1+A*(H+1)),T.push(x+A*(H+1)),T.push(x+(A+1)*(H+1)),T.push(x+1+(A+1)*(H+1)),T.push(x+A*(H+1));const D=new m.e;return D.indices=T,D.xa=X,D.ya=u,D.Aa=B,D}function D(v){const T=void 0!==v.xmin&&null!==v.xmin?v.xmin:-1,X=void 0!==v.zmin&&null!==v.zmin?v.zmin:-1,u=void 0!==v.xmax&&null!==v.xmax?v.xmax:1,B=void 0!==v.zmax&&null!==v.zmax?v.zmax:1,A=v.subdivisions||{w:1,h:1},x=v.precision||{w:1,h:1},f=[],M=[],H=[],n=[];let V,D,s,F;A.h=A.h<1?1:A.h,A.w=A.w<1?1:A.w,x.w=x.w<1?1:x.w,x.h=x.h<1?1:x.h;const k=(u-T)/A.w,b=(B-X)/A.h;function l(v,T,X,u){const B=M.length/3,m=x.w+1;for(V=0;V<x.h;V++)for(D=0;D<x.w;D++){const v=[B+D+V*m,B+(D+1)+V*m,B+(D+1)+(V+1)*m,B+D+(V+1)*m];f.push(v[1]),f.push(v[2]),f.push(v[3]),f.push(v[0]),f.push(v[1]),f.push(v[3])}const A=O.l.Zero(),s=new O.l(0,1,0);for(V=0;V<=x.h;V++)for(A.z=V*(u-T)/x.h+T,D=0;D<=x.w;D++)A.x=D*(X-v)/x.w+v,A.y=0,M.push(A.x,A.y,A.z),H.push(s.x,s.y,s.z),n.push(D/x.w,V/x.h)}for(s=0;s<A.h;s++)for(F=0;F<A.w;F++)l(T+F*k,X+s*b,T+(F+1)*k,X+(s+1)*b);const Q=new m.e;return Q.indices=f,Q.xa=M,Q.ya=H,Q.Aa=n,Q}function s(v){const T=[],X=[],B=[],A=[];let x,f;const M=v.colorFilter||new u.d(.3,.59,.11),n=v.alphaFilter||0;let V=!1;if(v.minHeight>v.maxHeight){V=!0;const T=v.maxHeight;v.maxHeight=v.minHeight,v.minHeight=T}for(x=0;x<=v.subdivisions;x++)for(f=0;f<=v.subdivisions;f++){const T=new O.l(f*v.width/v.subdivisions-v.width/2,0,(v.subdivisions-x)*v.height/v.subdivisions-v.height/2),u=4*(((T.x+v.width/2)/v.width*(v.bufferWidth-1)|0)+((1-(T.z+v.height/2)/v.height)*(v.bufferHeight-1)|0)*v.bufferWidth);let m=v.buffer[u]/255,D=v.buffer[u+1]/255,s=v.buffer[u+2]/255;const F=v.buffer[u+3]/255;V&&(m=1-m,D=1-D,s=1-s);const k=m*M.r+D*M.g+s*M.b;T.y=F>=n?v.minHeight+(v.maxHeight-v.minHeight)*k:v.minHeight-H.c,v.heightBuffer&&(v.heightBuffer[x*(v.subdivisions+1)+f]=T.y),X.push(T.x,T.y,T.z),B.push(0,0,0),A.push(f/v.subdivisions,1-x/v.subdivisions)}for(x=0;x<v.subdivisions;x++)for(f=0;f<v.subdivisions;f++){const O=f+1+(x+1)*(v.subdivisions+1),u=f+1+x*(v.subdivisions+1),B=f+x*(v.subdivisions+1),m=f+(x+1)*(v.subdivisions+1),A=X[3*O+1]>=v.minHeight,M=X[3*u+1]>=v.minHeight,H=X[3*B+1]>=v.minHeight;A&&M&&H&&(T.push(O),T.push(u),T.push(B));X[3*m+1]>=v.minHeight&&A&&H&&(T.push(m),T.push(O),T.push(B))}m.e.ComputeNormals(X,T,B);const D=new m.e;return D.indices=T,D.xa=X,D.ya=B,D.Aa=A,D}function F(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const X=new x(v,arguments.length>2?arguments[2]:void 0);X._setReady(!1),X._subdivisionsX=T.subdivisionsX||T.subdivisions||1,X._subdivisionsY=T.subdivisionsY||T.subdivisions||1,X._width=T.width||1,X._height=T.height||1,X._maxX=X._width/2,X._maxZ=X._height/2,X._minX=-X._maxX,X._minZ=-X._maxZ;return V(T).Ca(X,T.updatable),X._setReady(!0),X}function k(v,T){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const O=new B.d(v,X);return D(T).Ca(O,T.updatable),O}function b(v,T){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const B=X.width||10,m=X.height||10,A=X.subdivisions||1,H=X.minHeight||0,n=X.maxHeight||1,V=X.colorFilter||new u.d(.3,.59,.11),D=X.alphaFilter||0,F=X.updatable,k=X.onReady;O=O||M.c.LastCreatedScene;const b=new x(v,O);let l;b._subdivisionsX=A,b._subdivisionsY=A,b._width=B,b._height=m,b._maxX=b._width/2,b._maxZ=b._height/2,b._minX=-b._maxX,b._minZ=-b._maxZ,b._setReady(!1),X.passHeightBufferInCallback&&(l=new Float32Array((A+1)*(A+1)));const Q=(v,T,X)=>{s({width:B,height:m,subdivisions:A,minHeight:H,maxHeight:n,colorFilter:V,buffer:v,bufferWidth:T,bufferHeight:X,alphaFilter:D,heightBuffer:l}).Ca(b,F),k&&k(b,l),b._setReady(!0)};if("string"===typeof T){const v=v=>{var T;const X=v.width,u=v.height;if(O.u)return;const B=null===(T=O)||void 0===T?void 0:T.getEngine().resizeImageBitmap(v,X,u);Q(B,X,u)};f.c.LoadImage(T,v,X.onError?X.onError:()=>{},O.offlineProvider)}else Q(T.data,T.width,T.height);return b}m.e.CreateGround=V,m.e.CreateTiledGround=D,m.e.CreateGroundFromHeightMap=s,B.d.CreateGround=(v,T,X,O,u,B)=>F(v,{width:T,height:X,subdivisions:O,updatable:B},u),B.d.CreateTiledGround=(v,T,X,O,u,B,m,A,x)=>k(v,{xmin:T,zmin:X,xmax:O,zmax:u,subdivisions:B,precision:m,updatable:x},A),B.d.CreateGroundFromHeightMap=(v,T,X,O,u,B,m,A,x,f,M)=>b(v,T,{width:X,height:O,subdivisions:u,minHeight:B,maxHeight:m,updatable:x,onReady:f,alphaFilter:M},A)},12939:(v,T,X)=>{"use strict";X.d(T,{e:()=>J,i:()=>Z,k:()=>U});var O=X(1006),u=X(11911),B=X(11937),m=X(1170),A=X(1261),x=X(12563),f=X(1352),M=X(1156),H=X(1209),n=X(978),V=X(1023),D=X(1416),s=X(1070),F=X(1409),k=X(1034),b=X(1400),l=X(1397);const Q={effect:null,subMesh:null};class K extends F.e{constructor(v,T,X){let u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(v,T,!(arguments.length>4&&void 0!==arguments[4])||arguments[4]),this._textures={},this._textureArrays={},this._externalTextures={},this._floats={},this._ints={},this._uints={},this._floatsArrays={},this._colors3={},this._colors3Arrays={},this._colors4={},this._colors4Arrays={},this._vectors2={},this._vectors3={},this._vectors4={},this._quaternions={},this._quaternionsArrays={},this._matrices={},this._matrixArrays={},this._matrices3x3={},this._matrices2x2={},this._vectors2Arrays={},this._vectors3Arrays={},this._vectors4Arrays={},this._uniformBuffers={},this._textureSamplers={},this._storageBuffers={},this._cachedWorldViewMatrix=new O.b,this._cachedWorldViewProjectionMatrix=new O.b,this._multiview=!1,this._materialHelperNeedsPreviousMatrices=!1,this._shaderPath=X,this._options={needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","Wd","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],externalTextures:[],samplerObjects:[],storageBuffers:[],defines:[],useClipPlane:!1,...u}}get shaderPath(){return this._shaderPath}set shaderPath(v){this._shaderPath=v}get options(){return this._options}get isMultiview(){return this._multiview}getClassName(){return"ShaderMaterial"}needAlphaBlending(){return this.alpha<1||this._options.needAlphaBlending}needAlphaTesting(){return this._options.needAlphaTesting}_checkUniform(v){-1===this._options.uniforms.indexOf(v)&&this._options.uniforms.push(v)}setTexture(v,T){return-1===this._options.samplers.indexOf(v)&&this._options.samplers.push(v),this._textures[v]=T,this}removeTexture(v){delete this._textures[v]}setTextureArray(v,T){return-1===this._options.samplers.indexOf(v)&&this._options.samplers.push(v),this._checkUniform(v),this._textureArrays[v]=T,this}setExternalTexture(v,T){return-1===this._options.externalTextures.indexOf(v)&&this._options.externalTextures.push(v),this._externalTextures[v]=T,this}setFloat(v,T){return this._checkUniform(v),this._floats[v]=T,this}setInt(v,T){return this._checkUniform(v),this._ints[v]=T,this}setUInt(v,T){return this._checkUniform(v),this._uints[v]=T,this}setFloats(v,T){return this._checkUniform(v),this._floatsArrays[v]=T,this}setColor3(v,T){return this._checkUniform(v),this._colors3[v]=T,this}setColor3Array(v,T){return this._checkUniform(v),this._colors3Arrays[v]=T.reduce(((v,T)=>(T.toArray(v,v.length),v)),[]),this}setColor4(v,T){return this._checkUniform(v),this._colors4[v]=T,this}setColor4Array(v,T){return this._checkUniform(v),this._colors4Arrays[v]=T.reduce(((v,T)=>(T.toArray(v,v.length),v)),[]),this}setVector2(v,T){return this._checkUniform(v),this._vectors2[v]=T,this}setVector3(v,T){return this._checkUniform(v),this._vectors3[v]=T,this}setVector4(v,T){return this._checkUniform(v),this._vectors4[v]=T,this}setQuaternion(v,T){return this._checkUniform(v),this._quaternions[v]=T,this}setQuaternionArray(v,T){return this._checkUniform(v),this._quaternionsArrays[v]=T.reduce(((v,T)=>(T.toArray(v,v.length),v)),[]),this}setMatrix(v,T){return this._checkUniform(v),this._matrices[v]=T,this}setMatrices(v,T){this._checkUniform(v);const X=new Float32Array(16*T.length);for(let O=0;O<T.length;O++){T[O].copyToArray(X,16*O)}return this._matrixArrays[v]=X,this}setMatrix3x3(v,T){return this._checkUniform(v),this._matrices3x3[v]=T,this}setMatrix2x2(v,T){return this._checkUniform(v),this._matrices2x2[v]=T,this}setArray2(v,T){return this._checkUniform(v),this._vectors2Arrays[v]=T,this}setArray3(v,T){return this._checkUniform(v),this._vectors3Arrays[v]=T,this}setArray4(v,T){return this._checkUniform(v),this._vectors4Arrays[v]=T,this}setUniformBuffer(v,T){return-1===this._options.uniformBuffers.indexOf(v)&&this._options.uniformBuffers.push(v),this._uniformBuffers[v]=T,this}setTextureSampler(v,T){return-1===this._options.samplerObjects.indexOf(v)&&this._options.samplerObjects.push(v),this._textureSamplers[v]=T,this}setStorageBuffer(v,T){return-1===this._options.storageBuffers.indexOf(v)&&this._options.storageBuffers.push(v),this._storageBuffers[v]=T,this}setDefine(v,T){const X=v.trimEnd()+" ",O=this.options.defines.findIndex((T=>T===v||T.startsWith(X)));return O>=0&&this.options.defines.splice(O,1),("boolean"!==typeof T||T)&&this.options.defines.push(X+T),this}isReadyForSubMesh(v,T,X){return this.isReady(v,X,T)}isReady(v,T,X){var O;const u=X&&this._storeEffectOnSubMeshes;if(this.isFrozen){const v=u?X._drawWrapper:this._drawWrapper;if(v.effect&&v._wasPreviouslyReady&&v._wasPreviouslyUsingInstances===T)return!0}const B=this.va(),m=B.getEngine(),x=[],f=[],M=new D.d;let n=this._shaderPath,V=this._options.uniforms,s=this._options.uniformBuffers,F=this._options.samplers;m.getCaps().multiview&&B.activeCamera&&B.activeCamera.outputRenderTarget&&B.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,x.push("#define MULTIVIEW"),-1!==V.indexOf("viewProjection")&&-1===V.indexOf("viewProjectionR")&&V.push("viewProjectionR"));for(let A=0;A<this._options.defines.length;A++){const v=0===this._options.defines[A].indexOf("#define")?this._options.defines[A]:`#define ${this._options.defines[A]}`;x.push(v)}for(let A=0;A<this._options.attributes.length;A++)f.push(this._options.attributes[A]);if(v&&v.isVerticesDataPresent(A.e.ColorKind)&&(-1===f.indexOf(A.e.ColorKind)&&f.push(A.e.ColorKind),x.push("#define VERTEXCOLOR")),T&&(x.push("#define INSTANCES"),(0,l.W)(f,this._materialHelperNeedsPreviousMatrices),null!==v&&void 0!==v&&v.hasThinInstances&&(x.push("#define THIN_INSTANCES"),v&&v.isVerticesDataPresent(A.e.ColorInstanceKind)&&(f.push(A.e.ColorInstanceKind),x.push("#define INSTANCESCOLOR")))),v&&v.useBones&&v.computeBonesUsingShaders&&v.skeleton){f.push(A.e.MatricesIndicesKind),f.push(A.e.MatricesWeightsKind),v.numBoneInfluencers>4&&(f.push(A.e.MatricesIndicesExtraKind),f.push(A.e.MatricesWeightsExtraKind));const T=v.skeleton;x.push("#define NUM_BONE_INFLUENCERS "+v.numBoneInfluencers),M.addCPUSkinningFallback(0,v),T.isUsingTextureForMatrices?(x.push("#define BONETEXTURE"),-1===V.indexOf("boneTextureWidth")&&V.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(x.push("#define BonesPerMesh "+(T.bones.length+1)),-1===V.indexOf("mBones")&&V.push("mBones"))}else x.push("#define NUM_BONE_INFLUENCERS 0");let k=0;const K=v?v.morphTargetManager:null;if(K){const v=K.supportsUVs&&-1!==x.indexOf("#define UV1"),T=K.supportsTangents&&-1!==x.indexOf("#define TANGENT"),X=K.supportsNormals&&-1!==x.indexOf("#define NORMAL");k=K.numMaxInfluencers||K.numInfluencers,v&&x.push("#define MORPHTARGETS_UV"),T&&x.push("#define MORPHTARGETS_TANGENT"),X&&x.push("#define MORPHTARGETS_NORMAL"),k>0&&x.push("#define MORPHTARGETS"),K.isUsingTextureForTargets&&(x.push("#define MORPHTARGETS_TEXTURE"),-1===V.indexOf("morphTargetTextureIndices")&&V.push("morphTargetTextureIndices"),-1===this._options.samplers.indexOf("morphTargets")&&this._options.samplers.push("morphTargets")),x.push("#define NUM_MORPH_INFLUENCERS "+k);for(let O=0;O<k;O++)f.push(A.e.PositionKind+O),X&&f.push(A.e.NormalKind+O),T&&f.push(A.e.TangentKind+O),v&&f.push(A.e.UVKind+"_"+O);k>0&&(V=V.slice(),V.push("morphTargetInfluences"),V.push("morphTargetCount"),V.push("morphTargetTextureInfo"),V.push("morphTargetTextureIndices"))}else x.push("#define NUM_MORPH_INFLUENCERS 0");if(v){const T=v.bakedVertexAnimationManager;T&&T.isEnabled&&(x.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),-1===V.indexOf("bakedVertexAnimationSettings")&&V.push("bakedVertexAnimationSettings"),-1===V.indexOf("bakedVertexAnimationTextureSizeInverted")&&V.push("bakedVertexAnimationTextureSizeInverted"),-1===V.indexOf("bakedVertexAnimationTime")&&V.push("bakedVertexAnimationTime"),-1===this._options.samplers.indexOf("bakedVertexAnimationTexture")&&this._options.samplers.push("bakedVertexAnimationTexture")),(0,l.t)(f,v,x)}for(const A in this._textures)if(!this._textures[A].isReady())return!1;v&&this._shouldTurnAlphaTestOn(v)&&x.push("#define ALPHATEST"),!1!==this._options.useClipPlane&&((0,b.c)(V),(0,b.n)(this,B,x)),B.fogEnabled&&null!==v&&void 0!==v&&v.applyFog&&B.fogMode!==H.e.FOGMODE_NONE&&(x.push("#define FOG"),-1===V.indexOf("view")&&V.push("view"),-1===V.indexOf("vFogInfos")&&V.push("vFogInfos"),-1===V.indexOf("vFogColor")&&V.push("vFogColor")),this._useLogarithmicDepth&&(x.push("#define LOGARITHMICDEPTH"),-1===V.indexOf("logarithmicDepthConstant")&&V.push("logarithmicDepthConstant")),this.customShaderNameResolve&&(V=V.slice(),s=s.slice(),F=F.slice(),n=this.customShaderNameResolve(this.name,V,s,F,x,f));const p=u?X._getDrawWrapper(void 0,!0):this._drawWrapper,G=(null===p||void 0===p?void 0:p.effect)??null,L=(null===p||void 0===p?void 0:p.defines)??null,r=x.join("\n");let o=G;return L!==r&&(o=m.createEffect(n,{attributes:f,uniformsNames:V,uniformBuffersNames:s,samplers:F,defines:r,fallbacks:M,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousMorphTargets:k},shaderLanguage:this._options.shaderLanguage,extraInitializationsAsync:this._options.extraInitializationsAsync},m),u?X.setEffect(o,r,this._materialContext):p&&p.setEffect(o,r),this._onEffectCreatedObservable&&(Q.effect=o,Q.subMesh=X??(null===v||void 0===v?void 0:v.Ce[0])??null,this._onEffectCreatedObservable.notifyObservers(Q))),p._wasPreviouslyUsingInstances=!!T,!((null===(O=o)||void 0===O||!O.isReady())??1)&&(G!==o&&B.resetCachedMaterial(),p._wasPreviouslyReady=!0,!0)}bindOnlyWorldMatrix(v,T){const X=this.va(),O=T??this.getEffect();O&&(-1!==this._options.uniforms.indexOf("world")&&O.setMatrix("world",v),-1!==this._options.uniforms.indexOf("worldView")&&(v.multiplyToRef(X.getViewMatrix(),this._cachedWorldViewMatrix),O.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==this._options.uniforms.indexOf("worldViewProjection")&&(v.multiplyToRef(X.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),O.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)),-1!==this._options.uniforms.indexOf("view")&&O.setMatrix("view",X.getViewMatrix()))}bindForSubMesh(v,T,X){var O;this.bind(v,T,null===(O=X._drawWrapperOverride)||void 0===O?void 0:O.effect,X)}bind(v,T,X,O){const u=O&&this._storeEffectOnSubMeshes,B=X??(u?O.effect:this.getEffect());if(!B)return;const m=this.va();this._activeEffect=B,this.bindOnlyWorldMatrix(v,X);const A=this._options.uniformBuffers;let x=!1;if(B&&A&&A.length>0&&m.getEngine().supportsUniformBuffers)for(let H=0;H<A.length;++H){switch(A[H]){case"Mesh":T&&(T.getMeshUniformBuffer().bindToEffect(B,"Mesh"),T.transferToEffect(v));break;case"Scene":(0,l.n)(B,m.getSceneUniformBuffer()),m.finalizeSceneUbo(),x=!0}}const f=T&&u?this._mustRebind(m,B,O,T.visibility):m.getCachedMaterial()!==this;if(B&&f){let v;for(v in x||-1===this._options.uniforms.indexOf("view")||B.setMatrix("view",m.getViewMatrix()),x||-1===this._options.uniforms.indexOf("projection")||B.setMatrix("projection",m.getProjectionMatrix()),x||-1===this._options.uniforms.indexOf("viewProjection")||(B.setMatrix("viewProjection",m.getTransformMatrix()),this._multiview&&B.setMatrix("viewProjectionR",m._transformMatrixR)),m.activeCamera&&-1!==this._options.uniforms.indexOf("cameraPosition")&&B.setVector3("cameraPosition",m.activeCamera.globalPosition),(0,l.c)(T,B),(0,b.g)(B,this,m),this._useLogarithmicDepth&&(0,l.i)(u?O.materialDefines:B.defines,B,m),T&&(0,l.e)(m,T,B),this._textures)B.setTexture(v,this._textures[v]);for(v in this._textureArrays)B.setTextureArray(v,this._textureArrays[v]);for(v in this._ints)B.setInt(v,this._ints[v]);for(v in this._uints)B.setUInt(v,this._uints[v]);for(v in this._floats)B.setFloat(v,this._floats[v]);for(v in this._floatsArrays)B.setArray(v,this._floatsArrays[v]);for(v in this._colors3)B.setColor3(v,this._colors3[v]);for(v in this._colors3Arrays)B.setArray3(v,this._colors3Arrays[v]);for(v in this._colors4){const T=this._colors4[v];B.setFloat4(v,T.r,T.g,T.b,T.a)}for(v in this._colors4Arrays)B.setArray4(v,this._colors4Arrays[v]);for(v in this._vectors2)B.setVector2(v,this._vectors2[v]);for(v in this._vectors3)B.setVector3(v,this._vectors3[v]);for(v in this._vectors4)B.setVector4(v,this._vectors4[v]);for(v in this._quaternions)B.setQuaternion(v,this._quaternions[v]);for(v in this._matrices)B.setMatrix(v,this._matrices[v]);for(v in this._matrixArrays)B.setMatrices(v,this._matrixArrays[v]);for(v in this._matrices3x3)B.setMatrix3x3(v,this._matrices3x3[v]);for(v in this._matrices2x2)B.setMatrix2x2(v,this._matrices2x2[v]);for(v in this._vectors2Arrays)B.setArray2(v,this._vectors2Arrays[v]);for(v in this._vectors3Arrays)B.setArray3(v,this._vectors3Arrays[v]);for(v in this._vectors4Arrays)B.setArray4(v,this._vectors4Arrays[v]);for(v in this._quaternionsArrays)B.setArray4(v,this._quaternionsArrays[v]);for(v in this._uniformBuffers){const T=this._uniformBuffers[v].getBuffer();T&&B.bindUniformBuffer(T,v)}const X=m.getEngine(),A=X.setExternalTexture;if(A)for(v in this._externalTextures)A.call(X,v,this._externalTextures[v]);const f=X.setTextureSampler;if(f)for(v in this._textureSamplers)f.call(X,v,this._textureSamplers[v]);const M=X.setStorageBuffer;if(M)for(v in this._storageBuffers)M.call(X,v,this._storageBuffers[v])}if(B&&T&&(f||!this.isFrozen)){const v=T.morphTargetManager;v&&v.numInfluencers>0&&(0,l.m)(T,B);const X=T.bakedVertexAnimationManager;if(X&&X.isEnabled){var M;const v=u?O._drawWrapper:this._drawWrapper;null===(M=T.bakedVertexAnimationManager)||void 0===M||M.bind(B,!!v._wasPreviouslyUsingInstances)}}this._afterBind(T,B,O)}getActiveTextures(){const v=super.getActiveTextures();for(const T in this._textures)v.push(this._textures[T]);for(const T in this._textureArrays){const X=this._textureArrays[T];for(let T=0;T<X.length;T++)v.push(X[T])}return v}hasTexture(v){if(super.hasTexture(v))return!0;for(const T in this._textures)if(this._textures[T]===v)return!0;for(const T in this._textureArrays){const X=this._textureArrays[T];for(let T=0;T<X.length;T++)if(X[T]===v)return!0}return!1}clone(v){const T=M.e.Clone((()=>new K(v,this.va(),this._shaderPath,this._options,this._storeEffectOnSubMeshes)),this);T.name=v,T.id=v,"object"===typeof T._shaderPath&&(T._shaderPath={...T._shaderPath}),this._options={...this._options},Object.keys(this._options).forEach((v=>{const T=this._options[v];Array.isArray(T)&&(this._options[v]=T.slice(0))})),this.stencil.copyTo(T.stencil);for(const X in this._textures)T.setTexture(X,this._textures[X]);for(const X in this._textureArrays)T.setTextureArray(X,this._textureArrays[X]);for(const X in this._externalTextures)T.setExternalTexture(X,this._externalTextures[X]);for(const X in this._ints)T.setInt(X,this._ints[X]);for(const X in this._uints)T.setUInt(X,this._uints[X]);for(const X in this._floats)T.setFloat(X,this._floats[X]);for(const X in this._floatsArrays)T.setFloats(X,this._floatsArrays[X]);for(const X in this._colors3)T.setColor3(X,this._colors3[X]);for(const X in this._colors3Arrays)T._colors3Arrays[X]=this._colors3Arrays[X];for(const X in this._colors4)T.setColor4(X,this._colors4[X]);for(const X in this._colors4Arrays)T._colors4Arrays[X]=this._colors4Arrays[X];for(const X in this._vectors2)T.setVector2(X,this._vectors2[X]);for(const X in this._vectors3)T.setVector3(X,this._vectors3[X]);for(const X in this._vectors4)T.setVector4(X,this._vectors4[X]);for(const X in this._quaternions)T.setQuaternion(X,this._quaternions[X]);for(const X in this._quaternionsArrays)T._quaternionsArrays[X]=this._quaternionsArrays[X];for(const X in this._matrices)T.setMatrix(X,this._matrices[X]);for(const X in this._matrixArrays)T._matrixArrays[X]=this._matrixArrays[X].slice();for(const X in this._matrices3x3)T.setMatrix3x3(X,this._matrices3x3[X]);for(const X in this._matrices2x2)T.setMatrix2x2(X,this._matrices2x2[X]);for(const X in this._vectors2Arrays)T.setArray2(X,this._vectors2Arrays[X]);for(const X in this._vectors3Arrays)T.setArray3(X,this._vectors3Arrays[X]);for(const X in this._vectors4Arrays)T.setArray4(X,this._vectors4Arrays[X]);for(const X in this._uniformBuffers)T.setUniformBuffer(X,this._uniformBuffers[X]);for(const X in this._textureSamplers)T.setTextureSampler(X,this._textureSamplers[X]);for(const X in this._storageBuffers)T.setStorageBuffer(X,this._storageBuffers[X]);return T}dispose(v,T,X){if(T){let v;for(v in this._textures)this._textures[v].dispose();for(v in this._textureArrays){const T=this._textureArrays[v];for(let v=0;v<T.length;v++)T[v].dispose()}}this._textures={},super.dispose(v,T,X)}serialize(){const v=M.e.Serialize(this);let T;for(T in v.customType="BABYLON.ShaderMaterial",v.uniqueId=this.uniqueId,v.options=this._options,v.shaderPath=this._shaderPath,v.storeEffectOnSubMeshes=this._storeEffectOnSubMeshes,v.stencil=this.stencil.serialize(),v.textures={},this._textures)v.textures[T]=this._textures[T].serialize();for(T in v.textureArrays={},this._textureArrays){v.textureArrays[T]=[];const X=this._textureArrays[T];for(let O=0;O<X.length;O++)v.textureArrays[T].push(X[O].serialize())}for(T in v.ints={},this._ints)v.ints[T]=this._ints[T];for(T in v.uints={},this._uints)v.uints[T]=this._uints[T];for(T in v.floats={},this._floats)v.floats[T]=this._floats[T];for(T in v.floatsArrays={},this._floatsArrays)v.floatsArrays[T]=this._floatsArrays[T];for(T in v.colors3={},this._colors3)v.colors3[T]=this._colors3[T].Pd();for(T in v.colors3Arrays={},this._colors3Arrays)v.colors3Arrays[T]=this._colors3Arrays[T];for(T in v.colors4={},this._colors4)v.colors4[T]=this._colors4[T].Pd();for(T in v.colors4Arrays={},this._colors4Arrays)v.colors4Arrays[T]=this._colors4Arrays[T];for(T in v.vectors2={},this._vectors2)v.vectors2[T]=this._vectors2[T].Pd();for(T in v.vectors3={},this._vectors3)v.vectors3[T]=this._vectors3[T].Pd();for(T in v.vectors4={},this._vectors4)v.vectors4[T]=this._vectors4[T].Pd();for(T in v.quaternions={},this._quaternions)v.quaternions[T]=this._quaternions[T].Pd();for(T in v.matrices={},this._matrices)v.matrices[T]=this._matrices[T].Pd();for(T in v.matrixArray={},this._matrixArrays)v.matrixArray[T]=this._matrixArrays[T];for(T in v.matrices3x3={},this._matrices3x3)v.matrices3x3[T]=this._matrices3x3[T];for(T in v.matrices2x2={},this._matrices2x2)v.matrices2x2[T]=this._matrices2x2[T];for(T in v.vectors2Arrays={},this._vectors2Arrays)v.vectors2Arrays[T]=this._vectors2Arrays[T];for(T in v.vectors3Arrays={},this._vectors3Arrays)v.vectors3Arrays[T]=this._vectors3Arrays[T];for(T in v.vectors4Arrays={},this._vectors4Arrays)v.vectors4Arrays[T]=this._vectors4Arrays[T];for(T in v.quaternionsArrays={},this._quaternionsArrays)v.quaternionsArrays[T]=this._quaternionsArrays[T];return v}static Parse(v,T,X){const u=M.e.Parse((()=>new K(v.name,T,v.shaderPath,v.options,v.storeEffectOnSubMeshes)),v,T,X);let B;for(B in v.stencil&&u.stencil.parse(v.stencil,T,X),v.textures)u.setTexture(B,n.e.Parse(v.textures[B],T,X));for(B in v.textureArrays){const O=v.textureArrays[B],m=[];for(let v=0;v<O.length;v++)m.push(n.e.Parse(O[v],T,X));u.setTextureArray(B,m)}for(B in v.ints)u.setInt(B,v.ints[B]);for(B in v.uints)u.setUInt(B,v.uints[B]);for(B in v.floats)u.setFloat(B,v.floats[B]);for(B in v.floatsArrays)u.setFloats(B,v.floatsArrays[B]);for(B in v.colors3)u.setColor3(B,m.d.Ld(v.colors3[B]));for(B in v.colors3Arrays){const T=v.colors3Arrays[B].reduce(((v,T,X)=>(X%3===0?v.push([T]):v[v.length-1].push(T),v)),[]).map((v=>m.d.Ld(v)));u.setColor3Array(B,T)}for(B in v.colors4)u.setColor4(B,m.g.Ld(v.colors4[B]));for(B in v.colors4Arrays){const T=v.colors4Arrays[B].reduce(((v,T,X)=>(X%4===0?v.push([T]):v[v.length-1].push(T),v)),[]).map((v=>m.g.Ld(v)));u.setColor4Array(B,T)}for(B in v.vectors2)u.setVector2(B,O.i.Ld(v.vectors2[B]));for(B in v.vectors3)u.setVector3(B,O.l.Ld(v.vectors3[B]));for(B in v.vectors4)u.setVector4(B,O.o.Ld(v.vectors4[B]));for(B in v.quaternions)u.setQuaternion(B,O.f.Ld(v.quaternions[B]));for(B in v.matrices)u.setMatrix(B,O.b.Ld(v.matrices[B]));for(B in v.matrixArray)u._matrixArrays[B]=new Float32Array(v.matrixArray[B]);for(B in v.matrices3x3)u.setMatrix3x3(B,v.matrices3x3[B]);for(B in v.matrices2x2)u.setMatrix2x2(B,v.matrices2x2[B]);for(B in v.vectors2Arrays)u.setArray2(B,v.vectors2Arrays[B]);for(B in v.vectors3Arrays)u.setArray3(B,v.vectors3Arrays[B]);for(B in v.vectors4Arrays)u.setArray4(B,v.vectors4Arrays[B]);for(B in v.quaternionsArrays)u.setArray4(B,v.quaternionsArrays[B]);return u}static ParseFromFileAsync(v,T,X){let O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return new Promise(((u,B)=>{const m=new s.b;m.addEventListener("readystatechange",(()=>{if(4==m.readyState)if(200==m.status){const T=JSON.parse(m.responseText),B=this.Parse(T,X||k.c.LastCreatedScene,O);v&&(B.name=v),u(B)}else B("Unable to load the ShaderMaterial")})),m.open("GET",T),m.send()}))}static ParseFromSnippetAsync(v,T){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Promise(((O,u)=>{const B=new s.b;B.addEventListener("readystatechange",(()=>{if(4==B.readyState)if(200==B.status){const u=JSON.parse(JSON.parse(B.responseText).jsonPayload),m=JSON.parse(u.shaderMaterial),A=this.Parse(m,T||k.c.LastCreatedScene,X);A.snippetId=v,O(A)}else u("Unable to load the snippet "+v)})),B.open("GET",this.SnippetUrl+"/"+v.replace(/#/g,"/")),B.send()}))}}K.SnippetUrl="https://snippet.babylonjs.com",K.CreateFromSnippetAsync=K.ParseFromSnippetAsync,(0,V.f)("BABYLON.ShaderMaterial",K),u.d._LinesMeshParser=(v,T)=>p.Parse(v,T);class p extends u.d{_isShaderMaterial(v){return"ShaderMaterial"===v.getClassName()}constructor(v){let T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,O=arguments.length>5?arguments[5]:void 0,u=arguments.length>6?arguments[6]:void 0,B=arguments.length>7?arguments[7]:void 0;super(v,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,T,arguments.length>4?arguments[4]:void 0),this.useVertexColor=O,this.useVertexAlpha=u,this.color=new m.d(1,1,1),this.alpha=1,this._shaderLanguage=0,T&&(this.color=T.color.clone(),this.alpha=T.alpha,this.useVertexColor=T.useVertexColor,this.useVertexAlpha=T.useVertexAlpha),this.intersectionThreshold=.1;const x={attributes:[A.e.PositionKind],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:[],useClipPlane:null,shaderLanguage:0};if(!1===u?x.needAlphaBlending=!1:x.defines.push("#define VERTEXALPHA"),O?(x.defines.push("#define VERTEXCOLOR"),x.attributes.push(A.e.ColorKind)):(x.uniforms.push("color"),this._color4=new m.g),B)this.material=B;else{this.va().getEngine().isWebGPU&&!p.ForceGLSL&&(this._shaderLanguage=1),x.shaderLanguage=this._shaderLanguage,x.extraInitializationsAsync=async()=>{1===this._shaderLanguage?await Promise.all([X.e(19).then(X.bind(X,13249)),X.e(48).then(X.bind(X,13253))]):await Promise.all([X.e(26).then(X.bind(X,13255)),X.e(49).then(X.bind(X,13260))])},this.material=new K("colorShader",this.va(),"color",x,!1),this.material.doNotSerialize=!0}}isReady(){return!!this._lineMaterial.isReady(this,!!this._userInstancedBuffersStorage||this.hasThinInstances)&&super.isReady()}getClassName(){return"LinesMesh"}get material(){return this._lineMaterial}set material(v){this._lineMaterial=v,this._lineMaterial.fillMode=f.d.LineListDrawMode}get checkCollisions(){return!1}set checkCollisions(v){}_bind(v,T){if(!this._geometry)return this;const X=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(!this._userInstancedBuffersStorage||this.hasThinInstances?this._geometry._bind(T,X):this._geometry._bind(T,X,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects),!this.useVertexColor&&this._isShaderMaterial(this._lineMaterial)){const{r:v,g:T,b:X}=this.color;this._color4.set(v,T,X,this.alpha),this._lineMaterial.setColor4("color",this._color4)}return this}_draw(v,T,X){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const O=this.va().getEngine();return this._unIndexed?O.drawArraysType(f.d.LineListDrawMode,v.verticesStart,v.verticesCount,X):O.drawElementsType(f.d.LineListDrawMode,v.indexStart,v.indexCount,X),this}dispose(v){(arguments.length>2?arguments[2]:void 0)||this._lineMaterial.dispose(!1,!1,!0),super.dispose(v)}clone(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,X=arguments.length>2?arguments[2]:void 0;return new p(v,this.va(),T,this,X)}Jb(v){const T=new G(v,this);if(this.instancedBuffers){T.instancedBuffers={};for(const v in this.instancedBuffers)T.instancedBuffers[v]=this.instancedBuffers[v]}return T}serialize(v){super.serialize(v),v.color=this.color.Pd(),v.alpha=this.alpha}static Parse(v,T){const X=new p(v.name,T);return X.color=m.d.Ld(v.color),X.alpha=v.alpha,X}}p.ForceGLSL=!1;class G extends x.c{constructor(v,T){super(v,T),this.intersectionThreshold=T.intersectionThreshold}getClassName(){return"InstancedLinesMesh"}}var L=X(1103);function r(v){const T=[],X=[],O=v.lines,u=v.za,m=[];let A=0;for(let B=0;B<O.length;B++){const v=O[B];for(let O=0;O<v.length;O++){const{x:x,y:f,z:M}=v[O];if(X.push(x,f,M),u){const v=u[B],{r:T,g:X,b:A,a:x}=v[O];m.push(T,X,A,x)}O>0&&(T.push(A-1),T.push(A)),A++}}const x=new B.e;return x.indices=T,x.xa=X,u&&(x.za=m),x}function o(v){const T=v.dashSize||3,X=v.gapSize||1,u=v.dashNb||200,m=v.points,A=[],x=[],f=O.l.Zero();let M=0,H=0,n=0,V=0,D=0,s=0,F=0;for(F=0;F<m.length-1;F++)m[F+1].subtractToRef(m[F],f),M+=f.length();for(n=M/u,V=T*n/(T+X),F=0;F<m.length-1;F++){m[F+1].subtractToRef(m[F],f),H=Math.floor(f.length()/n),f.normalize();for(let v=0;v<H;v++)D=n*v,A.push(m[F].x+D*f.x,m[F].y+D*f.y,m[F].z+D*f.z),A.push(m[F].x+(D+V)*f.x,m[F].y+(D+V)*f.y,m[F].z+(D+V)*f.z),x.push(s,s+1),s+=2}const k=new B.e;return k.xa=A,k.indices=x,k}function Z(v,T){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const O=T.instance,u=T.lines,B=T.za;if(O){const v=O.getVerticesData(A.e.PositionKind);let T,X;B&&(T=O.getVerticesData(A.e.ColorKind));let m=0,x=0;for(let O=0;O<u.length;O++){const A=u[O];for(let u=0;u<A.length;u++)v[m]=A[u].x,v[m+1]=A[u].y,v[m+2]=A[u].z,B&&T&&(X=B[O],T[x]=X[u].r,T[x+1]=X[u].g,T[x+2]=X[u].b,T[x+3]=X[u].a,x+=4),m+=3}return O.updateVerticesData(A.e.PositionKind,v,!1,!1),B&&T&&O.updateVerticesData(A.e.ColorKind,T,!1,!1),O.refreshBoundingInfo(),O}const m=new p(v,X,null,void 0,void 0,!!B,T.useVertexAlpha,T.material);return r(T).Ca(m,T.updatable),m}function U(v,T){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const O=T.za?[T.za]:null;return Z(v,{lines:[T.points],updatable:T.updatable,instance:T.instance,za:O,useVertexAlpha:T.useVertexAlpha,material:T.material},X)}function J(v,T){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=T.points,m=T.instance,A=T.gapSize||1,x=T.dashSize||3;if(m){const v=v=>{const T=O.l.Zero(),X=v.length/6;let u=0,A=0,x=0,f=0,M=0,H=0,n=0,V=0;for(n=0;n<B.length-1;n++)B[n+1].subtractToRef(B[n],T),u+=T.length();x=u/X;const D=m._creationDataStorage.dashSize;for(f=D*x/(D+m._creationDataStorage.gapSize),n=0;n<B.length-1;n++)for(B[n+1].subtractToRef(B[n],T),A=Math.floor(T.length()/x),T.normalize(),V=0;V<A&&H<v.length;)M=x*V,v[H]=B[n].x+M*T.x,v[H+1]=B[n].y+M*T.y,v[H+2]=B[n].z+M*T.z,v[H+3]=B[n].x+(M+f)*T.x,v[H+4]=B[n].y+(M+f)*T.y,v[H+5]=B[n].z+(M+f)*T.z,H+=6,V++;for(;H<v.length;)v[H]=B[n].x,v[H+1]=B[n].y,v[H+2]=B[n].z,H+=3};return(T.dashNb||T.dashSize||T.gapSize||T.useVertexAlpha||T.material)&&L.d.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),m.updateMeshPositions(v,!1),m}const f=new p(v,X,null,void 0,void 0,void 0,T.useVertexAlpha,T.material);return o(T).Ca(f,T.updatable),f._creationDataStorage=new u.g,f._creationDataStorage.dashSize=x,f._creationDataStorage.gapSize=A,f}B.e.CreateLineSystem=r,B.e.CreateDashedLines=o,u.d.mb=function(v,T){return U(v,{points:T,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},u.d.CreateDashedLines=function(v,T,X,O,u){return J(v,{points:T,dashSize:X,gapSize:O,dashNb:u,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},12041:(v,T,X)=>{"use strict";X.d(T,{c:()=>A,d:()=>x});var O=X(11911),u=X(11937),B=X(1194);function m(v){const T=[],X=[],O=[],m=[],A=v.width||v.size||1,x=v.height||v.size||1,f=0===v.sideOrientation?0:v.sideOrientation||u.e.DEFAULTSIDE,M=A/2,H=x/2;X.push(-M,-H,0),O.push(0,0,-1),m.push(0,B.d?1:0),X.push(M,-H,0),O.push(0,0,-1),m.push(1,B.d?1:0),X.push(M,H,0),O.push(0,0,-1),m.push(1,B.d?0:1),X.push(-M,H,0),O.push(0,0,-1),m.push(0,B.d?0:1),T.push(0),T.push(1),T.push(2),T.push(0),T.push(2),T.push(3),u.e._ComputeSides(f,X,T,O,m,v.frontUVs,v.backUVs);const n=new u.e;return n.indices=T,n.xa=X,n.ya=O,n.Aa=m,n}function A(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const u=new O.d(v,X);T.sideOrientation=O.d._GetDefaultSideOrientation(T.sideOrientation),u._originalBuilderSideOrientation=T.sideOrientation;return m(T).Ca(u,T.updatable),T.sourcePlane&&(u.translate(T.sourcePlane.Wd,-T.sourcePlane.d),u.setDirection(T.sourcePlane.Wd.scale(-1))),u}const x={Rg:A};u.e.Rg=m,O.d.Rg=(v,T,X,O,u)=>A(v,{size:T,width:T,height:T,sideOrientation:u,updatable:O},X)},12093:(v,T,X)=>{"use strict";X.d(T,{d:()=>x});var O=X(1006),u=X(11911),B=X(11937),m=X(1194);function A(v){const T=0|(v.segments||32),X=v.diameterX||v.diameter||1,u=v.diameterY||v.diameter||1,A=v.diameterZ||v.diameter||1,x=v.arc&&(v.arc<=0||v.arc>1)?1:v.arc||1,f=v.slice&&v.slice<=0?1:v.slice||1,M=0===v.sideOrientation?0:v.sideOrientation||B.e.DEFAULTSIDE,H=!!v.dedupTopBottomIndices,n=new O.l(X/2,u/2,A/2),V=2+T,D=2*V,s=[],F=[],k=[],b=[];for(let B=0;B<=V;B++){const v=B/V,T=v*Math.PI*f;for(let X=0;X<=D;X++){const u=X/D,B=u*Math.PI*2*x,A=O.b.RotationZ(-T),f=O.b.RotationY(B),M=O.l.TransformCoordinates(O.l.Up(),A),H=O.l.TransformCoordinates(M,f),V=H.multiply(n),s=H.divide(n).normalize();F.push(V.x,V.y,V.z),k.push(s.x,s.y,s.z),b.push(u,m.d?1-v:v)}if(B>0){const v=F.length/3;for(let T=v-2*(D+1);T+D+2<v;T++)H?(B>1&&(s.push(T),s.push(T+1),s.push(T+D+1)),(B<V||f<1)&&(s.push(T+D+1),s.push(T+1),s.push(T+D+2))):(s.push(T),s.push(T+1),s.push(T+D+1),s.push(T+D+1),s.push(T+1),s.push(T+D+2))}}B.e._ComputeSides(M,F,s,k,b,v.frontUVs,v.backUVs);const l=new B.e;return l.indices=s,l.xa=F,l.ya=k,l.Aa=b,l}function x(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const O=new u.d(v,X);T.sideOrientation=u.d._GetDefaultSideOrientation(T.sideOrientation),O._originalBuilderSideOrientation=T.sideOrientation;return A(T).Ca(O,T.updatable),O}B.e.CreateSphere=A,u.d.CreateSphere=(v,T,X,O,u,B)=>x(v,{segments:T,diameterX:X,diameterY:X,diameterZ:X,sideOrientation:B,updatable:u},O)},12587:(v,T,X)=>{"use strict";X.d(T,{b:()=>H});var O=X(1217),u=X(10878),B=X(11942),m=X(1261),A=X(11937),x=X(1103);function f(v,T,X,O,u){let B=null,m=null,A=null;try{let x;B=new v.Decoder,m=new v.DecoderBuffer,m.Init(T,T.byteLength);const f=B.GetEncodedGeometryType(m);switch(f){case v.TRIANGULAR_MESH:{const T=new v.Mesh;if(x=B.DecodeBufferToMesh(m,T),!x.ok()||0===T.ptr)throw new Error(x.error_msg());const X=3*T.num_faces(),u=4*X,f=v._malloc(u);try{B.GetTrianglesUInt32Array(T,u,f);const m=new Uint32Array(X);m.set(new Uint32Array(v.HEAPF32.buffer,f,X)),O(m)}finally{v._free(f)}A=T;break}case v.POINT_CLOUD:{const T=new v.PointCloud;if(x=B.DecodeBufferToPointCloud(m,T),!x.ok()||!T.ptr)throw new Error(x.error_msg());A=T;break}default:throw new Error(`Invalid geometry type ${f}`)}const M=A.num_points(),H=(T,X,O,B)=>{const m=B.data_type(),A=B.num_components(),x=B.normalized(),f=B.byte_stride(),H=B.byte_offset(),n={[v.DT_FLOAT32]:{typedArrayConstructor:Float32Array,heap:v.HEAPF32},[v.DT_INT8]:{typedArrayConstructor:Int8Array,heap:v.HEAP8},[v.DT_INT16]:{typedArrayConstructor:Int16Array,heap:v.HEAP16},[v.DT_INT32]:{typedArrayConstructor:Int32Array,heap:v.HEAP32},[v.DT_UINT8]:{typedArrayConstructor:Uint8Array,heap:v.HEAPU8},[v.DT_UINT16]:{typedArrayConstructor:Uint16Array,heap:v.HEAPU16},[v.DT_UINT32]:{typedArrayConstructor:Uint32Array,heap:v.HEAPU32}}[m];if(!n)throw new Error(`Invalid data type ${m}`);const V=M*A,D=V*n.typedArrayConstructor.BYTES_PER_ELEMENT,s=v._malloc(D);try{T.GetAttributeDataArrayForAllPoints(X,B,m,D,s);const v=new n.typedArrayConstructor(n.heap.buffer,s,V);u(O,v.slice(),A,H,f,x)}finally{v._free(s)}};if(X)for(const v in X){const T=X[v],O=B.GetAttributeByUniqueId(A,T);H(B,A,v,O)}else{const T={position:v.POSITION,Wd:v.NORMAL,color:v.COLOR,uv:v.TEX_COORD};for(const v in T){const X=B.GetAttributeId(A,T[v]);if(-1!==X){const T=B.GetAttribute(A,X);H(B,A,v,T)}}}return M}finally{A&&v.destroy(A),m&&v.destroy(m),B&&v.destroy(B)}}function M(){let v;onmessage=T=>{const X=T.data;switch(X.id){case"init":{const T=X.decoder;T.url&&importScripts(T.url);const O=T.wasmBinary?{wasmBinary:T.wasmBinary}:{};v=DracoDecoderModule(O),postMessage({id:"initDone"});break}case"decodeMesh":if(!v)throw new Error("Draco decoder module is not available");v.then((v=>{const T=f(v,X.dataView,X.attributes,(v=>{postMessage({id:"indices",data:v},[v.buffer])}),((v,T,X,O,u,B)=>{postMessage({id:"attribute",kind:v,data:T,size:X,byteOffset:O,byteStride:u,normalized:B},[T.buffer])}));postMessage({id:"decodeMeshDone",totalVertices:T})}))}}}class H{static get DecoderAvailable(){const v=H.Configuration.decoder;return!!(v.wasmUrl&&v.wasmBinaryUrl&&"object"===typeof WebAssembly||v.fallbackUrl)}static GetDefaultNumWorkers(){return"object"===typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1}static get Default(){return H._Default||(H._Default=new H),H._Default}static ResetDefault(v){H._Default&&(v||H._Default.dispose(),H._Default=null)}constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:H.DefaultNumWorkers;const T=H.Configuration.decoder;if(T.workerPool||"object"===typeof v&&v.workerPool)this._workerPoolPromise=Promise.resolve(T.workerPool||v.workerPool);else{const X=T.wasmBinary||"object"===typeof v&&v.wasmBinary,B="number"===typeof v?v:v.numWorkers,m=B&&"function"===typeof Worker&&"function"===typeof URL,A=m||!m&&!T.jsModule,x=T.wasmUrl&&T.wasmBinaryUrl&&"object"===typeof WebAssembly?{url:A?O.c.GetBabylonScriptURL(T.wasmUrl,!0):"",wasmBinaryPromise:X?Promise.resolve(X):O.c.LoadFileAsync(O.c.GetBabylonScriptURL(T.wasmBinaryUrl,!0))}:{url:A?O.c.GetBabylonScriptURL(T.fallbackUrl):"",wasmBinaryPromise:Promise.resolve(void 0)};m?this._workerPoolPromise=x.wasmBinaryPromise.then((v=>{const T=`${f}(${M})()`,X=URL.createObjectURL(new Blob([T],{type:"application/javascript"}));return new u.e(B,(()=>function(v,T,X){return new Promise(((O,u)=>{const B=T=>{v.removeEventListener("error",B),v.removeEventListener("message",m),u(T)},m=T=>{"initDone"===T.data.id&&(v.removeEventListener("error",B),v.removeEventListener("message",m),O(v))};if(v.addEventListener("error",B),v.addEventListener("message",m),T){const O=T.slice(0);v.postMessage({id:"init",decoder:{url:X,wasmBinary:O}},[O])}else v.postMessage({id:"init",decoder:{url:X}})}))}(new Worker(X),v,x.url)))})):this._decoderModulePromise=x.wasmBinaryPromise.then((async v=>{if("undefined"===typeof DracoDecoderModule&&!T.jsModule){if(!x.url)throw new Error("Draco decoder module is not available");await O.c.LoadBabylonScriptAsync(x.url)}return await(X=v,u=T.jsModule,new Promise((v=>{(u||DracoDecoderModule)({wasmBinary:X}).then((T=>{v({module:T})}))})));var X,u}))}}dispose(){this._workerPoolPromise&&this._workerPoolPromise.then((v=>{v.dispose()})),delete this._workerPoolPromise,delete this._decoderModulePromise}async whenReadyAsync(){this._workerPoolPromise?await this._workerPoolPromise:this._decoderModulePromise&&await this._decoderModulePromise}decodeMeshToMeshDataAsync(v,T,X){const O=v instanceof ArrayBuffer?new Int8Array(v):new Int8Array(v.buffer,v.byteOffset,v.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((v=>new Promise(((u,B)=>{v.push(((v,m)=>{let A=null;const f=[],M=T=>{v.removeEventListener("error",M),v.removeEventListener("message",H),B(T),m()},H=T=>{const O=T.data;switch(O.id){case"decodeMeshDone":v.removeEventListener("error",M),v.removeEventListener("message",H),u({indices:A,attributes:f,totalVertices:O.totalVertices}),m();break;case"indices":A=O.data;break;case"attribute":f.push({kind:O.kind,data:O.data,size:O.size,byteOffset:O.byteOffset,byteStride:O.byteStride,normalized:(B=O.kind,n=O.normalized,X&&void 0!==X[B]?(n!==X[B]&&x.d.Warn(`Normalized flag from Draco data (${n}) does not match normalized flag from glTF accessor (${X[B]}). Using flag from glTF accessor.`),X[B]):n)})}var B,n};v.addEventListener("error",M),v.addEventListener("message",H);const n=O.slice();v.postMessage({id:"decodeMesh",dataView:n,attributes:T},[n.buffer])}))}))));if(this._decoderModulePromise)return this._decoderModulePromise.then((v=>{let X=null;const u=[],B=f(v.module,O,T,(v=>{X=v}),((v,T,X,O,B,m)=>{u.push({kind:v,data:T,size:X,byteOffset:O,byteStride:B,normalized:m})}));return{indices:X,attributes:u,totalVertices:B}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(v,T,X,O){const u=await this.decodeMeshToMeshDataAsync(X,O),A=new B.e(v,T);u.indices&&A.setIndices(u.indices);for(const B of u.attributes)A.setVerticesBuffer(new m.e(T.getEngine(),B.data,B.kind,!1,void 0,B.byteStride,void 0,B.byteOffset,B.size,void 0,B.normalized,!0),u.totalVertices);return A}async _decodeMeshToGeometryForGltfAsync(v,T,X,O,u){const A=await this.decodeMeshToMeshDataAsync(X,O,u),x=new B.e(v,T);A.indices&&x.setIndices(A.indices);for(const B of A.attributes)x.setVerticesBuffer(new m.e(T.getEngine(),B.data,B.kind,!1,void 0,B.byteStride,void 0,B.byteOffset,B.size,void 0,B.normalized,!0),A.totalVertices);return x}async decodeMeshAsync(v,T){const X=await this.decodeMeshToMeshDataAsync(v,T),O=new A.e;X.indices&&(O.indices=X.indices);for(const u of X.attributes){const v=m.e.GetFloatData(u.data,u.size,m.e.GetDataType(u.data),u.byteOffset,u.byteStride,u.normalized,X.totalVertices);O.set(v,u.kind)}return O}}H.Configuration={decoder:{wasmUrl:`${O.c._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${O.c._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${O.c._DefaultCdnUrl}/draco_decoder_gltf.js`}},H.DefaultNumWorkers=H.GetDefaultNumWorkers(),H._Default=null},11951:(v,T,X)=>{"use strict";X.d(T,{c:()=>G});var O=X(985),u=X(1001),B=X(1006),m=X(1261),A=X(11937),x=X(11955),f=X(1257),M=X(1371),H=X(1251);class n{constructor(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new B.l(0,0,0),this._diffPositionForCollisions=new B.l(0,0,0),this._collisionResponse=!0}}var V=X(1095),D=X(1381),s=X(1170),F=X(1015),k=X(1495),b=X(1023),l=X(994),Q=X(1111);class K{constructor(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=B.l.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1}}class p{constructor(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new K,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=null,this._currentLODIsUpToDate=!1,this._collisionRetryCount=3,this._morphTargetManager=null,this._renderingGroupId=0,this._bakedVertexAnimationManager=null,this._material=null,this._positions=null,this._pointerOverDisableMeshTesting=!1,this._meshCollisionData=new n,this._enableDistantPicking=!1,this._rawBoundingInfo=null,this._sideOrientationHint=!1,this._inheritVisibility=!1}}class G extends x.c{static get BILLBOARDMODE_NONE(){return x.c.BILLBOARDMODE_NONE}static get BILLBOARDMODE_X(){return x.c.BILLBOARDMODE_X}static get BILLBOARDMODE_Y(){return x.c.BILLBOARDMODE_Y}static get BILLBOARDMODE_Z(){return x.c.BILLBOARDMODE_Z}static get BILLBOARDMODE_ALL(){return x.c.BILLBOARDMODE_ALL}static get BILLBOARDMODE_USE_POSITION(){return x.c.BILLBOARDMODE_USE_POSITION}get facetNb(){return this._internalAbstractMeshDataInfo._facetData.facetNb}get partitioningSubdivisions(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions}set partitioningSubdivisions(v){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=v}get partitioningBBoxRatio(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio}set partitioningBBoxRatio(v){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=v}get mustDepthSortFacets(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort}set mustDepthSortFacets(v){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=v}get facetDepthSortFrom(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom}set facetDepthSortFrom(v){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=v}get collisionRetryCount(){return this._internalAbstractMeshDataInfo._collisionRetryCount}set collisionRetryCount(v){this._internalAbstractMeshDataInfo._collisionRetryCount=v}get isFacetDataEnabled(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled}get morphTargetManager(){return this._internalAbstractMeshDataInfo._morphTargetManager}set morphTargetManager(v){this._internalAbstractMeshDataInfo._morphTargetManager!==v&&(this._internalAbstractMeshDataInfo._morphTargetManager=v,this._syncGeometryWithMorphTargetManager())}get bakedVertexAnimationManager(){return this._internalAbstractMeshDataInfo._bakedVertexAnimationManager}set bakedVertexAnimationManager(v){this._internalAbstractMeshDataInfo._bakedVertexAnimationManager!==v&&(this._internalAbstractMeshDataInfo._bakedVertexAnimationManager=v,this._markSubMeshesAsAttributesDirty())}_syncGeometryWithMorphTargetManager(){}_updateNonUniformScalingState(v){return!!super._updateNonUniformScalingState(v)&&(this._markSubMeshesAsMiscDirty(),!0)}get rawBoundingInfo(){return this._internalAbstractMeshDataInfo._rawBoundingInfo}set rawBoundingInfo(v){this._internalAbstractMeshDataInfo._rawBoundingInfo=v}set Mk(v){this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver=this.onCollideObservable.add(v)}set onCollisionPositionChange(v){this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(v)}get visibility(){return this._internalAbstractMeshDataInfo._visibility}set visibility(v){if(this._internalAbstractMeshDataInfo._visibility===v)return;const T=this._internalAbstractMeshDataInfo._visibility;this._internalAbstractMeshDataInfo._visibility=v,(1===T&&1!==v||1!==T&&1===v)&&this._markSubMeshesAsDirty((v=>{v.markAsMiscDirty(),v.markAsPrePassDirty()}))}get inheritVisibility(){return this._internalAbstractMeshDataInfo._inheritVisibility}set inheritVisibility(v){this._internalAbstractMeshDataInfo._inheritVisibility=v}get isVisible(){if(!this._isVisible||!this.inheritVisibility||!this._parentNode)return this._isVisible;if(this._isVisible){let v=this._parentNode;for(;v;){const T=v.isVisible;if("undefined"!==typeof T)return T;v=v.parent}}return this._isVisible}set isVisible(v){this._isVisible=v}get pointerOverDisableMeshTesting(){return this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting}set pointerOverDisableMeshTesting(v){this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting=v}get renderingGroupId(){return this._internalAbstractMeshDataInfo._renderingGroupId}set renderingGroupId(v){this._internalAbstractMeshDataInfo._renderingGroupId=v}get material(){return this._internalAbstractMeshDataInfo._material}set material(v){this._setMaterial(v)}_setMaterial(v){this._internalAbstractMeshDataInfo._material!==v&&(this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._material=v,v&&v.meshMap&&(v.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.Ce&&(this.resetDrawCache(),this._unBindEffect()))}getMaterialForRenderPass(v){var T;return null===(T=this._internalAbstractMeshDataInfo._materialForRenderPass)||void 0===T?void 0:T[v]}setMaterialForRenderPass(v,T){this.resetDrawCache(v),this._internalAbstractMeshDataInfo._materialForRenderPass||(this._internalAbstractMeshDataInfo._materialForRenderPass=[]),this._internalAbstractMeshDataInfo._materialForRenderPass[v]=T}get receiveShadows(){return this._internalAbstractMeshDataInfo._receiveShadows}set receiveShadows(v){this._internalAbstractMeshDataInfo._receiveShadows!==v&&(this._internalAbstractMeshDataInfo._receiveShadows=v,this._markSubMeshesAsLightDirty())}get hasVertexAlpha(){return this._internalAbstractMeshDataInfo._hasVertexAlpha}set hasVertexAlpha(v){this._internalAbstractMeshDataInfo._hasVertexAlpha!==v&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=v,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())}get useVertexColors(){return this._internalAbstractMeshDataInfo._useVertexColors}set useVertexColors(v){this._internalAbstractMeshDataInfo._useVertexColors!==v&&(this._internalAbstractMeshDataInfo._useVertexColors=v,this._markSubMeshesAsAttributesDirty())}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(v){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==v&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=v,this._markSubMeshesAsAttributesDirty())}get numBoneInfluencers(){return this._internalAbstractMeshDataInfo._numBoneInfluencers}set numBoneInfluencers(v){this._internalAbstractMeshDataInfo._numBoneInfluencers!==v&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=v,this._markSubMeshesAsAttributesDirty())}get applyFog(){return this._internalAbstractMeshDataInfo._applyFog}set applyFog(v){this._internalAbstractMeshDataInfo._applyFog!==v&&(this._internalAbstractMeshDataInfo._applyFog=v,this._markSubMeshesAsMiscDirty())}get enableDistantPicking(){return this._internalAbstractMeshDataInfo._enableDistantPicking}set enableDistantPicking(v){this._internalAbstractMeshDataInfo._enableDistantPicking=v}get layerMask(){return this._internalAbstractMeshDataInfo._layerMask}set layerMask(v){v!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=v,this._resyncLightSources())}get collisionMask(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask}set collisionMask(v){this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask=isNaN(v)?-1:v}get collisionResponse(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse}set collisionResponse(v){this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse=v}get collisionGroup(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup}set collisionGroup(v){this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup=isNaN(v)?-1:v}get surroundingMeshes(){return this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes}set surroundingMeshes(v){this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes=v}get lightSources(){return this._lightSources}set skeleton(v){const T=this._internalAbstractMeshDataInfo._skeleton;T&&T.needInitialSkinMatrix&&T._unregisterMeshWithPoseMatrix(this),v&&v.needInitialSkinMatrix&&v._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=v,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()}get skeleton(){return this._internalAbstractMeshDataInfo._skeleton}constructor(v){var T;let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;switch(super(v,X,!1),T=this,this._internalAbstractMeshDataInfo=new p,this._waitingMaterialId=null,this._waitingMorphTargetManagerId=null,this.bf=G.Ui,this.onCollideObservable=new u.b,this.onCollisionPositionChangeObservable=new u.b,this.onMaterialChangedObservable=new u.b,this.definedFacingForward=!0,this._occlusionQuery=null,this._renderingGroup=null,this.alphaIndex=Number.MAX_VALUE,this._isVisible=!0,this.pe=!0,this.isNearPickable=!1,this.isNearGrabbable=!1,this.showSubMeshesBoundingBox=!1,this.isBlocker=!1,this.enablePointerMoveEvents=!1,this.outlineColor=s.d.Red(),this.outlineWidth=.02,this.overlayColor=s.d.Red(),this.overlayAlpha=.5,this.useOctreeForRenderingSelection=!0,this.useOctreeForPicking=!0,this.useOctreeForCollisions=!0,this.Le=!1,this.Da=!1,this.actionManager=null,this.ellipsoid=new B.l(.5,1,.5),this.ellipsoidOffset=new B.l(0,0,0),this.edgesWidth=1,this.edgesColor=new s.g(1,0,0,1),this._edgesRenderer=null,this._masterMesh=null,this._boundingInfo=null,this._boundingInfoIsDirty=!0,this._renderId=0,this._intersectionsInProgress=new Array,this._unIndexed=!1,this._lightSources=new Array,this._waitingData={lods:null,actions:null,gi:null},this._bonesTransformMatrices=null,this._transformMatrixTexture=null,this.onRebuildObservable=new u.b,this._onCollisionPositionChange=function(v,X){let O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;X.subtractToRef(T._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,T._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),T._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions.length()>Q.e.CollisionsEpsilon&&T.position.addInPlace(T._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),O&&T.onCollideObservable.notifyObservers(O),T.onCollisionPositionChangeObservable.notifyObservers(T.position)},X=this.va(),X.Ge(this),this._resyncLightSources(),this._uniformBuffer=new H.c(this.va().getEngine(),void 0,void 0,v,!this.va().getEngine().isWebGPU),this._buildUniformLayout(),X.performancePriority){case 2:this.Da=!0;case 1:this.Le=!0,this.pe=!1}}_buildUniformLayout(){this._uniformBuffer.addUniform("world",16),this._uniformBuffer.addUniform("visibility",1),this._uniformBuffer.create()}transferToEffect(v){const T=this._uniformBuffer;T.ne("world",v),T.updateFloat("visibility",this._internalAbstractMeshDataInfo._visibility),T.update()}getMeshUniformBuffer(){return this._uniformBuffer}getClassName(){return"AbstractMesh"}toString(v){let T="Name: "+this.name+", isInstance: "+("InstancedMesh"!==this.getClassName()?"YES":"NO");T+=", # of submeshes: "+(this.Ce?this.Ce.length:0);const X=this._internalAbstractMeshDataInfo._skeleton;return X&&(T+=", skeleton: "+X.name),v&&(T+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],T+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.gi?"YES":"NO")),T}_getEffectiveParent(){return this._masterMesh&&this.billboardMode!==x.c.BILLBOARDMODE_NONE?this._masterMesh:super._getEffectiveParent()}_getActionManagerForTrigger(v){let T=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.actionManager&&(T||this.actionManager.isRecursive)){if(!v)return this.actionManager;if(this.actionManager.hasSpecificTrigger(v))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(v,!1):null}_rebuild(){if(this.onRebuildObservable.notifyObservers(this),null!==this._occlusionQuery&&(this._occlusionQuery=null),this.Ce){for(const v of this.Ce)v._rebuild();this.resetDrawCache()}}_resyncLightSources(){this._lightSources.length=0;for(const v of this.va().lights)v.isEnabled()&&v.canAffectMesh(this)&&this._lightSources.push(v);this._markSubMeshesAsLightDirty()}_resyncLightSource(v){const T=v.isEnabled()&&v.canAffectMesh(this),X=this._lightSources.indexOf(v);let O=!1;if(-1===X){if(!T)return;this._lightSources.push(v)}else{if(T)return;O=!0,this._lightSources.splice(X,1)}this._markSubMeshesAsLightDirty(O)}_unBindEffect(){for(const v of this.Ce)v.setEffect(null)}_removeLightSource(v,T){const X=this._lightSources.indexOf(v);-1!==X&&(this._lightSources.splice(X,1),this._markSubMeshesAsLightDirty(T))}_markSubMeshesAsDirty(v){if(this.Ce)for(const T of this.Ce)for(let X=0;X<T._drawWrappers.length;++X){const O=T._drawWrappers[X];O&&O.defines&&O.defines.markAllAsDirty&&v(O.defines)}}_markSubMeshesAsLightDirty(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._markSubMeshesAsDirty((T=>T.markAsLightDirty(v)))}_markSubMeshesAsAttributesDirty(){this._markSubMeshesAsDirty((v=>v.markAsAttributesDirty()))}_markSubMeshesAsMiscDirty(){this._markSubMeshesAsDirty((v=>v.markAsMiscDirty()))}Oe(v){return this._currentRenderId=Number.MAX_VALUE,super.Oe(v),this._isDirty=!0,this}resetDrawCache(v){if(this.Ce)for(const T of this.Ce)T.resetDrawCache(v)}get isBlocked(){return!1}getLOD(v){return this}getTotalVertices(){return 0}getTotalIndices(){return 0}Qe(){return null}getVerticesData(v){return null}Ga(v,T,X,O){return this}updateVerticesData(v,T,X,O){return this}setIndices(v,T){return this}isVerticesDataPresent(v){return!1}getBoundingInfo(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfoIsDirty&&(this._boundingInfoIsDirty=!1,this.Ea()),this._boundingInfo)}getRawBoundingInfo(){return this.rawBoundingInfo??this.getBoundingInfo()}setBoundingInfo(v){return this._boundingInfo=v,this}get hasBoundingInfo(){return null!==this._boundingInfo}buildBoundingInfo(v,T,X){return this._boundingInfo=new M.c(v,T,X),this._boundingInfo}normalizeToUnitCube(){let v=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],T=arguments.length>1&&void 0!==arguments[1]&&arguments[1],X=arguments.length>2?arguments[2]:void 0;return super.normalizeToUnitCube(v,T,X)}get useBones(){return this.skeleton&&this.va().skeletonsEnabled&&this.isVerticesDataPresent(m.e.MatricesIndicesKind)&&this.isVerticesDataPresent(m.e.MatricesWeightsKind)}_preActivate(){}_preActivateForIntermediateRendering(v){}_activate(v,T){return this._renderId=v,!0}_postActivate(){}_freeze(){}_unFreeze(){}getWorldMatrix(){return this._masterMesh&&this.billboardMode===x.c.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():super.getWorldMatrix()}_getWorldMatrixDeterminant(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():super._getWorldMatrixDeterminant()}get isAnInstance(){return!1}get hasInstances(){return!1}get hasThinInstances(){return!1}movePOV(v,T,X){return this.position.addInPlace(this.calcMovePOV(v,T,X)),this}calcMovePOV(v,T,X){const O=new B.b;(this.rotationQuaternion?this.rotationQuaternion:B.f.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(O);const u=B.l.Zero(),m=this.definedFacingForward?-1:1;return B.l.TransformCoordinatesFromFloatsToRef(v*m,T,X*m,O,u),u}rotatePOV(v,T,X){return this.rotation.addInPlace(this.calcRotatePOV(v,T,X)),this}calcRotatePOV(v,T,X){const O=this.definedFacingForward?1:-1;return new B.l(v*O,T,X*O)}Fa(v,T){if(v){const X=(0,D.f)(v,0,this.getTotalVertices(),T);this._boundingInfo?this._boundingInfo.reConstruct(X.minimum,X.maximum):this._boundingInfo=new M.c(X.minimum,X.maximum)}if(this.Ce)for(let X=0;X<this.Ce.length;X++)this.Ce[X].refreshBoundingInfo(v);this.Ea()}_refreshBoundingInfoDirect(v){if(this._boundingInfo?this._boundingInfo.reConstruct(v.minimum,v.maximum):this._boundingInfo=new M.c(v.minimum,v.maximum),this.Ce)for(let T=0;T<this.Ce.length;T++)this.Ce[T].refreshBoundingInfo(null);this.Ea()}static _ApplySkeleton(v,T,X,O,u,A,x){!function(v,T,X,O,u,A,x){const f=B.g.Vd[0],M=B.g.Matrix[0],H=B.g.Matrix[1],n=T===m.e.NormalKind?B.l.TransformNormalFromFloatsToRef:B.l.TransformCoordinatesFromFloatsToRef;for(let m=0,V=0;m<v.length;m+=3,V+=4){let T,D;for(M.reset(),T=0;T<4;T++)D=u[V+T],D>0&&(B.b.FromFloat32ArrayToRefScaled(X,Math.floor(16*O[V+T]),D,H),M.addToSelf(H));if(A&&x)for(T=0;T<4;T++)D=x[V+T],D>0&&(B.b.FromFloat32ArrayToRefScaled(X,Math.floor(16*A[V+T]),D,H),M.addToSelf(H));n(v[m],v[m+1],v[m+2],M,f),f.toArray(v,m)}}(v,T,X,O,u,A,x)}_getData(v,T){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:m.e.PositionKind;const O=v.cache,u=v=>{if(O){const T=O._vertexData||(O._vertexData={});return T[v]||this.copyVerticesData(v,T),T[v]}return this.getVerticesData(v)};if(T||(T=u(X)),!T)return null;if(O?(O._outputData?O._outputData.set(T):O._outputData=new Float32Array(T),T=O._outputData):(v.applyMorph&&this.morphTargetManager||v.applySkeleton&&this.skeleton)&&(T=T.slice()),v.applyMorph&&this.morphTargetManager&&function(v,T,X){let O=null;switch(T){case m.e.PositionKind:O=v=>v.getPositions();break;case m.e.NormalKind:O=v=>v.getNormals();break;case m.e.TangentKind:O=v=>v.getTangents();break;case m.e.UVKind:O=v=>v.getUVs();break;default:return}for(let u=0;u<v.length;u++){let T=v[u];for(let B=0;B<X.numTargets;B++){const m=X.getTarget(B),A=m.influence;if(0!==A){const X=O(m);X&&(T+=(X[u]-v[u])*A)}}v[u]=T}}(T,X,this.morphTargetManager),v.applySkeleton&&this.skeleton){const v=u(m.e.MatricesIndicesKind),O=u(m.e.MatricesWeightsKind);if(O&&v){const B=this.numBoneInfluencers>4,A=B?u(m.e.MatricesIndicesExtraKind):null,x=B?u(m.e.MatricesWeightsExtraKind):null,f=this.skeleton.getTransformMatrices(this);G._ApplySkeleton(T,X,f,v,O,A,x)}}if(!1!==v.updatePositionsArray&&X===m.e.PositionKind){const v=this._internalAbstractMeshDataInfo._positions||[],X=v.length;if(v.length=T.length/3,X<v.length)for(let T=X;T<v.length;T++)v[T]=new B.l;for(let O=0,u=0;O<v.length;O++,u+=3)v[O].Sd(T[u],T[u+1],T[u+2]);this._internalAbstractMeshDataInfo._positions=v}return T}getNormalsData(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0],T=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getData({applySkeleton:v,applyMorph:T,updatePositionsArray:!1},null,m.e.NormalKind)}Yf(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0],T=arguments.length>1&&void 0!==arguments[1]&&arguments[1],X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this._getData({applySkeleton:v,applyMorph:T,updatePositionsArray:!1},X,m.e.PositionKind)}Ea(){return this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=new M.c(B.l.Zero(),B.l.Zero(),this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}_updateSubMeshesBoundingInfo(v){if(!this.Ce)return this;const T=this.Ce.length;for(let X=0;X<T;X++){const O=this.Ce[X];(T>1||!O.IsGlobal)&&O.updateBoundingInfo(v)}return this}_afterComputeWorldMatrix(){this.Da||(this._boundingInfoIsDirty=!0)}isInFrustum(v){return this.getBoundingInfo().isInFrustum(v,this.bf)}isCompletelyInFrustum(v){return this.getBoundingInfo().isCompletelyInFrustum(v)}intersectsMesh(v){let T=arguments.length>1&&void 0!==arguments[1]&&arguments[1],X=arguments.length>2?arguments[2]:void 0;const O=this.getBoundingInfo(),u=v.getBoundingInfo();if(O.intersects(u,T))return!0;if(X)for(const B of this.getChildMeshes())if(B.intersectsMesh(v,T,!0))return!0;return!1}intersectsPoint(v){return this.getBoundingInfo().intersectsPoint(v)}get checkCollisions(){return this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions}set checkCollisions(v){this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions=v}get collider(){return this._internalAbstractMeshDataInfo._meshCollisionData._collider}moveWithCollisions(v){this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions);const T=this.va().collisionCoordinator;return this._internalAbstractMeshDataInfo._meshCollisionData._collider||(this._internalAbstractMeshDataInfo._meshCollisionData._collider=T.createCollider()),this._internalAbstractMeshDataInfo._meshCollisionData._collider._radius=this.ellipsoid,T.getNewPosition(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,v,this._internalAbstractMeshDataInfo._meshCollisionData._collider,this.collisionRetryCount,this,this._onCollisionPositionChange,this.uniqueId),this}_collideForSubMesh(v,T,X){var O;if(this._generatePointsArray(),!this._positions)return this;if(!v._lastColliderWorldVertices||!v._lastColliderTransformMatrix.equals(T)){v._lastColliderTransformMatrix=T.clone(),v._lastColliderWorldVertices=[],v._trianglePlanes=[];const X=v.verticesStart,O=v.verticesStart+v.verticesCount;for(let u=X;u<O;u++)v._lastColliderWorldVertices.push(B.l.TransformCoordinates(this._positions[u],T))}return X._collide(v._trianglePlanes,v._lastColliderWorldVertices,this.Qe(),v.indexStart,v.indexStart+v.indexCount,v.verticesStart,!!v.Ha(),this,this._shouldConvertRHS(),7===(null===(O=v.Ha())||void 0===O?void 0:O.fillMode)),this}_processCollisionsForSubMeshes(v,T){const X=this._scene.getCollidingSubMeshCandidates(this,v),O=X.length;for(let u=0;u<O;u++){const B=X.data[u];O>1&&!B._checkCollision(v)||this._collideForSubMesh(B,T,v)}return this}_shouldConvertRHS(){return!1}_checkCollision(v){if(!this.getBoundingInfo()._checkCollision(v))return this;const T=B.g.Matrix[0],X=B.g.Matrix[1];return B.b.ScalingToRef(1/v._radius.x,1/v._radius.y,1/v._radius.z,T),this.worldMatrixFromCache.multiplyToRef(T,X),this._processCollisionsForSubMeshes(v,X),this}_generatePointsArray(){return!1}intersects(v,T,X){let O=arguments.length>3&&void 0!==arguments[3]&&arguments[3],u=arguments.length>4?arguments[4]:void 0,m=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const A=new f.d,x=this.getClassName(),M="InstancedLinesMesh"===x||"LinesMesh"===x||"GreasedLineMesh"===x?this.intersectionThreshold:0,H=this.getBoundingInfo();if(!this.Ce)return A;if(!m&&(!v.intersectsSphere(H.boundingSphere,M)||!v.intersectsBox(H.boundingBox,M)))return A;if(O)return A.hit=!m,A.pickedMesh=m?null:this,A.distance=m?0:B.l.Distance(v.origin,H.boundingSphere.center),A.subMeshId=0,A;if(!this._generatePointsArray())return A;let n=null;const V=this._scene.getIntersectingSubMeshCandidates(this,v),D=V.length;let s=!1;for(let B=0;B<D;B++){const v=V.data[B].Ha();if(v&&(7==v.fillMode||0==v.fillMode||1==v.fillMode||2==v.fillMode||4==v.fillMode)){s=!0;break}}if(!s)return A.hit=!0,A.pickedMesh=this,A.distance=B.l.Distance(v.origin,H.boundingSphere.center),A.subMeshId=-1,A;for(let B=0;B<D;B++){const O=V.data[B];if(D>1&&!m&&!O.canIntersects(v))continue;const u=O.intersects(v,this._positions,this.Qe(),T,X);if(u&&(T||!n||u.distance<n.distance)&&(n=u,n.subMeshId=B,T))break}if(n){const T=u??this.getWorldMatrix(),X=B.g.Vd[0],O=B.g.Vd[1];B.l.TransformCoordinatesToRef(v.origin,T,X),v.direction.scaleToRef(n.distance,O);const m=B.l.TransformNormal(O,T).addInPlace(X);return A.hit=!0,A.distance=B.l.Distance(X,m),A.pickedPoint=m,A.pickedMesh=this,A.bu=n.bu||0,A.bv=n.bv||0,A.subMeshFaceId=n.faceId,A.faceId=n.faceId+V.data[n.subMeshId].indexStart/(-1!==this.getClassName().indexOf("LinesMesh")?2:3),A.subMeshId=n.subMeshId,A}return A}clone(v,T,X){return null}releaseSubMeshes(){if(this.Ce)for(;this.Ce.length;)this.Ce[0].dispose();else this.Ce=[];return this}dispose(v){let T,X=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const O=this.va();for(this._scene.useMaterialMeshMap&&this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),O.freeActiveMeshes(),O.freeRenderingGroups(),O.renderingManager.maintainStateBetweenFrames&&O.renderingManager.restoreDispachedFlags(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.disposeWhenUnowned&&!this._scene.meshes.some((v=>v!==this&&v.actionManager===this.actionManager))&&this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),T=0;T<this._intersectionsInProgress.length;T++){const v=this._intersectionsInProgress[T],X=v._intersectionsInProgress.indexOf(this);v._intersectionsInProgress.splice(X,1)}this._intersectionsInProgress.length=0;O.lights.forEach((v=>{let T=v.includedOnlyMeshes.indexOf(this);-1!==T&&v.includedOnlyMeshes.splice(T,1),T=v.excludedMeshes.indexOf(this),-1!==T&&v.excludedMeshes.splice(T,1);const X=v.getShadowGenerators();if(X){const v=X.values();for(let X=v.next();!0!==X.done;X=v.next()){const v=X.value.getShadowMap();v&&v.renderList&&(T=v.renderList.indexOf(this),-1!==T&&v.renderList.splice(T,1))}}})),"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes();const u=O.getEngine();if(null!==this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,u.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),u.wipeCaches(),O.Je(this),this._parentContainer){const v=this._parentContainer.meshes.indexOf(this);v>-1&&this._parentContainer.meshes.splice(v,1),this._parentContainer=null}if(X&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!v)for(T=0;T<O.Ae.length;T++)O.Ae[T].k===this&&(O.Ae[T].dispose(),T--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this._uniformBuffer.dispose(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),super.dispose(v,X)}_initFacetData(){const v=this._internalAbstractMeshDataInfo._facetData;v.facetNormals||(v.facetNormals=[]),v.facetPositions||(v.facetPositions=[]),v.facetPartitioning||(v.facetPartitioning=new Array),v.facetNb=this.Qe().length/3|0,v.partitioningSubdivisions=v.partitioningSubdivisions?v.partitioningSubdivisions:10,v.partitioningBBoxRatio=v.partitioningBBoxRatio?v.partitioningBBoxRatio:1.01;for(let T=0;T<v.facetNb;T++)v.facetNormals[T]=B.l.Zero(),v.facetPositions[T]=B.l.Zero();return v.facetDataEnabled=!0,this}updateFacetData(){const v=this._internalAbstractMeshDataInfo._facetData;v.facetDataEnabled||this._initFacetData();const T=this.getVerticesData(m.e.PositionKind),X=this.Qe(),O=this.getVerticesData(m.e.NormalKind),u=this.getBoundingInfo();if(v.facetDepthSort&&!v.facetDepthSortEnabled){if(v.facetDepthSortEnabled=!0,X instanceof Uint16Array)v.depthSortedIndices=new Uint16Array(X);else if(X instanceof Uint32Array)v.depthSortedIndices=new Uint32Array(X);else{let T=!1;for(let v=0;v<X.length;v++)if(X[v]>65535){T=!0;break}v.depthSortedIndices=T?new Uint32Array(X):new Uint16Array(X)}if(v.facetDepthSortFunction=function(v,T){return T.sqDistance-v.sqDistance},!v.facetDepthSortFrom){const T=this.va().activeCamera;v.facetDepthSortFrom=T?T.position:B.l.Zero()}v.depthSortedFacets=[];for(let T=0;T<v.facetNb;T++){const X={ind:3*T,sqDistance:0};v.depthSortedFacets.push(X)}v.invertedMatrix=B.b.Identity(),v.facetDepthSortOrigin=B.l.Zero()}v.bbSize.x=u.maximum.x-u.minimum.x>F.c?u.maximum.x-u.minimum.x:F.c,v.bbSize.y=u.maximum.y-u.minimum.y>F.c?u.maximum.y-u.minimum.y:F.c,v.bbSize.z=u.maximum.z-u.minimum.z>F.c?u.maximum.z-u.minimum.z:F.c;let x=v.bbSize.x>v.bbSize.y?v.bbSize.x:v.bbSize.y;if(x=x>v.bbSize.z?x:v.bbSize.z,v.subDiv.max=v.partitioningSubdivisions,v.subDiv.X=Math.floor(v.subDiv.max*v.bbSize.x/x),v.subDiv.Y=Math.floor(v.subDiv.max*v.bbSize.y/x),v.subDiv.Z=Math.floor(v.subDiv.max*v.bbSize.z/x),v.subDiv.X=v.subDiv.X<1?1:v.subDiv.X,v.subDiv.Y=v.subDiv.Y<1?1:v.subDiv.Y,v.subDiv.Z=v.subDiv.Z<1?1:v.subDiv.Z,v.facetParameters.facetNormals=this.getFacetLocalNormals(),v.facetParameters.facetPositions=this.getFacetLocalPositions(),v.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),v.facetParameters.bInfo=u,v.facetParameters.bbSize=v.bbSize,v.facetParameters.subDiv=v.subDiv,v.facetParameters.ratio=this.partitioningBBoxRatio,v.facetParameters.depthSort=v.facetDepthSort,v.facetDepthSort&&v.facetDepthSortEnabled&&(this.Ke(!0),this._worldMatrix.invertToRef(v.invertedMatrix),B.l.TransformCoordinatesToRef(v.facetDepthSortFrom,v.invertedMatrix,v.facetDepthSortOrigin),v.facetParameters.distanceTo=v.facetDepthSortOrigin),v.facetParameters.depthSortedFacets=v.depthSortedFacets,O&&A.e.ComputeNormals(T,X,O,v.facetParameters),v.facetDepthSort&&v.facetDepthSortEnabled){v.depthSortedFacets.sort(v.facetDepthSortFunction);const T=v.depthSortedIndices.length/3|0;for(let O=0;O<T;O++){const T=v.depthSortedFacets[O].ind;v.depthSortedIndices[3*O]=X[T],v.depthSortedIndices[3*O+1]=X[T+1],v.depthSortedIndices[3*O+2]=X[T+2]}this.updateIndices(v.depthSortedIndices,void 0,!0)}return this}getFacetLocalNormals(){const v=this._internalAbstractMeshDataInfo._facetData;return v.facetNormals||this.updateFacetData(),v.facetNormals}getFacetLocalPositions(){const v=this._internalAbstractMeshDataInfo._facetData;return v.facetPositions||this.updateFacetData(),v.facetPositions}getFacetLocalPartitioning(){const v=this._internalAbstractMeshDataInfo._facetData;return v.facetPartitioning||this.updateFacetData(),v.facetPartitioning}getFacetPosition(v){const T=B.l.Zero();return this.getFacetPositionToRef(v,T),T}getFacetPositionToRef(v,T){const X=this.getFacetLocalPositions()[v],O=this.getWorldMatrix();return B.l.TransformCoordinatesToRef(X,O,T),this}getFacetNormal(v){const T=B.l.Zero();return this.getFacetNormalToRef(v,T),T}getFacetNormalToRef(v,T){const X=this.getFacetLocalNormals()[v];return B.l.TransformNormalToRef(X,this.getWorldMatrix(),T),this}getFacetsAtLocalCoordinates(v,T,X){const O=this.getBoundingInfo(),u=this._internalAbstractMeshDataInfo._facetData,B=Math.floor((v-O.minimum.x*u.partitioningBBoxRatio)*u.subDiv.X*u.partitioningBBoxRatio/u.bbSize.x),m=Math.floor((T-O.minimum.y*u.partitioningBBoxRatio)*u.subDiv.Y*u.partitioningBBoxRatio/u.bbSize.y),A=Math.floor((X-O.minimum.z*u.partitioningBBoxRatio)*u.subDiv.Z*u.partitioningBBoxRatio/u.bbSize.z);return B<0||B>u.subDiv.max||m<0||m>u.subDiv.max||A<0||A>u.subDiv.max?null:u.facetPartitioning[B+u.subDiv.max*m+u.subDiv.max*u.subDiv.max*A]}getClosestFacetAtCoordinates(v,T,X,O){let u=arguments.length>4&&void 0!==arguments[4]&&arguments[4],m=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const A=this.getWorldMatrix(),x=B.g.Matrix[5];A.invertToRef(x);const f=B.g.Vd[8];B.l.TransformCoordinatesFromFloatsToRef(v,T,X,x,f);const M=this.getClosestFacetAtLocalCoordinates(f.x,f.y,f.z,O,u,m);return O&&B.l.TransformCoordinatesFromFloatsToRef(O.x,O.y,O.z,A,O),M}getClosestFacetAtLocalCoordinates(v,T,X,O){let u=arguments.length>4&&void 0!==arguments[4]&&arguments[4],B=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],m=null,A=0,x=0,f=0,M=0,H=0,n=0,V=0,D=0;const s=this.getFacetLocalPositions(),F=this.getFacetLocalNormals(),k=this.getFacetsAtLocalCoordinates(v,T,X);if(!k)return null;let b,l,Q,K=Number.MAX_VALUE,p=K;for(let G=0;G<k.length;G++)b=k[G],l=F[b],Q=s[b],M=(v-Q.x)*l.x+(T-Q.y)*l.y+(X-Q.z)*l.z,(!u||u&&B&&M>=0||u&&!B&&M<=0)&&(M=l.x*Q.x+l.y*Q.y+l.z*Q.z,H=-(l.x*v+l.y*T+l.z*X-M)/(l.x*l.x+l.y*l.y+l.z*l.z),n=v+l.x*H,V=T+l.y*H,D=X+l.z*H,A=n-v,x=V-T,f=D-X,p=A*A+x*x+f*f,p<K&&(K=p,m=b,O&&(O.x=n,O.y=V,O.z=D)));return m}getFacetDataParameters(){return this._internalAbstractMeshDataInfo._facetData.facetParameters}disableFacetData(){const v=this._internalAbstractMeshDataInfo._facetData;return v.facetDataEnabled&&(v.facetDataEnabled=!1,v.facetPositions=[],v.facetNormals=[],v.facetPartitioning=new Array,v.facetParameters=null,v.depthSortedIndices=new Uint32Array(0)),this}updateIndices(v,T){return this}createNormals(v){const T=this.getVerticesData(m.e.PositionKind),X=this.Qe();let O;return O=this.isVerticesDataPresent(m.e.NormalKind)?this.getVerticesData(m.e.NormalKind):[],A.e.ComputeNormals(T,X,O,{useRightHandedSystem:this.va().useRightHandedSystem}),this.Ga(m.e.NormalKind,O,v),this}alignWithNormal(v,T){T||(T=k.c.Y);const X=B.g.Vd[0],O=B.g.Vd[1];return B.l.CrossToRef(T,v,O),B.l.CrossToRef(v,O,X),this.rotationQuaternion?B.f.RotationQuaternionFromAxisToRef(X,v,O,this.rotationQuaternion):B.l.RotationFromAxisToRef(X,v,O,this.rotation),this}_checkOcclusionQuery(){return!1}disableEdgesRendering(){throw(0,V.d)("EdgesRenderer")}enableEdgesRendering(v,T,X){throw(0,V.d)("EdgesRenderer")}xj(){return this._scene.Ae.filter((v=>v.k===this))}}G.OCCLUSION_TYPE_NONE=0,G.OCCLUSION_TYPE_OPTIMISTIC=1,G.OCCLUSION_TYPE_STRICT=2,G.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,G.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,G.CULLINGSTRATEGY_STANDARD=0,G.Ui=1,G.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,G.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,(0,O.c)([l.g.filter((function(){for(var v=arguments.length,T=new Array(v),X=0;X<v;X++)T[X]=arguments[X];let[O,u,B,m,A]=T;return!Array.isArray(O)&&!Array.isArray(u)&&!Array.isArray(B)&&!Array.isArray(m)&&!Array.isArray(A)}))],G,"_ApplySkeleton",null),(0,b.f)("BABYLON.AbstractMesh",G)},11942:(v,T,X)=>{"use strict";X.d(T,{e:()=>F});var O=X(1006),u=X(1170),B=X(11937),m=X(1261),A=X(1356),x=X(11945),f=X(1371),M=X(1217),H=X(1163),n=X(1381),V=X(1034),D=X(1194),s=X(1103);class F{get boundingBias(){return this._boundingBias}set boundingBias(v){this._boundingBias?this._boundingBias.p(v):this._boundingBias=v.clone(),this.Ea(!0,null)}static CreateGeometryForMesh(v){const T=new F(F.RandomId(),v.va());return T.Ca(v),T}get meshes(){return this._meshes}constructor(v,T,X){let O=arguments.length>3&&void 0!==arguments[3]&&arguments[3],u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this._positionsCache=[],this._parentContainer=null,this.useBoundingInfoFromGeometry=!1,this._scene=T||V.c.LastCreatedScene,this._scene&&(this.id=v,this.uniqueId=this._scene.getUniqueId(),this._engine=this._scene.getEngine(),this._meshes=[],this._vertexBuffers={},this._indices=[],this._updatable=O,X?this.setAllVerticesData(X,O):this._totalVertices=0,this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),u&&(this.Ca(u),u.Ke(!0)))}get extend(){return this._extend}va(){return this._scene}getEngine(){return this._engine}isReady(){return 1===this.delayLoadState||0===this.delayLoadState}get doNotSerialize(){for(let v=0;v<this._meshes.length;v++)if(!this._meshes[v].doNotSerialize)return!1;return!0}_rebuild(){this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer"));const v=new Set;for(const T in this._vertexBuffers)v.add(this._vertexBuffers[T].getWrapperBuffer());v.forEach((v=>{v._rebuild()}))}setAllVerticesData(v,T){v.applyToGeometry(this,T),this._notifyUpdate()}Ga(v,T){let X=arguments.length>2&&void 0!==arguments[2]&&arguments[2],O=arguments.length>3?arguments[3]:void 0;X&&Array.isArray(T)&&(T=new Float32Array(T));const u=new m.e(this._engine,T,v,{updatable:X,postponeInternalCreation:0===this._meshes.length,stride:O,label:"Geometry_"+this.id+"_"+v});this.setVerticesBuffer(u)}removeVerticesData(v){this._vertexBuffers[v]&&(this._vertexBuffers[v].dispose(),delete this._vertexBuffers[v]),this._vertexArrayObjects&&this._disposeVertexArrayObjects()}setVerticesBuffer(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,X=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const u=v.getKind();this._vertexBuffers[u]&&X&&this._vertexBuffers[u].dispose(),v._buffer&&v._buffer._increaseReferences(),this._vertexBuffers[u]=v;const B=this._meshes,A=B.length;if(u===m.e.PositionKind){this._totalVertices=T??v._maxVerticesCount,this._updateExtend(v.getFloatData(this._totalVertices)),this._resetPointsArrayCache();const X=this._extend&&this._extend.minimum||new O.l(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),u=this._extend&&this._extend.maximum||new O.l(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);for(let v=0;v<A;v++){const T=B[v];T.buildBoundingInfo(X,u),T._createGlobalSubMesh(T.isUnIndexed),T.Ke(!0),T.synchronizeInstances()}}this._notifyUpdate(u)}updateVerticesDataDirectly(v,T,X){let O=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const u=this.getVertexBuffer(v);u&&(u.updateDirectly(T,X,O),this._notifyUpdate(v))}updateVerticesData(v,T){let X=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const O=this.getVertexBuffer(v);O&&(O.update(T),v===m.e.PositionKind&&this.Ea(X,T),this._notifyUpdate(v))}Ea(v,T){if(v&&this._updateExtend(T),this._resetPointsArrayCache(),v){const v=this._meshes;for(const T of v){T.hasBoundingInfo?T.getBoundingInfo().reConstruct(this._extend.minimum,this._extend.maximum):T.buildBoundingInfo(this._extend.minimum,this._extend.maximum);const v=T.Ce;for(const T of v)T.refreshBoundingInfo()}}}_bind(v,T,X,O){if(!v)return;void 0===T&&(T=this._indexBuffer);const u=this.getVertexBuffers();if(!u)return;if(T!=this._indexBuffer||!this._vertexArrayObjects&&!O)return void this._engine.bindBuffers(u,T,v,X);const B=O||this._vertexArrayObjects,m=this._engine;B[v.key]||(B[v.key]=m.recordVertexArrayObject(u,T,v,X)),m.bindVertexArrayObject(B[v.key],T)}getTotalVertices(){return this.isReady()?this._totalVertices:0}getVerticesData(v,T,X){const O=this.getVertexBuffer(v);return O?O.getFloatData(this._totalVertices,X||T&&1!==this._meshes.length):null}copyVerticesData(v,T){const X=this.getVertexBuffer(v);if(!X)return;T[v]||(T[v]=new Float32Array(this._totalVertices*X.getSize()));const O=X.getData();O&&function(v,T,X,O,u,B,A,x){const f=T*m.e.GetTypeByteLength(X),M=A*T;if(x.length!==M)throw new Error("Output length is not valid");if(X===m.e.FLOAT&&u===f)if(v instanceof Array){const T=O/4;x.set(v,T)}else if(v instanceof ArrayBuffer){const T=new Float32Array(v,O,M);x.set(T)}else{const T=v.byteOffset+O;if(T%4)return s.d.Warn("CopyFloatData: copied misaligned data."),void x.set(new Float32Array(v.buffer.slice(T,T+4*M)));const X=new Float32Array(v.buffer,T,M);x.set(X)}else m.e.ForEach(v,O,u,T,X,M,B,((v,T)=>x[T]=v))}(O,X.getSize(),X.type,X.byteOffset,X.byteStride,X.normalized,this._totalVertices,T[v])}isVertexBufferUpdatable(v){const T=this._vertexBuffers[v];return!!T&&T.isUpdatable()}getVertexBuffer(v){return this.isReady()?this._vertexBuffers[v]:null}getVertexBuffers(){return this.isReady()?this._vertexBuffers:null}isVerticesDataPresent(v){return this._vertexBuffers?void 0!==this._vertexBuffers[v]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(v)}getVerticesDataKinds(){const v=[];let T;if(!this._vertexBuffers&&this._delayInfo)for(T in this._delayInfo)v.push(T);else for(T in this._vertexBuffers)v.push(T);return v}updateIndices(v,T){let X=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._indexBuffer)if(this._indexBufferIsUpdatable){const O=v.length!==this._indices.length;if(X||(this._indices=v.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,v,T),O)for(const v of this._meshes)v._createGlobalSubMesh(!0)}else this.setIndices(v,null,!0)}setIndexBuffer(v,T,X){this._indices=[],this._indexBufferIsUpdatable=!1,this._indexBuffer=v,this._totalVertices=T,this._totalIndices=X,v.is32Bits||(v.is32Bits=this._totalIndices>65535);for(const O of this._meshes)O._createGlobalSubMesh(!0),O.synchronizeInstances();this._notifyUpdate()}setIndices(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,X=arguments.length>2&&void 0!==arguments[2]&&arguments[2],O=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=v,this._indexBufferIsUpdatable=X,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,X,"Geometry_"+this.id+"_IndexBuffer")),void 0!=T&&(this._totalVertices=T);for(const u of this._meshes)u._createGlobalSubMesh(!O),u.synchronizeInstances();this._notifyUpdate()}getTotalIndices(){return this.isReady()?void 0!==this._totalIndices?this._totalIndices:this._indices.length:0}Qe(v,T){if(!this.isReady())return null;const X=this._indices;return T||v&&1!==this._meshes.length?X.slice():X}getIndexBuffer(){return this.isReady()?this._indexBuffer:null}_releaseVertexArrayObject(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;v&&this._vertexArrayObjects&&this._vertexArrayObjects[v.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[v.key]),delete this._vertexArrayObjects[v.key])}releaseForMesh(v,T){const X=this._meshes,O=X.indexOf(v);-1!==O&&(X.splice(O,1),this._vertexArrayObjects&&v._invalidateInstanceVertexArrayObject(),v._geometry=null,0===X.length&&T&&this.dispose())}Ca(v){if(v._geometry===this)return;const T=v._geometry;T&&T.releaseForMesh(v),this._vertexArrayObjects&&v._invalidateInstanceVertexArrayObject();const X=this._meshes;v._geometry=this,v._internalAbstractMeshDataInfo._positions=null,this._scene.pushGeometry(this),X.push(v),this.isReady()?this._applyToMesh(v):this._boundingInfo&&v.setBoundingInfo(this._boundingInfo)}_updateExtend(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.useBoundingInfoFromGeometry&&this._boundingInfo)this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()};else{if(!v&&(v=this.getVerticesData(m.e.PositionKind),!v))return;this._extend=(0,n.f)(v,0,this._totalVertices,this.boundingBias,3)}}_applyToMesh(v){const T=this._meshes.length;for(const X in this._vertexBuffers)1===T&&this._vertexBuffers[X].create(),X===m.e.PositionKind&&(this._extend||this._updateExtend(),v.buildBoundingInfo(this._extend.minimum,this._extend.maximum),v._createGlobalSubMesh(v.isUnIndexed),v.Ea());1===T&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer")),v._syncGeometryWithMorphTargetManager(),v.synchronizeInstances()}_notifyUpdate(v){this.onGeometryUpdated&&this.onGeometryUpdated(this,v),this._vertexArrayObjects&&this._disposeVertexArrayObjects();for(const T of this._meshes)T._markSubMeshesAsAttributesDirty()}load(v,T){2!==this.delayLoadState&&(this.isReady()?T&&T():(this.delayLoadState=2,this._queueLoad(v,T)))}_queueLoad(v,T){this.delayLoadingFile&&(v.addPendingData(this),v._loadFile(this.delayLoadingFile,(X=>{if(!this._delayLoadingFunction)return;this._delayLoadingFunction(JSON.parse(X),this),this.delayLoadState=1,this._delayInfo=[],v.removePendingData(this);const O=this._meshes,u=O.length;for(let v=0;v<u;v++)this._applyToMesh(O[v]);T&&T()}),void 0,!0))}toLeftHanded(){const v=this.Qe(!1);if(null!=v&&v.length>0){for(let T=0;T<v.length;T+=3){const X=v[T+0];v[T+0]=v[T+2],v[T+2]=X}this.setIndices(v)}const T=this.getVerticesData(m.e.PositionKind,!1);if(null!=T&&T.length>0){for(let v=0;v<T.length;v+=3)T[v+2]=-T[v+2];this.Ga(m.e.PositionKind,T,!1)}const X=this.getVerticesData(m.e.NormalKind,!1);if(null!=X&&X.length>0){for(let v=0;v<X.length;v+=3)X[v+2]=-X[v+2];this.Ga(m.e.NormalKind,X,!1)}}_resetPointsArrayCache(){this._positions=null}_generatePointsArray(){if(this._positions)return!0;const v=this.getVerticesData(m.e.PositionKind);if(!v||0===v.length)return!1;for(let T=3*this._positionsCache.length,X=this._positionsCache.length;T<v.length;T+=3,++X)this._positionsCache[X]=O.l.Ld(v,T);for(let T=0,X=0;T<v.length;T+=3,++X)this._positionsCache[X].set(v[0+T],v[1+T],v[2+T]);return this._positionsCache.length=v.length/3,this._positions=this._positionsCache,!0}u(){return this._isDisposed}_disposeVertexArrayObjects(){if(this._vertexArrayObjects){for(const X in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[X]);this._vertexArrayObjects={};const v=this._meshes,T=v.length;for(let X=0;X<T;X++)v[X]._invalidateInstanceVertexArrayObject()}}dispose(){const v=this._meshes,T=v.length;let X;for(X=0;X<T;X++)this.releaseForMesh(v[X]);this._meshes.length=0,this._disposeVertexArrayObjects();for(const O in this._vertexBuffers)this._vertexBuffers[O].dispose();if(this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._parentContainer){const v=this._parentContainer.geometries.indexOf(this);v>-1&&this._parentContainer.geometries.splice(v,1),this._parentContainer=null}this._isDisposed=!0}j(v){const T=new B.e;T.indices=[];const X=this.Qe();if(X)for(let B=0;B<X.length;B++)T.indices.push(X[B]);let O,u=!1,m=!1;for(O in this._vertexBuffers){const v=this.getVerticesData(O);if(v&&(v instanceof Float32Array?T.set(new Float32Array(v),O):T.set(v.slice(0),O),!m)){const v=this.getVertexBuffer(O);v&&(u=v.isUpdatable(),m=!u)}}const A=new F(v,this._scene,T,u);for(O in A.delayLoadState=this.delayLoadState,A.delayLoadingFile=this.delayLoadingFile,A._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)A._delayInfo=A._delayInfo||[],A._delayInfo.push(O);return A._boundingInfo=new f.c(this._extend.minimum,this._extend.maximum),A}serialize(){const v={};return v.id=this.id,v.uniqueId=this.uniqueId,v.updatable=this._updatable,H.d&&H.d.HasTags(this)&&(v.tags=H.d.GetTags(this)),v}_toNumberArray(v){return Array.isArray(v)?v:Array.prototype.slice.call(v)}clearCachedData(){this._indices=[],this._resetPointsArrayCache();for(const v in this._vertexBuffers)Object.prototype.hasOwnProperty.call(this._vertexBuffers,v)&&(this._vertexBuffers[v]._buffer._data=null)}serializeVerticeData(){const v=this.serialize();return this.isVerticesDataPresent(m.e.PositionKind)&&(v.xa=this._toNumberArray(this.getVerticesData(m.e.PositionKind)),this.isVertexBufferUpdatable(m.e.PositionKind)&&(v.xa._updatable=!0)),this.isVerticesDataPresent(m.e.NormalKind)&&(v.ya=this._toNumberArray(this.getVerticesData(m.e.NormalKind)),this.isVertexBufferUpdatable(m.e.NormalKind)&&(v.ya._updatable=!0)),this.isVerticesDataPresent(m.e.TangentKind)&&(v.tangents=this._toNumberArray(this.getVerticesData(m.e.TangentKind)),this.isVertexBufferUpdatable(m.e.TangentKind)&&(v.tangents._updatable=!0)),this.isVerticesDataPresent(m.e.UVKind)&&(v.Aa=this._toNumberArray(this.getVerticesData(m.e.UVKind)),this.isVertexBufferUpdatable(m.e.UVKind)&&(v.Aa._updatable=!0)),this.isVerticesDataPresent(m.e.UV2Kind)&&(v.uvs2=this._toNumberArray(this.getVerticesData(m.e.UV2Kind)),this.isVertexBufferUpdatable(m.e.UV2Kind)&&(v.uvs2._updatable=!0)),this.isVerticesDataPresent(m.e.UV3Kind)&&(v.uvs3=this._toNumberArray(this.getVerticesData(m.e.UV3Kind)),this.isVertexBufferUpdatable(m.e.UV3Kind)&&(v.uvs3._updatable=!0)),this.isVerticesDataPresent(m.e.UV4Kind)&&(v.uvs4=this._toNumberArray(this.getVerticesData(m.e.UV4Kind)),this.isVertexBufferUpdatable(m.e.UV4Kind)&&(v.uvs4._updatable=!0)),this.isVerticesDataPresent(m.e.UV5Kind)&&(v.uvs5=this._toNumberArray(this.getVerticesData(m.e.UV5Kind)),this.isVertexBufferUpdatable(m.e.UV5Kind)&&(v.uvs5._updatable=!0)),this.isVerticesDataPresent(m.e.UV6Kind)&&(v.uvs6=this._toNumberArray(this.getVerticesData(m.e.UV6Kind)),this.isVertexBufferUpdatable(m.e.UV6Kind)&&(v.uvs6._updatable=!0)),this.isVerticesDataPresent(m.e.ColorKind)&&(v.za=this._toNumberArray(this.getVerticesData(m.e.ColorKind)),this.isVertexBufferUpdatable(m.e.ColorKind)&&(v.za._updatable=!0)),this.isVerticesDataPresent(m.e.MatricesIndicesKind)&&(v.matricesIndices=this._toNumberArray(this.getVerticesData(m.e.MatricesIndicesKind)),v.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(m.e.MatricesIndicesKind)&&(v.matricesIndices._updatable=!0)),this.isVerticesDataPresent(m.e.MatricesWeightsKind)&&(v.matricesWeights=this._toNumberArray(this.getVerticesData(m.e.MatricesWeightsKind)),this.isVertexBufferUpdatable(m.e.MatricesWeightsKind)&&(v.matricesWeights._updatable=!0)),v.indices=this._toNumberArray(this.Qe()),v}static ExtractFromMesh(v,T){const X=v._geometry;return X?X.j(T):null}static RandomId(){return M.c.RandomId()}static _GetGeometryByLoadedUniqueId(v,T){for(let X=0;X<T.geometries.length;X++)if(T.geometries[X]._loadedUniqueId===v)return T.geometries[X];return null}static _ImportGeometry(v,T){const X=T.va(),O=v.geometryUniqueId,B=v.geometryId;if(O||B){const v=O?this._GetGeometryByLoadedUniqueId(O,X):X.getGeometryById(B);v&&v.Ca(T)}else if(v instanceof ArrayBuffer){const X=T._binaryInfo;if(X.positionsAttrDesc&&X.positionsAttrDesc.count>0){const O=new Float32Array(v,X.positionsAttrDesc.offset,X.positionsAttrDesc.count);T.Ga(m.e.PositionKind,O,!1)}if(X.normalsAttrDesc&&X.normalsAttrDesc.count>0){const O=new Float32Array(v,X.normalsAttrDesc.offset,X.normalsAttrDesc.count);T.Ga(m.e.NormalKind,O,!1)}if(X.tangetsAttrDesc&&X.tangetsAttrDesc.count>0){const O=new Float32Array(v,X.tangetsAttrDesc.offset,X.tangetsAttrDesc.count);T.Ga(m.e.TangentKind,O,!1)}if(X.uvsAttrDesc&&X.uvsAttrDesc.count>0){const O=new Float32Array(v,X.uvsAttrDesc.offset,X.uvsAttrDesc.count);if(D.d)for(let v=1;v<O.length;v+=2)O[v]=1-O[v];T.Ga(m.e.UVKind,O,!1)}if(X.uvs2AttrDesc&&X.uvs2AttrDesc.count>0){const O=new Float32Array(v,X.uvs2AttrDesc.offset,X.uvs2AttrDesc.count);if(D.d)for(let v=1;v<O.length;v+=2)O[v]=1-O[v];T.Ga(m.e.UV2Kind,O,!1)}if(X.uvs3AttrDesc&&X.uvs3AttrDesc.count>0){const O=new Float32Array(v,X.uvs3AttrDesc.offset,X.uvs3AttrDesc.count);if(D.d)for(let v=1;v<O.length;v+=2)O[v]=1-O[v];T.Ga(m.e.UV3Kind,O,!1)}if(X.uvs4AttrDesc&&X.uvs4AttrDesc.count>0){const O=new Float32Array(v,X.uvs4AttrDesc.offset,X.uvs4AttrDesc.count);if(D.d)for(let v=1;v<O.length;v+=2)O[v]=1-O[v];T.Ga(m.e.UV4Kind,O,!1)}if(X.uvs5AttrDesc&&X.uvs5AttrDesc.count>0){const O=new Float32Array(v,X.uvs5AttrDesc.offset,X.uvs5AttrDesc.count);if(D.d)for(let v=1;v<O.length;v+=2)O[v]=1-O[v];T.Ga(m.e.UV5Kind,O,!1)}if(X.uvs6AttrDesc&&X.uvs6AttrDesc.count>0){const O=new Float32Array(v,X.uvs6AttrDesc.offset,X.uvs6AttrDesc.count);if(D.d)for(let v=1;v<O.length;v+=2)O[v]=1-O[v];T.Ga(m.e.UV6Kind,O,!1)}if(X.colorsAttrDesc&&X.colorsAttrDesc.count>0){const O=new Float32Array(v,X.colorsAttrDesc.offset,X.colorsAttrDesc.count);T.Ga(m.e.ColorKind,O,!1,X.colorsAttrDesc.stride)}if(X.matricesIndicesAttrDesc&&X.matricesIndicesAttrDesc.count>0){const O=new Int32Array(v,X.matricesIndicesAttrDesc.offset,X.matricesIndicesAttrDesc.count),u=[];for(let v=0;v<O.length;v++){const T=O[v];u.push(255&T),u.push((65280&T)>>8),u.push((16711680&T)>>16),u.push(T>>24&255)}T.Ga(m.e.MatricesIndicesKind,u,!1)}if(X.matricesIndicesExtraAttrDesc&&X.matricesIndicesExtraAttrDesc.count>0){const O=new Int32Array(v,X.matricesIndicesExtraAttrDesc.offset,X.matricesIndicesExtraAttrDesc.count),u=[];for(let v=0;v<O.length;v++){const T=O[v];u.push(255&T),u.push((65280&T)>>8),u.push((16711680&T)>>16),u.push(T>>24&255)}T.Ga(m.e.MatricesIndicesExtraKind,u,!1)}if(X.matricesWeightsAttrDesc&&X.matricesWeightsAttrDesc.count>0){const O=new Float32Array(v,X.matricesWeightsAttrDesc.offset,X.matricesWeightsAttrDesc.count);T.Ga(m.e.MatricesWeightsKind,O,!1)}if(X.indicesAttrDesc&&X.indicesAttrDesc.count>0){const O=new Int32Array(v,X.indicesAttrDesc.offset,X.indicesAttrDesc.count);T.setIndices(O,null)}if(X.subMeshesAttrDesc&&X.subMeshesAttrDesc.count>0){const O=new Int32Array(v,X.subMeshesAttrDesc.offset,5*X.subMeshesAttrDesc.count);T.Ce=[];for(let v=0;v<X.subMeshesAttrDesc.count;v++){const X=O[5*v+0],u=O[5*v+1],B=O[5*v+2],m=O[5*v+3],x=O[5*v+4];A.c.AddToMesh(X,u,B,m,x,T)}}}else if(v.xa&&v.ya&&v.indices){if(T.Ga(m.e.PositionKind,v.xa,v.xa._updatable),T.Ga(m.e.NormalKind,v.ya,v.ya._updatable),v.tangents&&T.Ga(m.e.TangentKind,v.tangents,v.tangents._updatable),v.Aa&&T.Ga(m.e.UVKind,v.Aa,v.Aa._updatable),v.uvs2&&T.Ga(m.e.UV2Kind,v.uvs2,v.uvs2._updatable),v.uvs3&&T.Ga(m.e.UV3Kind,v.uvs3,v.uvs3._updatable),v.uvs4&&T.Ga(m.e.UV4Kind,v.uvs4,v.uvs4._updatable),v.uvs5&&T.Ga(m.e.UV5Kind,v.uvs5,v.uvs5._updatable),v.uvs6&&T.Ga(m.e.UV6Kind,v.uvs6,v.uvs6._updatable),v.za&&T.Ga(m.e.ColorKind,u.g.CheckColors4(v.za,v.xa.length/3),v.za._updatable),v.matricesIndices)if(v.matricesIndices._isExpanded)delete v.matricesIndices._isExpanded,T.Ga(m.e.MatricesIndicesKind,v.matricesIndices,v.matricesIndices._updatable);else{const X=[];for(let T=0;T<v.matricesIndices.length;T++){const O=v.matricesIndices[T];X.push(255&O),X.push((65280&O)>>8),X.push((16711680&O)>>16),X.push(O>>24&255)}T.Ga(m.e.MatricesIndicesKind,X,v.matricesIndices._updatable)}if(v.matricesIndicesExtra)if(v.matricesIndicesExtra._isExpanded)delete v.matricesIndices._isExpanded,T.Ga(m.e.MatricesIndicesExtraKind,v.matricesIndicesExtra,v.matricesIndicesExtra._updatable);else{const X=[];for(let T=0;T<v.matricesIndicesExtra.length;T++){const O=v.matricesIndicesExtra[T];X.push(255&O),X.push((65280&O)>>8),X.push((16711680&O)>>16),X.push(O>>24&255)}T.Ga(m.e.MatricesIndicesExtraKind,X,v.matricesIndicesExtra._updatable)}v.matricesWeights&&(F._CleanMatricesWeights(v,T),T.Ga(m.e.MatricesWeightsKind,v.matricesWeights,v.matricesWeights._updatable)),v.matricesWeightsExtra&&T.Ga(m.e.MatricesWeightsExtraKind,v.matricesWeightsExtra,v.matricesWeights._updatable),T.setIndices(v.indices,null)}if(v.Ce){T.Ce=[];for(let X=0;X<v.Ce.length;X++){const O=v.Ce[X];A.c.AddToMesh(O.materialIndex,O.verticesStart,O.verticesCount,O.indexStart,O.indexCount,T)}}T._shouldGenerateFlatShading&&(T.convertToFlatShadedMesh(),T._shouldGenerateFlatShading=!1),T.Ke(!0),X.onMeshImportedObservable.notifyObservers(T)}static _CleanMatricesWeights(v,T){const X=.001;if(!x.c.CleanBoneMatrixWeights)return;let O=0;if(!(v.skeletonId>-1))return;{const X=T.va().getLastSkeletonById(v.skeletonId);if(!X)return;O=X.bones.length}const u=T.getVerticesData(m.e.MatricesIndicesKind),B=T.getVerticesData(m.e.MatricesIndicesExtraKind),A=v.matricesWeights,f=v.matricesWeightsExtra,M=v.numBoneInfluencer,H=A.length;for(let m=0;m<H;m+=4){let v=0,T=-1;for(let O=0;O<4;O++){const u=A[m+O];v+=u,u<X&&T<0&&(T=O)}if(f)for(let O=0;O<4;O++){const u=f[m+O];v+=u,u<X&&T<0&&(T=O+4)}if((T<0||T>M-1)&&(T=M-1),v>X){const T=1/v;for(let v=0;v<4;v++)A[m+v]*=T;if(f)for(let v=0;v<4;v++)f[m+v]*=T}else T>=4?(f[m+T-4]=1-v,B[m+T-4]=O):(A[m+T]=1-v,u[m+T]=O)}T.Ga(m.e.MatricesIndicesKind,u),v.matricesWeightsExtra&&T.Ga(m.e.MatricesIndicesExtraKind,B)}static Parse(v,T,X){const u=new F(v.id,T,void 0,v.updatable);return u._loadedUniqueId=v.uniqueId,H.d&&H.d.AddTagsTo(u,v.tags),v.delayLoadingFile?(u.delayLoadState=4,u.delayLoadingFile=X+v.delayLoadingFile,u._boundingInfo=new f.c(O.l.Ld(v.boundingBoxMinimum),O.l.Ld(v.boundingBoxMaximum)),u._delayInfo=[],v.hasUVs&&u._delayInfo.push(m.e.UVKind),v.hasUVs2&&u._delayInfo.push(m.e.UV2Kind),v.hasUVs3&&u._delayInfo.push(m.e.UV3Kind),v.hasUVs4&&u._delayInfo.push(m.e.UV4Kind),v.hasUVs5&&u._delayInfo.push(m.e.UV5Kind),v.hasUVs6&&u._delayInfo.push(m.e.UV6Kind),v.hasColors&&u._delayInfo.push(m.e.ColorKind),v.hasMatricesIndices&&u._delayInfo.push(m.e.MatricesIndicesKind),v.hasMatricesWeights&&u._delayInfo.push(m.e.MatricesWeightsKind),u._delayLoadingFunction=B.e.ImportVertexData):B.e.ImportVertexData(v,u),T.pushGeometry(u,!0),u}}},12563:(v,T,X)=>{"use strict";X.d(T,{c:()=>n});var O=X(1006),u=X(1103),B=X(11951),m=X(11911),A=X(1223),x=X(11955),f=X(1261),M=X(1217),H=X(1023);m.d._instancedMeshFactory=(v,T)=>{const X=new n(v,T);if(T.instancedBuffers){X.instancedBuffers={};for(const v in T.instancedBuffers)X.instancedBuffers[v]=T.instancedBuffers[v]}return X};class n extends B.c{constructor(v,T){super(v,T.va()),this._indexInSourceMeshInstanceArray=-1,this._distanceToCamera=0,T.Lj(this),this._sourceMesh=T,this._unIndexed=T._unIndexed,this.position.p(T.position),this.rotation.p(T.rotation),this.Zd.p(T.Zd),T.rotationQuaternion&&(this.rotationQuaternion=T.rotationQuaternion.clone()),this.animations=T.animations.slice();for(const X of T.getAnimationRanges())null!=X&&this.createAnimationRange(X.name,X.from,X.to);this.infiniteDistance=T.infiniteDistance,this.setPivotMatrix(T.getPivotMatrix()),this.refreshBoundingInfo(!0,!0),this._syncSubMeshes()}getClassName(){return"InstancedMesh"}get lightSources(){return this._sourceMesh._lightSources}_resyncLightSources(){}_resyncLightSource(){}_removeLightSource(){}get receiveShadows(){return this._sourceMesh.receiveShadows}set receiveShadows(v){var T;(null===(T=this._sourceMesh)||void 0===T?void 0:T.receiveShadows)!==v&&M.c.Warn("Setting receiveShadows on an instanced mesh has no effect")}get material(){return this._sourceMesh.material}set material(v){var T;(null===(T=this._sourceMesh)||void 0===T?void 0:T.material)!==v&&M.c.Warn("Setting material on an instanced mesh has no effect")}get visibility(){return this._sourceMesh.visibility}set visibility(v){var T;(null===(T=this._sourceMesh)||void 0===T?void 0:T.visibility)!==v&&M.c.Warn("Setting visibility on an instanced mesh has no effect")}get skeleton(){return this._sourceMesh.skeleton}set skeleton(v){var T;(null===(T=this._sourceMesh)||void 0===T?void 0:T.skeleton)!==v&&M.c.Warn("Setting skeleton on an instanced mesh has no effect")}get renderingGroupId(){return this._sourceMesh.renderingGroupId}set renderingGroupId(v){this._sourceMesh&&v!==this._sourceMesh.renderingGroupId&&u.d.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")}getTotalVertices(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0}getTotalIndices(){return this._sourceMesh.getTotalIndices()}get sourceMesh(){return this._sourceMesh}Jb(v){return this._sourceMesh.Jb(v)}isReady(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._sourceMesh.isReady(v,!0)}getVerticesData(v,T,X){return this._sourceMesh.getVerticesData(v,T,X)}copyVerticesData(v,T){this._sourceMesh.copyVerticesData(v,T)}Ga(v,T,X,O){return this.sourceMesh&&this.sourceMesh.Ga(v,T,X,O),this.sourceMesh}updateVerticesData(v,T,X,O){return this.sourceMesh&&this.sourceMesh.updateVerticesData(v,T,X,O),this.sourceMesh}setIndices(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.sourceMesh&&this.sourceMesh.setIndices(v,T),this.sourceMesh}isVerticesDataPresent(v){return this._sourceMesh.isVerticesDataPresent(v)}Qe(){return this._sourceMesh.Qe()}get _positions(){return this._sourceMesh._positions}refreshBoundingInfo(){let v,T=arguments.length>0&&void 0!==arguments[0]&&arguments[0],X=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;v="object"===typeof T?T:{applySkeleton:T,applyMorph:X};const O=this._sourceMesh.Ne?this._sourceMesh.Ne.boundingBias:null;return this.Fa(this._sourceMesh._getData(v,null,f.e.PositionKind),O),this}_preActivate(){return this._currentLOD&&this._currentLOD._preActivate(),this}_activate(v,T){if(super._activate(v,T),this._sourceMesh.Ce||u.d.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!==this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,v),T){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1}_postActivate(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)}getWorldMatrix(){if(this._currentLOD&&this._currentLOD.billboardMode!==x.c.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new O.b);const v=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,O.g.Vd[7].p(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.p(this._currentLOD.Ke(!0)),this._currentLOD.position.p(O.g.Vd[7]),this._currentLOD._masterMesh=v,this._billboardWorldMatrix}return super.getWorldMatrix()}get isAnInstance(){return!0}getLOD(v){if(!v)return this;const T=this.sourceMesh.getLODLevels();if(T&&0!==T.length){const T=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(v,T.boundingSphere)}else this._currentLOD=this.sourceMesh;return this._currentLOD}_preActivateForIntermediateRendering(v){return this.sourceMesh._preActivateForIntermediateRendering(v)}_syncSubMeshes(){if(this.releaseSubMeshes(),this._sourceMesh.Ce)for(let v=0;v<this._sourceMesh.Ce.length;v++)this._sourceMesh.Ce[v].clone(this,this._sourceMesh);return this}_generatePointsArray(){return this._sourceMesh._generatePointsArray()}Ea(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}clone(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,X=arguments.length>2?arguments[2]:void 0;const O=((arguments.length>3?arguments[3]:void 0)||this._sourceMesh).Jb(v);if(A.d.DeepCopy(this,O,["name","Ce","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","wj","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo"],[]),this.refreshBoundingInfo(),T&&(O.parent=T),!X)for(let u=0;u<this.va().meshes.length;u++){const v=this.va().meshes[u];v.parent===this&&v.clone(v.name,O)}return O.Ke(!0),this.onClonedObservable.notifyObservers(O),O}dispose(v){let T=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._sourceMesh.Kj(this),super.dispose(v,T)}_serializeAsParent(v){super._serializeAsParent(v),v.parentId=this._sourceMesh.uniqueId,v.parentInstanceIndex=this._indexInSourceMeshInstanceArray}instantiateHierarchy(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,T=arguments.length>1?arguments[1]:void 0,X=arguments.length>2?arguments[2]:void 0;const O=this.clone("Clone of "+(this.name||this.id),v||this.parent,!0,T&&T.newSourcedMesh);O&&X&&X(this,O);for(const u of this.getChildTransformNodes(!0))u.instantiateHierarchy(O,T,X);return O}}m.d.prototype.registerInstancedBuffer=function(v,T){var X,O;if(null===(X=this._userInstancedBuffersStorage)||void 0===X||null===(O=X.vertexBuffers[v])||void 0===O||O.dispose(),!this.instancedBuffers){this.instancedBuffers={};for(const v of this.instances)v.instancedBuffers={}}this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this.instancedBuffers[v]=null,this._userInstancedBuffersStorage.strides[v]=T,this._userInstancedBuffersStorage.sizes[v]=32*T,this._userInstancedBuffersStorage.data[v]=new Float32Array(this._userInstancedBuffersStorage.sizes[v]),this._userInstancedBuffersStorage.vertexBuffers[v]=new f.e(this.getEngine(),this._userInstancedBuffersStorage.data[v],v,!0,!1,T,!0);for(const u of this.instances)u.instancedBuffers[v]=null;this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()},m.d.prototype._processInstancedBuffers=function(v,T){const X=v?v.length:0;for(const O in this.instancedBuffers){let u=this._userInstancedBuffersStorage.sizes[O];const B=this._userInstancedBuffersStorage.strides[O],m=(X+1)*B;for(;u<m;)u*=2;this._userInstancedBuffersStorage.data[O].length!=u&&(this._userInstancedBuffersStorage.data[O]=new Float32Array(u),this._userInstancedBuffersStorage.sizes[O]=u,this._userInstancedBuffersStorage.vertexBuffers[O]&&(this._userInstancedBuffersStorage.vertexBuffers[O].dispose(),this._userInstancedBuffersStorage.vertexBuffers[O]=null));const A=this._userInstancedBuffersStorage.data[O];let x=0;if(T){const v=this.instancedBuffers[O];v.toArray?v.toArray(A,x):v.copyToArray?v.copyToArray(A,x):A[x]=v,x+=B}for(let T=0;T<X;T++){const X=v[T].instancedBuffers[O];X.toArray?X.toArray(A,x):X.copyToArray?X.copyToArray(A,x):A[x]=X,x+=B}this._userInstancedBuffersStorage.vertexBuffers[O]?this._userInstancedBuffersStorage.vertexBuffers[O].updateDirectly(A,0):(this._userInstancedBuffersStorage.vertexBuffers[O]=new f.e(this.getEngine(),this._userInstancedBuffersStorage.data[O],O,!0,!1,B,!0),this._invalidateInstanceVertexArrayObject())}},m.d.prototype._invalidateInstanceVertexArrayObject=function(){if(this._userInstancedBuffersStorage&&void 0!==this._userInstancedBuffersStorage.vertexArrayObjects){for(const v in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[v]);this._userInstancedBuffersStorage.vertexArrayObjects={}}},m.d.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(const v in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[v]&&this._userInstancedBuffersStorage.vertexBuffers[v].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}},(0,H.f)("BABYLON.InstancedMesh",n)},11911:(v,T,X)=>{"use strict";X.d(T,{d:()=>P,g:()=>o});var O=X(1001),u=X(1217),B=X(1223),m=X(1163),A=X(11916),x=X(11921),f=X(1006),M=X(1170),H=X(11928),n=X(1261),V=X(11937),D=X(11942),s=X(11951),F=X(1356),k=X(1352),b=X(11964),l=X(11945),Q=X(1156),K=X(1103),p=X(1023),G=X(1095),L=X(1290);class r{constructor(v,T){this.distanceOrScreenCoverage=v,this.mesh=T}}class o{}class Z{constructor(){this.visibleInstances={},this.batchCache=new U,this.batchCacheReplacementModeInFrozenMode=new U,this.instancesBufferSize=2048}}class U{constructor(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=[],this.hardwareInstancedRendering=[]}}class J{constructor(){this.instancesCount=0,this.matrixBuffer=null,this.previousMatrixBuffer=null,this.matrixBufferSize=512,this.matrixData=null,this.boundingVectors=[],this.worldMatrices=null}}class y{constructor(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._useLODScreenCoverage=!1,this._effectiveMaterial=null,this._forcedInstanceCount=0,this._overrideRenderingFillMode=null}}class P extends s.c{static _GetDefaultSideOrientation(v){return v||P.FRONTSIDE}get useLODScreenCoverage(){return this._internalMeshDataInfo._useLODScreenCoverage}set useLODScreenCoverage(v){this._internalMeshDataInfo._useLODScreenCoverage=v,this._sortLODLevels()}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(v){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==v&&(v&&this._internalMeshDataInfo._sourcePositions&&(this.Ga(n.e.PositionKind,this._internalMeshDataInfo._sourcePositions,!0),this._internalMeshDataInfo._sourceNormals&&this.Ga(n.e.NormalKind,this._internalMeshDataInfo._sourceNormals,!0),this._internalMeshDataInfo._sourcePositions=null,this._internalMeshDataInfo._sourceNormals=null),this._internalAbstractMeshDataInfo._computeBonesUsingShaders=v,this._markSubMeshesAsAttributesDirty())}get onBeforeRenderObservable(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new O.b),this._internalMeshDataInfo._onBeforeRenderObservable}get onBeforeBindObservable(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new O.b),this._internalMeshDataInfo._onBeforeBindObservable}get onAfterRenderObservable(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new O.b),this._internalMeshDataInfo._onAfterRenderObservable}get onBetweenPassObservable(){return this._internalMeshDataInfo._onBetweenPassObservable||(this._internalMeshDataInfo._onBetweenPassObservable=new O.b),this._internalMeshDataInfo._onBetweenPassObservable}get onBeforeDrawObservable(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new O.b),this._internalMeshDataInfo._onBeforeDrawObservable}set onBeforeDraw(v){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(v)}get hasInstances(){return this.instances.length>0}get hasThinInstances(){return(this.forcedInstanceCount||this._thinInstanceDataStorage.instancesCount||0)>0}get forcedInstanceCount(){return this._internalMeshDataInfo._forcedInstanceCount}set forcedInstanceCount(v){this._internalMeshDataInfo._forcedInstanceCount=v}get sideOrientation(){return this._internalMeshDataInfo._sideOrientation}set sideOrientation(v){this._internalMeshDataInfo._sideOrientation=v,this._internalAbstractMeshDataInfo._sideOrientationHint=this._scene.useRightHandedSystem&&1===v||!this._scene.useRightHandedSystem&&0===v}get overrideMaterialSideOrientation(){return this.sideOrientation}set overrideMaterialSideOrientation(v){this.sideOrientation=v,this.material&&(this.material.sideOrientation=null)}get overrideRenderingFillMode(){return this._internalMeshDataInfo._overrideRenderingFillMode}set overrideRenderingFillMode(v){this._internalMeshDataInfo._overrideRenderingFillMode=v}get material(){return this._internalAbstractMeshDataInfo._material}set material(v){v&&(this.material&&null===this.material.sideOrientation||this._internalAbstractMeshDataInfo._sideOrientationHint)&&(v.sideOrientation=null),this._setMaterial(v)}get source(){return this._internalMeshDataInfo._source}get cloneMeshMap(){return this._internalMeshDataInfo.meshMap}get isUnIndexed(){return this._unIndexed}set isUnIndexed(v){this._unIndexed!==v&&(this._unIndexed=v,this._markSubMeshesAsAttributesDirty())}get worldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesData}get previousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesPreviousData}get manualUpdateOfWorldMatrixInstancedBuffer(){return this._instanceDataStorage.manualUpdate}set manualUpdateOfWorldMatrixInstancedBuffer(v){this._instanceDataStorage.manualUpdate=v}get manualUpdateOfPreviousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.previousManualUpdate}set manualUpdateOfPreviousWorldMatrixInstancedBuffer(v){this._instanceDataStorage.previousManualUpdate=v}get forceWorldMatrixInstancedBufferUpdate(){return this._instanceDataStorage.forceMatrixUpdates}set forceWorldMatrixInstancedBufferUpdate(v){this._instanceDataStorage.forceMatrixUpdates=v}_copySource(v,T){let X=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const O=this.va();if(v._geometry&&v._geometry.Ca(this),B.d.DeepCopy(v,this,["name","material","skeleton","instances","parent","uniqueId","source","metadata","morphTargetManager","hasInstances","worldMatrixInstancedBuffer","previousWorldMatrixInstancedBuffer","hasLODLevels","Ne","isBlocked","areNormalsFrozen","facetNb","isFacetDataEnabled","lightSources","useBones","isAnInstance","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","wj","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","cloneMeshMap","hasBoundingInfo","physicsBody","physicsImpostor"],["_poseMatrix"]),this._internalMeshDataInfo._source=v,O.useClonedMeshMap&&(v._internalMeshDataInfo.meshMap||(v._internalMeshDataInfo.meshMap={}),v._internalMeshDataInfo.meshMap[this.uniqueId]=this),this._originalBuilderSideOrientation=v._originalBuilderSideOrientation,this._creationDataStorage=v._creationDataStorage,v._ranges){const T=v._ranges;for(const v in T)Object.prototype.hasOwnProperty.call(T,v)&&T[v]&&this.createAnimationRange(v,T[v].from,T[v].to)}if(v.metadata&&v.metadata.clone?this.metadata=v.metadata.clone():this.metadata=v.metadata,this._internalMetadata=v._internalMetadata,m.d&&m.d.HasTags(v)&&m.d.AddTagsTo(this,m.d.GetTags(v,!0)),this.Qg(v.isEnabled(!1)),this.parent=v.parent,this.setPivotMatrix(v.getPivotMatrix(),this._postMultiplyPivotMatrix),this.id=this.name+"."+v.id,this.material=v.material,!T){const T=v.getDescendants(!0);for(let v=0;v<T.length;v++){const X=T[v];X.clone&&X.clone(this.name+"."+X.name,this)}}if(v.morphTargetManager&&(this.morphTargetManager=v.morphTargetManager),O.getPhysicsEngine){const T=O.getPhysicsEngine();if(X&&T)if(1===T.getPluginVersion()){const X=T.getImpostorForPhysicsObject(v);X&&(this.physicsImpostor=X.clone(this))}else 2===T.getPluginVersion()&&v.physicsBody&&v.physicsBody.clone(this)}for(let u=0;u<O.Ae.length;u++){const T=O.Ae[u];T.k===v&&T.clone(T.name,this)}this.skeleton=v.skeleton,this.refreshBoundingInfo(!0,!0),this.Ke(!0)}constructor(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,B=arguments.length>4?arguments[4]:void 0,m=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];super(v,T),this._internalMeshDataInfo=new y,this.delayLoadState=0,this.instances=[],this._creationDataStorage=null,this._geometry=null,this._instanceDataStorage=new Z,this._thinInstanceDataStorage=new J,this._shouldGenerateFlatShading=!1,this._originalBuilderSideOrientation=P.DEFAULTSIDE,this.ignoreCameraMaxZ=!1,T=this.va(),this._scene.useRightHandedSystem?this.sideOrientation=0:this.sideOrientation=1,this._onBeforeDraw=(v,T,X)=>{v&&X&&(this._uniformBuffer?this.transferToEffect(T):X.bindOnlyWorldMatrix(T))},u&&this._copySource(u,B,m),null!==X&&(this.parent=X),this._instanceDataStorage.hardwareInstancedRendering=this.getEngine().getCaps().instancedArrays,this._internalMeshDataInfo._onMeshReadyObserverAdded=v=>{v.unregisterOnNextCall=!0,this.isReady(!0)?this.onMeshReadyObservable.notifyObservers(this):this._internalMeshDataInfo._checkReadinessObserver||(this._internalMeshDataInfo._checkReadinessObserver=this._scene.onBeforeRenderObservable.add((()=>{this.isReady(!0)&&(this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),this._internalMeshDataInfo._checkReadinessObserver=null,this.onMeshReadyObservable.notifyObservers(this))})))},this.onMeshReadyObservable=new O.b(this._internalMeshDataInfo._onMeshReadyObserverAdded),u&&u.onClonedObservable.notifyObservers(this)}instantiateHierarchy(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,T=arguments.length>1?arguments[1]:void 0,X=arguments.length>2?arguments[2]:void 0;const O=0===this.getTotalVertices()||T&&T.doNotInstantiate&&(!0===T.doNotInstantiate||T.doNotInstantiate(this))?this.clone("Clone of "+(this.name||this.id),v||this.parent,!0):this.Jb("instance of "+(this.name||this.id));O.parent=v||this.parent,O.position=this.position.clone(),O.Zd=this.Zd.clone(),this.rotationQuaternion?O.rotationQuaternion=this.rotationQuaternion.clone():O.rotation=this.rotation.clone(),X&&X(this,O);for(const u of this.getChildTransformNodes(!0))"InstancedMesh"===u.getClassName()&&"Mesh"===O.getClassName()&&u.sourceMesh===this?u.instantiateHierarchy(O,{doNotInstantiate:T&&T.doNotInstantiate||!1,newSourcedMesh:O},X):u.instantiateHierarchy(O,T,X);return O}getClassName(){return"Mesh"}get _isMesh(){return!0}toString(v){let T=super.toString(v);if(T+=", n vertices: "+this.getTotalVertices(),T+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(let X=0;X<this.animations.length;X++)T+=", animation[0]: "+this.animations[X].toString(v);if(v)if(this._geometry){const v=this.Qe(),X=this.getVerticesData(n.e.PositionKind);X&&v&&(T+=", flat shading: "+(X.length/3===v.length?"YES":"NO"))}else T+=", flat shading: UNKNOWN";return T}_unBindEffect(){super._unBindEffect();for(const v of this.instances)v._unBindEffect()}get hasLODLevels(){return this._internalMeshDataInfo._LODLevels.length>0}getLODLevels(){return this._internalMeshDataInfo._LODLevels}_sortLODLevels(){const v=this._internalMeshDataInfo._useLODScreenCoverage?-1:1;this._internalMeshDataInfo._LODLevels.sort(((T,X)=>T.distanceOrScreenCoverage<X.distanceOrScreenCoverage?v:T.distanceOrScreenCoverage>X.distanceOrScreenCoverage?-v:0))}addLODLevel(v,T){if(T&&T._masterMesh)return K.d.Warn("You cannot use a mesh as LOD level twice"),this;const X=new r(v,T);return this._internalMeshDataInfo._LODLevels.push(X),T&&(T._masterMesh=this),this._sortLODLevels(),this}getLODLevelAtDistance(v){const T=this._internalMeshDataInfo;for(let X=0;X<T._LODLevels.length;X++){const O=T._LODLevels[X];if(O.distanceOrScreenCoverage===v)return O.mesh}return null}removeLODLevel(v){const T=this._internalMeshDataInfo;for(let X=0;X<T._LODLevels.length;X++)T._LODLevels[X].mesh===v&&(T._LODLevels.splice(X,1),v&&(v._masterMesh=null));return this._sortLODLevels(),this}getLOD(v,T){const X=this._internalMeshDataInfo;if(!X._LODLevels||0===X._LODLevels.length)return this;const O=T||this.getBoundingInfo().boundingSphere,u=v.mode===x.e.ORTHOGRAPHIC_CAMERA?v.ij:O.centerWorld.Xc(v.globalPosition).length();let B=u,m=1;if(X._useLODScreenCoverage){const T=v.screenArea;let X=O.radiusWorld*v.ij/u;X=X*X*Math.PI,B=X/T,m=-1}if(m*X._LODLevels[X._LODLevels.length-1].distanceOrScreenCoverage>m*B)return this.onLODLevelSelection&&this.onLODLevelSelection(B,this,this),this;for(let A=0;A<X._LODLevels.length;A++){const v=X._LODLevels[A];if(m*v.distanceOrScreenCoverage<m*B){if(v.mesh){if(4===v.mesh.delayLoadState)return v.mesh._checkDelayState(),this;if(2===v.mesh.delayLoadState)return this;v.mesh._preActivate(),v.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)}return this.onLODLevelSelection&&this.onLODLevelSelection(B,this,v.mesh),v.mesh}}return this.onLODLevelSelection&&this.onLODLevelSelection(B,this,this),this}get Ne(){return this._geometry}getTotalVertices(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()}getVerticesData(v,T,X,O){var u,B;if(!this._geometry)return null;let m=O||null===(u=this._userInstancedBuffersStorage)||void 0===u||null===(B=u.vertexBuffers[v])||void 0===B?void 0:B.getFloatData(this.instances.length+1,X||T&&1!==this._geometry.meshes.length);return m||(m=this._geometry.getVerticesData(v,T,X)),m}copyVerticesData(v,T){this._geometry&&this._geometry.copyVerticesData(v,T)}getVertexBuffer(v,T){var X;return this._geometry?(T||null===(X=this._userInstancedBuffersStorage)||void 0===X?void 0:X.vertexBuffers[v])??this._geometry.getVertexBuffer(v):null}isVerticesDataPresent(v,T){var X;return this._geometry?!T&&void 0!==(null===(X=this._userInstancedBuffersStorage)||void 0===X?void 0:X.vertexBuffers[v])||this._geometry.isVerticesDataPresent(v):!!this._delayInfo&&-1!==this._delayInfo.indexOf(v)}isVertexBufferUpdatable(v,T){if(!this._geometry)return!!this._delayInfo&&-1!==this._delayInfo.indexOf(v);if(!T){var X;const T=null===(X=this._userInstancedBuffersStorage)||void 0===X?void 0:X.vertexBuffers[v];if(T)return T.isUpdatable()}return this._geometry.isVertexBufferUpdatable(v)}getVerticesDataKinds(v){if(!this._geometry){const v=[];return this._delayInfo&&this._delayInfo.forEach((function(T){v.push(T)})),v}const T=this._geometry.getVerticesDataKinds();if(!v&&this._userInstancedBuffersStorage)for(const X in this._userInstancedBuffersStorage.vertexBuffers)-1===T.indexOf(X)&&T.push(X);return T}getTotalIndices(){return this._geometry?this._geometry.getTotalIndices():0}Qe(v,T){return this._geometry?this._geometry.Qe(v,T):[]}get isBlocked(){return null!==this._masterMesh&&void 0!==this._masterMesh}isReady(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0],T=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(2===this.delayLoadState)return!1;if(!super.isReady(v))return!1;if(!this.Ce||0===this.Ce.length)return!0;if(!v)return!0;const X=this.getEngine(),O=this.va(),u=T||X.getCaps().instancedArrays&&(this.instances.length>0||this.hasThinInstances);this.Ke();const B=this.material||O.defaultMaterial;if(B)if(B._storeEffectOnSubMeshes)for(const n of this.Ce){const v=n.Ha();if(v)if(v._storeEffectOnSubMeshes){if(!v.isReadyForSubMesh(this,n,u))return!1}else if(!v.isReady(this,u))return!1}else if(!B.isReady(this,u))return!1;const m=X.currentRenderPassId;for(const n of this.lightSources){const v=n.getShadowGenerators();if(!v)continue;const T=v.values();for(let O=T.next();!0!==O.done;O=T.next()){var A,x,f,M;const v=O.value;if(v&&(null===(A=v.getShadowMap())||void 0===A||!A.renderList||null!==(x=v.getShadowMap())&&void 0!==x&&x.renderList&&-1!==(null===(f=v.getShadowMap())||void 0===f||null===(M=f.renderList)||void 0===M?void 0:M.indexOf(this)))){const T=v.getShadowMap().renderPassIds??[X.currentRenderPassId];for(let O=0;O<T.length;++O){X.currentRenderPassId=T[O];for(const T of this.Ce){var H;if(!v.isReady(T,u,(null===(H=T.Ha())||void 0===H?void 0:H.needAlphaBlendingForMesh(this))??!1))return X.currentRenderPassId=m,!1}}X.currentRenderPassId=m}}}for(const n of this._internalMeshDataInfo._LODLevels)if(n.mesh&&!n.mesh.isReady(u))return!1;return!0}get areNormalsFrozen(){return this._internalMeshDataInfo._areNormalsFrozen}ei(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this}unfreezeNormals(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this}set overridenInstanceCount(v){this._instanceDataStorage.overridenInstanceCount=v}_preActivate(){const v=this._internalMeshDataInfo,T=this.va().getRenderId();return v._preActivateId===T||(v._preActivateId=T,this._instanceDataStorage.visibleInstances=null),this}_preActivateForIntermediateRendering(v){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=v),this}_registerInstanceForRenderId(v,T){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:T,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[T]||(void 0!==this._instanceDataStorage.previousRenderId&&this._instanceDataStorage.isFrozen&&(this._instanceDataStorage.visibleInstances[this._instanceDataStorage.previousRenderId]=null),this._instanceDataStorage.previousRenderId=T,this._instanceDataStorage.visibleInstances[T]=new Array),this._instanceDataStorage.visibleInstances[T].push(v),this}_afterComputeWorldMatrix(){super._afterComputeWorldMatrix(),this.hasThinInstances&&(this.Da||this.thinInstanceRefreshBoundingInfo(!1))}_postActivate(){this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup&&(this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer),this.edgesRenderer.customInstances.push(this.getWorldMatrix()))}refreshBoundingInfo(){let v,T=arguments.length>0&&void 0!==arguments[0]&&arguments[0],X=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;v="object"===typeof T?T:{applySkeleton:T,applyMorph:X};const O=this.Ne?this.Ne.boundingBias:null;return this.Fa(this._getData(v,null,n.e.PositionKind),O),this}_createGlobalSubMesh(v){const T=this.getTotalVertices();if(!T||!this.Qe())return null;if(this.Ce&&this.Ce.length>0){const X=this.Qe();if(!X)return null;const O=X.length;let u=!1;if(v)u=!0;else for(const v of this.Ce){if(v.indexStart+v.indexCount>O){u=!0;break}if(v.verticesStart+v.verticesCount>T){u=!0;break}}if(!u)return this.Ce[0]}return this.releaseSubMeshes(),new F.c(0,0,T,0,this.getTotalIndices(),this)}subdivide(v){if(v<1)return;const T=this.getTotalIndices();let X=T/v|0,O=0;for(;X%3!==0;)X++;this.releaseSubMeshes();for(let u=0;u<v&&!(O>=T);u++)F.c.CreateFromIndices(0,O,u===v-1?T-O:X,this,void 0,!1),O+=X;this.refreshBoundingInfo(),this.synchronizeInstances()}Ga(v,T){let X=arguments.length>2&&void 0!==arguments[2]&&arguments[2],O=arguments.length>3?arguments[3]:void 0;if(this._geometry)this._geometry.Ga(v,T,X,O);else{const O=new V.e;O.set(T,v);const u=this.va();new D.e(D.e.RandomId(),u,O,X,this)}return this}removeVerticesData(v){this._geometry&&this._geometry.removeVerticesData(v)}markVerticesDataAsUpdatable(v){let T=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const X=this.getVertexBuffer(v);X&&X.isUpdatable()!==T&&this.Ga(v,this.getVerticesData(v),T)}setVerticesBuffer(v){let T=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._geometry||(this._geometry=D.e.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(v,null,T),this}updateVerticesData(v,T,X,O){return this._geometry?(O?(this.makeGeometryUnique(),this.updateVerticesData(v,T,X,!1)):this._geometry.updateVerticesData(v,T,X),this):this}updateMeshPositions(v){let T=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const X=this.getVerticesData(n.e.PositionKind);if(!X)return this;if(v(X),this.updateVerticesData(n.e.PositionKind,X,!1,!1),T){const v=this.Qe(),T=this.getVerticesData(n.e.NormalKind);if(!T)return this;V.e.ComputeNormals(X,v,T),this.updateVerticesData(n.e.NormalKind,T,!1,!1)}return this}makeGeometryUnique(){if(!this._geometry)return this;if(1===this._geometry.meshes.length)return this;const v=this._geometry,T=this._geometry.j(D.e.RandomId());return v.releaseForMesh(this,!0),T.Ca(this),this}setIndexBuffer(v,T,X){let O=this._geometry;O||(O=new D.e(D.e.RandomId(),this.va(),void 0,void 0,this)),O.setIndexBuffer(v,T,X)}setIndices(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,X=arguments.length>2&&void 0!==arguments[2]&&arguments[2],O=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this._geometry)this._geometry.setIndices(v,T,X,O);else{const T=new V.e;T.indices=v;const O=this.va();new D.e(D.e.RandomId(),O,T,X,this)}return this}updateIndices(v,T){let X=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this._geometry?(this._geometry.updateIndices(v,T,X),this):this}toLeftHanded(){return this._geometry?(this._geometry.toLeftHanded(),this):this}_bind(v,T,X){let O=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!this._geometry)return this;const u=this.va().getEngine();let B;if(this._unIndexed)if(this._getRenderingFillMode(X)===k.d.WireFrameFillMode)B=v._getLinesIndexBuffer(this.Qe(),u);else B=null;else switch(this._getRenderingFillMode(X)){case k.d.PointFillMode:B=null;break;case k.d.WireFrameFillMode:B=v._getLinesIndexBuffer(this.Qe(),u);break;default:case k.d.TriangleFillMode:B=this._geometry.getIndexBuffer()}return this._bindDirect(T,B,O)}_bindDirect(v,T){let X=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this._geometry?(this.morphTargetManager&&this.morphTargetManager.isUsingTextureForTargets&&this.morphTargetManager._bind(v),X&&this._userInstancedBuffersStorage&&!this.hasThinInstances?this._geometry._bind(v,T,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects):this._geometry._bind(v,T),this):this}_draw(v,T,X){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);const O=this.va().getEngine();return this._unIndexed&&T!==k.d.WireFrameFillMode||T==k.d.PointFillMode?O.drawArraysType(T,v.verticesStart,v.verticesCount,this.forcedInstanceCount||X):T==k.d.WireFrameFillMode?O.drawElementsType(T,0,v._linesIndexCount,this.forcedInstanceCount||X):O.drawElementsType(T,v.indexStart,v.indexCount,this.forcedInstanceCount||X),this}registerBeforeRender(v){return this.onBeforeRenderObservable.add(v),this}unregisterBeforeRender(v){return this.onBeforeRenderObservable.removeCallback(v),this}registerAfterRender(v){return this.onAfterRenderObservable.add(v),this}unregisterAfterRender(v){return this.onAfterRenderObservable.removeCallback(v),this}_getInstancesRenderList(v){let T=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._instanceDataStorage.isFrozen){if(T)return this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.hardwareInstancedRendering[v]=!1,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.renderSelf[v]=!0,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode;if(this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch}const X=this.va(),O=X._isInIntermediateRendering(),u=O?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,B=this._instanceDataStorage.batchCache;if(B.mustReturn=!1,B.renderSelf[v]=T||!u&&this.isEnabled()&&this.isVisible,B.visibleInstances[v]=null,this._instanceDataStorage.visibleInstances&&!T){const T=this._instanceDataStorage.visibleInstances,u=X.getRenderId(),m=O?T.intermediateDefaultRenderId:T.defaultRenderId;B.visibleInstances[v]=T[u],!B.visibleInstances[v]&&m&&(B.visibleInstances[v]=T[m])}return B.hardwareInstancedRendering[v]=!T&&this._instanceDataStorage.hardwareInstancedRendering&&null!==B.visibleInstances[v]&&void 0!==B.visibleInstances[v],this._instanceDataStorage.previousBatch=B,B}_renderWithInstances(v,T,X,O,u){const B=X.visibleInstances[v._id],m=B?B.length:0,A=this._instanceDataStorage,x=A.instancesBufferSize;let M=A.instancesBuffer,H=A.instancesPreviousBuffer;const V=16*(m+1)*4;for(;A.instancesBufferSize<V;)A.instancesBufferSize*=2;A.instancesData&&x==A.instancesBufferSize||(A.instancesData=new Float32Array(A.instancesBufferSize/4)),(this._scene.needsPreviousWorldMatrices&&!A.instancesPreviousData||x!=A.instancesBufferSize)&&(A.instancesPreviousData=new Float32Array(A.instancesBufferSize/4));let D=0,s=0;const F=X.renderSelf[v._id],k=!M||x!==A.instancesBufferSize||this._scene.needsPreviousWorldMatrices&&!A.instancesPreviousBuffer;if(this._instanceDataStorage.manualUpdate||A.isFrozen&&!k)s=(F?1:0)+m;else{const T=this.getWorldMatrix();if(F&&(this._scene.needsPreviousWorldMatrices&&(A.masterMeshPreviousWorldMatrix?(A.masterMeshPreviousWorldMatrix.copyToArray(A.instancesPreviousData,D),A.masterMeshPreviousWorldMatrix.p(T)):(A.masterMeshPreviousWorldMatrix=T.clone(),A.masterMeshPreviousWorldMatrix.copyToArray(A.instancesPreviousData,D))),T.copyToArray(A.instancesData,D),D+=16,s++),B){var b;if(P.INSTANCEDMESH_SORT_TRANSPARENT&&this._scene.activeCamera&&null!==(b=v.Ha())&&void 0!==b&&b.needAlphaBlendingForMesh(v.getRenderingMesh())){const v=this._scene.activeCamera.globalPosition;for(let T=0;T<B.length;T++){const X=B[T];X._distanceToCamera=f.l.Distance(X.getBoundingInfo().boundingSphere.centerWorld,v)}B.sort(((v,T)=>v._distanceToCamera>T._distanceToCamera?-1:v._distanceToCamera<T._distanceToCamera?1:0))}for(let v=0;v<B.length;v++){const T=B[v],X=T.getWorldMatrix();X.copyToArray(A.instancesData,D),this._scene.needsPreviousWorldMatrices&&(T._previousWorldMatrix?(T._previousWorldMatrix.copyToArray(A.instancesPreviousData,D),T._previousWorldMatrix.p(X)):(T._previousWorldMatrix=X.clone(),T._previousWorldMatrix.copyToArray(A.instancesPreviousData,D))),D+=16,s++}}}return k?(M&&M.dispose(),H&&H.dispose(),M=new n.d(u,A.instancesData,!0,16,!1,!0),A.instancesBuffer=M,this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this._userInstancedBuffersStorage.vertexBuffers.world0=M.createVertexBuffer("world0",0,4),this._userInstancedBuffersStorage.vertexBuffers.world1=M.createVertexBuffer("world1",4,4),this._userInstancedBuffersStorage.vertexBuffers.world2=M.createVertexBuffer("world2",8,4),this._userInstancedBuffersStorage.vertexBuffers.world3=M.createVertexBuffer("world3",12,4),this._scene.needsPreviousWorldMatrices&&(H=new n.d(u,A.instancesPreviousData,!0,16,!1,!0),A.instancesPreviousBuffer=H,this._userInstancedBuffersStorage.vertexBuffers.previousWorld0=H.createVertexBuffer("previousWorld0",0,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld1=H.createVertexBuffer("previousWorld1",4,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld2=H.createVertexBuffer("previousWorld2",8,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld3=H.createVertexBuffer("previousWorld3",12,4)),this._invalidateInstanceVertexArrayObject()):this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||(M.updateDirectly(A.instancesData,0,s),!this._scene.needsPreviousWorldMatrices||this._instanceDataStorage.manualUpdate&&!this._instanceDataStorage.previousManualUpdate||H.updateDirectly(A.instancesPreviousData,0,s)),this._processInstancedBuffers(B,F),this.va()._activeIndices.addCount(v.indexCount*s,!1),u._currentDrawContext&&(u._currentDrawContext.useInstancing=!0),this._bind(v,O,T),this._draw(v,T,s),!this._scene.needsPreviousWorldMatrices||k||!this._instanceDataStorage.manualUpdate||this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||this._instanceDataStorage.previousManualUpdate||H.updateDirectly(A.instancesData,0,s),u.unbindInstanceAttributes(),this}_renderWithThinInstances(v,T,X,O){var u;const B=(null===(u=this._thinInstanceDataStorage)||void 0===u?void 0:u.instancesCount)??0;this.va()._activeIndices.addCount(v.indexCount*B,!1),O._currentDrawContext&&(O._currentDrawContext.useInstancing=!0),this._bind(v,X,T),this._draw(v,T,B),this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&this._thinInstanceDataStorage.matrixData&&(this._thinInstanceDataStorage.previousMatrixBuffer?this._thinInstanceDataStorage.previousMatrixBuffer.updateDirectly(this._thinInstanceDataStorage.matrixData,0,B):this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.matrixData,!1)),O.unbindInstanceAttributes()}_processInstancedBuffers(v,T){}_processRendering(v,T,X,O,u,B,m,A){const x=this.va(),f=x.getEngine();if(O=this._getRenderingFillMode(O),B&&T.getRenderingMesh().hasThinInstances)return this._renderWithThinInstances(T,O,X,f),this;if(B)this._renderWithInstances(T,O,u,X,f);else{f._currentDrawContext&&(f._currentDrawContext.useInstancing=!1);let X=0;u.renderSelf[T._id]&&(m&&m(!1,v.getWorldMatrix(),A),X++,this._draw(T,O,this._instanceDataStorage.overridenInstanceCount));const B=u.visibleInstances[T._id];if(B){const v=B.length;X+=v;for(let X=0;X<v;X++){const v=B[X].getWorldMatrix();m&&m(!0,v,A),this._draw(T,O)}}x._activeIndices.addCount(T.indexCount*X,!1)}return this}_rebuild(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._instanceDataStorage.instancesBuffer&&(v&&this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),this._userInstancedBuffersStorage){for(const T in this._userInstancedBuffersStorage.vertexBuffers){const X=this._userInstancedBuffersStorage.vertexBuffers[T];X&&(v&&X.dispose(),this._userInstancedBuffersStorage.vertexBuffers[T]=null)}this._userInstancedBuffersStorage.vertexArrayObjects&&(this._userInstancedBuffersStorage.vertexArrayObjects={})}this._internalMeshDataInfo._effectiveMaterial=null,super._rebuild(v)}_freeze(){if(this.Ce){for(let v=0;v<this.Ce.length;v++)this._getInstancesRenderList(v);this._internalMeshDataInfo._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}}_unFreeze(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null}renderWithRenderPassId(v,T,X,O){let u=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const B=this._scene.getEngine(),m=B.currentRenderPassId;if(void 0!==v&&(B.currentRenderPassId=v),O)(!u||u&&O.isInFrustum(this._scene._frustumPlanes))&&this.render(O,!!T,X);else for(let A=0;A<this.Ce.length;A++){const v=this.Ce[A];(!u||u&&v.isInFrustum(this._scene._frustumPlanes))&&this.render(v,!!T,X)}return void 0!==v&&(B.currentRenderPassId=m),this}directRender(){if(!this.Ce)return this;for(const v of this.Ce)this.render(v,!1);return this}render(v,T,X){var O,u,B;const m=this.va();this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1;const A=(null===(O=m.activeCameras)||void 0===O?void 0:O.length)??0;if((A>1&&m.activeCamera===m.activeCameras[0]||A<=1)&&this._checkOcclusionQuery()&&!this._occlusionDataStorage.forceRenderingWhenOccluded)return this;const x=this._getInstancesRenderList(v._id,!!X);if(x.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const f=m.getEngine();let M=0,H=null;this.ignoreCameraMaxZ&&m.activeCamera&&!m._isInIntermediateRendering()&&(M=m.activeCamera.maxZ,H=m.activeCamera,m.activeCamera.maxZ=0,m.updateTransformMatrix(!0)),this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);const n=v.getRenderingMesh(),V=x.hardwareInstancedRendering[v._id]||n.hasThinInstances||!!this._userInstancedBuffersStorage&&!v.getMesh()._internalAbstractMeshDataInfo._actAsRegularMesh,D=this._instanceDataStorage,s=v.Ha();if(!s)return H&&(H.maxZ=M,m.updateTransformMatrix(!0)),this;if(D.isFrozen&&this._internalMeshDataInfo._effectiveMaterial&&this._internalMeshDataInfo._effectiveMaterial===s){if(s._storeEffectOnSubMeshes&&(null===(u=v._drawWrapper)||void 0===u||!u._wasPreviouslyReady)||!s._storeEffectOnSubMeshes&&!s._getDrawWrapper()._wasPreviouslyReady)return H&&(H.maxZ=M,m.updateTransformMatrix(!0)),this}else{if(s._storeEffectOnSubMeshes){if(!s.isReadyForSubMesh(this,v,V))return H&&(H.maxZ=M,m.updateTransformMatrix(!0)),this}else if(!s.isReady(this,V))return H&&(H.maxZ=M,m.updateTransformMatrix(!0)),this;this._internalMeshDataInfo._effectiveMaterial=s}let F;T&&f.setAlphaMode(this._internalMeshDataInfo._effectiveMaterial.alphaMode),F=this._internalMeshDataInfo._effectiveMaterial._storeEffectOnSubMeshes?v._drawWrapper:this._internalMeshDataInfo._effectiveMaterial._getDrawWrapper();const b=(null===(B=F)||void 0===B?void 0:B.effect)??null;for(const k of m._beforeRenderingMeshStage)k.action(this,v,x,b);if(!F||!b)return H&&(H.maxZ=M,m.updateTransformMatrix(!0)),this;const l=X||this;let Q;if(D.isFrozen||!this._internalMeshDataInfo._effectiveMaterial.Xe&&null===this._internalMeshDataInfo._effectiveMaterial.sideOrientation&&!this._internalMeshDataInfo._effectiveMaterial.twoSidedLighting)Q=D.sideOrientation;else{const v=l._getWorldMatrixDeterminant();Q=this._internalMeshDataInfo._effectiveMaterial._getEffectiveOrientation(this),v<0&&(Q=Q===k.d.ClockWiseSideOrientation?k.d.CounterClockWiseSideOrientation:k.d.ClockWiseSideOrientation),D.sideOrientation=Q}const K=this._internalMeshDataInfo._effectiveMaterial._preBind(F,Q);this._internalMeshDataInfo._effectiveMaterial.forceDepthWrite&&f.setDepthWrite(!0);const p=this._internalMeshDataInfo._effectiveMaterial,G=p.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),V||this._bind(v,b,G,!1);const L=l.getWorldMatrix();p._storeEffectOnSubMeshes?p.bindForSubMesh(L,this,v):p.bind(L,this),!p.Xe&&p.separateCullingPass&&(f.setState(!0,p.zOffset,!1,!K,p.cullBackFaces,p.stencil,p.zOffsetUnits),this._processRendering(this,v,b,G,x,V,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),f.setState(!0,p.zOffset,!1,K,p.cullBackFaces,p.stencil,p.zOffsetUnits),this._internalMeshDataInfo._onBetweenPassObservable&&this._internalMeshDataInfo._onBetweenPassObservable.notifyObservers(v)),this._processRendering(this,v,b,G,x,V,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),this._internalMeshDataInfo._effectiveMaterial.unbind();for(const k of m._afterRenderingMeshStage)k.action(this,v,x,b);return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),H&&(H.maxZ=M,m.updateTransformMatrix(!0)),2!==m.performancePriority||D.isFrozen||this._freeze(),this}cleanMatrixWeights(){this.isVerticesDataPresent(n.e.MatricesWeightsKind)&&(this.isVerticesDataPresent(n.e.MatricesWeightsExtraKind)?this._normalizeSkinWeightsAndExtra():this._normalizeSkinFourWeights())}_normalizeSkinFourWeights(){const v=this.getVerticesData(n.e.MatricesWeightsKind),T=v.length;for(let X=0;X<T;X+=4){const T=v[X]+v[X+1]+v[X+2]+v[X+3];if(0===T)v[X]=1;else{const O=1/T;v[X]*=O,v[X+1]*=O,v[X+2]*=O,v[X+3]*=O}}this.Ga(n.e.MatricesWeightsKind,v)}_normalizeSkinWeightsAndExtra(){const v=this.getVerticesData(n.e.MatricesWeightsExtraKind),T=this.getVerticesData(n.e.MatricesWeightsKind),X=T.length;for(let O=0;O<X;O+=4){let X=T[O]+T[O+1]+T[O+2]+T[O+3];if(X+=v[O]+v[O+1]+v[O+2]+v[O+3],0===X)T[O]=1;else{const u=1/X;T[O]*=u,T[O+1]*=u,T[O+2]*=u,T[O+3]*=u,v[O]*=u,v[O+1]*=u,v[O+2]*=u,v[O+3]*=u}}this.Ga(n.e.MatricesWeightsKind,T),this.Ga(n.e.MatricesWeightsKind,v)}validateSkinning(){const v=this.getVerticesData(n.e.MatricesWeightsExtraKind),T=this.getVerticesData(n.e.MatricesWeightsKind);if(null===T||null==this.skeleton)return{skinned:!1,valid:!0,ce:"not skinned"};const X=T.length;let O=0,u=0,B=0,m=0;const A=null===v?4:8,x=[];for(let n=0;n<=A;n++)x[n]=0;for(let n=0;n<X;n+=4){let X=T[n],f=X,M=0===f?0:1;for(let u=1;u<A;u++){const B=u<4?T[n+u]:v[n+u-4];B>X&&O++,0!==B&&M++,f+=B,X=B}if(x[M]++,M>B&&(B=M),0===f)u++;else{const X=1/f;let O=0;for(let u=0;u<A;u++)O+=u<4?Math.abs(T[n+u]-T[n+u]*X):Math.abs(v[n+u-4]-v[n+u-4]*X);O>.001&&m++}}const f=this.skeleton.bones.length,M=this.getVerticesData(n.e.MatricesIndicesKind),H=this.getVerticesData(n.e.MatricesIndicesExtraKind);let V=0;for(let n=0;n<X;n+=4)for(let v=0;v<A;v++){const T=v<4?M[n+v]:H[n+v-4];(T>=f||T<0)&&V++}return{skinned:!0,valid:0===u&&0===m&&0===V,ce:"Number of Weights = "+X/4+"\nMaximum influences = "+B+"\nMissing Weights = "+u+"\nNot Sorted = "+O+"\nNot Normalized = "+m+"\nWeightCounts = ["+x+"]\nNumber of bones = "+f+"\nBad Bone Indices = "+V}}_checkDelayState(){const v=this.va();return this._geometry?this._geometry.load(v):4===this.delayLoadState&&(this.delayLoadState=2,this._queueLoad(v)),this}_queueLoad(v){v.addPendingData(this);const T=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return u.c.LoadFile(this.delayLoadingFile,(T=>{T instanceof ArrayBuffer?this._delayLoadingFunction(T,this):this._delayLoadingFunction(JSON.parse(T),this),this.instances.forEach((v=>{v.refreshBoundingInfo(),v._syncSubMeshes()})),this.delayLoadState=1,v.removePendingData(this)}),(()=>{}),v.offlineProvider,T),this}isInFrustum(v){return 2!==this.delayLoadState&&(!!super.isInFrustum(v)&&(this._checkDelayState(),!0))}setMaterialById(v){const T=this.va().materials;let X;for(X=T.length-1;X>-1;X--)if(T[X].id===v)return this.material=T[X],this;const O=this.va().multiMaterials;for(X=O.length-1;X>-1;X--)if(O[X].id===v)return this.material=O[X],this;return this}getAnimatables(){const v=[];return this.material&&v.push(this.material),this.skeleton&&v.push(this.skeleton),v}bakeTransformIntoVertices(v){if(!this.isVerticesDataPresent(n.e.PositionKind))return this;const T=this.Ce.splice(0);this._resetPointsArrayCache();let X=this.getVerticesData(n.e.PositionKind);const O=f.l.Zero();let u;for(u=0;u<X.length;u+=3)f.l.TransformCoordinatesFromFloatsToRef(X[u],X[u+1],X[u+2],v,O).toArray(X,u);if(this.Ga(n.e.PositionKind,X,this.getVertexBuffer(n.e.PositionKind).isUpdatable()),this.isVerticesDataPresent(n.e.NormalKind)){for(X=this.getVerticesData(n.e.NormalKind),u=0;u<X.length;u+=3)f.l.TransformNormalFromFloatsToRef(X[u],X[u+1],X[u+2],v,O).normalize().toArray(X,u);this.Ga(n.e.NormalKind,X,this.getVertexBuffer(n.e.NormalKind).isUpdatable())}if(this.isVerticesDataPresent(n.e.TangentKind)){for(X=this.getVerticesData(n.e.TangentKind),u=0;u<X.length;u+=4)f.l.TransformNormalFromFloatsToRef(X[u],X[u+1],X[u+2],v,O).normalize().toArray(X,u);this.Ga(n.e.TangentKind,X,this.getVertexBuffer(n.e.TangentKind).isUpdatable())}return v.determinant()<0&&this.flipFaces(),this.releaseSubMeshes(),this.Ce=T,this}bakeCurrentTransformIntoVertices(){let v=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.bakeTransformIntoVertices(this.Ke(!0)),this.resetLocalMatrix(v),this}get _positions(){return this._internalAbstractMeshDataInfo._positions||this._geometry&&this._geometry._positions||null}_resetPointsArrayCache(){return this._geometry&&this._geometry._resetPointsArrayCache(),this}_generatePointsArray(){return!!this._geometry&&this._geometry._generatePointsArray()}clone(){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,T=arguments.length>2?arguments[2]:void 0,X=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return new P(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",this.va(),v,this,T,X)}dispose(v){let T=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);const X=this._internalMeshDataInfo;if(X._onBeforeDrawObservable&&X._onBeforeDrawObservable.clear(),X._onBeforeBindObservable&&X._onBeforeBindObservable.clear(),X._onBeforeRenderObservable&&X._onBeforeRenderObservable.clear(),X._onAfterRenderObservable&&X._onAfterRenderObservable.clear(),X._onBetweenPassObservable&&X._onBetweenPassObservable.clear(),this._scene.useClonedMeshMap){if(X.meshMap)for(const v in X.meshMap){const T=X.meshMap[v];T&&(T._internalMeshDataInfo._source=null,X.meshMap[v]=void 0)}X._source&&X._source._internalMeshDataInfo.meshMap&&(X._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else{const v=this.va().meshes;for(const T of v){const v=T;v._internalMeshDataInfo&&v._internalMeshDataInfo._source&&v._internalMeshDataInfo._source===this&&(v._internalMeshDataInfo._source=null)}}X._source=null,this._instanceDataStorage.visibleInstances={},this._disposeInstanceSpecificData(),this._disposeThinInstanceSpecificData(),this._internalMeshDataInfo._checkReadinessObserver&&this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),super.dispose(v,T)}_disposeInstanceSpecificData(){}_disposeThinInstanceSpecificData(){}_invalidateInstanceVertexArrayObject(){}applyDisplacementMap(v,T,X,O,B,m){let A=arguments.length>6&&void 0!==arguments[6]&&arguments[6],x=arguments.length>7?arguments[7]:void 0;const f=this.va();return u.c.LoadImage(v,(v=>{const u=v.width,x=v.height,f=this.getEngine().createCanvas(u,x).getContext("2d");f.drawImage(v,0,0);const M=f.getImageData(0,0,u,x).data;this.applyDisplacementMapFromBuffer(M,u,x,T,X,B,m,A),O&&O(this)}),x||(()=>{}),f.offlineProvider),this}applyDisplacementMapFromBuffer(v,T,X,O,u,B,m){let A=arguments.length>7&&void 0!==arguments[7]&&arguments[7];if(!this.isVerticesDataPresent(n.e.PositionKind)||!this.isVerticesDataPresent(n.e.NormalKind)||!this.isVerticesDataPresent(n.e.UVKind))return K.d.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;const x=this.getVerticesData(n.e.PositionKind,!0,!0),M=this.getVerticesData(n.e.NormalKind),H=this.getVerticesData(n.e.UVKind);let D=f.l.Zero();const s=f.l.Zero(),F=f.i.Zero();B=B||f.i.Zero(),m=m||new f.i(1,1);for(let n=0;n<x.length;n+=3){f.l.FromArrayToRef(x,n,D),f.l.FromArrayToRef(M,n,s),f.i.FromArrayToRef(H,n/3*2,F);const A=4*((Math.abs(F.x*m.x+B.x%1)*(T-1)%T|0)+(Math.abs(F.y*m.y+B.y%1)*(X-1)%X|0)*T),V=.3*(v[A]/255)+.59*(v[A+1]/255)+.11*(v[A+2]/255);s.normalize(),s.scaleInPlace(O+(u-O)*V),D=D.add(s),D.toArray(x,n)}return V.e.ComputeNormals(x,this.Qe(),M),A?(this.Ga(n.e.PositionKind,x),this.Ga(n.e.NormalKind,M),this.Ga(n.e.UVKind,H)):(this.updateVerticesData(n.e.PositionKind,x),this.updateVerticesData(n.e.NormalKind,M)),this}_getFlattenedNormals(v,T){const X=new Float32Array(3*v.length);let O=0;const u=this.sideOrientation===(this._scene.useRightHandedSystem?1:0);for(let B=0;B<v.length;B+=3){const m=f.l.Ld(T,3*v[B]),A=f.l.Ld(T,3*v[B+1]),x=f.l.Ld(T,3*v[B+2]),M=m.Xc(A),H=x.Xc(A),n=f.l.Normalize(f.l.Cross(M,H));u&&n.scaleInPlace(-1);for(let v=0;v<3;v++)X[O++]=n.x,X[O++]=n.y,X[O++]=n.z}return X}_convertToUnIndexedMesh(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const T=this.getVerticesDataKinds().filter((v=>{var T;return!(null!==(T=this.getVertexBuffer(v))&&void 0!==T&&T.getIsInstanced())})),X=this.Qe(),O={},u=(v,T)=>{const O=new Float32Array(X.length*T);let u=0;for(let B=0;B<X.length;B++)for(let m=0;m<T;m++)O[u++]=v[X[B]*T+m];return O},B=this.getBoundingInfo(),m=this.Ne?this.Ce.slice(0):[];for(const A of T)O[A]=this.getVerticesData(A);for(const A of T){const T=this.getVertexBuffer(A),B=T.getSize();if(v&&A===n.e.NormalKind){const v=this._getFlattenedNormals(X,O[n.e.PositionKind]);this.Ga(n.e.NormalKind,v,T.isUpdatable(),B)}else this.Ga(A,u(O[A],B),T.isUpdatable(),B)}if(this.morphTargetManager){for(let T=0;T<this.morphTargetManager.numTargets;T++){const O=this.morphTargetManager.getTarget(T),B=O.getPositions();O.setPositions(u(B,3));const m=O.getNormals();m&&O.setNormals(v?this._getFlattenedNormals(X,B):u(m,3));const A=O.getTangents();A&&O.setTangents(u(A,3));const x=O.getUVs();x&&O.setUVs(u(x,2))}this.morphTargetManager.synchronize()}for(let A=0;A<X.length;A++)X[A]=A;this.setIndices(X),this._unIndexed=!0,this.releaseSubMeshes();for(const A of m){const v=A.getBoundingInfo();F.c.AddToMesh(A.materialIndex,A.indexStart,A.indexCount,A.indexStart,A.indexCount,this).setBoundingInfo(v)}return this.setBoundingInfo(B),this.synchronizeInstances(),this}convertToFlatShadedMesh(){return this._convertToUnIndexedMesh(!0)}convertToUnIndexedMesh(){return this._convertToUnIndexedMesh()}flipFaces(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const T=V.e.ExtractFromMesh(this);let X;if(v&&this.isVerticesDataPresent(n.e.NormalKind)&&T.ya){for(X=0;X<T.ya.length;X++)T.ya[X]*=-1;this.Ga(n.e.NormalKind,T.ya,this.isVertexBufferUpdatable(n.e.NormalKind))}if(T.indices){let v;for(X=0;X<T.indices.length;X+=3)v=T.indices[X+1],T.indices[X+1]=T.indices[X+2],T.indices[X+2]=v;this.setIndices(T.indices,null,this.isVertexBufferUpdatable(n.e.PositionKind),!0)}return this}increaseVertices(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const T=V.e.ExtractFromMesh(this),X=T.indices&&!Array.isArray(T.indices)&&Array.from?Array.from(T.indices):T.indices,O=T.xa&&!Array.isArray(T.xa)&&Array.from?Array.from(T.xa):T.xa,u=T.Aa&&!Array.isArray(T.Aa)&&Array.from?Array.from(T.Aa):T.Aa,B=T.ya&&!Array.isArray(T.ya)&&Array.from?Array.from(T.ya):T.ya;if(X&&O){T.indices=X,T.xa=O,u&&(T.Aa=u),B&&(T.ya=B);const m=v+1,A=new Array;for(let v=0;v<m+1;v++)A[v]=new Array;let x,M;const H=new f.l(0,0,0),V=new f.l(0,0,0),D=new f.i(0,0),s=new Array,F=new Array,k=new Array;let b,l,Q,K=O.length;u&&(l=u.length),B&&(Q=B.length);for(let v=0;v<X.length;v+=3){F[0]=X[v],F[1]=X[v+1],F[2]=X[v+2];for(let v=0;v<3;v++)if(x=F[v],M=F[(v+1)%3],void 0===k[x]&&void 0===k[M]?(k[x]=new Array,k[M]=new Array):(void 0===k[x]&&(k[x]=new Array),void 0===k[M]&&(k[M]=new Array)),void 0===k[x][M]&&void 0===k[M][x]){k[x][M]=[],H.x=(O[3*M]-O[3*x])/m,H.y=(O[3*M+1]-O[3*x+1])/m,H.z=(O[3*M+2]-O[3*x+2])/m,B&&(V.x=(B[3*M]-B[3*x])/m,V.y=(B[3*M+1]-B[3*x+1])/m,V.z=(B[3*M+2]-B[3*x+2])/m),u&&(D.x=(u[2*M]-u[2*x])/m,D.y=(u[2*M+1]-u[2*x+1])/m),k[x][M].push(x);for(let v=1;v<m;v++)k[x][M].push(O.length/3),O[K++]=O[3*x]+v*H.x,O[K++]=O[3*x+1]+v*H.y,O[K++]=O[3*x+2]+v*H.z,B&&(B[Q++]=B[3*x]+v*V.x,B[Q++]=B[3*x+1]+v*V.y,B[Q++]=B[3*x+2]+v*V.z),u&&(u[l++]=u[2*x]+v*D.x,u[l++]=u[2*x+1]+v*D.y);k[x][M].push(M),k[M][x]=new Array,b=k[x][M].length;for(let v=0;v<b;v++)k[M][x][v]=k[x][M][b-1-v]}A[0][0]=X[v],A[1][0]=k[X[v]][X[v+1]][1],A[1][1]=k[X[v]][X[v+2]][1];for(let T=2;T<m;T++){A[T][0]=k[X[v]][X[v+1]][T],A[T][T]=k[X[v]][X[v+2]][T],H.x=(O[3*A[T][T]]-O[3*A[T][0]])/T,H.y=(O[3*A[T][T]+1]-O[3*A[T][0]+1])/T,H.z=(O[3*A[T][T]+2]-O[3*A[T][0]+2])/T,B&&(V.x=(B[3*A[T][T]]-B[3*A[T][0]])/T,V.y=(B[3*A[T][T]+1]-B[3*A[T][0]+1])/T,V.z=(B[3*A[T][T]+2]-B[3*A[T][0]+2])/T),u&&(D.x=(u[2*A[T][T]]-u[2*A[T][0]])/T,D.y=(u[2*A[T][T]+1]-u[2*A[T][0]+1])/T);for(let v=1;v<T;v++)A[T][v]=O.length/3,O[K++]=O[3*A[T][0]]+v*H.x,O[K++]=O[3*A[T][0]+1]+v*H.y,O[K++]=O[3*A[T][0]+2]+v*H.z,B&&(B[Q++]=B[3*A[T][0]]+v*V.x,B[Q++]=B[3*A[T][0]+1]+v*V.y,B[Q++]=B[3*A[T][0]+2]+v*V.z),u&&(u[l++]=u[2*A[T][0]]+v*D.x,u[l++]=u[2*A[T][0]+1]+v*D.y)}A[m]=k[X[v+1]][X[v+2]],s.push(A[0][0],A[1][0],A[1][1]);for(let v=1;v<m;v++){let T;for(T=0;T<v;T++)s.push(A[v][T],A[v+1][T],A[v+1][T+1]),s.push(A[v][T],A[v+1][T+1],A[v][T+1]);s.push(A[v][T],A[v+1][T],A[v+1][T+1])}}T.indices=s,T.Ca(this,this.isVertexBufferUpdatable(n.e.PositionKind))}else K.d.Warn("Couldn't increase number of vertices : VertexData must contain at least indices and positions")}forceSharedVertices(){const v=V.e.ExtractFromMesh(this),T=v.Aa,X=v.indices,O=v.xa,u=v.za,B=v.matricesIndices,m=v.matricesWeights,A=v.matricesIndicesExtra,x=v.matricesWeightsExtra;if(void 0===X||void 0===O||null===X||null===O)K.d.Warn("VertexData contains empty entries");else{const f=new Array,M=new Array,H=new Array,D=new Array,s=new Array,F=new Array,k=new Array,b=new Array;let l=new Array,Q=0;const K={};let p,G;for(let v=0;v<X.length;v+=3){G=[X[v],X[v+1],X[v+2]],l=[];for(let v=0;v<3;v++){l[v]="";for(let T=0;T<3;T++)Math.abs(O[3*G[v]+T])<1e-8&&(O[3*G[v]+T]=0),l[v]+=O[3*G[v]+T]+"|"}if(l[0]!=l[1]&&l[0]!=l[2]&&l[1]!=l[2])for(let v=0;v<3;v++){if(p=K[l[v]],void 0===p){K[l[v]]=Q,p=Q++;for(let T=0;T<3;T++)f.push(O[3*G[v]+T]);if(null!==u&&void 0!==u)for(let T=0;T<4;T++)D.push(u[4*G[v]+T]);if(null!==T&&void 0!==T)for(let X=0;X<2;X++)H.push(T[2*G[v]+X]);if(null!==B&&void 0!==B)for(let T=0;T<4;T++)s.push(B[4*G[v]+T]);if(null!==m&&void 0!==m)for(let T=0;T<4;T++)F.push(m[4*G[v]+T]);if(null!==A&&void 0!==A)for(let T=0;T<4;T++)k.push(A[4*G[v]+T]);if(null!==x&&void 0!==x)for(let T=0;T<4;T++)b.push(x[4*G[v]+T])}M.push(p)}}const L=new Array;V.e.ComputeNormals(f,M,L),v.xa=f,v.indices=M,v.ya=L,null!==T&&void 0!==T&&(v.Aa=H),null!==u&&void 0!==u&&(v.za=D),null!==B&&void 0!==B&&(v.matricesIndices=s),null!==m&&void 0!==m&&(v.matricesWeights=F),null!==A&&void 0!==A&&(v.matricesIndicesExtra=k),null!==m&&void 0!==m&&(v.matricesWeightsExtra=b),v.Ca(this,this.isVertexBufferUpdatable(n.e.PositionKind))}}static _instancedMeshFactory(v,T){throw(0,G.d)("InstancedMesh")}static _PhysicsImpostorParser(v,T,X){throw(0,G.d)("PhysicsImpostor")}Jb(v){const T=P._instancedMeshFactory(v,this);return T.parent=this.parent,T}synchronizeInstances(){for(let v=0;v<this.instances.length;v++){this.instances[v]._syncSubMeshes()}return this}optimizeIndices(v){const T=this.Qe(),X=this.getVerticesData(n.e.PositionKind);if(!X||!T)return this;const O=[];for(let u=0;u<X.length;u+=3)O.push(f.l.Ld(X,u));const B=[];return u.b.SyncAsyncForLoop(O.length,40,(v=>{const T=O.length-1-v,X=O[T];for(let u=0;u<T;++u){const v=O[u];if(X.equals(v)){B[T]=u;break}}}),(()=>{for(let v=0;v<T.length;++v)T[v]=B[T[v]]||T[v];const X=this.Ce.slice(0);this.setIndices(T),this.Ce=X,v&&v(this)})),this}serialize(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};v.name=this.name,v.id=this.id,v.uniqueId=this.uniqueId,v.type=this.getClassName(),m.d&&m.d.HasTags(this)&&(v.tags=m.d.GetTags(this)),v.position=this.position.Pd(),this.rotationQuaternion?v.rotationQuaternion=this.rotationQuaternion.Pd():this.rotation&&(v.rotation=this.rotation.Pd()),v.Zd=this.Zd.Pd(),this._postMultiplyPivotMatrix?v.pivotMatrix=this.getPivotMatrix().Pd():v.localMatrix=this.getPivotMatrix().Pd(),v.isEnabled=this.isEnabled(!1),v.isVisible=this.isVisible,v.infiniteDistance=this.infiniteDistance,v.pickable=this.pe,v.receiveShadows=this.receiveShadows,v.billboardMode=this.billboardMode,v.visibility=this.visibility,v.Le=this.Le,v.checkCollisions=this.checkCollisions,v.ellipsoid=this.ellipsoid.Pd(),v.ellipsoidOffset=this.ellipsoidOffset.Pd(),v.Da=this.Da,v.isBlocker=this.isBlocker,v.sideOrientation=this.sideOrientation,this.parent&&this.parent._serializeAsParent(v),v.isUnIndexed=this.isUnIndexed;const T=this._geometry;if(T&&this.Ce){v.geometryUniqueId=T.uniqueId,v.geometryId=T.id,v.Ce=[];for(let T=0;T<this.Ce.length;T++){const X=this.Ce[T];v.Ce.push({materialIndex:X.materialIndex,verticesStart:X.verticesStart,verticesCount:X.verticesCount,indexStart:X.indexStart,indexCount:X.indexCount})}}if(this.material?this.material.doNotSerialize||(v.materialUniqueId=this.material.uniqueId,v.materialId=this.material.id):(this.material=null,v.materialUniqueId=this._scene.defaultMaterial.uniqueId,v.materialId=this._scene.defaultMaterial.id),this.morphTargetManager&&(v.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(v.skeletonId=this.skeleton.id,v.numBoneInfluencers=this.numBoneInfluencers),this.va()._getComponent(L.d.NAME_PHYSICSENGINE)){const T=this.getPhysicsImpostor();T&&(v.physicsMass=T.getParam("mass"),v.physicsFriction=T.getParam("friction"),v.physicsRestitution=T.getParam("mass"),v.physicsImpostor=T.type)}this.metadata&&(v.metadata=this.metadata),v.instances=[];for(let X=0;X<this.instances.length;X++){const T=this.instances[X];if(T.doNotSerialize)continue;const O={name:T.name,id:T.id,isEnabled:T.isEnabled(!1),isVisible:T.isVisible,pe:T.pe,checkCollisions:T.checkCollisions,position:T.position.Pd(),Zd:T.Zd.Pd()};if(T.parent&&T.parent._serializeAsParent(O),T.rotationQuaternion?O.rotationQuaternion=T.rotationQuaternion.Pd():T.rotation&&(O.rotation=T.rotation.Pd()),this.va()._getComponent(L.d.NAME_PHYSICSENGINE)){const v=T.getPhysicsImpostor();v&&(O.physicsMass=v.getParam("mass"),O.physicsFriction=v.getParam("friction"),O.physicsRestitution=v.getParam("mass"),O.physicsImpostor=v.type)}T.metadata&&(O.metadata=T.metadata),T.actionManager&&(O.actions=T.actionManager.serialize(T.name)),v.instances.push(O),Q.e.AppendSerializedAnimations(T,O),O.ranges=T.serializeAnimationRanges()}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData&&(v.thinInstances={instancesCount:this._thinInstanceDataStorage.instancesCount,matrixData:Array.from(this._thinInstanceDataStorage.matrixData),matrixBufferSize:this._thinInstanceDataStorage.matrixBufferSize,enablePicking:this.thinInstanceEnablePicking},this._userThinInstanceBuffersStorage)){const T={data:{},sizes:{},strides:{}};for(const v in this._userThinInstanceBuffersStorage.data)T.data[v]=Array.from(this._userThinInstanceBuffersStorage.data[v]),T.sizes[v]=this._userThinInstanceBuffersStorage.sizes[v],T.strides[v]=this._userThinInstanceBuffersStorage.strides[v];v.thinInstances.userThinInstance=T}return Q.e.AppendSerializedAnimations(this,v),v.ranges=this.serializeAnimationRanges(),v.layerMask=this.layerMask,v.alphaIndex=this.alphaIndex,v.hasVertexAlpha=this.hasVertexAlpha,v.overlayAlpha=this.overlayAlpha,v.overlayColor=this.overlayColor.Pd(),v.renderOverlay=this.renderOverlay,v.applyFog=this.applyFog,this.actionManager&&(v.actions=this.actionManager.serialize(this.name)),v}_syncGeometryWithMorphTargetManager(){if(!this.Ne)return;this._markSubMeshesAsAttributesDirty();const v=this._internalAbstractMeshDataInfo._morphTargetManager;if(v&&v.vertexCount){if(v.vertexCount!==this.getTotalVertices())return K.d.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);if(v.isUsingTextureForTargets)return;for(let T=0;T<v.numInfluencers;T++){const X=v.getActiveTarget(T),O=X.getPositions();if(!O)return void K.d.Error("Invalid morph target. Target must have positions.");this.Ne.Ga(n.e.PositionKind+T,O,!1,3);const u=X.getNormals();u&&this.Ne.Ga(n.e.NormalKind+T,u,!1,3);const B=X.getTangents();B&&this.Ne.Ga(n.e.TangentKind+T,B,!1,3);const m=X.getUVs();m&&this.Ne.Ga(n.e.UVKind+"_"+T,m,!1,2)}}else{let v=0;for(;this.Ne.isVerticesDataPresent(n.e.PositionKind+v);)this.Ne.removeVerticesData(n.e.PositionKind+v),this.Ne.isVerticesDataPresent(n.e.NormalKind+v)&&this.Ne.removeVerticesData(n.e.NormalKind+v),this.Ne.isVerticesDataPresent(n.e.TangentKind+v)&&this.Ne.removeVerticesData(n.e.TangentKind+v),this.Ne.isVerticesDataPresent(n.e.UVKind+v)&&this.Ne.removeVerticesData(n.e.UVKind+"_"+v),v++}}static Parse(v,T,X){let O;if(O=v.type&&"LinesMesh"===v.type?P._LinesMeshParser(v,T):v.type&&"GroundMesh"===v.type?P._GroundMeshParser(v,T):v.type&&"GoldbergMesh"===v.type?P._GoldbergMeshParser(v,T):v.type&&"GreasedLineMesh"===v.type?P._GreasedLineMeshParser(v,T):v.type&&"TrailMesh"===v.type?P._TrailMeshParser(v,T):new P(v.name,T),O.id=v.id,O._waitingParsedUniqueId=v.uniqueId,m.d&&m.d.AddTagsTo(O,v.tags),O.position=f.l.Ld(v.position),void 0!==v.metadata&&(O.metadata=v.metadata),v.rotationQuaternion?O.rotationQuaternion=f.f.Ld(v.rotationQuaternion):v.rotation&&(O.rotation=f.l.Ld(v.rotation)),O.Zd=f.l.Ld(v.Zd),v.localMatrix?O.setPreTransformMatrix(f.b.Ld(v.localMatrix)):v.pivotMatrix&&O.setPivotMatrix(f.b.Ld(v.pivotMatrix)),O.Qg(v.isEnabled),O.isVisible=v.isVisible,O.infiniteDistance=v.infiniteDistance,O.Le=!!v.Le,O.showBoundingBox=v.showBoundingBox,O.showSubMeshesBoundingBox=v.showSubMeshesBoundingBox,void 0!==v.applyFog&&(O.applyFog=v.applyFog),void 0!==v.pickable&&(O.pe=v.pickable),void 0!==v.alphaIndex&&(O.alphaIndex=v.alphaIndex),O.receiveShadows=v.receiveShadows,void 0!==v.billboardMode&&(O.billboardMode=v.billboardMode),void 0!==v.visibility&&(O.visibility=v.visibility),O.checkCollisions=v.checkCollisions,O.Da=!!v.Da,v.ellipsoid&&(O.ellipsoid=f.l.Ld(v.ellipsoid)),v.ellipsoidOffset&&(O.ellipsoidOffset=f.l.Ld(v.ellipsoidOffset)),null!=v.overrideMaterialSideOrientation&&(O.sideOrientation=v.overrideMaterialSideOrientation),void 0!==v.sideOrientation&&(O.sideOrientation=v.sideOrientation),void 0!==v.isBlocker&&(O.isBlocker=v.isBlocker),O._shouldGenerateFlatShading=v.useFlatShading,v.gi&&(O._waitingData.gi=v.gi),void 0!==v.parentId&&(O._waitingParentId=v.parentId),void 0!==v.parentInstanceIndex&&(O._waitingParentInstanceIndex=v.parentInstanceIndex),void 0!==v.actions&&(O._waitingData.actions=v.actions),void 0!==v.overlayAlpha&&(O.overlayAlpha=v.overlayAlpha),void 0!==v.overlayColor&&(O.overlayColor=M.d.Ld(v.overlayColor)),void 0!==v.renderOverlay&&(O.renderOverlay=v.renderOverlay),O.isUnIndexed=!!v.isUnIndexed,O.hasVertexAlpha=v.hasVertexAlpha,v.delayLoadingFile?(O.delayLoadState=4,O.delayLoadingFile=X+v.delayLoadingFile,O.buildBoundingInfo(f.l.Ld(v.boundingBoxMinimum),f.l.Ld(v.boundingBoxMaximum)),v._binaryInfo&&(O._binaryInfo=v._binaryInfo),O._delayInfo=[],v.hasUVs&&O._delayInfo.push(n.e.UVKind),v.hasUVs2&&O._delayInfo.push(n.e.UV2Kind),v.hasUVs3&&O._delayInfo.push(n.e.UV3Kind),v.hasUVs4&&O._delayInfo.push(n.e.UV4Kind),v.hasUVs5&&O._delayInfo.push(n.e.UV5Kind),v.hasUVs6&&O._delayInfo.push(n.e.UV6Kind),v.hasColors&&O._delayInfo.push(n.e.ColorKind),v.hasMatricesIndices&&O._delayInfo.push(n.e.MatricesIndicesKind),v.hasMatricesWeights&&O._delayInfo.push(n.e.MatricesWeightsKind),O._delayLoadingFunction=D.e._ImportGeometry,l.c.ForceFullSceneLoadingForIncremental&&O._checkDelayState()):D.e._ImportGeometry(v,O),v.materialUniqueId?O._waitingMaterialId=v.materialUniqueId:v.materialId&&(O._waitingMaterialId=v.materialId),v.morphTargetManagerId>-1&&(O._waitingMorphTargetManagerId=v.morphTargetManagerId),void 0!==v.skeletonId&&null!==v.skeletonId&&(O.skeleton=T.getLastSkeletonById(v.skeletonId),v.numBoneInfluencers&&(O.numBoneInfluencers=v.numBoneInfluencers)),v.animations){for(let T=0;T<v.animations.length;T++){const X=v.animations[T],u=(0,p.c)("BABYLON.Animation");u&&O.animations.push(u.Parse(X))}H.e.ParseAnimationRanges(O,v,T)}if(v.autoAnimate&&T.beginAnimation(O,v.autoAnimateFrom,v.autoAnimateTo,v.autoAnimateLoop,v.autoAnimateSpeed||1),v.layerMask&&!isNaN(v.layerMask)?O.layerMask=Math.abs(parseInt(v.layerMask)):O.layerMask=268435455,v.physicsImpostor&&(O.physicsImpostor=P._PhysicsImpostorParser(T,O,v)),v.lodMeshIds&&(O._waitingData.lods={ids:v.lodMeshIds,distances:v.lodDistances?v.lodDistances:null,coverages:v.lodCoverages?v.lodCoverages:null}),v.instances)for(let u=0;u<v.instances.length;u++){const X=v.instances[u],B=O.Jb(X.name);if(X.id&&(B.id=X.id),m.d&&(X.tags?m.d.AddTagsTo(B,X.tags):m.d.AddTagsTo(B,v.tags)),B.position=f.l.Ld(X.position),void 0!==X.metadata&&(B.metadata=X.metadata),void 0!==X.parentId&&(B._waitingParentId=X.parentId),void 0!==X.parentInstanceIndex&&(B._waitingParentInstanceIndex=X.parentInstanceIndex),void 0!==X.isEnabled&&null!==X.isEnabled&&B.Qg(X.isEnabled),void 0!==X.isVisible&&null!==X.isVisible&&(B.isVisible=X.isVisible),void 0!==X.pe&&null!==X.pe&&(B.pe=X.pe),X.rotationQuaternion?B.rotationQuaternion=f.f.Ld(X.rotationQuaternion):X.rotation&&(B.rotation=f.l.Ld(X.rotation)),B.Zd=f.l.Ld(X.Zd),void 0!=X.checkCollisions&&null!=X.checkCollisions&&(B.checkCollisions=X.checkCollisions),void 0!=X.pickable&&null!=X.pickable&&(B.pe=X.pickable),void 0!=X.showBoundingBox&&null!=X.showBoundingBox&&(B.showBoundingBox=X.showBoundingBox),void 0!=X.showSubMeshesBoundingBox&&null!=X.showSubMeshesBoundingBox&&(B.showSubMeshesBoundingBox=X.showSubMeshesBoundingBox),void 0!=X.alphaIndex&&null!=X.showSubMeshesBoundingBox&&(B.alphaIndex=X.alphaIndex),X.physicsImpostor&&(B.physicsImpostor=P._PhysicsImpostorParser(T,B,X)),void 0!==X.actions&&(B._waitingData.actions=X.actions),X.animations){for(let v=0;v<X.animations.length;v++){const T=X.animations[v],O=(0,p.c)("BABYLON.Animation");O&&B.animations.push(O.Parse(T))}H.e.ParseAnimationRanges(B,X,T),X.autoAnimate&&T.beginAnimation(B,X.autoAnimateFrom,X.autoAnimateTo,X.autoAnimateLoop,X.autoAnimateSpeed||1)}}if(v.thinInstances){const T=v.thinInstances;if(O.thinInstanceEnablePicking=!!T.enablePicking,T.matrixData?(O.Vj("matrix",new Float32Array(T.matrixData),16,!1),O._thinInstanceDataStorage.matrixBufferSize=T.matrixBufferSize,O._thinInstanceDataStorage.instancesCount=T.instancesCount):O._thinInstanceDataStorage.matrixBufferSize=T.matrixBufferSize,v.thinInstances.userThinInstance){const T=v.thinInstances.userThinInstance;for(const v in T.data)O.Vj(v,new Float32Array(T.data[v]),T.strides[v],!1),O._userThinInstanceBuffersStorage.sizes[v]=T.sizes[v]}}return O}setPositionsForCPUSkinning(){const v=this._internalMeshDataInfo;if(!v._sourcePositions){const T=this.getVerticesData(n.e.PositionKind);if(!T)return v._sourcePositions;v._sourcePositions=new Float32Array(T),this.isVertexBufferUpdatable(n.e.PositionKind)||this.Ga(n.e.PositionKind,T,!0)}return v._sourcePositions}setNormalsForCPUSkinning(){const v=this._internalMeshDataInfo;if(!v._sourceNormals){const T=this.getVerticesData(n.e.NormalKind);if(!T)return v._sourceNormals;v._sourceNormals=new Float32Array(T),this.isVertexBufferUpdatable(n.e.NormalKind)||this.Ga(n.e.NormalKind,T,!0)}return v._sourceNormals}applySkeleton(v){if(!this.Ne)return this;if(this.Ne._softwareSkinningFrameId==this.va().getFrameId())return this;if(this.Ne._softwareSkinningFrameId=this.va().getFrameId(),!this.isVerticesDataPresent(n.e.PositionKind))return this;if(!this.isVerticesDataPresent(n.e.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(n.e.MatricesWeightsKind))return this;const T=this.isVerticesDataPresent(n.e.NormalKind),X=this._internalMeshDataInfo;if(!X._sourcePositions){const v=this.Ce.slice();this.setPositionsForCPUSkinning(),this.Ce=v}T&&!X._sourceNormals&&this.setNormalsForCPUSkinning();let O=this.getVerticesData(n.e.PositionKind);if(!O)return this;O instanceof Float32Array||(O=new Float32Array(O));let u=this.getVerticesData(n.e.NormalKind);if(T){if(!u)return this;u instanceof Float32Array||(u=new Float32Array(u))}const B=this.getVerticesData(n.e.MatricesIndicesKind),m=this.getVerticesData(n.e.MatricesWeightsKind);if(!m||!B)return this;const A=this.numBoneInfluencers>4,x=A?this.getVerticesData(n.e.MatricesIndicesExtraKind):null,M=A?this.getVerticesData(n.e.MatricesWeightsExtraKind):null,H=v.getTransformMatrices(this),V=f.l.Zero(),D=new f.b,s=new f.b;let F,k=0;for(let n=0;n<O.length;n+=3,k+=4){let v;for(F=0;F<4;F++)v=m[k+F],v>0&&(f.b.FromFloat32ArrayToRefScaled(H,Math.floor(16*B[k+F]),v,s),D.addToSelf(s));if(A)for(F=0;F<4;F++)v=M[k+F],v>0&&(f.b.FromFloat32ArrayToRefScaled(H,Math.floor(16*x[k+F]),v,s),D.addToSelf(s));f.l.TransformCoordinatesFromFloatsToRef(X._sourcePositions[n],X._sourcePositions[n+1],X._sourcePositions[n+2],D,V),V.toArray(O,n),T&&(f.l.TransformNormalFromFloatsToRef(X._sourceNormals[n],X._sourceNormals[n+1],X._sourceNormals[n+2],D,V),V.toArray(u,n)),D.reset()}return this.updateVerticesData(n.e.PositionKind,O),T&&this.updateVerticesData(n.e.NormalKind,u),this}static MinMax(v){let T=null,X=null;return v.forEach((function(v){const O=v.getBoundingInfo().boundingBox;T&&X?(T.minimizeInPlace(O.minimumWorld),X.maximizeInPlace(O.maximumWorld)):(T=O.minimumWorld,X=O.maximumWorld)})),T&&X?{min:T,max:X}:{min:f.l.Zero(),max:f.l.Zero()}}static Center(v){const T=v instanceof Array?P.MinMax(v):v;return f.l.Center(T.min,T.max)}static MergeMeshes(v){let T=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],X=arguments.length>2?arguments[2]:void 0,O=arguments.length>3?arguments[3]:void 0,u=arguments.length>4?arguments[4]:void 0,B=arguments.length>5?arguments[5]:void 0;return(0,A.l)(P._MergeMeshesCoroutine(v,T,X,O,u,B,!1))}static MergeMeshesAsync(v){let T=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],X=arguments.length>2?arguments[2]:void 0,O=arguments.length>3?arguments[3]:void 0,u=arguments.length>4?arguments[4]:void 0,B=arguments.length>5?arguments[5]:void 0;return(0,A.i)(P._MergeMeshesCoroutine(v,T,X,O,u,B,!0),(0,A.e)())}static*_MergeMeshesCoroutine(v){let T,X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],O=arguments.length>2?arguments[2]:void 0,u=arguments.length>3?arguments[3]:void 0,B=arguments.length>4?arguments[4]:void 0,m=arguments.length>5?arguments[5]:void 0,A=arguments.length>6?arguments[6]:void 0;if(0===(v=v.filter(Boolean)).length)return null;if(!O){let X=0;for(T=0;T<v.length;T++)if(X+=v[T].getTotalVertices(),X>=65536)return K.d.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}m&&(B=!1);const x=new Array,f=new Array,M=new Array,H=v[0].sideOrientation;for(T=0;T<v.length;T++){const X=v[T];if(X.isAnInstance)return K.d.Warn("Cannot merge instance meshes."),null;if(H!==X.sideOrientation)return K.d.Warn("Cannot merge meshes with different sideOrientation values."),null;if(B&&M.push(X.getTotalIndices()),m)if(X.material){const v=X.material;if(v instanceof b.c){for(let T=0;T<v.Og.length;T++)x.indexOf(v.Og[T])<0&&x.push(v.Og[T]);for(let T=0;T<X.Ce.length;T++)f.push(x.indexOf(v.Og[X.Ce[T].materialIndex])),M.push(X.Ce[T].indexCount)}else{x.indexOf(v)<0&&x.push(v);for(let T=0;T<X.Ce.length;T++)f.push(x.indexOf(v)),M.push(X.Ce[T].indexCount)}}else for(let v=0;v<X.Ce.length;v++)f.push(0),M.push(X.Ce[v].indexCount)}const n=v[0],D=v=>{const T=v.Ke(!0);return{vertexData:V.e.ExtractFromMesh(v,!1,!1),transform:T}},{vertexData:s,transform:k}=D(n);A&&(yield);const l=new Array(v.length-1);for(let V=1;V<v.length;V++)l[V-1]=D(v[V]),A&&(yield);const Q=s._mergeCoroutine(k,l,O,A,!X);let p=Q.next();for(;!p.done;)A&&(yield),p=Q.next();const G=p.value;u||(u=new P(n.name+"_merged",n.va()));const L=G._applyToCoroutine(u,void 0,A);let r=L.next();for(;!r.done;)A&&(yield),r=L.next();if(u.checkCollisions=n.checkCollisions,u.sideOrientation=n.sideOrientation,X)for(T=0;T<v.length;T++)v[T].dispose();if(B||m){u.releaseSubMeshes(),T=0;let v=0;for(;T<M.length;)F.c.CreateFromIndices(0,v,M[T],u,void 0,!1),v+=M[T],T++;for(const T of u.Ce)T.refreshBoundingInfo();u.Ke(!0)}if(m){const v=new b.c(n.name+"_merged",n.va());v.Og=x;for(let T=0;T<u.Ce.length;T++)u.Ce[T].materialIndex=f[T];u.material=v}else u.material=n.material;return u}Lj(v){v._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(v)}Kj(v){const T=v._indexInSourceMeshInstanceArray;if(-1!=T){if(T!==this.instances.length-1){const v=this.instances[this.instances.length-1];this.instances[T]=v,v._indexInSourceMeshInstanceArray=T}v._indexInSourceMeshInstanceArray=-1,this.instances.pop()}}_shouldConvertRHS(){return this._scene.useRightHandedSystem&&this.sideOrientation===k.d.CounterClockWiseSideOrientation}_getRenderingFillMode(v){const T=this.va();return T.forcePointsCloud?k.d.PointFillMode:T.forceWireframe?k.d.WireFrameFillMode:this.overrideRenderingFillMode??v}setMaterialByID(v){return this.setMaterialById(v)}static CreateRibbon(v,T,X,O,u,B,m,A,x){throw new Error("Import MeshBuilder to populate this function")}static kb(v,T,X,O,u,B){throw new Error("Import MeshBuilder to populate this function")}static CreateBox(v,T,X,O,u){throw new Error("Import MeshBuilder to populate this function")}static CreateSphere(v,T,X,O,u,B){throw new Error("Import MeshBuilder to populate this function")}static CreateHemisphere(v,T,X,O){throw new Error("Import MeshBuilder to populate this function")}static CreateCylinder(v,T,X,O,u,B,m,A,x){throw new Error("Import MeshBuilder to populate this function")}static CreateTorus(v,T,X,O,u,B,m){throw new Error("Import MeshBuilder to populate this function")}static CreateTorusKnot(v,T,X,O,u,B,m,A,x,f){throw new Error("Import MeshBuilder to populate this function")}static mb(v,T,X,O,u){throw new Error("Import MeshBuilder to populate this function")}static CreateDashedLines(v,T,X,O,u,B,m,A){throw new Error("Import MeshBuilder to populate this function")}static CreatePolygon(v,T,X,O,u,B,m){throw new Error("Import MeshBuilder to populate this function")}static ExtrudePolygon(v,T,X,O,u,B,m,A){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShape(v,T,X,O,u,B,m,A,x,f){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShapeCustom(v,T,X,O,u,B,m,A,x,f,M,H){throw new Error("Import MeshBuilder to populate this function")}static CreateLathe(v,T,X,O,u,B,m){throw new Error("Import MeshBuilder to populate this function")}static Rg(v,T,X,O,u){throw new Error("Import MeshBuilder to populate this function")}static CreateGround(v,T,X,O,u,B){throw new Error("Import MeshBuilder to populate this function")}static CreateTiledGround(v,T,X,O,u,B,m,A,x){throw new Error("Import MeshBuilder to populate this function")}static CreateGroundFromHeightMap(v,T,X,O,u,B,m,A,x,f,M){throw new Error("Import MeshBuilder to populate this function")}static CreateTube(v,T,X,O,u,B,m,A,x,f){throw new Error("Import MeshBuilder to populate this function")}static CreatePolyhedron(v,T,X){throw new Error("Import MeshBuilder to populate this function")}static CreateIcoSphere(v,T,X){throw new Error("Import MeshBuilder to populate this function")}static CreateDecal(v,T,X,O,u,B){throw new Error("Import MeshBuilder to populate this function")}static CreateCapsule(v,T,X){throw new Error("Import MeshBuilder to populate this function")}static ExtendToGoldberg(v){throw new Error("Import MeshBuilder to populate this function")}}P.FRONTSIDE=V.e.FRONTSIDE,P.BACKSIDE=V.e.BACKSIDE,P.DOUBLESIDE=V.e.DOUBLESIDE,P.DEFAULTSIDE=V.e.DEFAULTSIDE,P.NO_CAP=0,P.CAP_START=1,P.CAP_END=2,P.CAP_ALL=3,P.NO_FLIP=0,P.FLIP_TILE=1,P.ROTATE_TILE=2,P.FLIP_ROW=3,P.ROTATE_ROW=4,P.FLIP_N_ROTATE_TILE=5,P.FLIP_N_ROTATE_ROW=6,P.CENTER=0,P.LEFT=1,P.RIGHT=2,P.TOP=3,P.BOTTOM=4,P.INSTANCEDMESH_SORT_TRANSPARENT=!1,P._GroundMeshParser=(v,T)=>{throw(0,G.d)("GroundMesh")},P._GoldbergMeshParser=(v,T)=>{throw(0,G.d)("GoldbergMesh")},P._LinesMeshParser=(v,T)=>{throw(0,G.d)("LinesMesh")},P._GreasedLineMeshParser=(v,T)=>{throw(0,G.d)("GreasedLineMesh")},P._GreasedLineRibbonMeshParser=(v,T)=>{throw(0,G.d)("GreasedLineRibbonMesh")},P._TrailMeshParser=(v,T)=>{throw(0,G.d)("TrailMesh")},(0,p.f)("BABYLON.Mesh",P)},11937:(v,T,X)=>{"use strict";X.d(T,{e:()=>D});var O=X(985),u=X(1006),B=X(1261),m=X(1095),A=X(1170),x=X(1103),f=X(994),M=X(11916),H=X(1076),n=X(1356);class V{}class D{constructor(){this.uniqueId=0,this.metadata={},this._applyTo=(0,M.h)(this._applyToCoroutine.bind(this)),this.uniqueId=D._UniqueIDGenerator,D._UniqueIDGenerator++}set(v,T){switch(v.length||x.d.Warn(`Setting vertex data kind '${T}' with an empty array`),T){case B.e.PositionKind:this.xa=v;break;case B.e.NormalKind:this.ya=v;break;case B.e.TangentKind:this.tangents=v;break;case B.e.UVKind:this.Aa=v;break;case B.e.UV2Kind:this.uvs2=v;break;case B.e.UV3Kind:this.uvs3=v;break;case B.e.UV4Kind:this.uvs4=v;break;case B.e.UV5Kind:this.uvs5=v;break;case B.e.UV6Kind:this.uvs6=v;break;case B.e.ColorKind:this.za=v;break;case B.e.MatricesIndicesKind:this.matricesIndices=v;break;case B.e.MatricesWeightsKind:this.matricesWeights=v;break;case B.e.MatricesIndicesExtraKind:this.matricesIndicesExtra=v;break;case B.e.MatricesWeightsExtraKind:this.matricesWeightsExtra=v}}Ca(v,T){return this._applyTo(v,T,!1),this}applyToGeometry(v,T){return this._applyTo(v,T,!1),this}updateMesh(v){return this._update(v),this}updateGeometry(v){return this._update(v),this}*_applyToCoroutine(v){let T=arguments.length>1&&void 0!==arguments[1]&&arguments[1],X=arguments.length>2?arguments[2]:void 0;if(this.xa&&(v.Ga(B.e.PositionKind,this.xa,T),X&&(yield)),this.ya&&(v.Ga(B.e.NormalKind,this.ya,T),X&&(yield)),this.tangents&&(v.Ga(B.e.TangentKind,this.tangents,T),X&&(yield)),this.Aa&&(v.Ga(B.e.UVKind,this.Aa,T),X&&(yield)),this.uvs2&&(v.Ga(B.e.UV2Kind,this.uvs2,T),X&&(yield)),this.uvs3&&(v.Ga(B.e.UV3Kind,this.uvs3,T),X&&(yield)),this.uvs4&&(v.Ga(B.e.UV4Kind,this.uvs4,T),X&&(yield)),this.uvs5&&(v.Ga(B.e.UV5Kind,this.uvs5,T),X&&(yield)),this.uvs6&&(v.Ga(B.e.UV6Kind,this.uvs6,T),X&&(yield)),this.za&&(v.Ga(B.e.ColorKind,this.za,T),this.hasVertexAlpha&&void 0!==v.hasVertexAlpha&&(v.hasVertexAlpha=!0),X&&(yield)),this.matricesIndices&&(v.Ga(B.e.MatricesIndicesKind,this.matricesIndices,T),X&&(yield)),this.matricesWeights&&(v.Ga(B.e.MatricesWeightsKind,this.matricesWeights,T),X&&(yield)),this.matricesIndicesExtra&&(v.Ga(B.e.MatricesIndicesExtraKind,this.matricesIndicesExtra,T),X&&(yield)),this.matricesWeightsExtra&&(v.Ga(B.e.MatricesWeightsExtraKind,this.matricesWeightsExtra,T),X&&(yield)),this.indices?(v.setIndices(this.indices,null,T),X&&(yield)):v.setIndices([],null),v.Ce&&this.materialInfos&&this.materialInfos.length>1){const T=v;T.Ce=[];for(const v of this.materialInfos)new n.c(v.materialIndex,v.verticesStart,v.verticesCount,v.indexStart,v.indexCount,T)}return this}_update(v,T,X){return this.xa&&v.updateVerticesData(B.e.PositionKind,this.xa,T,X),this.ya&&v.updateVerticesData(B.e.NormalKind,this.ya,T,X),this.tangents&&v.updateVerticesData(B.e.TangentKind,this.tangents,T,X),this.Aa&&v.updateVerticesData(B.e.UVKind,this.Aa,T,X),this.uvs2&&v.updateVerticesData(B.e.UV2Kind,this.uvs2,T,X),this.uvs3&&v.updateVerticesData(B.e.UV3Kind,this.uvs3,T,X),this.uvs4&&v.updateVerticesData(B.e.UV4Kind,this.uvs4,T,X),this.uvs5&&v.updateVerticesData(B.e.UV5Kind,this.uvs5,T,X),this.uvs6&&v.updateVerticesData(B.e.UV6Kind,this.uvs6,T,X),this.za&&v.updateVerticesData(B.e.ColorKind,this.za,T,X),this.matricesIndices&&v.updateVerticesData(B.e.MatricesIndicesKind,this.matricesIndices,T,X),this.matricesWeights&&v.updateVerticesData(B.e.MatricesWeightsKind,this.matricesWeights,T,X),this.matricesIndicesExtra&&v.updateVerticesData(B.e.MatricesIndicesExtraKind,this.matricesIndicesExtra,T,X),this.matricesWeightsExtra&&v.updateVerticesData(B.e.MatricesWeightsExtraKind,this.matricesWeightsExtra,T,X),this.indices&&v.setIndices(this.indices,null),this}static _TransformVector3Coordinates(v,T){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:v.length;const B=u.g.Vd[0],m=u.g.Vd[1];for(let A=X;A<X+O;A+=3)u.l.FromArrayToRef(v,A,B),u.l.TransformCoordinatesToRef(B,T,m),v[A]=m.x,v[A+1]=m.y,v[A+2]=m.z}static _TransformVector3Normals(v,T){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:v.length;const B=u.g.Vd[0],m=u.g.Vd[1];for(let A=X;A<X+O;A+=3)u.l.FromArrayToRef(v,A,B),u.l.TransformNormalToRef(B,T,m),v[A]=m.x,v[A+1]=m.y,v[A+2]=m.z}static _TransformVector4Normals(v,T){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:v.length;const B=u.g.Vector4[0],m=u.g.Vector4[1];for(let A=X;A<X+O;A+=4)u.o.FromArrayToRef(v,A,B),u.o.TransformNormalToRef(B,T,m),v[A]=m.x,v[A+1]=m.y,v[A+2]=m.z,v[A+3]=m.w}static _FlipFaces(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:v.length;for(let O=T;O<T+X;O+=3){const T=v[O+1];v[O+1]=v[O+2],v[O+2]=T}}transform(v){const T=v.determinant()<0;return this.xa&&D._TransformVector3Coordinates(this.xa,v),this.ya&&D._TransformVector3Normals(this.ya,v),this.tangents&&D._TransformVector4Normals(this.tangents,v),T&&this.indices&&D._FlipFaces(this.indices),this}splitBasedOnMaterialID(){if(!this.materialInfos||this.materialInfos.length<2)return[this];const v=[];for(const T of this.materialInfos){const X=new D;if(this.xa&&(X.xa=this.xa.slice(3*T.verticesStart,3*(T.verticesCount+T.verticesStart))),this.ya&&(X.ya=this.ya.slice(3*T.verticesStart,3*(T.verticesCount+T.verticesStart))),this.tangents&&(X.tangents=this.tangents.slice(4*T.verticesStart,4*(T.verticesCount+T.verticesStart))),this.za&&(X.za=this.za.slice(4*T.verticesStart,4*(T.verticesCount+T.verticesStart))),this.Aa&&(X.Aa=this.Aa.slice(2*T.verticesStart,2*(T.verticesCount+T.verticesStart))),this.uvs2&&(X.uvs2=this.uvs2.slice(2*T.verticesStart,2*(T.verticesCount+T.verticesStart))),this.uvs3&&(X.uvs3=this.uvs3.slice(2*T.verticesStart,2*(T.verticesCount+T.verticesStart))),this.uvs4&&(X.uvs4=this.uvs4.slice(2*T.verticesStart,2*(T.verticesCount+T.verticesStart))),this.uvs5&&(X.uvs5=this.uvs5.slice(2*T.verticesStart,2*(T.verticesCount+T.verticesStart))),this.uvs6&&(X.uvs6=this.uvs6.slice(2*T.verticesStart,2*(T.verticesCount+T.verticesStart))),this.matricesIndices&&(X.matricesIndices=this.matricesIndices.slice(4*T.verticesStart,4*(T.verticesCount+T.verticesStart))),this.matricesIndicesExtra&&(X.matricesIndicesExtra=this.matricesIndicesExtra.slice(4*T.verticesStart,4*(T.verticesCount+T.verticesStart))),this.matricesWeights&&(X.matricesWeights=this.matricesWeights.slice(4*T.verticesStart,4*(T.verticesCount+T.verticesStart))),this.matricesWeightsExtra&&(X.matricesWeightsExtra=this.matricesWeightsExtra.slice(4*T.verticesStart,4*(T.verticesCount+T.verticesStart))),this.indices){X.indices=[];for(let v=T.indexStart;v<T.indexStart+T.indexCount;v++)X.indices.push(this.indices[v]-T.verticesStart)}const O=new V;O.indexStart=0,O.indexCount=X.indices?X.indices.length:0,O.materialIndex=T.materialIndex,O.verticesStart=0,O.verticesCount=(X.xa?X.xa.length:0)/3,X.materialInfos=[O],v.push(X)}return v}merge(v){let T=arguments.length>1&&void 0!==arguments[1]&&arguments[1],X=arguments.length>2&&void 0!==arguments[2]&&arguments[2],O=arguments.length>3&&void 0!==arguments[3]&&arguments[3],u=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const B=Array.isArray(v)?v.map((v=>({vertexData:v}))):[{vertexData:v}];return(0,M.l)(this._mergeCoroutine(void 0,B,T,!1,X,O,u))}*_mergeCoroutine(v,T){var X,O;let u=arguments.length>2&&void 0!==arguments[2]&&arguments[2],m=arguments.length>3?arguments[3]:void 0,A=arguments.length>4?arguments[4]:void 0,x=arguments.length>5&&void 0!==arguments[5]&&arguments[5],f=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this._validate();let M=T.map((v=>v.vertexData)),H=this;if(f)for(const B of M)B&&(B._validate(),!this.ya&&B.ya&&(this.ya=new Float32Array(this.xa.length)),!this.tangents&&B.tangents&&(this.tangents=new Float32Array(this.xa.length/3*4)),!this.Aa&&B.Aa&&(this.Aa=new Float32Array(this.xa.length/3*2)),!this.uvs2&&B.uvs2&&(this.uvs2=new Float32Array(this.xa.length/3*2)),!this.uvs3&&B.uvs3&&(this.uvs3=new Float32Array(this.xa.length/3*2)),!this.uvs4&&B.uvs4&&(this.uvs4=new Float32Array(this.xa.length/3*2)),!this.uvs5&&B.uvs5&&(this.uvs5=new Float32Array(this.xa.length/3*2)),!this.uvs6&&B.uvs6&&(this.uvs6=new Float32Array(this.xa.length/3*2)),!this.za&&B.za&&(this.za=new Float32Array(this.xa.length/3*4),this.za.fill(1)),!this.matricesIndices&&B.matricesIndices&&(this.matricesIndices=new Float32Array(this.xa.length/3*4)),!this.matricesWeights&&B.matricesWeights&&(this.matricesWeights=new Float32Array(this.xa.length/3*4)),!this.matricesIndicesExtra&&B.matricesIndicesExtra&&(this.matricesIndicesExtra=new Float32Array(this.xa.length/3*4)),!this.matricesWeightsExtra&&B.matricesWeightsExtra&&(this.matricesWeightsExtra=new Float32Array(this.xa.length/3*4)));for(const B of M)if(B)if(f)this.ya&&!B.ya&&(B.ya=new Float32Array(B.xa.length)),this.tangents&&!B.tangents&&(B.tangents=new Float32Array(B.xa.length/3*4)),this.Aa&&!B.Aa&&(B.Aa=new Float32Array(B.xa.length/3*2)),this.uvs2&&!B.uvs2&&(B.uvs2=new Float32Array(B.xa.length/3*2)),this.uvs3&&!B.uvs3&&(B.uvs3=new Float32Array(B.xa.length/3*2)),this.uvs4&&!B.uvs4&&(B.uvs4=new Float32Array(B.xa.length/3*2)),this.uvs5&&!B.uvs5&&(B.uvs5=new Float32Array(B.xa.length/3*2)),this.uvs6&&!B.uvs6&&(B.uvs6=new Float32Array(B.xa.length/3*2)),this.za&&!B.za&&(B.za=new Float32Array(B.xa.length/3*4),B.za.fill(1)),this.matricesIndices&&!B.matricesIndices&&(B.matricesIndices=new Float32Array(B.xa.length/3*4)),this.matricesWeights&&!B.matricesWeights&&(B.matricesWeights=new Float32Array(B.xa.length/3*4)),this.matricesIndicesExtra&&!B.matricesIndicesExtra&&(B.matricesIndicesExtra=new Float32Array(B.xa.length/3*4)),this.matricesWeightsExtra&&!B.matricesWeightsExtra&&(B.matricesWeightsExtra=new Float32Array(B.xa.length/3*4));else if(B._validate(),!this.ya!==!B.ya||!this.tangents!==!B.tangents||!this.Aa!==!B.Aa||!this.uvs2!==!B.uvs2||!this.uvs3!==!B.uvs3||!this.uvs4!==!B.uvs4||!this.uvs5!==!B.uvs5||!this.uvs6!==!B.uvs6||!this.za!==!B.za||!this.matricesIndices!==!B.matricesIndices||!this.matricesWeights!==!B.matricesWeights||!this.matricesIndicesExtra!==!B.matricesIndicesExtra||!this.matricesWeightsExtra!==!B.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(x){let X=0,O=0,u=0;const B=[];let m=null;const A=[];for(const T of this.splitBasedOnMaterialID())A.push({vertexData:T,transform:v});for(const v of T)if(v.vertexData)for(const T of v.vertexData.splitBasedOnMaterialID())A.push({vertexData:T,transform:v.transform});A.sort(((v,T)=>{const X=v.vertexData.materialInfos?v.vertexData.materialInfos[0].materialIndex:0,O=T.vertexData.materialInfos?T.vertexData.materialInfos[0].materialIndex:0;return X>O?1:X===O?0:-1}));for(const v of A){const T=v.vertexData;if(X=T.materialInfos?T.materialInfos[0].materialIndex:0,m&&m.materialIndex===X)m.indexCount+=T.indices.length,m.verticesCount+=T.xa.length/3;else{const v=new V;v.materialIndex=X,v.indexStart=O,v.indexCount=T.indices.length,v.verticesStart=u,v.verticesCount=T.xa.length/3,B.push(v),m=v}O+=T.indices.length,u+=T.xa.length/3}const x=A.splice(0,1)[0];H=x.vertexData,v=x.transform,M=A.map((v=>v.vertexData)),T=A,this.materialInfos=B}const n=M.reduce(((v,T)=>{var X;return v+((null===(X=T.indices)||void 0===X?void 0:X.length)??0)}),(null===(X=H.indices)||void 0===X?void 0:X.length)??0);let s=A||M.some((v=>v.indices===H.indices))?null===(O=H.indices)||void 0===O?void 0:O.slice():H.indices;if(n>0){var F;let X=(null===(F=s)||void 0===F?void 0:F.length)??0;if(s||(s=new Array(n)),s.length!==n){if(Array.isArray(s))s.length=n;else{const v=u||s instanceof Uint32Array?new Uint32Array(n):new Uint16Array(n);v.set(s),s=v}v&&v.determinant()<0&&D._FlipFaces(s,0,X)}let O=H.xa?H.xa.length/3:0;for(const{vertexData:v,transform:u}of T)if(v.indices){for(let T=0;T<v.indices.length;T++)s[X+T]=v.indices[T]+O;u&&u.determinant()<0&&D._FlipFaces(s,X,v.indices.length),O+=v.xa.length/3,X+=v.indices.length,m&&(yield)}}return this.indices=s,this.xa=D._MergeElement(B.e.PositionKind,H.xa,v,T.map((v=>[v.vertexData.xa,v.transform]))),m&&(yield),H.ya&&(this.ya=D._MergeElement(B.e.NormalKind,H.ya,v,T.map((v=>[v.vertexData.ya,v.transform]))),m&&(yield)),H.tangents&&(this.tangents=D._MergeElement(B.e.TangentKind,H.tangents,v,T.map((v=>[v.vertexData.tangents,v.transform]))),m&&(yield)),H.Aa&&(this.Aa=D._MergeElement(B.e.UVKind,H.Aa,v,T.map((v=>[v.vertexData.Aa,v.transform]))),m&&(yield)),H.uvs2&&(this.uvs2=D._MergeElement(B.e.UV2Kind,H.uvs2,v,T.map((v=>[v.vertexData.uvs2,v.transform]))),m&&(yield)),H.uvs3&&(this.uvs3=D._MergeElement(B.e.UV3Kind,H.uvs3,v,T.map((v=>[v.vertexData.uvs3,v.transform]))),m&&(yield)),H.uvs4&&(this.uvs4=D._MergeElement(B.e.UV4Kind,H.uvs4,v,T.map((v=>[v.vertexData.uvs4,v.transform]))),m&&(yield)),H.uvs5&&(this.uvs5=D._MergeElement(B.e.UV5Kind,H.uvs5,v,T.map((v=>[v.vertexData.uvs5,v.transform]))),m&&(yield)),H.uvs6&&(this.uvs6=D._MergeElement(B.e.UV6Kind,H.uvs6,v,T.map((v=>[v.vertexData.uvs6,v.transform]))),m&&(yield)),H.za&&(this.za=D._MergeElement(B.e.ColorKind,H.za,v,T.map((v=>[v.vertexData.za,v.transform]))),(void 0!==H.hasVertexAlpha||T.some((v=>void 0!==v.vertexData.hasVertexAlpha)))&&(this.hasVertexAlpha=H.hasVertexAlpha||T.some((v=>v.vertexData.hasVertexAlpha))),m&&(yield)),H.matricesIndices&&(this.matricesIndices=D._MergeElement(B.e.MatricesIndicesKind,H.matricesIndices,v,T.map((v=>[v.vertexData.matricesIndices,v.transform]))),m&&(yield)),H.matricesWeights&&(this.matricesWeights=D._MergeElement(B.e.MatricesWeightsKind,H.matricesWeights,v,T.map((v=>[v.vertexData.matricesWeights,v.transform]))),m&&(yield)),H.matricesIndicesExtra&&(this.matricesIndicesExtra=D._MergeElement(B.e.MatricesIndicesExtraKind,H.matricesIndicesExtra,v,T.map((v=>[v.vertexData.matricesIndicesExtra,v.transform]))),m&&(yield)),H.matricesWeightsExtra&&(this.matricesWeightsExtra=D._MergeElement(B.e.MatricesWeightsExtraKind,H.matricesWeightsExtra,v,T.map((v=>[v.vertexData.matricesWeightsExtra,v.transform])))),this}static _MergeElement(v,T,X,O){const u=O.filter((v=>null!==v[0]&&void 0!==v[0]));if(!T&&0==u.length)return T;if(!T)return this._MergeElement(v,u[0][0],u[0][1],u.slice(1));const m=u.reduce(((v,T)=>v+T[0].length),T.length),A=v===B.e.PositionKind?D._TransformVector3Coordinates:v===B.e.NormalKind?D._TransformVector3Normals:v===B.e.TangentKind?D._TransformVector4Normals:()=>{};if(T instanceof Float32Array){const v=new Float32Array(m);v.set(T),X&&A(v,X,0,T.length);let O=T.length;for(const[T,X]of u)v.set(T,O),X&&A(v,X,O,T.length),O+=T.length;return v}{const v=new Array(m);for(let X=0;X<T.length;X++)v[X]=T[X];X&&A(v,X,0,T.length);let O=T.length;for(const[T,X]of u){for(let X=0;X<T.length;X++)v[O+X]=T[X];X&&A(v,X,O,T.length),O+=T.length}return v}}_validate(){if(!this.xa)throw new H.f("Positions are required",H.e.MeshInvalidPositionsError);const v=(v,T)=>{const X=B.e.DeduceStride(v);if(T.length%X!==0)throw new Error("The "+v+"s array count must be a multiple of "+X);return T.length/X},T=v(B.e.PositionKind,this.xa),X=(X,O)=>{const u=v(X,O);if(u!==T)throw new Error("The "+X+"s element count ("+u+") does not match the positions count ("+T+")")};this.ya&&X(B.e.NormalKind,this.ya),this.tangents&&X(B.e.TangentKind,this.tangents),this.Aa&&X(B.e.UVKind,this.Aa),this.uvs2&&X(B.e.UV2Kind,this.uvs2),this.uvs3&&X(B.e.UV3Kind,this.uvs3),this.uvs4&&X(B.e.UV4Kind,this.uvs4),this.uvs5&&X(B.e.UV5Kind,this.uvs5),this.uvs6&&X(B.e.UV6Kind,this.uvs6),this.za&&X(B.e.ColorKind,this.za),this.matricesIndices&&X(B.e.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&X(B.e.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&X(B.e.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&X(B.e.MatricesWeightsExtraKind,this.matricesWeightsExtra)}clone(){const v=this.serialize();return D.Parse(v)}serialize(){const v={};if(this.xa&&(v.xa=Array.from(this.xa)),this.ya&&(v.ya=Array.from(this.ya)),this.tangents&&(v.tangents=Array.from(this.tangents)),this.Aa&&(v.Aa=Array.from(this.Aa)),this.uvs2&&(v.uvs2=Array.from(this.uvs2)),this.uvs3&&(v.uvs3=Array.from(this.uvs3)),this.uvs4&&(v.uvs4=Array.from(this.uvs4)),this.uvs5&&(v.uvs5=Array.from(this.uvs5)),this.uvs6&&(v.uvs6=Array.from(this.uvs6)),this.za&&(v.za=Array.from(this.za),v.hasVertexAlpha=this.hasVertexAlpha),this.matricesIndices&&(v.matricesIndices=Array.from(this.matricesIndices),v.matricesIndices._isExpanded=!0),this.matricesWeights&&(v.matricesWeights=Array.from(this.matricesWeights)),this.matricesIndicesExtra&&(v.matricesIndicesExtra=Array.from(this.matricesIndicesExtra),v.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(v.matricesWeightsExtra=Array.from(this.matricesWeightsExtra)),v.indices=Array.from(this.indices),this.materialInfos){v.materialInfos=[];for(const T of this.materialInfos){const X={indexStart:T.indexStart,indexCount:T.indexCount,materialIndex:T.materialIndex,verticesStart:T.verticesStart,verticesCount:T.verticesCount};v.materialInfos.push(X)}}return v}static ExtractFromMesh(v,T,X){return D._ExtractFrom(v,T,X)}static ExtractFromGeometry(v,T,X){return D._ExtractFrom(v,T,X)}static _ExtractFrom(v,T,X){const O=new D;if(v.isVerticesDataPresent(B.e.PositionKind)&&(O.xa=v.getVerticesData(B.e.PositionKind,T,X)),v.isVerticesDataPresent(B.e.NormalKind)&&(O.ya=v.getVerticesData(B.e.NormalKind,T,X)),v.isVerticesDataPresent(B.e.TangentKind)&&(O.tangents=v.getVerticesData(B.e.TangentKind,T,X)),v.isVerticesDataPresent(B.e.UVKind)&&(O.Aa=v.getVerticesData(B.e.UVKind,T,X)),v.isVerticesDataPresent(B.e.UV2Kind)&&(O.uvs2=v.getVerticesData(B.e.UV2Kind,T,X)),v.isVerticesDataPresent(B.e.UV3Kind)&&(O.uvs3=v.getVerticesData(B.e.UV3Kind,T,X)),v.isVerticesDataPresent(B.e.UV4Kind)&&(O.uvs4=v.getVerticesData(B.e.UV4Kind,T,X)),v.isVerticesDataPresent(B.e.UV5Kind)&&(O.uvs5=v.getVerticesData(B.e.UV5Kind,T,X)),v.isVerticesDataPresent(B.e.UV6Kind)&&(O.uvs6=v.getVerticesData(B.e.UV6Kind,T,X)),v.isVerticesDataPresent(B.e.ColorKind)){const u=v.Ne||v,m=u.getVertexBuffer(B.e.ColorKind),A=u.getVerticesData(B.e.ColorKind,T,X);if(3===m.getSize()){const v=new Float32Array(4*A.length/3);for(let T=0,X=0;T<A.length;T+=3,X+=4)v[X]=A[T],v[X+1]=A[T+1],v[X+2]=A[T+2],v[X+3]=1;O.za=v}else{if(4!==m.getSize())throw new Error(`Unexpected number of color components: ${m.getSize()}`);O.za=A}}return v.isVerticesDataPresent(B.e.MatricesIndicesKind)&&(O.matricesIndices=v.getVerticesData(B.e.MatricesIndicesKind,T,X)),v.isVerticesDataPresent(B.e.MatricesWeightsKind)&&(O.matricesWeights=v.getVerticesData(B.e.MatricesWeightsKind,T,X)),v.isVerticesDataPresent(B.e.MatricesIndicesExtraKind)&&(O.matricesIndicesExtra=v.getVerticesData(B.e.MatricesIndicesExtraKind,T,X)),v.isVerticesDataPresent(B.e.MatricesWeightsExtraKind)&&(O.matricesWeightsExtra=v.getVerticesData(B.e.MatricesWeightsExtraKind,T,X)),O.indices=v.Qe(T,X),O}static CreateRibbon(v){throw(0,m.d)("ribbonBuilder")}static CreateBox(v){throw(0,m.d)("boxBuilder")}static CreateTiledBox(v){throw(0,m.d)("tiledBoxBuilder")}static CreateTiledPlane(v){throw(0,m.d)("tiledPlaneBuilder")}static CreateSphere(v){throw(0,m.d)("sphereBuilder")}static CreateCylinder(v){throw(0,m.d)("cylinderBuilder")}static CreateTorus(v){throw(0,m.d)("torusBuilder")}static CreateLineSystem(v){throw(0,m.d)("linesBuilder")}static CreateDashedLines(v){throw(0,m.d)("linesBuilder")}static CreateGround(v){throw(0,m.d)("groundBuilder")}static CreateTiledGround(v){throw(0,m.d)("groundBuilder")}static CreateGroundFromHeightMap(v){throw(0,m.d)("groundBuilder")}static Rg(v){throw(0,m.d)("planeBuilder")}static kb(v){throw(0,m.d)("discBuilder")}static CreatePolygon(v,T,X,O,u,B,A){throw(0,m.d)("polygonBuilder")}static CreateIcoSphere(v){throw(0,m.d)("icoSphereBuilder")}static CreatePolyhedron(v){throw(0,m.d)("polyhedronBuilder")}static CreateCapsule(){arguments.length>0&&void 0!==arguments[0]||u.l.Up();throw(0,m.d)("capsuleBuilder")}static CreateTorusKnot(v){throw(0,m.d)("torusKnotBuilder")}static ComputeNormals(v,T,X,O){let B=0,m=0,A=0,x=0,f=0,M=0,H=0,n=0,V=0,D=0,s=0,F=0,k=0,b=0,l=0,Q=0,K=0,p=0,G=0,L=0,r=!1,o=!1,Z=!1,U=!1,J=1,y=0,P=null;O&&(r=!!O.facetNormals,o=!!O.facetPositions,Z=!!O.facetPartitioning,J=!0===O.useRightHandedSystem?-1:1,y=O.ratio||0,U=!!O.depthSort,P=O.distanceTo,U&&void 0===P&&(P=u.l.Zero()));let a=0,E=0,i=0,t=0;for(Z&&O&&O.bbSize&&(a=O.subDiv.X*y/O.bbSize.x,E=O.subDiv.Y*y/O.bbSize.y,i=O.subDiv.Z*y/O.bbSize.z,t=O.subDiv.max*O.subDiv.max,O.facetPartitioning.length=0),B=0;B<v.length;B++)X[B]=0;const C=T.length/3|0;for(B=0;B<C;B++){if(F=3*T[3*B],k=F+1,b=F+2,l=3*T[3*B+1],Q=l+1,K=l+2,p=3*T[3*B+2],G=p+1,L=p+2,m=v[F]-v[l],A=v[k]-v[Q],x=v[b]-v[K],f=v[p]-v[l],M=v[G]-v[Q],H=v[L]-v[K],n=J*(A*H-x*M),V=J*(x*f-m*H),D=J*(m*M-A*f),s=Math.sqrt(n*n+V*V+D*D),s=0===s?1:s,n/=s,V/=s,D/=s,r&&O&&(O.facetNormals[B].x=n,O.facetNormals[B].y=V,O.facetNormals[B].z=D),o&&O&&(O.facetPositions[B].x=(v[F]+v[l]+v[p])/3,O.facetPositions[B].y=(v[k]+v[Q]+v[G])/3,O.facetPositions[B].z=(v[b]+v[K]+v[L])/3),Z&&O){const T=Math.floor((O.facetPositions[B].x-O.bInfo.minimum.x*y)*a),X=Math.floor((O.facetPositions[B].y-O.bInfo.minimum.y*y)*E),u=Math.floor((O.facetPositions[B].z-O.bInfo.minimum.z*y)*i),m=Math.floor((v[F]-O.bInfo.minimum.x*y)*a),A=Math.floor((v[k]-O.bInfo.minimum.y*y)*E),x=Math.floor((v[b]-O.bInfo.minimum.z*y)*i),f=Math.floor((v[l]-O.bInfo.minimum.x*y)*a),M=Math.floor((v[Q]-O.bInfo.minimum.y*y)*E),H=Math.floor((v[K]-O.bInfo.minimum.z*y)*i),n=Math.floor((v[p]-O.bInfo.minimum.x*y)*a),V=Math.floor((v[G]-O.bInfo.minimum.y*y)*E),D=Math.floor((v[L]-O.bInfo.minimum.z*y)*i),s=m+O.subDiv.max*A+t*x,r=f+O.subDiv.max*M+t*H,o=n+O.subDiv.max*V+t*D,Z=T+O.subDiv.max*X+t*u;O.facetPartitioning[Z]=O.facetPartitioning[Z]?O.facetPartitioning[Z]:new Array,O.facetPartitioning[s]=O.facetPartitioning[s]?O.facetPartitioning[s]:new Array,O.facetPartitioning[r]=O.facetPartitioning[r]?O.facetPartitioning[r]:new Array,O.facetPartitioning[o]=O.facetPartitioning[o]?O.facetPartitioning[o]:new Array,O.facetPartitioning[s].push(B),r!=s&&O.facetPartitioning[r].push(B),o!=r&&o!=s&&O.facetPartitioning[o].push(B),Z!=s&&Z!=r&&Z!=o&&O.facetPartitioning[Z].push(B)}if(U&&O&&O.facetPositions){const v=O.depthSortedFacets[B];v.ind=3*B,v.sqDistance=u.l.DistanceSquared(O.facetPositions[B],P)}X[F]+=n,X[k]+=V,X[b]+=D,X[l]+=n,X[Q]+=V,X[K]+=D,X[p]+=n,X[G]+=V,X[L]+=D}for(B=0;B<X.length/3;B++)n=X[3*B],V=X[3*B+1],D=X[3*B+2],s=Math.sqrt(n*n+V*V+D*D),s=0===s?1:s,n/=s,V/=s,D/=s,X[3*B]=n,X[3*B+1]=V,X[3*B+2]=D}static _ComputeSides(v,T,X,O,B,m,A){const x=X.length,f=O.length;let M,H;switch(v=v||D.DEFAULTSIDE){case D.FRONTSIDE:break;case D.BACKSIDE:for(M=0;M<x;M+=3){const v=X[M];X[M]=X[M+2],X[M+2]=v}for(H=0;H<f;H++)O[H]=-O[H];break;case D.DOUBLESIDE:{const v=T.length,n=v/3;for(let X=0;X<v;X++)T[v+X]=T[X];for(M=0;M<x;M+=3)X[M+x]=X[M+2]+n,X[M+1+x]=X[M+1]+n,X[M+2+x]=X[M]+n;for(H=0;H<f;H++)O[f+H]=-O[H];const V=B.length;let D=0;for(D=0;D<V;D++)B[D+V]=B[D];for(m=m||new u.o(0,0,1,1),A=A||new u.o(0,0,1,1),D=0,M=0;M<V/2;M++)B[D]=m.x+(m.z-m.x)*B[D],B[D+1]=m.y+(m.w-m.y)*B[D+1],B[D+V]=A.x+(A.z-A.x)*B[D+V],B[D+V+1]=A.y+(A.w-A.y)*B[D+V+1],D+=2;break}}}static Parse(v){const T=new D,X=v.xa;X&&T.set(X,B.e.PositionKind);const O=v.ya;O&&T.set(O,B.e.NormalKind);const u=v.tangents;u&&T.set(u,B.e.TangentKind);const m=v.Aa;m&&T.set(m,B.e.UVKind);const x=v.uvs2;x&&T.set(x,B.e.UV2Kind);const f=v.uvs3;f&&T.set(f,B.e.UV3Kind);const M=v.uvs4;M&&T.set(M,B.e.UV4Kind);const H=v.uvs5;H&&T.set(H,B.e.UV5Kind);const n=v.uvs6;n&&T.set(n,B.e.UV6Kind);const s=v.za;s&&(T.set(A.g.CheckColors4(s,X.length/3),B.e.ColorKind),void 0!==v.hasVertexAlpha&&(T.hasVertexAlpha=v.hasVertexAlpha));const F=v.matricesIndices;F&&T.set(F,B.e.MatricesIndicesKind);const k=v.matricesWeights;k&&T.set(k,B.e.MatricesWeightsKind);const b=v.indices;b&&(T.indices=b);const l=v.materialInfos;if(l){T.materialInfos=[];for(const v of l){const X=new V;X.indexCount=v.indexCount,X.indexStart=v.indexStart,X.verticesCount=v.verticesCount,X.verticesStart=v.verticesStart,X.materialIndex=v.materialIndex,T.materialInfos.push(X)}}return T}static ImportVertexData(v,T){const X=D.Parse(v);T.setAllVerticesData(X,v.updatable)}}D.FRONTSIDE=0,D.BACKSIDE=1,D.DOUBLESIDE=2,D.DEFAULTSIDE=0,D._UniqueIDGenerator=0,(0,O.c)([f.g.filter((function(){for(var v=arguments.length,T=new Array(v),X=0;X<v;X++)T[X]=arguments[X];let[O]=T;return!Array.isArray(O)}))],D,"_TransformVector3Coordinates",null),(0,O.c)([f.g.filter((function(){for(var v=arguments.length,T=new Array(v),X=0;X<v;X++)T[X]=arguments[X];let[O]=T;return!Array.isArray(O)}))],D,"_TransformVector3Normals",null),(0,O.c)([f.g.filter((function(){for(var v=arguments.length,T=new Array(v),X=0;X<v;X++)T[X]=arguments[X];let[O]=T;return!Array.isArray(O)}))],D,"_TransformVector4Normals",null),(0,O.c)([f.g.filter((function(){for(var v=arguments.length,T=new Array(v),X=0;X<v;X++)T[X]=arguments[X];let[O]=T;return!Array.isArray(O)}))],D,"_FlipFaces",null)},12936:(v,T,X)=>{"use strict";X.d(T,{c:()=>sv});var O=X(1006),u=X(11911),B=X(1261),m=X(11937),A=X(1194);function x(v){let T=v.pathArray;const X=v.closeArray||!1,O=v.closePath||!1,u=v.invertUV||!1,x=Math.floor(T[0].length/2);let f=v.offset||x;f=f>x?x:Math.floor(f);const M=0===v.sideOrientation?0:v.sideOrientation||m.e.DEFAULTSIDE,H=v.Aa,n=v.za,V=[],D=[],s=[],F=[],k=[],b=[],l=[],Q=[];let K;const p=[],G=[];let L,r,o;if(T.length<2){const v=[],X=[];for(r=0;r<T[0].length-f;r++)v.push(T[0][r]),X.push(T[0][r+f]);T=[v,X]}let Z=0;const U=O?1:0,J=X?1:0;let y,P,a,E,i,t;for(K=T[0].length,L=0;L<T.length+J;L++){for(l[L]=0,k[L]=[0],y=L===T.length?T[0]:T[L],P=y.length,K=K<P?K:P,o=0;o<P;)V.push(y[o].x,y[o].y,y[o].z),o>0&&(a=y[o].Xc(y[o-1]).length(),E=a+l[L],k[L].push(E),l[L]=E),o++;O&&(o--,V.push(y[0].x,y[0].y,y[0].z),a=y[o].Xc(y[0]).length(),E=a+l[L],k[L].push(E),l[L]=E),p[L]=P+U,G[L]=Z,Z+=P+U}let C,c,N=null,d=null;for(r=0;r<K+U;r++)for(Q[r]=0,b[r]=[0],L=0;L<T.length-1+J;L++)i=T[L],t=L===T.length-1?T[0]:T[L+1],r===K?(N=i[0],d=t[0]):(N=i[r],d=t[r]),a=d.Xc(N).length(),E=a+Q[r],b[r].push(E),Q[r]=E;if(H)for(L=0;L<H.length;L++)F.push(H[L].x,A.d?1-H[L].y:H[L].y);else for(L=0;L<T.length+J;L++)for(r=0;r<K+U;r++)C=0!=l[L]?k[L][r]/l[L]:0,c=0!=Q[r]?b[r][L]/Q[r]:0,u?F.push(c,C):F.push(C,A.d?1-c:c);L=0;let I=0,W=p[L]-1,g=p[L+1]-1,j=W<g?W:g,e=G[1]-G[0];const h=p.length-1;for(;I<=j&&L<h;)D.push(I,I+e,I+1),D.push(I+e+1,I+1,I+e),I+=1,I===j&&(L++,e=G[L+1]-G[L],W=p[L]-1,g=p[L+1]-1,I=G[L],j=W<g?W+I:g+I);if(m.e.ComputeNormals(V,D,s),O){let v=0,X=0;for(L=0;L<T.length;L++){v=3*G[L],X=L+1<T.length?3*(G[L+1]-1):s.length-3,s[v]=.5*(s[v]+s[X]),s[v+1]=.5*(s[v+1]+s[X+1]),s[v+2]=.5*(s[v+2]+s[X+2]);const O=Math.sqrt(s[v]*s[v]+s[v+1]*s[v+1]+s[v+2]*s[v+2]);s[v]/=O,s[v+1]/=O,s[v+2]/=O,s[X]=s[v],s[X+1]=s[v+1],s[X+2]=s[v+2]}}if(X){let v=3*G[0],X=3*G[T.length];for(r=0;r<K+U;r++){s[v]=.5*(s[v]+s[X]),s[v+1]=.5*(s[v+1]+s[X+1]),s[v+2]=.5*(s[v+2]+s[X+2]);const T=Math.sqrt(s[v]*s[v]+s[v+1]*s[v+1]+s[v+2]*s[v+2]);s[v]/=T,s[v+1]/=T,s[v+2]/=T,s[X]=s[v],s[X+1]=s[v+1],s[X+2]=s[v+2],v+=3,X+=3}}m.e._ComputeSides(M,V,D,s,F,v.frontUVs,v.backUVs);let S=null;if(n){S=new Float32Array(4*n.length);for(let v=0;v<n.length;v++)S[4*v]=n[v].r,S[4*v+1]=n[v].g,S[4*v+2]=n[v].b,S[4*v+3]=n[v].a}const w=new m.e,z=new Float32Array(V),R=new Float32Array(s),Y=new Float32Array(F);return w.indices=D,w.xa=z,w.ya=R,w.Aa=Y,S&&w.set(S,B.e.ColorKind),O&&(w._idx=G),w}function f(v,T){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const f=T.pathArray,M=T.closeArray,H=T.closePath,n=u.d._GetDefaultSideOrientation(T.sideOrientation),V=T.instance,D=T.updatable;if(V){const v=O.g.Vd[0].Td(Number.MAX_VALUE),X=O.g.Vd[1].Td(-Number.MAX_VALUE),x=T=>{let O=f[0].length;const B=V;let m=0;const A=B._originalBuilderSideOrientation===u.d.DOUBLESIDE?2:1;for(let u=1;u<=A;++u)for(let A=0;A<f.length;++A){const u=f[A],x=u.length;O=O<x?O:x;for(let B=0;B<O;++B){const O=u[B];T[m]=O.x,T[m+1]=O.y,T[m+2]=O.z,v.minimizeInPlaceFromFloats(O.x,O.y,O.z),X.maximizeInPlaceFromFloats(O.x,O.y,O.z),m+=3}if(B._creationDataStorage&&B._creationDataStorage.closePath){const v=u[0];T[m]=v.x,T[m+1]=v.y,T[m+2]=v.z,m+=3}}},M=V.getVerticesData(B.e.PositionKind);if(x(M),V.hasBoundingInfo?V.getBoundingInfo().reConstruct(v,X,V._worldMatrix):V.buildBoundingInfo(v,X,V._worldMatrix),V.updateVerticesData(B.e.PositionKind,M,!1,!1),T.za){const v=V.getVerticesData(B.e.ColorKind);for(let X=0,O=0;X<T.za.length;X++,O+=4){const u=T.za[X];v[O]=u.r,v[O+1]=u.g,v[O+2]=u.b,v[O+3]=u.a}V.updateVerticesData(B.e.ColorKind,v,!1,!1)}if(T.Aa){const v=V.getVerticesData(B.e.UVKind);for(let X=0;X<T.Aa.length;X++)v[2*X]=T.Aa[X].x,v[2*X+1]=A.d?1-T.Aa[X].y:T.Aa[X].y;V.updateVerticesData(B.e.UVKind,v,!1,!1)}if(!V.areNormalsFrozen||V.isFacetDataEnabled){const v=V.Qe(),T=V.getVerticesData(B.e.NormalKind),X=V.isFacetDataEnabled?V.getFacetDataParameters():null;if(m.e.ComputeNormals(M,v,T,X),V._creationDataStorage&&V._creationDataStorage.closePath){let v=0,X=0;for(let O=0;O<f.length;O++)v=3*V._creationDataStorage.idx[O],X=O+1<f.length?3*(V._creationDataStorage.idx[O+1]-1):T.length-3,T[v]=.5*(T[v]+T[X]),T[v+1]=.5*(T[v+1]+T[X+1]),T[v+2]=.5*(T[v+2]+T[X+2]),T[X]=T[v],T[X+1]=T[v+1],T[X+2]=T[v+2]}V.areNormalsFrozen||V.updateVerticesData(B.e.NormalKind,T,!1,!1)}return V}{const O=new u.d(v,X);O._originalBuilderSideOrientation=n,O._creationDataStorage=new u.g;const B=x(T);return H&&(O._creationDataStorage.idx=B._idx),O._creationDataStorage.closePath=H,O._creationDataStorage.closeArray=M,B.Ca(O,D),O}}m.e.CreateRibbon=x,u.d.CreateRibbon=function(v,T){return f(v,{pathArray:T,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var M=X(12106),H=X(11972),n=X(1170);function V(v){const T=v.pattern||u.d.NO_FLIP,X=v.tileWidth||v.tileSize||1,O=v.tileHeight||v.tileSize||1,B=v.alignHorizontal||0,A=v.alignVertical||0,x=v.width||v.size||1,f=Math.floor(x/X);let M=x-f*X;const H=v.height||v.size||1,n=Math.floor(H/O);let V=H-n*O;const D=X*f/2,s=O*n/2;let F=0,k=0,b=0,l=0,Q=0,K=0;if(M>0||V>0){switch(b=-D,l=-s,Q=D,K=s,B){case u.d.CENTER:M/=2,b-=M,Q+=M;break;case u.d.LEFT:Q+=M,F=-M/2;break;case u.d.RIGHT:b-=M,F=M/2}switch(A){case u.d.CENTER:V/=2,l-=V,K+=V;break;case u.d.BOTTOM:K+=V,k=-V/2;break;case u.d.TOP:l-=V,k=V/2}}const p=[],G=[],L=[];L[0]=[0,0,1,0,1,1,0,1],L[1]=[0,0,1,0,1,1,0,1],T!==u.d.ROTATE_TILE&&T!==u.d.ROTATE_ROW||(L[1]=[1,1,0,1,0,0,1,0]),T!==u.d.FLIP_TILE&&T!==u.d.FLIP_ROW||(L[1]=[1,0,0,0,0,1,1,1]),T!==u.d.FLIP_N_ROTATE_TILE&&T!==u.d.FLIP_N_ROTATE_ROW||(L[1]=[0,1,1,1,1,0,0,0]);let r=[];const o=[],Z=[];let U=0;for(let m=0;m<n;m++)for(let v=0;v<f;v++)p.push(v*X-D+F,m*O-s+k,0),p.push((v+1)*X-D+F,m*O-s+k,0),p.push((v+1)*X-D+F,(m+1)*O-s+k,0),p.push(v*X-D+F,(m+1)*O-s+k,0),Z.push(U,U+1,U+3,U+1,U+2,U+3),r=T===u.d.FLIP_TILE||T===u.d.ROTATE_TILE||T===u.d.FLIP_N_ROTATE_TILE?r.concat(L[(v%2+m%2)%2]):T===u.d.FLIP_ROW||T===u.d.ROTATE_ROW||T===u.d.FLIP_N_ROTATE_ROW?r.concat(L[m%2]):r.concat(L[0]),o.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),G.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),U+=4;if(M>0||V>0){const v=V>0&&(A===u.d.CENTER||A===u.d.TOP),m=V>0&&(A===u.d.CENTER||A===u.d.BOTTOM),x=M>0&&(B===u.d.CENTER||B===u.d.RIGHT),H=M>0&&(B===u.d.CENTER||B===u.d.LEFT);let L,J,y,P,a=[];if(v&&x&&(p.push(b+F,l+k,0),p.push(-D+F,l+k,0),p.push(-D+F,l+V+k,0),p.push(b+F,l+V+k,0),Z.push(U,U+1,U+3,U+1,U+2,U+3),U+=4,L=1-M/X,J=1-V/O,y=1,P=1,a=[L,J,y,J,y,P,L,P],T===u.d.ROTATE_ROW&&(a=[1-L,1-J,1-y,1-J,1-y,1-P,1-L,1-P]),T===u.d.FLIP_ROW&&(a=[1-L,J,1-y,J,1-y,P,1-L,P]),T===u.d.FLIP_N_ROTATE_ROW&&(a=[L,1-J,y,1-J,y,1-P,L,1-P]),r=r.concat(a),o.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),G.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),v&&H&&(p.push(D+F,l+k,0),p.push(Q+F,l+k,0),p.push(Q+F,l+V+k,0),p.push(D+F,l+V+k,0),Z.push(U,U+1,U+3,U+1,U+2,U+3),U+=4,L=0,J=1-V/O,y=M/X,P=1,a=[L,J,y,J,y,P,L,P],(T===u.d.ROTATE_ROW||T===u.d.ROTATE_TILE&&f%2===0)&&(a=[1-L,1-J,1-y,1-J,1-y,1-P,1-L,1-P]),(T===u.d.FLIP_ROW||T===u.d.FLIP_TILE&&f%2===0)&&(a=[1-L,J,1-y,J,1-y,P,1-L,P]),(T===u.d.FLIP_N_ROTATE_ROW||T===u.d.FLIP_N_ROTATE_TILE&&f%2===0)&&(a=[L,1-J,y,1-J,y,1-P,L,1-P]),r=r.concat(a),o.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),G.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),m&&x&&(p.push(b+F,s+k,0),p.push(-D+F,s+k,0),p.push(-D+F,K+k,0),p.push(b+F,K+k,0),Z.push(U,U+1,U+3,U+1,U+2,U+3),U+=4,L=1-M/X,J=0,y=1,P=V/O,a=[L,J,y,J,y,P,L,P],(T===u.d.ROTATE_ROW&&n%2===1||T===u.d.ROTATE_TILE&&n%1===0)&&(a=[1-L,1-J,1-y,1-J,1-y,1-P,1-L,1-P]),(T===u.d.FLIP_ROW&&n%2===1||T===u.d.FLIP_TILE&&n%2===0)&&(a=[1-L,J,1-y,J,1-y,P,1-L,P]),(T===u.d.FLIP_N_ROTATE_ROW&&n%2===1||T===u.d.FLIP_N_ROTATE_TILE&&n%2===0)&&(a=[L,1-J,y,1-J,y,1-P,L,1-P]),r=r.concat(a),o.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),G.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),m&&H&&(p.push(D+F,s+k,0),p.push(Q+F,s+k,0),p.push(Q+F,K+k,0),p.push(D+F,K+k,0),Z.push(U,U+1,U+3,U+1,U+2,U+3),U+=4,L=0,J=0,y=M/X,P=V/O,a=[L,J,y,J,y,P,L,P],(T===u.d.ROTATE_ROW&&n%2===1||T===u.d.ROTATE_TILE&&(n+f)%2===1)&&(a=[1-L,1-J,1-y,1-J,1-y,1-P,1-L,1-P]),(T===u.d.FLIP_ROW&&n%2===1||T===u.d.FLIP_TILE&&(n+f)%2===1)&&(a=[1-L,J,1-y,J,1-y,P,1-L,P]),(T===u.d.FLIP_N_ROTATE_ROW&&n%2===1||T===u.d.FLIP_N_ROTATE_TILE&&(n+f)%2===1)&&(a=[L,1-J,y,1-J,y,1-P,L,1-P]),r=r.concat(a),o.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),G.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),v){const v=[];L=0,J=1-V/O,y=1,P=1,v[0]=[L,J,y,J,y,P,L,P],v[1]=[L,J,y,J,y,P,L,P],T!==u.d.ROTATE_TILE&&T!==u.d.ROTATE_ROW||(v[1]=[1-L,1-J,1-y,1-J,1-y,1-P,1-L,1-P]),T!==u.d.FLIP_TILE&&T!==u.d.FLIP_ROW||(v[1]=[1-L,J,1-y,J,1-y,P,1-L,P]),T!==u.d.FLIP_N_ROTATE_TILE&&T!==u.d.FLIP_N_ROTATE_ROW||(v[1]=[L,1-J,y,1-J,y,1-P,L,1-P]);for(let O=0;O<f;O++)p.push(O*X-D+F,l+k,0),p.push((O+1)*X-D+F,l+k,0),p.push((O+1)*X-D+F,l+V+k,0),p.push(O*X-D+F,l+V+k,0),Z.push(U,U+1,U+3,U+1,U+2,U+3),U+=4,r=T===u.d.FLIP_TILE||T===u.d.ROTATE_TILE||T===u.d.FLIP_N_ROTATE_TILE?r.concat(v[(O+1)%2]):T===u.d.FLIP_ROW||T===u.d.ROTATE_ROW||T===u.d.FLIP_N_ROTATE_ROW?r.concat(v[1]):r.concat(v[0]),o.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),G.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(m){const v=[];L=0,J=0,y=1,P=V/O,v[0]=[L,J,y,J,y,P,L,P],v[1]=[L,J,y,J,y,P,L,P],T!==u.d.ROTATE_TILE&&T!==u.d.ROTATE_ROW||(v[1]=[1-L,1-J,1-y,1-J,1-y,1-P,1-L,1-P]),T!==u.d.FLIP_TILE&&T!==u.d.FLIP_ROW||(v[1]=[1-L,J,1-y,J,1-y,P,1-L,P]),T!==u.d.FLIP_N_ROTATE_TILE&&T!==u.d.FLIP_N_ROTATE_ROW||(v[1]=[L,1-J,y,1-J,y,1-P,L,1-P]);for(let O=0;O<f;O++)p.push(O*X-D+F,K-V+k,0),p.push((O+1)*X-D+F,K-V+k,0),p.push((O+1)*X-D+F,K+k,0),p.push(O*X-D+F,K+k,0),Z.push(U,U+1,U+3,U+1,U+2,U+3),U+=4,r=T===u.d.FLIP_TILE||T===u.d.ROTATE_TILE||T===u.d.FLIP_N_ROTATE_TILE?r.concat(v[(O+n)%2]):T===u.d.FLIP_ROW||T===u.d.ROTATE_ROW||T===u.d.FLIP_N_ROTATE_ROW?r.concat(v[n%2]):r.concat(v[0]),o.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),G.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(x){const v=[];L=1-M/X,J=0,y=1,P=1,v[0]=[L,J,y,J,y,P,L,P],v[1]=[L,J,y,J,y,P,L,P],T!==u.d.ROTATE_TILE&&T!==u.d.ROTATE_ROW||(v[1]=[1-L,1-J,1-y,1-J,1-y,1-P,1-L,1-P]),T!==u.d.FLIP_TILE&&T!==u.d.FLIP_ROW||(v[1]=[1-L,J,1-y,J,1-y,P,1-L,P]),T!==u.d.FLIP_N_ROTATE_TILE&&T!==u.d.FLIP_N_ROTATE_ROW||(v[1]=[L,1-J,y,1-J,y,1-P,L,1-P]);for(let X=0;X<n;X++)p.push(b+F,X*O-s+k,0),p.push(b+M+F,X*O-s+k,0),p.push(b+M+F,(X+1)*O-s+k,0),p.push(b+F,(X+1)*O-s+k,0),Z.push(U,U+1,U+3,U+1,U+2,U+3),U+=4,r=T===u.d.FLIP_TILE||T===u.d.ROTATE_TILE||T===u.d.FLIP_N_ROTATE_TILE?r.concat(v[(X+1)%2]):T===u.d.FLIP_ROW||T===u.d.ROTATE_ROW||T===u.d.FLIP_N_ROTATE_ROW?r.concat(v[X%2]):r.concat(v[0]),o.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),G.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(H){const v=[];L=0,J=0,y=M/O,P=1,v[0]=[L,J,y,J,y,P,L,P],v[1]=[L,J,y,J,y,P,L,P],T!==u.d.ROTATE_TILE&&T!==u.d.ROTATE_ROW||(v[1]=[1-L,1-J,1-y,1-J,1-y,1-P,1-L,1-P]),T!==u.d.FLIP_TILE&&T!==u.d.FLIP_ROW||(v[1]=[1-L,J,1-y,J,1-y,P,1-L,P]),T!==u.d.FLIP_N_ROTATE_TILE&&T!==u.d.FLIP_N_ROTATE_ROW||(v[1]=[L,1-J,y,1-J,y,1-P,L,1-P]);for(let X=0;X<n;X++)p.push(Q-M+F,X*O-s+k,0),p.push(Q+F,X*O-s+k,0),p.push(Q+F,(X+1)*O-s+k,0),p.push(Q-M+F,(X+1)*O-s+k,0),Z.push(U,U+1,U+3,U+1,U+2,U+3),U+=4,r=T===u.d.FLIP_TILE||T===u.d.ROTATE_TILE||T===u.d.FLIP_N_ROTATE_TILE?r.concat(v[(X+f)%2]):T===u.d.FLIP_ROW||T===u.d.ROTATE_ROW||T===u.d.FLIP_N_ROTATE_ROW?r.concat(v[X%2]):r.concat(v[0]),o.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),G.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const J=0===v.sideOrientation?0:v.sideOrientation||m.e.DEFAULTSIDE;m.e._ComputeSides(J,p,Z,G,r,v.frontUVs,v.backUVs);const y=new m.e;y.indices=Z,y.xa=p,y.ya=G,y.Aa=r;const P=J===m.e.DOUBLESIDE?o.concat(o):o;return y.za=P,y}function D(v,T){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const O=new u.d(v,X);T.sideOrientation=u.d._GetDefaultSideOrientation(T.sideOrientation),O._originalBuilderSideOrientation=T.sideOrientation;return V(T).Ca(O,T.updatable),O}function s(v){const T=v.faceUV||new Array(6),X=v.faceColors,B=v.pattern||u.d.NO_FLIP,x=v.width||v.size||1,f=v.height||v.size||1,M=v.depth||v.size||1,H=v.tileWidth||v.tileSize||1,D=v.tileHeight||v.tileSize||1,s=v.alignHorizontal||0,F=v.alignVertical||0,k=0===v.sideOrientation?0:v.sideOrientation||m.e.DEFAULTSIDE;for(let u=0;u<6;u++)void 0===T[u]&&(T[u]=new O.o(0,0,1,1)),X&&void 0===X[u]&&(X[u]=new n.g(1,1,1,1));const b=x/2,l=f/2,Q=M/2,K=[];for(let O=0;O<2;O++)K[O]=V({pattern:B,tileWidth:H,tileHeight:D,width:x,height:f,alignVertical:F,alignHorizontal:s,sideOrientation:k});for(let O=2;O<4;O++)K[O]=V({pattern:B,tileWidth:H,tileHeight:D,width:M,height:f,alignVertical:F,alignHorizontal:s,sideOrientation:k});let p=F;F===u.d.BOTTOM?p=u.d.TOP:F===u.d.TOP&&(p=u.d.BOTTOM);for(let O=4;O<6;O++)K[O]=V({pattern:B,tileWidth:H,tileHeight:D,width:x,height:M,alignVertical:p,alignHorizontal:s,sideOrientation:k});let G=[],L=[],r=[],o=[];const Z=[],U=[],J=[],y=[];let P=0,a=0;for(let u=0;u<6;u++){const v=K[u].xa.length;U[u]=[],J[u]=[];for(let T=0;T<v/3;T++)U[u].push(new O.l(K[u].xa[3*T],K[u].xa[3*T+1],K[u].xa[3*T+2])),J[u].push(new O.l(K[u].ya[3*T],K[u].ya[3*T+1],K[u].ya[3*T+2]));P=K[u].Aa.length,y[u]=[];for(let X=0;X<P;X+=2)y[u][X]=T[u].x+(T[u].z-T[u].x)*K[u].Aa[X],y[u][X+1]=T[u].y+(T[u].w-T[u].y)*K[u].Aa[X+1],A.d&&(y[u][X+1]=1-y[u][X+1]);if(r=r.concat(y[u]),o=o.concat(K[u].indices.map((v=>v+a))),a+=U[u].length,X)for(let T=0;T<4;T++)Z.push(X[u].r,X[u].g,X[u].b,X[u].a)}const E=new O.l(0,0,Q),i=O.b.RotationY(Math.PI);G=U[0].map((v=>O.l.TransformNormal(v,i).add(E))).map((v=>[v.x,v.y,v.z])).reduce(((v,T)=>v.concat(T)),[]),L=J[0].map((v=>O.l.TransformNormal(v,i))).map((v=>[v.x,v.y,v.z])).reduce(((v,T)=>v.concat(T)),[]),G=G.concat(U[1].map((v=>v.Xc(E))).map((v=>[v.x,v.y,v.z])).reduce(((v,T)=>v.concat(T)),[])),L=L.concat(J[1].map((v=>[v.x,v.y,v.z])).reduce(((v,T)=>v.concat(T)),[]));const t=new O.l(b,0,0),C=O.b.RotationY(-Math.PI/2);G=G.concat(U[2].map((v=>O.l.TransformNormal(v,C).add(t))).map((v=>[v.x,v.y,v.z])).reduce(((v,T)=>v.concat(T)),[])),L=L.concat(J[2].map((v=>O.l.TransformNormal(v,C))).map((v=>[v.x,v.y,v.z])).reduce(((v,T)=>v.concat(T)),[]));const c=O.b.RotationY(Math.PI/2);G=G.concat(U[3].map((v=>O.l.TransformNormal(v,c).Xc(t))).map((v=>[v.x,v.y,v.z])).reduce(((v,T)=>v.concat(T)),[])),L=L.concat(J[3].map((v=>O.l.TransformNormal(v,c))).map((v=>[v.x,v.y,v.z])).reduce(((v,T)=>v.concat(T)),[]));const N=new O.l(0,l,0),d=O.b.RotationX(Math.PI/2);G=G.concat(U[4].map((v=>O.l.TransformNormal(v,d).add(N))).map((v=>[v.x,v.y,v.z])).reduce(((v,T)=>v.concat(T)),[])),L=L.concat(J[4].map((v=>O.l.TransformNormal(v,d))).map((v=>[v.x,v.y,v.z])).reduce(((v,T)=>v.concat(T)),[]));const I=O.b.RotationX(-Math.PI/2);G=G.concat(U[5].map((v=>O.l.TransformNormal(v,I).Xc(N))).map((v=>[v.x,v.y,v.z])).reduce(((v,T)=>v.concat(T)),[])),L=L.concat(J[5].map((v=>O.l.TransformNormal(v,I))).map((v=>[v.x,v.y,v.z])).reduce(((v,T)=>v.concat(T)),[])),m.e._ComputeSides(k,G,o,L,r);const W=new m.e;if(W.indices=o,W.xa=G,W.ya=L,W.Aa=r,X){const v=k===m.e.DOUBLESIDE?Z.concat(Z):Z;W.za=v}return W}function F(v,T){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const O=new u.d(v,X);T.sideOrientation=u.d._GetDefaultSideOrientation(T.sideOrientation),O._originalBuilderSideOrientation=T.sideOrientation;return s(T).Ca(O,T.updatable),O}m.e.CreateTiledPlane=V;m.e.CreateTiledBox=s;var k=X(12093),b=X(1209),l=X(1495);function Q(v){const T=v.height||2;let X=0===v.diameterTop?0:v.diameterTop||v.diameter||1,B=0===v.diameterBottom?0:v.diameterBottom||v.diameter||1;X=X||1e-5,B=B||1e-5;const x=0|(v.Xk||24),f=0|(v.subdivisions||1),M=!!v.hasRings,H=!!v.enclose,V=0===v.cap?0:v.cap||u.d.CAP_ALL,D=v.arc&&(v.arc<=0||v.arc>1)?1:v.arc||1,s=0===v.sideOrientation?0:v.sideOrientation||m.e.DEFAULTSIDE,F=v.faceUV||new Array(3),k=v.faceColors,b=2+(1+(1!==D&&H?2:0))*(M?f:1);let Q;for(Q=0;Q<b;Q++)k&&void 0===k[Q]&&(k[Q]=new n.g(1,1,1,1));for(Q=0;Q<b;Q++)F&&void 0===F[Q]&&(F[Q]=new O.o(0,0,1,1));const K=[],p=[],G=[],L=[],r=[],o=2*Math.PI*D/x;let Z,U,J;const y=(B-X)/2/T,P=O.l.Zero(),a=O.l.Zero(),E=O.l.Zero(),i=O.l.Zero(),t=O.l.Zero(),C=l.c.Y;let c,N,d,I=1,W=1,g=0,j=0;for(c=0;c<=f;c++)for(U=c/f,J=(U*(X-B)+B)/2,I=M&&0!==c&&c!==f?2:1,d=0;d<I;d++){for(M&&(W+=d),H&&(W+=2*d),N=0;N<=x;N++)Z=N*o,P.x=Math.cos(-Z)*J,P.y=-T/2+U*T,P.z=Math.sin(-Z)*J,0===X&&c===f?(a.x=G[G.length-3*(x+1)],a.y=G[G.length-3*(x+1)+1],a.z=G[G.length-3*(x+1)+2]):(a.x=P.x,a.z=P.z,a.y=Math.sqrt(a.x*a.x+a.z*a.z)*y,a.normalize()),0===N&&(E.p(P),i.p(a)),p.push(P.x,P.y,P.z),G.push(a.x,a.y,a.z),j=M?g!==W?F[W].y:F[W].w:F[W].y+(F[W].w-F[W].y)*U,L.push(F[W].x+(F[W].z-F[W].x)*N/x,A.d?1-j:j),k&&r.push(k[W].r,k[W].g,k[W].b,k[W].a);1!==D&&H&&(p.push(P.x,P.y,P.z),p.push(0,P.y,0),p.push(0,P.y,0),p.push(E.x,E.y,E.z),O.l.CrossToRef(C,a,t),t.normalize(),G.push(t.x,t.y,t.z,t.x,t.y,t.z),O.l.CrossToRef(i,C,t),t.normalize(),G.push(t.x,t.y,t.z,t.x,t.y,t.z),j=M?g!==W?F[W+1].y:F[W+1].w:F[W+1].y+(F[W+1].w-F[W+1].y)*U,L.push(F[W+1].x,A.d?1-j:j),L.push(F[W+1].z,A.d?1-j:j),j=M?g!==W?F[W+2].y:F[W+2].w:F[W+2].y+(F[W+2].w-F[W+2].y)*U,L.push(F[W+2].x,A.d?1-j:j),L.push(F[W+2].z,A.d?1-j:j),k&&(r.push(k[W+1].r,k[W+1].g,k[W+1].b,k[W+1].a),r.push(k[W+1].r,k[W+1].g,k[W+1].b,k[W+1].a),r.push(k[W+2].r,k[W+2].g,k[W+2].b,k[W+2].a),r.push(k[W+2].r,k[W+2].g,k[W+2].b,k[W+2].a))),g!==W&&(g=W)}const e=1!==D&&H?x+4:x;for(c=0,W=0;W<f;W++){let v=0,T=0,X=0,O=0;for(N=0;N<x;N++)v=c*(e+1)+N,T=(c+1)*(e+1)+N,X=c*(e+1)+(N+1),O=(c+1)*(e+1)+(N+1),K.push(v,T,X),K.push(O,X,T);1!==D&&H&&(K.push(v+2,T+2,X+2),K.push(O+2,X+2,T+2),K.push(v+4,T+4,X+4),K.push(O+4,X+4,T+4)),c=M?c+2:c+1}const h=v=>{const u=v?X/2:B/2;if(0===u)return;let m,f,M;const H=v?F[b-1]:F[0];let n=null;k&&(n=v?k[b-1]:k[0]);const V=p.length/3,s=v?T/2:-T/2,l=new O.l(0,s,0);p.push(l.x,l.y,l.z),G.push(0,v?1:-1,0);const Q=H.y+.5*(H.w-H.y);L.push(H.x+.5*(H.z-H.x),A.d?1-Q:Q),n&&r.push(n.r,n.g,n.b,n.a);const o=new O.i(.5,.5);for(M=0;M<=x;M++){m=2*Math.PI*M*D/x;const T=Math.cos(-m),X=Math.sin(-m);f=new O.l(T*u,s,X*u);const B=new O.i(T*o.x+.5,X*o.y+.5);p.push(f.x,f.y,f.z),G.push(0,v?1:-1,0);const V=H.y+(H.w-H.y)*B.y;L.push(H.x+(H.z-H.x)*B.x,A.d?1-V:V),n&&r.push(n.r,n.g,n.b,n.a)}for(M=0;M<x;M++)v?(K.push(V),K.push(V+(M+2)),K.push(V+(M+1))):(K.push(V),K.push(V+(M+1)),K.push(V+(M+2)))};V!==u.d.CAP_START&&V!==u.d.CAP_ALL||h(!1),V!==u.d.CAP_END&&V!==u.d.CAP_ALL||h(!0),m.e._ComputeSides(s,p,K,G,L,v.frontUVs,v.backUVs);const S=new m.e;return S.indices=K,S.xa=p,S.ya=G,S.Aa=L,k&&(S.za=r),S}function K(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},X=arguments.length>2?arguments[2]:void 0;const O=new u.d(v,X);T.sideOrientation=u.d._GetDefaultSideOrientation(T.sideOrientation),O._originalBuilderSideOrientation=T.sideOrientation;return Q(T).Ca(O,T.updatable),O}function p(v){const T=[],X=[],u=[],B=[],x=v.diameter||1,f=v.thickness||.5,M=0|(v.Xk||16),H=0===v.sideOrientation?0:v.sideOrientation||m.e.DEFAULTSIDE,n=M+1;for(let m=0;m<=M;m++){const v=m/M,H=m*Math.PI*2/M-Math.PI/2,V=O.b.Translation(x/2,0,0).multiply(O.b.RotationY(H));for(let x=0;x<=M;x++){const H=1-x/M,D=x*Math.PI*2/M+Math.PI,s=Math.cos(D),F=Math.sin(D);let k=new O.l(s,F,0),b=k.scale(f/2);const l=new O.i(v,H);b=O.l.TransformCoordinates(b,V),k=O.l.TransformNormal(k,V),X.push(b.x,b.y,b.z),u.push(k.x,k.y,k.z),B.push(l.x,A.d?1-l.y:l.y);const Q=(m+1)%n,K=(x+1)%n;T.push(m*n+x),T.push(m*n+K),T.push(Q*n+x),T.push(m*n+K),T.push(Q*n+K),T.push(Q*n+x)}}m.e._ComputeSides(H,X,T,u,B,v.frontUVs,v.backUVs);const V=new m.e;return V.indices=T,V.xa=X,V.ya=u,V.Aa=B,V}function G(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},X=arguments.length>2?arguments[2]:void 0;const O=new u.d(v,X);T.sideOrientation=u.d._GetDefaultSideOrientation(T.sideOrientation),O._originalBuilderSideOrientation=T.sideOrientation;return p(T).Ca(O,T.updatable),O}m.e.CreateCylinder=Q,u.d.CreateCylinder=(v,T,X,O,B,m,A,x,f)=>{void 0!==A&&A instanceof b.e||(void 0!==A&&(f=x||u.d.DEFAULTSIDE,x=A),A=m,m=1);return K(v,{height:T,diameterTop:X,diameterBottom:O,Xk:B,subdivisions:m,sideOrientation:f,updatable:x},A)};function L(v){const T=[],X=[],u=[],B=[],x=v.i||2,f=v.tube||.5,M=v.radialSegments||32,H=v.tubularSegments||32,n=v.p||2,V=v.q||3,D=0===v.sideOrientation?0:v.sideOrientation||m.e.DEFAULTSIDE,s=v=>{const T=Math.cos(v),X=Math.sin(v),u=V/n*v,B=Math.cos(u),m=x*(2+B)*.5*T,A=x*(2+B)*X*.5,f=x*Math.sin(u)*.5;return new O.l(m,A,f)};let F,k;for(F=0;F<=M;F++){const v=F%M/M*2*n*Math.PI,T=s(v),u=s(v+.01),m=u.Xc(T);let x=u.add(T);const V=O.l.Cross(m,x);for(x=O.l.Cross(V,m),V.normalize(),x.normalize(),k=0;k<H;k++){const v=k%H/H*2*Math.PI,O=-f*Math.cos(v),u=f*Math.sin(v);X.push(T.x+O*x.x+u*V.x),X.push(T.y+O*x.y+u*V.y),X.push(T.z+O*x.z+u*V.z),B.push(F/M),B.push(A.d?1-k/H:k/H)}}for(F=0;F<M;F++)for(k=0;k<H;k++){const v=(k+1)%H,X=F*H+k,O=(F+1)*H+k,u=(F+1)*H+v,B=F*H+v;T.push(B),T.push(O),T.push(X),T.push(B),T.push(u),T.push(O)}m.e.ComputeNormals(X,T,u),m.e._ComputeSides(D,X,T,u,B,v.frontUVs,v.backUVs);const b=new m.e;return b.indices=T,b.xa=X,b.ya=u,b.Aa=B,b}function r(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},X=arguments.length>2?arguments[2]:void 0;const O=new u.d(v,X);T.sideOrientation=u.d._GetDefaultSideOrientation(T.sideOrientation),O._originalBuilderSideOrientation=T.sideOrientation;return L(T).Ca(O,T.updatable),O}m.e.CreateTorus=p,u.d.CreateTorus=(v,T,X,O,u,B,m)=>G(v,{diameter:T,thickness:X,Xk:O,sideOrientation:m,updatable:B},u);m.e.CreateTorusKnot=L,u.d.CreateTorusKnot=(v,T,X,O,u,B,m,A,x,f)=>r(v,{i:T,tube:X,radialSegments:O,tubularSegments:u,p:B,q:m,sideOrientation:f,updatable:x},A);var o=X(12939),Z=X(1103),U=X(1499),J=X(1015),y=X(1034);class P extends O.i{constructor(v,T){super(v.x,v.y),this.index=T}}class a{constructor(){this.elements=[]}add(v){const T=[];return v.forEach((v=>{const X=new P(v,this.elements.length);T.push(X),this.elements.push(X)})),T}computeBounds(){const v=new O.i(this.elements[0].x,this.elements[0].y),T=new O.i(this.elements[0].x,this.elements[0].y);return this.elements.forEach((X=>{X.x<v.x?v.x=X.x:X.x>T.x&&(T.x=X.x),X.y<v.y?v.y=X.y:X.y>T.y&&(T.y=X.y)})),{min:v,max:T,width:T.x-v.x,height:T.y-v.y}}}class E{_addToepoint(v){for(const T of v)this._epoints.push(T.x,T.y)}constructor(v,T,X){let O,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;this._points=new a,this._outlinepoints=new a,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=u,this._name=v,this._scene=X||y.c.LastCreatedScene,O=T instanceof U.f?T.getPoints():T,this._addToepoint(O),this._points.add(O),this._outlinepoints.add(O),"undefined"===typeof this.bjsEarcut&&Z.d.Warn("Earcut was not found, the polygon will not be built.")}addHole(v){this._points.add(v);const T=new a;return T.add(v),this._holes.push(T),this._eholes.push(this._epoints.length/2),this._addToepoint(v),this}build(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0],T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const O=new u.d(this._name,this._scene),m=this.buildVertexData(T,X);return O.Ga(B.e.PositionKind,m.xa,v),O.Ga(B.e.NormalKind,m.ya,v),O.Ga(B.e.UVKind,m.Aa,v),O.setIndices(m.indices),O}buildVertexData(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const X=new m.e,O=[],u=[],B=[],A=this._points.computeBounds();this._points.elements.forEach((v=>{O.push(0,1,0),u.push(v.x,0,v.y),B.push((v.x-A.min.x)/A.width,(v.y-A.min.y)/A.height)}));const x=[],f=this.bjsEarcut(this._epoints,this._eholes,2);for(let m=0;m<f.length;m++)x.push(f[m]);if(v>0){const X=u.length/3;this._points.elements.forEach((T=>{O.push(0,-1,0),u.push(T.x,-v,T.y),B.push(1-(T.x-A.min.x)/A.width,1-(T.y-A.min.y)/A.height)}));const m=x.length;for(let v=0;v<m;v+=3){const T=x[v+0],O=x[v+1],u=x[v+2];x.push(u+X),x.push(O+X),x.push(T+X)}this._addSide(u,O,B,x,A,this._outlinepoints,v,!1,T),this._holes.forEach((X=>{this._addSide(u,O,B,x,A,X,v,!0,T)}))}return X.indices=x,X.xa=u,X.ya=O,X.Aa=B,X}_addSide(v,T,X,u,B,m,A,x,f){let M=v.length/3,H=0;for(let n=0;n<m.elements.length;n++){const V=m.elements[n],D=m.elements[(n+1)%m.elements.length];v.push(V.x,0,V.y),v.push(V.x,-A,V.y),v.push(D.x,0,D.y),v.push(D.x,-A,D.y);const s=m.elements[(n+m.elements.length-1)%m.elements.length],F=m.elements[(n+2)%m.elements.length];let k=new O.l(-(D.y-V.y),0,D.x-V.x),b=new O.l(-(V.y-s.y),0,V.x-s.x),l=new O.l(-(F.y-D.y),0,F.x-D.x);x||(k=k.scale(-1),b=b.scale(-1),l=l.scale(-1));const Q=k.normalizeToNew();let K=b.normalizeToNew(),p=l.normalizeToNew();const G=O.l.Dot(K,Q);K=G>f?G<J.c-1?new O.l(V.x,0,V.y).Xc(new O.l(D.x,0,D.y)).normalize():b.add(k).normalize():Q;const L=O.l.Dot(l,k);p=L>f?L<J.c-1?new O.l(D.x,0,D.y).Xc(new O.l(V.x,0,V.y)).normalize():l.add(k).normalize():Q,X.push(H/B.width,0),X.push(H/B.width,1),H+=k.length(),X.push(H/B.width,0),X.push(H/B.width,1),T.push(K.x,K.y,K.z),T.push(K.x,K.y,K.z),T.push(p.x,p.y,p.z),T.push(p.x,p.y,p.z),x?(u.push(M),u.push(M+2),u.push(M+1),u.push(M+1),u.push(M+2),u.push(M+3)):(u.push(M),u.push(M+1),u.push(M+2),u.push(M+1),u.push(M+3),u.push(M+2)),M+=4}}}function i(v,T,X,u,x,f,M){const H=X||new Array(3),V=u,D=[],s=M||!1;for(let B=0;B<3;B++)void 0===H[B]&&(H[B]=new O.o(0,0,1,1)),V&&void 0===V[B]&&(V[B]=new n.g(1,1,1,1));const F=v.getVerticesData(B.e.PositionKind),k=v.getVerticesData(B.e.NormalKind),b=v.getVerticesData(B.e.UVKind),l=v.Qe(),Q=F.length/9;let K=0,p=0,G=0,L=0,r=0;const o=[0];if(s)for(let O=Q;O<F.length/3;O+=4)p=F[3*(O+2)]-F[3*O],G=F[3*(O+2)+2]-F[3*O+2],L=Math.sqrt(p*p+G*G),r+=L,o.push(r);let Z=0,U=0;for(let O=0;O<k.length;O+=3)Math.abs(k[O+1])<.001&&(U=1),Math.abs(k[O+1]-1)<.001&&(U=0),Math.abs(k[O+1]+1)<.001&&(U=2),Z=O/3,1===U?(K=Z-Q,b[2*Z]=K%4<1.5?s?H[U].x+(H[U].z-H[U].x)*o[Math.floor(K/4)]/r:H[U].x:s?H[U].x+(H[U].z-H[U].x)*o[Math.floor(K/4)+1]/r:H[U].z,b[2*Z+1]=K%2===0?A.d?1-H[U].w:H[U].w:A.d?1-H[U].y:H[U].y):(b[2*Z]=(1-b[2*Z])*H[U].x+b[2*Z]*H[U].z,b[2*Z+1]=(1-b[2*Z+1])*H[U].y+b[2*Z+1]*H[U].w,A.d&&(b[2*Z+1]=1-b[2*Z+1])),V&&D.push(V[U].r,V[U].g,V[U].b,V[U].a);m.e._ComputeSides(T,F,l,k,b,x,f);const J=new m.e;if(J.indices=l,J.xa=F,J.ya=k,J.Aa=b,V){const v=T===m.e.DOUBLESIDE?D.concat(D):D;J.za=v}return J}function t(v,T){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;T.sideOrientation=u.d._GetDefaultSideOrientation(T.sideOrientation);const m=T.shape,A=T.holes||[],x=T.depth||0,f=T.smoothingThreshold||2,M=[];let H=[];for(let u=0;u<m.length;u++)M[u]=new O.i(m[u].x,m[u].z);M[0].equalsWithEpsilon(M[M.length-1],1e-8)&&M.pop();const n=new E(v,M,X||y.c.LastCreatedScene,B);for(let u=0;u<A.length;u++){H=[];for(let v=0;v<A[u].length;v++)H.push(new O.i(A[u][v].x,A[u][v].z));n.addHole(H)}const V=n.build(!1,x,f);V._originalBuilderSideOrientation=T.sideOrientation;return i(V,T.sideOrientation,T.faceUV,T.faceColors,T.frontUVs,T.backUVs,T.wrap).Ca(V,T.updatable),V}function C(v,T){return t(v,T,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut)}function c(v,T){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const O=T.path,B=T.shape,m=T.scale||1,A=T.rotation||0,x=0===T.cap?0:T.cap||u.d.NO_CAP,f=T.updatable,M=u.d._GetDefaultSideOrientation(T.sideOrientation),H=T.instance||null,n=T.invertUV||!1,V=T.closeShape||!1;return d(v,B,O,m,A,null,null,T.closePath||!1,V,x,!1,X,!!f,M,H,n,T.frontUVs||null,T.backUVs||null,T.firstNormal||null,!!T.adjustFrame)}function N(v,T){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const O=T.path,B=T.shape,m=T.scaleFunction||(()=>1),A=T.rotationFunction||(()=>0),x=T.closePath||T.ribbonCloseArray||!1,f=T.closeShape||T.ribbonClosePath||!1,M=0===T.cap?0:T.cap||u.d.NO_CAP,H=T.updatable,n=T.firstNormal||null,V=T.adjustFrame||!1;return d(v,B,O,null,null,m,A,x,f,M,!0,X,!!H,u.d._GetDefaultSideOrientation(T.sideOrientation),T.instance||null,T.invertUV||!1,T.frontUVs||null,T.backUVs||null,n,V)}function d(v,T,X,B,m,A,x,M,H,n,V,D,s,F,k,b,l,Q,K,p){const G=(v,T,X,B,m,A,x,f,M,H,n)=>{const V=X.getTangents(),D=X.getNormals(),s=X.getBinormals(),F=X.getDistances();if(n)for(let u=0;u<V.length;u++)if(0==V[u].x&&0==V[u].y&&0==V[u].z&&V[u].p(V[u-1]),0==D[u].x&&0==D[u].y&&0==D[u].z&&D[u].p(D[u-1]),0==s[u].x&&0==s[u].y&&0==s[u].z&&s[u].p(s[u-1]),u>0){let v=V[u-1];O.l.Dot(v,V[u])<0&&V[u].scaleInPlace(-1),v=D[u-1],O.l.Dot(v,D[u])<0&&D[u].scaleInPlace(-1),v=s[u-1],O.l.Dot(v,s[u])<0&&s[u].scaleInPlace(-1)}let k=0;const b=H&&f?f:()=>null!==A?A:0,l=H&&x?x:()=>null!==m?m:1;let Q=M===u.d.NO_CAP||M===u.d.CAP_END?0:2;const K=O.g.Matrix[0];for(let u=0;u<T.length;u++){const X=[],m=b(u,F[u]),A=l(u,F[u]);O.b.RotationAxisToRef(V[u],k,K);for(let B=0;B<v.length;B++){const m=V[u].scale(v[B].z).add(D[u].scale(v[B].x)).add(s[u].scale(v[B].y)),x=O.l.Zero();O.l.TransformCoordinatesToRef(m,K,x),x.scaleInPlace(A).addInPlace(T[u]),X[B]=x}B[Q]=X,k+=m,Q++}const p=v=>{const T=Array(),X=O.l.Zero();let u;for(u=0;u<v.length;u++)X.addInPlace(v[u]);for(X.scaleInPlace(1/v.length),u=0;u<v.length;u++)T.push(X);return T};switch(M){case u.d.NO_CAP:break;case u.d.CAP_START:B[0]=p(B[2]),B[1]=B[2];break;case u.d.CAP_END:B[Q]=B[Q-1],B[Q+1]=p(B[Q-1]);break;case u.d.CAP_ALL:B[0]=p(B[2]),B[1]=B[2],B[Q]=B[Q-1],B[Q+1]=p(B[Q-1])}return B};let L,r;if(k){const v=k._creationDataStorage;return L=K?v.path3D.update(X,K):v.path3D.update(X),r=G(T,X,v.path3D,v.pathArray,B,m,A,x,v.cap,V,p),k=f("",{pathArray:r,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:k},D||void 0)}L=K?new U.i(X,K):new U.i(X);r=G(T,X,L,new Array,B,m,A,x,n=n<0||n>3?0:n,V,p);const o=f(v,{pathArray:r,closeArray:M,closePath:H,updatable:s,sideOrientation:F,invertUV:b,frontUVs:l||void 0,backUVs:Q||void 0},D);return o._creationDataStorage.pathArray=r,o._creationDataStorage.path3D=L,o._creationDataStorage.cap=n,o}m.e.CreatePolygon=i,u.d.CreatePolygon=function(v,T,X,O,u,B){return t(v,{shape:T,holes:O,updatable:u,sideOrientation:B},X,arguments.length>6&&void 0!==arguments[6]?arguments[6]:earcut)},u.d.ExtrudePolygon=function(v,T,X,O,u,B,m){return C(v,{shape:T,holes:u,depth:X,updatable:B,sideOrientation:m},O,arguments.length>7&&void 0!==arguments[7]?arguments[7]:earcut)};function I(v,T){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=T.arc?T.arc<=0||T.arc>1?1:T.arc:1,m=void 0===T.closed||T.closed,A=T.shape,x=T.i||1,M=T.Xk||64,H=T.clip||0,n=T.updatable,V=u.d._GetDefaultSideOrientation(T.sideOrientation),D=T.cap||u.d.NO_CAP,s=2*Math.PI,F=[],k=T.invertUV||!1;let b=0,l=0;const Q=s/M*B;let K,p;for(b=0;b<=M-H;b++){for(p=[],D!=u.d.CAP_START&&D!=u.d.CAP_ALL||(p.push(new O.l(0,A[0].y,0)),p.push(new O.l(Math.cos(b*Q)*A[0].x*x,A[0].y,Math.sin(b*Q)*A[0].x*x))),l=0;l<A.length;l++)K=new O.l(Math.cos(b*Q)*A[l].x*x,A[l].y,Math.sin(b*Q)*A[l].x*x),p.push(K);D!=u.d.CAP_END&&D!=u.d.CAP_ALL||(p.push(new O.l(Math.cos(b*Q)*A[A.length-1].x*x,A[A.length-1].y,Math.sin(b*Q)*A[A.length-1].x*x)),p.push(new O.l(0,A[A.length-1].y,0))),F.push(p)}return f(v,{pathArray:F,closeArray:m,sideOrientation:V,updatable:n,invertUV:k,frontUVs:T.frontUVs,backUVs:T.backUVs},X)}u.d.ExtrudeShape=function(v,T,X,O,B,m){let A=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,x=arguments.length>7?arguments[7]:void 0,f=arguments.length>8?arguments[8]:void 0,M=arguments.length>9?arguments[9]:void 0;return c(v,{shape:T,path:X,scale:O,rotation:B,cap:0===m?0:m||u.d.NO_CAP,sideOrientation:f,instance:M,updatable:x},A)},u.d.ExtrudeShapeCustom=(v,T,X,O,B,m,A,x,f,M,H,n)=>N(v,{shape:T,path:X,scaleFunction:O,rotationFunction:B,ribbonCloseArray:m,ribbonClosePath:A,cap:0===x?0:x||u.d.NO_CAP,sideOrientation:H,instance:n,updatable:M},f);u.d.CreateLathe=(v,T,X,O,u,B,m)=>I(v,{shape:T,i:X,Xk:O,sideOrientation:m,updatable:B},u);var W=X(12041),g=X(11979);function j(v,T){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=T.path;let m=T.instance,A=1;void 0!==T.i?A=T.i:m&&(A=m._creationDataStorage.i);const x=T.Xk||64,M=T.radiusFunction||null;let H=T.cap||u.d.NO_CAP;const n=T.invertUV||!1,V=T.updatable,D=u.d._GetDefaultSideOrientation(T.sideOrientation);T.arc=T.arc&&(T.arc<=0||T.arc>1)?1:T.arc||1;const s=(v,T,X,B,m,A,x,f)=>{const M=T.getTangents(),H=T.getNormals(),n=T.getDistances(),V=2*Math.PI/m*f,D=A||(()=>B);let s,F,k,b;const l=O.g.Matrix[0];let Q=x===u.d.NO_CAP||x===u.d.CAP_END?0:2;for(let u=0;u<v.length;u++){F=D(u,n[u]),s=Array(),k=H[u];for(let T=0;T<m;T++)O.b.RotationAxisToRef(M[u],V*T,l),b=s[T]?s[T]:O.l.Zero(),O.l.TransformCoordinatesToRef(k,l,b),b.scaleInPlace(F).addInPlace(v[u]),s[T]=b;X[Q]=s,Q++}const K=(T,X)=>{const O=Array();for(let u=0;u<T;u++)O.push(v[X]);return O};switch(x){case u.d.NO_CAP:break;case u.d.CAP_START:X[0]=K(m,0),X[1]=X[2].slice(0);break;case u.d.CAP_END:X[Q]=X[Q-1].slice(0),X[Q+1]=K(m,v.length-1);break;case u.d.CAP_ALL:X[0]=K(m,0),X[1]=X[2].slice(0),X[Q]=X[Q-1].slice(0),X[Q+1]=K(m,v.length-1)}return X};let F,k;if(m){const v=m._creationDataStorage,X=T.arc||v.arc;return F=v.path3D.update(B),k=s(B,F,v.pathArray,A,v.Xk,M,v.cap,X),m=f("",{pathArray:k,instance:m}),v.path3D=F,v.pathArray=k,v.arc=X,v.i=A,m}F=new U.i(B);H=H<0||H>3?0:H,k=s(B,F,new Array,A,x,M,H,T.arc);const b=f(v,{pathArray:k,closePath:!0,closeArray:!1,updatable:V,sideOrientation:D,invertUV:n,frontUVs:T.frontUVs,backUVs:T.backUVs},X);return b._creationDataStorage.pathArray=k,b._creationDataStorage.path3D=F,b._creationDataStorage.Xk=x,b._creationDataStorage.cap=H,b._creationDataStorage.arc=T.arc,b._creationDataStorage.i=A,b}function e(v){const T=[];T[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},T[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},T[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},T[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},T[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},T[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},T[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},T[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},T[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},T[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},T[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},T[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},T[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},T[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},T[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const X=v.type&&(v.type<0||v.type>=T.length)?0:v.type||0,u=v.size,B=v.sizeX||u||1,x=v.sizeY||u||1,f=v.sizeZ||u||1,M=v.custom||T[X],H=M.face.length,V=v.faceUV||new Array(H),D=v.faceColors,s=void 0===v.flat||v.flat,F=0===v.sideOrientation?0:v.sideOrientation||m.e.DEFAULTSIDE,k=[],b=[],l=[],Q=[],K=[];let p=0,G=0;const L=[];let r,o,Z,U,J,y,P=0,a=0;if(s)for(a=0;a<H;a++)D&&void 0===D[a]&&(D[a]=new n.g(1,1,1,1)),V&&void 0===V[a]&&(V[a]=new O.o(0,0,1,1));if(s)for(a=0;a<H;a++){const v=M.face[a].length;for(Z=2*Math.PI/v,U=.5*Math.tan(Z/2),J=.5,P=0;P<v;P++)k.push(M.vertex[M.face[a][P]][0]*B,M.vertex[M.face[a][P]][1]*x,M.vertex[M.face[a][P]][2]*f),L.push(p),p++,r=V[a].x+(V[a].z-V[a].x)*(.5+U),o=V[a].y+(V[a].w-V[a].y)*(J-.5),Q.push(r,A.d?1-o:o),y=U*Math.cos(Z)-J*Math.sin(Z),J=U*Math.sin(Z)+J*Math.cos(Z),U=y,D&&K.push(D[a].r,D[a].g,D[a].b,D[a].a);for(P=0;P<v-2;P++)b.push(L[0+G],L[P+2+G],L[P+1+G]);G+=v}else{for(P=0;P<M.vertex.length;P++)k.push(M.vertex[P][0]*B,M.vertex[P][1]*x,M.vertex[P][2]*f),Q.push(0,A.d?1:0);for(a=0;a<H;a++)for(P=0;P<M.face[a].length-2;P++)b.push(M.face[a][0],M.face[a][P+2],M.face[a][P+1])}m.e.ComputeNormals(k,b,l),m.e._ComputeSides(F,k,b,l,Q,v.frontUVs,v.backUVs);const E=new m.e;return E.xa=k,E.indices=b,E.ya=l,E.Aa=Q,D&&s&&(E.za=K),E}function h(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const O=new u.d(v,X);T.sideOrientation=u.d._GetDefaultSideOrientation(T.sideOrientation),O._originalBuilderSideOrientation=T.sideOrientation;return e(T).Ca(O,T.updatable),O}u.d.CreateTube=(v,T,X,O,u,B,m,A,x,f)=>j(v,{path:T,i:X,Xk:O,radiusFunction:u,arc:1,cap:B,updatable:A,sideOrientation:x,instance:f},m);function S(v){const T=v.sideOrientation||m.e.DEFAULTSIDE,X=v.i||1,u=void 0===v.flat||v.flat,B=0|(v.subdivisions||4),x=v.radiusX||X,f=v.radiusY||X,M=v.radiusZ||X,H=(1+Math.sqrt(5))/2,n=[-1,H,-0,1,H,0,-1,-H,0,1,-H,0,0,-1,-H,0,1,-H,0,-1,H,0,1,H,H,0,1,H,0,-1,-H,0,1,-H,0,-1],V=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],D=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],s=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],F=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],k=[],b=[],l=[],Q=[];let K=0;const p=new Array(3),G=new Array(3);let L;for(L=0;L<3;L++)p[L]=O.l.Zero(),G[L]=O.i.Zero();for(let m=0;m<20;m++){for(L=0;L<3;L++){const v=V[3*m+L];p[L].Sd(n[3*D[v]],n[3*D[v]+1],n[3*D[v]+2]),p[L].normalize(),G[L].Sd(.134765625*s[2*v]+.05859375+-.0390625*F[m],.2333984375*s[2*v+1]+.025390625+.01953125*F[m])}const v=(v,T,X,m)=>{const H=O.l.Lerp(p[0],p[2],T/B),n=O.l.Lerp(p[1],p[2],T/B),V=B===T?p[2]:O.l.Lerp(H,n,v/(B-T));let D;if(V.normalize(),u){const v=O.l.Lerp(p[0],p[2],m/B),T=O.l.Lerp(p[1],p[2],m/B);D=O.l.Lerp(v,T,X/(B-m))}else D=new O.l(V.x,V.y,V.z);D.x/=x,D.y/=f,D.z/=M,D.normalize();const s=O.i.Lerp(G[0],G[2],T/B),F=O.i.Lerp(G[1],G[2],T/B),L=B===T?G[2]:O.i.Lerp(s,F,v/(B-T));b.push(V.x*x,V.y*f,V.z*M),l.push(D.x,D.y,D.z),Q.push(L.x,A.d?1-L.y:L.y),k.push(K),K++};for(let T=0;T<B;T++)for(let X=0;X+T<B;X++)v(X,T,X+1/3,T+1/3),v(X+1,T,X+1/3,T+1/3),v(X,T+1,X+1/3,T+1/3),X+T+1<B&&(v(X+1,T,X+2/3,T+2/3),v(X+1,T+1,X+2/3,T+2/3),v(X,T+1,X+2/3,T+2/3))}m.e._ComputeSides(T,b,k,l,Q,v.frontUVs,v.backUVs);const r=new m.e;return r.indices=k,r.xa=b,r.ya=l,r.Aa=Q,r}function w(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const O=new u.d(v,X);T.sideOrientation=u.d._GetDefaultSideOrientation(T.sideOrientation),O._originalBuilderSideOrientation=T.sideOrientation;return S(T).Ca(O,T.updatable),O}m.e.CreatePolyhedron=e,u.d.CreatePolyhedron=(v,T,X)=>h(v,T,X);m.e.CreateIcoSphere=S,u.d.CreateIcoSphere=(v,T,X)=>w(v,T,X);var z=X(1040);const R=new O.l(1,0,0),Y=new O.l(-1,0,0),q=new O.l(0,1,0),vv=new O.l(0,-1,0),Tv=new O.l(0,0,1),Xv=new O.l(0,0,-1);class Ov{constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:O.l.Zero(),T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:O.l.Up(),X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:O.i.Zero(),u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,A=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,x=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,f=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=v,this.Wd=T,this.uv=X,this.vertexIdx=u,this.vertexIdxForBones=B,this.localPositionOverride=m,this.localNormalOverride=A,this.matrixIndicesOverride=x,this.matrixWeightsOverride=f}clone(){var v,T,X,O;return new Ov(this.position.clone(),this.Wd.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(v=this.localPositionOverride)||void 0===v?void 0:v.slice(),null===(T=this.localNormalOverride)||void 0===T?void 0:T.slice(),null===(X=this.matrixIndicesOverride)||void 0===X?void 0:X.slice(),null===(O=this.matrixWeightsOverride)||void 0===O?void 0:O.slice())}}function uv(v,T,X){var x,f,M,H;const n=!!T.skeleton,V=X.localMode||n,D=T.Qe(),s=n?T.Yf(!0,!0):T.getVerticesData(B.e.PositionKind),F=n?T.getNormalsData(!0,!0):T.getVerticesData(B.e.NormalKind),k=V?n?T.getVerticesData(B.e.PositionKind):s:null,b=V?n?T.getVerticesData(B.e.NormalKind):F:null,l=T.getVerticesData(B.e.UVKind),Q=n?T.getVerticesData(B.e.MatricesIndicesKind):null,K=n?T.getVerticesData(B.e.MatricesWeightsKind):null,p=n?T.getVerticesData(B.e.MatricesIndicesExtraKind):null,G=n?T.getVerticesData(B.e.MatricesWeightsExtraKind):null,L=X.position||O.l.Zero();let r=X.Wd||O.l.Up();const o=X.size||O.l.One(),Z=X.angle||0;if(!r){const v=new O.l(0,0,1),X=T.va().activeCamera,u=O.l.TransformCoordinates(v,X.getWorldMatrix());r=X.globalPosition.Xc(u)}const U=-Math.atan2(r.z,r.x)-Math.PI/2,J=Math.sqrt(r.x*r.x+r.z*r.z),y=Math.atan2(r.y,J),P=new m.e;P.indices=[],P.xa=[],P.ya=[],P.Aa=[],P.matricesIndices=n?[]:null,P.matricesWeights=n?[]:null,P.matricesIndicesExtra=p?[]:null,P.matricesWeightsExtra=G?[]:null;let a=0;const E=(v,T)=>{const u=new Ov;if(!D||!s||!F)return u;const B=D[v];if(u.vertexIdx=3*B,u.vertexIdxForBones=4*B,u.position=new O.l(s[3*B],s[3*B+1],s[3*B+2]),O.l.TransformCoordinatesToRef(u.position,T,u.position),u.Wd=new O.l(F[3*B],F[3*B+1],F[3*B+2]),O.l.TransformNormalToRef(u.Wd,T,u.Wd),X.captureUVS&&l){const v=l[2*B+1];u.uv=new O.i(l[2*B],A.d?1-v:v)}return u},i=[0,0,0,0],t=(v,T)=>{if(0===v.length)return v;const X=.5*Math.abs(O.l.Dot(o,T)),u=(v,T,X,O)=>{for(let u=0;u<O;++u)if(v[X+u]===T)return X+u;return-1},B=(v,B)=>{const m=O.l.GetClipFactor(v.position,B.position,T,X);let A=i,x=i;if(Q&&K){const T=v.matrixIndicesOverride?0:v.vertexIdxForBones,X=v.matrixIndicesOverride??Q,O=v.matrixWeightsOverride??K,f=B.matrixIndicesOverride?0:B.vertexIdxForBones,M=B.matrixIndicesOverride??Q,H=B.matrixWeightsOverride??K;A=[0,0,0,0],x=[0,0,0,0];let n=0;for(let v=0;v<4;++v)if(O[T+v]>0){const B=u(M,X[T+v],f,4);A[n]=X[T+v],x[n]=(0,z.n)(O[T+v],B>=0?H[B]:0,m),n++}for(let v=0;v<4&&n<4;++v){const O=M[f+v];-1===u(X,O,T,4)&&(A[n]=O,x[n]=(0,z.n)(0,H[f+v],m),n++)}const V=x[0]+x[1]+x[2]+x[3];x[0]/=V,x[1]/=V,x[2]/=V,x[3]/=V}const f=v.localPositionOverride?v.localPositionOverride[0]:(null===k||void 0===k?void 0:k[v.vertexIdx])??0,M=v.localPositionOverride?v.localPositionOverride[1]:(null===k||void 0===k?void 0:k[v.vertexIdx+1])??0,H=v.localPositionOverride?v.localPositionOverride[2]:(null===k||void 0===k?void 0:k[v.vertexIdx+2])??0,n=B.localPositionOverride?B.localPositionOverride[0]:(null===k||void 0===k?void 0:k[B.vertexIdx])??0,V=B.localPositionOverride?B.localPositionOverride[1]:(null===k||void 0===k?void 0:k[B.vertexIdx+1])??0,D=B.localPositionOverride?B.localPositionOverride[2]:(null===k||void 0===k?void 0:k[B.vertexIdx+2])??0,s=v.localNormalOverride?v.localNormalOverride[0]:(null===b||void 0===b?void 0:b[v.vertexIdx])??0,F=v.localNormalOverride?v.localNormalOverride[1]:(null===b||void 0===b?void 0:b[v.vertexIdx+1])??0,l=v.localNormalOverride?v.localNormalOverride[2]:(null===b||void 0===b?void 0:b[v.vertexIdx+2])??0,p=s+((B.localNormalOverride?B.localNormalOverride[0]:(null===b||void 0===b?void 0:b[B.vertexIdx])??0)-s)*m,G=F+((B.localNormalOverride?B.localNormalOverride[1]:(null===b||void 0===b?void 0:b[B.vertexIdx+1])??0)-F)*m,L=l+((B.localNormalOverride?B.localNormalOverride[2]:(null===b||void 0===b?void 0:b[B.vertexIdx+2])??0)-l)*m,r=Math.sqrt(p*p+G*G+L*L);return new Ov(O.l.Lerp(v.position,B.position,m),O.l.Lerp(v.Wd,B.Wd,m).normalize(),O.i.Lerp(v.uv,B.uv,m),-1,-1,k?[f+(n-f)*m,M+(V-M)*m,H+(D-H)*m]:null,b?[p/r,G/r,L/r]:null,A,x)};let m=null;v.length>3&&(m=[]);for(let A=0;A<v.length;A+=3){let u=0,x=null,f=null,M=null,H=null;const n=O.l.Dot(v[A].position,T)-X>0,V=O.l.Dot(v[A+1].position,T)-X>0,D=O.l.Dot(v[A+2].position,T)-X>0;switch(u=(n?1:0)+(V?1:0)+(D?1:0),u){case 0:v.length>3?(m.push(v[A]),m.push(v[A+1]),m.push(v[A+2])):m=v;break;case 1:if(m=m??new Array,n&&(x=v[A+1],f=v[A+2],M=B(v[A],x),H=B(v[A],f)),V){x=v[A],f=v[A+2],M=B(v[A+1],x),H=B(v[A+1],f),m.push(M),m.push(f.clone()),m.push(x.clone()),m.push(f.clone()),m.push(M.clone()),m.push(H);break}D&&(x=v[A],f=v[A+1],M=B(v[A+2],x),H=B(v[A+2],f)),x&&f&&M&&H&&(m.push(x.clone()),m.push(f.clone()),m.push(M),m.push(H),m.push(M.clone()),m.push(f.clone()));break;case 2:m=m??new Array,n||(x=v[A].clone(),f=B(x,v[A+1]),M=B(x,v[A+2]),m.push(x),m.push(f),m.push(M)),V||(x=v[A+1].clone(),f=B(x,v[A+2]),M=B(x,v[A]),m.push(x),m.push(f),m.push(M)),D||(x=v[A+2].clone(),f=B(x,v[A]),M=B(x,v[A+1]),m.push(x),m.push(f),m.push(M))}}return m},C=T instanceof u.d?T:null,c=null===C||void 0===C?void 0:C._thinInstanceDataStorage.matrixData,N=(null===C||void 0===C?void 0:C.Rj)||1,d=O.g.Matrix[0];d.p(O.b.IdentityReadOnly);for(let u=0;u<N;++u){if(null!==C&&void 0!==C&&C.hasThinInstances&&c){const v=16*u;d.setRowFromFloats(0,c[v+0],c[v+1],c[v+2],c[v+3]),d.setRowFromFloats(1,c[v+4],c[v+5],c[v+6],c[v+7]),d.setRowFromFloats(2,c[v+8],c[v+9],c[v+10],c[v+11]),d.setRowFromFloats(3,c[v+12],c[v+13],c[v+14],c[v+15])}const v=O.b.RotationYawPitchRoll(U,y,Z).multiply(O.b.Translation(L.x,L.y,L.z)),B=O.b.Invert(v),m=T.getWorldMatrix(),x=d.multiply(m).multiply(B),f=new Array(3);for(let T=0;T<D.length;T+=3){let v=f;if(v[0]=E(T,x),v[1]=E(T+1,x),v[2]=E(T+2,x),!(X.cullBackFaces&&-v[0].Wd.z<=0&&-v[1].Wd.z<=0&&-v[2].Wd.z<=0)&&(v=t(v,R),v&&(v=t(v,Y),v&&(v=t(v,q),v&&(v=t(v,vv),v&&(v=t(v,Tv),v&&(v=t(v,Xv),v)))))))for(let T=0;T<v.length;T++){const O=v[T];if(P.indices.push(a),V?(O.localPositionOverride?(P.xa[3*a]=O.localPositionOverride[0],P.xa[3*a+1]=O.localPositionOverride[1],P.xa[3*a+2]=O.localPositionOverride[2]):k&&(P.xa[3*a]=k[O.vertexIdx],P.xa[3*a+1]=k[O.vertexIdx+1],P.xa[3*a+2]=k[O.vertexIdx+2]),O.localNormalOverride?(P.ya[3*a]=O.localNormalOverride[0],P.ya[3*a+1]=O.localNormalOverride[1],P.ya[3*a+2]=O.localNormalOverride[2]):b&&(P.ya[3*a]=b[O.vertexIdx],P.ya[3*a+1]=b[O.vertexIdx+1],P.ya[3*a+2]=b[O.vertexIdx+2])):(O.position.toArray(P.xa,3*a),O.Wd.toArray(P.ya,3*a)),P.matricesIndices&&P.matricesWeights&&(O.matrixIndicesOverride?(P.matricesIndices[4*a]=O.matrixIndicesOverride[0],P.matricesIndices[4*a+1]=O.matrixIndicesOverride[1],P.matricesIndices[4*a+2]=O.matrixIndicesOverride[2],P.matricesIndices[4*a+3]=O.matrixIndicesOverride[3]):(Q&&(P.matricesIndices[4*a]=Q[O.vertexIdxForBones],P.matricesIndices[4*a+1]=Q[O.vertexIdxForBones+1],P.matricesIndices[4*a+2]=Q[O.vertexIdxForBones+2],P.matricesIndices[4*a+3]=Q[O.vertexIdxForBones+3]),p&&P.matricesIndicesExtra&&(P.matricesIndicesExtra[4*a]=p[O.vertexIdxForBones],P.matricesIndicesExtra[4*a+1]=p[O.vertexIdxForBones+1],P.matricesIndicesExtra[4*a+2]=p[O.vertexIdxForBones+2],P.matricesIndicesExtra[4*a+3]=p[O.vertexIdxForBones+3])),O.matrixWeightsOverride?(P.matricesWeights[4*a]=O.matrixWeightsOverride[0],P.matricesWeights[4*a+1]=O.matrixWeightsOverride[1],P.matricesWeights[4*a+2]=O.matrixWeightsOverride[2],P.matricesWeights[4*a+3]=O.matrixWeightsOverride[3]):(K&&(P.matricesWeights[4*a]=K[O.vertexIdxForBones],P.matricesWeights[4*a+1]=K[O.vertexIdxForBones+1],P.matricesWeights[4*a+2]=K[O.vertexIdxForBones+2],P.matricesWeights[4*a+3]=K[O.vertexIdxForBones+3]),G&&P.matricesWeightsExtra&&(P.matricesWeightsExtra[4*a]=G[O.vertexIdxForBones],P.matricesWeightsExtra[4*a+1]=G[O.vertexIdxForBones+1],P.matricesWeightsExtra[4*a+2]=G[O.vertexIdxForBones+2],P.matricesWeightsExtra[4*a+3]=G[O.vertexIdxForBones+3]))),X.captureUVS)O.uv.toArray(P.Aa,2*a);else{P.Aa.push(.5+O.position.x/o.x);const v=.5+O.position.y/o.y;P.Aa.push(A.d?1-v:v)}a++}}}0===P.indices.length&&(P.indices=null),0===P.xa.length&&(P.xa=null),0===P.ya.length&&(P.ya=null),0===P.Aa.length&&(P.Aa=null),0===(null===(x=P.matricesIndices)||void 0===x?void 0:x.length)&&(P.matricesIndices=null),0===(null===(f=P.matricesWeights)||void 0===f?void 0:f.length)&&(P.matricesWeights=null),0===(null===(M=P.matricesIndicesExtra)||void 0===M?void 0:M.length)&&(P.matricesIndicesExtra=null),0===(null===(H=P.matricesWeightsExtra)||void 0===H?void 0:H.length)&&(P.matricesWeightsExtra=null);const I=new u.d(v,T.va());return P.Ca(I),V?(I.skeleton=T.skeleton,I.parent=T):(I.position=L.clone(),I.rotation=new O.l(y,U,Z)),I.Ke(!0),I.refreshBoundingInfo(!0,!0),I}function Bv(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,Xk:16,height:1,i:.25,capSubdivisions:6};const T=0|Math.max(v.subdivisions?v.subdivisions:2,1),X=0|Math.max(v.Xk?v.Xk:16,3),u=Math.max(v.height?v.height:1,0),B=Math.max(v.i?v.i:.25,0),x=0|Math.max(v.capSubdivisions?v.capSubdivisions:6,1),f=X,M=T,H=Math.max(v.radiusTop?v.radiusTop:B,0),n=Math.max(v.radiusBottom?v.radiusBottom:B,0),V=u-(H+n),D=2*Math.PI,s=Math.max(v.topCapSubdivisions?v.topCapSubdivisions:x,1),F=Math.max(v.bottomCapSubdivisions?v.bottomCapSubdivisions:x,1),k=Math.acos((n-H)/u);let b=[];const l=[],Q=[],K=[];let p=0;const G=[],L=.5*V,r=.5*Math.PI;let o,Z;const U=O.l.Zero(),J=O.l.Zero(),y=Math.cos(k),P=Math.sin(k),a=new O.i(H*P,L+H*y).Xc(new O.i(n*P,n*y-L)).length(),E=H*k+a+n*(r-k);let i=0;for(Z=0;Z<=s;Z++){const v=[],T=r-k*(Z/s);i+=H*k/s;const X=Math.cos(T),O=Math.sin(T),u=X*H;for(o=0;o<=f;o++){const T=o/f,B=T*D+0,m=Math.sin(B),x=Math.cos(B);J.x=u*m,J.y=L+O*H,J.z=u*x,l.push(J.x,J.y,J.z),U.set(X*m,O,X*x),Q.push(U.x,U.y,U.z),K.push(T,A.d?i/E:1-i/E),v.push(p),p++}G.push(v)}const t=u-H-n+y*H-y*n,C=P*(n-H)/t;for(Z=1;Z<=M;Z++){const v=[];i+=a/M;const T=P*(Z*(n-H)/M+H);for(o=0;o<=f;o++){const X=o/f,O=X*D+0,u=Math.sin(O),B=Math.cos(O);J.x=T*u,J.y=L+y*H-Z*t/M,J.z=T*B,l.push(J.x,J.y,J.z),U.set(u,C,B).normalize(),Q.push(U.x,U.y,U.z),K.push(X,A.d?i/E:1-i/E),v.push(p),p++}G.push(v)}for(Z=1;Z<=F;Z++){const v=[],T=r-k-(Math.PI-k)*(Z/F);i+=n*k/F;const X=Math.cos(T),O=Math.sin(T),u=X*n;for(o=0;o<=f;o++){const T=o/f,B=T*D+0,m=Math.sin(B),x=Math.cos(B);J.x=u*m,J.y=O*n-L,J.z=u*x,l.push(J.x,J.y,J.z),U.set(X*m,O,X*x),Q.push(U.x,U.y,U.z),K.push(T,A.d?i/E:1-i/E),v.push(p),p++}G.push(v)}for(o=0;o<f;o++)for(Z=0;Z<s+M+F;Z++){const v=G[Z][o],T=G[Z+1][o],X=G[Z+1][o+1],O=G[Z][o+1];b.push(v),b.push(T),b.push(O),b.push(T),b.push(X),b.push(O)}if(b=b.reverse(),v.orientation&&!v.orientation.equals(O.l.Up())){const T=new O.b;v.orientation.clone().scale(.5*Math.PI).cross(O.l.Up()).toQuaternion().toRotationMatrix(T);const X=O.l.Zero();for(let v=0;v<l.length;v+=3)X.set(l[v],l[v+1],l[v+2]),O.l.TransformCoordinatesToRef(X.clone(),T,X),l[v]=X.x,l[v+1]=X.y,l[v+2]=X.z}const c=new m.e;return c.xa=l,c.ya=Q,c.Aa=K,c.indices=b,c}function mv(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:O.l.Up(),subdivisions:2,Xk:16,height:1,i:.25,capSubdivisions:6,updatable:!1},X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=new u.d(v,X);return Bv(T).Ca(B,T.updatable),B}u.d.CreateDecal=(v,T,X,O,u,B)=>uv(v,T,{position:X,Wd:O,size:u,angle:B});u.d.CreateCapsule=(v,T,X)=>mv(v,T,X),m.e.CreateCapsule=Bv;class Av{constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=v,this.y=T,v!==Math.floor(v)&&(v=Math.floor(v),Z.d.Warn("x is not an integer, floor(x) used")),T!==Math.floor(T)&&(T=Math.floor(T),Z.d.Warn("y is not an integer, floor(y) used"))}clone(){return new Av(this.x,this.y)}rotate60About(v){const T=this.x;return this.x=v.x+v.y-this.y,this.y=T+this.y-v.x,this}rotateNeg60About(v){const T=this.x;return this.x=T+this.y-v.y,this.y=v.x+v.y-T,this}rotate120(v,T){v!==Math.floor(v)&&(v=Math.floor(v),Z.d.Warn("m not an integer only floor(m) used")),T!==Math.floor(T)&&(T=Math.floor(T),Z.d.Warn("n not an integer only floor(n) used"));const X=this.x;return this.x=v-X-this.y,this.y=T+X,this}rotateNeg120(v,T){v!==Math.floor(v)&&(v=Math.floor(v),Z.d.Warn("m is not an integer, floor(m) used")),T!==Math.floor(T)&&(T=Math.floor(T),Z.d.Warn("n is not an integer,   floor(n) used"));const X=this.x;return this.x=this.y-T,this.y=v+T-X-this.y,this}toCartesianOrigin(v,T){const X=O.l.Zero();return X.x=v.x+2*this.x*T+this.y*T,X.y=v.y+Math.sqrt(3)*this.y*T,X}static Zero(){return new Av(0,0)}}class xv{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new fv("icosahedron","Regular",[[0,J.e,-1],[-J.e,1,0],[-1,0,-J.e],[1,0,-J.e],[J.e,1,0],[0,J.e,1],[-1,0,J.e],[-J.e,-1,0],[0,-J.e,-1],[J.e,-1,0],[1,0,J.e],[0,-J.e,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let v=12;const T={},X=this.m,O=this.n;let u,B,m,A,x,f=X,M=1,H=0;0!==O&&(f=(0,z.i)(X,O)),M=X/f,H=O/f;const n=Av.Zero(),V=new Av(X,O),D=new Av(-O,X+O),s=Av.Zero(),F=Av.Zero(),k=Av.Zero();let b,l,Q,K,p=[];const G=[],L=this.vertByDist,r=(X,O,u,B)=>{b=X+"|"+u,l=O+"|"+B,b in T||l in T?b in T&&!(l in T)?T[l]=T[b]:l in T&&!(b in T)&&(T[b]=T[l]):(T[b]=v,T[l]=v,v++),L[u][0]>2?G[T[b]]=[-L[u][0],L[u][1],T[b]]:G[T[b]]=[p[L[u][0]],L[u][1],T[b]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let o=0;o<20;o++){if(p=this.IDATA.face[o],m=p[2],A=p[1],x=p[0],Q=n.x+"|"+n.y,b=o+"|"+Q,b in T||(T[b]=m,G[m]=[p[L[Q][0]],L[Q][1]]),Q=V.x+"|"+V.y,b=o+"|"+Q,b in T||(T[b]=A,G[A]=[p[L[Q][0]],L[Q][1]]),Q=D.x+"|"+D.y,b=o+"|"+Q,b in T||(T[b]=x,G[x]=[p[L[Q][0]],L[Q][1]]),u=this.IDATA.edgematch[o][0],B=this.IDATA.edgematch[o][1],"B"===B)for(let v=1;v<f;v++)F.x=X-v*(M+H),F.y=O+v*M,k.x=-v*H,k.y=v*(M+H),Q=F.x+"|"+F.y,K=k.x+"|"+k.y,r(o,u,Q,K);if("O"===B)for(let v=1;v<f;v++)k.x=-v*H,k.y=v*(M+H),s.x=v*M,s.y=v*H,Q=k.x+"|"+k.y,K=s.x+"|"+s.y,r(o,u,Q,K);if(u=this.IDATA.edgematch[o][2],B=this.IDATA.edgematch[o][3],B&&"A"===B)for(let v=1;v<f;v++)s.x=v*M,s.y=v*H,F.x=X-(f-v)*(M+H),F.y=O+(f-v)*M,Q=s.x+"|"+s.y,K=F.x+"|"+F.y,r(o,u,Q,K);for(let X=0;X<this.vertices.length;X++)Q=this.vertices[X].x+"|"+this.vertices[X].y,b=o+"|"+Q,b in T||(T[b]=v++,L[Q][0]>2?G[T[b]]=[-L[Q][0],L[Q][1],T[b]]:G[T[b]]=[p[L[Q][0]],L[Q][1],T[b]])}this.closestTo=G,this.vecToidx=T}calcCoeffs(){const v=this.m,T=this.n,X=Math.sqrt(3)/3,O=v*v+T*T+v*T;this.coau=(v+T)/O,this.cobu=-T/O,this.coav=-X*(v-T)/O,this.cobv=X*(2*v+T)/O}createInnerFacets(){const v=this.m,T=this.n;for(let X=0;X<T+v+1;X++)for(let v=this.min[X];v<this.max[X]+1;v++)v<this.max[X]&&v<this.max[X+1]+1&&this.innerFacets.push(["|"+v+"|"+X,"|"+v+"|"+(X+1),"|"+(v+1)+"|"+X]),X>0&&v<this.max[X-1]&&v+1<this.max[X]+1&&this.innerFacets.push(["|"+v+"|"+X,"|"+(v+1)+"|"+X,"|"+(v+1)+"|"+(X-1)])}edgeVecsABOB(){const v=this.m,T=this.n,X=new Av(-T,v+T);for(let O=1;O<v+T;O++){const v=new Av(this.min[O],O),T=new Av(this.min[O-1],O-1),u=new Av(this.min[O+1],O+1),B=v.clone(),m=T.clone(),A=u.clone();B.rotate60About(X),m.rotate60About(X),A.rotate60About(X);const x=new Av(this.max[B.y],B.y),f=new Av(this.max[B.y-1],B.y-1),M=new Av(this.max[B.y-1]-1,B.y-1);B.x===x.x&&B.y===x.y||(B.x!==f.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([v,f,M]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([v,M,x])):B.y===A.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([v,T,f]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([v,f,u])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([v,T,f]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([v,f,x])))}}mapABOBtoOBOA(){const v=new Av(0,0);for(let T=0;T<this.isoVecsABOB.length;T++){const X=[];for(let O=0;O<3;O++)v.x=this.isoVecsABOB[T][O].x,v.y=this.isoVecsABOB[T][O].y,0===this.vertexTypes[T][O]&&v.rotateNeg120(this.m,this.n),X.push(v.clone());this.isoVecsOBOA.push(X)}}mapABOBtoBAOA(){const v=new Av(0,0);for(let T=0;T<this.isoVecsABOB.length;T++){const X=[];for(let O=0;O<3;O++)v.x=this.isoVecsABOB[T][O].x,v.y=this.isoVecsABOB[T][O].y,1===this.vertexTypes[T][O]&&v.rotate120(this.m,this.n),X.push(v.clone());this.isoVecsBAOA.push(X)}}MapToFace(v,T){const X=this.IDATA.face[v],u=X[2],B=X[1],m=X[0],A=O.l.Ld(this.IDATA.vertex[u]),x=O.l.Ld(this.IDATA.vertex[B]),f=O.l.Ld(this.IDATA.vertex[m]),M=x.Xc(A),H=f.Xc(A),n=M.scale(this.coau).add(H.scale(this.cobu)),V=M.scale(this.coav).add(H.scale(this.cobv)),D=[];let s,F=O.g.Vd[0];for(let O=0;O<this.cartesian.length;O++)F=n.scale(this.cartesian[O].x).add(V.scale(this.cartesian[O].y)).add(A),D[O]=[F.x,F.y,F.z],s=v+"|"+this.vertices[O].x+"|"+this.vertices[O].y,T.vertex[this.vecToidx[s]]=[F.x,F.y,F.z]}build(v,T){const X=[],O=Av.Zero(),u=new Av(v,T),B=new Av(-T,v+T);X.push(O,u,B);for(let Q=T;Q<v+1;Q++)for(let T=0;T<v+1-Q;T++)X.push(new Av(T,Q));if(T>0){const O=(0,z.i)(v,T),u=v/O,B=T/O;for(let A=1;A<O;A++)X.push(new Av(A*u,A*B)),X.push(new Av(-A*B,A*(u+B))),X.push(new Av(v-A*(u+B),T+A*u));const m=v/T;for(let A=1;A<T;A++)for(let O=0;O<A*m;O++)X.push(new Av(O,A)),X.push(new Av(O,A).rotate120(v,T)),X.push(new Av(O,A).rotateNeg120(v,T))}X.sort(((v,T)=>v.x-T.x)),X.sort(((v,T)=>v.y-T.y));const m=new Array(v+T+1),A=new Array(v+T+1);for(let Q=0;Q<m.length;Q++)m[Q]=1/0,A[Q]=-1/0;let x=0,f=0;const M=X.length;for(let Q=0;Q<M;Q++)f=X[Q].x,x=X[Q].y,m[x]=Math.min(f,m[x]),A[x]=Math.max(f,A[x]);const H=(X,O)=>{const u=X.clone();return"A"===O&&u.rotateNeg120(v,T),"B"===O&&u.rotate120(v,T),u.x<0?u.y:u.x+u.y},n=[],V=[],D=[],s=[],F={},k=[];let b=-1,l=-1;for(let Q=0;Q<M;Q++)n[Q]=X[Q].toCartesianOrigin(new Av(0,0),.5),V[Q]=H(X[Q],"O"),D[Q]=H(X[Q],"A"),s[Q]=H(X[Q],"B"),V[Q]===D[Q]&&D[Q]===s[Q]?(b=3,l=V[Q]):V[Q]===D[Q]?(b=4,l=V[Q]):D[Q]===s[Q]?(b=5,l=D[Q]):s[Q]===V[Q]&&(b=6,l=V[Q]),V[Q]<D[Q]&&V[Q]<s[Q]&&(b=2,l=V[Q]),D[Q]<V[Q]&&D[Q]<s[Q]&&(b=1,l=D[Q]),s[Q]<D[Q]&&s[Q]<V[Q]&&(b=0,l=s[Q]),k.push([b,l,X[Q].x,X[Q].y]);k.sort(((v,T)=>v[2]-T[2])),k.sort(((v,T)=>v[3]-T[3])),k.sort(((v,T)=>v[1]-T[1])),k.sort(((v,T)=>v[0]-T[0]));for(let Q=0;Q<k.length;Q++)F[k[Q][2]+"|"+k[Q][3]]=[k[Q][0],k[Q][1],Q];return this.m=v,this.n=T,this.vertices=X,this.vertByDist=F,this.cartesian=n,this.min=m,this.max=A,this}}class fv{constructor(v,T,X,O){this.name=v,this.category=T,this.vertex=X,this.face=O}}class Mv extends fv{innerToData(v,T){for(let X=0;X<T.innerFacets.length;X++)this.face.push(T.innerFacets[X].map((X=>T.vecToidx[v+X])))}mapABOBtoDATA(v,T){const X=T.IDATA.edgematch[v][0];for(let O=0;O<T.isoVecsABOB.length;O++){const u=[];for(let B=0;B<3;B++)0===T.vertexTypes[O][B]?u.push(v+"|"+T.isoVecsABOB[O][B].x+"|"+T.isoVecsABOB[O][B].y):u.push(X+"|"+T.isoVecsABOB[O][B].x+"|"+T.isoVecsABOB[O][B].y);this.face.push([T.vecToidx[u[0]],T.vecToidx[u[1]],T.vecToidx[u[2]]])}}mapOBOAtoDATA(v,T){const X=T.IDATA.edgematch[v][0];for(let O=0;O<T.isoVecsOBOA.length;O++){const u=[];for(let B=0;B<3;B++)1===T.vertexTypes[O][B]?u.push(v+"|"+T.isoVecsOBOA[O][B].x+"|"+T.isoVecsOBOA[O][B].y):u.push(X+"|"+T.isoVecsOBOA[O][B].x+"|"+T.isoVecsOBOA[O][B].y);this.face.push([T.vecToidx[u[0]],T.vecToidx[u[1]],T.vecToidx[u[2]]])}}mapBAOAtoDATA(v,T){const X=T.IDATA.edgematch[v][2];for(let O=0;O<T.isoVecsBAOA.length;O++){const u=[];for(let B=0;B<3;B++)1===T.vertexTypes[O][B]?u.push(v+"|"+T.isoVecsBAOA[O][B].x+"|"+T.isoVecsBAOA[O][B].y):u.push(X+"|"+T.isoVecsBAOA[O][B].x+"|"+T.isoVecsBAOA[O][B].y);this.face.push([T.vecToidx[u[0]],T.vecToidx[u[1]],T.vecToidx[u[2]]])}}orderData(v){const T=[];for(let B=0;B<13;B++)T[B]=[];const X=v.closestTo;for(let B=0;B<X.length;B++)X[B][0]>-1?X[B][1]>0&&T[X[B][0]].push([B,X[B][1]]):T[12].push([B,X[B][0]]);const O=[];for(let B=0;B<12;B++)O[B]=B;let u=12;for(let B=0;B<12;B++){T[B].sort(((v,T)=>v[1]-T[1]));for(let v=0;v<T[B].length;v++)O[T[B][v][0]]=u++}for(let B=0;B<T[12].length;B++)O[T[12][B][0]]=u++;for(let B=0;B<this.vertex.length;B++)this.vertex[B].push(O[B]);this.vertex.sort(((v,T)=>v[3]-T[3]));for(let B=0;B<this.vertex.length;B++)this.vertex[B].pop();for(let B=0;B<this.face.length;B++)for(let v=0;v<this.face[B].length;v++)this.face[B][v]=O[this.face[B][v]];this.sharedNodes=T[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(v,T){const X=[],O=[];let u=T.pop();O.push(u);let B=this.face[u].indexOf(v);B=(B+2)%3;let m=this.face[u][B];X.push(m);let A=0;for(;T.length>0;)u=T[A],this.face[u].indexOf(m)>-1?(B=(this.face[u].indexOf(m)+1)%3,m=this.face[u][B],X.push(m),O.push(u),T.splice(A,1),A=0):A++;return this.adjacentFaces.push(X),O}toGoldbergPolyhedronData(){const v=new fv("GeoDual","Goldberg",[],[]);v.name="GD dual";const T=this.vertex.length,X=new Array(T);for(let x=0;x<T;x++)X[x]=[];for(let x=0;x<this.face.length;x++)for(let v=0;v<3;v++)X[this.face[x][v]].push(x);let O=0,u=0,B=0,m=[],A=[];this.adjacentFaces=[];for(let x=0;x<X.length;x++)v.face[x]=this.setOrder(x,X[x].concat([])),X[x].forEach((T=>{O=0,u=0,B=0,m=this.face[T];for(let v=0;v<3;v++)A=this.vertex[m[v]],O+=A[0],u+=A[1],B+=A[2];v.vertex[T]=[O/3,u/3,B/3]}));return v}static BuildGeodesicData(v){const T=new Mv("Geodesic-m-n","Geodesic",[[0,J.e,-1],[-J.e,1,0],[-1,0,-J.e],[1,0,-J.e],[J.e,1,0],[0,J.e,1],[-1,0,J.e],[-J.e,-1,0],[0,-J.e,-1],[J.e,-1,0],[1,0,J.e],[0,-J.e,1]],[]);v.setIndices(),v.calcCoeffs(),v.createInnerFacets(),v.edgeVecsABOB(),v.mapABOBtoOBOA(),v.mapABOBtoBAOA();for(let X=0;X<v.IDATA.face.length;X++)v.MapToFace(X,T),T.innerToData(X,v),"B"===v.IDATA.edgematch[X][1]&&T.mapABOBtoDATA(X,v),"O"===v.IDATA.edgematch[X][1]&&T.mapOBOAtoDATA(X,v),"A"===v.IDATA.edgematch[X][3]&&T.mapBAOAtoDATA(X,v);T.orderData(v);return T.vertex=T.vertex.map((function(v){const T=v[0],X=v[1],O=v[2],u=Math.sqrt(T*T+X*X+O*O);return v[0]*=1/u,v[1]*=1/u,v[2]*=1/u,v})),T}}u.d._GoldbergMeshParser=(v,T)=>Hv.Parse(v,T);class Hv extends u.d{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(v,T){return void 0===T?(v>this.goldbergData.nbUnsharedFaces-1&&(Z.d.Warn("Maximum number of unshared faces used"),v=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+v):(v>11&&(Z.d.Warn("Last pole used"),v=11),T>this.goldbergData.nbFacesAtPole-1&&(Z.d.Warn("Maximum number of faces at a pole used"),T=this.goldbergData.nbFacesAtPole-1),12+v*this.goldbergData.nbFacesAtPole+T)}_changeGoldbergFaceColors(v){for(let X=0;X<v.length;X++){const T=v[X][0],O=v[X][1],u=v[X][2];for(let v=T;v<O+1;v++)this.goldbergData.faceColors[v]=u}const T=[];for(let X=0;X<12;X++)for(let v=0;v<5;v++)T.push(this.goldbergData.faceColors[X].r,this.goldbergData.faceColors[X].g,this.goldbergData.faceColors[X].b,this.goldbergData.faceColors[X].a);for(let X=12;X<this.goldbergData.faceColors.length;X++)for(let v=0;v<6;v++)T.push(this.goldbergData.faceColors[X].r,this.goldbergData.faceColors[X].g,this.goldbergData.faceColors[X].b,this.goldbergData.faceColors[X].a);return T}setGoldbergFaceColors(v){const T=this._changeGoldbergFaceColors(v);this.Ga(B.e.ColorKind,T)}updateGoldbergFaceColors(v){const T=this._changeGoldbergFaceColors(v);this.updateVerticesData(B.e.ColorKind,T)}_changeGoldbergFaceUVs(v){const T=this.getVerticesData(B.e.UVKind);for(let X=0;X<v.length;X++){const O=v[X][0],u=v[X][1],B=v[X][2],m=v[X][3],A=v[X][4],x=[],f=[];let M,H;for(let v=0;v<5;v++)M=B.x+m*Math.cos(A+v*Math.PI/2.5),H=B.y+m*Math.sin(A+v*Math.PI/2.5),M<0&&(M=0),M>1&&(M=1),x.push(M,H);for(let v=0;v<6;v++)M=B.x+m*Math.cos(A+v*Math.PI/3),H=B.y+m*Math.sin(A+v*Math.PI/3),M<0&&(M=0),M>1&&(M=1),f.push(M,H);for(let v=O;v<Math.min(12,u+1);v++)for(let X=0;X<5;X++)T[10*v+2*X]=x[2*X],T[10*v+2*X+1]=x[2*X+1];for(let v=Math.max(12,O);v<u+1;v++)for(let X=0;X<6;X++)T[12*v-24+2*X]=f[2*X],T[12*v-23+2*X]=f[2*X+1]}return T}setGoldbergFaceUVs(v){const T=this._changeGoldbergFaceUVs(v);this.Ga(B.e.UVKind,T)}updateGoldbergFaceUVs(v){const T=this._changeGoldbergFaceUVs(v);this.updateVerticesData(B.e.UVKind,T)}placeOnGoldbergFaceAt(v,T,X){const u=O.l.RotationFromAxis(this.goldbergData.faceXaxis[T],this.goldbergData.faceYaxis[T],this.goldbergData.faceZaxis[T]);v.rotation=u,v.position=this.goldbergData.faceCenters[T].add(this.goldbergData.faceXaxis[T].scale(X.x)).add(this.goldbergData.faceYaxis[T].scale(X.y)).add(this.goldbergData.faceZaxis[T].scale(X.z))}serialize(v){super.serialize(v),v.type="GoldbergMesh";const T={};if(T.adjacentFaces=this.goldbergData.adjacentFaces,T.nbSharedFaces=this.goldbergData.nbSharedFaces,T.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,T.nbFaces=this.goldbergData.nbFaces,T.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){T.faceColors=[];for(const v of this.goldbergData.faceColors)T.faceColors.push(v.Pd())}if(this.goldbergData.faceCenters){T.faceCenters=[];for(const v of this.goldbergData.faceCenters)T.faceCenters.push(v.Pd())}if(this.goldbergData.faceZaxis){T.faceZaxis=[];for(const v of this.goldbergData.faceZaxis)T.faceZaxis.push(v.Pd())}if(this.goldbergData.faceYaxis){T.faceYaxis=[];for(const v of this.goldbergData.faceYaxis)T.faceYaxis.push(v.Pd())}if(this.goldbergData.faceXaxis){T.faceXaxis=[];for(const v of this.goldbergData.faceXaxis)T.faceXaxis.push(v.Pd())}v.goldbergData=T}static Parse(v,T){const X=v.goldbergData;X.faceColors=X.faceColors.map((v=>n.g.Ld(v))),X.faceCenters=X.faceCenters.map((v=>O.l.Ld(v))),X.faceZaxis=X.faceZaxis.map((v=>O.l.Ld(v))),X.faceXaxis=X.faceXaxis.map((v=>O.l.Ld(v))),X.faceYaxis=X.faceYaxis.map((v=>O.l.Ld(v)));const u=new Hv(v.name,T);return u.goldbergData=X,u}}var nv=X(11955);class Vv{constructor(v){this._paths=[],this._tempPaths=[],this._holes=[],this._resolution=v}moveTo(v,T){this._currentPath=new U.f(v,T),this._tempPaths.push(this._currentPath)}lineTo(v,T){this._currentPath.addLineTo(v,T)}quadraticCurveTo(v,T,X,O){this._currentPath.addQuadraticCurveTo(v,T,X,O,this._resolution)}bezierCurveTo(v,T,X,O,u,B){this._currentPath.addBezierCurveTo(v,T,X,O,u,B,this._resolution)}extractHoles(){for(const v of this._tempPaths)v.area()>0?this._holes.push(v):this._paths.push(v);if(!this._paths.length&&this._holes.length){const v=this._holes;this._holes=this._paths,this._paths=v}this._tempPaths.length=0}get paths(){return this._paths}get holes(){return this._holes}}function Dv(v,T,X,O,u,B){const m=B.glyphs[v]||B.glyphs["?"];if(!m)return null;const A=new Vv(u);if(m.o){const v=m.o.split(" ");for(let u=0,B=v.length;u<B;){switch(v[u++]){case"m":{const B=parseInt(v[u++])*T+X,m=parseInt(v[u++])*T+O;A.moveTo(B,m);break}case"l":{const B=parseInt(v[u++])*T+X,m=parseInt(v[u++])*T+O;A.lineTo(B,m);break}case"q":{const B=parseInt(v[u++])*T+X,m=parseInt(v[u++])*T+O,x=parseInt(v[u++])*T+X,f=parseInt(v[u++])*T+O;A.quadraticCurveTo(x,f,B,m);break}case"b":{const B=parseInt(v[u++])*T+X,m=parseInt(v[u++])*T+O,x=parseInt(v[u++])*T+X,f=parseInt(v[u++])*T+O,M=parseInt(v[u++])*T+X,H=parseInt(v[u++])*T+O;A.bezierCurveTo(x,f,M,H,B,m);break}}}}return A.extractHoles(),{offsetX:m.ha*T,shapePath:A}}const sv={CreateBox:H.i,CreateTiledBox:F,CreateSphere:k.d,kb:M.c,CreateIcoSphere:w,CreateRibbon:f,CreateCylinder:K,CreateTorus:G,CreateTorusKnot:r,CreateLineSystem:o.i,mb:o.k,CreateDashedLines:o.e,ExtrudeShape:c,ExtrudeShapeCustom:N,CreateLathe:I,CreateTiledPlane:D,Rg:W.c,CreateGround:g.f,CreateTiledGround:g.j,CreateGroundFromHeightMap:g.d,CreatePolygon:t,ExtrudePolygon:C,CreateTube:j,CreatePolyhedron:h,CreateGeodesic:function(v,T){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,O=T.m||1;O!==Math.floor(O)&&(O=Math.floor(O),Z.d.Warn("m not an integer only floor(m) used"));let u=T.n||0;if(u!==Math.floor(u)&&(u=Math.floor(u),Z.d.Warn("n not an integer only floor(n) used")),u>O){const v=u;u=O,O=v,Z.d.Warn("n > m therefore m and n swapped")}const B=new xv;return B.build(O,u),h(v,{custom:Mv.BuildGeodesicData(B),size:T.size,sizeX:T.sizeX,sizeY:T.sizeY,sizeZ:T.sizeZ,faceUV:T.faceUV,faceColors:T.faceColors,flat:T.flat,updatable:T.updatable,sideOrientation:T.sideOrientation,frontUVs:T.frontUVs,backUVs:T.backUVs},X)},CreateGoldberg:function(v,T){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=T.size,x=T.sizeX||B||1,f=T.sizeY||B||1,M=T.sizeZ||B||1;let H=T.m||1;H!==Math.floor(H)&&(H=Math.floor(H),Z.d.Warn("m not an integer only floor(m) used"));let V=T.n||0;if(V!==Math.floor(V)&&(V=Math.floor(V),Z.d.Warn("n not an integer only floor(n) used")),V>H){const v=V;V=H,H=v,Z.d.Warn("n > m therefore m and n swapped")}const D=new xv;D.build(H,V);const s=Mv.BuildGeodesicData(D),F=s.toGoldbergPolyhedronData(),k=new Hv(v,X);T.sideOrientation=u.d._GetDefaultSideOrientation(T.sideOrientation),k._originalBuilderSideOrientation=T.sideOrientation;(function(v,T){const X=v.size,u=v.sizeX||X||1,B=v.sizeY||X||1,x=v.sizeZ||X||1,f=0===v.sideOrientation?0:v.sideOrientation||m.e.DEFAULTSIDE,M=[],H=[],n=[],V=[];let D=1/0,s=-1/0,F=1/0,k=-1/0;for(let O=0;O<T.vertex.length;O++)D=Math.min(D,T.vertex[O][0]*u),s=Math.max(s,T.vertex[O][0]*u),F=Math.min(F,T.vertex[O][1]*B),k=Math.max(k,T.vertex[O][1]*B);let b=0;for(let m=0;m<T.face.length;m++){const v=T.face[m],X=O.l.Ld(T.vertex[v[0]]),f=O.l.Ld(T.vertex[v[2]]),l=O.l.Ld(T.vertex[v[1]]),Q=f.Xc(X),K=l.Xc(X),p=O.l.Cross(K,Q).normalize();for(let O=0;O<v.length;O++){n.push(p.x,p.y,p.z);const X=T.vertex[v[O]];M.push(X[0]*u,X[1]*B,X[2]*x);const m=(X[1]*B-F)/(k-F);V.push((X[0]*u-D)/(s-D),A.d?1-m:m)}for(let T=0;T<v.length-2;T++)H.push(b,b+T+2,b+T+1);b+=v.length}m.e._ComputeSides(f,M,H,n,V);const l=new m.e;return l.xa=M,l.indices=H,l.ya=n,l.Aa=V,l})(T,F).Ca(k,T.updatable),k.goldbergData.nbSharedFaces=s.sharedNodes,k.goldbergData.nbUnsharedFaces=s.poleNodes,k.goldbergData.adjacentFaces=s.adjacentFaces,k.goldbergData.nbFaces=k.goldbergData.nbSharedFaces+k.goldbergData.nbUnsharedFaces,k.goldbergData.nbFacesAtPole=(k.goldbergData.nbUnsharedFaces-12)/12;for(let u=0;u<s.vertex.length;u++)k.goldbergData.faceCenters.push(O.l.Ld(s.vertex[u])),k.goldbergData.faceCenters[u].x*=x,k.goldbergData.faceCenters[u].y*=f,k.goldbergData.faceCenters[u].z*=M,k.goldbergData.faceColors.push(new n.g(1,1,1,1));for(let u=0;u<F.face.length;u++){const v=F.face[u],T=O.l.Ld(F.vertex[v[0]]),X=O.l.Ld(F.vertex[v[2]]),B=O.l.Ld(F.vertex[v[1]]),m=X.Xc(T),A=B.Xc(T),x=O.l.Cross(A,m).normalize(),f=O.l.Cross(A,x).normalize();k.goldbergData.faceXaxis.push(A.normalize()),k.goldbergData.faceYaxis.push(x),k.goldbergData.faceZaxis.push(f)}return k},CreateDecal:uv,CreateCapsule:mv,CreateText:function(v,T,X){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{size:50,resolution:8,depth:1},m=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,A=arguments.length>5&&void 0!==arguments[5]?arguments[5]:earcut;const x=function(v,T,X,O){const u=Array.from(v),B=T/O.resolution,m=(O.boundingBox.yMax-O.boundingBox.yMin+O.underlineThickness)*B,A=[];let x=0,f=0;for(let M=0;M<u.length;M++){const v=u[M];if("\n"===v)x=0,f-=m;else{const T=Dv(v,B,x,f,X,O);T&&(x+=T.offsetX,A.push(T.shapePath))}}return A}(T,B.size||50,B.resolution||8,X),f=[];let M=0;for(const D of x){if(!D.paths.length)continue;const T=D.holes.slice();for(const X of D.paths){var H,n;const x=[],V=[],D=X.getPoints();for(const v of D)V.push(new O.l(v.x,0,v.y));const s=T.slice();for(const v of s){const u=v.getPoints();let B=!1;for(const v of u)if(X.isPointInside(v)){B=!0;break}if(!B)continue;const m=[];for(const v of u)m.push(new O.l(v.x,0,v.y));x.push(m),T.splice(T.indexOf(v),1)}if(!x.length&&T.length)for(const v of T){const T=v.getPoints(),X=[];for(const v of T)X.push(new O.l(v.x,0,v.y));x.push(X)}const F=C(v,{shape:V,holes:x.length?x:void 0,depth:B.depth||1,faceUV:B.faceUV||(null===(H=B.perLetterFaceUV)||void 0===H?void 0:H.call(B,M)),faceColors:B.faceColors||(null===(n=B.perLetterFaceColors)||void 0===n?void 0:n.call(B,M)),sideOrientation:u.d._GetDefaultSideOrientation(B.sideOrientation||u.d.DOUBLESIDE)},m,A);f.push(F),M++}}const V=u.d.MergeMeshes(f,!0,!0);if(V){const T=V.getBoundingInfo().boundingBox;V.position.x+=-(T.minimumWorld.x+T.maximumWorld.x)/2,V.position.y+=-(T.minimumWorld.y+T.maximumWorld.y)/2,V.position.z+=-(T.minimumWorld.z+T.maximumWorld.z)/2+T.extendSize.z,V.name=v;const X=new nv.c("pivot",m);X.rotation.x=-Math.PI/2,V.parent=X,V.bakeCurrentTransformIntoVertices(),V.parent=null,X.dispose()}return V}}},12581:(v,T,X)=>{"use strict";var O=X(11911),u=X(1261),B=X(1006),m=X(1103),A=X(1371);O.d.prototype.thinInstanceAdd=function(v){let T=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.va().getEngine().getCaps().instancedArrays)return m.d.Error("Thin Instances are not supported on this device as Instanced Array extension not supported"),-1;this._thinInstanceUpdateBufferSize("matrix",Array.isArray(v)?v.length:1);const X=this._thinInstanceDataStorage.instancesCount;if(Array.isArray(v))for(let O=0;O<v.length;++O)this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,v[O],O===v.length-1&&T);else this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,v,T);return X},O.d.prototype.thinInstanceAddSelf=function(){let v=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.thinInstanceAdd(B.b.IdentityReadOnly,v)},O.d.prototype.thinInstanceRegisterAttribute=function(v,T){v===u.e.ColorKind&&(v=u.e.ColorInstanceKind),this.removeVerticesData(v),this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.strides[v]=T,this._userThinInstanceBuffersStorage.sizes[v]=T*Math.max(32,this._thinInstanceDataStorage.instancesCount),this._userThinInstanceBuffersStorage.data[v]=new Float32Array(this._userThinInstanceBuffersStorage.sizes[v]),this._userThinInstanceBuffersStorage.vertexBuffers[v]=new u.e(this.getEngine(),this._userThinInstanceBuffersStorage.data[v],v,!0,!1,T,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[v])},O.d.prototype.thinInstanceSetMatrixAt=function(v,T){let X=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!this._thinInstanceDataStorage.matrixData||v>=this._thinInstanceDataStorage.instancesCount)return!1;const O=this._thinInstanceDataStorage.matrixData;return T.copyToArray(O,16*v),this._thinInstanceDataStorage.worldMatrices&&(this._thinInstanceDataStorage.worldMatrices[v]=T),X&&(this.Uj("matrix"),this.Da||this.thinInstanceRefreshBoundingInfo(!1)),!0},O.d.prototype.thinInstanceSetAttributeAt=function(v,T,X){let O=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return v===u.e.ColorKind&&(v=u.e.ColorInstanceKind),!(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.data[v]||T>=this._thinInstanceDataStorage.instancesCount)&&(this._thinInstanceUpdateBufferSize(v,0),this._userThinInstanceBuffersStorage.data[v].set(X,T*this._userThinInstanceBuffersStorage.strides[v]),O&&this.Uj(v),!0)},Object.defineProperty(O.d.prototype,"Rj",{get:function(){return this._thinInstanceDataStorage.instancesCount},set:function(v){var T;const X=this._thinInstanceDataStorage.matrixData??(null===(T=this.source)||void 0===T?void 0:T._thinInstanceDataStorage.matrixData);v<=(X?X.length/16:0)&&(this._thinInstanceDataStorage.instancesCount=v)},enumerable:!0,configurable:!0}),O.d.prototype._thinInstanceCreateMatrixBuffer=function(v,T){let X=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const O=new u.d(this.getEngine(),T,!X,16,!1,!0);for(let u=0;u<4;u++)this.setVerticesBuffer(O.createVertexBuffer(v+u,4*u,4));return O},O.d.prototype.Vj=function(v,T){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,O=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];var B;if(X=X||16,"matrix"===v)null===(B=this._thinInstanceDataStorage.matrixBuffer)||void 0===B||B.dispose(),this._thinInstanceDataStorage.matrixBuffer=null,this._thinInstanceDataStorage.matrixBufferSize=T?T.length:32*X,this._thinInstanceDataStorage.matrixData=T,this._thinInstanceDataStorage.worldMatrices=null,null!==T?(this._thinInstanceDataStorage.instancesCount=T.length/X,this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",T,O),this.Da||this.thinInstanceRefreshBoundingInfo(!1)):(this._thinInstanceDataStorage.instancesCount=0,this.Da||this.refreshBoundingInfo());else if("previousMatrix"===v){var m;null===(m=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===m||m.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=null,this._thinInstanceDataStorage.previousMatrixData=T,null!==T&&(this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",T,O))}else{var A;if(v===u.e.ColorKind&&(v=u.e.ColorInstanceKind),null===T)null!==(A=this._userThinInstanceBuffersStorage)&&void 0!==A&&A.data[v]&&(this.removeVerticesData(v),delete this._userThinInstanceBuffersStorage.data[v],delete this._userThinInstanceBuffersStorage.strides[v],delete this._userThinInstanceBuffersStorage.sizes[v],delete this._userThinInstanceBuffersStorage.vertexBuffers[v]);else this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.data[v]=T,this._userThinInstanceBuffersStorage.strides[v]=X,this._userThinInstanceBuffersStorage.sizes[v]=T.length,this._userThinInstanceBuffersStorage.vertexBuffers[v]=new u.e(this.getEngine(),T,v,!O,!1,X,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[v])}},O.d.prototype.Uj=function(v){var T;if("matrix"===v)this.Qj&&this._thinInstanceDataStorage.matrixBuffer&&!this._thinInstanceDataStorage.matrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(v),null===(T=this._thinInstanceDataStorage.matrixBuffer)||void 0===T||T.updateDirectly(this._thinInstanceDataStorage.matrixData,0,this._thinInstanceDataStorage.instancesCount);else if("previousMatrix"===v){var X;this.Qj&&this._thinInstanceDataStorage.previousMatrixBuffer&&!this._thinInstanceDataStorage.previousMatrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(v),null===(X=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===X||X.updateDirectly(this._thinInstanceDataStorage.previousMatrixData,0,this._thinInstanceDataStorage.instancesCount)}else{var O;v===u.e.ColorKind&&(v=u.e.ColorInstanceKind),null!==(O=this._userThinInstanceBuffersStorage)&&void 0!==O&&O.vertexBuffers[v]&&(this.Qj&&!this._userThinInstanceBuffersStorage.vertexBuffers[v].isUpdatable()&&this._thinInstanceRecreateBuffer(v),this._userThinInstanceBuffersStorage.vertexBuffers[v].updateDirectly(this._userThinInstanceBuffersStorage.data[v],0))}},O.d.prototype.thinInstancePartialBufferUpdate=function(v,T,X){var O;"matrix"===v?this._thinInstanceDataStorage.matrixBuffer&&this._thinInstanceDataStorage.matrixBuffer.updateDirectly(T,X):(v===u.e.ColorKind&&(v=u.e.ColorInstanceKind),null!==(O=this._userThinInstanceBuffersStorage)&&void 0!==O&&O.vertexBuffers[v]&&this._userThinInstanceBuffersStorage.vertexBuffers[v].updateDirectly(T,X))},O.d.prototype.thinInstanceGetWorldMatrices=function(){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return[];const v=this._thinInstanceDataStorage.matrixData;if(!this._thinInstanceDataStorage.worldMatrices){this._thinInstanceDataStorage.worldMatrices=[];for(let T=0;T<this._thinInstanceDataStorage.instancesCount;++T)this._thinInstanceDataStorage.worldMatrices[T]=B.b.Ld(v,16*T)}return this._thinInstanceDataStorage.worldMatrices},O.d.prototype.thinInstanceRefreshBoundingInfo=function(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0],T=arguments.length>1&&void 0!==arguments[1]&&arguments[1],X=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return;const O=this._thinInstanceDataStorage.boundingVectors;if(v||!this.rawBoundingInfo){O.length=0,this.refreshBoundingInfo(T,X);const v=this.getBoundingInfo();this.rawBoundingInfo=new A.c(v.minimum,v.maximum)}const u=this.getBoundingInfo(),m=this._thinInstanceDataStorage.matrixData;if(0===O.length)for(let B=0;B<u.boundingBox.vectors.length;++B)O.push(u.boundingBox.vectors[B].clone());B.g.Vd[0].Td(Number.POSITIVE_INFINITY),B.g.Vd[1].Td(Number.NEGATIVE_INFINITY);for(let A=0;A<this._thinInstanceDataStorage.instancesCount;++A){B.b.FromArrayToRef(m,16*A,B.g.Matrix[0]);for(let v=0;v<O.length;++v)B.l.TransformCoordinatesToRef(O[v],B.g.Matrix[0],B.g.Vd[2]),B.g.Vd[0].minimizeInPlace(B.g.Vd[2]),B.g.Vd[1].maximizeInPlace(B.g.Vd[2])}u.reConstruct(B.g.Vd[0],B.g.Vd[1]),this.Ea()},O.d.prototype._thinInstanceRecreateBuffer=function(v){let T=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var X;if("matrix"===v)null===(X=this._thinInstanceDataStorage.matrixBuffer)||void 0===X||X.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",this._thinInstanceDataStorage.matrixData,T);else if("previousMatrix"===v){var O;if(this._scene.needsPreviousWorldMatrices)null===(O=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===O||O.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.previousMatrixData??this._thinInstanceDataStorage.matrixData,T)}else{var B;v===u.e.ColorKind&&(v=u.e.ColorInstanceKind),null===(B=this._userThinInstanceBuffersStorage.vertexBuffers[v])||void 0===B||B.dispose(),this._userThinInstanceBuffersStorage.vertexBuffers[v]=new u.e(this.getEngine(),this._userThinInstanceBuffersStorage.data[v],v,!T,!1,this._userThinInstanceBuffersStorage.strides[v],!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[v])}},O.d.prototype._thinInstanceUpdateBufferSize=function(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;v===u.e.ColorKind&&(v=u.e.ColorInstanceKind);const X="matrix"===v;if(!X&&(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.strides[v]))return;const O=X?16:this._userThinInstanceBuffersStorage.strides[v],B=X?this._thinInstanceDataStorage.matrixBufferSize:this._userThinInstanceBuffersStorage.sizes[v];let m=X?this._thinInstanceDataStorage.matrixData:this._userThinInstanceBuffersStorage.data[v];const A=(this._thinInstanceDataStorage.instancesCount+T)*O;let x=B;for(;x<A;)x*=2;if(!m||B!=x){if(m){const v=new Float32Array(x);v.set(m,0),m=v}else m=new Float32Array(x);var f,M,H;if(X){if(null===(f=this._thinInstanceDataStorage.matrixBuffer)||void 0===f||f.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",m,!1),this._thinInstanceDataStorage.matrixData=m,this._thinInstanceDataStorage.matrixBufferSize=x,this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData)null===(M=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===M||M.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",m,!1)}else null===(H=this._userThinInstanceBuffersStorage.vertexBuffers[v])||void 0===H||H.dispose(),this._userThinInstanceBuffersStorage.data[v]=m,this._userThinInstanceBuffersStorage.sizes[v]=x,this._userThinInstanceBuffersStorage.vertexBuffers[v]=new u.e(this.getEngine(),m,v,!0,!1,O,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[v])}},O.d.prototype._thinInstanceInitializeUserStorage=function(){this._userThinInstanceBuffersStorage||(this._userThinInstanceBuffersStorage={data:{},sizes:{},vertexBuffers:{},strides:{}})},O.d.prototype._disposeThinInstanceSpecificData=function(){var v;null!==(v=this._thinInstanceDataStorage)&&void 0!==v&&v.matrixBuffer&&(this._thinInstanceDataStorage.matrixBuffer.dispose(),this._thinInstanceDataStorage.matrixBuffer=null)}},11955:(v,T,X)=>{"use strict";X.d(T,{c:()=>H});var O=X(985),u=X(994),B=X(1156),m=X(1001),A=X(1006),x=X(11928),f=X(1023);const M=A.b.Compose(A.l.One(),A.f.FromEulerAngles(0,Math.PI,0),A.l.Zero());class H extends x.e{get billboardMode(){return this._billboardMode}set billboardMode(v){this._billboardMode!==v&&(this._billboardMode=v,this._cache.useBillboardPosition=0!==(this._billboardMode&H.BILLBOARDMODE_USE_POSITION),this._computeUseBillboardPath())}get preserveParentRotationForBillboard(){return this._preserveParentRotationForBillboard}set preserveParentRotationForBillboard(v){v!==this._preserveParentRotationForBillboard&&(this._preserveParentRotationForBillboard=v,this._computeUseBillboardPath())}_computeUseBillboardPath(){this._cache.useBillboardPath=this._billboardMode!==H.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}get infiniteDistance(){return this._infiniteDistance}set infiniteDistance(v){this._infiniteDistance!==v&&(this._infiniteDistance=v)}constructor(v){let T=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(v,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,!1),this._forward=new A.l(0,0,1),this._up=new A.l(0,1,0),this._right=new A.l(1,0,0),this._position=A.l.Zero(),this._rotation=A.l.Zero(),this._rotationQuaternion=null,this._scaling=A.l.One(),this._transformToBoneReferal=null,this._isAbsoluteSynced=!1,this._billboardMode=H.BILLBOARDMODE_NONE,this._preserveParentRotationForBillboard=!1,this.scalingDeterminant=1,this._infiniteDistance=!1,this.ignoreNonUniformScaling=!1,this.reIntegrateRotationIntoRotationQuaternion=!1,this._poseMatrix=null,this.Tj=A.b.Zero(),this._usePivotMatrix=!1,this._absolutePosition=A.l.Zero(),this._absoluteScaling=A.l.Zero(),this._absoluteRotationQuaternion=A.f.Identity(),this._pivotMatrix=A.b.Identity(),this._postMultiplyPivotMatrix=!1,this._isWorldMatrixFrozen=!1,this._indexInSceneTransformNodesArray=-1,this.onAfterWorldMatrixUpdateObservable=new m.b,this._nonUniformScaling=!1,T&&this.va().addTransformNode(this)}getClassName(){return"nb"}get position(){return this._position}set position(v){this._position=v,this._markAsDirtyInternal()}isUsingPivotMatrix(){return this._usePivotMatrix}isUsingPostMultiplyPivotMatrix(){return this._postMultiplyPivotMatrix}get rotation(){return this._rotation}set rotation(v){this._rotation=v,this._rotationQuaternion=null,this._markAsDirtyInternal()}get Zd(){return this._scaling}set Zd(v){this._scaling=v,this._markAsDirtyInternal()}get rotationQuaternion(){return this._rotationQuaternion}set rotationQuaternion(v){this._rotationQuaternion=v,v&&this._rotation.Td(0),this._markAsDirtyInternal()}_markAsDirtyInternal(){this._isDirty||(this._isDirty=!0,this.customMarkAsDirty&&this.customMarkAsDirty())}get forward(){return A.l.TransformNormalFromFloatsToRef(0,0,this.va().useRightHandedSystem?-1:1,this.getWorldMatrix(),this._forward),this._forward.normalize()}get up(){return A.l.TransformNormalFromFloatsToRef(0,1,0,this.getWorldMatrix(),this._up),this._up.normalize()}get right(){return A.l.TransformNormalFromFloatsToRef(this.va().useRightHandedSystem?-1:1,0,0,this.getWorldMatrix(),this._right),this._right.normalize()}updatePoseMatrix(v){return this._poseMatrix?(this._poseMatrix.p(v),this):(this._poseMatrix=v.clone(),this)}getPoseMatrix(){return this._poseMatrix||(this._poseMatrix=A.b.Identity()),this._poseMatrix}_isSynchronized(){const v=this._cache;return this._billboardMode===v.billboardMode&&this._billboardMode===H.BILLBOARDMODE_NONE&&(!v.pivotMatrixUpdated&&(!this._infiniteDistance&&(!this._position._isDirty&&(!this._scaling._isDirty&&!(this._rotationQuaternion&&this._rotationQuaternion._isDirty||this._rotation._isDirty)))))}_initCache(){super._initCache();const v=this._cache;v.localMatrixUpdated=!1,v.billboardMode=-1,v.infiniteDistance=!1,v.useBillboardPosition=!1,v.useBillboardPath=!1}get absolutePosition(){return this.getAbsolutePosition()}get absoluteScaling(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling}get absoluteRotationQuaternion(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion}setPreTransformMatrix(v){return this.setPivotMatrix(v,!1)}setPivotMatrix(v){let T=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._pivotMatrix.p(v),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=T,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=A.b.Invert(this._pivotMatrix)),this}getPivotMatrix(){return this._pivotMatrix}instantiateHierarchy(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,T=arguments.length>1?arguments[1]:void 0,X=arguments.length>2?arguments[2]:void 0;const O=this.clone("Clone of "+(this.name||this.id),v||this.parent,!0);O&&X&&X(this,O);for(const u of this.getChildTransformNodes(!0))u.instantiateHierarchy(O,T,X);return O}gi(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return v?arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(this._rotation.Td(0),this._rotationQuaternion=this._rotationQuaternion||A.f.Identity(),v.decompose(this._scaling,this._rotationQuaternion,this._position),this.Ke(!0)):(this._worldMatrix=v,this._absolutePosition.Sd(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._afterComputeWorldMatrix()):(this._isWorldMatrixFrozen=!1,this.Ke(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this}unfreezeWorldMatrix(){return this._isWorldMatrixFrozen=!1,this.Ke(!0),this}get wj(){return this._isWorldMatrixFrozen}getAbsolutePosition(){return this.Ke(),this._absolutePosition}setAbsolutePosition(v){if(!v)return this;let T,X,O;if(void 0===v.x){if(arguments.length<3)return this;T=arguments[0],X=arguments[1],O=arguments[2]}else T=v.x,X=v.y,O=v.z;if(this.parent){const v=A.g.Matrix[0];this.parent.getWorldMatrix().invertToRef(v),A.l.TransformCoordinatesFromFloatsToRef(T,X,O,v,this.position)}else this.position.x=T,this.position.y=X,this.position.z=O;return this._absolutePosition.p(v),this}setPositionWithLocalVector(v){return this.Ke(),this.position=A.l.TransformNormal(v,this.Tj),this}getPositionExpressedInLocalSpace(){this.Ke();const v=A.g.Matrix[0];return this.Tj.invertToRef(v),A.l.TransformNormal(this.position,v)}locallyTranslate(v){return this.Ke(!0),this.position=A.l.TransformCoordinates(v,this.Tj),this}lookAt(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const B=H._LookAtVectorCache,m=0===u?this.position:this.getAbsolutePosition();if(v.subtractToRef(m,B),this.setDirection(B,T,X,O),1===u&&this.parent)if(this.rotationQuaternion){const v=A.g.Matrix[0];this.rotationQuaternion.toRotationMatrix(v);const T=A.g.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(T),T.invert(),v.multiplyToRef(T,v),this.rotationQuaternion.fromRotationMatrix(v)}else{const v=A.g.Quaternion[0];A.f.FromEulerVectorToRef(this.rotation,v);const T=A.g.Matrix[0];v.toRotationMatrix(T);const X=A.g.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(X),X.invert(),T.multiplyToRef(X,T),v.fromRotationMatrix(T),v.toEulerAnglesToRef(this.rotation)}return this}Zc(v){const T=A.l.Zero();return this.getDirectionToRef(v,T),T}getDirectionToRef(v,T){return A.l.TransformNormalToRef(v,this.getWorldMatrix(),T),this}setDirection(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const u=-Math.atan2(v.z,v.x)+Math.PI/2,B=Math.sqrt(v.x*v.x+v.z*v.z),m=-Math.atan2(v.y,B);return this.rotationQuaternion?A.f.RotationYawPitchRollToRef(u+T,m+X,O,this.rotationQuaternion):(this.rotation.x=m+X,this.rotation.y=u+T,this.rotation.z=O),this}setPivotPoint(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;0==this.va().getRenderId()&&this.Ke(!0);const X=this.getWorldMatrix();if(1==T){const T=A.g.Matrix[0];X.invertToRef(T),v=A.l.TransformCoordinates(v,T)}return this.setPivotMatrix(A.b.Translation(-v.x,-v.y,-v.z),!0)}getPivotPoint(){const v=A.l.Zero();return this.getPivotPointToRef(v),v}getPivotPointToRef(v){return v.x=-this._pivotMatrix.m[12],v.y=-this._pivotMatrix.m[13],v.z=-this._pivotMatrix.m[14],this}getAbsolutePivotPoint(){const v=A.l.Zero();return this.getAbsolutePivotPointToRef(v),v}getAbsolutePivotPointToRef(v){return this.getPivotPointToRef(v),A.l.TransformCoordinatesToRef(v,this.getWorldMatrix(),v),this}Oe(v){if(this._isDirty)return this;if(this._children)for(const T of this._children)T.Oe(v);return super.Oe(v)}setParent(v){let T=arguments.length>1&&void 0!==arguments[1]&&arguments[1],X=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!v&&!this.parent)return this;const O=A.g.Quaternion[0],u=A.g.Vd[0],B=A.g.Vd[1],m=A.g.Matrix[1];A.b.IdentityToRef(m);const x=A.g.Matrix[0];this.Ke(!0);let f=this.rotationQuaternion;return f||(f=H._TmpRotation,A.f.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,f)),A.b.ComposeToRef(this.Zd,f,this.position,x),this.parent&&x.multiplyToRef(this.parent.Ke(!0),x),v&&(v.Ke(!0).invertToRef(m),x.multiplyToRef(m,x)),x.decompose(B,O,u,T?this:void 0),this.rotationQuaternion?this.rotationQuaternion.p(O):O.toEulerAnglesToRef(this.rotation),this.Zd.p(B),this.position.p(u),this.parent=v,X&&this.setPivotMatrix(A.b.Identity()),this}addChild(v){let T=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return v.setParent(this,T),this}removeChild(v){let T=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return v.setParent(null,T),this}get nonUniformScaling(){return this._nonUniformScaling}_updateNonUniformScalingState(v){return this._nonUniformScaling!==v&&(this._nonUniformScaling=v,!0)}attachToBone(v,T){return this._currentParentWhenAttachingToBone=this.parent,this._transformToBoneReferal=T,this.parent=v,v.getSkeleton().prepare(!0),v.getFinalMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this}detachFromBone(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=v?this._currentParentWhenAttachingToBone:null,this):(v&&(this.parent=this._currentParentWhenAttachingToBone),this)}rotate(v,T,X){let O;if(v.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.Td(0)),X&&0!==X){if(this.parent){const X=this.parent.getWorldMatrix(),O=A.g.Matrix[0];X.invertToRef(O),v=A.l.TransformNormal(v,O),X.determinant()<0&&(T*=-1)}O=A.f.RotationAxisToRef(v,T,H._RotationAxisCache),O.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else O=A.f.RotationAxisToRef(v,T,H._RotationAxisCache),this.rotationQuaternion.multiplyToRef(O,this.rotationQuaternion);return this}rotateAround(v,T,X){T.normalize(),this.rotationQuaternion||(this.rotationQuaternion=A.f.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.Td(0));const O=A.g.Vd[0],u=A.g.Vd[1],B=A.g.Vd[2],m=A.g.Quaternion[0],x=A.g.Matrix[0],f=A.g.Matrix[1],M=A.g.Matrix[2],H=A.g.Matrix[3];return v.subtractToRef(this.position,O),A.b.TranslationToRef(O.x,O.y,O.z,x),A.b.TranslationToRef(-O.x,-O.y,-O.z,f),A.b.RotationAxisToRef(T,X,M),f.multiplyToRef(M,H),H.multiplyToRef(x,H),H.decompose(u,m,B),this.position.addInPlace(B),m.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this}translate(v,T,X){const O=v.scale(T);if(X&&0!==X)this.setAbsolutePosition(this.getAbsolutePosition().add(O));else{const v=this.getPositionExpressedInLocalSpace().add(O);this.setPositionWithLocalVector(v)}return this}addRotation(v,T,X){let O;this.rotationQuaternion?O=this.rotationQuaternion:(O=A.g.Quaternion[1],A.f.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,O));const u=A.g.Quaternion[0];return A.f.RotationYawPitchRollToRef(T,v,X,u),O.multiplyInPlace(u),this.rotationQuaternion||O.toEulerAnglesToRef(this.rotation),this}_getEffectiveParent(){return this.parent}isWorldMatrixCameraDependent(){return this._infiniteDistance&&!this.parent||this._billboardMode!==H.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}Ke(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0],T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;const X=this.va().getRenderId();if(!this._isDirty&&!v&&(this._currentRenderId===X||this.isSynchronized()))return this._currentRenderId=X,this._worldMatrix;T=T||this.va().activeCamera,this._updateCache();const O=this._cache;O.pivotMatrixUpdated=!1,O.billboardMode=this.billboardMode,O.infiniteDistance=this.infiniteDistance,O.parent=this._parentNode,this._currentRenderId=X,this._childUpdateId+=1,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;const u=this._getEffectiveParent(),B=H._TmpScaling;let m,x=this._position;if(this._infiniteDistance&&!this.parent&&T){const v=T.getWorldMatrix(),X=new A.l(v.m[12],v.m[13],v.m[14]);x=H._TmpTranslation,x.Sd(this._position.x+X.x,this._position.y+X.y,this._position.z+X.z)}if(B.Sd(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant),this._rotationQuaternion){if(this._rotationQuaternion._isDirty=!1,m=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion){this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(A.f.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.Sd(0,0,0))}}else m=H._TmpRotation,A.f.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,m);if(this._usePivotMatrix){const v=A.g.Matrix[1];A.b.ScalingToRef(B.x,B.y,B.z,v);const T=A.g.Matrix[0];m.toRotationMatrix(T),this._pivotMatrix.multiplyToRef(v,A.g.Matrix[4]),A.g.Matrix[4].multiplyToRef(T,this.Tj),this._postMultiplyPivotMatrix&&this.Tj.multiplyToRef(this._pivotMatrixInverse,this.Tj),this.Tj.addTranslationFromFloats(x.x,x.y,x.z)}else A.b.ComposeToRef(B,m,x,this.Tj);if(u&&u.getWorldMatrix){if(v&&u.Ke(v),O.useBillboardPath){if(this._transformToBoneReferal){const v=this.parent;v.getSkeleton().prepare(),v.getFinalMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),A.g.Matrix[7])}else A.g.Matrix[7].p(u.getWorldMatrix());const v=A.g.Vd[5],T=A.g.Vd[6],X=A.g.Quaternion[0];A.g.Matrix[7].decompose(T,X,v),A.b.ScalingToRef(T.x,T.y,T.z,A.g.Matrix[7]),A.g.Matrix[7].setTranslation(v),H.BillboardUseParentOrientation&&(this._position.applyRotationQuaternionToRef(X,v),this.Tj.setTranslation(v)),this.Tj.multiplyToRef(A.g.Matrix[7],this._worldMatrix)}else if(this._transformToBoneReferal){const v=this.parent;v.getSkeleton().prepare(),this.Tj.multiplyToRef(v.getFinalMatrix(),A.g.Matrix[6]),A.g.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)}else this.Tj.multiplyToRef(u.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.p(this.Tj);if(O.useBillboardPath&&T&&this.billboardMode&&!O.useBillboardPosition){const v=A.g.Vd[0];if(this._worldMatrix.getTranslationToRef(v),A.g.Matrix[1].p(T.getViewMatrix()),this._scene.useRightHandedSystem&&A.g.Matrix[1].multiplyToRef(M,A.g.Matrix[1]),A.g.Matrix[1].setTranslationFromFloats(0,0,0),A.g.Matrix[1].invertToRef(A.g.Matrix[0]),(this.billboardMode&H.BILLBOARDMODE_ALL)!==H.BILLBOARDMODE_ALL){A.g.Matrix[0].decompose(void 0,A.g.Quaternion[0],void 0);const v=A.g.Vd[1];A.g.Quaternion[0].toEulerAnglesToRef(v),(this.billboardMode&H.BILLBOARDMODE_X)!==H.BILLBOARDMODE_X&&(v.x=0),(this.billboardMode&H.BILLBOARDMODE_Y)!==H.BILLBOARDMODE_Y&&(v.y=0),(this.billboardMode&H.BILLBOARDMODE_Z)!==H.BILLBOARDMODE_Z&&(v.z=0),A.b.RotationYawPitchRollToRef(v.y,v.x,v.z,A.g.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(A.g.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(A.g.Vd[0])}else if(O.useBillboardPath&&T&&O.useBillboardPosition){const v=A.g.Vd[0];this._worldMatrix.getTranslationToRef(v);const X=T.globalPosition;this._worldMatrix.invertToRef(A.g.Matrix[1]);const O=A.g.Vd[1];A.l.TransformCoordinatesToRef(X,A.g.Matrix[1],O),O.normalize();const u=-Math.atan2(O.z,O.x)+Math.PI/2,B=Math.sqrt(O.x*O.x+O.z*O.z),m=-Math.atan2(O.y,B);if(A.f.RotationYawPitchRollToRef(u,m,0,A.g.Quaternion[0]),(this.billboardMode&H.BILLBOARDMODE_ALL)!==H.BILLBOARDMODE_ALL){const v=A.g.Vd[1];A.g.Quaternion[0].toEulerAnglesToRef(v),(this.billboardMode&H.BILLBOARDMODE_X)!==H.BILLBOARDMODE_X&&(v.x=0),(this.billboardMode&H.BILLBOARDMODE_Y)!==H.BILLBOARDMODE_Y&&(v.y=0),(this.billboardMode&H.BILLBOARDMODE_Z)!==H.BILLBOARDMODE_Z&&(v.z=0),A.b.RotationYawPitchRollToRef(v.y,v.x,v.z,A.g.Matrix[0])}else A.b.FromQuaternionToRef(A.g.Quaternion[0],A.g.Matrix[0]);this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(A.g.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(A.g.Vd[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):u&&u._nonUniformScaling?this._updateNonUniformScalingState(u._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.Sd(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=A.b.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix}resetLocalMatrix(){let v=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.Ke(),v){const v=this.getChildren();for(let T=0;T<v.length;++T){const X=v[T];if(X){X.Ke();const v=A.g.Matrix[0];X.Tj.multiplyToRef(this.Tj,v);const T=A.g.Quaternion[0];v.decompose(X.Zd,T,X.position),X.rotationQuaternion?X.rotationQuaternion.p(T):T.toEulerAnglesToRef(X.rotation)}}}this.Zd.Sd(1,1,1),this.position.Sd(0,0,0),this.rotation.Sd(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=A.f.Identity()),this._worldMatrix=A.b.Identity()}_afterComputeWorldMatrix(){}registerAfterWorldMatrixUpdate(v){return this.onAfterWorldMatrixUpdateObservable.add(v),this}unregisterAfterWorldMatrixUpdate(v){return this.onAfterWorldMatrixUpdateObservable.removeCallback(v),this}getPositionInCameraSpace(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return v||(v=this.va().activeCamera),A.l.TransformCoordinates(this.getAbsolutePosition(),v.getViewMatrix())}getDistanceToCamera(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return v||(v=this.va().activeCamera),this.getAbsolutePosition().Xc(v.globalPosition).length()}clone(v,T,X){const O=B.e.Clone((()=>new H(v,this.va())),this);if(O.name=v,O.id=v,T&&(O.parent=T),!X){const T=this.getDescendants(!0);for(let X=0;X<T.length;X++){const u=T[X];u.clone&&u.clone(v+"."+u.name,O)}}return O}serialize(v){const T=B.e.Serialize(this,v);return T.type=this.getClassName(),T.uniqueId=this.uniqueId,this.parent&&this.parent._serializeAsParent(T),T.localMatrix=this.getPivotMatrix().Pd(),T.isEnabled=this.isEnabled(),B.e.AppendSerializedAnimations(this,T),T.ranges=this.serializeAnimationRanges(),T}static Parse(v,T,X){const O=B.e.Parse((()=>new H(v.name,T)),v,T,X);if(v.localMatrix?O.setPreTransformMatrix(A.b.Ld(v.localMatrix)):v.pivotMatrix&&O.setPivotMatrix(A.b.Ld(v.pivotMatrix)),O.Qg(v.isEnabled),O._waitingParsedUniqueId=v.uniqueId,void 0!==v.parentId&&(O._waitingParentId=v.parentId),void 0!==v.parentInstanceIndex&&(O._waitingParentInstanceIndex=v.parentInstanceIndex),v.animations){for(let T=0;T<v.animations.length;T++){const X=v.animations[T],u=(0,f.c)("BABYLON.Animation");u&&O.animations.push(u.Parse(X))}x.e.ParseAnimationRanges(O,v,T)}return v.autoAnimate&&T.beginAnimation(O,v.autoAnimateFrom,v.autoAnimateTo,v.autoAnimateLoop,v.autoAnimateSpeed||1),O}getChildTransformNodes(v,T){const X=[];return this._getDescendants(X,v,(v=>(!T||T(v))&&v instanceof H)),X}dispose(v){let T=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.va().stopAnimation(this),this.va().removeTransformNode(this),this._parentContainer){const v=this._parentContainer.transformNodes.indexOf(this);v>-1&&this._parentContainer.transformNodes.splice(v,1),this._parentContainer=null}if(this.onAfterWorldMatrixUpdateObservable.clear(),v){const v=this.getChildTransformNodes(!0);for(const T of v)T.parent=null,T.Ke(!0)}super.dispose(v,T)}normalizeToUnitCube(){let v=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],T=arguments.length>1&&void 0!==arguments[1]&&arguments[1],X=arguments.length>2?arguments[2]:void 0,O=null,u=null;T&&(this.rotationQuaternion?(u=this.rotationQuaternion.clone(),this.rotationQuaternion.Sd(0,0,0,1)):this.rotation&&(O=this.rotation.clone(),this.rotation.Sd(0,0,0)));const B=this.getHierarchyBoundingVectors(v,X),m=B.max.Xc(B.min),A=Math.max(m.x,m.y,m.z);if(0===A)return this;const x=1/A;return this.Zd.scaleInPlace(x),T&&(this.rotationQuaternion&&u?this.rotationQuaternion.p(u):this.rotation&&O&&this.rotation.p(O)),this}_syncAbsoluteScalingAndRotation(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)}}H.BILLBOARDMODE_NONE=0,H.BILLBOARDMODE_X=1,H.BILLBOARDMODE_Y=2,H.BILLBOARDMODE_Z=4,H.BILLBOARDMODE_ALL=7,H.BILLBOARDMODE_USE_POSITION=128,H.BillboardUseParentOrientation=!1,H._TmpRotation=A.f.Zero(),H._TmpScaling=A.l.Zero(),H._TmpTranslation=A.l.Zero(),H._LookAtVectorCache=new A.l(0,0,0),H._RotationAxisCache=new A.f,(0,O.c)([(0,u.E)("position")],H.prototype,"_position",void 0),(0,O.c)([(0,u.E)("rotation")],H.prototype,"_rotation",void 0),(0,O.c)([(0,u.y)("rotationQuaternion")],H.prototype,"_rotationQuaternion",void 0),(0,O.c)([(0,u.E)("Zd")],H.prototype,"_scaling",void 0),(0,O.c)([(0,u.G)("billboardMode")],H.prototype,"_billboardMode",void 0),(0,O.c)([(0,u.G)()],H.prototype,"scalingDeterminant",void 0),(0,O.c)([(0,u.G)("infiniteDistance")],H.prototype,"_infiniteDistance",void 0),(0,O.c)([(0,u.G)()],H.prototype,"ignoreNonUniformScaling",void 0),(0,O.c)([(0,u.G)()],H.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0)},12543:(v,T,X)=>{"use strict";X.d(T,{d:()=>m});var O=X(978),u=X(10846);let B=0;const m=v=>{if(!v.environmentBRDFTexture){const T=v.useDelayedTextureLoading;v.useDelayedTextureLoading=!1;const X=v._blockEntityCollection;v._blockEntityCollection=!1;const m=O.e.CreateFromBase64String("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR42u29yY5tWXIlZnbuiSaTbZFUkZRKrCKhElASQA0EoQABgn6hJvoXzfUP+gP9hWb6Bg00IgRoQJaKqUxmZmTEe8/v0uB2u7Fm2T7HIyIrnz88uPvt3f2a2WrMbOvf/u3PvvzP/sUf/N6//i8vf/lv/3v5H//d//Sb//Uq/5u8yf8hV/m/5Cp/L1f5hVzlG7nKJ7mKyJuIXN/hPwqXI/g++zq6rPI5u8z+WqfLre+zy7PrVv9L8brsMiGvk8XLmM/sdfHXal4e3ad6GXPdyu2ij8u/+uv/5cuf/OSLfdtEfvUr+dnf/d0X//t3H/7bf/hP//N/928h/0Yg/4VA/kogfyGQP5Wr/IFAvhbIlwK5CGQTPP+9z5uPeePJSW+yo2+s/GtN30Rnv1E+f5zxof9R/lSXv/nr//mrr3+i+5dfyX7ZZQP07Tffys//8R/l/9TtX7790T/7r/8G8pdy+/8XAvnnAvkzgfwzgfyxQP5AIL8vkJ8K5KsmMVzu1U7p5PA5AXxOAJ8TwPf7sX/51ZeXfcemqnp9w/W77/S7X/6T/vzf/7383RWCX3/z05/9i3/13/0PX//eX/2FyP8tIv+PiPy9iPy/IvIzEfm5iPxCRH4lIt/c/393//9BRD6KyKf7f488fP74/PH544dJAF9cLl98IZfLBZtuqterXr/7Dt9982v95S9+Lv+gF/3i7Spv/8lf/vnf/vGf/dF/JfKnIvLnIvLvReQ/NEngn0TklyLy6/v/34jIt00iGJOBlxAsdvv54/PH5493SQCXy9t2ueh2ueimKorrFbjq9eNH+fDtb+TXv/ol/vHyhX4Fxfbx7euPf/Lnf/PfiPyeiPyhiPxxkwB+fk8AvxzQgJcIrGTwFsiAEXH4/PH54/PHUgLY7whgu2C7bLqpQgHB2xvePn6SDx8+6G9+84384vKF/IPu8iVU9Y/+7C/+jWxffiHytYj8VER+X0T+oEEBvxqQwCMJeIngo5EI3goIwVMIPn98/vj8ESaAbbtu2ybbvl8u2ybbdtluSECA65u8ffqIDx8+6G++/VZ/efkV/sO261dQXP7wT/7kX8vl8qXIFyLylbySwe/dE0CLAr65B/9vGn0gQwRMMqgmhM/J4fPH548eAezbZd/lsm3YtssNAYiqiogAAkCvb5/k46cP8u2HD/rrb7+R/2/b9Wu9yJe//8d/9Ney6S5yEZFdRL68/38khG/uKOCnAwoYkcCoEXwkEgGDDq7CeQfyOTl8/vhd1QCum26ybZtu2yabbrKpQvXue1yvuF6v+vbpTT5+/CDffviAX1++1V9sO77WXb/66R/+4V/dgkbllQi+aBLBV/dE8LWRALwkYCWCNyMZXElkwLTMeMkga/P4/PH547ccAVwuctkvdxSw6bbdtYDbTfSZBN7e8PHTR/3u4wf55vKd/nL7DX6mu3791U9//5+/gkNFZGuSgZUQvnKowKgLWLTAQgRtEniTuEfwaELw0MJvf3LQzynud+53uG+X6y3gN9kul+2y6XVT1U27JCDAFVc8ksAn/e7jR/nN5YP+avtWfq6Xy9f7Vz/9w1dgRYngiyYhfNkkgzYBWHTg44AEMmqQUYQKOmDaiCIa8TmsfmzB+DnZDQjgcpGLbti2y3bZHjRAdRMVvb/dcYU8kcDbPQlsH/CrbddfbF98+RPZfvLFnAQeieCRDC5DMvju/vmD4JkEvjRQgKULeGggowdHkAHTYxihg89vu88I5UeGAPSOAFTlrgPopiqbKPSmCKreUoAAkCcSePukHz590m8vH+WbD9/JP335k6/+tA86KxFchv8jMvhiogE4JQm8XhfKqOAqx5qRPyeGzx8/cgSwbXcUoLJtim27C4Oi93+4v6VxQwKAvl2v+Hj9pB8+fZJvt4/yzfbF9lPdv/wJnsE2BogmyeCRED40tGFvksIXiSbgiYSRRpDNDZ6BDI6ghM+J4fPHeyKAO+zX7cb9t4tedMMNAQju5V+f1uAtBSiu1zsduMrHy5t8ePsk3376KN98sX/xE5FPAnm7/782o0DiUINXMkCXCB7/P94/e87AWUmARQWVvgMuKej9t1RLBp+Tw+ePgwngsutFFdu26WXbbl+rSvdfbnqAiuA23QcBgCugV1zl7e1NPm5v+LC96XfbJ/1W9y++fgXjA3bDYXV+MuhRwSPwL3JLMFYC+HS/LU8HYrGwIhwyNOF12SvgM4SgztdifP85MXz+KGsA2C6X7aJ6bXSAOwrY5OYIqGy3d5uq4P5GhABXuV6veLvRAf10fZMPb2/y3b7vX7+g+9v98/WOBq7GG7RNAlYy+Dgkhhb+Xxp0sE8IAC4SGAP/TbgVJK/PoJPBnAiwPKxsXfbbnRg+i3s/JAK4Q/4b9NfLtomBAqCickMBjy7BuywAUVyv8na94tMjCVzf9KNcLl/0SeA6oAEYb1i9g+FtSALb/bKL8/+t+wxXFMyswqiHoK4ToIgKqslgpg1qUC0QoYbvJZg/B/q5v4szHmPX7YEAsD0CX25OwEUVm9xag1+agKg+nxQArnKjAtDr9U0+Xd/k4/UqH7bL5YsewrcBBiMJZPRAp6TwQgWfjM9vgRbgUYGL8AvLWH2gqhesCokeUmCSwPsnhs8fP2YNYMO2XeSmAWxy2VQaXeDmDIhApf33rD4PTUCuV+DtCn27XuXT5ir8VmCJ2G5BpBM8/r/dEcJb8/0lEQMtJHA5TAlqNuLRhJChhEpSqFabH3di+G1AGj+W1/dyAR4IYJNNnuLf6+tWC9CHHiAtFhAIFLjK2/Uqn65X+SS67aK+3QeTDoy/IG2ogQ7fb/dAtz5vBgrYGqrwNtCHsVfgIvwK07OTQBURVNCBFpKCOjqCHn5L/67TgTN+fpySAC56nwSUi256kXsSuFGAVyLoUIDo8/Pz7fdoErr/v17lk162HbgHvFpIYDfoAJJfW4sGPjkU4VNAF8ZEcLmLhdc7kljdY1y1Dq9yLiI4IiRqcLujb138KIPn80ejATwRwIbtBvn1cqv+2J78/5EI5N4cJA8qIPcmwRsKAHDF9WYP6mV7VmrgLuTpxYTcMEW0LAmoQxFsuvAI8tv/a/C5fV2ZMMiKg++FCM7RDPRu8ebWY7VG6VJi+Bzk35MI2LsAckMAgwvQ0gC5DQjd3ABg2HQLAPpEAlZ1Bu7VV7MGHDFRAbo3VKsTbAY9sPWC/uvx86gBbDK3D1eEQS8pbAeSgSwmhepnJb6uBv/o/PzHLzxWA/X7TH77De5j6AGQi6o0CUGfCOD2X7cXAlCFQABtEsGLDtxuOyQB2UTQBKZe5GUPXgkUYCUAbZJRhBDeuq8xBf+bgwbehDm+BFQi2IJksOocvA8ysIMfxluVcRsY/eB3JzH8GFDAXQO48X/dcIf9jyDHptIigDsFkEe066tBSETQUYF7ElDdYEBytN4+rk9UcBPfrKaZqFHWcw3i4J8/X4ev2//bSXqAhwTay6OEIPLD2Ipt8OtAGzxkwLw9WVFRjTc/qC6H3+YK/b1oAA0KuOizHfieCLaHHiAb5NYTIC9EMEbZrVEQt1xwhVy1UfBh8PUOquMizwaap3tQXfY5B//tea/NZdfhsvbz+PURQTDSGWB87VX/7WSd4KxjUqrIgE0IUkoKGnhIvwvawpGf6eECXJ7tv4qbA7DJgwpsKthEmmYgfaAAffYF3HLxo0vwNjJ0SwRWMG4db4eh1gPNm18vQ+us/0eGmxDemu/fnM/X4evq/8342ksGHgLY5LyT/zg0wM8lcMjgGFXwqIOVFJBQw99eCvF9oZL9Mfl3QwAvIXDsBRC9R+fz8x0FPBLB0xJEpwUobrfAkARgIAF41h3wQgP6QAmX5E/7eI43IxGwwf/moIkRyWRJQIPgt9CA9b39nzt4bYUWjAlCjWDPgv8IEjgLJfzuaAsrv9VdVG4OwOXW/fdoA35qAdL0BDwvf6AAUVHd8LIEu94A3K+Q+2YxaB84MOH62P//qoo38fCRDERE2zf0JfmDa+MieElAjcDPKz+mRKCOtdgGtXaBjgNJ4H2owSpNeAW/rRH4CaHSpMwnBYYycjgSJwfie9CR6mPu20Uv8kABF206AvXlBMiIBPSlB9wjBW1fwEuSb94296VCqgMaGCt/G1BbExi3IG+r3a3J6P48Gv/J0YmEYoiGY7V/SxwFCwGoE/xa0AJ0CEiV9QPCJb1OJ5F1VTjEY2/MO9AEJvj1BJTQpqLfTlGwjABuzT962e4IoKnyrdh3+/6mzDVJ4PHOxj0JqGKoy20+wBMN6D1gLWi9NQHfVP5MEEPzjGYy8BMAOnTAJgEr8HUIejRo5xrA5xkR5AngmiSHs+zDDAmMgWzTg55GSJEmHE8IvWPAoYTfhWak/Wn/bQ0CGLSAjv83SUEfKp5q24LXuQICpzrjrgWoza8xVE00CQCORdhMJuTUT/rjuls0gO4Iby8BIEgK6gS7BsGuTtDrScH/fR68biUHNVGBnxjeNyHEvQe/ve3LZQqgG3rof6cEclsNflG9J4KtaQ8WHcVBHS1BtHE4QP9OBMS98mpbKTeDW7dJwRsnHpMBTFJpV4I+b0kY/NqInVFSyBLANbnMSgBM8F+Fqfxq/h657/Up+GaBnwV9hRqc9bZ/vA6vu+T9E8KPJWns94UfTeCj2QXwCHS9dNL8Xf3Ho/rfewSeFODGDV69AU0y6NFAE1DP3qK++rdB7/1HRxf86gT376zOr99T/h/ioBiXWQkgQgVeIrCC/WomhDmQK+hASI2ARQZKooHMLdCJwGEBBXC3+uERwg+VOHZ9ioAt9H80AI06wGgJ3nQA3BoCut6AhxYwgcPOFnxuFnrphk+NIKIGrWPQtgz3b0i7Y6D5rs1GKqTop0nQX52vmQC4BkjA+r4a7Kx9WLENGeegkhSETBCrNXIMdi/444Rw1n6E96ry7OPuj8UfLxtQ78NA2iSBbg7gIiIbdDLsb5agPhLC3RkYKv8NDbS2YGsatNRAG2oQwf9ZIOydgy1MAzBkAw8UwEEIDzSAqdPQ6za0PkeJAMH3Z0wXniUSZoHvBXU2mcjQgv56TedIKglCpIoQfgwCIjOytd8WgN0bfxoR8Fn9Gx0Aj5Zgq0lIZbsH/ibSJoFnS+C98g9ooHEELI3gliy25yONIiE6pb0NfBlyNEYyENoodkKwgl6I6s8kARgJ4ZoEfuYWHLEJa0LhSBXm7kImGeSfVdoJ1DO2G7WXsehAptupSOoyrCSF904k+6vt98X/ZcM98Hsd4JYIXhQAIg3/f9AAUYhsLQKAtkHVBnzjCKhOoYl2ym+iBtvzDzQ2DLXJ4PUmbJHAVnBQX4jkxfvHhNDqAdHXGQJgv0aSDGItgOseHIU+K9hXnIJzkoGlEKzNHagTdJ6VWEUH4iCKH4fd2AwDPaYBm4Wgng4gQ9V/CoGiuNmD04AQtNGMGzSAAQ2I2pzfogY9LRh7BrbOh4+D30sAencljFu2CUFrwY8UAWRfWwGvVOVfbx2uIILM0pwDv082dUTw8hYs8L+uIWiHGpWgClnAa1lMPJogovvvbePPs/q3Xr++kgCsfgB5oQF9WYKPJqEn6G+OE3i5AqouF59FQOmahQC8rlPLj38kg1c2f30vw+XaoIX24/pMGIgSBoZqoH3wo0sIIGlA9PWcCPrAtpPB8eBf6x1o6cHra+2+tpIFP4PgBfxZtZUJfo4qxELT948D9ucK8Mt9+ccjIQw6QJcEbrD/1g340ATuDgDkFfx6twSf1f9xvuBECYxq/7ythQQGm+5JDx6Brw4CkMGT3wgscCUoQ4sU2t6DR2ciBjTgtcpenQoZVX9NuL4Owc+dVaDursYVkVALX+shjSBKBuvCYDUZjE5BdNkxdHAUBexyHwB6NP7Iyw7sxUDViwge1t+mz8B/LAvVx/c3PeBBCToB8IUGOgqA3iV4yUg6UAOxaUFHDx6CYS8SorMOue0CCJGAf5YfRhoAI+A1CvwxqNkAY5yAIx2EQmkFfeWOXi+nEdSQQA0ZHMEItiagJArQxDXIrj8nCfQi4HZPAttrIahso9oPQ/2/JwV5JQU8zw+7I4D7/sBn4EO6rjw0FR+i3Z9fHtahzsFvJgM0X+tmVH5vaYiNDGAigewAz+gyNLThnjCURQFR1b9d3lZvnVqmj9mEPDKIUIC4KCCjBXywS4N+otp/Hk3QVthOkwEKlV9PQwXjT7s/zwF4Qf9toAAzFdjuaEB6S7D1//U5FIQu2MevO0rQQH8ZmoXE6B/IkgE60XCjVoq8gt2iCG0S8L5GdxkM1cGsfsCMArSCAnrr7dzAZxCEEpepvB8tqHJ/q+bmJGGts/AcAXFOMMeTwC7Pw0B6CtCtA2vWgonqBQJFSwH0JQK29OB2kvgj2HHXAoyeAIsCQO0kMNECAhFMqCBf8mElAkyBbX1tJQP2RJ/ha0gpAfS9l+/5n00CkrQpq0MZbOdAuxmMvHswog62jZj7BnYQe19b14kxNq2D/ehX/p68HEcF+x3yP7z/V/A/q/5DA3i5A/dzA5pdgbKp3v3/wQF4Bb70WkCTHGRAA6+KL0bFl6FJaFw0ImZwm6igSwbbwPn9RMBWf3sN2JgA/BVh/Rg0kQBgePf6HglAHLFQwqQQOwDjbdVxNZjR4iM6Qa3WxwvNxh0JFb3g/WzFQQS8b/ttKcDWoABtUMAd8j9hf0MB2uDXhzX4CHj03L9DBU3Qjz0C0l4mLSLQPicOOwZoVCB6P6dA7nDbGkVuxcNr8PU2JQO4wX5trEqmccZaHU4q8oCDFOpzAnOwqyMIMktNNNAHouDGxO37DgArQZzlmp/14W1QlqHTMaIIx7SCx0+5yza7AKJ3IXBrNAHVDcMZAU/BT/vgv/ULPOA+XiLggAREDF2g0ci6xNDRglegd7P7TWWH5oJfayliEg7bScQRBVgI4Ookg/F6rvpLWP29swREqA3CaG8/FpKqS8DTAV4TiBqIqtxfzaQRLys5I0XEFIFrPbZRQb+16Fgi2LvJv8EFUPW1gGfQv1T/F/d/HBnccP7rAwnIIyHI4ArgWeGbU4eHy6Tx/EeTZIb5bo/BsMBjmjBE08f/RB0PHYBd9eVRAGY7cHRwiBf8WeCPHY1bgBTa9xKTELzEkQX9CPtl0gJiqsAmCT7I8xbjivh3JGFI+D2nBcSJQJ8agDX+O9iBL7UfG4bzAkcaICrbtYHz1ycSmGmAjJfL3CMgT3tQpmrfB7gxSzC1DnvdhQMieG47u75+kTouKNkM8c/+vq/Q7ZYjO/hhVvRq8F/9gGfhP8aqE9EIdR6LTwJ1h0BItyDqB8iFwuNqASscRnYioxOg9ApvnYA35f8e9Ohbfe8J4rknoFkO0lmA2gmAG0YK0DkB4ieEjiLoMD8wBzom27ANZkzIoU8EMHk/uo1mzeVoEoRWKn8L/62EYAX/lsB7D/LXg74uAMr9oGivJ0CNJCGD6i9DhZdQF+gtOp4S+NODRzsDVbhdgv4BqTMNyIL9SCKwL9/FGPp5oQKxIf8A/UX6r231H7YIqLML0Ae2GtrADOvRQH5b/MPE9dt9BGLNG8jVTAQvIaK5TtvvvWQgDvyXIClUA78S9Nfg7VtIBlO7cbsEYkQDMot+ygQ7QwmOawTHnAM2XUSnJvPIYRYMmYPS+sv3J+cfP3d04JYIXsF/EwMbBKB9Q9AY+BiSwFj9mzrSXmcJhFPVHySTbgHJCPvRQ/z7G/SVUETsg0ZF+i3CRoCjhf7y1A9mOiDD7TwdwEoEXjLwAv+avLE2B7Jnb+OqDpBoAchoQJskxKnss0vu7Q2YhcDv4ySeLOg9GsCKiUIihP7yfW7zbTsBh0TQfN0iAWn9f72Z56/Ax9P7j5OAH/Qvv3/QxKfk0DgDuP+R3USg3bzBC7bO/QT9Eeh9QvDPG7glBQzJwK740lAFFgFk8P88CqDGAa223YckWYhr+c0BPdwetl2ocnsfzePAWcVnnAIp6gDVhDLyfV4nqFEDPxHsbWD3k4BDkN+pARqKMLYBPzYEvxp9xmCHQQdgWH/9EtH2TIFpu3AH/cdGydv1j0TQbRrq+D/mLcX3ZACZ15bF378CG0My6Kq/zoGOQwhASDFwFbxyNGBuSxbCEhQ/uEPe/6gAERWQObCVVfjPpQX+rexxYhYFxIkgpgX7Y/vPs+Pvxf9vwt8kAs7i32t3QCP+3SPaTwIytQXP38u0PESm+YER+o9B3vr8mETAUfDrEkPI80ck0FZ0dXh9U+HRbhey0cAc2H7A4y4egoD6y8JfkBiigLdFP8v2W00E8deT2IeAKujZ/QAVKpAtKI20gLWksHedfgPcb+0+NEHefd9vB9rayi8h7J91gBbaw20MsnWAF5xHkyDUCOoXp+yrOwwxcKj0aL6fFppaaKDv6OpHR5sgx5BAlK/+fYhuP1D196o8e7lFBaKqv5YIMnFQpd0FGVR35RJCnCDaABaXBtgbiSwtICMtalKC+1JQ6bx/PLcDPQL91QFodQNKpwOgF/9eqcBxBBqRcKAAVk+ArQOMx1RYGgB6naDhlK+uQQwJYx4meQbxtNnYQwMjt/d4f3M9ZE4UOld1LAh99fbfzOxiEkKFCkTJIUIMUeVnJ/9sDt8/e1NEJOi9oVHDGYhgnSLss9DX2IAqw1zALUncKcDr0FB5NP+0cBQNrEezDiyiADPkt9qGpwoPdL0AGPx/NOKeyf3b9WJNdfcFv6bKd2cLMJVfJ6Y3B6wB9WFUfWWEwKMfGiQL+3bz9XGQz2EHKhF41GCtZyDi/gUCsNhYoAr3UNJ58YidHKqnMb/6AB5J4N73/4L+t7mAkeeP3P+1LNSB/l0SkMEd8DcEuUlguEw6t2AU/PCE/q++Akw6QFf1u6SBrj1ZnnhG50AfkoGIdf7gJv1KcSfgzWWkQ9U33Z3tHXYASKJ9e/YhU90rvD+q9Ej69/wxYJVs506Eg/r3DkMDzEdDBRGgcZay49XihLA30P+l8N+hf1f57/0AoxbQbwYaan/rBMirE9Dk+sBzTkC8JNDEUlv5McB8PP19Y01Gayep+hC/2zvQ/2HGLAurowsNGlA1cnqGGzeH5weiYLZm7h3QQC4O2tXdhvMMk1ZS5ebpgI8eMrPvPGkwaxayk8Yc6PMOBPEdC1XZ+2UfbfOPtxLMQQAG9BcZFoF0gp/RKjxe7+oAw9T7ZPWhgedodgz0gf5KBtrtIZhQAZpAV1Bi36w6t98qVfH7hqGI318lLCjLCUFlxRHwqYEH9a2qb4XjWvDT7kBwfbZA5P0+PNuRuW1yf4yNQH3zzwv6b70QOJ0G9OT/dhoYRUGT15uQH/71MjQLtQlxfDuiCXrtM+SkA+icQdH6sU/xz7Ze7FlubV4TpoTQ2osdpaEjtqADmEU7OkBEFoLeC3IWFFeswJXKXzkboNL+wzcFHU8hTGKIboO7CLi1/P+5F+gydQhuvRbwEgxvtACmANikhLTbj0gCYk8KdlYgmj+4Ymaod7TwahwadICuX0Cm2fE5iNHPK0x/CDV66Kyg1MnqjNFBnhBoLQCgUULfaVe5nq/6EQWY67bXCszUb+7232fVPz51iGB12owK9peyP1T4raMFF/OEYJP792mgXYfZ04GHMAhBkCSmSj+dKqRPgVFGHbpLEGMiGFeQWfSgrY52VxaeDUPSNJI0P7NoisG729HHl78z6hxfs9rV3m4JjgM/lsui2qmThjCfDFSb+I9vwUqG5wwL55U7C+6ot8B+7N2o6r3q37T9trfpjgmTvv7PSQATLLeRAOZhIJHBQfDQQJPBdUwEbVW3+L08EcEE/9G4ANrCeWcnPKRHDupbNynMx5AA9IRYLmrc/YLSiD5EaEBS/s/TgnU9ILcH19n+CpHwegLejx7Mn/d25fdN+e9U/1vgb7bqf08MOtf8EXxaoh+GY8L6gDfhvs4i6HQ7seYI2sv1GchdMsBIG3xlvxcCRzdgCPTn+6q/TW00VE8Q9FaFv+R2VlOM1vm/hhjhDCdgNflVKME5B47I9xT8z0YgPAJ8myb/LqHy36j/Mwqw9AALxuO1JVjiuQAYLcFzIhiEPe05fk8tRjGw7yWQbsfuLAT2VqOId1osnr0F49VM8INACPHDoBz4B5mqqSnUgyh3ArjXxfQH5BbgUS8gP7aU+w0zHD9GGD0CGHf+P1p/DeivlhU4BbxR9a2kYFR58YaDZCUR2P0DMmgED2eg77puegy6PgDphEB0CwlG/i9d+/Hs34pBEQrBn0W51mqGnJAk3ACCHeiqkQ1XFQA5AlKH7Lk8yJKWY3/nym14h2C3JvxeMwD9ZVMz0BPMi1n1RbKl1cYhIVblF3G0ATsRiCMUvoK9//OgcwYMoe+ZKOLlC6/Xk50br9NFz9fanqA8UIYSpCwlBO4kHc4WLLBfBHVaKwKgLQjmP4Un61Vq+3s7Bsyi0WztmLjJwJwFeE0I2vD/1Q6MVwefxfUf32skCPbCnxQqf+QMPEUDHZ7vGeyj020JgkPXXwsldA7SYR1RE3h94NvNtugswcgxXEkIcBPCGZ1rmrgDC0A4K88nm2fn/eTnpQtWyZfybRoK8Dro4zYDIMGsf7saTBzvX0SMbkAD6o9CYbsfMK38cJKD9l2FJt9/VGs0h5Gib33pxMKWNsigFUh3G2un+/N1WUglI/EEx8fq27vUNnwsiOoKecL7kQS8VnWAGCFUgn6dBtQhv40CmIYggwK0uwDHRGAuBXVdfwzHUjZzATLMAoyJ4FmBhzaWBlrHld9CCWpPHRqofBqMReMGTJ78q9rDes1Tv7/0m0v0AFHXNR6P6g30SHivin7V1BOhh3iWPwvps/yE836L2XiwnUT8x2iHgfqhnwn667QHEE8oLQjEvtEW7GYBZDrDVkwNIO4G5GiBDf9fGoFM6n+vbEtzXwP6u9AduaWnGYSLAlVdl/AU+ikrSeEIKgwdaZ4AACAASURBVKj4/wtgHcHtdO2nWKcBkPfxcvnNQvsj2Me9f02r76T8q0IBn9OLKfz1HX8yVXQYGoAB/2UeBQ5/5kCL6+H/OGGoRnLSwdd3oH8r7KkGTbgIxEwVWvnF8KOpHnyzfF9Jod5Px+IF1h8owyitDw/XEgRb5bPqbt1uvn7qBIQ16vtS/u+DP3cR7CH0WWJgd5mTJKYgNzoGjQrfvu99NDBC+bnyW1x/qhTatv2OaMKgJWPvv5kwnMgxHYGFRtJW8VMl3uP+MgoqSZyWFKr7+KIDw1d6+IiOgZI4+d5iYL3imzbgyO+tph9t2oSBxOM3ugHtPoFZ1LM0hF4kXNEBssvVgPdjdXZWK7uKvyS3q1Xb1WQwtVDqSUggq+Vw3t56JA2cz7PXOwGNW1ecwxPhfe3QEUsDsFaAz8jg0nf+iZMAHNg/XSazDuC18Iq1HBRrOsAQ8NLB+16g614jmuSgs3bROxE55D+WDDQNA4ivdMJ9M1b309UqknaDU8ObV9/PwmMPATvTMAxpABLBzugUtV9bLdhNDQA+7B9tQJ06/7QNDHGSwtgZOCIA47InIoDdROQGtt0U1HI3GaoUnCnC/rzBMQJteN17+VaAzYNA7e+PFqHQUyXPUYB7iQYa5ZFjq1Zqpx8Uqu/XT7+6BWC1Xaj0GlBIwMoHu7UzcI/6/Acb8KIq+hzmGWmAYnADrIpvKP7TZeLaf0LAeQkGgebbq9FToI44p654F47tekKkI0L5PQNZPsDwPBpy/ni+wKMN76Vav4+2cFZFf8+JwAraMt0DFB7beA/u4Zz/a+RXx0M/ct4/jwaNAS8G17eSwmta0Fhx0VRxJkHMivso+onMXr+YwdWKbgioy1jp4x4AzIKg5lEA7wvHEYCRmdx11TAuT6lDLVl4KvXkAET9P4RT8H2u+lg9EPQIpw+/NpJ7RwE8HaDv/Mu4f3OdNkq/EfAiEiOANjEALvcWL9gfFV4NZbgbQc6qPky4Pm35QZxtH1f4j+P/jXuaYPcWwIEH/fmEPBoAO4m4LGxV3txOQqDU+dXgey+UwSzuqP++uImO/u/6ogCb7wTc1n61sL+vZi87rxnrNas+giTg6QLzaUCjIp6JfhwtGI7AjBBB9JjDY4ePYVR6ZPgN4owVv6Q2N5hhVHwNeYrM+w6dN6K1sMHZm/Ce7bHe3dzKr1xw1w4JrSQMZtgnoQHlr18fzunAszD4qurNUg/TDqzx/lfCaO6t4tACMUQ6P6htWjDPC1hCoZ8kpODzJ70MUR9AODcgwyqyPhmE+wfHYB/hvSqt6qeXUShhXH+d9SR8DzrDaZZdpSp/HxqLMQuATgDU/qDPRgOIeT8cvz/h/XC6BtE7ACLOWPE0KIS4UUjmZaJ2grBphiWgT41BUVWZfP3AnEIT6OrfoF122l2rMycBoU5i/OXoUZ4/aglsXwLzHNU++FVF3qikOj5HXm2PBitT1WuvJRAB+6O//W0/PY8vQH5IrAsMs/WuVmAdHBrQgrbOxJShXwRSsu08h8JMBpo0+aDTALwV4tbswgzHrftG/dJKIAQb5h9KCssWIMeto+GYqG12/HWGjx8kzqNJaa0noMWOr2KwW01AMwJoNvhMQda2/RKQP/3ecABM3g9uD6BY68Ntz9+nDOMb5iV+hIE+dP/Zs/wwJhJ9mgBnohBuStABUXjugF3hkXF9ZZJAjefKdHZCc389LoStKvIl7QIEb1d9RyciQgFDI9Cjyccc/23Aam7/PZJBhgDgin5CtQvbCzX8ip9YgIFtOAt+w0owp/hOiCWgEGbVHuYjRigPGR/YOnEoqPDoV5z5YqB3mRq2ox5ICmSSgAP1Ne+XV2NE+/vuFbCTRADxtS70VRBCjgBk2OyDUQiUgfl77b7DwaHm2rAZ7osRSOOUoHgKfNBSLI767+oDYrfwZvqChSpGfj3pFwZFsCJg2jeIQQBUiyI4WgD68ww4qO8khuWkkIuDrxWv2nv+UTBpJYiPd0KemTA8qqFiuUF1jWS3BoG6pADJq751JqBI0wvAVPyMQvjcX1zbELltKK+zBiXRFiRxG+b7q3M9xuLdzR8g0gCGNzSM5gNYfqGO9CBT8OHct6oB3KsSDBisUnwsFuISQaRHxDSv0vptt2oeLHMERfRn/FG/Cx01EpgIQG8LP+/i37PKw53xn6sYCM4/JwSRrCnIeB1ZkLsawDhaPKv/njU3wnZ/dBdGE8+YTHSG8+ofGgIjsC19YnwdM/KAnTSsqj6ig7uGgIPw3nYFzhhIIvriAxFP9CQd4HSlnzgxONIdrE7A8ZDPx9fjib8ifgegNIliRgdx95+E1T7+3nQVNNhEzDgGA3T2rEDLduwtPpuuouPcs8swwXFjdTaMKt+jA5gUAQPcf95KJQxYU0cYxEDvsBSmYuukp7AwnqniC9Afa5z8vboI68ImT0t26CvwBzSggkj447r9IojvCn7U92J/Hw0QSdwZKNNjxPCfSxRqnATkdwpOwh88oc4J8KTSm/wdbZjrc+4iFP8YO0/5JJDCfaijK5xVXevqfg6zGRrQf83chvX4aRfAE//6vv5+6490U4ADdO7QgM/5bcHP/n4OtCQhBEFeDWSvos8DPq8/IwzLzjpa8/U6MMSkBklDm8e0mn3QIY7XG1Om8wzN48y7HwhOK3P0/ZwUQHHv4psbdoVeb9VlAjChBCdtDDpOKTh9ZfcagOYq31RFjN4/gwBYzp8lAwYNwBELhZoxECeZxMlAzWGdCRV0fQWGHo8+8Kx+AAxnCIzowAxy9KvNepWfsfp4RR9kUrD88CPVTuXRybhqqTHcnxEGndsgub1Gdug8yz9fHt3Hpl57x/mfCOC29FOSQ7/noAZR5W3Ob24UMpuPYAYiQrQgk1gnFoUIKr4vKFpV15pHUJO3Y5rfH3UFHU4bGkU+NKJ9f2hJyOMxDBDpjAgwiYqvk5TqNl9EH2Arb6fA3yaA4cBtPWewhkEcIQJBlGzYp6zRmr1v+e3Fv27xpzvyI44NGDkCIi7CGNV9Dw0M8NtHC2vUwHINumCGNG8erxOwtQINsW88Tlwdoc+F85nI559ngEDpt2F/Uu3hiXYrkN/pBFS26hYDAkFgErMK67y9mGBA3L5ore5izf8b3n805MOq/t7XU4WHv1DUF/5gugCSOAIW/59uMwl6CHWAib8bvfxWl9/rBGEMTTwDfG+ezEYG4yk6FvRPuPwE+wvc39IRjENWM+/cm5b0W4Pf4WuKUnw/vD6eDbB1ETs5vl77Dhnm/51g6wPWwQAqxnivgQaeS3gy/u/1H4hpTPrIgHAN0mSgXUX13YP5PMIuQAfBr/f70cdeE+QoCX3i8nFMLcAjInBoAIYqt1LhC1WdtvmSab28AYffaeivCB+ohdYQgfUa/WS4ToMsNLHLc9nnvPZLwn1/EefPVf+U/xvnCVSEQEkEQEnEQJO7S7RvYDxNeNYKrG7DKMhtsQ8cMmhgPKKKj+F7CiHYFR5KIIPxOmg5IVAtu3ACQSPh7CzUQOgAej5CWEkIe3vgxz0ROGO//qYfz/dnLT+ZxDr4QW0eNCJBorCFOVC312Ec2TiY5Bk0cAaQmiA1VH1MOwDHQ0kHdEDDf+2UTWhS4Z8diQMicLx8MLBfverLcP/jQzF0P8EJj5+NGK9RCz755S6F/f1+X/gxeP+Wsedv+vF8/54aSPJYFjIQd624MDz/UDLQnr8HU3ztKHRf8Qeno1vyAQJBaLcMtTV3cvgP56COCqd/QP9xLgBkH4BxO13n4hNUDtACC6G1S3zqooZ6Ba4lp/zcAFb7iERKQwQcF39IFJjdXECGADw0IE4gg674pYAnk4HoHPx54tD5daO5vxrugSkMjgiiqc7TVKAT6AT8R4ckbHEQCYR/IZBxJgA+XZjsR7vaoRpIxWqeqfXuGC2CxwudicwePEB1kNkaZCuwyF0DuKv/4sz9mzP/Qxdg3BDkBTMC8Q+loD6UGBzx0Kz6eAX/KArOQTlPHFoI4vVtf4rNuLrca9edRn4xBP7k8w+9AgZCgBfEUZWfEs8iFNZ3UO7TqmkjCO/rWdgco/yIqHcQWaC2EGTzgz5y/iXQAvyx3riyxxV/JeBriaGB9OrTA5g9/eokM+37GszqfA/UZk9iW5UnCtBqBl3XoNN6Ag/+zy6A5evPAp+TIFDn15gQw9rjrOzFX0s2JBVAxa/nP1a6AsNWYGjPNGPLTQgBsNUFvOA3Ht9o/rGDN0tWOCcxJGp+f7++kkP7PxcGv1+GjkaLt/fawpwwerQxBJNW4b+PJsYEgiAYYdEAGIlDNaAbRkIgK3ut0jKByp+8yz23X6GttmBmjwDvChgiYLP5V/zhH6/110sGcKo5CkggCngxnIPoPja0j2B+1BRkiYJiviaLJqghDI63G2nAgAxMCuDdnoD0wIQm+urMB3VuAwbBrFGgGgnhAFqg9+ujKsLxB3qGCQNEEtPinIQlAj4WgIw7/iXc9V/x/yUWFs2KH504bAh4aYWf4TrTLGTy9YbftyLeVOWNfYNyt/ji29mQnqMAltU3ioTtbX343yv/1u0YPUBz6zB702tQucnX0gWaFh6DgPdmhXaapGotw0SFz1qDiTMdd8h45HfcqCPRUhA3+NmKz1l9teCPaMd4urGaewRitNBDdahR5c3AfQmDCFT9vmtQEwqAYXX4XI2n23Z9B/Yb1FL+LWox6wHGbZSo6FR1LzyG+3hriSZvWT6jfXhl2cmQZJDrAbuYAqAHo1GA/EOgD8eGcU7A8eDvH4fQBuAhBL/Zp/vamPTrRENDGLTV/7E1WEPLDlP/PwzU4YhusIMUgfIPAr6Dhv5R4y2r8ldFwiFoYHnmr8TAHbhRQSZOctH598ZYhqt6wP7q/ouqe77RJxvzFYaji/z4vna4v5cUMDXqDAJ5ytktqtBDckyjvJg04hl16LB0xFfyMfD77PZjErGQRRjYIfSvoAXntks0ok8MsUC4KARWnYPlJBeIgLeFrUgDOHYCag0/XNAbWgRwQuLAsaQwIhC1g7+jCNKuT38JfnYSyTi+QQEwwHeT4/dWHYxJPxfOj5oAnRQqgU3YgGZSOaDyK3n/qkDYBKptzR3oD6B4fyRKjp2AzSl80YR/3P+/1vBjX18Jbu+YsrMRgbqPP8zrDLTAaupphfeZtyPs9BPztpLSBZjowF3woYRwBwOWaqbev15b7X4RWsiqYiY6ZkFEIoUwUA2OrkeEQE8HYNyD/rl3m88jCGgO/nPW3xy8x4Q/HBcM1dYg5q8N+B/SBSYhtD0EY1PRGLDoKIBHF3yLz4H/gSYQJRETgqeB2d4vC8L2NVnQn4PoVJJAcP0inahAfdXVI8CFszjRagCTtRdV7Sr895NBpRKXIT64RMFw/iw5eChhEvmmyUIH+k+Qu3cLzOAN6ILlFvgWnx3YWFDz0f38ze9GlfP6UQ3ojEY0gtqRIEbA5/WgQFhsEuIeL75uTzvqHktAWfj/OD6sQXssROcGiRgFn0QVkld7OznMDT7CJKzhMIqxW9B+LCOQdH4uyxIcE49VTSeLj0wKjzcp2oDXQA8YoDEGBLMW0BJw+eAxXejPV/IXd59/tp5rVyYXDw5BlRetSpQAcvgfOwVM8ObzBq/AQ2wX4lwkQV3vNhYFfn2LFgaoDU1ogqsfqGkJYmrj9Tr22KQwBLzbLuzDeA9yzyJjVRfwegWq0H+FThDPA6ZhZwX2M2Kh4waovCzAWJTzD/qY00c+6PM8coz08VNqglzx54LfHuTJK7z2rwX35ABLg1DzsZ7Qv7l/f2yXDlbf4C/irg0MJ0aCuD0wP74MrxfdFlX7tq+vtRdCpvt599EG9Yz3V+P+Oj/n4zLruZHcJ7oMt/MNp9eD6HEeFb6/TMfbWo85Pb79HJo8t3371/PuIAZqMvjPC34nVV6ZB4hEuA7AzA5cfU0y2n6ux89D/35/n2/vWY5Bf0qwf3tPLISO1Tap9qzFB6eap/beqI94NCCbGwgqOItY3CGl446CaQ8i2Q9g0AvmgJOnBoAA0gu17tsKtKS7D4udgCYERy2QIceCX/P7mBW+g/7D9S6Mn50CS0eAoQPDcBjopIA5+EcxEjLweRjXq0UbLIjcBxsGx2IZvlf0ATjz/6qypAmY7bhrk4ahsIis6ccXKHdueAfUgk+RWPCLh42c6zEeKyJpRTdRAOqBbl/Wq/uT+q+Fx3FoTIuCzc6+hN8j4veGjuAnhSE5gKnco3A3XwYlq2sq+lmP4yEOpqEoG0M+mGDYuYT0pKCFHgLHKt3T7T9p8GcWH+n1UwGa8X6kQt2x4CeqPexegT6o/Z4Cr313PHdgrsS2ZReLfpKIf+IMFnmVmwxQ9AhithYT73+p2s+JIVfrjwiHnpAZrSsr9CMstQXP1+1+510N/q8E/YoekMN9OMFvi5LvkRDsy9rgFCOoPdpgaQIWBZjf5KCSQszZJ1ivTvLokpen6tsJAVND0NFqb6GUGg2Im4Dyx9Pn7/0dm4pADAslJzTv+dKNrAPQ0wyySm7bj1RQgbAXsRa4R+mBJzpaQmHLmy0BLoL+Nh2ZRca8uUc6P37k97n451fvTieAE8BdZ2ItqFEK6oOJIYPsiU4woo140Oh+H/UC++gatHYcOFT+2y3AYvD1rM/fpxdUcsAi70c0OxAEP45X/hymE9XeoC0zfYhbcqfbhs09HpwnKMDR6g0mmYyKth/UcLl9ITGQ8N1S6s+gA1HvQCc2pluPvN2Br8SyZyfyxPP/VhCi1L1HWX2CQCuAE8TIq/sBYdANZmTIwqq0sb0HIzhhugBeUpBZLFyA8y+EErsBUYDZHYN9QAAooQwOws+uQlhdESSSqk5Qsh8LSYI6LDS1AbmOvLlRBqQIeITvM36+TP63VfE5hFClCTr9zEyVFwS3STQBy66DMHB+PJWIrfgGnYBx2dTboPa2X49GaBVlePA7CFx4iaGi4ns0aLVjMGvtPTDtmO4XEE8E5Kb/8qYai+NHl60LgAICcUCoJPVeiYG6Pxw/X9VFNVbFn9FNPzXoIRDTyzcpREYB5Fm1EQQn3KRi9wKApR8Tz48SwxnV3qM0q7ZhpdKvr0zfY+gO4oQf+EGPFYW/Xf5hwWsUgxiBbShGoGIx+D2eH1h2EeR3UQMH4zMaUKr4033nzkSkfQADelFbLOQCalxdxvN8mInhPas9bxtGJw29Fx3Y8429MAS0fL33Oeo7qFZeiToCC3B/VSNYuU0fgDnkhxGgMFdxiYEY7MYel+OHPH30IMeVFK1C79l+QdXVpFqHlMAXEf3EYDyfkkGdNvJ8f3RAXU0jpgM7jMNA5yCrtfzOicKG/M9bgEkEjqqPPDEcDfqVwGZv6zcO9avDfOhf4OmLFd9OLBHHdxp51HvOBlnAoQksYjASA1xnIhPsapTCPjbsGB2YevpPpgM73EYeSYIftgPgte6CWesVBB9QEgfnWYMgoeC8ql69bWoRIqYHvSIv/u26bj/jdqZ9KSGk74JRo6QS9PuTiSHm6Z62kLUGH0UO4rwWrhtRETkR4iKRdI8giJ2D2nUCMjsA0TXiVDb98NAf/rCMlajA9wesWHZrAe1dlwRyVI2jx4KkyUHSx7YDe6YD4tOC6XW01puEdAJwaEJzf1uATHi6ZlSCpBQscsh6C1xRcWEG4bCFeKcAVhVlDu54JQIkTT21hptIT/Afk0kMcS9BKfjBJozcDXCrtgbWXxbMAw3INQIxtQJPAGwXmYaBbYh4SCsuKwLOAQ5awKskCMmRg8P3xwlBfbosQaDqyZqBkyQe1CLQACoTgN4qbyHsPwkTiF2pYaj6MAXBmUosQHnUEYCsBL3MW39SNKMJ5PfoBsT33DVJCEbFnBCMOkHfvj6Xq8uw+dgRIhGgAiUqf5QgKDFyhe8nnYrlqn9sG1GoAfirubygX4H+8IM1CmQrMFAJ5ExzKIp54nPoVU2Auh6eBShDlTV4u5c4HE/fVvjFrsII0Ik6QX+Iq68jB19ziLoKC27FYe0gC+j1RSS+BgB7AvAM3m8HLdy5fV60C8RMVuhD1ieQB32MCCq0QPJuvuw5IHF/geMKwOPdpmsxBwVEfGEOgeincJqNmuSFIPhPq/xM81CWIIi+gCFBqDX3QPYd2OcCRo6GZBoA3AM+00aesAOQ7/2Pe/vBCXoguD4OBD1WfPwClzcui12AuH+gC0gEwW72KfjBCQRBr05D0IQc7N8PzOCMehPWK384MPVDJQim7yDdoiRTItzzFV/ZOX9sYFetP0fsQzb6O7wOoFjxk89YoQXv+BmSN+yYHYO+BsDRAXHhuJXsEFbdIEGZQWUkNVNzGA9NZUVBIQL7jASR0AclE4Pb7JN3BO72mG92+o8UG3nybj+mASh0FsLKn9GPxDrEcS2Au35BzHO1BksriIJdpqWjKR1wlpR4fN977rZqI+XbYjYDgVDpcYQalOYKMiuQbB3G6Pu/HlMbi9a0EMkksXtjvvXTfgMKAEZRN/i/O7yD8Da2S2Bdh3ICWfp8yuMkYl5a4df4vVWt4UF0yyqEnaT6swYyWB8/j111Y1ERS9oB0SLMtBGDEBD1PEHwtdjUEAHnqmoHU4wCDAoAS+lHwtu9eQLUAgmxVvAuMB9cELMV3m8EUtcBYYI9nkNIEEJYrQeUHfnzzRyC39j8CgSkir/E0P2odnAmAqDnDIhqrtV9BDNS2POjv/0pwKr6z1h/PMz3uf9ykFYq9TtoAXSwpz0HljdvBCVAPY6t7osv6gFhMpkX13rcfXQMIpuTsfTibkfOPRAC2meLRipI4mDPwMD5x+v3+Ey+qEfACwoUEkKQSMZxYJDz9R68PyP43yvo2aYf881rNQbZgRU/jp80QnW/hdXqJxMvCFxXQSNHpE8QiF4XI+wFfQcw7VL2Md7RRajsKgh2D+6SLAKPF356+/7yXYBTUgFy/38StUjFHweD+iiHh8/LV/i/TSvGk4L5x7F6AsIKbgb4C0YjgdGRIToGUx7cgS3JKP8pRcgak95BJGQbjaJdBYQ1qHYnYHL8F45QgHx2gLMQ2cDxBD/4SeR0LSDi5XzPQNjM4ySE/HGG6g+ugltLNSARn281BPtNO72eJLjdX4ITSEgpQvJYFEUg24f1qAYQNQdxx6Q/RcB85j9f+03zf2QV33IDPHegNgPABTfqFR8cZK9TA7/ll0EQbUUHW8Gr1d+MSadia+LRHwhunv87yWoJ3h/pRDwJAbDNQQFd2P2mH4kP/wDT/ZeN3CK3+ZjvgVpw4r20AMafb58j4N1UMknuj6iCx883PU9g2VHVH5JX2eEcPghSgRBCKPzK0Q3fknwPN0Hk0CyC0zBkz//7duEetgFjVtypASDI4CsknYJgYDhqsBxxy29+eyxrAZX75EEf8f+CkOcijMDDHx4ASYGGu8WHgPwpHJc0qOG8FgFTuVk0cRZVePFwHEIUEu8xSHoL5qWg4I7/HgOKXe2dcnu2SSdCGIDTA+AcxY1zYL6Q6AAFu+/1GvjKPSeEoJV3NiM4Dz9C6oWkEav+NWjPWXNOIkKgNTi2I8LeBgaZHJxqrC4oNXoB9pzzMws/OW3ghSyQJgjbygOVEDhoj4nHLld8HPD6UUMFVLIgKrTL7cFoBRLQgEdXIseZ2/HhFPKbk4d5tYWwwR0nIFQSD2P5gQhs6meVfB+Bkyz2fOIvX/zxqsSODuAGIOLtPNnmIPCrv6Kqvgz3q4tCwNl9lWYfnsdHj2HTgQw5IBHwULmfSu1jEV3gDFSxTBmqSEVqiYK2IkWcRiAkwV/cyW9YhqHXDw9dkNQAcO6HFNJT7oChfrPUYc3KY17zAd+evAwF2w5SCKLV4EuCEKsKfjBVWHu9Q9Arh4CoBqEMWYBsNX7YgKP/69uC3M7/mOOz232QT+ox4iCyJGEFP4oBHd+GVvXBwX35nqp7qeIbV6L6tdZub3ueJ+gBIKgC6S5gOQFxDoGr+Bv2nzqbknd7ph/EmXzO0o+kZdc/wqvQkAOUffVMzKtYgx5Vob1/+HAfCdzHSiXHenX35/2JTr3KZ9Ruj2lYiMhLIFoNyMq9hFroeYMTE0bSLbhb4l3YlFPa6hMd2jk8dmrDgdQCnC4/+ANFlYTB6ATlx2GDGXP1rvL+SnWHw+cJes5/rRWt4H2pw9GklD4uSMpwasIQiaYR92gIyFX5S8dtRZt/nCAH48VXW3hRE/HKOsGquj8EM85Q9cfeAV4XwNGAlmIFIwPYrfLKuxV476RRetzcdeAsRSZhiHizCKEIOHn3EMOWy5X4uIJnXX6sFiBFLaBm/THOQAkVJK9j6TKwiSDTBWpwHkSPQJX7U959uAkoaTUuug6oQCBz1Zlxm0OJSIoIw04M+7zCGuYiznCfHww9AN6Ir+HXA7lfn2oBSJ2FOOh8SzINfmcAyITq8JX/sOMPx6A9LeYtVfwgCBZhdu25OB9/XmWWNPUEPD5dUuJ68wd1AqD2+w1PI9KxE9BW5t3z/igdYGWiL7L+wPv9jgVY8f0ZcbCKCuLAHN+c5wa69Zpr0J9t2KnpAGzyiAIPiFalJ8/xXrrA6Y+/8NoDnWCPNwFJzf5DpVkHte8hx76P+HU1+HEytEeSEIzAsu5r6wPJGu6oLz8VrKofXLce+ywIHhNa/Dmw8LrptWXZ4NKZm4pr/QQ7Qk8ehMrPtAF7PQCD309QgRgRZMKgAbFREAfBBXNalbHA9cEHMo4IgIUuPjjBWEUFEQpYTkhVO43eRiynJw9Jjj8TOUIlJExK+0wA4gWgQvcFBHAc7P4/u78/Ff4CC5ATB3P3oUwFClYgcALcxzp/B9Ez4DUV8RjBbsCBrMH4dLNwIDaCGhA6o3pXksdBvYBsktrXDgNJKAFy1Z+ZGIy5NXgXoBT8a3ZgVSPIUAMV6DjLxhsV8wX4n4ibbONObHNyCr8Z4FinNFjg8ziiF5zSV8A99u7Zdf5OisvVaAAAG3VJREFU/kIPAJLWX3hUIFD6o7MD4WkHIMXBk4IftSrPNBJVk0OoC7ice8HGS8XBKDoz/YFBLaQi392lGpCMJfhD9xVkx5Xbj73P9V4m1j0v73x9FjDDPlYvATkgFAVWcdNvJBamliOjAwRV0EpeRymAe717kMYRyy/j5FwFBX0fP7Dyx8gq8wn2ZXi8GfGYR+lFcGJSxa3Y84WgzBHetlU4cvKY44Ps4iP9fsgsPGEhQTAcHqwwGCj61SoPexKwasXFqtxq8qhD9SixoBBYcJEDNzmIoi3J7QkoJActVHocTVpPBCDhElAvMDK1PT/Sq3DwB/ygmyB9GNhYDH4so4Foy48kkPtZfZEv1PQTxYpyX0EI3Bu+/5krcN8fgwVdwWu2JNVNWAk+PcOOPMNdGFyAZ5Aj6gicgzNfwuHZg0HrLxBWfjSRl88fVCo/apX/IBrIvf65ZxtEoK9Bec4KZIPLe76osQns46NwW0pUPCPAyMc4A/KXOwZzFLGbAqD5xhhbgBcWfoJBAlarcCSQgdQJ+Movnih4gjZQTw51rz588y/ZgxVUEAQ8soCfX8OR26JwujCLGFAMsOjnwGrlPuQw9D/PPv8BYVR7pG/eeFtQpsLzR2KFI8SwKj9KlX++HeLOPuSBKrKeHBi7L4b+Kx184+ptAp4Trcscv69oARVYzWgaK01H1X0K3zNSmARKtxXYHvwJuT+8gLGGWgpHcWOmBeljFB2Ckg6wiAYOqfxEK3GMCAj6kIiTWdCBCXhkjUKMgJcLk271N9uLSbtvvK0S69OXAvoA5z94VsFubbmZvx4QAnXgBnJxENyQjy38wef81uPhxMpPJIQzr5ckuUTKe0wZyN57iFTWga8GvCwlh5UqvYgmaNV9XSxEVWs40kkosFwA70RgNOu8mLZfR6wDiwRa35y7j08NksqPQhcfkRBK/J8R75Iz+9C8gJpqzwiIeZII3QnYOkJWbVEI5jNuA+o2BwK82ifwnpSgHwaC+GNAdmW2VXfC+vPu6wR6lBj84C9WfvivZyUhZMJlJhjSukDlFJ3g4AvGJfC1iEpQJ/CaEd7G9wds7p71+odruKrHip/C7RdsxeVjzIxhoNkFGOW/+sk/YVAGtltfzZAIfzix8gcHhZCXpcGN2u69qWqD9OlRFAy7x2fQBhHUiETB+DocqvArYt98f+AEAXApsEmEcNLC0t2uPHCqPQIXwHYDfI4/9+8LMpchqr5HK39MJSrBXwnutNqjovjHFdq+fcHLp7YLR4mGgduW5hFpAXUoL4cTTuW5HJSkB5PC0S7A+8c+837DyoM1J9iv/po/o3BunlDqPjOSO/YbLFd+FGy9sxKFeT8b+nLNPrkAyD53FtT27yUS32yqUaEGTMBiASGcZ0FmK8nWxbvjC1q6WQC4VdWdAcBY8eFoAzIrC0b7Wt8wlPcIdE1FhUWeKU1Igv8Q/0dl4k/NnYSxdlDon8diUDeuQB4c8XVzcahRgyyZmNC+LAgeCfSVALde8/t1DCYawNoePGT83wlOpFUdOZKwxn89OsMEf0X8CxJCBN/dwKbFwkSMgx0ACJJDJD4iC1JEYh6XcEqVHpx4+J4I4UiAl26r5x64sttvSlAn3LBuQCz6edU8C+J5epBrC4YP52EFDgHrCw1B0eU9bOaTgh3wmYvQV3Oqqcf53XnVNXUBELX1xtSgFrirlII5d3HFulxBCNEfZx0h7K2f34XwdHpuYQcguN189Ow/nPXclaUcqMH5leCXjKOjbv3F0a7i2ZaRHmBe5zwnhA9S736ZC8AH8LHkg/T5znYgmES1dtuzGo92qwHIquiWX+4KgVLd8utv9Ml1BQNhEJW/FOgweiTguCUoQHkEwYhjfQIgm8eAzPKzHqAG5xGiiPyxeGRRaYetUpDVpHVC1T9bHGyaknb/TQTnuG7rDYwYCUT7/cMjtILzA+Go/FPw581F/mWeTkDuBsBCAK8ki+A29nMzPn4Rzjv6QV7xWW4fzQFUxb9jQQ1qc28kMi4mDl1NBr4usIsz5ltZqNm7AeJXfuTHd7nioLEyPBISU+8/tP1AC4Il/n+YGmjg2NiBRdl6yCw//zG5ph7bqaBuz8B4VMU/TqSsNPbwCeZA1cdxyG9SgKzRZPL+GXFOiH1/SFZ9wX8M3zUgvH8a4rMBjZj/h1W9MrwTiN6MlsCKiI4gycBzgV/xUaQGjGDHwHiYi0VIzeEAasCpNuL76AC7BIEl7i4AIxnAfoMxk35eJbZ68wWEUChs8IPz/EEE9BkUoNA4RCWSLJkY1h0Y/dG9bVCtUVPe7QRhtStXG4nOECDfUxc4Uw/Ik8JkA9o9+a83IrfHH11EdFUWc4phNgVFWkPsIHBnCvCCYBSgqEN9qtoXuwHhByYoJJA7BxIkkRwpDGgAHo+vQ3ZGOwCFJCJKUAx4MBpFZWvReeLgtBBkDDQu2OJxXa7SE/P4ZiUPHABjY1DsFIhPAaygWewiXK72hHjow/k8gCL6gKES8qcDZ7A+EhYlWCPGCX1wXIwzkQEKt8cP6iqkC0FEhFj/ZYtvXCtwuBLcDT5wXN+9H6ZEIkTwV/x/s78fXFX3siWHEKrC3tw7EFZ31Ll7ttknQyEMGgAqCaVe1bGk8r8nFWCQQR0h7CY0dsU/mIeIuA1AGCo02Q0YVXxub36sG1Qgfo0CBBUXxap+ECFEycQVyViBEBFPt14TK9rZHB9EwMG7DPXOv0OVHkdtx7OSCXfb3av4CFZGTwQBwT7/hKPHE4PzpJ4L4+FM9r1n8B+B+9R9I4Fu9brYUZgCunZWNxdQgIs8mASBQ4F8hJpEiaf4GPihk8FdAxin/kybjZjTj+mAQy6ihZ9whDvHAWB6BKrBXQr+5SBfqPaINwiz12UIwoTmbPACZY/fshBBBKNlW8ZCHwH/cVKSOZMm4Mxk4OwE9JeB+EFkn1IzcPQoiSB4vGgNeJSoik1A7m0TCmE/HrggB+/1M12C1Z18ACGoIeH1pH2IhAqFWgBq+kDFEWAvA3X8tpW0cnSD5WAOriOHhnYraF1eLTkS8P/QsHUBdtMPnOrMaANJE9AZiaKWII5Ue/8PTHn/UcCSTgIF2xN4zdmAQYIAKeBFl6FiO0aKfq5jcImHfPwTxcEdRmD3LcFoAva1Hdjm9UgGggI9YOoPkOBYLsT8HlG3nucMDGkOOJ8CkNOELdSO7D5qqAeJYBb2GpABgRi2gxLITgrOQ9C937HgB+0i7MeRx3gfPWCXLtgbLJAu/gCFBPzRX8eADJqCvA3FViC/BlOQC4LZyrBq8BdQAOUKoKjqR7v7EFfVFMojPgEoSlJesNIePyLHwW9NRgq7E6HvUN8A0yj0wyWDHRZ3J2A1jHdMyu3hCGwSDwdRir7h9VP7AKLgPoMCgKziOFLtrUm8aIFHlgxYfz8WBYUU55iAXauo+evJaIK/NTgRJM9sUcZRzcCnMdNKMJc7usnAyrpxHYkTRHK+n1HxS01LheAHqRWwKIDqLvQC0+PupHZgBawfVGsiniTVHwZHRqbUI/D4Cd+ftgyLAR1ehkIiqaKFw7MJEwUIuK5zsu4svoFYCFKgBJZACBuppOId2RDkPZas8H9kULcA9a0KTCQDGtpnzT+RMJiOGseHl4BQ1C29AWUXIIf/OIwwqoNEK3SCuA7FRiBrE9B4/PcrGJ1OQNj83F4Xbol/TgVHfMiIZLAdcaVkgh8sLrd+liNQH/FqsNTfj15m1J0X+ffZuq/gTY7QnvIfJz6UzBJLs83ItQpt3RfZz5iuGfNPajpngUm0R8DoA5jDlzsOTAwZjzsC3Jjxg7H914PjlcskGdghgx9HG4OOQH34uwQyzz61/0qiYNQjXxECuWYbGM/DrjtPH/Mw/K+gBLLSA+cEfPr4MroArzcDuybbr8Zc72i2UnzeHnTgzD4Ug78SzIvCoARVOQxaFFR3TzWnkkHUVFShEuqKxZnKz4p4YYcf8ZhYhuu8wFgSHcuuwCJagI4bgchJQK/qe9c/RT6nGcg6KGREJpb+MI0EY/b0jcsni3AJBeCQNsBOFVYoApcM2Aom4VFgIRdHpeIG8D3YaxBD+qCiQ+rBOSVnci8hzkAG1t/pgHA4uwDzmu8xFKkkkIqCfkIRs204r/hiDgutoAAcowBMZ9+KS0CcXVBOHCvJw2jMQSJyeoeExF2DuTuRcuWAo9sefyUQ6/oBaIjPtiRH1KvQKvygAHb171d+vc4GRMDPoxN/kL5pwlVh1mBQ1quQJAJ5j0TgOAis+h8d3mnC8xTKE34+8sDNjyVXE6nFMN+H39TQDmocHScENvN74LoGScGU4f7g6IG3n3C3qnG6JBS+Z5tHOOzRYQx+u7MZmAl0OSsRLAS/VIKfRAWU92+12aaVPksGDBWQuCMvgNy2M2Mt8EwqbjosZAec5xLEAmXmcFTHiOWARWglpNpjdEtBQRxJJU5VL5/7F1X86XntXgUK4q+KggsUoIIK8oA+kgy4+zLaACqQGTVOX6MBWdehL6BxHn+tlyBMDGAqufd7WOX5WTJwKYDfXJJP2GXDPk7Tj5Ed7BOG7DMFaBRAJgI/+H2Ngeb2SKb0zkoGlQBHkefDr7xMA5HZeJPtKIzyApI9gmnPgf1c3mulfhe0gFekDCdNFnrOwi4Gs6eTACNjB+Uegcgojog4V25P8bctRYY6RL8AJklE9ACFAGZdBEahd4d4CmghFhbzcwaXYH5qTlS6DY+KfNH5Avzjo2JJ0poDkSCMxLn73H/eB+ifvgvyIFCWAji7BWC8hd0qj0FziMdrS70BlVbgamIgcmotGZDNPwm0L9l5iHv7WRoAFx57ScFS2r2iwot8oKu8l+TOCOg2mZ2nFdjTgOFQENzKkJ8OjEnsE8f6AzyXwT6MNF3RDRnuj0Lwo6wTlBMDIyqaz6G+RiLJMg/KUrQV/rh9uH0tWduwoxmky0kSMQ+rnXxZsGadgnxfgk1pCnsIsGYltvfdzTOBIclIsN8MLAGcz5gBwj94AE8DuC9Molip/JGwB57nRyJiyD3pyk6q5ij+3TzRLohcqyqCEQBTepF15+WVmW8SEr5jMUUkx3oMIsrH3ndwAQganKzyMpOJNxMQooGBYwcByw7axIhgPRGEr6GSGJhkAELoQ1YRg+dPeD5IIRDIqq5PA2Jh0Rq0YcS8XBi0ghGRFpCtWTdum5+yLOsQf2EuYY8AfnbQZDgCjHxBSKwTGpt8QCIDVH3/4H5OwEvldhliINwAFLsEyyIfGKV+vm3eEehVqKTdNxtDiPoLHCRiuwTJxCECxMDqDjTvZ63KaPKvRgV2i/F3ohm88V8LN8hgJcXD5pVGIPPNn9EBqSQC0I4AMxBUcQNCkarkFgSn/oCs9GCVep4eUG5BRAOcQOCWlGSc3If0IFqRfURQGRrKewPKEJ9sLnIowKCcw+f48N6UHjqYtgInaCCkBbPSj8VEkCr2g8U43wY1xX/BNkwreQrzg+oaJghOCGTU8RBxuIp6VFOGoEXgEsBLIgV6gBgxoLSI5CgiYNT+GBHsU01GthrceiMUtv9KgAYktgVNeGrBbtiOQVi9x8WjiAW7UNUnm4Vet7WtsFgDCDYEwQ/EVL1PnQf/xCDLTowTh4c4HPRDoQaiwhKIAae4B7xgCBydI/CDPOrevK0FR4p6w3VfoXgQiB3T1N8Y1PCD0X19JqcHGfzB5WkQE4p/kdeXBcEVUXEIFqSij82lMyrWq/7c+LFHA7z5/dwOHHg8s/Y8C2CmhbmALtare+4UWLfb25BmXABKABTniC8gRAP2yvDAiUAsElnrxFzITQa/sAFecAOY7zPV/8jMQHSbWAiUPGkQNABhw85xrSCv+mMSzFR8+7mjw01A8f4F8S/td4jnDHYxpT8/OEyV3gz2+GTfdAeAszswfJNGlQhEIjB0Bls0BKn4Iw7WKu9f1gmSagmvqleEwJwnZwjO7npz1HdCJ1hS/mlBcRXyF3i/M7NxqJFoeH27z7nnJaBmpUZKHsTbGUc1ALEoIGsGYl9ixS50gjAT/VhB8IzvGTrBVfWEz1MzAkRFTtecW731VdjNQPukVdhdn0Y8d/a7WYH6i/TBPBzUFwAlHwtGHOQISrgb1AMUgDETTA3+THAdeRJhg59V/Ektofa9I8wxVICkC7QQSAd2O3cftzPzdMK6aA4iZI4ILfYRbb9RgqICt2AxVnYZ4kkBvHOBxT/zN9ybHx/f5Ql2fkGCX6ANm6F8WCfqAS+Eq5AGcHJd2IFHagTMHAAj+mWBnDXuc81CjhsAi5dL2K8QCYI1aJ/PJtSSxEFXASv7C2I3ZB9/a0j/7nDn/j1pHsz9Jr8fNpxPBUAUUYD4wz5GBlmyAiORjtAIGDFwzSUwqiNZ1d1tPiB7/Q9VeI9KeJU16/knkEeQJEALjY4rkp74fCZiMDSA/PgvT/aT2gYgp5E/P29AKBQAo6TRth5T4VesQFb0i4K7RA2MZpgyFXCEQHCOixuYMPgy2L7+45ezSSKt2oUkURlpXkEMOLSiXPuDQZjk63N5bmzOSxQdLHX7AhwUEA0BAeQPJIQzkAuFlOK/GtyLdiGDKEBdllQ7YouxV2Xdwza9So4Kp5Z0yAgUhTlJgFzSFrznIHYIwKcCu2/L3LsCg6UI1b1/CA+ApIV5/32HqOIjdQusE4azip5Wc1b0q/QGIAlaWEJbXP3r/L+AEipw/+BtkQVY9fIM2i/ZhgVEgJO6DZ1ksVtlYdoQAPhVO0oKmYBmnAYco4DRCRB3TwCziptaE0auER9/VzRqKNOEYINOQg2m1l9GpGNQAhh1v6UmxNQh2M4+LmlUzll0OTjYQOaGlZAEMCrdhmBphaMBwBADrSQQc3//He8KgFETT7p6BHnjj2X9EXsDjrgBS6ihoAmcSQVYmE4JgYWFpp1waAQRoqDzxDhU+HxSnZHz/9JEY6Y5MJA+cwoWrt99+U3Mc/9g/NQTFaigAEtwB1yBzwzucZSX7RZEILhR1d5GDCsBLVUdIQvsldZfEJt5i/MHx2hGJZFkVVyK242iFeh58oBUFqIQbkfp2DV2X0CkAYgv1sU+P+I/HmBu8nErugdRnUWhfp+A/ddlbEH3uQlBsNobUEMHasK1HOYn8BEEvCUaiuigXRIKj+sGOPA4KAWz9/s7WxcgB4+a6/fI2osEwv4yOENAiPf+wQhbc/5f0gGisWuQaRFmGoIqguARWsBQgTTocDLMT5OJUQnhqdCEig+/EShKSEgTVV0MBMnz04BcshPnLk/+OaV0/dwKzB4QUt1NB6uTDfGOP+cNm9mEsBAFiM7AQh9AKVEU75vy68jeOxrUC4mDEuYO0oLqoSdHaEF2eXYYSm0V+oEOwpLmYFOF3Z4CmAeBTIGueiIw2xoKPzDBJVBXQ5g5O8/twwA+QguIjJt3+g0NQEcDfUXgO5gsqlTBLkQLdl86K3CWneitQ8sg/5oWAUJP2C3V3RoEyji5n4b9lB4t9pz2CA+cAFn1Z9I/uzYsU/ELtEBOCHYQQqGcFejV+yeuRJX31zsKV5IGjway9z6PLDxKwNEPsBuOEiqw57jGgOtZ1Y++T50AuMFl7hPIbhskiOwsATtRoc7rS7dXrpcgrMCGJca6ELJo+Y0be0BW5ZKGcFz4y8W9BduwcDnK9iO5fagsKpp9ANnvDPxeP8THNyIVFo1AMas8Qk5v2Ytm0LCCYAXqn+wQsPTBh/5Bcnne14Os3uCQt28vsK1WUESJFviBgAW//3u9PLxusXchcCR2WsNzv/ImvgZzzkUByDUAIrjTvmSHAowpJBQE4SUlxMxnARlQbIqkArVAJ6pBBvELCCKlkyCDAP45BYfEPfcUpfMch3Vn4bheYK4E66BxAxHSVd5INgEPgU/NBCDfNQ8Ho1CoINAPQAW/QT8OCIZlNFCB84XhoDChFByHGjx35v9BLgyhmojqHYb5QYXnuAecvua0hZe6BV9f7v4ibvgvamrmAc1TmaEir0LQ9h97eYAYVoM/nWA60i8Q3Ifezha9BqaaL3zvqd6IAuwwLSCCuCLuJWch4h30giPtyiAphKEBcCu9BV5wwzkMxID8rhMwdwMhcSFgrBT3RUTQboAUg3+p+Qe1IGarOioVnazmefV3lHpwA0AcLWCahUiXwePHWJsP+GH1gnp/we5KfOhJAbsj0H/BIEb04TbrTPsAyb2LLu93KwfCvn5PLAwrOXAa72eEQRo1CNdw5IprsAZ3hApy9zlcITG2vpCihsRSYxNS+J4vdBZ6B52eqRcQ/QXmSjAWSfa/5GA5qEg4iJFtm624AqXLrSA2gx8p1Mdqcghv41S0lSp/xAYs9gakQc4Ie2RTUYwYgt748mV+FU1Xgp14eW3XYZ6cdqGTNHwHICTwEeTPl0jEZwIgP9gDEaogeg5IHWCF+1eoAhvEKPB/EAeTRsM/pSAP5wjWEUMM1/NJRhwJbpJSgK7S7zF3EOsI5jBQBK9DV80Z8Y0COzvmWzJXgDl40KEC6cqvqgi4OB5cpgLFYK/1CvDiItXqC6/S87wfAUfPtxqfGNzlYaOjlf1IsHPPvffHgDAoEeEST4ZLZUd/RSo91/BjXY5ggWgQ4In3fyj4mUqPrInHOCLKO3wUwRsfyXpt1nEIRLrqcWeTuk7bigsbid1zD4iDRQtnIdQsyIXnFCn1I9D7ADgxEhOvR5AJosoUbu1FkJyYCi9OhQERoIx+4AX/YqUXQhtYEwKN4Cy1HntLMmtaAQpqfrT/UCoLSxeswjA5UWPPi0mjajUWxMTdVusNvt/ChMdmILK5IRMFu90BMEzFYHdg2GAgeYVHMMJIBTA7EFTx/5fpgTFXz9w/en0ZjD8kCDoKPNGwlB01BmoWQbh+AxR689mBponGJOr9OwmMu3dtJ/ylW1Tik4ElUPmR9RqII+pVhD9ychABMQ51gOIZg+/G+5mGIzLB1JJC5WhzYjhJ7IWmLDpA8jzsAafUPkB2WnFBF4iSxkq1ty7f25rv/+EQLOxs2oUdTSA9HIR9swdBlCcFe9owPC3XWDDC0ISVzsEVbSCF/sWdA5Fu4HJqankp2SeQCYYrImNalfmhpVxYrGkUS4LeSUjg8dD7+D7w/ybIfy7vlB9/HJ978zr7/45Qgajzj+4EjIK/ULHPRAOlKr/aG0AFcqCyu0GcW45Igh6JMJmhA49/U+cEssHNJhtXDC1MOya3j/sAiAGcrEtqtgjBD6wEzSDc7D8o6C8rIqAZyPk+NQoNLAZ1hR64Yl1FBY648smUYKnSg1Xwk/0DyRyArByMUobyByhCcPnOaPyoegREFS4jNfYAw+IHCjdC1J2WDZBke/OyN85J24WiXwDYPoJyYuCD238ulvuzwt6KgHf0shWKsqCFFGjB/w8HU8eeTED9wAAAAABJRU5ErkJggg==","EnvironmentBRDFTexture"+B++,v,!0,!1,O.e.BILINEAR_SAMPLINGMODE);v._blockEntityCollection=X;const A=v.getEngine().getLoadedTexturesCache(),x=A.indexOf(m.getInternalTexture());-1!==x&&A.splice(x,1),m.isRGBD=!0,m.wrapU=O.e.CLAMP_ADDRESSMODE,m.wrapV=O.e.CLAMP_ADDRESSMODE,v.environmentBRDFTexture=m,v.useDelayedTextureLoading=T,u.c.ExpandRGBDTexture(m);const f=v.getEngine().onContextRestoredObservable.add((()=>{m.isRGBD=!0;const T=v.onBeforeRenderObservable.add((()=>{m.isReady()&&(v.onBeforeRenderObservable.remove(T),u.c.ExpandRGBDTexture(m))}))}));v.ae.add((()=>{v.getEngine().onContextRestoredObservable.remove(f)}))}return v.environmentBRDFTexture}},11916:(v,T,X)=>{"use strict";function O(v,T,X){try{const O=v.next();O.done?T(O):O.value?O.value.then((()=>{O.value=void 0,T(O)}),X):T(O)}catch(O){X(O)}}function u(){let v,T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:25;return(X,u,B)=>{const m=performance.now();void 0===v||m-v>T?(v=m,setTimeout((()=>{O(X,u,B)}),0)):O(X,u,B)}}function B(v,T,X,O,u){const B=()=>{let m;const A=v=>{v.done?X(v.value):void 0===m?m=!0:B()};do{m=void 0,u&&u.aborted?O(new Error("Aborted")):T(v,A,O),void 0===m&&(m=!1)}while(m)};B()}function m(v,T){let X;return B(v,O,(v=>X=v),(v=>{throw v}),T),X}function A(v,T,X){return new Promise(((O,u)=>{B(v,T,O,u,X)}))}function x(v,T){return function(){return m(v(...arguments),T)}}X.d(T,{e:()=>u,h:()=>x,i:()=>A,l:()=>m})},10878:(v,T,X)=>{"use strict";X.d(T,{e:()=>u});class O{constructor(v){this._pendingActions=new Array,this._workerInfos=v.map((v=>({workerPromise:Promise.resolve(v),idle:!0})))}dispose(){for(const v of this._workerInfos)v.workerPromise.then((v=>{v.terminate()}));this._workerInfos.length=0,this._pendingActions.length=0}push(v){this._executeOnIdleWorker(v)||this._pendingActions.push(v)}_executeOnIdleWorker(v){for(const T of this._workerInfos)if(T.idle)return this._execute(T,v),!0;return!1}_execute(v,T){v.idle=!1,v.workerPromise.then((X=>{T(X,(()=>{const T=this._pendingActions.shift();T?this._execute(v,T):v.idle=!0}))}))}}class u extends O{constructor(v,T){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:u.DefaultOptions;super([]),this._maxWorkers=v,this._createWorkerAsync=T,this._options=X}push(v){if(!this._executeOnIdleWorker(v))if(this._workerInfos.length<this._maxWorkers){const T={workerPromise:this._createWorkerAsync(),idle:!1};this._workerInfos.push(T),this._execute(T,v)}else this._pendingActions.push(v)}_execute(v,T){v.timeoutId&&(clearTimeout(v.timeoutId),delete v.timeoutId),super._execute(v,((X,O)=>{T(X,(()=>{O(),v.idle&&(v.timeoutId=setTimeout((()=>{v.workerPromise.then((v=>{v.terminate()}));const T=this._workerInfos.indexOf(v);-1!==T&&this._workerInfos.splice(T,1)}),this._options.idleTimeElapsedBeforeRelease))}))}))}}u.DefaultOptions={idleTimeElapsedBeforeRelease:1e3}},12086:(v,T,X)=>{"use strict";X.d(T,{d:()=>kv});var O=X(1006),u=X(1403);class B extends u.c{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var m=X(1170),A=(X(1465),X(1023));class x{get noiseTexture(){return this._noiseTexture}set noiseTexture(v){this._noiseTexture!==v&&(this._noiseTexture=v,this._reset())}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(v){this._isAnimationSheetEnabled!=v&&(this._isAnimationSheetEnabled=v,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(v){this._useLogarithmicDepth=v&&this.va().getEngine().getCaps().fragmentDepthSupported}va(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:O.l.Zero()}set direction1(v){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=v)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:O.l.Zero()}set direction2(v){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=v)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:O.l.Zero()}set minEmitBox(v){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=v)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:O.l.Zero()}set maxEmitBox(v){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=v)}get billboardMode(){return this._billboardMode}set billboardMode(v){this._billboardMode!==v&&(this._billboardMode=v,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(v){this._isBillboardBased!==v&&(this._isBillboardBased=v,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(v){this._attachImageProcessingConfiguration(v)}_attachImageProcessingConfiguration(v){v!==this._imageProcessingConfiguration&&(!v&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=v)}_reset(){}_removeGradientAndTexture(v,T,X){if(!T)return this;let O=0;for(const u of T){if(u.gradient===v){T.splice(O,1);break}O++}return X&&X.dispose(),this}constructor(v){this.animations=[],this.renderingGroupId=0,this.k=O.l.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this.targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new O.l(10,10,10),this.onAnimationEnd=null,this.blendMode=x.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new O.i(0,0),this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.Eg=new O.l(0,0,0),this._useLogarithmicDepth=!1,this.gravity=O.l.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new m.g(1,1,1,1),this.color2=new m.g(1,1,1,1),this.colorDead=new m.g(0,0,0,1),this.textureMask=new m.g(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new B,this.id=v,this.name=v}createPointEmitter(v,T){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new O.l(0,1,0),arguments.length>2&&void 0!==arguments[2]||new O.l(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new O.l(0,1,0),arguments.length>4&&void 0!==arguments[4]||new O.l(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new O.l(0,1,0),arguments.length>3&&void 0!==arguments[3]||new O.l(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(v,T,X,O){throw new Error("Method not implemented.")}}x.BLENDMODE_ONEONE=0,x.BLENDMODE_STANDARD=1,x.BLENDMODE_ADD=2,x.BLENDMODE_MULTIPLY=3,x.BLENDMODE_MULTIPLYADD=4,(0,A.f)("BABYLON.BaseParticleSystem",x);var f=X(1040),M=X(1223);class H{constructor(){this.direction1=new O.l(0,1,0),this.direction2=new O.l(0,1,0),this.minEmitBox=new O.l(-.5,-.5,-.5),this.maxEmitBox=new O.l(.5,.5,.5)}startDirectionFunction(v,T,X,u){const B=(0,f.p)(this.direction1.x,this.direction2.x),m=(0,f.p)(this.direction1.y,this.direction2.y),A=(0,f.p)(this.direction1.z,this.direction2.z);if(u)return T.x=B,T.y=m,void(T.z=A);O.l.TransformNormalFromFloatsToRef(B,m,A,v,T)}startPositionFunction(v,T,X,u){const B=(0,f.p)(this.minEmitBox.x,this.maxEmitBox.x),m=(0,f.p)(this.minEmitBox.y,this.maxEmitBox.y),A=(0,f.p)(this.minEmitBox.z,this.maxEmitBox.z);if(u)return T.x=B,T.y=m,void(T.z=A);O.l.TransformCoordinatesFromFloatsToRef(B,m,A,v,T)}clone(){const v=new H;return M.d.DeepCopy(this,v),v}applyToShader(v){v.setVector3("direction1",this.direction1),v.setVector3("direction2",this.direction2),v.setVector3("minEmitBox",this.minEmitBox),v.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(v){v.addUniform("direction1",3),v.addUniform("direction2",3),v.addUniform("minEmitBox",3),v.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const v={};return v.type=this.getClassName(),v.direction1=this.direction1.Pd(),v.direction2=this.direction2.Pd(),v.minEmitBox=this.minEmitBox.Pd(),v.maxEmitBox=this.maxEmitBox.Pd(),v}parse(v){O.l.FromArrayToRef(v.direction1,0,this.direction1),O.l.FromArrayToRef(v.direction2,0,this.direction2),O.l.FromArrayToRef(v.minEmitBox,0,this.minEmitBox),O.l.FromArrayToRef(v.maxEmitBox,0,this.maxEmitBox)}}class n{get i(){return this._radius}set i(v){this._radius=v,this._buildHeight()}get angle(){return this._angle}set angle(v){this._angle=v,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=X,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=T,this.i=v}startDirectionFunction(v,T,X,u){u?O.g.Vd[0].p(X.Lg).normalize():X.position.subtractToRef(v.getTranslation(),O.g.Vd[0]).normalize();const B=(0,f.p)(0,this.directionRandomizer),m=(0,f.p)(0,this.directionRandomizer),A=(0,f.p)(0,this.directionRandomizer);T.x=O.g.Vd[0].x+B,T.y=O.g.Vd[0].y+m,T.z=O.g.Vd[0].z+A,T.normalize()}startPositionFunction(v,T,X,u){const B=(0,f.p)(0,2*Math.PI);let m;this.emitFromSpawnPointOnly?m=1e-4:(m=(0,f.p)(0,this.heightRange),m=1-m*m);let A=this._radius-(0,f.p)(0,this._radius*this.radiusRange);A*=m;const x=A*Math.sin(B),M=A*Math.cos(B),H=m*this._height;if(u)return T.x=x,T.y=H,void(T.z=M);O.l.TransformCoordinatesFromFloatsToRef(x,H,M,v,T)}clone(){const v=new n(this._radius,this._angle,this.directionRandomizer);return M.d.DeepCopy(this,v),v}applyToShader(v){v.setFloat2("i",this._radius,this.radiusRange),v.setFloat("coneAngle",this._angle),v.setFloat2("height",this._height,this.heightRange),v.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(v){v.addUniform("i",2),v.addUniform("coneAngle",1),v.addUniform("height",2),v.addUniform("directionRandomizer",1)}getEffectDefines(){let v="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(v+="\n#define CONEEMITTERSPAWNPOINT"),v}getClassName(){return"ConeParticleEmitter"}serialize(){const v={};return v.type=this.getClassName(),v.i=this._radius,v.angle=this._angle,v.directionRandomizer=this.directionRandomizer,v.radiusRange=this.radiusRange,v.heightRange=this.heightRange,v.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,v}parse(v){this.i=v.i,this.angle=v.angle,this.directionRandomizer=v.directionRandomizer,this.radiusRange=void 0!==v.radiusRange?v.radiusRange:1,this.heightRange=void 0!==v.radiusRange?v.heightRange:1,this.emitFromSpawnPointOnly=void 0!==v.emitFromSpawnPointOnly&&v.emitFromSpawnPointOnly}}class V extends n{constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new O.l(0,1,0),u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new O.l(0,1,0);super(v,T),this.direction1=X,this.direction2=u}startDirectionFunction(v,T){const X=(0,f.p)(this.direction1.x,this.direction2.x),u=(0,f.p)(this.direction1.y,this.direction2.y),B=(0,f.p)(this.direction1.z,this.direction2.z);O.l.TransformNormalFromFloatsToRef(X,u,B,v,T)}clone(){const v=new V(this.i,this.angle,this.direction1,this.direction2);return M.d.DeepCopy(this,v),v}applyToShader(v){v.setFloat("i",this.i),v.setFloat("radiusRange",this.radiusRange),v.setVector3("direction1",this.direction1),v.setVector3("direction2",this.direction2)}buildUniformLayout(v){v.addUniform("i",1),v.addUniform("radiusRange",1),v.addUniform("direction1",3),v.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const v=super.serialize();return v.direction1=this.direction1.Pd(),v.direction2=this.direction2.Pd(),v}parse(v){super.parse(v),this.direction1.p(v.direction1),this.direction2.p(v.direction2)}}class D{constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.i=v,this.height=T,this.radiusRange=X,this.directionRandomizer=u,this._tempVector=O.l.Zero()}startDirectionFunction(v,T,X,u,B){X.position.subtractToRef(v.getTranslation(),this._tempVector),this._tempVector.normalize(),O.l.TransformNormalToRef(this._tempVector,B,this._tempVector);const m=(0,f.p)(-this.directionRandomizer/2,this.directionRandomizer/2);let A=Math.atan2(this._tempVector.x,this._tempVector.z);A+=(0,f.p)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=m,this._tempVector.x=Math.sin(A),this._tempVector.z=Math.cos(A),this._tempVector.normalize(),u?T.p(this._tempVector):O.l.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,v,T)}startPositionFunction(v,T,X,u){const B=(0,f.p)(-this.height/2,this.height/2),m=(0,f.p)(0,2*Math.PI),A=(0,f.p)((1-this.radiusRange)*(1-this.radiusRange),1),x=Math.sqrt(A)*this.i,M=x*Math.cos(m),H=x*Math.sin(m);u?T.Sd(M,B,H):O.l.TransformCoordinatesFromFloatsToRef(M,B,H,v,T)}clone(){const v=new D(this.i,this.directionRandomizer);return M.d.DeepCopy(this,v),v}applyToShader(v){v.setFloat("i",this.i),v.setFloat("height",this.height),v.setFloat("radiusRange",this.radiusRange),v.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(v){v.addUniform("i",1),v.addUniform("height",1),v.addUniform("radiusRange",1),v.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const v={};return v.type=this.getClassName(),v.i=this.i,v.height=this.height,v.radiusRange=this.radiusRange,v.directionRandomizer=this.directionRandomizer,v}parse(v){this.i=v.i,this.height=v.height,this.radiusRange=v.radiusRange,this.directionRandomizer=v.directionRandomizer}}class s extends D{constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new O.l(0,1,0),B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new O.l(0,1,0);super(v,T,X),this.direction1=u,this.direction2=B}startDirectionFunction(v,T,X,u){const B=(0,f.p)(this.direction1.x,this.direction2.x),m=(0,f.p)(this.direction1.y,this.direction2.y),A=(0,f.p)(this.direction1.z,this.direction2.z);u?T.Sd(B,m,A):O.l.TransformNormalFromFloatsToRef(B,m,A,v,T)}clone(){const v=new s(this.i,this.height,this.radiusRange,this.direction1,this.direction2);return M.d.DeepCopy(this,v),v}applyToShader(v){v.setFloat("i",this.i),v.setFloat("height",this.height),v.setFloat("radiusRange",this.radiusRange),v.setVector3("direction1",this.direction1),v.setVector3("direction2",this.direction2)}buildUniformLayout(v){v.addUniform("i",1),v.addUniform("height",1),v.addUniform("radiusRange",1),v.addUniform("direction1",3),v.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const v=super.serialize();return v.direction1=this.direction1.Pd(),v.direction2=this.direction2.Pd(),v}parse(v){super.parse(v),O.l.FromArrayToRef(v.direction1,0,this.direction1),O.l.FromArrayToRef(v.direction2,0,this.direction2)}}class F{constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.i=v,this.radiusRange=T,this.directionRandomizer=X}startDirectionFunction(v,T,X,u){const B=X.position.Xc(v.getTranslation()).normalize(),m=(0,f.p)(0,this.directionRandomizer),A=(0,f.p)(0,this.directionRandomizer),x=(0,f.p)(0,this.directionRandomizer);B.x+=m,B.y+=A,B.z+=x,B.normalize(),u?T.p(B):O.l.TransformNormalFromFloatsToRef(B.x,B.y,B.z,v,T)}startPositionFunction(v,T,X,u){const B=this.i-(0,f.p)(0,this.i*this.radiusRange),m=(0,f.p)(0,1),A=(0,f.p)(0,2*Math.PI),x=Math.acos(2*m-1),M=B*Math.cos(A)*Math.sin(x),H=B*Math.cos(x),n=B*Math.sin(A)*Math.sin(x);u?T.Sd(M,Math.abs(H),n):O.l.TransformCoordinatesFromFloatsToRef(M,Math.abs(H),n,v,T)}clone(){const v=new F(this.i,this.directionRandomizer);return M.d.DeepCopy(this,v),v}applyToShader(v){v.setFloat("i",this.i),v.setFloat("radiusRange",this.radiusRange),v.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(v){v.addUniform("i",1),v.addUniform("radiusRange",1),v.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const v={};return v.type=this.getClassName(),v.i=this.i,v.radiusRange=this.radiusRange,v.directionRandomizer=this.directionRandomizer,v}parse(v){this.i=v.i,this.radiusRange=v.radiusRange,this.directionRandomizer=v.directionRandomizer}}class k{constructor(){this.direction1=new O.l(0,1,0),this.direction2=new O.l(0,1,0)}startDirectionFunction(v,T,X,u){const B=(0,f.p)(this.direction1.x,this.direction2.x),m=(0,f.p)(this.direction1.y,this.direction2.y),A=(0,f.p)(this.direction1.z,this.direction2.z);u?T.Sd(B,m,A):O.l.TransformNormalFromFloatsToRef(B,m,A,v,T)}startPositionFunction(v,T,X,u){u?T.Sd(0,0,0):O.l.TransformCoordinatesFromFloatsToRef(0,0,0,v,T)}clone(){const v=new k;return M.d.DeepCopy(this,v),v}applyToShader(v){v.setVector3("direction1",this.direction1),v.setVector3("direction2",this.direction2)}buildUniformLayout(v){v.addUniform("direction1",3),v.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const v={};return v.type=this.getClassName(),v.direction1=this.direction1.Pd(),v.direction2=this.direction2.Pd(),v}parse(v){O.l.FromArrayToRef(v.direction1,0,this.direction1),O.l.FromArrayToRef(v.direction2,0,this.direction2)}}class b{constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.i=v,this.radiusRange=T,this.directionRandomizer=X}startDirectionFunction(v,T,X,u){const B=X.position.Xc(v.getTranslation()).normalize(),m=(0,f.p)(0,this.directionRandomizer),A=(0,f.p)(0,this.directionRandomizer),x=(0,f.p)(0,this.directionRandomizer);B.x+=m,B.y+=A,B.z+=x,B.normalize(),u?T.p(B):O.l.TransformNormalFromFloatsToRef(B.x,B.y,B.z,v,T)}startPositionFunction(v,T,X,u){const B=this.i-(0,f.p)(0,this.i*this.radiusRange),m=(0,f.p)(0,1),A=(0,f.p)(0,2*Math.PI),x=Math.acos(2*m-1),M=B*Math.cos(A)*Math.sin(x),H=B*Math.cos(x),n=B*Math.sin(A)*Math.sin(x);u?T.Sd(M,H,n):O.l.TransformCoordinatesFromFloatsToRef(M,H,n,v,T)}clone(){const v=new b(this.i,this.directionRandomizer);return M.d.DeepCopy(this,v),v}applyToShader(v){v.setFloat("i",this.i),v.setFloat("radiusRange",this.radiusRange),v.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(v){v.addUniform("i",1),v.addUniform("radiusRange",1),v.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const v={};return v.type=this.getClassName(),v.i=this.i,v.radiusRange=this.radiusRange,v.directionRandomizer=this.directionRandomizer,v}parse(v){this.i=v.i,this.radiusRange=v.radiusRange,this.directionRandomizer=v.directionRandomizer}}class l extends b{constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new O.l(0,1,0),X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new O.l(0,1,0);super(v),this.direction1=T,this.direction2=X}startDirectionFunction(v,T){const X=(0,f.p)(this.direction1.x,this.direction2.x),u=(0,f.p)(this.direction1.y,this.direction2.y),B=(0,f.p)(this.direction1.z,this.direction2.z);O.l.TransformNormalFromFloatsToRef(X,u,B,v,T)}clone(){const v=new l(this.i,this.direction1,this.direction2);return M.d.DeepCopy(this,v),v}applyToShader(v){v.setFloat("i",this.i),v.setFloat("radiusRange",this.radiusRange),v.setVector3("direction1",this.direction1),v.setVector3("direction2",this.direction2)}buildUniformLayout(v){v.addUniform("i",1),v.addUniform("radiusRange",1),v.addUniform("direction1",3),v.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const v=super.serialize();return v.direction1=this.direction1.Pd(),v.direction2=this.direction2.Pd(),v}parse(v){super.parse(v),this.direction1.p(v.direction1),this.direction2.p(v.direction2)}}class Q{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{}}startDirectionFunction(v,T,X,u){const B=O.g.Vd[0];if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,X,B);const v=O.g.Vd[1];B.subtractToRef(X.position,v),v.scaleToRef(1/X.lifeTime,B)}else B.set(0,0,0);u?T.p(B):O.l.TransformNormalToRef(B,v,T)}startPositionFunction(v,T,X,u){const B=O.g.Vd[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,X,B):B.set(0,0,0),u?T.p(B):O.l.TransformCoordinatesToRef(B,v,T)}clone(){const v=new Q;return M.d.DeepCopy(this,v),v}applyToShader(v){}buildUniformLayout(v){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const v={};return v.type=this.getClassName(),v.particlePositionGenerator=this.particlePositionGenerator,v.particleDestinationGenerator=this.particleDestinationGenerator,v}parse(v){v.particlePositionGenerator&&(this.particlePositionGenerator=v.particlePositionGenerator),v.particleDestinationGenerator&&(this.particleDestinationGenerator=v.particleDestinationGenerator)}}var K=X(1261);class p{get mesh(){return this.af}set mesh(v){this.af!==v&&(this.af=v,v?(this._indices=v.Qe(),this._positions=v.getVerticesData(K.e.PositionKind),this._normals=v.getVerticesData(K.e.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=O.l.Zero(),this.af=null,this.direction1=new O.l(0,1,0),this.direction2=new O.l(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=v}startDirectionFunction(v,T,X,u){if(this.useMeshNormalsForDirection&&this._normals)return void O.l.TransformNormalToRef(this._storedNormal,v,T);const B=(0,f.p)(this.direction1.x,this.direction2.x),m=(0,f.p)(this.direction1.y,this.direction2.y),A=(0,f.p)(this.direction1.z,this.direction2.z);u?T.Sd(B,m,A):O.l.TransformNormalFromFloatsToRef(B,m,A,v,T)}startPositionFunction(v,T,X,u){if(!this._indices||!this._positions)return;const B=3*Math.random()*(this._indices.length/3)|0,m=Math.random(),A=Math.random()*(1-m),x=1-m-A,f=this._indices[B],M=this._indices[B+1],H=this._indices[B+2],n=O.g.Vd[0],V=O.g.Vd[1],D=O.g.Vd[2],s=O.g.Vd[3];O.l.FromArrayToRef(this._positions,3*f,n),O.l.FromArrayToRef(this._positions,3*M,V),O.l.FromArrayToRef(this._positions,3*H,D),s.x=m*n.x+A*V.x+x*D.x,s.y=m*n.y+A*V.y+x*D.y,s.z=m*n.z+A*V.z+x*D.z,u?T.Sd(s.x,s.y,s.z):O.l.TransformCoordinatesFromFloatsToRef(s.x,s.y,s.z,v,T),this.useMeshNormalsForDirection&&this._normals&&(O.l.FromArrayToRef(this._normals,3*f,n),O.l.FromArrayToRef(this._normals,3*M,V),O.l.FromArrayToRef(this._normals,3*H,D),this._storedNormal.x=m*n.x+A*V.x+x*D.x,this._storedNormal.y=m*n.y+A*V.y+x*D.y,this._storedNormal.z=m*n.z+A*V.z+x*D.z)}clone(){const v=new p(this.mesh);return M.d.DeepCopy(this,v),v}applyToShader(v){v.setVector3("direction1",this.direction1),v.setVector3("direction2",this.direction2)}buildUniformLayout(v){v.addUniform("direction1",3),v.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var v;const T={};return T.type=this.getClassName(),T.direction1=this.direction1.Pd(),T.direction2=this.direction2.Pd(),T.meshId=null===(v=this.mesh)||void 0===v?void 0:v.id,T.useMeshNormalsForDirection=this.useMeshNormalsForDirection,T}parse(v,T){O.l.FromArrayToRef(v.direction1,0,this.direction1),O.l.FromArrayToRef(v.direction2,0,this.direction2),v.meshId&&T&&(this.mesh=T.getLastMeshById(v.meshId)),this.useMeshNormalsForDirection=v.useMeshNormalsForDirection}}var G=X(1115);class L{_isUbo(v){return void 0!==v.addUniform}constructor(v){this._isUbo(v)?(this.setMatrix3x3=v.updateMatrix3x3.bind(v),this.setMatrix2x2=v.updateMatrix2x2.bind(v),this.setFloat=v.updateFloat.bind(v),this.setFloat2=v.updateFloat2.bind(v),this.setFloat3=v.updateFloat3.bind(v),this.setFloat4=v.updateFloat4.bind(v),this.setFloatArray=v.updateFloatArray.bind(v),this.setArray=v.updateArray.bind(v),this.setIntArray=v.updateIntArray.bind(v),this.setMatrix=v.ne.bind(v),this.setMatrices=v.updateMatrices.bind(v),this.setVector3=v.updateVector3.bind(v),this.setVector4=v.updateVector4.bind(v),this.setColor3=v.updateColor3.bind(v),this.setColor4=v.updateColor4.bind(v),this.setDirectColor4=v.updateDirectColor4.bind(v),this.setInt=v.updateInt.bind(v),this.setInt2=v.updateInt2.bind(v),this.setInt3=v.updateInt3.bind(v),this.setInt4=v.updateInt4.bind(v)):(this.setMatrix3x3=v.setMatrix3x3.bind(v),this.setMatrix2x2=v.setMatrix2x2.bind(v),this.setFloat=v.setFloat.bind(v),this.setFloat2=v.setFloat2.bind(v),this.setFloat3=v.setFloat3.bind(v),this.setFloat4=v.setFloat4.bind(v),this.setFloatArray=v.setFloatArray.bind(v),this.setArray=v.setArray.bind(v),this.setIntArray=v.setIntArray.bind(v),this.setMatrix=v.setMatrix.bind(v),this.setMatrices=v.setMatrices.bind(v),this.setVector3=v.setVector3.bind(v),this.setVector4=v.setVector4.bind(v),this.setColor3=v.setColor3.bind(v),this.setColor4=v.setColor4.bind(v),this.setDirectColor4=v.setDirectColor4.bind(v),this.setInt=v.setInt.bind(v),this.setInt2=v.setInt2.bind(v),this.setInt3=v.setInt3.bind(v),this.setInt4=v.setInt4.bind(v))}}var r=X(1120);const o="gpuUpdateParticlesPixelShader",Z="#version 300 es\nvoid main() {discard;}\n";r.e.ShadersStore[o]=Z;const U="gpuUpdateParticlesVertexShader",J="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";r.e.ShadersStore[U]=J;(0,A.f)("BABYLON.WebGL2ParticleSystem",class{constructor(v,T){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=v,this._engine=T,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","i","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var v;return(null===(v=this._updateEffect)||void 0===v?void 0:v.isReady())??!1}createUpdateBuffer(v){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof Q&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=v,this._updateEffect=new G.e("gpuUpdateParticles",this._updateEffectOptions,this._engine),new L(this._updateEffect)}createVertexBuffers(v,T){this._updateVAO.push(this._createUpdateVAO(v)),this._renderVAO.push(this._engine.recordVertexArrayObject(T,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=T}createParticleBuffer(v){return v}bindDrawBuffers(v,T,X){X?this._engine.bindBuffers(this._renderVertexBuffers,X,T):this._engine.bindVertexArrayObject(this._renderVAO[v],null)}preUpdateParticleBuffer(){const v=this._engine;if(this._engine.enableEffect(this._updateEffect),!v.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(v,T,X){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[v],null);const O=this._engine;O.bindTransformFeedbackBuffer(T.getBuffer()),O.setRasterizerState(!1),O.beginTransformFeedback(!0),O.drawArraysType(3,0,X),O.endTransformFeedback(),O.setRasterizerState(!0),O.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let v=0;v<this._updateVAO.length;v++)this._engine.releaseVertexArrayObject(this._updateVAO[v]);this._updateVAO.length=0;for(let v=0;v<this._renderVAO.length;v++)this._engine.releaseVertexArrayObject(this._renderVAO[v]);this._renderVAO.length=0}_createUpdateVAO(v){const T={};T.position=v.createVertexBuffer("position",0,3);let X=3;T.age=v.createVertexBuffer("age",X,1),X+=1,T.size=v.createVertexBuffer("size",X,3),X+=3,T.life=v.createVertexBuffer("life",X,1),X+=1,T.seed=v.createVertexBuffer("seed",X,4),X+=4,T.direction=v.createVertexBuffer("direction",X,3),X+=3,this._parent.particleEmitterType instanceof Q&&(T.initialPosition=v.createVertexBuffer("initialPosition",X,3),X+=3),this._parent._colorGradientsTexture||(T.color=v.createVertexBuffer("color",X,4),X+=4),this._parent._isBillboardBased||(T.initialDirection=v.createVertexBuffer("initialDirection",X,3),X+=3),this._parent.noiseTexture&&(T.noiseCoordinates1=v.createVertexBuffer("noiseCoordinates1",X,3),X+=3,T.noiseCoordinates2=v.createVertexBuffer("noiseCoordinates2",X,3),X+=3),this._parent._angularSpeedGradientsTexture?(T.angle=v.createVertexBuffer("angle",X,1),X+=1):(T.angle=v.createVertexBuffer("angle",X,2),X+=2),this._parent._isAnimationSheetEnabled&&(T.cellIndex=v.createVertexBuffer("cellIndex",X,1),X+=1,this._parent.spriteRandomStartCell&&(T.cellStartOffset=v.createVertexBuffer("cellStartOffset",X,1),X+=1));const O=this._engine.recordVertexArrayObject(T,null,this._updateEffect);return this._engine.bindArrayBuffer(null),O}});class y{constructor(v,T){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,O=arguments.length>3?arguments[3]:void 0;this._engine=v,this._label=O,this._engine._storageBuffers.push(this),this._create(T,X)}_create(v,T){this._bufferSize=v,this._creationFlags=T,this._buffer=this._engine.createStorageBuffer(v,T,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(v,T,X){this._buffer&&this._engine.updateStorageBuffer(this._buffer,v,T,X)}read(v,T,X,O){return this._engine.readFromStorageBuffer(this._buffer,v,T,X,O)}dispose(){const v=this._engine._storageBuffers,T=v.indexOf(this);-1!==T&&(v[T]=v[v.length-1],v.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var P=X(985),a=X(994),E=X(1156),i=X(978),t=X(1331),C=X(1103),c=X(1145),N=X(1319);class d{constructor(){this._gpuTimeInFrameId=-1,this.counter=new N.d}_addDuration(v,T){v<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==v?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(T,!1),this._gpuTimeInFrameId=v):this.counter.addCount(T,!1))}}class I{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(v,T,X){let O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=v,this._engine=T,this.uniqueId=t.e.UniqueId,T.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new d),this._engine.getCaps().supportComputeShaders?O.bindingsMapping?(this._context=T.createComputeContext(),this._shaderPath=X,this._options={bindingsMapping:{},defines:[],...O}):C.d.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):C.d.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(v,T){let X=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const O=this._bindings[v];this._bindings[v]={type:X?0:4,object:T,indexInGroupEntries:null===O||void 0===O?void 0:O.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!O||O.object!==T||O.type!==this._bindings[v].type)}setStorageTexture(v,T){const X=this._bindings[v];this._contextIsDirty||(this._contextIsDirty=!X||X.object!==T),this._bindings[v]={type:1,object:T,indexInGroupEntries:null===X||void 0===X?void 0:X.indexInGroupEntries}}setExternalTexture(v,T){const X=this._bindings[v];this._contextIsDirty||(this._contextIsDirty=!X||X.object!==T),this._bindings[v]={type:6,object:T,indexInGroupEntries:null===X||void 0===X?void 0:X.indexInGroupEntries}}setVideoTexture(v,T){return!!T.externalTexture&&(this.setExternalTexture(v,T.externalTexture),!0)}setUniformBuffer(v,T){const X=this._bindings[v];this._contextIsDirty||(this._contextIsDirty=!X||X.object!==T),this._bindings[v]={type:I._BufferIsDataBuffer(T)?7:2,object:T,indexInGroupEntries:null===X||void 0===X?void 0:X.indexInGroupEntries}}setStorageBuffer(v,T){const X=this._bindings[v];this._contextIsDirty||(this._contextIsDirty=!X||X.object!==T),this._bindings[v]={type:I._BufferIsDataBuffer(T)?7:3,object:T,indexInGroupEntries:null===X||void 0===X?void 0:X.indexInGroupEntries}}setTextureSampler(v,T){const X=this._bindings[v];this._contextIsDirty||(this._contextIsDirty=!X||!T.compareSampler(X.object)),this._bindings[v]={type:5,object:T,indexInGroupEntries:null===X||void 0===X?void 0:X.indexInGroupEntries}}isReady(){let v=this._effect;for(const u in this._bindings){const v=this._bindings[u],T=v.type,X=v.object;switch(T){case 0:case 4:case 1:if(!X.isReady())return!1;break;case 6:if(!X.isReady())return!1;break}}const T=[],X=this._shaderPath;if(this._options.defines)for(let u=0;u<this._options.defines.length;u++)T.push(this._options.defines[u]);const O=T.join("\n");return this._cachedDefines!==O&&(this._cachedDefines=O,v=this._engine.createComputeEffect(X,{defines:O,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=v),!!v.isReady()}dispatch(v,T,X){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,v,T,X,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const X=I._BufferIsDataBuffer(v)?v:v.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,X,T,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const T in this._bindings){const X=this._bindings[T];if(!this._options.bindingsMapping[T])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+T+"'");switch(X.type){case 0:{const O=this._samplers[T],u=X.object;var v;if(!O||!u._texture||!O.compareSampler(u._texture))this._samplers[T]=(new c.b).setParameters(u.wrapU,u.wrapV,u.wrapR,u.anisotropicFilteringLevel,u._texture.samplingMode,null===(v=u._texture)||void 0===v?void 0:v._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const v=X.object;v.getBuffer()!==X.buffer&&(X.buffer=v.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}dispatchWhenReady(v,T,X){let O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return new Promise((u=>{const B=()=>{this.dispatch(v,T,X)?u():setTimeout(B,O)};B()}))}serialize(){const v=E.e.Serialize(this);v.options=this._options,v.shaderPath=this._shaderPath,v.Dj={},v.textures={};for(const T in this._bindings){const X=this._bindings[T],O=X.object;switch(X.type){case 0:case 4:case 1:{const u=O.serialize();u&&(v.textures[T]=u,v.Dj[T]={type:X.type});break}}}return v}static Parse(v,T,X){const O=E.e.Parse((()=>new I(v.name,T.getEngine(),v.shaderPath,v.options)),v,T,X);for(const u in v.textures){const B=v.Dj[u],m=i.e.Parse(v.textures[u],T,X);0===B.type?O.setTexture(u,m):4===B.type?O.setTexture(u,m,!1):O.setStorageTexture(u,m)}return O}static _BufferIsDataBuffer(v){return void 0!==v.underlyingResource}}(0,P.c)([(0,a.G)()],I.prototype,"name",void 0),(0,P.c)([(0,a.G)()],I.prototype,"fastMode",void 0),(0,A.f)("BABYLON.ComputeShader",I);var W=X(1251);const g="gpuUpdateParticlesComputeShader",j="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";r.e.ShadersStoreWGSL[g]=j;(0,A.f)("BABYLON.ComputeShaderParticleSystem",class{constructor(v,T){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=v,this._engine=T}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var v;return(null===(v=this._updateComputeShader)||void 0===v?void 0:v.isReady())??!1}createUpdateBuffer(v){var T;const X={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(X.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(X.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(X.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(X.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(X.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(X.noiseTexture={group:1,binding:11}),this._updateComputeShader=new I("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:X,defines:v.split("\n")}),null===(T=this._simParamsComputeShader)||void 0===T||T.dispose(),this._simParamsComputeShader=new W.c(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new L(this._simParamsComputeShader)}createVertexBuffers(v,T){this._renderVertexBuffers.push(T)}createParticleBuffer(v){const T=new y(this._engine,4*v.length,11,"ComputeShaderParticleSystemBuffer");return T.update(v),this._bufferComputeShader.push(T),T.getBuffer()}bindDrawBuffers(v,T,X){this._engine.bindBuffers(this._renderVertexBuffers[v],X,T)}preUpdateParticleBuffer(){}updateParticleBuffer(v,T,X){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[v]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^v]),this._updateComputeShader.dispatch(Math.ceil(X/64))}releaseBuffers(){var v;for(let T=0;T<this._bufferComputeShader.length;++T)this._bufferComputeShader[T].dispose();this._bufferComputeShader.length=0,null===(v=this._simParamsComputeShader)||void 0===v||v.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class e{constructor(v,T,X){this.gradient=v,this.color1=T,this.color2=X}getColorToRef(v){this.color2?m.g.LerpToRef(this.color1,this.color2,Math.random(),v):v.p(this.color1)}}class h{constructor(v,T){this.gradient=v,this.color=T}}class S{constructor(v,T,X){this.gradient=v,this.factor1=T,this.factor2=X}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class w{static GetCurrentGradient(v,T,X){if(T[0].gradient>v)return void X(T[0],T[0],1);for(let u=0;u<T.length-1;u++){const O=T[u],B=T[u+1];if(v>=O.gradient&&v<=B.gradient){return void X(O,B,(v-O.gradient)/(B.gradient-O.gradient))}}const O=T.length-1;X(T[O],T[O],1)}}var z=X(1001),R=X(12091),Y=X(1034);class q{constructor(v){this.particleSystem=v,this.position=O.l.Zero(),this.direction=O.l.Zero(),this.color=new m.g(0,0,0,0),this.colorStep=new m.g(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new O.i(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new m.g(0,0,0,0),this._currentColor2=new m.g(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=q._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let v=this.age,T=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===T?(T=1,v=this._randomCellOffset):v+=this._randomCellOffset);const X=this._initialEndSpriteCellID-this._initialStartSpriteCellID+1;let O;O=this._initialSpriteCellLoop?(0,f.c)(v*T%this.lifeTime/this.lifeTime):(0,f.c)(v*T/this.lifeTime),this.cellIndex=this._initialStartSpriteCellID+O*X|0}_inheritParticleInfoToSubEmitter(v){if(v.particleSystem.k.position){const T=v.particleSystem.k;if(T.position.p(this.position),v.inheritDirection){const v=O.g.Vd[0];this.direction.normalizeToRef(v),T.setDirection(v,0,Math.PI/2)}}else{v.particleSystem.k.p(this.position)}this.direction.scaleToRef(v.inheritedVelocityAmount/2,O.g.Vd[0]),v.particleSystem._inheritedVelocityOffset.p(O.g.Vd[0])}_inheritParticleInfoToSubEmitters(){this._attachedSubEmitters&&this._attachedSubEmitters.length>0&&this._attachedSubEmitters.forEach((v=>{this._inheritParticleInfoToSubEmitter(v)}))}_reset(){this.age=0,this.id=q._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(v){v.position.p(this.position),this._initialDirection?v._initialDirection?v._initialDirection.p(this._initialDirection):v._initialDirection=this._initialDirection.clone():v._initialDirection=null,v.direction.p(this.direction),this.Lg&&(v.Lg?v.Lg.p(this.Lg):v.Lg=this.Lg.clone()),v.color.p(this.color),v.colorStep.p(this.colorStep),v.lifeTime=this.lifeTime,v.age=this.age,v._randomCellOffset=this._randomCellOffset,v.size=this.size,v.scale.p(this.scale),v.angle=this.angle,v.angularSpeed=this.angularSpeed,v.particleSystem=this.particleSystem,v.cellIndex=this.cellIndex,v.id=this.id,v._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(v._currentColorGradient=this._currentColorGradient,v._currentColor1.p(this._currentColor1),v._currentColor2.p(this._currentColor2)),this._currentSizeGradient&&(v._currentSizeGradient=this._currentSizeGradient,v._currentSize1=this._currentSize1,v._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(v._currentAngularSpeedGradient=this._currentAngularSpeedGradient,v._currentAngularSpeed1=this._currentAngularSpeed1,v._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(v._currentVelocityGradient=this._currentVelocityGradient,v._currentVelocity1=this._currentVelocity1,v._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(v._currentLimitVelocityGradient=this._currentLimitVelocityGradient,v._currentLimitVelocity1=this._currentLimitVelocity1,v._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(v._currentDragGradient=this._currentDragGradient,v._currentDrag1=this._currentDrag1,v._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(v._initialStartSpriteCellID=this._initialStartSpriteCellID,v._initialEndSpriteCellID=this._initialEndSpriteCellID,v._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(v.remapData&&this.remapData?v.remapData.p(this.remapData):v.remapData=new O.o(0,0,0,0)),this._randomNoiseCoordinates1&&(v._randomNoiseCoordinates1?(v._randomNoiseCoordinates1.p(this._randomNoiseCoordinates1),v._randomNoiseCoordinates2.p(this._randomNoiseCoordinates2)):(v._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),v._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}q._Count=0;var vv=X(1388),Tv=(X(1461),X(1400)),Xv=X(1397),Ov=X(1249);class uv extends x{set onDispose(v){this._onDisposeObserver&&this.ae.remove(this._onDisposeObserver),this._onDisposeObserver=this.ae.add(v)}get useRampGradients(){return this._useRampGradients}set useRampGradients(v){this._useRampGradients!==v&&(this._useRampGradients=v,this._resetEffect())}get particles(){return this.yj}get shaderLanguage(){return this._shaderLanguage}getActiveCount(){return this.yj.length}getClassName(){return"Te"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var v;let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(v=this._customWrappers[T])||void 0===v?void 0:v.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[v]??this._customWrappers[0]}setCustomEffect(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[T]=new vv.d(this._engine),this._customWrappers[T].effect=v,this._customWrappers[T].drawContext&&(this._customWrappers[T].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new z.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}constructor(v,T,X){let u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,B=arguments.length>4&&void 0!==arguments[4]&&arguments[4],A=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01;super(v),this._emitterInverseWorldMatrix=O.b.Identity(),this._inheritedVelocityOffset=new O.l,this.ae=new z.b,this.onStoppedObservable=new z.b,this.yj=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new m.g(0,0,0,0),this._colorDiff=new m.g(0,0,0,0),this._scaledDirection=O.l.Zero(),this._scaledGravity=O.l.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this.isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=v=>{},this.recycleParticle=v=>{const T=this.yj.pop();T!==v&&T.copyTo(v),this._stockParticles.push(T)},this._createParticle=()=>{let v;return 0!==this._stockParticles.length?(v=this._stockParticles.pop(),v._reset()):v=new q(this),this._prepareParticle(v),v},this._shadersLoaded=!1,this._capacity=T,this._epsilon=A,this._isAnimationSheetEnabled=B,X&&"Scene"!==X.getClassName()?(this._engine=X,this.defaultProjectionMatrix=O.b.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=X||Y.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Ae.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._attachImageProcessingConfiguration(null),this._customWrappers={0:new vv.d(this._engine)},this._customWrappers[0].effect=u,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new H;let x=null;this.updateFunction=v=>{let T=null;var X;this.noiseTexture&&(T=this.noiseTexture.getSize(),null===(X=this.noiseTexture.getContent())||void 0===X||X.then((v=>{x=v})));const u=v===this.yj;for(let B=0;B<v.length;B++){const X=v[B];let A=this._scaledUpdateSpeed;const M=X.age;if(X.age+=A,X.age>X.lifeTime){const v=X.age-M;A=(X.lifeTime-M)*A/v,X.age=X.lifeTime}const H=X.age/X.lifeTime;this._colorGradients&&this._colorGradients.length>0?w.GetCurrentGradient(H,this._colorGradients,((v,T,O)=>{v!==X._currentColorGradient&&(X._currentColor1.p(X._currentColor2),T.getColorToRef(X._currentColor2),X._currentColorGradient=v),m.g.LerpToRef(X._currentColor1,X._currentColor2,O,X.color)})):(X.colorStep.scaleToRef(A,this._scaledColorStep),X.color.addInPlace(this._scaledColorStep),X.color.a<0&&(X.color.a=0)),this._angularSpeedGradients&&this._angularSpeedGradients.length>0&&w.GetCurrentGradient(H,this._angularSpeedGradients,((v,T,O)=>{v!==X._currentAngularSpeedGradient&&(X._currentAngularSpeed1=X._currentAngularSpeed2,X._currentAngularSpeed2=T.getFactor(),X._currentAngularSpeedGradient=v),X.angularSpeed=(0,f.n)(X._currentAngularSpeed1,X._currentAngularSpeed2,O)})),X.angle+=X.angularSpeed*A;let n=A;if(this._velocityGradients&&this._velocityGradients.length>0&&w.GetCurrentGradient(H,this._velocityGradients,((v,T,O)=>{v!==X._currentVelocityGradient&&(X._currentVelocity1=X._currentVelocity2,X._currentVelocity2=T.getFactor(),X._currentVelocityGradient=v),n*=(0,f.n)(X._currentVelocity1,X._currentVelocity2,O)})),X.direction.scaleToRef(n,this._scaledDirection),this._limitVelocityGradients&&this._limitVelocityGradients.length>0&&w.GetCurrentGradient(H,this._limitVelocityGradients,((v,T,O)=>{v!==X._currentLimitVelocityGradient&&(X._currentLimitVelocity1=X._currentLimitVelocity2,X._currentLimitVelocity2=T.getFactor(),X._currentLimitVelocityGradient=v);const u=(0,f.n)(X._currentLimitVelocity1,X._currentLimitVelocity2,O);X.direction.length()>u&&X.direction.scaleInPlace(this.limitVelocityDamping)})),this._dragGradients&&this._dragGradients.length>0&&w.GetCurrentGradient(H,this._dragGradients,((v,T,O)=>{v!==X._currentDragGradient&&(X._currentDrag1=X._currentDrag2,X._currentDrag2=T.getFactor(),X._currentDragGradient=v);const u=(0,f.n)(X._currentDrag1,X._currentDrag2,O);this._scaledDirection.scaleInPlace(1-u)})),this.isLocal&&X.Lg?(X.Lg.addInPlace(this._scaledDirection),O.l.TransformCoordinatesToRef(X.Lg,this._emitterWorldMatrix,X.position)):X.position.addInPlace(this._scaledDirection),x&&T&&X._randomNoiseCoordinates1){const v=this._fetchR(X._randomNoiseCoordinates1.x,X._randomNoiseCoordinates1.y,T.width,T.height,x),u=this._fetchR(X._randomNoiseCoordinates1.z,X._randomNoiseCoordinates2.x,T.width,T.height,x),B=this._fetchR(X._randomNoiseCoordinates2.y,X._randomNoiseCoordinates2.z,T.width,T.height,x),m=O.g.Vd[0],f=O.g.Vd[1];m.Sd((2*v-1)*this.noiseStrength.x,(2*u-1)*this.noiseStrength.y,(2*B-1)*this.noiseStrength.z),m.scaleToRef(A,f),X.direction.addInPlace(f)}this.gravity.scaleToRef(A,this._scaledGravity),X.direction.addInPlace(this._scaledGravity),this._sizeGradients&&this._sizeGradients.length>0&&w.GetCurrentGradient(H,this._sizeGradients,((v,T,O)=>{v!==X._currentSizeGradient&&(X._currentSize1=X._currentSize2,X._currentSize2=T.getFactor(),X._currentSizeGradient=v),X.size=(0,f.n)(X._currentSize1,X._currentSize2,O)})),this._useRampGradients&&(this._colorRemapGradients&&this._colorRemapGradients.length>0&&w.GetCurrentGradient(H,this._colorRemapGradients,((v,T,O)=>{const u=(0,f.n)(v.factor1,T.factor1,O),B=(0,f.n)(v.factor2,T.factor2,O);X.remapData.x=u,X.remapData.y=B-u})),this._alphaRemapGradients&&this._alphaRemapGradients.length>0&&w.GetCurrentGradient(H,this._alphaRemapGradients,((v,T,O)=>{const u=(0,f.n)(v.factor1,T.factor1,O),B=(0,f.n)(v.factor2,T.factor2,O);X.remapData.z=u,X.remapData.w=B-u}))),this._isAnimationSheetEnabled&&X.updateCellIndex(),X._inheritParticleInfoToSubEmitters(),X.age>=X.lifeTime&&(this._emitFromParticle(X),X._attachedSubEmitters&&(X._attachedSubEmitters.forEach((v=>{v.particleSystem.disposeOnStop=!0,v.particleSystem.stop()})),X._attachedSubEmitters=null),this.recycleParticle(X),u&&B--)}}}serialize(v){throw new Error("Method not implemented.")}clone(v,T){throw new Error("Method not implemented.")}_addFactorGradient(v,T,X,O){const u=new S(T,X,O);v.push(u),v.sort(((v,T)=>v.gradient<T.gradient?-1:v.gradient>T.gradient?1:0))}_removeFactorGradient(v,T){if(!v)return;let X=0;for(const O of v){if(O.gradient===T){v.splice(X,1);break}X++}}addLifeTimeGradient(v,T,X){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,v,T,X),this}removeLifeTimeGradient(v){return this._removeFactorGradient(this._lifeTimeGradients,v),this}addSizeGradient(v,T,X){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,v,T,X),this}removeSizeGradient(v){return this._removeFactorGradient(this._sizeGradients,v),this}addColorRemapGradient(v,T,X){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,v,T,X),this}removeColorRemapGradient(v){return this._removeFactorGradient(this._colorRemapGradients,v),this}addAlphaRemapGradient(v,T,X){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,v,T,X),this}removeAlphaRemapGradient(v){return this._removeFactorGradient(this._alphaRemapGradients,v),this}addAngularSpeedGradient(v,T,X){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,v,T,X),this}removeAngularSpeedGradient(v){return this._removeFactorGradient(this._angularSpeedGradients,v),this}addVelocityGradient(v,T,X){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,v,T,X),this}removeVelocityGradient(v){return this._removeFactorGradient(this._velocityGradients,v),this}addLimitVelocityGradient(v,T,X){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,v,T,X),this}removeLimitVelocityGradient(v){return this._removeFactorGradient(this._limitVelocityGradients,v),this}addDragGradient(v,T,X){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,v,T,X),this}removeDragGradient(v){return this._removeFactorGradient(this._dragGradients,v),this}addEmitRateGradient(v,T,X){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,v,T,X),this}removeEmitRateGradient(v){return this._removeFactorGradient(this._emitRateGradients,v),this}addStartSizeGradient(v,T,X){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,v,T,X),this}removeStartSizeGradient(v){return this._removeFactorGradient(this._startSizeGradients,v),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const v=new Uint8Array(4*this._rawTextureWidth),T=m.k.he[0];for(let X=0;X<this._rawTextureWidth;X++){const O=X/this._rawTextureWidth;w.GetCurrentGradient(O,this._rampGradients,((O,u,B)=>{m.d.LerpToRef(O.color,u.color,B,T),v[4*X]=255*T.r,v[4*X+1]=255*T.g,v[4*X+2]=255*T.b,v[4*X+3]=255}))}this._rampGradientsTexture=R.d.CreateRGBATexture(v,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((v,T)=>v.gradient<T.gradient?-1:v.gradient>T.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(v,T){this._rampGradients||(this._rampGradients=[]);const X=new h(v,T);return this._rampGradients.push(X),this._syncRampGradientTexture(),this}removeRampGradient(v){return this._removeGradientAndTexture(v,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(v,T,X){this._colorGradients||(this._colorGradients=[]);const O=new e(v,T,X);return this._colorGradients.push(O),this._colorGradients.sort(((v,T)=>v.gradient<T.gradient?-1:v.gradient>T.gradient?1:0)),this}removeColorGradient(v){if(!this._colorGradients)return this;let T=0;for(const X of this._colorGradients){if(X.gradient===v){this._colorGradients.splice(T,1);break}T++}return this}resetDrawCache(){for(const v of this._drawWrappers)if(v)for(const T of v)null===T||void 0===T||T.dispose();this._drawWrappers=[]}_fetchR(v,T,X,O,u){return u[4*(((v=.5*Math.abs(v)+.5)*X%X|0)+((T=.5*Math.abs(T)+.5)*O%O|0)*X)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const v=this._engine,T=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*T),this._vertexBuffer=new K.d(v,this._vertexData,!0,T);let X=0;const O=this._vertexBuffer.createVertexBuffer(K.e.PositionKind,X,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[K.e.PositionKind]=O,X+=3;const u=this._vertexBuffer.createVertexBuffer(K.e.ColorKind,X,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[K.e.ColorKind]=u,X+=4;const B=this._vertexBuffer.createVertexBuffer("angle",X,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=B,X+=1;const m=this._vertexBuffer.createVertexBuffer("size",X,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=m,X+=2,this._isAnimationSheetEnabled){const v=this._vertexBuffer.createVertexBuffer("cellIndex",X,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=v,X+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const v=this._vertexBuffer.createVertexBuffer("direction",X,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=v,X+=3}if(this._useRampGradients){const v=this._vertexBuffer.createVertexBuffer("remapData",X,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=v,X+=4}let A;if(this._useInstancing){const T=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new K.d(v,T,!1,2),A=this._spriteBuffer.createVertexBuffer("offset",0,2)}else A=this._vertexBuffer.createVertexBuffer("offset",X,2,this._vertexBufferSize,this._useInstancing),X+=2;this._vertexBuffers.offset=A,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const v=[],T=[];let X=0;for(let O=0;O<this._capacity;O++)v.push(X),v.push(X+1),v.push(X+2),v.push(X),v.push(X+2),v.push(X+3),T.push(X,X+1,X+1,X+2,X+2,X+3,X+3,X,X,X+3),X+=4;this._indexBuffer=this._engine.createIndexBuffer(v),this._linesIndexBuffer=this._engine.createIndexBuffer(T)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(v)setTimeout((()=>{this.start(0)}),v);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var T;-1!==(null===(T=this.k)||void 0===T?void 0:T.getClassName().indexOf("Mesh"))&&this.k.Ke(!0);const v=this.noiseTexture;if(v&&v.onGeneratedObservable)v.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let T=0;T<this.preWarmCycles;T++)this.animate(!0),v.render()}))}));else for(let T=0;T<this.preWarmCycles;T++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop)}}stop(){let v=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(v))}_postStop(v){}reset(){this._stockParticles.length=0,this.yj.length=0}_appendParticleVertex(v,T,X,u){let B=v*this._vertexBufferSize;if(this._vertexData[B++]=T.position.x+this.Eg.x,this._vertexData[B++]=T.position.y+this.Eg.y,this._vertexData[B++]=T.position.z+this.Eg.z,this._vertexData[B++]=T.color.r,this._vertexData[B++]=T.color.g,this._vertexData[B++]=T.color.b,this._vertexData[B++]=T.color.a,this._vertexData[B++]=T.angle,this._vertexData[B++]=T.scale.x*T.size,this._vertexData[B++]=T.scale.y*T.size,this._isAnimationSheetEnabled&&(this._vertexData[B++]=T.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[B++]=T.direction.x,this._vertexData[B++]=T.direction.y,this._vertexData[B++]=T.direction.z);else if(T._initialDirection){let v=T._initialDirection;this.isLocal&&(O.l.TransformNormalToRef(v,this._emitterWorldMatrix,O.g.Vd[0]),v=O.g.Vd[0]),0===v.x&&0===v.z&&(v.x=.001),this._vertexData[B++]=v.x,this._vertexData[B++]=v.y,this._vertexData[B++]=v.z}else{let v=T.direction;this.isLocal&&(O.l.TransformNormalToRef(v,this._emitterWorldMatrix,O.g.Vd[0]),v=O.g.Vd[0]),0===v.x&&0===v.z&&(v.x=.001),this._vertexData[B++]=v.x,this._vertexData[B++]=v.y,this._vertexData[B++]=v.z}this._useRampGradients&&T.remapData&&(this._vertexData[B++]=T.remapData.x,this._vertexData[B++]=T.remapData.y,this._vertexData[B++]=T.remapData.z,this._vertexData[B++]=T.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===X?X=this._epsilon:1===X&&(X=1-this._epsilon),0===u?u=this._epsilon:1===u&&(u=1-this._epsilon)),this._vertexData[B++]=X,this._vertexData[B++]=u)}_prepareParticle(v){}_update(v){if(this._alive=this.yj.length>0,this.k.position){const v=this.k;this._emitterWorldMatrix=v.getWorldMatrix()}else{const v=this.k;this._emitterWorldMatrix=O.b.Translation(v.x,v.y,v.z)}let T;this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.yj);for(let X=0;X<v&&this.yj.length!==this._capacity;X++){if(T=this._createParticle(),this.yj.push(T),this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0){const v=(0,f.c)(this._actualFrame/this.targetStopDuration);w.GetCurrentGradient(v,this._lifeTimeGradients,((X,O)=>{const u=X,B=O,m=u.getFactor(),A=B.getFactor(),x=(v-u.gradient)/(B.gradient-u.gradient);T.lifeTime=(0,f.n)(m,A,x)}))}else T.lifeTime=(0,f.p)(this.minLifeTime,this.maxLifeTime);const v=(0,f.p)(this.minEmitPower,this.maxEmitPower);if(this.startPositionFunction?this.startPositionFunction(this._emitterWorldMatrix,T.position,T,this.isLocal):this.particleEmitterType.startPositionFunction(this._emitterWorldMatrix,T.position,T,this.isLocal),this.isLocal&&(T.Lg?T.Lg.p(T.position):T.Lg=T.position.clone(),O.l.TransformCoordinatesToRef(T.Lg,this._emitterWorldMatrix,T.position)),this.startDirectionFunction?this.startDirectionFunction(this._emitterWorldMatrix,T.direction,T,this.isLocal):this.particleEmitterType.startDirectionFunction(this._emitterWorldMatrix,T.direction,T,this.isLocal,this._emitterInverseWorldMatrix),0===v?T._initialDirection?T._initialDirection.p(T.direction):T._initialDirection=T.direction.clone():T._initialDirection=null,T.direction.scaleInPlace(v),this._sizeGradients&&0!==this._sizeGradients.length?(T._currentSizeGradient=this._sizeGradients[0],T._currentSize1=T._currentSizeGradient.getFactor(),T.size=T._currentSize1,this._sizeGradients.length>1?T._currentSize2=this._sizeGradients[1].getFactor():T._currentSize2=T._currentSize1):T.size=(0,f.p)(this.minSize,this.maxSize),T.scale.Sd((0,f.p)(this.minScaleX,this.maxScaleX),(0,f.p)(this.minScaleY,this.maxScaleY)),this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration){const v=this._actualFrame/this.targetStopDuration;w.GetCurrentGradient(v,this._startSizeGradients,((v,X,O)=>{v!==this._currentStartSizeGradient&&(this._currentStartSize1=this._currentStartSize2,this._currentStartSize2=X.getFactor(),this._currentStartSizeGradient=v);const u=(0,f.n)(this._currentStartSize1,this._currentStartSize2,O);T.scale.scaleInPlace(u)}))}if(this._angularSpeedGradients&&0!==this._angularSpeedGradients.length?(T._currentAngularSpeedGradient=this._angularSpeedGradients[0],T.angularSpeed=T._currentAngularSpeedGradient.getFactor(),T._currentAngularSpeed1=T.angularSpeed,this._angularSpeedGradients.length>1?T._currentAngularSpeed2=this._angularSpeedGradients[1].getFactor():T._currentAngularSpeed2=T._currentAngularSpeed1):T.angularSpeed=(0,f.p)(this.minAngularSpeed,this.maxAngularSpeed),T.angle=(0,f.p)(this.minInitialRotation,this.maxInitialRotation),this._velocityGradients&&this._velocityGradients.length>0&&(T._currentVelocityGradient=this._velocityGradients[0],T._currentVelocity1=T._currentVelocityGradient.getFactor(),this._velocityGradients.length>1?T._currentVelocity2=this._velocityGradients[1].getFactor():T._currentVelocity2=T._currentVelocity1),this._limitVelocityGradients&&this._limitVelocityGradients.length>0&&(T._currentLimitVelocityGradient=this._limitVelocityGradients[0],T._currentLimitVelocity1=T._currentLimitVelocityGradient.getFactor(),this._limitVelocityGradients.length>1?T._currentLimitVelocity2=this._limitVelocityGradients[1].getFactor():T._currentLimitVelocity2=T._currentLimitVelocity1),this._dragGradients&&this._dragGradients.length>0&&(T._currentDragGradient=this._dragGradients[0],T._currentDrag1=T._currentDragGradient.getFactor(),this._dragGradients.length>1?T._currentDrag2=this._dragGradients[1].getFactor():T._currentDrag2=T._currentDrag1),this._colorGradients&&0!==this._colorGradients.length)T._currentColorGradient=this._colorGradients[0],T._currentColorGradient.getColorToRef(T.color),T._currentColor1.p(T.color),this._colorGradients.length>1?this._colorGradients[1].getColorToRef(T._currentColor2):T._currentColor2.p(T.color);else{const v=(0,f.p)(0,1);m.g.LerpToRef(this.color1,this.color2,v,T.color),this.colorDead.subtractToRef(T.color,this._colorDiff),this._colorDiff.scaleToRef(1/T.lifeTime,T.colorStep)}this._isAnimationSheetEnabled&&(T._initialStartSpriteCellID=this.startSpriteCellID,T._initialEndSpriteCellID=this.endSpriteCellID,T._initialSpriteCellLoop=this.spriteCellLoop),T.direction.addInPlace(this._inheritedVelocityOffset),this._useRampGradients&&(T.remapData=new O.o(0,1,0,1)),this.noiseTexture&&(T._randomNoiseCoordinates1?(T._randomNoiseCoordinates1.Sd(Math.random(),Math.random(),Math.random()),T._randomNoiseCoordinates2.Sd(Math.random(),Math.random(),Math.random())):(T._randomNoiseCoordinates1=new O.l(Math.random(),Math.random(),Math.random()),T._randomNoiseCoordinates2=new O.l(Math.random(),Math.random(),Math.random()))),T._inheritParticleInfoToSubEmitters()}}static _GetAttributeNamesOrOptions(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0],T=arguments.length>1&&void 0!==arguments[1]&&arguments[1],X=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const O=[K.e.PositionKind,K.e.ColorKind,"angle","offset","size"];return v&&O.push("cellIndex"),T||O.push("direction"),X&&O.push("remapData"),O}static _GetEffectCreationOptions(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0],T=arguments.length>1&&void 0!==arguments[1]&&arguments[1],X=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const O=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,Tv.c)(O),v&&O.push("particlesInfos"),T&&O.push("logarithmicDepthConstant"),X&&(O.push("vFogInfos"),O.push("vFogColor")),O}fillDefines(v,T){let X=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,Tv.n)(this,this._scene,v),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&v.push("#define FOG")),this._isAnimationSheetEnabled&&v.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&v.push("#define LOGARITHMICDEPTH"),T===x.BLENDMODE_MULTIPLY&&v.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&v.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(v.push("#define BILLBOARD"),this.billboardMode){case 2:v.push("#define BILLBOARDY");break;case 8:case 9:v.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&v.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:v.push("#define BILLBOARDMODE_ALL")}X&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),v.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(v,T,X){T.push(...uv._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),v.push(...uv._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),X.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,Ov.e)(v,this._imageProcessingConfigurationDefines),(0,Ov.d)(X,this._imageProcessingConfigurationDefines))}_getWrapper(v){const T=this._getCustomDrawWrapper(v);if(null!==T&&void 0!==T&&T.effect)return T;const X=[];this.fillDefines(X,v);const O=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let u=this._drawWrappers[O];u||(u=this._drawWrappers[O]=[]);let B=u[v];B||(B=new vv.d(this._engine),B.drawContext&&(B.drawContext.useInstancing=this._useInstancing),u[v]=B);const m=X.join("\n");if(B.defines!==m){const v=[],T=[],X=[];this.fillUniformsAttributesAndSamplerNames(T,v,X),B.setEffect(this._engine.createEffect("particles",v,T,X,m,void 0,void 0,void 0,void 0,this._shaderLanguage),m)}return B}animate(){var v;let T,X=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started){if(!X&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(X?this.preWarmStepOffset:(null===(v=this._scene)||void 0===v?void 0:v.getAnimationRatio())||1),this.manualEmitCount>-1)T=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let v=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const T=this._actualFrame/this.targetStopDuration;w.GetCurrentGradient(T,this._emitRateGradients,((T,X,O)=>{T!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=X.getFactor(),this._currentEmitRateGradient=T),v=(0,f.n)(this._currentEmitRate1,this._currentEmitRate2,O)}))}T=v*this._scaledUpdateSpeed|0,this._newPartsExcess+=v*this._scaledUpdateSpeed-T}if(this._newPartsExcess>1&&(T+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?T=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(T),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!X){let v=0;for(let T=0;T<this.yj.length;T++){const X=this.yj[T];this._appendParticleVertices(v,X),v+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.yj.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(v,T){this._appendParticleVertex(v++,T,0,0),this._useInstancing||(this._appendParticleVertex(v++,T,1,0),this._appendParticleVertex(v++,T,1,1),this._appendParticleVertex(v++,T,0,1))}rebuild(){var v;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(v=this._spriteBuffer)||void 0===v||v._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!uv.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(X.bind(X,12135)),Promise.resolve().then(X.bind(X,12131))])):await Promise.all([Promise.resolve().then(X.bind(X,12124)),Promise.resolve().then(X.bind(X,12116))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.k||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==x.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(x.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(x.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(v){const T=this._getWrapper(v),X=T.effect,u=this._engine;u.enableEffect(T);const B=this.defaultViewMatrix??this._scene.getViewMatrix();if(X.setTexture("diffuseSampler",this.particleTexture),X.setMatrix("view",B),X.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const v=this.particleTexture.getBaseSize();X.setFloat3("particlesInfos",this.spriteCellWidth/v.width,this.spriteCellHeight/v.height,this.spriteCellWidth/v.width)}if(X.setVector2("translationPivot",this.translationPivot),X.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const v=this._scene.activeCamera;X.setVector3("eyePosition",v.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),X.setTexture("rampSampler",this._rampGradientsTexture));const m=X.defines;var A,f,M,H,n,V;(this._scene&&((0,Tv.g)(X,this,this._scene),this.applyFog&&(0,Xv.e)(this._scene,void 0,X)),m.indexOf("#define BILLBOARDMODE_ALL")>=0&&(B.invertToRef(O.g.Matrix[0]),X.setMatrix("invView",O.g.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(A=this._scene)&&void 0!==A&&A.forceWireframe?u.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,X):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,X)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(f=this._scene)&&void 0!==f&&f.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?u.bindBuffers(this._vertexBuffers,null!==(M=this._scene)&&void 0!==M&&M.forceWireframe?this._linesIndexBuffer:this._indexBuffer,X):u.bindBuffers(this._vertexBuffers,null!==(H=this._scene)&&void 0!==H&&H.forceWireframe?this._linesIndexBufferUseInstancing:null,X);switch(this.useLogarithmicDepth&&this._scene&&(0,Xv.i)(m,X,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(X),v){case x.BLENDMODE_ADD:u.setAlphaMode(1);break;case x.BLENDMODE_ONEONE:u.setAlphaMode(6);break;case x.BLENDMODE_STANDARD:u.setAlphaMode(2);break;case x.BLENDMODE_MULTIPLY:u.setAlphaMode(4)}(this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(X),this._useInstancing)?null!==(n=this._scene)&&void 0!==n&&n.forceWireframe?u.drawElementsType(6,0,10,this.yj.length):u.drawArraysType(7,0,4,this.yj.length):null!==(V=this._scene)&&void 0!==V&&V.forceWireframe?u.drawElementsType(1,0,10*this.yj.length):u.drawElementsType(0,0,6*this.yj.length);return this.yj.length}render(){if(!this.isReady()||!this.yj.length)return 0;const v=this._engine;v.setState&&(v.setState(!1),this.forceDepthWrite&&v.setDepthWrite(!0));let T=0;return T=this.blendMode===x.BLENDMODE_MULTIPLYADD?this._render(x.BLENDMODE_MULTIPLY)+this._render(x.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),T}_onDispose(){}dispose(){let v=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],T=arguments.length>1&&void 0!==arguments[1]&&arguments[1],X=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),v&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),v&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(T,X),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const v=this._scene.Ae.indexOf(this);v>-1&&this._scene.Ae.splice(v,1),this._scene._activeParticleSystems.dispose()}this.ae.notifyObservers(this),this.ae.clear(),this.onStoppedObservable.clear(),this.reset()}}uv.ForceGLSL=!1;var Bv,mv=X(1095);!function(v){v[v.ATTACHED=0]="ATTACHED",v[v.END=1]="END"}(Bv||(Bv={}));class Av{constructor(v){if(this.particleSystem=v,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!v.k||!v.k.dispose){const T=(0,A.c)("BABYLON.AbstractMesh");v.k=new T("SubemitterSystemEmitter",v.va()),v._disposeEmitterOnDispose=!0}}clone(){let v=this.particleSystem.k;if(v){if(v instanceof O.l)v=v.clone();else if(-1!==v.getClassName().indexOf("Mesh")){v=new((0,A.c)("BABYLON.Mesh"))("",v.va()),v.isVisible=!1}}else v=new O.l;const T=new Av(this.particleSystem.clone(this.particleSystem.name,v));return T.particleSystem.name+="Clone",T.type=this.type,T.inheritDirection=this.inheritDirection,T.inheritedVelocityAmount=this.inheritedVelocityAmount,T.particleSystem._disposeEmitterOnDispose=!0,T.particleSystem.disposeOnStop=!0,T}serialize(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const T={};return T.type=this.type,T.inheritDirection=this.inheritDirection,T.inheritedVelocityAmount=this.inheritedVelocityAmount,T.particleSystem=this.particleSystem.serialize(v),T}static _ParseParticleSystem(v,T,X){throw(0,mv.d)("ParseParticle")}static Parse(v,T,X){const O=v.particleSystem,u=new Av(Av._ParseParticleSystem(O,T,X,!0));return u.type=v.type,u.inheritDirection=v.inheritDirection,u.inheritedVelocityAmount=v.inheritedVelocityAmount,u.particleSystem._isSubEmitter=!0,u}dispose(){this.particleSystem.dispose()}}var xv=X(1111);function fv(v,T){const X=new k;return X.direction1=v,X.direction2=T,X}function Mv(){return new F(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function Hv(){return new b(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function nv(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new O.l(0,1,0),X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new O.l(0,1,0);return new l(v,T,X)}function Vv(){return new D(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function Dv(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new O.l(0,1,0),B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new O.l(0,1,0);return new s(v,T,X,u,B)}function sv(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new n(v,T)}function Fv(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new O.l(0,1,0),u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new O.l(0,1,0);return new V(v,T,X,u)}class kv extends uv{constructor(){super(...arguments),this._disposeEmitterOnDispose=!1,this._emitFromParticle=v=>{if(!this._subEmitters||0===this._subEmitters.length)return;const T=Math.floor(Math.random()*this._subEmitters.length);this._subEmitters[T].forEach((T=>{if(1===T.type){const X=T.clone();v._inheritParticleInfoToSubEmitter(X),X.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(X.particleSystem),X.particleSystem.start()}}))}}createPointEmitter(v,T){const X=fv(v,T);return this.particleEmitterType=X,X}createHemisphericEmitter(){const v=Mv(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=v,v}createSphereEmitter(){const v=Hv(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=v,v}createDirectedSphereEmitter(){const v=nv(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new O.l(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new O.l(0,1,0));return this.particleEmitterType=v,v}createCylinderEmitter(){const v=Vv(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=v,v}createDirectedCylinderEmitter(){const v=Dv(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new O.l(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new O.l(0,1,0));return this.particleEmitterType=v,v}createConeEmitter(){const v=sv(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=v,v}createDirectedConeEmitter(){const v=Fv(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new O.l(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new O.l(0,1,0));return this.particleEmitterType=v,v}createBoxEmitter(v,T,X,O){const u=new H;return this.particleEmitterType=u,this.direction1=v,this.direction2=T,this.minEmitBox=X,this.maxEmitBox=O,u}_prepareSubEmitterInternalArray(){this._subEmitters=new Array,this.subEmitters&&this.subEmitters.forEach((v=>{v instanceof kv?this._subEmitters.push([new Av(v)]):v instanceof Av?this._subEmitters.push([v]):v instanceof Array&&this._subEmitters.push(v)}))}_stopSubEmitters(){this.activeSubSystems&&(this.activeSubSystems.forEach((v=>{v.stop(!0)})),this.activeSubSystems=[])}_removeFromRoot(){if(!this._rootParticleSystem)return;const v=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==v&&this._rootParticleSystem.activeSubSystems.splice(v,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(v){v&&this._stopSubEmitters()}_prepareParticle(v){if(this._subEmitters&&this._subEmitters.length>0){const T=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];v._attachedSubEmitters=[],T.forEach((T=>{if(0===T.type){const X=T.clone();v._attachedSubEmitters.push(X),X.particleSystem.start()}}))}}_onDispose(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0],T=arguments.length>1&&void 0!==arguments[1]&&arguments[1];var X;(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),v)&&(null===(X=this.particles)||void 0===X||X.forEach((v=>{if(v._attachedSubEmitters)for(let T=v._attachedSubEmitters.length-1;T>=0;T-=1)v._attachedSubEmitters[T].dispose()})));if(T&&this.activeSubSystems)for(let O=this.activeSubSystems.length-1;O>=0;O-=1)this.activeSubSystems[O].dispose();if(this._subEmitters&&this._subEmitters.length){for(let v=0;v<this._subEmitters.length;v++)for(const T of this._subEmitters[v])T.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.k&&this.k.dispose&&this.k.dispose(!0)}static _Parse(v,T,X,u){let B;B=X instanceof xv.e?null:X;const x=(0,A.c)("BABYLON.Texture");if(x&&B&&(v.texture?T.particleTexture=x.Parse(v.texture,B,u):v.textureName&&(T.particleTexture=new x(u+v.textureName,B,!1,void 0===v.invertY||v.invertY),T.particleTexture.name=v.textureName)),v.emitterId||0===v.emitterId||void 0!==v.k?v.emitterId&&B?T.k=B.getLastMeshById(v.emitterId):T.k=O.l.Ld(v.k):T.k=O.l.Zero(),T.isLocal=!!v.isLocal,void 0!==v.renderingGroupId&&(T.renderingGroupId=v.renderingGroupId),void 0!==v.isBillboardBased&&(T.isBillboardBased=v.isBillboardBased),void 0!==v.billboardMode&&(T.billboardMode=v.billboardMode),void 0!==v.useLogarithmicDepth&&(T.useLogarithmicDepth=v.useLogarithmicDepth),v.animations){for(let X=0;X<v.animations.length;X++){const O=v.animations[X],u=(0,A.c)("BABYLON.Animation");u&&T.animations.push(u.Parse(O))}T.beginAnimationOnStart=v.beginAnimationOnStart,T.beginAnimationFrom=v.beginAnimationFrom,T.beginAnimationTo=v.beginAnimationTo,T.beginAnimationLoop=v.beginAnimationLoop}if(v.autoAnimate&&B&&B.beginAnimation(T,v.autoAnimateFrom,v.autoAnimateTo,v.autoAnimateLoop,v.autoAnimateSpeed||1),T.startDelay=0|v.startDelay,T.minAngularSpeed=v.minAngularSpeed,T.maxAngularSpeed=v.maxAngularSpeed,T.minSize=v.minSize,T.maxSize=v.maxSize,v.minScaleX&&(T.minScaleX=v.minScaleX,T.maxScaleX=v.maxScaleX,T.minScaleY=v.minScaleY,T.maxScaleY=v.maxScaleY),void 0!==v.preWarmCycles&&(T.preWarmCycles=v.preWarmCycles,T.preWarmStepOffset=v.preWarmStepOffset),void 0!==v.minInitialRotation&&(T.minInitialRotation=v.minInitialRotation,T.maxInitialRotation=v.maxInitialRotation),T.minLifeTime=v.minLifeTime,T.maxLifeTime=v.maxLifeTime,T.minEmitPower=v.minEmitPower,T.maxEmitPower=v.maxEmitPower,T.emitRate=v.emitRate,T.gravity=O.l.Ld(v.gravity),v.noiseStrength&&(T.noiseStrength=O.l.Ld(v.noiseStrength)),T.color1=m.g.Ld(v.color1),T.color2=m.g.Ld(v.color2),T.colorDead=m.g.Ld(v.colorDead),T.updateSpeed=v.updateSpeed,T.targetStopDuration=v.targetStopDuration,T.blendMode=v.blendMode,v.colorGradients)for(const O of v.colorGradients)T.addColorGradient(O.gradient,m.g.Ld(O.color1),O.color2?m.g.Ld(O.color2):void 0);if(v.rampGradients){for(const X of v.rampGradients)T.addRampGradient(X.gradient,m.d.Ld(X.color));T.useRampGradients=v.useRampGradients}if(v.colorRemapGradients)for(const O of v.colorRemapGradients)T.addColorRemapGradient(O.gradient,void 0!==O.factor1?O.factor1:O.factor,O.factor2);if(v.alphaRemapGradients)for(const O of v.alphaRemapGradients)T.addAlphaRemapGradient(O.gradient,void 0!==O.factor1?O.factor1:O.factor,O.factor2);if(v.sizeGradients)for(const O of v.sizeGradients)T.addSizeGradient(O.gradient,void 0!==O.factor1?O.factor1:O.factor,O.factor2);if(v.angularSpeedGradients)for(const O of v.angularSpeedGradients)T.addAngularSpeedGradient(O.gradient,void 0!==O.factor1?O.factor1:O.factor,O.factor2);if(v.velocityGradients)for(const O of v.velocityGradients)T.addVelocityGradient(O.gradient,void 0!==O.factor1?O.factor1:O.factor,O.factor2);if(v.dragGradients)for(const O of v.dragGradients)T.addDragGradient(O.gradient,void 0!==O.factor1?O.factor1:O.factor,O.factor2);if(v.emitRateGradients)for(const O of v.emitRateGradients)T.addEmitRateGradient(O.gradient,void 0!==O.factor1?O.factor1:O.factor,O.factor2);if(v.startSizeGradients)for(const O of v.startSizeGradients)T.addStartSizeGradient(O.gradient,void 0!==O.factor1?O.factor1:O.factor,O.factor2);if(v.lifeTimeGradients)for(const O of v.lifeTimeGradients)T.addLifeTimeGradient(O.gradient,void 0!==O.factor1?O.factor1:O.factor,O.factor2);if(v.limitVelocityGradients){for(const X of v.limitVelocityGradients)T.addLimitVelocityGradient(X.gradient,void 0!==X.factor1?X.factor1:X.factor,X.factor2);T.limitVelocityDamping=v.limitVelocityDamping}if(v.noiseTexture&&B){const X=(0,A.c)("BABYLON.ProceduralTexture");T.noiseTexture=X.Parse(v.noiseTexture,B,u)}let f;if(v.particleEmitterType){switch(v.particleEmitterType.type){case"SphereParticleEmitter":f=new b;break;case"SphereDirectedParticleEmitter":f=new l;break;case"ConeEmitter":case"ConeParticleEmitter":f=new n;break;case"ConeDirectedParticleEmitter":f=new V;break;case"CylinderParticleEmitter":f=new D;break;case"CylinderDirectedParticleEmitter":f=new s;break;case"HemisphericParticleEmitter":f=new F;break;case"PointParticleEmitter":f=new k;break;case"MeshParticleEmitter":f=new p;break;case"CustomParticleEmitter":f=new Q;break;default:f=new H}f.parse(v.particleEmitterType,B)}else f=new H,f.parse(v,B);T.particleEmitterType=f,T.startSpriteCellID=v.startSpriteCellID,T.endSpriteCellID=v.endSpriteCellID,T.spriteCellLoop=v.spriteCellLoop??!0,T.spriteCellWidth=v.spriteCellWidth,T.spriteCellHeight=v.spriteCellHeight,T.spriteCellChangeSpeed=v.spriteCellChangeSpeed,T.spriteRandomStartCell=v.spriteRandomStartCell,T.disposeOnStop=v.disposeOnStop??!1,T.manualEmitCount=v.manualEmitCount??-1}static Parse(v,T,X){let u=arguments.length>3&&void 0!==arguments[3]&&arguments[3],B=arguments.length>4?arguments[4]:void 0;const A=v.name;let x,f,M=null,H=null;if(T instanceof xv.e?x=T:(f=T,x=f.getEngine()),v.customShader&&x.createEffectForParticles){H=v.customShader;const T=H.shaderOptions.defines.length>0?H.shaderOptions.defines.join("\n"):"";M=x.createEffectForParticles(H.shaderPath.fragmentElement,H.shaderOptions.uniforms,H.shaderOptions.samplers,T)}const n=new kv(A,B||v.Re,T,M,v.isAnimationSheetEnabled);if(n.customShader=H,n._rootUrl=X,v.id&&(n.id=v.id),v.subEmitters){n.subEmitters=[];for(const O of v.subEmitters){const v=[];for(const u of O)v.push(Av.Parse(u,T,X));n.subEmitters.push(v)}}return kv._Parse(v,n,T,X),v.textureMask&&(n.textureMask=m.g.Ld(v.textureMask)),v.Eg&&(n.Eg=O.l.Ld(v.Eg)),v.preventAutoStart&&(n.preventAutoStart=v.preventAutoStart),u||n.preventAutoStart||n.start(),n}serialize(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const T={};if(kv._Serialize(T,this,v),T.textureMask=this.textureMask.Pd(),T.customShader=this.customShader,T.preventAutoStart=this.preventAutoStart,T.Eg=this.Eg.Pd(),this.subEmitters){T.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const X of this._subEmitters){const O=[];for(const T of X)O.push(T.serialize(v));T.subEmitters.push(O)}}return T}static _Serialize(v,T,X){if(v.name=T.name,v.id=T.id,v.Re=T.getCapacity(),v.disposeOnStop=T.disposeOnStop,v.manualEmitCount=T.manualEmitCount,T.k.position){const X=T.k;v.emitterId=X.id}else{const X=T.k;v.k=X.Pd()}T.particleEmitterType&&(v.particleEmitterType=T.particleEmitterType.serialize()),T.particleTexture&&(X?v.texture=T.particleTexture.serialize():(v.textureName=T.particleTexture.name,v.invertY=!!T.particleTexture._invertY)),v.isLocal=T.isLocal,E.e.AppendSerializedAnimations(T,v),v.beginAnimationOnStart=T.beginAnimationOnStart,v.beginAnimationFrom=T.beginAnimationFrom,v.beginAnimationTo=T.beginAnimationTo,v.beginAnimationLoop=T.beginAnimationLoop,v.startDelay=T.startDelay,v.renderingGroupId=T.renderingGroupId,v.isBillboardBased=T.isBillboardBased,v.billboardMode=T.billboardMode,v.minAngularSpeed=T.minAngularSpeed,v.maxAngularSpeed=T.maxAngularSpeed,v.minSize=T.minSize,v.maxSize=T.maxSize,v.minScaleX=T.minScaleX,v.maxScaleX=T.maxScaleX,v.minScaleY=T.minScaleY,v.maxScaleY=T.maxScaleY,v.minEmitPower=T.minEmitPower,v.maxEmitPower=T.maxEmitPower,v.minLifeTime=T.minLifeTime,v.maxLifeTime=T.maxLifeTime,v.emitRate=T.emitRate,v.gravity=T.gravity.Pd(),v.noiseStrength=T.noiseStrength.Pd(),v.color1=T.color1.Pd(),v.color2=T.color2.Pd(),v.colorDead=T.colorDead.Pd(),v.updateSpeed=T.updateSpeed,v.targetStopDuration=T.targetStopDuration,v.blendMode=T.blendMode,v.preWarmCycles=T.preWarmCycles,v.preWarmStepOffset=T.preWarmStepOffset,v.minInitialRotation=T.minInitialRotation,v.maxInitialRotation=T.maxInitialRotation,v.startSpriteCellID=T.startSpriteCellID,v.spriteCellLoop=T.spriteCellLoop,v.endSpriteCellID=T.endSpriteCellID,v.spriteCellChangeSpeed=T.spriteCellChangeSpeed,v.spriteCellWidth=T.spriteCellWidth,v.spriteCellHeight=T.spriteCellHeight,v.spriteRandomStartCell=T.spriteRandomStartCell,v.isAnimationSheetEnabled=T.isAnimationSheetEnabled,v.useLogarithmicDepth=T.useLogarithmicDepth;const O=T.getColorGradients();if(O){v.colorGradients=[];for(const T of O){const X={gradient:T.gradient,color1:T.color1.Pd()};T.color2?X.color2=T.color2.Pd():X.color2=T.color1.Pd(),v.colorGradients.push(X)}}const u=T.getRampGradients();if(u){v.rampGradients=[];for(const T of u){const X={gradient:T.gradient,color:T.color.Pd()};v.rampGradients.push(X)}v.useRampGradients=T.useRampGradients}const B=T.getColorRemapGradients();if(B){v.colorRemapGradients=[];for(const T of B){const X={gradient:T.gradient,factor1:T.factor1};void 0!==T.factor2?X.factor2=T.factor2:X.factor2=T.factor1,v.colorRemapGradients.push(X)}}const m=T.getAlphaRemapGradients();if(m){v.alphaRemapGradients=[];for(const T of m){const X={gradient:T.gradient,factor1:T.factor1};void 0!==T.factor2?X.factor2=T.factor2:X.factor2=T.factor1,v.alphaRemapGradients.push(X)}}const A=T.getSizeGradients();if(A){v.sizeGradients=[];for(const T of A){const X={gradient:T.gradient,factor1:T.factor1};void 0!==T.factor2?X.factor2=T.factor2:X.factor2=T.factor1,v.sizeGradients.push(X)}}const x=T.getAngularSpeedGradients();if(x){v.angularSpeedGradients=[];for(const T of x){const X={gradient:T.gradient,factor1:T.factor1};void 0!==T.factor2?X.factor2=T.factor2:X.factor2=T.factor1,v.angularSpeedGradients.push(X)}}const f=T.getVelocityGradients();if(f){v.velocityGradients=[];for(const T of f){const X={gradient:T.gradient,factor1:T.factor1};void 0!==T.factor2?X.factor2=T.factor2:X.factor2=T.factor1,v.velocityGradients.push(X)}}const M=T.getDragGradients();if(M){v.dragGradients=[];for(const T of M){const X={gradient:T.gradient,factor1:T.factor1};void 0!==T.factor2?X.factor2=T.factor2:X.factor2=T.factor1,v.dragGradients.push(X)}}const H=T.getEmitRateGradients();if(H){v.emitRateGradients=[];for(const T of H){const X={gradient:T.gradient,factor1:T.factor1};void 0!==T.factor2?X.factor2=T.factor2:X.factor2=T.factor1,v.emitRateGradients.push(X)}}const n=T.getStartSizeGradients();if(n){v.startSizeGradients=[];for(const T of n){const X={gradient:T.gradient,factor1:T.factor1};void 0!==T.factor2?X.factor2=T.factor2:X.factor2=T.factor1,v.startSizeGradients.push(X)}}const V=T.getLifeTimeGradients();if(V){v.lifeTimeGradients=[];for(const T of V){const X={gradient:T.gradient,factor1:T.factor1};void 0!==T.factor2?X.factor2=T.factor2:X.factor2=T.factor1,v.lifeTimeGradients.push(X)}}const D=T.getLimitVelocityGradients();if(D){v.limitVelocityGradients=[];for(const T of D){const X={gradient:T.gradient,factor1:T.factor1};void 0!==T.factor2?X.factor2=T.factor2:X.factor2=T.factor1,v.limitVelocityGradients.push(X)}v.limitVelocityDamping=T.limitVelocityDamping}T.noiseTexture&&(v.noiseTexture=T.noiseTexture.serialize())}clone(v,T){let X=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const O={...this._customWrappers};let u=null;const B=this._engine;if(B.createEffectForParticles&&null!=this.customShader){u=this.customShader;const v=u.shaderOptions.defines.length>0?u.shaderOptions.defines.join("\n"):"",T=B.createEffectForParticles(u.shaderPath.fragmentElement,u.shaderOptions.uniforms,u.shaderOptions.samplers,v);O[0]?O[0].effect=T:this.setCustomEffect(T,0)}const m=this.serialize(X),A=kv.Parse(m,this._scene||this._engine,this._rootUrl);return A.name=v,A.customShader=u,A._customWrappers=O,void 0===T&&(T=this.k),this.noiseTexture&&(A.noiseTexture=this.noiseTexture.clone()),A.k=T,this.preventAutoStart||A.start(),A}}kv.BILLBOARDMODE_Y=2,kv.BILLBOARDMODE_ALL=7,kv.BILLBOARDMODE_STRETCHED=8,kv.BILLBOARDMODE_STRETCHED_LOCAL=9,Av._ParseParticleSystem=kv.Parse;var bv=X(1236),lv=X(1209),Qv=X(1441);Qv.e.prototype.createTransformFeedback=function(){const v=this._gl.createTransformFeedback();if(!v)throw new Error("Unable to create Transform Feedback");return v},Qv.e.prototype.deleteTransformFeedback=function(v){this._gl.deleteTransformFeedback(v)},Qv.e.prototype.bindTransformFeedback=function(v){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,v)},Qv.e.prototype.beginTransformFeedback=function(){let v=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(v?this._gl.POINTS:this._gl.TRIANGLES)},Qv.e.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},Qv.e.prototype.setTranformFeedbackVaryings=function(v,T){this._gl.transformFeedbackVaryings(v,T,this._gl.INTERLEAVED_ATTRIBS)},Qv.e.prototype.bindTransformFeedbackBuffer=function(v){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,v?v.underlyingResource:null)},Qv.e.prototype.readTransformFeedbackBuffer=function(v){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,v)};const Kv="clipPlaneFragmentDeclaration2",pv="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";r.e.IncludesShadersStore[Kv]=pv;X(11451),X(11322),X(11242),X(11454),X(11481),X(11485),X(11514),X(11523);const Gv="gpuRenderParticlesPixelShader",Lv="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";r.e.ShadersStore[Gv]=Lv;const rv="clipPlaneVertexDeclaration2",ov="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";r.e.IncludesShadersStore[rv]=ov;X(11293),X(11371),X(11378),X(11396);const Zv="gpuRenderParticlesVertexShader",Uv="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";r.e.ShadersStore[Zv]=Uv;class Jv extends x{static get IsSupported(){if(!Y.c.LastCreatedEngine)return!1;const v=Y.c.LastCreatedEngine.getCaps();return v.supportTransformFeedbacks||v.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(v){this._maxActiveParticleCount=Math.min(v,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(v){this.maxActiveParticleCount=v}createPointEmitter(v,T){const X=fv(v,T);return this.particleEmitterType=X,X}createHemisphericEmitter(){const v=Mv(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=v,v}createSphereEmitter(){const v=Hv(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=v,v}createDirectedSphereEmitter(){const v=nv(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new O.l(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new O.l(0,1,0));return this.particleEmitterType=v,v}createCylinderEmitter(){const v=Vv(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=v,v}createDirectedCylinderEmitter(){const v=Dv(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new O.l(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new O.l(0,1,0));return this.particleEmitterType=v,v}createConeEmitter(){const v=sv(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=v,v}createDirectedConeEmitter(){const v=Fv(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new O.l(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new O.l(0,1,0));return this.particleEmitterType=v,v}createBoxEmitter(v,T,X,O){const u=new H;return this.particleEmitterType=u,this.direction1=v,this.direction2=T,this.minEmitBox=X,this.maxEmitBox=O,u}isReady(){if(!this.k||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==kv.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(kv.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(kv.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";v?setTimeout((()=>{this.start(0)}),v):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var v;let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(v=this._customWrappers[T])||void 0===v?void 0:v.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[v]??this._customWrappers[0]}setCustomEffect(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[T]=new vv.d(this._engine),this._customWrappers[T].effect=v}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new z.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(v,T,X){return super._removeGradientAndTexture(v,T,X),this._releaseBuffers(),this}addColorGradient(v,T){this._colorGradients||(this._colorGradients=[]);const X=new e(v,T);return this._colorGradients.push(X),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(v&&this._colorGradients.sort(((v,T)=>v.gradient<T.gradient?-1:v.gradient>T.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(v){return this._removeGradientAndTexture(v,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const T in this._drawWrappers){var v;null===(v=this._drawWrappers[T].drawContext)||void 0===v||v.reset()}}_addFactorGradient(v,T,X){const O=new S(T,X);v.push(O),this._releaseBuffers()}addSizeGradient(v,T){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,v,T),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(v){return this._removeGradientAndTexture(v,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(v,T){if(!v)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&v.sort(((v,T)=>v.gradient<T.gradient?-1:v.gradient>T.gradient?1:0));const X=this;X[T]&&(X[T].dispose(),X[T]=null)}addAngularSpeedGradient(v,T){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,v,T),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(v){return this._removeGradientAndTexture(v,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(v,T){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,v,T),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(v){return this._removeGradientAndTexture(v,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(v,T){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,v,T),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(v){return this._removeGradientAndTexture(v,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(v,T){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,v,T),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(v){return this._removeGradientAndTexture(v,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(v){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(v,T,X){let u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,B=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(v),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.ae=new z.b,this.onStoppedObservable=new z.b,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._onBeforeDrawParticlesObservable=null,X&&"Scene"!==X.getClassName()?(this._engine=X,this.defaultProjectionMatrix=O.b.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=X||Y.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Ae.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,A.c)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,A.c)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,A.c)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,A.c)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new vv.d(this._engine)},this._customWrappers[0].effect=u,this._drawWrappers={0:new vv.d(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(T=T??{}).randomTextureSize||delete T.randomTextureSize;const m={Re:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...T},x=T;isFinite(x)&&(m.Re=x),this._capacity=m.Re,this._maxActiveParticleCount=m.Re,this._currentActiveCount=0,this._isAnimationSheetEnabled=B,this.particleEmitterType=new H;const f=Math.min(this._engine.getCaps().maxTextureSize,m.randomTextureSize);let M=[];for(let O=0;O<f;++O)M.push(Math.random()),M.push(Math.random()),M.push(Math.random()),M.push(Math.random());this._randomTexture=new R.d(new Float32Array(M),f,1,5,X,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,M=[];for(let O=0;O<f;++O)M.push(Math.random()),M.push(Math.random()),M.push(Math.random()),M.push(Math.random());this._randomTexture2=new R.d(new Float32Array(M),f,1,5,X,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=f}_reset(){this._releaseBuffers()}_createVertexBuffers(v,T,X){const O={};O.position=T.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let u=3;O.age=T.createVertexBuffer("age",u,1,this._attributesStrideSize,!0),u+=1,O.size=T.createVertexBuffer("size",u,3,this._attributesStrideSize,!0),u+=3,O.life=T.createVertexBuffer("life",u,1,this._attributesStrideSize,!0),u+=1,u+=4,this.billboardMode===kv.BILLBOARDMODE_STRETCHED&&(O.direction=T.createVertexBuffer("direction",u,3,this._attributesStrideSize,!0)),u+=3,this._platform.alignDataInBuffer&&(u+=1),this.particleEmitterType instanceof Q&&(u+=3,this._platform.alignDataInBuffer&&(u+=1)),this._colorGradientsTexture||(O.color=T.createVertexBuffer("color",u,4,this._attributesStrideSize,!0),u+=4),this._isBillboardBased||(O.initialDirection=T.createVertexBuffer("initialDirection",u,3,this._attributesStrideSize,!0),u+=3,this._platform.alignDataInBuffer&&(u+=1)),this.noiseTexture&&(O.noiseCoordinates1=T.createVertexBuffer("noiseCoordinates1",u,3,this._attributesStrideSize,!0),u+=3,this._platform.alignDataInBuffer&&(u+=1),O.noiseCoordinates2=T.createVertexBuffer("noiseCoordinates2",u,3,this._attributesStrideSize,!0),u+=3,this._platform.alignDataInBuffer&&(u+=1)),O.angle=T.createVertexBuffer("angle",u,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?u++:u+=2,this._isAnimationSheetEnabled&&(O.cellIndex=T.createVertexBuffer("cellIndex",u,1,this._attributesStrideSize,!0),u+=1,this.spriteRandomStartCell&&(O.cellStartOffset=T.createVertexBuffer("cellStartOffset",u,1,this._attributesStrideSize,!0),u+=1)),O.offset=X.createVertexBuffer("offset",0,2),O.uv=X.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(O),this._platform.createVertexBuffers(v,O),this.resetDrawCache()}_initialize(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!v)return;const T=this._engine,X=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof Q&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const u=this.particleEmitterType instanceof Q,B=O.g.Vd[0];let m=0;for(let O=0;O<this._capacity;O++)if(X.push(0),X.push(0),X.push(0),X.push(0),X.push(0),X.push(0),X.push(0),X.push(0),X.push(Math.random()),X.push(Math.random()),X.push(Math.random()),X.push(Math.random()),u?(this.particleEmitterType.particleDestinationGenerator(O,null,B),X.push(B.x),X.push(B.y),X.push(B.z)):(X.push(0),X.push(0),X.push(0)),this._platform.alignDataInBuffer&&X.push(0),m+=16,u&&(this.particleEmitterType.particlePositionGenerator(O,null,B),X.push(B.x),X.push(B.y),X.push(B.z),this._platform.alignDataInBuffer&&X.push(0),m+=4),this._colorGradientsTexture||(X.push(0),X.push(0),X.push(0),X.push(0),m+=4),this.isBillboardBased||(X.push(0),X.push(0),X.push(0),this._platform.alignDataInBuffer&&X.push(0),m+=4),this.noiseTexture&&(X.push(Math.random()),X.push(Math.random()),X.push(Math.random()),this._platform.alignDataInBuffer&&X.push(0),X.push(Math.random()),X.push(Math.random()),X.push(Math.random()),this._platform.alignDataInBuffer&&X.push(0),m+=8),X.push(0),m+=1,this._angularSpeedGradientsTexture||(X.push(0),m+=1),this._isAnimationSheetEnabled&&(X.push(0),m+=1,this.spriteRandomStartCell&&(X.push(0),m+=1)),this._platform.alignDataInBuffer){let v=3-(m+3&3);for(m+=v;v-- >0;)X.push(0)}const A=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),x=this._platform.createParticleBuffer(X),f=this._platform.createParticleBuffer(X);this._buffer0=new K.d(T,x,!1,this._attributesStrideSize),this._buffer1=new K.d(T,f,!1,this._attributesStrideSize),this._spriteBuffer=new K.d(T,A,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let v=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(v+="\n#define BILLBOARD"),this._colorGradientsTexture&&(v+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(v+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(v+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(v+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(v+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(v+="\n#define DRAGGRADIENTS"),this.isAnimationSheetEnabled&&(v+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(v+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(v+="\n#define NOISE"),this.isLocal&&(v+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===v||(this._cachedUpdateDefines=v,this._updateBuffer=this._platform.createUpdateBuffer(v)),this._platform.isUpdateBufferReady()}_getWrapper(v){const T=this._getCustomDrawWrapper(v);if(null!==T&&void 0!==T&&T.effect)return T;const X=[];this.fillDefines(X,v);let O=this._drawWrappers[v];O||(O=new vv.d(this._engine),O.drawContext&&(O.drawContext.useInstancing=!0),this._drawWrappers[v]=O);const u=X.join("\n");if(O.defines!==u){const v=[],T=[],X=[];this.fillUniformsAttributesAndSamplerNames(T,v,X),O.setEffect(this._engine.createEffect("gpuRenderParticles",v,T,X,u),u)}return O}static _GetAttributeNamesOrOptions(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0],T=arguments.length>1&&void 0!==arguments[1]&&arguments[1],X=arguments.length>2&&void 0!==arguments[2]&&arguments[2],O=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const u=[K.e.PositionKind,"age","life","size","angle"];return v||u.push(K.e.ColorKind),T&&u.push("cellIndex"),X||u.push("initialDirection"),O&&u.push("direction"),u.push("offset",K.e.UVKind),u}static _GetEffectCreationOptions(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0],T=arguments.length>1&&void 0!==arguments[1]&&arguments[1],X=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const O=["emitterWM","Eg","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,Tv.c)(O),v&&O.push("sheetInfos"),T&&O.push("logarithmicDepthConstant"),X&&(O.push("vFogInfos"),O.push("vFogColor")),O}fillDefines(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,X=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,Tv.n)(this,this._scene,v),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==lv.e.FOGMODE_NONE&&v.push("#define FOG")),T===kv.BLENDMODE_MULTIPLY&&v.push("#define BLENDMULTIPLYMODE"),this.isLocal&&v.push("#define LOCAL"),this.useLogarithmicDepth&&v.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(v.push("#define BILLBOARD"),this.billboardMode){case kv.BILLBOARDMODE_Y:v.push("#define BILLBOARDY");break;case kv.BILLBOARDMODE_STRETCHED:v.push("#define BILLBOARDSTRETCHED");break;case kv.BILLBOARDMODE_ALL:v.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&v.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&v.push("#define ANIMATESHEET"),X&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),v.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(v,T,X){T.push(...Jv._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===kv.BILLBOARDMODE_STRETCHED)),v.push(...Jv._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),X.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(bv.e.PrepareUniforms(v,this._imageProcessingConfigurationDefines),bv.e.PrepareSamplers(X,this._imageProcessingConfigurationDefines))}animate(){var v;let T=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(T?this.preWarmStepOffset:(null===(v=this._scene)||void 0===v?void 0:v.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(v,T){const X=this[T];if(!v||!v.length||X)return;const O=new Float32Array(this._rawTextureWidth);for(let u=0;u<this._rawTextureWidth;u++){const T=u/this._rawTextureWidth;w.GetCurrentGradient(T,v,((v,T,X)=>{O[u]=(0,f.n)(v.factor1,T.factor1,X)}))}this[T]=R.d.CreateRTexture(O,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[T].name=T.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const v=new Uint8Array(4*this._rawTextureWidth),T=m.k.ke[0];for(let X=0;X<this._rawTextureWidth;X++){const O=X/this._rawTextureWidth;w.GetCurrentGradient(O,this._colorGradients,((O,u,B)=>{m.g.LerpToRef(O.color1,u.color1,B,T),v[4*X]=255*T.r,v[4*X+1]=255*T.g,v[4*X+2]=255*T.b,v[4*X+3]=255*T.a}))}this._colorGradientsTexture=R.d.CreateRGBATexture(v,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(v,T){var X,u,B,m;const A=this._getWrapper(v),x=A.effect;this._engine.enableEffect(A);const f=(null===(X=this._scene)||void 0===X?void 0:X.getViewMatrix())||O.b.IdentityReadOnly;if(x.setMatrix("view",f),x.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),x.setTexture("diffuseSampler",this.particleTexture),x.setVector2("translationPivot",this.translationPivot),x.setVector3("Eg",this.Eg),this.isLocal&&x.setMatrix("emitterWM",T),this._colorGradientsTexture?x.setTexture("colorGradientSampler",this._colorGradientsTexture):x.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const v=this.particleTexture.getBaseSize();x.setFloat3("sheetInfos",this.spriteCellWidth/v.width,this.spriteCellHeight/v.height,v.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const v=this._scene.activeCamera;x.setVector3("eyePosition",v.globalPosition)}const M=x.defines;if(this._scene&&((0,Tv.g)(x,this,this._scene),this.applyFog&&(0,Xv.e)(this._scene,void 0,x)),M.indexOf("#define BILLBOARDMODE_ALL")>=0){const v=f.clone();v.invert(),x.setMatrix("invView",v)}switch(this.useLogarithmicDepth&&this._scene&&(0,Xv.i)(M,x,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(x),v){case kv.BLENDMODE_ADD:this._engine.setAlphaMode(1);break;case kv.BLENDMODE_ONEONE:this._engine.setAlphaMode(6);break;case kv.BLENDMODE_STANDARD:this._engine.setAlphaMode(2);break;case kv.BLENDMODE_MULTIPLY:this._engine.setAlphaMode(4)}return this._platform.bindDrawBuffers(this._targetIndex,x,null!==(u=this._scene)&&void 0!==u&&u.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(x),null!==(B=this._scene)&&void 0!==B&&B.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(m=this._scene)&&void 0!==m&&m.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(v){if(!this.k||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!v)if(this.k.position){v=this.k.getWorldMatrix()}else{const T=this.k;v=O.g.Matrix[0],O.b.TranslationToRef(T.x,T.y,T.z,v)}this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this.isLocal||this._updateBuffer.setMatrix("emitterWM",v),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const T=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=T}render(){let v,T=arguments.length>0&&void 0!==arguments[0]&&arguments[0],X=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!T&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let v=0;v<this.preWarmCycles;v++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>1){const v=0|this._accumulatedCount;this._accumulatedCount-=v,this._currentActiveCount+=v}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.k.position){v=this.k.getWorldMatrix()}else{const T=this.k;v=O.g.Matrix[0],O.b.TranslationToRef(T.x,T.y,T.z,v)}const u=this._engine;this.updateInAnimate||this._update(v);let B=0;return T||X||(u.setState(!1),this.forceDepthWrite&&u.setDepthWrite(!0),B=this.blendMode===kv.BLENDMODE_MULTIPLYADD?this._render(kv.BLENDMODE_MULTIPLY,v)+this._render(kv.BLENDMODE_ADD,v):this._render(this.blendMode,v),this._engine.setAlphaMode(0)),B}rebuild(){const v=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(v,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,v()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let v=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const T in this._drawWrappers){this._drawWrappers[T].dispose()}if(this._drawWrappers={},this._scene){const v=this._scene.Ae.indexOf(this);v>-1&&this._scene.Ae.splice(v,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let T=0;T<this._renderVertexBuffers.length;++T){const v=this._renderVertexBuffers[T];for(const T in v)v[T].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),v&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),v&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.ae.notifyObservers(this),this.ae.clear()}clone(v,T){let X=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const O={...this._customWrappers};let u=null;const B=this._engine;if(B.createEffectForParticles&&null!=this.customShader){u=this.customShader;const v=u.shaderOptions.defines.length>0?u.shaderOptions.defines.join("\n"):"";O[0]=B.createEffectForParticles(u.shaderPath.fragmentElement,u.shaderOptions.uniforms,u.shaderOptions.samplers,v,void 0,void 0,void 0,this)}const m=this.serialize(X),A=Jv.Parse(m,this._scene||this._engine,this._rootUrl);return A.name=v,A.customShader=u,A._customWrappers=O,void 0===T&&(T=this.k),this.noiseTexture&&(A.noiseTexture=this.noiseTexture.clone()),A.k=T,A}serialize(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const T={};return kv._Serialize(T,this,v),T.activeParticleCount=this.activeParticleCount,T.randomTextureSize=this._randomTextureSize,T.customShader=this.customShader,T}static Parse(v,T,X){let O=arguments.length>3&&void 0!==arguments[3]&&arguments[3],u=arguments.length>4?arguments[4]:void 0;const B=v.name;let m,A;T instanceof xv.e?m=T:(A=T,m=A.getEngine());const x=new Jv(B,{Re:u||v.Re,randomTextureSize:v.randomTextureSize},T,null,v.isAnimationSheetEnabled);if(x._rootUrl=X,v.customShader&&m.createEffectForParticles){const T=v.customShader,X=T.shaderOptions.defines.length>0?T.shaderOptions.defines.join("\n"):"",O=m.createEffectForParticles(T.shaderPath.fragmentElement,T.shaderOptions.uniforms,T.shaderOptions.samplers,X,void 0,void 0,void 0,x);x.setCustomEffect(O,0),x.customShader=T}return v.id&&(x.id=v.id),v.activeParticleCount&&(x.activeParticleCount=v.activeParticleCount),kv._Parse(v,x,T,X),v.preventAutoStart&&(x.preventAutoStart=v.preventAutoStart),O||x.preventAutoStart||x.start(),x}}var yv=X(1217),Pv=X(12093),av=X(1199);class Ev{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(v){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const T of this.systems)T.k=v;this._emitterNode=v}setEmitterAsSphere(v,T,X){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:v,renderingGroupId:T};const O=(0,Pv.d)("emitterSphere",{diameter:v.diameter,segments:v.segments},X);O.renderingGroupId=T;const u=new av.d("emitterSphereMaterial",X);u.emissiveColor=v.color,O.material=u;for(const B of this.systems)B.k=O;this._emitterNode=O}start(v){for(const T of this.systems)v&&(T.k=v),T.start()}dispose(){for(const v of this.systems)v.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const T={systems:[]};for(const X of this.systems)T.systems.push(X.serialize(v));return this._emitterNode&&(T.k=this._emitterCreationOptions),T}static Parse(v,T){let X=arguments.length>2&&void 0!==arguments[2]&&arguments[2],O=arguments.length>3?arguments[3]:void 0;const u=new Ev,B=this.BaseAssetsUrl+"/textures/";T=T||Y.c.LastCreatedScene;for(const m of v.systems)u.systems.push(X?Jv.Parse(m,T,B,!0,O):kv.Parse(m,T,B,!0,O));if(v.k){const X=v.k.options;if("Sphere"===v.k.kind)u.setEmitterAsSphere({diameter:X.diameter,segments:X.segments,color:m.d.Ld(X.color)},v.k.renderingGroupId,T)}return u}}Ev.BaseAssetsUrl="https://assets.babylonjs.com/particles";var iv=X(1070);class tv{static CreateDefault(v){let T,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,O=arguments.length>2?arguments[2]:void 0;return T=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new Jv("default system",{Re:X},O):new kv("default system",X,O),T.k=v,T.particleTexture=new i.e("https://assets.babylonjs.com/textures/flare.png",T.va()),T.createConeEmitter(.1,Math.PI/4),T.color1=new m.g(1,1,1,1),T.color2=new m.g(1,1,1,1),T.colorDead=new m.g(1,1,1,0),T.minSize=.1,T.maxSize=.1,T.minEmitPower=2,T.maxEmitPower=2,T.updateSpeed=1/60,T.emitRate=30,T}static CreateAsync(v,T){let X=arguments.length>2&&void 0!==arguments[2]&&arguments[2],O=arguments.length>3?arguments[3]:void 0;T||(T=Y.c.LastCreatedScene);const u={};return T.addPendingData(u),new Promise(((B,m)=>{if(X&&!Jv.IsSupported)return T.removePendingData(u),m("Particle system with GPU is not supported.");yv.c.LoadFile(`${tv.BaseAssetsUrl}/systems/${v}.json`,(v=>{T.removePendingData(u);const m=JSON.parse(v.toString());return B(Ev.Parse(m,T,X,O))}),void 0,void 0,void 0,(()=>(T.removePendingData(u),m(`An error occurred with the creation of your particle system. Check if your type '${v}' exists.`))))}))}static ExportSet(v){const T=new Ev;for(const X of v)T.systems.push(X);return T}static ParseFromFileAsync(v,T,X){let O=arguments.length>3&&void 0!==arguments[3]&&arguments[3],u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",B=arguments.length>5?arguments[5]:void 0;return new Promise(((m,A)=>{const x=new iv.b;x.addEventListener("readystatechange",(()=>{if(4==x.readyState)if(200==x.status){const T=JSON.parse(x.responseText);let A;A=O?Jv.Parse(T,X,u,!1,B):kv.Parse(T,X,u,!1,B),v&&(A.name=v),m(A)}else A("Unable to load the particle system")})),x.open("GET",T),x.send()}))}static ParseFromSnippetAsync(v,T){let X=arguments.length>2&&void 0!==arguments[2]&&arguments[2],O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",u=arguments.length>4?arguments[4]:void 0;if("_BLANK"===v){const v=this.CreateDefault(null);return v.start(),Promise.resolve(v)}return new Promise(((B,m)=>{const A=new iv.b;A.addEventListener("readystatechange",(()=>{if(4==A.readyState)if(200==A.status){const m=JSON.parse(JSON.parse(A.responseText).jsonPayload),x=JSON.parse(m.particleSystem);let f;f=X?Jv.Parse(x,T,O,!1,u):kv.Parse(x,T,O,!1,u),f.snippetId=v,B(f)}else m("Unable to load the snippet "+v)})),A.open("GET",this.SnippetUrl+"/"+v.replace(/#/g,"/")),A.send()}))}}tv.BaseAssetsUrl=Ev.BaseAssetsUrl,tv.SnippetUrl="https://snippet.babylonjs.com",tv.CreateFromSnippetAsync=tv.ParseFromSnippetAsync;var Cv=X(11911),cv=X(1290),Nv=X(12102);(0,Nv.h)(cv.d.NAME_PARTICLESYSTEM,((v,T,X,O)=>{const u=(0,Nv.i)(cv.d.NAME_PARTICLESYSTEM);if(u&&void 0!==v.Ae&&null!==v.Ae)for(let B=0,m=v.Ae.length;B<m;B++){const m=v.Ae[B];X.Ae.push(u(m,T,O))}})),(0,Nv.d)(cv.d.NAME_PARTICLESYSTEM,((v,T,X)=>{if(v.activeParticleCount){return Jv.Parse(v,T,X)}return kv.Parse(v,T,X)})),xv.e.prototype.createEffectForParticles=function(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",B=arguments.length>4?arguments[4]:void 0,m=arguments.length>5?arguments[5]:void 0,A=arguments.length>6?arguments[6]:void 0,x=arguments.length>7?arguments[7]:void 0,f=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,M=[],H=[];const n=[];return x?x.fillUniformsAttributesAndSamplerNames(H,M,n):(M=kv._GetAttributeNamesOrOptions(),H=kv._GetEffectCreationOptions()),-1===u.indexOf(" BILLBOARD")&&(u+="\n#define BILLBOARD\n"),null!==x&&void 0!==x&&x.isAnimationSheetEnabled&&-1===u.indexOf(" ANIMATESHEET")&&(u+="\n#define ANIMATESHEET\n"),-1===O.indexOf("diffuseSampler")&&O.push("diffuseSampler"),this.createEffect({vertex:(null===x||void 0===x?void 0:x.vertexShaderName)??"particles",fragmentElement:v},M,H.concat(T),n.concat(O),u,B,m,A,void 0,f,(async()=>{0===f?await Promise.resolve().then(X.bind(X,12124)):await Promise.resolve().then(X.bind(X,12135))}))},Cv.d.prototype.getEmittedParticleSystems=function(){const v=[];for(let T=0;T<this.va().Ae.length;T++){const X=this.va().Ae[T];X.k===this&&v.push(X)}return v},Cv.d.prototype.getHierarchyEmittedParticleSystems=function(){const v=[],T=this.getDescendants();T.push(this);for(let X=0;X<this.va().Ae.length;X++){const O=this.va().Ae[X],u=O.k;u.position&&-1!==T.indexOf(u)&&v.push(O)}return v};X(1371),X(1378),X(11951);X(11937),X(12106),X(1495),X(1356),X(11964);X(1488);var dv;X(12109),X(1047);!function(v){v[v.Color=2]="Color",v[v.UV=1]="UV",v[v.Random=0]="Random",v[v.Stated=3]="Stated"}(dv||(dv={}));X(12116),X(12124),X(12131),X(12135)},11156:(v,T,X)=>{"use strict";const O="clipPlaneFragment",u="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";X(1120).e.IncludesShadersStoreWGSL[O]=u},11140:(v,T,X)=>{"use strict";const O="clipPlaneFragmentDeclaration",u="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";X(1120).e.IncludesShadersStoreWGSL[O]=u},11052:(v,T,X)=>{"use strict";const O="clipPlaneVertex",u="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";X(1120).e.IncludesShadersStoreWGSL[O]=u},10966:(v,T,X)=>{"use strict";const O="clipPlaneVertexDeclaration",u="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";X(1120).e.IncludesShadersStoreWGSL[O]=u},11194:(v,T,X)=>{"use strict";const O="fogFragment",u="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";X(1120).e.IncludesShadersStoreWGSL[O]=u},11148:(v,T,X)=>{"use strict";const O="fogFragmentDeclaration",u="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";X(1120).e.IncludesShadersStoreWGSL[O]=u},11058:(v,T,X)=>{"use strict";const O="fogVertex",u="#ifdef FOG\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#endif\n";X(1120).e.IncludesShadersStoreWGSL[O]=u},10975:(v,T,X)=>{"use strict";const O="fogVertexDeclaration",u="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";X(1120).e.IncludesShadersStoreWGSL[O]=u},10922:(v,T,X)=>{"use strict";const O="helperFunctions",u="const PI: f32=3.1415926535897932384626433832795;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3<f32>=vec3<f32> (0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(0.0),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);} \nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3<f32>=inMatrix[0];let i1: vec3<f32>=inMatrix[1];let i2: vec3<f32>=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3<f32>)->vec3<f32>\n{let nearZeroSection: vec3<f32>=0.0773993808*color;let remainingSection: vec3<f32>=pow(0.947867299*(color+vec3<f32>(0.055)),vec3<f32>(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3<f32>(0.04045)));}\nfn toGammaSpaceExact(color: vec3<f32>)->vec3<f32>\n{let nearZeroSection: vec3<f32>=12.92*color;let remainingSection: vec3<f32>=1.055*pow(color,vec3<f32>(0.41666))-vec3<f32>(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3<f32>(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3<f32>)->vec3<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3<f32>(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3<f32>(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3<f32>)->vec3<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3<f32>(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3<f32>)->vec3<f32>\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3<f32>)->f32\n{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3<f32>)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3<f32> =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(clamp(rgb,vec3<f32>(0.,0.,0.),vec3<f32>(1.,1.,1.)),D); }\nfn fromRGBD(rgbd: vec4<f32>)->vec3<f32> {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3<f32>,origVec: vec3<f32>,cubeSize: vec3<f32>,cubePos: vec3<f32>)->vec3<f32> {let invOrigVec: vec3<f32>=vec3<f32>(1.0,1.0,1.0)/origVec;let halfSize: vec3<f32>=cubeSize*0.5;let intersecAtMaxPlane: vec3<f32>=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3<f32>=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3<f32>=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3<f32>=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\n";X(1120).e.IncludesShadersStoreWGSL[O]=u},11115:(v,T,X)=>{"use strict";const O="imageProcessingDeclaration",u="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";X(1120).e.IncludesShadersStoreWGSL[O]=u},11119:(v,T,X)=>{"use strict";const O="imageProcessingFunctions",u="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";X(1120).e.IncludesShadersStoreWGSL[O]=u},10992:(v,T,X)=>{"use strict";const O="logDepthDeclaration",u="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";X(1120).e.IncludesShadersStoreWGSL[O]=u},11189:(v,T,X)=>{"use strict";const O="logDepthFragment",u="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";X(1120).e.IncludesShadersStoreWGSL[O]=u},11074:(v,T,X)=>{"use strict";const O="logDepthVertex",u="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";X(1120).e.IncludesShadersStoreWGSL[O]=u},12131:(v,T,X)=>{"use strict";X.r(T),X.d(T,{particlesPixelShaderWGSL:()=>m});var O=X(1120);X(11140),X(11115),X(10992),X(10922),X(11119),X(11148),X(11156),X(11189),X(11194);const u="particlesPixelShader",B="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";O.e.ShadersStoreWGSL[u]=B;const m={name:u,shader:B}},12135:(v,T,X)=>{"use strict";X.r(T),X.d(T,{particlesVertexShaderWGSL:()=>m});var O=X(1120);X(10966),X(10975),X(10992),X(11052),X(11058),X(11074);const u="particlesVertexShader",B="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return input.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";O.e.ShadersStoreWGSL[u]=B;const m={name:u,shader:B}},11485:(v,T,X)=>{"use strict";const O="clipPlaneFragment",u="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";X(1120).e.IncludesShadersStore[O]=u},11479:(v,T,X)=>{"use strict";const O="clipPlaneFragmentDeclaration",u="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";X(1120).e.IncludesShadersStore[O]=u},11371:(v,T,X)=>{"use strict";const O="clipPlaneVertex",u="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";X(1120).e.IncludesShadersStore[O]=u},11287:(v,T,X)=>{"use strict";const O="clipPlaneVertexDeclaration",u="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";X(1120).e.IncludesShadersStore[O]=u},11523:(v,T,X)=>{"use strict";const O="fogFragment",u="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";X(1120).e.IncludesShadersStore[O]=u},11481:(v,T,X)=>{"use strict";const O="fogFragmentDeclaration",u="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";X(1120).e.IncludesShadersStore[O]=u},11378:(v,T,X)=>{"use strict";const O="fogVertex",u="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";X(1120).e.IncludesShadersStore[O]=u},11293:(v,T,X)=>{"use strict";const O="fogVertexDeclaration",u="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";X(1120).e.IncludesShadersStore[O]=u},11242:(v,T,X)=>{"use strict";const O="helperFunctions",u="const float PI=3.1415926535897932384626433832795;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.0;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(clamp(rgb,0.,1.),D); }\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.0,1.0,1.0)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\n";X(1120).e.IncludesShadersStore[O]=u},11451:(v,T,X)=>{"use strict";const O="imageProcessingDeclaration",u="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";X(1120).e.IncludesShadersStore[O]=u},11454:(v,T,X)=>{"use strict";const O="imageProcessingFunctions",u="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";X(1120).e.IncludesShadersStore[O]=u},11322:(v,T,X)=>{"use strict";const O="logDepthDeclaration",u="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";X(1120).e.IncludesShadersStore[O]=u},11514:(v,T,X)=>{"use strict";const O="logDepthFragment",u="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";X(1120).e.IncludesShadersStore[O]=u},11396:(v,T,X)=>{"use strict";const O="logDepthVertex",u="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";X(1120).e.IncludesShadersStore[O]=u},12116:(v,T,X)=>{"use strict";X.r(T),X.d(T,{particlesPixelShader:()=>m});var O=X(1120);X(11479),X(11451),X(11322),X(11242),X(11454),X(11481),X(11485),X(11514),X(11523);const u="particlesPixelShader",B="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";O.e.ShadersStore[u]=B;const m={name:u,shader:B}},12124:(v,T,X)=>{"use strict";X.r(T),X.d(T,{particlesVertexShader:()=>m});var O=X(1120);X(11287),X(11293),X(11322),X(11371),X(11378),X(11396);const u="particlesVertexShader",B="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";O.e.ShadersStore[u]=B;const m={name:u,shader:B}},11928:(v,T,X)=>{"use strict";X.d(T,{e:()=>H});var O=X(985),u=X(1006),B=X(994),m=X(1001),A=X(1034),x=X(1095),f=X(1156);class M{constructor(){this._doNotSerialize=!1,this._isDisposed=!1,this._sceneRootNodesIndex=-1,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._onEnabledStateChangedObservable=new m.b,this._onClonedObservable=new m.b}}class H{static AddNodeConstructor(v,T){this._NodeConstructors[v]=T}static Construct(v,T,X,O){const u=this._NodeConstructors[v];return u?u(T,X,O):null}set accessibilityTag(v){this._accessibilityTag=v,this.onAccessibilityTagChangedObservable.notifyObservers(v)}get accessibilityTag(){return this._accessibilityTag}get doNotSerialize(){return!!this._nodeDataStorage._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize}set doNotSerialize(v){this._nodeDataStorage._doNotSerialize=v}u(){return this._nodeDataStorage._isDisposed}set parent(v){if(this._parentNode===v)return;const T=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){const T=this._parentNode._children.indexOf(this);-1!==T&&this._parentNode._children.splice(T,1),v||this._nodeDataStorage._isDisposed||this._addToSceneRootNodes()}this._parentNode=v,this._isDirty=!0,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),T||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}get parent(){return this._parentNode}_serializeAsParent(v){v.parentId=this.uniqueId}_addToSceneRootNodes(){-1===this._nodeDataStorage._sceneRootNodesIndex&&(this._nodeDataStorage._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))}_removeFromSceneRootNodes(){if(-1!==this._nodeDataStorage._sceneRootNodesIndex){const v=this._scene.rootNodes,T=v.length-1;v[this._nodeDataStorage._sceneRootNodesIndex]=v[T],v[this._nodeDataStorage._sceneRootNodesIndex]._nodeDataStorage._sceneRootNodesIndex=this._nodeDataStorage._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._nodeDataStorage._sceneRootNodesIndex=-1}}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(v){this._animationPropertiesOverride=v}getClassName(){return"Node"}set onDispose(v){this._onDisposeObserver&&this.ae.remove(this._onDisposeObserver),this._onDisposeObserver=this.ae.add(v)}get onEnabledStateChangedObservable(){return this._nodeDataStorage._onEnabledStateChangedObservable}get onClonedObservable(){return this._nodeDataStorage._onClonedObservable}constructor(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,X=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._isDirty=!1,this._nodeDataStorage=new M,this.state="",this.metadata=null,this.reservedDataStore=null,this._accessibilityTag=null,this.onAccessibilityTagChangedObservable=new m.b,this._parentContainer=null,this.animations=[],this._ranges={},this.onReady=null,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._waitingParentInstanceIndex=null,this._waitingParsedUniqueId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=u.b.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._animationPropertiesOverride=null,this._isNode=!0,this.ae=new m.b,this._onDisposeObserver=null,this._behaviors=new Array,this.name=v,this.id=v,this._scene=T||A.c.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache(),X&&this._addToSceneRootNodes()}va(){return this._scene}getEngine(){return this._scene.getEngine()}addBehavior(v){let T=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return-1!==this._behaviors.indexOf(v)||(v.init(),this._scene.isLoading&&!T?this._scene.onDataLoadedObservable.addOnce((()=>{v.attach(this)})):v.attach(this),this._behaviors.push(v)),this}removeBehavior(v){const T=this._behaviors.indexOf(v);return-1===T||(this._behaviors[T].detach(),this._behaviors.splice(T,1)),this}get behaviors(){return this._behaviors}getBehaviorByName(v){for(const T of this._behaviors)if(T.name===v)return T;return null}getWorldMatrix(){return this._currentRenderId!==this._scene.getRenderId()&&this.Ke(),this._worldMatrix}_getWorldMatrixDeterminant(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant}get worldMatrixFromCache(){return this._worldMatrix}_initCache(){this._cache={}}updateCache(v){!v&&this.isSynchronized()||this._updateCache()}_getActionManagerForTrigger(v){return this.parent?this.parent._getActionManagerForTrigger(v,!1):null}_updateCache(v){}_isSynchronized(){return!0}_markSyncedWithParent(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)}isSynchronizedWithParent(){return!this._parentNode||!this._parentNode._isDirty&&this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()}isSynchronized(){return!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()}isReady(){return this._nodeDataStorage._isReady}Oe(v){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}isEnabled(){return!1===(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])?this._nodeDataStorage._isEnabled:!!this._nodeDataStorage._isEnabled&&this._nodeDataStorage._isParentEnabled}_syncParentEnabledState(){this._nodeDataStorage._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children&&this._children.forEach((v=>{v._syncParentEnabledState()}))}Qg(v){this._nodeDataStorage._isEnabled!==v&&(this._nodeDataStorage._isEnabled=v,this._syncParentEnabledState(),this._nodeDataStorage._onEnabledStateChangedObservable.notifyObservers(v))}isDescendantOf(v){return!!this.parent&&(this.parent===v||this.parent.isDescendantOf(v))}_getDescendants(v){let T=arguments.length>1&&void 0!==arguments[1]&&arguments[1],X=arguments.length>2?arguments[2]:void 0;if(this._children)for(let O=0;O<this._children.length;O++){const u=this._children[O];X&&!X(u)||v.push(u),T||u._getDescendants(v,!1,X)}}getDescendants(v,T){const X=[];return this._getDescendants(X,v,T),X}getChildMeshes(v,T){const X=[];return this._getDescendants(X,v,(v=>(!T||T(v))&&void 0!==v.bf)),X}getChildren(v){let T=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.getDescendants(T,v)}_setReady(v){v!==this._nodeDataStorage._isReady&&(v?(this.onReady&&this.onReady(this),this._nodeDataStorage._isReady=!0):this._nodeDataStorage._isReady=!1)}getAnimationByName(v){for(let T=0;T<this.animations.length;T++){const X=this.animations[T];if(X.name===v)return X}return null}createAnimationRange(v,T,X){if(!this._ranges[v]){this._ranges[v]=H._AnimationRangeFactory(v,T,X);for(let O=0,u=this.animations.length;O<u;O++)this.animations[O]&&this.animations[O].createRange(v,T,X)}}deleteAnimationRange(v){let T=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let X=0,O=this.animations.length;X<O;X++)this.animations[X]&&this.animations[X].deleteRange(v,T);this._ranges[v]=null}getAnimationRange(v){return this._ranges[v]||null}clone(v,T,X){const O=f.e.Clone((()=>new H(v,this.va())),this);if(T&&(O.parent=T),!X){const T=this.getDescendants(!0);for(let X=0;X<T.length;X++){const u=T[X];u.clone(v+"."+u.name,O)}}return O}getAnimationRanges(){const v=[];let T;for(T in this._ranges)v.push(this._ranges[T]);return v}beginAnimation(v,T,X,O){const u=this.getAnimationRange(v);return u?this._scene.beginAnimation(this,u.from,u.to,T,X,O):null}serializeAnimationRanges(){const v=[];for(const T in this._ranges){const X=this._ranges[T];if(!X)continue;const O={};O.name=T,O.from=X.from,O.to=X.to,v.push(O)}return v}Ke(v){return this._worldMatrix||(this._worldMatrix=u.b.Identity()),this._worldMatrix}dispose(v){let T=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._nodeDataStorage._isDisposed=!0,!v){const X=this.getDescendants(!0);for(const O of X)O.dispose(v,T)}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.ae.notifyObservers(this),this.ae.clear(),this.onEnabledStateChangedObservable.clear(),this.onClonedObservable.clear();for(const X of this._behaviors)X.detach();this._behaviors.length=0,this.metadata=null}static ParseAnimationRanges(v,T,X){if(T.ranges)for(let O=0;O<T.ranges.length;O++){const X=T.ranges[O];v.createAnimationRange(X.name,X.from,X.to)}}getHierarchyBoundingVectors(){let v,T,X=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.va().incrementRenderId(),this.Ke(!0);const B=this;if(B.getBoundingInfo&&B.Ce){const X=B.getBoundingInfo();v=X.boundingBox.minimumWorld.clone(),T=X.boundingBox.maximumWorld.clone()}else v=new u.l(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),T=new u.l(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(X){const X=this.getDescendants(!1);for(const B of X){const X=B;if(X.Ke(!0),O&&!O(X))continue;if(!X.getBoundingInfo||0===X.getTotalVertices())continue;const m=X.getBoundingInfo().boundingBox,A=m.minimumWorld,x=m.maximumWorld;u.l.CheckExtends(A,v,T),u.l.CheckExtends(x,v,T)}}return{min:v,max:T}}}H._AnimationRangeFactory=(v,T,X)=>{throw(0,x.d)("AnimationRange")},H._NodeConstructors={},(0,O.c)([(0,B.G)()],H.prototype,"name",void 0),(0,O.c)([(0,B.G)()],H.prototype,"id",void 0),(0,O.c)([(0,B.G)()],H.prototype,"uniqueId",void 0),(0,O.c)([(0,B.G)()],H.prototype,"state",void 0),(0,O.c)([(0,B.G)()],H.prototype,"metadata",void 0)},12506:(v,T,X)=>{"use strict";class O{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((v,T)=>{this._resolve=v,this._reject=T}))}}var u=X(1006),B=X(1170),m=X(1217),A=X(11921),x=X(12513),f=X(12530),M=X(1001),H=X(12091),n=X(12532),V=X(12536),D=X(1034),s=X(1103),F=X(1223);class k{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(v){this._useTextureToStoreBoneMatrices=v,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(v){this._animationPropertiesOverride=v}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(v,T,X){this.name=v,this.id=T,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=u.b.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new M.b,this.bones=[],this._scene=X||D.c.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const O=this._scene.getEngine().getCaps();this._canUseTextureForBones=O.textureFloat&&O.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((v=>!v.getParent()))}getTransformMatrices(v){if(this.needInitialSkinMatrix){if(!v)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return v._bonesTransformMatrices||this.prepare(!0),v._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(v){return this.needInitialSkinMatrix&&v._transformMatrixTexture?v._transformMatrixTexture:this._transformMatrixTexture}va(){return this._scene}toString(v){let T=`Name: ${this.name}, nBones: ${this.bones.length}`;if(T+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,v){T+=", Ranges: {";let v=!0;for(const X in this._ranges)v&&(T+=", ",v=!1),T+=X;T+="}"}return T}getBoneIndexByName(v){for(let T=0,X=this.bones.length;T<X;T++)if(this.bones[T].name===v)return T;return-1}createAnimationRange(v,T,X){if(!this._ranges[v]){this._ranges[v]=new V.b(v,T,X);for(let O=0,u=this.bones.length;O<u;O++)this.bones[O].animations[0]&&this.bones[O].animations[0].createRange(v,T,X)}}deleteAnimationRange(v){let T=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let X=0,O=this.bones.length;X<O;X++)this.bones[X].animations[0]&&this.bones[X].animations[0].deleteRange(v,T);this._ranges[v]=null}getAnimationRange(v){return this._ranges[v]||null}getAnimationRanges(){const v=[];let T;for(T in this._ranges)v.push(this._ranges[T]);return v}copyAnimationRange(v,T){let X=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[T]||!v.getAnimationRange(T))return!1;let O=!0;const u=this._getHighestAnimationFrame()+1,B={},m=v.bones;let A,x;for(x=0,A=m.length;x<A;x++)B[m[x].name]=m[x];this.bones.length!==m.length&&(s.d.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${m.length}`),O=!1);const f=X&&this.dimensionsAtRest&&v.dimensionsAtRest?this.dimensionsAtRest.divide(v.dimensionsAtRest):null;for(x=0,A=this.bones.length;x<A;x++){const v=this.bones[x].name,m=B[v];m?O=O&&this.bones[x].copyAnimationRange(m,T,u,X,f):(s.d.Warn("copyAnimationRange: not same rig, missing source bone "+v),O=!1)}const M=v.getAnimationRange(T);return M&&(this._ranges[T]=new V.b(T,M.from+u,M.to+u)),O}returnToRest(){for(const v of this.bones)-1!==v._index&&v.returnToRest()}_getHighestAnimationFrame(){let v=0;for(let T=0,X=this.bones.length;T<X;T++)if(this.bones[T].animations[0]){const X=this.bones[T].animations[0].getHighestFrame();v<X&&(v=X)}return v}beginAnimation(v,T,X,O){const u=this.getAnimationRange(v);return u?this._scene.beginAnimation(this,u.from,u.to,T,X,O):null}static MakeAnimationAdditive(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,X=arguments.length>2?arguments[2]:void 0;const O=v.getAnimationRange(X);if(!O)return null;const u=v._scene.getAllAnimatablesByTarget(v);let B=null;for(let A=0;A<u.length;A++){const v=u[A];if(v.fromFrame===(null===O||void 0===O?void 0:O.from)&&v.toFrame===(null===O||void 0===O?void 0:O.to)){B=v;break}}const m=v.getAnimatables();for(let A=0;A<m.length;A++){const v=m[A].animations;if(v)for(let O=0;O<v.length;O++)n.e.MakeAnimationAdditive(v[O],T,X)}return B&&(B.isAdditive=!0),v}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(v){this._meshesWithPoseMatrix.push(v)}_unregisterMeshWithPoseMatrix(v){const T=this._meshesWithPoseMatrix.indexOf(v);T>-1&&this._meshesWithPoseMatrix.splice(T,1)}_computeTransformMatrices(v,T){this.onBeforeComputeObservable.notifyObservers(this);for(let X=0;X<this.bones.length;X++){const O=this.bones[X];O._childUpdateId++;const u=O.getParent();if(u?O.getLocalMatrix().multiplyToRef(u.getFinalMatrix(),O.getFinalMatrix()):T?O.getLocalMatrix().multiplyToRef(T,O.getFinalMatrix()):O.getFinalMatrix().p(O.getLocalMatrix()),-1!==O._index){const T=null===O._index?X:O._index;O.getAbsoluteInverseBindMatrix().multiplyToArray(O.getFinalMatrix(),v,16*T)}}this._identity.copyToArray(v,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const v=this.va().getRenderId();if(this._currentRenderId===v)return;this._currentRenderId=v}if(this._numBonesWithLinkedTransformNode>0)for(const v of this.bones)if(v._linkedTransformNode){const T=v._linkedTransformNode;v.position=T.position,T.rotationQuaternion?v.rotationQuaternion=T.rotationQuaternion:v.rotation=T.rotation,v.Zd=T.Zd}if(this.needInitialSkinMatrix)for(const v of this._meshesWithPoseMatrix){const T=v.getPoseMatrix();let X=this._isDirty;if(v._bonesTransformMatrices&&v._bonesTransformMatrices.length===16*(this.bones.length+1)||(v._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),X=!0),X){if(this._synchronizedWithMesh!==v){this._synchronizedWithMesh=v;for(const v of this.bones)if(!v.getParent()){v.getBindMatrix().multiplyToRef(T,u.g.Matrix[1]),v._updateAbsoluteBindMatrices(u.g.Matrix[1])}if(this.isUsingTextureForMatrices){const T=4*(this.bones.length+1);v._transformMatrixTexture&&v._transformMatrixTexture.getSize().width===T||(v._transformMatrixTexture&&v._transformMatrixTexture.dispose(),v._transformMatrixTexture=H.d.CreateRGBATexture(v._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(v._bonesTransformMatrices,T),this.isUsingTextureForMatrices&&v._transformMatrixTexture&&v._transformMatrixTexture.update(v._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=H.d.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let v=0;v<this.bones.length;v++)this._animatables.push(this.bones[v])}return this._animatables}clone(v,T){const X=new k(v,T||v,this._scene);X.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let O=0;O<this.bones.length;O++){const v=this.bones[O];let T=null;const u=v.getParent();if(u){const v=this.bones.indexOf(u);T=X.bones[v]}const B=new f.c(v.name,X,T,v.getBindMatrix().clone(),v.getRestMatrix().clone());B._index=v._index,v._linkedTransformNode&&B.linkTransformNode(v._linkedTransformNode),F.d.DeepCopy(v.animations,B.animations)}if(this._ranges){X._ranges={};for(const v in this._ranges){const T=this._ranges[v];T&&(X._ranges[v]=T.clone())}}return this._isDirty=!0,X.prepare(!0),X}enableBlending(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;this.bones.forEach((T=>{T.animations.forEach((T=>{T.enableBlending=!0,T.blendingSpeed=v}))}))}dispose(){if(this._meshesWithPoseMatrix.length=0,this.va().stopAnimation(this),this.va().removeSkeleton(this),this._parentContainer){const v=this._parentContainer.skeletons.indexOf(this);v>-1&&this._parentContainer.skeletons.splice(v,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const v={};v.name=this.name,v.id=this.id,this.dimensionsAtRest&&(v.dimensionsAtRest=this.dimensionsAtRest.Pd()),v.bones=[],v.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let X=0;X<this.bones.length;X++){var T;const O=this.bones[X],u=O.getParent(),B={parentBoneIndex:u?this.bones.indexOf(u):-1,index:O.getIndex(),name:O.name,id:O.id,matrix:O.getBindMatrix().Pd(),rest:O.getRestMatrix().Pd(),linkedTransformNodeId:null===(T=O.getTransformNode())||void 0===T?void 0:T.id};v.bones.push(B),O.length&&(B.length=O.length),O.metadata&&(B.metadata=O.metadata),O.animations&&O.animations.length>0&&(B.animation=O.animations[0].serialize()),v.ranges=[];for(const T in this._ranges){const X=this._ranges[T];if(!X)continue;const O={};O.name=T,O.from=X.from,O.to=X.to,v.ranges.push(O)}}return v}static Parse(v,T){const X=new k(v.name,v.id,T);let O;for(v.dimensionsAtRest&&(X.dimensionsAtRest=u.l.Ld(v.dimensionsAtRest)),X.needInitialSkinMatrix=v.needInitialSkinMatrix,O=0;O<v.bones.length;O++){const T=v.bones[O],B=v.bones[O].index;let m=null;T.parentBoneIndex>-1&&(m=X.bones[T.parentBoneIndex]);const A=T.rest?u.b.Ld(T.rest):null,x=new f.c(T.name,X,m,u.b.Ld(T.matrix),A,null,B);void 0!==T.id&&null!==T.id&&(x.id=T.id),T.length&&(x.length=T.length),T.metadata&&(x.metadata=T.metadata),T.animation&&x.animations.push(n.e.Parse(T.animation)),void 0!==T.linkedTransformNodeId&&null!==T.linkedTransformNodeId&&(X._hasWaitingData=!0,x._waitingTransformNodeId=T.linkedTransformNodeId)}if(v.ranges)for(O=0;O<v.ranges.length;O++){const T=v.ranges[O];X.createAnimationRange(T.name,T.from,T.to)}return X}computeAbsoluteMatrices(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||v)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(v)}getPoseMatrix(){let v=null;return this._meshesWithPoseMatrix.length>0&&(v=this._meshesWithPoseMatrix[0].getPoseMatrix()),v}sortBones(){const v=[],T=new Array(this.bones.length);for(let X=0;X<this.bones.length;X++)this._sortBones(X,v,T);this.bones=v}_sortBones(v,T,X){if(X[v])return;X[v]=!0;const O=this.bones[v];if(!O)return;void 0===O._index&&(O._index=v);const u=O.getParent();u&&this._sortBones(this.bones.indexOf(u),T,X),T.push(O)}setCurrentPoseAsRest(){this.bones.forEach((v=>{v.setCurrentPoseAsRest()}))}}var b=X(1352),l=X(985),Q=X(994),K=X(12543),p=X(12549),G=X(1023),L=X(1156);class r extends p.e{get refractionTexture(){return this.subSurface.refractionTexture}set refractionTexture(v){this.subSurface.refractionTexture=v,v?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)}get indexOfRefraction(){return this.subSurface.indexOfRefraction}set indexOfRefraction(v){this.subSurface.indexOfRefraction=v}get invertRefractionY(){return this.subSurface.invertRefractionY}set invertRefractionY(v){this.subSurface.invertRefractionY=v}get linkRefractionWithTransparency(){return this.subSurface.linkRefractionWithTransparency}set linkRefractionWithTransparency(v){this.subSurface.linkRefractionWithTransparency=v,v&&(this.subSurface.isRefractionEnabled=!0)}get usePhysicalLightFalloff(){return this._lightFalloff===p.e.LIGHTFALLOFF_PHYSICAL}set usePhysicalLightFalloff(v){v!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=v?p.e.LIGHTFALLOFF_PHYSICAL:p.e.LIGHTFALLOFF_STANDARD)}get useGLTFLightFalloff(){return this._lightFalloff===p.e.LIGHTFALLOFF_GLTF}set useGLTFLightFalloff(v){v!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=v?p.e.LIGHTFALLOFF_GLTF:p.e.LIGHTFALLOFF_STANDARD)}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(v){this._attachImageProcessingConfiguration(v),this._markAllSubMeshesAsTexturesDirty()}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(v){this.imageProcessingConfiguration.colorCurvesEnabled=v}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(v){this.imageProcessingConfiguration.colorGradingEnabled=v}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(v){this._imageProcessingConfiguration.toneMappingEnabled=v}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(v){this._imageProcessingConfiguration.exposure=v}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(v){this._imageProcessingConfiguration.contrast=v}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(v){this._imageProcessingConfiguration.colorGradingTexture=v}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(v){this._imageProcessingConfiguration.colorCurves=v}constructor(v,T){super(v,T,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.directIntensity=1,this.emissiveIntensity=1,this.environmentIntensity=1,this.specularIntensity=1,this.disableBumpMap=!1,this.ambientTextureStrength=1,this.ambientTextureImpactOnAnalyticalLights=r.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this.metallicF0Factor=1,this.metallicReflectanceColor=B.d.White(),this.useOnlyMetallicFromMetallicReflectanceTexture=!1,this.ambientColor=new B.d(0,0,0),this.albedoColor=new B.d(1,1,1),this.reflectivityColor=new B.d(1,1,1),this.reflectionColor=new B.d(1,1,1),this.emissiveColor=new B.d(0,0,0),this.microSurface=1,this.useLightmapAsShadowmap=!1,this.useAlphaFromAlbedoTexture=!1,this.forceAlphaTest=!1,this.alphaCutOff=.4,this.useSpecularOverAlpha=!0,this.useMicroSurfaceFromReflectivityMapAlpha=!1,this.useRoughnessFromMetallicTextureAlpha=!0,this.useRoughnessFromMetallicTextureGreen=!1,this.useMetallnessFromMetallicTextureBlue=!1,this.useAmbientOcclusionFromMetallicTextureRed=!1,this.useAmbientInGrayScale=!1,this.useAutoMicroSurfaceFromReflectivityMap=!1,this.useRadianceOverAlpha=!0,this.useObjectSpaceNormalMap=!1,this.useParallax=!1,this.useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this.disableLighting=!1,this.forceIrradianceInFragment=!1,this.maxSimultaneousLights=4,this.invertNormalMapX=!1,this.invertNormalMapY=!1,this.twoSidedLighting=!1,this.useAlphaFresnel=!1,this.useLinearAlphaFresnel=!1,this.environmentBRDFTexture=null,this.forceNormalForward=!1,this.enableSpecularAntiAliasing=!1,this.useHorizonOcclusion=!0,this.useRadianceOcclusion=!0,this.unlit=!1,this.applyDecalMapAfterDetailMap=!1,this._environmentBRDFTexture=(0,K.d)(this.va())}getClassName(){return"PBRMaterial"}clone(v){let T=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const O=L.e.Clone((()=>new r(v,this.va())),this,{cloneTexturesOnlyOnce:T});return O.id=v,O.name=v,this.stencil.copyTo(O.stencil),this._clonePlugins(O,X),O}serialize(){const v=super.serialize();return v.customType="BABYLON.PBRMaterial",v}static Parse(v,T,X){const O=L.e.Parse((()=>new r(v.name,T)),v,T,X);return v.stencil&&O.stencil.parse(v.stencil,T,X),b.d._ParsePlugins(v,O,T,X),v.clearCoat&&O.clearCoat.parse(v.clearCoat,T,X),v.anisotropy&&O.anisotropy.parse(v.anisotropy,T,X),v.brdf&&O.brdf.parse(v.brdf,T,X),v.sheen&&O.sheen.parse(v.sheen,T,X),v.subSurface&&O.subSurface.parse(v.subSurface,T,X),v.iridescence&&O.iridescence.parse(v.iridescence,T,X),O}}r.PBRMATERIAL_OPAQUE=p.e.PBRMATERIAL_OPAQUE,r.PBRMATERIAL_ALPHATEST=p.e.PBRMATERIAL_ALPHATEST,r.PBRMATERIAL_ALPHABLEND=p.e.PBRMATERIAL_ALPHABLEND,r.PBRMATERIAL_ALPHATESTANDBLEND=p.e.PBRMATERIAL_ALPHATESTANDBLEND,r.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=p.e.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,(0,l.c)([(0,Q.G)(),(0,Q.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"directIntensity",void 0),(0,l.c)([(0,Q.G)(),(0,Q.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"emissiveIntensity",void 0),(0,l.c)([(0,Q.G)(),(0,Q.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"environmentIntensity",void 0),(0,l.c)([(0,Q.G)(),(0,Q.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"specularIntensity",void 0),(0,l.c)([(0,Q.G)(),(0,Q.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"disableBumpMap",void 0),(0,l.c)([(0,Q.z)(),(0,Q.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"albedoTexture",void 0),(0,l.c)([(0,Q.z)(),(0,Q.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"ambientTexture",void 0),(0,l.c)([(0,Q.G)(),(0,Q.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"ambientTextureStrength",void 0),(0,l.c)([(0,Q.G)(),(0,Q.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),(0,l.c)([(0,Q.z)(),(0,Q.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],r.prototype,"opacityTexture",void 0),(0,l.c)([(0,Q.z)(),(0,Q.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"reflectionTexture",void 0),(0,l.c)([(0,Q.z)(),(0,Q.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"emissiveTexture",void 0),(0,l.c)([(0,Q.z)(),(0,Q.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"reflectivityTexture",void 0),(0,l.c)([(0,Q.z)(),(0,Q.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"metallicTexture",void 0),(0,l.c)([(0,Q.G)(),(0,Q.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"metallic",void 0),(0,l.c)([(0,Q.G)(),(0,Q.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"roughness",void 0),(0,l.c)([(0,Q.G)(),(0,Q.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"metallicF0Factor",void 0),(0,l.c)([(0,Q.k)(),(0,Q.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"metallicReflectanceColor",void 0),(0,l.c)([(0,Q.G)(),(0,Q.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useOnlyMetallicFromMetallicReflectanceTexture",void 0),(0,l.c)([(0,Q.z)(),(0,Q.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"metallicReflectanceTexture",void 0),(0,l.c)([(0,Q.z)(),(0,Q.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"reflectanceTexture",void 0),(0,l.c)([(0,Q.z)(),(0,Q.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"microSurfaceTexture",void 0),(0,l.c)([(0,Q.z)(),(0,Q.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"bumpTexture",void 0),(0,l.c)([(0,Q.z)(),(0,Q.e)("_markAllSubMeshesAsTexturesDirty",null)],r.prototype,"lightmapTexture",void 0),(0,l.c)([(0,Q.k)("ambient"),(0,Q.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"ambientColor",void 0),(0,l.c)([(0,Q.k)("albedo"),(0,Q.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"albedoColor",void 0),(0,l.c)([(0,Q.k)("reflectivity"),(0,Q.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"reflectivityColor",void 0),(0,l.c)([(0,Q.k)("reflection"),(0,Q.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"reflectionColor",void 0),(0,l.c)([(0,Q.k)("emissive"),(0,Q.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"emissiveColor",void 0),(0,l.c)([(0,Q.G)(),(0,Q.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"microSurface",void 0),(0,l.c)([(0,Q.G)(),(0,Q.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useLightmapAsShadowmap",void 0),(0,l.c)([(0,Q.G)(),(0,Q.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],r.prototype,"useAlphaFromAlbedoTexture",void 0),(0,l.c)([(0,Q.G)(),(0,Q.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],r.prototype,"forceAlphaTest",void 0),(0,l.c)([(0,Q.G)(),(0,Q.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],r.prototype,"alphaCutOff",void 0),(0,l.c)([(0,Q.G)(),(0,Q.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useSpecularOverAlpha",void 0),(0,l.c)([(0,Q.G)(),(0,Q.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),(0,l.c)([(0,Q.G)(),(0,Q.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),(0,l.c)([(0,Q.G)(),(0,Q.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useRoughnessFromMetallicTextureGreen",void 0),(0,l.c)([(0,Q.G)(),(0,Q.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useMetallnessFromMetallicTextureBlue",void 0),(0,l.c)([(0,Q.G)(),(0,Q.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),(0,l.c)([(0,Q.G)(),(0,Q.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useAmbientInGrayScale",void 0),(0,l.c)([(0,Q.G)(),(0,Q.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),(0,l.c)([(0,Q.G)()],r.prototype,"usePhysicalLightFalloff",null),(0,l.c)([(0,Q.G)()],r.prototype,"useGLTFLightFalloff",null),(0,l.c)([(0,Q.G)(),(0,Q.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useRadianceOverAlpha",void 0),(0,l.c)([(0,Q.G)(),(0,Q.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useObjectSpaceNormalMap",void 0),(0,l.c)([(0,Q.G)(),(0,Q.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useParallax",void 0),(0,l.c)([(0,Q.G)(),(0,Q.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useParallaxOcclusion",void 0),(0,l.c)([(0,Q.G)(),(0,Q.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"parallaxScaleBias",void 0),(0,l.c)([(0,Q.G)(),(0,Q.e)("_markAllSubMeshesAsLightsDirty")],r.prototype,"disableLighting",void 0),(0,l.c)([(0,Q.G)(),(0,Q.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"forceIrradianceInFragment",void 0),(0,l.c)([(0,Q.G)(),(0,Q.e)("_markAllSubMeshesAsLightsDirty")],r.prototype,"maxSimultaneousLights",void 0),(0,l.c)([(0,Q.G)(),(0,Q.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"invertNormalMapX",void 0),(0,l.c)([(0,Q.G)(),(0,Q.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"invertNormalMapY",void 0),(0,l.c)([(0,Q.G)(),(0,Q.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"twoSidedLighting",void 0),(0,l.c)([(0,Q.G)(),(0,Q.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useAlphaFresnel",void 0),(0,l.c)([(0,Q.G)(),(0,Q.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useLinearAlphaFresnel",void 0),(0,l.c)([(0,Q.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"environmentBRDFTexture",void 0),(0,l.c)([(0,Q.G)(),(0,Q.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"forceNormalForward",void 0),(0,l.c)([(0,Q.G)(),(0,Q.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"enableSpecularAntiAliasing",void 0),(0,l.c)([(0,Q.G)(),(0,Q.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useHorizonOcclusion",void 0),(0,l.c)([(0,Q.G)(),(0,Q.e)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useRadianceOcclusion",void 0),(0,l.c)([(0,Q.G)(),(0,Q.e)("_markAllSubMeshesAsMiscDirty")],r.prototype,"unlit",void 0),(0,l.c)([(0,Q.G)(),(0,Q.e)("_markAllSubMeshesAsMiscDirty")],r.prototype,"applyDecalMapAfterDetailMap",void 0),(0,G.f)("BABYLON.PBRMaterial",r);var o=X(978),Z=X(11955),U=X(1261),J=X(11942),y=X(11951),P=X(11911);class a{get influence(){return this._influence}set influence(v){if(this._influence===v)return;const T=this._influence;this._influence=v,this.onInfluenceChanged.hasObservers()&&this.onInfluenceChanged.notifyObservers(0===T||0===v)}get animationPropertiesOverride(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride}set animationPropertiesOverride(v){this._animationPropertiesOverride=v}constructor(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.name=v,this.animations=[],this._positions=null,this._normals=null,this._tangents=null,this._uvs=null,this._uniqueId=0,this.onInfluenceChanged=new M.b,this._onDataLayoutChanged=new M.b,this._animationPropertiesOverride=null,this.id=v,this._scene=X||D.c.LastCreatedScene,this.influence=T,this._scene&&(this._uniqueId=this._scene.getUniqueId())}get uniqueId(){return this._uniqueId}get hasPositions(){return!!this._positions}get hasNormals(){return!!this._normals}get hasTangents(){return!!this._tangents}get hasUVs(){return!!this._uvs}setPositions(v){const T=this.hasPositions;this._positions=v,T!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)}getPositions(){return this._positions}setNormals(v){const T=this.hasNormals;this._normals=v,T!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)}getNormals(){return this._normals}setTangents(v){const T=this.hasTangents;this._tangents=v,T!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)}getTangents(){return this._tangents}setUVs(v){const T=this.hasUVs;this._uvs=v,T!==this.hasUVs&&this._onDataLayoutChanged.notifyObservers(void 0)}getUVs(){return this._uvs}clone(){const v=L.e.Clone((()=>new a(this.name,this.influence,this._scene)),this);return v._positions=this._positions,v._normals=this._normals,v._tangents=this._tangents,v._uvs=this._uvs,v}serialize(){const v={};return v.name=this.name,v.influence=this.influence,v.xa=Array.prototype.slice.call(this.getPositions()),null!=this.id&&(v.id=this.id),this.hasNormals&&(v.ya=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(v.tangents=Array.prototype.slice.call(this.getTangents())),this.hasUVs&&(v.Aa=Array.prototype.slice.call(this.getUVs())),L.e.AppendSerializedAnimations(this,v),v}getClassName(){return"MorphTarget"}static Parse(v,T){const X=new a(v.name,v.influence);if(X.setPositions(v.xa),null!=v.id&&(X.id=v.id),v.ya&&X.setNormals(v.ya),v.tangents&&X.setTangents(v.tangents),v.Aa&&X.setUVs(v.Aa),v.animations){for(let T=0;T<v.animations.length;T++){const O=v.animations[T],u=(0,G.c)("BABYLON.Animation");u&&X.animations.push(u.Parse(O))}v.autoAnimate&&T&&T.beginAnimation(X,v.autoAnimateFrom,v.autoAnimateTo,v.autoAnimateLoop,v.autoAnimateSpeed||1)}return X}static FromMesh(v,T,X){T||(T=v.name);const O=new a(T,X,v.va());return O.setPositions(v.getVerticesData(U.e.PositionKind)),v.isVerticesDataPresent(U.e.NormalKind)&&O.setNormals(v.getVerticesData(U.e.NormalKind)),v.isVerticesDataPresent(U.e.TangentKind)&&O.setTangents(v.getVerticesData(U.e.TangentKind)),v.isVerticesDataPresent(U.e.UVKind)&&O.setUVs(v.getVerticesData(U.e.UVKind)),O}}(0,l.c)([(0,Q.G)()],a.prototype,"id",void 0);var E=X(1207),i=X(1557);class t{set areUpdatesFrozen(v){v?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(!0)))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new E.d(16),this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,v||(v=D.c.LastCreatedScene),this._scene=v,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const v=this._scene.getEngine().getCaps();this._canUseTextureForTargets=v.canUseGLVertexID&&v.textureFloat&&v.maxVertexTextureImageUnits>0&&v.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return this._numMaxInfluencers}set numMaxInfluencers(v){this._numMaxInfluencers!==v&&(this._numMaxInfluencers=v,this._syncActiveTargets(!0))}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(v){this._useTextureToStoreTargets=v}get isUsingTextureForTargets(){var v;return t.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(v=this._scene)&&void 0!==v&&v.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(v){return this._activeTargets.data[v]}getTarget(v){return this._targets[v]}getTargetByName(v){for(const T of this._targets)if(T.name===v)return T;return null}addTarget(v){this._targets.push(v),this._targetInfluenceChangedObservers.push(v.onInfluenceChanged.add((v=>{this._syncActiveTargets(v)}))),this._targetDataLayoutChangedObservers.push(v._onDataLayoutChanged.add((()=>{this._syncActiveTargets(!0)}))),this._syncActiveTargets(!0)}removeTarget(v){const T=this._targets.indexOf(v);T>=0&&(this._targets.splice(T,1),v.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(T,1)[0]),v._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(T,1)[0]),this._syncActiveTargets(!0)),this._scene&&this._scene.stopAnimation(v)}_bind(v){v.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),v.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),v.setTexture("morphTargets",this._targetStoreTexture),v.setInt("morphTargetCount",this.numInfluencers)}clone(){const v=new t(this._scene);for(const T of this._targets)v.addTarget(T.clone());return v.enableNormalMorphing=this.enableNormalMorphing,v.enableTangentMorphing=this.enableTangentMorphing,v.enableUVMorphing=this.enableUVMorphing,v}serialize(){const v={};v.id=this.uniqueId,v.targets=[];for(const T of this._targets)v.targets.push(T.serialize());return v}_syncActiveTargets(v){if(this.areUpdatesFrozen)return;let T=0;this._activeTargets.reset(),this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._vertexCount=0,this._scene&&this._targets.length>this._scene.getEngine().getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let X=-1;for(const O of this._targets){if(X++,0===O.influence&&this.optimizeInfluencers)continue;if(this._activeTargets.length>=t.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(O),this._morphTargetTextureIndices[T]=X,this._tempInfluences[T++]=O.influence,this._supportsNormals=this._supportsNormals&&O.hasNormals,this._supportsTangents=this._supportsTangents&&O.hasTangents,this._supportsUVs=this._supportsUVs&&O.hasUVs;const v=O.getPositions();if(v){const T=v.length/3;if(0===this._vertexCount)this._vertexCount=T;else if(this._vertexCount!==T)return void s.d.Error("Incompatible target. Targets must all have the same vertices count.")}}this._morphTargetTextureIndices.length!==T&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,T)),this._influences&&this._influences.length===T||(this._influences=new Float32Array(T));for(let O=0;O<T;O++)this._influences[O]=this._tempInfluences[O];v&&this.synchronize()}synchronize(){if(this._scene&&!this.areUpdatesFrozen){if(this.isUsingTextureForTargets&&(this._vertexCount||this.numMaxInfluencers>0)){this._textureVertexStride=1,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const v=this._scene.getEngine().getCaps().maxTextureSize;this._textureWidth>v&&(this._textureHeight=Math.ceil(this._textureWidth/v),this._textureWidth=v);let T=!0;if(this._targetStoreTexture){const v=this._targetStoreTexture.getSize();v.width===this._textureWidth&&v.height===this._textureHeight&&this._targetStoreTexture.depth===this._targets.length&&(T=!1)}if(T){this._targetStoreTexture&&this._targetStoreTexture.dispose();const v=this._targets.length,T=new Float32Array(v*this._textureWidth*this._textureHeight*4);let X=0;for(let O=0;O<v;O++){const v=this._targets[O],u=v.getPositions(),B=v.getNormals(),m=v.getUVs(),A=v.getTangents();if(!u)return void(0===O&&s.d.Error("Invalid morph target. Target must have positions."));X=O*this._textureWidth*this._textureHeight*4;for(let O=0;O<this._vertexCount;O++)T[X]=u[3*O],T[X+1]=u[3*O+1],T[X+2]=u[3*O+2],X+=4,this._supportsNormals&&B&&(T[X]=B[3*O],T[X+1]=B[3*O+1],T[X+2]=B[3*O+2],X+=4),this._supportsUVs&&m&&(T[X]=m[2*O],T[X+1]=m[2*O+1],X+=4),this._supportsTangents&&A&&(T[X]=A[3*O],T[X+1]=A[3*O+1],T[X+2]=A[3*O+2],X+=4)}this._targetStoreTexture=i.c.CreateRGBATexture(T,this._textureWidth,this._textureHeight,v,this._scene,!1,!1,1,1)}}for(const v of this._scene.meshes)v.morphTargetManager===this&&v._syncGeometryWithMorphTargetManager()}}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const v=this._parentContainer.morphTargetManagers.indexOf(this);v>-1&&this._parentContainer.morphTargetManagers.splice(v,1),this._parentContainer=null}for(const v of this._targets)this._scene.stopAnimation(v)}}static Parse(v,T){const X=new t(T);for(const O of v.targets)X.addTarget(a.Parse(O,T));return X}}t.EnableTextureStorage=!0,t.MaxActiveMorphTargetsInVertexAttributeMode=8;var C=X(12555),c=X(1061),N=X(1371);function d(v,T,X,O){return u.l.Ld(T,X).scaleInPlace(O)}class I{constructor(v,T,X,O){this.type=v,this.name=T,this.getValue=X,this.getStride=O}_buildAnimation(v,T,X){const O=new n.e(v,this.name,T,this.type);return O.setKeys(X),O}}class W extends I{buildAnimations(v,T,X,O,u){u(v._babylonTransformNode,this._buildAnimation(T,X,O))}}const g={translation:[new W(n.e.ANIMATIONTYPE_VECTOR3,"position",d,(()=>3))],rotation:[new W(n.e.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",(function(v,T,X,O){return u.f.Ld(T,X).scaleInPlace(O)}),(()=>4))],scale:[new W(n.e.ANIMATIONTYPE_VECTOR3,"Zd",d,(()=>3))],weights:[new class extends I{buildAnimations(v,T,X,O,u){if(v._numMorphTargets)for(let B=0;B<v._numMorphTargets;B++){const m=new n.e(`${T}_${B}`,this.name,X,this.type);if(m.setKeys(O.map((v=>({frame:v.frame,inTangent:v.inTangent?v.inTangent[B]:void 0,value:v.value[B],outTangent:v.outTangent?v.outTangent[B]:void 0,interpolation:v.interpolation})))),v._primitiveBabylonMeshes)for(const T of v._primitiveBabylonMeshes)if(T.morphTargetManager){const v=T.morphTargetManager.getTarget(B),X=m.clone();v.animations.push(X),u(v,X)}}}}(n.e.ANIMATIONTYPE_FLOAT,"influence",(function(v,T,X,O){const u=new Array(v._numMorphTargets);for(let B=0;B<u.length;B++)u[B]=T[X++]*O;return u}),(v=>v._numMorphTargets))]},j=new Map,e=j;function h(v,T,X){S(v)&&s.d.Warn(`Extension with the name '${v}' already exists`),j.set(v,{isGLTFExtension:T,factory:X})}function S(v){return j.delete(v)}function w(){const v=v=>v&&"object"===typeof v;for(var T=arguments.length,X=new Array(T),O=0;O<T;O++)X[O]=arguments[O];return X.reduce(((T,X)=>(Object.keys(X).forEach((O=>{const u=T[O],B=X[O];Array.isArray(u)&&Array.isArray(B)?T[O]=u.concat(...B):v(u)&&v(B)?T[O]=w(u,B):T[O]=B})),T)),{})}class z{static Get(v,T,X){if(!T||void 0==X||!T[X])throw new Error(`${v}: Failed to find index (${X})`);return T[X]}static TryGet(v,T){return v&&void 0!=T&&v[T]?v[T]:null}static Assign(v){if(v)for(let T=0;T<v.length;T++)v[T].index=T}}class R{static RegisterExtension(v,T){h(v,!1,T)}static UnregisterExtension(v){return S(v)}get cj(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(v){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=v}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((v=>v.dispose&&v.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}importMeshAsync(v,T,X,O,u,B){let m=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return Promise.resolve().then((()=>{this._babylonScene=T,this._assetContainer=X,this._loadData(O);let B=null;if(v){const T={};if(this._gltf.nodes)for(const v of this._gltf.nodes)v.name&&(T[v.name]=v.index);B=(v instanceof Array?v:[v]).map((v=>{const X=T[v];if(void 0===X)throw new Error(`Failed to find node '${v}'`);return X}))}return this._loadAsync(u,m,B,(()=>({meshes:this._getMeshes(),Ae:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}loadAsync(v,T,X,O){let u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return Promise.resolve().then((()=>(this._babylonScene=v,this._loadData(T),this._loadAsync(X,u,null,(()=>{})))))}_loadAsync(v,T,X,O){return Promise.resolve().then((async()=>{this._rootUrl=v,this._uniqueRootUrl=!v.startsWith("file:")&&T?v:`${v}${Date.now()}/`,this._fileName=T,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const u=`${C.i[C.i.LOADING]} => ${C.i[C.i.READY]}`,B=`${C.i[C.i.LOADING]} => ${C.i[C.i.COMPLETE]}`;this._parent._startPerformanceCounter(u),this._parent._startPerformanceCounter(B),this._parent._setState(C.i.LOADING),this._extensionsOnLoading();const A=new Array;if(!this.parent.loadOnlyMaterials)if(X)A.push(this.loadSceneAsync("/nodes",{nodes:X,index:-1}));else if(void 0!=this._gltf.Fe||this._gltf.scenes&&this._gltf.scenes[0]){const v=z.Get("/scene",this._gltf.scenes,this._gltf.Fe||0);A.push(this.loadSceneAsync(`/scenes/${v.index}`,v))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let v=0;v<this._gltf.materials.length;++v){const T=this._gltf.materials[v],X="/materials/"+v,O=b.d.TriangleFillMode;A.push(this._loadMaterialAsync(X,T,null,O,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&A.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&A.push(this._compileShadowGeneratorsAsync());return Promise.all(A).then((()=>(this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.Qg(!0),this._extensionsOnReady(),this._parent._setState(C.i.READY),this._startAnimations(),O()))).then((v=>(this._parent._endPerformanceCounter(u),m.c.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(B),this._parent._setState(C.i.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(v=>{this._parent.onErrorObservable.notifyObservers(v),this._parent.onErrorObservable.clear(),this.dispose()}))})),v)))})).catch((v=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(v),this._parent.onErrorObservable.clear(),this.dispose()),v}))}_loadData(v){if(this._gltf=v.json,this._setupData(),v.bin){const T=this._gltf.buffers;if(T&&T[0]&&!T[0].uri){const X=T[0];(X.byteLength<v.bin.byteLength-3||X.byteLength>v.bin.byteLength)&&s.d.Warn(`Binary buffer length (${X.byteLength}) from JSON does not match chunk length (${v.bin.byteLength})`),this._bin=v.bin}else s.d.Warn("Unexpected BIN chunk")}}_setupData(){if(z.Assign(this._gltf.accessors),z.Assign(this._gltf.animations),z.Assign(this._gltf.buffers),z.Assign(this._gltf.bufferViews),z.Assign(this._gltf.cameras),z.Assign(this._gltf.images),z.Assign(this._gltf.materials),z.Assign(this._gltf.meshes),z.Assign(this._gltf.nodes),z.Assign(this._gltf.samplers),z.Assign(this._gltf.scenes),z.Assign(this._gltf.skins),z.Assign(this._gltf.textures),this._gltf.nodes){const v={};for(const X of this._gltf.nodes)if(X.children)for(const T of X.children)v[T]=X.index;const T=this._createRootNode();for(const X of this._gltf.nodes){const O=v[X.index];X.parent=void 0===O?T:this._gltf.nodes[O]}}}async _loadExtensionsAsync(){const v=[];if(e.forEach(((T,X)=>{var O;!1===(null===(O=this.parent.extensionOptions[X])||void 0===O?void 0:O.enabled)?T.isGLTFExtension&&this.isExtensionUsed(X)&&s.d.Warn(`Extension ${X} is used but has been explicitly disabled.`):T.isGLTFExtension&&!this.isExtensionUsed(X)||v.push((async()=>{const v=await T.factory(this);return v.name!==X&&s.d.Warn(`The name of the glTF loader extension instance does not match the registered name: ${v.name} !== ${X}`),this._parent.onExtensionLoadedObservable.notifyObservers(v),v})())})),this._extensions.push(...await Promise.all(v)),this._extensions.sort(((v,T)=>(v.order||Number.MAX_VALUE)-(T.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const X of this._gltf.extensionsRequired){if(!this._extensions.some((v=>v.name===X&&v.enabled))){var T;if(!1===(null===(T=this.parent.extensionOptions[X])||void 0===T?void 0:T.enabled))throw new Error(`Required extension ${X} is disabled`);throw new Error(`Required extension ${X} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const v=new P.d("__root__",this._babylonScene);this._rootBabylonMesh=v,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.Qg(!1);const T={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case C.h.AUTO:this._babylonScene.useRightHandedSystem||(T.rotation=[0,1,0,0],T.scale=[1,1,-1],R._LoadTransform(T,this._rootBabylonMesh));break;case C.h.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(v),T}loadSceneAsync(v,T){const X=this._extensionsLoadSceneAsync(v,T);if(X)return X;const O=new Array;if(this.logOpen(`${v} ${T.name||""}`),T.nodes)for(const u of T.nodes){const T=z.Get(`${v}/nodes/${u}`,this._gltf.nodes,u);O.push(this.loadNodeAsync(`/nodes/${T.index}`,T,(v=>{v.parent=this._rootBabylonMesh})))}for(const u of this._postSceneLoadActions)u();return O.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(O).then((()=>{}))}_forEachPrimitive(v,T){if(v._primitiveBabylonMeshes)for(const X of v._primitiveBabylonMeshes)T(X)}_getGeometries(){const v=[],T=this._gltf.nodes;if(T)for(const X of T)this._forEachPrimitive(X,(T=>{const X=T.Ne;X&&-1===v.indexOf(X)&&v.push(X)}));return v}_getMeshes(){const v=[];this._rootBabylonMesh instanceof y.c&&v.push(this._rootBabylonMesh);const T=this._gltf.nodes;if(T)for(const X of T)this._forEachPrimitive(X,(T=>{v.push(T)}));return v}_getTransformNodes(){const v=[],T=this._gltf.nodes;if(T)for(const X of T)X._babylonTransformNode&&"nb"===X._babylonTransformNode.getClassName()&&v.push(X._babylonTransformNode),X._babylonTransformNodeForSkin&&v.push(X._babylonTransformNodeForSkin);return v}_getSkeletons(){const v=[],T=this._gltf.skins;if(T)for(const X of T)X._data&&v.push(X._data.babylonSkeleton);return v}_getAnimationGroups(){const v=[],T=this._gltf.animations;if(T)for(const X of T)X._babylonAnimationGroup&&v.push(X._babylonAnimationGroup);return v}_startAnimations(){switch(this._parent.animationStartMode){case C.e.NONE:break;case C.e.FIRST:{const v=this._getAnimationGroups();0!==v.length&&v[0].start(!0);break}case C.e.ALL:{const v=this._getAnimationGroups();for(const T of v)T.start(!0);break}default:return void s.d.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(v,T){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const O=this._extensionsLoadNodeAsync(v,T,X);if(O)return O;if(T._babylonTransformNode)throw new Error(`${v}: Invalid recursive node hierarchy`);const u=new Array;this.logOpen(`${v} ${T.name||""}`);const B=O=>{if(R.AddPointerMetadata(O,v),R._LoadTransform(T,O),void 0!=T.camera){const X=z.Get(`${v}/camera`,this._gltf.cameras,T.camera);u.push(this.loadCameraAsync(`/cameras/${X.index}`,X,(v=>{v.parent=O})))}if(T.children)for(const X of T.children){const T=z.Get(`${v}/children/${X}`,this._gltf.nodes,X);u.push(this.loadNodeAsync(`/nodes/${T.index}`,T,(v=>{v.parent=O})))}X(O)},m=void 0!=T.mesh,A=this._parent.loadSkins&&void 0!=T.skin;if(!m||A){const v=T.name||`node${T.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const X=new Z.c(v,this._babylonScene);X._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==T.mesh?T._babylonTransformNode=X:T._babylonTransformNodeForSkin=X,B(X)}if(m)if(A){const X=z.Get(`${v}/mesh`,this._gltf.meshes,T.mesh);u.push(this._loadMeshAsync(`/meshes/${X.index}`,T,X,(X=>{const O=T._babylonTransformNodeForSkin;X.metadata=w(O.metadata,X.metadata||{});const B=z.Get(`${v}/skin`,this._gltf.skins,T.skin);u.push(this._loadSkinAsync(`/skins/${B.index}`,T,B,(v=>{this._forEachPrimitive(T,(T=>{T.skeleton=v})),this._postSceneLoadActions.push((()=>{if(void 0!=B.skeleton){const v=z.Get(`/skins/${B.index}/skeleton`,this._gltf.nodes,B.skeleton).parent;T.index===v.index?X.parent=O.parent:X.parent=v._babylonTransformNode}else X.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:O,skinnedNode:X})}))})))})))}else{const X=z.Get(`${v}/mesh`,this._gltf.meshes,T.mesh);u.push(this._loadMeshAsync(`/meshes/${X.index}`,T,X,B))}return this.logClose(),Promise.all(u).then((()=>(this._forEachPrimitive(T,(v=>{v.Ne&&v.Ne.useBoundingInfoFromGeometry?v.Ea():v.refreshBoundingInfo(!0,!0)})),T._babylonTransformNode)))}_loadMeshAsync(v,T,X,O){const u=X.primitives;if(!u||!u.length)throw new Error(`${v}: Primitives are missing`);void 0==u[0].index&&z.Assign(u);const B=new Array;this.logOpen(`${v} ${X.name||""}`);const m=T.name||`node${T.index}`;if(1===u.length){const O=X.primitives[0];B.push(this._loadMeshPrimitiveAsync(`${v}/primitives/${O.index}`,m,T,X,O,(v=>{T._babylonTransformNode=v,T._primitiveBabylonMeshes=[v]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,T._babylonTransformNode=new Z.c(m,this._babylonScene),T._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,T._primitiveBabylonMeshes=[];for(const O of u)B.push(this._loadMeshPrimitiveAsync(`${v}/primitives/${O.index}`,`${m}_primitive${O.index}`,T,X,O,(v=>{v.parent=T._babylonTransformNode,T._primitiveBabylonMeshes.push(v)})))}return O(T._babylonTransformNode),this.logClose(),Promise.all(B).then((()=>T._babylonTransformNode))}_loadMeshPrimitiveAsync(v,T,X,O,u,B){const m=this._extensionsLoadMeshPrimitiveAsync(v,T,X,O,u,B);if(m)return m;this.logOpen(`${v}`);const A=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==X.skin&&!O.primitives[0].targets;let x,f;if(A&&u._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,x=u._instanceData.babylonSourceMesh.Jb(T),x._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,f=u._instanceData.promise;else{const B=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const m=new P.d(T,this._babylonScene);m._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,m.sideOrientation=this._babylonScene.useRightHandedSystem?b.d.CounterClockWiseSideOrientation:b.d.ClockWiseSideOrientation,this._createMorphTargets(v,X,O,u,m),B.push(this._loadVertexDataAsync(v,u,m).then((T=>this._loadMorphTargetsAsync(v,u,m,T).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,T.Ca(m),T._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const M=R._GetDrawMode(v,u.mode);if(void 0==u.material){let v=this._defaultBabylonMaterialData[M];v||(v=this._createDefaultMaterial("__GLTFLoader._default",M),this._parent.onMaterialLoadedObservable.notifyObservers(v),this._defaultBabylonMaterialData[M]=v),m.material=v}else if(!this.parent.skipMaterials){const T=z.Get(`${v}/material`,this._gltf.materials,u.material);B.push(this._loadMaterialAsync(`/materials/${T.index}`,T,m,M,(v=>{m.material=v})))}f=Promise.all(B),A&&(u._instanceData={babylonSourceMesh:m,promise:f}),x=m}return R.AddPointerMetadata(x,v),this._parent.onMeshLoadedObservable.notifyObservers(x),B(x),this.logClose(),f.then((()=>x))}_loadVertexDataAsync(v,T,X){const O=this._extensionsLoadVertexDataAsync(v,T,X);if(O)return O;const B=T.attributes;if(!B)throw new Error(`${v}: Attributes are missing`);const m=new Array,A=new J.e(X.name,this._babylonScene);if(void 0==T.indices)X.isUnIndexed=!0;else{const X=z.Get(`${v}/indices`,this._gltf.accessors,T.indices);m.push(this._loadIndicesAccessorAsync(`/accessors/${X.index}`,X).then((v=>{A.setIndices(v)})))}const x=(T,O,x)=>{if(void 0==B[T])return;X._delayInfo=X._delayInfo||[],-1===X._delayInfo.indexOf(O)&&X._delayInfo.push(O);const f=z.Get(`${v}/attributes/${T}`,this._gltf.accessors,B[T]);m.push(this._loadVertexAccessorAsync(`/accessors/${f.index}`,f,O).then((v=>{if(v.getKind()===U.e.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!X.skeleton&&f.min&&f.max){const v=u.g.Vd[0].Sd(...f.min),T=u.g.Vd[1].Sd(...f.max);if(f.normalized&&5126!==f.componentType){let X=1;switch(f.componentType){case 5120:X=127;break;case 5121:X=255;break;case 5122:X=32767;break;case 5123:X=65535}const O=1/X;v.scaleInPlace(O),T.scaleInPlace(O)}A._boundingInfo=new N.c(v,T),A.useBoundingInfoFromGeometry=!0}A.setVerticesBuffer(v,f.count)}))),O==U.e.MatricesIndicesExtraKind&&(X.numBoneInfluencers=8),x&&x(f)};return x("POSITION",U.e.PositionKind),x("NORMAL",U.e.NormalKind),x("TANGENT",U.e.TangentKind),x("TEXCOORD_0",U.e.UVKind),x("TEXCOORD_1",U.e.UV2Kind),x("TEXCOORD_2",U.e.UV3Kind),x("TEXCOORD_3",U.e.UV4Kind),x("TEXCOORD_4",U.e.UV5Kind),x("TEXCOORD_5",U.e.UV6Kind),x("JOINTS_0",U.e.MatricesIndicesKind),x("WEIGHTS_0",U.e.MatricesWeightsKind),x("JOINTS_1",U.e.MatricesIndicesExtraKind),x("WEIGHTS_1",U.e.MatricesWeightsExtraKind),x("COLOR_0",U.e.ColorKind,(v=>{"VEC4"===v.type&&(X.hasVertexAlpha=!0)})),Promise.all(m).then((()=>A))}_createMorphTargets(v,T,X,O,u){if(!O.targets||!this._parent.loadMorphTargets)return;if(void 0==T._numMorphTargets)T._numMorphTargets=O.targets.length;else if(O.targets.length!==T._numMorphTargets)throw new Error(`${v}: Primitives do not have the same number of targets`);const B=X.extras?X.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,u.morphTargetManager=new t(this._babylonScene),u.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,u.morphTargetManager.areUpdatesFrozen=!0;for(let m=0;m<O.targets.length;m++){const v=T.weights?T.weights[m]:X.weights?X.weights[m]:0,O=B?B[m]:`morphTarget${m}`;u.morphTargetManager.addTarget(new a(O,v,u.va()))}}_loadMorphTargetsAsync(v,T,X,O){if(!T.targets||!this._parent.loadMorphTargets)return Promise.resolve();const u=new Array,B=X.morphTargetManager;for(let m=0;m<B.numTargets;m++){const X=B.getTarget(m);u.push(this._loadMorphTargetVertexDataAsync(`${v}/targets/${m}`,O,T.targets[m],X))}return Promise.all(u).then((()=>{B.areUpdatesFrozen=!1}))}_loadMorphTargetVertexDataAsync(v,T,X,O){const u=new Array,B=(O,B,m)=>{if(void 0==X[O])return;const A=T.getVertexBuffer(B);if(!A)return;const x=z.Get(`${v}/${O}`,this._gltf.accessors,X[O]);u.push(this._loadFloatAccessorAsync(`/accessors/${x.index}`,x).then((v=>{m(A,v)})))};return B("POSITION",U.e.PositionKind,((v,T)=>{const X=new Float32Array(T.length);v.forEach(T.length,((v,O)=>{X[O]=T[O]+v})),O.setPositions(X)})),B("NORMAL",U.e.NormalKind,((v,T)=>{const X=new Float32Array(T.length);v.forEach(X.length,((v,O)=>{X[O]=T[O]+v})),O.setNormals(X)})),B("TANGENT",U.e.TangentKind,((v,T)=>{const X=new Float32Array(T.length/3*4);let u=0;v.forEach(T.length/3*4,((v,O)=>{(O+1)%4!==0&&(X[u]=T[u]+v,u++)})),O.setTangents(X)})),Promise.all(u).then((()=>{}))}static _LoadTransform(v,T){if(void 0!=v.skin)return;let X=u.l.Zero(),O=u.f.Identity(),B=u.l.One();if(v.matrix){u.b.Ld(v.matrix).decompose(B,O,X)}else v.translation&&(X=u.l.Ld(v.translation)),v.rotation&&(O=u.f.Ld(v.rotation)),v.scale&&(B=u.l.Ld(v.scale));T.position=X,T.rotationQuaternion=O,T.Zd=B}_loadSkinAsync(v,T,X,O){if(!this._parent.loadSkins)return Promise.resolve();const u=this._extensionsLoadSkinAsync(v,T,X);if(u)return u;if(X._data)return O(X._data.babylonSkeleton),X._data.promise;const B=`skeleton${X.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const m=new k(X.name||B,B,this._babylonScene);m._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(v,X,m);const A=this._loadSkinInverseBindMatricesDataAsync(v,X).then((v=>{this._updateBoneMatrices(m,v)}));return X._data={babylonSkeleton:m,promise:A},O(m),A}_loadBones(v,T,X){if(void 0==T.skeleton||this._parent.alwaysComputeSkeletonRootNode){const X=this._findSkeletonRootNode(`${v}/joints`,T.joints);if(X)if(void 0===T.skeleton)T.skeleton=X.index;else{const O=(v,T)=>{for(;T.parent;T=T.parent)if(T.parent===v)return!0;return!1},u=z.Get(`${v}/skeleton`,this._gltf.nodes,T.skeleton);u===X||O(u,X)||(s.d.Warn(`${v}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),T.skeleton=X.index)}else s.d.Warn(`${v}: Failed to find common root`)}const O={};for(const u of T.joints){const B=z.Get(`${v}/joints/${u}`,this._gltf.nodes,u);this._loadBone(B,T,X,O)}}_findSkeletonRootNode(v,T){if(0===T.length)return null;const X={};for(const u of T){const T=[];let O=z.Get(`${v}/${u}`,this._gltf.nodes,u);for(;-1!==O.index;)T.unshift(O),O=O.parent;X[u]=T}let O=null;for(let u=0;;++u){let v=X[T[0]];if(u>=v.length)return O;const B=v[u];for(let m=1;m<T.length;++m)if(v=X[T[m]],u>=v.length||B!==v[u])return O;O=B}}_loadBone(v,T,X,O){v._isJoint=!0;let u=O[v.index];if(u)return u;let B=null;v.index!==T.skeleton&&(v.parent&&-1!==v.parent.index?B=this._loadBone(v.parent,T,X,O):void 0!==T.skeleton&&s.d.Warn(`/skins/${T.index}/skeleton: Skeleton node is not a common root`));const m=T.joints.indexOf(v.index);return u=new f.c(v.name||`joint${v.index}`,X,B,this._getNodeMatrix(v),null,null,m),O[v.index]=u,this._postSceneLoadActions.push((()=>{u.linkTransformNode(v._babylonTransformNode)})),u}_loadSkinInverseBindMatricesDataAsync(v,T){if(void 0==T.inverseBindMatrices)return Promise.resolve(null);const X=z.Get(`${v}/inverseBindMatrices`,this._gltf.accessors,T.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${X.index}`,X)}_updateBoneMatrices(v,T){for(const X of v.bones){const v=u.b.Identity(),O=X._index;T&&-1!==O&&(u.b.FromArrayToRef(T,16*O,v),v.invertToRef(v));const B=X.getParent();B&&v.multiplyToRef(B.getAbsoluteInverseBindMatrix(),v),X.ne(v,!1,!1),X._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(v){return v.matrix?u.b.Ld(v.matrix):u.b.Compose(v.scale?u.l.Ld(v.scale):u.l.One(),v.rotation?u.f.Ld(v.rotation):u.f.Identity(),v.translation?u.l.Ld(v.translation):u.l.Zero())}loadCameraAsync(v,T){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const O=this._extensionsLoadCameraAsync(v,T,X);if(O)return O;const B=new Array;this.logOpen(`${v} ${T.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const m=new x.c(T.name||`camera${T.index}`,u.l.Zero(),this._babylonScene,!1);switch(m._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,m.ignoreParentScaling=!0,T._babylonCamera=m,m.rotation.set(0,Math.PI,0),T.type){case"perspective":{const X=T.perspective;if(!X)throw new Error(`${v}: Camera perspective properties are missing`);m.fov=X.yfov,m.ij=X.znear,m.maxZ=X.zfar||0;break}case"orthographic":if(!T.orthographic)throw new Error(`${v}: Camera orthographic properties are missing`);m.mode=A.e.ORTHOGRAPHIC_CAMERA,m.orthoLeft=-T.orthographic.xmag,m.orthoRight=T.orthographic.xmag,m.orthoBottom=-T.orthographic.ymag,m.orthoTop=T.orthographic.ymag,m.ij=T.orthographic.znear,m.maxZ=T.orthographic.zfar;break;default:throw new Error(`${v}: Invalid camera type (${T.type})`)}return R.AddPointerMetadata(m,v),this._parent.onCameraLoadedObservable.notifyObservers(m),X(m),this.logClose(),Promise.all(B).then((()=>m))}_loadAnimationsAsync(){const v=this._gltf.animations;if(!v)return Promise.resolve();const T=new Array;for(let X=0;X<v.length;X++){const O=v[X];T.push(this.loadAnimationAsync(`/animations/${O.index}`,O).then((v=>{0===v.targetedAnimations.length&&v.dispose()})))}return Promise.all(T).then((()=>{}))}loadAnimationAsync(v,T){const O=this._extensionsLoadAnimationAsync(v,T);return O||X.e(43).then(X.bind(X,13204)).then((X=>{let{AnimationGroup:O}=X;this._babylonScene._blockEntityCollection=!!this._assetContainer;const u=new O(T.name||`animation${T.index}`,this._babylonScene);u._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,T._babylonAnimationGroup=u;const B=new Array;z.Assign(T.channels),z.Assign(T.samplers);for(const m of T.channels)B.push(this._loadAnimationChannelAsync(`${v}/channels/${m.index}`,v,T,m,((v,T)=>{v.animations=v.animations||[],v.animations.push(T),u.addTargetedAnimation(T,v)})));return Promise.all(B).then((()=>(u.normalize(0),u)))}))}_loadAnimationChannelAsync(v,T,X,O,u){const B=this._extensionsLoadAnimationChannelAsync(v,T,X,O,u);if(B)return B;if(void 0==O.target.node)return Promise.resolve();const m=z.Get(`${v}/target/node`,this._gltf.nodes,O.target.node),A=O.target.path,x="weights"===A;if(x&&!m._numMorphTargets||!x&&!m._babylonTransformNode)return Promise.resolve();if(!this._parent.loadNodeAnimations&&!x&&!m._isJoint)return Promise.resolve();let f;switch(A){case"translation":f=g.translation;break;case"rotation":f=g.rotation;break;case"scale":f=g.scale;break;case"weights":f=g.weights;break;default:throw new Error(`${v}/target/path: Invalid value (${O.target.path})`)}const M={object:m,info:f};return this._loadAnimationChannelFromTargetInfoAsync(v,T,X,O,M,u)}_loadAnimationChannelFromTargetInfoAsync(v,T,X,O,u,B){const m=this.parent.targetFps,A=1/m,x=z.Get(`${v}/sampler`,X.samplers,O.sampler);return this._loadAnimationSamplerAsync(`${T}/samplers/${O.sampler}`,x).then((v=>{let T=0;const x=u.object,f=u.info;for(const u of f){const f=u.getStride(x),M=v.input,H=v.output,n=new Array(M.length);let V=0;switch(v.interpolation){case"STEP":for(let v=0;v<M.length;v++){const T=u.getValue(x,H,V,1);V+=f,n[v]={frame:M[v]*m,value:T,interpolation:1}}break;case"CUBICSPLINE":for(let v=0;v<M.length;v++){const T=u.getValue(x,H,V,A);V+=f;const X=u.getValue(x,H,V,1);V+=f;const O=u.getValue(x,H,V,A);V+=f,n[v]={frame:M[v]*m,inTangent:T,value:X,outTangent:O}}break;case"LINEAR":for(let v=0;v<M.length;v++){const T=u.getValue(x,H,V,1);V+=f,n[v]={frame:M[v]*m,value:T}}}if(V>0){const v=`${X.name||`animation${X.index}`}_channel${O.index}_${T}`;u.buildAnimations(x,v,m,n,((v,X)=>{++T,B(v,X)}))}}}))}_loadAnimationSamplerAsync(v,T){if(T._data)return T._data;const X=T.interpolation||"LINEAR";switch(X){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${v}/interpolation: Invalid value (${T.interpolation})`)}const O=z.Get(`${v}/input`,this._gltf.accessors,T.input),u=z.Get(`${v}/output`,this._gltf.accessors,T.output);return T._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${O.index}`,O),this._loadFloatAccessorAsync(`/accessors/${u.index}`,u)]).then((v=>{let[T,O]=v;return{input:T,interpolation:X,output:O}})),T._data}loadBufferAsync(v,T,X,O){const u=this._extensionsLoadBufferAsync(v,T,X,O);if(u)return u;if(!T._data)if(T.uri)T._data=this.loadUriAsync(`${v}/uri`,T,T.uri);else{if(!this._bin)throw new Error(`${v}: Uri is missing or the binary glTF is missing its binary chunk`);T._data=this._bin.readAsync(0,T.byteLength)}return T._data.then((T=>{try{return new Uint8Array(T.buffer,T.byteOffset+X,O)}catch(u){throw new Error(`${v}: ${u.message}`)}}))}loadBufferViewAsync(v,T){const X=this._extensionsLoadBufferViewAsync(v,T);if(X)return X;if(T._data)return T._data;const O=z.Get(`${v}/buffer`,this._gltf.buffers,T.buffer);return T._data=this.loadBufferAsync(`/buffers/${O.index}`,O,T.byteOffset||0,T.byteLength),T._data}_loadAccessorAsync(v,T,X){if(T._data)return T._data;const O=R._GetNumComponents(v,T.type),u=O*U.e.GetTypeByteLength(T.componentType),B=O*T.count;if(void 0==T.bufferView)T._data=Promise.resolve(new X(B));else{const m=z.Get(`${v}/bufferView`,this._gltf.bufferViews,T.bufferView);T._data=this.loadBufferViewAsync(`/bufferViews/${m.index}`,m).then((A=>{if(5126!==T.componentType||T.normalized||m.byteStride&&m.byteStride!==u){const v=new X(B);return U.e.ForEach(A,T.byteOffset||0,m.byteStride||u,O,T.componentType,v.length,T.normalized||!1,((T,X)=>{v[X]=T})),v}return R._GetTypedArray(v,T.componentType,A,T.byteOffset,B)}))}if(T.sparse){const B=T.sparse;T._data=T._data.then((m=>{const A=m,x=z.Get(`${v}/sparse/indices/bufferView`,this._gltf.bufferViews,B.indices.bufferView),f=z.Get(`${v}/sparse/values/bufferView`,this._gltf.bufferViews,B.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${x.index}`,x),this.loadBufferViewAsync(`/bufferViews/${f.index}`,f)]).then((m=>{let[x,f]=m;const M=R._GetTypedArray(`${v}/sparse/indices`,B.indices.componentType,x,B.indices.byteOffset,B.count),H=O*B.count;let n;if(5126!==T.componentType||T.normalized){const m=R._GetTypedArray(`${v}/sparse/values`,T.componentType,f,B.values.byteOffset,H);n=new X(H),U.e.ForEach(m,0,u,O,T.componentType,n.length,T.normalized||!1,((v,T)=>{n[T]=v}))}else n=R._GetTypedArray(`${v}/sparse/values`,T.componentType,f,B.values.byteOffset,H);let V=0;for(let v=0;v<M.length;v++){let T=M[v]*O;for(let v=0;v<O;v++)A[T++]=n[V++]}return A}))}))}return T._data}_loadFloatAccessorAsync(v,T){return this._loadAccessorAsync(v,T,Float32Array)}_loadIndicesAccessorAsync(v,T){if("SCALAR"!==T.type)throw new Error(`${v}/type: Invalid value ${T.type}`);if(5121!==T.componentType&&5123!==T.componentType&&5125!==T.componentType)throw new Error(`${v}/componentType: Invalid value ${T.componentType}`);if(T._data)return T._data;if(T.sparse){const X=R._GetTypedArrayConstructor(`${v}/componentType`,T.componentType);T._data=this._loadAccessorAsync(v,T,X)}else{const X=z.Get(`${v}/bufferView`,this._gltf.bufferViews,T.bufferView);T._data=this.loadBufferViewAsync(`/bufferViews/${X.index}`,X).then((X=>R._GetTypedArray(v,T.componentType,X,T.byteOffset,T.count)))}return T._data}_loadVertexBufferViewAsync(v){if(v._babylonBuffer)return v._babylonBuffer;const T=this._babylonScene.getEngine();return v._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${v.index}`,v).then((v=>new U.d(T,v,!1))),v._babylonBuffer}_loadVertexAccessorAsync(v,T,X){var O;if(null!==(O=T._babylonVertexBuffer)&&void 0!==O&&O[X])return T._babylonVertexBuffer[X];T._babylonVertexBuffer||(T._babylonVertexBuffer={});const u=this._babylonScene.getEngine();if(T.sparse||void 0==T.bufferView)T._babylonVertexBuffer[X]=this._loadFloatAccessorAsync(v,T).then((v=>new U.e(u,v,X,!1)));else{const O=z.Get(`${v}/bufferView`,this._gltf.bufferViews,T.bufferView);T._babylonVertexBuffer[X]=this._loadVertexBufferViewAsync(O).then((B=>{const m=R._GetNumComponents(v,T.type);return new U.e(u,B,X,!1,void 0,O.byteStride,void 0,T.byteOffset,m,T.componentType,T.normalized,!0,void 0,!0)}))}return T._babylonVertexBuffer[X]}_loadMaterialMetallicRoughnessPropertiesAsync(v,T,X){if(!(X instanceof r))throw new Error(`${v}: Material type not supported`);const O=new Array;return T&&(T.baseColorFactor?(X.albedoColor=B.d.Ld(T.baseColorFactor),X.alpha=T.baseColorFactor[3]):X.albedoColor=B.d.White(),X.metallic=void 0==T.metallicFactor?1:T.metallicFactor,X.roughness=void 0==T.roughnessFactor?1:T.roughnessFactor,T.baseColorTexture&&O.push(this.loadTextureInfoAsync(`${v}/baseColorTexture`,T.baseColorTexture,(v=>{v.name=`${X.name} (Base Color)`,X.albedoTexture=v}))),T.metallicRoughnessTexture&&(T.metallicRoughnessTexture.nonColorData=!0,O.push(this.loadTextureInfoAsync(`${v}/metallicRoughnessTexture`,T.metallicRoughnessTexture,(v=>{v.name=`${X.name} (Metallic Roughness)`,X.metallicTexture=v}))),X.useMetallnessFromMetallicTextureBlue=!0,X.useRoughnessFromMetallicTextureGreen=!0,X.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(O).then((()=>{}))}_loadMaterialAsync(v,T,X,O){let u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const B=this._extensionsLoadMaterialAsync(v,T,X,O,u);if(B)return B;T._data=T._data||{};let m=T._data[O];if(!m){this.logOpen(`${v} ${T.name||""}`);const X=this.createMaterial(v,T,O);m={babylonMaterial:X,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(v,T,X)},T._data[O]=m,R.AddPointerMetadata(X,v),this._parent.onMaterialLoadedObservable.notifyObservers(X),this.logClose()}return X&&(m.babylonMeshes.push(X),X.ae.addOnce((()=>{const v=m.babylonMeshes.indexOf(X);-1!==v&&m.babylonMeshes.splice(v,1)}))),u(m.babylonMaterial),m.promise.then((()=>m.babylonMaterial))}_createDefaultMaterial(v,T){this._babylonScene._blockEntityCollection=!!this._assetContainer;const X=new r(v,this._babylonScene);return X._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,X.fillMode=T,X.enableSpecularAntiAliasing=!0,X.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,X.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,X.transparencyMode=r.PBRMATERIAL_OPAQUE,X.metallic=1,X.roughness=1,X}createMaterial(v,T,X){const O=this._extensionsCreateMaterial(v,T,X);if(O)return O;const u=T.name||`material${T.index}`;return this._createDefaultMaterial(u,X)}loadMaterialPropertiesAsync(v,T,X){const O=this._extensionsLoadMaterialPropertiesAsync(v,T,X);if(O)return O;const u=new Array;return u.push(this.loadMaterialBasePropertiesAsync(v,T,X)),T.pbrMetallicRoughness&&u.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${v}/pbrMetallicRoughness`,T.pbrMetallicRoughness,X)),this.loadMaterialAlphaProperties(v,T,X),Promise.all(u).then((()=>{}))}loadMaterialBasePropertiesAsync(v,T,X){if(!(X instanceof r))throw new Error(`${v}: Material type not supported`);const O=new Array;return X.emissiveColor=T.emissiveFactor?B.d.Ld(T.emissiveFactor):new B.d(0,0,0),T.doubleSided&&(X.Xe=!1,X.twoSidedLighting=!0),T.normalTexture&&(T.normalTexture.nonColorData=!0,O.push(this.loadTextureInfoAsync(`${v}/normalTexture`,T.normalTexture,(v=>{v.name=`${X.name} (Normal)`,X.bumpTexture=v}))),X.invertNormalMapX=!this._babylonScene.useRightHandedSystem,X.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=T.normalTexture.scale&&X.bumpTexture&&(X.bumpTexture.level=T.normalTexture.scale),X.forceIrradianceInFragment=!0),T.occlusionTexture&&(T.occlusionTexture.nonColorData=!0,O.push(this.loadTextureInfoAsync(`${v}/occlusionTexture`,T.occlusionTexture,(v=>{v.name=`${X.name} (Occlusion)`,X.ambientTexture=v}))),X.useAmbientInGrayScale=!0,void 0!=T.occlusionTexture.strength&&(X.ambientTextureStrength=T.occlusionTexture.strength)),T.emissiveTexture&&O.push(this.loadTextureInfoAsync(`${v}/emissiveTexture`,T.emissiveTexture,(v=>{v.name=`${X.name} (Emissive)`,X.emissiveTexture=v}))),Promise.all(O).then((()=>{}))}loadMaterialAlphaProperties(v,T,X){if(!(X instanceof r))throw new Error(`${v}: Material type not supported`);switch(T.alphaMode||"OPAQUE"){case"OPAQUE":X.transparencyMode=r.PBRMATERIAL_OPAQUE,X.alpha=1;break;case"MASK":X.transparencyMode=r.PBRMATERIAL_ALPHATEST,X.alphaCutOff=void 0==T.alphaCutoff?.5:T.alphaCutoff,X.albedoTexture&&(X.albedoTexture.yd=!0);break;case"BLEND":X.transparencyMode=r.PBRMATERIAL_ALPHABLEND,X.albedoTexture&&(X.albedoTexture.yd=!0,X.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${v}/alphaMode: Invalid value (${T.alphaMode})`)}}loadTextureInfoAsync(v,T){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const O=this._extensionsLoadTextureInfoAsync(v,T,X);if(O)return O;if(this.logOpen(`${v}`),T.texCoord>=6)throw new Error(`${v}/texCoord: Invalid value (${T.texCoord})`);const u=z.Get(`${v}/index`,this._gltf.textures,T.index);u._textureInfo=T;const B=this._loadTextureAsync(`/textures/${T.index}`,u,(O=>{O.coordinatesIndex=T.texCoord||0,R.AddPointerMetadata(O,v),this._parent.onTextureLoadedObservable.notifyObservers(O),X(O)}));return this.logClose(),B}_loadTextureAsync(v,T){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const O=this._extensionsLoadTextureAsync(v,T,X);if(O)return O;this.logOpen(`${v} ${T.name||""}`);const u=void 0==T.sampler?R.DefaultSampler:z.Get(`${v}/sampler`,this._gltf.samplers,T.sampler),B=z.Get(`${v}/source`,this._gltf.images,T.source),m=this._createTextureAsync(v,u,B,X,void 0,!T._textureInfo.nonColorData);return this.logClose(),m}_createTextureAsync(v,T,X){let u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},B=arguments.length>4?arguments[4]:void 0,m=arguments.length>5?arguments[5]:void 0;const A=this._loadSampler(`/samplers/${T.index}`,T),x=new Array,f=new O;this._babylonScene._blockEntityCollection=!!this._assetContainer;const M={noMipmap:A.noMipMaps,invertY:!1,samplingMode:A.samplingMode,X:()=>{this._disposed||f.resolve()},onError:(T,X)=>{this._disposed||f.reject(new Error(`${v}: ${X&&X.message?X.message:T||"Failed to load texture"}`))},mimeType:X.mimeType,loaderOptions:B,useSRGBBuffer:!!m&&this._parent.useSRGBBuffers},H=new o.e(null,this._babylonScene,M);return H._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,x.push(f.promise),x.push(this.loadImageAsync(`/images/${X.index}`,X).then((v=>{const T=X.uri||`${this._fileName}#image${X.index}`,O=`data:${this._uniqueRootUrl}${T}`;H.updateURL(O,v);const u=H.getInternalTexture();u&&(u.label=X.name)}))),H.wrapU=A.wrapU,H.wrapV=A.wrapV,u(H),this._parent.useGltfTextureNames&&(H.name=X.name||X.uri||`image${X.index}`),Promise.all(x).then((()=>H))}_loadSampler(v,T){return T._data||(T._data={noMipMaps:9728===T.minFilter||9729===T.minFilter,samplingMode:R._GetTextureSamplingMode(v,T),wrapU:R._GetTextureWrapMode(`${v}/wrapS`,T.wrapS),wrapV:R._GetTextureWrapMode(`${v}/wrapT`,T.wrapT)}),T._data}loadImageAsync(v,T){if(!T._data){if(this.logOpen(`${v} ${T.name||""}`),T.uri)T._data=this.loadUriAsync(`${v}/uri`,T,T.uri);else{const X=z.Get(`${v}/bufferView`,this._gltf.bufferViews,T.bufferView);T._data=this.loadBufferViewAsync(`/bufferViews/${X.index}`,X)}this.logClose()}return T._data}loadUriAsync(v,T,X){const O=this._extensionsLoadUriAsync(v,T,X);if(O)return O;if(!R._ValidateUri(X))throw new Error(`${v}: '${X}' is invalid`);if((0,c.k)(X)){const T=new Uint8Array((0,c.e)(X));return this.log(`${v}: Decoded ${X.substring(0,64)}... (${T.length} bytes)`),Promise.resolve(T)}return this.log(`${v}: Loading ${X}`),this._parent.preprocessUrlAsync(this._rootUrl+X).then((T=>new Promise(((O,u)=>{this._parent._loadFile(this._babylonScene,T,(T=>{this._disposed||(this.log(`${v}: Loaded ${X} (${T.byteLength} bytes)`),O(new Uint8Array(T)))}),!0,(T=>{u(new c.n(`${v}: Failed to load '${X}'${T?": "+T.status+" "+T.statusText:""}`,T))}))}))))}static AddPointerMetadata(v,T){v.metadata=v.metadata||{};const X=v._internalMetadata=v._internalMetadata||{},O=X.cj=X.cj||{};(O.pointers=O.pointers||[]).push(T)}static _GetTextureWrapMode(v,T){switch(T=void 0==T?10497:T){case 33071:return o.e.CLAMP_ADDRESSMODE;case 33648:return o.e.MIRROR_ADDRESSMODE;case 10497:return o.e.WRAP_ADDRESSMODE;default:return s.d.Warn(`${v}: Invalid value (${T})`),o.e.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(v,T){const X=void 0==T.magFilter?9729:T.magFilter,O=void 0==T.minFilter?9987:T.minFilter;if(9729===X)switch(O){case 9728:return o.e.LINEAR_NEAREST;case 9729:return o.e.LINEAR_LINEAR;case 9984:return o.e.LINEAR_NEAREST_MIPNEAREST;case 9985:return o.e.LINEAR_LINEAR_MIPNEAREST;case 9986:return o.e.LINEAR_NEAREST_MIPLINEAR;case 9987:return o.e.LINEAR_LINEAR_MIPLINEAR;default:return s.d.Warn(`${v}/minFilter: Invalid value (${O})`),o.e.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==X&&s.d.Warn(`${v}/magFilter: Invalid value (${X})`),O){case 9728:return o.e.NEAREST_NEAREST;case 9729:return o.e.NEAREST_LINEAR;case 9984:return o.e.NEAREST_NEAREST_MIPNEAREST;case 9985:return o.e.NEAREST_LINEAR_MIPNEAREST;case 9986:return o.e.NEAREST_NEAREST_MIPLINEAR;case 9987:return o.e.NEAREST_LINEAR_MIPLINEAR;default:return s.d.Warn(`${v}/minFilter: Invalid value (${O})`),o.e.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(v,T){switch(T){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`${v}: Invalid component type ${T}`)}}static _GetTypedArray(v,T,X,O,u){const B=X.buffer;O=X.byteOffset+(O||0);const m=R._GetTypedArrayConstructor(`${v}/componentType`,T),A=U.e.GetTypeByteLength(T);return O%A!==0?(s.d.Warn(`${v}: Copying buffer as byte offset (${O}) is not a multiple of component type byte length (${A})`),new m(B.slice(O,O+u*A),0)):new m(B,O,u)}static _GetNumComponents(v,T){switch(T){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${v}: Invalid type (${T})`)}static _ValidateUri(v){return m.c.IsBase64(v)||-1===v.indexOf("..")}static _GetDrawMode(v,T){switch(void 0==T&&(T=4),T){case 0:return b.d.PointListDrawMode;case 1:return b.d.LineListDrawMode;case 2:return b.d.LineLoopDrawMode;case 3:return b.d.LineStripDrawMode;case 4:return b.d.TriangleFillMode;case 5:return b.d.TriangleStripDrawMode;case 6:return b.d.TriangleFanDrawMode}throw new Error(`${v}: Invalid mesh primitive mode (${T})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const v=new Array;if(this._gltf.materials)for(const T of this._gltf.materials)if(T._data)for(const X in T._data){const O=T._data[X];for(const T of O.babylonMeshes){T.Ke(!0);const X=O.babylonMaterial;v.push(X.forceCompilationAsync(T)),v.push(X.forceCompilationAsync(T,{useInstances:!0})),this._parent.useClipPlane&&(v.push(X.forceCompilationAsync(T,{clipPlane:!0})),v.push(X.forceCompilationAsync(T,{clipPlane:!0,useInstances:!0})))}}return Promise.all(v).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const v=new Array,T=this._babylonScene.lights;for(const X of T){const T=X.getShadowGenerator();T&&v.push(T.forceCompilationAsync())}return Promise.all(v).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(v){for(const T of this._extensions)T.enabled&&v(T)}_applyExtensions(v,T,X){for(const O of this._extensions)if(O.enabled){const u=`${O.name}.${T}`,B=v;B._activeLoaderExtensionFunctions=B._activeLoaderExtensionFunctions||{};const m=B._activeLoaderExtensionFunctions;if(!m[u]){m[u]=!0;try{const v=X(O);if(v)return v}finally{delete m[u]}}}return null}_extensionsOnLoading(){this._forEachExtensions((v=>v.onLoading&&v.onLoading()))}_extensionsOnReady(){this._forEachExtensions((v=>v.onReady&&v.onReady()))}_extensionsLoadSceneAsync(v,T){return this._applyExtensions(T,"loadScene",(X=>X.loadSceneAsync&&X.loadSceneAsync(v,T)))}_extensionsLoadNodeAsync(v,T,X){return this._applyExtensions(T,"loadNode",(O=>O.loadNodeAsync&&O.loadNodeAsync(v,T,X)))}_extensionsLoadCameraAsync(v,T,X){return this._applyExtensions(T,"loadCamera",(O=>O.loadCameraAsync&&O.loadCameraAsync(v,T,X)))}_extensionsLoadVertexDataAsync(v,T,X){return this._applyExtensions(T,"loadVertexData",(O=>O._loadVertexDataAsync&&O._loadVertexDataAsync(v,T,X)))}_extensionsLoadMeshPrimitiveAsync(v,T,X,O,u,B){return this._applyExtensions(u,"loadMeshPrimitive",(m=>m._loadMeshPrimitiveAsync&&m._loadMeshPrimitiveAsync(v,T,X,O,u,B)))}_extensionsLoadMaterialAsync(v,T,X,O,u){return this._applyExtensions(T,"loadMaterial",(B=>B._loadMaterialAsync&&B._loadMaterialAsync(v,T,X,O,u)))}_extensionsCreateMaterial(v,T,X){return this._applyExtensions(T,"createMaterial",(O=>O.createMaterial&&O.createMaterial(v,T,X)))}_extensionsLoadMaterialPropertiesAsync(v,T,X){return this._applyExtensions(T,"loadMaterialProperties",(O=>O.loadMaterialPropertiesAsync&&O.loadMaterialPropertiesAsync(v,T,X)))}_extensionsLoadTextureInfoAsync(v,T,X){return this._applyExtensions(T,"loadTextureInfo",(O=>O.loadTextureInfoAsync&&O.loadTextureInfoAsync(v,T,X)))}_extensionsLoadTextureAsync(v,T,X){return this._applyExtensions(T,"loadTexture",(O=>O._loadTextureAsync&&O._loadTextureAsync(v,T,X)))}_extensionsLoadAnimationAsync(v,T){return this._applyExtensions(T,"loadAnimation",(X=>X.loadAnimationAsync&&X.loadAnimationAsync(v,T)))}_extensionsLoadAnimationChannelAsync(v,T,X,O,u){return this._applyExtensions(X,"loadAnimationChannel",(B=>B._loadAnimationChannelAsync&&B._loadAnimationChannelAsync(v,T,X,O,u)))}_extensionsLoadSkinAsync(v,T,X){return this._applyExtensions(X,"loadSkin",(O=>O._loadSkinAsync&&O._loadSkinAsync(v,T,X)))}_extensionsLoadUriAsync(v,T,X){return this._applyExtensions(T,"loadUri",(O=>O._loadUriAsync&&O._loadUriAsync(v,T,X)))}_extensionsLoadBufferViewAsync(v,T){return this._applyExtensions(T,"loadBufferView",(X=>X.loadBufferViewAsync&&X.loadBufferViewAsync(v,T)))}_extensionsLoadBufferAsync(v,T,X,O){return this._applyExtensions(T,"loadBuffer",(u=>u.loadBufferAsync&&u.loadBufferAsync(v,T,X,O)))}static LoadExtensionAsync(v,T,X,O){if(!T.extensions)return null;const u=T.extensions[X];return u?O(`${v}/extensions/${X}`,u):null}static LoadExtraAsync(v,T,X,O){if(!T.extras)return null;const u=T.extras[X];return u?O(`${v}/extras/${X}`,u):null}isExtensionUsed(v){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(v)}logOpen(v){this._parent._logOpen(v)}logClose(){this._parent._logClose()}log(v){this._parent._log(v)}startPerformanceCounter(v){this._parent._startPerformanceCounter(v)}endPerformanceCounter(v){this._parent._endPerformanceCounter(v)}}R.DefaultSampler={index:-1},C.c._CreateGLTF2Loader=v=>new R(v);var Y=X(1483),q=X(10839),vv=X(12578);class Tv extends vv.b{constructor(v,T,X){let O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,B=arguments.length>5&&void 0!==arguments[5]&&arguments[5],m=arguments.length>6&&void 0!==arguments[6]&&arguments[6],A=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,x=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",v),this._texture=v.getEngine().createRawCubeTexture(T,X,O,u,B,m,A,x)}update(v,T,X,O){let u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,v,T,X,O,u)}updateRGBDAsync(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,q.k)(this._texture,v,T,X,O).then((()=>{}))}clone(){return L.e.Clone((()=>{const v=this.va(),T=this._texture,X=new Tv(v,T._bufferViewArray,T.width,T.format,T.type,T.generateMipMaps,T.invertY,T.samplingMode,T._compression);return 13===T.source&&X.updateRGBDAsync(T._bufferViewArrayArray,T._sphericalPolynomial,T._lodGenerationScale,T._lodGenerationOffset),X}),this)}}const Xv="EXT_lights_image_based";class Ov{constructor(v){this.name=Xv,this._loader=v,this.enabled=this._loader.isExtensionUsed(Xv)}dispose(){this._loader=null,delete this._lights}onLoading(){const v=this._loader.cj.extensions;if(v&&v[this.name]){const T=v[this.name];this._lights=T.lights}}loadSceneAsync(v,T){return R.LoadExtensionAsync(v,T,this.name,((X,O)=>{this._loader._allMaterialsDirtyRequired=!0;const u=new Array;u.push(this._loader.loadSceneAsync(v,T)),this._loader.logOpen(`${X}`);const B=z.Get(`${X}/light`,this._lights,O.eb);return u.push(this._loadLightAsync(`/extensions/${this.name}/lights/${O.eb}`,B).then((v=>{this._loader.babylonScene.environmentTexture=v}))),this._loader.logClose(),Promise.all(u).then((()=>{}))}))}_loadLightAsync(v,T){if(!T._loaded){const X=new Array;this._loader.logOpen(`${v}`);const O=new Array(T.specularImages.length);for(let u=0;u<T.specularImages.length;u++){const B=T.specularImages[u];O[u]=new Array(B.length);for(let T=0;T<B.length;T++){const m=`${v}/specularImages/${u}/${T}`;this._loader.logOpen(`${m}`);const A=B[T],x=z.Get(m,this._loader.cj.images,A);X.push(this._loader.loadImageAsync(`/images/${A}`,x).then((v=>{O[u][T]=v}))),this._loader.logClose()}}this._loader.logClose(),T._loaded=Promise.all(X).then((()=>{const X=new Tv(this._loader.babylonScene,null,T.specularImageSize);if(X.name=T.name||"environment",T._babylonTexture=X,void 0!=T.mj&&(X.level=T.mj),T.rotation){let v=u.f.Ld(T.rotation);this._loader.babylonScene.useRightHandedSystem||(v=u.f.Inverse(v)),u.b.FromQuaternionToRef(v,X.getReflectionTextureMatrix())}if(!T.irradianceCoefficients)throw new Error(`${v}: Irradiance coefficients are missing`);const B=Y.b.Ld(T.irradianceCoefficients);B.scaleInPlace(T.mj),B.convertIrradianceToLambertianRadiance();const m=Y.e.FromHarmonics(B),A=(O.length-1)/Math.log2(T.specularImageSize);return X.updateRGBDAsync(O,m,A)}))}return T._loaded.then((()=>T._babylonTexture))}}S(Xv),h(Xv,!0,(v=>new Ov(v)));X(12581);const uv="EXT_mesh_gpu_instancing";class Bv{constructor(v){this.name=uv,this._loader=v,this.enabled=this._loader.isExtensionUsed(uv)}dispose(){this._loader=null}loadNodeAsync(v,T,X){return R.LoadExtensionAsync(v,T,this.name,((v,O)=>{this._loader._disableInstancedMesh++;const B=this._loader.loadNodeAsync(`/nodes/${T.index}`,T,X);if(this._loader._disableInstancedMesh--,!T._primitiveBabylonMeshes)return B;const m=new Array;let A=0;const x=T=>{if(void 0==O.attributes[T])return void m.push(Promise.resolve(null));const X=z.Get(`${v}/attributes/${T}`,this._loader.cj.accessors,O.attributes[T]);if(m.push(this._loader._loadFloatAccessorAsync(`/accessors/${X.bufferView}`,X)),0===A)A=X.count;else if(A!==X.count)throw new Error(`${v}/attributes: Instance buffer accessors do not have the same count.`)};return x("TRANSLATION"),x("ROTATION"),x("SCALE"),B.then((v=>Promise.all(m).then((X=>{let[O,B,m]=X;const x=new Float32Array(16*A);u.g.Vd[0].Sd(0,0,0),u.g.Quaternion[0].Sd(0,0,0,1),u.g.Vd[1].Sd(1,1,1);for(let v=0;v<A;++v)O&&u.l.FromArrayToRef(O,3*v,u.g.Vd[0]),B&&u.f.FromArrayToRef(B,4*v,u.g.Quaternion[0]),m&&u.l.FromArrayToRef(m,3*v,u.g.Vd[1]),u.b.ComposeToRef(u.g.Vd[1],u.g.Quaternion[0],u.g.Vd[0],u.g.Matrix[0]),u.g.Matrix[0].copyToArray(x,16*v);for(const v of T._primitiveBabylonMeshes)v.Vj("matrix",x,16,!0);return v}))))}))}}S(uv),h(uv,!0,(v=>new Bv(v)));class mv{static get Default(){return mv._Default||(mv._Default=new mv),mv._Default}constructor(){const v=mv.Configuration.decoder;this._decoderModulePromise=m.c.LoadBabylonScriptAsync(v.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}decodeGltfBufferAsync(v,T,X,O,u){return this._decoderModulePromise.then((async()=>{MeshoptDecoder.useWorkers(1);const B=await MeshoptDecoder.decodeGltfBufferAsync(T,X,v,O,u);return MeshoptDecoder.useWorkers(0),B}))}}mv.Configuration={decoder:{url:`${m.c._DefaultCdnUrl}/meshopt_decoder.js`}},mv._Default=null;const Av="EXT_meshopt_compression";class xv{constructor(v){this.name=Av,this.enabled=v.isExtensionUsed(Av),this._loader=v}dispose(){this._loader=null}loadBufferViewAsync(v,T){return R.LoadExtensionAsync(v,T,this.name,((X,O)=>{const u=T;if(u._meshOptData)return u._meshOptData;const B=z.Get(`${v}/buffer`,this._loader.cj.buffers,O.buffer);return u._meshOptData=this._loader.loadBufferAsync(`/buffers/${B.index}`,B,O.byteOffset||0,O.byteLength).then((v=>mv.Default.decodeGltfBufferAsync(v,O.count,O.byteStride,O.mode,O.filter))),u._meshOptData}))}}S(Av),h(Av,!0,(v=>new xv(v)));const fv="EXT_texture_webp";class Mv{constructor(v){this.name=fv,this._loader=v,this.enabled=v.isExtensionUsed(fv)}dispose(){this._loader=null}_loadTextureAsync(v,T,X){return R.LoadExtensionAsync(v,T,this.name,((O,u)=>{const B=void 0==T.sampler?R.DefaultSampler:z.Get(`${v}/sampler`,this._loader.cj.samplers,T.sampler),m=z.Get(`${O}/source`,this._loader.cj.images,u.source);return this._loader._createTextureAsync(v,B,m,(v=>{X(v)}),void 0,!T._textureInfo.nonColorData)}))}}S(fv),h(fv,!0,(v=>new Mv(v)));const Hv="EXT_texture_avif";class nv{constructor(v){this.name=Hv,this._loader=v,this.enabled=v.isExtensionUsed(Hv)}dispose(){this._loader=null}_loadTextureAsync(v,T,X){return R.LoadExtensionAsync(v,T,this.name,((O,u)=>{const B=void 0==T.sampler?R.DefaultSampler:z.Get(`${v}/sampler`,this._loader.cj.samplers,T.sampler),m=z.Get(`${O}/source`,this._loader.cj.images,u.source);return this._loader._createTextureAsync(v,B,m,(v=>{X(v)}),void 0,!T._textureInfo.nonColorData)}))}}S(Hv),h(Hv,!0,(v=>new nv(v)));var Vv=X(12587);const Dv="KHR_draco_mesh_compression";class sv{constructor(v){this.name=Dv,this.useNormalizedFlagFromAccessor=!0,this._loader=v,this.enabled=Vv.b.DecoderAvailable&&this._loader.isExtensionUsed(Dv)}dispose(){delete this.dracoCompression,this._loader=null}_loadVertexDataAsync(v,T,X){return R.LoadExtensionAsync(v,T,this.name,((O,u)=>{if(void 0!=T.mode&&4!==T.mode&&5!==T.mode)throw new Error(`${v}: Unsupported mode ${T.mode}`);const B={},m={},A=(v,O)=>{const A=u.attributes[v];if(void 0!=A&&(X._delayInfo=X._delayInfo||[],-1===X._delayInfo.indexOf(O)&&X._delayInfo.push(O),B[O]=A,this.useNormalizedFlagFromAccessor)){const X=z.TryGet(this._loader.cj.accessors,T.attributes[v]);X&&(m[O]=X.normalized||!1)}};A("POSITION",U.e.PositionKind),A("NORMAL",U.e.NormalKind),A("TANGENT",U.e.TangentKind),A("TEXCOORD_0",U.e.UVKind),A("TEXCOORD_1",U.e.UV2Kind),A("TEXCOORD_2",U.e.UV3Kind),A("TEXCOORD_3",U.e.UV4Kind),A("TEXCOORD_4",U.e.UV5Kind),A("TEXCOORD_5",U.e.UV6Kind),A("JOINTS_0",U.e.MatricesIndicesKind),A("WEIGHTS_0",U.e.MatricesWeightsKind),A("COLOR_0",U.e.ColorKind);const x=z.Get(O,this._loader.cj.bufferViews,u.bufferView);return x._dracoBabylonGeometry||(x._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${x.index}`,x).then((T=>(this.dracoCompression||Vv.b.Default)._decodeMeshToGeometryForGltfAsync(X.name,this._loader.babylonScene,T,B,m).catch((T=>{throw new Error(`${v}: ${T.message}`)}))))),x._dracoBabylonGeometry}))}}S(Dv),h(Dv,!0,(v=>new sv(v)));var Fv=X(12593),kv=X(11928),bv=X(12571),lv=X(12597);kv.e.AddNodeConstructor("Light_Type_0",((v,T)=>()=>new Qv(v,u.l.Zero(),T)));class Qv extends lv.c{get shadowAngle(){return this._shadowAngle}set shadowAngle(v){this._shadowAngle=v,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(v){const T=this.needCube();if(this._direction=v,this.needCube()!==T&&this._shadowGenerators){const v=this._shadowGenerators.values();for(let T=v.next();!0!==T.done;T=v.next()){T.value.recreateShadowMap()}}}constructor(v,T,X){super(v,X),this._shadowAngle=Math.PI/2,this.position=T}getClassName(){return"PointLight"}getTypeID(){return bv.d.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(v){if(this.direction)return super.getShadowDirection(v);switch(v){case 0:return new u.l(1,0,0);case 1:return new u.l(-1,0,0);case 2:return new u.l(0,-1,0);case 3:return new u.l(0,1,0);case 4:return new u.l(0,0,1);case 5:return new u.l(0,0,-1)}return u.l.Zero()}_setDefaultShadowProjectionMatrix(v,T,X){const O=this.va().activeCamera;if(!O)return;const B=void 0!==this.shadowMinZ?this.shadowMinZ:O.ij,m=void 0!==this.shadowMaxZ?this.shadowMaxZ:O.maxZ,A=this.va().getEngine().useReverseDepthBuffer;u.b.PerspectiveFovLHToRef(this.shadowAngle,1,A?m:B,A?B:m,v,!0,this._scene.getEngine().isNDCHalfZRange,void 0,A)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(v,T){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,T):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,T),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,T),this}transferToNodeMaterialEffect(v,T){return this.computeTransformedInformation()?v.setFloat3(T,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):v.setFloat3(T,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(v,T){v["POINTLIGHT"+T]=!0}}(0,l.c)([(0,Q.G)()],Qv.prototype,"shadowAngle",null),(0,G.f)("BABYLON.PointLight",Qv),kv.e.AddNodeConstructor("Light_Type_2",((v,T)=>()=>new Kv(v,u.l.Zero(),u.l.Zero(),0,0,T)));class Kv extends lv.c{get angle(){return this._angle}set angle(v){this._angle=v,this._cosHalfAngle=Math.cos(.5*v),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(v){this._innerAngle=v,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(v){this._shadowAngleScale=v,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(v){this._projectionTextureLightNear=v,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(v){this._projectionTextureLightFar=v,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(v){this._projectionTextureUpDirection=v,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(v){this._projectionTexture!==v&&(this._projectionTexture=v,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(Kv._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):Kv._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(v){return void 0!==v.onGeneratedObservable}static _IsTexture(v){return void 0!==v.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(v){this._projectionTextureProjectionLightMatrix=v,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(v,T,X,O,B,m){super(v,m),this._innerAngle=0,this._projectionTextureMatrix=u.b.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=u.l.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=u.l.Zero(),this._projectionTextureViewLightMatrix=u.b.Zero(),this._projectionTextureProjectionLightMatrix=u.b.Zero(),this._projectionTextureScalingMatrix=u.b.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=T,this.direction=X,this.angle=O,this.exponent=B}getClassName(){return"SpotLight"}getTypeID(){return bv.d.LIGHTTYPEID_SPOTLIGHT}_setDirection(v){super._setDirection(v),this._projectionTextureViewLightDirty=!0}_setPosition(v){super._setPosition(v),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(v,T,X){const O=this.va().activeCamera;if(!O)return;this._shadowAngleScale=this._shadowAngleScale||1;const B=this._shadowAngleScale*this._angle,m=void 0!==this.shadowMinZ?this.shadowMinZ:O.ij,A=void 0!==this.shadowMaxZ?this.shadowMaxZ:O.maxZ,x=this.va().getEngine().useReverseDepthBuffer;u.b.PerspectiveFovLHToRef(B,1,x?A:m,x?m:A,v,!0,this._scene.getEngine().isNDCHalfZRange,void 0,x)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),u.b.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const v=this.projectionTextureLightFar,T=this.projectionTextureLightNear,X=v/(v-T),O=-X*T,B=1/Math.tan(this._angle/2);u.b.FromValuesToRef(B/1,0,0,0,0,B,0,0,0,0,X,1,0,0,O,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof o.e){const v=this._projectionTexture.uScale/2,T=this._projectionTexture.vScale/2;u.b.FromValuesToRef(v,0,0,0,0,T,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(v,T){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),v.setMatrix("textureProjectionMatrix"+T,this._projectionTextureMatrix),v.setTexture("projectionLightTexture"+T,this.projectionTexture)),this}transferToEffect(v,T){let X;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,T),X=u.l.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,T),X=u.l.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",X.x,X.y,X.z,this._cosHalfAngle,T),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,T),this}transferToNodeMaterialEffect(v,T){let X;return X=this.computeTransformedInformation()?u.l.Normalize(this.transformedDirection):u.l.Normalize(this.direction),this.va().useRightHandedSystem?v.setFloat3(T,-X.x,-X.y,-X.z):v.setFloat3(T,X.x,X.y,X.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose()}getDepthMinZ(v){const T=this._scene.getEngine(),X=void 0!==this.shadowMinZ?this.shadowMinZ:v.ij;return T.useReverseDepthBuffer&&T.isNDCHalfZRange?X:this._scene.getEngine().isNDCHalfZRange?0:X}getDepthMaxZ(v){const T=this._scene.getEngine(),X=void 0!==this.shadowMaxZ?this.shadowMaxZ:v.maxZ;return T.useReverseDepthBuffer&&T.isNDCHalfZRange?0:X}prepareLightSpecificDefines(v,T){v["SPOTLIGHT"+T]=!0,v["PROJECTEDLIGHTTEXTURE"+T]=!(!this.projectionTexture||!this.projectionTexture.isReady())}}(0,l.c)([(0,Q.G)()],Kv.prototype,"angle",null),(0,l.c)([(0,Q.G)()],Kv.prototype,"innerAngle",null),(0,l.c)([(0,Q.G)()],Kv.prototype,"shadowAngleScale",null),(0,l.c)([(0,Q.G)()],Kv.prototype,"exponent",void 0),(0,l.c)([(0,Q.G)()],Kv.prototype,"projectionTextureLightNear",null),(0,l.c)([(0,Q.G)()],Kv.prototype,"projectionTextureLightFar",null),(0,l.c)([(0,Q.G)()],Kv.prototype,"projectionTextureUpDirection",null),(0,l.c)([(0,Q.z)("projectedLightTexture")],Kv.prototype,"_projectionTexture",void 0),(0,G.f)("BABYLON.SpotLight",Kv);const pv="KHR_lights_punctual";class Gv{constructor(v){this.name=pv,this._loader=v,this.enabled=this._loader.isExtensionUsed(pv)}dispose(){this._loader=null,delete this._lights}onLoading(){const v=this._loader.cj.extensions;if(v&&v[this.name]){const T=v[this.name];this._lights=T.lights,z.Assign(this._lights)}}loadNodeAsync(v,T,X){return R.LoadExtensionAsync(v,T,this.name,((O,m)=>(this._loader._allMaterialsDirtyRequired=!0,this._loader.loadNodeAsync(v,T,(v=>{let T;const A=z.Get(O,this._lights,m.eb),x=A.name||v.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,A.type){case"directional":{const v=new Fv.c(x,u.l.Backward(),this._loader.babylonScene);v.position.Td(0),T=v;break}case"point":T=new Qv(x,u.l.Zero(),this._loader.babylonScene);break;case"spot":{const v=new Kv(x,u.l.Zero(),u.l.Backward(),0,1,this._loader.babylonScene);v.angle=2*(A.spot&&A.spot.outerConeAngle||Math.PI/4),v.innerAngle=2*(A.spot&&A.spot.innerConeAngle||0),T=v;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${O}: Invalid light type (${A.type})`)}T._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,A._babylonLight=T,T.falloffType=bv.d.FALLOFF_GLTF,T.Vh=A.color?B.d.Ld(A.color):B.d.White(),T.mj=void 0==A.mj?1:A.mj,T.range=void 0==A.range?Number.MAX_VALUE:A.range,T.parent=v,this._loader._babylonLights.push(T),R.AddPointerMetadata(T,O),X(v)})))))}}S(pv),h(pv,!0,(v=>new Gv(v)));const Lv="KHR_materials_pbrSpecularGlossiness";class rv{constructor(v){this.name=Lv,this.order=200,this._loader=v,this.enabled=this._loader.isExtensionUsed(Lv)}dispose(){this._loader=null}loadMaterialPropertiesAsync(v,T,X){return R.LoadExtensionAsync(v,T,this.name,((O,u)=>{const B=new Array;return B.push(this._loader.loadMaterialBasePropertiesAsync(v,T,X)),B.push(this._loadSpecularGlossinessPropertiesAsync(O,u,X)),this._loader.loadMaterialAlphaProperties(v,T,X),Promise.all(B).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(v,T,X){if(!(X instanceof r))throw new Error(`${v}: Material type not supported`);const O=new Array;return X.metallic=null,X.roughness=null,T.diffuseFactor?(X.albedoColor=B.d.Ld(T.diffuseFactor),X.alpha=T.diffuseFactor[3]):X.albedoColor=B.d.White(),X.reflectivityColor=T.specularFactor?B.d.Ld(T.specularFactor):B.d.White(),X.microSurface=void 0==T.glossinessFactor?1:T.glossinessFactor,T.diffuseTexture&&O.push(this._loader.loadTextureInfoAsync(`${v}/diffuseTexture`,T.diffuseTexture,(v=>{v.name=`${X.name} (Diffuse)`,X.albedoTexture=v}))),T.specularGlossinessTexture&&(O.push(this._loader.loadTextureInfoAsync(`${v}/specularGlossinessTexture`,T.specularGlossinessTexture,(v=>{v.name=`${X.name} (Specular Glossiness)`,X.reflectivityTexture=v,X.reflectivityTexture.yd=!0}))),X.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(O).then((()=>{}))}}S(Lv),h(Lv,!0,(v=>new rv(v)));const ov="KHR_materials_unlit";class Zv{constructor(v){this.name=ov,this.order=210,this._loader=v,this.enabled=this._loader.isExtensionUsed(ov)}dispose(){this._loader=null}loadMaterialPropertiesAsync(v,T,X){return R.LoadExtensionAsync(v,T,this.name,(()=>this._loadUnlitPropertiesAsync(v,T,X)))}_loadUnlitPropertiesAsync(v,T,X){if(!(X instanceof r))throw new Error(`${v}: Material type not supported`);const O=new Array;X.unlit=!0;const u=T.pbrMetallicRoughness;return u&&(u.baseColorFactor?(X.albedoColor=B.d.Ld(u.baseColorFactor),X.alpha=u.baseColorFactor[3]):X.albedoColor=B.d.White(),u.baseColorTexture&&O.push(this._loader.loadTextureInfoAsync(`${v}/baseColorTexture`,u.baseColorTexture,(v=>{v.name=`${X.name} (Base Color)`,X.albedoTexture=v})))),T.doubleSided&&(X.Xe=!1,X.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(v,T,X),Promise.all(O).then((()=>{}))}}S(ov),h(ov,!0,(v=>new Zv(v)));const Uv="KHR_materials_clearcoat";class Jv{constructor(v){this.name=Uv,this.order=190,this._loader=v,this.enabled=this._loader.isExtensionUsed(Uv)}dispose(){this._loader=null}loadMaterialPropertiesAsync(v,T,X){return R.LoadExtensionAsync(v,T,this.name,((O,u)=>{const B=new Array;return B.push(this._loader.loadMaterialPropertiesAsync(v,T,X)),B.push(this._loadClearCoatPropertiesAsync(O,u,X)),Promise.all(B).then((()=>{}))}))}_loadClearCoatPropertiesAsync(v,T,X){if(!(X instanceof r))throw new Error(`${v}: Material type not supported`);const O=new Array;return X.clearCoat.isEnabled=!0,X.clearCoat.useRoughnessFromMainTexture=!1,X.clearCoat.remapF0OnInterfaceChange=!1,void 0!=T.clearcoatFactor?X.clearCoat.mj=T.clearcoatFactor:X.clearCoat.mj=0,T.clearcoatTexture&&O.push(this._loader.loadTextureInfoAsync(`${v}/clearcoatTexture`,T.clearcoatTexture,(v=>{v.name=`${X.name} (ClearCoat)`,X.clearCoat.texture=v}))),void 0!=T.clearcoatRoughnessFactor?X.clearCoat.roughness=T.clearcoatRoughnessFactor:X.clearCoat.roughness=0,T.clearcoatRoughnessTexture&&(T.clearcoatRoughnessTexture.nonColorData=!0,O.push(this._loader.loadTextureInfoAsync(`${v}/clearcoatRoughnessTexture`,T.clearcoatRoughnessTexture,(v=>{v.name=`${X.name} (ClearCoat Roughness)`,X.clearCoat.textureRoughness=v})))),T.clearcoatNormalTexture&&(T.clearcoatNormalTexture.nonColorData=!0,O.push(this._loader.loadTextureInfoAsync(`${v}/clearcoatNormalTexture`,T.clearcoatNormalTexture,(v=>{v.name=`${X.name} (ClearCoat Normal)`,X.clearCoat.bumpTexture=v}))),X.invertNormalMapX=!X.va().useRightHandedSystem,X.invertNormalMapY=X.va().useRightHandedSystem,void 0!=T.clearcoatNormalTexture.scale&&(X.clearCoat.bumpTexture.level=T.clearcoatNormalTexture.scale)),Promise.all(O).then((()=>{}))}}S(Uv),h(Uv,!0,(v=>new Jv(v)));const yv="KHR_materials_iridescence";class Pv{constructor(v){this.name=yv,this.order=195,this._loader=v,this.enabled=this._loader.isExtensionUsed(yv)}dispose(){this._loader=null}loadMaterialPropertiesAsync(v,T,X){return R.LoadExtensionAsync(v,T,this.name,((O,u)=>{const B=new Array;return B.push(this._loader.loadMaterialPropertiesAsync(v,T,X)),B.push(this._loadIridescencePropertiesAsync(O,u,X)),Promise.all(B).then((()=>{}))}))}_loadIridescencePropertiesAsync(v,T,X){if(!(X instanceof r))throw new Error(`${v}: Material type not supported`);const O=new Array;return X.iridescence.isEnabled=!0,X.iridescence.mj=T.iridescenceFactor??0,X.iridescence.indexOfRefraction=T.iridescenceIor??T.iridescenceIOR??1.3,X.iridescence.minimumThickness=T.iridescenceThicknessMinimum??100,X.iridescence.maximumThickness=T.iridescenceThicknessMaximum??400,T.iridescenceTexture&&O.push(this._loader.loadTextureInfoAsync(`${v}/iridescenceTexture`,T.iridescenceTexture,(v=>{v.name=`${X.name} (Iridescence)`,X.iridescence.texture=v}))),T.iridescenceThicknessTexture&&O.push(this._loader.loadTextureInfoAsync(`${v}/iridescenceThicknessTexture`,T.iridescenceThicknessTexture,(v=>{v.name=`${X.name} (Iridescence Thickness)`,X.iridescence.thicknessTexture=v}))),Promise.all(O).then((()=>{}))}}S(yv),h(yv,!0,(v=>new Pv(v)));const av="KHR_materials_anisotropy";class Ev{constructor(v){this.name=av,this.order=195,this._loader=v,this.enabled=this._loader.isExtensionUsed(av)}dispose(){this._loader=null}loadMaterialPropertiesAsync(v,T,X){return R.LoadExtensionAsync(v,T,this.name,((O,u)=>{const B=new Array;return B.push(this._loader.loadMaterialPropertiesAsync(v,T,X)),B.push(this._loadIridescencePropertiesAsync(O,u,X)),Promise.all(B).then((()=>{}))}))}_loadIridescencePropertiesAsync(v,T,X){if(!(X instanceof r))throw new Error(`${v}: Material type not supported`);const O=new Array;return X.anisotropy.isEnabled=!0,X.anisotropy.mj=T.anisotropyStrength??0,X.anisotropy.angle=T.anisotropyRotation??0,T.anisotropyTexture&&(T.anisotropyTexture.nonColorData=!0,O.push(this._loader.loadTextureInfoAsync(`${v}/anisotropyTexture`,T.anisotropyTexture,(v=>{v.name=`${X.name} (Anisotropy Intensity)`,X.anisotropy.texture=v})))),Promise.all(O).then((()=>{}))}}S(av),h(av,!0,(v=>new Ev(v)));const iv="KHR_materials_emissive_strength";class tv{constructor(v){this.name=iv,this.order=170,this._loader=v,this.enabled=this._loader.isExtensionUsed(iv)}dispose(){this._loader=null}loadMaterialPropertiesAsync(v,T,X){return R.LoadExtensionAsync(v,T,this.name,((O,u)=>this._loader.loadMaterialPropertiesAsync(v,T,X).then((()=>{this._loadEmissiveProperties(O,u,X)}))))}_loadEmissiveProperties(v,T,X){if(!(X instanceof r))throw new Error(`${v}: Material type not supported`);void 0!==T.emissiveStrength&&(X.emissiveIntensity=T.emissiveStrength)}}S(iv),h(iv,!0,(v=>new tv(v)));const Cv="KHR_materials_sheen";class cv{constructor(v){this.name=Cv,this.order=190,this._loader=v,this.enabled=this._loader.isExtensionUsed(Cv)}dispose(){this._loader=null}loadMaterialPropertiesAsync(v,T,X){return R.LoadExtensionAsync(v,T,this.name,((O,u)=>{const B=new Array;return B.push(this._loader.loadMaterialPropertiesAsync(v,T,X)),B.push(this._loadSheenPropertiesAsync(O,u,X)),Promise.all(B).then((()=>{}))}))}_loadSheenPropertiesAsync(v,T,X){if(!(X instanceof r))throw new Error(`${v}: Material type not supported`);const O=new Array;return X.sheen.isEnabled=!0,X.sheen.mj=1,void 0!=T.sheenColorFactor?X.sheen.color=B.d.Ld(T.sheenColorFactor):X.sheen.color=B.d.Black(),T.sheenColorTexture&&O.push(this._loader.loadTextureInfoAsync(`${v}/sheenColorTexture`,T.sheenColorTexture,(v=>{v.name=`${X.name} (Sheen Color)`,X.sheen.texture=v}))),void 0!==T.sheenRoughnessFactor?X.sheen.roughness=T.sheenRoughnessFactor:X.sheen.roughness=0,T.sheenRoughnessTexture&&(T.sheenRoughnessTexture.nonColorData=!0,O.push(this._loader.loadTextureInfoAsync(`${v}/sheenRoughnessTexture`,T.sheenRoughnessTexture,(v=>{v.name=`${X.name} (Sheen Roughness)`,X.sheen.textureRoughness=v})))),X.sheen.albedoScaling=!0,X.sheen.useRoughnessFromMainTexture=!1,Promise.all(O).then((()=>{}))}}S(Cv),h(Cv,!0,(v=>new cv(v)));const Nv="KHR_materials_specular";class dv{constructor(v){this.name=Nv,this.order=190,this._loader=v,this.enabled=this._loader.isExtensionUsed(Nv)}dispose(){this._loader=null}loadMaterialPropertiesAsync(v,T,X){return R.LoadExtensionAsync(v,T,this.name,((O,u)=>{const B=new Array;return B.push(this._loader.loadMaterialPropertiesAsync(v,T,X)),B.push(this._loadSpecularPropertiesAsync(O,u,X)),Promise.all(B).then((()=>{}))}))}_loadSpecularPropertiesAsync(v,T,X){if(!(X instanceof r))throw new Error(`${v}: Material type not supported`);const O=new Array;return void 0!==T.specularFactor&&(X.metallicF0Factor=T.specularFactor),void 0!==T.specularColorFactor&&(X.metallicReflectanceColor=B.d.Ld(T.specularColorFactor)),T.specularTexture&&(T.specularTexture.nonColorData=!0,O.push(this._loader.loadTextureInfoAsync(`${v}/specularTexture`,T.specularTexture,(v=>{v.name=`${X.name} (Specular)`,X.metallicReflectanceTexture=v,X.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),T.specularColorTexture&&O.push(this._loader.loadTextureInfoAsync(`${v}/specularColorTexture`,T.specularColorTexture,(v=>{v.name=`${X.name} (Specular Color)`,X.reflectanceTexture=v}))),Promise.all(O).then((()=>{}))}}S(Nv),h(Nv,!0,(v=>new dv(v)));const Iv="KHR_materials_ior";class Wv{constructor(v){this.name=Iv,this.order=180,this._loader=v,this.enabled=this._loader.isExtensionUsed(Iv)}dispose(){this._loader=null}loadMaterialPropertiesAsync(v,T,X){return R.LoadExtensionAsync(v,T,this.name,((O,u)=>{const B=new Array;return B.push(this._loader.loadMaterialPropertiesAsync(v,T,X)),B.push(this._loadIorPropertiesAsync(O,u,X)),Promise.all(B).then((()=>{}))}))}_loadIorPropertiesAsync(v,T,X){if(!(X instanceof r))throw new Error(`${v}: Material type not supported`);return void 0!==T.ior?X.indexOfRefraction=T.ior:X.indexOfRefraction=Wv._DEFAULT_IOR,Promise.resolve()}}Wv._DEFAULT_IOR=1.5,S(Iv),h(Iv,!0,(v=>new Wv(v)));const gv="KHR_materials_variants";class jv{constructor(v){this.name=gv,this._loader=v,this.enabled=this._loader.isExtensionUsed(gv)}dispose(){this._loader=null}static GetAvailableVariants(v){const T=this._GetExtensionMetadata(v);return T?Object.keys(T.variants):[]}getAvailableVariants(v){return jv.GetAvailableVariants(v)}static SelectVariant(v,T){const X=this._GetExtensionMetadata(v);if(!X)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${gv} extension`);const O=v=>{const T=X.variants[v];if(T)for(const X of T)X.mesh.material=X.material};if(T instanceof Array)for(const u of T)O(u);else O(T);X.lastSelected=T}selectVariant(v,T){jv.SelectVariant(v,T)}static Reset(v){const T=this._GetExtensionMetadata(v);if(!T)throw new Error(`Cannot reset on a glTF mesh that does not have the ${gv} extension`);for(const X of T.original)X.mesh.material=X.material;T.lastSelected=null}reset(v){jv.Reset(v)}static GetLastSelectedVariant(v){const T=this._GetExtensionMetadata(v);if(!T)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${gv} extension`);return T.lastSelected}getLastSelectedVariant(v){return jv.GetLastSelectedVariant(v)}static _GetExtensionMetadata(v){var T,X;return(null===v||void 0===v||null===(T=v._internalMetadata)||void 0===T||null===(X=T.cj)||void 0===X?void 0:X[gv])||null}onLoading(){const v=this._loader.cj.extensions;if(v&&v[this.name]){const T=v[this.name];this._variants=T.variants}}_loadMeshPrimitiveAsync(v,T,X,O,u,B){return R.LoadExtensionAsync(v,u,this.name,((m,A)=>{const x=new Array;return x.push(this._loader._loadMeshPrimitiveAsync(v,T,X,O,u,(T=>{if(B(T),T instanceof P.d){const X=R._GetDrawMode(v,u.mode),O=this._loader.rootBabylonMesh,B=O?O._internalMetadata=O._internalMetadata||{}:{},f=B.cj=B.cj||{},M=f[gv]=f[gv]||{lastSelected:null,original:[],variants:{}};M.original.push({mesh:T,material:T.material});for(let v=0;v<A.mappings.length;++v){const u=A.mappings[v],B=z.Get(`${m}/mappings/${v}/material`,this._loader.cj.materials,u.material);x.push(this._loader._loadMaterialAsync(`#/materials/${u.material}`,B,T,X,(v=>{for(let X=0;X<u.variants.length;++X){const B=u.variants[X],m=z.Get(`/extensions/${gv}/variants/${B}`,this._variants,B);M.variants[m.name]=M.variants[m.name]||[],M.variants[m.name].push({mesh:T,material:v}),T.onClonedObservable.add((v=>{const X=v;let u=null,B=X;do{if(B=B.parent,!B)return;u=jv._GetExtensionMetadata(B)}while(null===u);if(O&&u===jv._GetExtensionMetadata(O)){B._internalMetadata={};for(const v in O._internalMetadata)B._internalMetadata[v]=O._internalMetadata[v];B._internalMetadata.cj=[];for(const v in O._internalMetadata.cj)B._internalMetadata.cj[v]=O._internalMetadata.cj[v];B._internalMetadata.cj[gv]={lastSelected:null,original:[],variants:{}};for(const v of u.original)B._internalMetadata.cj[gv].original.push({mesh:v.mesh,material:v.material});for(const v in u.variants)if(Object.prototype.hasOwnProperty.call(u.variants,v)){B._internalMetadata.cj[gv].variants[v]=[];for(const T of u.variants[v])B._internalMetadata.cj[gv].variants[v].push({mesh:T.mesh,material:T.material})}u=B._internalMetadata.cj[gv]}for(const O of u.original)O.mesh===T&&(O.mesh=X);for(const O of u.variants[m.name])O.mesh===T&&(O.mesh=X)}))}})))}}}))),Promise.all(x).then((v=>{let[T]=v;return T}))}))}}S(gv),h(gv,!0,(v=>new jv(v)));var ev=X(1530);class hv{}hv.AUTOSAMPLERSUFFIX="Sampler",hv.DISABLEUA="#define DISABLE_UNIFORMITY_ANALYSIS",hv.ALPHA_DISABLE=0,hv.ALPHA_ADD=1,hv.ALPHA_COMBINE=2,hv.ALPHA_SUBTRACT=3,hv.ALPHA_MULTIPLY=4,hv.ALPHA_MAXIMIZED=5,hv.ALPHA_ONEONE=6,hv.ALPHA_PREMULTIPLIED=7,hv.ALPHA_PREMULTIPLIED_PORTERDUFF=8,hv.ALPHA_INTERPOLATE=9,hv.ALPHA_SCREENMODE=10,hv.ALPHA_ONEONE_ONEONE=11,hv.ALPHA_ALPHATOCOLOR=12,hv.ALPHA_REVERSEONEMINUS=13,hv.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,hv.ALPHA_ONEONE_ONEZERO=15,hv.ALPHA_EXCLUSION=16,hv.ALPHA_LAYER_ACCUMULATE=17,hv.ALPHA_EQUATION_ADD=0,hv.ALPHA_EQUATION_SUBSTRACT=1,hv.ALPHA_EQUATION_REVERSE_SUBTRACT=2,hv.ALPHA_EQUATION_MAX=3,hv.ALPHA_EQUATION_MIN=4,hv.ALPHA_EQUATION_DARKEN=5,hv.DELAYLOADSTATE_NONE=0,hv.DELAYLOADSTATE_LOADED=1,hv.DELAYLOADSTATE_LOADING=2,hv.DELAYLOADSTATE_NOTLOADED=4,hv.NEVER=512,hv.ALWAYS=519,hv.LESS=513,hv.EQUAL=514,hv.LEQUAL=515,hv.GREATER=516,hv.GEQUAL=518,hv.NOTEQUAL=517,hv.KEEP=7680,hv.ZERO=0,hv.REPLACE=7681,hv.INCR=7682,hv.DECR=7683,hv.INVERT=5386,hv.INCR_WRAP=34055,hv.DECR_WRAP=34056,hv.TEXTURE_CLAMP_ADDRESSMODE=0,hv.TEXTURE_WRAP_ADDRESSMODE=1,hv.TEXTURE_MIRROR_ADDRESSMODE=2,hv.TEXTURE_CREATIONFLAG_STORAGE=1,hv.TEXTUREFORMAT_ALPHA=0,hv.TEXTUREFORMAT_LUMINANCE=1,hv.TEXTUREFORMAT_LUMINANCE_ALPHA=2,hv.TEXTUREFORMAT_RGB=4,hv.TEXTUREFORMAT_RGBA=5,hv.TEXTUREFORMAT_RED=6,hv.TEXTUREFORMAT_R=6,hv.TEXTUREFORMAT_RG=7,hv.TEXTUREFORMAT_RED_INTEGER=8,hv.TEXTUREFORMAT_R_INTEGER=8,hv.TEXTUREFORMAT_RG_INTEGER=9,hv.TEXTUREFORMAT_RGB_INTEGER=10,hv.TEXTUREFORMAT_RGBA_INTEGER=11,hv.TEXTUREFORMAT_BGRA=12,hv.TEXTUREFORMAT_DEPTH24_STENCIL8=13,hv.TEXTUREFORMAT_DEPTH32_FLOAT=14,hv.TEXTUREFORMAT_DEPTH16=15,hv.TEXTUREFORMAT_DEPTH24=16,hv.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17,hv.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18,hv.TEXTUREFORMAT_STENCIL8=19,hv.TEXTUREFORMAT_UNDEFINED=4294967295,hv.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492,hv.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493,hv.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495,hv.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494,hv.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779,hv.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919,hv.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778,hv.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918,hv.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777,hv.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776,hv.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917,hv.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916,hv.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808,hv.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840,hv.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196,hv.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492,hv.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493,hv.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494,hv.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495,hv.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496,hv.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497,hv.TEXTURETYPE_UNSIGNED_BYTE=0,hv.TEXTURETYPE_UNSIGNED_INT=0,hv.TEXTURETYPE_FLOAT=1,hv.TEXTURETYPE_HALF_FLOAT=2,hv.TEXTURETYPE_BYTE=3,hv.TEXTURETYPE_SHORT=4,hv.TEXTURETYPE_UNSIGNED_SHORT=5,hv.TEXTURETYPE_INT=6,hv.TEXTURETYPE_UNSIGNED_INTEGER=7,hv.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,hv.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,hv.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,hv.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,hv.TEXTURETYPE_UNSIGNED_INT_24_8=12,hv.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,hv.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,hv.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,hv.TEXTURETYPE_UNDEFINED=16,hv.TEXTURE_2D=3553,hv.TEXTURE_2D_ARRAY=35866,hv.TEXTURE_CUBE_MAP=34067,hv.TEXTURE_CUBE_MAP_ARRAY=3735928559,hv.TEXTURE_3D=32879,hv.TEXTURE_NEAREST_SAMPLINGMODE=1,hv.TEXTURE_NEAREST_NEAREST=1,hv.TEXTURE_BILINEAR_SAMPLINGMODE=2,hv.TEXTURE_LINEAR_LINEAR=2,hv.TEXTURE_TRILINEAR_SAMPLINGMODE=3,hv.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,hv.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,hv.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,hv.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,hv.TEXTURE_NEAREST_LINEAR=7,hv.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,hv.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,hv.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,hv.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,hv.TEXTURE_LINEAR_NEAREST=12,hv.TEXTURE_EXPLICIT_MODE=0,hv.TEXTURE_SPHERICAL_MODE=1,hv.TEXTURE_PLANAR_MODE=2,hv.TEXTURE_CUBIC_MODE=3,hv.TEXTURE_PROJECTION_MODE=4,hv.TEXTURE_SKYBOX_MODE=5,hv.TEXTURE_INVCUBIC_MODE=6,hv.TEXTURE_EQUIRECTANGULAR_MODE=7,hv.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,hv.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,hv.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,hv.TEXTURE_FILTERING_QUALITY_HIGH=64,hv.TEXTURE_FILTERING_QUALITY_MEDIUM=16,hv.TEXTURE_FILTERING_QUALITY_LOW=8,hv.SCALEMODE_FLOOR=1,hv.SCALEMODE_NEAREST=2,hv.SCALEMODE_CEILING=3,hv.MATERIAL_TextureDirtyFlag=1,hv.MATERIAL_LightDirtyFlag=2,hv.MATERIAL_FresnelDirtyFlag=4,hv.MATERIAL_AttributesDirtyFlag=8,hv.MATERIAL_MiscDirtyFlag=16,hv.MATERIAL_PrePassDirtyFlag=32,hv.MATERIAL_AllDirtyFlag=63,hv.MATERIAL_TriangleFillMode=0,hv.MATERIAL_WireFrameFillMode=1,hv.MATERIAL_PointFillMode=2,hv.MATERIAL_PointListDrawMode=3,hv.MATERIAL_LineListDrawMode=4,hv.MATERIAL_LineLoopDrawMode=5,hv.MATERIAL_LineStripDrawMode=6,hv.MATERIAL_TriangleStripDrawMode=7,hv.MATERIAL_TriangleFanDrawMode=8,hv.MATERIAL_ClockWiseSideOrientation=0,hv.MATERIAL_CounterClockWiseSideOrientation=1,hv.ACTION_NothingTrigger=0,hv.ACTION_OnPickTrigger=1,hv.ACTION_OnLeftPickTrigger=2,hv.ACTION_OnRightPickTrigger=3,hv.ACTION_OnCenterPickTrigger=4,hv.ACTION_OnPickDownTrigger=5,hv.ACTION_OnDoublePickTrigger=6,hv.ACTION_OnPickUpTrigger=7,hv.ACTION_OnPickOutTrigger=16,hv.ACTION_OnLongPressTrigger=8,hv.ACTION_OnPointerOverTrigger=9,hv.ACTION_OnPointerOutTrigger=10,hv.ACTION_OnEveryFrameTrigger=11,hv.ACTION_OnIntersectionEnterTrigger=12,hv.ACTION_OnIntersectionExitTrigger=13,hv.ACTION_OnKeyDownTrigger=14,hv.ACTION_OnKeyUpTrigger=15,hv.PARTICLES_BILLBOARDMODE_Y=2,hv.PARTICLES_BILLBOARDMODE_ALL=7,hv.PARTICLES_BILLBOARDMODE_STRETCHED=8,hv.PARTICLES_BILLBOARDMODE_STRETCHED_LOCAL=9,hv.MESHES_CULLINGSTRATEGY_STANDARD=0,hv.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,hv.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,hv.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,hv.SCENELOADER_NO_LOGGING=0,hv.SCENELOADER_MINIMAL_LOGGING=1,hv.SCENELOADER_SUMMARY_LOGGING=2,hv.SCENELOADER_DETAILED_LOGGING=3,hv.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,hv.PREPASS_POSITION_TEXTURE_TYPE=1,hv.PREPASS_VELOCITY_TEXTURE_TYPE=2,hv.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,hv.PREPASS_COLOR_TEXTURE_TYPE=4,hv.PREPASS_DEPTH_TEXTURE_TYPE=5,hv.PREPASS_NORMAL_TEXTURE_TYPE=6,hv.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7,hv.PREPASS_WORLD_NORMAL_TEXTURE_TYPE=8,hv.PREPASS_LOCAL_POSITION_TEXTURE_TYPE=9,hv.PREPASS_SCREENSPACE_DEPTH_TEXTURE_TYPE=10,hv.PREPASS_VELOCITY_LINEAR_TEXTURE_TYPE=11,hv.PREPASS_ALBEDO_TEXTURE_TYPE=12,hv.BUFFER_CREATIONFLAG_READ=1,hv.BUFFER_CREATIONFLAG_WRITE=2,hv.BUFFER_CREATIONFLAG_READWRITE=3,hv.BUFFER_CREATIONFLAG_UNIFORM=4,hv.BUFFER_CREATIONFLAG_VERTEX=8,hv.BUFFER_CREATIONFLAG_INDEX=16,hv.BUFFER_CREATIONFLAG_STORAGE=32,hv.BUFFER_CREATIONFLAG_INDIRECT=64,hv.RENDERPASS_MAIN=0,hv.INPUT_ALT_KEY=18,hv.INPUT_CTRL_KEY=17,hv.INPUT_META_KEY1=91,hv.INPUT_META_KEY2=92,hv.INPUT_META_KEY3=93,hv.INPUT_SHIFT_KEY=16,hv.SNAPSHOTRENDERING_STANDARD=0,hv.SNAPSHOTRENDERING_FAST=1,hv.PERSPECTIVE_CAMERA=0,hv.ORTHOGRAPHIC_CAMERA=1,hv.FOVMODE_VERTICAL_FIXED=0,hv.FOVMODE_HORIZONTAL_FIXED=1,hv.RIG_MODE_NONE=0,hv.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,hv.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,hv.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,hv.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,hv.RIG_MODE_STEREOSCOPIC_INTERLACED=14,hv.RIG_MODE_VR=20,hv.RIG_MODE_CUSTOM=22,hv.MAX_SUPPORTED_UV_SETS=6,hv.GL_ALPHA_EQUATION_ADD=32774,hv.GL_ALPHA_EQUATION_MIN=32775,hv.GL_ALPHA_EQUATION_MAX=32776,hv.GL_ALPHA_EQUATION_SUBTRACT=32778,hv.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779,hv.GL_ALPHA_FUNCTION_SRC=768,hv.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769,hv.GL_ALPHA_FUNCTION_SRC_ALPHA=770,hv.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771,hv.GL_ALPHA_FUNCTION_DST_ALPHA=772,hv.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773,hv.GL_ALPHA_FUNCTION_DST_COLOR=774,hv.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775,hv.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776,hv.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769,hv.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770,hv.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771,hv.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772,hv.GL_ALPHA_FUNCTION_SRC1_COLOR=35065,hv.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_COLOR=35066,hv.GL_ALPHA_FUNCTION_SRC1_ALPHA=34185,hv.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_ALPHA=35067,hv.SnippetUrl="https://snippet.babylonjs.com",hv.FOGMODE_NONE=0,hv.FOGMODE_EXP=1,hv.FOGMODE_EXP2=2,hv.FOGMODE_LINEAR=3,hv.BYTE=5120,hv.UNSIGNED_BYTE=5121,hv.SHORT=5122,hv.UNSIGNED_SHORT=5123,hv.INT=5124,hv.UNSIGNED_INT=5125,hv.FLOAT=5126,hv.PositionKind="position",hv.NormalKind="Wd",hv.TangentKind="tangent",hv.UVKind="uv",hv.UV2Kind="uv2",hv.UV3Kind="uv3",hv.UV4Kind="uv4",hv.UV5Kind="uv5",hv.UV6Kind="uv6",hv.ColorKind="color",hv.ColorInstanceKind="instanceColor",hv.MatricesIndicesKind="matricesIndices",hv.MatricesWeightsKind="matricesWeights",hv.MatricesIndicesExtraKind="matricesIndicesExtra",hv.MatricesWeightsExtraKind="matricesWeightsExtra";class Sv{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:hv.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(v,T){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...Sv._GetDefaultOptions(),...v},this._scene=T,this._scene._transmissionHelper=this,this.onErrorObservable=new M.b,this._scene.ae.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(v){if(!Object.keys(v).filter((T=>this._options[T]!==v[T])).length)return;const T={...this._options,...v},X=this._options;this._options=T,T.renderSize===X.renderSize&&T.renderTargetTextureType===X.renderTargetTextureType&&T.generateMipmaps===X.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=T.samples,this._opaqueRenderTarget.lodGenerationScale=T.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=T.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(v){return!!v&&!!(v instanceof r&&v.subSurface.isRefractionEnabled)}_addMesh(v){this._materialObservers[v.uniqueId]=v.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),m.c.SetImmediate((()=>{this._shouldRenderAsTransmission(v.material)?(v.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(v)&&this._transparentMeshesCache.push(v)):-1===this._opaqueMeshesCache.indexOf(v)&&this._opaqueMeshesCache.push(v)}))}_removeMesh(v){v.onMaterialChangedObservable.remove(this._materialObservers[v.uniqueId]),delete this._materialObservers[v.uniqueId];let T=this._transparentMeshesCache.indexOf(v);-1!==T&&this._transparentMeshesCache.splice(T,1),T=this._opaqueMeshesCache.indexOf(v),-1!==T&&this._opaqueMeshesCache.splice(T,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(v){const T=this._transparentMeshesCache.indexOf(v),X=this._opaqueMeshesCache.indexOf(v);this._shouldRenderAsTransmission(v.material)?(v.material instanceof r&&(v.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==X?(this._opaqueMeshesCache.splice(X,1),this._transparentMeshesCache.push(v)):-1===T&&this._transparentMeshesCache.push(v)):-1!==T?(this._transparentMeshesCache.splice(T,1),this._opaqueMeshesCache.push(v)):-1===X&&this._opaqueMeshesCache.push(v)}_isRenderTargetValid(){var v;return null!==(null===(v=this._opaqueRenderTarget)||void 0===v?void 0:v.getInternalTexture())}_setupRenderTargets(){var v;let T,X;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new ev.c("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(v=this._options.clearColor)||void 0===v?void 0:v.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((v=>{X=this._scene.environmentIntensity,this._scene.environmentIntensity=1,T=this._scene.imageProcessingConfiguration.applyByPostProcess,this._options.clearColor?v.clearColor.p(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(v.clearColor,this._scene.getEngine().useExactSrgbConversions),this._scene.imageProcessingConfiguration._applyByPostProcess=!0})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=X,this._scene.imageProcessingConfiguration._applyByPostProcess=T})),this._transparentMeshesCache.forEach((v=>{this._shouldRenderAsTransmission(v.material)&&(v.material.refractionTexture=this._opaqueRenderTarget)}))}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const wv="KHR_materials_transmission";class zv{constructor(v){this.name=wv,this.order=175,this._loader=v,this.enabled=this._loader.isExtensionUsed(wv),this.enabled&&(v.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(v,T,X){return R.LoadExtensionAsync(v,T,this.name,((O,u)=>{const B=new Array;return B.push(this._loader.loadMaterialPropertiesAsync(v,T,X)),B.push(this._loadTransparentPropertiesAsync(O,T,X,u)),Promise.all(B).then((()=>{}))}))}_loadTransparentPropertiesAsync(v,T,X,O){if(!(X instanceof r))throw new Error(`${v}: Material type not supported`);const u=X;if(u.subSurface.isRefractionEnabled=!0,u.subSurface.volumeIndexOfRefraction=1,u.subSurface.useAlbedoToTintRefraction=!0,void 0===O.transmissionFactor)return u.subSurface.refractionIntensity=0,u.subSurface.isRefractionEnabled=!1,Promise.resolve();{var B;u.subSurface.refractionIntensity=O.transmissionFactor;const v=u.va();if(u.subSurface.refractionIntensity&&!v._transmissionHelper)new Sv({},u.va());else if(u.subSurface.refractionIntensity&&(null===(B=v._transmissionHelper)||void 0===B||!B._isRenderTargetValid())){var m;null===(m=v._transmissionHelper)||void 0===m||m._setupRenderTargets()}}return u.subSurface.minimumThickness=0,u.subSurface.maximumThickness=0,O.transmissionTexture?(O.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${v}/transmissionTexture`,O.transmissionTexture,void 0).then((v=>{v.name=`${X.name} (Transmission)`,u.subSurface.refractionIntensityTexture=v,u.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}S(wv),h(wv,!0,(v=>new zv(v)));const Rv="KHR_materials_diffuse_transmission";class Yv{constructor(v){this.name=Rv,this.order=174,this._loader=v,this.enabled=this._loader.isExtensionUsed(Rv),this.enabled&&(v.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(v,T,X){return R.LoadExtensionAsync(v,T,this.name,((O,u)=>{const B=new Array;return B.push(this._loader.loadMaterialPropertiesAsync(v,T,X)),B.push(this._loadTranslucentPropertiesAsync(O,T,X,u)),Promise.all(B).then((()=>{}))}))}_loadTranslucentPropertiesAsync(v,T,X,O){if(!(X instanceof r))throw new Error(`${v}: Material type not supported`);const u=X;if(u.subSurface.isTranslucencyEnabled=!0,u.subSurface.volumeIndexOfRefraction=1,u.subSurface.minimumThickness=0,u.subSurface.maximumThickness=0,u.subSurface.useAlbedoToTintTranslucency=!1,void 0===O.diffuseTransmissionFactor)return u.subSurface.translucencyIntensity=0,u.subSurface.isTranslucencyEnabled=!1,Promise.resolve();u.subSurface.translucencyIntensity=O.diffuseTransmissionFactor;const m=new Array;return u.subSurface.useGltfStyleTextures=!0,O.diffuseTransmissionTexture&&(O.diffuseTransmissionTexture.nonColorData=!0,m.push(this._loader.loadTextureInfoAsync(`${v}/diffuseTransmissionTexture`,O.diffuseTransmissionTexture).then((v=>{v.name=`${X.name} (Diffuse Transmission)`,u.subSurface.translucencyIntensityTexture=v})))),void 0!==O.diffuseTransmissionColorFactor?u.subSurface.translucencyColor=B.d.Ld(O.diffuseTransmissionColorFactor):u.subSurface.translucencyColor=B.d.White(),O.diffuseTransmissionColorTexture&&m.push(this._loader.loadTextureInfoAsync(`${v}/diffuseTransmissionColorTexture`,O.diffuseTransmissionColorTexture).then((v=>{v.name=`${X.name} (Diffuse Transmission Color)`,u.subSurface.translucencyColorTexture=v}))),Promise.all(m).then((()=>{}))}}S(Rv),h(Rv,!0,(v=>new Yv(v)));const qv="KHR_materials_volume";class vT{constructor(v){this.name=qv,this.order=173,this._loader=v,this.enabled=this._loader.isExtensionUsed(qv),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(v,T,X){return R.LoadExtensionAsync(v,T,this.name,((O,u)=>{const B=new Array;return B.push(this._loader.loadMaterialPropertiesAsync(v,T,X)),B.push(this._loadVolumePropertiesAsync(O,T,X,u)),Promise.all(B).then((()=>{}))}))}_loadVolumePropertiesAsync(v,T,X,O){if(!(X instanceof r))throw new Error(`${v}: Material type not supported`);if(!X.subSurface.isRefractionEnabled&&!X.subSurface.isTranslucencyEnabled||!O.thicknessFactor)return Promise.resolve();X.subSurface.volumeIndexOfRefraction=X.indexOfRefraction;const u=void 0!==O.attenuationDistance?O.attenuationDistance:Number.MAX_VALUE;return X.subSurface.tintColorAtDistance=u,void 0!==O.attenuationColor&&3==O.attenuationColor.length&&X.subSurface.tintColor.Sd(O.attenuationColor[0],O.attenuationColor[1],O.attenuationColor[2]),X.subSurface.minimumThickness=0,X.subSurface.maximumThickness=O.thicknessFactor,X.subSurface.useThicknessAsDepth=!0,O.thicknessTexture?(O.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${v}/thicknessTexture`,O.thicknessTexture).then((v=>{v.name=`${X.name} (Thickness)`,X.subSurface.thicknessTexture=v,X.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}S(qv),h(qv,!0,(v=>new vT(v)));const TT="KHR_materials_dispersion";class XT{constructor(v){this.name=TT,this.order=174,this._loader=v,this.enabled=this._loader.isExtensionUsed(TT)}dispose(){this._loader=null}loadMaterialPropertiesAsync(v,T,X){return R.LoadExtensionAsync(v,T,this.name,((O,u)=>{const B=new Array;return B.push(this._loader.loadMaterialPropertiesAsync(v,T,X)),B.push(this._loadDispersionPropertiesAsync(O,T,X,u)),Promise.all(B).then((()=>{}))}))}_loadDispersionPropertiesAsync(v,T,X,O){if(!(X instanceof r))throw new Error(`${v}: Material type not supported`);return X.subSurface.isRefractionEnabled&&O.dispersion?(X.subSurface.isDispersionEnabled=!0,X.subSurface.dispersion=O.dispersion,Promise.resolve()):Promise.resolve()}}S(TT),h(TT,!0,(v=>new XT(v)));const OT="KHR_mesh_quantization";class uT{constructor(v){this.name=OT,this.enabled=v.isExtensionUsed(OT)}dispose(){}}S(OT),h(OT,!0,(v=>new uT(v)));const BT="KHR_texture_basisu";class mT{constructor(v){this.name=BT,this._loader=v,this.enabled=v.isExtensionUsed(BT)}dispose(){this._loader=null}_loadTextureAsync(v,T,X){return R.LoadExtensionAsync(v,T,this.name,((O,u)=>{const B=void 0==T.sampler?R.DefaultSampler:z.Get(`${v}/sampler`,this._loader.cj.samplers,T.sampler),m=z.Get(`${O}/source`,this._loader.cj.images,u.source);return this._loader._createTextureAsync(v,B,m,(v=>{X(v)}),T._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!T._textureInfo.nonColorData)}))}}S(BT),h(BT,!0,(v=>new mT(v)));const AT="KHR_texture_transform";class xT{constructor(v){this.name=AT,this._loader=v,this.enabled=this._loader.isExtensionUsed(AT)}dispose(){this._loader=null}loadTextureInfoAsync(v,T,X){return R.LoadExtensionAsync(v,T,this.name,((O,u)=>this._loader.loadTextureInfoAsync(v,T,(v=>{if(!(v instanceof o.e))throw new Error(`${O}: Texture type not supported`);u.offset&&(v.uOffset=u.offset[0],v.vOffset=u.offset[1]),v.uRotationCenter=0,v.vRotationCenter=0,u.rotation&&(v.wAng=-u.rotation),u.scale&&(v.uScale=u.scale[0],v.vScale=u.scale[1]),void 0!=u.texCoord&&(v.coordinatesIndex=u.texCoord),X(v)}))))}}S(AT),h(AT,!0,(v=>new xT(v)));const fT="KHR_xmp_json_ld";class MT{constructor(v){this.name=fT,this.order=100,this._loader=v,this.enabled=this._loader.isExtensionUsed(fT)}dispose(){this._loader=null}onLoading(){var v,T,X;if(null===this._loader.rootBabylonMesh)return;const O=null===(v=this._loader.cj.extensions)||void 0===v?void 0:v.KHR_xmp_json_ld,u=null===(T=this._loader.cj.asset)||void 0===T||null===(X=T.extensions)||void 0===X?void 0:X.KHR_xmp_json_ld;if(O&&u){const v=+u.packet;O.packets&&v<O.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=O.packets[v])}}}function HT(v,T,X,O){return B.d.Ld(T,X).scale(O)}function nT(v,T,X,O){return T[X]*O}function VT(v,T,X,O){return-T[X]*O}function DT(v,T,X,O){return T[X+1]*O}function sT(v,T,X,O){return T[X]*O*2}function FT(v){return{scale:[new bT(n.e.ANIMATIONTYPE_FLOAT,`${v}.uScale`,nT,(()=>2)),new bT(n.e.ANIMATIONTYPE_FLOAT,`${v}.vScale`,DT,(()=>2))],offset:[new bT(n.e.ANIMATIONTYPE_FLOAT,`${v}.uOffset`,nT,(()=>2)),new bT(n.e.ANIMATIONTYPE_FLOAT,`${v}.vOffset`,DT,(()=>2))],rotation:[new bT(n.e.ANIMATIONTYPE_FLOAT,`${v}.wAng`,VT,(()=>1))]}}S(fT),h(fT,!0,(v=>new MT(v)));class kT extends I{buildAnimations(v,T,X,O,u){u(v._babylonCamera,this._buildAnimation(T,X,O))}}class bT extends I{buildAnimations(v,T,X,O,u){for(const B in v._data)u(v._data[B].babylonMaterial,this._buildAnimation(T,X,O))}}class lT extends I{buildAnimations(v,T,X,O,u){u(v._babylonLight,this._buildAnimation(T,X,O))}}const QT={__array__:{__target__:!0,...g}},KT={__array__:{__target__:!0,orthographic:{xmag:[new kT(n.e.ANIMATIONTYPE_FLOAT,"orthoLeft",VT,(()=>1)),new kT(n.e.ANIMATIONTYPE_FLOAT,"orthoRight",DT,(()=>1))],ymag:[new kT(n.e.ANIMATIONTYPE_FLOAT,"orthoBottom",VT,(()=>1)),new kT(n.e.ANIMATIONTYPE_FLOAT,"orthoTop",DT,(()=>1))],zfar:[new kT(n.e.ANIMATIONTYPE_FLOAT,"maxZ",nT,(()=>1))],znear:[new kT(n.e.ANIMATIONTYPE_FLOAT,"ij",nT,(()=>1))]},perspective:{yfov:[new kT(n.e.ANIMATIONTYPE_FLOAT,"fov",nT,(()=>1))],zfar:[new kT(n.e.ANIMATIONTYPE_FLOAT,"maxZ",nT,(()=>1))],znear:[new kT(n.e.ANIMATIONTYPE_FLOAT,"ij",nT,(()=>1))]}}},pT={nodes:QT,materials:{__array__:{__target__:!0,pbrMetallicRoughness:{baseColorFactor:[new bT(n.e.ANIMATIONTYPE_COLOR3,"albedoColor",HT,(()=>4)),new bT(n.e.ANIMATIONTYPE_FLOAT,"alpha",(function(v,T,X,O){return T[X+3]*O}),(()=>4))],metallicFactor:[new bT(n.e.ANIMATIONTYPE_FLOAT,"metallic",nT,(()=>1))],roughnessFactor:[new bT(n.e.ANIMATIONTYPE_FLOAT,"roughness",nT,(()=>1))],baseColorTexture:{extensions:{KHR_texture_transform:FT("albedoTexture")}},metallicRoughnessTexture:{extensions:{KHR_texture_transform:FT("metallicTexture")}}},emissiveFactor:[new bT(n.e.ANIMATIONTYPE_COLOR3,"emissiveColor",HT,(()=>3))],normalTexture:{scale:[new bT(n.e.ANIMATIONTYPE_FLOAT,"bumpTexture.level",nT,(()=>1))],extensions:{KHR_texture_transform:FT("bumpTexture")}},occlusionTexture:{strength:[new bT(n.e.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",nT,(()=>1))],extensions:{KHR_texture_transform:FT("ambientTexture")}},emissiveTexture:{extensions:{KHR_texture_transform:FT("emissiveTexture")}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:[new bT(n.e.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",nT,(()=>1))],anisotropyRotation:[new bT(n.e.ANIMATIONTYPE_FLOAT,"anisotropy.angle",nT,(()=>1))],anisotropyTexture:{extensions:{KHR_texture_transform:FT("anisotropy.texture")}}},KHR_materials_clearcoat:{clearcoatFactor:[new bT(n.e.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",nT,(()=>1))],clearcoatRoughnessFactor:[new bT(n.e.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",nT,(()=>1))],clearcoatTexture:{extensions:{KHR_texture_transform:FT("clearCoat.texture")}},clearcoatNormalTexture:{scale:[new bT(n.e.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",nT,(()=>1))],extensions:{KHR_texture_transform:FT("clearCoat.bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:FT("clearCoat.textureRoughness")}}},KHR_materials_dispersion:{dispersion:[new bT(n.e.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",nT,(()=>1))]},KHR_materials_emissive_strength:{emissiveStrength:[new bT(n.e.ANIMATIONTYPE_FLOAT,"emissiveIntensity",nT,(()=>1))]},KHR_materials_ior:{ior:[new bT(n.e.ANIMATIONTYPE_FLOAT,"indexOfRefraction",nT,(()=>1))]},KHR_materials_iridescence:{iridescenceFactor:[new bT(n.e.ANIMATIONTYPE_FLOAT,"iridescence.intensity",nT,(()=>1))],iridescenceIor:[new bT(n.e.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",nT,(()=>1))],iridescenceThicknessMinimum:[new bT(n.e.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",nT,(()=>1))],iridescenceThicknessMaximum:[new bT(n.e.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",nT,(()=>1))],iridescenceTexture:{extensions:{KHR_texture_transform:FT("iridescence.texture")}},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:FT("iridescence.thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:[new bT(n.e.ANIMATIONTYPE_COLOR3,"sheen.color",HT,(()=>3))],sheenRoughnessFactor:[new bT(n.e.ANIMATIONTYPE_FLOAT,"sheen.roughness",nT,(()=>1))],sheenColorTexture:{extensions:{KHR_texture_transform:FT("sheen.texture")}},sheenRoughnessTexture:{extensions:{KHR_texture_transform:FT("sheen.textureRoughness")}}},KHR_materials_specular:{specularFactor:[new bT(n.e.ANIMATIONTYPE_FLOAT,"metallicF0Factor",nT,(()=>1))],specularColorFactor:[new bT(n.e.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",HT,(()=>3))],specularTexture:{extensions:{KHR_texture_transform:FT("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:FT("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:[new bT(n.e.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",nT,(()=>1))],transmissionTexture:{extensions:{KHR_texture_transform:FT("subSurface.refractionIntensityTexture")}}},KHR_materials_volume:{attenuationColor:[new bT(n.e.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",HT,(()=>3))],attenuationDistance:[new bT(n.e.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",nT,(()=>1))],thicknessFactor:[new bT(n.e.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",nT,(()=>1))],thicknessTexture:{extensions:{KHR_texture_transform:FT("subSurface.thicknessTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:[new bT(n.e.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",nT,(()=>1))],diffuseTransmissionTexture:{extensions:{KHR_texture_transform:FT("subSurface.translucencyIntensityTexture")}},diffuseTransmissionColorFactor:[new bT(n.e.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",HT,(()=>3))],diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:FT("subSurface.translucencyColorTexture")}}}}}},cameras:KT,extensions:{KHR_lights_punctual:{lights:{__array__:{__target__:!0,color:[new lT(n.e.ANIMATIONTYPE_COLOR3,"diffuse",HT,(()=>3))],mj:[new lT(n.e.ANIMATIONTYPE_FLOAT,"intensity",nT,(()=>1))],range:[new lT(n.e.ANIMATIONTYPE_FLOAT,"range",nT,(()=>1))],spot:{innerConeAngle:[new lT(n.e.ANIMATIONTYPE_FLOAT,"innerAngle",sT,(()=>1))],outerConeAngle:[new lT(n.e.ANIMATIONTYPE_FLOAT,"angle",sT,(()=>1))]}}}}}};class GT{constructor(v,T){this._gltf=v,this._infoTree=T}convert(v){let T,X=this._gltf,O=this._infoTree;if(!v.startsWith("/"))throw new Error("Path must start with a /");const u=v.split("/");u.shift();for(const B of u){if(O.__array__)O=O.__array__;else if(O=O[B],!O)throw new Error(`Path ${v} is invalid`);if(void 0===X)throw new Error(`Path ${v} is invalid`);X=X[B],O.__target__&&(T=X)}return{object:T,info:O}}}const LT="KHR_animation_pointer";class rT extends GT{constructor(v){super(v,pT)}}class oT{constructor(v){this.name=LT,this._loader=v,this._pathToObjectConverter=new rT(this._loader.cj)}get enabled(){return this._loader.isExtensionUsed(LT)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(v,T,X,O,u){var B;const m=null===(B=O.target.extensions)||void 0===B?void 0:B.KHR_animation_pointer;if(!m||!this._pathToObjectConverter)return null;"pointer"!==O.target.path&&s.d.Warn(`${v}/target/path: Value (${O.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=O.target.node&&s.d.Warn(`${v}/target/node: Value (${O.target.node}) must not be present when using the ${this.name} extension`);const A=`${v}/extensions/${this.name}`,x=m.pointer;if(!x)throw new Error(`${A}: Pointer is missing`);try{const B=this._pathToObjectConverter.convert(x);return this._loader._loadAnimationChannelFromTargetInfoAsync(v,T,X,O,B,u)}catch(f){return s.d.Warn(`${A}/pointer: Invalid pointer (${x}) skipped`),null}}}S(LT),h(LT,!0,(v=>new oT(v)));class ZT{constructor(v,T,X){this.frame=v,this.action=T,this.onlyOnce=X,this.isDone=!1}_clone(){return new ZT(this.frame,this.action,this.onlyOnce)}}var UT=X(1095),JT=X(1111);class yT{get loop(){return this._loop}set loop(v){v!==this._loop&&(this._loop=v,this.updateOptions({loop:v}))}get currentTime(){var v;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(v=JT.e.audioEngine)&&void 0!==v&&v.audioContext&&(this.isPlaying||this.isPaused)){const v=this.isPaused?0:JT.e.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+v}return 0}get spatialSound(){return this._spatialSound}set spatialSound(v){if(v==this._spatialSound)return;const T=this.isPlaying;this.pause(),v?(this._spatialSound=v,this._updateSpatialParameters()):this._disableSpatialSound(),T&&this.play()}constructor(v,T,X){var O;let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,A=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new M.b,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=u.l.Zero(),this._localDirection=new u.l(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=v,X=X||D.c.LastCreatedScene)if(this._scene=X,yT._SceneComponentInitialization(X),this._readyToPlayCallback=B,this._customAttenuationFunction=(v,T,X,O,u)=>T<X?v*(1-T/X):0,A&&(this.autoplay=A.autoplay||!1,this._loop=A.loop||!1,void 0!==A.volume&&(this._volume=A.volume),this._spatialSound=A.spatialSound??!1,this.maxDistance=A.maxDistance??100,this.useCustomAttenuation=A.useCustomAttenuation??!1,this.rolloffFactor=A.rolloffFactor||1,this.refDistance=A.refDistance||1,this.distanceModel=A.distanceModel||"linear",this._playbackRate=A.playbackRate||1,this._streaming=A.streaming??!1,this._length=A.length,this._offset=A.offset),null!==(O=JT.e.audioEngine)&&void 0!==O&&O.canUseWebAudio&&JT.e.audioEngine.audioContext){this._soundGain=JT.e.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let v=!0;if(T)try{"string"===typeof T?(this._urlType="String",this._url=T):T instanceof ArrayBuffer?this._urlType="ArrayBuffer":T instanceof HTMLMediaElement?this._urlType="MediaElement":T instanceof MediaStream?this._urlType="MediaStream":T instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(T)&&(this._urlType="Array");let X=[],O=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=JT.e.audioEngine.audioContext.createMediaElementSource(T),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=JT.e.audioEngine.audioContext.createMediaStreamSource(T),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":T.byteLength>0&&(O=!0,this._soundLoaded(T));break;case"AudioBuffer":this._audioBufferLoaded(T);break;case"String":X.push(T);case"Array":0===X.length&&(X=T);for(let v=0;v<X.length;v++){const T=X[v];if(O=A&&A.skipCodecCheck||-1!==T.indexOf(".mp3",T.length-4)&&JT.e.audioEngine.isMP3supported||-1!==T.indexOf(".ogg",T.length-4)&&JT.e.audioEngine.isOGGsupported||-1!==T.indexOf(".wav",T.length-4)||-1!==T.indexOf(".m4a",T.length-4)||-1!==T.indexOf(".mp4",T.length-4)||-1!==T.indexOf("blob:"),O){this._streaming?(this._htmlAudioElement=new Audio(T),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,m.c.SetCorsBehavior(T,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(T,(v=>{this._soundLoaded(v)}),void 0,!0,!0,(v=>{v&&s.d.Error("XHR "+v.status+" error on: "+T+"."),s.d.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:v=!1}v?O||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):s.d.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(x){s.d.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),JT.e.audioEngine&&!JT.e.audioEngine.WarnedWebAudioUnsupported&&(s.d.Error("Web Audio is not supported by your browser."),JT.e.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var v;null!==(v=JT.e.audioEngine)&&void 0!==v&&v.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(v){var T;null!==(T=JT.e.audioEngine)&&void 0!==T&&T.audioContext&&(this._audioBuffer=v,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(v){var T;null!==(T=JT.e.audioEngine)&&void 0!==T&&T.audioContext&&JT.e.audioEngine.audioContext.decodeAudioData(v,(v=>{this._audioBufferLoaded(v)}),(v=>{s.d.Error("Error while decoding audio data for: "+this.name+" / Error: "+v)}))}setAudioBuffer(v){var T;null!==(T=JT.e.audioEngine)&&void 0!==T&&T.canUseWebAudio&&(this._audioBuffer=v,this._isReadyToPlay=!0)}updateOptions(v){v&&(this.loop=v.loop??this.loop,this.maxDistance=v.maxDistance??this.maxDistance,this.useCustomAttenuation=v.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=v.rolloffFactor??this.rolloffFactor,this.refDistance=v.refDistance??this.refDistance,this.distanceModel=v.distanceModel??this.distanceModel,this._playbackRate=v.playbackRate??this._playbackRate,this._length=v.length??void 0,this.spatialSound=v.spatialSound??this._spatialSound,this._setOffset(v.offset??void 0),this.setVolume(v.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var v;null!==(v=JT.e.audioEngine)&&void 0!==v&&v.canUseWebAudio&&JT.e.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??JT.e.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var v;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(v=this._soundPanner)||void 0===v||v.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var v;null!==(v=JT.e.audioEngine)&&void 0!==v&&v.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(v){var T;null!==(T=JT.e.audioEngine)&&void 0!==T&&T.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(v),this._isOutputConnected=!0)}setDirectionalCone(v,T,X){T<v?s.d.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=v,this._coneOuterAngle=T,this._coneOuterGain=X,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(v){if(v!=this._coneInnerAngle){var T;if(this._coneOuterAngle<v)return void s.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=v,null!==(T=JT.e.audioEngine)&&void 0!==T&&T.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(v){if(v!=this._coneOuterAngle){var T;if(v<this._coneInnerAngle)return void s.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=v,null!==(T=JT.e.audioEngine)&&void 0!==T&&T.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(v){var T;v.equals(this._position)||(this._position.p(v),null!==(T=JT.e.audioEngine)&&void 0!==T&&T.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(v){var T;this._localDirection=v,null!==(T=JT.e.audioEngine)&&void 0!==T&&T.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const v=this._connectedTransformNode.getWorldMatrix(),T=u.l.TransformNormal(this._localDirection,v);T.normalize(),this._soundPanner.orientationX.value=T.x,this._soundPanner.orientationY.value=T.y,this._soundPanner.orientationZ.value=T.z}updateDistanceFromListener(){var v;if(null!==(v=JT.e.audioEngine)&&void 0!==v&&v.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const v=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.Xc(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,v,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(v){this._customAttenuationFunction=v}play(v,T,X){var O;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(O=JT.e.audioEngine)&&void 0!==O&&O.audioContext)try{var u,B;this._clearTimeoutsAndObservers();let O=v?(null===(u=JT.e.audioEngine)||void 0===u?void 0:u.audioContext.currentTime)+v:null===(B=JT.e.audioEngine)||void 0===B?void 0:B.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=JT.e.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const v=()=>{var X;if(null!==(X=JT.e.audioEngine)&&void 0!==X&&X.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=T??0;const X=this._htmlAudioElement.play();void 0!==X&&X.catch((()=>{var T,X;(null===(T=JT.e.audioEngine)||void 0===T||T.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(X=JT.e.audioEngine)||void 0===X?void 0:X.onAudioUnlockedObservable.addOnce((()=>{v()})))}))}else{var O;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(O=JT.e.audioEngine)||void 0===O?void 0:O.onAudioUnlockedObservable.addOnce((()=>{v()}))}};v()}}else{var m;const u=()=>{var u;if(null!==(u=JT.e.audioEngine)&&void 0!==u&&u.audioContext){var B;if(X=X||this._length,void 0!==T&&this._setOffset(T),this._soundSource){const v=this._soundSource;v.onended=()=>{v.disconnect()}}if(this._soundSource=null===(B=JT.e.audioEngine)||void 0===B?void 0:B.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var m;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==T&&(this._soundSource.loopStart=T),void 0!==X&&(this._soundSource.loopEnd=(0|T)+X),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},O=v?(null===(m=JT.e.audioEngine)||void 0===m?void 0:m.audioContext.currentTime)+v:JT.e.audioEngine.audioContext.currentTime;const u=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(O,u,this.loop?void 0:X)}}};"suspended"===(null===(m=JT.e.audioEngine)||void 0===m?void 0:m.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var v;"suspended"===(null===(v=JT.e.audioEngine)||void 0===v?void 0:v.audioContext.state)?(JT.e.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=JT.e.audioEngine.onAudioUnlockedObservable.addOnce((()=>{u()})))):u()}),500):u()}this._startTime=O,this.isPlaying=!0,this.isPaused=!1}catch(A){s.d.Error("Error while trying to play audio: "+this.name+", "+A.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(v){var T;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var X;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(X=this._streamingSource)||void 0===X||X.disconnect();this.isPlaying=!1}else if(null!==(T=JT.e.audioEngine)&&void 0!==T&&T.audioContext&&this._soundSource){const T=v?JT.e.audioEngine.audioContext.currentTime+v:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(T)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var v;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var T;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(T=this._streamingSource)||void 0===T||T.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(v=JT.e.audioEngine)&&void 0!==v&&v.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=JT.e.audioEngine.audioContext.currentTime-this._startTime)}setVolume(v,T){var X;null!==(X=JT.e.audioEngine)&&void 0!==X&&X.canUseWebAudio&&this._soundGain&&(T&&JT.e.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(JT.e.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,JT.e.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(v,JT.e.audioEngine.audioContext.currentTime+T)):this._soundGain.gain.value=v),this._volume=v}setPlaybackRate(v){this._playbackRate=v,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(v){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=v,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=v=>this._onRegisterAfterWorldMatrixUpdate(v),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(v){var T;if(v.getBoundingInfo){const T=v.getBoundingInfo();this.setPosition(T.boundingSphere.centerWorld)}else this.setPosition(v.absolutePosition);null!==(T=JT.e.audioEngine)&&void 0!==T&&T.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const v=()=>{this._isReadyToPlay?(X._audioBuffer=this.getAudioBuffer(),X._isReadyToPlay=!0,X.autoplay&&X.play(0,this._offset,this._length)):setTimeout(v,300)},T={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},X=new yT(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,T);return this.useCustomAttenuation&&X.setAttenuationFunction(this._customAttenuationFunction),X.setPosition(this._position),X.setPlaybackRate(this._playbackRate),v(),X}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const v={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(v.connectedMeshId=this._connectedTransformNode.id),v.position=this._position.Pd(),v.refDistance=this.refDistance,v.distanceModel=this.distanceModel,v.isDirectional=this._isDirectional,v.localDirectionToMesh=this._localDirection.Pd(),v.coneInnerAngle=this._coneInnerAngle,v.coneOuterAngle=this._coneOuterAngle,v.coneOuterGain=this._coneOuterGain),v}static Parse(v,T,X,O){const B=v.name;let m;m=v.url?X+v.url:X+B;const A={autoplay:v.autoplay,loop:v.loop,volume:v.volume,spatialSound:v.spatialSound,maxDistance:v.maxDistance,rolloffFactor:v.rolloffFactor,refDistance:v.refDistance,distanceModel:v.distanceModel,playbackRate:v.playbackRate};let x;if(O){const v=()=>{O._isReadyToPlay?(x._audioBuffer=O.getAudioBuffer(),x._isReadyToPlay=!0,x.autoplay&&x.play(0,x._offset,x._length)):setTimeout(v,300)};x=new yT(B,new ArrayBuffer(0),T,null,A),v()}else x=new yT(B,m,T,(()=>{T.removePendingData(x)}),A),T.addPendingData(x);if(v.position){const T=u.l.Ld(v.position);x.setPosition(T)}if(v.isDirectional&&(x.setDirectionalCone(v.coneInnerAngle||360,v.coneOuterAngle||360,v.coneOuterGain||0),v.localDirectionToMesh)){const T=u.l.Ld(v.localDirectionToMesh);x.setLocalDirectionToMesh(T)}if(v.connectedMeshId){const X=T.getMeshById(v.connectedMeshId);X&&x.attachToMesh(X)}return v.metadata&&(x.metadata=v.metadata),x}_setOffset(v){this._offset!==v&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=v)}_clearTimeoutsAndObservers(){var v;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(v=JT.e.audioEngine)||void 0===v||v.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}yT._SceneComponentInitialization=v=>{throw(0,UT.d)("AudioSceneComponent")},(0,G.f)("BABYLON.Sound",yT);class PT{constructor(v,T,X){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],T.length!==X.length)throw new Error("Sounds length does not equal weights length");this.loop=v,this._weights=X;let O=0;for(const B of X)O+=B;const u=O>0?1/O:0;for(let B=0;B<this._weights.length;B++)this._weights[B]*=u;this._sounds=T;for(const B of this._sounds)B.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(v){if(v!==this._coneInnerAngle){if(this._coneOuterAngle<v)return void s.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=v;for(const T of this._sounds)T.directionalConeInnerAngle=v}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(v){if(v!==this._coneOuterAngle){if(v<this._coneInnerAngle)return void s.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=v;for(const T of this._sounds)T.directionalConeOuterAngle=v}}get volume(){return this._volume}set volume(v){if(v!==this._volume)for(const T of this._sounds)T.setVolume(v)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(v){if(!this.isPaused){this.stop();const v=Math.random();let T=0;for(let X=0;X<this._weights.length;X++)if(T+=this._weights[X],v<=T){this._currentIndex=X;break}}const T=this._sounds[this._currentIndex??0];T.isReady()?T.play(0,this.isPaused?void 0:v):T.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class aT{constructor(v){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(v=v||D.c.LastCreatedScene)&&(this._scene=v,this.soundCollection=[],this._options=T,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var v;null!==(v=JT.e.audioEngine)&&void 0!==v&&v.canUseWebAudio&&JT.e.audioEngine.audioContext&&(this._outputAudioNode=JT.e.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(JT.e.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(JT.e.audioEngine&&JT.e.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(v){var T;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(T=JT.e.audioEngine)&&void 0!==T&&T.canUseWebAudio&&this._outputAudioNode&&v.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==v.soundTrackId&&(-1===v.soundTrackId?this._scene.mainSoundTrack.removeSound(v):this._scene.soundTracks&&this._scene.soundTracks[v.soundTrackId].removeSound(v)),this.soundCollection.push(v),v.soundTrackId=this.id}removeSound(v){const T=this.soundCollection.indexOf(v);-1!==T&&this.soundCollection.splice(T,1)}setVolume(v){var T;null!==(T=JT.e.audioEngine)&&void 0!==T&&T.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=v)}switchPanningModelToHRTF(){var v;if(null!==(v=JT.e.audioEngine)&&void 0!==v&&v.canUseWebAudio)for(let T=0;T<this.soundCollection.length;T++)this.soundCollection[T].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var v;if(null!==(v=JT.e.audioEngine)&&void 0!==v&&v.canUseWebAudio)for(let T=0;T<this.soundCollection.length;T++)this.soundCollection[T].switchPanningModelToEqualPower()}connectToAnalyser(v){var T;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=v,null!==(T=JT.e.audioEngine)&&void 0!==T&&T.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,JT.e.audioEngine.masterGain))}}var ET=X(1290),iT=X(1209),tT=(X(1555),X(1133));(0,X(12102).h)(ET.d.NAME_AUDIO,((v,T,X,O)=>{let u,B=[];if(X.Be=X.Be||[],void 0!==v.Be&&null!==v.Be)for(let A=0,x=v.Be.length;A<x;A++){var m;const x=v.Be[A];null!==(m=JT.e.audioEngine)&&void 0!==m&&m.canUseWebAudio?(x.url||(x.url=x.name),B[x.url]?X.Be.push(yT.Parse(x,T,O,B[x.url])):(u=yT.Parse(x,T,O),B[x.url]=u,X.Be.push(u))):X.Be.push(new yT(x.name,null,T))}B=[]})),Object.defineProperty(iT.e.prototype,"mainSoundTrack",{get:function(){let v=this._getComponent(ET.d.NAME_AUDIO);return v||(v=new CT(this),this.xe(v)),this._mainSoundTrack||(this._mainSoundTrack=new aT(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),iT.e.prototype.getSoundByName=function(v){let T;for(T=0;T<this.mainSoundTrack.soundCollection.length;T++)if(this.mainSoundTrack.soundCollection[T].name===v)return this.mainSoundTrack.soundCollection[T];if(this.soundTracks)for(let X=0;X<this.soundTracks.length;X++)for(T=0;T<this.soundTracks[X].soundCollection.length;T++)if(this.soundTracks[X].soundCollection[T].name===v)return this.soundTracks[X].soundCollection[T];return null},Object.defineProperty(iT.e.prototype,"audioEnabled",{get:function(){let v=this._getComponent(ET.d.NAME_AUDIO);return v||(v=new CT(this),this.xe(v)),v.audioEnabled},set:function(v){let T=this._getComponent(ET.d.NAME_AUDIO);T||(T=new CT(this),this.xe(T)),v?T.enableAudio():T.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(iT.e.prototype,"headphone",{get:function(){let v=this._getComponent(ET.d.NAME_AUDIO);return v||(v=new CT(this),this.xe(v)),v.headphone},set:function(v){let T=this._getComponent(ET.d.NAME_AUDIO);T||(T=new CT(this),this.xe(T)),v?T.switchAudioModeForHeadphones():T.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(iT.e.prototype,"audioListenerPositionProvider",{get:function(){let v=this._getComponent(ET.d.NAME_AUDIO);return v||(v=new CT(this),this.xe(v)),v.audioListenerPositionProvider},set:function(v){let T=this._getComponent(ET.d.NAME_AUDIO);if(T||(T=new CT(this),this.xe(T)),v&&"function"!==typeof v)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");T.audioListenerPositionProvider=v},enumerable:!0,configurable:!0}),Object.defineProperty(iT.e.prototype,"audioListenerRotationProvider",{get:function(){let v=this._getComponent(ET.d.NAME_AUDIO);return v||(v=new CT(this),this.xe(v)),v.audioListenerRotationProvider},set:function(v){let T=this._getComponent(ET.d.NAME_AUDIO);if(T||(T=new CT(this),this.xe(T)),v&&"function"!==typeof v)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");T.audioListenerRotationProvider=v},enumerable:!0,configurable:!0}),Object.defineProperty(iT.e.prototype,"audioPositioningRefreshRate",{get:function(){let v=this._getComponent(ET.d.NAME_AUDIO);return v||(v=new CT(this),this.xe(v)),v.audioPositioningRefreshRate},set:function(v){let T=this._getComponent(ET.d.NAME_AUDIO);T||(T=new CT(this),this.xe(T)),T.audioPositioningRefreshRate=v},enumerable:!0,configurable:!0});class CT{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(v){this.name=ET.d.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new u.l,this._cachedCameraPosition=new u.l,this._lastCheck=0,this._invertMatrixTemp=new u.b,this._cameraDirectionTemp=new u.l,(v=v||D.c.LastCreatedScene)&&(this.Fe=v,v.soundTracks=[],v.Be=[])}register(){this.Fe._afterRenderStage.registerStep(ET.d.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(v){if(v.Be=[],this.Fe.soundTracks)for(let T=0;T<this.Fe.soundTracks.length;T++){const X=this.Fe.soundTracks[T];for(let T=0;T<X.soundCollection.length;T++)v.Be.push(X.soundCollection[T].serialize())}}addFromContainer(v){v.Be&&v.Be.forEach((v=>{v.play(),v.autoplay=!0,this.Fe.mainSoundTrack.addSound(v)}))}removeFromContainer(v){let T=arguments.length>1&&void 0!==arguments[1]&&arguments[1];v.Be&&v.Be.forEach((v=>{v.stop(),v.autoplay=!1,this.Fe.mainSoundTrack.removeSound(v),T&&v.dispose()}))}dispose(){const v=this.Fe;if(v._mainSoundTrack&&v.mainSoundTrack.dispose(),v.soundTracks)for(let T=0;T<v.soundTracks.length;T++)v.soundTracks[T].dispose()}disableAudio(){const v=this.Fe;let T;for(this._audioEnabled=!1,JT.e.audioEngine&&JT.e.audioEngine.audioContext&&JT.e.audioEngine.audioContext.suspend(),T=0;T<v.mainSoundTrack.soundCollection.length;T++)v.mainSoundTrack.soundCollection[T].pause();if(v.soundTracks)for(T=0;T<v.soundTracks.length;T++)for(let X=0;X<v.soundTracks[T].soundCollection.length;X++)v.soundTracks[T].soundCollection[X].pause()}enableAudio(){const v=this.Fe;let T;for(this._audioEnabled=!0,JT.e.audioEngine&&JT.e.audioEngine.audioContext&&JT.e.audioEngine.audioContext.resume(),T=0;T<v.mainSoundTrack.soundCollection.length;T++)v.mainSoundTrack.soundCollection[T].isPaused&&v.mainSoundTrack.soundCollection[T].play();if(v.soundTracks)for(T=0;T<v.soundTracks.length;T++)for(let X=0;X<v.soundTracks[T].soundCollection.length;X++)v.soundTracks[T].soundCollection[X].isPaused&&v.soundTracks[T].soundCollection[X].play()}switchAudioModeForHeadphones(){const v=this.Fe;if(this._headphone=!0,v.mainSoundTrack.switchPanningModelToHRTF(),v.soundTracks)for(let T=0;T<v.soundTracks.length;T++)v.soundTracks[T].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const v=this.Fe;if(this._headphone=!1,v.mainSoundTrack.switchPanningModelToEqualPower(),v.soundTracks)for(let T=0;T<v.soundTracks.length;T++)v.soundTracks[T].switchPanningModelToEqualPower()}_afterRender(){const v=tT.b.Now;if(this._lastCheck&&v-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=v;const T=this.Fe;if(!this._audioEnabled||!T._mainSoundTrack||!T.soundTracks||0===T._mainSoundTrack.soundCollection.length&&1===T.soundTracks.length)return;const X=JT.e.audioEngine;if(X&&X.audioContext){let v,O=T.activeCamera;if(T.activeCameras&&T.activeCameras.length>0&&(O=T.activeCameras[0]),this.audioListenerPositionProvider){const v=this.audioListenerPositionProvider();X.audioContext.listener.setPosition(v.x||0,v.y||0,v.z||0)}else O?this._cachedCameraPosition.equals(O.globalPosition)||(this._cachedCameraPosition.p(O.globalPosition),X.audioContext.listener.setPosition(O.globalPosition.x,O.globalPosition.y,O.globalPosition.z)):X.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const v=this.audioListenerRotationProvider();X.audioContext.listener.setOrientation(v.x||0,v.y||0,v.z||0,0,1,0)}else O?(O.rigCameras&&O.rigCameras.length>0&&(O=O.rigCameras[0]),O.getViewMatrix().invertToRef(this._invertMatrixTemp),u.l.TransformNormalToRef(CT._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.p(this._cameraDirectionTemp),X.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):X.audioContext.listener.setOrientation(0,0,0,0,1,0);for(v=0;v<T.mainSoundTrack.soundCollection.length;v++){const X=T.mainSoundTrack.soundCollection[v];X.useCustomAttenuation&&X.updateDistanceFromListener()}if(T.soundTracks)for(v=0;v<T.soundTracks.length;v++)for(let X=0;X<T.soundTracks[v].soundCollection.length;X++){const O=T.soundTracks[v].soundCollection[X];O.useCustomAttenuation&&O.updateDistanceFromListener()}}}}CT._CameraDirection=new u.l(0,0,-1),yT._SceneComponentInitialization=v=>{let T=v._getComponent(ET.d.NAME_AUDIO);T||(T=new CT(v),v.xe(T))};const cT="MSFT_audio_emitter";class NT{constructor(v){this.name=cT,this._loader=v,this.enabled=this._loader.isExtensionUsed(cT)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const v=this._loader.cj.extensions;if(v&&v[this.name]){const T=v[this.name];this._clips=T.clips,this._emitters=T.emitters,z.Assign(this._clips),z.Assign(this._emitters)}}loadSceneAsync(v,T){return R.LoadExtensionAsync(v,T,this.name,((X,O)=>{const u=new Array;u.push(this._loader.loadSceneAsync(v,T));for(const v of O.emitters){const T=z.Get(`${X}/emitters`,this._emitters,v);if(void 0!=T.refDistance||void 0!=T.maxDistance||void 0!=T.rolloffFactor||void 0!=T.distanceModel||void 0!=T.innerAngle||void 0!=T.outerAngle)throw new Error(`${X}: Direction or Distance properties are not allowed on emitters attached to a scene`);u.push(this._loadEmitterAsync(`${X}/emitters/${T.index}`,T))}return Promise.all(u).then((()=>{}))}))}loadNodeAsync(v,T,X){return R.LoadExtensionAsync(v,T,this.name,((v,O)=>{const B=new Array;return this._loader.loadNodeAsync(v,T,(T=>{for(const X of O.emitters){const O=z.Get(`${v}/emitters`,this._emitters,X);B.push(this._loadEmitterAsync(`${v}/emitters/${O.index}`,O).then((()=>{for(const v of O._babylonSounds)v.attachToMesh(T),void 0==O.innerAngle&&void 0==O.outerAngle||(v.setLocalDirectionToMesh(u.l.Forward()),v.setDirectionalCone(2*m.c.ToDegrees(void 0==O.innerAngle?Math.PI:O.innerAngle),2*m.c.ToDegrees(void 0==O.outerAngle?Math.PI:O.outerAngle),0))})))}X(T)})).then((v=>Promise.all(B).then((()=>v))))}))}loadAnimationAsync(v,T){return R.LoadExtensionAsync(v,T,this.name,((X,O)=>this._loader.loadAnimationAsync(v,T).then((u=>{const B=new Array;z.Assign(O.events);for(const m of O.events)B.push(this._loadAnimationEventAsync(`${X}/events/${m.index}`,v,T,m,u));return Promise.all(B).then((()=>u))}))))}_loadClipAsync(v,T){if(T._objectURL)return T._objectURL;let X;if(T.uri)X=this._loader.loadUriAsync(v,T,T.uri);else{const O=z.Get(`${v}/bufferView`,this._loader.cj.bufferViews,T.bufferView);X=this._loader.loadBufferViewAsync(`/bufferViews/${O.index}`,O)}return T._objectURL=X.then((v=>URL.createObjectURL(new Blob([v],{type:T.mimeType})))),T._objectURL}_loadEmitterAsync(v,T){if(T._babylonSounds=T._babylonSounds||[],!T._babylonData){const v=new Array,X=T.name||`emitter${T.index}`,O={loop:!1,autoplay:!1,volume:void 0==T.volume?1:T.volume};for(let B=0;B<T.clips.length;B++){const u=`/extensions/${this.name}/clips`,m=z.Get(u,this._clips,T.clips[B].clip);v.push(this._loadClipAsync(`${u}/${T.clips[B].clip}`,m).then((v=>{const u=T._babylonSounds[B]=new yT(X,v,this._loader.babylonScene,null,O);u.refDistance=T.refDistance||1,u.maxDistance=T.maxDistance||256,u.rolloffFactor=T.rolloffFactor||1,u.distanceModel=T.distanceModel||"exponential"})))}const u=Promise.all(v).then((()=>{const v=T.clips.map((v=>v.weight||1)),X=new PT(T.loop||!1,T._babylonSounds,v);T.innerAngle&&(X.directionalConeInnerAngle=2*m.c.ToDegrees(T.innerAngle)),T.outerAngle&&(X.directionalConeOuterAngle=2*m.c.ToDegrees(T.outerAngle)),T.volume&&(X.volume=T.volume),T._babylonData.sound=X}));T._babylonData={loaded:u}}return T._babylonData.loaded}_getEventAction(v,T,X,O,u){switch(X){case"play":return v=>{const X=(u||0)+(v-O);T.play(X)};case"stop":return()=>{T.stop()};case"pause":return()=>{T.pause()};default:throw new Error(`${v}: Unsupported action ${X}`)}}_loadAnimationEventAsync(v,T,X,O,u){if(0==u.targetedAnimations.length)return Promise.resolve();const B=u.targetedAnimations[0],m=O.k,A=z.Get(`/extensions/${this.name}/emitters`,this._emitters,m);return this._loadEmitterAsync(v,A).then((()=>{const T=A._babylonData.sound;if(T){const X=new ZT(O.time,this._getEventAction(v,T,O.action,O.time,O.startOffset));B.animation.addEvent(X),u.onAnimationGroupEndObservable.add((()=>{T.stop()})),u.onAnimationGroupPauseObservable.add((()=>{T.pause()}))}}))}}S(cT),h(cT,!0,(v=>new NT(v)));const dT="MSFT_lod";class IT{constructor(v){var T;this.name=dT,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new M.b,this.onMaterialLODsLoadedObservable=new M.b,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=v,this.maxLODsToLoad=(null===(T=this._loader.parent.extensionOptions[dT])||void 0===T?void 0:T.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(dT)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let v=0;v<this._nodePromiseLODs.length;v++){const T=Promise.all(this._nodePromiseLODs[v]).then((()=>{0!==v&&(this._loader.endPerformanceCounter(`Node LOD ${v}`),this._loader.log(`Loaded node LOD ${v}`)),this.onNodeLODsLoadedObservable.notifyObservers(v),v!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${v+1}`),this._loadBufferLOD(this._nodeBufferLODs,v+1),this._nodeSignalLODs[v]&&this._nodeSignalLODs[v].resolve())}));this._loader._completePromises.push(T)}for(let v=0;v<this._materialPromiseLODs.length;v++){const T=Promise.all(this._materialPromiseLODs[v]).then((()=>{0!==v&&(this._loader.endPerformanceCounter(`Material LOD ${v}`),this._loader.log(`Loaded material LOD ${v}`)),this.onMaterialLODsLoadedObservable.notifyObservers(v),v!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${v+1}`),this._loadBufferLOD(this._materialBufferLODs,v+1),this._materialSignalLODs[v]&&this._materialSignalLODs[v].resolve())}));this._loader._completePromises.push(T)}}loadSceneAsync(v,T){const X=this._loader.loadSceneAsync(v,T);return this._loadBufferLOD(this._bufferLODs,0),X}loadNodeAsync(v,T,X){return R.LoadExtensionAsync(v,T,this.name,((v,u)=>{let B;const m=this._getLODs(v,T,this._loader.cj.nodes,u.ids);this._loader.logOpen(`${v}`);for(let T=0;T<m.length;T++){const v=m[T];0!==T&&(this._nodeIndexLOD=T,this._nodeSignalLODs[T]=this._nodeSignalLODs[T]||new O);const u=v=>{X(v),v.Qg(!1)},A=this._loader.loadNodeAsync(`/nodes/${v.index}`,v,u).then((v=>{if(0!==T){const v=m[T-1];v._babylonTransformNode&&(this._disposeTransformNode(v._babylonTransformNode),delete v._babylonTransformNode)}return v.Qg(!0),v}));this._nodePromiseLODs[T]=this._nodePromiseLODs[T]||[],0===T?B=A:(this._nodeIndexLOD=null,this._nodePromiseLODs[T].push(A))}return this._loader.logClose(),B}))}_loadMaterialAsync(v,T,X,O,u){return this._nodeIndexLOD?null:R.LoadExtensionAsync(v,T,this.name,((v,B)=>{let m;const A=this._getLODs(v,T,this._loader.cj.materials,B.ids);this._loader.logOpen(`${v}`);for(let T=0;T<A.length;T++){const v=A[T];0!==T&&(this._materialIndexLOD=T);const B=this._loader._loadMaterialAsync(`/materials/${v.index}`,v,X,O,(v=>{0===T&&u(v)})).then((v=>{if(0!==T){u(v);const X=A[T-1]._data;X[O]&&(this._disposeMaterials([X[O].babylonMaterial]),delete X[O])}return v}));this._materialPromiseLODs[T]=this._materialPromiseLODs[T]||[],0===T?m=B:(this._materialIndexLOD=null,this._materialPromiseLODs[T].push(B))}return this._loader.logClose(),m}))}_loadUriAsync(v,T,X){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const u=this._nodeIndexLOD-1;return this._nodeSignalLODs[u]=this._nodeSignalLODs[u]||new O,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((()=>this._loader.loadUriAsync(v,T,X)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const u=this._materialIndexLOD-1;return this._materialSignalLODs[u]=this._materialSignalLODs[u]||new O,this._materialSignalLODs[u].promise.then((()=>this._loader.loadUriAsync(v,T,X)))}return null}loadBufferAsync(v,T,X,u){if(this._loader.parent.useRangeRequests&&!T.uri){if(!this._loader.bin)throw new Error(`${v}: Uri is missing or the binary glTF is missing its binary chunk`);const T=(v,T)=>{const B=X,m=B+u-1;let A=v[T];return A?(A.start=Math.min(A.start,B),A.end=Math.max(A.end,m)):(A={start:B,end:m,loaded:new O},v[T]=A),A.loaded.promise.then((v=>new Uint8Array(v.buffer,v.byteOffset+X-A.start,u)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?T(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?T(this._materialBufferLODs,this._materialIndexLOD):T(this._bufferLODs,0)}return null}_loadBufferLOD(v,T){const X=v[T];X&&(this._loader.log(`Loading buffer range [${X.start}-${X.end}]`),this._loader.bin.readAsync(X.start,X.end-X.start+1).then((v=>{X.loaded.resolve(v)}),(v=>{X.loaded.reject(v)})))}_getLODs(v,T,X,O){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const u=[];for(let B=O.length-1;B>=0;B--)if(u.push(z.Get(`${v}/ids/${O[B]}`,X,O[B])),u.length===this.maxLODsToLoad)return u;return u.push(T),u}_disposeTransformNode(v){const T=[],X=v.material;X&&T.push(X);for(const u of v.getChildMeshes())u.material&&T.push(u.material);v.dispose();const O=T.filter((v=>this._loader.babylonScene.meshes.every((T=>T.material!=v))));this._disposeMaterials(O)}_disposeMaterials(v){const T={};for(const X of v){for(const v of X.getActiveTextures())T[v.uniqueId]=v;X.dispose()}for(const X in T)for(const v of this._loader.babylonScene.materials)v.hasTexture(T[X])&&delete T[X];for(const X in T)T[X].dispose()}}S(dT),h(dT,!0,(v=>new IT(v)));const WT="MSFT_minecraftMesh";class gT{constructor(v){this.name=WT,this._loader=v,this.enabled=this._loader.isExtensionUsed(WT)}dispose(){this._loader=null}loadMaterialPropertiesAsync(v,T,X){return R.LoadExtraAsync(v,T,this.name,((O,u)=>{if(u){if(!(X instanceof r))throw new Error(`${O}: Material type not supported`);const u=this._loader.loadMaterialPropertiesAsync(v,T,X);return X.needAlphaBlending()&&(X.forceDepthWrite=!0,X.separateCullingPass=!0),X.Xe=X.forceDepthWrite,X.twoSidedLighting=!0,u}return null}))}}S(WT),h(WT,!0,(v=>new gT(v)));const jT="MSFT_sRGBFactors";class eT{constructor(v){this.name=jT,this._loader=v,this.enabled=this._loader.isExtensionUsed(jT)}dispose(){this._loader=null}loadMaterialPropertiesAsync(v,T,X){return R.LoadExtraAsync(v,T,this.name,((O,u)=>{if(u){if(!(X instanceof r))throw new Error(`${O}: Material type not supported`);const u=this._loader.loadMaterialPropertiesAsync(v,T,X),B=X.va().getEngine().useExactSrgbConversions;return X.albedoTexture||X.albedoColor.toLinearSpaceToRef(X.albedoColor,B),X.reflectivityTexture||X.reflectivityColor.toLinearSpaceToRef(X.reflectivityColor,B),u}return null}))}}S(jT),h(jT,!0,(v=>new eT(v)));var hT,ST=X(1053);!function(v){v[v.Input=0]="Input",v[v.Output=1]="Output"}(hT||(hT={}));class wT{constructor(v,T,X){this._ownerBlock=X,this._connectedPoint=[],this.uniqueId=(0,ST.c)(),this.connectedPointIds=[],this.name=v,this._connectionType=T}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(v){if(this._connectionType===v._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||v._isSingularConnection()&&v._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(v),v._connectedPoint.push(this)}serialize(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};v.uniqueId=this.uniqueId,v.name=this.name,v._connectionType=this._connectionType,v.connectedPointIds=[],v.className=this.getClassName();for(const T of this._connectedPoint)v.connectedPointIds.push(T.uniqueId)}getClassName(){return"FGConnection"}deserialize(v){this.uniqueId=v.uniqueId,this.name=v.name,this._connectionType=v._connectionType,this.connectedPointIds=v.connectedPointIds}static Parse(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},T=arguments.length>1?arguments[1]:void 0;const X=new(m.c.Instantiate(v.className))(v.name,v._connectionType,T);return X.deserialize(v),X}}class zT{constructor(v){this.value=this._toInt(v)}_toInt(v){return 0|v}add(v){return new zT(this.value+v.value)}Xc(v){return new zT(this.value-v.value)}multiply(v){return new zT(Math.imul(this.value,v.value))}divide(v){return new zT(this.value/v.value)}getClassName(){return zT.ClassName}equals(v){return this.value===v.value}static Parse(v){return new zT(v.value)}}zT.ClassName="FlowGraphInteger",(0,G.f)("FlowGraphInteger",zT);class RT{constructor(v,T){this.typeName=v,this.defaultValue=T}serialize(v){v.typeName=this.typeName,v.defaultValue=this.defaultValue}static Parse(v){return new RT(v.typeName,v.defaultValue)}}const YT=new RT("any",void 0),qT=(new RT("string",""),new RT("number",0)),vX=new RT("boolean",!1),TX=new RT("Vector2",u.i.Zero()),XX=new RT("Vd",u.l.Zero()),OX=(new RT("Vector4",u.o.Zero()),new RT("Matrix",u.b.Identity())),uX=(new RT("he",B.d.Black()),new RT("ke",new B.g(0,0,0,0)),new RT("Quaternion",u.f.Identity()),new RT("FlowGraphInteger",new zT(0)));class BX extends wT{constructor(v,T,X,O){super(v,T,X),this.richType=O}_isSingularConnection(){return 0===this.connectionType}setValue(v,T){T._setConnectionValue(this,v)}connectTo(v){super.connectTo(v)}_getValueOrDefault(v){return v._hasConnectionValue(this)?v._getConnectionValue(this):this.richType.defaultValue}getValue(v){return 1===this.connectionType?(v._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(v),this._getValueOrDefault(v)):this.isConnected()?this._connectedPoint[0].getValue(v):this._getValueOrDefault(v)}getClassName(){return"FGDataConnection"}serialize(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(v),v.richType={},this.richType.serialize(v.richType)}static Parse(v,T){const X=wT.Parse(v,T);return X.richType=RT.Parse(v.richType),X}}function mX(v){return"Mesh"===v||"AbstractMesh"===v||"GroundMesh"===v||"InstanceMesh"===v||"LinesMesh"===v||"GoldbergMesh"===v||"GreasedLineMesh"===v||"TrailMesh"===v}function AX(v){return"Vector2"===v||"Vd"===v||"Vector4"===v||"Quaternion"===v||"he"===v||"ke"===v}function xX(v,T,X){var O;const u=(null===T||void 0===T||null===(O=T.getClassName)||void 0===O?void 0:O.call(T))??"";mX(u)?X[v]={name:T.name,className:u}:AX(u)?X[v]={value:T.Pd(),className:u}:X[v]=T}function fX(v,T,X){const O=T[v];let m;const A=null===O||void 0===O?void 0:O.className;return m=mX(A)?X.getMeshByName(O.name):AX(A)?function(v,T){if("Vector2"===v)return u.i.Ld(T);if("Vd"===v)return u.l.Ld(T);if("Vector4"===v)return u.o.Ld(T);if("Quaternion"===v)return u.f.Ld(T);if("he"===v)return new B.d(T[0],T[1],T[2]);if("ke"===v)return new B.g(T[0],T[1],T[2],T[3]);throw new Error(`Unknown vector class name ${v}`)}(A,O.value):"Matrix"===A?u.b.Ld(O.value):A===zT.ClassName?zT.Parse(O):O&&void 0!==O.value?O.value:O,m}(0,G.f)("FGDataConnection",BX);class MX{constructor(v){var T;this.config=v,this.uniqueId=(0,ST.c)(),this.name=(null===(T=this.config)||void 0===T?void 0:T.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(v){}registerDataInput(v,T){const X=new BX(v,0,this,T);return this.dataInputs.push(X),X}registerDataOutput(v,T){const X=new BX(v,1,this,T);return this.dataOutputs.push(X),X}getDataInput(v){return this.dataInputs.find((T=>T.name===v))}getDataOutput(v){return this.dataOutputs.find((T=>T.name===v))}serialize(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};v.uniqueId=this.uniqueId,v.config={},this.config&&(v.config.name=this.config.name),v.dataInputs=[],v.dataOutputs=[],v.className=this.getClassName();for(const T of this.dataInputs){const X={};T.serialize(X),v.dataInputs.push(X)}for(const T of this.dataOutputs){const X={};T.serialize(X),v.dataOutputs.push(X)}}getClassName(){return"FGBlock"}static Parse(v,T){const X=m.c.Instantiate(v.className),O={},u=T.valueParseFunction??fX;if(v.config)for(const m in v.config)O[m]=u(m,v.config,T.Fe);var B;("FGSetPropertyBlock"===(B=v.className)||"FGGetPropertyBlock"===B||"FGPlayAnimationBlock"===B||"FGMeshPickEventBlock"===B)&&(O.pathConverter=T.pathConverter);const A=new X(O);A.uniqueId=v.uniqueId;for(let m=0;m<v.dataInputs.length;m++){const T=A.getDataInput(v.dataInputs[m].name);if(!T)throw new Error("Could not find data input with name "+v.dataInputs[m].name+" in block "+v.className);T.deserialize(v.dataInputs[m])}for(let m=0;m<v.dataOutputs.length;m++){const T=A.getDataOutput(v.dataOutputs[m].name);if(!T)throw new Error("Could not find data output with name "+v.dataOutputs[m].name+" in block "+v.className);T.deserialize(v.dataOutputs[m])}return A.metadata=v.metadata,A.deserialize&&A.deserialize(v),A}}class HX extends wT{_isSingularConnection(){return 1===this.connectionType}_activateSignal(v){var T;0===this.connectionType?(v._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(v,this),v._increaseExecutionId()):null===(T=this._connectedPoint[0])||void 0===T||T._activateSignal(v)}}(0,G.f)("FlowGraphSignalConnection",HX);class nX extends MX{constructor(v){super(v),this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in")}_registerSignalInput(v){const T=new HX(v,0,this);return this.signalInputs.push(T),T}_registerSignalOutput(v){const T=new HX(v,1,this);return this.signalOutputs.push(T),T}getSignalInput(v){return this.signalInputs.find((T=>T.name===v))}getSignalOutput(v){return this.signalOutputs.find((T=>T.name===v))}serialize(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(v),v.signalInputs=[],v.signalOutputs=[];for(const T of this.signalInputs){const X={};T.serialize(X),v.signalInputs.push(X)}for(const T of this.signalOutputs){const X={};T.serialize(X),v.signalOutputs.push(X)}}deserialize(v){for(let T=0;T<v.signalInputs.length;T++){const X=this.getSignalInput(v.signalInputs[T].name);if(!X)throw new Error("Could not find signal input with name "+v.signalInputs[T].name+" in block "+v.className);X.deserialize(v.signalInputs[T])}for(let T=0;T<v.signalOutputs.length;T++){const X=this.getSignalOutput(v.signalOutputs[T].name);if(!X)throw new Error("Could not find signal output with name "+v.signalOutputs[T].name+" in block "+v.className);X.deserialize(v.signalOutputs[T])}}getClassName(){return"FGExecutionBlock"}}class VX extends nX{constructor(v){super(v),this.out=this._registerSignalOutput("out"),this.done=this._registerSignalOutput("done")}_startPendingTasks(v){this._preparePendingTasks(v),v._addPendingBlock(this)}}class DX extends VX{_execute(v){v._notifyExecuteNode(this),this.out._activateSignal(v)}}class sX{constructor(v){this.uniqueId=(0,ST.c)(),this._userVariables={},this._executionVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new M.b,this._configuration=v}hasVariable(v){return v in this._userVariables}setVariable(v,T){this._userVariables[v]=T}getVariable(v){return this._userVariables[v]}get userVariables(){return this._userVariables}_getUniqueIdPrefixedName(v,T){return`${v.uniqueId}_${T}`}_setExecutionVariable(v,T,X){this._executionVariables[this._getUniqueIdPrefixedName(v,T)]=X}_getExecutionVariable(v,T,X){return this._hasExecutionVariable(v,T)?this._executionVariables[this._getUniqueIdPrefixedName(v,T)]:X}_deleteExecutionVariable(v,T){delete this._executionVariables[this._getUniqueIdPrefixedName(v,T)]}_hasExecutionVariable(v,T){return this._getUniqueIdPrefixedName(v,T)in this._executionVariables}_hasConnectionValue(v){return v.uniqueId in this._connectionValues}_setConnectionValue(v,T){this._connectionValues[v.uniqueId]=T}_getConnectionValue(v){return this._connectionValues[v.uniqueId]}get configuration(){return this._configuration}_addPendingBlock(v){this._pendingBlocks.push(v)}_removePendingBlock(v){const T=this._pendingBlocks.indexOf(v);-1!==T&&this._pendingBlocks.splice(T,1)}_clearPendingBlocks(){for(const v of this._pendingBlocks)v._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(v){this.onNodeExecutedObservable.notifyObservers(v)}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:xX;v.uniqueId=this.uniqueId,v._userVariables={};for(const X in this._userVariables)T(X,this._userVariables[X],v._userVariables);v._connectionValues={};for(const X in this._connectionValues)T(X,this._connectionValues[X],v._connectionValues)}getClassName(){return"FGContext"}static Parse(v,T){const X=T.graph.createContext(),O=T.valueParseFunction??fX;X.uniqueId=v.uniqueId;for(const u in v._userVariables){const T=O(u,v._userVariables,X._configuration.Fe);X._userVariables[u]=T}for(const u in v._connectionValues){const T=O(u,v._connectionValues,X._configuration.Fe);X._connectionValues[u]=T}return X}}(0,l.c)([(0,Q.G)()],sX.prototype,"uniqueId",void 0);var FX,kX,bX=X(1292);function lX(v,T){return!(!v.parent||v.parent!==T&&!lX(v.parent,T))}class QX extends DX{constructor(v){super(v),this.config=v}_getReferencedMesh(){const v=this.config.pathConverter.convert(this.config.path),T=v.info.getObject(v.object);if(!T||!(T instanceof y.c))throw new Error("Mesh pick event block requires a valid mesh");return T}_preparePendingTasks(v){let T=v._getExecutionVariable(this,"meshPickObserver");if(!T){const X=this._getReferencedMesh();v._setExecutionVariable(this,"mesh",X),T=X.va().onPointerObservable.add((T=>{var O,u,B;T.type===bX.d.POINTERPICK&&null!==(O=T.pickInfo)&&void 0!==O&&O.pickedMesh&&((null===(u=T.pickInfo)||void 0===u?void 0:u.pickedMesh)===X||lX(null===(B=T.pickInfo)||void 0===B?void 0:B.pickedMesh,X))&&this._execute(v)}));const O=X.ae.add((()=>this._onDispose));v._setExecutionVariable(this,"meshPickObserver",T),v._setExecutionVariable(this,"meshDisposeObserver",O)}}_onDispose(v){this._cancelPendingTasks(v),v._removePendingBlock(this)}_cancelPendingTasks(v){const T=v._getExecutionVariable(this,"mesh"),X=v._getExecutionVariable(this,"meshPickObserver"),O=v._getExecutionVariable(this,"meshDisposeObserver");T.va().onPointerObservable.remove(X),T.ae.remove(O),v._deleteExecutionVariable(this,"mesh"),v._deleteExecutionVariable(this,"meshPickObserver"),v._deleteExecutionVariable(this,"meshDisposeObserver")}getClassName(){return QX.ClassName}serialize(v){super.serialize(v),v.config.path=this.config.path}}QX.ClassName="FGMeshPickEventBlock",(0,G.f)(QX.ClassName,QX),function(v){v[v.Stopped=0]="Stopped",v[v.Started=1]="Started"}(FX||(FX={}));class KX{constructor(v){this._eventBlocks=[],this._executionContexts=[],this.state=0,this._scene=v.Fe,this._coordinator=v.coordinator,this._sceneDisposeObserver=this._scene.ae.add((()=>this.dispose()))}createContext(){const v=new sX({Fe:this._scene,coordinator:this._coordinator});return this._executionContexts.push(v),v}getContext(v){return this._executionContexts[v]}addEventBlock(v){this._eventBlocks.push(v)}start(){if(1!==this.state){this.state=1,0===this._executionContexts.length&&this.createContext();for(const v of this._executionContexts){const T=this._getContextualOrder();for(const X of T)X._startPendingTasks(v)}}}_getContextualOrder(){const v=[];for(const T of this._eventBlocks)if(T.getClassName()===QX.ClassName){const X=T._getReferencedMesh();let O=0;for(;O<v.length;O++){const T=v[O]._getReferencedMesh();if(X&&T&&lX(X,T))break}v.splice(O,0,T)}else v.push(T);return v}dispose(){if(0!==this.state){this.state=0;for(const v of this._executionContexts)v._clearPendingBlocks();this._executionContexts.length=0,this._eventBlocks.length=0,this._scene.ae.remove(this._sceneDisposeObserver),this._sceneDisposeObserver=null}}visitAllBlocks(v){const T=[],X=new Set;for(const O of this._eventBlocks)T.push(O),X.add(O.uniqueId);for(;T.length>0;){const O=T.pop();v(O);for(const v of O.dataInputs)for(const O of v._connectedPoint)X.has(O._ownerBlock.uniqueId)||(T.push(O._ownerBlock),X.add(O._ownerBlock.uniqueId));if(O instanceof nX)for(const v of O.signalOutputs)for(const O of v._connectedPoint)X.has(O._ownerBlock.uniqueId)||(T.push(O._ownerBlock),X.add(O._ownerBlock.uniqueId))}}serialize(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},T=arguments.length>1?arguments[1]:void 0;v.allBlocks=[],this.visitAllBlocks((T=>{const X={};T.serialize(X),v.allBlocks.push(X)})),v.executionContexts=[];for(const X of this._executionContexts){const O={};X.serialize(O,T),v.executionContexts.push(O)}}static GetDataOutConnectionByUniqueId(v,T){for(const X of v)for(const v of X.dataOutputs)if(v.uniqueId===T)return v;throw new Error("Could not find data out connection with unique id "+T)}static GetSignalInConnectionByUniqueId(v,T){for(const X of v)if(X instanceof nX)for(const v of X.signalInputs)if(v.uniqueId===T)return v;throw new Error("Could not find signal in connection with unique id "+T)}static Parse(v,T){const X=T.coordinator.createGraph(),O=[],u=T.valueParseFunction??fX;for(const B of v.allBlocks){const v=MX.Parse(B,{Fe:T.coordinator.config.Fe,pathConverter:T.pathConverter,valueParseFunction:u});O.push(v),v instanceof DX&&X.addEventBlock(v)}for(const B of O){for(const v of B.dataInputs)for(const T of v.connectedPointIds){const X=KX.GetDataOutConnectionByUniqueId(O,T);v.connectTo(X)}if(B instanceof nX)for(const v of B.signalOutputs)for(const T of v.connectedPointIds){const X=KX.GetSignalInConnectionByUniqueId(O,T);v.connectTo(X)}}for(const B of v.executionContexts)sX.Parse(B,{graph:X,valueParseFunction:u});return X}}class pX{constructor(v){this.config=v,this._flowGraphs=[],this._customEventsMap=new Map,this.config.Fe.ae.add((()=>{this.dispose()}));(pX.SceneCoordinators.get(this.config.Fe)??[]).push(this)}createGraph(){const v=new KX({Fe:this.config.Fe,coordinator:this});return this._flowGraphs.push(v),v}removeGraph(v){const T=this._flowGraphs.indexOf(v);-1!==T&&(v.dispose(),this._flowGraphs.splice(T,1))}start(){this._flowGraphs.forEach((v=>v.start()))}dispose(){this._flowGraphs.forEach((v=>v.dispose())),this._flowGraphs.length=0;const v=pX.SceneCoordinators.get(this.config.Fe)??[],T=v.indexOf(this);-1!==T&&v.splice(T,1)}serialize(v,T){v._flowGraphs=[],this._flowGraphs.forEach((X=>{const O={};X.serialize(O,T),v._flowGraphs.push(O)}))}static Parse(v,T){var X;const O=T.valueParseFunction??fX,u=new pX({Fe:T.Fe});return null===(X=v._flowGraphs)||void 0===X||X.forEach((v=>{KX.Parse(v,{coordinator:u,valueParseFunction:O,pathConverter:T.pathConverter})})),u}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(v){let T=this._customEventsMap.get(v);return T||(T=new M.b,this._customEventsMap.set(v,T)),T}notifyCustomEvent(v,T){const X=this._customEventsMap.get(v);X&&X.notifyObservers(T)}}pX.SceneCoordinators=new Map;class GX extends DX{_preparePendingTasks(v){if(!v._getExecutionVariable(this,"sceneReadyObserver")){const T=v.configuration.Fe.onReadyObservable.add((()=>{this._execute(v)}));v._setExecutionVariable(this,"sceneReadyObserver",T)}}_cancelPendingTasks(v){const T=v._getExecutionVariable(this,"sceneReadyObserver");v.configuration.Fe.onReadyObservable.remove(T),v._deleteExecutionVariable(this,"sceneReadyObserver")}getClassName(){return GX.ClassName}}GX.ClassName="FGSceneReadyEventBlock",(0,G.f)("FGSceneReadyEventBlock",GX);class LX extends DX{_preparePendingTasks(v){if(!v._getExecutionVariable(this,"sceneBeforeRender")){const T=v.configuration.Fe.onBeforeRenderObservable.add((()=>{this._execute(v)}));v._setExecutionVariable(this,"sceneBeforeRender",T)}}_cancelPendingTasks(v){const T=v._getExecutionVariable(this,"sceneBeforeRender");v.configuration.Fe.onBeforeRenderObservable.remove(T),v._deleteExecutionVariable(this,"sceneBeforeRender")}getClassName(){return LX.ClassName}}LX.ClassName="FGSceneTickEventBlock",(0,G.f)(LX.ClassName,LX);class rX extends nX{constructor(v){super(v),this.out=this._registerSignalOutput("out")}}class oX extends rX{constructor(v){super(v),this.message=this.registerDataInput("message",YT)}_execute(v){const T=this.message.getValue(v);s.d.Log(T),this.out._activateSignal(v)}getClassName(){return oX.ClassName}}oX.ClassName="FGConsoleLogBlock",(0,G.f)(oX.ClassName,oX),function(v){v[v.INIT=0]="INIT",v[v.STARTED=1]="STARTED",v[v.ENDED=2]="ENDED"}(kX||(kX={}));class ZX{constructor(v){this.onEachCountObservable=new M.b,this.onTimerAbortedObservable=new M.b,this.onTimerEndedObservable=new M.b,this.onStateChangedObservable=new M.b,this._observer=null,this._breakOnNextTick=!1,this._tick=v=>{const T=Date.now();this._timer=T-this._startTime;const X={startTime:this._startTime,currentTime:T,deltaTime:this._timer,completeRate:this._timer/this._timeToEnd,payload:v},O=this._breakOnNextTick||this._breakCondition(X);O||this._timer>=this._timeToEnd?this._stop(X,O):this.onEachCountObservable.notifyObservers(X)},this._setState(0),this._contextObservable=v.contextObservable,this._observableParameters=v.observableParameters??{},this._breakCondition=v.breakCondition??(()=>!1),this._timeToEnd=v.timeout,v.onEnded&&this.onTimerEndedObservable.add(v.onEnded),v.wi&&this.onEachCountObservable.add(v.wi),v.onAborted&&this.onTimerAbortedObservable.add(v.onAborted)}set breakCondition(v){this._breakCondition=v}clearObservables(){this.onEachCountObservable.clear(),this.onTimerAbortedObservable.clear(),this.onTimerEndedObservable.clear(),this.onStateChangedObservable.clear()}start(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._timeToEnd;if(1===this._state)throw new Error("Timer already started. Please stop it before starting again");this._timeToEnd=v,this._startTime=Date.now(),this._timer=0,this._observer=this._contextObservable.add(this._tick,this._observableParameters.mask,this._observableParameters.insertFirst,this._observableParameters.scope),this._setState(1)}stop(){1===this._state&&(this._breakOnNextTick=!0)}dispose(){this._observer&&this._contextObservable.remove(this._observer),this.clearObservables()}_setState(v){this._state=v,this.onStateChangedObservable.notifyObservers(this._state)}_stop(v){let T=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._contextObservable.remove(this._observer),this._setState(2),T?this.onTimerAbortedObservable.notifyObservers(v):this.onTimerEndedObservable.notifyObservers(v)}}class UX extends VX{constructor(v){super(v),this.timeout=this.registerDataInput("timeout",qT)}_preparePendingTasks(v){const T=this.timeout.getValue(v);if(void 0!==T&&T>=0){const X=v._getExecutionVariable(this,"runningTimers")||[],O=v.configuration.Fe,u=new ZX({timeout:T,contextObservable:O.onBeforeRenderObservable,onEnded:()=>this._onEnded(u,v)});u.start(),X.push(u),v._setExecutionVariable(this,"runningTimers",X)}}_execute(v){this._startPendingTasks(v),this.out._activateSignal(v)}_onEnded(v,T){const X=T._getExecutionVariable(this,"runningTimers")||[],O=X.indexOf(v);-1!==O?X.splice(O,1):m.c.Warn("FlowGraphTimerBlock: Timer ended but was not found in the running timers list"),T._removePendingBlock(this),this.done._activateSignal(T)}_cancelPendingTasks(v){const T=v._getExecutionVariable(this,"runningTimers")||[];for(const X of T)X.dispose();v._deleteExecutionVariable(this,"runningTimers")}getClassName(){return UX.ClassName}}UX.ClassName="FGTimerBlock",(0,G.f)("FGTimerBlock",UX);class JX extends rX{constructor(v){super(v),this.config=v;for(let T=0;T<this.config.eventData.length;T++){const v=this.config.eventData[T];this.registerDataInput(v,YT)}}_execute(v){const T=this.config.eventId,X=this.dataInputs.map((T=>T.getValue(v)));v.configuration.coordinator.notifyCustomEvent(T,X),this.out._activateSignal(v)}getClassName(){return JX.ClassName}}JX.ClassName="FGSendCustomEventBlock",(0,G.f)("FGSendCustomEventBlock",JX);class yX extends DX{constructor(v){super(v),this.config=v;for(let T=0;T<this.config.eventData.length;T++){const v=this.config.eventData[T];this.registerDataOutput(v,YT)}}_preparePendingTasks(v){const T=v.configuration.coordinator.getCustomEventObservable(this.config.eventId);this._eventObserver=T.add((T=>{for(let X=0;X<T.length;X++)this.dataOutputs[X].setValue(T[X],v);this._execute(v)}))}_cancelPendingTasks(v){const T=v.configuration.coordinator.getCustomEventObservable(this.config.eventId);T?T.remove(this._eventObserver):m.c.Warn(`FlowGraphReceiveCustomEventBlock: Missing observable for event ${this.config.eventId}`)}getClassName(){return yX.ClassName}serialize(v){super.serialize(v),v.eventId=this.config.eventId,v.eventData=this.config.eventData}}yX.ClassName="FGReceiveCustomEventBlock",(0,G.f)(yX.ClassName,yX);class PX extends nX{constructor(v){super(v),this.config=v,this.outFlows=[];for(let T=0;T<this.config.numberOutputFlows;T++)this.outFlows.push(this._registerSignalOutput(`${T}`))}_execute(v){for(let T=0;T<this.config.numberOutputFlows;T++)this.outFlows[T]._activateSignal(v)}getClassName(){return PX.ClassName}}PX.ClassName="FGSequenceBlock",(0,G.f)(PX.ClassName,PX);const aX=new RegExp(/\{(\w+)\}/g);class EX{constructor(v,T){this.path=v,this.ownerBlock=T,this.templatedInputs=[];let X=aX.exec(v);for(;X;){const[,O]=X;this.templatedInputs.push(T.registerDataInput(O,uX)),X=aX.exec(v)}}getAccessor(v,T){let X=this.path;for(const O of this.templatedInputs){const v=O.getValue(T).value;X=X.replace(`{${O.name}}`,v.toString())}return v.convert(X)}}class iX extends MX{constructor(v){super(v),this.config=v,this.value=this.registerDataOutput("value",YT),this.templateComponent=new EX(v.path,this)}_updateOutputs(v){const T=this.templateComponent.getAccessor(this.config.pathConverter,v),X=T.info.get(T.object);this.value.setValue(X,v)}getClassName(){return iX.ClassName}serialize(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(v),v.config.path=this.config.path}}iX.ClassName="FGGetPropertyBlock",(0,G.f)(iX.ClassName,iX);class tX extends rX{constructor(v){super(v),this.config=v,this.a=this.registerDataInput("a",YT),this.templateComponent=new EX(v.path,this)}_execute(v){const T=this.a.getValue(v),X=this.templateComponent.getAccessor(this.config.pathConverter,v);X.info.set(T,X.object),this.out._activateSignal(v)}serialize(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(v),v.config.path=this.config.path}getClassName(){return tX.ClassName}}tX.ClassName="FGSetPropertyBlock",(0,G.f)("FGSetPropertyBlock",tX);const CX="cachedOperationValue",cX="cachedExecutionId";class NX extends MX{constructor(v,T){super(T),this.value=this.registerDataOutput("value",v)}_updateOutputs(v){const T=v._getExecutionVariable(this,cX),X=v._getExecutionVariable(this,CX);if(void 0!==X&&T===v.executionId)this.value.setValue(X,v);else{const T=this._doOperation(v);v._setExecutionVariable(this,CX,T),v._setExecutionVariable(this,cX,v.executionId),this.value.setValue(T,v)}}}class dX extends NX{constructor(v,T,X,O,u,B){super(X,B),this._operation=O,this._className=u,this.a=this.registerDataInput("a",v),this.b=this.registerDataInput("b",T)}_doOperation(v){return this._operation(this.a.getValue(v),this.b.getValue(v))}getClassName(){return this._className}}class IX extends NX{constructor(v,T,X,O){super(v,O),this._operation=T,this._className=X}_doOperation(v){return this._operation()}getClassName(){return this._className}}class WX extends NX{constructor(v,T,X,O,u){super(T,u),this._operation=X,this._className=O,this.a=this.registerDataInput("a",v)}_doOperation(v){return this._operation(this.a.getValue(v))}getClassName(){return this._className}}class gX extends NX{constructor(v,T,X,O,u,B,m){super(O,m),this._operation=u,this._className=B,this.a=this.registerDataInput("a",v),this.b=this.registerDataInput("b",T),this.c=this.registerDataInput("c",X)}_doOperation(v){return this._operation(this.a.getValue(v),this.b.getValue(v),this.c.getValue(v))}getClassName(){return this._className}}function jX(v){return v.getClassName?v.getClassName():""}function eX(v,T){return"Vector2"===v&&"Vector2"===T||"Vd"===v&&"Vd"===T||"Vector4"===v&&"Vector4"===T}function hX(v,T){return"Matrix"===v&&"Matrix"===T}function SX(v,T){return"FlowGraphInteger"===v&&"FlowGraphInteger"===T}class wX extends dX{constructor(v){super(YT,YT,YT,((v,T)=>this._polymorphicAdd(v,T)),wX.ClassName,v)}_polymorphicAdd(v,T){const X=jX(v),O=jX(T);return eX(X,O)||hX(X,O)||SX(X,O)?v.add(T):v+T}}wX.ClassName="FGAddBlock",(0,G.f)(wX.ClassName,wX);class zX extends dX{constructor(v){super(YT,YT,YT,((v,T)=>this._polymorphicAdd(v,T)),zX.ClassName,v)}_polymorphicAdd(v,T){const X=jX(v),O=jX(T);return eX(X,O)||SX(X,O)?v.Xc(T):hX(X,O)?v.add(T.scale(-1)):v-T}}zX.ClassName="FGSubBlock",(0,G.f)(zX.ClassName,zX);class RX extends dX{constructor(v){super(YT,YT,YT,((v,T)=>this._polymorphicMultiply(v,T)),RX.ClassName,v)}_polymorphicMultiply(v,T){const X=jX(v),O=jX(T);return eX(X,O)||SX(X,O)?v.multiply(T):hX(X,O)?u.b.FromValues(v.m[0]*T.m[0],v.m[4]*T.m[4],v.m[8]*T.m[8],v.m[12]*T.m[12],v.m[1]*T.m[1],v.m[5]*T.m[5],v.m[9]*T.m[9],v.m[13]*T.m[13],v.m[2]*T.m[2],v.m[6]*T.m[6],v.m[10]*T.m[10],v.m[14]*T.m[14],v.m[3]*T.m[3],v.m[7]*T.m[7],v.m[11]*T.m[11],v.m[15]*T.m[15]):v*T}}RX.ClassName="FGMultiplyBlock",(0,G.f)(RX.ClassName,RX);class YX extends dX{constructor(v){super(YT,YT,YT,((v,T)=>this._polymorphicDivide(v,T)),YX.ClassName,v)}_polymorphicDivide(v,T){const X=jX(v),O=jX(T);return eX(X,O)||SX(X,O)?v.divide(T):hX(X,O)?u.b.FromValues(v.m[0]/T.m[0],v.m[4]/T.m[4],v.m[8]/T.m[8],v.m[12]/T.m[12],v.m[1]/T.m[1],v.m[5]/T.m[5],v.m[9]/T.m[9],v.m[13]/T.m[13],v.m[2]/T.m[2],v.m[6]/T.m[6],v.m[10]/T.m[10],v.m[14]/T.m[14],v.m[3]/T.m[3],v.m[7]/T.m[7],v.m[11]/T.m[11],v.m[15]/T.m[15]):v/T}}YX.ClassName="FGDivideBlock",(0,G.f)(YX.ClassName,YX);class qX extends IX{constructor(v){super(qT,(()=>Math.random()),qX.ClassName,v)}}qX.ClassName="FGRandomBlock",(0,G.f)(qX.ClassName,qX);class vO extends dX{constructor(v){super(YT,YT,qT,((v,T)=>this._polymorphicDot(v,T)),vO.ClassName,v)}_polymorphicDot(v,T){switch(jX(v)){case"Vector2":return u.i.Dot(v,T);case"Vd":return u.l.Dot(v,T);case"Vector4":return u.o.Dot(v,T);default:throw new Error(`Cannot get dot product of ${v} and ${T}`)}}}vO.ClassName="FGDotBlock",(0,G.f)(vO.ClassName,vO);class TO extends IX{constructor(v){super(qT,(()=>Math.E),TO.ClassName,v)}}TO.ClassName="FGEBlock",(0,G.f)(TO.ClassName,TO);class XO extends IX{constructor(v){super(qT,(()=>Math.PI),XO.ClassName,v)}}XO.ClassName="FGPIBlock",(0,G.f)(XO.ClassName,XO);class OO extends IX{constructor(v){super(qT,(()=>Number.POSITIVE_INFINITY),OO.ClassName,v)}}OO.ClassName="FGInfBlock",(0,G.f)(OO.ClassName,OO);class uO extends IX{constructor(v){super(qT,(()=>Number.NaN),uO.ClassName,v)}}function BO(v,T){switch(jX(v)){case"FlowGraphInteger":return new zT(T(v.value));case"Vector2":return new u.i(T(v.x),T(v.y));case"Vd":return new u.l(T(v.x),T(v.y),T(v.z));case"Vector4":return new u.o(T(v.x),T(v.y),T(v.z),T(v.w));case"Matrix":return u.b.FromValues(T(v.m[0]),T(v.m[4]),T(v.m[8]),T(v.m[12]),T(v.m[1]),T(v.m[5]),T(v.m[9]),T(v.m[13]),T(v.m[2]),T(v.m[6]),T(v.m[10]),T(v.m[14]),T(v.m[3]),T(v.m[7]),T(v.m[11]),T(v.m[15]));default:return T(v)}}uO.ClassName="FGNaNBlock",(0,G.f)(uO.ClassName,uO);class mO extends WX{constructor(v){super(YT,YT,(v=>this._polymorphicAbs(v)),mO.ClassName,v)}_polymorphicAbs(v){return BO(v,Math.abs)}}mO.ClassName="FGAbsBlock",(0,G.f)(mO.ClassName,mO);class AO extends WX{constructor(v){super(YT,YT,(v=>this._polymorphicSign(v)),AO.ClassName,v)}_polymorphicSign(v){return BO(v,Math.sign)}}AO.ClassName="FGSignBlock",(0,G.f)(AO.ClassName,AO);class xO extends WX{constructor(v){super(YT,YT,(v=>this._polymorphicTrunc(v)),xO.ClassName,v)}_polymorphicTrunc(v){return BO(v,Math.trunc)}}xO.ClassName="FGTruncBlock",(0,G.f)(xO.ClassName,xO);class fO extends WX{constructor(v){super(YT,YT,(v=>this._polymorphicFloor(v)),fO.ClassName,v)}_polymorphicFloor(v){return BO(v,Math.floor)}}fO.ClassName="FGFloorBlock",(0,G.f)(fO.ClassName,fO);class MO extends WX{constructor(v){super(YT,YT,(v=>this._polymorphicCeiling(v)),MO.ClassName,v)}_polymorphicCeiling(v){return BO(v,Math.ceil)}}MO.ClassName="FGCeilBlock",(0,G.f)(MO.ClassName,MO);class HO extends WX{constructor(v){super(YT,YT,(v=>this._polymorphicFract(v)),HO.ClassName,v)}_polymorphicFract(v){return BO(v,(v=>v-Math.floor(v)))}}HO.ClassName="FGFractBlock",(0,G.f)(HO.ClassName,HO);class nO extends WX{constructor(v){super(YT,YT,(v=>this._polymorphicNeg(v)),nO.ClassName,v)}_polymorphicNeg(v){return BO(v,(v=>-v))}}function VO(v,T,X){switch(jX(v)){case"FlowGraphInteger":return new zT(X(v.value,T.value));case"Vector2":return new u.i(X(v.x,T.x),X(v.y,T.y));case"Vd":return new u.l(X(v.x,T.x),X(v.y,T.y),X(v.z,T.z));case"Vector4":return new u.o(X(v.x,T.x),X(v.y,T.y),X(v.z,T.z),X(v.w,T.w));case"Matrix":return u.b.FromValues(X(v.m[0],T.m[0]),X(v.m[4],T.m[4]),X(v.m[8],T.m[8]),X(v.m[12],T.m[12]),X(v.m[1],T.m[1]),X(v.m[5],T.m[5]),X(v.m[9],T.m[9]),X(v.m[13],T.m[13]),X(v.m[2],T.m[2]),X(v.m[6],T.m[6]),X(v.m[10],T.m[10]),X(v.m[14],T.m[14]),X(v.m[3],T.m[3]),X(v.m[7],T.m[7]),X(v.m[11],T.m[11]),X(v.m[15],T.m[15]));default:return X(v,T)}}nO.ClassName="FGNegBlock",(0,G.f)(nO.ClassName,nO);class DO extends dX{constructor(v){super(YT,YT,YT,((v,T)=>this._polymorphicRemainder(v,T)),DO.ClassName,v)}_polymorphicRemainder(v,T){return VO(v,T,((v,T)=>v%T))}}DO.ClassName="FGRemainderBlock",(0,G.f)(DO.ClassName,DO);class sO extends dX{constructor(v){super(YT,YT,YT,((v,T)=>this._polymorphicMin(v,T)),sO.ClassName,v)}_polymorphicMin(v,T){return VO(v,T,Math.min)}}sO.ClassName="FGMinBlock",(0,G.f)(sO.ClassName,sO);class FO extends dX{constructor(v){super(YT,YT,YT,((v,T)=>this._polymorphicMax(v,T)),FO.ClassName,v)}_polymorphicMax(v,T){return VO(v,T,Math.max)}}function kO(v,T,X){return Math.min(Math.max(v,Math.min(T,X)),Math.max(T,X))}function bO(v,T,X,O){switch(jX(v)){case"FlowGraphInteger":return new zT(O(v.value,T.value,X.value));case"Vector2":return new u.i(O(v.x,T.x,X.x),O(v.y,T.y,X.y));case"Vd":return new u.l(O(v.x,T.x,X.x),O(v.y,T.y,X.y),O(v.z,T.z,X.z));case"Vector4":return new u.o(O(v.x,T.x,X.x),O(v.y,T.y,X.y),O(v.z,T.z,X.z),O(v.w,T.w,X.w));case"Matrix":return u.b.FromValues(O(v.m[0],T.m[0],X.m[0]),O(v.m[4],T.m[4],X.m[4]),O(v.m[8],T.m[8],X.m[8]),O(v.m[12],T.m[12],X.m[12]),O(v.m[1],T.m[1],X.m[1]),O(v.m[5],T.m[5],X.m[5]),O(v.m[9],T.m[9],X.m[9]),O(v.m[13],T.m[13],X.m[13]),O(v.m[2],T.m[2],X.m[2]),O(v.m[6],T.m[6],X.m[6]),O(v.m[10],T.m[10],X.m[10]),O(v.m[14],T.m[14],X.m[14]),O(v.m[3],T.m[3],X.m[3]),O(v.m[7],T.m[7],X.m[7]),O(v.m[11],T.m[11],X.m[11]),O(v.m[15],T.m[15],X.m[15]));default:return O(v,T,X)}}FO.ClassName="FGMaxBlock",(0,G.f)(FO.ClassName,FO);class lO extends gX{constructor(v){super(YT,YT,YT,YT,((v,T,X)=>this._polymorphicClamp(v,T,X)),lO.ClassName,v)}_polymorphicClamp(v,T,X){return bO(v,T,X,kO)}}function QO(v){return Math.min(Math.max(v,0),1)}lO.ClassName="FGClampBlock",(0,G.f)(lO.ClassName,lO);class KO extends WX{constructor(v){super(YT,YT,(v=>this._polymorphicSaturate(v)),KO.ClassName,v)}_polymorphicSaturate(v){return BO(v,QO)}}KO.ClassName="FGSaturateBlock",(0,G.f)(KO.ClassName,KO);class pO extends gX{constructor(v){super(YT,YT,YT,YT,((v,T,X)=>this._polymorphicInterpolate(v,T,X)),pO.ClassName,v)}_interpolate(v,T,X){return(1-X)*v+X*T}_polymorphicInterpolate(v,T,X){return bO(v,T,X,this._interpolate)}}pO.ClassName="FGInterpolateBlock",(0,G.f)(pO.ClassName,pO);class GO extends dX{constructor(v){super(YT,YT,vX,((v,T)=>this._polymorphicEq(v,T)),GO.ClassName,v)}_polymorphicEq(v,T){const X=jX(v),O=jX(T);return eX(X,O)||hX(X,O)||SX(X,O)?v.equals(T):v===T}}function LO(v,T,X){const O=jX(v);if(O===jX(T)){if(""===O)return X(v,T);if("FlowGraphInteger"===O)return X(v.value,T.value);throw new Error(`Cannot compare ${v} and ${T}`)}throw new Error(`${v} and ${T} are of different types.`)}GO.ClassName="FGEqBlock",(0,G.f)(GO.ClassName,GO);class rO extends dX{constructor(v){super(YT,YT,vX,((v,T)=>this._polymorphicLessThan(v,T)),rO.ClassName,v)}_polymorphicLessThan(v,T){return LO(v,T,((v,T)=>v<T))}}rO.ClassName="FGLessThanBlock",(0,G.f)(rO.ClassName,rO);class oO extends dX{constructor(v){super(YT,YT,vX,((v,T)=>this._polymorphicLessThanOrEqual(v,T)),oO.ClassName,v)}_polymorphicLessThanOrEqual(v,T){return LO(v,T,((v,T)=>v<=T))}}oO.ClassName="FGLessThanOrEqualBlock";class ZO extends dX{constructor(v){super(YT,YT,vX,((v,T)=>this._polymorphicGreaterThan(v,T)),ZO.ClassName,v)}_polymorphicGreaterThan(v,T){return LO(v,T,((v,T)=>v>T))}}ZO.ClassName="FGGreaterThanBlock",(0,G.f)(ZO.ClassName,ZO);class UO extends dX{constructor(v){super(YT,YT,vX,((v,T)=>this._polymorphicGreaterThanOrEqual(v,T)),UO.ClassName,v)}_polymorphicGreaterThanOrEqual(v,T){return LO(v,T,((v,T)=>v>=T))}}UO.ClassName="FGGreaterThanOrEqualBlock",(0,G.f)(UO.ClassName,UO);class JO extends WX{constructor(v){super(YT,vX,(v=>this._polymorphicIsNan(v)),JO.ClassName,v)}_polymorphicIsNan(v){const T=jX(v);if(""===T)return isNaN(v);if("FlowGraphInteger"===T)return isNaN(v.value);throw new Error(`Cannot get NaN of ${v}`)}}JO.ClassName="FGIsNanBlock",(0,G.f)(JO.ClassName,JO);class yO extends WX{constructor(v){super(YT,vX,(v=>this._polymorphicIsInf(v)),yO.ClassName,v)}_polymorphicIsInf(v){const T=jX(v);if(""===T)return!isFinite(v);if("FlowGraphInteger"===T)return!isFinite(v.value);throw new Error(`Cannot get isInf of ${v}`)}}yO.ClassName="FGIsInfBlock";class PO extends WX{constructor(v){super(YT,YT,(v=>this._polymorphicDegToRad(v)),PO.ClassName,v)}_degToRad(v){return v*Math.PI/180}_polymorphicDegToRad(v){return BO(v,this._degToRad)}}PO.ClassName="FGDegToRadBlock",(0,G.f)(PO.ClassName,PO);class aO extends WX{constructor(v){super(YT,YT,(v=>this._polymorphicRadToDeg(v)),aO.ClassName,v)}_radToDeg(v){return 180*v/Math.PI}_polymorphicRadToDeg(v){return BO(v,this._radToDeg)}}aO.ClassName="FGRadToDegBlock",(0,G.f)(aO.ClassName,aO);class EO extends WX{constructor(v){super(YT,YT,(v=>this._polymorphicSin(v)),EO.ClassName,v)}_polymorphicSin(v){return BO(v,Math.sin)}}EO.ClassName="FGSinBlock",(0,G.f)(EO.ClassName,EO);class iO extends WX{constructor(v){super(YT,YT,(v=>this._polymorphicCos(v)),iO.ClassName,v)}_polymorphicCos(v){return BO(v,Math.cos)}}iO.ClassName="FGCosBlock",(0,G.f)(iO.ClassName,iO);class tO extends WX{constructor(v){super(YT,YT,(v=>this._polymorphicTan(v)),tO.ClassName,v)}_polymorphicTan(v){return BO(v,Math.tan)}}tO.ClassName="FGTanBlock",(0,G.f)(tO.ClassName,tO);class CO extends WX{constructor(v){super(YT,YT,(v=>this._polymorphicAsin(v)),CO.ClassName,v)}_polymorphicAsin(v){return BO(v,Math.asin)}}CO.ClassName="FGAsinBlock",(0,G.f)(CO.ClassName,CO);class cO extends WX{constructor(v){super(YT,YT,(v=>this._polymorphicAcos(v)),cO.ClassName,v)}_polymorphicAcos(v){return BO(v,Math.acos)}}cO.ClassName="FGAcosBlock",(0,G.f)(cO.ClassName,cO);class NO extends WX{constructor(v){super(YT,YT,(v=>this._polymorphicAtan(v)),NO.ClassName,v)}_polymorphicAtan(v){return BO(v,Math.atan)}}NO.ClassName="FGAtanBlock",(0,G.f)(NO.ClassName,NO);class dO extends dX{constructor(v){super(YT,YT,YT,((v,T)=>this._polymorphicAtan2(v,T)),dO.ClassName,v)}_polymorphicAtan2(v,T){return VO(v,T,Math.atan2)}}dO.ClassName="FGAtan2Block",(0,G.f)(dO.ClassName,dO);class IO extends WX{constructor(v){super(YT,YT,(v=>this._polymorphicSinh(v)),IO.ClassName,v)}_polymorphicSinh(v){return BO(v,Math.sinh)}}IO.ClassName="FGSinhBlock",(0,G.f)(IO.ClassName,IO);class WO extends WX{constructor(v){super(YT,YT,(v=>this._polymorphicCosh(v)),WO.ClassName,v)}_polymorphicCosh(v){return BO(v,Math.cosh)}}WO.ClassName="FGCoshBlock",(0,G.f)(WO.ClassName,WO);class gO extends WX{constructor(v){super(YT,YT,(v=>this._polymorphicTanh(v)),gO.ClassName,v)}_polymorphicTanh(v){return BO(v,Math.tanh)}}gO.ClassName="FGTanhBlock",(0,G.f)(gO.ClassName,gO);class jO extends WX{constructor(v){super(YT,qT,(v=>this._polymorphicAsinh(v)),jO.ClassName,v)}_polymorphicAsinh(v){return BO(v,Math.asinh)}}jO.ClassName="FGAsinhBlock",(0,G.f)(jO.ClassName,jO);class eO extends WX{constructor(v){super(YT,qT,(v=>this._polymorphicAcosh(v)),eO.ClassName,v)}_polymorphicAcosh(v){return BO(v,Math.acosh)}}eO.ClassName="FGAcoshBlock",(0,G.f)(eO.ClassName,eO);class hO extends WX{constructor(v){super(YT,qT,(v=>this._polymorphicAtanh(v)),hO.ClassName,v)}_polymorphicAtanh(v){return BO(v,Math.atanh)}}hO.ClassName="FGAtanhBlock",(0,G.f)(hO.ClassName,hO);class SO extends WX{constructor(v){super(YT,qT,(v=>this._polymorphicExp(v)),SO.ClassName,v)}_polymorphicExp(v){return BO(v,Math.exp)}}SO.ClassName="FGExpBlock",(0,G.f)(SO.ClassName,SO);class wO extends WX{constructor(v){super(YT,qT,(v=>this._polymorphicLog(v)),wO.ClassName,v)}_polymorphicLog(v){return BO(v,Math.log)}}wO.ClassName="FGLogBlock",(0,G.f)(wO.ClassName,wO);class zO extends WX{constructor(v){super(YT,qT,(v=>this._polymorphicLog2(v)),zO.ClassName,v)}_polymorphicLog2(v){return BO(v,Math.log2)}}zO.ClassName="FGLog2Block",(0,G.f)(zO.ClassName,zO);class RO extends WX{constructor(v){super(YT,qT,(v=>this._polymorphicLog10(v)),RO.ClassName,v)}_polymorphicLog10(v){return BO(v,Math.log10)}}RO.ClassName="FGLog10Block",(0,G.f)(RO.ClassName,RO);class YO extends WX{constructor(v){super(YT,qT,(v=>this._polymorphicSqrt(v)),YO.ClassName,v)}_polymorphicSqrt(v){return BO(v,Math.sqrt)}}YO.ClassName="FGSqrtBlock",(0,G.f)(YO.ClassName,YO);class qO extends WX{constructor(v){super(YT,qT,(v=>this._polymorphicCubeRoot(v)),qO.ClassName,v)}_polymorphicCubeRoot(v){return BO(v,Math.cbrt)}}qO.ClassName="FGCubeRootBlock",(0,G.f)(qO.ClassName,qO);class vu extends dX{constructor(v){super(YT,qT,qT,((v,T)=>this._polymorphicPow(v,T)),vu.ClassName,v)}_polymorphicPow(v,T){return VO(v,T,Math.pow)}}vu.ClassName="FGPowBlock",(0,G.f)(vu.ClassName,vu);class Tu extends WX{constructor(v){super(YT,qT,(v=>this._polymorphicLength(v)),Tu.ClassName,v)}_polymorphicLength(v){switch(jX(v)){case"Vector2":case"Vd":case"Vector4":return v.length();default:throw new Error(`Cannot compute length of value ${v}`)}}}Tu.ClassName="FGLengthBlock",(0,G.f)(Tu.ClassName,Tu);class Xu extends WX{constructor(v){super(YT,YT,(v=>this._polymorphicNormalize(v)),Xu.ClassName,v)}_polymorphicNormalize(v){switch(jX(v)){case"Vector2":case"Vd":case"Vector4":return v.normalize();default:throw new Error(`Cannot normalize value ${v}`)}}}Xu.ClassName="FGNormalizeBlock",(0,G.f)(Xu.ClassName,Xu);class Ou extends dX{constructor(v){super(XX,XX,XX,((v,T)=>u.l.Cross(v,T)),Ou.ClassName,v)}}Ou.ClassName="FGCrossBlock",(0,G.f)(Ou.ClassName,Ou);class uu extends dX{constructor(v){super(TX,qT,TX,((v,T)=>u.i.Transform(v,u.b.RotationZ(T))),uu.ClassName,v)}}uu.ClassName="FGRotate2DBlock",(0,G.f)(uu.ClassName,uu);class Bu extends gX{constructor(v){super(XX,XX,qT,XX,((v,T,X)=>u.l.TransformCoordinates(v,u.b.RotationAxis(T,X))),Bu.ClassName,v)}}Bu.ClassName="FGRotate3DBlock",(0,G.f)(Bu.ClassName,Bu);class mu extends WX{constructor(v){super(OX,OX,(v=>u.b.Transpose(v)),mu.ClassName,v)}}mu.ClassName="FGTransposeBlock",(0,G.f)(mu.ClassName,mu);class Au extends WX{constructor(v){super(OX,qT,(v=>v.determinant()),Au.ClassName,v)}}Au.ClassName="FGDeterminantBlock",(0,G.f)(Au.ClassName,Au);class xu extends WX{constructor(v){super(OX,OX,(v=>u.b.Invert(v)),xu.ClassName,v)}}xu.ClassName="FGInvertMatrixBlock",(0,G.f)(xu.ClassName,xu);class fu extends dX{constructor(v){super(OX,OX,OX,((v,T)=>T.multiply(v)),fu.ClassName,v)}}fu.ClassName="FGMatMulBlock",(0,G.f)(fu.ClassName,fu);class Mu extends WX{constructor(v){super(uX,uX,(v=>new zT(~v.value)),Mu.ClassName,v)}}Mu.ClassName="FGBitwiseNotBlock",(0,G.f)(Mu.ClassName,Mu);class Hu extends dX{constructor(v){super(uX,uX,uX,((v,T)=>new zT(v.value&T.value)),Hu.ClassName,v)}}Hu.ClassName="FGBitwiseAndBlock",(0,G.f)(Hu.ClassName,Hu);class nu extends dX{constructor(v){super(uX,uX,uX,((v,T)=>new zT(v.value|T.value)),nu.ClassName,v)}}nu.ClassName="FGBitwiseOrBlock",(0,G.f)(nu.ClassName,nu);class Vu extends dX{constructor(v){super(uX,uX,uX,((v,T)=>new zT(v.value^T.value)),Vu.ClassName,v)}}Vu.ClassName="FGBitwiseXorBlock",(0,G.f)(Vu.ClassName,Vu);class Du extends dX{constructor(v){super(uX,uX,uX,((v,T)=>new zT(v.value<<T.value)),Du.ClassName,v)}}Du.ClassName="FGBitwiseLeftShiftBlock",(0,G.f)(Du.ClassName,Du);class su extends dX{constructor(v){super(uX,uX,uX,((v,T)=>new zT(v.value>>T.value)),su.ClassName,v)}}su.ClassName="FGBitwiseRightShiftBlock",(0,G.f)(su.ClassName,su);class Fu extends WX{constructor(v){super(uX,uX,(v=>new zT(Math.clz32(v.value))),Fu.ClassName,v)}}Fu.ClassName="FGCountLeadingZerosBlock",(0,G.f)(Fu.ClassName,Fu);class ku extends WX{constructor(v){super(uX,uX,(v=>new zT(v.value?31-Math.clz32(v.value&-v.value):32)),ku.ClassName,v)}}ku.ClassName="FGCountTrailingZerosBlock",(0,G.f)(ku.ClassName,ku);class bu extends WX{constructor(v){super(uX,uX,(v=>new zT(function(v){let T=0;for(;v;)T+=1&v,v>>=1;return T}(v.value))),bu.ClassName,v)}}bu.ClassName="FGCountOneBitsBlock",(0,G.f)(bu.ClassName,bu);class lu extends rX{constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{startIndex:new zT(0)};super(v),this.config=v,this.reset=this._registerSignalInput("reset"),this.n=this.registerDataInput("n",uX),this.value=this.registerDataOutput("value",uX)}_execute(v,T){if(T===this.reset)this.value.setValue(this.config.startIndex,v);else{const T=this.value.getValue(v);T.value<this.n.getValue(v).value&&(this.value.setValue(new zT(T.value+1),v),this.out._activateSignal(v))}}getClassName(){return lu.ClassName}}lu.ClassName="FGDoNBlock",(0,G.f)(lu.ClassName,lu);class Qu extends MX{constructor(v){super(v),this.config=v,this.output=this.registerDataOutput(v.variableName,YT)}_updateOutputs(v){const T=this.config.variableName;v.hasVariable(T)&&this.output.setValue(v.getVariable(T),v)}getClassName(){return Qu.ClassName}serialize(v){super.serialize(v),v.config.variableName=this.config.variableName}}Qu.ClassName="FGGetVariableBlock",(0,G.f)(Qu.ClassName,Qu);class Ku extends rX{constructor(v){super(v),this.config=v,this.input=this.registerDataInput(v.variableName,YT)}_execute(v){const T=this.config.variableName,X=this.input.getValue(v);v.setVariable(T,X),this.out._activateSignal(v)}getClassName(){return Ku.ClassName}}Ku.ClassName="FGSetVariableBlock",(0,G.f)(Ku.ClassName,Ku);class pu extends rX{constructor(v){super(v),this.config=v,this.condition=this.registerDataInput("condition",vX),this.loopBody=this._registerSignalOutput("loopBody")}_execute(v,T){var X;let O=this.condition.getValue(v);for(null!==(X=this.config)&&void 0!==X&&X.isDo&&!O&&this.loopBody._activateSignal(v);O;)this.loopBody._activateSignal(v),O=this.condition.getValue(v);this.out._activateSignal(v)}getClassName(){return pu.ClassName}serialize(v){var T;super.serialize(v),v.isDo=null===(T=this.config)||void 0===T?void 0:T.isDo}}pu.ClassName="FGWhileLoopBlock",(0,G.f)(pu.ClassName,pu);const Gu={"lifecycle/onStart":GX.ClassName,"lifecycle/onTick":LX.ClassName,log:oX.ClassName,"flow/delay":UX.ClassName,"customEvent/send":JX.ClassName,"customEvent/receive":yX.ClassName,"flow/sequence":PX.ClassName,"world/get":iX.ClassName,"world/set":tX.ClassName,"flow/doN":lu.ClassName,"variable/get":Qu.ClassName,"variable/set":Ku.ClassName,"flow/whileLoop":pu.ClassName,"math/random":qX.ClassName,"math/e":TO.ClassName,"math/pi":XO.ClassName,"math/inf":OO.ClassName,"math/nan":uO.ClassName,"math/abs":mO.ClassName,"math/sign":AO.ClassName,"math/trunc":xO.ClassName,"math/floor":fO.ClassName,"math/ceil":MO.ClassName,"math/fract":HO.ClassName,"math/neg":nO.ClassName,"math/add":wX.ClassName,"math/sub":zX.ClassName,"math/mul":RX.ClassName,"math/div":YX.ClassName,"math/rem":DO.ClassName,"math/min":sO.ClassName,"math/max":FO.ClassName,"math/clamp":lO.ClassName,"math/saturate":KO.ClassName,"math/mix":pO.ClassName,"math/eq":GO.ClassName,"math/lt":rO.ClassName,"math/le":oO.ClassName,"math/gt":ZO.ClassName,"math/ge":UO.ClassName,"math/isnan":JO.ClassName,"math/isinf":yO.ClassName,"math/rad":PO.ClassName,"math/deg":aO.ClassName,"math/sin":EO.ClassName,"math/cos":iO.ClassName,"math/tan":tO.ClassName,"math/asin":CO.ClassName,"math/acos":cO.ClassName,"math/atan":NO.ClassName,"math/atan2":dO.ClassName,"math/sinh":IO.ClassName,"math/cosh":WO.ClassName,"math/tanh":gO.ClassName,"math/asinh":jO.ClassName,"math/acosh":eO.ClassName,"math/atanh":hO.ClassName,"math/exp":SO.ClassName,"math/log":wO.ClassName,"math/log2":zO.ClassName,"math/log10":RO.ClassName,"math/sqrt":YO.ClassName,"math/cbrt":qO.ClassName,"math/pow":vu.ClassName,"math/length":Tu.ClassName,"math/normalize":Xu.ClassName,"math/dot":vO.ClassName,"math/cross":Ou.ClassName,"math/rotate2d":uu.ClassName,"math/rotate3d":Bu.ClassName,"math/transpose":mu.ClassName,"math/determinant":Au.ClassName,"math/inverse":xu.ClassName,"math/matmul":fu.ClassName,"math/not":Mu.ClassName,"math/and":Hu.ClassName,"math/or":nu.ClassName,"math/xor":Vu.ClassName,"math/asr":su.ClassName,"math/lsl":Du.ClassName,"math/clz":Fu.ClassName,"math/ctz":ku.ClassName,"math/popcnt":bu.ClassName},Lu={float2:"Vector2",float3:"Vd",float4:"Vector4",float4x4:"Matrix",int:"FlowGraphInteger"};function ru(v,T,X){if(void 0!==v.type){const O=T.types&&T.types[v.type];if(!O)throw new Error(`${X}: Unknown type: ${v.type}`);const u=O.signature;if(!u)throw new Error(`${X}: Type ${v.type} has no signature`);const B=Lu[u];return{value:v.value,className:B}}return v.value}function ou(v,T,X){const O=Gu[T.type];if(!O)throw new Error(`/extensions/KHR_interactivity/nodes/${v}: Unknown block type: ${T.type}`);const u=v.toString(),B=function(v,T,X){const O={},u=v.configuration??[];for(const B of u)if("customEvent"===B.id){const v=T.customEvents&&T.customEvents[B.value];if(!v)throw new Error(`/extensions/KHR_interactivity/nodes/${X}: Unknown custom event: ${B.value}`);O.eventId=v.id,O.eventData=v.values.map((v=>v.id))}else if("variable"===B.id){const v=T.variables&&T.variables[B.value];if(!v)throw new Error(`/extensions/KHR_interactivity/nodes/${X}: Unknown variable: ${B.value}`);O.variableName=v.id}else if("path"===B.id){const v=B.value;O.path=v}else O[B.id]=ru(B,T,`/extensions/KHR_interactivity/nodes/${X}`);return O}(T,X,u);return{className:O,config:B,uniqueId:u,metadata:T.metadata,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[]}}class Zu extends GT{constructor(v){super(v,Ju)}}const Uu={__array__:{__target__:!0,translation:{type:"Vd",get:v=>v._babylonTransformNode.position,set:(v,T)=>{T._babylonTransformNode.position=v},getObject:v=>v._babylonTransformNode}}},Ju={nodes:Uu},yu="KHR_interactivity";class Pu{constructor(v){this._loader=v,this.name=yu,this.enabled=this._loader.isExtensionUsed(yu),this._pathConverter=new Zu(this._loader.cj)}dispose(){this._loader=null,delete this._pathConverter}onReady(){var v;if(!this._loader.babylonScene||!this._pathConverter)return;const T=this._loader.babylonScene,X=function(v){const T={uniqueId:(0,ST.c)(),_userVariables:{},_connectionValues:{}},X=[T],O=[];for(let B=0;B<v.nodes.length;B++){const T=ou(B,v.nodes[B],v);O.push(T)}for(let B=0;B<v.nodes.length;B++){const X=v.nodes[B],u=O[B],m=X.flows??[];for(const v of m){const T=v.id,X={uniqueId:(0,ST.c)(),name:T,_connectionType:1,connectedPointIds:[]};u.signalOutputs.push(X);const m=v.node,A=v.socket,x=O[m];if(!x)throw new Error(`/extensions/KHR_interactivity/nodes/${B}: Could not find node with id ${m} that connects its input with with node ${B}'s output ${T}`);let f=x.signalInputs.find((v=>v.name===A));f||(f={uniqueId:(0,ST.c)(),name:A,_connectionType:0,connectedPointIds:[]},x.signalInputs.push(f)),f.connectedPointIds.push(X.uniqueId),X.connectedPointIds.push(f.uniqueId)}const A=X.values??[];for(const x of A){const X=x.id,m={uniqueId:(0,ST.c)(),name:X,_connectionType:0,connectedPointIds:[]};if(u.dataInputs.push(m),void 0!==x.value){const X=ru(x,v,`/extensions/KHR_interactivity/nodes/${B}`);T._connectionValues[m.uniqueId]=X}else{if(void 0===x.node||void 0===x.socket)throw new Error(`/extensions/KHR_interactivity/nodes/${B}: Invalid socket ${X} in node ${B}`);{const v=x.node,T=x.socket,u=O[v];if(!u)throw new Error(`/extensions/KHR_interactivity/nodes/${B}: Could not find node with id ${v} that connects its output with node${B}'s input ${X}`);let A=u.dataOutputs.find((v=>v.name===T));A||(A={uniqueId:(0,ST.c)(),name:T,_connectionType:1,connectedPointIds:[]},u.dataOutputs.push(A)),m.connectedPointIds.push(A.uniqueId),A.connectedPointIds.push(m.uniqueId)}}}}const u=v.variables??[];for(let B=0;B<u.length;B++){const X=u[B],O=X.id;T._userVariables[O]=ru(X,v,`/extensions/KHR_interactivity/variables/${B}`)}return{allBlocks:O,executionContexts:X}}(null===(v=this._loader.cj.extensions)||void 0===v?void 0:v.KHR_interactivity),O=new pX({Fe:T});KX.Parse(X,{coordinator:O,pathConverter:this._pathConverter}),O.start()}}S(yu),h(yu,!0,(v=>new Pu(v)));const au="KHR_node_visibility";class Eu{constructor(v){this.name=au,this._loader=v,this.enabled=v.isExtensionUsed(au)}async onReady(){var v;null===(v=this._loader.cj.nodes)||void 0===v||v.forEach((v=>{var T,X,O,u;(null===(T=v._primitiveBabylonMeshes)||void 0===T||T.forEach((v=>{v.inheritVisibility=!0})),null!==(X=v.extensions)&&void 0!==X&&X.KHR_node_visibility)&&(!1===(null===(O=v.extensions)||void 0===O?void 0:O.KHR_node_visibility.visible)&&(v._babylonTransformNode&&(v._babylonTransformNode.isVisible=!1),null===(u=v._primitiveBabylonMeshes)||void 0===u||u.forEach((v=>{v.isVisible=!1}))))}))}dispose(){this._loader=null}}S(au),h(au,!0,(v=>new Eu(v)));const iu="ExtrasAsMetadata";class tu{_assignExtras(v,T){if(T.extras&&Object.keys(T.extras).length>0){const X=v.metadata=v.metadata||{};(X.cj=X.cj||{}).extras=T.extras}}constructor(v){this.name=iu,this.enabled=!0,this._loader=v}dispose(){this._loader=null}loadNodeAsync(v,T,X){return this._loader.loadNodeAsync(v,T,(v=>{this._assignExtras(v,T),X(v)}))}loadCameraAsync(v,T,X){return this._loader.loadCameraAsync(v,T,(v=>{this._assignExtras(v,T),X(v)}))}createMaterial(v,T,X){const O=this._loader.createMaterial(v,T,X);return this._assignExtras(O,T),O}}S(iu),h(iu,!1,(v=>new tu(v)))},12555:(v,T,X)=>{"use strict";X.d(T,{c:()=>y,e:()=>L,h:()=>G,i:()=>r});var O=X(1001),u=X(1217),B=X(12032),m=X(11911),A=X(11955),x=X(11951),f=X(1103),M=X(1034),H=X(12563),n=X(12571),V=X(11921);class D{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.Ae=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.Be=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(v){this._environmentTexture=v}getNodes(){let v=[];return v=v.concat(this.meshes),v=v.concat(this.lights),v=v.concat(this.cameras),v=v.concat(this.transformNodes),this.skeletons.forEach((T=>v=v.concat(T.bones))),v}}class s extends D{}class F{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){this.rootNodes.slice(0).forEach((v=>{v.dispose()})),this.rootNodes.length=0,this.skeletons.slice(0).forEach((v=>{v.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((v=>{v.dispose()})),this.animationGroups.length=0}}class k extends D{constructor(v){super(),this._wasAddedToScene=!1,(v=v||M.c.LastCreatedScene)&&(this.Fe=v,this.proceduralTextures=[],v.ae.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=v.getEngine().onContextRestoredObservable.add((()=>{for(const v of this.geometries)v._rebuild();for(const v of this.meshes)v._rebuild();for(const v of this.Ae)v.rebuild();for(const v of this.textures)v._rebuild()})))}_topologicalSort(v){const T=new Map;for(const m of v)T.set(m.uniqueId,m);const X={dependsOn:new Map,dependedBy:new Map};for(const m of v){const v=m.uniqueId;X.dependsOn.set(v,new Set),X.dependedBy.set(v,new Set)}for(const m of v){const v=m.uniqueId,O=X.dependsOn.get(v);if(m instanceof H.c){const u=m.sourceMesh;T.has(u.uniqueId)&&(O.add(u.uniqueId),X.dependedBy.get(u.uniqueId).add(v))}const u=X.dependedBy.get(v);for(const B of m.getDescendants()){const O=B.uniqueId;if(T.has(O)){u.add(O);X.dependsOn.get(O).add(v)}}}const O=[],u=[];for(const m of v){const v=m.uniqueId;0===X.dependsOn.get(v).size&&(u.push(m),T.delete(v))}const B=u;for(;B.length>0;){const v=B.shift();O.push(v);const u=X.dependedBy.get(v.uniqueId);for(const O of Array.from(u.values())){const u=X.dependsOn.get(O);u.delete(v.uniqueId),0===u.size&&T.get(O)&&(B.push(T.get(O)),T.delete(O))}}return T.size>0&&(f.d.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),T.forEach((v=>f.d.Error(v.name)))),O}_addNodeAndDescendantsToList(v,T,X,O){if(X&&(!O||O(X))&&!T.has(X.uniqueId)){v.push(X),T.add(X.uniqueId);for(const u of X.getDescendants(!0))this._addNodeAndDescendantsToList(v,T,u,O)}}_isNodeInContainer(v){return v instanceof x.c&&-1!==this.meshes.indexOf(v)||(v instanceof A.c&&-1!==this.transformNodes.indexOf(v)||(v instanceof n.d&&-1!==this.lights.indexOf(v)||v instanceof V.e&&-1!==this.cameras.indexOf(v)))}_isValidHierarchy(){for(const v of this.meshes)if(v.parent&&!this._isNodeInContainer(v.parent))return f.d.Warn(`Node ${v.name} has a parent that is not in the container.`),!1;for(const v of this.transformNodes)if(v.parent&&!this._isNodeInContainer(v.parent))return f.d.Warn(`Node ${v.name} has a parent that is not in the container.`),!1;for(const v of this.lights)if(v.parent&&!this._isNodeInContainer(v.parent))return f.d.Warn(`Node ${v.name} has a parent that is not in the container.`),!1;for(const v of this.cameras)if(v.parent&&!this._isNodeInContainer(v.parent))return f.d.Warn(`Node ${v.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(v){let T=arguments.length>1&&void 0!==arguments[1]&&arguments[1],X=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||u.c.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const O={},B={},A=new F,x=[],f=[],M={doNotInstantiate:!0,...X},H=[],n=new Set;for(const u of this.transformNodes)null===u.parent&&this._addNodeAndDescendantsToList(H,n,u,M.predicate);for(const u of this.meshes)null===u.parent&&this._addNodeAndDescendantsToList(H,n,u,M.predicate);const V=this._topologicalSort(H),D=(X,u)=>{if(((T,X)=>{if(O[T.uniqueId]=X.uniqueId,B[X.uniqueId]=X,v&&(X.name=v(T.name)),X instanceof m.d){const v=X;if(v.morphTargetManager){const X=T.morphTargetManager;v.morphTargetManager=X.clone();for(let T=0;T<X.numTargets;T++){const u=X.getTarget(T),m=v.morphTargetManager.getTarget(T);O[u.uniqueId]=m.uniqueId,B[m.uniqueId]=m}}}})(X,u),X.parent){const v=O[X.parent.uniqueId],T=B[v];u.parent=T||X.parent}if(u.position&&X.position&&u.position.p(X.position),u.rotationQuaternion&&X.rotationQuaternion&&u.rotationQuaternion.p(X.rotationQuaternion),u.rotation&&X.rotation&&u.rotation.p(X.rotation),u.Zd&&X.Zd&&u.Zd.p(X.Zd),u.material){const m=u;if(m.material)if(T){const T=X.material;if(-1===f.indexOf(T)){let X=T.clone(v?v(T.name):"Clone of "+T.name);if(f.push(T),O[T.uniqueId]=X.uniqueId,B[X.uniqueId]=X,"MultiMaterial"===T.getClassName()){const u=T;for(const T of u.Og)T&&(X=T.clone(v?v(T.name):"Clone of "+T.name),f.push(T),O[T.uniqueId]=X.uniqueId,B[X.uniqueId]=X);u.Og=u.Og.map((v=>v&&B[O[v.uniqueId]]))}}"InstancedMesh"!==m.getClassName()&&(m.material=B[O[T.uniqueId]])}else"MultiMaterial"===m.material.getClassName()?-1===this.Fe.multiMaterials.indexOf(m.material)&&this.Fe.addMultiMaterial(m.material):-1===this.Fe.materials.indexOf(m.material)&&this.Fe.addMaterial(m.material)}null===u.parent&&A.rootNodes.push(u)};return V.forEach((v=>{if("InstancedMesh"===v.getClassName()){const T=v,X=T.sourceMesh,u=O[X.uniqueId],m=("number"===typeof u?B[u]:X).Jb(T.name);D(T,m)}else{let T=!0;"nb"===v.getClassName()||"Node"===v.getClassName()||v.skeleton||!v.getTotalVertices||0===v.getTotalVertices()?T=!1:M.doNotInstantiate&&(T="function"===typeof M.doNotInstantiate?!M.doNotInstantiate(v):!M.doNotInstantiate);const X=T?v.Jb(`instance of ${v.name}`):v.clone(`Clone of ${v.name}`,null,!0);if(!X)throw new Error(`Could not clone or instantiate node on Asset Container ${v.name}`);D(v,X)}})),this.skeletons.forEach((T=>{if(M.predicate&&!M.predicate(T))return;const X=T.clone(v?v(T.name):"Clone of "+T.name);for(const v of this.meshes)if(v.skeleton===T&&!v.isAnInstance){const T=B[O[v.uniqueId]];if(!T||T.isAnInstance)continue;if(T.skeleton=X,-1!==x.indexOf(X))continue;x.push(X);for(const v of X.bones)v._linkedTransformNode&&(v._linkedTransformNode=B[O[v._linkedTransformNode.uniqueId]])}A.skeletons.push(X)})),this.animationGroups.forEach((T=>{if(M.predicate&&!M.predicate(T))return;const X=T.clone(v?v(T.name):"Clone of "+T.name,(v=>B[O[v.uniqueId]]||v));A.animationGroups.push(X)})),A}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||u.c.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.Fe.environmentTexture=this.environmentTexture);for(const v of this.Fe._serializableComponents)v.addFromContainer(this);this.Fe.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const T=[];this.cameras.forEach((X=>{v&&!v(X)||(this.Fe.addCamera(X),T.push(X))})),this.lights.forEach((X=>{v&&!v(X)||(this.Fe.addLight(X),T.push(X))})),this.meshes.forEach((X=>{v&&!v(X)||(this.Fe.Ge(X),T.push(X))})),this.skeletons.forEach((T=>{v&&!v(T)||this.Fe.addSkeleton(T)})),this.animations.forEach((T=>{v&&!v(T)||this.Fe.addAnimation(T)})),this.animationGroups.forEach((T=>{v&&!v(T)||this.Fe.addAnimationGroup(T)})),this.multiMaterials.forEach((T=>{v&&!v(T)||this.Fe.addMultiMaterial(T)})),this.materials.forEach((T=>{v&&!v(T)||this.Fe.addMaterial(T)})),this.morphTargetManagers.forEach((T=>{v&&!v(T)||this.Fe.addMorphTargetManager(T)})),this.geometries.forEach((T=>{v&&!v(T)||this.Fe.addGeometry(T)})),this.transformNodes.forEach((X=>{v&&!v(X)||(this.Fe.addTransformNode(X),T.push(X))})),this.actionManagers.forEach((T=>{v&&!v(T)||this.Fe.addActionManager(T)})),this.textures.forEach((T=>{v&&!v(T)||this.Fe.addTexture(T)})),this.reflectionProbes.forEach((T=>{v&&!v(T)||this.Fe.addReflectionProbe(T)}));for(const X of T)X.parent&&-1===this.Fe.getNodes().indexOf(X.parent)&&(X.setParent?X.setParent(null):X.parent=null)}removeAllFromScene(){this._isValidHierarchy()||u.c.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.Fe.environmentTexture&&(this.Fe.environmentTexture=null);for(const v of this.Fe._serializableComponents)v.removeFromContainer(this)}removeFromScene(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.cameras.forEach((T=>{v&&!v(T)||this.Fe.removeCamera(T)})),this.lights.forEach((T=>{v&&!v(T)||this.Fe.removeLight(T)})),this.meshes.forEach((T=>{v&&!v(T)||this.Fe.Je(T,!0)})),this.skeletons.forEach((T=>{v&&!v(T)||this.Fe.removeSkeleton(T)})),this.animations.forEach((T=>{v&&!v(T)||this.Fe.removeAnimation(T)})),this.animationGroups.forEach((T=>{v&&!v(T)||this.Fe.removeAnimationGroup(T)})),this.multiMaterials.forEach((T=>{v&&!v(T)||this.Fe.removeMultiMaterial(T)})),this.materials.forEach((T=>{v&&!v(T)||this.Fe.removeMaterial(T)})),this.morphTargetManagers.forEach((T=>{v&&!v(T)||this.Fe.removeMorphTargetManager(T)})),this.geometries.forEach((T=>{v&&!v(T)||this.Fe.removeGeometry(T)})),this.transformNodes.forEach((T=>{v&&!v(T)||this.Fe.removeTransformNode(T)})),this.actionManagers.forEach((T=>{v&&!v(T)||this.Fe.removeActionManager(T)})),this.textures.forEach((T=>{v&&!v(T)||this.Fe.removeTexture(T)})),this.reflectionProbes.forEach((T=>{v&&!v(T)||this.Fe.removeReflectionProbe(T)}))}dispose(){this.cameras.slice(0).forEach((v=>{v.dispose()})),this.cameras.length=0,this.lights.slice(0).forEach((v=>{v.dispose()})),this.lights.length=0,this.meshes.slice(0).forEach((v=>{v.dispose()})),this.meshes.length=0,this.skeletons.slice(0).forEach((v=>{v.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((v=>{v.dispose()})),this.animationGroups.length=0,this.multiMaterials.slice(0).forEach((v=>{v.dispose()})),this.multiMaterials.length=0,this.materials.slice(0).forEach((v=>{v.dispose()})),this.materials.length=0,this.geometries.slice(0).forEach((v=>{v.dispose()})),this.geometries.length=0,this.transformNodes.slice(0).forEach((v=>{v.dispose()})),this.transformNodes.length=0,this.actionManagers.slice(0).forEach((v=>{v.dispose()})),this.actionManagers.length=0,this.textures.slice(0).forEach((v=>{v.dispose()})),this.textures.length=0,this.reflectionProbes.slice(0).forEach((v=>{v.dispose()})),this.reflectionProbes.length=0,this.morphTargetManagers.slice(0).forEach((v=>{v.dispose()})),this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const v of this.Fe._serializableComponents)v.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.Fe.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(v,T,X){if(v&&T)for(const O of v){let v=!0;if(X)for(const T of X)if(O===T){v=!1;break}v&&(T.push(O),O._parentContainer=this)}}moveAllFromScene(v){this._wasAddedToScene=!1,void 0===v&&(v=new s);for(const T in this)Object.prototype.hasOwnProperty.call(this,T)&&(this[T]=this[T]||("_environmentTexture"===T?null:[]),this._moveAssets(this.Fe[T],this[T],v[T]));this.environmentTexture=this.Fe.environmentTexture,this.removeAllFromScene()}createRootMesh(){const v=new m.d("assetContainerRootMesh",this.Fe);return this.meshes.forEach((T=>{T.parent||v.addChild(T)})),this.meshes.unshift(v),v}mergeAnimationsTo(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M.c.LastCreatedScene,T=arguments.length>1?arguments[1]:void 0,X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!v)return f.d.Error("No scene available to merge animations to"),[];const O=X||(T=>{let X=null;const O=T.animations.length?T.animations[0].targetProperty:"",u=T.name.split(".").join("").split("_primitive")[0];switch(O){case"position":case"rotationQuaternion":X=v.getTransformNodeByName(T.name)||v.getTransformNodeByName(u);break;case"influence":X=v.getMorphTargetByName(T.name)||v.getMorphTargetByName(u);break;default:X=v.getNodeByName(T.name)||v.getNodeByName(u)}return X});this.getNodes().forEach((v=>{const T=O(v);if(null!==T){for(const X of v.animations){const v=T.animations.filter((v=>v.targetProperty===X.targetProperty));for(const X of v){const v=T.animations.indexOf(X,0);v>-1&&T.animations.splice(v,1)}}T.animations=T.animations.concat(v.animations)}}));const u=[];return this.animationGroups.slice().forEach((v=>{u.push(v.clone(v.name,O)),v.animatables.forEach((v=>{v.stop()}))})),T.forEach((T=>{const X=O(T.target);X&&(v.beginAnimation(X,T.fromFrame,T.toFrame,T.loopAnimation,T.speedRatio,T.onAnimationEnd?T.onAnimationEnd:void 0,void 0,!0,void 0,T.onAnimationLoop?T.onAnimationLoop:void 0),v.stopAnimation(T.target))})),u}populateRootNodes(){this.rootNodes.length=0,this.meshes.forEach((v=>{v.parent||-1!==this.rootNodes.indexOf(v)||this.rootNodes.push(v)})),this.transformNodes.forEach((v=>{v.parent||-1!==this.rootNodes.indexOf(v)||this.rootNodes.push(v)})),this.lights.forEach((v=>{v.parent||-1!==this.rootNodes.indexOf(v)||this.rootNodes.push(v)})),this.cameras.forEach((v=>{v.parent||-1!==this.rootNodes.indexOf(v)||this.rootNodes.push(v)}))}addAllAssetsToContainer(v){if(!v)return;const T=[],X=new Set;for(T.push(v);T.length>0;){const v=T.pop();if(v instanceof m.d?(v.Ne&&-1===this.geometries.indexOf(v.Ne)&&this.geometries.push(v.Ne),this.meshes.push(v)):v instanceof A.c?this.transformNodes.push(v):v instanceof n.d?this.lights.push(v):v instanceof V.e&&this.cameras.push(v),v instanceof x.c){if(v.material&&-1===this.materials.indexOf(v.material)){this.materials.push(v.material);for(const T of v.material.getActiveTextures())-1===this.textures.indexOf(T)&&this.textures.push(T)}v.skeleton&&-1===this.skeletons.indexOf(v.skeleton)&&this.skeletons.push(v.skeleton),v.morphTargetManager&&-1===this.morphTargetManagers.indexOf(v.morphTargetManager)&&this.morphTargetManagers.push(v.morphTargetManager)}for(const O of v.getChildren())X.has(O)||T.push(O);X.add(v)}this.populateRootNodes()}}var b=X(1083);class l{constructor(v){this.byteOffset=0,this.buffer=v}loadAsync(v){return this.buffer.readAsync(this.byteOffset,v).then((v=>{this._dataView=new DataView(v.buffer,v.byteOffset,v.byteLength),this._dataByteOffset=0}))}readUint32(){const v=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,v}readUint8Array(v){const T=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,v);return this._dataByteOffset+=v,this.byteOffset+=v,T}readString(v){return(0,b.j)(this.readUint8Array(v))}skipBytes(v){this._dataByteOffset+=v,this.byteOffset+=v}}var Q=X(12575);const K="Z2xURg",p={name:"cj",extensions:{".gltf":{isBinary:!1},".glb":{isBinary:!0}},canDirectLoad:v=>-1!==v.indexOf("asset")&&-1!==v.indexOf("version")||v.startsWith("data:base64,"+K)||v.startsWith("data:;base64,"+K)||v.startsWith("data:application/octet-stream;base64,"+K)||v.startsWith("data:model/gltf-binary;base64,"+K)};var G,L,r,o=X(1061),Z=X(1076);function U(v,T,X){try{return Promise.resolve(new Uint8Array(v,T,X))}catch(O){return Promise.reject(O)}}!function(v){v[v.AUTO=0]="AUTO",v[v.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(G||(G={})),function(v){v[v.NONE=0]="NONE",v[v.FIRST=1]="FIRST",v[v.ALL=2]="ALL"}(L||(L={})),function(v){v[v.LOADING=0]="LOADING",v[v.READY=1]="READY",v[v.COMPLETE=2]="COMPLETE"}(r||(r={}));class J{constructor(){this.coordinateSystemMode=G.AUTO,this.animationStartMode=L.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=v=>Promise.resolve(v),this.extensionOptions={}}p(v){v&&(this.onParsed=v.onParsed,this.coordinateSystemMode=v.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=v.animationStartMode??this.animationStartMode,this.loadNodeAnimations=v.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=v.loadSkins??this.loadSkins,this.loadMorphTargets=v.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=v.compileMaterials??this.compileMaterials,this.useClipPlane=v.useClipPlane??this.useClipPlane,this.compileShadowGenerators=v.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=v.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=v.useRangeRequests??this.useRangeRequests,this.createInstances=v.createInstances??this.createInstances,this.alwaysComputeBoundingBox=v.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=v.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=v.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=v.skipMaterials??this.skipMaterials,this.useSRGBBuffers=v.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=v.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=v.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=v.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=v.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=v.customRootNode,this.onMeshLoaded=v.onMeshLoaded,this.onSkinLoaded=v.onSkinLoaded,this.onTextureLoaded=v.onTextureLoaded,this.onMaterialLoaded=v.onMaterialLoaded,this.onCameraLoaded=v.onCameraLoaded,this.extensionOptions=v.extensionOptions??this.extensionOptions)}}class y extends J{constructor(v){super(),this.onParsedObservable=new O.b,this.onMeshLoadedObservable=new O.b,this.onSkinLoadedObservable=new O.b,this.onTextureLoadedObservable=new O.b,this.onMaterialLoadedObservable=new O.b,this.onCameraLoadedObservable=new O.b,this.onCompleteObservable=new O.b,this.onErrorObservable=new O.b,this.ae=new O.b,this.onExtensionLoadedObservable=new O.b,this.validate=!1,this.onValidatedObservable=new O.b,this._loader=null,this._state=null,this._requests=new Array,this.name=p.name,this.extensions=p.extensions,this.onLoaderStateChangedObservable=new O.b,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.p(v)}set onParsed(v){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),v&&(this._onParsedObserver=this.onParsedObservable.add(v))}set onMeshLoaded(v){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),v&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(v))}set onSkinLoaded(v){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),v&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((T=>v(T.node,T.skinnedNode))))}set onTextureLoaded(v){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),v&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(v))}set onMaterialLoaded(v){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),v&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(v))}set onCameraLoaded(v){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),v&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(v))}set onComplete(v){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(v)}set onError(v){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(v)}set onDispose(v){this._onDisposeObserver&&this.ae.remove(this._onDisposeObserver),this._onDisposeObserver=this.ae.add(v)}set onExtensionLoaded(v){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(v)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(v){this._loggingEnabled!==v&&(this._loggingEnabled=v,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(v){this._capturePerformanceCounters!==v&&(this._capturePerformanceCounters=v,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(v){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(v)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const v of this._requests)v.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=v=>Promise.resolve(v),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.ae.notifyObservers(void 0),this.ae.clear()}loadFile(v,T,X,B,m,A,x,M){if(ArrayBuffer.isView(T))return this._loadBinary(v,T,X,B,x,M),null;this._progressCallback=m;const H=T.name||u.c.GetFilename(T);if(A){if(this.useRangeRequests){this.validate&&f.d.Warn("glTF validation is not supported when range requests are enabled");const X={abort:()=>{},onCompleteObservable:new O.b},u={readAsync:(X,O)=>new Promise(((u,B)=>{this._loadFile(v,T,(v=>{u(new Uint8Array(v))}),!0,(v=>{B(v)}),(v=>{v.setRequestHeader("Range",`bytes=${X}-${X+O-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new l(u)).then((v=>{X.onCompleteObservable.notifyObservers(X),B(v)}),x?v=>x(void 0,v):void 0),X}return this._loadFile(v,T,(T=>{this._validate(v,new Uint8Array(T,0,T.byteLength),X,H),this._unpackBinaryAsync(new l({readAsync:(v,X)=>U(T,v,X),byteLength:T.byteLength})).then((v=>{B(v)}),x?v=>x(void 0,v):void 0)}),!0,x)}return this._loadFile(v,T,(T=>{try{this._validate(v,T,X,H),B({json:this._parseJson(T)})}catch{x&&x()}}),!1,x)}_loadBinary(v,T,X,O,u,B){this._validate(v,new Uint8Array(T.buffer,T.byteOffset,T.byteLength),X,B),this._unpackBinaryAsync(new l({readAsync:(v,X)=>function(v,T,X){try{if(T<0||T>=v.byteLength)throw new RangeError("Offset is out of range.");if(T+X>v.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(v.buffer,v.byteOffset+T,X))}catch(O){return Promise.reject(O)}}(T,v,X),byteLength:T.byteLength})).then((v=>{O(v)}),u?v=>u(void 0,v):void 0)}importMeshAsync(v,T,X,O,u,B){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(X),this.onParsedObservable.clear(),this._log(`Loading ${B||""}`),this._loader=this._getLoader(X),this._loader.importMeshAsync(v,T,null,X,O,u,B))))}loadAsync(v,T,X,O,u){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(T),this.onParsedObservable.clear(),this._log(`Loading ${u||""}`),this._loader=this._getLoader(T),this._loader.loadAsync(v,T,X,O,u))))}loadAssetContainerAsync(v,T,X,O,u){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(T),this.onParsedObservable.clear(),this._log(`Loading ${u||""}`),this._loader=this._getLoader(T);const B=new k(v),m=[];this.onMaterialLoadedObservable.add((v=>{m.push(v)}));const A=[];this.onTextureLoadedObservable.add((v=>{A.push(v)}));const x=[];this.onCameraLoadedObservable.add((v=>{x.push(v)}));const f=[];return this.onMeshLoadedObservable.add((v=>{v.morphTargetManager&&f.push(v.morphTargetManager)})),this._loader.importMeshAsync(null,v,B,T,X,O,u).then((v=>(Array.prototype.push.apply(B.geometries,v.geometries),Array.prototype.push.apply(B.meshes,v.meshes),Array.prototype.push.apply(B.Ae,v.Ae),Array.prototype.push.apply(B.skeletons,v.skeletons),Array.prototype.push.apply(B.animationGroups,v.animationGroups),Array.prototype.push.apply(B.materials,m),Array.prototype.push.apply(B.textures,A),Array.prototype.push.apply(B.lights,v.lights),Array.prototype.push.apply(B.transformNodes,v.transformNodes),Array.prototype.push.apply(B.cameras,x),Array.prototype.push.apply(B.morphTargetManagers,f),B)))}))}canDirectLoad(v){return p.canDirectLoad(v)}directLoad(v,T){if(T.startsWith("base64,"+K)||T.startsWith(";base64,"+K)||T.startsWith("application/octet-stream;base64,"+K)||T.startsWith("model/gltf-binary;base64,"+K)){const X=(0,o.e)(T);return this._validate(v,new Uint8Array(X,0,X.byteLength)),this._unpackBinaryAsync(new l({readAsync:(v,T)=>U(X,v,T),byteLength:X.byteLength}))}return this._validate(v,T),Promise.resolve({json:this._parseJson(T)})}createPlugin(v){return new y(v[p.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((v,T)=>{this.onCompleteObservable.addOnce((()=>{v()})),this.onErrorObservable.addOnce((v=>{T(v)}))}))}_setState(v){this._state!==v&&(this._state=v,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(r[this._state]))}_loadFile(v,T,X,O,u,B){const m=v._loadFile(T,X,(v=>{this._onProgress(v,m)}),!0,O,u,B);return m.onCompleteObservable.add((()=>{m._lengthComputable=!0,m._total=m._loaded})),this._requests.push(m),m}_onProgress(v,T){if(!this._progressCallback)return;T._lengthComputable=v.lengthComputable,T._loaded=v.loaded,T._total=v.total;let X=!0,O=0,u=0;for(const B of this._requests){if(void 0===B._lengthComputable||void 0===B._loaded||void 0===B._total)return;X=X&&B._lengthComputable,O+=B._loaded,u+=B._total}this._progressCallback({lengthComputable:X,loaded:O,total:X?u:0})}_validate(v,T){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),Q.b.ValidateAsync(T,X,O,(T=>this.preprocessUrlAsync(X+T).then((T=>v._loadFileAsync(T,void 0,!0,!0).then((v=>new Uint8Array(v,0,v.byteLength))))))).then((v=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(v),this.onValidatedObservable.clear()}),(v=>{this._endPerformanceCounter("Validate JSON"),u.c.Warn(`Failed to validate: ${v.message}`),this.onValidatedObservable.clear()})))}_getLoader(v){const T=v.json.asset||{};this._log(`Asset version: ${T.version}`),T.minVersion&&this._log(`Asset minimum version: ${T.minVersion}`),T.generator&&this._log(`Asset generator: ${T.generator}`);const X=y._parseVersion(T.version);if(!X)throw new Error("Invalid version: "+T.version);if(void 0!==T.minVersion){const v=y._parseVersion(T.minVersion);if(!v)throw new Error("Invalid minimum version: "+T.minVersion);if(y._compareVersion(v,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+T.minVersion)}const O={1:y._CreateGLTF1Loader,2:y._CreateGLTF2Loader}[X.major];if(!O)throw new Error("Unsupported version: "+T.version);return O(this)}_parseJson(v){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${v.length}`);const T=JSON.parse(v);return this._endPerformanceCounter("Parse JSON"),T}_unpackBinaryAsync(v){return this._startPerformanceCounter("Unpack Binary"),v.loadAsync(20).then((()=>{const T=v.readUint32();if(1179937895!==T)throw new Z.f("Unexpected magic: "+T,Z.e.GLTFLoaderUnexpectedMagicError);const X=v.readUint32();this.loggingEnabled&&this._log(`Binary version: ${X}`);const O=v.readUint32();let u;switch(this.useRangeRequests||O===v.buffer.byteLength||f.d.Warn(`Length in header does not match actual data length: ${O} != ${v.buffer.byteLength}`),X){case 1:u=this._unpackBinaryV1Async(v,O);break;case 2:u=this._unpackBinaryV2Async(v,O);break;default:throw new Error("Unsupported version: "+X)}return this._endPerformanceCounter("Unpack Binary"),u}))}_unpackBinaryV1Async(v,T){const X=v.readUint32(),O=v.readUint32();if(0!==O)throw new Error(`Unexpected content format: ${O}`);const u=T-v.byteOffset,B={json:this._parseJson(v.readString(X)),bin:null};if(0!==u){const T=v.byteOffset;B.bin={readAsync:(X,O)=>v.buffer.readAsync(T+X,O),byteLength:u}}return Promise.resolve(B)}_unpackBinaryV2Async(v,T){const X=1313821514,O=5130562,u=v.readUint32();if(v.readUint32()!==X)throw new Error("First chunk format is not JSON");return v.byteOffset+u===T?v.loadAsync(u).then((()=>({json:this._parseJson(v.readString(u)),bin:null}))):v.loadAsync(u+8).then((()=>{const B={json:this._parseJson(v.readString(u)),bin:null},m=()=>{const u=v.readUint32();switch(v.readUint32()){case X:throw new Error("Unexpected JSON chunk");case O:{const T=v.byteOffset;B.bin={readAsync:(X,O)=>v.buffer.readAsync(T+X,O),byteLength:u},v.skipBytes(u);break}default:v.skipBytes(u)}return v.byteOffset!==T?v.loadAsync(8).then(m):Promise.resolve(B)};return m()}))}static _parseVersion(v){if("1.0"===v||"1.0.1"===v)return{major:1,minor:0};const T=(v+"").match(/^(\d+)\.(\d+)/);return T?{major:parseInt(T[1]),minor:parseInt(T[2])}:null}static _compareVersion(v,T){return v.major>T.major?1:v.major<T.major?-1:v.minor>T.minor?1:v.minor<T.minor?-1:0}_logOpen(v){this._log(v),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(v){const T=y._logSpaces.substring(0,2*this._logIndentLevel);f.d.Log(`${T}${v}`)}_logDisabled(v){}_startPerformanceCounterEnabled(v){u.c.StartPerformanceCounter(v)}_startPerformanceCounterDisabled(v){}_endPerformanceCounterEnabled(v){u.c.EndPerformanceCounter(v)}_endPerformanceCounterDisabled(v){}}y.IncrementalLoading=!0,y.HomogeneousCoordinates=!1,y._logSpaces="                                ",(0,B.e)(new y)},12575:(v,T,X)=>{"use strict";X.d(T,{b:()=>m});var O=X(1217);function u(v,T,X,O){const u={externalResourceFunction:O};return X&&(u.uri="file:"===T?X:T+X),ArrayBuffer.isView(v)?GLTFValidator.validateBytes(v,u):GLTFValidator.validateString(v,u)}function B(){const v=[];onmessage=T=>{const X=T.data;switch(X.id){case"init":importScripts(X.url);break;case"validate":u(X.data,X.rootUrl,X.fileName,(T=>new Promise(((X,O)=>{const u=v.length;v.push({resolve:X,reject:O}),postMessage({id:"getExternalResource",index:u,uri:T})})))).then((v=>{postMessage({id:"validate.resolve",value:v})}),(v=>{postMessage({id:"validate.reject",reason:v})}));break;case"getExternalResource.resolve":v[X.index].resolve(X.value);break;case"getExternalResource.reject":v[X.index].reject(X.reason)}}}class m{static ValidateAsync(v,T,X,m){return"function"===typeof Worker?new Promise(((A,x)=>{const f=`${u}(${B})()`,M=URL.createObjectURL(new Blob([f],{type:"application/javascript"})),H=new Worker(M),n=v=>{H.removeEventListener("error",n),H.removeEventListener("message",V),x(v)},V=v=>{const T=v.data;switch(T.id){case"getExternalResource":m(T.uri).then((v=>{H.postMessage({id:"getExternalResource.resolve",index:T.index,value:v},[v.buffer])}),(v=>{H.postMessage({id:"getExternalResource.reject",index:T.index,reason:v})}));break;case"validate.resolve":H.removeEventListener("error",n),H.removeEventListener("message",V),A(T.value),H.terminate();break;case"validate.reject":H.removeEventListener("error",n),H.removeEventListener("message",V),x(T.reason),H.terminate()}};if(H.addEventListener("error",n),H.addEventListener("message",V),H.postMessage({id:"init",url:O.c.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(v)){const O=v.slice();H.postMessage({id:"validate",data:O,rootUrl:T,fileName:X},[O.buffer])}else H.postMessage({id:"validate",data:v,rootUrl:T,fileName:X})})):(this._LoadScriptPromise||(this._LoadScriptPromise=O.c.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>u(v,T,X,m))))}}m.Configuration={url:`${O.c._DefaultCdnUrl}/gltf_validator.js`}},12946:(v,T,X)=>{"use strict";X.d(T,{e:()=>G});var O=X(985),u=X(994),B=X(1156),m=X(1006),A=X(1403),x=X(1409),f=X(1261),M=X(1209),H=X(1023),n=X(1120);X(11479),X(11322),X(11481),X(11242),X(11485),X(11514),X(11523);const V="imageProcessingCompatibility",D="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";n.e.IncludesShadersStore[V]=D;const s="skyPixelShader",F="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";n.e.ShadersStore[s]=F;X(11287),X(11293),X(11371),X(11396),X(11378);const k="skyVertexShader",b="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";n.e.ShadersStore[k]=b;var l=X(1416),Q=X(1400),K=X(1397);class p extends A.c{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class G extends x.e{constructor(v,T){super(v,T),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new m.l(0,100,0),this.useSunPosition=!1,this.cameraOffset=m.l.Zero(),this.up=m.l.Up(),this.dithering=!1,this._cameraPosition=m.l.Zero(),this._skyOrientation=new m.f}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(v,T){const X=T._drawWrapper;if(this.isFrozen&&X.effect&&X._wasPreviouslyReady)return!0;T.materialDefines||(T.materialDefines=new p);const O=T.materialDefines,u=this.va();if(this._isReadyForSubMesh(T))return!0;if((0,K.L)(v,u,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,O),(0,K.E)(v,O,!0,!1),O.IMAGEPROCESSINGPOSTPROCESS!==u.imageProcessingConfiguration.applyByPostProcess&&O.markAsMiscDirty(),O.DITHER!==this.dithering&&O.markAsMiscDirty(),O.isDirty){O.markAsProcessed(),u.resetCachedMaterial();const v=new l.d;O.FOG&&v.addFallback(1,"FOG"),O.IMAGEPROCESSINGPOSTPROCESS=u.imageProcessingConfiguration.applyByPostProcess,O.DITHER=this.dithering;const X=[f.e.PositionKind];O.VERTEXCOLOR&&X.push(f.e.ColorKind);const B="sky",m=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,Q.c)(m);const A=O.toString();T.setEffect(u.getEngine().createEffect(B,X,m,[],A,v,this.onCompiled,this.onError),O,this._materialContext)}return!(!T.effect||!T.effect.isReady())&&(O._renderId=u.getRenderId(),X._wasPreviouslyReady=!0,!0)}bindForSubMesh(v,T,X){const O=this.va(),u=X.materialDefines;if(!u)return;const B=X.effect;if(!B)return;this._activeEffect=B,this.bindOnlyWorldMatrix(v),this._activeEffect.setMatrix("viewProjection",O.getTransformMatrix()),this._mustRebind(O,B,X)&&((0,Q.g)(B,this,O),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,K.i)(u,B,O)),O.fogEnabled&&T.applyFog&&O.fogMode!==M.e.FOGMODE_NONE&&this._activeEffect.setMatrix("view",O.getViewMatrix()),(0,K.e)(O,T,this._activeEffect);const A=O.activeCamera;if(A){const v=A.getWorldMatrix();this._cameraPosition.x=v.m[12],this._cameraPosition.y=v.m[13],this._cameraPosition.z=v.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const v=Math.PI*(this.inclination-.5),T=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(T)*Math.cos(v),this.sunPosition.y=this.distance*Math.sin(-v),this.sunPosition.z=this.distance*Math.sin(T)*Math.cos(v),m.f.FromUnitVectorsToRef(m.l.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(T,this._activeEffect,X)}getAnimatables(){return[]}dispose(v){super.dispose(v)}clone(v){return B.e.Clone((()=>new G(v,this.va())),this)}serialize(){const v=super.serialize();return v.customType="BABYLON.SkyMaterial",v}getClassName(){return"SkyMaterial"}static Parse(v,T,X){return B.e.Parse((()=>new G(v.name,T)),v,T,X)}}(0,O.c)([(0,u.G)()],G.prototype,"luminance",void 0),(0,O.c)([(0,u.G)()],G.prototype,"turbidity",void 0),(0,O.c)([(0,u.G)()],G.prototype,"rayleigh",void 0),(0,O.c)([(0,u.G)()],G.prototype,"mieCoefficient",void 0),(0,O.c)([(0,u.G)()],G.prototype,"mieDirectionalG",void 0),(0,O.c)([(0,u.G)()],G.prototype,"distance",void 0),(0,O.c)([(0,u.G)()],G.prototype,"inclination",void 0),(0,O.c)([(0,u.G)()],G.prototype,"azimuth",void 0),(0,O.c)([(0,u.E)()],G.prototype,"sunPosition",void 0),(0,O.c)([(0,u.G)()],G.prototype,"useSunPosition",void 0),(0,O.c)([(0,u.E)()],G.prototype,"cameraOffset",void 0),(0,O.c)([(0,u.E)()],G.prototype,"up",void 0),(0,O.c)([(0,u.G)()],G.prototype,"dithering",void 0),(0,H.f)("BABYLON.SkyMaterial",G)},11652:(v,T,X)=>{"use strict";function O(v,T){T.headers=v.headers||{},T.statusMessage=v.statusText,T.statusCode=v.status,T.data=v.response}function u(v,T,X){return new Promise((function(u,B){X=X||{};var m,A,x,f=new XMLHttpRequest,M=X.body,H=X.headers||{};for(m in X.timeout&&(f.timeout=X.timeout),f.ontimeout=f.onerror=function(v){v.timeout="timeout"==v.type,B(v)},f.open(v,T.href||T),f.onload=function(){for(x=f.getAllResponseHeaders().trim().split(/[\r\n]+/),O(f,f);A=x.shift();)A=A.split(": "),f.headers[A.shift().toLowerCase()]=A.join(": ");if((A=f.headers["content-type"])&&~A.indexOf("application/json"))try{f.data=JSON.parse(f.data,X.reviver)}catch(v){return O(f,v),B(v)}(f.status>=400?B:u)(f)},typeof FormData<"u"&&M instanceof FormData||M&&"object"==typeof M&&(H["content-type"]="application/json",M=JSON.stringify(M)),f.withCredentials=!!X.withCredentials,H)f.setRequestHeader(m,H[m]);f.send(M)}))}X.r(T),X.d(T,{del:()=>x,get:()=>B,patch:()=>A,post:()=>m,put:()=>f,send:()=>u});var B=u.bind(u,"GET"),m=u.bind(u,"POST"),A=u.bind(u,"PATCH"),x=u.bind(u,"DELETE"),f=u.bind(u,"PUT")},13045:(v,T,X)=>{"use strict";X.d(T,{e:()=>H});const O=.5*(Math.sqrt(3)-1),u=(3-Math.sqrt(3))/6,B=1/3,m=1/6,A=(Math.sqrt(5)-1)/4,x=(5-Math.sqrt(5))/20,f=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),M=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const H=class{constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const T="function"==typeof v?v:function(v){let T=0,X=0,O=0,u=1;const B=function(){let v=4022871197;return function(T){T=T.toString();for(let X=0;X<T.length;X++){v+=T.charCodeAt(X);let O=.02519603282416938*v;v=O>>>0,O-=v,O*=v,v=O>>>0,O-=v,v+=4294967296*O}return 2.3283064365386963e-10*(v>>>0)}}();T=B(" "),X=B(" "),O=B(" "),T-=B(v),T<0&&(T+=1);X-=B(v),X<0&&(X+=1);O-=B(v),O<0&&(O+=1);return function(){const v=2091639*T+2.3283064365386963e-10*u;return T=X,X=O,O=v-(u=0|v)}}(v);this.p=function(v){const T=new Uint8Array(256);for(let X=0;X<256;X++)T[X]=X;for(let X=0;X<255;X++){const O=X+~~(v()*(256-X)),u=T[X];T[X]=T[O],T[O]=u}return T}(T),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let X=0;X<512;X++)this.perm[X]=this.p[255&X],this.permMod12[X]=this.perm[X]%12}noise2D(v,T){const X=this.permMod12,B=this.perm;let m=0,A=0,x=0;const M=(v+T)*O,H=Math.floor(v+M),n=Math.floor(T+M),V=(H+n)*u,D=v-(H-V),s=T-(n-V);let F,k;D>s?(F=1,k=0):(F=0,k=1);const b=D-F+u,l=s-k+u,Q=D-1+2*u,K=s-1+2*u,p=255&H,G=255&n;let L=.5-D*D-s*s;if(L>=0){const v=3*X[p+B[G]];L*=L,m=L*L*(f[v]*D+f[v+1]*s)}let r=.5-b*b-l*l;if(r>=0){const v=3*X[p+F+B[G+k]];r*=r,A=r*r*(f[v]*b+f[v+1]*l)}let o=.5-Q*Q-K*K;if(o>=0){const v=3*X[p+1+B[G+1]];o*=o,x=o*o*(f[v]*Q+f[v+1]*K)}return 70*(m+A+x)}noise3D(v,T,X){const O=this.permMod12,u=this.perm;let A,x,M,H;const n=(v+T+X)*B,V=Math.floor(v+n),D=Math.floor(T+n),s=Math.floor(X+n),F=(V+D+s)*m,k=v-(V-F),b=T-(D-F),l=X-(s-F);let Q,K,p,G,L,r;k>=b?b>=l?(Q=1,K=0,p=0,G=1,L=1,r=0):k>=l?(Q=1,K=0,p=0,G=1,L=0,r=1):(Q=0,K=0,p=1,G=1,L=0,r=1):b<l?(Q=0,K=0,p=1,G=0,L=1,r=1):k<l?(Q=0,K=1,p=0,G=0,L=1,r=1):(Q=0,K=1,p=0,G=1,L=1,r=0);const o=k-Q+m,Z=b-K+m,U=l-p+m,J=k-G+2*m,y=b-L+2*m,P=l-r+2*m,a=k-1+.5,E=b-1+.5,i=l-1+.5,t=255&V,C=255&D,c=255&s;let N=.6-k*k-b*b-l*l;if(N<0)A=0;else{const v=3*O[t+u[C+u[c]]];N*=N,A=N*N*(f[v]*k+f[v+1]*b+f[v+2]*l)}let d=.6-o*o-Z*Z-U*U;if(d<0)x=0;else{const v=3*O[t+Q+u[C+K+u[c+p]]];d*=d,x=d*d*(f[v]*o+f[v+1]*Z+f[v+2]*U)}let I=.6-J*J-y*y-P*P;if(I<0)M=0;else{const v=3*O[t+G+u[C+L+u[c+r]]];I*=I,M=I*I*(f[v]*J+f[v+1]*y+f[v+2]*P)}let W=.6-a*a-E*E-i*i;if(W<0)H=0;else{const v=3*O[t+1+u[C+1+u[c+1]]];W*=W,H=W*W*(f[v]*a+f[v+1]*E+f[v+2]*i)}return 32*(A+x+M+H)}noise4D(v,T,X,O){const u=this.perm;let B,m,f,H,n;const V=(v+T+X+O)*A,D=Math.floor(v+V),s=Math.floor(T+V),F=Math.floor(X+V),k=Math.floor(O+V),b=(D+s+F+k)*x,l=v-(D-b),Q=T-(s-b),K=X-(F-b),p=O-(k-b);let G=0,L=0,r=0,o=0;l>Q?G++:L++,l>K?G++:r++,l>p?G++:o++,Q>K?L++:r++,Q>p?L++:o++,K>p?r++:o++;const Z=G>=3?1:0,U=L>=3?1:0,J=r>=3?1:0,y=o>=3?1:0,P=G>=2?1:0,a=L>=2?1:0,E=r>=2?1:0,i=o>=2?1:0,t=G>=1?1:0,C=L>=1?1:0,c=r>=1?1:0,N=o>=1?1:0,d=l-Z+x,I=Q-U+x,W=K-J+x,g=p-y+x,j=l-P+2*x,e=Q-a+2*x,h=K-E+2*x,S=p-i+2*x,w=l-t+3*x,z=Q-C+3*x,R=K-c+3*x,Y=p-N+3*x,q=l-1+4*x,vv=Q-1+4*x,Tv=K-1+4*x,Xv=p-1+4*x,Ov=255&D,uv=255&s,Bv=255&F,mv=255&k;let Av=.6-l*l-Q*Q-K*K-p*p;if(Av<0)B=0;else{const v=u[Ov+u[uv+u[Bv+u[mv]]]]%32*4;Av*=Av,B=Av*Av*(M[v]*l+M[v+1]*Q+M[v+2]*K+M[v+3]*p)}let xv=.6-d*d-I*I-W*W-g*g;if(xv<0)m=0;else{const v=u[Ov+Z+u[uv+U+u[Bv+J+u[mv+y]]]]%32*4;xv*=xv,m=xv*xv*(M[v]*d+M[v+1]*I+M[v+2]*W+M[v+3]*g)}let fv=.6-j*j-e*e-h*h-S*S;if(fv<0)f=0;else{const v=u[Ov+P+u[uv+a+u[Bv+E+u[mv+i]]]]%32*4;fv*=fv,f=fv*fv*(M[v]*j+M[v+1]*e+M[v+2]*h+M[v+3]*S)}let Mv=.6-w*w-z*z-R*R-Y*Y;if(Mv<0)H=0;else{const v=u[Ov+t+u[uv+C+u[Bv+c+u[mv+N]]]]%32*4;Mv*=Mv,H=Mv*Mv*(M[v]*w+M[v+1]*z+M[v+2]*R+M[v+3]*Y)}let Hv=.6-q*q-vv*vv-Tv*Tv-Xv*Xv;if(Hv<0)n=0;else{const v=u[Ov+1+u[uv+1+u[Bv+1+u[mv+1]]]]%32*4;Hv*=Hv,n=Hv*Hv*(M[v]*q+M[v+1]*vv+M[v+2]*Tv+M[v+3]*Xv)}return 27*(B+m+f+H+n)}}}}]);