/*! For license information please see q6li2m.10.c56754e4.chunk.js.LICENSE.txt */
(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[10],{12322:(M,E,b)=>{"use strict";var x=b(12325),k=b(12328),a=b(12332);b.g.__TYPEDARRAY_POOL||(b.g.__TYPEDARRAY_POOL={UINT8:k([32,0]),UINT16:k([32,0]),UINT32:k([32,0]),INT8:k([32,0]),INT16:k([32,0]),INT32:k([32,0]),FLOAT:k([32,0]),DOUBLE:k([32,0]),DATA:k([32,0]),UINT8C:k([32,0]),BUFFER:k([32,0])});var g="undefined"!==typeof Uint8ClampedArray,n=b.g.__TYPEDARRAY_POOL;n.UINT8C||(n.UINT8C=k([32,0])),n.BUFFER||(n.BUFFER=k([32,0]));var J=n.DATA,u=n.BUFFER;function T(M){if(M){var E=M.length||M.byteLength,b=x.log2(E);J[b].push(M)}}function V(M){M=x.nextPow2(M);var E=x.log2(M),b=J[E];return b.length>0?b.pop():new ArrayBuffer(M)}function I(M){return new Uint8Array(V(M),0,M)}function t(M){return new Uint16Array(V(2*M),0,M)}function y(M){return new Uint32Array(V(4*M),0,M)}function B(M){return new Int8Array(V(M),0,M)}function r(M){return new Int16Array(V(2*M),0,M)}function c(M){return new Int32Array(V(4*M),0,M)}function C(M){return new Float32Array(V(4*M),0,M)}function R(M){return new Float64Array(V(8*M),0,M)}function w(M){return g?new Uint8ClampedArray(V(M),0,M):I(M)}function S(M){return new DataView(V(M),0,M)}E.free=function(M){if(a(M))u[x.log2(M.length)].push(M);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(M)&&(M=M.buffer),!M)return;var E=M.length||M.byteLength,b=0|x.log2(E);J[b].push(M)}},E.freeUint8=E.freeUint16=E.freeUint32=E.freeInt8=E.freeInt16=E.freeInt32=E.freeFloat32=E.freeFloat=E.freeFloat64=E.freeDouble=E.freeUint8Clamped=E.freeDataView=function(M){T(M.buffer)},E.freeArrayBuffer=T,E.freeBuffer=function(M){u[x.log2(M.length)].push(M)},E.malloc=function(M,E){if(void 0===E||"arraybuffer"===E)return V(M);switch(E){case"uint8":return I(M);case"uint16":return t(M);case"uint32":return y(M);case"int8":return B(M);case"int16":return r(M);case"int32":return c(M);case"float":case"float32":return C(M);case"double":case"float64":return R(M);case"uint8_clamped":return w(M);case"buffer":throw"Buffer not supported";case"data":case"dataview":return S(M);default:return null}return null},E.mallocArrayBuffer=V,E.mallocUint8=I,E.mallocUint16=t,E.mallocUint32=y,E.mallocInt8=B,E.mallocInt16=r,E.mallocInt32=c,E.mallocFloat32=E.mallocFloat=C,E.mallocFloat64=E.mallocDouble=R,E.mallocUint8Clamped=w,E.mallocDataView=S,E.clearCache=function(){for(var M=0;M<32;++M)n.UINT8[M].length=0,n.UINT16[M].length=0,n.UINT32[M].length=0,n.INT8[M].length=0,n.INT16[M].length=0,n.INT32[M].length=0,n.FLOAT[M].length=0,n.DOUBLE[M].length=0,n.UINT8C[M].length=0,J[M].length=0,u[M].length=0}},12420:(M,E,b)=>{M.exports=k;var x=b(11862);function k(M,E){if(!(this instanceof k))return new k(M,E);var b=x.create();x.add(b,M,E),this.zd=x.min(x.create(),M,b),this.rh=x.clone(E),this.max=x.max(x.create(),M,b),this.mag=x.length(this.rh)}var a=k.prototype;a.width=function(){return this.rh[0]},a.height=function(){return this.rh[1]},a.depth=function(){return this.rh[2]},a.x0=function(){return this.zd[0]},a.y0=function(){return this.zd[1]},a.z0=function(){return this.zd[2]},a.x1=function(){return this.max[0]},a.y1=function(){return this.max[1]},a.z1=function(){return this.max[2]},a.translate=function(M){return x.add(this.max,this.max,M),x.add(this.zd,this.zd,M),this},a.setPosition=function(M){return x.add(this.max,M,this.rh),x.j(this.zd,M),this},a.expand=function(M){var E=x.create(),b=x.create();return x.max(E,M.max,this.max),x.min(b,M.zd,this.zd),x.Qc(E,E,b),new k(b,E)},a.intersects=function(M){return!(M.zd[0]>this.max[0])&&(!(M.zd[1]>this.max[1])&&(!(M.zd[2]>this.max[2])&&(!(M.max[0]<this.zd[0])&&(!(M.max[1]<this.zd[1])&&!(M.max[2]<this.zd[2])))))},a.touches=function(M){var E=this.union(M);return null!==E&&(0==E.width()||0==E.height()||0==E.depth())},a.union=function(M){if(!this.intersects(M))return null;var E=Math.max(M.zd[0],this.zd[0]),b=Math.max(M.zd[1],this.zd[1]),x=Math.max(M.zd[2],this.zd[2]);return new k([E,b,x],[Math.min(M.max[0],this.max[0])-E,Math.min(M.max[1],this.max[1])-b,Math.min(M.max[2],this.max[2])-x])}},12325:(M,E)=>{"use strict";function b(M){var E=32;return(M&=-M)&&E--,65535&M&&(E-=16),16711935&M&&(E-=8),252645135&M&&(E-=4),858993459&M&&(E-=2),1431655765&M&&(E-=1),E}E.INT_BITS=32,E.INT_MAX=2147483647,E.INT_MIN=-1<<31,E.sign=function(M){return(M>0)-(M<0)},E.abs=function(M){var E=M>>31;return(M^E)-E},E.min=function(M,E){return E^(M^E)&-(M<E)},E.max=function(M,E){return M^(M^E)&-(M<E)},E.isPow2=function(M){return!(M&M-1)&&!!M},E.log2=function(M){var E,b;return E=(M>65535)<<4,E|=b=((M>>>=E)>255)<<3,E|=b=((M>>>=b)>15)<<2,(E|=b=((M>>>=b)>3)<<1)|(M>>>=b)>>1},E.log10=function(M){return M>=1e9?9:M>=1e8?8:M>=1e7?7:M>=1e6?6:M>=1e5?5:M>=1e4?4:M>=1e3?3:M>=100?2:M>=10?1:0},E.popCount=function(M){return 16843009*((M=(858993459&(M-=M>>>1&1431655765))+(M>>>2&858993459))+(M>>>4)&252645135)>>>24},E.countTrailingZeros=b,E.nextPow2=function(M){return M+=0===M,--M,M|=M>>>1,M|=M>>>2,M|=M>>>4,M|=M>>>8,(M|=M>>>16)+1},E.prevPow2=function(M){return M|=M>>>1,M|=M>>>2,M|=M>>>4,M|=M>>>8,(M|=M>>>16)-(M>>>1)},E.parity=function(M){return M^=M>>>16,M^=M>>>8,M^=M>>>4,27030>>>(M&=15)&1};var x=new Array(256);!function(M){for(var E=0;E<256;++E){var b=E,x=E,k=7;for(b>>>=1;b;b>>>=1)x<<=1,x|=1&b,--k;M[E]=x<<k&255}}(x),E.reverse=function(M){return x[255&M]<<24|x[M>>>8&255]<<16|x[M>>>16&255]<<8|x[M>>>24&255]},E.interleave2=function(M,E){return(M=1431655765&((M=858993459&((M=252645135&((M=16711935&((M&=65535)|M<<8))|M<<4))|M<<2))|M<<1))|(E=1431655765&((E=858993459&((E=252645135&((E=16711935&((E&=65535)|E<<8))|E<<4))|E<<2))|E<<1))<<1},E.deinterleave2=function(M,E){return(M=65535&((M=16711935&((M=252645135&((M=858993459&((M=M>>>E&1431655765)|M>>>1))|M>>>2))|M>>>4))|M>>>16))<<16>>16},E.interleave3=function(M,E,b){return M=1227133513&((M=3272356035&((M=251719695&((M=4278190335&((M&=1023)|M<<16))|M<<8))|M<<4))|M<<2),(M|=(E=1227133513&((E=3272356035&((E=251719695&((E=4278190335&((E&=1023)|E<<16))|E<<8))|E<<4))|E<<2))<<1)|(b=1227133513&((b=3272356035&((b=251719695&((b=4278190335&((b&=1023)|b<<16))|b<<8))|b<<4))|b<<2))<<2},E.deinterleave3=function(M,E){return(M=1023&((M=4278190335&((M=251719695&((M=3272356035&((M=M>>>E&1227133513)|M>>>2))|M>>>4))|M>>>8))|M>>>16))<<22>>22},E.nextCombination=function(M){var E=M|M-1;return E+1|(~E&-~E)-1>>>b(M)+1}},12313:(M,E,b)=>{"use strict";M.exports=function(M,E,b){switch(arguments.length){case 1:return x=[],u(k=M,k,T,!0),x;case 2:return"function"===typeof E?u(M,M,E,!0):function(M,E){return x=[],u(M,E,T,!1),x}(M,E);case 3:return u(M,E,b,!1);default:throw new Error("box-intersect: Invalid arguments")}var k};var x,k=b(12322),a=b(12338),g=b(12353);function n(M,E){for(var b=0;b<M;++b)if(!(E[b]<=E[b+M]))return!0;return!1}function J(M,E,b,x){for(var k=0,a=0,g=0,J=M.length;g<J;++g){var u=M[g];if(!n(E,u)){for(var T=0;T<2*E;++T)b[k++]=u[T];x[a++]=g}}return a}function u(M,E,b,x){var n=M.length,u=E.length;if(!(n<=0||u<=0)){var T=M[0].length>>>1;if(!(T<=0)){var V,I=k.mallocDouble(2*T*n),t=k.mallocInt32(n);if((n=J(M,T,I,t))>0){if(1===T&&x)a.init(n),V=a.sweepComplete(T,b,0,n,I,t,0,n,I,t);else{var y=k.mallocDouble(2*T*u),B=k.mallocInt32(u);(u=J(E,T,y,B))>0&&(a.init(n+u),V=1===T?a.sweepBipartite(T,b,0,n,I,t,0,u,y,B):g(T,b,x,n,I,t,u,y,B),k.free(y),k.free(B))}k.free(I),k.free(t)}return V}}}function T(M,E){x.push([M,E])}},12360:(M,E)=>{"use strict";var b="d",x="ax",k="fp",a="es",g="rs",n="re",J="rb",u="bs",T="be",V="bb",I=[b,x,"vv",g,n,J,"ri",u,T,V,"bi"];function t(M){var E="bruteForce"+(M?"Full":"Partial"),x=[],g=I.slice();M||g.splice(3,0,k);var n=["function "+E+"("+g.join()+"){"];function J(E,k){var g=function(M,E,x){var k="bruteForce"+(M?"Red":"Blue")+(E?"Flip":"")+(x?"Full":""),g=["function ",k,"(",I.join(),"){","var ",a,"=2*",b,";"],n="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",J="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(x?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return M?g.push(n,"Q",":",J):g.push(J,"Q",":",n),x?g.push("if(y1<x0||x1<y0)continue;"):E?g.push("if(y0<=x0||x1<y0)continue;"):g.push("if(y0<x0||x1<y0)continue;"),g.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),E?g.push("yi,xi"):g.push("xi,yi"),g.push(");if(rv!==void 0)return rv;}}}"),{name:k,code:g.join("")}}(E,k,M);x.push(g.code),n.push("return "+g.name+"("+I.join()+");")}n.push("if(re-rs>be-bs){"),M?(J(!0,!1),n.push("}else{"),J(!1,!1)):(n.push("if(fp){"),J(!0,!0),n.push("}else{"),J(!0,!1),n.push("}}else{if(fp){"),J(!1,!0),n.push("}else{"),J(!1,!1),n.push("}")),n.push("}}return "+E);var u=x.join("")+n.join("");return new Function(u)()}E.partial=t(!1),E.full=t(!0)},12353:(M,E,b)=>{"use strict";M.exports=function(M,E,b,a,T,h,Z,O,p){!function(M,E){var b=8*k.log2(E+1)*(M+1)|0,a=k.nextPow2(w*b);X.length<a&&(x.free(X),X=x.mallocInt32(a));var g=k.nextPow2(S*b);U.length<g&&(x.free(U),U=x.mallocDouble(g))}(M,a+Z);var P,F=0,l=2*M;v(F++,0,0,a,0,Z,b?16:0,-1/0,1/0),b||v(F++,0,0,Z,0,a,1,-1/0,1/0);for(;F>0;){var d=(F-=1)*w,W=X[d],m=X[d+1],o=X[d+2],j=X[d+3],s=X[d+4],q=X[d+5],D=F*S,z=U[D],A=U[D+1],Y=1&q,i=!!(16&q),G=T,H=h,e=O,Q=p;if(Y&&(G=O,H=p,e=T,Q=h),!(2&q&&m>=(o=r(M,W,m,o,G,H,A)))&&!(4&q&&(m=c(M,W,m,o,G,H,z))>=o)){var L=o-m,f=s-j;if(i){if(M*L*(L+f)<t){if(void 0!==(P=J.scanComplete(M,W,E,m,o,G,H,j,s,e,Q)))return P;continue}}else{if(M*Math.min(L,f)<V){if(void 0!==(P=g(M,W,E,Y,m,o,G,H,j,s,e,Q)))return P;continue}if(M*L*f<I){if(void 0!==(P=J.scanBipartite(M,W,E,Y,m,o,G,H,j,s,e,Q)))return P;continue}}var MM=y(M,W,m,o,G,H,z,A);if(m<MM)if(M*(MM-m)<V){if(void 0!==(P=n(M,W+1,E,m,MM,G,H,j,s,e,Q)))return P}else if(W===M-2){if(void 0!==(P=Y?J.sweepBipartite(M,E,j,s,e,Q,m,MM,G,H):J.sweepBipartite(M,E,m,MM,G,H,j,s,e,Q)))return P}else v(F++,W+1,m,MM,j,s,Y,-1/0,1/0),v(F++,W+1,j,s,m,MM,1^Y,-1/0,1/0);if(MM<o){var EM=u(M,W,j,s,e,Q),bM=e[l*EM+W],xM=B(M,W,EM,s,e,Q,bM);if(xM<s&&v(F++,W,MM,o,xM,s,(4|Y)+(i?16:0),bM,A),j<EM&&v(F++,W,MM,o,j,EM,(2|Y)+(i?16:0),z,bM),EM+1===xM){if(void 0!==(P=i?K(M,W,E,MM,o,G,H,EM,e,Q[EM]):N(M,W,E,Y,MM,o,G,H,EM,e,Q[EM])))return P}else if(EM<xM){var kM;if(i){if(MM<(kM=C(M,W,MM,o,G,H,bM))){var aM=B(M,W,MM,kM,G,H,bM);if(W===M-2){if(MM<aM&&void 0!==(P=J.sweepComplete(M,E,MM,aM,G,H,EM,xM,e,Q)))return P;if(aM<kM&&void 0!==(P=J.sweepBipartite(M,E,aM,kM,G,H,EM,xM,e,Q)))return P}else MM<aM&&v(F++,W+1,MM,aM,EM,xM,16,-1/0,1/0),aM<kM&&(v(F++,W+1,aM,kM,EM,xM,0,-1/0,1/0),v(F++,W+1,EM,xM,aM,kM,1,-1/0,1/0))}}else MM<(kM=Y?R(M,W,MM,o,G,H,bM):C(M,W,MM,o,G,H,bM))&&(W===M-2?P=Y?J.sweepBipartite(M,E,EM,xM,e,Q,MM,kM,G,H):J.sweepBipartite(M,E,MM,kM,G,H,EM,xM,e,Q):(v(F++,W+1,MM,kM,EM,xM,Y,-1/0,1/0),v(F++,W+1,EM,xM,MM,kM,1^Y,-1/0,1/0)))}}}}};var x=b(12322),k=b(12325),a=b(12360),g=a.partial,n=a.full,J=b(12338),u=b(12363),T=b(12372),V=128,I=1<<22,t=1<<22,y=T("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),B=T("lo===p0",["p0"]),r=T("lo<p0",["p0"]),c=T("hi<=p0",["p0"]),C=T("lo<=p0&&p0<=hi",["p0"]),R=T("lo<p0&&p0<=hi",["p0"]),w=6,S=2,X=x.mallocInt32(1024),U=x.mallocDouble(1024);function v(M,E,b,x,k,a,g,n,J){var u=w*M;X[u]=E,X[u+1]=b,X[u+2]=x,X[u+3]=k,X[u+4]=a,X[u+5]=g;var T=S*M;U[T]=n,U[T+1]=J}function N(M,E,b,x,k,a,g,n,J,u,T){var V=2*M,I=J*V,t=u[I+E];M:for(var y=k,B=k*V;y<a;++y,B+=V){var r=g[B+E],c=g[B+E+M];if(!(t<r||c<t)&&(!x||t!==r)){for(var C,R=n[y],w=E+1;w<M;++w){r=g[B+w],c=g[B+w+M];var S=u[I+w],X=u[I+w+M];if(c<S||X<r)continue M}if(void 0!==(C=x?b(T,R):b(R,T)))return C}}}function K(M,E,b,x,k,a,g,n,J,u){var T=2*M,V=n*T,I=J[V+E];M:for(var t=x,y=x*T;t<k;++t,y+=T){var B=g[t];if(B!==u){var r=a[y+E],c=a[y+E+M];if(!(I<r||c<I)){for(var C=E+1;C<M;++C){r=a[y+C],c=a[y+C+M];var R=J[V+C],w=J[V+C+M];if(c<R||w<r)continue M}var S=b(B,u);if(void 0!==S)return S}}}}},12363:(M,E,b)=>{"use strict";M.exports=function(M,E,b,g,n,J){if(g<=b+1)return b;var u=b,T=g,V=g+b>>>1,I=2*M,t=V,y=n[I*V+E];for(;u<T;){if(T-u<k){a(M,E,u,T,n,J),y=n[I*V+E];break}var B=T-u,r=Math.random()*B+u|0,c=n[I*r+E],C=Math.random()*B+u|0,R=n[I*C+E],w=Math.random()*B+u|0,S=n[I*w+E];c<=R?S>=R?(t=C,y=R):c>=S?(t=r,y=c):(t=w,y=S):R>=S?(t=C,y=R):S>=c?(t=r,y=c):(t=w,y=S);for(var X=I*(T-1),U=I*t,v=0;v<I;++v,++X,++U){var N=n[X];n[X]=n[U],n[U]=N}var K=J[T-1];J[T-1]=J[t],J[t]=K;for(X=I*(T-1),U=I*(t=x(M,E,u,T-1,n,J,y)),v=0;v<I;++v,++X,++U){N=n[X];n[X]=n[U],n[U]=N}K=J[T-1];if(J[T-1]=J[t],J[t]=K,V<t){for(T=t-1;u<T&&n[I*(T-1)+E]===y;)T-=1;T+=1}else{if(!(t<V))break;for(u=t+1;u<T&&n[I*u+E]===y;)u+=1}}return x(M,E,b,V,n,J,n[I*V+E])};var x=b(12372)("lo<p0",["p0"]),k=8;function a(M,E,b,x,k,a){for(var g=2*M,n=g*(b+1)+E,J=b+1;J<x;++J,n+=g)for(var u=k[n],T=J,V=g*(J-1);T>b&&k[V+E]>u;--T,V-=g){for(var I=V,t=V+g,y=0;y<g;++y,++I,++t){var B=k[I];k[I]=k[t],k[t]=B}var r=a[T];a[T]=a[T-1],a[T-1]=r}}},12372:M=>{"use strict";M.exports=function(M,b){var x="abcdef".split("").concat(b),k=[];M.indexOf("lo")>=0&&k.push("lo=e[k+n]");M.indexOf("hi")>=0&&k.push("hi=e[k+o]");return x.push(E.replace("_",k.join()).replace("$",M)),Function.apply(void 0,x)};var E="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},12345:M=>{"use strict";M.exports=function(M,x){x<=4*E?b(0,x-1,M):u(0,x-1,M)};var E=32;function b(M,E,b){for(var x=2*(M+1),k=M+1;k<=E;++k){for(var a=b[x++],g=b[x++],n=k,J=x-2;n-- >M;){var u=b[J-2],T=b[J-1];if(u<a)break;if(u===a&&T<g)break;b[J]=u,b[J+1]=T,J-=2}b[J]=a,b[J+1]=g}}function x(M,E,b){E*=2;var x=b[M*=2],k=b[M+1];b[M]=b[E],b[M+1]=b[E+1],b[E]=x,b[E+1]=k}function k(M,E,b){E*=2,b[M*=2]=b[E],b[M+1]=b[E+1]}function a(M,E,b,x){E*=2,b*=2;var k=x[M*=2],a=x[M+1];x[M]=x[E],x[M+1]=x[E+1],x[E]=x[b],x[E+1]=x[b+1],x[b]=k,x[b+1]=a}function g(M,E,b,x,k){E*=2,k[M*=2]=k[E],k[E]=b,k[M+1]=k[E+1],k[E+1]=x}function n(M,E,b){E*=2;var x=b[M*=2],k=b[E];return!(x<k)&&(x!==k||b[M+1]>b[E+1])}function J(M,E,b,x){var k=x[M*=2];return k<E||k===E&&x[M+1]<b}function u(M,T,V){var I=(T-M+1)/6|0,t=M+I,y=T-I,B=M+T>>1,r=B-I,c=B+I,C=t,R=r,w=B,S=c,X=y,U=M+1,v=T-1,N=0;n(C,R,V)&&(N=C,C=R,R=N),n(S,X,V)&&(N=S,S=X,X=N),n(C,w,V)&&(N=C,C=w,w=N),n(R,w,V)&&(N=R,R=w,w=N),n(C,S,V)&&(N=C,C=S,S=N),n(w,S,V)&&(N=w,w=S,S=N),n(R,X,V)&&(N=R,R=X,X=N),n(R,w,V)&&(N=R,R=w,w=N),n(S,X,V)&&(N=S,S=X,X=N);for(var K=V[2*R],h=V[2*R+1],Z=V[2*S],O=V[2*S+1],p=2*C,P=2*w,F=2*X,l=2*t,d=2*B,W=2*y,m=0;m<2;++m){var o=V[p+m],j=V[P+m],s=V[F+m];V[l+m]=o,V[d+m]=j,V[W+m]=s}k(r,M,V),k(c,T,V);for(var q=U;q<=v;++q)if(J(q,K,h,V))q!==U&&x(q,U,V),++U;else if(!J(q,Z,O,V))for(;;){if(J(v,Z,O,V)){J(v,K,h,V)?(a(q,U,v,V),++U,--v):(x(q,v,V),--v);break}if(--v<q)break}g(M,U-1,K,h,V),g(T,v+1,Z,O,V),U-2-M<=E?b(M,U-2,V):u(M,U-2,V),T-(v+2)<=E?b(v+2,T,V):u(v+2,T,V),v-U<=E?b(U,v,V):u(U,v,V)}},12338:(M,E,b)=>{"use strict";M.exports={init:function(M){var E=k.nextPow2(M);J.length<E&&(x.free(J),J=x.mallocInt32(E));u.length<E&&(x.free(u),u=x.mallocInt32(E));T.length<E&&(x.free(T),T=x.mallocInt32(E));V.length<E&&(x.free(V),V=x.mallocInt32(E));I.length<E&&(x.free(I),I=x.mallocInt32(E));t.length<E&&(x.free(t),t=x.mallocInt32(E));var b=8*E;y.length<b&&(x.free(y),y=x.mallocDouble(b))},sweepBipartite:function(M,E,b,x,k,n,I,t,c,C){for(var R=0,w=2*M,S=M-1,X=w-1,U=b;U<x;++U){var v=n[U],N=w*U;y[R++]=k[N+S],y[R++]=-(v+1),y[R++]=k[N+X],y[R++]=v}for(U=I;U<t;++U){v=C[U]+g;var K=w*U;y[R++]=c[K+S],y[R++]=-v,y[R++]=c[K+X],y[R++]=v}var h=R>>>1;a(y,h);var Z=0,O=0;for(U=0;U<h;++U){var p=0|y[2*U+1];if(p>=g)B(T,V,O--,p=p-g|0);else if(p>=0)B(J,u,Z--,p);else if(p<=-g){p=-p-g|0;for(var P=0;P<Z;++P){if(void 0!==(F=E(J[P],p)))return F}r(T,V,O++,p)}else{p=-p-1|0;for(P=0;P<O;++P){var F;if(void 0!==(F=E(p,T[P])))return F}r(J,u,Z++,p)}}},sweepComplete:function(M,E,b,x,k,g,n,c,C,R){for(var w=0,S=2*M,X=M-1,U=S-1,v=b;v<x;++v){var N=g[v]+1<<1,K=S*v;y[w++]=k[K+X],y[w++]=-N,y[w++]=k[K+U],y[w++]=N}for(v=n;v<c;++v){N=R[v]+1<<1;var h=S*v;y[w++]=C[h+X],y[w++]=1|-N,y[w++]=C[h+U],y[w++]=1|N}var Z=w>>>1;a(y,Z);var O=0,p=0,P=0;for(v=0;v<Z;++v){var F=0|y[2*v+1],l=1&F;if(v<Z-1&&F>>1===y[2*v+3]>>1&&(l=2,v+=1),F<0){for(var d=-(F>>1)-1,W=0;W<P;++W){if(void 0!==(m=E(I[W],d)))return m}if(0!==l)for(W=0;W<O;++W){if(void 0!==(m=E(J[W],d)))return m}if(1!==l)for(W=0;W<p;++W){var m;if(void 0!==(m=E(T[W],d)))return m}0===l?r(J,u,O++,d):1===l?r(T,V,p++,d):2===l&&r(I,t,P++,d)}else{d=(F>>1)-1;0===l?B(J,u,O--,d):1===l?B(T,V,p--,d):2===l&&B(I,t,P--,d)}}},scanBipartite:function(M,E,b,x,k,n,T,V,I,t,c,C){var R=0,w=2*M,S=E,X=E+M,U=1,v=1;x?v=g:U=g;for(var N=k;N<n;++N){var K=N+U,h=w*N;y[R++]=T[h+S],y[R++]=-K,y[R++]=T[h+X],y[R++]=K}for(N=I;N<t;++N){K=N+v;var Z=w*N;y[R++]=c[Z+S],y[R++]=-K}var O=R>>>1;a(y,O);var p=0;for(N=0;N<O;++N){var P=0|y[2*N+1];if(P<0){var F=!1;if((K=-P)>=g?(F=!x,K-=g):(F=!!x,K-=1),F)r(J,u,p++,K);else{var l=C[K],d=w*K,W=c[d+E+1],m=c[d+E+1+M];M:for(var o=0;o<p;++o){var j=J[o],s=w*j;if(!(m<T[s+E+1]||T[s+E+1+M]<W)){for(var q=E+2;q<M;++q)if(c[d+q+M]<T[s+q]||T[s+q+M]<c[d+q])continue M;var D,z=V[j];if(void 0!==(D=x?b(l,z):b(z,l)))return D}}}}else B(J,u,p--,P-U)}},scanComplete:function(M,E,b,x,k,n,u,T,V,I,t){for(var B=0,r=2*M,c=E,C=E+M,R=x;R<k;++R){var w=R+g,S=r*R;y[B++]=n[S+c],y[B++]=-w,y[B++]=n[S+C],y[B++]=w}for(R=T;R<V;++R){w=R+1;var X=r*R;y[B++]=I[X+c],y[B++]=-w}var U=B>>>1;a(y,U);var v=0;for(R=0;R<U;++R){var N=0|y[2*R+1];if(N<0){if((w=-N)>=g)J[v++]=w-g;else{var K=t[w-=1],h=r*w,Z=I[h+E+1],O=I[h+E+1+M];M:for(var p=0;p<v;++p){var P=J[p],F=u[P];if(F===K)break;var l=r*P;if(!(O<n[l+E+1]||n[l+E+1+M]<Z)){for(var d=E+2;d<M;++d)if(I[h+d+M]<n[l+d]||n[l+d+M]<I[h+d])continue M;var W=b(F,K);if(void 0!==W)return W}}}}else{for(w=N-g,p=v-1;p>=0;--p)if(J[p]===w){for(d=p+1;d<v;++d)J[d-1]=J[d];break}--v}}}};var x=b(12322),k=b(12325),a=b(12345),g=1<<28,n=1024,J=x.mallocInt32(n),u=x.mallocInt32(n),T=x.mallocInt32(n),V=x.mallocInt32(n),I=x.mallocInt32(n),t=x.mallocInt32(n),y=x.mallocDouble(8192);function B(M,E,b,x){var k=E[x],a=M[b-1];M[k]=a,E[a]=k}function r(M,E,b,x){M[b]=x,E[x]=b}},12328:M=>{"use strict";function E(M,b,x){var k=0|M[x];if(k<=0)return[];var a,g=new Array(k);if(x===M.length-1)for(a=0;a<k;++a)g[a]=b;else for(a=0;a<k;++a)g[a]=E(M,b,x+1);return g}M.exports=function(M,b){switch("undefined"===typeof b&&(b=0),typeof M){case"number":if(M>0)return function(M,E){var b,x;for(b=new Array(M),x=0;x<M;++x)b[x]=E;return b}(0|M,b);break;case"object":if("number"===typeof M.length)return E(M,b,0)}return[]}},12276:(M,E,b)=>{M.exports=function(){var M=this;this.components={},this.comps=this.components;var E=this.components,b=1,k={},a=[],g=[],n={timeout:!1,removals:[],multiComps:[]};function J(M,b){var x=E[b],a=k[b],g=a.hash[M];g&&(a.remove(M),x.bb&&(x.multi?(g.forEach((E=>{E&&x.bb(M,E)})),g.length=0):x.bb(M,g)),n.removals.push(a),u())}function u(){n.timeout||(n.timeout=!0,setTimeout(T,1))}function T(){n.timeout=!1,V()}function V(){n.multiComps.length&&function(M){for(var E=0;E<M.length;E++){var{entID:b,data:x}=M[E],k=x.hash[b];if(k){for(var a=0;a<k.length;a++)k[a]||(k.splice(a,1),a--);0===k.length&&(x.remove(b),n.removals.push(x))}}M.length=0}(n.multiComps),n.removals.length&&function(M){for(var E=0;E<M.length;E++){M[E].flush()}M.length=0}(n.removals)}this.Ni=k,this._systems=a,this._renderSystems=g,this.wh=function(E){var x=b++;return Array.isArray(E)&&E.forEach((E=>M.uf(x,E))),x},this.deleteEntity=function(E){return Object.keys(k).forEach((M=>{k[M].hash[E]&&J(E,M)})),M},this.Th=function(M){if(!M)throw new Error("Missing component definition");var b=M.name;if(!b)throw new Error("Component definition must have a name property.");if("string"!==typeof b)throw new Error("Component name must be a string.");if(""===b)throw new Error("Component name must be a non-empty string.");if(k[b])throw new Error(`Component ${b} already exists.`);var n={};return n.name=b,n.multi=!!M.multi,n.order=isNaN(M.order)?99:M.order,n.stateConstructor=M.stateConstructor||null,n.state=M.state||{},n.Df=M.Df||null,n.bb=M.bb||null,n.system=M.system||null,n.Pg=M.Pg||null,E[b]=n,k[b]=new x,k[b]._pendingMultiCleanup=!1,k[b]._multiCleanupIDs=n.multi?[]:null,n.system&&(a.push(b),a.sort(((M,b)=>E[M].order-E[b].order))),n.Pg&&(g.push(b),g.sort(((M,b)=>E[M].order-E[b].order))),b},this.overwriteComponent=function(M,b){var x=E[M];if(!x)throw new Error(`Unknown component: ${M}`);if(!b)throw new Error("Missing component definition");if(x.name!==b.name)throw new Error("Overwriting component must use the same name property.");var n={};n.name=M,n.multi=!!b.multi,n.order=isNaN(b.order)?99:b.order,n.state=b.state||{},n.Df=b.Df||null,n.bb=b.bb||null,n.system=b.system||null,n.Pg=b.Pg||null,E[M]=n,k[M]._pendingMultiCleanup=!1,k[M]._multiCleanupIDs=n.multi?[]:null;var J=a.indexOf(M);n.system&&J<0&&a.push(M),!n.system&&J>=0&&a.splice(J,1),a.sort(((M,b)=>E[M].order-E[b].order));var u=g.indexOf(M);n.Pg&&u<0&&g.push(M),!n.Pg&&u>=0&&g.splice(u,1),g.sort(((M,b)=>E[M].order-E[b].order));var T=n.state;return this.Sg(M).forEach((M=>{for(var E in T)E in M||(M[E]=T[E]);n.Df&&n.Df(M.Og,M)})),M},this.deleteComponent=function(b){var x=k[b];if(!x)throw new Error(`Unknown component: ${b}`);x.flush(),x.list.forEach((M=>{M&&J(M.Og||M[0].Og,b)}));var n=a.indexOf(b),u=g.indexOf(b);return n>-1&&a.splice(n,1),u>-1&&g.splice(u,1),k[b].dispose(),delete k[b],delete E[b],M},this.uf=function(M,b,x){var a,g=E[b],n=k[b];if(!n)throw new Error(`Unknown component: ${b}.`);if(n.hash[M]&&!g.multi)throw new Error(`Entity ${M} already has component: ${b}.`);if(g.stateConstructor){if(!(a=new g.stateConstructor).hasOwnProperty("Og"))throw new Error(`Component ${g.name} stateConstructor type does not have property __id`)}else a=Object.assign({},{Og:M},g.state,x);if(a.Og=M,g.multi){var J=n.hash[M];J||(J=[],n.add(M,J)),J.push(a)}else n.add(M,a);return g.Df&&g.Df(M,a),this},this.Jf=function(M,E){var b=k[E];if(!b)throw new Error(`Unknown component: ${E}.`);return!!b.hash[M]},this.yf=function(E,b){if(!k[b])throw new Error(`Unknown component: ${b}.`);return J(E,b),M},this.getState=function(M,E){var b=k[E];if(!b)throw new Error(`Unknown component: ${E}.`);return b.hash[M]},this.Sg=function(M){var E=k[M];if(!E)throw new Error(`Unknown component: ${M}.`);return V(),E.list},this.uk=function(M){if(!k[M])throw new Error(`Unknown component: ${M}.`);var E=k[M].hash;return M=>E[M]},this.xk=function(M){if(!k[M])throw new Error(`Unknown component: ${M}.`);var E=k[M].hash;return M=>!!E[M]},this.Se=function(b){V();for(var x=0;x<a.length;x++){var g=a[x],n=E[g],J=k[g];n.system(b,J.list),V()}return M},this.render=function(b){V();for(var x=0;x<g.length;x++){var a=g[x],n=E[a],J=k[a];n.Pg(b,J.list),V()}return M},this.removeMultiComponent=function(b,x,a){var g=E[x],J=k[x];if(!J)throw new Error(`Unknown component: ${x}.`);if(!g.multi)throw new Error("removeMultiComponent called on non-multi component");return function(M,E,b,x){var k=b.hash[M];if(k){var a=k[x];a&&(k[x]=null,E.bb&&E.bb(M,a),n.multiComps.push({entID:M,data:b}),u())}}(b,g,J,a),M}};var x=b(12282)},12282:M=>{function E(M,E){var b=M._map[E];if(delete M.hash[E],delete M._map[E],b===M.list.length-1)M.list.pop();else{var x=M.list.pop();if(M.list[b]=x,null===x||null===x[0]){var k=M.list.length;for(var a in M._map)if(M._map[a]===k)return void(M._map[a]=b)}else{var g=x.Og||x[0].Og;M._map[g]=b}}}M.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(M,E){if("number"===typeof this._map[M]){var b=this._map[M];this.hash[M]=E,this.list[b]=E}else this._map[M]=this.list.length,this.hash[M]=E,this.list.push(E)}remove(M){var E=this._map[M];this.hash[M]=null,this.list[E]=null,this._pendingRemovals.push(M)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var M=0;M<this._pendingRemovals.length;M++){var b=this._pendingRemovals[M];null===this.hash[b]&&E(this,b)}this._pendingRemovals.length=0}}},12239:M=>{"use strict";var E,b="object"===typeof Reflect?Reflect:null,x=function(M,E,b){return Function.prototype.apply.call(M,E,b)};E=b&&"function"===typeof b.ownKeys?b.ownKeys:Object.getOwnPropertySymbols?function(M){return Object.getOwnPropertyNames(M).concat(Object.getOwnPropertySymbols(M))}:function(M){return Object.getOwnPropertyNames(M)};var k=Number.isNaN||function(M){return M!==M};function a(){a.init.call(this)}M.exports=a,M.exports.once=function(M,E){return new Promise((function(b,x){function k(b){M.removeListener(E,a),x(b)}function a(){"function"===typeof M.removeListener&&M.removeListener("error",k),b([].slice.call(arguments))}B(M,E,a,{once:!0}),"error"!==E&&function(M,E,b){"function"===typeof M.on&&B(M,"error",E,b)}(M,k,{once:!0})}))},a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var g=10;function n(M){if("function"!==typeof M)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof M)}function J(M){return void 0===M._maxListeners?a.defaultMaxListeners:M._maxListeners}function u(M,E,b,x){var k,a,g,u;if(n(b),void 0===(a=M._events)?(a=M._events=Object.create(null),M._eventsCount=0):(void 0!==a.newListener&&(M.emit("newListener",E,b.listener?b.listener:b),a=M._events),g=a[E]),void 0===g)g=a[E]=b,++M._eventsCount;else if("function"===typeof g?g=a[E]=x?[b,g]:[g,b]:x?g.unshift(b):g.push(b),(k=J(M))>0&&g.length>k&&!g.warned){g.warned=!0;var T=new Error("Possible EventEmitter memory leak detected. "+g.length+" "+String(E)+" listeners added. Use emitter.setMaxListeners() to increase limit");T.name="MaxListenersExceededWarning",T.k=M,T.type=E,T.count=g.length,u=T,console&&console.warn&&console.warn(u)}return M}function T(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function V(M,E,b){var x={fired:!1,wrapFn:void 0,target:M,type:E,listener:b},k=T.bind(x);return k.listener=b,x.wrapFn=k,k}function I(M,E,b){var x=M._events;if(void 0===x)return[];var k=x[E];return void 0===k?[]:"function"===typeof k?b?[k.listener||k]:[k]:b?function(M){for(var E=new Array(M.length),b=0;b<E.length;++b)E[b]=M[b].listener||M[b];return E}(k):y(k,k.length)}function t(M){var E=this._events;if(void 0!==E){var b=E[M];if("function"===typeof b)return 1;if(void 0!==b)return b.length}return 0}function y(M,E){for(var b=new Array(E),x=0;x<E;++x)b[x]=M[x];return b}function B(M,E,b,x){if("function"===typeof M.on)x.once?M.once(E,b):M.on(E,b);else{if("function"!==typeof M.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof M);M.addEventListener(E,(function k(a){x.once&&M.removeEventListener(E,k),b(a)}))}}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return g},set:function(M){if("number"!==typeof M||M<0||k(M))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+M+".");g=M}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(M){if("number"!==typeof M||M<0||k(M))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+M+".");return this._maxListeners=M,this},a.prototype.getMaxListeners=function(){return J(this)},a.prototype.emit=function(M){for(var E=[],b=1;b<arguments.length;b++)E.push(arguments[b]);var k="error"===M,a=this._events;if(void 0!==a)k=k&&void 0===a.error;else if(!k)return!1;if(k){var g;if(E.length>0&&(g=E[0]),g instanceof Error)throw g;var n=new Error("Unhandled error."+(g?" ("+g.message+")":""));throw n.context=g,n}var J=a[M];if(void 0===J)return!1;if("function"===typeof J)x(J,this,E);else{var u=J.length,T=y(J,u);for(b=0;b<u;++b)x(T[b],this,E)}return!0},a.prototype.addListener=function(M,E){return u(this,M,E,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(M,E){return u(this,M,E,!0)},a.prototype.once=function(M,E){return n(E),this.on(M,V(this,M,E)),this},a.prototype.prependOnceListener=function(M,E){return n(E),this.prependListener(M,V(this,M,E)),this},a.prototype.removeListener=function(M,E){var b,x,k,a,g;if(n(E),void 0===(x=this._events))return this;if(void 0===(b=x[M]))return this;if(b===E||b.listener===E)0===--this._eventsCount?this._events=Object.create(null):(delete x[M],x.removeListener&&this.emit("removeListener",M,b.listener||E));else if("function"!==typeof b){for(k=-1,a=b.length-1;a>=0;a--)if(b[a]===E||b[a].listener===E){g=b[a].listener,k=a;break}if(k<0)return this;0===k?b.shift():function(M,E){for(;E+1<M.length;E++)M[E]=M[E+1];M.pop()}(b,k),1===b.length&&(x[M]=b[0]),void 0!==x.removeListener&&this.emit("removeListener",M,g||E)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(M){var E,b,x;if(void 0===(b=this._events))return this;if(void 0===b.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==b[M]&&(0===--this._eventsCount?this._events=Object.create(null):delete b[M]),this;if(0===arguments.length){var k,a=Object.keys(b);for(x=0;x<a.length;++x)"removeListener"!==(k=a[x])&&this.removeAllListeners(k);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(E=b[M]))this.removeListener(M,E);else if(void 0!==E)for(x=E.length-1;x>=0;x--)this.removeListener(M,E[x]);return this},a.prototype.listeners=function(M){return I(this,M,!0)},a.prototype.rawListeners=function(M){return I(this,M,!1)},a.listenerCount=function(M,E){return"function"===typeof M.listenerCount?M.listenerCount(E):t.call(M,E)},a.prototype.listenerCount=t,a.prototype.eventNames=function(){return this._eventsCount>0?E(this._events):[]}},12561:M=>{"use strict";M.exports=function(M,E,b,x,k,a){var g=+E[0],n=+E[1],J=+E[2],u=+b[0],T=+b[1],V=+b[2],I=Math.sqrt(u*u+T*T+V*V);if(0===I)throw new Error("Can't raycast along a zero vector");return function(M,E,b,x,k,a,g,n,J,u){for(var T=0,V=Math.floor,I=0|V(E),t=0|V(b),y=0|V(x),B=k>0?1:-1,r=a>0?1:-1,c=g>0?1:-1,C=Math.abs(1/k),R=Math.abs(1/a),w=Math.abs(1/g),S=C<1/0?C*(B>0?I+1-E:E-I):1/0,X=R<1/0?R*(r>0?t+1-b:b-t):1/0,U=w<1/0?w*(c>0?y+1-x:x-y):1/0,v=-1;T<=n;){var N=M(I,t,y);if(N)return J&&(J[0]=E+T*k,J[1]=b+T*a,J[2]=x+T*g),u&&(u[0]=u[1]=u[2]=0,0===v&&(u[0]=-B),1===v&&(u[1]=-r),2===v&&(u[2]=-c)),N;S<X?S<U?(I+=B,T=S,S+=C,v=0):(y+=c,T=U,U+=w,v=2):X<U?(t+=r,T=X,X+=R,v=1):(y+=c,T=U,U+=w,v=2)}return J&&(J[0]=E+T*k,J[1]=b+T*a,J[2]=x+T*g),u&&(u[0]=u[1]=u[2]=0),0}(M,g,n,J,u/=I,T/=I,V/=I,x="undefined"===typeof x?64:+x,k,a)}},12599:(M,E,b)=>{"use strict";b.d(E,{c:()=>a});var x=b(12239);function k(){this.uj=!1,this.stopPropagation=!1,this.vj=!1,this.disabled=!1}class a{constructor(M,E){this.version="0.7.0";var b=Object.assign({},new k,E||{});this.element=M||document,this.uj=!!b.uj,this.stopPropagation=!!b.stopPropagation,this.vj=!!b.vj,this.disabled=!!b.disabled,this.filterEvents=(M,E)=>!0,this.down=new x.EventEmitter,this.up=new x.EventEmitter,this.state={},this.Hg={dx:0,dy:0,kk:0,Gg:0,lk:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?n(this):document.addEventListener("DOMContentLoaded",(M=>{n(this)}),{once:!0})}bind(M){for(var E=arguments.length,b=new Array(E>1?E-1:0),x=1;x<E;x++)b[x-1]=arguments[x];b.forEach((E=>{var b=this._keyBindmap[E]||[];b.includes(M)||(b.push(M),this._keyBindmap[E]=b)})),this.state[M]=!!this.state[M],this.pressCount[M]=this.pressCount[M]||0,this.releaseCount[M]=this.releaseCount[M]||0}unbind(M){for(var E in this._keyBindmap){var b=this._keyBindmap[E],x=b.indexOf(M);x>-1&&b.splice(x,1)}}getBindings(){var M={};for(var E in this._keyBindmap){this._keyBindmap[E].forEach((b=>{M[b]=M[b]||[],M[b].push(E)}))}return M}Se(){g(this.Hg),g(this.pressCount),g(this.releaseCount)}}function g(M){for(var E in M)M[E]=0}function n(M){window.addEventListener("keydown",y.bind(null,M,!0),!1),window.addEventListener("keyup",y.bind(null,M,!1),!1);var E={passive:!0};M.element.addEventListener("touchstart",V.bind(void 0,M),{passive:!1}),M.element.addEventListener("touchend",t.bind(void 0,M),E),M.element.addEventListener("mousedown",B.bind(null,M,!0),E),window.document.addEventListener("mouseup",B.bind(null,M,!1),E),M.element.addEventListener("touchmove",r.bind(null,M),E),M.element.addEventListener("mousemove",r.bind(null,M),E),window.PointerEvent,M.element.addEventListener("wheel",c.bind(null,M),E),M.element.addEventListener("contextmenu",C.bind(null,M),!1),window.addEventListener("blur",R.bind(null,M),!1)}var J=0,u=0,T=null;function V(M,E){E.preventDefault(),I(E)}function I(M){let E=!1;for(let b=0;b<M.touches.length;++b)if(M.touches[b].identifier===T){E=!0;break}if(!E){const E=M.changedTouches[0];J=E.clientX,u=E.clientY,T=E.identifier}}function t(M,E){for(var b=E.changedTouches,x=0;x<b.length;++x)b[x].identifier===T&&(T=null)}function y(M,E,b){w(b.code,E,M,b)}function B(M,E,b){if("pointerId"in b)if(E){if(null!==M._touches.currID)return;M._touches.currID=b.pointerId}else{if(M._touches.currID!==b.pointerId)return;M._touches.currID=null}return w("Mouse"+("button"in b?b.button+1:1),E,M,b),!1}function r(M,E){var b=E.movementX||E.mozMovementX||0,x=E.movementY||E.mozMovementY||0;if(E.touches&&0===(b|x)){var k=function(M){I(M);for(let E=0;E<M.changedTouches.length;++E)if(M.changedTouches[E].identifier==T){const b=M.changedTouches[E],x=[b.clientX-J,b.clientY-u];return J=b.clientX,u=b.clientY,x}return console.error(`Did not find touch id ${T}`),[0,0]}(E);b=k[0],x=k[1]}M.Hg.dx+=b,M.Hg.dy+=x}function c(M,E){var b=1;switch(E.deltaMode){case 0:b=1;break;case 1:b=12;break;case 2:b=M.element.clientHeight||window.innerHeight}M.Hg.kk+=(E.deltaX||0)*b,M.Hg.Gg+=(E.deltaY||0)*b,M.Hg.lk+=(E.deltaZ||0)*b}function C(M,E){if(!M.vj)return E.preventDefault(),!1}function R(M){for(var E in M._keyStates)M._keyStates[E]&&(/^Mouse\d/.test(E)||w(E,!1,M,{code:E,note:"This is a mocked KeyboardEvent made by the 'game-inputs' module",preventDefault:()=>{},stopPropagation:()=>{}}))}function w(M,E,b,x){var k=b._keyBindmap[M];k&&(S(b._keyStates[M],E)&&(b._keyStates[M]=E,k.forEach((M=>{(!b.filterEvents||b.filterEvents(x,M))&&function(M,E,b,x){var k=E?b.pressCount:b.releaseCount;k[M]=(k[M]||0)+1;var a=b._bindPressCount[M]||0;(a+=E?1:-1)<0&&(a=0);b._bindPressCount[M]=a;var g=b.state[M];if(S(g,a)){b.state[M]=a>0;var n=E?b.down:b.up;b.disabled||n.emit(M,x)}}(M,E,b,x)}))),"button"in x||(b.uj&&!x.defaultPrevented&&x.preventDefault(),b.stopPropagation&&x.stopPropagation()))}function S(M,E){return M?!E:E}},11920:M=>{M.exports=function(M,E,b){return M[0]=E[0]+b[0],M[1]=E[1]+b[1],M[2]=E[2]+b[2],M}},11882:(M,E,b)=>{M.exports=function(M,E){var b=x(M[0],M[1],M[2]),g=x(E[0],E[1],E[2]);k(b,b),k(g,g);var n=a(b,g);return n>1?0:Math.acos(n)};var x=b(11884),k=b(11893),a=b(11895)},11965:M=>{M.exports=function(M,E){return M[0]=Math.ceil(E[0]),M[1]=Math.ceil(E[1]),M[2]=Math.ceil(E[2]),M}},11878:M=>{M.exports=function(M){var E=new Float32Array(3);return E[0]=M[0],E[1]=M[1],E[2]=M[2],E}},11899:M=>{M.exports=function(M,E){return M[0]=E[0],M[1]=E[1],M[2]=E[2],M}},11875:M=>{M.exports=function(){var M=new Float32Array(3);return M[0]=0,M[1]=0,M[2]=0,M}},12040:M=>{M.exports=function(M,E,b){var x=E[0],k=E[1],a=E[2],g=b[0],n=b[1],J=b[2];return M[0]=k*J-a*n,M[1]=a*g-x*J,M[2]=x*n-k*g,M}},11983:(M,E,b)=>{M.exports=b(11981)},11981:M=>{M.exports=function(M,E){var b=E[0]-M[0],x=E[1]-M[1],k=E[2]-M[2];return Math.sqrt(b*b+x*x+k*k)}},11946:(M,E,b)=>{M.exports=b(11943)},11943:M=>{M.exports=function(M,E,b){return M[0]=E[0]/b[0],M[1]=E[1]/b[1],M[2]=E[2]/b[2],M}},11895:M=>{M.exports=function(M,E){return M[0]*E[0]+M[1]*E[1]+M[2]*E[2]}},11868:M=>{M.exports=1e-6},11905:(M,E,b)=>{M.exports=function(M,E){var b=M[0],k=M[1],a=M[2],g=E[0],n=E[1],J=E[2];return Math.abs(b-g)<=x*Math.max(1,Math.abs(b),Math.abs(g))&&Math.abs(k-n)<=x*Math.max(1,Math.abs(k),Math.abs(n))&&Math.abs(a-J)<=x*Math.max(1,Math.abs(a),Math.abs(J))};var x=b(11868)},11913:M=>{M.exports=function(M,E){return M[0]===E[0]&&M[1]===E[1]&&M[2]===E[2]}},11961:M=>{M.exports=function(M,E){return M[0]=Math.floor(E[0]),M[1]=Math.floor(E[1]),M[2]=Math.floor(E[2]),M}},12086:(M,E,b)=>{M.exports=function(M,E,b,k,a,g){var n,J;E||(E=3);b||(b=0);J=k?Math.min(k*E+b,M.length):M.length;for(n=b;n<J;n+=E)x[0]=M[n],x[1]=M[n+1],x[2]=M[n+2],a(x,x,g),M[n]=x[0],M[n+1]=x[1],M[n+2]=x[2];return M};var x=b(11875)()},11884:M=>{M.exports=function(M,E,b){var x=new Float32Array(3);return x[0]=M,x[1]=E,x[2]=b,x}},11862:(M,E,b)=>{M.exports={EPSILON:b(11868),create:b(11875),clone:b(11878),angle:b(11882),nd:b(11884),j:b(11899),set:b(11903),equals:b(11905),exactEquals:b(11913),add:b(11920),Qc:b(11923),sub:b(11927),multiply:b(11934),mul:b(11939),divide:b(11943),div:b(11946),min:b(11954),max:b(11956),floor:b(11961),ceil:b(11965),round:b(11970),scale:b(11973),od:b(11979),distance:b(11981),dist:b(11983),qd:b(11989),sqrDist:b(11996),length:b(12003),len:b(12008),squaredLength:b(12014),rd:b(12022),negate:b(12028),inverse:b(12032),normalize:b(11893),dot:b(11895),cross:b(12040),dd:b(12043),random:b(12048),transformMat4:b(12057),transformMat3:b(12059),transformQuat:b(12065),td:b(12072),ud:b(12081),xd:b(12083),forEach:b(12086)}},12032:M=>{M.exports=function(M,E){return M[0]=1/E[0],M[1]=1/E[1],M[2]=1/E[2],M}},12008:(M,E,b)=>{M.exports=b(12003)},12003:M=>{M.exports=function(M){var E=M[0],b=M[1],x=M[2];return Math.sqrt(E*E+b*b+x*x)}},12043:M=>{M.exports=function(M,E,b,x){var k=E[0],a=E[1],g=E[2];return M[0]=k+x*(b[0]-k),M[1]=a+x*(b[1]-a),M[2]=g+x*(b[2]-g),M}},11956:M=>{M.exports=function(M,E,b){return M[0]=Math.max(E[0],b[0]),M[1]=Math.max(E[1],b[1]),M[2]=Math.max(E[2],b[2]),M}},11954:M=>{M.exports=function(M,E,b){return M[0]=Math.min(E[0],b[0]),M[1]=Math.min(E[1],b[1]),M[2]=Math.min(E[2],b[2]),M}},11939:(M,E,b)=>{M.exports=b(11934)},11934:M=>{M.exports=function(M,E,b){return M[0]=E[0]*b[0],M[1]=E[1]*b[1],M[2]=E[2]*b[2],M}},12028:M=>{M.exports=function(M,E){return M[0]=-E[0],M[1]=-E[1],M[2]=-E[2],M}},11893:M=>{M.exports=function(M,E){var b=E[0],x=E[1],k=E[2],a=b*b+x*x+k*k;a>0&&(a=1/Math.sqrt(a),M[0]=E[0]*a,M[1]=E[1]*a,M[2]=E[2]*a);return M}},12048:M=>{M.exports=function(M,E){E=E||1;var b=2*Math.random()*Math.PI,x=2*Math.random()-1,k=Math.sqrt(1-x*x)*E;return M[0]=Math.cos(b)*k,M[1]=Math.sin(b)*k,M[2]=x*E,M}},12072:M=>{M.exports=function(M,E,b,x){var k=b[1],a=b[2],g=E[1]-k,n=E[2]-a,J=Math.sin(x),u=Math.cos(x);return M[0]=E[0],M[1]=k+g*u-n*J,M[2]=a+g*J+n*u,M}},12081:M=>{M.exports=function(M,E,b,x){var k=b[0],a=b[2],g=E[0]-k,n=E[2]-a,J=Math.sin(x),u=Math.cos(x);return M[0]=k+n*J+g*u,M[1]=E[1],M[2]=a+n*u-g*J,M}},12083:M=>{M.exports=function(M,E,b,x){var k=b[0],a=b[1],g=E[0]-k,n=E[1]-a,J=Math.sin(x),u=Math.cos(x);return M[0]=k+g*u-n*J,M[1]=a+g*J+n*u,M[2]=E[2],M}},11970:M=>{M.exports=function(M,E){return M[0]=Math.round(E[0]),M[1]=Math.round(E[1]),M[2]=Math.round(E[2]),M}},11973:M=>{M.exports=function(M,E,b){return M[0]=E[0]*b,M[1]=E[1]*b,M[2]=E[2]*b,M}},11979:M=>{M.exports=function(M,E,b,x){return M[0]=E[0]+b[0]*x,M[1]=E[1]+b[1]*x,M[2]=E[2]+b[2]*x,M}},11903:M=>{M.exports=function(M,E,b,x){return M[0]=E,M[1]=b,M[2]=x,M}},11996:(M,E,b)=>{M.exports=b(11989)},12022:(M,E,b)=>{M.exports=b(12014)},11989:M=>{M.exports=function(M,E){var b=E[0]-M[0],x=E[1]-M[1],k=E[2]-M[2];return b*b+x*x+k*k}},12014:M=>{M.exports=function(M){var E=M[0],b=M[1],x=M[2];return E*E+b*b+x*x}},11927:(M,E,b)=>{M.exports=b(11923)},11923:M=>{M.exports=function(M,E,b){return M[0]=E[0]-b[0],M[1]=E[1]-b[1],M[2]=E[2]-b[2],M}},12059:M=>{M.exports=function(M,E,b){var x=E[0],k=E[1],a=E[2];return M[0]=x*b[0]+k*b[3]+a*b[6],M[1]=x*b[1]+k*b[4]+a*b[7],M[2]=x*b[2]+k*b[5]+a*b[8],M}},12057:M=>{M.exports=function(M,E,b){var x=E[0],k=E[1],a=E[2],g=b[3]*x+b[7]*k+b[11]*a+b[15];return g=g||1,M[0]=(b[0]*x+b[4]*k+b[8]*a+b[12])/g,M[1]=(b[1]*x+b[5]*k+b[9]*a+b[13])/g,M[2]=(b[2]*x+b[6]*k+b[10]*a+b[14])/g,M}},12065:M=>{M.exports=function(M,E,b){var x=E[0],k=E[1],a=E[2],g=b[0],n=b[1],J=b[2],u=b[3],T=u*x+n*a-J*k,V=u*k+J*x-g*a,I=u*a+g*k-n*x,t=-g*x-n*k-J*a;return M[0]=T*u+t*-g+V*-J-I*-n,M[1]=V*u+t*-n+I*-g-T*-J,M[2]=I*u+t*-J+T*-n-V*-g,M}},12260:M=>{"use strict";M.exports=function(M){for(var E=new Array(M),b=0;b<M;++b)E[b]=b;return E}},12332:M=>{M.exports=function(M){return null!=M&&null!=M.constructor&&"function"===typeof M.constructor.isBuffer&&M.constructor.isBuffer(M)}},12570:(M,E,b)=>{"use strict";b.d(E,{d:()=>x});class x{constructor(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.mi=!1,this.ni=!1,this.ki=30,this.li=0,this.wi=!1,this.fullscreen=!1,this.pi=function(M){},this.qi=function(){},this.ti=function(){},this.cb=function(){},this.ri=function(M){},this.onFullscreenChanged=function(M){},u((()=>{!function(M,E){M._nowObject=performance||Date,M._lastTick=0,M._renderAccum=0,M._rt=0,M._frameCB=n.bind(null,M),requestAnimationFrame(M._frameCB),E>0&&(M._intervalCB=g.bind(null,M),M._interval=setInterval(M._intervalCB,Math.max(E,1e3/M.ki/2)))}(this,E),function(M,E){if(!E)return;var b=!1,x=!1;document.addEventListener("pointerlockchange",(x=>{b=document.pointerLockElement===E,M.ri(b)})),document.addEventListener("fullscreenchange",(b=>{x=document.fullscreenElement===E,M.onFullscreenChanged(x)})),Object.defineProperty(M,"wi",{get:()=>b,set:M=>{M&&!b?J(E):b&&!M&&function(M){M.exitPointerLock&&M.exitPointerLock()}(document)}}),Object.defineProperty(M,"fullscreen",{get:()=>x,set:M=>{M&&!x?E.requestFullscreen():x&&!M&&document.exitFullscreen()}}),E.addEventListener("click",(k=>{M.mi&&!b&&J(E),M.ni&&!x&&E.requestFullscreen()}));var k=()=>M.cb();if(window.ResizeObserver){new ResizeObserver(k).observe(E)}else window.addEventListener("resize",k)}(this,M),this.ti()}))}}var k=3,a=20;function g(M){for(var E=1e3/M.ki,b=M._nowObject.now()+a,x=0;M._nowObject.now()>=M._lastTick+E&&M._nowObject.now()<b&&++x<=k;)M.pi(E),M._lastTick+=E;var g=5*(E+5),n=M._nowObject.now();if(n-M._lastTick>g)for(;n>=M._lastTick+E;)M._lastTick+=E}function n(M){requestAnimationFrame(M._frameCB),g(M);var E=M._nowObject.now(),b=E-M._rt;if(M._rt=E,M.li>0){M._renderAccum+=b;var x=1e3/M.li;if(M._renderAccum<x)return;M._renderAccum=Math.min(M._renderAccum-x,x)}var k=1e3/M.ki,a=(E-M._lastTick)/k;M.qi(b,a,k)}function J(M){M.requestPointerLock&&M.requestPointerLock()}var u=M=>{if("loading"===document.readyState){var E=()=>{document.removeEventListener("readystatechange",E),M()};document.addEventListener("readystatechange",E)}else setTimeout(M,1)}},12258:(M,E,b)=>{var x=b(12260),k=b(12269),a="undefined"!==typeof Float64Array;function g(M,E){return M[0]-E[0]}function n(){var M,E=this.stride,b=new Array(E.length);for(M=0;M<b.length;++M)b[M]=[Math.abs(E[M]),M];b.sort(g);var x=new Array(b.length);for(M=0;M<x.length;++M)x[M]=b[M][1];return x}function J(M,E){var b=["View",E,"d",M].join("");E<0&&(b="View_Nil"+M);var k="generic"===M;if(-1===E){var a="function "+b+"(a){this.data=a;};var proto="+b+".prototype;proto.dtype='"+M+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+b+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+b+"(a){return new "+b+"(a);}";return new Function(a)()}if(0===E){a="function "+b+"(a,d) {this.data = a;this.offset = d};var proto="+b+".prototype;proto.dtype='"+M+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+b+"_copy() {return new "+b+"(this.data,this.offset)};proto.pick=function "+b+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+b+"_get(){return "+(k?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+b+"_set(v){return "+(k?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+b+"(a,b,c,d){return new "+b+"(a,d)}";return new Function("TrivialArray",a)(u[M][0])}a=["'use strict'"];var g=x(E),J=g.map((function(M){return"i"+M})),T="this.offset+"+g.map((function(M){return"this.stride["+M+"]*i"+M})).join("+"),V=g.map((function(M){return"b"+M})).join(","),I=g.map((function(M){return"c"+M})).join(",");a.push("function "+b+"(a,"+V+","+I+",d){this.data=a","this.shape=["+V+"]","this.stride=["+I+"]","this.offset=d|0}","var proto="+b+".prototype","proto.dtype='"+M+"'","proto.dimension="+E),a.push("Object.defineProperty(proto,'size',{get:function "+b+"_size(){return "+g.map((function(M){return"this.shape["+M+"]"})).join("*"),"}})"),1===E?a.push("proto.order=[0]"):(a.push("Object.defineProperty(proto,'order',{get:"),E<4?(a.push("function "+b+"_order(){"),2===E?a.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===E&&a.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):a.push("ORDER})")),a.push("proto.set=function "+b+"_set("+J.join(",")+",v){"),k?a.push("return this.data.set("+T+",v)}"):a.push("return this.data["+T+"]=v}"),a.push("proto.get=function "+b+"_get("+J.join(",")+"){"),k?a.push("return this.data.get("+T+")}"):a.push("return this.data["+T+"]}"),a.push("proto.index=function "+b+"_index(",J.join(),"){return "+T+"}"),a.push("proto.hi=function "+b+"_hi("+J.join(",")+"){return new "+b+"(this.data,"+g.map((function(M){return["(typeof i",M,"!=='number'||i",M,"<0)?this.shape[",M,"]:i",M,"|0"].join("")})).join(",")+","+g.map((function(M){return"this.stride["+M+"]"})).join(",")+",this.offset)}");var t=g.map((function(M){return"a"+M+"=this.shape["+M+"]"})),y=g.map((function(M){return"c"+M+"=this.stride["+M+"]"}));a.push("proto.lo=function "+b+"_lo("+J.join(",")+"){var b=this.offset,d=0,"+t.join(",")+","+y.join(","));for(var B=0;B<E;++B)a.push("if(typeof i"+B+"==='number'&&i"+B+">=0){d=i"+B+"|0;b+=c"+B+"*d;a"+B+"-=d}");a.push("return new "+b+"(this.data,"+g.map((function(M){return"a"+M})).join(",")+","+g.map((function(M){return"c"+M})).join(",")+",b)}"),a.push("proto.step=function "+b+"_step("+J.join(",")+"){var "+g.map((function(M){return"a"+M+"=this.shape["+M+"]"})).join(",")+","+g.map((function(M){return"b"+M+"=this.stride["+M+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(B=0;B<E;++B)a.push("if(typeof i"+B+"==='number'){d=i"+B+"|0;if(d<0){c+=b"+B+"*(a"+B+"-1);a"+B+"=ceil(-a"+B+"/d)}else{a"+B+"=ceil(a"+B+"/d)}b"+B+"*=d}");a.push("return new "+b+"(this.data,"+g.map((function(M){return"a"+M})).join(",")+","+g.map((function(M){return"b"+M})).join(",")+",c)}");var r=new Array(E),c=new Array(E);for(B=0;B<E;++B)r[B]="a[i"+B+"]",c[B]="b[i"+B+"]";a.push("proto.transpose=function "+b+"_transpose("+J+"){"+J.map((function(M,E){return M+"=("+M+"===undefined?"+E+":"+M+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+b+"(this.data,"+r.join(",")+","+c.join(",")+",this.offset)}"),a.push("proto.pick=function "+b+"_pick("+J+"){var a=[],b=[],c=this.offset");for(B=0;B<E;++B)a.push("if(typeof i"+B+"==='number'&&i"+B+">=0){c=(c+this.stride["+B+"]*i"+B+")|0}else{a.push(this.shape["+B+"]);b.push(this.stride["+B+"])}");return a.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),a.push("return function construct_"+b+"(data,shape,stride,offset){return new "+b+"(data,"+g.map((function(M){return"shape["+M+"]"})).join(",")+","+g.map((function(M){return"stride["+M+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",a.join("\n"))(u[M],n)}var u={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};M.exports=function(M,E,b,x){if(void 0===M)return(0,u.array[0])([]);"number"===typeof M&&(M=[M]),void 0===E&&(E=[M.length]);var g=E.length;if(void 0===b){b=new Array(g);for(var n=g-1,T=1;n>=0;--n)b[n]=T,T*=E[n]}if(void 0===x){x=0;for(n=0;n<g;++n)b[n]<0&&(x-=(E[n]-1)*b[n])}for(var V=function(M){if(k(M))return"buffer";if(a)switch(Object.prototype.toString.call(M)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(M)?"array":"generic"}(M),I=u[V];I.length<=g+1;)I.push(J(V,I.length-1));return(0,I[g+1])(M,E,b,x)}},12269:M=>{function E(M){return!!M.constructor&&"function"===typeof M.constructor.isBuffer&&M.constructor.isBuffer(M)}M.exports=function(M){return null!=M&&(E(M)||function(M){return"function"===typeof M.readFloatLE&&"function"===typeof M.slice&&E(M.slice(0,0))}(M)||!!M._isBuffer)}},12422:M=>{"use strict";var E=[],b=[],x=[],k=[],a=[],g=[],n=[],J=[],u=[],T=[],V=[],I=[];M.exports=function(M,t,y,B,r,c){for(var C=n,R=u,w=T,S=I,X=0;X<3;X++)C[X]=+y[X],w[X]=+t.max[X],R[X]=+t.zd[X];c||(c=1e-10);var U=function(M,n,u,T,I,t){var y=E,B=b,r=x,c=k,C=a,R=g,w=J,S=Math.floor,X=0,U=0,v=0,N=0,K=0;if(h(),0===v)return 0;for(N=p();U<=v;){if(Z(N)&&O())return X;N=p()}for(X+=v,K=0;K<3;K++)T[K]+=u[K],I[K]+=u[K];return X;function h(){if(U=0,0!==(v=Math.sqrt(u[0]*u[0]+u[1]*u[1]+u[2]*u[2])))for(var M=0;M<3;M++){var E=u[M]>=0;c[M]=E?1:-1;var b=E?I[M]:T[M];y[M]=E?T[M]:I[M],B[M]=P(b,c[M]),r[M]=F(y[M],c[M]),w[M]=u[M]/v,C[M]=Math.abs(1/w[M]);var x=E?B[M]+1-b:b-B[M];R[M]=C[M]<1/0?C[M]*x:1/0}}function Z(E){for(var b=c[0],x=0===E?B[0]:r[0],k=B[0]+b,a=c[1],g=1===E?B[1]:r[1],n=B[1]+a,J=c[2],u=2===E?B[2]:r[2],T=B[2]+J,V=x;V!=k;V+=b)for(var I=g;I!=n;I+=a)for(var t=u;t!=T;t+=J)if(M(V,I,t))return!0;return!1}function O(){X+=U;var M=c[N],E=U/v,b=V;for(K=0;K<3;K++){var x=u[K]*E;T[K]+=x,I[K]+=x,b[K]=u[K]-x}if(M>0?I[N]=Math.round(I[N]):T[N]=Math.round(T[N]),n(X,N,M,b))return!0;for(K=0;K<3;K++)u[K]=b[K];return h(),0===v}function p(){var M=R[0]<R[1]?R[0]<R[2]?0:2:R[1]<R[2]?1:2,E=R[M]-U;for(U=R[M],B[M]+=c[M],R[M]+=C[M],K=0;K<3;K++)y[K]+=E*w[K],r[K]=F(y[K],c[K]);return M}function P(M,E){return S(M-E*t)}function F(M,E){return S(M+E*t)}}(M,B,C,R,w,c);if(!r){for(X=0;X<3;X++)S[X]=y[X]>0?w[X]-t.max[X]:R[X]-t.zd[X];t.translate(S)}return U}},12608:(M,E,b)=>{"use strict";b.d(E,{b:()=>V});var x=b(12420),k=b(11862);class a{constructor(M,E,b,a,g,n,J){this.Rg=new x(M.zd,M.rh),this.mass=E,this.friction=b,this.restitution=a,this.Tc=g,this.Fk=n,this.Uc=!!J,this.qh=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.sl=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.gg=k.create(),this.Ng=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=k.create(),this._impulses=k.create(),this._sleepFrameCount=10}loadFromCopy(M){k.j(this.Rg.zd,M.Rg.zd),k.j(this.Rg.rh,M.Rg.rh),k.j(this.Rg.max,M.Rg.max),this.Rg.mag=M.Rg.mag,this.mass=M.mass,this.friction=M.friction,this.restitution=M.restitution,this.Tc=M.Tc,this.Fk=M.Fk,this.Uc=M.Uc,this.qh=M.qh,this.fluidDrag=M.fluidDrag,this.sl=M.sl,this.preventFallOffEdge=M.preventFallOffEdge,this.rolledBackLastTick=M.rolledBackLastTick,k.j(this.gg,M.gg),k.j(this.Ng,M.Ng),this.inFluid=M.inFluid,this._ratioInFluid=M._ratioInFluid,k.j(this._forces,M._forces),k.j(this._impulses,M._impulses),this._sleepFrameCount=M._sleepFrameCount}setPosition(M){g(M),k.Qc(M,M,this.Rg.zd),this.Rg.translate(M),this.kg()}eb(){return k.clone(this.Rg.zd)}applyForce(M){g(M),k.add(this._forces,this._forces,M),this.kg()}applyImpulse(M){g(M),k.add(this._impulses,this._impulses,M),this.kg()}kg(){this._sleepFrameCount=10}atRestX(){return this.Ng[0]}atRestY(){return this.Ng[1]}atRestZ(){return this.Ng[2]}}var g=M=>{};var n=b(12420),J=b(11862),u=b(12422);function T(){this.qh=.1,this.fluidDrag=.4,this._c=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function V(M,E,b){M=Object.assign(new T,M),this.gravity=M.gravity||[0,-10,0],this.qh=M.qh||.1,this._c=M._c||2,this.fluidDrag=M.fluidDrag||.4,this.minBounceImpulse=M.minBounceImpulse,this.bodies=[],this.ak=M.ak,this.testSolid=E,this.testFluid=b}V.prototype.Mk=function(M,E,b,x,k,g){M=M||new n([0,0,0],[1,1,1]),"undefined"==typeof E&&(E=1),"undefined"==typeof b&&(b=1),"undefined"==typeof x&&(x=0),"undefined"==typeof k&&(k=1);var J=new a(M,E,b,x,k,g);return this.bodies.push(J),J},V.prototype.Nk=function(M){var E=this.bodies.indexOf(M);E<0||(this.bodies.splice(E,1),M.Rg=M.Fk=null)};var I=J.create(),t=J.create(),y=J.create(),B=J.create(),r=J.create(),c=J.create(),C=J.create(),R=new n([0,0,0],[1,1,1]),w=new a(R,1,1,0,1,(()=>{}),!1);function S(M,E,b){return E=b,E*=1-(1-M.ratioInFluid)**2}V.prototype.Se=function(M){M/=1e3;var E=o(0,J.squaredLength(this.gravity));this.bodies.forEach((b=>function(M,E,b,x){J.j(r,E.Ng),M.ak&&w.loadFromCopy(E);if(E.mass<=0)return J.set(E.gg,0,0,0),J.set(E._forces,0,0,0),void J.set(E._impulses,0,0,0);var k=x||0===E.Tc;if(function(M,E,b,x){if(E._sleepFrameCount>0)return!1;if(x)return!0;var k=!1,a=.5*b*b*E.Tc;return J.scale(m,M.gravity,a),u(M.testSolid,E.Rg,m,(function(){return k=!0,!0}),!0),k}(M,E,b,k))return;E._sleepFrameCount--,function(M,E){var b=E.Rg,x=Math.floor(b.zd[0]),k=Math.floor(b.zd[2]),a=Math.floor(b.zd[1]),g=Math.floor(b.max[1]);if(!M.testFluid(x,a,k))return E.inFluid=!1,void(E.ratioInFluid=0);var n=1,u=a+1;for(;u<=g&&M.testFluid(x,u,k);)n++,u++;var T=(a+n-b.zd[1])/b.rh[1];T>1&&(T=1);var V=b.rh[0]*b.rh[1]*b.rh[2]*T,I=U;J.scale(I,M.gravity,-M._c*V*E.Tc),E.applyForce(I),E.inFluid=!0,E.ratioInFluid=T}(M,E),s(E._forces),s(E._impulses),s(E.gg),s(E.Ng),J.scale(I,E._forces,1/E.mass),J.od(I,I,M.gravity,E.Tc),J.scale(t,E._impulses,1/E.mass),J.od(t,t,I,b),J.add(E.gg,E.gg,t),E.friction&&(v(M,0,E,t,b),v(M,1,E,t,b),v(M,2,E,t,b));var a=E.fluidDrag>=0?E.fluidDrag:M.fluidDrag,g=E.qh>=0?E.qh:M.qh,n=g,T=g;E.inFluid&&(n=S(E,n,E.fluidDragHoriz>=0?E.fluidDragHoriz:a),T=S(E,T,E.fluidDragVert>=0?E.fluidDragVert:a));n=Math.max(1-n*b/E.mass,0),T=Math.max(1-T*b/E.mass,0),J.set(X,n,T,n),J.multiply(E.gg,E.gg,X),J.scale(y,E.gg,b),J.set(E._forces,0,0,0),J.set(E._impulses,0,0,0),E.Uc&&j(h,E.Rg);J.j(c,y),J.set(C,0,0,0),E.preventFallOffEdge&&function(M,E,b,x){if(!E.Ng[1]||b[1]>0)return;var k=l;j(k,E.Rg);for(var a=0;a<3;a+=2){J.set(F,0,0,0),F[a]=b[a];var g=!0;(g=(g=(g=(g=g&&!W(M,k.zd[0]+F[0]+1e-5,k.zd[1],k.zd[2]+F[2]+1e-5))&&!W(M,k.max[0]+F[0]-1e-5,k.zd[1],k.zd[2]+F[2]+1e-5))&&!W(M,k.zd[0]+F[0]+1e-5,k.zd[1],k.max[2]+F[2]-1e-5))&&!W(M,k.max[0]+F[0]-1e-5,k.zd[1],k.max[2]+F[2]-1e-5))?(x[a]=b[a]>0?1:-1,b[a]=0):0===a&&(J.set(d,b[0],0,0),K(M,k,d,x,E.slideOnCollision))}}(M,E,y,C);K(M,E.Rg,y,E.Ng,E.slideOnCollision),E.Uc&&function(M,E,b,x){if(E.Ng[1]>=0&&!E.inFluid)return;var k=0!==E.Ng[0],a=0!==E.Ng[2];if(!k&&!a)return;var g=Math.abs(x[0]/x[2]),n=4;if(!k&&g>n)return;if(!a&&g<1/n)return;J.add(O,b.zd,x);var T=M.testSolid;u(T,b,x,(function(M,E,b,x){if(1!==E)return!0;x[E]=0}));var V=b.zd[1],I=E.inFluid?1.951:1.001,t=Math.floor(V+I)-V;J.set(p,0,t,0);var y=!1;if(u(T,b,p,(function(M,E,b,x){return y=!0,!0})),y)return;J.Qc(P,O,b.zd),P[1]=0,K(M,b,P,Z,!0);var B=o(b.zd[0],O[0]),r=o(b.zd[2],O[2]);if(k&&!B&&(!r||!a))return;if(a&&(!B||!k)&&!r)return;var c=!0;if(c=c&&!W(M,b.zd[0]+1e-5,b.zd[1],b.zd[2]+1e-5),c=c&&!W(M,b.max[0]-1e-5,b.zd[1],b.zd[2]+1e-5),c=c&&!W(M,b.zd[0]+1e-5,b.zd[1],b.max[2]-1e-5),c=c&&!W(M,b.max[0]-1e-5,b.zd[1],b.max[2]-1e-5),c)return;j(E.Rg,b),E.Ng[0]=Z[0],E.Ng[2]=Z[2],E.sl&&E.sl()}(M,E,h,c);for(var V=0;V<3;++V)E.Ng[V]=E.Ng[V]||C[V],B[V]=0,E.Ng[V]&&(r[V]||(B[V]=-E.gg[V]),E.gg[V]=0);var R=J.length(B);R>.001&&(J.scale(B,B,E.mass),E.Fk&&E.Fk(B),E.restitution>0&&R>M.minBounceImpulse&&(J.scale(B,B,E.restitution),E.applyImpulse(B)));var N=J.squaredLength(E.gg);N>1e-5&&E.kg();M.ak&&M.ak(E)?(E.loadFromCopy(w),E.rolledBackLastTick=!0):E.rolledBackLastTick=!1}(this,b,M,E)))};var X=J.create([0,0,0]);var U=J.create();function v(M,E,b,x,k){var a=b.Ng[E],g=x[E];if(!b.alwaysApplyHorizFriction||1!==E){if(0===a)return;if(a*g<=0)return}J.j(N,b.gg),N[E]=0;var n=J.length(N);if(!o(n,0)){var u=Math.abs(b.friction*M.gravity[E]*k),T=n>u?(n-u)/n:0;b.gg[(E+1)%3]*=T,b.gg[(E+2)%3]*=T}}var N=J.create();function K(M,E,b,x,k){return J.set(x,0,0,0),u(M.testSolid,E,b,(function(M,E,b,a){x[E]=b,a[E]=0,k||(a[0]=0,a[1]=0,a[2]=0)}))}var h=new n([],[]),Z=J.create(),O=J.create(),p=J.create(),P=J.create();var F=J.create(),l=new n([],[]),d=J.create();function W(M,E,b,x){return M.testSolid(Math.floor(E),Math.floor(b-1),Math.floor(x))}var m=J.create();function o(M,E){return Math.abs(M-E)<1e-5}function j(M,E){for(var b=0;b<3;b++)M.zd[b]=E.zd[b],M.max[b]=E.max[b],M.rh[b]=E.rh[b]}var s=function(M){}},11301:function(M,E){!function(M){"use strict";var E=function(M,b){return E=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(M,E){M.__proto__=E}||function(M,E){for(var b in E)Object.prototype.hasOwnProperty.call(E,b)&&(M[b]=E[b])},E(M,b)};function b(M,b){if("function"!==typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function x(){this.constructor=M}E(M,b),M.prototype=null===b?Object.create(b):(x.prototype=b.prototype,new x)}function x(M,E,b,x){var k,a=arguments.length,g=a<3?E:null===x?x=Object.getOwnPropertyDescriptor(E,b):x;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)g=Reflect.decorate(M,E,b,x);else for(var n=M.length-1;n>=0;n--)(k=M[n])&&(g=(a<3?k(g):a>3?k(E,b,g):k(E,b))||g);return a>3&&g&&Object.defineProperty(E,b,g),g}function k(M,E,b){if(b||2===arguments.length)for(var x,k=0,a=E.length;k<a;k++)!x&&k in E||(x||(x=Array.prototype.slice.call(E,0,k)),x[k]=E[k]);return M.concat(x||Array.prototype.slice.call(E))}var a,g=255,n=213;M.OPERATION=void 0,(a=M.OPERATION||(M.OPERATION={}))[a.ADD=128]="ADD",a[a.REPLACE=0]="REPLACE",a[a.DELETE=64]="DELETE",a[a.DELETE_AND_ADD=192]="DELETE_AND_ADD",a[a.TOUCH=1]="TOUCH",a[a.CLEAR=10]="CLEAR";var J=function(){function E(M,E,b){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=M,this.setParent(E,b)}return E.prototype.setParent=function(M,E,b){var x=this;if(this.indexes||(this.indexes=this.ref instanceof PM?this.ref._definition.indexes:{}),this.parent=M,this.parentIndex=b,E)if(this.root=E,this.ref instanceof PM){var k=this.ref._definition;for(var a in k.schema){var g=this.ref[a];if(g&&g.$changes){var n=k.indexes[a];g.$changes.setParent(this.ref,E,n)}}}else"object"===typeof this.ref&&this.ref.forEach((function(M,E){if(M instanceof PM){var b=M.$changes,k=x.ref.$changes.indexes[E];b.setParent(x.ref,x.root,k)}}))},E.prototype.operation=function(M){this.changes.set(--this.currentCustomOperation,M)},E.prototype.change=function(E,b){void 0===b&&(b=M.OPERATION.ADD);var x="number"===typeof E?E:this.indexes[E];this.assertValidIndex(x,E);var k=this.changes.get(x);k&&k.op!==M.OPERATION.DELETE&&k.op!==M.OPERATION.TOUCH||this.changes.set(x,{op:k&&k.op===M.OPERATION.DELETE?M.OPERATION.DELETE_AND_ADD:b,index:x}),this.allChanges.add(x),this.changed=!0,this.touchParents()},E.prototype.touch=function(E){var b="number"===typeof E?E:this.indexes[E];this.assertValidIndex(b,E),this.changes.has(b)||this.changes.set(b,{op:M.OPERATION.TOUCH,index:b}),this.allChanges.add(b),this.touchParents()},E.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},E.prototype.getType=function(M){if(this.ref._definition)return(E=this.ref._definition).schema[E.fieldsByIndex[M]];var E,b=(E=this.parent._definition).schema[E.fieldsByIndex[this.parentIndex]];return Object.values(b)[0]},E.prototype.getChildrenFilter=function(){var M=this.parent._definition.childFilters;return M&&M[this.parentIndex]},E.prototype.getValue=function(M){return this.ref.getByIndex(M)},E.prototype.delete=function(E){var b="number"===typeof E?E:this.indexes[E];if(void 0!==b){var x=this.getValue(b);this.changes.set(b,{op:M.OPERATION.DELETE,index:b}),this.allChanges.delete(b),delete this.caches[b],x&&x.$changes&&(x.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(E," (").concat(b,")"))},E.prototype.discard=function(E,b){var x=this;void 0===E&&(E=!1),void 0===b&&(b=!1),this.ref instanceof PM||this.changes.forEach((function(E){if(E.op===M.OPERATION.DELETE){var b=x.ref.getIndex(E.index);delete x.indexes[b]}})),this.changes.clear(),this.changed=E,b&&this.allChanges.clear(),this.currentCustomOperation=0},E.prototype.discardAll=function(){var M=this;this.changes.forEach((function(E){var b=M.getValue(E.index);b&&b.$changes&&b.$changes.discardAll()})),this.discard()},E.prototype.cache=function(M,E){this.caches[M]=E},E.prototype.clone=function(){return new E(this.ref,this.parent,this.root)},E.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},E.prototype.assertValidIndex=function(M,E){if(void 0===M)throw new Error('ChangeTree: missing index for field "'.concat(E,'"'))},E}();function u(M,E,b,x){return M[E]||(M[E]=[]),M[E].push(b),null===x||void 0===x||x.forEach((function(M,E){return b(M,E)})),function(){return V(M[E],M[E].indexOf(b))}}function T(E){var b=this,x="string"!==typeof this.$changes.getType();this.$items.forEach((function(k,a){E.push({refId:b.$changes.refId,op:M.OPERATION.DELETE,field:a,value:void 0,previousValue:k}),x&&b.$changes.root.removeRef(k.$changes.refId)}))}function V(M,E){if(-1===E||E>=M.length)return!1;for(var b=M.length-1,x=E;x<b;x++)M[x]=M[x+1];return M.length=b,!0}var I=function(M,E){var b=M.toString(),x=E.toString();return b<x?-1:b>x?1:0};function t(M){return M.$proxy=!0,M=new Proxy(M,{get:function(M,E){return"symbol"===typeof E||isNaN(E)?M[E]:M.at(E)},set:function(M,E,b){if("symbol"===typeof E||isNaN(E))M[E]=b;else{var x=Array.from(M.$items.keys()),k=parseInt(x[E]||E);void 0===b||null===b?M.deleteAt(k):M.setAt(k,b)}return!0},deleteProperty:function(M,E){return"number"===typeof E?M.deleteAt(E):delete M[E],!0}})}var y=function(){function E(){for(var M=[],E=0;E<arguments.length;E++)M[E]=arguments[E];this.$changes=new J(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,M)}return E.prototype.Df=function(E,b){return void 0===b&&(b=!0),u(this.$callbacks||(this.$callbacks=[]),M.OPERATION.ADD,E,b?this.$items:void 0)},E.prototype.bb=function(E){return u(this.$callbacks||(this.$callbacks=[]),M.OPERATION.DELETE,E)},E.prototype.onChange=function(E){return u(this.$callbacks||(this.$callbacks=[]),M.OPERATION.REPLACE,E)},E.is=function(M){return Array.isArray(M)||void 0!==M.array},Object.defineProperty(E.prototype,"length",{get:function(){return this.$items.size},set:function(M){0===M?this.clear():this.splice(M,this.length-M)},enumerable:!1,configurable:!0}),E.prototype.push=function(){for(var M,E=this,b=[],x=0;x<arguments.length;x++)b[x]=arguments[x];return b.forEach((function(b){M=E.$refId++,E.setAt(M,b)})),M},E.prototype.pop=function(){var M=Array.from(this.$indexes.values()).pop();if(void 0!==M){this.$changes.delete(M),this.$indexes.delete(M);var E=this.$items.get(M);return this.$items.delete(M),E}},E.prototype.at=function(M){var E=Array.from(this.$items.keys())[M];return this.$items.get(E)},E.prototype.setAt=function(E,b){var x,k;if(void 0!==b&&null!==b){if(this.$items.get(E)!==b){void 0!==b.$changes&&b.$changes.setParent(this,this.$changes.root,E);var a=null!==(k=null===(x=this.$changes.indexes[E])||void 0===x?void 0:x.op)&&void 0!==k?k:M.OPERATION.ADD;this.$changes.indexes[E]=E,this.$indexes.set(E,E),this.$items.set(E,b),this.$changes.change(E,a)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},E.prototype.deleteAt=function(M){var E=Array.from(this.$items.keys())[M];return void 0!==E&&this.$deleteAt(E)},E.prototype.$deleteAt=function(M){return this.$changes.delete(M),this.$indexes.delete(M),this.$items.delete(M)},E.prototype.clear=function(E){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),E&&T.call(this,E),this.$items.clear(),this.$changes.operation({index:0,op:M.OPERATION.CLEAR}),this.$changes.touchParents()},E.prototype.concat=function(){for(var M,b=[],x=0;x<arguments.length;x++)b[x]=arguments[x];return new(E.bind.apply(E,k([void 0],(M=Array.from(this.$items.values())).concat.apply(M,b),!1)))},E.prototype.join=function(M){return Array.from(this.$items.values()).join(M)},E.prototype.reverse=function(){var M=this,E=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(b,x){M.setAt(E[x],b)})),this},E.prototype.shift=function(){var M=Array.from(this.$items.keys()).shift();if(void 0!==M){var E=this.$items.get(M);return this.$deleteAt(M),E}},E.prototype.slice=function(M,b){var x=new E;return x.push.apply(x,Array.from(this.$items.values()).slice(M,b)),x},E.prototype.sort=function(M){var E=this;void 0===M&&(M=I);var b=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(M).forEach((function(M,x){E.setAt(b[x],M)})),this},E.prototype.splice=function(M,E){void 0===E&&(E=this.length-M);for(var b=Array.from(this.$items.keys()),x=[],k=M;k<M+E;k++)x.push(this.$items.get(b[k])),this.$deleteAt(b[k]);return x},E.prototype.unshift=function(){for(var M=this,E=[],b=0;b<arguments.length;b++)E[b]=arguments[b];var x=this.length,k=E.length,a=Array.from(this.$items.values());return E.forEach((function(E,b){M.setAt(b,E)})),a.forEach((function(E,b){M.setAt(k+b,E)})),x+k},E.prototype.indexOf=function(M,E){return Array.from(this.$items.values()).indexOf(M,E)},E.prototype.lastIndexOf=function(M,E){return void 0===E&&(E=this.length-1),Array.from(this.$items.values()).lastIndexOf(M,E)},E.prototype.every=function(M,E){return Array.from(this.$items.values()).every(M,E)},E.prototype.some=function(M,E){return Array.from(this.$items.values()).some(M,E)},E.prototype.forEach=function(M,E){Array.from(this.$items.values()).forEach(M,E)},E.prototype.map=function(M,E){return Array.from(this.$items.values()).map(M,E)},E.prototype.filter=function(M,E){return Array.from(this.$items.values()).filter(M,E)},E.prototype.reduce=function(M,E){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},E.prototype.reduceRight=function(M,E){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},E.prototype.find=function(M,E){return Array.from(this.$items.values()).find(M,E)},E.prototype.findIndex=function(M,E){return Array.from(this.$items.values()).findIndex(M,E)},E.prototype.fill=function(M,E,b){throw new Error("ArraySchema#fill() not implemented")},E.prototype.copyWithin=function(M,E,b){throw new Error("ArraySchema#copyWithin() not implemented")},E.prototype.toString=function(){return this.$items.toString()},E.prototype.toLocaleString=function(){return this.$items.toLocaleString()},E.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(E,Symbol.species,{get:function(){return E},enumerable:!1,configurable:!0}),E.prototype.entries=function(){return this.$items.entries()},E.prototype.keys=function(){return this.$items.keys()},E.prototype.values=function(){return this.$items.values()},E.prototype.includes=function(M,E){return Array.from(this.$items.values()).includes(M,E)},E.prototype.flatMap=function(M,E){throw new Error("ArraySchema#flatMap() is not supported.")},E.prototype.flat=function(M){throw new Error("ArraySchema#flat() is not supported.")},E.prototype.findLast=function(){var M=Array.from(this.$items.values());return M.findLast.apply(M,arguments)},E.prototype.findLastIndex=function(){var M=Array.from(this.$items.values());return M.findLastIndex.apply(M,arguments)},E.prototype.setIndex=function(M,E){this.$indexes.set(M,E)},E.prototype.getIndex=function(M){return this.$indexes.get(M)},E.prototype.getByIndex=function(M){return this.$items.get(this.$indexes.get(M))},E.prototype.deleteByIndex=function(M){var E=this.$indexes.get(M);this.$items.delete(E),this.$indexes.delete(M)},E.prototype.toArray=function(){return Array.from(this.$items.values())},E.prototype.toJSON=function(){return this.toArray().map((function(M){return"function"===typeof M.toJSON?M.toJSON():M}))},E.prototype.clone=function(M){return M?new(E.bind.apply(E,k([void 0],Array.from(this.$items.values()),!1))):new(E.bind.apply(E,k([void 0],this.map((function(M){return M.$changes?M.clone():M})),!1)))},E}();function B(M){return M.$proxy=!0,M=new Proxy(M,{get:function(M,E){return"symbol"!==typeof E&&"undefined"===typeof M[E]?M.get(E):M[E]},set:function(M,E,b){return"symbol"!==typeof E&&-1===E.indexOf("$")&&"Df"!==E&&"bb"!==E&&"onChange"!==E?M.set(E,b):M[E]=b,!0},deleteProperty:function(M,E){return M.delete(E),!0}})}var r=function(){function E(M){var b=this;if(this.$changes=new J(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,M)if(M instanceof Map||M instanceof E)M.forEach((function(M,E){return b.set(E,M)}));else for(var x in M)this.set(x,M[x])}return E.prototype.Df=function(E,b){return void 0===b&&(b=!0),u(this.$callbacks||(this.$callbacks=[]),M.OPERATION.ADD,E,b?this.$items:void 0)},E.prototype.bb=function(E){return u(this.$callbacks||(this.$callbacks=[]),M.OPERATION.DELETE,E)},E.prototype.onChange=function(E){return u(this.$callbacks||(this.$callbacks=[]),M.OPERATION.REPLACE,E)},E.is=function(M){return void 0!==M.map},E.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(E.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(E,Symbol.species,{get:function(){return E},enumerable:!1,configurable:!0}),E.prototype.set=function(E,b){if(void 0===b||null===b)throw new Error("MapSchema#set('".concat(E,"', ").concat(b,"): trying to set ").concat(b," value on '").concat(E,"'."));E=E.toString();var x="undefined"!==typeof this.$changes.indexes[E],k=x?this.$changes.indexes[E]:this.$refId++,a=x?M.OPERATION.REPLACE:M.OPERATION.ADD,g=void 0!==b.$changes;if(g&&b.$changes.setParent(this,this.$changes.root,k),x){if(!g&&this.$items.get(E)===b)return;g&&this.$items.get(E)!==b&&(a=M.OPERATION.ADD)}else this.$changes.indexes[E]=k,this.$indexes.set(k,E);return this.$items.set(E,b),this.$changes.change(E,a),this},E.prototype.get=function(M){return this.$items.get(M)},E.prototype.delete=function(M){return this.$changes.delete(M),this.$items.delete(M)},E.prototype.clear=function(E){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),E&&T.call(this,E),this.$items.clear(),this.$changes.operation({index:0,op:M.OPERATION.CLEAR}),this.$changes.touchParents()},E.prototype.has=function(M){return this.$items.has(M)},E.prototype.forEach=function(M){this.$items.forEach(M)},E.prototype.entries=function(){return this.$items.entries()},E.prototype.keys=function(){return this.$items.keys()},E.prototype.values=function(){return this.$items.values()},Object.defineProperty(E.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),E.prototype.setIndex=function(M,E){this.$indexes.set(M,E)},E.prototype.getIndex=function(M){return this.$indexes.get(M)},E.prototype.getByIndex=function(M){return this.$items.get(this.$indexes.get(M))},E.prototype.deleteByIndex=function(M){var E=this.$indexes.get(M);this.$items.delete(E),this.$indexes.delete(M)},E.prototype.toJSON=function(){var M={};return this.forEach((function(E,b){M[b]="function"===typeof E.toJSON?E.toJSON():E})),M},E.prototype.clone=function(M){var b;return M?b=Object.assign(new E,this):(b=new E,this.forEach((function(M,E){M.$changes?b.set(E,M.clone()):b.set(E,M)}))),b},E}(),c={};function C(M,E){c[M]=E}function R(M){return c[M]}var w=function(){function M(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return M.create=function(E){var b=new M;return b.schema=Object.assign({},E&&E.schema||{}),b.indexes=Object.assign({},E&&E.indexes||{}),b.fieldsByIndex=Object.assign({},E&&E.fieldsByIndex||{}),b.descriptors=Object.assign({},E&&E.descriptors||{}),b.deprecated=Object.assign({},E&&E.deprecated||{}),b},M.prototype.addField=function(M,E){var b=this.getNextFieldIndex();this.fieldsByIndex[b]=M,this.indexes[M]=b,this.schema[M]=Array.isArray(E)?{array:E[0]}:E},M.prototype.hasField=function(M){return void 0!==this.indexes[M]},M.prototype.addFilter=function(M,E){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[M]]=E,this.indexesWithFilters.push(this.indexes[M]),!0},M.prototype.addChildrenFilter=function(M,E){var b=this.indexes[M],x=this.schema[M];if(R(Object.keys(x)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[b]=E,!0;console.warn("@filterChildren: field '".concat(M,"' can't have children. Ignoring filter."))},M.prototype.getChildrenFilter=function(M){return this.childFilters&&this.childFilters[this.indexes[M]]},M.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},M}();function S(M){return M._context&&M._context.useFilters}var X=function(){function M(){this.types={},this.schemas=new Map,this.useFilters=!1}return M.prototype.has=function(M){return this.schemas.has(M)},M.prototype.get=function(M){return this.types[M]},M.prototype.add=function(M,E){void 0===E&&(E=this.schemas.size),M._definition=w.create(M._definition),M._typeid=E,this.types[E]=M,this.schemas.set(M,E)},M.create=function(E){return void 0===E&&(E={}),function(b){return E.context||(E.context=new M),v(b,E)}},M}(),U=new X;function v(M,E){return void 0===E&&(E={}),function(b,x){var a=E.context||U,g=b.constructor;if(g._context=a,!M)throw new Error("".concat(g.name,': @type() reference provided for "').concat(x,"\" is undefined. Make sure you don't have any circular dependencies."));a.has(g)||a.add(g);var n=g._definition;if(n.addField(x,M),n.descriptors[x]){if(n.deprecated[x])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(x,"' definition on '").concat(g.name,"'.\nCheck @type() annotation"))}catch(c){var J=c.stack.split("\n")[4].trim();throw new Error("".concat(c.message," ").concat(J))}}var u=y.is(M),T=!u&&r.is(M);if("string"!==typeof M&&!PM.is(M)){var V=Object.values(M)[0];"string"===typeof V||a.has(V)||a.add(V)}if(E.manual)n.descriptors[x]={enumerable:!0,configurable:!0,writable:!0};else{var I="_".concat(x);n.descriptors[I]={enumerable:!1,configurable:!1,writable:!0},n.descriptors[x]={get:function(){return this[I]},set:function(M){M!==this[I]&&(void 0!==M&&null!==M?(!u||M instanceof y||(M=new(y.bind.apply(y,k([void 0],M,!1)))),!T||M instanceof r||(M=new r(M)),void 0===M.$proxy&&(T?M=B(M):u&&(M=t(M))),this.$changes.change(x),M.$changes&&M.$changes.setParent(this,this.$changes.root,this._definition.indexes[x])):this[I]&&this.$changes.delete(x),this[I]=M)},enumerable:!0,configurable:!0}}}}function N(M){return function(E,b){var x=E.constructor;x._definition.addFilter(b,M)&&(x._context.useFilters=!0)}}function K(M){return function(E,b){var x=E.constructor;x._definition.addChildrenFilter(b,M)&&(x._context.useFilters=!0)}}function h(M){return void 0===M&&(M=!0),function(E,b){var x=E.constructor._definition;x.deprecated[b]=!0,M&&(x.descriptors[b]={get:function(){throw new Error("".concat(b," is deprecated."))},set:function(M){},enumerable:!1,configurable:!0})}}function Z(M,E,b){for(var x in void 0===b&&(b={}),b.context||(b.context=M._context||b.context||U),E)v(E[x],b)(M.prototype,x);return M}function O(M){for(var E=0,b=0,x=0,k=M.length;x<k;x++)(E=M.charCodeAt(x))<128?b+=1:E<2048?b+=2:E<55296||E>=57344?b+=3:(x++,b+=4);return b}function p(M,E,b){for(var x=0,k=0,a=b.length;k<a;k++)(x=b.charCodeAt(k))<128?M[E++]=x:x<2048?(M[E++]=192|x>>6,M[E++]=128|63&x):x<55296||x>=57344?(M[E++]=224|x>>12,M[E++]=128|x>>6&63,M[E++]=128|63&x):(k++,x=65536+((1023&x)<<10|1023&b.charCodeAt(k)),M[E++]=240|x>>18,M[E++]=128|x>>12&63,M[E++]=128|x>>6&63,M[E++]=128|63&x)}function P(M,E){M.push(255&E)}function F(M,E){M.push(255&E)}function l(M,E){M.push(255&E),M.push(E>>8&255)}function d(M,E){M.push(255&E),M.push(E>>8&255)}function W(M,E){M.push(255&E),M.push(E>>8&255),M.push(E>>16&255),M.push(E>>24&255)}function m(M,E){var b=E>>24,x=E>>16,k=E>>8,a=E;M.push(255&a),M.push(255&k),M.push(255&x),M.push(255&b)}function o(M,E){var b=Math.floor(E/Math.pow(2,32));m(M,E>>>0),m(M,b)}function j(M,E){var b=E/Math.pow(2,32)|0;m(M,E>>>0),m(M,b)}function s(M,E){Y(M,E)}function q(M,E){i(M,E)}var D=new Int32Array(2),z=new Float32Array(D.buffer),A=new Float64Array(D.buffer);function Y(M,E){z[0]=E,W(M,D[0])}function i(M,E){A[0]=E,W(M,D[0]),W(M,D[1])}function G(M,E){return F(M,E?1:0)}function H(M,E){E||(E="");var b=O(E),x=0;if(b<32)M.push(160|b),x=1;else if(b<256)M.push(217),F(M,b),x=2;else if(b<65536)M.push(218),d(M,b),x=3;else{if(!(b<4294967296))throw new Error("String too long");M.push(219),m(M,b),x=5}return p(M,M.length,E),x+b}function e(M,E){return isNaN(E)?e(M,0):isFinite(E)?E!==(0|E)?(M.push(203),i(M,E),9):E>=0?E<128?(F(M,E),1):E<256?(M.push(204),F(M,E),2):E<65536?(M.push(205),d(M,E),3):E<4294967296?(M.push(206),m(M,E),5):(M.push(207),j(M,E),9):E>=-32?(M.push(224|E+32),1):E>=-128?(M.push(208),P(M,E),2):E>=-32768?(M.push(209),l(M,E),3):E>=-2147483648?(M.push(210),W(M,E),5):(M.push(211),o(M,E),9):e(M,E>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var Q=Object.freeze({__proto__:null,utf8Write:p,int8:P,uint8:F,int16:l,uint16:d,int32:W,uint32:m,int64:o,uint64:j,float32:s,float64:q,writeFloat32:Y,writeFloat64:i,boolean:G,string:H,number:e});function L(M,E,b){for(var x="",k=0,a=E,g=E+b;a<g;a++){var n=M[a];0!==(128&n)?192!==(224&n)?224!==(240&n)?240!==(248&n)?console.error("Invalid byte "+n.toString(16)):(k=(7&n)<<18|(63&M[++a])<<12|(63&M[++a])<<6|63&M[++a])>=65536?(k-=65536,x+=String.fromCharCode(55296+(k>>>10),56320+(1023&k))):x+=String.fromCharCode(k):x+=String.fromCharCode((15&n)<<12|(63&M[++a])<<6|63&M[++a]):x+=String.fromCharCode((31&n)<<6|63&M[++a]):x+=String.fromCharCode(n)}return x}function f(M,E){return MM(M,E)<<24>>24}function MM(M,E){return M[E.offset++]}function EM(M,E){return bM(M,E)<<16>>16}function bM(M,E){return M[E.offset++]|M[E.offset++]<<8}function xM(M,E){return M[E.offset++]|M[E.offset++]<<8|M[E.offset++]<<16|M[E.offset++]<<24}function kM(M,E){return xM(M,E)>>>0}function aM(M,E){return IM(M,E)}function gM(M,E){return tM(M,E)}function nM(M,E){var b=kM(M,E);return xM(M,E)*Math.pow(2,32)+b}function JM(M,E){var b=kM(M,E);return kM(M,E)*Math.pow(2,32)+b}var uM=new Int32Array(2),TM=new Float32Array(uM.buffer),VM=new Float64Array(uM.buffer);function IM(M,E){return uM[0]=xM(M,E),TM[0]}function tM(M,E){return uM[0]=xM(M,E),uM[1]=xM(M,E),VM[0]}function yM(M,E){return MM(M,E)>0}function BM(M,E){var b,x=M[E.offset++];x<192?b=31&x:217===x?b=MM(M,E):218===x?b=bM(M,E):219===x&&(b=kM(M,E));var k=L(M,E.offset,b);return E.offset+=b,k}function rM(M,E){var b=M[E.offset];return b<192&&b>160||217===b||218===b||219===b}function cM(M,E){var b=M[E.offset++];return b<128?b:202===b?IM(M,E):203===b?tM(M,E):204===b?MM(M,E):205===b?bM(M,E):206===b?kM(M,E):207===b?JM(M,E):208===b?f(M,E):209===b?EM(M,E):210===b?xM(M,E):211===b?nM(M,E):b>223?-1*(255-b+1):void 0}function CM(M,E){var b=M[E.offset];return b<128||b>=202&&b<=211}function RM(M,E){return M[E.offset]<160}function wM(M,E){return M[E.offset-1]===g&&(M[E.offset]<128||M[E.offset]>=202&&M[E.offset]<=211)}var SM=Object.freeze({__proto__:null,int8:f,uint8:MM,int16:EM,uint16:bM,int32:xM,uint32:kM,float32:aM,float64:gM,int64:nM,uint64:JM,readFloat32:IM,readFloat64:tM,boolean:yM,string:BM,stringCheck:rM,number:cM,numberCheck:CM,arrayCheck:RM,switchStructureCheck:wM}),XM=function(){function E(M){var E=this;this.$changes=new J(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,M&&M.forEach((function(M){return E.add(M)}))}return E.prototype.Df=function(E,b){return void 0===b&&(b=!0),u(this.$callbacks||(this.$callbacks=[]),M.OPERATION.ADD,E,b?this.$items:void 0)},E.prototype.bb=function(E){return u(this.$callbacks||(this.$callbacks=[]),M.OPERATION.DELETE,E)},E.prototype.onChange=function(E){return u(this.$callbacks||(this.$callbacks=[]),M.OPERATION.REPLACE,E)},E.is=function(M){return void 0!==M.collection},E.prototype.add=function(M){var E=this.$refId++;return void 0!==M.$changes&&M.$changes.setParent(this,this.$changes.root,E),this.$changes.indexes[E]=E,this.$indexes.set(E,E),this.$items.set(E,M),this.$changes.change(E),E},E.prototype.at=function(M){var E=Array.from(this.$items.keys())[M];return this.$items.get(E)},E.prototype.entries=function(){return this.$items.entries()},E.prototype.delete=function(M){for(var E,b,x=this.$items.entries();(b=x.next())&&!b.done;)if(M===b.value[1]){E=b.value[0];break}return void 0!==E&&(this.$changes.delete(E),this.$indexes.delete(E),this.$items.delete(E))},E.prototype.clear=function(E){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),E&&T.call(this,E),this.$items.clear(),this.$changes.operation({index:0,op:M.OPERATION.CLEAR}),this.$changes.touchParents()},E.prototype.has=function(M){return Array.from(this.$items.values()).some((function(E){return E===M}))},E.prototype.forEach=function(M){var E=this;this.$items.forEach((function(b,x,k){return M(b,x,E)}))},E.prototype.values=function(){return this.$items.values()},Object.defineProperty(E.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),E.prototype.setIndex=function(M,E){this.$indexes.set(M,E)},E.prototype.getIndex=function(M){return this.$indexes.get(M)},E.prototype.getByIndex=function(M){return this.$items.get(this.$indexes.get(M))},E.prototype.deleteByIndex=function(M){var E=this.$indexes.get(M);this.$items.delete(E),this.$indexes.delete(M)},E.prototype.toArray=function(){return Array.from(this.$items.values())},E.prototype.toJSON=function(){var M=[];return this.forEach((function(E,b){M.push("function"===typeof E.toJSON?E.toJSON():E)})),M},E.prototype.clone=function(M){var b;return M?b=Object.assign(new E,this):(b=new E,this.forEach((function(M){M.$changes?b.add(M.clone()):b.add(M)}))),b},E}(),UM=function(){function E(M){var E=this;this.$changes=new J(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,M&&M.forEach((function(M){return E.add(M)}))}return E.prototype.Df=function(E,b){return void 0===b&&(b=!0),u(this.$callbacks||(this.$callbacks=[]),M.OPERATION.ADD,E,b?this.$items:void 0)},E.prototype.bb=function(E){return u(this.$callbacks||(this.$callbacks=[]),M.OPERATION.DELETE,E)},E.prototype.onChange=function(E){return u(this.$callbacks||(this.$callbacks=[]),M.OPERATION.REPLACE,E)},E.is=function(M){return void 0!==M.set},E.prototype.add=function(E){var b,x;if(this.has(E))return!1;var k=this.$refId++;void 0!==E.$changes&&E.$changes.setParent(this,this.$changes.root,k);var a=null!==(x=null===(b=this.$changes.indexes[k])||void 0===b?void 0:b.op)&&void 0!==x?x:M.OPERATION.ADD;return this.$changes.indexes[k]=k,this.$indexes.set(k,k),this.$items.set(k,E),this.$changes.change(k,a),k},E.prototype.entries=function(){return this.$items.entries()},E.prototype.delete=function(M){for(var E,b,x=this.$items.entries();(b=x.next())&&!b.done;)if(M===b.value[1]){E=b.value[0];break}return void 0!==E&&(this.$changes.delete(E),this.$indexes.delete(E),this.$items.delete(E))},E.prototype.clear=function(E){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),E&&T.call(this,E),this.$items.clear(),this.$changes.operation({index:0,op:M.OPERATION.CLEAR}),this.$changes.touchParents()},E.prototype.has=function(M){for(var E,b=this.$items.values(),x=!1;(E=b.next())&&!E.done;)if(M===E.value){x=!0;break}return x},E.prototype.forEach=function(M){var E=this;this.$items.forEach((function(b,x,k){return M(b,x,E)}))},E.prototype.values=function(){return this.$items.values()},Object.defineProperty(E.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),E.prototype.setIndex=function(M,E){this.$indexes.set(M,E)},E.prototype.getIndex=function(M){return this.$indexes.get(M)},E.prototype.getByIndex=function(M){return this.$items.get(this.$indexes.get(M))},E.prototype.deleteByIndex=function(M){var E=this.$indexes.get(M);this.$items.delete(E),this.$indexes.delete(M)},E.prototype.toArray=function(){return Array.from(this.$items.values())},E.prototype.toJSON=function(){var M=[];return this.forEach((function(E,b){M.push("function"===typeof E.toJSON?E.toJSON():E)})),M},E.prototype.clone=function(M){var b;return M?b=Object.assign(new E,this):(b=new E,this.forEach((function(M){M.$changes?b.add(M.clone()):b.add(M)}))),b},E}(),vM=function(){function M(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return M.prototype.addRefId=function(M){this.refIds.has(M)||(this.refIds.add(M),this.containerIndexes.set(M,new Set))},M.get=function(E){return void 0===E.$filterState&&(E.$filterState=new M),E.$filterState},M}(),NM=function(){function M(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return M.prototype.getNextUniqueId=function(){return this.nextUniqueId++},M.prototype.addRef=function(M,E,b){void 0===b&&(b=!0),this.refs.set(M,E),b&&(this.refCounts[M]=(this.refCounts[M]||0)+1)},M.prototype.removeRef=function(M){this.refCounts[M]=this.refCounts[M]-1,this.deletedRefs.add(M)},M.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},M.prototype.garbageCollectDeletedRefs=function(){var M=this;this.deletedRefs.forEach((function(E){if(!(M.refCounts[E]>0)){var b=M.refs.get(E);if(b instanceof PM)for(var x in b._definition.schema)"string"!==typeof b._definition.schema[x]&&b[x]&&b[x].$changes&&M.removeRef(b[x].$changes.refId);else{var k=b.$changes.parent._definition,a=k.schema[k.fieldsByIndex[b.$changes.parentIndex]];"function"===typeof Object.values(a)[0]&&Array.from(b.values()).forEach((function(E){return M.removeRef(E.$changes.refId)}))}M.refs.delete(E),delete M.refCounts[E]}})),this.deletedRefs.clear()},M}(),KM=function(M){function E(){return null!==M&&M.apply(this,arguments)||this}return b(E,M),E}(Error);function hM(M,E,b,x){var k,a=!1;switch(E){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":k="number",isNaN(M)&&console.log('trying to encode "NaN" in '.concat(b.constructor.name,"#").concat(x));break;case"string":k="string",a=!0;break;case"boolean":return}if(typeof M!==k&&(!a||a&&null!==M)){var g="'".concat(JSON.stringify(M),"'").concat(M&&M.constructor&&" (".concat(M.constructor.name,")")||"");throw new KM("a '".concat(k,"' was expected, but ").concat(g," was provided in ").concat(b.constructor.name,"#").concat(x))}}function ZM(M,E,b,x){if(!(M instanceof E))throw new KM("a '".concat(E.name,"' was expected, but '").concat(M.constructor.name,"' was provided in ").concat(b.constructor.name,"#").concat(x))}function OM(M,E,b,x,k){hM(b,M,x,k);var a=Q[M];if(!a)throw new KM("a '".concat(M,"' was expected, but ").concat(b," was provided in ").concat(x.constructor.name,"#").concat(k));a(E,b)}function pM(M,E,b){return SM[M](E,b)}var PM=function(){function E(){for(var M=[],E=0;E<arguments.length;E++)M[E]=arguments[E];Object.defineProperties(this,{$changes:{value:new J(this,void 0,new NM),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var b=this._definition.descriptors;b&&Object.defineProperties(this,b),M[0]&&this.assign(M[0])}return E.onError=function(M){console.error(M)},E.is=function(M){return M._definition&&void 0!==M._definition.schema},E.prototype.onChange=function(E){return u(this.$callbacks||(this.$callbacks=[]),M.OPERATION.REPLACE,E)},E.prototype.bb=function(E){return u(this.$callbacks||(this.$callbacks=[]),M.OPERATION.DELETE,E)},E.prototype.assign=function(M){return Object.assign(this,M),this},Object.defineProperty(E.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),E.prototype.setDirty=function(M,E){this.$changes.change(M,E)},E.prototype.listen=function(M,E,b){var x=this;return void 0===b&&(b=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[M]||(this.$callbacks[M]=[]),this.$callbacks[M].push(E),b&&void 0!==this[M]&&E(this[M],void 0),function(){return V(x.$callbacks[M],x.$callbacks[M].indexOf(E))}},E.prototype.decode=function(b,x,k){var a;void 0===x&&(x={offset:0}),void 0===k&&(k=this);var n=[],J=this.$changes.root,u=b.length,T=0;for(J.refs.set(T,this);x.offset<u;){var V=b[x.offset++];if(V!=g){var I=k.$changes,t=void 0!==k._definition,B=t?V>>6<<6:V;if(B!==M.OPERATION.CLEAR){var c=t?V%(B||255):cM(b,x),C=t?k._definition.fieldsByIndex[c]:"",w=I.getType(c),S=void 0,X=void 0,U=void 0;if(t?X=k["_".concat(C)]:(X=k.getByIndex(c),(B&M.OPERATION.ADD)===M.OPERATION.ADD?(U=k instanceof r?BM(b,x):c,k.setIndex(c,U)):U=k.getIndex(c)),(B&M.OPERATION.DELETE)===M.OPERATION.DELETE&&(B!==M.OPERATION.DELETE_AND_ADD&&k.deleteByIndex(c),X&&X.$changes&&J.removeRef(X.$changes.refId),S=null),void 0!==C){if(B===M.OPERATION.DELETE);else if(E.is(w)){var v=cM(b,x);if(S=J.refs.get(v),B!==M.OPERATION.REPLACE){var N=this.getSchemaType(b,x,w);S||((S=this.createTypeInstance(N)).$changes.refId=v,X&&(S.$callbacks=X.$callbacks,X.$changes.refId&&v!==X.$changes.refId&&J.removeRef(X.$changes.refId))),J.addRef(v,S,S!==X)}}else if("string"===typeof w)S=pM(w,b,x);else{var K=R(Object.keys(w)[0]),h=cM(b,x),Z=J.refs.has(h)?X||J.refs.get(h):new K.constructor;if((S=Z.clone(!0)).$changes.refId=h,X&&(S.$callbacks=X.$callbacks,X.$changes.refId&&h!==X.$changes.refId)){J.removeRef(X.$changes.refId);for(var O=X.entries(),p=void 0;(p=O.next())&&!p.done;){var P=(a=p.value)[0],F=a[1];n.push({refId:h,op:M.OPERATION.DELETE,field:P,value:void 0,previousValue:F})}}J.addRef(h,S,Z!==X)}if(null!==S&&void 0!==S)if(S.$changes&&S.$changes.setParent(I.ref,I.root,c),k instanceof E)k[C]=S;else if(k instanceof r)P=U,k.$items.set(P,S),k.$changes.allChanges.add(c);else if(k instanceof y)k.setAt(c,S);else if(k instanceof XM){var l=k.add(S);k.setIndex(c,l)}else k instanceof UM&&!1!==(l=k.add(S))&&k.setIndex(c,l);X!==S&&n.push({refId:T,op:B,field:C,dynamicIndex:U,value:S,previousValue:X})}else{console.warn("@colyseus/schema: definition mismatch");for(var d={offset:x.offset};x.offset<u&&(!wM(b,x)||(d.offset=x.offset+1,!J.refs.has(cM(b,d))));)x.offset++}}else k.clear(n)}else{T=cM(b,x);var W=J.refs.get(T);if(!W)throw new Error('"refId" not found: '.concat(T));k=W}}return this._triggerChanges(n),J.garbageCollectDeletedRefs(),n},E.prototype.encode=function(b,x,k){void 0===b&&(b=!1),void 0===x&&(x=[]),void 0===k&&(k=!1);for(var a=this.$changes,n=new WeakSet,J=[a],u=1,T=0;T<u;T++){var V=J[T],I=V.ref,t=I instanceof E;V.ensureRefId(),n.add(V),V!==a&&(V.changed||b)&&(F(x,g),e(x,V.refId));for(var y=b?Array.from(V.allChanges):Array.from(V.changes.values()),B=0,c=y.length;B<c;B++){var C=b?{op:M.OPERATION.ADD,index:y[B]}:y[B],w=C.index,S=t?I._definition.fieldsByIndex&&I._definition.fieldsByIndex[w]:w,X=x.length;if(C.op!==M.OPERATION.TOUCH)if(t)F(x,w|C.op);else{if(F(x,C.op),C.op===M.OPERATION.CLEAR)continue;e(x,w)}if(t||(C.op&M.OPERATION.ADD)!=M.OPERATION.ADD||I instanceof r&&H(x,V.ref.$indexes.get(w)),C.op!==M.OPERATION.DELETE){var U=V.getType(w),v=V.getValue(w);if(v&&v.$changes&&!n.has(v.$changes)&&(J.push(v.$changes),v.$changes.ensureRefId(),u++),C.op!==M.OPERATION.TOUCH){if(E.is(U))ZM(v,U,I,S),e(x,v.$changes.refId),(C.op&M.OPERATION.ADD)===M.OPERATION.ADD&&this.tryEncodeTypeId(x,U,v.constructor);else if("string"===typeof U)OM(U,x,v,I,S);else{var N=R(Object.keys(U)[0]);ZM(I["_".concat(S)],N.constructor,I,S),e(x,v.$changes.refId)}k&&V.cache(w,x.slice(X))}}}b||k||V.discard()}return x},E.prototype.encodeAll=function(M){return this.encode(!0,[],M)},E.prototype.applyFilters=function(b,x){var k,a;void 0===x&&(x=!1);for(var n=this,J=new Set,u=vM.get(b),T=[this.$changes],V=1,I=[],t=function(t){var y=T[t];if(J.has(y.refId))return"continue";var B=y.ref,c=B instanceof E;F(I,g),e(I,y.refId);var C=u.refIds.has(y),R=x||!C;u.addRefId(y);var w=u.containerIndexes.get(y),S=R?Array.from(y.allChanges):Array.from(y.changes.values());!x&&c&&B._definition.indexesWithFilters&&B._definition.indexesWithFilters.forEach((function(E){!w.has(E)&&y.allChanges.has(E)&&(R?S.push(E):S.push({op:M.OPERATION.ADD,index:E}))}));for(var X=0,U=S.length;X<U;X++){var v=R?{op:M.OPERATION.ADD,index:S[X]}:S[X];if(v.op!==M.OPERATION.CLEAR){var N=v.index;if(v.op!==M.OPERATION.DELETE){var K=y.getValue(N),h=y.getType(N);if(c){if((Z=B._definition.filters&&B._definition.filters[N])&&!Z.call(B,b,K,n)){K&&K.$changes&&J.add(K.$changes.refId);continue}}else{var Z,O=y.parent;if((Z=y.getChildrenFilter())&&!Z.call(O,b,B.$indexes.get(N),K,n)){K&&K.$changes&&J.add(K.$changes.refId);continue}}if(K.$changes&&(T.push(K.$changes),V++),v.op!==M.OPERATION.TOUCH)if(v.op===M.OPERATION.ADD||c)I.push.apply(I,null!==(k=y.caches[N])&&void 0!==k?k:[]),w.add(N);else if(w.has(N))I.push.apply(I,null!==(a=y.caches[N])&&void 0!==a?a:[]);else{if(w.add(N),F(I,M.OPERATION.ADD),e(I,N),B instanceof r){var p=y.ref.$indexes.get(N);H(I,p)}K.$changes?e(I,K.$changes.refId):Q[h](I,K)}else K.$changes&&!c&&(F(I,M.OPERATION.ADD),e(I,N),B instanceof r&&(p=y.ref.$indexes.get(N),H(I,p)),e(I,K.$changes.refId))}else c?F(I,v.op|N):(F(I,v.op),e(I,N))}else F(I,v.op)}},y=0;y<V;y++)t(y);return I},E.prototype.clone=function(){var M,E=new this.constructor,b=this._definition.schema;for(var x in b)"object"===typeof this[x]&&"function"===typeof(null===(M=this[x])||void 0===M?void 0:M.clone)?E[x]=this[x].clone():E[x]=this[x];return E},E.prototype.toJSON=function(){var M=this._definition.schema,E=this._definition.deprecated,b={};for(var x in M)E[x]||null===this[x]||"undefined"===typeof this[x]||(b[x]="function"===typeof this[x].toJSON?this[x].toJSON():this["_".concat(x)]);return b},E.prototype.discardAllChanges=function(){this.$changes.discardAll()},E.prototype.getByIndex=function(M){return this[this._definition.fieldsByIndex[M]]},E.prototype.deleteByIndex=function(M){this[this._definition.fieldsByIndex[M]]=void 0},E.prototype.tryEncodeTypeId=function(M,E,b){E._typeid!==b._typeid&&(F(M,n),e(M,b._typeid))},E.prototype.getSchemaType=function(M,E,b){var x;return M[E.offset]===n&&(E.offset++,x=this.constructor._context.get(cM(M,E))),x||b},E.prototype.createTypeInstance=function(M){var E=new M;return E.$changes.root=this.$changes.root,E},E.prototype._triggerChanges=function(b){for(var x,k,a,g,n,J,u,T,V,I=new Set,t=this.$changes.root.refs,y=function(y){var B=b[y],r=B.refId,c=t.get(r),C=c.$callbacks;if((B.op&M.OPERATION.DELETE)===M.OPERATION.DELETE&&B.previousValue instanceof E&&(null===(k=null===(x=B.previousValue.$callbacks)||void 0===x?void 0:x[M.OPERATION.DELETE])||void 0===k||k.forEach((function(M){return M()}))),!C)return"continue";if(c instanceof E){if(!I.has(r))try{null===(a=null===C||void 0===C?void 0:C[M.OPERATION.REPLACE])||void 0===a||a.forEach((function(M){return M()}))}catch(R){E.onError(R)}try{C.hasOwnProperty(B.field)&&(null===(g=C[B.field])||void 0===g||g.forEach((function(M){return M(B.value,B.previousValue)})))}catch(R){E.onError(R)}}else B.op===M.OPERATION.ADD&&void 0===B.previousValue?null===(n=C[M.OPERATION.ADD])||void 0===n||n.forEach((function(M){var E;return M(B.value,null!==(E=B.dynamicIndex)&&void 0!==E?E:B.field)})):B.op===M.OPERATION.DELETE?void 0!==B.previousValue&&(null===(J=C[M.OPERATION.DELETE])||void 0===J||J.forEach((function(M){var E;return M(B.previousValue,null!==(E=B.dynamicIndex)&&void 0!==E?E:B.field)}))):B.op===M.OPERATION.DELETE_AND_ADD&&(void 0!==B.previousValue&&(null===(u=C[M.OPERATION.DELETE])||void 0===u||u.forEach((function(M){var E;return M(B.previousValue,null!==(E=B.dynamicIndex)&&void 0!==E?E:B.field)}))),null===(T=C[M.OPERATION.ADD])||void 0===T||T.forEach((function(M){var E;return M(B.value,null!==(E=B.dynamicIndex)&&void 0!==E?E:B.field)}))),B.value!==B.previousValue&&(null===(V=C[M.OPERATION.REPLACE])||void 0===V||V.forEach((function(M){var E;return M(B.value,null!==(E=B.dynamicIndex)&&void 0!==E?E:B.field)})));I.add(r)},B=0;B<b.length;B++)y(B)},E._definition=w.create(),E}();function FM(M){for(var E=[M.$changes],b=1,x={},k=x,a=function(M){var b=E[M];b.changes.forEach((function(M){var E=b.ref,x=M.index,a=E._definition?E._definition.fieldsByIndex[x]:E.$indexes.get(x);k[a]=b.getValue(x)}))},g=0;g<b;g++)a(g);return x}var lM={context:new X},dM=function(M){function E(){return null!==M&&M.apply(this,arguments)||this}return b(E,M),x([v("string",lM)],E.prototype,"name",void 0),x([v("string",lM)],E.prototype,"type",void 0),x([v("number",lM)],E.prototype,"referencedType",void 0),E}(PM),WM=function(M){function E(){var E=null!==M&&M.apply(this,arguments)||this;return E.fields=new y,E}return b(E,M),x([v("number",lM)],E.prototype,"id",void 0),x([v([dM],lM)],E.prototype,"fields",void 0),E}(PM),mM=function(M){function E(){var E=null!==M&&M.apply(this,arguments)||this;return E.types=new y,E}return b(E,M),E.encode=function(M){var b=M.constructor,x=new E;x.rootType=b._typeid;var k=function(M,E){for(var b in E){var k=new dM;k.name=b;var a=void 0;if("string"===typeof E[b])a=E[b];else{var g=E[b],n=void 0;PM.is(g)?(a="ref",n=E[b]):"string"===typeof g[a=Object.keys(g)[0]]?a+=":"+g[a]:n=g[a],k.referencedType=n?n._typeid:-1}k.type=a,M.fields.push(k)}x.types.push(M)},a=b._context.types;for(var g in a){var n=new WM;n.id=Number(g),k(n,a[g]._definition.schema)}return x.encodeAll()},E.decode=function(M,x){var k=new X,a=new E;a.decode(M,x);var g=a.types.reduce((function(M,E){var x=function(M){function E(){return null!==M&&M.apply(this,arguments)||this}return b(E,M),E}(PM),a=E.id;return M[a]=x,k.add(x,a),M}),{});a.types.forEach((function(M){var E=g[M.id];M.fields.forEach((function(M){var b;if(void 0!==M.referencedType){var x=M.type,a=g[M.referencedType];if(!a){var n=M.type.split(":");x=n[0],a=n[1]}"ref"===x?v(a,{context:k})(E.prototype,M.name):v(((b={})[x]=a,b),{context:k})(E.prototype,M.name)}else v(M.type,{context:k})(E.prototype,M.name)}))}));var n=g[a.rootType],J=new n;for(var u in n._definition.schema){var T=n._definition.schema[u];"string"!==typeof T&&(J[u]="function"===typeof T?new T:new(R(Object.keys(T)[0]).constructor))}return J},x([v([WM],lM)],E.prototype,"types",void 0),x([v("number",lM)],E.prototype,"rootType",void 0),E}(PM);C("map",{constructor:r}),C("array",{constructor:y}),C("set",{constructor:UM}),C("collection",{constructor:XM}),M.ArraySchema=y,M.CollectionSchema=XM,M.Context=X,M.MapSchema=r,M.Reflection=mM,M.ReflectionField=dM,M.ReflectionType=WM,M.Schema=PM,M.SchemaDefinition=w,M.SetSchema=UM,M.decode=SM,M.defineTypes=Z,M.deprecated=h,M.dumpChanges=FM,M.encode=Q,M.filter=N,M.filterChildren=K,M.hasFilter=S,M.registerType=C,M.type=v,Object.defineProperty(M,"__esModule",{value:!0})}(E)},12461:M=>{"use strict";M.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12455:(M,E,b)=>{var x=b(12461),k=b(12465),a=Object.hasOwnProperty,g=Object.create(null);for(var n in x)a.call(x,n)&&(g[x[n]]=n);var J=M.exports={to:{},get:{}};function u(M,E,b){return Math.min(Math.max(E,M),b)}function T(M){var E=Math.round(M).toString(16).toUpperCase();return E.length<2?"0"+E:E}J.get=function(M){var E,b;switch(M.substring(0,3).toLowerCase()){case"hsl":E=J.get.hsl(M),b="hsl";break;case"hwb":E=J.get.hwb(M),b="hwb";break;default:E=J.get.rgb(M),b="rgb"}return E?{model:b,value:E}:null},J.get.rgb=function(M){if(!M)return null;var E,b,k,g=[0,0,0,1];if(E=M.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(k=E[2],E=E[1],b=0;b<3;b++){var n=2*b;g[b]=parseInt(E.slice(n,n+2),16)}k&&(g[3]=parseInt(k,16)/255)}else if(E=M.match(/^#([a-f0-9]{3,4})$/i)){for(k=(E=E[1])[3],b=0;b<3;b++)g[b]=parseInt(E[b]+E[b],16);k&&(g[3]=parseInt(k+k,16)/255)}else if(E=M.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(b=0;b<3;b++)g[b]=parseInt(E[b+1],0);E[4]&&(E[5]?g[3]=.01*parseFloat(E[4]):g[3]=parseFloat(E[4]))}else{if(!(E=M.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(E=M.match(/^(\w+)$/))?"transparent"===E[1]?[0,0,0,0]:a.call(x,E[1])?((g=x[E[1]])[3]=1,g):null:null;for(b=0;b<3;b++)g[b]=Math.round(2.55*parseFloat(E[b+1]));E[4]&&(E[5]?g[3]=.01*parseFloat(E[4]):g[3]=parseFloat(E[4]))}for(b=0;b<3;b++)g[b]=u(g[b],0,255);return g[3]=u(g[3],0,1),g},J.get.hsl=function(M){if(!M)return null;var E=M.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(E){var b=parseFloat(E[4]);return[(parseFloat(E[1])%360+360)%360,u(parseFloat(E[2]),0,100),u(parseFloat(E[3]),0,100),u(isNaN(b)?1:b,0,1)]}return null},J.get.hwb=function(M){if(!M)return null;var E=M.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(E){var b=parseFloat(E[4]);return[(parseFloat(E[1])%360+360)%360,u(parseFloat(E[2]),0,100),u(parseFloat(E[3]),0,100),u(isNaN(b)?1:b,0,1)]}return null},J.to.hex=function(){var M=k(arguments);return"#"+T(M[0])+T(M[1])+T(M[2])+(M[3]<1?T(Math.round(255*M[3])):"")},J.to.rgb=function(){var M=k(arguments);return M.length<4||1===M[3]?"rgb("+Math.round(M[0])+", "+Math.round(M[1])+", "+Math.round(M[2])+")":"rgba("+Math.round(M[0])+", "+Math.round(M[1])+", "+Math.round(M[2])+", "+M[3]+")"},J.to.rgb.percent=function(){var M=k(arguments),E=Math.round(M[0]/255*100),b=Math.round(M[1]/255*100),x=Math.round(M[2]/255*100);return M.length<4||1===M[3]?"rgb("+E+"%, "+b+"%, "+x+"%)":"rgba("+E+"%, "+b+"%, "+x+"%, "+M[3]+")"},J.to.hsl=function(){var M=k(arguments);return M.length<4||1===M[3]?"hsl("+M[0]+", "+M[1]+"%, "+M[2]+"%)":"hsla("+M[0]+", "+M[1]+"%, "+M[2]+"%, "+M[3]+")"},J.to.hwb=function(){var M=k(arguments),E="";return M.length>=4&&1!==M[3]&&(E=", "+M[3]),"hwb("+M[0]+", "+M[1]+"%, "+M[2]+"%"+E+")"},J.to.keyword=function(M){return g[M.slice(0,3)]}},12451:(M,E,b)=>{const x=b(12455),k=b(12472),a=["keyword","gray","hex"],g={};for(const t of Object.keys(k))g[[...k[t].labels].sort().join("")]=t;const n={};function J(M,E){if(!(this instanceof J))return new J(M,E);if(E&&E in a&&(E=null),E&&!(E in k))throw new Error("Unknown model: "+E);let b,u;if(null==M)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(M instanceof J)this.model=M.model,this.color=[...M.color],this.valpha=M.valpha;else if("string"===typeof M){const E=x.get(M);if(null===E)throw new Error("Unable to parse color from string: "+M);this.model=E.model,u=k[this.model].channels,this.color=E.value.slice(0,u),this.valpha="number"===typeof E.value[u]?E.value[u]:1}else if(M.length>0){this.model=E||"rgb",u=k[this.model].channels;const b=Array.prototype.slice.call(M,0,u);this.color=I(b,u),this.valpha="number"===typeof M[u]?M[u]:1}else if("number"===typeof M)this.model="rgb",this.color=[M>>16&255,M>>8&255,255&M],this.valpha=1;else{this.valpha=1;const E=Object.keys(M);"alpha"in M&&(E.splice(E.indexOf("alpha"),1),this.valpha="number"===typeof M.alpha?M.alpha:0);const x=E.sort().join("");if(!(x in g))throw new Error("Unable to parse color from object: "+JSON.stringify(M));this.model=g[x];const{labels:a}=k[this.model],n=[];for(b=0;b<a.length;b++)n.push(M[a[b]]);this.color=I(n)}if(n[this.model])for(u=k[this.model].channels,b=0;b<u;b++){const M=n[this.model][b];M&&(this.color[b]=M(this.color[b]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}J.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(M){let E=this.model in x.to?this:this.rgb();E=E.round("number"===typeof M?M:1);const b=1===E.valpha?E.color:[...E.color,this.valpha];return x.to[E.model](b)},percentString(M){const E=this.rgb().round("number"===typeof M?M:1),b=1===E.valpha?E.color:[...E.color,this.valpha];return x.to.rgb.percent(b)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const M={},{channels:E}=k[this.model],{labels:b}=k[this.model];for(let x=0;x<E;x++)M[b[x]]=this.color[x];return 1!==this.valpha&&(M.alpha=this.valpha),M},unitArray(){const M=this.rgb().color;return M[0]/=255,M[1]/=255,M[2]/=255,1!==this.valpha&&M.push(this.valpha),M},unitObject(){const M=this.rgb().object();return M.r/=255,M.g/=255,M.b/=255,1!==this.valpha&&(M.alpha=this.valpha),M},round(M){return M=Math.max(M||0,0),new J([...this.color.map(u(M)),this.valpha],this.model)},alpha(M){return void 0!==M?new J([...this.color,Math.max(0,Math.min(1,M))],this.model):this.valpha},red:T("rgb",0,V(255)),green:T("rgb",1,V(255)),blue:T("rgb",2,V(255)),hue:T(["hsl","hsv","hsl","hwb","hcg"],0,(M=>(M%360+360)%360)),saturationl:T("hsl",1,V(100)),lightness:T("hsl",2,V(100)),saturationv:T("hsv",1,V(100)),value:T("hsv",2,V(100)),chroma:T("hcg",1,V(100)),gray:T("hcg",2,V(100)),white:T("hwb",1,V(100)),wblack:T("hwb",2,V(100)),cyan:T("cmyk",0,V(100)),magenta:T("cmyk",1,V(100)),yellow:T("cmyk",2,V(100)),black:T("cmyk",3,V(100)),x:T("xyz",0,V(95.047)),y:T("xyz",1,V(100)),z:T("xyz",2,V(108.833)),l:T("lab",0,V(100)),a:T("lab",1),b:T("lab",2),keyword(M){return void 0!==M?new J(M):k[this.model].keyword(this.color)},hex(M){return void 0!==M?new J(M):x.to.hex(this.rgb().round().color)},hexa(M){if(void 0!==M)return new J(M);const E=this.rgb().round().color;let b=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===b.length&&(b="0"+b),x.to.hex(E)+b},rgbNumber(){const M=this.rgb().color;return(255&M[0])<<16|(255&M[1])<<8|255&M[2]},luminosity(){const M=this.rgb().color,E=[];for(const[b,x]of M.entries()){const M=x/255;E[b]=M<=.04045?M/12.92:((M+.055)/1.055)**2.4}return.2126*E[0]+.7152*E[1]+.0722*E[2]},contrast(M){const E=this.luminosity(),b=M.luminosity();return E>b?(E+.05)/(b+.05):(b+.05)/(E+.05)},level(M){const E=this.contrast(M);return E>=7?"AAA":E>=4.5?"AA":""},isDark(){const M=this.rgb().color;return(2126*M[0]+7152*M[1]+722*M[2])/1e4<128},isLight(){return!this.isDark()},negate(){const M=this.rgb();for(let E=0;E<3;E++)M.color[E]=255-M.color[E];return M},lighten(M){const E=this.hsl();return E.color[2]+=E.color[2]*M,E},darken(M){const E=this.hsl();return E.color[2]-=E.color[2]*M,E},saturate(M){const E=this.hsl();return E.color[1]+=E.color[1]*M,E},desaturate(M){const E=this.hsl();return E.color[1]-=E.color[1]*M,E},whiten(M){const E=this.hwb();return E.color[1]+=E.color[1]*M,E},blacken(M){const E=this.hwb();return E.color[2]+=E.color[2]*M,E},grayscale(){const M=this.rgb().color,E=.3*M[0]+.59*M[1]+.11*M[2];return J.rgb(E,E,E)},fade(M){return this.alpha(this.valpha-this.valpha*M)},opaquer(M){return this.alpha(this.valpha+this.valpha*M)},rotate(M){const E=this.hsl();let b=E.color[0];return b=(b+M)%360,b=b<0?360+b:b,E.color[0]=b,E},mix(M,E){if(!M||!M.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof M);const b=M.rgb(),x=this.rgb(),k=void 0===E?.5:E,a=2*k-1,g=b.alpha()-x.alpha(),n=((a*g===-1?a:(a+g)/(1+a*g))+1)/2,u=1-n;return J.rgb(n*b.red()+u*x.red(),n*b.green()+u*x.green(),n*b.blue()+u*x.blue(),b.alpha()*k+x.alpha()*(1-k))}};for(const t of Object.keys(k)){if(a.includes(t))continue;const{channels:M}=k[t];J.prototype[t]=function(){if(this.model===t)return new J(this);for(var M=arguments.length,E=new Array(M),b=0;b<M;b++)E[b]=arguments[b];return E.length>0?new J(E,t):new J([...(x=k[this.model][t].raw(this.color),Array.isArray(x)?x:[x]),this.valpha],t);var x},J[t]=function(){for(var E=arguments.length,b=new Array(E),x=0;x<E;x++)b[x]=arguments[x];let k=b[0];return"number"===typeof k&&(k=I(b,M)),new J(k,t)}}function u(M){return function(E){return function(M,E){return Number(M.toFixed(E))}(E,M)}}function T(M,E,b){M=Array.isArray(M)?M:[M];for(const x of M)(n[x]||(n[x]=[]))[E]=b;return M=M[0],function(x){let k;return void 0!==x?(b&&(x=b(x)),k=this[M](),k.color[E]=x,k):(k=this[M]().color[E],b&&(k=b(k)),k)}}function V(M){return function(E){return Math.max(0,Math.min(M,E))}}function I(M,E){for(let b=0;b<E;b++)"number"!==typeof M[b]&&(M[b]=0);return M}M.exports=J},12478:(M,E,b)=>{const x=b(12487),k={};for(const g of Object.keys(x))k[x[g]]=g;const a={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};M.exports=a;for(const g of Object.keys(a)){if(!("channels"in a[g]))throw new Error("missing channels property: "+g);if(!("labels"in a[g]))throw new Error("missing channel labels property: "+g);if(a[g].labels.length!==a[g].channels)throw new Error("channel and label counts mismatch: "+g);const{channels:M,labels:E}=a[g];delete a[g].channels,delete a[g].labels,Object.defineProperty(a[g],"channels",{value:M}),Object.defineProperty(a[g],"labels",{value:E})}a.rgb.hsl=function(M){const E=M[0]/255,b=M[1]/255,x=M[2]/255,k=Math.min(E,b,x),a=Math.max(E,b,x),g=a-k;let n,J;a===k?n=0:E===a?n=(b-x)/g:b===a?n=2+(x-E)/g:x===a&&(n=4+(E-b)/g),n=Math.min(60*n,360),n<0&&(n+=360);const u=(k+a)/2;return J=a===k?0:u<=.5?g/(a+k):g/(2-a-k),[n,100*J,100*u]},a.rgb.hsv=function(M){let E,b,x,k,a;const g=M[0]/255,n=M[1]/255,J=M[2]/255,u=Math.max(g,n,J),T=u-Math.min(g,n,J),V=function(M){return(u-M)/6/T+.5};return 0===T?(k=0,a=0):(a=T/u,E=V(g),b=V(n),x=V(J),g===u?k=x-b:n===u?k=1/3+E-x:J===u&&(k=2/3+b-E),k<0?k+=1:k>1&&(k-=1)),[360*k,100*a,100*u]},a.rgb.hwb=function(M){const E=M[0],b=M[1];let x=M[2];const k=a.rgb.hsl(M)[0],g=1/255*Math.min(E,Math.min(b,x));return x=1-1/255*Math.max(E,Math.max(b,x)),[k,100*g,100*x]},a.rgb.cmyk=function(M){const E=M[0]/255,b=M[1]/255,x=M[2]/255,k=Math.min(1-E,1-b,1-x);return[100*((1-E-k)/(1-k)||0),100*((1-b-k)/(1-k)||0),100*((1-x-k)/(1-k)||0),100*k]},a.rgb.keyword=function(M){const E=k[M];if(E)return E;let b,a=1/0;for(const k of Object.keys(x)){const E=x[k],J=(n=E,((g=M)[0]-n[0])**2+(g[1]-n[1])**2+(g[2]-n[2])**2);J<a&&(a=J,b=k)}var g,n;return b},a.keyword.rgb=function(M){return x[M]},a.rgb.xyz=function(M){let E=M[0]/255,b=M[1]/255,x=M[2]/255;E=E>.04045?((E+.055)/1.055)**2.4:E/12.92,b=b>.04045?((b+.055)/1.055)**2.4:b/12.92,x=x>.04045?((x+.055)/1.055)**2.4:x/12.92;return[100*(.4124*E+.3576*b+.1805*x),100*(.2126*E+.7152*b+.0722*x),100*(.0193*E+.1192*b+.9505*x)]},a.rgb.lab=function(M){const E=a.rgb.xyz(M);let b=E[0],x=E[1],k=E[2];b/=95.047,x/=100,k/=108.883,b=b>.008856?b**(1/3):7.787*b+16/116,x=x>.008856?x**(1/3):7.787*x+16/116,k=k>.008856?k**(1/3):7.787*k+16/116;return[116*x-16,500*(b-x),200*(x-k)]},a.hsl.rgb=function(M){const E=M[0]/360,b=M[1]/100,x=M[2]/100;let k,a,g;if(0===b)return g=255*x,[g,g,g];k=x<.5?x*(1+b):x+b-x*b;const n=2*x-k,J=[0,0,0];for(let u=0;u<3;u++)a=E+1/3*-(u-1),a<0&&a++,a>1&&a--,g=6*a<1?n+6*(k-n)*a:2*a<1?k:3*a<2?n+(k-n)*(2/3-a)*6:n,J[u]=255*g;return J},a.hsl.hsv=function(M){const E=M[0];let b=M[1]/100,x=M[2]/100,k=b;const a=Math.max(x,.01);x*=2,b*=x<=1?x:2-x,k*=a<=1?a:2-a;return[E,100*(0===x?2*k/(a+k):2*b/(x+b)),100*((x+b)/2)]},a.hsv.rgb=function(M){const E=M[0]/60,b=M[1]/100;let x=M[2]/100;const k=Math.floor(E)%6,a=E-Math.floor(E),g=255*x*(1-b),n=255*x*(1-b*a),J=255*x*(1-b*(1-a));switch(x*=255,k){case 0:return[x,J,g];case 1:return[n,x,g];case 2:return[g,x,J];case 3:return[g,n,x];case 4:return[J,g,x];case 5:return[x,g,n]}},a.hsv.hsl=function(M){const E=M[0],b=M[1]/100,x=M[2]/100,k=Math.max(x,.01);let a,g;g=(2-b)*x;const n=(2-b)*k;return a=b*k,a/=n<=1?n:2-n,a=a||0,g/=2,[E,100*a,100*g]},a.hwb.rgb=function(M){const E=M[0]/360;let b=M[1]/100,x=M[2]/100;const k=b+x;let a;k>1&&(b/=k,x/=k);const g=Math.floor(6*E),n=1-x;a=6*E-g,0!==(1&g)&&(a=1-a);const J=b+a*(n-b);let u,T,V;switch(g){default:case 6:case 0:u=n,T=J,V=b;break;case 1:u=J,T=n,V=b;break;case 2:u=b,T=n,V=J;break;case 3:u=b,T=J,V=n;break;case 4:u=J,T=b,V=n;break;case 5:u=n,T=b,V=J}return[255*u,255*T,255*V]},a.cmyk.rgb=function(M){const E=M[0]/100,b=M[1]/100,x=M[2]/100,k=M[3]/100;return[255*(1-Math.min(1,E*(1-k)+k)),255*(1-Math.min(1,b*(1-k)+k)),255*(1-Math.min(1,x*(1-k)+k))]},a.xyz.rgb=function(M){const E=M[0]/100,b=M[1]/100,x=M[2]/100;let k,a,g;return k=3.2406*E+-1.5372*b+-.4986*x,a=-.9689*E+1.8758*b+.0415*x,g=.0557*E+-.204*b+1.057*x,k=k>.0031308?1.055*k**(1/2.4)-.055:12.92*k,a=a>.0031308?1.055*a**(1/2.4)-.055:12.92*a,g=g>.0031308?1.055*g**(1/2.4)-.055:12.92*g,k=Math.min(Math.max(0,k),1),a=Math.min(Math.max(0,a),1),g=Math.min(Math.max(0,g),1),[255*k,255*a,255*g]},a.xyz.lab=function(M){let E=M[0],b=M[1],x=M[2];E/=95.047,b/=100,x/=108.883,E=E>.008856?E**(1/3):7.787*E+16/116,b=b>.008856?b**(1/3):7.787*b+16/116,x=x>.008856?x**(1/3):7.787*x+16/116;return[116*b-16,500*(E-b),200*(b-x)]},a.lab.xyz=function(M){let E,b,x;b=(M[0]+16)/116,E=M[1]/500+b,x=b-M[2]/200;const k=b**3,a=E**3,g=x**3;return b=k>.008856?k:(b-16/116)/7.787,E=a>.008856?a:(E-16/116)/7.787,x=g>.008856?g:(x-16/116)/7.787,E*=95.047,b*=100,x*=108.883,[E,b,x]},a.lab.lch=function(M){const E=M[0],b=M[1],x=M[2];let k;k=360*Math.atan2(x,b)/2/Math.PI,k<0&&(k+=360);return[E,Math.sqrt(b*b+x*x),k]},a.lch.lab=function(M){const E=M[0],b=M[1],x=M[2]/360*2*Math.PI;return[E,b*Math.cos(x),b*Math.sin(x)]},a.rgb.ansi16=function(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[b,x,k]=M;let g=null===E?a.rgb.hsv(M)[2]:E;if(g=Math.round(g/50),0===g)return 30;let n=30+(Math.round(k/255)<<2|Math.round(x/255)<<1|Math.round(b/255));return 2===g&&(n+=60),n},a.hsv.ansi16=function(M){return a.rgb.ansi16(a.hsv.rgb(M),M[2])},a.rgb.ansi256=function(M){const E=M[0],b=M[1],x=M[2];if(E===b&&b===x)return E<8?16:E>248?231:Math.round((E-8)/247*24)+232;return 16+36*Math.round(E/255*5)+6*Math.round(b/255*5)+Math.round(x/255*5)},a.ansi16.rgb=function(M){let E=M%10;if(0===E||7===E)return M>50&&(E+=3.5),E=E/10.5*255,[E,E,E];const b=.5*(1+~~(M>50));return[(1&E)*b*255,(E>>1&1)*b*255,(E>>2&1)*b*255]},a.ansi256.rgb=function(M){if(M>=232){const E=10*(M-232)+8;return[E,E,E]}let E;M-=16;return[Math.floor(M/36)/5*255,Math.floor((E=M%36)/6)/5*255,E%6/5*255]},a.rgb.hex=function(M){const E=(((255&Math.round(M[0]))<<16)+((255&Math.round(M[1]))<<8)+(255&Math.round(M[2]))).toString(16).toUpperCase();return"000000".substring(E.length)+E},a.hex.rgb=function(M){const E=M.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!E)return[0,0,0];let b=E[0];3===E[0].length&&(b=b.split("").map((M=>M+M)).join(""));const x=parseInt(b,16);return[x>>16&255,x>>8&255,255&x]},a.rgb.hcg=function(M){const E=M[0]/255,b=M[1]/255,x=M[2]/255,k=Math.max(Math.max(E,b),x),a=Math.min(Math.min(E,b),x),g=k-a;let n,J;return n=g<1?a/(1-g):0,J=g<=0?0:k===E?(b-x)/g%6:k===b?2+(x-E)/g:4+(E-b)/g,J/=6,J%=1,[360*J,100*g,100*n]},a.hsl.hcg=function(M){const E=M[1]/100,b=M[2]/100,x=b<.5?2*E*b:2*E*(1-b);let k=0;return x<1&&(k=(b-.5*x)/(1-x)),[M[0],100*x,100*k]},a.hsv.hcg=function(M){const E=M[1]/100,b=M[2]/100,x=E*b;let k=0;return x<1&&(k=(b-x)/(1-x)),[M[0],100*x,100*k]},a.hcg.rgb=function(M){const E=M[0]/360,b=M[1]/100,x=M[2]/100;if(0===b)return[255*x,255*x,255*x];const k=[0,0,0],a=E%1*6,g=a%1,n=1-g;let J=0;switch(Math.floor(a)){case 0:k[0]=1,k[1]=g,k[2]=0;break;case 1:k[0]=n,k[1]=1,k[2]=0;break;case 2:k[0]=0,k[1]=1,k[2]=g;break;case 3:k[0]=0,k[1]=n,k[2]=1;break;case 4:k[0]=g,k[1]=0,k[2]=1;break;default:k[0]=1,k[1]=0,k[2]=n}return J=(1-b)*x,[255*(b*k[0]+J),255*(b*k[1]+J),255*(b*k[2]+J)]},a.hcg.hsv=function(M){const E=M[1]/100,b=E+M[2]/100*(1-E);let x=0;return b>0&&(x=E/b),[M[0],100*x,100*b]},a.hcg.hsl=function(M){const E=M[1]/100,b=M[2]/100*(1-E)+.5*E;let x=0;return b>0&&b<.5?x=E/(2*b):b>=.5&&b<1&&(x=E/(2*(1-b))),[M[0],100*x,100*b]},a.hcg.hwb=function(M){const E=M[1]/100,b=E+M[2]/100*(1-E);return[M[0],100*(b-E),100*(1-b)]},a.hwb.hcg=function(M){const E=M[1]/100,b=1-M[2]/100,x=b-E;let k=0;return x<1&&(k=(b-x)/(1-x)),[M[0],100*x,100*k]},a.apple.rgb=function(M){return[M[0]/65535*255,M[1]/65535*255,M[2]/65535*255]},a.rgb.apple=function(M){return[M[0]/255*65535,M[1]/255*65535,M[2]/255*65535]},a.gray.rgb=function(M){return[M[0]/100*255,M[0]/100*255,M[0]/100*255]},a.gray.hsl=function(M){return[0,0,M[0]]},a.gray.hsv=a.gray.hsl,a.gray.hwb=function(M){return[0,100,M[0]]},a.gray.cmyk=function(M){return[0,0,0,M[0]]},a.gray.lab=function(M){return[M[0],0,0]},a.gray.hex=function(M){const E=255&Math.round(M[0]/100*255),b=((E<<16)+(E<<8)+E).toString(16).toUpperCase();return"000000".substring(b.length)+b},a.rgb.gray=function(M){return[(M[0]+M[1]+M[2])/3/255*100]}},12472:(M,E,b)=>{const x=b(12478),k=b(12490),a={};Object.keys(x).forEach((M=>{a[M]={},Object.defineProperty(a[M],"channels",{value:x[M].channels}),Object.defineProperty(a[M],"labels",{value:x[M].labels});const E=k(M);Object.keys(E).forEach((b=>{const x=E[b];a[M][b]=function(M){const E=function(){for(var E=arguments.length,b=new Array(E),x=0;x<E;x++)b[x]=arguments[x];const k=b[0];if(void 0===k||null===k)return k;k.length>1&&(b=k);const a=M(b);if("object"===typeof a)for(let M=a.length,g=0;g<M;g++)a[g]=Math.round(a[g]);return a};return"conversion"in M&&(E.conversion=M.conversion),E}(x),a[M][b].raw=function(M){const E=function(){for(var E=arguments.length,b=new Array(E),x=0;x<E;x++)b[x]=arguments[x];const k=b[0];return void 0===k||null===k?k:(k.length>1&&(b=k),M(b))};return"conversion"in M&&(E.conversion=M.conversion),E}(x)}))})),M.exports=a},12490:(M,E,b)=>{const x=b(12478);function k(M){const E=function(){const M={},E=Object.keys(x);for(let b=E.length,x=0;x<b;x++)M[E[x]]={distance:-1,parent:null};return M}(),b=[M];for(E[M].distance=0;b.length;){const M=b.pop(),k=Object.keys(x[M]);for(let x=k.length,a=0;a<x;a++){const x=k[a],g=E[x];-1===g.distance&&(g.distance=E[M].distance+1,g.parent=M,b.unshift(x))}}return E}function a(M,E){return function(b){return E(M(b))}}function g(M,E){const b=[E[M].parent,M];let k=x[E[M].parent][M],g=E[M].parent;for(;E[g].parent;)b.unshift(E[g].parent),k=a(x[E[g].parent][g],k),g=E[g].parent;return k.conversion=b,k}M.exports=function(M){const E=k(M),b={},x=Object.keys(E);for(let k=x.length,a=0;a<k;a++){const M=x[a];null!==E[M].parent&&(b[M]=g(M,E))}return b}},12487:M=>{"use strict";M.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},11309:function(M,E,b){"use strict";var x=this&&this.__createBinding||(Object.create?function(M,E,b,x){void 0===x&&(x=b);var k=Object.getOwnPropertyDescriptor(E,b);k&&!("get"in k?!E.__esModule:k.writable||k.configurable)||(k={enumerable:!0,get:function(){return E[b]}}),Object.defineProperty(M,x,k)}:function(M,E,b,x){void 0===x&&(x=b),M[x]=E[b]}),k=this&&this.__setModuleDefault||(Object.create?function(M,E){Object.defineProperty(M,"default",{enumerable:!0,value:E})}:function(M,E){M.default=E}),a=this&&this.__importStar||function(M){if(M&&M.__esModule)return M;var E={};if(null!=M)for(var b in M)"default"!==b&&Object.prototype.hasOwnProperty.call(M,b)&&x(E,M,b);return k(E,M),E},g=this&&this.__awaiter||function(M,E,b,x){return new(b||(b=Promise))((function(k,a){function g(M){try{J(x.next(M))}catch(E){a(E)}}function n(M){try{J(x.throw(M))}catch(E){a(E)}}function J(M){var E;M.done?k(M.value):(E=M.value,E instanceof b?E:new b((function(M){M(E)}))).then(g,n)}J((x=x.apply(M,E||[])).next())}))};Object.defineProperty(E,"__esModule",{value:!0}),E.Auth=E.Platform=void 0;const n=a(b(11233)),J=b(11316),u="colyseus-auth-token";!function(M){M.ios="ios",M.android="android"}(E.Platform||(E.Platform={}));E.Auth=class{constructor(M){this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=M.replace("ws","http"),(0,J.getItem)(u,(M=>this.token=M))}get hasToken(){return!!this.token}login(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return g(this,void 0,void 0,(function*(){const E=Object.assign({},M);this.hasToken&&(E.token=this.token);const b=yield this.request("post","/auth",E);this.token=b.token,(0,J.setItem)(u,this.token);for(let M in b)this.hasOwnProperty(M)&&(this[M]=b[M]);return this.registerPingService(),this}))}save(){return g(this,void 0,void 0,(function*(){return yield this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone}),this}))}getFriends(){return g(this,void 0,void 0,(function*(){return yield this.request("get","/friends/all")}))}getOnlineFriends(){return g(this,void 0,void 0,(function*(){return yield this.request("get","/friends/online")}))}getFriendRequests(){return g(this,void 0,void 0,(function*(){return yield this.request("get","/friends/requests")}))}sendFriendRequest(M){return g(this,void 0,void 0,(function*(){return yield this.request("post","/friends/requests",{userId:M})}))}acceptFriendRequest(M){return g(this,void 0,void 0,(function*(){return yield this.request("put","/friends/requests",{userId:M})}))}declineFriendRequest(M){return g(this,void 0,void 0,(function*(){return yield this.request("del","/friends/requests",{userId:M})}))}blockUser(M){return g(this,void 0,void 0,(function*(){return yield this.request("post","/friends/block",{userId:M})}))}unblockUser(M){return g(this,void 0,void 0,(function*(){return yield this.request("put","/friends/block",{userId:M})}))}request(M,E){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},x=arguments.length>3?arguments[3]:void 0,k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return g(this,void 0,void 0,(function*(){k.Accept="application/json",this.hasToken&&(k.Authorization="Bearer "+this.token);const a=[];for(const M in b)a.push(`${M}=${b[M]}`);const g=a.length>0?`?${a.join("&")}`:"",J={headers:k};return x&&(J.body=x),(yield n[M](`${this.endpoint}${E}${g}`,J)).data}))}logout(){this.token=void 0,(0,J.removeItem)(u),this.unregisterPingService()}registerPingService(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;this.unregisterPingService(),this.keepOnlineInterval=setInterval((()=>this.request("get","/auth")),M)}unregisterPingService(){clearInterval(this.keepOnlineInterval)}}},11225:function(M,E,b){"use strict";var x,k=this&&this.__awaiter||function(M,E,b,x){return new(b||(b=Promise))((function(k,a){function g(M){try{J(x.next(M))}catch(E){a(E)}}function n(M){try{J(x.throw(M))}catch(E){a(E)}}function J(M){var E;M.done?k(M.value):(E=M.value,E instanceof b?E:new b((function(M){M(E)}))).then(g,n)}J((x=x.apply(M,E||[])).next())}))};Object.defineProperty(E,"__esModule",{value:!0}),E.Client=E.MatchMakeError=void 0;const a=b(11233),g=b(11241),n=b(11249);class J extends Error{constructor(M,E){super(M),this.code=E,Object.setPrototypeOf(this,J.prototype)}}E.MatchMakeError=J;const u="undefined"!==typeof window&&"undefined"!==typeof(null===(x=null===window||void 0===window?void 0:window.location)||void 0===x?void 0:x.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";E.Client=class{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u;if("string"===typeof M){const E=new URL(M),b="https:"===E.protocol||"wss:"===E.protocol,x=Number(E.port||(b?443:80));this.settings={hostname:E.hostname,pathname:"/"!==E.pathname?E.pathname:"",port:x,secure:b}}else void 0===M.port&&(M.port=M.secure?443:80),void 0===M.pathname&&(M.pathname=""),this.settings=M}joinOrCreate(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2?arguments[2]:void 0;return k(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",M,E,b)}))}create(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2?arguments[2]:void 0;return k(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",M,E,b)}))}join(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2?arguments[2]:void 0;return k(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",M,E,b)}))}joinById(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2?arguments[2]:void 0;return k(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",M,E,b)}))}reconnect(M,E){return k(this,void 0,void 0,(function*(){if("string"===typeof M&&"string"===typeof E)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[b,x]=M.split(":");return yield this.createMatchMakeRequest("reconnect",b,{reconnectionToken:x},E)}))}getAvailableRooms(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return k(this,void 0,void 0,(function*(){return(yield(0,a.get)(this.getHttpEndpoint(`${M}`),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(M,E,b){return k(this,void 0,void 0,(function*(){const x=this.createRoom(M.room.name,E);x.roomId=M.room.roomId,x.sessionId=M.sessionId;const a={sessionId:x.sessionId};M.reconnectionToken&&(a.reconnectionToken=M.reconnectionToken);const n=b||x;return x.connect(this.buildEndpoint(M.room,a),M.devMode&&(()=>k(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${x.roomId}'...`);let b=0;const a=()=>k(this,void 0,void 0,(function*(){b++;try{yield this.consumeSeatReservation(M,E,n),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${x.roomId}'`)}catch(k){b<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${b} out of 8)`),setTimeout(a,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(a,2e3)}))),n),new Promise(((M,E)=>{const b=(M,b)=>E(new g.ServerError(M,b));n.onError.once(b),n.onJoin.once((()=>{n.onError.remove(b),M(n)}))}))}))}createMatchMakeRequest(M,E){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},x=arguments.length>3?arguments[3]:void 0,g=arguments.length>4?arguments[4]:void 0;return k(this,void 0,void 0,(function*(){const k=(yield(0,a.post)(this.getHttpEndpoint(`${M}/${E}`),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(b)})).data;if(k.error)throw new J(k.error,k.code);return"reconnect"===M&&(k.reconnectionToken=b.reconnectionToken),yield this.consumeSeatReservation(k,x,g)}))}createRoom(M,E){return new n.Room(M,E)}buildEndpoint(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const b=[];for(const k in E)E.hasOwnProperty(k)&&b.push(`${k}=${E[k]}`);let x=this.settings.secure?"wss://":"ws://";return M.publicAddress?x+=`${M.publicAddress}`:x+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`,`${x}/${M.processId}/${M.roomId}?${b.join("&")}`}getHttpEndpoint(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}/matchmake/${M}`}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},11261:(M,E,b)=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0}),E.Connection=void 0;const x=b(11267);E.Connection=class{constructor(){this.events={},this.transport=new x.WebSocketTransport(this.events)}send(M){this.transport.send(M)}connect(M){this.transport.connect(M)}close(M,E){this.transport.close(M,E)}get isOpen(){return this.transport.isOpen}}},11276:(M,E)=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0}),E.utf8Length=E.utf8Read=E.ErrorCode=E.Protocol=void 0,function(M){M[M.HANDSHAKE=9]="HANDSHAKE",M[M.JOIN_ROOM=10]="JOIN_ROOM",M[M.ERROR=11]="ERROR",M[M.LEAVE_ROOM=12]="LEAVE_ROOM",M[M.ROOM_DATA=13]="ROOM_DATA",M[M.ROOM_STATE=14]="ROOM_STATE",M[M.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",M[M.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",M[M.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(E.Protocol||(E.Protocol={})),function(M){M[M.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",M[M.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",M[M.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",M[M.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",M[M.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",M[M.AUTH_FAILED=4215]="AUTH_FAILED",M[M.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(E.ErrorCode||(E.ErrorCode={})),E.utf8Read=function(M,E){const b=M[E++];for(var x="",k=0,a=E,g=E+b;a<g;a++){var n=M[a];if(0!==(128&n))if(192!==(224&n))if(224!==(240&n)){if(240!==(248&n))throw new Error("Invalid byte "+n.toString(16));(k=(7&n)<<18|(63&M[++a])<<12|(63&M[++a])<<6|63&M[++a])>=65536?(k-=65536,x+=String.fromCharCode(55296+(k>>>10),56320+(1023&k))):x+=String.fromCharCode(k)}else x+=String.fromCharCode((15&n)<<12|(63&M[++a])<<6|63&M[++a]);else x+=String.fromCharCode((31&n)<<6|63&M[++a]);else x+=String.fromCharCode(n)}return x},E.utf8Length=function(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",E=0,b=0;for(let x=0,k=M.length;x<k;x++)E=M.charCodeAt(x),E<128?b+=1:E<2048?b+=2:E<55296||E>=57344?b+=3:(x++,b+=4);return b+1}},11249:function(M,E,b){"use strict";var x=this&&this.__createBinding||(Object.create?function(M,E,b,x){void 0===x&&(x=b);var k=Object.getOwnPropertyDescriptor(E,b);k&&!("get"in k?!E.__esModule:k.writable||k.configurable)||(k={enumerable:!0,get:function(){return E[b]}}),Object.defineProperty(M,x,k)}:function(M,E,b,x){void 0===x&&(x=b),M[x]=E[b]}),k=this&&this.__setModuleDefault||(Object.create?function(M,E){Object.defineProperty(M,"default",{enumerable:!0,value:E})}:function(M,E){M.default=E}),a=this&&this.__importStar||function(M){if(M&&M.__esModule)return M;var E={};if(null!=M)for(var b in M)"default"!==b&&Object.prototype.hasOwnProperty.call(M,b)&&x(E,M,b);return k(E,M),E};Object.defineProperty(E,"__esModule",{value:!0}),E.Room=void 0;const g=a(b(11252)),n=b(11261),J=b(11276),u=b(11279),T=b(11286),V=b(11295),I=b(11301),t=b(11241);class y{constructor(M,E){this.onStateChange=(0,V.createSignal)(),this.onError=(0,V.createSignal)(),this.onLeave=(0,V.createSignal)(),this.onJoin=(0,V.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,T.createNanoEvents)(),this.roomId=null,this.name=M,E&&(this.serializer=new((0,u.getSerializer)("schema")),this.rootSchema=E,this.serializer.state=new E),this.onError(((M,E)=>{var b;return null===(b=console.warn)||void 0===b?void 0:b.call(console,`colyseus.js - onError => (${M}) ${E}`)})),this.onLeave((()=>this.removeAllListeners()))}get id(){return this.roomId}connect(M,E){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;const x=new n.Connection;b.connection=x,x.events.onmessage=y.prototype.onMessageCallback.bind(b),x.events.onclose=function(M){var x;if(!b.hasJoined)return null===(x=console.warn)||void 0===x||x.call(console,`Room connection was closed unexpectedly (${M.code}): ${M.reason}`),void b.onError.invoke(M.code,M.reason);M.code===t.CloseCode.DEVMODE_RESTART&&E?E():(b.onLeave.invoke(M.code),b.destroy())},x.events.onerror=function(M){var E;null===(E=console.warn)||void 0===E||E.call(console,`Room, onError (${M.code}): ${M.reason}`),b.onError.invoke(M.code,M.reason)},x.connect(M)}leave(){let M=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((E=>{this.onLeave((M=>E(M))),this.connection?M?this.connection.send([J.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(t.CloseCode.CONSENTED)}))}onMessage(M,E){return this.onMessageHandlers.on(this.getMessageHandlerKey(M),E)}send(M,E){const b=[J.Protocol.ROOM_DATA];let x;if("string"===typeof M?I.encode.string(b,M):I.encode.number(b,M),void 0!==E){const M=g.encode(E);x=new Uint8Array(b.length+M.byteLength),x.set(new Uint8Array(b),0),x.set(new Uint8Array(M),b.length)}else x=new Uint8Array(b);this.connection.send(x.buffer)}sendBytes(M,E){const b=[J.Protocol.ROOM_DATA_BYTES];let x;"string"===typeof M?I.encode.string(b,M):I.encode.number(b,M),x=new Uint8Array(b.length+(E.byteLength||E.length)),x.set(new Uint8Array(b),0),x.set(new Uint8Array(E),b.length),this.connection.send(x.buffer)}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(M){const E=Array.from(new Uint8Array(M.data)),b=E[0];if(b===J.Protocol.JOIN_ROOM){let M=1;const b=(0,J.utf8Read)(E,M);if(M+=(0,J.utf8Length)(b),this.serializerId=(0,J.utf8Read)(E,M),M+=(0,J.utf8Length)(this.serializerId),!this.serializer){const M=(0,u.getSerializer)(this.serializerId);this.serializer=new M}E.length>M&&this.serializer.handshake&&this.serializer.handshake(E,{offset:M}),this.reconnectionToken=`${this.roomId}:${b}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([J.Protocol.JOIN_ROOM])}else if(b===J.Protocol.ERROR){const M={offset:1},b=I.decode.number(E,M),x=I.decode.string(E,M);this.onError.invoke(b,x)}else if(b===J.Protocol.LEAVE_ROOM)this.leave();else if(b===J.Protocol.ROOM_DATA_SCHEMA){const M={offset:1},b=this.serializer.getState().constructor._context.get(I.decode.number(E,M)),x=new b;x.decode(E,M),this.dispatchMessage(b,x)}else if(b===J.Protocol.ROOM_STATE)E.shift(),this.setState(E);else if(b===J.Protocol.ROOM_STATE_PATCH)E.shift(),this.patch(E);else if(b===J.Protocol.ROOM_DATA){const b={offset:1},x=I.decode.stringCheck(E,b)?I.decode.string(E,b):I.decode.number(E,b),k=E.length>b.offset?g.decode(M.data,b.offset):void 0;this.dispatchMessage(x,k)}else if(b===J.Protocol.ROOM_DATA_BYTES){const M={offset:1},b=I.decode.stringCheck(E,M)?I.decode.string(E,M):I.decode.number(E,M);this.dispatchMessage(b,new Uint8Array(E.slice(M.offset)))}}setState(M){this.serializer.setState(M),this.onStateChange.invoke(this.serializer.getState())}patch(M){this.serializer.patch(M),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(M,E){var b;const x=this.getMessageHandlerKey(M);this.onMessageHandlers.events[x]?this.onMessageHandlers.emit(x,E):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",M,E):null===(b=console.warn)||void 0===b||b.call(console,`colyseus.js: onMessage() not registered for type '${M}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(M){switch(typeof M){case"function":return`$${M._typeid}`;case"string":return M;case"number":return`i${M}`;default:throw new Error("invalid message type.")}}}E.Room=y},11316:(M,E)=>{"use strict";let b;function x(){return b||(b="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!==typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(M,E){this.cache[M]=E},getItem:function(M){this.cache[M]},removeItem:function(M){delete this.cache[M]}}),b}Object.defineProperty(E,"__esModule",{value:!0}),E.getItem=E.removeItem=E.setItem=void 0,E.setItem=function(M,E){x().setItem(M,E)},E.removeItem=function(M){x().removeItem(M)},E.getItem=function(M,E){const b=x().getItem(M);"undefined"!==typeof Promise&&b instanceof Promise?b.then((M=>E(M))):E(b)}},11286:(M,E)=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0}),E.createNanoEvents=void 0;E.createNanoEvents=()=>({emit(M){let E=this.events[M]||[];for(var b=arguments.length,x=new Array(b>1?b-1:0),k=1;k<b;k++)x[k-1]=arguments[k];for(let a=0,g=E.length;a<g;a++)E[a](...x)},events:{},on(M,E){var b;return(null===(b=this.events[M])||void 0===b?void 0:b.push(E))||(this.events[M]=[E]),()=>{var b;this.events[M]=null===(b=this.events[M])||void 0===b?void 0:b.filter((M=>E!==M))}}})},11295:(M,E)=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0}),E.createSignal=E.EventEmitter=void 0;class b{constructor(){this.handlers=[]}register(M){return this.handlers.push(M),this}invoke(){for(var M=arguments.length,E=new Array(M),b=0;b<M;b++)E[b]=arguments[b];this.handlers.forEach((M=>M.apply(this,E)))}invokeAsync(){for(var M=arguments.length,E=new Array(M),b=0;b<M;b++)E[b]=arguments[b];return Promise.all(this.handlers.map((M=>M.apply(this,E))))}remove(M){const E=this.handlers.indexOf(M);this.handlers[E]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}E.EventEmitter=b,E.createSignal=function(){const M=new b;function E(E){return M.register(E,null===this)}return E.once=E=>{const b=function(){for(var x=arguments.length,k=new Array(x),a=0;a<x;a++)k[a]=arguments[a];E.apply(this,k),M.remove(b)};M.register(b)},E.remove=E=>M.remove(E),E.invoke=function(){return M.invoke(...arguments)},E.invokeAsync=function(){return M.invokeAsync(...arguments)},E.clear=()=>M.clear(),E}},11241:(M,E)=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0}),E.ServerError=E.CloseCode=void 0,function(M){M[M.CONSENTED=4e3]="CONSENTED",M[M.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(E.CloseCode||(E.CloseCode={}));class b extends Error{constructor(M,E){super(E),this.name="ServerError",this.code=M}}E.ServerError=b},11214:(M,E,b)=>{"use strict";E.b=void 0,b(11218);var x=b(11225);Object.defineProperty(E,"b",{enumerable:!0,get:function(){return x.Client}});var k=b(11276);var a=b(11249);var g=b(11309);const n=b(11323);const J=b(11332),u=b(11279);(0,u.registerSerializer)("schema",n.SchemaSerializer),(0,u.registerSerializer)("none",J.NoneSerializer)},11218:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=M=>null!==M&&"object"===typeof M&&M.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},11252:(M,E)=>{"use strict";function b(M,E){if(this._offset=E,M instanceof ArrayBuffer)this._buffer=M,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(M))throw new Error("Invalid argument");this._buffer=M.buffer,this._view=new DataView(this._buffer,M.byteOffset,M.byteLength)}}Object.defineProperty(E,"__esModule",{value:!0}),E.decode=E.encode=void 0,b.prototype._array=function(M){for(var E=new Array(M),b=0;b<M;b++)E[b]=this._parse();return E},b.prototype._map=function(M){for(var E={},b=0;b<M;b++)E[this._parse()]=this._parse();return E},b.prototype._str=function(M){var E=function(M,E,b){for(var x="",k=0,a=E,g=E+b;a<g;a++){var n=M.getUint8(a);if(0!==(128&n))if(192!==(224&n))if(224!==(240&n)){if(240!==(248&n))throw new Error("Invalid byte "+n.toString(16));(k=(7&n)<<18|(63&M.getUint8(++a))<<12|(63&M.getUint8(++a))<<6|63&M.getUint8(++a))>=65536?(k-=65536,x+=String.fromCharCode(55296+(k>>>10),56320+(1023&k))):x+=String.fromCharCode(k)}else x+=String.fromCharCode((15&n)<<12|(63&M.getUint8(++a))<<6|63&M.getUint8(++a));else x+=String.fromCharCode((31&n)<<6|63&M.getUint8(++a));else x+=String.fromCharCode(n)}return x}(this._view,this._offset,M);return this._offset+=M,E},b.prototype._bin=function(M){var E=this._buffer.slice(this._offset,this._offset+M);return this._offset+=M,E},b.prototype._parse=function(){var M,E=this._view.getUint8(this._offset++),b=0,x=0,k=0,a=0;if(E<192)return E<128?E:E<144?this._map(15&E):E<160?this._array(15&E):this._str(31&E);if(E>223)return-1*(255-E+1);switch(E){case 192:return null;case 194:return!1;case 195:return!0;case 196:return b=this._view.getUint8(this._offset),this._offset+=1,this._bin(b);case 197:return b=this._view.getUint16(this._offset),this._offset+=2,this._bin(b);case 198:return b=this._view.getUint32(this._offset),this._offset+=4,this._bin(b);case 199:if(b=this._view.getUint8(this._offset),x=this._view.getInt8(this._offset+1),this._offset+=2,-1===x){var g=this._view.getUint32(this._offset);return k=this._view.getInt32(this._offset+4),a=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*k+a)+g/1e6)}return[x,this._bin(b)];case 200:return b=this._view.getUint16(this._offset),x=this._view.getInt8(this._offset+2),this._offset+=3,[x,this._bin(b)];case 201:return b=this._view.getUint32(this._offset),x=this._view.getInt8(this._offset+4),this._offset+=5,[x,this._bin(b)];case 202:return M=this._view.getFloat32(this._offset),this._offset+=4,M;case 203:return M=this._view.getFloat64(this._offset),this._offset+=8,M;case 204:return M=this._view.getUint8(this._offset),this._offset+=1,M;case 205:return M=this._view.getUint16(this._offset),this._offset+=2,M;case 206:return M=this._view.getUint32(this._offset),this._offset+=4,M;case 207:return k=this._view.getUint32(this._offset)*Math.pow(2,32),a=this._view.getUint32(this._offset+4),this._offset+=8,k+a;case 208:return M=this._view.getInt8(this._offset),this._offset+=1,M;case 209:return M=this._view.getInt16(this._offset),this._offset+=2,M;case 210:return M=this._view.getInt32(this._offset),this._offset+=4,M;case 211:return k=this._view.getInt32(this._offset)*Math.pow(2,32),a=this._view.getUint32(this._offset+4),this._offset+=8,k+a;case 212:return x=this._view.getInt8(this._offset),this._offset+=1,0===x?void(this._offset+=1):[x,this._bin(1)];case 213:return x=this._view.getInt8(this._offset),this._offset+=1,[x,this._bin(2)];case 214:return x=this._view.getInt8(this._offset),this._offset+=1,-1===x?(M=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*M)):[x,this._bin(4)];case 215:return x=this._view.getInt8(this._offset),this._offset+=1,0===x?(k=this._view.getInt32(this._offset)*Math.pow(2,32),a=this._view.getUint32(this._offset+4),this._offset+=8,new Date(k+a)):-1===x?(k=this._view.getUint32(this._offset),a=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&k)+a)+(k>>>2)/1e6)):[x,this._bin(8)];case 216:return x=this._view.getInt8(this._offset),this._offset+=1,[x,this._bin(16)];case 217:return b=this._view.getUint8(this._offset),this._offset+=1,this._str(b);case 218:return b=this._view.getUint16(this._offset),this._offset+=2,this._str(b);case 219:return b=this._view.getUint32(this._offset),this._offset+=4,this._str(b);case 220:return b=this._view.getUint16(this._offset),this._offset+=2,this._array(b);case 221:return b=this._view.getUint32(this._offset),this._offset+=4,this._array(b);case 222:return b=this._view.getUint16(this._offset),this._offset+=2,this._map(b);case 223:return b=this._view.getUint32(this._offset),this._offset+=4,this._map(b)}throw new Error("Could not parse")},E.decode=function(M){var E=new b(M,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),x=E._parse();if(E._offset!==M.byteLength)throw new Error(M.byteLength-E._offset+" trailing bytes");return x};function x(M,E,b){for(var x=0,k=0,a=b.length;k<a;k++)(x=b.charCodeAt(k))<128?M.setUint8(E++,x):x<2048?(M.setUint8(E++,192|x>>6),M.setUint8(E++,128|63&x)):x<55296||x>=57344?(M.setUint8(E++,224|x>>12),M.setUint8(E++,128|x>>6&63),M.setUint8(E++,128|63&x)):(k++,x=65536+((1023&x)<<10|1023&b.charCodeAt(k)),M.setUint8(E++,240|x>>18),M.setUint8(E++,128|x>>12&63),M.setUint8(E++,128|x>>6&63),M.setUint8(E++,128|63&x))}function k(M,E,b){var x=typeof b,a=0,g=0,n=0,J=0,u=0,T=0;if("string"===x){if(u=function(M){for(var E=0,b=0,x=0,k=M.length;x<k;x++)(E=M.charCodeAt(x))<128?b+=1:E<2048?b+=2:E<55296||E>=57344?b+=3:(x++,b+=4);return b}(b),u<32)M.push(160|u),T=1;else if(u<256)M.push(217,u),T=2;else if(u<65536)M.push(218,u>>8,u),T=3;else{if(!(u<4294967296))throw new Error("String too long");M.push(219,u>>24,u>>16,u>>8,u),T=5}return E.push({_str:b,_length:u,_offset:M.length}),T+u}if("number"===x)return Math.floor(b)===b&&isFinite(b)?b>=0?b<128?(M.push(b),1):b<256?(M.push(204,b),2):b<65536?(M.push(205,b>>8,b),3):b<4294967296?(M.push(206,b>>24,b>>16,b>>8,b),5):(n=b/Math.pow(2,32)|0,J=b>>>0,M.push(207,n>>24,n>>16,n>>8,n,J>>24,J>>16,J>>8,J),9):b>=-32?(M.push(b),1):b>=-128?(M.push(208,b),2):b>=-32768?(M.push(209,b>>8,b),3):b>=-2147483648?(M.push(210,b>>24,b>>16,b>>8,b),5):(n=Math.floor(b/Math.pow(2,32)),J=b>>>0,M.push(211,n>>24,n>>16,n>>8,n,J>>24,J>>16,J>>8,J),9):(M.push(203),E.push({_float:b,_length:8,_offset:M.length}),9);if("object"===x){if(null===b)return M.push(192),1;if(Array.isArray(b)){if((u=b.length)<16)M.push(144|u),T=1;else if(u<65536)M.push(220,u>>8,u),T=3;else{if(!(u<4294967296))throw new Error("Array too large");M.push(221,u>>24,u>>16,u>>8,u),T=5}for(a=0;a<u;a++)T+=k(M,E,b[a]);return T}if(b instanceof Date){var V=b.getTime(),I=Math.floor(V/1e3),t=1e6*(V-1e3*I);return I>=0&&t>=0&&I<=17179869183?0===t&&I<=4294967295?(M.push(214,255,I>>24,I>>16,I>>8,I),6):(n=I/4294967296,J=4294967295&I,M.push(215,255,t>>22,t>>14,t>>6,n,J>>24,J>>16,J>>8,J),10):(n=Math.floor(I/4294967296),J=I>>>0,M.push(199,12,255,t>>24,t>>16,t>>8,t,n>>24,n>>16,n>>8,n,J>>24,J>>16,J>>8,J),15)}if(b instanceof ArrayBuffer){if((u=b.byteLength)<256)M.push(196,u),T=2;else if(u<65536)M.push(197,u>>8,u),T=3;else{if(!(u<4294967296))throw new Error("Buffer too large");M.push(198,u>>24,u>>16,u>>8,u),T=5}return E.push({_bin:b,_length:u,_offset:M.length}),T+u}if("function"===typeof b.toJSON)return k(M,E,b.toJSON());var y=[],B="",r=Object.keys(b);for(a=0,g=r.length;a<g;a++)void 0!==b[B=r[a]]&&"function"!==typeof b[B]&&y.push(B);if((u=y.length)<16)M.push(128|u),T=1;else if(u<65536)M.push(222,u>>8,u),T=3;else{if(!(u<4294967296))throw new Error("Object too large");M.push(223,u>>24,u>>16,u>>8,u),T=5}for(a=0;a<u;a++)T+=k(M,E,B=y[a]),T+=k(M,E,b[B]);return T}if("boolean"===x)return M.push(b?195:194),1;if("undefined"===x)return M.push(192),1;if("function"===typeof b.toJSON)return k(M,E,b.toJSON());throw new Error("Could not encode")}E.encode=function(M){var E=[],b=[],a=k(E,b,M),g=new ArrayBuffer(a),n=new DataView(g),J=0,u=0,T=-1;b.length>0&&(T=b[0]._offset);for(var V,I=0,t=0,y=0,B=E.length;y<B;y++)if(n.setUint8(u+y,E[y]),y+1===T){if(I=(V=b[J])._length,t=u+T,V._bin)for(var r=new Uint8Array(V._bin),c=0;c<I;c++)n.setUint8(t+c,r[c]);else V._str?x(n,t,V._str):void 0!==V._float&&n.setFloat64(t,V._float);u+=I,b[++J]&&(T=b[J]._offset)}return g}},11332:(M,E)=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0}),E.NoneSerializer=void 0;E.NoneSerializer=class{setState(M){}getState(){return null}patch(M){}teardown(){}handshake(M){}}},11323:(M,E,b)=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0}),E.SchemaSerializer=void 0;const x=b(11301);E.SchemaSerializer=class{setState(M){return this.state.decode(M)}getState(){return this.state}patch(M){return this.state.decode(M)}teardown(){var M,E;null===(E=null===(M=this.state)||void 0===M?void 0:M.$changes)||void 0===E||E.root.clearRefs()}handshake(M,E){if(this.state){(new x.Reflection).decode(M,E)}else this.state=x.Reflection.decode(M,E)}}},11279:(M,E)=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0}),E.getSerializer=E.registerSerializer=void 0;const b={};E.registerSerializer=function(M,E){b[M]=E},E.getSerializer=function(M){const E=b[M];if(!E)throw new Error("missing serializer: "+M);return E}},11267:function(M,E,b){"use strict";var x=this&&this.__importDefault||function(M){return M&&M.__esModule?M:{default:M}};Object.defineProperty(E,"__esModule",{value:!0}),E.WebSocketTransport=void 0;const k=x(b(11274)),a=globalThis.WebSocket||k.default;E.WebSocketTransport=class{constructor(M){this.events=M}send(M){M instanceof ArrayBuffer?this.ws.send(M):Array.isArray(M)&&this.ws.send(new Uint8Array(M).buffer)}connect(M){this.ws=new a(M,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(M,E){this.ws.close(M,E)}get isOpen(){return this.ws.readyState===a.OPEN}}},11274:M=>{"use strict";M.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},11382:M=>{"use strict";M.exports=function(M){for(var E=new Array(M),b=0;b<M;++b)E[b]=b;return E}},11390:M=>{function E(M){return!!M.constructor&&"function"===typeof M.constructor.isBuffer&&M.constructor.isBuffer(M)}M.exports=function(M){return null!=M&&(E(M)||function(M){return"function"===typeof M.readFloatLE&&"function"===typeof M.slice&&E(M.slice(0,0))}(M)||!!M._isBuffer)}},11373:(M,E,b)=>{var x=b(11382),k=b(11390),a="undefined"!==typeof Float64Array;function g(M,E){return M[0]-E[0]}function n(){var M,E=this.stride,b=new Array(E.length);for(M=0;M<b.length;++M)b[M]=[Math.abs(E[M]),M];b.sort(g);var x=new Array(b.length);for(M=0;M<x.length;++M)x[M]=b[M][1];return x}function J(M,E){var b=["View",E,"d",M].join("");E<0&&(b="View_Nil"+M);var k="generic"===M;if(-1===E){var a="function "+b+"(a){this.data=a;};var proto="+b+".prototype;proto.dtype='"+M+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+b+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+b+"(a){return new "+b+"(a);}";return new Function(a)()}if(0===E){a="function "+b+"(a,d) {this.data = a;this.offset = d};var proto="+b+".prototype;proto.dtype='"+M+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+b+"_copy() {return new "+b+"(this.data,this.offset)};proto.pick=function "+b+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+b+"_get(){return "+(k?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+b+"_set(v){return "+(k?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+b+"(a,b,c,d){return new "+b+"(a,d)}";return new Function("TrivialArray",a)(u[M][0])}a=["'use strict'"];var g=x(E),J=g.map((function(M){return"i"+M})),T="this.offset+"+g.map((function(M){return"this.stride["+M+"]*i"+M})).join("+"),V=g.map((function(M){return"b"+M})).join(","),I=g.map((function(M){return"c"+M})).join(",");a.push("function "+b+"(a,"+V+","+I+",d){this.data=a","this.shape=["+V+"]","this.stride=["+I+"]","this.offset=d|0}","var proto="+b+".prototype","proto.dtype='"+M+"'","proto.dimension="+E),a.push("Object.defineProperty(proto,'size',{get:function "+b+"_size(){return "+g.map((function(M){return"this.shape["+M+"]"})).join("*"),"}})"),1===E?a.push("proto.order=[0]"):(a.push("Object.defineProperty(proto,'order',{get:"),E<4?(a.push("function "+b+"_order(){"),2===E?a.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===E&&a.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):a.push("ORDER})")),a.push("proto.set=function "+b+"_set("+J.join(",")+",v){"),k?a.push("return this.data.set("+T+",v)}"):a.push("return this.data["+T+"]=v}"),a.push("proto.get=function "+b+"_get("+J.join(",")+"){"),k?a.push("return this.data.get("+T+")}"):a.push("return this.data["+T+"]}"),a.push("proto.index=function "+b+"_index(",J.join(),"){return "+T+"}"),a.push("proto.hi=function "+b+"_hi("+J.join(",")+"){return new "+b+"(this.data,"+g.map((function(M){return["(typeof i",M,"!=='number'||i",M,"<0)?this.shape[",M,"]:i",M,"|0"].join("")})).join(",")+","+g.map((function(M){return"this.stride["+M+"]"})).join(",")+",this.offset)}");var t=g.map((function(M){return"a"+M+"=this.shape["+M+"]"})),y=g.map((function(M){return"c"+M+"=this.stride["+M+"]"}));a.push("proto.lo=function "+b+"_lo("+J.join(",")+"){var b=this.offset,d=0,"+t.join(",")+","+y.join(","));for(var B=0;B<E;++B)a.push("if(typeof i"+B+"==='number'&&i"+B+">=0){d=i"+B+"|0;b+=c"+B+"*d;a"+B+"-=d}");a.push("return new "+b+"(this.data,"+g.map((function(M){return"a"+M})).join(",")+","+g.map((function(M){return"c"+M})).join(",")+",b)}"),a.push("proto.step=function "+b+"_step("+J.join(",")+"){var "+g.map((function(M){return"a"+M+"=this.shape["+M+"]"})).join(",")+","+g.map((function(M){return"b"+M+"=this.stride["+M+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(B=0;B<E;++B)a.push("if(typeof i"+B+"==='number'){d=i"+B+"|0;if(d<0){c+=b"+B+"*(a"+B+"-1);a"+B+"=ceil(-a"+B+"/d)}else{a"+B+"=ceil(a"+B+"/d)}b"+B+"*=d}");a.push("return new "+b+"(this.data,"+g.map((function(M){return"a"+M})).join(",")+","+g.map((function(M){return"b"+M})).join(",")+",c)}");var r=new Array(E),c=new Array(E);for(B=0;B<E;++B)r[B]="a[i"+B+"]",c[B]="b[i"+B+"]";a.push("proto.transpose=function "+b+"_transpose("+J+"){"+J.map((function(M,E){return M+"=("+M+"===undefined?"+E+":"+M+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+b+"(this.data,"+r.join(",")+","+c.join(",")+",this.offset)}"),a.push("proto.pick=function "+b+"_pick("+J+"){var a=[],b=[],c=this.offset");for(B=0;B<E;++B)a.push("if(typeof i"+B+"==='number'&&i"+B+">=0){c=(c+this.stride["+B+"]*i"+B+")|0}else{a.push(this.shape["+B+"]);b.push(this.stride["+B+"])}");return a.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),a.push("return function construct_"+b+"(data,shape,stride,offset){return new "+b+"(data,"+g.map((function(M){return"shape["+M+"]"})).join(",")+","+g.map((function(M){return"stride["+M+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",a.join("\n"))(u[M],n)}var u={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};M.exports=function(M,E,b,x){if(void 0===M)return(0,u.array[0])([]);"number"===typeof M&&(M=[M]),void 0===E&&(E=[M.length]);var g=E.length;if(void 0===b){b=new Array(g);for(var n=g-1,T=1;n>=0;--n)b[n]=T,T*=E[n]}if(void 0===x){x=0;for(n=0;n<g;++n)b[n]<0&&(x-=(E[n]-1)*b[n])}for(var V=function(M){if(k(M))return"buffer";if(a)switch(Object.prototype.toString.call(M)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(M)?"array":"generic"}(M),I=u[V];I.length<=g+1;)I.push(J(V,I.length-1));return(0,I[g+1])(M,E,b,x)}},11346:M=>{var E;self,E=()=>(()=>{"use strict";var M={d:(E,b)=>{for(var x in b)M.o(b,x)&&!M.o(E,x)&&Object.defineProperty(E,x,{enumerable:!0,get:b[x]})},o:(M,E)=>Object.prototype.hasOwnProperty.call(M,E)},E={};M.d(E,{default:()=>F});var b,x=function(M,E){var b=E.x-M.x,x=E.y-M.y;return Math.sqrt(b*b+x*x)},k=function(M){return M*(Math.PI/180)},a=new Map,g=function(M){a.has(M)&&clearTimeout(a.get(M)),a.set(M,setTimeout(M,100))},n=function(M,E,b){for(var x,k=E.split(/[ ,]+/g),a=0;a<k.length;a+=1)x=k[a],M.addEventListener?M.addEventListener(x,b,!1):M.attachEvent&&M.attachEvent(x,b)},J=function(M,E,b){for(var x,k=E.split(/[ ,]+/g),a=0;a<k.length;a+=1)x=k[a],M.removeEventListener?M.removeEventListener(x,b):M.detachEvent&&M.detachEvent(x,b)},u=function(M){return M.preventDefault(),M.type.match(/^touch/)?M.changedTouches:M},T=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},V=function(M,E){E.top||E.right||E.bottom||E.left?(M.style.top=E.top,M.style.right=E.right,M.style.bottom=E.bottom,M.style.left=E.left):(M.style.left=E.x+"px",M.style.top=E.y+"px")},I=function(M,E,b){var x=t(M);for(var k in x)if(x.hasOwnProperty(k))if("string"==typeof E)x[k]=E+" "+b;else{for(var a="",g=0,n=E.length;g<n;g+=1)a+=E[g]+" "+b+", ";x[k]=a.slice(0,-2)}return x},t=function(M){var E={};return E[M]="",["webkit","Moz","o"].forEach((function(b){E[b+M.charAt(0).toUpperCase()+M.slice(1)]=""})),E},y=function(M,E){for(var b in E)E.hasOwnProperty(b)&&(M[b]=E[b]);return M},B=function(M,E){if(M.length)for(var b=0,x=M.length;b<x;b+=1)E(M[b]);else E(M)},r="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,c=window.matchMedia("(any-hover: none)").matches,C=!!("ontouchstart"in window),R=!!window.PointerEvent,w=!!window.MSPointerEvent,S={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},X={start:"mousedown",move:"mousemove",end:"mouseup"},U={};function v(){}r&&!c?b=S:R?b={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:w?b={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:C?(b=S,U=X):b=X,v.prototype.on=function(M,E){var b,x=this,k=M.split(/[ ,]+/g);x._handlers_=x._handlers_||{};for(var a=0;a<k.length;a+=1)b=k[a],x._handlers_[b]=x._handlers_[b]||[],x._handlers_[b].push(E);return x},v.prototype.off=function(M,E){var b=this;return b._handlers_=b._handlers_||{},void 0===M?b._handlers_={}:void 0===E?b._handlers_[M]=null:b._handlers_[M]&&b._handlers_[M].indexOf(E)>=0&&b._handlers_[M].splice(b._handlers_[M].indexOf(E),1),b},v.prototype.trigger=function(M,E){var b,x=this,k=M.split(/[ ,]+/g);x._handlers_=x._handlers_||{};for(var a=0;a<k.length;a+=1)b=k[a],x._handlers_[b]&&x._handlers_[b].length&&x._handlers_[b].forEach((function(M){M.call(x,{type:b,target:x},E)}))},v.prototype.config=function(M){var E=this;E.options=E.defaults||{},M&&(E.options=function(M,E){var b={};for(var x in M)M.hasOwnProperty(x)&&E.hasOwnProperty(x)?b[x]=E[x]:M.hasOwnProperty(x)&&(b[x]=M[x]);return b}(E.options,M))},v.prototype.bindEvt=function(M,E){var x=this;return x._domHandlers_=x._domHandlers_||{},x._domHandlers_[E]=function(){"function"==typeof x["on"+E]?x["on"+E].apply(x,arguments):console.warn('[WARNING] : Missing "on'+E+'" handler.')},n(M,b[E],x._domHandlers_[E]),U[E]&&n(M,U[E],x._domHandlers_[E]),x},v.prototype.unbindEvt=function(M,E){var x=this;return x._domHandlers_=x._domHandlers_||{},J(M,b[E],x._domHandlers_[E]),U[E]&&J(M,U[E],x._domHandlers_[E]),delete x._domHandlers_[E],this};const N=v;function K(M,E){return this.identifier=E.identifier,this.position=E.position,this.frontPosition=E.frontPosition,this.collection=M,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(E),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=K.id,K.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}K.prototype=new N,K.constructor=K,K.id=0,K.prototype.buildEl=function(M){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},K.prototype.stylize=function(){if(this.options.dataOnly)return this;var M=this.options.fadeTime+"ms",E=function(){var M=t("borderRadius");for(var E in M)M.hasOwnProperty(E)&&(M[E]="50%");return M}(),b=I("transition","opacity",M),x={};return x.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},x.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},x.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},y(x.el,b),"circle"===this.options.shape&&y(x.back,E),y(x.front,E),this.applyStyles(x),this},K.prototype.applyStyles=function(M){for(var E in this.ui)if(this.ui.hasOwnProperty(E))for(var b in M[E])this.ui[E].style[b]=M[E][b];return this},K.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},K.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},K.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},K.prototype.show=function(M){var E=this;return E.options.dataOnly||(clearTimeout(E.removeTimeout),clearTimeout(E.showTimeout),clearTimeout(E.restTimeout),E.addToDom(),E.restCallback(),setTimeout((function(){E.ui.el.style.opacity=1}),0),E.showTimeout=setTimeout((function(){E.trigger("shown",E.instance),"function"==typeof M&&M.call(this)}),E.options.fadeTime)),E},K.prototype.hide=function(M){var E=this;if(E.options.dataOnly)return E;if(E.ui.el.style.opacity=E.options.restOpacity,clearTimeout(E.removeTimeout),clearTimeout(E.showTimeout),clearTimeout(E.restTimeout),E.removeTimeout=setTimeout((function(){var b="dynamic"===E.options.mode?"none":"block";E.ui.el.style.display=b,"function"==typeof M&&M.call(E),E.trigger("hidden",E.instance)}),E.options.fadeTime),E.options.restJoystick){var b=E.options.restJoystick,x={};x.x=!0===b||!1!==b.x?0:E.instance.frontPosition.x,x.y=!0===b||!1!==b.y?0:E.instance.frontPosition.y,E.setPosition(M,x)}return E},K.prototype.setPosition=function(M,E){var b=this;b.frontPosition={x:E.x,y:E.y};var x=b.options.fadeTime+"ms",k={};k.front=I("transition",["transform"],x);var a={front:{}};a.front={transform:"translate("+b.frontPosition.x+"px,"+b.frontPosition.y+"px)"},b.applyStyles(k),b.applyStyles(a),b.restTimeout=setTimeout((function(){"function"==typeof M&&M.call(b),b.restCallback()}),b.options.fadeTime)},K.prototype.restCallback=function(){var M=this,E={};E.front=I("transition","none",""),M.applyStyles(E),M.trigger("rested",M.instance)},K.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},K.prototype.computeDirection=function(M){var E,b,x,k=M.angle.radian,a=Math.PI/4,g=Math.PI/2;if(k>a&&k<3*a&&!M.lockX?E="up":k>-a&&k<=a&&!M.lockY?E="left":k>3*-a&&k<=-a&&!M.lockX?E="down":M.lockY||(E="right"),M.lockY||(b=k>-g&&k<g?"left":"right"),M.lockX||(x=k>0?"up":"down"),M.force>this.options.threshold){var n,J={};for(n in this.direction)this.direction.hasOwnProperty(n)&&(J[n]=this.direction[n]);var u={};for(n in this.direction={x:b,y:x,angle:E},M.direction=this.direction,J)J[n]===this.direction[n]&&(u[n]=!0);if(u.x&&u.y&&u.angle)return M;u.x&&u.y||this.trigger("plain",M),u.x||this.trigger("plain:"+b,M),u.y||this.trigger("plain:"+x,M),u.angle||this.trigger("dir dir:"+E,M)}else this.resetDirection();return M};const h=K;function Z(M,E){var b=this;b.nipples=[],b.idles=[],b.actives=[],b.ids=[],b.pressureIntervals={},b.manager=M,b.id=Z.id,Z.id+=1,b.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},b.config(E),"static"!==b.options.mode&&"semi"!==b.options.mode||(b.options.multitouch=!1),b.options.multitouch||(b.options.maxNumberOfNipples=1);var x=getComputedStyle(b.options.zone.parentElement);return x&&"flex"===x.display&&(b.parentIsFlex=!0),b.updateBox(),b.prepareNipples(),b.wj(),b.begin(),b.nipples}Z.prototype=new N,Z.constructor=Z,Z.id=0,Z.prototype.prepareNipples=function(){var M=this,E=M.nipples;E.on=M.on.bind(M),E.off=M.off.bind(M),E.options=M.options,E.destroy=M.destroy.bind(M),E.ids=M.ids,E.id=M.id,E.processOnMove=M.processOnMove.bind(M),E.processOnEnd=M.processOnEnd.bind(M),E.get=function(M){if(void 0===M)return E[0];for(var b=0,x=E.length;b<x;b+=1)if(E[b].identifier===M)return E[b];return!1}},Z.prototype.wj=function(){var M=this;M.bindEvt(M.options.zone,"start"),M.options.zone.style.touchAction="none",M.options.zone.style.msTouchAction="none"},Z.prototype.begin=function(){var M=this,E=M.options;if("static"===E.mode){var b=M.createNipple(E.position,M.manager.getIdentifier());b.add(),M.idles.push(b)}},Z.prototype.createNipple=function(M,E){var b=this,x=b.manager.scroll,k={},a=b.options,g=b.parentIsFlex?x.x:x.x+b.box.left,n=b.parentIsFlex?x.y:x.y+b.box.top;if(M.x&&M.y)k={x:M.x-g,y:M.y-n};else if(M.top||M.right||M.bottom||M.left){var J=document.createElement("DIV");J.style.display="hidden",J.style.top=M.top,J.style.right=M.right,J.style.bottom=M.bottom,J.style.left=M.left,J.style.position="absolute",a.zone.appendChild(J);var u=J.getBoundingClientRect();a.zone.removeChild(J),k=M,M={x:u.left+x.x,y:u.top+x.y}}var T=new h(b,{color:a.color,size:a.size,threshold:a.threshold,fadeTime:a.fadeTime,dataOnly:a.dataOnly,restJoystick:a.restJoystick,restOpacity:a.restOpacity,mode:a.mode,identifier:E,position:M,zone:a.zone,frontPosition:{x:0,y:0},shape:a.shape});return a.dataOnly||(V(T.ui.el,k),V(T.ui.front,T.frontPosition)),b.nipples.push(T),b.trigger("added "+T.identifier+":added",T),b.manager.trigger("added "+T.identifier+":added",T),b.bindNipple(T),T},Z.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},Z.prototype.bindNipple=function(M){var E,b=this,x=function(M,x){E=M.type+" "+x.id+":"+M.type,b.trigger(E,x)};M.on("destroyed",b.onDestroyed.bind(b)),M.on("shown hidden rested dir plain",x),M.on("dir:up dir:right dir:down dir:left",x),M.on("plain:up plain:right plain:down plain:left",x)},Z.prototype.pressureFn=function(M,E,b){var x=this,k=0;clearInterval(x.pressureIntervals[b]),x.pressureIntervals[b]=setInterval(function(){var b=M.force||M.pressure||M.webkitForce||0;b!==k&&(E.trigger("pressure",b),x.trigger("pressure "+E.identifier+":pressure",b),k=b)}.bind(x),100)},Z.prototype.onstart=function(M){var E=this,b=E.options,x=M;return M=u(M),E.updateBox(),B(M,(function(k){E.actives.length<b.maxNumberOfNipples?E.processOnStart(k):x.type.match(/^touch/)&&(Object.keys(E.manager.ids).forEach((function(b){if(Object.values(x.touches).findIndex((function(M){return M.identifier===b}))<0){var k=[M[0]];k.identifier=b,E.processOnEnd(k)}})),E.actives.length<b.maxNumberOfNipples&&E.processOnStart(k))})),E.manager.bindDocument(),!1},Z.prototype.processOnStart=function(M){var E,b=this,k=b.options,a=b.manager.getIdentifier(M),g=M.force||M.pressure||M.webkitForce||0,n={x:M.pageX,y:M.pageY},J=b.getOrCreate(a,n);J.identifier!==a&&b.manager.removeIdentifier(J.identifier),J.identifier=a;var u=function(E){E.trigger("start",E),b.trigger("start "+E.id+":start",E),E.show(),g>0&&b.pressureFn(M,E,E.identifier),b.processOnMove(M)};if((E=b.idles.indexOf(J))>=0&&b.idles.splice(E,1),b.actives.push(J),b.ids.push(J.identifier),"semi"!==k.mode)u(J);else{if(!(x(n,J.position)<=k.catchDistance))return J.destroy(),void b.processOnStart(M);u(J)}return J},Z.prototype.getOrCreate=function(M,E){var b,x=this,k=x.options;return/(semi|static)/.test(k.mode)?(b=x.idles[0])?(x.idles.splice(0,1),b):"semi"===k.mode?x.createNipple(E,M):(console.warn("Coudln't find the needed nipple."),!1):b=x.createNipple(E,M)},Z.prototype.processOnMove=function(M){var E=this,b=E.options,a=E.manager.getIdentifier(M),g=E.nipples.get(a),n=E.manager.scroll;if(function(M){return isNaN(M.buttons)?0!==M.pressure:0!==M.buttons}(M)){if(!g)return console.error("Found zombie joystick with ID "+a),void E.manager.removeIdentifier(a);if(b.dynamicPage){var J=g.el.getBoundingClientRect();g.position={x:n.x+J.left,y:n.y+J.top}}g.identifier=a;var u=g.options.size/2,T={x:M.pageX,y:M.pageY};b.lockX&&(T.y=g.position.y),b.lockY&&(T.x=g.position.x);var V,I,t,y,B,r,c,C,R,w,S=x(T,g.position),X=(V=T,t=(I=g.position).x-V.x,y=I.y-V.y,function(M){return M*(180/Math.PI)}(Math.atan2(y,t))),U=k(X),v=S/u,N={distance:S,position:T};if("circle"===g.options.shape?(B=Math.min(S,u),c=g.position,C=B,w={x:0,y:0},R=k(R=X),w.x=c.x-C*Math.cos(R),w.y=c.y-C*Math.sin(R),r=w):(r=function(M,E,b){return{x:Math.min(Math.max(M.x,E.x-b),E.x+b),y:Math.min(Math.max(M.y,E.y-b),E.y+b)}}(T,g.position,u),B=x(r,g.position)),b.follow){if(S>u){var K=T.x-r.x,h=T.y-r.y;g.position.x+=K,g.position.y+=h,g.el.style.top=g.position.y-(E.box.top+n.y)+"px",g.el.style.left=g.position.x-(E.box.left+n.x)+"px",S=x(T,g.position)}}else T=r,S=B;var Z=T.x-g.position.x,O=T.y-g.position.y;g.frontPosition={x:Z,y:O},b.dataOnly||(g.ui.front.style.transform="translate("+Z+"px,"+O+"px)");var p={identifier:g.identifier,position:T,force:v,pressure:M.force||M.pressure||M.webkitForce||0,distance:S,angle:{radian:U,degree:X},vector:{x:Z/u,y:-O/u},raw:N,instance:g,lockX:b.lockX,lockY:b.lockY};(p=g.computeDirection(p)).angle={radian:k(180-X),degree:180-X},g.trigger("move",p),E.trigger("move "+g.id+":move",p)}else this.processOnEnd(M)},Z.prototype.processOnEnd=function(M){var E=this,b=E.options,x=E.manager.getIdentifier(M),k=E.nipples.get(x),a=E.manager.removeIdentifier(k.identifier);k&&(b.dataOnly||k.hide((function(){"dynamic"===b.mode&&(k.trigger("removed",k),E.trigger("removed "+k.id+":removed",k),E.manager.trigger("removed "+k.id+":removed",k),k.destroy())})),clearInterval(E.pressureIntervals[k.identifier]),k.resetDirection(),k.trigger("end",k),E.trigger("end "+k.id+":end",k),E.ids.indexOf(k.identifier)>=0&&E.ids.splice(E.ids.indexOf(k.identifier),1),E.actives.indexOf(k)>=0&&E.actives.splice(E.actives.indexOf(k),1),/(semi|static)/.test(b.mode)?E.idles.push(k):E.nipples.indexOf(k)>=0&&E.nipples.splice(E.nipples.indexOf(k),1),E.manager.unbindDocument(),/(semi|static)/.test(b.mode)&&(E.manager.ids[a.id]=a.identifier))},Z.prototype.onDestroyed=function(M,E){var b=this;b.nipples.indexOf(E)>=0&&b.nipples.splice(b.nipples.indexOf(E),1),b.actives.indexOf(E)>=0&&b.actives.splice(b.actives.indexOf(E),1),b.idles.indexOf(E)>=0&&b.idles.splice(b.idles.indexOf(E),1),b.ids.indexOf(E.identifier)>=0&&b.ids.splice(b.ids.indexOf(E.identifier),1),b.manager.removeIdentifier(E.identifier),b.manager.unbindDocument()},Z.prototype.destroy=function(){var M=this;for(var E in M.unbindEvt(M.options.zone,"start"),M.nipples.forEach((function(M){M.destroy()})),M.pressureIntervals)M.pressureIntervals.hasOwnProperty(E)&&clearInterval(M.pressureIntervals[E]);M.trigger("destroyed",M.nipples),M.manager.unbindDocument(),M.off()};const O=Z;function p(M){var E=this;E.ids={},E.index=0,E.collections=[],E.scroll=T(),E.config(M),E.prepareCollections();var b=function(){var M;E.collections.forEach((function(b){b.forEach((function(b){M=b.el.getBoundingClientRect(),b.position={x:E.scroll.x+M.left,y:E.scroll.y+M.top}}))}))};n(window,"resize",(function(){g(b)}));var x=function(){E.scroll=T()};return n(window,"scroll",(function(){g(x)})),E.collections}p.prototype=new N,p.constructor=p,p.prototype.prepareCollections=function(){var M=this;M.collections.create=M.create.bind(M),M.collections.on=M.on.bind(M),M.collections.off=M.off.bind(M),M.collections.destroy=M.destroy.bind(M),M.collections.get=function(E){var b;return M.collections.every((function(M){return!(b=M.get(E))})),b}},p.prototype.create=function(M){return this.createCollection(M)},p.prototype.createCollection=function(M){var E=this,b=new O(E,M);return E.bindCollection(b),E.collections.push(b),b},p.prototype.bindCollection=function(M){var E,b=this,x=function(M,x){E=M.type+" "+x.id+":"+M.type,b.trigger(E,x)};M.on("destroyed",b.onDestroyed.bind(b)),M.on("shown hidden rested dir plain",x),M.on("dir:up dir:right dir:down dir:left",x),M.on("plain:up plain:right plain:down plain:left",x)},p.prototype.bindDocument=function(){var M=this;M.binded||(M.bindEvt(document,"move").bindEvt(document,"end"),M.binded=!0)},p.prototype.unbindDocument=function(M){var E=this;Object.keys(E.ids).length&&!0!==M||(E.unbindEvt(document,"move").unbindEvt(document,"end"),E.binded=!1)},p.prototype.getIdentifier=function(M){var E;return M?void 0===(E=void 0===M.identifier?M.pointerId:M.identifier)&&(E=this.latest||0):E=this.index,void 0===this.ids[E]&&(this.ids[E]=this.index,this.index+=1),this.latest=E,this.ids[E]},p.prototype.removeIdentifier=function(M){var E={};for(var b in this.ids)if(this.ids[b]===M){E.id=b,E.identifier=this.ids[b],delete this.ids[b];break}return E},p.prototype.onmove=function(M){return this.onAny("move",M),!1},p.prototype.onend=function(M){return this.onAny("end",M),!1},p.prototype.oncancel=function(M){return this.onAny("end",M),!1},p.prototype.onAny=function(M,E){var b,x=this,k="processOn"+M.charAt(0).toUpperCase()+M.slice(1);E=u(E);var a=function(M,E,b){b.ids.indexOf(E)>=0&&(b[k](M),M._found_=!0)};return B(E,(function(M){b=x.getIdentifier(M),B(x.collections,a.bind(null,M,b)),M._found_||x.removeIdentifier(b)})),!1},p.prototype.destroy=function(){var M=this;M.unbindDocument(!0),M.ids={},M.index=0,M.collections.forEach((function(M){M.destroy()})),M.off()},p.prototype.onDestroyed=function(M,E){var b=this;if(b.collections.indexOf(E)<0)return!1;b.collections.splice(b.collections.indexOf(E),1)};var P=new p;const F={create:function(M){return P.create(M)},factory:P};return E.default})(),M.exports=E()},11411:(M,E,b)=>{"use strict";const{Deflate:x,deflate:k,deflateRaw:a,gzip:g}=b(11417),{Inflate:n,inflate:J,inflateRaw:u,ungzip:T}=b(11478),V=b(11456);M.exports.Deflate=x,M.exports.deflate=k,M.exports.deflateRaw=a,M.exports.gzip=g,M.exports.Inflate=n,M.exports.inflate=J,M.exports.inflateRaw=u,M.exports.ungzip=T,M.exports.constants=V},11417:(M,E,b)=>{"use strict";const x=b(11421),k=b(11461),a=b(11466),g=b(11449),n=b(11473),J=Object.prototype.toString,{Z_NO_FLUSH:u,Z_SYNC_FLUSH:T,Z_FULL_FLUSH:V,Z_FINISH:I,Z_OK:t,Z_STREAM_END:y,Z_DEFAULT_COMPRESSION:B,Z_DEFAULT_STRATEGY:r,Z_DEFLATED:c}=b(11456);function C(M){this.options=k.assign({level:B,method:c,Ja:16384,windowBits:15,memLevel:8,strategy:r},M||{});let E=this.options;E.raw&&E.windowBits>0?E.windowBits=-E.windowBits:E.gzip&&E.windowBits>0&&E.windowBits<16&&(E.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new n,this.strm.avail_out=0;let b=x.deflateInit2(this.strm,E.level,E.method,E.windowBits,E.memLevel,E.strategy);if(b!==t)throw new Error(g[b]);if(E.header&&x.deflateSetHeader(this.strm,E.header),E.dictionary){let M;if(M="string"===typeof E.dictionary?a.string2buf(E.dictionary):"[object ArrayBuffer]"===J.call(E.dictionary)?new Uint8Array(E.dictionary):E.dictionary,b=x.deflateSetDictionary(this.strm,M),b!==t)throw new Error(g[b]);this._dict_set=!0}}function R(M,E){const b=new C(E);if(b.push(M,!0),b.err)throw b.msg||g[b.err];return b.result}C.prototype.push=function(M,E){const b=this.strm,k=this.options.Ja;let g,n;if(this.ended)return!1;for(n=E===~~E?E:!0===E?I:u,"string"===typeof M?b.input=a.string2buf(M):"[object ArrayBuffer]"===J.call(M)?b.input=new Uint8Array(M):b.input=M,b.next_in=0,b.avail_in=b.input.length;;)if(0===b.avail_out&&(b.output=new Uint8Array(k),b.next_out=0,b.avail_out=k),(n===T||n===V)&&b.avail_out<=6)this.onData(b.output.subarray(0,b.next_out)),b.avail_out=0;else{if(g=x.deflate(b,n),g===y)return b.next_out>0&&this.onData(b.output.subarray(0,b.next_out)),g=x.deflateEnd(this.strm),this.onEnd(g),this.ended=!0,g===t;if(0!==b.avail_out){if(n>0&&b.next_out>0)this.onData(b.output.subarray(0,b.next_out)),b.avail_out=0;else if(0===b.avail_in)break}else this.onData(b.output)}return!0},C.prototype.onData=function(M){this.chunks.push(M)},C.prototype.onEnd=function(M){M===t&&(this.result=k.flattenChunks(this.chunks)),this.chunks=[],this.err=M,this.msg=this.strm.msg},M.exports.Deflate=C,M.exports.deflate=R,M.exports.deflateRaw=function(M,E){return(E=E||{}).raw=!0,R(M,E)},M.exports.gzip=function(M,E){return(E=E||{}).gzip=!0,R(M,E)},M.exports.constants=b(11456)},11478:(M,E,b)=>{"use strict";const x=b(11486),k=b(11461),a=b(11466),g=b(11449),n=b(11473),J=b(11498),u=Object.prototype.toString,{Z_NO_FLUSH:T,Z_FINISH:V,Z_OK:I,Z_STREAM_END:t,Z_NEED_DICT:y,Z_STREAM_ERROR:B,Z_DATA_ERROR:r,Z_MEM_ERROR:c}=b(11456);function C(M){this.options=k.assign({Ja:65536,windowBits:15,to:""},M||{});const E=this.options;E.raw&&E.windowBits>=0&&E.windowBits<16&&(E.windowBits=-E.windowBits,0===E.windowBits&&(E.windowBits=-15)),!(E.windowBits>=0&&E.windowBits<16)||M&&M.windowBits||(E.windowBits+=32),E.windowBits>15&&E.windowBits<48&&0===(15&E.windowBits)&&(E.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new n,this.strm.avail_out=0;let b=x.inflateInit2(this.strm,E.windowBits);if(b!==I)throw new Error(g[b]);if(this.header=new J,x.inflateGetHeader(this.strm,this.header),E.dictionary&&("string"===typeof E.dictionary?E.dictionary=a.string2buf(E.dictionary):"[object ArrayBuffer]"===u.call(E.dictionary)&&(E.dictionary=new Uint8Array(E.dictionary)),E.raw&&(b=x.inflateSetDictionary(this.strm,E.dictionary),b!==I)))throw new Error(g[b])}function R(M,E){const b=new C(E);if(b.push(M),b.err)throw b.msg||g[b.err];return b.result}C.prototype.push=function(M,E){const b=this.strm,k=this.options.Ja,g=this.options.dictionary;let n,J,C;if(this.ended)return!1;for(J=E===~~E?E:!0===E?V:T,"[object ArrayBuffer]"===u.call(M)?b.input=new Uint8Array(M):b.input=M,b.next_in=0,b.avail_in=b.input.length;;){for(0===b.avail_out&&(b.output=new Uint8Array(k),b.next_out=0,b.avail_out=k),n=x.inflate(b,J),n===y&&g&&(n=x.inflateSetDictionary(b,g),n===I?n=x.inflate(b,J):n===r&&(n=y));b.avail_in>0&&n===t&&b.state.wrap>0&&0!==M[b.next_in];)x.inflateReset(b),n=x.inflate(b,J);switch(n){case B:case r:case y:case c:return this.onEnd(n),this.ended=!0,!1}if(C=b.avail_out,b.next_out&&(0===b.avail_out||n===t))if("string"===this.options.to){let M=a.utf8border(b.output,b.next_out),E=b.next_out-M,x=a.buf2string(b.output,M);b.next_out=E,b.avail_out=k-E,E&&b.output.set(b.output.subarray(M,M+E),0),this.onData(x)}else this.onData(b.output.length===b.next_out?b.output:b.output.subarray(0,b.next_out));if(n!==I||0!==C){if(n===t)return n=x.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,!0;if(0===b.avail_in)break}}return!0},C.prototype.onData=function(M){this.chunks.push(M)},C.prototype.onEnd=function(M){M===I&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=k.flattenChunks(this.chunks)),this.chunks=[],this.err=M,this.msg=this.strm.msg},M.exports.Inflate=C,M.exports.inflate=R,M.exports.inflateRaw=function(M,E){return(E=E||{}).raw=!0,R(M,E)},M.exports.ungzip=R,M.exports.constants=b(11456)},11461:M=>{"use strict";const E=(M,E)=>Object.prototype.hasOwnProperty.call(M,E);M.exports.assign=function(M){const b=Array.prototype.slice.call(arguments,1);for(;b.length;){const x=b.shift();if(x){if("object"!==typeof x)throw new TypeError(x+"must be non-object");for(const b in x)E(x,b)&&(M[b]=x[b])}}return M},M.exports.flattenChunks=M=>{let E=0;for(let x=0,k=M.length;x<k;x++)E+=M[x].length;const b=new Uint8Array(E);for(let x=0,k=0,a=M.length;x<a;x++){let E=M[x];b.set(E,k),k+=E.length}return b}},11466:M=>{"use strict";let E=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(x){E=!1}const b=new Uint8Array(256);for(let k=0;k<256;k++)b[k]=k>=252?6:k>=248?5:k>=240?4:k>=224?3:k>=192?2:1;b[254]=b[254]=1,M.exports.string2buf=M=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(M);let E,b,x,k,a,g=M.length,n=0;for(k=0;k<g;k++)b=M.charCodeAt(k),55296===(64512&b)&&k+1<g&&(x=M.charCodeAt(k+1),56320===(64512&x)&&(b=65536+(b-55296<<10)+(x-56320),k++)),n+=b<128?1:b<2048?2:b<65536?3:4;for(E=new Uint8Array(n),a=0,k=0;a<n;k++)b=M.charCodeAt(k),55296===(64512&b)&&k+1<g&&(x=M.charCodeAt(k+1),56320===(64512&x)&&(b=65536+(b-55296<<10)+(x-56320),k++)),b<128?E[a++]=b:b<2048?(E[a++]=192|b>>>6,E[a++]=128|63&b):b<65536?(E[a++]=224|b>>>12,E[a++]=128|b>>>6&63,E[a++]=128|63&b):(E[a++]=240|b>>>18,E[a++]=128|b>>>12&63,E[a++]=128|b>>>6&63,E[a++]=128|63&b);return E};M.exports.buf2string=(M,x)=>{const k=x||M.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(M.subarray(0,x));let a,g;const n=new Array(2*k);for(g=0,a=0;a<k;){let E=M[a++];if(E<128){n[g++]=E;continue}let x=b[E];if(x>4)n[g++]=65533,a+=x-1;else{for(E&=2===x?31:3===x?15:7;x>1&&a<k;)E=E<<6|63&M[a++],x--;x>1?n[g++]=65533:E<65536?n[g++]=E:(E-=65536,n[g++]=55296|E>>10&1023,n[g++]=56320|1023&E)}}return((M,b)=>{if(b<65534&&M.subarray&&E)return String.fromCharCode.apply(null,M.length===b?M:M.subarray(0,b));let x="";for(let E=0;E<b;E++)x+=String.fromCharCode(M[E]);return x})(n,g)},M.exports.utf8border=(M,E)=>{(E=E||M.length)>M.length&&(E=M.length);let x=E-1;for(;x>=0&&128===(192&M[x]);)x--;return x<0||0===x?E:x+b[M[x]]>E?x:E}},11437:M=>{"use strict";M.exports=(M,E,b,x)=>{let k=65535&M,a=M>>>16&65535,g=0;for(;0!==b;){g=b>2e3?2e3:b,b-=g;do{k=k+E[x++]|0,a=a+k|0}while(--g);k%=65521,a%=65521}return k|a<<16}},11456:M=>{"use strict";M.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},11445:M=>{"use strict";const E=new Uint32Array((()=>{let M,E=[];for(var b=0;b<256;b++){M=b;for(var x=0;x<8;x++)M=1&M?3988292384^M>>>1:M>>>1;E[b]=M}return E})());M.exports=(M,b,x,k)=>{const a=E,g=k+x;M^=-1;for(let E=k;E<g;E++)M=M>>>8^a[255&(M^b[E])];return~M}},11421:(M,E,b)=>{"use strict";const{_tr_init:x,_tr_stored_block:k,_tr_flush_block:a,_tr_tally:g,_tr_align:n}=b(11429),J=b(11437),u=b(11445),T=b(11449),{Z_NO_FLUSH:V,Z_PARTIAL_FLUSH:I,Z_FULL_FLUSH:t,Z_FINISH:y,Z_BLOCK:B,Z_OK:r,Z_STREAM_END:c,Z_STREAM_ERROR:C,Z_DATA_ERROR:R,Z_BUF_ERROR:w,Z_DEFAULT_COMPRESSION:S,Z_FILTERED:X,Z_HUFFMAN_ONLY:U,Z_RLE:v,Z_FIXED:N,Z_DEFAULT_STRATEGY:K,Z_UNKNOWN:h,Z_DEFLATED:Z}=b(11456),O=258,p=262,P=103,F=113,l=666,d=(M,E)=>(M.msg=T[E],E),W=M=>(M<<1)-(M>4?9:0),m=M=>{let E=M.length;for(;--E>=0;)M[E]=0};let o=(M,E,b)=>(E<<M.hash_shift^b)&M.hash_mask;const j=M=>{const E=M.state;let b=E.pending;b>M.avail_out&&(b=M.avail_out),0!==b&&(M.output.set(E.pending_buf.subarray(E.pending_out,E.pending_out+b),M.next_out),M.next_out+=b,E.pending_out+=b,M.total_out+=b,M.avail_out-=b,E.pending-=b,0===E.pending&&(E.pending_out=0))},s=(M,E)=>{a(M,M.block_start>=0?M.block_start:-1,M.strstart-M.block_start,E),M.block_start=M.strstart,j(M.strm)},q=(M,E)=>{M.pending_buf[M.pending++]=E},D=(M,E)=>{M.pending_buf[M.pending++]=E>>>8&255,M.pending_buf[M.pending++]=255&E},z=(M,E,b,x)=>{let k=M.avail_in;return k>x&&(k=x),0===k?0:(M.avail_in-=k,E.set(M.input.subarray(M.next_in,M.next_in+k),b),1===M.state.wrap?M.adler=J(M.adler,E,k,b):2===M.state.wrap&&(M.adler=u(M.adler,E,k,b)),M.next_in+=k,M.total_in+=k,k)},A=(M,E)=>{let b,x,k=M.max_chain_length,a=M.strstart,g=M.prev_length,n=M.nice_match;const J=M.strstart>M.w_size-p?M.strstart-(M.w_size-p):0,u=M.window,T=M.w_mask,V=M.prev,I=M.strstart+O;let t=u[a+g-1],y=u[a+g];M.prev_length>=M.good_match&&(k>>=2),n>M.lookahead&&(n=M.lookahead);do{if(b=E,u[b+g]===y&&u[b+g-1]===t&&u[b]===u[a]&&u[++b]===u[a+1]){a+=2,b++;do{}while(u[++a]===u[++b]&&u[++a]===u[++b]&&u[++a]===u[++b]&&u[++a]===u[++b]&&u[++a]===u[++b]&&u[++a]===u[++b]&&u[++a]===u[++b]&&u[++a]===u[++b]&&a<I);if(x=O-(I-a),a=I-O,x>g){if(M.match_start=E,g=x,x>=n)break;t=u[a+g-1],y=u[a+g]}}}while((E=V[E&T])>J&&0!==--k);return g<=M.lookahead?g:M.lookahead},Y=M=>{const E=M.w_size;let b,x,k,a,g;do{if(a=M.window_size-M.lookahead-M.strstart,M.strstart>=E+(E-p)){M.window.set(M.window.subarray(E,E+E),0),M.match_start-=E,M.strstart-=E,M.block_start-=E,x=M.hash_size,b=x;do{k=M.head[--b],M.head[b]=k>=E?k-E:0}while(--x);x=E,b=x;do{k=M.prev[--b],M.prev[b]=k>=E?k-E:0}while(--x);a+=E}if(0===M.strm.avail_in)break;if(x=z(M.strm,M.window,M.strstart+M.lookahead,a),M.lookahead+=x,M.lookahead+M.insert>=3)for(g=M.strstart-M.insert,M.ins_h=M.window[g],M.ins_h=o(M,M.ins_h,M.window[g+1]);M.insert&&(M.ins_h=o(M,M.ins_h,M.window[g+3-1]),M.prev[g&M.w_mask]=M.head[M.ins_h],M.head[M.ins_h]=g,g++,M.insert--,!(M.lookahead+M.insert<3)););}while(M.lookahead<p&&0!==M.strm.avail_in)},i=(M,E)=>{let b,x;for(;;){if(M.lookahead<p){if(Y(M),M.lookahead<p&&E===V)return 1;if(0===M.lookahead)break}if(b=0,M.lookahead>=3&&(M.ins_h=o(M,M.ins_h,M.window[M.strstart+3-1]),b=M.prev[M.strstart&M.w_mask]=M.head[M.ins_h],M.head[M.ins_h]=M.strstart),0!==b&&M.strstart-b<=M.w_size-p&&(M.match_length=A(M,b)),M.match_length>=3)if(x=g(M,M.strstart-M.match_start,M.match_length-3),M.lookahead-=M.match_length,M.match_length<=M.max_lazy_match&&M.lookahead>=3){M.match_length--;do{M.strstart++,M.ins_h=o(M,M.ins_h,M.window[M.strstart+3-1]),b=M.prev[M.strstart&M.w_mask]=M.head[M.ins_h],M.head[M.ins_h]=M.strstart}while(0!==--M.match_length);M.strstart++}else M.strstart+=M.match_length,M.match_length=0,M.ins_h=M.window[M.strstart],M.ins_h=o(M,M.ins_h,M.window[M.strstart+1]);else x=g(M,0,M.window[M.strstart]),M.lookahead--,M.strstart++;if(x&&(s(M,!1),0===M.strm.avail_out))return 1}return M.insert=M.strstart<2?M.strstart:2,E===y?(s(M,!0),0===M.strm.avail_out?3:4):M.last_lit&&(s(M,!1),0===M.strm.avail_out)?1:2},G=(M,E)=>{let b,x,k;for(;;){if(M.lookahead<p){if(Y(M),M.lookahead<p&&E===V)return 1;if(0===M.lookahead)break}if(b=0,M.lookahead>=3&&(M.ins_h=o(M,M.ins_h,M.window[M.strstart+3-1]),b=M.prev[M.strstart&M.w_mask]=M.head[M.ins_h],M.head[M.ins_h]=M.strstart),M.prev_length=M.match_length,M.prev_match=M.match_start,M.match_length=2,0!==b&&M.prev_length<M.max_lazy_match&&M.strstart-b<=M.w_size-p&&(M.match_length=A(M,b),M.match_length<=5&&(M.strategy===X||3===M.match_length&&M.strstart-M.match_start>4096)&&(M.match_length=2)),M.prev_length>=3&&M.match_length<=M.prev_length){k=M.strstart+M.lookahead-3,x=g(M,M.strstart-1-M.prev_match,M.prev_length-3),M.lookahead-=M.prev_length-1,M.prev_length-=2;do{++M.strstart<=k&&(M.ins_h=o(M,M.ins_h,M.window[M.strstart+3-1]),b=M.prev[M.strstart&M.w_mask]=M.head[M.ins_h],M.head[M.ins_h]=M.strstart)}while(0!==--M.prev_length);if(M.match_available=0,M.match_length=2,M.strstart++,x&&(s(M,!1),0===M.strm.avail_out))return 1}else if(M.match_available){if(x=g(M,0,M.window[M.strstart-1]),x&&s(M,!1),M.strstart++,M.lookahead--,0===M.strm.avail_out)return 1}else M.match_available=1,M.strstart++,M.lookahead--}return M.match_available&&(x=g(M,0,M.window[M.strstart-1]),M.match_available=0),M.insert=M.strstart<2?M.strstart:2,E===y?(s(M,!0),0===M.strm.avail_out?3:4):M.last_lit&&(s(M,!1),0===M.strm.avail_out)?1:2};function H(M,E,b,x,k){this.good_length=M,this.max_lazy=E,this.nice_length=b,this.max_chain=x,this.func=k}const e=[new H(0,0,0,0,((M,E)=>{let b=65535;for(b>M.pending_buf_size-5&&(b=M.pending_buf_size-5);;){if(M.lookahead<=1){if(Y(M),0===M.lookahead&&E===V)return 1;if(0===M.lookahead)break}M.strstart+=M.lookahead,M.lookahead=0;const x=M.block_start+b;if((0===M.strstart||M.strstart>=x)&&(M.lookahead=M.strstart-x,M.strstart=x,s(M,!1),0===M.strm.avail_out))return 1;if(M.strstart-M.block_start>=M.w_size-p&&(s(M,!1),0===M.strm.avail_out))return 1}return M.insert=0,E===y?(s(M,!0),0===M.strm.avail_out?3:4):(M.strstart>M.block_start&&(s(M,!1),M.strm.avail_out),1)})),new H(4,4,8,4,i),new H(4,5,16,8,i),new H(4,6,32,32,i),new H(4,4,16,16,G),new H(8,16,32,32,G),new H(8,16,128,128,G),new H(8,32,128,256,G),new H(32,128,258,1024,G),new H(32,258,258,4096,G)];function Q(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Z,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),m(this.dyn_ltree),m(this.dyn_dtree),m(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),m(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),m(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const L=M=>{if(!M||!M.state)return d(M,C);M.total_in=M.total_out=0,M.data_type=h;const E=M.state;return E.pending=0,E.pending_out=0,E.wrap<0&&(E.wrap=-E.wrap),E.status=E.wrap?42:F,M.adler=2===E.wrap?0:1,E.last_flush=V,x(E),r},f=M=>{const E=L(M);var b;return E===r&&((b=M.state).window_size=2*b.w_size,m(b.head),b.max_lazy_match=e[b.level].max_lazy,b.good_match=e[b.level].good_length,b.nice_match=e[b.level].nice_length,b.max_chain_length=e[b.level].max_chain,b.strstart=0,b.block_start=0,b.lookahead=0,b.insert=0,b.match_length=b.prev_length=2,b.match_available=0,b.ins_h=0),E},MM=(M,E,b,x,k,a)=>{if(!M)return C;let g=1;if(E===S&&(E=6),x<0?(g=0,x=-x):x>15&&(g=2,x-=16),k<1||k>9||b!==Z||x<8||x>15||E<0||E>9||a<0||a>N)return d(M,C);8===x&&(x=9);const n=new Q;return M.state=n,n.strm=M,n.wrap=g,n.gzhead=null,n.w_bits=x,n.w_size=1<<n.w_bits,n.w_mask=n.w_size-1,n.hash_bits=k+7,n.hash_size=1<<n.hash_bits,n.hash_mask=n.hash_size-1,n.hash_shift=~~((n.hash_bits+3-1)/3),n.window=new Uint8Array(2*n.w_size),n.head=new Uint16Array(n.hash_size),n.prev=new Uint16Array(n.w_size),n.lit_bufsize=1<<k+6,n.pending_buf_size=4*n.lit_bufsize,n.pending_buf=new Uint8Array(n.pending_buf_size),n.d_buf=1*n.lit_bufsize,n.l_buf=3*n.lit_bufsize,n.level=E,n.strategy=a,n.method=b,f(M)};M.exports.deflateInit=(M,E)=>MM(M,E,Z,15,8,K),M.exports.deflateInit2=MM,M.exports.deflateReset=f,M.exports.deflateResetKeep=L,M.exports.deflateSetHeader=(M,E)=>M&&M.state?2!==M.state.wrap?C:(M.state.gzhead=E,r):C,M.exports.deflate=(M,E)=>{let b,x;if(!M||!M.state||E>B||E<0)return M?d(M,C):C;const a=M.state;if(!M.output||!M.input&&0!==M.avail_in||a.status===l&&E!==y)return d(M,0===M.avail_out?w:C);a.strm=M;const J=a.last_flush;if(a.last_flush=E,42===a.status)if(2===a.wrap)M.adler=0,q(a,31),q(a,139),q(a,8),a.gzhead?(q(a,(a.gzhead.text?1:0)+(a.gzhead.hcrc?2:0)+(a.gzhead.extra?4:0)+(a.gzhead.name?8:0)+(a.gzhead.comment?16:0)),q(a,255&a.gzhead.time),q(a,a.gzhead.time>>8&255),q(a,a.gzhead.time>>16&255),q(a,a.gzhead.time>>24&255),q(a,9===a.level?2:a.strategy>=U||a.level<2?4:0),q(a,255&a.gzhead.os),a.gzhead.extra&&a.gzhead.extra.length&&(q(a,255&a.gzhead.extra.length),q(a,a.gzhead.extra.length>>8&255)),a.gzhead.hcrc&&(M.adler=u(M.adler,a.pending_buf,a.pending,0)),a.gzindex=0,a.status=69):(q(a,0),q(a,0),q(a,0),q(a,0),q(a,0),q(a,9===a.level?2:a.strategy>=U||a.level<2?4:0),q(a,3),a.status=F);else{let E=Z+(a.w_bits-8<<4)<<8,b=-1;b=a.strategy>=U||a.level<2?0:a.level<6?1:6===a.level?2:3,E|=b<<6,0!==a.strstart&&(E|=32),E+=31-E%31,a.status=F,D(a,E),0!==a.strstart&&(D(a,M.adler>>>16),D(a,65535&M.adler)),M.adler=1}if(69===a.status)if(a.gzhead.extra){for(b=a.pending;a.gzindex<(65535&a.gzhead.extra.length)&&(a.pending!==a.pending_buf_size||(a.gzhead.hcrc&&a.pending>b&&(M.adler=u(M.adler,a.pending_buf,a.pending-b,b)),j(M),b=a.pending,a.pending!==a.pending_buf_size));)q(a,255&a.gzhead.extra[a.gzindex]),a.gzindex++;a.gzhead.hcrc&&a.pending>b&&(M.adler=u(M.adler,a.pending_buf,a.pending-b,b)),a.gzindex===a.gzhead.extra.length&&(a.gzindex=0,a.status=73)}else a.status=73;if(73===a.status)if(a.gzhead.name){b=a.pending;do{if(a.pending===a.pending_buf_size&&(a.gzhead.hcrc&&a.pending>b&&(M.adler=u(M.adler,a.pending_buf,a.pending-b,b)),j(M),b=a.pending,a.pending===a.pending_buf_size)){x=1;break}x=a.gzindex<a.gzhead.name.length?255&a.gzhead.name.charCodeAt(a.gzindex++):0,q(a,x)}while(0!==x);a.gzhead.hcrc&&a.pending>b&&(M.adler=u(M.adler,a.pending_buf,a.pending-b,b)),0===x&&(a.gzindex=0,a.status=91)}else a.status=91;if(91===a.status)if(a.gzhead.comment){b=a.pending;do{if(a.pending===a.pending_buf_size&&(a.gzhead.hcrc&&a.pending>b&&(M.adler=u(M.adler,a.pending_buf,a.pending-b,b)),j(M),b=a.pending,a.pending===a.pending_buf_size)){x=1;break}x=a.gzindex<a.gzhead.comment.length?255&a.gzhead.comment.charCodeAt(a.gzindex++):0,q(a,x)}while(0!==x);a.gzhead.hcrc&&a.pending>b&&(M.adler=u(M.adler,a.pending_buf,a.pending-b,b)),0===x&&(a.status=P)}else a.status=P;if(a.status===P&&(a.gzhead.hcrc?(a.pending+2>a.pending_buf_size&&j(M),a.pending+2<=a.pending_buf_size&&(q(a,255&M.adler),q(a,M.adler>>8&255),M.adler=0,a.status=F)):a.status=F),0!==a.pending){if(j(M),0===M.avail_out)return a.last_flush=-1,r}else if(0===M.avail_in&&W(E)<=W(J)&&E!==y)return d(M,w);if(a.status===l&&0!==M.avail_in)return d(M,w);if(0!==M.avail_in||0!==a.lookahead||E!==V&&a.status!==l){let b=a.strategy===U?((M,E)=>{let b;for(;;){if(0===M.lookahead&&(Y(M),0===M.lookahead)){if(E===V)return 1;break}if(M.match_length=0,b=g(M,0,M.window[M.strstart]),M.lookahead--,M.strstart++,b&&(s(M,!1),0===M.strm.avail_out))return 1}return M.insert=0,E===y?(s(M,!0),0===M.strm.avail_out?3:4):M.last_lit&&(s(M,!1),0===M.strm.avail_out)?1:2})(a,E):a.strategy===v?((M,E)=>{let b,x,k,a;const n=M.window;for(;;){if(M.lookahead<=O){if(Y(M),M.lookahead<=O&&E===V)return 1;if(0===M.lookahead)break}if(M.match_length=0,M.lookahead>=3&&M.strstart>0&&(k=M.strstart-1,x=n[k],x===n[++k]&&x===n[++k]&&x===n[++k])){a=M.strstart+O;do{}while(x===n[++k]&&x===n[++k]&&x===n[++k]&&x===n[++k]&&x===n[++k]&&x===n[++k]&&x===n[++k]&&x===n[++k]&&k<a);M.match_length=O-(a-k),M.match_length>M.lookahead&&(M.match_length=M.lookahead)}if(M.match_length>=3?(b=g(M,1,M.match_length-3),M.lookahead-=M.match_length,M.strstart+=M.match_length,M.match_length=0):(b=g(M,0,M.window[M.strstart]),M.lookahead--,M.strstart++),b&&(s(M,!1),0===M.strm.avail_out))return 1}return M.insert=0,E===y?(s(M,!0),0===M.strm.avail_out?3:4):M.last_lit&&(s(M,!1),0===M.strm.avail_out)?1:2})(a,E):e[a.level].func(a,E);if(3!==b&&4!==b||(a.status=l),1===b||3===b)return 0===M.avail_out&&(a.last_flush=-1),r;if(2===b&&(E===I?n(a):E!==B&&(k(a,0,0,!1),E===t&&(m(a.head),0===a.lookahead&&(a.strstart=0,a.block_start=0,a.insert=0))),j(M),0===M.avail_out))return a.last_flush=-1,r}return E!==y?r:a.wrap<=0?c:(2===a.wrap?(q(a,255&M.adler),q(a,M.adler>>8&255),q(a,M.adler>>16&255),q(a,M.adler>>24&255),q(a,255&M.total_in),q(a,M.total_in>>8&255),q(a,M.total_in>>16&255),q(a,M.total_in>>24&255)):(D(a,M.adler>>>16),D(a,65535&M.adler)),j(M),a.wrap>0&&(a.wrap=-a.wrap),0!==a.pending?r:c)},M.exports.deflateEnd=M=>{if(!M||!M.state)return C;const E=M.state.status;return 42!==E&&69!==E&&73!==E&&91!==E&&E!==P&&E!==F&&E!==l?d(M,C):(M.state=null,E===F?d(M,R):r)},M.exports.deflateSetDictionary=(M,E)=>{let b=E.length;if(!M||!M.state)return C;const x=M.state,k=x.wrap;if(2===k||1===k&&42!==x.status||x.lookahead)return C;if(1===k&&(M.adler=J(M.adler,E,b,0)),x.wrap=0,b>=x.w_size){0===k&&(m(x.head),x.strstart=0,x.block_start=0,x.insert=0);let M=new Uint8Array(x.w_size);M.set(E.subarray(b-x.w_size,b),0),E=M,b=x.w_size}const a=M.avail_in,g=M.next_in,n=M.input;for(M.avail_in=b,M.next_in=0,M.input=E,Y(x);x.lookahead>=3;){let M=x.strstart,E=x.lookahead-2;do{x.ins_h=o(x,x.ins_h,x.window[M+3-1]),x.prev[M&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=M,M++}while(--E);x.strstart=M,x.lookahead=2,Y(x)}return x.strstart+=x.lookahead,x.block_start=x.strstart,x.insert=x.lookahead,x.lookahead=0,x.match_length=x.prev_length=2,x.match_available=0,M.next_in=g,M.input=n,M.avail_in=a,x.wrap=k,r},M.exports.deflateInfo="pako deflate (from Nodeca project)"},11498:M=>{"use strict";M.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},11493:M=>{"use strict";M.exports=function(M,E){let b,x,k,a,g,n,J,u,T,V,I,t,y,B,r,c,C,R,w,S,X,U,v,N;const K=M.state;b=M.next_in,v=M.input,x=b+(M.avail_in-5),k=M.next_out,N=M.output,a=k-(E-M.avail_out),g=k+(M.avail_out-257),n=K.dmax,J=K.wsize,u=K.whave,T=K.wnext,V=K.window,I=K.hold,t=K.bits,y=K.lencode,B=K.distcode,r=(1<<K.lenbits)-1,c=(1<<K.distbits)-1;M:do{t<15&&(I+=v[b++]<<t,t+=8,I+=v[b++]<<t,t+=8),C=y[I&r];E:for(;;){if(R=C>>>24,I>>>=R,t-=R,R=C>>>16&255,0===R)N[k++]=65535&C;else{if(!(16&R)){if(0===(64&R)){C=y[(65535&C)+(I&(1<<R)-1)];continue E}if(32&R){K.mode=12;break M}M.msg="invalid literal/length code",K.mode=30;break M}w=65535&C,R&=15,R&&(t<R&&(I+=v[b++]<<t,t+=8),w+=I&(1<<R)-1,I>>>=R,t-=R),t<15&&(I+=v[b++]<<t,t+=8,I+=v[b++]<<t,t+=8),C=B[I&c];b:for(;;){if(R=C>>>24,I>>>=R,t-=R,R=C>>>16&255,!(16&R)){if(0===(64&R)){C=B[(65535&C)+(I&(1<<R)-1)];continue b}M.msg="invalid distance code",K.mode=30;break M}if(S=65535&C,R&=15,t<R&&(I+=v[b++]<<t,t+=8,t<R&&(I+=v[b++]<<t,t+=8)),S+=I&(1<<R)-1,S>n){M.msg="invalid distance too far back",K.mode=30;break M}if(I>>>=R,t-=R,R=k-a,S>R){if(R=S-R,R>u&&K.sane){M.msg="invalid distance too far back",K.mode=30;break M}if(X=0,U=V,0===T){if(X+=J-R,R<w){w-=R;do{N[k++]=V[X++]}while(--R);X=k-S,U=N}}else if(T<R){if(X+=J+T-R,R-=T,R<w){w-=R;do{N[k++]=V[X++]}while(--R);if(X=0,T<w){R=T,w-=R;do{N[k++]=V[X++]}while(--R);X=k-S,U=N}}}else if(X+=T-R,R<w){w-=R;do{N[k++]=V[X++]}while(--R);X=k-S,U=N}for(;w>2;)N[k++]=U[X++],N[k++]=U[X++],N[k++]=U[X++],w-=3;w&&(N[k++]=U[X++],w>1&&(N[k++]=U[X++]))}else{X=k-S;do{N[k++]=N[X++],N[k++]=N[X++],N[k++]=N[X++],w-=3}while(w>2);w&&(N[k++]=N[X++],w>1&&(N[k++]=N[X++]))}break}}break}}while(b<x&&k<g);w=t>>3,b-=w,t-=w<<3,I&=(1<<t)-1,M.next_in=b,M.next_out=k,M.avail_in=b<x?x-b+5:5-(b-x),M.avail_out=k<g?g-k+257:257-(k-g),K.hold=I,K.bits=t}},11486:(M,E,b)=>{"use strict";const x=b(11437),k=b(11445),a=b(11493),g=b(11496),{Z_FINISH:n,Z_BLOCK:J,Z_TREES:u,Z_OK:T,Z_STREAM_END:V,Z_NEED_DICT:I,Z_STREAM_ERROR:t,Z_DATA_ERROR:y,Z_MEM_ERROR:B,Z_BUF_ERROR:r,Z_DEFLATED:c}=b(11456),C=12,R=30,w=M=>(M>>>24&255)+(M>>>8&65280)+((65280&M)<<8)+((255&M)<<24);function S(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const X=M=>{if(!M||!M.state)return t;const E=M.state;return M.total_in=M.total_out=E.total=0,M.msg="",E.wrap&&(M.adler=1&E.wrap),E.mode=1,E.last=0,E.havedict=0,E.dmax=32768,E.head=null,E.hold=0,E.bits=0,E.lencode=E.lendyn=new Int32Array(852),E.distcode=E.distdyn=new Int32Array(592),E.sane=1,E.back=-1,T},U=M=>{if(!M||!M.state)return t;const E=M.state;return E.wsize=0,E.whave=0,E.wnext=0,X(M)},v=(M,E)=>{let b;if(!M||!M.state)return t;const x=M.state;return E<0?(b=0,E=-E):(b=1+(E>>4),E<48&&(E&=15)),E&&(E<8||E>15)?t:(null!==x.window&&x.wbits!==E&&(x.window=null),x.wrap=b,x.wbits=E,U(M))},N=(M,E)=>{if(!M)return t;const b=new S;M.state=b,b.window=null;const x=v(M,E);return x!==T&&(M.state=null),x};let K,h,Z=!0;const O=M=>{if(Z){K=new Int32Array(512),h=new Int32Array(32);let E=0;for(;E<144;)M.lens[E++]=8;for(;E<256;)M.lens[E++]=9;for(;E<280;)M.lens[E++]=7;for(;E<288;)M.lens[E++]=8;for(g(1,M.lens,0,288,K,0,M.work,{bits:9}),E=0;E<32;)M.lens[E++]=5;g(2,M.lens,0,32,h,0,M.work,{bits:5}),Z=!1}M.lencode=K,M.lenbits=9,M.distcode=h,M.distbits=5},p=(M,E,b,x)=>{let k;const a=M.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),x>=a.wsize?(a.window.set(E.subarray(b-a.wsize,b),0),a.wnext=0,a.whave=a.wsize):(k=a.wsize-a.wnext,k>x&&(k=x),a.window.set(E.subarray(b-x,b-x+k),a.wnext),(x-=k)?(a.window.set(E.subarray(b-x,b),0),a.wnext=x,a.whave=a.wsize):(a.wnext+=k,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=k))),0};M.exports.inflateReset=U,M.exports.inflateReset2=v,M.exports.inflateResetKeep=X,M.exports.inflateInit=M=>N(M,15),M.exports.inflateInit2=N,M.exports.inflate=(M,E)=>{let b,S,X,U,v,N,K,h,Z,P,F,l,d,W,m,o,j,s,q,D,z,A,Y=0;const i=new Uint8Array(4);let G,H;const e=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!M||!M.state||!M.output||!M.input&&0!==M.avail_in)return t;b=M.state,b.mode===C&&(b.mode=13),v=M.next_out,X=M.output,K=M.avail_out,U=M.next_in,S=M.input,N=M.avail_in,h=b.hold,Z=b.bits,P=N,F=K,A=T;M:for(;;)switch(b.mode){case 1:if(0===b.wrap){b.mode=13;break}for(;Z<16;){if(0===N)break M;N--,h+=S[U++]<<Z,Z+=8}if(2&b.wrap&&35615===h){b.check=0,i[0]=255&h,i[1]=h>>>8&255,b.check=k(b.check,i,2,0),h=0,Z=0,b.mode=2;break}if(b.flags=0,b.head&&(b.head.done=!1),!(1&b.wrap)||(((255&h)<<8)+(h>>8))%31){M.msg="incorrect header check",b.mode=R;break}if((15&h)!==c){M.msg="unknown compression method",b.mode=R;break}if(h>>>=4,Z-=4,z=8+(15&h),0===b.wbits)b.wbits=z;else if(z>b.wbits){M.msg="invalid window size",b.mode=R;break}b.dmax=1<<b.wbits,M.adler=b.check=1,b.mode=512&h?10:C,h=0,Z=0;break;case 2:for(;Z<16;){if(0===N)break M;N--,h+=S[U++]<<Z,Z+=8}if(b.flags=h,(255&b.flags)!==c){M.msg="unknown compression method",b.mode=R;break}if(57344&b.flags){M.msg="unknown header flags set",b.mode=R;break}b.head&&(b.head.text=h>>8&1),512&b.flags&&(i[0]=255&h,i[1]=h>>>8&255,b.check=k(b.check,i,2,0)),h=0,Z=0,b.mode=3;case 3:for(;Z<32;){if(0===N)break M;N--,h+=S[U++]<<Z,Z+=8}b.head&&(b.head.time=h),512&b.flags&&(i[0]=255&h,i[1]=h>>>8&255,i[2]=h>>>16&255,i[3]=h>>>24&255,b.check=k(b.check,i,4,0)),h=0,Z=0,b.mode=4;case 4:for(;Z<16;){if(0===N)break M;N--,h+=S[U++]<<Z,Z+=8}b.head&&(b.head.xflags=255&h,b.head.os=h>>8),512&b.flags&&(i[0]=255&h,i[1]=h>>>8&255,b.check=k(b.check,i,2,0)),h=0,Z=0,b.mode=5;case 5:if(1024&b.flags){for(;Z<16;){if(0===N)break M;N--,h+=S[U++]<<Z,Z+=8}b.length=h,b.head&&(b.head.extra_len=h),512&b.flags&&(i[0]=255&h,i[1]=h>>>8&255,b.check=k(b.check,i,2,0)),h=0,Z=0}else b.head&&(b.head.extra=null);b.mode=6;case 6:if(1024&b.flags&&(l=b.length,l>N&&(l=N),l&&(b.head&&(z=b.head.extra_len-b.length,b.head.extra||(b.head.extra=new Uint8Array(b.head.extra_len)),b.head.extra.set(S.subarray(U,U+l),z)),512&b.flags&&(b.check=k(b.check,S,l,U)),N-=l,U+=l,b.length-=l),b.length))break M;b.length=0,b.mode=7;case 7:if(2048&b.flags){if(0===N)break M;l=0;do{z=S[U+l++],b.head&&z&&b.length<65536&&(b.head.name+=String.fromCharCode(z))}while(z&&l<N);if(512&b.flags&&(b.check=k(b.check,S,l,U)),N-=l,U+=l,z)break M}else b.head&&(b.head.name=null);b.length=0,b.mode=8;case 8:if(4096&b.flags){if(0===N)break M;l=0;do{z=S[U+l++],b.head&&z&&b.length<65536&&(b.head.comment+=String.fromCharCode(z))}while(z&&l<N);if(512&b.flags&&(b.check=k(b.check,S,l,U)),N-=l,U+=l,z)break M}else b.head&&(b.head.comment=null);b.mode=9;case 9:if(512&b.flags){for(;Z<16;){if(0===N)break M;N--,h+=S[U++]<<Z,Z+=8}if(h!==(65535&b.check)){M.msg="header crc mismatch",b.mode=R;break}h=0,Z=0}b.head&&(b.head.hcrc=b.flags>>9&1,b.head.done=!0),M.adler=b.check=0,b.mode=C;break;case 10:for(;Z<32;){if(0===N)break M;N--,h+=S[U++]<<Z,Z+=8}M.adler=b.check=w(h),h=0,Z=0,b.mode=11;case 11:if(0===b.havedict)return M.next_out=v,M.avail_out=K,M.next_in=U,M.avail_in=N,b.hold=h,b.bits=Z,I;M.adler=b.check=1,b.mode=C;case C:if(E===J||E===u)break M;case 13:if(b.last){h>>>=7&Z,Z-=7&Z,b.mode=27;break}for(;Z<3;){if(0===N)break M;N--,h+=S[U++]<<Z,Z+=8}switch(b.last=1&h,h>>>=1,Z-=1,3&h){case 0:b.mode=14;break;case 1:if(O(b),b.mode=20,E===u){h>>>=2,Z-=2;break M}break;case 2:b.mode=17;break;case 3:M.msg="invalid block type",b.mode=R}h>>>=2,Z-=2;break;case 14:for(h>>>=7&Z,Z-=7&Z;Z<32;){if(0===N)break M;N--,h+=S[U++]<<Z,Z+=8}if((65535&h)!==(h>>>16^65535)){M.msg="invalid stored block lengths",b.mode=R;break}if(b.length=65535&h,h=0,Z=0,b.mode=15,E===u)break M;case 15:b.mode=16;case 16:if(l=b.length,l){if(l>N&&(l=N),l>K&&(l=K),0===l)break M;X.set(S.subarray(U,U+l),v),N-=l,U+=l,K-=l,v+=l,b.length-=l;break}b.mode=C;break;case 17:for(;Z<14;){if(0===N)break M;N--,h+=S[U++]<<Z,Z+=8}if(b.nlen=257+(31&h),h>>>=5,Z-=5,b.ndist=1+(31&h),h>>>=5,Z-=5,b.ncode=4+(15&h),h>>>=4,Z-=4,b.nlen>286||b.ndist>30){M.msg="too many length or distance symbols",b.mode=R;break}b.have=0,b.mode=18;case 18:for(;b.have<b.ncode;){for(;Z<3;){if(0===N)break M;N--,h+=S[U++]<<Z,Z+=8}b.lens[e[b.have++]]=7&h,h>>>=3,Z-=3}for(;b.have<19;)b.lens[e[b.have++]]=0;if(b.lencode=b.lendyn,b.lenbits=7,G={bits:b.lenbits},A=g(0,b.lens,0,19,b.lencode,0,b.work,G),b.lenbits=G.bits,A){M.msg="invalid code lengths set",b.mode=R;break}b.have=0,b.mode=19;case 19:for(;b.have<b.nlen+b.ndist;){for(;Y=b.lencode[h&(1<<b.lenbits)-1],m=Y>>>24,o=Y>>>16&255,j=65535&Y,!(m<=Z);){if(0===N)break M;N--,h+=S[U++]<<Z,Z+=8}if(j<16)h>>>=m,Z-=m,b.lens[b.have++]=j;else{if(16===j){for(H=m+2;Z<H;){if(0===N)break M;N--,h+=S[U++]<<Z,Z+=8}if(h>>>=m,Z-=m,0===b.have){M.msg="invalid bit length repeat",b.mode=R;break}z=b.lens[b.have-1],l=3+(3&h),h>>>=2,Z-=2}else if(17===j){for(H=m+3;Z<H;){if(0===N)break M;N--,h+=S[U++]<<Z,Z+=8}h>>>=m,Z-=m,z=0,l=3+(7&h),h>>>=3,Z-=3}else{for(H=m+7;Z<H;){if(0===N)break M;N--,h+=S[U++]<<Z,Z+=8}h>>>=m,Z-=m,z=0,l=11+(127&h),h>>>=7,Z-=7}if(b.have+l>b.nlen+b.ndist){M.msg="invalid bit length repeat",b.mode=R;break}for(;l--;)b.lens[b.have++]=z}}if(b.mode===R)break;if(0===b.lens[256]){M.msg="invalid code -- missing end-of-block",b.mode=R;break}if(b.lenbits=9,G={bits:b.lenbits},A=g(1,b.lens,0,b.nlen,b.lencode,0,b.work,G),b.lenbits=G.bits,A){M.msg="invalid literal/lengths set",b.mode=R;break}if(b.distbits=6,b.distcode=b.distdyn,G={bits:b.distbits},A=g(2,b.lens,b.nlen,b.ndist,b.distcode,0,b.work,G),b.distbits=G.bits,A){M.msg="invalid distances set",b.mode=R;break}if(b.mode=20,E===u)break M;case 20:b.mode=21;case 21:if(N>=6&&K>=258){M.next_out=v,M.avail_out=K,M.next_in=U,M.avail_in=N,b.hold=h,b.bits=Z,a(M,F),v=M.next_out,X=M.output,K=M.avail_out,U=M.next_in,S=M.input,N=M.avail_in,h=b.hold,Z=b.bits,b.mode===C&&(b.back=-1);break}for(b.back=0;Y=b.lencode[h&(1<<b.lenbits)-1],m=Y>>>24,o=Y>>>16&255,j=65535&Y,!(m<=Z);){if(0===N)break M;N--,h+=S[U++]<<Z,Z+=8}if(o&&0===(240&o)){for(s=m,q=o,D=j;Y=b.lencode[D+((h&(1<<s+q)-1)>>s)],m=Y>>>24,o=Y>>>16&255,j=65535&Y,!(s+m<=Z);){if(0===N)break M;N--,h+=S[U++]<<Z,Z+=8}h>>>=s,Z-=s,b.back+=s}if(h>>>=m,Z-=m,b.back+=m,b.length=j,0===o){b.mode=26;break}if(32&o){b.back=-1,b.mode=C;break}if(64&o){M.msg="invalid literal/length code",b.mode=R;break}b.extra=15&o,b.mode=22;case 22:if(b.extra){for(H=b.extra;Z<H;){if(0===N)break M;N--,h+=S[U++]<<Z,Z+=8}b.length+=h&(1<<b.extra)-1,h>>>=b.extra,Z-=b.extra,b.back+=b.extra}b.was=b.length,b.mode=23;case 23:for(;Y=b.distcode[h&(1<<b.distbits)-1],m=Y>>>24,o=Y>>>16&255,j=65535&Y,!(m<=Z);){if(0===N)break M;N--,h+=S[U++]<<Z,Z+=8}if(0===(240&o)){for(s=m,q=o,D=j;Y=b.distcode[D+((h&(1<<s+q)-1)>>s)],m=Y>>>24,o=Y>>>16&255,j=65535&Y,!(s+m<=Z);){if(0===N)break M;N--,h+=S[U++]<<Z,Z+=8}h>>>=s,Z-=s,b.back+=s}if(h>>>=m,Z-=m,b.back+=m,64&o){M.msg="invalid distance code",b.mode=R;break}b.offset=j,b.extra=15&o,b.mode=24;case 24:if(b.extra){for(H=b.extra;Z<H;){if(0===N)break M;N--,h+=S[U++]<<Z,Z+=8}b.offset+=h&(1<<b.extra)-1,h>>>=b.extra,Z-=b.extra,b.back+=b.extra}if(b.offset>b.dmax){M.msg="invalid distance too far back",b.mode=R;break}b.mode=25;case 25:if(0===K)break M;if(l=F-K,b.offset>l){if(l=b.offset-l,l>b.whave&&b.sane){M.msg="invalid distance too far back",b.mode=R;break}l>b.wnext?(l-=b.wnext,d=b.wsize-l):d=b.wnext-l,l>b.length&&(l=b.length),W=b.window}else W=X,d=v-b.offset,l=b.length;l>K&&(l=K),K-=l,b.length-=l;do{X[v++]=W[d++]}while(--l);0===b.length&&(b.mode=21);break;case 26:if(0===K)break M;X[v++]=b.length,K--,b.mode=21;break;case 27:if(b.wrap){for(;Z<32;){if(0===N)break M;N--,h|=S[U++]<<Z,Z+=8}if(F-=K,M.total_out+=F,b.total+=F,F&&(M.adler=b.check=b.flags?k(b.check,X,F,v-F):x(b.check,X,F,v-F)),F=K,(b.flags?h:w(h))!==b.check){M.msg="incorrect data check",b.mode=R;break}h=0,Z=0}b.mode=28;case 28:if(b.wrap&&b.flags){for(;Z<32;){if(0===N)break M;N--,h+=S[U++]<<Z,Z+=8}if(h!==(4294967295&b.total)){M.msg="incorrect length check",b.mode=R;break}h=0,Z=0}b.mode=29;case 29:A=V;break M;case R:A=y;break M;case 31:return B;default:return t}return M.next_out=v,M.avail_out=K,M.next_in=U,M.avail_in=N,b.hold=h,b.bits=Z,(b.wsize||F!==M.avail_out&&b.mode<R&&(b.mode<27||E!==n))&&p(M,M.output,M.next_out,F-M.avail_out)?(b.mode=31,B):(P-=M.avail_in,F-=M.avail_out,M.total_in+=P,M.total_out+=F,b.total+=F,b.wrap&&F&&(M.adler=b.check=b.flags?k(b.check,X,F,M.next_out-F):x(b.check,X,F,M.next_out-F)),M.data_type=b.bits+(b.last?64:0)+(b.mode===C?128:0)+(20===b.mode||15===b.mode?256:0),(0===P&&0===F||E===n)&&A===T&&(A=r),A)},M.exports.inflateEnd=M=>{if(!M||!M.state)return t;let E=M.state;return E.window&&(E.window=null),M.state=null,T},M.exports.inflateGetHeader=(M,E)=>{if(!M||!M.state)return t;const b=M.state;return 0===(2&b.wrap)?t:(b.head=E,E.done=!1,T)},M.exports.inflateSetDictionary=(M,E)=>{const b=E.length;let k,a,g;return M&&M.state?(k=M.state,0!==k.wrap&&11!==k.mode?t:11===k.mode&&(a=1,a=x(a,E,b,0),a!==k.check)?y:(g=p(M,E,b,b),g?(k.mode=31,B):(k.havedict=1,T))):t},M.exports.inflateInfo="pako inflate (from Nodeca project)"},11496:M=>{"use strict";const E=15,b=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),x=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),k=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),a=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);M.exports=(M,g,n,J,u,T,V,I)=>{const t=I.bits;let y,B,r,c,C,R,w=0,S=0,X=0,U=0,v=0,N=0,K=0,h=0,Z=0,O=0,p=null,P=0;const F=new Uint16Array(16),l=new Uint16Array(16);let d,W,m,o=null,j=0;for(w=0;w<=E;w++)F[w]=0;for(S=0;S<J;S++)F[g[n+S]]++;for(v=t,U=E;U>=1&&0===F[U];U--);if(v>U&&(v=U),0===U)return u[T++]=20971520,u[T++]=20971520,I.bits=1,0;for(X=1;X<U&&0===F[X];X++);for(v<X&&(v=X),h=1,w=1;w<=E;w++)if(h<<=1,h-=F[w],h<0)return-1;if(h>0&&(0===M||1!==U))return-1;for(l[1]=0,w=1;w<E;w++)l[w+1]=l[w]+F[w];for(S=0;S<J;S++)0!==g[n+S]&&(V[l[g[n+S]]++]=S);if(0===M?(p=o=V,R=19):1===M?(p=b,P-=257,o=x,j-=257,R=256):(p=k,o=a,R=-1),O=0,S=0,w=X,C=T,N=v,K=0,r=-1,Z=1<<v,c=Z-1,1===M&&Z>852||2===M&&Z>592)return 1;for(;;){d=w-K,V[S]<R?(W=0,m=V[S]):V[S]>R?(W=o[j+V[S]],m=p[P+V[S]]):(W=96,m=0),y=1<<w-K,B=1<<N,X=B;do{B-=y,u[C+(O>>K)+B]=d<<24|W<<16|m}while(0!==B);for(y=1<<w-1;O&y;)y>>=1;if(0!==y?(O&=y-1,O+=y):O=0,S++,0===--F[w]){if(w===U)break;w=g[n+V[S]]}if(w>v&&(O&c)!==r){for(0===K&&(K=v),C+=X,N=w-K,h=1<<N;N+K<U&&(h-=F[N+K],!(h<=0));)N++,h<<=1;if(Z+=1<<N,1===M&&Z>852||2===M&&Z>592)return 1;r=O&c,u[r]=v<<24|N<<16|C-T}}return 0!==O&&(u[C+O]=w-K<<24|64<<16),I.bits=v,0}},11449:M=>{"use strict";M.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},11429:M=>{"use strict";function E(M){let E=M.length;for(;--E>=0;)M[E]=0}const b=256,x=286,k=30,a=15,g=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),n=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),J=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),u=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),T=new Array(576);E(T);const V=new Array(60);E(V);const I=new Array(512);E(I);const t=new Array(256);E(t);const y=new Array(29);E(y);const B=new Array(k);function r(M,E,b,x,k){this.static_tree=M,this.extra_bits=E,this.extra_base=b,this.elems=x,this.max_length=k,this.has_stree=M&&M.length}let c,C,R;function w(M,E){this.dyn_tree=M,this.max_code=0,this.stat_desc=E}E(B);const S=M=>M<256?I[M]:I[256+(M>>>7)],X=(M,E)=>{M.pending_buf[M.pending++]=255&E,M.pending_buf[M.pending++]=E>>>8&255},U=(M,E,b)=>{M.bi_valid>16-b?(M.bi_buf|=E<<M.bi_valid&65535,X(M,M.bi_buf),M.bi_buf=E>>16-M.bi_valid,M.bi_valid+=b-16):(M.bi_buf|=E<<M.bi_valid&65535,M.bi_valid+=b)},v=(M,E,b)=>{U(M,b[2*E],b[2*E+1])},N=(M,E)=>{let b=0;do{b|=1&M,M>>>=1,b<<=1}while(--E>0);return b>>>1},K=(M,E,b)=>{const x=new Array(16);let k,g,n=0;for(k=1;k<=a;k++)x[k]=n=n+b[k-1]<<1;for(g=0;g<=E;g++){let E=M[2*g+1];0!==E&&(M[2*g]=N(x[E]++,E))}},h=M=>{let E;for(E=0;E<x;E++)M.dyn_ltree[2*E]=0;for(E=0;E<k;E++)M.dyn_dtree[2*E]=0;for(E=0;E<19;E++)M.bl_tree[2*E]=0;M.dyn_ltree[512]=1,M.opt_len=M.static_len=0,M.last_lit=M.matches=0},Z=M=>{M.bi_valid>8?X(M,M.bi_buf):M.bi_valid>0&&(M.pending_buf[M.pending++]=M.bi_buf),M.bi_buf=0,M.bi_valid=0},O=(M,E,b,x)=>{const k=2*E,a=2*b;return M[k]<M[a]||M[k]===M[a]&&x[E]<=x[b]},p=(M,E,b)=>{const x=M.heap[b];let k=b<<1;for(;k<=M.heap_len&&(k<M.heap_len&&O(E,M.heap[k+1],M.heap[k],M.depth)&&k++,!O(E,x,M.heap[k],M.depth));)M.heap[b]=M.heap[k],b=k,k<<=1;M.heap[b]=x},P=(M,E,x)=>{let k,a,J,u,T=0;if(0!==M.last_lit)do{k=M.pending_buf[M.d_buf+2*T]<<8|M.pending_buf[M.d_buf+2*T+1],a=M.pending_buf[M.l_buf+T],T++,0===k?v(M,a,E):(J=t[a],v(M,J+b+1,E),u=g[J],0!==u&&(a-=y[J],U(M,a,u)),k--,J=S(k),v(M,J,x),u=n[J],0!==u&&(k-=B[J],U(M,k,u)))}while(T<M.last_lit);v(M,256,E)},F=(M,E)=>{const b=E.dyn_tree,x=E.stat_desc.static_tree,k=E.stat_desc.has_stree,g=E.stat_desc.elems;let n,J,u,T=-1;for(M.heap_len=0,M.heap_max=573,n=0;n<g;n++)0!==b[2*n]?(M.heap[++M.heap_len]=T=n,M.depth[n]=0):b[2*n+1]=0;for(;M.heap_len<2;)u=M.heap[++M.heap_len]=T<2?++T:0,b[2*u]=1,M.depth[u]=0,M.opt_len--,k&&(M.static_len-=x[2*u+1]);for(E.max_code=T,n=M.heap_len>>1;n>=1;n--)p(M,b,n);u=g;do{n=M.heap[1],M.heap[1]=M.heap[M.heap_len--],p(M,b,1),J=M.heap[1],M.heap[--M.heap_max]=n,M.heap[--M.heap_max]=J,b[2*u]=b[2*n]+b[2*J],M.depth[u]=(M.depth[n]>=M.depth[J]?M.depth[n]:M.depth[J])+1,b[2*n+1]=b[2*J+1]=u,M.heap[1]=u++,p(M,b,1)}while(M.heap_len>=2);M.heap[--M.heap_max]=M.heap[1],((M,E)=>{const b=E.dyn_tree,x=E.max_code,k=E.stat_desc.static_tree,g=E.stat_desc.has_stree,n=E.stat_desc.extra_bits,J=E.stat_desc.extra_base,u=E.stat_desc.max_length;let T,V,I,t,y,B,r=0;for(t=0;t<=a;t++)M.bl_count[t]=0;for(b[2*M.heap[M.heap_max]+1]=0,T=M.heap_max+1;T<573;T++)V=M.heap[T],t=b[2*b[2*V+1]+1]+1,t>u&&(t=u,r++),b[2*V+1]=t,V>x||(M.bl_count[t]++,y=0,V>=J&&(y=n[V-J]),B=b[2*V],M.opt_len+=B*(t+y),g&&(M.static_len+=B*(k[2*V+1]+y)));if(0!==r){do{for(t=u-1;0===M.bl_count[t];)t--;M.bl_count[t]--,M.bl_count[t+1]+=2,M.bl_count[u]--,r-=2}while(r>0);for(t=u;0!==t;t--)for(V=M.bl_count[t];0!==V;)I=M.heap[--T],I>x||(b[2*I+1]!==t&&(M.opt_len+=(t-b[2*I+1])*b[2*I],b[2*I+1]=t),V--)}})(M,E),K(b,T,M.bl_count)},l=(M,E,b)=>{let x,k,a=-1,g=E[1],n=0,J=7,u=4;for(0===g&&(J=138,u=3),E[2*(b+1)+1]=65535,x=0;x<=b;x++)k=g,g=E[2*(x+1)+1],++n<J&&k===g||(n<u?M.bl_tree[2*k]+=n:0!==k?(k!==a&&M.bl_tree[2*k]++,M.bl_tree[32]++):n<=10?M.bl_tree[34]++:M.bl_tree[36]++,n=0,a=k,0===g?(J=138,u=3):k===g?(J=6,u=3):(J=7,u=4))},d=(M,E,b)=>{let x,k,a=-1,g=E[1],n=0,J=7,u=4;for(0===g&&(J=138,u=3),x=0;x<=b;x++)if(k=g,g=E[2*(x+1)+1],!(++n<J&&k===g)){if(n<u)do{v(M,k,M.bl_tree)}while(0!==--n);else 0!==k?(k!==a&&(v(M,k,M.bl_tree),n--),v(M,16,M.bl_tree),U(M,n-3,2)):n<=10?(v(M,17,M.bl_tree),U(M,n-3,3)):(v(M,18,M.bl_tree),U(M,n-11,7));n=0,a=k,0===g?(J=138,u=3):k===g?(J=6,u=3):(J=7,u=4)}};let W=!1;const m=(M,E,b,x)=>{U(M,0+(x?1:0),3),((M,E,b,x)=>{Z(M),x&&(X(M,b),X(M,~b)),M.pending_buf.set(M.window.subarray(E,E+b),M.pending),M.pending+=b})(M,E,b,!0)};M.exports._tr_init=M=>{W||((()=>{let M,E,b,u,w;const S=new Array(16);for(b=0,u=0;u<28;u++)for(y[u]=b,M=0;M<1<<g[u];M++)t[b++]=u;for(t[b-1]=u,w=0,u=0;u<16;u++)for(B[u]=w,M=0;M<1<<n[u];M++)I[w++]=u;for(w>>=7;u<k;u++)for(B[u]=w<<7,M=0;M<1<<n[u]-7;M++)I[256+w++]=u;for(E=0;E<=a;E++)S[E]=0;for(M=0;M<=143;)T[2*M+1]=8,M++,S[8]++;for(;M<=255;)T[2*M+1]=9,M++,S[9]++;for(;M<=279;)T[2*M+1]=7,M++,S[7]++;for(;M<=287;)T[2*M+1]=8,M++,S[8]++;for(K(T,287,S),M=0;M<k;M++)V[2*M+1]=5,V[2*M]=N(M,5);c=new r(T,g,257,x,a),C=new r(V,n,0,k,a),R=new r(new Array(0),J,0,19,7)})(),W=!0),M.l_desc=new w(M.dyn_ltree,c),M.d_desc=new w(M.dyn_dtree,C),M.bl_desc=new w(M.bl_tree,R),M.bi_buf=0,M.bi_valid=0,h(M)},M.exports._tr_stored_block=m,M.exports._tr_flush_block=(M,E,x,k)=>{let a,g,n=0;M.level>0?(2===M.strm.data_type&&(M.strm.data_type=(M=>{let E,x=4093624447;for(E=0;E<=31;E++,x>>>=1)if(1&x&&0!==M.dyn_ltree[2*E])return 0;if(0!==M.dyn_ltree[18]||0!==M.dyn_ltree[20]||0!==M.dyn_ltree[26])return 1;for(E=32;E<b;E++)if(0!==M.dyn_ltree[2*E])return 1;return 0})(M)),F(M,M.l_desc),F(M,M.d_desc),n=(M=>{let E;for(l(M,M.dyn_ltree,M.l_desc.max_code),l(M,M.dyn_dtree,M.d_desc.max_code),F(M,M.bl_desc),E=18;E>=3&&0===M.bl_tree[2*u[E]+1];E--);return M.opt_len+=3*(E+1)+5+5+4,E})(M),a=M.opt_len+3+7>>>3,g=M.static_len+3+7>>>3,g<=a&&(a=g)):a=g=x+5,x+4<=a&&-1!==E?m(M,E,x,k):4===M.strategy||g===a?(U(M,2+(k?1:0),3),P(M,T,V)):(U(M,4+(k?1:0),3),((M,E,b,x)=>{let k;for(U(M,E-257,5),U(M,b-1,5),U(M,x-4,4),k=0;k<x;k++)U(M,M.bl_tree[2*u[k]+1],3);d(M,M.dyn_ltree,E-1),d(M,M.dyn_dtree,b-1)})(M,M.l_desc.max_code+1,M.d_desc.max_code+1,n+1),P(M,M.dyn_ltree,M.dyn_dtree)),h(M),k&&Z(M)},M.exports._tr_tally=(M,E,x)=>(M.pending_buf[M.d_buf+2*M.last_lit]=E>>>8&255,M.pending_buf[M.d_buf+2*M.last_lit+1]=255&E,M.pending_buf[M.l_buf+M.last_lit]=255&x,M.last_lit++,0===E?M.dyn_ltree[2*x]++:(M.matches++,E--,M.dyn_ltree[2*(t[x]+b+1)]++,M.dyn_dtree[2*S(E)]++),M.last_lit===M.lit_bufsize-1),M.exports._tr_align=M=>{U(M,2,3),v(M,256,T),(M=>{16===M.bi_valid?(X(M,M.bi_buf),M.bi_buf=0,M.bi_valid=0):M.bi_valid>=8&&(M.pending_buf[M.pending++]=255&M.bi_buf,M.bi_buf>>=8,M.bi_valid-=8)})(M)}},11473:M=>{"use strict";M.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},11848:M=>{function E(M,E,b){for(var x=M.length,k=-1/0,a=1/0,g=0;g<x;g++){var n=(b[0][g]-M[g])/E[g],J=(b[1][g]-M[g])/E[g];if(n>J){var u=n;n=J,J=u}if(J<k||n>a)return 1/0;n>k&&(k=n),J<a&&(a=J)}return k>a?1/0:k}M.exports=function(M,b,x,k){var a=E(b,x,k);if(a===1/0)M=null;else{M=M||[];for(var g=0;g<b.length;g++)M[g]=b[g]+x[g]*a}return M},M.exports.distance=E},12510:(M,E,b)=>{"use strict";b.d(E,{d:()=>g});var x=b(27);const k=x.useLayoutEffect;const a=function(M){var E=(0,x.useRef)(M);return k((function(){E.current=M})),E};var g=function(M){var E=a(M);(0,x.useEffect)((function(){var M=function(M){var b;if(null!=E.current&&(b=E.current(M)),M.defaultPrevented&&(M.returnValue=""),"string"===typeof b)return M.returnValue=b,b};return window.addEventListener("beforeunload",M),function(){window.removeEventListener("beforeunload",M)}}),[])}},12465:(M,E,b)=>{"use strict";var x=b(12469),k=Array.prototype.concat,a=Array.prototype.slice,g=M.exports=function(M){for(var E=[],b=0,g=M.length;b<g;b++){var n=M[b];x(n)?E=k.call(E,a.call(n)):E.push(n)}return E};g.wrap=function(M){return function(){return M(g(arguments))}}},12469:M=>{M.exports=function(M){return!(!M||"string"===typeof M)&&(M instanceof Array||Array.isArray(M)||M.length>=0&&(M.splice instanceof Function||Object.getOwnPropertyDescriptor(M,M.length-1)&&"String"!==M.constructor.name))}},11359:(M,E,b)=>{var x=b(11368);function k(M){for(var E,b,k=0,a=M.length,g=0;g<M.length;){for(E=M[g],b=0;g<a&&M[g]===E;)++g,++b;k+=x.log2(b)/7|0,k+=x.log2(E>>>0)/7|0,k+=2}return k}E.size=k,E.encode=function(M,E){E||(E=new Uint8Array(k(M)));for(var b,x,a=0,g=E.length,n=0;n<M.length;){for(b=M[n],x=0;n<M.length&&M[n]===b;)++n,++x;for(;a<g&&x>=128;)E[a++]=128+(127&x),x>>>=7;if(a>=g)throw new Error("RLE buffer overflow");for(E[a++]=x,b>>>=0;a<g&&b>=128;)E[a++]=128+(127&b),b>>>=7;if(a>=g)throw new Error("RLE buffer overflow");E[a++]=b}return E},E.decode=function(M,E){for(var b,x,k,a,g=E.length,n=M.length,J=0,u=0;u<n;){for(b=0,x=0;u<n&&M[u]>=128;)b+=(127&M[u++])<<x,x+=7;if(b+=M[u++]<<x,u>=n)throw new Error("RLE buffer underrun");if(J+b>g)throw new Error("Chunk buffer overflow");for(k=0,x=0;u<n&&M[u]>=128;)k+=(127&M[u++])<<x,x+=7;if(u>=n)throw new Error("RLE buffer underrun");for(k+=M[u++]<<x,a=0;a<b;++a)E[J++]=k}return E}},11368:(M,E)=>{"use strict";function b(M){var E=32;return(M&=-M)&&E--,65535&M&&(E-=16),16711935&M&&(E-=8),252645135&M&&(E-=4),858993459&M&&(E-=2),1431655765&M&&(E-=1),E}E.INT_BITS=32,E.INT_MAX=2147483647,E.INT_MIN=-1<<31,E.sign=function(M){return(M>0)-(M<0)},E.abs=function(M){var E=M>>31;return(M^E)-E},E.min=function(M,E){return E^(M^E)&-(M<E)},E.max=function(M,E){return M^(M^E)&-(M<E)},E.isPow2=function(M){return!(M&M-1)&&!!M},E.log2=function(M){var E,b;return E=(M>65535)<<4,E|=b=((M>>>=E)>255)<<3,E|=b=((M>>>=b)>15)<<2,(E|=b=((M>>>=b)>3)<<1)|(M>>>=b)>>1},E.log10=function(M){return M>=1e9?9:M>=1e8?8:M>=1e7?7:M>=1e6?6:M>=1e5?5:M>=1e4?4:M>=1e3?3:M>=100?2:M>=10?1:0},E.popCount=function(M){return 16843009*((M=(858993459&(M-=M>>>1&1431655765))+(M>>>2&858993459))+(M>>>4)&252645135)>>>24},E.countTrailingZeros=b,E.nextPow2=function(M){return M+=0===M,--M,M|=M>>>1,M|=M>>>2,M|=M>>>4,M|=M>>>8,(M|=M>>>16)+1},E.prevPow2=function(M){return M|=M>>>1,M|=M>>>2,M|=M>>>4,M|=M>>>8,(M|=M>>>16)-(M>>>1)},E.parity=function(M){return M^=M>>>16,M^=M>>>8,M^=M>>>4,27030>>>(M&=15)&1};var x=new Array(256);!function(M){for(var E=0;E<256;++E){var b=E,x=E,k=7;for(b>>>=1;b;b>>>=1)x<<=1,x|=1&b,--k;M[E]=x<<k&255}}(x),E.reverse=function(M){return x[255&M]<<24|x[M>>>8&255]<<16|x[M>>>16&255]<<8|x[M>>>24&255]},E.interleave2=function(M,E){return(M=1431655765&((M=858993459&((M=252645135&((M=16711935&((M&=65535)|M<<8))|M<<4))|M<<2))|M<<1))|(E=1431655765&((E=858993459&((E=252645135&((E=16711935&((E&=65535)|E<<8))|E<<4))|E<<2))|E<<1))<<1},E.deinterleave2=function(M,E){return(M=65535&((M=16711935&((M=252645135&((M=858993459&((M=M>>>E&1431655765)|M>>>1))|M>>>2))|M>>>4))|M>>>16))<<16>>16},E.interleave3=function(M,E,b){return M=1227133513&((M=3272356035&((M=251719695&((M=4278190335&((M&=1023)|M<<16))|M<<8))|M<<4))|M<<2),(M|=(E=1227133513&((E=3272356035&((E=251719695&((E=4278190335&((E&=1023)|E<<16))|E<<8))|E<<4))|E<<2))<<1)|(b=1227133513&((b=3272356035&((b=251719695&((b=4278190335&((b&=1023)|b<<16))|b<<8))|b<<4))|b<<2))<<2},E.deinterleave3=function(M,E){return(M=1023&((M=4278190335&((M=251719695&((M=3272356035&((M=M>>>E&1227133513)|M>>>2))|M>>>4))|M>>>8))|M>>>16))<<22>>22},E.nextCombination=function(M){var E=M|M-1;return E+1|(~E&-~E)-1>>>b(M)+1}},11404:M=>{"use strict";M.exports=function(M,E,b,x){var k=self||window;try{try{var a;try{a=new k.Blob([M])}catch(u){(a=new(k.BlobBuilder||k.WebKitBlobBuilder||k.MozBlobBuilder||k.MSBlobBuilder)).append(M),a=a.getBlob()}var g=k.URL||k.webkitURL,n=g.createObjectURL(a),J=new k[E](n,b);return g.revokeObjectURL(n),J}catch(u){return new k[E]("data:application/javascript,".concat(encodeURIComponent(M)),b)}}catch(u){if(!x)throw Error("Inline worker is not supported");return new k[E](x,b)}}},11835:(M,E,b)=>{"use strict";function x(M,E,b,x,k){var a={};return Object.keys(x).forEach((function(M){a[M]=x[M]})),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=b.slice().reverse().reduce((function(b,x){return x(M,E,b)||b}),a),k&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(k):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(M,E,a),a=null),a}b.d(E,{b:()=>x})},11832:(M,E,b)=>{"use strict";function x(M,E,b,x){b&&Object.defineProperty(M,E,{enumerable:b.enumerable,configurable:b.configurable,writable:b.writable,value:b.initializer?b.initializer.call(x):void 0})}b.d(E,{d:()=>x})},12117:(M,E,b)=>{"use strict";b.d(E,{d:()=>R,h:()=>r,k:()=>c,n:()=>I,q:()=>B,u:()=>y,y:()=>t});var x=b(970),k=b(1133),a=b(1009),g=b(989),n=b(12119),J=b(11554),u=b(1122),T=b(1026),V=b(1124);const I=Object.freeze(new x.e(0,0,0,0)),t=Object.freeze(x.m.Zero()),y=Object.freeze(x.l.Zero()),B=Object.freeze(u.e.Zero()),r=Object.freeze(k.e.Black()),c=Object.freeze(new k.h(0,0,0,0)),C={key:0,repeatCount:0,loopMode:2};class R{static _PrepareAnimation(M,E,b,a,g,n,J,T){let V;if(!isNaN(parseFloat(g))&&isFinite(g)?V=R.ANIMATIONTYPE_FLOAT:g instanceof x.e?V=R.ANIMATIONTYPE_QUATERNION:g instanceof x.m?V=R.ANIMATIONTYPE_VECTOR3:g instanceof x.l?V=R.ANIMATIONTYPE_VECTOR2:g instanceof k.e?V=R.ANIMATIONTYPE_COLOR3:g instanceof k.h?V=R.ANIMATIONTYPE_COLOR4:g instanceof u.e&&(V=R.ANIMATIONTYPE_SIZE),void 0==V)return null;const I=new R(M,E,b,V,J),t=[{frame:0,value:g},{frame:a,value:n}];return I.setKeys(t),void 0!==T&&I.setEasingFunction(T),I}static CreateAnimation(M,E,b,x){const k=new R(M+"Animation",M,b,E,R.ANIMATIONLOOPMODE_CONSTANT);return k.setEasingFunction(x),k}static CreateAndStartAnimation(M,E,b,x,k,a,g,n,J,u,T){const V=R._PrepareAnimation(M,b,x,k,a,g,n,J);return V?(E.va&&(T=E.va()),T?T.beginDirectAnimation(E,[V],0,k,1===V.loopMode,1,u):null):null}static CreateAndStartHierarchyAnimation(M,E,b,x,k,a,g,n,J,u,T){const V=R._PrepareAnimation(M,x,k,a,g,n,J,u);if(!V)return null;return E.va().beginDirectHierarchyAnimation(E,b,[V],0,a,1===V.loopMode,1,T)}static CreateMergeAndStartAnimation(M,E,b,x,k,a,g,n,J,u){const T=R._PrepareAnimation(M,b,x,k,a,g,n,J);return T?(E.animations.push(T),E.va().beginAnimation(E,0,k,1===T.loopMode,1,u)):null}static MakeAnimationAdditive(M,E,b){let k;k="object"===typeof E?E:{referenceFrame:E??0,range:b,cloneOriginalAnimation:arguments.length>3&&void 0!==arguments[3]&&arguments[3],clonedAnimationName:arguments.length>4?arguments[4]:void 0};let a=M;if(k.cloneOriginalAnimation&&(a=M.clone(),a.name=k.clonedAnimationName||a.name),!a._keys.length)return a;const g=k.referenceFrame&&k.referenceFrame>=0?k.referenceFrame:0;let n=0;const J=a._keys[0];let u=a._keys.length-1;const T=a._keys[u],V={referenceValue:J.value,referencePosition:x.i.Fd[0],referenceQuaternion:x.i.Quaternion[0],referenceScaling:x.i.Fd[1],keyPosition:x.i.Fd[2],keyQuaternion:x.i.Quaternion[1],keyScaling:x.i.Fd[3]};let I=J.frame,t=T.frame;if(k.range){const M=a.getRange(k.range);M&&(I=M.from,t=M.to)}else I=k.fromFrame??I,t=k.toFrame??t;if(I!==J.frame&&(n=a.createKeyForFrame(I)),t!==T.frame&&(u=a.createKeyForFrame(t)),1===a._keys.length){const M=a._getKeyValue(a._keys[0]);V.referenceValue=M.clone?M.clone():M}else if(g<=J.frame){const M=a._getKeyValue(J.value);V.referenceValue=M.clone?M.clone():M}else if(g>=T.frame){const M=a._getKeyValue(T.value);V.referenceValue=M.clone?M.clone():M}else{C.key=0;const M=a._interpolate(g,C);V.referenceValue=M.clone?M.clone():M}a.dataType===R.ANIMATIONTYPE_QUATERNION?V.referenceValue.normalize().conjugateInPlace():a.dataType===R.ANIMATIONTYPE_MATRIX&&(V.referenceValue.decompose(V.referenceScaling,V.referenceQuaternion,V.referencePosition),V.referenceQuaternion.normalize().conjugateInPlace());let y=Number.MAX_VALUE;const B=k.clipKeys?[]:null;for(let r=n;r<=u;r++){let M=a._keys[r];if((B||k.cloneOriginalAnimation)&&(M={frame:M.frame,value:M.value.clone?M.value.clone():M.value,inTangent:M.inTangent,outTangent:M.outTangent,interpolation:M.interpolation,lockedTangent:M.lockedTangent},B&&(y===Number.MAX_VALUE&&(y=M.frame),M.frame-=y,B.push(M))),!r||a.dataType===R.ANIMATIONTYPE_FLOAT||M.value!==J.value)switch(a.dataType){case R.ANIMATIONTYPE_MATRIX:M.value.decompose(V.keyScaling,V.keyQuaternion,V.keyPosition),V.keyPosition.Ld(V.referencePosition),V.keyScaling.divideInPlace(V.referenceScaling),V.referenceQuaternion.multiplyToRef(V.keyQuaternion,V.keyQuaternion),x.d.ComposeToRef(V.keyScaling,V.keyQuaternion,V.keyPosition,M.value);break;case R.ANIMATIONTYPE_QUATERNION:V.referenceValue.multiplyToRef(M.value,M.value);break;case R.ANIMATIONTYPE_VECTOR2:case R.ANIMATIONTYPE_VECTOR3:case R.ANIMATIONTYPE_COLOR3:case R.ANIMATIONTYPE_COLOR4:M.value.subtractToRef(V.referenceValue,M.value);break;case R.ANIMATIONTYPE_SIZE:M.value.width-=V.referenceValue.width,M.value.height-=V.referenceValue.height;break;default:M.value-=V.referenceValue}}return B&&a.setKeys(B,!0),a}static TransitionTo(M,E,b,x,k,a,g){let n=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;if(g<=0)return b[M]=E,n&&n(),null;const J=k*(g/1e3);a.setKeys([{frame:0,value:b[M].clone?b[M].clone():b[M]},{frame:J,value:E}]),b.animations||(b.animations=[]),b.animations.push(a);const u=x.beginAnimation(b,0,J,!1);return u.onAnimationEnd=n,u}get runtimeAnimations(){return this._runtimeAnimations}get hasRunningRuntimeAnimations(){for(const M of this._runtimeAnimations)if(!M.isStopped())return!0;return!1}constructor(M,E,b,x,k,a){this.name=M,this.targetProperty=E,this.framePerSecond=b,this.dataType=x,this.loopMode=k,this.enableBlending=a,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=E.split("."),this.dataType=x,this.loopMode=void 0===k?R.ANIMATIONLOOPMODE_CYCLE:k,this.uniqueId=R._UniqueIdGenerator++}toString(M){let E="Name: "+this.name+", property: "+this.targetProperty;if(E+=", datatype: "+["Float","Fd","Quaternion","Matrix","te","Vector2"][this.dataType],E+=", nKeys: "+(this._keys?this._keys.length:"none"),E+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),M){E+=", Ranges: {";let M=!0;for(const b in this._ranges)M&&(E+=", ",M=!1),E+=b;E+="}"}return E}addEvent(M){this._events.push(M),this._events.sort(((M,E)=>M.frame-E.frame))}removeEvents(M){for(let E=0;E<this._events.length;E++)this._events[E].frame===M&&(this._events.splice(E,1),E--)}getEvents(){return this._events}createRange(M,E,b){this._ranges[M]||(this._ranges[M]=new n.e(M,E,b))}deleteRange(M){let E=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const b=this._ranges[M];if(b){if(E){const M=b.from,E=b.to;for(let b=this._keys.length-1;b>=0;b--)this._keys[b].frame>=M&&this._keys[b].frame<=E&&this._keys.splice(b,1)}this._ranges[M]=null}}getRange(M){return this._ranges[M]}getKeys(){return this._keys}getHighestFrame(){let M=0;for(let E=0,b=this._keys.length;E<b;E++)M<this._keys[E].frame&&(M=this._keys[E].frame);return M}getEasingFunction(){return this._easingFunction}setEasingFunction(M){this._easingFunction=M}floatInterpolateFunction(M,E,b){return(0,a.m)(M,E,b)}floatInterpolateFunctionWithTangents(M,E,b,x,k){return(0,a.e)(M,E,b,x,k)}quaternionInterpolateFunction(M,E,b){return x.e.Slerp(M,E,b)}quaternionInterpolateFunctionWithTangents(M,E,b,k,a){return x.e.Hermite(M,E,b,k,a).normalize()}vector3InterpolateFunction(M,E,b){return x.m.Lerp(M,E,b)}vector3InterpolateFunctionWithTangents(M,E,b,k,a){return x.m.Hermite(M,E,b,k,a)}vector2InterpolateFunction(M,E,b){return x.l.Lerp(M,E,b)}vector2InterpolateFunctionWithTangents(M,E,b,k,a){return x.l.Hermite(M,E,b,k,a)}sizeInterpolateFunction(M,E,b){return u.e.Lerp(M,E,b)}color3InterpolateFunction(M,E,b){return k.e.Lerp(M,E,b)}color3InterpolateFunctionWithTangents(M,E,b,x,a){return k.e.Hermite(M,E,b,x,a)}color4InterpolateFunction(M,E,b){return k.h.Lerp(M,E,b)}color4InterpolateFunctionWithTangents(M,E,b,x,a){return k.h.Hermite(M,E,b,x,a)}_getKeyValue(M){return"function"===typeof M?M():M}evaluate(M){return C.key=0,this._interpolate(M,C)}_interpolate(M,E){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(E.loopMode===R.ANIMATIONLOOPMODE_CONSTANT&&E.repeatCount>0)return E.highLimitValue.clone?E.highLimitValue.clone():E.highLimitValue;const x=this._keys,k=x.length;let a=E.key;for(;a>=0&&M<x[a].frame;)--a;for(;a+1<=k-1&&M>=x[a+1].frame;)++a;if(E.key=a,a<0)return b?void 0:this._getKeyValue(x[0].value);if(a+1>k-1)return b?void 0:this._getKeyValue(x[k-1].value);const g=x[a],n=x[a+1];if(b&&(M===g.frame||M===n.frame))return;const J=this._getKeyValue(g.value),u=this._getKeyValue(n.value);if(1===g.interpolation)return n.frame>M?J:u;const T=void 0!==g.outTangent&&void 0!==n.inTangent,V=n.frame-g.frame;let C=(M-g.frame)/V;const w=g.easingFunction||this.getEasingFunction();switch(null!==w&&(C=w.ease(C)),this.dataType){case R.ANIMATIONTYPE_FLOAT:{const M=T?this.floatInterpolateFunctionWithTangents(J,g.outTangent*V,u,n.inTangent*V,C):this.floatInterpolateFunction(J,u,C);switch(E.loopMode){case R.ANIMATIONLOOPMODE_CYCLE:case R.ANIMATIONLOOPMODE_CONSTANT:case R.ANIMATIONLOOPMODE_YOYO:return M;case R.ANIMATIONLOOPMODE_RELATIVE:case R.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return(E.offsetValue??0)*E.repeatCount+M}break}case R.ANIMATIONTYPE_QUATERNION:{const M=T?this.quaternionInterpolateFunctionWithTangents(J,g.outTangent.scale(V),u,n.inTangent.scale(V),C):this.quaternionInterpolateFunction(J,u,C);switch(E.loopMode){case R.ANIMATIONLOOPMODE_CYCLE:case R.ANIMATIONLOOPMODE_CONSTANT:case R.ANIMATIONLOOPMODE_YOYO:return M;case R.ANIMATIONLOOPMODE_RELATIVE:case R.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return M.addInPlace((E.offsetValue||I).scale(E.repeatCount))}return M}case R.ANIMATIONTYPE_VECTOR3:{const M=T?this.vector3InterpolateFunctionWithTangents(J,g.outTangent.scale(V),u,n.inTangent.scale(V),C):this.vector3InterpolateFunction(J,u,C);switch(E.loopMode){case R.ANIMATIONLOOPMODE_CYCLE:case R.ANIMATIONLOOPMODE_CONSTANT:case R.ANIMATIONLOOPMODE_YOYO:return M;case R.ANIMATIONLOOPMODE_RELATIVE:case R.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return M.add((E.offsetValue||t).scale(E.repeatCount))}break}case R.ANIMATIONTYPE_VECTOR2:{const M=T?this.vector2InterpolateFunctionWithTangents(J,g.outTangent.scale(V),u,n.inTangent.scale(V),C):this.vector2InterpolateFunction(J,u,C);switch(E.loopMode){case R.ANIMATIONLOOPMODE_CYCLE:case R.ANIMATIONLOOPMODE_CONSTANT:case R.ANIMATIONLOOPMODE_YOYO:return M;case R.ANIMATIONLOOPMODE_RELATIVE:case R.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return M.add((E.offsetValue||y).scale(E.repeatCount))}break}case R.ANIMATIONTYPE_SIZE:switch(E.loopMode){case R.ANIMATIONLOOPMODE_CYCLE:case R.ANIMATIONLOOPMODE_CONSTANT:case R.ANIMATIONLOOPMODE_YOYO:return this.sizeInterpolateFunction(J,u,C);case R.ANIMATIONLOOPMODE_RELATIVE:case R.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return this.sizeInterpolateFunction(J,u,C).add((E.offsetValue||B).scale(E.repeatCount))}break;case R.ANIMATIONTYPE_COLOR3:{const M=T?this.color3InterpolateFunctionWithTangents(J,g.outTangent.scale(V),u,n.inTangent.scale(V),C):this.color3InterpolateFunction(J,u,C);switch(E.loopMode){case R.ANIMATIONLOOPMODE_CYCLE:case R.ANIMATIONLOOPMODE_CONSTANT:case R.ANIMATIONLOOPMODE_YOYO:return M;case R.ANIMATIONLOOPMODE_RELATIVE:case R.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return M.add((E.offsetValue||r).scale(E.repeatCount))}break}case R.ANIMATIONTYPE_COLOR4:{const M=T?this.color4InterpolateFunctionWithTangents(J,g.outTangent.scale(V),u,n.inTangent.scale(V),C):this.color4InterpolateFunction(J,u,C);switch(E.loopMode){case R.ANIMATIONLOOPMODE_CYCLE:case R.ANIMATIONLOOPMODE_CONSTANT:case R.ANIMATIONLOOPMODE_YOYO:return M;case R.ANIMATIONLOOPMODE_RELATIVE:case R.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return M.add((E.offsetValue||c).scale(E.repeatCount))}break}case R.ANIMATIONTYPE_MATRIX:switch(E.loopMode){case R.ANIMATIONLOOPMODE_CYCLE:case R.ANIMATIONLOOPMODE_CONSTANT:case R.ANIMATIONLOOPMODE_YOYO:return R.AllowMatricesInterpolation?this.matrixInterpolateFunction(J,u,C,E.workValue):J;case R.ANIMATIONLOOPMODE_RELATIVE:case R.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return J}}return 0}matrixInterpolateFunction(M,E,b,k){return R.AllowMatrixDecomposeForInterpolation?k?(x.d.DecomposeLerpToRef(M,E,b,k),k):x.d.DecomposeLerp(M,E,b):k?(x.d.LerpToRef(M,E,b,k),k):x.d.Lerp(M,E,b)}clone(){const M=new R(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(M.enableBlending=this.enableBlending,M.blendingSpeed=this.blendingSpeed,this._keys&&M.setKeys(this._keys),this._ranges){M._ranges={};for(const E in this._ranges){const b=this._ranges[E];b&&(M._ranges[E]=b.clone())}}return M}setKeys(M){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._keys=E?M:M.slice(0)}createKeyForFrame(M){C.key=0;const E=this._interpolate(M,C,!0);if(!E)return this._keys[C.key].frame===M?C.key:C.key+1;const b={frame:M,value:E.clone?E.clone():E};return this._keys.splice(C.key+1,0,b),C.key+1}serialize(){const M={};M.name=this.name,M.property=this.targetProperty,M.framePerSecond=this.framePerSecond,M.dataType=this.dataType,M.loopBehavior=this.loopMode,M.enableBlending=this.enableBlending,M.blendingSpeed=this.blendingSpeed;const E=this.dataType;M.keys=[];const b=this.getKeys();for(let x=0;x<b.length;x++){const k=b[x],a={};switch(a.frame=k.frame,E){case R.ANIMATIONTYPE_FLOAT:a.values=[k.value],void 0!==k.inTangent&&a.values.push(k.inTangent),void 0!==k.outTangent&&(void 0===k.inTangent&&a.values.push(void 0),a.values.push(k.outTangent)),void 0!==k.interpolation&&(void 0===k.inTangent&&a.values.push(void 0),void 0===k.outTangent&&a.values.push(void 0),a.values.push(k.interpolation));break;case R.ANIMATIONTYPE_QUATERNION:case R.ANIMATIONTYPE_MATRIX:case R.ANIMATIONTYPE_VECTOR3:case R.ANIMATIONTYPE_COLOR3:case R.ANIMATIONTYPE_COLOR4:a.values=k.value.Vd(),void 0!=k.inTangent&&a.values.push(k.inTangent.Vd()),void 0!=k.outTangent&&(void 0===k.inTangent&&a.values.push(void 0),a.values.push(k.outTangent.Vd())),void 0!==k.interpolation&&(void 0===k.inTangent&&a.values.push(void 0),void 0===k.outTangent&&a.values.push(void 0),a.values.push(k.interpolation))}M.keys.push(a)}M.ranges=[];for(const x in this._ranges){const E=this._ranges[x];if(!E)continue;const b={};b.name=x,b.from=E.from,b.to=E.to,M.ranges.push(b)}return M}static _UniversalLerp(M,E,b){const x=M.constructor;return x.Lerp?x.Lerp(M,E,b):x.Slerp?x.Slerp(M,E,b):M.toFixed?M*(1-b)+b*E:E}static Parse(M){const E=new R(M.name,M.property,M.framePerSecond,M.dataType,M.loopBehavior),b=M.dataType,a=[];let g,n;for(M.enableBlending&&(E.enableBlending=M.enableBlending),M.blendingSpeed&&(E.blendingSpeed=M.blendingSpeed),n=0;n<M.keys.length;n++){const E=M.keys[n];let J,u,T;switch(b){case R.ANIMATIONTYPE_FLOAT:g=E.values[0],E.values.length>=2&&(J=E.values[1]),E.values.length>=3&&(u=E.values[2]),E.values.length>=4&&(T=E.values[3]);break;case R.ANIMATIONTYPE_QUATERNION:if(g=x.e.Id(E.values),E.values.length>=8){const M=x.e.Id(E.values.slice(4,8));M.equals(x.e.Zero())||(J=M)}if(E.values.length>=12){const M=x.e.Id(E.values.slice(8,12));M.equals(x.e.Zero())||(u=M)}E.values.length>=13&&(T=E.values[12]);break;case R.ANIMATIONTYPE_MATRIX:g=x.d.Id(E.values),E.values.length>=17&&(T=E.values[16]);break;case R.ANIMATIONTYPE_COLOR3:g=k.e.Id(E.values),E.values[3]&&(J=k.e.Id(E.values[3])),E.values[4]&&(u=k.e.Id(E.values[4])),E.values[5]&&(T=E.values[5]);break;case R.ANIMATIONTYPE_COLOR4:g=k.h.Id(E.values),E.values[4]&&(J=k.h.Id(E.values[4])),E.values[5]&&(u=k.h.Id(E.values[5])),E.values[6]&&(T=k.h.Id(E.values[6]));break;case R.ANIMATIONTYPE_VECTOR3:default:g=x.m.Id(E.values),E.values[3]&&(J=x.m.Id(E.values[3])),E.values[4]&&(u=x.m.Id(E.values[4])),E.values[5]&&(T=E.values[5])}const V={};V.frame=E.frame,V.value=g,void 0!=J&&(V.inTangent=J),void 0!=u&&(V.outTangent=u),void 0!=T&&(V.interpolation=T),a.push(V)}if(E.setKeys(a),M.ranges)for(n=0;n<M.ranges.length;n++)g=M.ranges[n],E.createRange(g.name,g.from,g.to);return E}static AppendSerializedAnimations(M,E){V.b.AppendSerializedAnimations(M,E)}static ParseFromFileAsync(M,E){return new Promise(((b,x)=>{const k=new T.d;k.addEventListener("readystatechange",(()=>{if(4==k.readyState)if(200==k.status){let E=JSON.parse(k.responseText);if(E.animations&&(E=E.animations),E.length){const M=[];for(const b of E)M.push(this.Parse(b));b(M)}else{const x=this.Parse(E);M&&(x.name=M),b(x)}}else x("Unable to load the animation")})),k.open("GET",E),k.send()}))}static ParseFromSnippetAsync(M){return new Promise(((E,b)=>{const x=new T.d;x.addEventListener("readystatechange",(()=>{if(4==x.readyState)if(200==x.status){const b=JSON.parse(JSON.parse(x.responseText).jsonPayload);if(b.animations){const x=JSON.parse(b.animations),k=[];for(const E of x.animations){const b=this.Parse(E);b.snippetId=M,k.push(b)}E(k)}else{const x=JSON.parse(b.animation),k=this.Parse(x);k.snippetId=M,E(k)}}else b("Unable to load the snippet "+M)})),x.open("GET",this.SnippetUrl+"/"+M.replace(/#/g,"/")),x.send()}))}}R._UniqueIdGenerator=0,R.AllowMatricesInterpolation=!1,R.AllowMatrixDecomposeForInterpolation=!0,R.SnippetUrl="https://snippet.babylonjs.com",R.ANIMATIONTYPE_FLOAT=0,R.ANIMATIONTYPE_VECTOR3=1,R.ANIMATIONTYPE_QUATERNION=2,R.ANIMATIONTYPE_MATRIX=3,R.ANIMATIONTYPE_COLOR3=4,R.ANIMATIONTYPE_COLOR4=7,R.ANIMATIONTYPE_VECTOR2=5,R.ANIMATIONTYPE_SIZE=6,R.ANIMATIONLOOPMODE_RELATIVE=0,R.ANIMATIONLOOPMODE_CYCLE=1,R.ANIMATIONLOOPMODE_CONSTANT=2,R.ANIMATIONLOOPMODE_YOYO=4,R.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT=5,R.CreateFromSnippetAsync=R.ParseFromSnippetAsync,(0,g.h)("BABYLON.Animation",R),J.d._AnimationRangeFactory=(M,E,b)=>new n.e(M,E,b)},12119:(M,E,b)=>{"use strict";b.d(E,{e:()=>x});class x{constructor(M,E,b){this.name=M,this.from=E,this.to=b}clone(){return new x(this.name,this.from,this.to)}}},12114:(M,E,b)=>{"use strict";b.d(E,{b:()=>g});var x=b(970),k=b(985),a=b(11554);class g extends a.d{get _matrix(){return this._compose(),this.Mj}set _matrix(M){(M.updateFlag!==this.Mj.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.Mj.p(M),this._markAsDirtyAndDecompose())}constructor(M,E){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(M,E.va(),!1),this.name=M,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=E,this.Mj=(null===k||void 0===k?void 0:k.clone())??x.d.Identity(),this._restMatrix=a??this.Mj.clone(),this._bindMatrix=g??this.Mj.clone(),this._index=n,this._absoluteMatrix=new x.d,this._absoluteBindMatrix=new x.d,this._absoluteInverseBindMatrix=new x.d,this._finalMatrix=new x.d,E.bones.push(this),this.setParent(b,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(M){this.setParent(M)}setParent(M){let E=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==M){if(this.parent){const M=this.parent.children.indexOf(this);-1!==M&&this.parent.children.splice(M,1)}this._parentNode=M,this.parent&&this.parent.children.push(this),E&&this._updateAbsoluteBindMatrices(),this.ge()}}getLocalMatrix(){return this._compose(),this.Mj}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(M){this._restMatrix.p(M)}setRestPose(M){this.setRestMatrix(M)}getBindPose(){return this.getBindMatrix()}setBindMatrix(M){this.ne(M)}setBindPose(M){this.setBindMatrix(M)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const M=x.i.Fd[0],E=x.i.Quaternion[0],b=x.i.Fd[1];this.getRestMatrix().decompose(M,E,b),this._linkedTransformNode.position.p(b),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??x.e.Identity(),this._linkedTransformNode.rotationQuaternion.p(E),this._linkedTransformNode.ve.p(M)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(M){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=M,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.rg}set position(M){this._decompose(),this.rg.p(M),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(M){this.setRotation(M)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(M){this.setRotationQuaternion(M)}get ve(){return this.getScale()}set ve(M){this.setScale(M)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=x.m.Zero(),this._localRotation=x.e.Zero(),this.rg=x.m.Zero()),this.Mj.decompose(this._localScaling,this._localRotation,this.rg))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,x.d.ComposeToRef(this._localScaling,this._localRotation,this.rg,this.Mj)):this._needToCompose=!1)}ne(M){let E=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],b=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.p(M),E&&this._updateAbsoluteBindMatrices(),b?this._matrix=M:this.ge()}_updateAbsoluteBindMatrices(M){let E=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(M||(M=this._bindMatrix),this.parent?M.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.p(M),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),E)for(let b=0;b<this.children.length;b++)this.children[b]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}ge(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.ge(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.ge(),this._needToDecompose=!0}_updatePosition(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2?arguments[2]:void 0,k=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const a=this.getLocalMatrix();if(0==E)k?(a.addAtIndex(12,M.x),a.addAtIndex(13,M.y),a.addAtIndex(14,M.z)):a.setTranslationFromFloats(M.x,M.y,M.z);else{let E=null;b&&(E=b.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const n=g._TmpMats[0],J=g._TmpVecs[0];this.parent?b&&E?(n.p(this.parent.getAbsoluteMatrix()),n.multiplyToRef(E,n)):n.p(this.parent.getAbsoluteMatrix()):x.d.IdentityToRef(n),k&&n.setTranslationFromFloats(0,0,0),n.invert(),x.m.TransformCoordinatesToRef(M,n,J),k?(a.addAtIndex(12,J.x),a.addAtIndex(13,J.y),a.addAtIndex(14,J.z)):a.setTranslationFromFloats(J.x,J.y,J.z)}this._markAsDirtyAndDecompose()}translate(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2?arguments[2]:void 0;this._updatePosition(M,E,b,!0)}setPosition(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2?arguments[2]:void 0;this._updatePosition(M,E,b,!1)}setAbsolutePosition(M,E){this.setPosition(M,1,E)}scale(M,E,b){let k=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const a=this.getLocalMatrix(),n=g._TmpMats[0];x.d.ScalingToRef(M,E,b,n),n.multiplyToRef(a,a),n.invert();for(const x of this.children){const k=x.getLocalMatrix();k.multiplyToRef(n,k),k.multiplyAtIndex(12,M),k.multiplyAtIndex(13,E),k.multiplyAtIndex(14,b),x._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),k)for(const x of this.children)x.scale(M,E,b,k)}setScale(M){this._decompose(),this._localScaling.p(M),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(M){this._decompose(),M.p(this._localScaling)}setYawPitchRoll(M,E,b){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4?arguments[4]:void 0;if(0===k){const n=g._TmpQuat;return x.e.RotationYawPitchRollToRef(M,E,b,n),void this.setRotationQuaternion(n,k,a)}const n=g._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(n,a))return;const J=g._TmpMats[1];x.d.RotationYawPitchRollToRef(M,E,b,J),n.multiplyToRef(J,J),this._rotateWithMatrix(J,k,a)}rotate(M,E){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,k=arguments.length>3?arguments[3]:void 0;const a=g._TmpMats[0];a.setTranslationFromFloats(0,0,0),x.d.RotationAxisToRef(M,E,a),this._rotateWithMatrix(a,b,k)}setAxisAngle(M,E){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,k=arguments.length>3?arguments[3]:void 0;if(0===b){const a=g._TmpQuat;return x.e.RotationAxisToRef(M,E,a),void this.setRotationQuaternion(a,b,k)}const a=g._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(a,k))return;const n=g._TmpMats[1];x.d.RotationAxisToRef(M,E,n),a.multiplyToRef(n,n),this._rotateWithMatrix(n,b,k)}setRotation(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(M.y,M.x,M.z,E,b)}setRotationQuaternion(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2?arguments[2]:void 0;if(0===E)return this._decompose(),this._localRotation.p(M),void this._markAsDirtyAndCompose();const k=g._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(k,b))return;const a=g._TmpMats[1];x.d.FromQuaternionToRef(M,a),k.multiplyToRef(a,a),this._rotateWithMatrix(a,E,b)}setRotationMatrix(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2?arguments[2]:void 0;if(0===E){const k=g._TmpQuat;return x.e.FromRotationMatrixToRef(M,k),void this.setRotationQuaternion(k,E,b)}const k=g._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(k,b))return;const a=g._TmpMats[1];a.p(M),k.multiplyToRef(M,a),this._rotateWithMatrix(a,E,b)}_rotateWithMatrix(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2?arguments[2]:void 0;const x=this.getLocalMatrix(),k=x.m[12],a=x.m[13],n=x.m[14],J=this.getParent(),u=g._TmpMats[3],T=g._TmpMats[4];J&&1==E?(b?(u.p(b.getWorldMatrix()),J.getAbsoluteMatrix().multiplyToRef(u,u)):u.p(J.getAbsoluteMatrix()),T.p(u),T.invert(),x.multiplyToRef(u,x),x.multiplyToRef(M,x),x.multiplyToRef(T,x)):1==E&&b?(u.p(b.getWorldMatrix()),T.p(u),T.invert(),x.multiplyToRef(u,x),x.multiplyToRef(M,x),x.multiplyToRef(T,x)):x.multiplyToRef(M,x),x.setTranslationFromFloats(k,a,n),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(M,E){const b=g._TmpMats[2];return M.p(this.getAbsoluteMatrix()),E?(M.multiplyToRef(E.getWorldMatrix(),M),x.d.ScalingToRef(E.ve.x,E.ve.y,E.ve.z,b)):x.d.IdentityToRef(b),M.invert(),!isNaN(M.m[0])&&(b.multiplyAtIndex(0,this._scalingDeterminant),M.multiplyToRef(b,M),!0)}eb(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const b=x.m.Zero();return this.getPositionToRef(M,E,b),b}getPositionToRef(){let M=arguments.length>1?arguments[1]:void 0,E=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const M=this.getLocalMatrix();E.x=M.m[12],E.y=M.m[13],E.z=M.m[14]}else{let b=null;M&&(b=M.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let x=g._TmpMats[0];M&&b?(x.p(this.getAbsoluteMatrix()),x.multiplyToRef(b,x)):x=this.getAbsoluteMatrix(),E.x=x.m[12],E.y=x.m[13],E.z=x.m[14]}}getAbsolutePosition(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const E=x.m.Zero();return this.getPositionToRef(1,M,E),E}getAbsolutePositionToRef(M,E){this.getPositionToRef(1,M,E)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.Mj.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.p(this.Mj);const M=this._skeleton.getPoseMatrix();M&&this._absoluteMatrix.multiplyToRef(M,this._absoluteMatrix)}const M=this.children,E=M.length;for(let b=0;b<E;b++)M[b].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}hf(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const b=x.m.Zero();return this.getDirectionToRef(M,E,b),b}getDirectionToRef(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2?arguments[2]:void 0,k=null;E&&(k=E.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const a=g._TmpMats[0];a.p(this.getAbsoluteMatrix()),E&&k&&a.multiplyToRef(k,a),x.m.TransformNormalToRef(M,a,b),b.normalize()}getRotation(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const b=x.m.Zero();return this.getRotationToRef(M,E,b),b}getRotationToRef(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2?arguments[2]:void 0;const x=g._TmpQuat;this.getRotationQuaternionToRef(M,E,x),x.toEulerAnglesToRef(b)}getRotationQuaternion(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const b=x.e.Identity();return this.getRotationQuaternionToRef(M,E,b),b}getRotationQuaternionToRef(){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,E=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),E.p(this._localRotation);else{const b=g._TmpMats[0],x=this.getAbsoluteMatrix();M?x.multiplyToRef(M.getWorldMatrix(),b):b.p(x),b.multiplyAtIndex(0,this._scalingDeterminant),b.multiplyAtIndex(1,this._scalingDeterminant),b.multiplyAtIndex(2,this._scalingDeterminant),b.decompose(void 0,E,void 0)}}getRotationMatrix(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,E=arguments.length>1?arguments[1]:void 0;const b=x.d.Identity();return this.getRotationMatrixToRef(M,E,b),b}getRotationMatrixToRef(){let M=arguments.length>1?arguments[1]:void 0,E=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(E);else{const b=g._TmpMats[0],x=this.getAbsoluteMatrix();M?x.multiplyToRef(M.getWorldMatrix(),b):b.p(x),b.multiplyAtIndex(0,this._scalingDeterminant),b.multiplyAtIndex(1,this._scalingDeterminant),b.multiplyAtIndex(2,this._scalingDeterminant),b.getRotationMatrixToRef(E)}}getAbsolutePositionFromLocal(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const b=x.m.Zero();return this.getAbsolutePositionFromLocalToRef(M,E,b),b}getAbsolutePositionFromLocalToRef(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2?arguments[2]:void 0,k=null;E&&(k=E.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const a=g._TmpMats[0];a.p(this.getAbsoluteMatrix()),E&&k&&a.multiplyToRef(k,a),x.m.TransformCoordinatesToRef(M,a,b)}getLocalPositionFromAbsolute(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const b=x.m.Zero();return this.getLocalPositionFromAbsoluteToRef(M,E,b),b}getLocalPositionFromAbsoluteToRef(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2?arguments[2]:void 0,k=null;E&&(k=E.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const a=g._TmpMats[0];a.p(this.getAbsoluteMatrix()),E&&k&&a.multiplyToRef(k,a),a.invert(),x.m.TransformCoordinatesToRef(M,a,b)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}}g._TmpVecs=(0,k.b)(2,x.m.Zero),g._TmpQuat=x.e.Identity(),g._TmpMats=(0,k.b)(5,x.d.Identity)},12494:(M,E,b)=>{"use strict";b.d(E,{e:()=>P});var x=b(948),k=b(953),a=b(962),g=b(970),n=b(11554),J=b(11537),u=b(1269),T=b(1099),V=b(977);class I{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(M){this._zoomStopsAnimation=M}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(M){this._idleRotationSpeed=M}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(M){this._idleRotationWaitTime=M}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(M){this._idleRotationSpinupTime=M}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(M){this._attachedCamera=M;const E=this._attachedCamera.va();this._onPrePointerObservableObserver=E.onPrePointerObservable.add((M=>{M.type!==u.d.POINTERDOWN?M.type===u.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=M.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const M=T.e.Now;let E=0;null!=this._lastFrameTime&&(E=M-this._lastFrameTime),this._lastFrameTime=M,this._applyUserInteraction();const b=M-this._lastInteractionTime-this._idleRotationWaitTime,x=Math.max(Math.min(b/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*x,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(E/1e3))}))}detach(){if(!this._attachedCamera)return;const M=this._attachedCamera.va();this._onPrePointerObservableObserver&&M.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(M){this._lastInteractionTime=M??T.e.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<V.b}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let M=!1;return this._lastFrameRadius===this._attachedCamera.i&&0!==this._attachedCamera.inertialRadiusOffset&&(M=!0),this._lastFrameRadius=this._attachedCamera.i,this._zoomStopsAnimation?M:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=T.e.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}b(1517);class t{constructor(){this._easingMode=t.EASINGMODE_EASEIN}setEasingMode(M){const E=Math.min(Math.max(M,0),2);this._easingMode=E}getEasingMode(){return this._easingMode}easeInCore(M){throw new Error("You must implement this method")}ease(M){switch(this._easingMode){case t.EASINGMODE_EASEIN:return this.easeInCore(M);case t.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-M)}return M>=.5?.5*(1-this.easeInCore(2*(1-M)))+.5:.5*this.easeInCore(2*M)}}t.EASINGMODE_EASEIN=0,t.EASINGMODE_EASEOUT=1,t.EASINGMODE_EASEINOUT=2;var y=b(12117);class B{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(M){if(this._autoTransitionRange===M)return;this._autoTransitionRange=M;const E=this._attachedCamera;E&&(M?this._onMeshTargetChangedObserver=E.onMeshTargetChangedObservable.add((M=>{if(M&&(M.ce(!0),M.getBoundingInfo)){const E=M.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*E,this.upperRadiusTransitionRange=.05*E}})):this._onMeshTargetChangedObserver&&E.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(M){this._attachedCamera=M,this._onAfterCheckInputsObserver=M.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(M){return!!this._attachedCamera&&(this._attachedCamera.i===M&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(M){if(!this._attachedCamera)return;this._radiusBounceTransition||(B.EasingFunction.setEasingMode(B.EasingMode),this._radiusBounceTransition=y.d.CreateAnimation("i",y.d.ANIMATIONTYPE_FLOAT,60,B.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const E=y.d.TransitionTo("i",this._attachedCamera.i+M,this._attachedCamera,this._attachedCamera.va(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));E&&this._animatables.push(E)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}B.EasingFunction=new class extends t{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=M}easeInCore(M){const E=Math.max(0,this.amplitude);return Math.pow(M,3)-M*E*Math.sin(3.141592653589793*M)}}(.3),B.EasingMode=t.EASINGMODE_EASEOUT;class r{constructor(){this.onTargetFramingAnimationEndObservable=new a.b,this._mode=r.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(M){this._mode=M}get mode(){return this._mode}set radiusScale(M){this._radiusScale=M}get radiusScale(){return this._radiusScale}set positionScale(M){this._positionScale=M}get positionScale(){return this._positionScale}set defaultElevation(M){this._defaultElevation=M}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(M){this._elevationReturnTime=M}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(M){this._elevationReturnWaitTime=M}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(M){this._zoomStopsAnimation=M}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(M){this._framingTime=M}get framingTime(){return this._framingTime}init(){}attach(M){this._attachedCamera=M;const E=this._attachedCamera.va();r.EasingFunction.setEasingMode(r.EasingMode),this._onPrePointerObservableObserver=E.onPrePointerObservable.add((M=>{M.type!==u.d.POINTERDOWN?M.type===u.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=M.onMeshTargetChangedObservable.add((M=>{M&&M.getBoundingInfo&&this.zoomOnMesh(M,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=M.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const M=this._attachedCamera.va();this._onPrePointerObservableObserver&&M.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(M){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;M.ce(!0);const x=M.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(x.minimumWorld,x.maximumWorld,E,b)}zoomOnMeshHierarchy(M){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;M.ce(!0);const x=M.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(x.min,x.max,E,b)}zoomOnMeshesHierarchy(M){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const x=new g.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),k=new g.m(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let a=0;a<M.length;a++){const E=M[a].getHierarchyBoundingVectors(!0);g.m.CheckExtends(E.min,x,k),g.m.CheckExtends(E.max,x,k)}this.zoomOnBoundingInfo(x,k,E,b)}zoomOnBoundingInfo(M,E){let b,x=arguments.length>2&&void 0!==arguments[2]&&arguments[2],k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const a=M.y,n=a+(E.y-a)*this._positionScale,J=E.Qc(M).scale(.5);if(x)b=new g.m(0,n,0);else{const E=M.add(J);b=new g.m(E.x,n,E.z)}this._vectorTransition||(this._vectorTransition=y.d.CreateAnimation("target",y.d.ANIMATIONTYPE_VECTOR3,60,r.EasingFunction)),this._betaIsAnimating=!0;let u=y.d.TransitionTo("target",b,this._attachedCamera,this._attachedCamera.va(),60,this._vectorTransition,this._framingTime);u&&this._animatables.push(u);let T=0;if(this._mode===r.FitFrustumSidesMode){const b=this._calculateLowerRadiusFromModelBoundingSphere(M,E);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=J.length()+this._attachedCamera.bj),T=b}else this._mode===r.IgnoreBoundsSizeMode&&(T=this._calculateLowerRadiusFromModelBoundingSphere(M,E),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.bj));if(this.autoCorrectCameraLimitsAndSensibility){const b=E.Qc(M).length();this._attachedCamera.panningSensibility=5e3/b,this._attachedCamera.wheelPrecision=100/T}return this._radiusTransition||(this._radiusTransition=y.d.CreateAnimation("i",y.d.ANIMATIONTYPE_FLOAT,60,r.EasingFunction)),u=y.d.TransitionTo("i",T,this._attachedCamera,this._attachedCamera.va(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),k&&k(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),u&&this._animatables.push(u),!0}_calculateLowerRadiusFromModelBoundingSphere(M,E){const b=this._attachedCamera;if(!b)return 0;let x=b._calculateLowerRadiusFromModelBoundingSphere(M,E,this._radiusScale);return b.lowerRadiusLimit&&this._mode===r.IgnoreBoundsSizeMode&&(x=x<b.lowerRadiusLimit?b.lowerRadiusLimit:x),b.upperRadiusLimit&&(x=x>b.upperRadiusLimit?b.upperRadiusLimit:x),x}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const M=T.e.Now-this._lastInteractionTime,E=.5*Math.PI-this._defaultElevation,b=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>b&&M>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=y.d.CreateAnimation("beta",y.d.ANIMATIONTYPE_FLOAT,60,r.EasingFunction));const M=y.d.TransitionTo("beta",E,this._attachedCamera,this._attachedCamera.va(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));M&&this._animatables.push(M)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=T.e.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}r.EasingFunction=new class extends t{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=M}easeInCore(M){return this.exponent<=0?M:(Math.exp(this.exponent*M)-1)/(Math.exp(this.exponent)-1)}},r.EasingMode=t.EASINGMODE_EASEINOUT,r.IgnoreBoundsSizeMode=0,r.FitFrustumSidesMode=1;var c=b(11548),C=b(12106),R=b(12109),w=b(1176);class S{constructor(){this._currentActiveButton=-1,this.buttons=[0,1,2]}attachControl(M){M=w.e.BackCompatCameraNoPreventDefault(arguments);const E=this.camera.getEngine(),b=E.getInputElement();let x=0,k=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=a=>{var g,n;const J=a.event,T="touch"===J.pointerType;if(a.type!==u.d.POINTERMOVE&&-1===this.buttons.indexOf(J.button))return;const V=J.target;if(this._altKey=J.altKey,this._ctrlKey=J.ctrlKey,this._metaKey=J.metaKey,this._shiftKey=J.shiftKey,this._buttonsPressed=J.buttons,E.isPointerLock){const M=J.movementX,E=J.movementY;this.onTouch(null,M,E),this._pointA=null,this._pointB=null}else{if(a.type!==u.d.POINTERDOWN&&a.type!==u.d.POINTERDOUBLETAP&&T&&(null===(g=this._pointA)||void 0===g?void 0:g.pointerId)!==J.pointerId&&(null===(n=this._pointB)||void 0===n?void 0:n.pointerId)!==J.pointerId)return;if(a.type!==u.d.POINTERDOWN||-1!==this._currentActiveButton&&!T)if(a.type===u.d.POINTERDOUBLETAP)this.onDoubleTap(J.pointerType);else if(a.type!==u.d.POINTERUP||this._currentActiveButton!==J.button&&!T){if(a.type===u.d.POINTERMOVE)if(M||J.preventDefault(),this._pointA&&null===this._pointB){const M=J.clientX-this._pointA.x,E=J.clientY-this._pointA.y;this._pointA.x=J.clientX,this._pointA.y=J.clientY,this.onTouch(this._pointA,M,E)}else if(this._pointA&&this._pointB){const M=this._pointA.pointerId===J.pointerId?this._pointA:this._pointB;M.x=J.clientX,M.y=J.clientY;const E=this._pointA.x-this._pointB.x,b=this._pointA.y-this._pointB.y,g=E*E+b*b,n={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:J.pointerId,type:a.type};this.onMultiTouch(this._pointA,this._pointB,x,g,k,n),k=n,x=g}}else{try{null===V||void 0===V||V.releasePointerCapture(J.pointerId)}catch(I){}T||(this._pointB=null),E._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==J.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==J.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==x||k)&&(this.onMultiTouch(this._pointA,this._pointB,x,0,k,null),x=0,k=null),this._currentActiveButton=-1,this.onButtonUp(J),M||J.preventDefault()}else{try{null===V||void 0===V||V.setPointerCapture(J.pointerId)}catch(I){}if(null===this._pointA)this._pointA={x:J.clientX,y:J.clientY,pointerId:J.pointerId,type:J.pointerType};else{if(null!==this._pointB)return;this._pointB={x:J.clientX,y:J.clientY,pointerId:J.pointerId,type:J.pointerType}}-1!==this._currentActiveButton||T||(this._currentActiveButton=J.button),this.onButtonDown(J),M||(J.preventDefault(),b&&b.focus())}}},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,u.d.POINTERDOWN|u.d.POINTERUP|u.d.POINTERMOVE|u.d.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,x=0,k=null,this.onLostFocus()},this._contextMenuBind=M=>this.onContextMenu(M),b&&b.addEventListener("contextmenu",this._contextMenuBind,!1);const a=this.camera.va().getEngine().getHostWindow();a&&w.e.RegisterTopRootEvents(a,[{name:"blur",handler:this._onLostFocus}])}Ce(){if(this._onLostFocus){const M=this.camera.va().getEngine().getHostWindow();M&&w.e.UnregisterTopRootEvents(M,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const M=this.camera.va().getEngine().getInputElement();M&&M.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentActiveButton=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(M){}onTouch(M,E,b){}onMultiTouch(M,E,b,x,k,a){}onContextMenu(M){M.preventDefault()}onButtonDown(M){}onButtonUp(M){}onLostFocus(){}}(0,x.d)([(0,k.E)()],S.prototype,"buttons",void 0);class X extends S{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(M,E){if(0!==this.panningSensibility&&M&&E){const b=E.x-M.x,x=E.y-M.y;this.camera.inertialPanningX+=-b/this.panningSensibility,this.camera.inertialPanningY+=x/this.panningSensibility}}_computePinchZoom(M,E){const b=this.camera.i||X.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.i=b*Math.sqrt(M)/Math.sqrt(E):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(E-M)*b*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(E-M)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(M,E,b){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-E/this.panningSensibility,this.camera.inertialPanningY+=b/this.panningSensibility):(this.camera.inertialAlphaOffset-=E/this.angularSensibilityX,this.camera.inertialBetaOffset-=b/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(M,E,b,x,k,a){0===b&&null===k||0===x&&null===a||(this.multiTouchPanAndZoom?(this._computePinchZoom(b,x),this._computeMultiTouchPanning(k,a)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(x)-Math.sqrt(b))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(b,x),this._isPinching=!0):this._computeMultiTouchPanning(k,a)):this.multiTouchPanning?this._computeMultiTouchPanning(k,a):this.pinchZoom&&this._computePinchZoom(b,x))}onButtonDown(M){this._isPanClick=M.button===this.camera._panningMouseButton}onButtonUp(M){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}X.MinimumRadiusForPinch=.001,(0,x.d)([(0,k.E)()],X.prototype,"buttons",void 0),(0,x.d)([(0,k.E)()],X.prototype,"angularSensibilityX",void 0),(0,x.d)([(0,k.E)()],X.prototype,"angularSensibilityY",void 0),(0,x.d)([(0,k.E)()],X.prototype,"pinchPrecision",void 0),(0,x.d)([(0,k.E)()],X.prototype,"pinchDeltaPercentage",void 0),(0,x.d)([(0,k.E)()],X.prototype,"useNaturalPinchZoom",void 0),(0,x.d)([(0,k.E)()],X.prototype,"pinchZoom",void 0),(0,x.d)([(0,k.E)()],X.prototype,"panningSensibility",void 0),(0,x.d)([(0,k.E)()],X.prototype,"multiTouchPanning",void 0),(0,x.d)([(0,k.E)()],X.prototype,"multiTouchPanAndZoom",void 0),R.e.ArcRotateCameraPointersInput=X;var U=b(1276);class v{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(M){M=w.e.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((E=>{const b=E.event;if(!b.metaKey)if(E.type===U.e.KEYDOWN){if(this._ctrlPressed=b.ctrlKey,this._altPressed=b.altKey,-1!==this.keysUp.indexOf(b.keyCode)||-1!==this.keysDown.indexOf(b.keyCode)||-1!==this.keysLeft.indexOf(b.keyCode)||-1!==this.keysRight.indexOf(b.keyCode)||-1!==this.keysReset.indexOf(b.keyCode)){-1===this._keys.indexOf(b.keyCode)&&this._keys.push(b.keyCode),b.preventDefault&&(M||b.preventDefault())}}else if(-1!==this.keysUp.indexOf(b.keyCode)||-1!==this.keysDown.indexOf(b.keyCode)||-1!==this.keysLeft.indexOf(b.keyCode)||-1!==this.keysRight.indexOf(b.keyCode)||-1!==this.keysReset.indexOf(b.keyCode)){const E=this._keys.indexOf(b.keyCode);E>=0&&this._keys.splice(E,1),b.preventDefault&&(M||b.preventDefault())}})))}Ce(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const M=this.camera;for(let E=0;E<this._keys.length;E++){const b=this._keys[E];-1!==this.keysLeft.indexOf(b)?this._ctrlPressed&&this.camera._useCtrlForPanning?M.inertialPanningX-=1/this.panningSensibility:M.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(b)?this._ctrlPressed&&this.camera._useCtrlForPanning?M.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?M.inertialRadiusOffset+=1/this.zoomingSensibility:M.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(b)?this._ctrlPressed&&this.camera._useCtrlForPanning?M.inertialPanningX+=1/this.panningSensibility:M.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(b)?this._ctrlPressed&&this.camera._useCtrlForPanning?M.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?M.inertialRadiusOffset-=1/this.zoomingSensibility:M.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(b)&&M.useInputToRestoreState&&M.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,x.d)([(0,k.E)()],v.prototype,"keysUp",void 0),(0,x.d)([(0,k.E)()],v.prototype,"keysDown",void 0),(0,x.d)([(0,k.E)()],v.prototype,"keysLeft",void 0),(0,x.d)([(0,k.E)()],v.prototype,"keysRight",void 0),(0,x.d)([(0,k.E)()],v.prototype,"keysReset",void 0),(0,x.d)([(0,k.E)()],v.prototype,"panningSensibility",void 0),(0,x.d)([(0,k.E)()],v.prototype,"zoomingSensibility",void 0),(0,x.d)([(0,k.E)()],v.prototype,"useAltToZoom",void 0),(0,x.d)([(0,k.E)()],v.prototype,"angularSpeed",void 0),R.e.ArcRotateCameraKeyboardMoveInput=v;var N=b(1145),K=b(1285),h=b(1009);class Z{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new g.m(0,0,0),this._globalOffset=new g.m(0,0,0),this._inertialPanning=g.m.Zero()}_computeDeltaFromMouseWheelLegacyEvent(M,E){let b=0;const x=.01*M*this.wheelDeltaPercentage*E;return b=M>0?x/(1+this.wheelDeltaPercentage):x*(1+this.wheelDeltaPercentage),b}attachControl(M){M=w.e.BackCompatCameraNoPreventDefault(arguments),this._wheel=E=>{if(E.type!==u.d.POINTERWHEEL)return;const b=E.event;let x=0;const k=b.deltaMode===K.b.DOM_DELTA_LINE?40:1,a=-b.deltaY*k;if(this.customComputeDeltaFromMouseWheel)x=this.customComputeDeltaFromMouseWheel(a,this,b);else if(this.wheelDeltaPercentage){if(x=this._computeDeltaFromMouseWheelLegacyEvent(a,this.camera.i),x>0){let M=this.camera.i,E=this.camera.inertialRadiusOffset+x;for(let b=0;b<20&&Math.abs(E)>.001;b++)M-=E,E*=this.camera.inertia;M=(0,h.d)(M,0,Number.MAX_VALUE),x=this._computeDeltaFromMouseWheelLegacyEvent(a,M)}}else x=a/(40*this.wheelPrecision);x&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(x)):this.camera.inertialRadiusOffset+=x),b.preventDefault&&(M||b.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,u.d.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.Kd(0)}Ce(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const M=this.camera;0+M.inertialAlphaOffset+M.inertialBetaOffset+M.inertialRadiusOffset&&(this._updateHitPlane(),M.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(M.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const M=this.camera,E=M.target.Qc(M.position);this._hitPlane=N.e.FromPositionAndNormal(M.target,E)}_getPosition(){const M=this.camera,E=M.va(),b=E.createPickingRay(E.pointerX,E.pointerY,g.d.Identity(),M,!1);0===M.targetScreenOffset.x&&0===M.targetScreenOffset.y||(this._viewOffset.set(M.targetScreenOffset.x,M.targetScreenOffset.y,0),M.getViewMatrix().invertToRef(M._cameraTransformMatrix),this._globalOffset=g.m.TransformNormal(this._viewOffset,M._cameraTransformMatrix),b.origin.addInPlace(this._globalOffset));let x=0;return this._hitPlane&&(x=b.intersectsPlane(this._hitPlane)??0),b.origin.addInPlace(b.direction.scaleInPlace(x))}_zoomToMouse(M){const E=this.camera,b=1-E.inertia;if(E.lowerRadiusLimit){const x=E.lowerRadiusLimit??0;E.i-(E.inertialRadiusOffset+M)/b<x&&(M=(E.i-x)*b-E.inertialRadiusOffset)}if(E.upperRadiusLimit){const x=E.upperRadiusLimit??0;E.i-(E.inertialRadiusOffset+M)/b>x&&(M=(E.i-x)*b-E.inertialRadiusOffset)}const x=M/b/E.i,k=this._getPosition(),a=g.i.Fd[6];k.subtractToRef(E.target,a),a.scaleInPlace(x),a.scaleInPlace(b),this._inertialPanning.addInPlace(a),E.inertialRadiusOffset+=M}_zeroIfClose(M){Math.abs(M.x)<V.b&&(M.x=0),Math.abs(M.y)<V.b&&(M.y=0),Math.abs(M.z)<V.b&&(M.z=0)}}(0,x.d)([(0,k.E)()],Z.prototype,"wheelPrecision",void 0),(0,x.d)([(0,k.E)()],Z.prototype,"zoomToMouseLocation",void 0),(0,x.d)([(0,k.E)()],Z.prototype,"wheelDeltaPercentage",void 0),R.e.ArcRotateCameraMouseWheelInput=Z;class O extends R.g{constructor(M){super(M)}addMouseWheel(){return this.add(new Z),this}addPointers(){return this.add(new X),this}addKeyboard(){return this.add(new v),this}}var p=b(989);n.d.AddNodeConstructor("ArcRotateCamera",((M,E)=>()=>new P(M,0,0,1,g.m.Zero(),E)));class P extends C.c{get target(){return this._target}set target(M){this.setTarget(M)}get targetHost(){return this._targetHost}set targetHost(M){M&&this.setTarget(M)}getTarget(){return this.target}get position(){return this._position}set position(M){this.setPosition(M)}set upVector(M){this._upToYMatrix||(this._yToUpMatrix=new g.d,this._upToYMatrix=new g.d,this._upVector=g.m.Zero()),M.normalize(),this._upVector.p(M),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){g.d.RotationAlignToRef(g.m.UpReadOnly,this._upVector,this._yToUpMatrix),g.d.RotationAlignToRef(this._upVector,g.m.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const M=this.inputs.attached.pointers;return M?M.angularSensibilityX:0}set angularSensibilityX(M){const E=this.inputs.attached.pointers;E&&(E.angularSensibilityX=M)}get angularSensibilityY(){const M=this.inputs.attached.pointers;return M?M.angularSensibilityY:0}set angularSensibilityY(M){const E=this.inputs.attached.pointers;E&&(E.angularSensibilityY=M)}get pinchPrecision(){const M=this.inputs.attached.pointers;return M?M.pinchPrecision:0}set pinchPrecision(M){const E=this.inputs.attached.pointers;E&&(E.pinchPrecision=M)}get pinchDeltaPercentage(){const M=this.inputs.attached.pointers;return M?M.pinchDeltaPercentage:0}set pinchDeltaPercentage(M){const E=this.inputs.attached.pointers;E&&(E.pinchDeltaPercentage=M)}get useNaturalPinchZoom(){const M=this.inputs.attached.pointers;return!!M&&M.useNaturalPinchZoom}set useNaturalPinchZoom(M){const E=this.inputs.attached.pointers;E&&(E.useNaturalPinchZoom=M)}get panningSensibility(){const M=this.inputs.attached.pointers;return M?M.panningSensibility:0}set panningSensibility(M){const E=this.inputs.attached.pointers;E&&(E.panningSensibility=M)}get keysUp(){const M=this.inputs.attached.keyboard;return M?M.keysUp:[]}set keysUp(M){const E=this.inputs.attached.keyboard;E&&(E.keysUp=M)}get keysDown(){const M=this.inputs.attached.keyboard;return M?M.keysDown:[]}set keysDown(M){const E=this.inputs.attached.keyboard;E&&(E.keysDown=M)}get keysLeft(){const M=this.inputs.attached.keyboard;return M?M.keysLeft:[]}set keysLeft(M){const E=this.inputs.attached.keyboard;E&&(E.keysLeft=M)}get keysRight(){const M=this.inputs.attached.keyboard;return M?M.keysRight:[]}set keysRight(M){const E=this.inputs.attached.keyboard;E&&(E.keysRight=M)}get wheelPrecision(){const M=this.inputs.attached.mousewheel;return M?M.wheelPrecision:0}set wheelPrecision(M){const E=this.inputs.attached.mousewheel;E&&(E.wheelPrecision=M)}get zoomToMouseLocation(){const M=this.inputs.attached.mousewheel;return!!M&&M.zoomToMouseLocation}set zoomToMouseLocation(M){const E=this.inputs.attached.mousewheel;E&&(E.zoomToMouseLocation=M)}get wheelDeltaPercentage(){const M=this.inputs.attached.mousewheel;return M?M.wheelDeltaPercentage:0}set wheelDeltaPercentage(M){const E=this.inputs.attached.mousewheel;E&&(E.wheelDeltaPercentage=M)}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(M){M!==this.useBouncingBehavior&&(M?(this._bouncingBehavior=new B,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(M){M!==this.useFramingBehavior&&(M?(this._framingBehavior=new r,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(M){M!==this.useAutoRotationBehavior&&(M?(this._autoRotationBehavior=new I,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(M,E,b,x,k,n){var J;let u=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(M,g.m.Zero(),n,u),J=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=g.m.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=g.l.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._viewMatrix=new g.d,this.panningAxis=new g.m(1,1,0),this._transformedDirection=new g.m,this.mapPanning=!1,this._progressiveRestore=!1,this.onMeshTargetChangedObservable=new a.b,this.checkCollisions=!1,this.collisionRadius=new g.m(.5,.5,.5),this._previousPosition=g.m.Zero(),this._collisionVelocity=g.m.Zero(),this._newPosition=g.m.Zero(),this._computationVector=g.m.Zero(),this._onCollisionPositionChange=function(M,E){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;b?(J.setPosition(E),J.Fk&&J.Fk(b)):J._previousPosition.p(J._position);const x=Math.cos(J.alpha),k=Math.sin(J.alpha),a=Math.cos(J.beta);let g=Math.sin(J.beta);0===g&&(g=1e-4);const n=J._getTargetPosition();J._computationVector.Hd(J.i*x*g,J.i*a,J.i*k*g),n.addToRef(J._computationVector,J._newPosition),J._position.p(J._newPosition);let u=J.upVector;J.allowUpsideDown&&J.beta<0&&(u=u.clone(),u=u.negate()),J._computeViewMatrix(J._position,n,u),J._viewMatrix.addAtIndex(12,J.targetScreenOffset.x),J._viewMatrix.addAtIndex(13,J.targetScreenOffset.y),J._collisionTriggered=!1},this._target=g.m.Zero(),k&&this.setTarget(k),this.alpha=E,this.beta=b,this.i=x,this.getViewMatrix(),this.inputs=new O(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new g.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.i=void 0,this._cache.targetScreenOffset=g.l.Zero()}_updateCache(M){M||super._updateCache(),this._cache._target.p(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.i=this.i,this._cache.targetScreenOffset.p(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const M=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?M.addToRef(this._targetBoundingCenter,this._target):this._target.p(M)}const M=this._getLockedTargetPosition();return M||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.i,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>V.b&&this.restoreStateInterpolationFactor<1?(this._progressiveRestore=!0,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.i=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.i===this.i&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(M,E){let b=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const k=arguments;E=w.e.BackCompatCameraNoPreventDefault(k),this._useCtrlForPanning=b,this._panningMouseButton=x,"boolean"===typeof k[0]&&(k.length>1&&(this._useCtrlForPanning=k[1]),k.length>2&&(this._panningMouseButton=k[2])),this.inputs.attachElement(E),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}Ce(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),this._progressiveRestore){const M=this._scene.getEngine().getDeltaTime()/1e3,E=1-Math.pow(2,-M/this.restoreStateInterpolationFactor);this.setTarget(g.m.Lerp(this.getTarget(),this._storedTarget,E)),g.e.RotationAlphaBetaGammaToRef(this._storedAlpha,this._storedBeta,0,g.i.Quaternion[0]),g.e.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,g.i.Quaternion[1]),g.e.SlerpToRef(g.i.Quaternion[1],g.i.Quaternion[0],E,g.i.Quaternion[2]),g.i.Quaternion[2].normalize(),g.i.Quaternion[2].toAlphaBetaGammaToRef(g.i.Fd[0]),this.alpha=g.i.Fd[0].x,this.beta=g.i.Fd[0].y,this.i+=(this._storedRadius-this.i)*E,g.l.LerpToRef(this.targetScreenOffset,this._storedTargetScreenOffset,E,this.targetScreenOffset),(g.m.DistanceSquared(this.getTarget(),this._storedTarget)<V.b&&g.i.Quaternion[2].equalsWithEpsilon(g.i.Quaternion[0])&&Math.pow(this._storedRadius-this.i,2)<V.b&&g.l.Distance(this.targetScreenOffset,this._storedTargetScreenOffset)<V.b||0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset||0!==this.inertialPanningX||0!==this.inertialPanningY)&&(this._progressiveRestore=!1)}if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){const M=this.invertRotation?-1:1,E=this._calculateHandednessMultiplier();let b=this.inertialAlphaOffset*E;this.beta<0&&(b*=-1),this.alpha+=b*M,this.beta+=this.inertialBetaOffset*M,this.i-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<V.b&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<V.b&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*V.b&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){const M=new g.m(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),M.multiplyInPlace(this.panningAxis),g.m.TransformNormalToRef(M,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const M=this.upVector,E=g.m.CrossToRef(this._transformedDirection,M,this._transformedDirection);g.m.CrossToRef(M,E,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);g.m.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.p(this._transformedDirection)}else{if(this.parent){const M=g.i.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(M),M.transposeToRef(M),g.m.TransformCoordinatesToRef(this._transformedDirection,M,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*V.b&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*V.b&&(this.inertialPanningY=0)}this._checkLimits(),super._checkInputs()}}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.i<this.lowerRadiusLimit&&(this.i=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.i>this.upperRadiusLimit&&(this.i=this.upperRadiusLimit,this.inertialRadiusOffset=0)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||g.m.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.i=this._computationVector.length(),0===this.i&&(this.i=1e-4);const M=this.alpha;0===this._computationVector.x&&0===this._computationVector.z?this.alpha=Math.PI/2:this.alpha=Math.acos(this._computationVector.x/Math.sqrt(Math.pow(this._computationVector.x,2)+Math.pow(this._computationVector.z,2))),this._computationVector.z<0&&(this.alpha=2*Math.PI-this.alpha);const E=Math.round((M-this.alpha)/(2*Math.PI));this.alpha+=2*E*Math.PI,this.beta=Math.acos(this._computationVector.y/this.i),this._checkLimits()}setPosition(M){this._position.equals(M)||(this._position.p(M),this.rebuildAnglesAndRadius())}setTarget(M){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],x=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(x=this.overrideCloneAlphaBetaRadius??x,M.ce)E&&M.getBoundingInfo?this._targetBoundingCenter=M.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,M.ce(),this._targetHost=M,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const E=M,x=this._getTargetPosition();if(x&&!b&&x.equals(E))return;this._targetHost=null,this._target=E,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}x||this.rebuildAnglesAndRadius()}_getViewMatrix(){const M=Math.cos(this.alpha),E=Math.sin(this.alpha),b=Math.cos(this.beta);let x=Math.sin(this.beta);0===x&&(x=1e-4),0===this.i&&(this.i=1e-4);const k=this._getTargetPosition();if(this._computationVector.Hd(this.i*M*x,this.i*b,this.i*E*x),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||g.m.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),k.addToRef(this._computationVector,this._newPosition),this.va().collisionsEnabled&&this.checkCollisions){const M=this.va().collisionCoordinator;this._collider||(this._collider=M.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,M.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.p(this._newPosition);let M=this.upVector;this.allowUpsideDown&&x<0&&(M=M.negate()),this._computeViewMatrix(this._position,k,M),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget=k,this._viewMatrix}zoomOn(M){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1];M=M||this.va().meshes;const b=J.e.MinMax(M);let x=this._calculateLowerRadiusFromModelBoundingSphere(b.min,b.max);x=Math.max(Math.min(x,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.i=x*this.zoomOnFactor,this.focusOn({min:b.min,max:b.max,distance:x},E)}focusOn(M){let E,b,x=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===M.min){const x=M||this.va().meshes;E=J.e.MinMax(x),b=g.m.Distance(E.min,E.max)}else{E=M,b=M.distance}this._target=J.e.Center(E),x||(this.maxZ=2*b)}createRigCamera(M,E){let b=0;switch(this.cameraRigMode){case c.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case c.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case c.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case c.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case c.c.RIG_MODE_VR:b=this._cameraRigParams.stereoHalfAngle*(0===E?1:-1);break;case c.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:b=this._cameraRigParams.stereoHalfAngle*(0===E?-1:1)}const x=new P(M,this.alpha+b,this.beta,this.i,this._target,this.va());return x._cameraRigParams={},x.isRigCamera=!0,x.rigParent=this,x.upVector=this.upVector,x.mode=this.mode,x.orthoLeft=this.orthoLeft,x.orthoRight=this.orthoRight,x.orthoBottom=this.orthoBottom,x.orthoTop=this.orthoTop,x}_updateRigCameras(){const M=this._rigCameras[0],E=this._rigCameras[1];switch(M.beta=E.beta=this.beta,this.cameraRigMode){case c.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case c.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case c.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case c.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case c.c.RIG_MODE_VR:M.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,E.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case c.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:M.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,E.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(M,E){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const x=g.m.Distance(M,E),k=this.va().getEngine().getAspectRatio(this),a=Math.tan(this.fov/2),n=a*k,J=.5*x*b,u=J*Math.sqrt(1+1/(n*n)),T=J*Math.sqrt(1+1/(a*a));return Math.max(u,T)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,x.d)([(0,k.E)()],P.prototype,"alpha",void 0),(0,x.d)([(0,k.E)()],P.prototype,"beta",void 0),(0,x.d)([(0,k.E)()],P.prototype,"i",void 0),(0,x.d)([(0,k.E)()],P.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,x.d)([(0,k.C)("target")],P.prototype,"_target",void 0),(0,x.d)([(0,k.u)("targetHost")],P.prototype,"_targetHost",void 0),(0,x.d)([(0,k.E)()],P.prototype,"inertialAlphaOffset",void 0),(0,x.d)([(0,k.E)()],P.prototype,"inertialBetaOffset",void 0),(0,x.d)([(0,k.E)()],P.prototype,"inertialRadiusOffset",void 0),(0,x.d)([(0,k.E)()],P.prototype,"lowerAlphaLimit",void 0),(0,x.d)([(0,k.E)()],P.prototype,"upperAlphaLimit",void 0),(0,x.d)([(0,k.E)()],P.prototype,"lowerBetaLimit",void 0),(0,x.d)([(0,k.E)()],P.prototype,"upperBetaLimit",void 0),(0,x.d)([(0,k.E)()],P.prototype,"lowerRadiusLimit",void 0),(0,x.d)([(0,k.E)()],P.prototype,"upperRadiusLimit",void 0),(0,x.d)([(0,k.E)()],P.prototype,"inertialPanningX",void 0),(0,x.d)([(0,k.E)()],P.prototype,"inertialPanningY",void 0),(0,x.d)([(0,k.E)()],P.prototype,"pinchToPanMaxDistance",void 0),(0,x.d)([(0,k.E)()],P.prototype,"panningDistanceLimit",void 0),(0,x.d)([(0,k.C)()],P.prototype,"panningOriginTarget",void 0),(0,x.d)([(0,k.E)()],P.prototype,"panningInertia",void 0),(0,x.d)([(0,k.E)()],P.prototype,"zoomToMouseLocation",null),(0,x.d)([(0,k.E)()],P.prototype,"zoomOnFactor",void 0),(0,x.d)([(0,k.B)()],P.prototype,"targetScreenOffset",void 0),(0,x.d)([(0,k.E)()],P.prototype,"allowUpsideDown",void 0),(0,x.d)([(0,k.E)()],P.prototype,"useInputToRestoreState",void 0),(0,x.d)([(0,k.E)()],P.prototype,"restoreStateInterpolationFactor",void 0),(0,p.h)("BABYLON.ArcRotateCamera",P)},11548:(M,E,b)=>{"use strict";b.d(E,{c:()=>r});var x=b(948),k=b(953),a=b(1166),g=b(1176),n=b(962),J=b(970),u=b(11554),T=b(1060),V=b(989),I=b(1056),t=b(1521),y=b(1302),B=b(1124);class r extends u.d{get position(){return this._position}set position(M){this._position=M}set upVector(M){this._upVector=M}get upVector(){return this._upVector}get screenArea(){let M=0,E=0;if(this.mode===r.PERSPECTIVE_CAMERA)this.fovMode===r.FOVMODE_VERTICAL_FIXED?(E=2*this.bj*Math.tan(this.fov/2),M=this.getEngine().getAspectRatio(this)*E):(M=2*this.bj*Math.tan(this.fov/2),E=M/this.getEngine().getAspectRatio(this));else{const b=this.getEngine().getRenderWidth()/2,x=this.getEngine().getRenderHeight()/2;M=(this.orthoRight??b)-(this.orthoLeft??-b),E=(this.orthoTop??x)-(this.orthoBottom??-x)}return M*E}set orthoLeft(M){this._orthoLeft=M;for(const E of this._rigCameras)E.orthoLeft=M}get orthoLeft(){return this._orthoLeft}set orthoRight(M){this._orthoRight=M;for(const E of this._rigCameras)E.orthoRight=M}get orthoRight(){return this._orthoRight}set orthoBottom(M){this._orthoBottom=M;for(const E of this._rigCameras)E.orthoBottom=M}get orthoBottom(){return this._orthoBottom}set orthoTop(M){this._orthoTop=M;for(const E of this._rigCameras)E.orthoTop=M}get orthoTop(){return this._orthoTop}set mode(M){this._mode=M;for(const E of this._rigCameras)E.mode=M}get mode(){return this._mode}get hasMoved(){return this._hasMoved}constructor(M,E,b){let x=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];super(M,b,!1),this._position=J.m.Zero(),this._upVector=J.m.Up(),this.oblique=null,this._orthoLeft=null,this._orthoRight=null,this._orthoBottom=null,this._orthoTop=null,this.fov=.8,this.projectionPlaneTilt=0,this.bj=1,this.maxZ=1e4,this.inertia=.9,this._mode=r.PERSPECTIVE_CAMERA,this.isIntermediate=!1,this.viewport=new t.c(0,0,1,1),this.layerMask=268435455,this.fovMode=r.FOVMODE_VERTICAL_FIXED,this.cameraRigMode=r.RIG_MODE_NONE,this.customRenderTargets=[],this.outputRenderTarget=null,this.onViewMatrixChangedObservable=new n.b,this.onProjectionMatrixChangedObservable=new n.b,this.onAfterCheckInputsObservable=new n.b,this.onRestoreStateObservable=new n.b,this.isRigCamera=!1,this._hasMoved=!1,this._rigCameras=new Array,this._skipRendering=!1,this._projectionMatrix=new J.d,this._postProcesses=new Array,this._activeMeshes=new a.f(256),this._globalPosition=J.m.Zero(),this._computedViewMatrix=J.d.Identity(),this._doNotComputeProjectionMatrix=!1,this._transformMatrix=J.d.Zero(),this._refreshFrustumPlanes=!0,this._absoluteRotation=J.e.Identity(),this._isCamera=!0,this._isLeftCamera=!1,this._isRightCamera=!1,this.va().addCamera(this),x&&!this.va().activeCamera&&(this.va().activeCamera=this),this.position=E,this.renderPassId=this.va().getEngine().createRenderPassId(`Camera ${M}`)}storeState(){return this._stateStored=!0,this._storedFov=this.fov,this}hasStateStored(){return!!this._stateStored}_restoreStateValues(){return!!this._stateStored&&(this.fov=this._storedFov,!0)}restoreState(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)}getClassName(){return"Lh"}toString(M){let E="Name: "+this.name;if(E+=", type: "+this.getClassName(),this.animations)for(let b=0;b<this.animations.length;b++)E+=", animation[0]: "+this.animations[b].toString(M);return E}applyVerticalCorrection(){const M=this.absoluteRotation.toEulerAngles();this.projectionPlaneTilt=this._scene.useRightHandedSystem?-M.x:M.x}get globalPosition(){return this._globalPosition}getActiveMeshes(){return this._activeMeshes}isActiveMesh(M){return-1!==this._activeMeshes.indexOf(M)}isReady(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(M)for(const E of this._postProcesses)if(E&&!E.isReady())return!1;return super.isReady(M)}_initCache(){super._initCache(),this._cache.position=new J.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new J.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.bj=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.obliqueAngle=void 0,this._cache.obliqueLength=void 0,this._cache.obliqueOffset=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0}_updateCache(M){M||super._updateCache(),this._cache.position.p(this.position),this._cache.upVector.p(this.upVector)}_isSynchronized(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()}_isSynchronizedViewMatrix(){return!!super._isSynchronized()&&(this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent())}_isSynchronizedProjectionMatrix(){let M=this._cache.mode===this.mode&&this._cache.bj===this.bj&&this._cache.maxZ===this.maxZ;if(!M)return!1;const E=this.getEngine();return this.mode===r.PERSPECTIVE_CAMERA?M=this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===E.getAspectRatio(this)&&this._cache.projectionPlaneTilt===this.projectionPlaneTilt:(M=this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===E.getRenderWidth()&&this._cache.renderHeight===E.getRenderHeight(),this.oblique&&(M=M&&this._cache.obliqueAngle===this.oblique.angle&&this._cache.obliqueLength===this.oblique.length&&this._cache.obliqueOffset===this.oblique.offset)),M}attachControl(M,E){}Ce(M){}update(){this._hasMoved=!1,this._checkInputs(),this.cameraRigMode!==r.RIG_MODE_NONE&&this._updateRigCameras(),this.getViewMatrix(),this.getProjectionMatrix()}_checkInputs(){this.onAfterCheckInputsObservable.notifyObservers(this)}get rigCameras(){return this._rigCameras}get rigPostProcess(){return this._rigPostProcess}_getFirstPostProcess(){for(let M=0;M<this._postProcesses.length;M++)if(null!==this._postProcesses[M])return this._postProcesses[M];return null}_cascadePostProcessesToRigCams(){const M=this._getFirstPostProcess();M&&M.markTextureDirty();for(let E=0,b=this._rigCameras.length;E<b;E++){const M=this._rigCameras[E],b=M._rigPostProcess;if(b){"pass"===b.getEffectName()&&(M.isIntermediate=0===this._postProcesses.length),M._postProcesses=this._postProcesses.slice(0).concat(b),b.markTextureDirty()}else M._postProcesses=this._postProcesses.slice(0)}}attachPostProcess(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return!M.isReusable()&&this._postProcesses.indexOf(M)>-1?(T.d.Error("You're trying to reuse a post process not defined as reusable."),0):(null==E||E<0?this._postProcesses.push(M):null===this._postProcesses[E]?this._postProcesses[E]=M:this._postProcesses.splice(E,0,M),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.ge(),this._postProcesses.indexOf(M))}detachPostProcess(M){const E=this._postProcesses.indexOf(M);-1!==E&&(this._postProcesses[E]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.ge(),this._cascadePostProcessesToRigCams()}getWorldMatrix(){return this._isSynchronizedViewMatrix()||this.getViewMatrix(),this._worldMatrix}_getViewMatrix(){return J.d.Identity()}getViewMatrix(M){return!M&&this._isSynchronizedViewMatrix()||(this._hasMoved=!0,this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.va().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix)),this._computedViewMatrix}freezeProjectionMatrix(M){this._doNotComputeProjectionMatrix=!0,void 0!==M&&(this._projectionMatrix=M)}unfreezeProjectionMatrix(){this._doNotComputeProjectionMatrix=!1}getProjectionMatrix(M){if(this._doNotComputeProjectionMatrix||!M&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.bj=this.bj,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;const E=this.getEngine(),b=this.va(),x=E.useReverseDepthBuffer;if(this.mode===r.PERSPECTIVE_CAMERA){let M;this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=E.getAspectRatio(this),this._cache.projectionPlaneTilt=this.projectionPlaneTilt,this.bj<=0&&(this.bj=.1),M=b.useRightHandedSystem?J.d.PerspectiveFovRHToRef:J.d.PerspectiveFovLHToRef,M(this.fov,E.getAspectRatio(this),x?this.maxZ:this.bj,x?this.bj:this.maxZ,this._projectionMatrix,this.fovMode===r.FOVMODE_VERTICAL_FIXED,E.isNDCHalfZRange,this.projectionPlaneTilt,x)}else{var k,a,g;const M=E.getRenderWidth()/2,n=E.getRenderHeight()/2;b.useRightHandedSystem?this.oblique?J.d.ObliqueOffCenterRHToRef(this.orthoLeft??-M,this.orthoRight??M,this.orthoBottom??-n,this.orthoTop??n,x?this.maxZ:this.bj,x?this.bj:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,E.isNDCHalfZRange):J.d.OrthoOffCenterRHToRef(this.orthoLeft??-M,this.orthoRight??M,this.orthoBottom??-n,this.orthoTop??n,x?this.maxZ:this.bj,x?this.bj:this.maxZ,this._projectionMatrix,E.isNDCHalfZRange):this.oblique?J.d.ObliqueOffCenterLHToRef(this.orthoLeft??-M,this.orthoRight??M,this.orthoBottom??-n,this.orthoTop??n,x?this.maxZ:this.bj,x?this.bj:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,E.isNDCHalfZRange):J.d.OrthoOffCenterLHToRef(this.orthoLeft??-M,this.orthoRight??M,this.orthoBottom??-n,this.orthoTop??n,x?this.maxZ:this.bj,x?this.bj:this.maxZ,this._projectionMatrix,E.isNDCHalfZRange),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.obliqueAngle=null===(k=this.oblique)||void 0===k?void 0:k.angle,this._cache.obliqueLength=null===(a=this.oblique)||void 0===a?void 0:a.length,this._cache.obliqueOffset=null===(g=this.oblique)||void 0===g?void 0:g.offset,this._cache.renderWidth=E.getRenderWidth(),this._cache.renderHeight=E.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix}getTransformationMatrix(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix}_computeObliqueDistance(M){return(this.i||(this.target?J.m.Distance(this.position,this.target):this.position.length()))+M}_updateFrustumPlanes(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?y.d.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=y.d.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)}isInFrustum(M){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._updateFrustumPlanes(),E&&this.rigCameras.length>0){let E=!1;return this.rigCameras.forEach((b=>{b._updateFrustumPlanes(),E=E||M.isInFrustum(b._frustumPlanes)})),E}return M.isInFrustum(this._frustumPlanes)}isCompletelyInFrustum(M){return this._updateFrustumPlanes(),M.isCompletelyInFrustum(this._frustumPlanes)}getForwardRay(){throw(0,I.b)("Ray")}getForwardRayToRef(M){throw(0,I.b)("Ray")}dispose(M){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.va().stopAnimation(this),this.va().removeCamera(this);this._rigCameras.length>0;){const M=this._rigCameras.pop();M&&M.dispose()}if(this._parentContainer){const M=this._parentContainer.cameras.indexOf(this);M>-1&&this._parentContainer.cameras.splice(M,1),this._parentContainer=null}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses.length=0;else if(this.cameraRigMode!==r.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses.length=0;else{let M=this._postProcesses.length;for(;--M>=0;){const E=this._postProcesses[M];E&&E.dispose(this)}}let b=this.customRenderTargets.length;for(;--b>=0;)this.customRenderTargets[b].dispose();this.customRenderTargets.length=0,this._activeMeshes.dispose(),this.va().getEngine().releaseRenderPassId(this.renderPassId),super.dispose(M,E)}get isLeftCamera(){return this._isLeftCamera}get isRightCamera(){return this._isRightCamera}get leftCamera(){return this._rigCameras.length<1?null:this._rigCameras[0]}get rightCamera(){return this._rigCameras.length<2?null:this._rigCameras[1]}getLeftTarget(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()}getRightTarget(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()}setCameraRigMode(M,E){if(this.cameraRigMode!==M){for(;this._rigCameras.length>0;){const M=this._rigCameras.pop();M&&M.dispose()}if(this.cameraRigMode=M,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=E.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=g.e.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==r.RIG_MODE_NONE){const M=this.createRigCamera(this.name+"_L",0);M&&(M._isLeftCamera=!0);const E=this.createRigCamera(this.name+"_R",1);E&&(E._isRightCamera=!0),M&&E&&(this._rigCameras.push(M),this._rigCameras.push(E))}this._setRigMode(E),this._cascadePostProcessesToRigCams(),this.update()}}_setRigMode(M){}_getVRProjectionMatrix(){return J.d.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.bj,this.maxZ,this._cameraRigParams.vrWorkMatrix,!0,this.getEngine().isNDCHalfZRange),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix}setCameraRigParameter(M,E){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[M]=E,"interaxialDistance"===M&&(this._cameraRigParams.stereoHalfAngle=g.e.ToRadians(E/.0637))}createRigCamera(M,E){return null}_updateRigCameras(){for(let M=0;M<this._rigCameras.length;M++)this._rigCameras[M].bj=this.bj,this._rigCameras[M].maxZ=this.maxZ,this._rigCameras[M].fov=this.fov,this._rigCameras[M].upVector.p(this.upVector);this.cameraRigMode===r.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)}_setupInputs(){}serialize(){const M=B.b.Serialize(this);return M.uniqueId=this.uniqueId,M.type=this.getClassName(),this.parent&&this.parent._serializeAsParent(M),this.inputs&&this.inputs.serialize(M),B.b.AppendSerializedAnimations(this,M),M.ranges=this.serializeAnimationRanges(),M.isEnabled=this.isEnabled(),M}clone(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const b=B.b.Clone(r.GetConstructorFromName(this.getClassName(),M,this.va(),this.interaxialDistance,this.isStereoscopicSideBySide),this);return b.name=M,b.parent=E,this.onClonedObservable.notifyObservers(b),b}hf(M){const E=J.m.Zero();return this.getDirectionToRef(M,E),E}get absoluteRotation(){return this.getWorldMatrix().decompose(void 0,this._absoluteRotation),this._absoluteRotation}getDirectionToRef(M,E){J.m.TransformNormalToRef(M,this.getWorldMatrix(),E)}static GetConstructorFromName(M,E,b){let x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,k=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const a=u.d.Construct(M,E,b,{interaxial_distance:x,isStereoscopicSideBySide:k});return a||(()=>r._CreateDefaultParsedCamera(E,b))}ce(){return this.getWorldMatrix()}static Parse(M,E){const b=M.type,x=r.GetConstructorFromName(b,M.name,E,M.interaxial_distance,M.isStereoscopicSideBySide),k=B.b.Parse(x,M,E);if(void 0!==M.parentId&&(k._waitingParentId=M.parentId),void 0!==M.parentInstanceIndex&&(k._waitingParentInstanceIndex=M.parentInstanceIndex),k.inputs&&(k.inputs.parse(M),k._setupInputs()),M.upVector&&(k.upVector=J.m.Id(M.upVector)),k.setPosition&&(k.position.Hd(0,0,0),k.setPosition(J.m.Id(M.position))),M.target&&k.setTarget&&k.setTarget(J.m.Id(M.target)),M.cameraRigMode){const E=M.interaxial_distance?{interaxialDistance:M.interaxial_distance}:{};k.setCameraRigMode(M.cameraRigMode,E)}if(M.animations){for(let E=0;E<M.animations.length;E++){const b=M.animations[E],x=(0,V.e)("BABYLON.Animation");x&&k.animations.push(x.Parse(b))}u.d.ParseAnimationRanges(k,M,E)}return M.autoAnimate&&E.beginAnimation(k,M.autoAnimateFrom,M.autoAnimateTo,M.autoAnimateLoop,M.autoAnimateSpeed||1),void 0!==M.isEnabled&&k.wg(M.isEnabled),k}_calculateHandednessMultiplier(){let M=this.va().useRightHandedSystem?-1:1;return this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(M*=-1),M}}r._CreateDefaultParsedCamera=(M,E)=>{throw(0,I.b)("UniversalCamera")},r.PERSPECTIVE_CAMERA=0,r.ORTHOGRAPHIC_CAMERA=1,r.FOVMODE_VERTICAL_FIXED=0,r.FOVMODE_HORIZONTAL_FIXED=1,r.RIG_MODE_NONE=0,r.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,r.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,r.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,r.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,r.RIG_MODE_STEREOSCOPIC_INTERLACED=14,r.RIG_MODE_VR=20,r.RIG_MODE_CUSTOM=22,r.ForceAttachControlToAlwaysPreventDefault=!1,(0,x.d)([(0,k.C)("position")],r.prototype,"_position",void 0),(0,x.d)([(0,k.C)("upVector")],r.prototype,"_upVector",void 0),(0,x.d)([(0,k.E)()],r.prototype,"orthoLeft",null),(0,x.d)([(0,k.E)()],r.prototype,"orthoRight",null),(0,x.d)([(0,k.E)()],r.prototype,"orthoBottom",null),(0,x.d)([(0,k.E)()],r.prototype,"orthoTop",null),(0,x.d)([(0,k.E)()],r.prototype,"fov",void 0),(0,x.d)([(0,k.E)()],r.prototype,"projectionPlaneTilt",void 0),(0,x.d)([(0,k.E)()],r.prototype,"bj",void 0),(0,x.d)([(0,k.E)()],r.prototype,"maxZ",void 0),(0,x.d)([(0,k.E)()],r.prototype,"inertia",void 0),(0,x.d)([(0,k.E)()],r.prototype,"mode",null),(0,x.d)([(0,k.E)()],r.prototype,"layerMask",void 0),(0,x.d)([(0,k.E)()],r.prototype,"fovMode",void 0),(0,x.d)([(0,k.E)()],r.prototype,"cameraRigMode",void 0),(0,x.d)([(0,k.E)()],r.prototype,"interaxialDistance",void 0),(0,x.d)([(0,k.E)()],r.prototype,"isStereoscopicSideBySide",void 0)},12109:(M,E,b)=>{"use strict";b.d(E,{e:()=>g,g:()=>n});var x=b(1060),k=b(1124),a=b(11548),g={};class n{constructor(M){this.attachedToElement=!1,this.attached={},this.camera=M,this.checkInputs=()=>{}}add(M){const E=M.getSimpleName();this.attached[E]?x.d.Warn("camera input of type "+E+" already exists on camera"):(this.attached[E]=M,M.camera=this.camera,M.checkInputs&&(this.checkInputs=this._addCheckInputs(M.checkInputs.bind(M))),this.attachedToElement&&M.attachControl(this.noPreventDefault))}remove(M){for(const E in this.attached){const b=this.attached[E];if(b===M)return b.Ce(),b.camera=null,delete this.attached[E],void this.rebuildInputCheck()}}removeByType(M){for(const E in this.attached){const b=this.attached[E];b.getClassName()===M&&(b.Ce(),b.camera=null,delete this.attached[E],this.rebuildInputCheck())}}_addCheckInputs(M){const E=this.checkInputs;return()=>{E(),M()}}attachInput(M){this.attachedToElement&&M.attachControl(this.noPreventDefault)}attachElement(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){M=!a.c.ForceAttachControlToAlwaysPreventDefault&&M,this.attachedToElement=!0,this.noPreventDefault=M;for(const E in this.attached)this.attached[E].attachControl(M)}}detachElement(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const E in this.attached)this.attached[E].Ce(),M&&(this.attached[E].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const M in this.attached){const E=this.attached[M];E.checkInputs&&(this.checkInputs=this._addCheckInputs(E.checkInputs.bind(E)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(M){const E={};for(const b in this.attached){const M=this.attached[b],x=k.b.Serialize(M);E[M.getClassName()]=x}M.inputsmgr=E}parse(M){const E=M.inputsmgr;if(E){this.clear();for(const M in E){const b=g[M];if(b){const x=E[M],a=k.b.Parse((()=>new b),x,null);this.add(a)}}}else for(const b in this.attached){const E=g[this.attached[b].getClassName()];if(E){const x=k.b.Parse((()=>new E),M,null);this.remove(this.attached[b]),this.add(x)}}}}},12098:(M,E,b)=>{"use strict";b.d(E,{c:()=>X});var x=b(948),k=b(953),a=b(970),g=b(12106),n=b(12109),J=b(1276),u=b(1176);class T{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(M){M=u.e.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((E=>{const b=E.event;if(!b.metaKey)if(E.type===J.e.KEYDOWN){if(-1!==this.keysUp.indexOf(b.keyCode)||-1!==this.keysDown.indexOf(b.keyCode)||-1!==this.keysLeft.indexOf(b.keyCode)||-1!==this.keysRight.indexOf(b.keyCode)||-1!==this.keysUpward.indexOf(b.keyCode)||-1!==this.keysDownward.indexOf(b.keyCode)||-1!==this.keysRotateLeft.indexOf(b.keyCode)||-1!==this.keysRotateRight.indexOf(b.keyCode)||-1!==this.keysRotateUp.indexOf(b.keyCode)||-1!==this.keysRotateDown.indexOf(b.keyCode)){-1===this._keys.indexOf(b.keyCode)&&this._keys.push(b.keyCode),M||b.preventDefault()}}else if(-1!==this.keysUp.indexOf(b.keyCode)||-1!==this.keysDown.indexOf(b.keyCode)||-1!==this.keysLeft.indexOf(b.keyCode)||-1!==this.keysRight.indexOf(b.keyCode)||-1!==this.keysUpward.indexOf(b.keyCode)||-1!==this.keysDownward.indexOf(b.keyCode)||-1!==this.keysRotateLeft.indexOf(b.keyCode)||-1!==this.keysRotateRight.indexOf(b.keyCode)||-1!==this.keysRotateUp.indexOf(b.keyCode)||-1!==this.keysRotateDown.indexOf(b.keyCode)){const E=this._keys.indexOf(b.keyCode);E>=0&&this._keys.splice(E,1),M||b.preventDefault()}})))}Ce(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const M=this.camera;for(let E=0;E<this._keys.length;E++){const b=this._keys[E],x=M._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(b)?M._localDirection.Hd(-x,0,0):-1!==this.keysUp.indexOf(b)?M._localDirection.Hd(0,0,x):-1!==this.keysRight.indexOf(b)?M._localDirection.Hd(x,0,0):-1!==this.keysDown.indexOf(b)?M._localDirection.Hd(0,0,-x):-1!==this.keysUpward.indexOf(b)?M._localDirection.Hd(0,x,0):-1!==this.keysDownward.indexOf(b)?M._localDirection.Hd(0,-x,0):-1!==this.keysRotateLeft.indexOf(b)?(M._localDirection.Hd(0,0,0),M.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(b)?(M._localDirection.Hd(0,0,0),M.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(b)?(M._localDirection.Hd(0,0,0),M.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(b)&&(M._localDirection.Hd(0,0,0),M.cameraRotation.x+=this._getLocalRotation()),M.va().useRightHandedSystem&&(M._localDirection.z*=-1),M.getViewMatrix().invertToRef(M._cameraTransformMatrix),a.m.TransformNormalToRef(M._localDirection,M._cameraTransformMatrix,M._transformedDirection),M.cameraDirection.addInPlace(M._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const M=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*M}}(0,x.d)([(0,k.E)()],T.prototype,"keysUp",void 0),(0,x.d)([(0,k.E)()],T.prototype,"keysUpward",void 0),(0,x.d)([(0,k.E)()],T.prototype,"keysDown",void 0),(0,x.d)([(0,k.E)()],T.prototype,"keysDownward",void 0),(0,x.d)([(0,k.E)()],T.prototype,"keysLeft",void 0),(0,x.d)([(0,k.E)()],T.prototype,"keysRight",void 0),(0,x.d)([(0,k.E)()],T.prototype,"rotationSpeed",void 0),(0,x.d)([(0,k.E)()],T.prototype,"keysRotateLeft",void 0),(0,x.d)([(0,k.E)()],T.prototype,"keysRotateRight",void 0),(0,x.d)([(0,k.E)()],T.prototype,"keysRotateUp",void 0),(0,x.d)([(0,k.E)()],T.prototype,"keysRotateDown",void 0),n.e.FreeCameraKeyboardMoveInput=T;var V=b(962),I=b(1269);class t{constructor(){let M=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=M,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new V.b,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(M){M=u.e.BackCompatCameraNoPreventDefault(arguments);const E=this.camera.getEngine(),b=E.getInputElement();this._pointerInput||(this._pointerInput=x=>{const k=x.event,a="touch"===k.pointerType;if(!this.touchEnabled&&a)return;if(x.type!==I.d.POINTERMOVE&&-1===this.buttons.indexOf(k.button))return;const g=k.target;if(x.type===I.d.POINTERDOWN){if(a&&-1!==this._activePointerId||!a&&-1!==this._currentActiveButton)return;this._activePointerId=k.pointerId;try{null===g||void 0===g||g.setPointerCapture(k.pointerId)}catch(n){}-1===this._currentActiveButton&&(this._currentActiveButton=k.button),this._previousPosition={x:k.clientX,y:k.clientY},M||(k.preventDefault(),b&&b.focus()),E.isPointerLock&&this._onMouseMove&&this._onMouseMove(x.event)}else if(x.type===I.d.POINTERUP){if(a&&this._activePointerId!==k.pointerId||!a&&this._currentActiveButton!==k.button)return;try{null===g||void 0===g||g.releasePointerCapture(k.pointerId)}catch(n){}this._currentActiveButton=-1,this._previousPosition=null,M||k.preventDefault(),this._activePointerId=-1}else if(x.type===I.d.POINTERMOVE&&(this._activePointerId===k.pointerId||!a))if(E.isPointerLock&&this._onMouseMove)this._onMouseMove(x.event);else if(this._previousPosition){const E=this.camera._calculateHandednessMultiplier(),b=(k.clientX-this._previousPosition.x)*E,x=k.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=b/this.angularSensibility,this.camera.cameraRotation.x+=x/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:b,offsetY:x}),this._previousPosition={x:k.clientX,y:k.clientY},M||k.preventDefault()}}),this._onMouseMove=b=>{if(!E.isPointerLock)return;const x=this.camera._calculateHandednessMultiplier(),k=b.movementX*x;this.camera.cameraRotation.y+=k/this.angularSensibility;const a=b.movementY;this.camera.cameraRotation.x+=a/this.angularSensibility,this._previousPosition=null,M||b.preventDefault()},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,I.d.POINTERDOWN|I.d.POINTERUP|I.d.POINTERMOVE),b&&(this._contextMenuBind=M=>this.onContextMenu(M),b.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(M){M.preventDefault()}Ce(){if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const M=this.camera.getEngine().getInputElement();M&&M.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,x.d)([(0,k.E)()],t.prototype,"buttons",void 0),(0,x.d)([(0,k.E)()],t.prototype,"angularSensibility",void 0),n.e.FreeCameraMouseInput=t;var y,B=b(1285);class r{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new V.b,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(M){M=u.e.BackCompatCameraNoPreventDefault(arguments),this._wheel=E=>{if(E.type!==I.d.POINTERWHEEL)return;const b=E.event,x=b.deltaMode===B.b.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*x*b.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*x*b.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*x*b.deltaZ/this._normalize,b.preventDefault&&(M||b.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,I.d.POINTERWHEEL)}Ce(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,x.d)([(0,k.E)()],r.prototype,"wheelPrecisionX",void 0),(0,x.d)([(0,k.E)()],r.prototype,"wheelPrecisionY",void 0),(0,x.d)([(0,k.E)()],r.prototype,"wheelPrecisionZ",void 0),function(M){M[M.MoveRelative=0]="MoveRelative",M[M.RotateRelative=1]="RotateRelative",M[M.MoveScene=2]="MoveScene"}(y||(y={}));class c extends r{constructor(){super(...arguments),this._moveRelative=a.m.Zero(),this._rotateRelative=a.m.Zero(),this._moveScene=a.m.Zero(),this._wheelXAction=y.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=y.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(M){null===M&&this._wheelXAction!==y.MoveRelative||(this._wheelXAction=y.MoveRelative,this._wheelXActionCoordinate=M)}get wheelXMoveRelative(){return this._wheelXAction!==y.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(M){null===M&&this._wheelYAction!==y.MoveRelative||(this._wheelYAction=y.MoveRelative,this._wheelYActionCoordinate=M)}get wheelYMoveRelative(){return this._wheelYAction!==y.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(M){null===M&&this._wheelZAction!==y.MoveRelative||(this._wheelZAction=y.MoveRelative,this._wheelZActionCoordinate=M)}get wheelZMoveRelative(){return this._wheelZAction!==y.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(M){null===M&&this._wheelXAction!==y.RotateRelative||(this._wheelXAction=y.RotateRelative,this._wheelXActionCoordinate=M)}get wheelXRotateRelative(){return this._wheelXAction!==y.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(M){null===M&&this._wheelYAction!==y.RotateRelative||(this._wheelYAction=y.RotateRelative,this._wheelYActionCoordinate=M)}get wheelYRotateRelative(){return this._wheelYAction!==y.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(M){null===M&&this._wheelZAction!==y.RotateRelative||(this._wheelZAction=y.RotateRelative,this._wheelZActionCoordinate=M)}get wheelZRotateRelative(){return this._wheelZAction!==y.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(M){null===M&&this._wheelXAction!==y.MoveScene||(this._wheelXAction=y.MoveScene,this._wheelXActionCoordinate=M)}get wheelXMoveScene(){return this._wheelXAction!==y.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(M){null===M&&this._wheelYAction!==y.MoveScene||(this._wheelYAction=y.MoveScene,this._wheelYActionCoordinate=M)}get wheelYMoveScene(){return this._wheelYAction!==y.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(M){null===M&&this._wheelZAction!==y.MoveScene||(this._wheelZAction=y.MoveScene,this._wheelZActionCoordinate=M)}get wheelZMoveScene(){return this._wheelZAction!==y.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.Kd(0),this._rotateRelative.Kd(0),this._moveScene.Kd(0),this._updateCamera(),this.camera.va().useRightHandedSystem&&(this._moveRelative.z*=-1);const M=a.d.Zero();this.camera.getViewMatrix().invertToRef(M);const E=a.m.Zero();a.m.TransformNormalToRef(this._moveRelative,M,E),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(E),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(M,E,b){if(0===M)return;if(null===E||null===b)return;let x=null;switch(E){case y.MoveRelative:x=this._moveRelative;break;case y.RotateRelative:x=this._rotateRelative;break;case y.MoveScene:x=this._moveScene}switch(b){case 0:x.set(M,0,0);break;case 1:x.set(0,M,0);break;case 2:x.set(0,0,M)}}}(0,x.d)([(0,k.E)()],c.prototype,"wheelXMoveRelative",null),(0,x.d)([(0,k.E)()],c.prototype,"wheelYMoveRelative",null),(0,x.d)([(0,k.E)()],c.prototype,"wheelZMoveRelative",null),(0,x.d)([(0,k.E)()],c.prototype,"wheelXRotateRelative",null),(0,x.d)([(0,k.E)()],c.prototype,"wheelYRotateRelative",null),(0,x.d)([(0,k.E)()],c.prototype,"wheelZRotateRelative",null),(0,x.d)([(0,k.E)()],c.prototype,"wheelXMoveScene",null),(0,x.d)([(0,k.E)()],c.prototype,"wheelYMoveScene",null),(0,x.d)([(0,k.E)()],c.prototype,"wheelZMoveScene",null),n.e.FreeCameraMouseWheelInput=c;class C{constructor(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=M,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=u.e.IsSafari()}attachControl(M){M=u.e.BackCompatCameraNoPreventDefault(arguments);let E=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=b=>{const x=b.event,k="mouse"===x.pointerType||this._isSafari&&"undefined"===typeof x.pointerType;if(this.allowMouse||!k)if(b.type===I.d.POINTERDOWN){if(M||x.preventDefault(),this._pointerPressed.push(x.pointerId),1!==this._pointerPressed.length)return;E={x:x.clientX,y:x.clientY}}else if(b.type===I.d.POINTERUP){M||x.preventDefault();const b=this._pointerPressed.indexOf(x.pointerId);if(-1===b)return;if(this._pointerPressed.splice(b,1),0!=b)return;E=null,this._offsetX=null,this._offsetY=null}else if(b.type===I.d.POINTERMOVE){if(M||x.preventDefault(),!E)return;if(0!=this._pointerPressed.indexOf(x.pointerId))return;this._offsetX=x.clientX-E.x,this._offsetY=-(x.clientY-E.y)}}),this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,I.d.POINTERDOWN|I.d.POINTERUP|I.d.POINTERMOVE),this._onLostFocus){const M=this.camera.getEngine().getInputElement();M&&M.addEventListener("blur",this._onLostFocus)}}Ce(){if(this._pointerInput){if(this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const M=this.camera.getEngine().getInputElement();M&&M.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const M=this.camera,E=M._calculateHandednessMultiplier();M.cameraRotation.y=E*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)M.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const E=M._computeLocalCameraSpeed(),b=new a.m(0,0,0!==this.touchMoveSensibility?E*this._offsetY/this.touchMoveSensibility:0);a.d.RotationYawPitchRollToRef(M.rotation.y,M.rotation.x,0,M._cameraRotationMatrix),M.cameraDirection.addInPlace(a.m.TransformCoordinates(b,M._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,x.d)([(0,k.E)()],C.prototype,"touchAngularSensibility",void 0),(0,x.d)([(0,k.E)()],C.prototype,"touchMoveSensibility",void 0),n.e.FreeCameraTouchInput=C;class R extends n.g{constructor(M){super(M),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new T),this}addMouse(){let M=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new t(M),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new c,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new C),this}clear(){super.clear(),this._mouseInput=null}}var w=b(989),S=b(1073);class X extends g.c{get angularSensibility(){const M=this.inputs.attached.mouse;return M?M.angularSensibility:0}set angularSensibility(M){const E=this.inputs.attached.mouse;E&&(E.angularSensibility=M)}get keysUp(){const M=this.inputs.attached.keyboard;return M?M.keysUp:[]}set keysUp(M){const E=this.inputs.attached.keyboard;E&&(E.keysUp=M)}get keysUpward(){const M=this.inputs.attached.keyboard;return M?M.keysUpward:[]}set keysUpward(M){const E=this.inputs.attached.keyboard;E&&(E.keysUpward=M)}get keysDown(){const M=this.inputs.attached.keyboard;return M?M.keysDown:[]}set keysDown(M){const E=this.inputs.attached.keyboard;E&&(E.keysDown=M)}get keysDownward(){const M=this.inputs.attached.keyboard;return M?M.keysDownward:[]}set keysDownward(M){const E=this.inputs.attached.keyboard;E&&(E.keysDownward=M)}get keysLeft(){const M=this.inputs.attached.keyboard;return M?M.keysLeft:[]}set keysLeft(M){const E=this.inputs.attached.keyboard;E&&(E.keysLeft=M)}get keysRight(){const M=this.inputs.attached.keyboard;return M?M.keysRight:[]}set keysRight(M){const E=this.inputs.attached.keyboard;E&&(E.keysRight=M)}get keysRotateLeft(){const M=this.inputs.attached.keyboard;return M?M.keysRotateLeft:[]}set keysRotateLeft(M){const E=this.inputs.attached.keyboard;E&&(E.keysRotateLeft=M)}get keysRotateRight(){const M=this.inputs.attached.keyboard;return M?M.keysRotateRight:[]}set keysRotateRight(M){const E=this.inputs.attached.keyboard;E&&(E.keysRotateRight=M)}get keysRotateUp(){const M=this.inputs.attached.keyboard;return M?M.keysRotateUp:[]}set keysRotateUp(M){const E=this.inputs.attached.keyboard;E&&(E.keysRotateUp=M)}get keysRotateDown(){const M=this.inputs.attached.keyboard;return M?M.keysRotateDown:[]}set keysRotateDown(M){const E=this.inputs.attached.keyboard;E&&(E.keysRotateDown=M)}constructor(M,E,b){var x;super(M,E,b,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),x=this,this.ellipsoid=new a.m(.5,1,.5),this.ellipsoidOffset=new a.m(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=a.m.Zero(),this._diffPosition=a.m.Zero(),this._newPosition=a.m.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(M,E){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;x._newPosition.p(E),x._newPosition.subtractToRef(x._oldPosition,x._diffPosition),x._diffPosition.length()>S.c.CollisionsEpsilon&&(x.position.addToRef(x._diffPosition,x._deferredPositionUpdate),x._deferOnly?x._deferredUpdated=!0:x.position.p(x._deferredPositionUpdate),x.Fk&&b&&x.Fk(b))},this.inputs=new R(this),this.inputs.addKeyboard().addMouse()}attachControl(M,E){E=u.e.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(E)}Ce(){this.inputs.detachElement(),this.cameraDirection=new a.m(0,0,0),this.cameraRotation=new a.l(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(M){this._collisionMask=isNaN(M)?-1:M}_collideWithWorld(M){let E;E=this.parent?a.m.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,E.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const b=this.va().collisionCoordinator;this._collider||(this._collider=b.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let x=M;this.applyGravity&&(x=M.add(this.va().gravity)),b.getNewPosition(this._oldPosition,x,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=a.m.Zero(),this._transformedDirection=a.m.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(M){this._needMoveForGravity=M}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.va().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"hb"}}(0,x.d)([(0,k.C)()],X.prototype,"ellipsoid",void 0),(0,x.d)([(0,k.C)()],X.prototype,"ellipsoidOffset",void 0),(0,x.d)([(0,k.E)()],X.prototype,"checkCollisions",void 0),(0,x.d)([(0,k.E)()],X.prototype,"applyGravity",void 0),(0,w.h)("BABYLON.FreeCamera",X)},12106:(M,E,b)=>{"use strict";b.d(E,{c:()=>u});var x=b(948),k=b(953),a=b(11548),g=b(970),n=b(977),J=b(1512);b(11554).d.AddNodeConstructor("TargetCamera",((M,E)=>()=>new u(M,g.m.Zero(),E)));class u extends a.c{constructor(M,E,b){super(M,E,b,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),this._tmpUpVector=g.m.Zero(),this._tmpTargetVector=g.m.Zero(),this.cameraDirection=new g.m(0,0,0),this.cameraRotation=new g.l(0,0),this.ignoreParentScaling=!1,this.updateUpVectorFromRotation=!1,this._tmpQuaternion=new g.e,this.rotation=new g.m(0,0,0),this.speed=2,this.noRotationConstraint=!1,this.invertRotation=!1,this.inverseRotationSpeed=.2,this.lockedTarget=null,this._currentTarget=g.m.Zero(),this._initialFocalDistance=1,this._viewMatrix=g.d.Zero(),this._camMatrix=g.d.Zero(),this._cameraTransformMatrix=g.d.Zero(),this._cameraRotationMatrix=g.d.Zero(),this._referencePoint=new g.m(0,0,1),this._transformedReferencePoint=g.m.Zero(),this._deferredPositionUpdate=new g.m,this._deferredRotationQuaternionUpdate=new g.e,this._deferredRotationUpdate=new g.m,this._deferredUpdated=!1,this._deferOnly=!1,this._defaultUp=g.m.Up(),this._cachedRotationZ=0,this._cachedQuaternionRotationZ=0}getFrontPosition(M){this.getWorldMatrix();const E=this.getTarget().Qc(this.position);return E.normalize(),E.scaleInPlace(M),this.globalPosition.add(E)}_getLockedTargetPosition(){if(!this.lockedTarget)return null;if(this.lockedTarget.absolutePosition){const M=this.lockedTarget;M.ce().getTranslationToRef(M.absolutePosition)}return this.lockedTarget.absolutePosition||this.lockedTarget}storeState(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),super.storeState()}_restoreStateValues(){return!!super._restoreStateValues()&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.Hd(0,0,0),this.cameraRotation.Hd(0,0),!0)}_initCache(){super._initCache(),this._cache.lockedTarget=new g.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new g.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new g.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}_updateCache(M){M||super._updateCache();const E=this._getLockedTargetPosition();E?this._cache.lockedTarget?this._cache.lockedTarget.p(E):this._cache.lockedTarget=E.clone():this._cache.lockedTarget=null,this._cache.rotation.p(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.p(this.rotationQuaternion)}_isSynchronizedViewMatrix(){if(!super._isSynchronizedViewMatrix())return!1;const M=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(M):!M)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))}_computeLocalCameraSpeed(){const M=this.getEngine();return this.speed*Math.sqrt(M.getDeltaTime()/(100*M.getFps()))}setTarget(M){this.upVector.normalize(),this._initialFocalDistance=M.Qc(this.position).length(),this.position.z===M.z&&(this.position.z+=n.b),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),g.d.LookAtLHToRef(this.position,M,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);const E=M.Qc(this.position);E.x>=0?this.rotation.y=-Math.atan(E.z/E.x)+Math.PI/2:this.rotation.y=-Math.atan(E.z/E.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&g.e.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)}get target(){return this.getTarget()}set target(M){this.setTarget(M)}getTarget(){return this._currentTarget}_decideIfNeedsToMove(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(g.i.Matrix[0]),g.m.TransformNormalToRef(this.cameraDirection,g.i.Matrix[0],g.i.Fd[0]),this._deferredPositionUpdate.addInPlace(g.i.Fd[0]),void(this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate));this._deferredPositionUpdate.addInPlace(this.cameraDirection),this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate)}_checkInputs(){const M=this.invertRotation?-this.inverseRotationSpeed:1,E=this._decideIfNeedsToMove(),b=this.cameraRotation.x||this.cameraRotation.y;if(this._deferredUpdated=!1,this._deferredRotationUpdate.p(this.rotation),this._deferredPositionUpdate.p(this.position),this.rotationQuaternion&&this._deferredRotationQuaternionUpdate.p(this.rotationQuaternion),E&&this._updatePosition(),b){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this._deferredRotationUpdate),this._deferredRotationUpdate.x+=this.cameraRotation.x*M,this._deferredRotationUpdate.y+=this.cameraRotation.y*M,!this.noRotationConstraint){const M=1.570796;this._deferredRotationUpdate.x>M&&(this._deferredRotationUpdate.x=M),this._deferredRotationUpdate.x<-M&&(this._deferredRotationUpdate.x=-M)}if(this._deferOnly?this._deferredUpdated=!0:this.rotation.p(this._deferredRotationUpdate),this.rotationQuaternion){this._deferredRotationUpdate.lengthSquared()&&(g.e.RotationYawPitchRollToRef(this._deferredRotationUpdate.y,this._deferredRotationUpdate.x,this._deferredRotationUpdate.z,this._deferredRotationQuaternionUpdate),this._deferOnly?this._deferredUpdated=!0:this.rotationQuaternion.p(this._deferredRotationQuaternionUpdate))}}E&&(Math.abs(this.cameraDirection.x)<this.speed*n.b&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*n.b&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*n.b&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),b&&(Math.abs(this.cameraRotation.x)<this.speed*n.b&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*n.b&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),super._checkInputs()}_updateCameraRotationMatrix(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):g.d.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)}_rotateUpVectorWithCameraRotationMatrix(){return g.m.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this}_getViewMatrix(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),g.m.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?J.d.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(g.e.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),J.d.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix}_computeViewMatrix(M,E,b){if(this.ignoreParentScaling){if(this.parent){const x=this.parent.getWorldMatrix();g.m.TransformCoordinatesToRef(M,x,this._globalPosition),g.m.TransformCoordinatesToRef(E,x,this._tmpTargetVector),g.m.TransformNormalToRef(b,x,this._tmpUpVector),this._markSyncedWithParent()}else this._globalPosition.p(M),this._tmpTargetVector.p(E),this._tmpUpVector.p(b);this.va().useRightHandedSystem?g.d.LookAtRHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix):g.d.LookAtLHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix)}else if(this.va().useRightHandedSystem?g.d.LookAtRHToRef(M,E,b,this._viewMatrix):g.d.LookAtLHToRef(M,E,b,this._viewMatrix),this.parent){const M=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(M,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.p(M)}createRigCamera(M,E){if(this.cameraRigMode!==a.c.RIG_MODE_NONE){const E=new u(M,this.position.clone(),this.va());return E.isRigCamera=!0,E.rigParent=this,this.cameraRigMode===a.c.RIG_MODE_VR&&(this.rotationQuaternion||(this.rotationQuaternion=new g.e),E._cameraRigParams={},E.rotationQuaternion=new g.e),E.mode=this.mode,E.orthoLeft=this.orthoLeft,E.orthoRight=this.orthoRight,E.orthoTop=this.orthoTop,E.orthoBottom=this.orthoBottom,E}return null}_updateRigCameras(){const M=this._rigCameras[0],E=this._rigCameras[1];switch(this.ce(),this.cameraRigMode){case a.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case a.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case a.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case a.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case a.c.RIG_MODE_STEREOSCOPIC_INTERLACED:{const b=this.cameraRigMode===a.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,x=this.cameraRigMode===a.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*b,M),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*x,E);break}case a.c.RIG_MODE_VR:M.rotationQuaternion?(M.rotationQuaternion.p(this.rotationQuaternion),E.rotationQuaternion.p(this.rotationQuaternion)):(M.rotation.p(this.rotation),E.rotation.p(this.rotation)),M.position.p(this.position),E.position.p(this.position)}super._updateRigCameras()}_getRigCamPositionAndTarget(M,E){this.getTarget().subtractToRef(this.position,u._TargetFocalPoint),u._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);const b=u._TargetFocalPoint.addInPlace(this.position);g.d.TranslationToRef(-b.x,-b.y,-b.z,u._TargetTransformMatrix),u._TargetTransformMatrix.multiplyToRef(g.d.RotationAxis(E.upVector,M),u._RigCamTransformMatrix),g.d.TranslationToRef(b.x,b.y,b.z,u._TargetTransformMatrix),u._RigCamTransformMatrix.multiplyToRef(u._TargetTransformMatrix,u._RigCamTransformMatrix),g.m.TransformCoordinatesToRef(this.position,u._RigCamTransformMatrix,E.position),E.setTarget(b)}getClassName(){return"TargetCamera"}}u._RigCamTransformMatrix=new g.d,u._TargetTransformMatrix=new g.d,u._TargetFocalPoint=new g.m,(0,x.d)([(0,k.C)()],u.prototype,"rotation",void 0),(0,x.d)([(0,k.E)()],u.prototype,"speed",void 0),(0,x.d)([(0,k.u)("lockedTargetId")],u.prototype,"lockedTarget",void 0)},12574:(M,E,b)=>{"use strict";b.d(E,{d:()=>a});var x=b(1166),k=b(12579);class a{constructor(M,E){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=b,this.zi=[],this._maxBlockCapacity=E||64,this._selectionContent=new x.c(1024),this._creationFunc=M}update(M,E,b){k.c._CreateBlocks(M,E,b,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}Le(M){for(let E=0;E<this.Rh.length;E++){this.Rh[E].addEntry(M)}}Me(M){for(let E=0;E<this.Rh.length;E++){this.Rh[E].removeEntry(M)}}select(M,E){this._selectionContent.reset();for(let b=0;b<this.Rh.length;b++){this.Rh[b].select(M,this._selectionContent,E)}return E?this._selectionContent.concat(this.zi):this._selectionContent.concatWithNoDuplicate(this.zi),this._selectionContent}intersects(M,E,b){this._selectionContent.reset();for(let x=0;x<this.Rh.length;x++){this.Rh[x].intersects(M,E,this._selectionContent,b)}return b?this._selectionContent.concat(this.zi):this._selectionContent.concatWithNoDuplicate(this.zi),this._selectionContent}intersectsRay(M){this._selectionContent.reset();for(let E=0;E<this.Rh.length;E++){this.Rh[E].intersectsRay(M,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.zi),this._selectionContent}}a.CreationFuncForMeshes=(M,E)=>{const b=M.getBoundingInfo();!M.isBlocked&&b.boundingBox.intersectsMinMax(E.Di,E.Ei)&&E.entries.push(M)},a.CreationFuncForSubMeshes=(M,E)=>{M.getBoundingInfo().boundingBox.intersectsMinMax(E.Di,E.Ei)&&E.entries.push(M)}},12579:(M,E,b)=>{"use strict";b.d(E,{c:()=>a});var x=b(970),k=b(1352);class a{constructor(M,E,b,x,k,a){this.entries=[],this.Fi=new Array,this._capacity=b,this._depth=x,this._maxDepth=k,this._creationFunc=a,this._minPoint=M,this._maxPoint=E,this.Fi.push(M.clone()),this.Fi.push(E.clone()),this.Fi.push(M.clone()),this.Fi[2].x=E.x,this.Fi.push(M.clone()),this.Fi[3].y=E.y,this.Fi.push(M.clone()),this.Fi[4].z=E.z,this.Fi.push(E.clone()),this.Fi[5].z=M.z,this.Fi.push(E.clone()),this.Fi[6].x=M.x,this.Fi.push(E.clone()),this.Fi[7].y=M.y}get Dd(){return this._capacity}get Di(){return this._minPoint}get Ei(){return this._maxPoint}addEntry(M){if(this.Rh)for(let E=0;E<this.Rh.length;E++){this.Rh[E].addEntry(M)}else this._creationFunc(M,this),this.entries.length>this.Dd&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(M){if(this.Rh){for(let E=0;E<this.Rh.length;E++){this.Rh[E].removeEntry(M)}return}const E=this.entries.indexOf(M);E>-1&&this.entries.splice(E,1)}addEntries(M){for(let E=0;E<M.length;E++){const b=M[E];this.addEntry(b)}}select(M,E,b){if(k.e.IsInFrustum(this.Fi,M)){if(this.Rh){for(let x=0;x<this.Rh.length;x++){this.Rh[x].select(M,E,b)}return}b?E.concat(this.entries):E.concatWithNoDuplicate(this.entries)}}intersects(M,E,b,x){if(k.e.IntersectsSphere(this._minPoint,this._maxPoint,M,E)){if(this.Rh){for(let k=0;k<this.Rh.length;k++){this.Rh[k].intersects(M,E,b,x)}return}x?b.concat(this.entries):b.concatWithNoDuplicate(this.entries)}}intersectsRay(M,E){if(M.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.Rh){for(let b=0;b<this.Rh.length;b++){this.Rh[b].intersectsRay(M,E)}return}E.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){a._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(M,E,b,k,g,n,J,u){J.Rh=new Array;const T=new x.m((E.x-M.x)/2,(E.y-M.y)/2,(E.z-M.z)/2);for(let x=0;x<2;x++)for(let E=0;E<2;E++)for(let V=0;V<2;V++){const I=M.add(T.multiplyByFloats(x,E,V)),t=M.add(T.multiplyByFloats(x+1,E+1,V+1)),y=new a(I,t,k,g+1,n,u);y.addEntries(b),J.Rh.push(y)}}}},12584:(M,E,b)=>{"use strict";b.d(E,{b:()=>T});var x=b(1171),k=b(970),a=b(11569),g=b(11726),n=b(1260),J=b(12574),u=b(1005);x.d.prototype.createOrUpdateSelectionOctree=function(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,b=this._getComponent(n.c.NAME_OCTREE);b||(b=new T(this),this.Ie(b)),this.xi||(this.xi=new J.d(J.d.CreationFuncForMeshes,M,E));const x=this.getWorldExtends();return this.xi.update(x.min,x.max,this.meshes),this.xi},Object.defineProperty(x.d.prototype,"selectionOctree",{get:function(){return this.xi},enumerable:!0,configurable:!0}),a.d.prototype.createOrUpdateSubmeshesOctree=function(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const b=this.va();let x=b._getComponent(n.c.NAME_OCTREE);x||(x=new T(b),b.Ie(x)),this._submeshesOctree||(this._submeshesOctree=new J.d(J.d.CreationFuncForSubMeshes,M,E)),this.ce(!0);const k=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(k.minimumWorld,k.maximumWorld,this.Td),this._submeshesOctree};class T{constructor(M){this.name=n.c.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new g.e(k.m.Zero(),new k.m(1,1,1)),(M=M||u.b.LastCreatedScene)&&(this.Ae=M,this.Ae.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.Ae.getActiveSubMeshCandidates=M=>this.getActiveSubMeshCandidates(M),this.Ae.getCollidingSubMeshCandidates=(M,E)=>this.getCollidingSubMeshCandidates(M,E),this.Ae.getIntersectingSubMeshCandidates=(M,E)=>this.getIntersectingSubMeshCandidates(M,E))}register(){this.Ae.onMeshRemovedObservable.add((M=>{const E=this.Ae.selectionOctree;if(void 0!==E&&null!==E){const b=E.zi.indexOf(M);-1!==b&&E.zi.splice(b,1)}})),this.Ae.onMeshImportedObservable.add((M=>{const E=this.Ae.selectionOctree;void 0!==E&&null!==E&&E.Le(M)}))}getActiveMeshCandidates(){var M;return(null===(M=this.Ae.xi)||void 0===M?void 0:M.select(this.Ae.frustumPlanes))||this.Ae._getDefaultMeshCandidates()}getActiveSubMeshCandidates(M){if(M._submeshesOctree&&M.useOctreeForRenderingSelection){return M._submeshesOctree.select(this.Ae.frustumPlanes)}return this.Ae._getDefaultSubMeshCandidates(M)}getIntersectingSubMeshCandidates(M,E){if(M._submeshesOctree&&M.useOctreeForPicking){g.e.TransformToRef(E,M.getWorldMatrix(),this._tempRay);return M._submeshesOctree.intersectsRay(this._tempRay)}return this.Ae._getDefaultSubMeshCandidates(M)}getCollidingSubMeshCandidates(M,E){if(M._submeshesOctree&&M.useOctreeForCollisions){const b=E._velocityWorldLength+Math.max(E._radius.x,E._radius.y,E._radius.z);return M._submeshesOctree.intersects(E._basePointWorld,b)}return this.Ae._getDefaultSubMeshCandidates(M)}rebuild(){}dispose(){}}},11726:(M,E,b)=>{"use strict";b.d(E,{e:()=>t});var x=b(1171),k=b(11548),a=b(977),g=b(970),n=b(985),J=b(1337),u=b(1222),T=b(1005),V=b(1291);const I={internalPickerForMesh:void 0};class t{constructor(M,E){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:a.b;this.origin=M,this.direction=E,this.length=b,this.epsilon=x}clone(){return new t(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(M,E){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const x=t._TmpVector3[0].Hd(M.x-b,M.y-b,M.z-b),k=t._TmpVector3[1].Hd(E.x+b,E.y+b,E.z+b);let a,g,n,J,u=0,T=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<x.x||this.origin.x>k.x)return!1}else if(a=1/this.direction.x,g=(x.x-this.origin.x)*a,n=(k.x-this.origin.x)*a,n===-1/0&&(n=1/0),g>n&&(J=g,g=n,n=J),u=Math.max(g,u),T=Math.min(n,T),u>T)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<x.y||this.origin.y>k.y)return!1}else if(a=1/this.direction.y,g=(x.y-this.origin.y)*a,n=(k.y-this.origin.y)*a,n===-1/0&&(n=1/0),g>n&&(J=g,g=n,n=J),u=Math.max(g,u),T=Math.min(n,T),u>T)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<x.z||this.origin.z>k.z)return!1}else if(a=1/this.direction.z,g=(x.z-this.origin.z)*a,n=(k.z-this.origin.z)*a,n===-1/0&&(n=1/0),g>n&&(J=g,g=n,n=J),u=Math.max(g,u),T=Math.min(n,T),u>T)return!1;return!0}intersectsBox(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(M.minimum,M.maximum,E)}intersectsSphere(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const b=M.center.x-this.origin.x,x=M.center.y-this.origin.y,k=M.center.z-this.origin.z,a=b*b+x*x+k*k,g=M.i+E,n=g*g;if(a<=n)return!0;const J=b*this.direction.x+x*this.direction.y+k*this.direction.z;if(J<0)return!1;return a-J*J<=n}intersectsTriangle(M,E,b){const x=t._TmpVector3[0],k=t._TmpVector3[1],a=t._TmpVector3[2],n=t._TmpVector3[3],u=t._TmpVector3[4];E.subtractToRef(M,x),b.subtractToRef(M,k),g.m.CrossToRef(this.direction,k,a);const T=g.m.Dot(x,a);if(0===T)return null;const V=1/T;this.origin.subtractToRef(M,n);const I=g.m.Dot(n,a)*V;if(I<-this.epsilon||I>1+this.epsilon)return null;g.m.CrossToRef(n,x,u);const y=g.m.Dot(this.direction,u)*V;if(y<-this.epsilon||I+y>1+this.epsilon)return null;const B=g.m.Dot(k,u)*V;return B>this.length?null:new J.b(1-I-y,I,B)}intersectsPlane(M){let E;const b=g.m.Dot(M.de,this.direction);if(Math.abs(b)<9.99999997475243e-7)return null;{const x=g.m.Dot(M.de,this.origin);return E=(-M.d-x)/b,E<0?E<-9.99999997475243e-7?null:0:E}}intersectsAxis(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(M){case"y":{const M=(this.origin.y-E)/this.direction.y;return M>0?null:new g.m(this.origin.x+this.direction.x*-M,E,this.origin.z+this.direction.z*-M)}case"x":{const M=(this.origin.x-E)/this.direction.x;return M>0?null:new g.m(E,this.origin.y+this.direction.y*-M,this.origin.z+this.direction.z*-M)}case"z":{const M=(this.origin.z-E)/this.direction.z;return M>0?null:new g.m(this.origin.x+this.direction.x*-M,this.origin.y+this.direction.y*-M,E)}default:return null}}intersectsMesh(M,E,b){let x=arguments.length>3&&void 0!==arguments[3]&&arguments[3],k=arguments.length>4?arguments[4]:void 0,a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const n=g.i.Matrix[0];return M.getWorldMatrix().invertToRef(n),this._tmpRay?t.TransformToRef(this,n,this._tmpRay):this._tmpRay=t.Transform(this,n),M.intersects(this._tmpRay,E,b,x,k,a)}intersectsMeshes(M,E,b){b?b.length=0:b=[];for(let x=0;x<M.length;x++){const k=this.intersectsMesh(M[x],E);k.hit&&b.push(k)}return b.sort(this._comparePickingInfo),b}_comparePickingInfo(M,E){return M.distance<E.distance?-1:M.distance>E.distance?1:0}intersectionSegment(M,E,b){const x=this.origin,k=g.i.Fd[0],a=g.i.Fd[1],n=g.i.Fd[2],J=g.i.Fd[3];E.subtractToRef(M,k),this.direction.scaleToRef(t._Rayl,n),x.addToRef(n,a),M.subtractToRef(x,J);const u=g.m.Dot(k,k),T=g.m.Dot(k,n),V=g.m.Dot(n,n),I=g.m.Dot(k,J),y=g.m.Dot(n,J),B=u*V-T*T;let r,c,C=B,R=B;B<t._Smallnum?(r=0,C=1,c=y,R=V):(r=T*y-V*I,c=u*y-T*I,r<0?(r=0,c=y,R=V):r>C&&(r=C,c=y+T,R=V)),c<0?(c=0,-I<0?r=0:-I>u?r=C:(r=-I,C=u)):c>R&&(c=R,-I+T<0?r=0:-I+T>u?r=C:(r=-I+T,C=u));const w=Math.abs(r)<t._Smallnum?0:r/C,S=Math.abs(c)<t._Smallnum?0:c/R,X=g.i.Fd[4];n.scaleToRef(S,X);const U=g.i.Fd[5];k.scaleToRef(w,U),U.addInPlace(J);const v=g.i.Fd[6];U.subtractToRef(X,v);return S>0&&S<=this.length&&v.lengthSquared()<b*b?U.length():-1}update(M,E,b,x,k,a,n){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){t._RayDistant||(t._RayDistant=t.Zero()),t._RayDistant.unprojectRayToRef(M,E,b,x,g.d.IdentityReadOnly,a,n);const J=g.i.Matrix[0];k.invertToRef(J),t.TransformToRef(t._RayDistant,J,this)}else this.unprojectRayToRef(M,E,b,x,k,a,n);return this}static Zero(){return new t(g.m.Zero(),g.m.Zero())}static CreateNew(M,E,b,x,k,a,g){return t.Zero().update(M,E,b,x,k,a,g)}static CreateNewFromTo(M,E){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:g.d.IdentityReadOnly;const x=new t(new g.m(0,0,0),new g.m(0,0,0));return t.CreateFromToToRef(M,E,x,b)}static CreateFromToToRef(M,E,b){let x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:g.d.IdentityReadOnly;b.origin.p(M);const k=E.subtractToRef(M,b.direction),a=Math.sqrt(k.x*k.x+k.y*k.y+k.z*k.z);return b.length=a,b.direction.normalize(),t.TransformToRef(b,x,b)}static Transform(M,E){const b=new t(new g.m(0,0,0),new g.m(0,0,0));return t.TransformToRef(M,E,b),b}static TransformToRef(M,E,b){g.m.TransformCoordinatesToRef(M.origin,E,b.origin),g.m.TransformNormalToRef(M.direction,E,b.direction),b.length=M.length,b.epsilon=M.epsilon;const x=b.direction,k=x.length();if(0!==k&&1!==k){const M=1/k;x.x*=M,x.y*=M,x.z*=M,b.length*=k}return b}unprojectRayToRef(M,E,b,x,k,a,n){const J=g.i.Matrix[0];k.multiplyToRef(a,J),J.multiplyToRef(n,J),J.invert();const u=T.b.LastCreatedEngine,V=g.i.Fd[0];V.x=M/b*2-1,V.y=-(E/x*2-1),V.z=null!==u&&void 0!==u&&u.useReverseDepthBuffer?1:null!==u&&void 0!==u&&u.isNDCHalfZRange?0:-1;const I=g.i.Fd[1].Hd(V.x,V.y,1-1e-8),t=g.i.Fd[2],y=g.i.Fd[3];g.m._UnprojectFromInvertedMatrixToRef(V,J,t),g.m._UnprojectFromInvertedMatrixToRef(I,J,y),this.origin.p(t),y.subtractToRef(t,this.direction),this.direction.normalize()}}function y(M,E,b,x,k){let a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const g=t.Zero();return B(M,E,b,x,g,k,a),g}function B(M,E,b,x,k,a){let n=arguments.length>6&&void 0!==arguments[6]&&arguments[6],J=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const u=M.getEngine();if(!a&&!(a=M.activeCamera))return M;const T=a.viewport,V=u.getRenderHeight(),{x:I,y:t,width:y,height:B}=T.toGlobal(u.getRenderWidth(),V),r=1/u.getHardwareScalingLevel();return E=E*r-I,b=b*r-(V-t-B),k.update(E,b,y,B,x||g.d.IdentityReadOnly,n?g.d.IdentityReadOnly:a.getViewMatrix(),a.getProjectionMatrix(),J),M}function r(M,E,b,x,k){if(!u.b)return M;const a=M.getEngine();if(!k&&!(k=M.activeCamera))throw new Error("Active camera not set");const n=k.viewport,J=a.getRenderHeight(),{x:T,y:V,width:I,height:t}=n.toGlobal(a.getRenderWidth(),J),y=g.d.Identity(),B=1/a.getHardwareScalingLevel();return E=E*B-T,b=b*B-(J-V-t),x.update(E,b,I,t,y,y,k.getProjectionMatrix()),M}function c(M,E,b,x,k,a,g,n){const J=E(x,b.enableDistantPicking),u=b.intersects(J,k,g,a,x,n);return u&&u.hit?!k&&null!=M&&u.distance>=M.distance?null:u:null}function C(M,E,b,x,k,a){let n=null;const J=!!(M.activeCameras&&M.activeCameras.length>1&&M.cameraToUseForPointers!==M.activeCamera),T=M.cameraToUseForPointers||M.activeCamera,V=I.internalPickerForMesh||c;for(let u=0;u<M.meshes.length;u++){const I=M.meshes[u];if(b){if(!b(I,-1))continue}else if(!I.isEnabled()||!I.isVisible||!I.Be)continue;const t=J&&I.isWorldMatrixCameraDependent(),y=I.ce(t,T);if(I.hasThinInstances&&I.thinInstanceEnablePicking){const M=V(n,E,I,y,!0,!0,a);if(M){if(k)return M;const J=g.i.Matrix[1],u=I.thinInstanceGetWorldMatrices();for(let M=0;M<u.length;M++){if(b&&!b(I,M))continue;u[M].multiplyToRef(y,J);const g=V(n,E,I,J,x,k,a,!0);if(g&&(n=g,n.thinInstanceIndex=M,x))return n}}}else{const M=V(n,E,I,y,x,k,a);if(M&&(n=M,x))return n}}return n||new u.b}function R(M,E,b,x){if(!u.b)return null;const k=[],a=!!(M.activeCameras&&M.activeCameras.length>1&&M.cameraToUseForPointers!==M.activeCamera),n=M.cameraToUseForPointers||M.activeCamera,J=I.internalPickerForMesh||c;for(let u=0;u<M.meshes.length;u++){const T=M.meshes[u];if(b){if(!b(T,-1))continue}else if(!T.isEnabled()||!T.isVisible||!T.Be)continue;const V=a&&T.isWorldMatrixCameraDependent(),I=T.ce(V,n);if(T.hasThinInstances&&T.thinInstanceEnablePicking){if(J(null,E,T,I,!0,!0,x)){const M=g.i.Matrix[1],a=T.thinInstanceGetWorldMatrices();for(let g=0;g<a.length;g++){if(b&&!b(T,g))continue;a[g].multiplyToRef(I,M);const n=J(null,E,T,M,!1,!1,x,!0);n&&(n.thinInstanceIndex=g,k.push(n))}}}else{const M=J(null,E,T,I,!1,!1,x);M&&k.push(M)}}return k}function w(M,E){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,x=arguments.length>3?arguments[3]:void 0,k=arguments.length>4?arguments[4]:void 0;x||(x=M.getWorldMatrix()),E.length=b,k?E.origin.p(k):E.origin.p(M.position);const a=g.i.Fd[2];a.set(0,0,M._scene.useRightHandedSystem?-1:1);const n=g.i.Fd[3];return g.m.TransformNormalToRef(a,x,n),g.m.NormalizeToRef(n,E.direction),E}var S,X;t._TmpVector3=(0,n.b)(6,g.m.Zero),t._RayDistant=t.Zero(),t._Smallnum=1e-8,t._Rayl=1e9,S=x.d,(X=k.c)&&(X.prototype.getForwardRay=function(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,E=arguments.length>1?arguments[1]:void 0,b=arguments.length>2?arguments[2]:void 0;return w(this,new t(g.m.Zero(),g.m.Zero(),M),M,E,b)},X.prototype.getForwardRayToRef=function(M){return w(this,M,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),S&&(V.c._IsPickingAvailable=!0,S.prototype.createPickingRay=function(M,E,b,x){return y(this,M,E,b,x,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),x.d.prototype.createPickingRayToRef=function(M,E,b,x,k){return B(this,M,E,b,x,k,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},x.d.prototype.createPickingRayInCameraSpace=function(M,E,b){return function(M,E,b,x){const k=t.Zero();return r(M,E,b,k,x),k}(this,M,E,b)},x.d.prototype.createPickingRayInCameraSpaceToRef=function(M,E,b,x){return r(this,M,E,b,x)},x.d.prototype.pickWithBoundingInfo=function(M,E,b,x,k){return function(M,E,b,x,k,a){if(!u.b)return null;const n=C(M,(x=>(M._tempPickingRay||(M._tempPickingRay=t.Zero()),B(M,E,b,x,M._tempPickingRay,a||null),M._tempPickingRay)),x,k,!0);return n&&(n.ray=y(M,E,b,g.d.Identity(),a||null)),n}(this,M,E,b,x,k)},x.d.prototype.Pc=function(M,E,b,x,k,a){return function(M,E,b,x,k,a,n){const J=C(M,((x,k)=>(M._tempPickingRay||(M._tempPickingRay=t.Zero()),B(M,E,b,x,M._tempPickingRay,a||null,!1,k),M._tempPickingRay)),x,k,!1,n);return J&&(J.ray=y(M,E,b,g.d.Identity(),a||null)),J}(this,M,E,b,x,k,a)},x.d.prototype.pickWithRay=function(M,E,b,x){return function(M,E,b,x,k){const a=C(M,(b=>(M._pickWithRayInverseMatrix||(M._pickWithRayInverseMatrix=g.d.Identity()),b.invertToRef(M._pickWithRayInverseMatrix),M._cachedRayForTransform||(M._cachedRayForTransform=t.Zero()),t.TransformToRef(E,M._pickWithRayInverseMatrix,M._cachedRayForTransform),M._cachedRayForTransform)),b,x,!1,k);return a&&(a.ray=E),a}(this,M,E,b,x)},x.d.prototype.multiPick=function(M,E,b,x,k){return function(M,E,b,x,k,a){return R(M,(x=>y(M,E,b,x,k||null)),x,a)}(this,M,E,b,x,k)},x.d.prototype.multiPickWithRay=function(M,E,b){return function(M,E,b,x){return R(M,(b=>(M._pickWithRayInverseMatrix||(M._pickWithRayInverseMatrix=g.d.Identity()),b.invertToRef(M._pickWithRayInverseMatrix),M._cachedRayForTransform||(M._cachedRayForTransform=t.Zero()),t.TransformToRef(E,M._pickWithRayInverseMatrix,M._cachedRayForTransform),M._cachedRayForTransform)),b,x)}(this,M,E,b)}},12591:(M,E,b)=>{"use strict";b(1060);var x=b(1425);b(1104),b(1236),b(998),b(1487),b(1442);x.e},11396:(M,E,b)=>{"use strict";b.r(E),b.d(E,{SceneInstrumentation:()=>a});var x=b(1176),k=b(1300);class a{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(M){M!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=M,M?(this._onBeforeActiveMeshesEvaluationObserver=this.Ae.onBeforeActiveMeshesEvaluationObservable.add((()=>{x.e.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.Ae.onAfterActiveMeshesEvaluationObservable.add((()=>{x.e.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.Ae.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Ae.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(M){M!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=M,M?(this._onBeforeRenderTargetsRenderObserver=this.Ae.onBeforeRenderTargetsRenderObservable.add((()=>{x.e.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.Ae.onAfterRenderTargetsRenderObservable.add((()=>{x.e.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.Ae.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Ae.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(M){M!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=M,M?(this._onBeforeParticlesRenderingObserver=this.Ae.onBeforeParticlesRenderingObservable.add((()=>{x.e.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.Ae.onAfterParticlesRenderingObservable.add((()=>{x.e.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.Ae.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Ae.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(M){M!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=M,this.Ae.spriteManagers&&(M?(this._onBeforeSpritesRenderingObserver=this.Ae.onBeforeSpritesRenderingObservable.add((()=>{x.e.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.Ae.onAfterSpritesRenderingObservable.add((()=>{x.e.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.Ae.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.Ae.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(M){M!==this._capturePhysicsTime&&this.Ae.onBeforePhysicsObservable&&(this._capturePhysicsTime=M,M?(this._onBeforePhysicsObserver=this.Ae.onBeforePhysicsObservable.add((()=>{x.e.StartPerformanceCounter("ib"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.Ae.onAfterPhysicsObservable.add((()=>{x.e.EndPerformanceCounter("ib"),this._physicsTime.endMonitoring()}))):(this.Ae.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.Ae.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(M){M!==this._captureAnimationsTime&&(this._captureAnimationsTime=M,M?this._onAfterAnimationsObserver=this.Ae.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.Ae.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(M){this._captureFrameTime=M}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(M){this._captureInterFrameTime=M}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(M){M!==this._captureRenderTime&&(this._captureRenderTime=M,M?(this._onBeforeDrawPhaseObserver=this.Ae.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),x.e.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.Ae.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),x.e.EndPerformanceCounter("Main render")}))):(this.Ae.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Ae.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(M){M!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=M,M?(this._onBeforeCameraRenderObserver=this.Ae.onBeforeCameraRenderObservable.add((M=>{this._cameraRenderTime.beginMonitoring(),x.e.StartPerformanceCounter(`Rendering camera ${M.name}`)})),this._onAfterCameraRenderObserver=this.Ae.onAfterCameraRenderObservable.add((M=>{this._cameraRenderTime.endMonitoring(!1),x.e.EndPerformanceCounter(`Rendering camera ${M.name}`)}))):(this.Ae.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Ae.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.Ae.getEngine()._drawCalls}constructor(M){this.Ae=M,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new k.c,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new k.c,this._captureFrameTime=!1,this._frameTime=new k.c,this._captureRenderTime=!1,this._renderTime=new k.c,this._captureInterFrameTime=!1,this._interFrameTime=new k.c,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new k.c,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new k.c,this._capturePhysicsTime=!1,this._physicsTime=new k.c,this._captureAnimationsTime=!1,this._animationsTime=new k.c,this._captureCameraRenderTime=!1,this._cameraRenderTime=new k.c,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._onBeforeAnimationsObserver=M.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(x.e.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.Ae.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=M.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(x.e.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.Qd(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.Qd(),this._captureParticlesRenderTime&&this._particlesRenderTime.Qd(),this._captureSpritesRenderTime&&this._spritesRenderTime.Qd(),this._captureRenderTime&&this._renderTime.Qd(),this._captureCameraRenderTime&&this._cameraRenderTime.Qd()}))}dispose(){this.Ae.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.Ae.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Ae.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.Ae.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Ae.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.Ae.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.Ae.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Ae.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.Ae.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.Ae.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.Ae.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Ae.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.Ae.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.Ae.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.Ae.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.Ae.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Ae.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.Ae=null}}},12187:(M,E,b)=>{"use strict";b.d(E,{d:()=>T});var x=b(948),k=b(953),a=b(970),g=b(11554),n=b(12152),J=b(12194),u=b(989);g.d.AddNodeConstructor("Light_Type_1",((M,E)=>()=>new T(M,a.m.Zero(),E)));class T extends J.b{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(M){this._shadowFrustumSize=M,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(M){this._shadowOrthoScale=M,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(M){this._orthoLeft=M}get orthoRight(){return this._orthoRight}set orthoRight(M){this._orthoRight=M}get orthoTop(){return this._orthoTop}set orthoTop(M){this._orthoTop=M}get orthoBottom(){return this._orthoBottom}set orthoBottom(M){this._orthoBottom=M}constructor(M,E,b){super(M,b),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=E.scale(-1),this.direction=E}getClassName(){return"kb"}getTypeID(){return n.e.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(M,E,b){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(M):this._setDefaultAutoExtendShadowProjectionMatrix(M,E,b)}_setDefaultFixedFrustumShadowProjectionMatrix(M){const E=this.va().activeCamera;E&&a.d.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:E.bj,void 0!==this.shadowMaxZ?this.shadowMaxZ:E.maxZ,M,this.va().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(M,E,b){const x=this.va().activeCamera;if(!x)return;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const M=a.m.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let x=Number.MAX_VALUE,k=-Number.MAX_VALUE;for(let g=0;g<b.length;g++){const n=b[g];if(!n)continue;const J=n.getBoundingInfo().boundingBox;for(let b=0;b<J.vectorsWorld.length;b++)a.m.TransformCoordinatesToRef(J.vectorsWorld[b],E,M),M.x<this._orthoLeft&&(this._orthoLeft=M.x),M.y<this._orthoBottom&&(this._orthoBottom=M.y),M.x>this._orthoRight&&(this._orthoRight=M.x),M.y>this._orthoTop&&(this._orthoTop=M.y),this.autoCalcShadowZBounds&&(M.z<x&&(x=M.z),M.z>k&&(k=M.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=x,this._shadowMaxZ=k)}const k=this._orthoRight-this._orthoLeft,g=this._orthoTop-this._orthoBottom,n=void 0!==this.shadowMinZ?this.shadowMinZ:x.bj,J=void 0!==this.shadowMaxZ?this.shadowMaxZ:x.maxZ,u=this.va().getEngine().useReverseDepthBuffer;a.d.OrthoOffCenterLHToRef(this._orthoLeft-k*this.shadowOrthoScale,this._orthoRight+k*this.shadowOrthoScale,this._orthoBottom-g*this.shadowOrthoScale,this._orthoTop+g*this.shadowOrthoScale,u?J:n,u?n:J,M,this.va().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(M,E){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,E),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,E),this)}transferToNodeMaterialEffect(M,E){return this.computeTransformedInformation()?(M.setFloat3(E,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(M.setFloat3(E,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(M){const E=this._scene.getEngine();return!E.useReverseDepthBuffer&&E.isNDCHalfZRange?0:1}getDepthMaxZ(M){const E=this._scene.getEngine();return E.useReverseDepthBuffer&&E.isNDCHalfZRange?0:1}prepareLightSpecificDefines(M,E){M["DIRLIGHT"+E]=!0}}(0,x.d)([(0,k.E)()],T.prototype,"shadowFrustumSize",null),(0,x.d)([(0,k.E)()],T.prototype,"shadowOrthoScale",null),(0,x.d)([(0,k.E)()],T.prototype,"autoUpdateExtends",void 0),(0,x.d)([(0,k.E)()],T.prototype,"autoCalcShadowZBounds",void 0),(0,x.d)([(0,k.E)("orthoLeft")],T.prototype,"_orthoLeft",void 0),(0,x.d)([(0,k.E)("orthoRight")],T.prototype,"_orthoRight",void 0),(0,x.d)([(0,k.E)("orthoTop")],T.prototype,"_orthoTop",void 0),(0,x.d)([(0,k.E)("orthoBottom")],T.prototype,"_orthoBottom",void 0),(0,u.h)("BABYLON.DirectionalLight",T)},12501:(M,E,b)=>{"use strict";b.d(E,{d:()=>T});var x=b(948),k=b(953),a=b(970),g=b(1133),n=b(11554),J=b(12152),u=b(989);n.d.AddNodeConstructor("Light_Type_3",((M,E)=>()=>new T(M,a.m.Zero(),E)));class T extends J.e{constructor(M,E,b){super(M,b),this.groundColor=new g.e(0,0,0),this.direction=E||a.m.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"mb"}setDirectionToTarget(M){return this.direction=a.m.Normalize(M.Qc(a.m.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(M,E){const b=a.m.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",b.x,b.y,b.z,0,E),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.fj),E),this}transferToNodeMaterialEffect(M,E){const b=a.m.Normalize(this.direction);return M.setFloat3(E,b.x,b.y,b.z),this}ce(){return this._worldMatrix||(this._worldMatrix=a.d.Identity()),this._worldMatrix}getTypeID(){return J.e.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(M,E){M["HEMILIGHT"+E]=!0}}(0,x.d)([(0,k.m)()],T.prototype,"groundColor",void 0),(0,x.d)([(0,k.C)()],T.prototype,"direction",void 0),(0,u.h)("BABYLON.HemisphericLight",T)},12152:(M,E,b)=>{"use strict";b.d(E,{e:()=>I});var x=b(948),k=b(953),a=b(970),g=b(1133),n=b(11554),J=b(1217),u=b(989),T=b(1313),V=b(1124);class I extends n.d{get range(){return this._range}set range(M){this._range=M,this._inverseSquaredRange=1/(this.range*this.range)}get intensityMode(){return this._intensityMode}set intensityMode(M){this._intensityMode=M,this._computePhotometricScale()}get i(){return this._radius}set i(M){this._radius=M,this._computePhotometricScale()}get shadowEnabled(){return this._shadowEnabled}set shadowEnabled(M){this._shadowEnabled!==M&&(this._shadowEnabled=M,this._markMeshesAsLightDirty())}get includedOnlyMeshes(){return this._includedOnlyMeshes}set includedOnlyMeshes(M){this._includedOnlyMeshes=M,this._hookArrayForIncludedOnly(M)}get excludedMeshes(){return this._excludedMeshes}set excludedMeshes(M){this._excludedMeshes=M,this._hookArrayForExcluded(M)}get excludeWithLayerMask(){return this._excludeWithLayerMask}set excludeWithLayerMask(M){this._excludeWithLayerMask=M,this._resyncMeshes()}get includeOnlyWithLayerMask(){return this._includeOnlyWithLayerMask}set includeOnlyWithLayerMask(M){this._includeOnlyWithLayerMask=M,this._resyncMeshes()}get lightmapMode(){return this._lightmapMode}set lightmapMode(M){this._lightmapMode!==M&&(this._lightmapMode=M,this._markMeshesAsLightDirty())}getViewMatrix(M){return null}getProjectionMatrix(M,E){return null}constructor(M,E){super(M,E,!1),this.Nh=new g.e(1,1,1),this.qe=new g.e(1,1,1),this.falloffType=I.FALLOFF_DEFAULT,this.fj=1,this._range=Number.MAX_VALUE,this._inverseSquaredRange=0,this._photometricScale=1,this._intensityMode=I.INTENSITYMODE_AUTOMATIC,this._radius=1e-5,this.renderPriority=0,this._shadowEnabled=!0,this._excludeWithLayerMask=0,this._includeOnlyWithLayerMask=0,this._lightmapMode=0,this._shadowGenerators=null,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,this._isLight=!0,this.va().addLight(this),this._uniformBuffer=new J.c(this.va().getEngine(),void 0,void 0,M),this._buildUniformLayout(),this.includedOnlyMeshes=[],this.excludedMeshes=[],this._resyncMeshes()}transferTexturesToEffect(M,E){return this}_bindLight(M,E,b,x){let k=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const a=M.toString();let n=!1;if(this._uniformBuffer.bindToEffect(b,"Light"+a),this._renderId!==E.getRenderId()||this._lastUseSpecular!==x||!this._uniformBuffer.useUbo){this._renderId=E.getRenderId(),this._lastUseSpecular=x;const M=this.getScaledIntensity();this.transferToEffect(b,a),this.Nh.scaleToRef(M,g.i.te[0]),this._uniformBuffer.updateColor4("vLightDiffuse",g.i.te[0],this.range,a),x&&(this.qe.scaleToRef(M,g.i.te[1]),this._uniformBuffer.updateColor4("vLightSpecular",g.i.te[1],this.i,a)),n=!0}if(this.transferTexturesToEffect(b,a),E.shadowsEnabled&&this.shadowEnabled&&k){const M=this.getShadowGenerator(E.activeCamera)??this.getShadowGenerator();M&&(M.bindShadowLight(a,b),n=!0)}n?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()}getClassName(){return"Light"}toString(M){let E="Name: "+this.name;if(E+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(let b=0;b<this.animations.length;b++)E+=", animation[0]: "+this.animations[b].toString(M);return E}_syncParentEnabledState(){super._syncParentEnabledState(),this.u()||this._resyncMeshes()}wg(M){super.wg(M),this._resyncMeshes()}getShadowGenerator(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===this._shadowGenerators?null:this._shadowGenerators.get(M)??null}getShadowGenerators(){return this._shadowGenerators}getAbsolutePosition(){return a.m.Zero()}canAffectMesh(M){return!M||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(M))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(M))&&((0===this.includeOnlyWithLayerMask||0!==(this.includeOnlyWithLayerMask&M.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&M.layerMask)))}dispose(M){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._shadowGenerators){const M=this._shadowGenerators.values();for(let E=M.next();!0!==E.done;E=M.next()){E.value.dispose()}this._shadowGenerators=null}if(this.va().stopAnimation(this),this._parentContainer){const M=this._parentContainer.lights.indexOf(this);M>-1&&this._parentContainer.lights.splice(M,1),this._parentContainer=null}for(const b of this.va().meshes)b._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.va().removeLight(this),super.dispose(M,E)}getTypeID(){return 0}getScaledIntensity(){return this._photometricScale*this.fj}clone(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const b=I.GetConstructorFromName(this.getTypeID(),M,this.va());if(!b)return null;const x=V.b.Clone(b,this);return M&&(x.name=M),E&&(x.parent=E),x.wg(this.isEnabled()),this.onClonedObservable.notifyObservers(x),x}serialize(){const M=V.b.Serialize(this);return M.uniqueId=this.uniqueId,M.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(M),this.excludedMeshes.length>0&&(M.excludedMeshesIds=[],this.excludedMeshes.forEach((E=>{M.excludedMeshesIds.push(E.id)}))),this.includedOnlyMeshes.length>0&&(M.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach((E=>{M.includedOnlyMeshesIds.push(E.id)}))),V.b.AppendSerializedAnimations(this,M),M.ranges=this.serializeAnimationRanges(),M.isEnabled=this.isEnabled(),M}static GetConstructorFromName(M,E,b){const x=n.d.Construct("Light_Type_"+M,E,b);return x||null}static Parse(M,E){const b=I.GetConstructorFromName(M.type,M.name,E);if(!b)return null;const x=V.b.Parse(b,M,E);if(M.excludedMeshesIds&&(x._excludedMeshesIds=M.excludedMeshesIds),M.includedOnlyMeshesIds&&(x._includedOnlyMeshesIds=M.includedOnlyMeshesIds),void 0!==M.parentId&&(x._waitingParentId=M.parentId),void 0!==M.parentInstanceIndex&&(x._waitingParentInstanceIndex=M.parentInstanceIndex),void 0!==M.falloffType&&(x.falloffType=M.falloffType),void 0!==M.lightmapMode&&(x.lightmapMode=M.lightmapMode),M.animations){for(let E=0;E<M.animations.length;E++){const b=M.animations[E],k=(0,u.e)("BABYLON.Animation");k&&x.animations.push(k.Parse(b))}n.d.ParseAnimationRanges(x,M,E)}return M.autoAnimate&&E.beginAnimation(x,M.autoAnimateFrom,M.autoAnimateTo,M.autoAnimateLoop,M.autoAnimateSpeed||1),void 0!==M.isEnabled&&x.wg(M.isEnabled),x}_hookArrayForExcluded(M){var E=this;const b=M.push;M.push=function(){for(var x=arguments.length,k=new Array(x),a=0;a<x;a++)k[a]=arguments[a];const g=b.apply(M,k);for(const M of k)M._resyncLightSource(E);return g};const x=M.splice;M.splice=(E,b)=>{const k=x.apply(M,[E,b]);for(const M of k)M._resyncLightSource(this);return k};for(const k of M)k._resyncLightSource(this)}_hookArrayForIncludedOnly(M){var E=this;const b=M.push;M.push=function(){for(var x=arguments.length,k=new Array(x),a=0;a<x;a++)k[a]=arguments[a];const g=b.apply(M,k);return E._resyncMeshes(),g};const x=M.splice;M.splice=(E,b)=>{const k=x.apply(M,[E,b]);return this._resyncMeshes(),k},this._resyncMeshes()}_resyncMeshes(){for(const M of this.va().meshes)M._resyncLightSource(this)}_markMeshesAsLightDirty(){for(const M of this.va().meshes)-1!==M.lightSources.indexOf(this)&&M._markSubMeshesAsLightDirty()}_computePhotometricScale(){this._photometricScale=this._getPhotometricScale(),this.va().resetCachedMaterial()}_getPhotometricScale(){let M=0;const E=this.getTypeID();let b=this.intensityMode;switch(b===I.INTENSITYMODE_AUTOMATIC&&(b=E===I.LIGHTTYPEID_DIRECTIONALLIGHT?I.INTENSITYMODE_ILLUMINANCE:I.INTENSITYMODE_LUMINOUSINTENSITY),E){case I.LIGHTTYPEID_POINTLIGHT:case I.LIGHTTYPEID_SPOTLIGHT:switch(b){case I.INTENSITYMODE_LUMINOUSPOWER:M=1/(4*Math.PI);break;case I.INTENSITYMODE_LUMINOUSINTENSITY:M=1;break;case I.INTENSITYMODE_LUMINANCE:M=this.i*this.i}break;case I.LIGHTTYPEID_DIRECTIONALLIGHT:switch(b){case I.INTENSITYMODE_ILLUMINANCE:M=1;break;case I.INTENSITYMODE_LUMINANCE:{let E=this.i;E=Math.max(E,.001);M=2*Math.PI*(1-Math.cos(E));break}}break;case I.LIGHTTYPEID_HEMISPHERICLIGHT:M=1}return M}_reorderLightsInScene(){const M=this.va();0!=this._renderPriority&&(M.requireLightSorting=!0),this.va().sortLightsByPriority()}}I.FALLOFF_DEFAULT=T.b.FALLOFF_DEFAULT,I.FALLOFF_PHYSICAL=T.b.FALLOFF_PHYSICAL,I.FALLOFF_GLTF=T.b.FALLOFF_GLTF,I.FALLOFF_STANDARD=T.b.FALLOFF_STANDARD,I.LIGHTMAP_DEFAULT=T.b.LIGHTMAP_DEFAULT,I.LIGHTMAP_SPECULAR=T.b.LIGHTMAP_SPECULAR,I.LIGHTMAP_SHADOWSONLY=T.b.LIGHTMAP_SHADOWSONLY,I.INTENSITYMODE_AUTOMATIC=T.b.INTENSITYMODE_AUTOMATIC,I.INTENSITYMODE_LUMINOUSPOWER=T.b.INTENSITYMODE_LUMINOUSPOWER,I.INTENSITYMODE_LUMINOUSINTENSITY=T.b.INTENSITYMODE_LUMINOUSINTENSITY,I.INTENSITYMODE_ILLUMINANCE=T.b.INTENSITYMODE_ILLUMINANCE,I.INTENSITYMODE_LUMINANCE=T.b.INTENSITYMODE_LUMINANCE,I.LIGHTTYPEID_POINTLIGHT=T.b.LIGHTTYPEID_POINTLIGHT,I.LIGHTTYPEID_DIRECTIONALLIGHT=T.b.LIGHTTYPEID_DIRECTIONALLIGHT,I.LIGHTTYPEID_SPOTLIGHT=T.b.LIGHTTYPEID_SPOTLIGHT,I.LIGHTTYPEID_HEMISPHERICLIGHT=T.b.LIGHTTYPEID_HEMISPHERICLIGHT,(0,x.d)([(0,k.m)()],I.prototype,"diffuse",void 0),(0,x.d)([(0,k.m)()],I.prototype,"specular",void 0),(0,x.d)([(0,k.E)()],I.prototype,"falloffType",void 0),(0,x.d)([(0,k.E)()],I.prototype,"intensity",void 0),(0,x.d)([(0,k.E)()],I.prototype,"range",null),(0,x.d)([(0,k.E)()],I.prototype,"intensityMode",null),(0,x.d)([(0,k.E)()],I.prototype,"i",null),(0,x.d)([(0,k.E)()],I.prototype,"_renderPriority",void 0),(0,x.d)([(0,k.e)("_reorderLightsInScene")],I.prototype,"renderPriority",void 0),(0,x.d)([(0,k.E)("shadowEnabled")],I.prototype,"_shadowEnabled",void 0),(0,x.d)([(0,k.E)("excludeWithLayerMask")],I.prototype,"_excludeWithLayerMask",void 0),(0,x.d)([(0,k.E)("includeOnlyWithLayerMask")],I.prototype,"_includeOnlyWithLayerMask",void 0),(0,x.d)([(0,k.E)("lightmapMode")],I.prototype,"_lightmapMode",void 0)},12194:(M,E,b)=>{"use strict";b.d(E,{b:()=>J});var x=b(948),k=b(953),a=b(970),g=b(12152),n=b(1512);class J extends g.e{constructor(){super(...arguments),this._needProjectionMatrixCompute=!0,this._viewMatrix=a.d.Identity(),this._projectionMatrix=a.d.Identity()}_setPosition(M){this._position=M}get position(){return this._position}set position(M){this._setPosition(M)}_setDirection(M){this._direction=M}get direction(){return this._direction}set direction(M){this._setDirection(M)}get shadowMinZ(){return this._shadowMinZ}set shadowMinZ(M){this._shadowMinZ=M,this.forceProjectionMatrixCompute()}get shadowMaxZ(){return this._shadowMaxZ}set shadowMaxZ(M){this._shadowMaxZ=M,this.forceProjectionMatrixCompute()}computeTransformedInformation(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=a.m.Zero()),a.m.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=a.m.Zero()),a.m.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)}getDepthScale(){return 50}getShadowDirection(M){return this.transformedDirection?this.transformedDirection:this.direction}getAbsolutePosition(){return this.transformedPosition?this.transformedPosition:this.position}setDirectionToTarget(M){return this.direction=a.m.Normalize(M.Qc(this.position)),this.direction}getRotation(){this.direction.normalize();const M=a.m.Cross(this.direction,n.d.Y),E=a.m.Cross(M,this.direction);return a.m.RotationFromAxis(M,E,this.direction)}needCube(){return!1}needProjectionMatrixCompute(){return this._needProjectionMatrixCompute}forceProjectionMatrixCompute(){this._needProjectionMatrixCompute=!0}_initCache(){super._initCache(),this._cache.position=a.m.Zero()}_isSynchronized(){return!!this._cache.position.equals(this.position)}ce(M){return!M&&this.isSynchronized()?(this._currentRenderId=this.va().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.p(this.position),this._worldMatrix||(this._worldMatrix=a.d.Identity()),a.d.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)}getDepthMinZ(M){return void 0!==this.shadowMinZ?this.shadowMinZ:M.bj}getDepthMaxZ(M){return void 0!==this.shadowMaxZ?this.shadowMaxZ:M.maxZ}setShadowProjectionMatrix(M,E,b){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(E,b,M):this._setDefaultShadowProjectionMatrix(M,E,b),this}_syncParentEnabledState(){super._syncParentEnabledState(),this.parent&&this.parent.getWorldMatrix||(this.transformedPosition=null,this.transformedDirection=null)}getViewMatrix(M){const E=a.i.Fd[0];let b=this.position;this.computeTransformedInformation()&&(b=this.transformedPosition),a.m.NormalizeToRef(this.getShadowDirection(M),E),1===Math.abs(a.m.Dot(E,a.m.Up()))&&(E.z=1e-13);const x=a.i.Fd[1];return b.addToRef(E,x),a.d.LookAtLHToRef(b,x,a.m.Up(),this._viewMatrix),this._viewMatrix}getProjectionMatrix(M,E){return this.setShadowProjectionMatrix(this._projectionMatrix,M??this._viewMatrix,E??[]),this._projectionMatrix}}(0,x.d)([(0,k.C)()],J.prototype,"position",null),(0,x.d)([(0,k.C)()],J.prototype,"direction",null),(0,x.d)([(0,k.E)()],J.prototype,"shadowMinZ",null),(0,x.d)([(0,k.E)()],J.prototype,"shadowMaxZ",null)},11712:(M,E,b)=>{"use strict";b.d(E,{b:()=>g,e:()=>a,g:()=>n});const x={},k={};function a(M,E){x[M]=E}function g(M,E){k[M]=E}function n(M){return k[M]?k[M]:null}},11630:(M,E,b)=>{"use strict";b.d(E,{e:()=>F,g:()=>X});var x,k=b(1176),a=b(962),g=b(1171),n=b(1005),J=b(1060),u=b(11565),T=b(1022),V=b(1041),I=b(1019),t=b(1073);!function(M){M[M.Clean=0]="Clean",M[M.Stop=1]="Stop",M[M.Sync=2]="Sync",M[M.NoSync=3]="NoSync"}(x||(x={}));const y=new a.b,B={};let r=!1;function c(){return B[".babylon"]}function C(M){const E=B[M];return E||(J.d.Warn("Unable to find a plugin to load "+M+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),c())}function R(M,E,b){let x="Unable to load from "+(M.rawData?"binary data":M.url);return E?x+=`: ${E}`:b&&(x+=`: ${b}`),x}function w(M,E,b,x,k,a,g,n,J){var u;const V="data:"===(I=M.url).substring(0,5)?I.substring(5):null;var I;if(M.rawData&&!g)throw"When using ArrayBufferView to load data the file extension must be provided.";const r=g?C(g):V?function(M){for(const E in B){const b=B[E].plugin;if(b.canDirectLoad&&b.canDirectLoad(M))return B[E]}return c()}(M.url):function(M){const E=M.indexOf("?");-1!==E&&(M=M.substring(0,E));const b=M.lastIndexOf(".");return C(M.substring(b,M.length).toLowerCase())}(M.url);if(!r)throw new Error(`No plugin or fallback for ${g??M.url}`);if(!1===(null===J||void 0===J||null===(u=J[r.plugin.name])||void 0===u?void 0:u.enabled))throw new Error(`The '${r.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(M.rawData&&!r.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(M=>{if(r.plugin.createPlugin){const E=r.plugin.createPlugin(J??{});return E instanceof Promise?(E.then(M).catch((M=>{k("Error instantiating plugin.",M)})),null):(M(E),E)}return M(r.plugin),r.plugin})((J=>{var u;if(!J)throw`The loader plugin corresponding to the '${g}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(y.notifyObservers(J),V&&(J.canDirectLoad&&J.canDirectLoad(M.url)||!(0,T.h)(M.url))){if(J.directLoad){const M=J.directLoad(E,V);M instanceof Promise?M.then((M=>{b(J,M)})).catch((M=>{k("Error in directLoad of _loadData: "+M,M)})):b(J,M)}else b(J,V);return}const I=r.isBinary,B=(M,x)=>{E.u?k("Scene has been disposed"):b(J,M,x)};let c=null,C=!1;null===(u=J.Rd)||void 0===u||u.add((()=>{C=!0,c&&(c.abort(),c=null),a()}));const R=()=>{if(C)return;const b=(M,E)=>{k(null===M||void 0===M?void 0:M.statusText,E)};if(!J.loadFile&&M.rawData)throw"Plugin does not support loading ArrayBufferView.";c=J.loadFile?J.loadFile(E,M.rawData||M.file||M.url,M.rootUrl,B,x,I,b,n):E._loadFile(M.file||M.url,B,x,!0,I,b)},w=E.getEngine();let S=w.enableOfflineSupport;if(S){let b=!1;for(const x of E.disableOfflineSupportExceptionRules)if(x.test(M.url)){b=!0;break}S=!b}S&&t.c.OfflineProviderFactory?E.offlineProvider=t.c.OfflineProviderFactory(M.url,R,w.disableManifestCheck):R()}))}function S(M,E){let b,x,a=null,g=null;if(E)if(E.name)b=`file:${E.name}`,x=E.name,a=E;else if(ArrayBuffer.isView(E))b="",x=(0,I.e)(),g=E;else if(E.startsWith("data:"))b=E,x="";else if(M){const a=E;if("/"===a.substring(0,1))return k.e.Error("Wrong sceneFilename parameter"),null;b=M+a,x=a}else b=E,x=k.e.GetFilename(E),M=k.e.GetFolderPath(E);else b=M,x=k.e.GetFilename(M),M=k.e.GetFolderPath(M);return{url:b,rootUrl:M,name:x,file:a,rawData:g}}function X(M){if("string"===typeof M.extensions){const E=M.extensions;B[E.toLowerCase()]={plugin:M,isBinary:!1}}else{const E=M.extensions;Object.keys(E).forEach((b=>{B[b.toLowerCase()]={plugin:M,isBinary:E[b].isBinary}}))}}function U(M,E){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n.b.LastCreatedScene,k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,T=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",I=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!x)return J.d.Error("No scene available to import mesh to"),null;const t=S(E,b);if(!t)return null;const y={};x.addPendingData(y);const B=()=>{x.removePendingData(y)},r=(M,E)=>{const b=R(t,M,E);g?g(x,b,new V.g(b,V.f.SceneLoaderError,E)):J.d.Error(b),B()},c=a?M=>{try{a(M)}catch(E){r("Error in onProgress callback: "+E,E)}}:void 0,C=(M,E,b,a,g,n,J,u)=>{if(x.importedMeshesFiles.push(t.url),k)try{k(M,E,b,a,g,n,J,u)}catch(T){r("Error in onSuccess callback: "+T,T)}x.removePendingData(y)};return w(t,x,((E,b,k)=>{if(E.rewriteRootURL&&(t.rootUrl=E.rewriteRootURL(t.rootUrl,k)),E.importMesh){const k=[],a=[],g=[];if(!E.importMesh(M,x,b,t.rootUrl,k,a,g,r))return;x.loadingPluginName=E.name,C(k,a,g,[],[],[],[],[])}else{E.importMeshAsync(M,x,b,t.rootUrl,c,t.name).then((M=>{x.loadingPluginName=E.name,C(M.meshes,M.ae,M.skeletons,M.animationGroups,M.transformNodes,M.geometries,M.lights,M.spriteManagers)})).catch((M=>{r(M.message,M)}))}}),c,r,B,u,T,I)}function v(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n.b.LastCreatedEngine,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,J=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,T=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",V=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};return b?K(M,E,new g.d(b),x,a,J,u,T,V):(k.e.Error("No engine available"),null)}function N(M,E,b,x,k,a,g){return new Promise(((n,J)=>{v(M,E,b,(M=>{n(M)}),x,((M,E,b)=>{J(b||new Error(E))}),k,a,g)}))}function K(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n.b.LastCreatedScene,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,T=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",I=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!b)return J.d.Error("No scene available to append to"),null;const t=S(M,E);if(!t)return null;const y={};b.addPendingData(y);const B=()=>{b.removePendingData(y)};u.d.ShowLoadingScreen&&!r&&(r=!0,b.getEngine().displayLoadingUI(),b.executeWhenReady((()=>{b.getEngine().hideLoadingUI(),r=!1})));const c=(M,E)=>{const x=R(t,M,E);a?a(b,x,new V.g(x,V.f.SceneLoaderError,E)):J.d.Error(x),B()},C=k?M=>{try{k(M)}catch(E){c("Error in onProgress callback",E)}}:void 0,X=()=>{if(x)try{x(b)}catch(M){c("Error in onSuccess callback",M)}b.removePendingData(y)};return w(t,b,((M,E)=>{if(M.load){if(!M.load(b,E,t.rootUrl,c))return;b.loadingPluginName=M.name,X()}else{M.loadAsync(b,E,t.rootUrl,C,t.name).then((()=>{b.loadingPluginName=M.name,X()})).catch((M=>{c(M.message,M)}))}}),C,c,B,g,T,I)}function h(M,E,b,x,k,a,g){return new Promise(((n,J)=>{K(M,E,b,(M=>{n(M)}),x,((M,E,b)=>{J(b||new Error(E))}),k,a,g)}))}function Z(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n.b.LastCreatedScene,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",T=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!b)return J.d.Error("No scene available to load asset container to"),null;const I=S(M,E);if(!I)return null;const t={};b.addPendingData(t);const y=()=>{b.removePendingData(t)},B=(M,E)=>{const x=R(I,M,E);a?a(b,x,new V.g(x,V.f.SceneLoaderError,E)):J.d.Error(x),y()},r=k?M=>{try{k(M)}catch(E){B("Error in onProgress callback",E)}}:void 0,c=M=>{if(x)try{x(M)}catch(E){B("Error in onSuccess callback",E)}b.removePendingData(t)};return w(I,b,((M,E)=>{if(M.loadAssetContainer){const x=M.loadAssetContainer(b,E,I.rootUrl,B);if(!x)return;x.populateRootNodes(),b.loadingPluginName=M.name,c(x)}else if(M.loadAssetContainerAsync){M.loadAssetContainerAsync(b,E,I.rootUrl,r,I.name).then((E=>{E.populateRootNodes(),b.loadingPluginName=M.name,c(E)})).catch((M=>{B(M.message,M)}))}else B("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),r,B,y,g,u,T)}function O(M,E,b,x,k,a,g){return new Promise(((n,J)=>{Z(M,E,b,(M=>{n(M)}),x,((M,E,b)=>{J(b||new Error(E))}),k,a,g)}))}function p(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n.b.LastCreatedScene,x=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,T=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,V=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,I=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",t=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!b)return void J.d.Error("No scene available to load animations to");if(x){for(const M of b.animatables)M.reset();b.stopAllAnimations(),b.animationGroups.slice().forEach((M=>{M.dispose()}));b.getNodes().forEach((M=>{M.animations&&(M.animations=[])}))}else switch(k){case 0:b.animationGroups.slice().forEach((M=>{M.dispose()}));break;case 1:b.animationGroups.forEach((M=>{M.stop()}));break;case 2:b.animationGroups.forEach((M=>{M.reset(),M.restart()}));break;case 3:break;default:return void J.d.Error("Unknown animation group loading mode value '"+k+"'")}const y=b.animatables.length;Z(M,E,b,(M=>{M.mergeAnimationsTo(b,b.animatables.slice(y),a),M.dispose(),b.onAnimationFileImportedObservable.notifyObservers(b),g&&g(b)}),u,T,V,I,t)}function P(M,E,b,x,k,a,g,n,J,u){return new Promise(((T,V)=>{p(M,E,b,x,k,a,(M=>{T(M)}),g,((M,E,b)=>{V(b||new Error(E))}),n,J,u)}))}class F{static get ForceFullSceneLoadingForIncremental(){return u.d.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(M){u.d.ForceFullSceneLoadingForIncremental=M}static get ShowLoadingScreen(){return u.d.ShowLoadingScreen}static set ShowLoadingScreen(M){u.d.ShowLoadingScreen=M}static get loggingLevel(){return u.d.loggingLevel}static set loggingLevel(M){u.d.loggingLevel=M}static get CleanBoneMatrixWeights(){return u.d.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(M){u.d.CleanBoneMatrixWeights=M}static GetDefaultPlugin(){return c()}static GetPluginForExtension(M){var E;return null===(E=C(M))||void 0===E?void 0:E.plugin}static IsPluginForExtensionAvailable(M){return function(M){return!!B[M]}(M)}static RegisterPlugin(M){X(M)}static ImportMesh(M,E,b,x,k,a,g,n,J){return U(M,E,b,x,k,a,g,n,J)}static ImportMeshAsync(M,E,b,x,k,a,g){return function(M,E,b,x,k,a,g,n){return new Promise(((J,u)=>{U(M,E,b,x,((M,E,b,x,k,a,g,n)=>{J({meshes:M,ae:E,skeletons:b,animationGroups:x,transformNodes:k,geometries:a,lights:g,spriteManagers:n})}),k,((M,E,b)=>{u(b||new Error(E))}),a,g,n)}))}(M,E,b,x,k,a,g)}static Load(M,E,b,x,k,a,g,n){return v(M,E,b,x,k,a,g,n)}static LoadAsync(M,E,b,x,k,a){return N(M,E,b,x,k,a)}static Append(M,E,b,x,k,a,g,n){return K(M,E,b,x,k,a,g,n)}static AppendAsync(M,E,b,x,k,a){return h(M,E,b,x,k,a)}static LoadAssetContainer(M,E,b,x,k,a,g,n){return Z(M,E,b,x,k,a,g,n)}static LoadAssetContainerAsync(M,E,b,x,k,a){return O(M,E,b,x,k,a)}static ImportAnimations(M,E,b,x,k,a,g,n,J,u,T){p(M,E,b,x,k,a,g,n,J,u,T)}static ImportAnimationsAsync(M,E,b,x,k,a,g,n,J,u,T){return P(M,E,b,x,k,a,n,u,T)}}F.NO_LOGGING=0,F.MINIMAL_LOGGING=1,F.SUMMARY_LOGGING=2,F.DETAILED_LOGGING=3,F.OnPluginActivatedObservable=y},11565:(M,E,b)=>{"use strict";b.d(E,{d:()=>x});class x{static get ForceFullSceneLoadingForIncremental(){return x._ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(M){x._ForceFullSceneLoadingForIncremental=M}static get ShowLoadingScreen(){return x._ShowLoadingScreen}static set ShowLoadingScreen(M){x._ShowLoadingScreen=M}static get loggingLevel(){return x._LoggingLevel}static set loggingLevel(M){x._LoggingLevel=M}static get CleanBoneMatrixWeights(){return x._CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(M){x._CleanBoneMatrixWeights=M}}x._ForceFullSceneLoadingForIncremental=!1,x._ShowLoadingScreen=!0,x._CleanBoneMatrixWeights=!1,x._LoggingLevel=0},12130:(M,E,b)=>{"use strict";b.d(E,{d:()=>s});var x=b(948),k=b(953),a=b(1060),g=b(1166),n=b(12127),J=b(1171),u=b(970),T=b(1228),V=b(1378),I=b(1408);class t extends V.d{constructor(){super(...arguments),this.BRDF_V_HEIGHT_CORRELATED=!1,this.MS_BRDF_ENERGY_CONSERVATION=!1,this.SPHERICAL_HARMONICS=!1,this.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1}}class y extends I.e{_markAllSubMeshesAsMiscDirty(){this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(M){let E=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(M,"PBRBRDF",90,new t,E),this._useEnergyConservation=y.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=y.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=y.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=y.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=y.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=y.DEFAULT_USE_SPHERICAL_HARMONICS,this._useSpecularGlossinessInputEnergyConservation=y.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this.useSpecularGlossinessInputEnergyConservation=y.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this._internalMarkAllSubMeshesAsMiscDirty=M._dirtyCallbacks[16],this._enable(!0)}prepareDefines(M){M.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,M.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,M.SPHERICAL_HARMONICS=this._useSphericalHarmonics,M.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation}getClassName(){return"PBRBRDFConfiguration"}}y.DEFAULT_USE_ENERGY_CONSERVATION=!0,y.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,y.DEFAULT_USE_SPHERICAL_HARMONICS=!0,y.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0,(0,x.d)([(0,k.E)(),(0,k.e)("_markAllSubMeshesAsMiscDirty")],y.prototype,"useEnergyConservation",void 0),(0,x.d)([(0,k.E)(),(0,k.e)("_markAllSubMeshesAsMiscDirty")],y.prototype,"useSmithVisibilityHeightCorrelated",void 0),(0,x.d)([(0,k.E)(),(0,k.e)("_markAllSubMeshesAsMiscDirty")],y.prototype,"useSphericalHarmonics",void 0),(0,x.d)([(0,k.E)(),(0,k.e)("_markAllSubMeshesAsMiscDirty")],y.prototype,"useSpecularGlossinessInputEnergyConservation",void 0);var B=b(1321),r=b(1133),c=b(1197),C=b(1326),R=b(1386),w=b(942),S=b(1388),X=(b(10499),b(1397)),U=b(1367);class v extends V.d{constructor(){super(...arguments),this.CLEARCOAT=!1,this.CLEARCOAT_DEFAULTIOR=!1,this.CLEARCOAT_TEXTURE=!1,this.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this.CLEARCOAT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,this.CLEARCOAT_BUMP=!1,this.CLEARCOAT_BUMPDIRECTUV=0,this.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,this.CLEARCOAT_REMAP_F0=!1,this.CLEARCOAT_TINT=!1,this.CLEARCOAT_TINT_TEXTURE=!1,this.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TINT_GAMMATEXTURE=!1}}class N extends I.e{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(M){let E=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(M,"PBRClearCoat",100,new v,E),this._isEnabled=!1,this.isEnabled=!1,this.fj=1,this.roughness=0,this._indexOfRefraction=N._DefaultIndexOfRefraction,this.indexOfRefraction=N._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._textureRoughness=null,this.textureRoughness=null,this._remapF0OnInterfaceChange=!0,this.remapF0OnInterfaceChange=!0,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=r.e.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=M._dirtyCallbacks[1]}isReadyForSubMesh(M,E,b){if(!this._isEnabled)return!0;const x=this._material._disableBumpMap;if(M._areTexturesDirty&&E.texturesEnabled){if(this._texture&&S.e.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&S.e.ClearCoatTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1;if(b.getCaps().standardDerivatives&&this._bumpTexture&&S.e.ClearCoatBumpTextureEnabled&&!x&&!this._bumpTexture.isReady())return!1;if(this._isTintEnabled&&this._tintTexture&&S.e.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(M,E){this._isEnabled?(M.CLEARCOAT=!0,M.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,M.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange,M._areTexturesDirty&&E.texturesEnabled&&(this._texture&&S.e.ClearCoatTextureEnabled?(0,U.O)(this._texture,M,"CLEARCOAT_TEXTURE"):M.CLEARCOAT_TEXTURE=!1,this._textureRoughness&&S.e.ClearCoatTextureEnabled?(0,U.O)(this._textureRoughness,M,"CLEARCOAT_TEXTURE_ROUGHNESS"):M.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this._bumpTexture&&S.e.ClearCoatBumpTextureEnabled?(0,U.O)(this._bumpTexture,M,"CLEARCOAT_BUMP"):M.CLEARCOAT_BUMP=!1,M.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===N._DefaultIndexOfRefraction,this._isTintEnabled?(M.CLEARCOAT_TINT=!0,this._tintTexture&&S.e.ClearCoatTintTextureEnabled?((0,U.O)(this._tintTexture,M,"CLEARCOAT_TINT_TEXTURE"),M.CLEARCOAT_TINT_GAMMATEXTURE=this._tintTexture.gammaSpace):M.CLEARCOAT_TINT_TEXTURE=!1):(M.CLEARCOAT_TINT=!1,M.CLEARCOAT_TINT_TEXTURE=!1))):(M.CLEARCOAT=!1,M.CLEARCOAT_TEXTURE=!1,M.CLEARCOAT_TEXTURE_ROUGHNESS=!1,M.CLEARCOAT_BUMP=!1,M.CLEARCOAT_TINT=!1,M.CLEARCOAT_TINT_TEXTURE=!1,M.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,M.CLEARCOAT_DEFAULTIOR=!1,M.CLEARCOAT_TEXTUREDIRECTUV=0,M.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,M.CLEARCOAT_BUMPDIRECTUV=0,M.CLEARCOAT_REMAP_F0=!1,M.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,M.CLEARCOAT_TINT_GAMMATEXTURE=!1)}bindForSubMesh(M,E,b,x){if(!this._isEnabled)return;const k=x.materialDefines,a=this._material.isFrozen,g=this._material._disableBumpMap,n=this._material._invertNormalMapX,J=this._material._invertNormalMapY;if(!M.useUbo||!a||!M.isSync){var u,T,V,I;if((this._texture||this._textureRoughness)&&S.e.ClearCoatTextureEnabled)M.updateFloat4("vClearCoatInfos",(null===(u=this._texture)||void 0===u?void 0:u.coordinatesIndex)??0,(null===(T=this._texture)||void 0===T?void 0:T.level)??0,(null===(V=this._textureRoughness)||void 0===V?void 0:V.coordinatesIndex)??0,(null===(I=this._textureRoughness)||void 0===I?void 0:I.level)??0),this._texture&&(0,U.p)(this._texture,M,"clearCoat"),this._textureRoughness&&!k.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,U.p)(this._textureRoughness,M,"clearCoatRoughness");this._bumpTexture&&b.getCaps().standardDerivatives&&S.e.ClearCoatTextureEnabled&&!g&&(M.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),(0,U.p)(this._bumpTexture,M,"clearCoatBump"),E._mirroredCameraPosition?M.updateFloat2("vClearCoatTangentSpaceParams",n?1:-1,J?1:-1):M.updateFloat2("vClearCoatTangentSpaceParams",n?-1:1,J?-1:1)),this._tintTexture&&S.e.ClearCoatTintTextureEnabled&&(M.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),(0,U.p)(this._tintTexture,M,"clearCoatTint")),M.updateFloat2("vClearCoatParams",this.fj,this.roughness);const x=1-this._indexOfRefraction,a=1+this._indexOfRefraction,t=Math.pow(-x/a,2),y=1/this._indexOfRefraction;M.updateFloat4("vClearCoatRefractionParams",t,y,x,a),this._isTintEnabled&&(M.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),M.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}E.texturesEnabled&&(this._texture&&S.e.ClearCoatTextureEnabled&&M.setTexture("clearCoatSampler",this._texture),this._textureRoughness&&!k.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&S.e.ClearCoatTextureEnabled&&M.setTexture("clearCoatRoughnessSampler",this._textureRoughness),this._bumpTexture&&b.getCaps().standardDerivatives&&S.e.ClearCoatBumpTextureEnabled&&!g&&M.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&S.e.ClearCoatTintTextureEnabled&&M.setTexture("clearCoatTintSampler",this._tintTexture))}hasTexture(M){return this._texture===M||(this._textureRoughness===M||(this._bumpTexture===M||this._tintTexture===M))}getActiveTextures(M){this._texture&&M.push(this._texture),this._textureRoughness&&M.push(this._textureRoughness),this._bumpTexture&&M.push(this._bumpTexture),this._tintTexture&&M.push(this._tintTexture)}getAnimatables(M){this._texture&&this._texture.animations&&this._texture.animations.length>0&&M.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&M.push(this._textureRoughness),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&M.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&M.push(this._tintTexture)}dispose(M){var E,b,x,k;M&&(null===(E=this._texture)||void 0===E||E.dispose(),null===(b=this._textureRoughness)||void 0===b||b.dispose(),null===(x=this._bumpTexture)||void 0===x||x.dispose(),null===(k=this._tintTexture)||void 0===k||k.dispose())}getClassName(){return"PBRClearCoatConfiguration"}addFallbacks(M,E,b){return M.CLEARCOAT_BUMP&&E.addFallback(b++,"CLEARCOAT_BUMP"),M.CLEARCOAT_TINT&&E.addFallback(b++,"CLEARCOAT_TINT"),M.CLEARCOAT&&E.addFallback(b++,"CLEARCOAT"),b}getSamplers(M){M.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler")}getUniforms(){return{ubo:[{name:"vClearCoatParams",size:2,type:"vec2"},{name:"vClearCoatRefractionParams",size:4,type:"vec4"},{name:"vClearCoatInfos",size:4,type:"vec4"},{name:"clearCoatMatrix",size:16,type:"mat4"},{name:"clearCoatRoughnessMatrix",size:16,type:"mat4"},{name:"vClearCoatBumpInfos",size:2,type:"vec2"},{name:"vClearCoatTangentSpaceParams",size:2,type:"vec2"},{name:"clearCoatBumpMatrix",size:16,type:"mat4"},{name:"vClearCoatTintParams",size:4,type:"vec4"},{name:"clearCoatColorAtDistance",size:1,type:"float"},{name:"vClearCoatTintInfos",size:2,type:"vec2"},{name:"clearCoatTintMatrix",size:16,type:"mat4"}]}}}N._DefaultIndexOfRefraction=1.5,(0,x.d)([(0,k.E)(),(0,k.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"isEnabled",void 0),(0,x.d)([(0,k.E)()],N.prototype,"intensity",void 0),(0,x.d)([(0,k.E)()],N.prototype,"roughness",void 0),(0,x.d)([(0,k.E)(),(0,k.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"indexOfRefraction",void 0),(0,x.d)([(0,k.A)(),(0,k.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"texture",void 0),(0,x.d)([(0,k.E)(),(0,k.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"useRoughnessFromMainTexture",void 0),(0,x.d)([(0,k.A)(),(0,k.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"textureRoughness",void 0),(0,x.d)([(0,k.E)(),(0,k.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"remapF0OnInterfaceChange",void 0),(0,x.d)([(0,k.A)(),(0,k.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"bumpTexture",void 0),(0,x.d)([(0,k.E)(),(0,k.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"isTintEnabled",void 0),(0,x.d)([(0,k.m)()],N.prototype,"tintColor",void 0),(0,x.d)([(0,k.E)()],N.prototype,"tintColorAtDistance",void 0),(0,x.d)([(0,k.E)()],N.prototype,"tintThickness",void 0),(0,x.d)([(0,k.A)(),(0,k.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"tintTexture",void 0);class K extends V.d{constructor(){super(...arguments),this.IRIDESCENCE=!1,this.IRIDESCENCE_TEXTURE=!1,this.IRIDESCENCE_TEXTUREDIRECTUV=0,this.IRIDESCENCE_THICKNESS_TEXTURE=!1,this.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0}}class h extends I.e{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(M){let E=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(M,"PBRIridescence",110,new K,E),this._isEnabled=!1,this.isEnabled=!1,this.fj=1,this.minimumThickness=h._DefaultMinimumThickness,this.maximumThickness=h._DefaultMaximumThickness,this.indexOfRefraction=h._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._thicknessTexture=null,this.thicknessTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=M._dirtyCallbacks[1]}isReadyForSubMesh(M,E){if(!this._isEnabled)return!0;if(M._areTexturesDirty&&E.texturesEnabled){if(this._texture&&S.e.IridescenceTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._thicknessTexture&&S.e.IridescenceTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(M,E){this._isEnabled?(M.IRIDESCENCE=!0,M._areTexturesDirty&&E.texturesEnabled&&(this._texture&&S.e.IridescenceTextureEnabled?(0,U.O)(this._texture,M,"IRIDESCENCE_TEXTURE"):M.IRIDESCENCE_TEXTURE=!1,this._thicknessTexture&&S.e.IridescenceTextureEnabled?(0,U.O)(this._thicknessTexture,M,"IRIDESCENCE_THICKNESS_TEXTURE"):M.IRIDESCENCE_THICKNESS_TEXTURE=!1)):(M.IRIDESCENCE=!1,M.IRIDESCENCE_TEXTURE=!1,M.IRIDESCENCE_THICKNESS_TEXTURE=!1,M.IRIDESCENCE_TEXTUREDIRECTUV=0,M.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0)}bindForSubMesh(M,E){if(!this._isEnabled)return;const b=this._material.isFrozen;if(!M.useUbo||!b||!M.isSync){var x,k,a,g;if((this._texture||this._thicknessTexture)&&S.e.IridescenceTextureEnabled)M.updateFloat4("vIridescenceInfos",(null===(x=this._texture)||void 0===x?void 0:x.coordinatesIndex)??0,(null===(k=this._texture)||void 0===k?void 0:k.level)??0,(null===(a=this._thicknessTexture)||void 0===a?void 0:a.coordinatesIndex)??0,(null===(g=this._thicknessTexture)||void 0===g?void 0:g.level)??0),this._texture&&(0,U.p)(this._texture,M,"iridescence"),this._thicknessTexture&&(0,U.p)(this._thicknessTexture,M,"iridescenceThickness");M.updateFloat4("vIridescenceParams",this.fj,this.indexOfRefraction,this.minimumThickness,this.maximumThickness)}E.texturesEnabled&&(this._texture&&S.e.IridescenceTextureEnabled&&M.setTexture("iridescenceSampler",this._texture),this._thicknessTexture&&S.e.IridescenceTextureEnabled&&M.setTexture("iridescenceThicknessSampler",this._thicknessTexture))}hasTexture(M){return this._texture===M||this._thicknessTexture===M}getActiveTextures(M){this._texture&&M.push(this._texture),this._thicknessTexture&&M.push(this._thicknessTexture)}getAnimatables(M){this._texture&&this._texture.animations&&this._texture.animations.length>0&&M.push(this._texture),this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&M.push(this._thicknessTexture)}dispose(M){var E,b;M&&(null===(E=this._texture)||void 0===E||E.dispose(),null===(b=this._thicknessTexture)||void 0===b||b.dispose())}getClassName(){return"PBRIridescenceConfiguration"}addFallbacks(M,E,b){return M.IRIDESCENCE&&E.addFallback(b++,"IRIDESCENCE"),b}getSamplers(M){M.push("iridescenceSampler","iridescenceThicknessSampler")}getUniforms(){return{ubo:[{name:"vIridescenceParams",size:4,type:"vec4"},{name:"vIridescenceInfos",size:4,type:"vec4"},{name:"iridescenceMatrix",size:16,type:"mat4"},{name:"iridescenceThicknessMatrix",size:16,type:"mat4"}]}}}h._DefaultMinimumThickness=100,h._DefaultMaximumThickness=400,h._DefaultIndexOfRefraction=1.3,(0,x.d)([(0,k.E)(),(0,k.e)("_markAllSubMeshesAsTexturesDirty")],h.prototype,"isEnabled",void 0),(0,x.d)([(0,k.E)()],h.prototype,"intensity",void 0),(0,x.d)([(0,k.E)()],h.prototype,"minimumThickness",void 0),(0,x.d)([(0,k.E)()],h.prototype,"maximumThickness",void 0),(0,x.d)([(0,k.E)()],h.prototype,"indexOfRefraction",void 0),(0,x.d)([(0,k.A)(),(0,k.e)("_markAllSubMeshesAsTexturesDirty")],h.prototype,"texture",void 0),(0,x.d)([(0,k.A)(),(0,k.e)("_markAllSubMeshesAsTexturesDirty")],h.prototype,"thicknessTexture",void 0);class Z extends V.d{constructor(){super(...arguments),this.ANISOTROPIC=!1,this.ANISOTROPIC_TEXTURE=!1,this.ANISOTROPIC_TEXTUREDIRECTUV=0,this.ANISOTROPIC_LEGACY=!1,this.MAINUV1=!1}}class O extends I.e{set angle(M){this.direction.x=Math.cos(M),this.direction.y=Math.sin(M)}get angle(){return Math.atan2(this.direction.y,this.direction.x)}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markAllSubMeshesAsMiscDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(M){let E=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(M,"PBRAnisotropic",110,new Z,E),this._isEnabled=!1,this.isEnabled=!1,this.fj=1,this.direction=new u.l(1,0),this._texture=null,this.texture=null,this._legacy=!1,this.legacy=!1,this._internalMarkAllSubMeshesAsTexturesDirty=M._dirtyCallbacks[1],this._internalMarkAllSubMeshesAsMiscDirty=M._dirtyCallbacks[16]}isReadyForSubMesh(M,E){return!this._isEnabled||!(M._areTexturesDirty&&E.texturesEnabled&&this._texture&&S.e.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())}prepareDefinesBeforeAttributes(M,E,b){this._isEnabled?(M.ANISOTROPIC=this._isEnabled,this._isEnabled&&!b.isVerticesDataPresent(T.g.TangentKind)&&(M._needUVs=!0,M.MAINUV1=!0),M._areTexturesDirty&&E.texturesEnabled&&(this._texture&&S.e.AnisotropicTextureEnabled?(0,U.O)(this._texture,M,"ANISOTROPIC_TEXTURE"):M.ANISOTROPIC_TEXTURE=!1),M._areMiscDirty&&(M.ANISOTROPIC_LEGACY=this._legacy)):(M.ANISOTROPIC=!1,M.ANISOTROPIC_TEXTURE=!1,M.ANISOTROPIC_TEXTUREDIRECTUV=0,M.ANISOTROPIC_LEGACY=!1)}bindForSubMesh(M,E){if(!this._isEnabled)return;const b=this._material.isFrozen;M.useUbo&&b&&M.isSync||(this._texture&&S.e.AnisotropicTextureEnabled&&(M.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),(0,U.p)(this._texture,M,"anisotropy")),M.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.fj)),E.texturesEnabled&&this._texture&&S.e.AnisotropicTextureEnabled&&M.setTexture("anisotropySampler",this._texture)}hasTexture(M){return this._texture===M}getActiveTextures(M){this._texture&&M.push(this._texture)}getAnimatables(M){this._texture&&this._texture.animations&&this._texture.animations.length>0&&M.push(this._texture)}dispose(M){M&&this._texture&&this._texture.dispose()}getClassName(){return"PBRAnisotropicConfiguration"}addFallbacks(M,E,b){return M.ANISOTROPIC&&E.addFallback(b++,"ANISOTROPIC"),b}getSamplers(M){M.push("anisotropySampler")}getUniforms(){return{ubo:[{name:"vAnisotropy",size:3,type:"vec3"},{name:"vAnisotropyInfos",size:2,type:"vec2"},{name:"anisotropyMatrix",size:16,type:"mat4"}]}}parse(M,E,b){super.parse(M,E,b),void 0===M.legacy&&(this.legacy=!0)}}(0,x.d)([(0,k.E)(),(0,k.e)("_markAllSubMeshesAsTexturesDirty")],O.prototype,"isEnabled",void 0),(0,x.d)([(0,k.E)()],O.prototype,"intensity",void 0),(0,x.d)([(0,k.B)()],O.prototype,"direction",void 0),(0,x.d)([(0,k.A)(),(0,k.e)("_markAllSubMeshesAsTexturesDirty")],O.prototype,"texture",void 0),(0,x.d)([(0,k.E)(),(0,k.e)("_markAllSubMeshesAsMiscDirty")],O.prototype,"legacy",void 0);class p extends V.d{constructor(){super(...arguments),this.SHEEN=!1,this.SHEEN_TEXTURE=!1,this.SHEEN_GAMMATEXTURE=!1,this.SHEEN_TEXTURE_ROUGHNESS=!1,this.SHEEN_TEXTUREDIRECTUV=0,this.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0,this.SHEEN_LINKWITHALBEDO=!1,this.SHEEN_ROUGHNESS=!1,this.SHEEN_ALBEDOSCALING=!1,this.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1}}class P extends I.e{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(M){let E=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(M,"Sheen",120,new p,E),this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.fj=1,this.color=r.e.White(),this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._roughness=null,this.roughness=null,this._textureRoughness=null,this.textureRoughness=null,this._albedoScaling=!1,this.albedoScaling=!1,this._internalMarkAllSubMeshesAsTexturesDirty=M._dirtyCallbacks[1]}isReadyForSubMesh(M,E){if(!this._isEnabled)return!0;if(M._areTexturesDirty&&E.texturesEnabled){if(this._texture&&S.e.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&S.e.SheenTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(M,E){this._isEnabled?(M.SHEEN=!0,M.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,M.SHEEN_ROUGHNESS=null!==this._roughness,M.SHEEN_ALBEDOSCALING=this._albedoScaling,M.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,M._areTexturesDirty&&E.texturesEnabled&&(this._texture&&S.e.SheenTextureEnabled?((0,U.O)(this._texture,M,"SHEEN_TEXTURE"),M.SHEEN_GAMMATEXTURE=this._texture.gammaSpace):M.SHEEN_TEXTURE=!1,this._textureRoughness&&S.e.SheenTextureEnabled?(0,U.O)(this._textureRoughness,M,"SHEEN_TEXTURE_ROUGHNESS"):M.SHEEN_TEXTURE_ROUGHNESS=!1)):(M.SHEEN=!1,M.SHEEN_TEXTURE=!1,M.SHEEN_TEXTURE_ROUGHNESS=!1,M.SHEEN_LINKWITHALBEDO=!1,M.SHEEN_ROUGHNESS=!1,M.SHEEN_ALBEDOSCALING=!1,M.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,M.SHEEN_GAMMATEXTURE=!1,M.SHEEN_TEXTUREDIRECTUV=0,M.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0)}bindForSubMesh(M,E,b,x){if(!this._isEnabled)return;const k=x.materialDefines,a=this._material.isFrozen;if(!M.useUbo||!a||!M.isSync){var g,n,J,u;if((this._texture||this._textureRoughness)&&S.e.SheenTextureEnabled)M.updateFloat4("vSheenInfos",(null===(g=this._texture)||void 0===g?void 0:g.coordinatesIndex)??0,(null===(n=this._texture)||void 0===n?void 0:n.level)??0,(null===(J=this._textureRoughness)||void 0===J?void 0:J.coordinatesIndex)??0,(null===(u=this._textureRoughness)||void 0===u?void 0:u.level)??0),this._texture&&(0,U.p)(this._texture,M,"sheen"),this._textureRoughness&&!k.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,U.p)(this._textureRoughness,M,"sheenRoughness");M.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.fj),null!==this._roughness&&M.updateFloat("vSheenRoughness",this._roughness)}E.texturesEnabled&&(this._texture&&S.e.SheenTextureEnabled&&M.setTexture("sheenSampler",this._texture),this._textureRoughness&&!k.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&S.e.SheenTextureEnabled&&M.setTexture("sheenRoughnessSampler",this._textureRoughness))}hasTexture(M){return this._texture===M||this._textureRoughness===M}getActiveTextures(M){this._texture&&M.push(this._texture),this._textureRoughness&&M.push(this._textureRoughness)}getAnimatables(M){this._texture&&this._texture.animations&&this._texture.animations.length>0&&M.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&M.push(this._textureRoughness)}dispose(M){var E,b;M&&(null===(E=this._texture)||void 0===E||E.dispose(),null===(b=this._textureRoughness)||void 0===b||b.dispose())}getClassName(){return"PBRSheenConfiguration"}addFallbacks(M,E,b){return M.SHEEN&&E.addFallback(b++,"SHEEN"),b}getSamplers(M){M.push("sheenSampler","sheenRoughnessSampler")}getUniforms(){return{ubo:[{name:"vSheenColor",size:4,type:"vec4"},{name:"vSheenRoughness",size:1,type:"float"},{name:"vSheenInfos",size:4,type:"vec4"},{name:"sheenMatrix",size:16,type:"mat4"},{name:"sheenRoughnessMatrix",size:16,type:"mat4"}]}}}(0,x.d)([(0,k.E)(),(0,k.e)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"isEnabled",void 0),(0,x.d)([(0,k.E)(),(0,k.e)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"linkSheenWithAlbedo",void 0),(0,x.d)([(0,k.E)()],P.prototype,"intensity",void 0),(0,x.d)([(0,k.m)()],P.prototype,"color",void 0),(0,x.d)([(0,k.A)(),(0,k.e)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"texture",void 0),(0,x.d)([(0,k.E)(),(0,k.e)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"useRoughnessFromMainTexture",void 0),(0,x.d)([(0,k.E)(),(0,k.e)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"roughness",void 0),(0,x.d)([(0,k.A)(),(0,k.e)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"textureRoughness",void 0),(0,x.d)([(0,k.E)(),(0,k.e)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"albedoScaling",void 0);class F extends V.d{constructor(){super(...arguments),this.SUBSURFACE=!1,this.SS_REFRACTION=!1,this.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_TRANSLUCENCY=!1,this.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_SCATTERING=!1,this.SS_DISPERSION=!1,this.SS_THICKNESSANDMASK_TEXTURE=!1,this.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,this.SS_HAS_THICKNESS=!1,this.SS_REFRACTIONINTENSITY_TEXTURE=!1,this.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,this.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,this.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,this.SS_REFRACTIONMAP_3D=!1,this.SS_REFRACTIONMAP_OPPOSITEZ=!1,this.SS_LODINREFRACTIONALPHA=!1,this.SS_GAMMAREFRACTION=!1,this.SS_RGBDREFRACTION=!1,this.SS_LINEARSPECULARREFRACTION=!1,this.SS_LINKREFRACTIONTOTRANSPARENCY=!1,this.SS_ALBEDOFORREFRACTIONTINT=!1,this.SS_ALBEDOFORTRANSLUCENCYTINT=!1,this.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.SS_USE_THICKNESS_AS_DEPTH=!1,this.SS_USE_GLTF_TEXTURES=!1}}class l extends I.e{get scatteringDiffusionProfile(){return this._scene.subSurfaceConfiguration?this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex]:null}set scatteringDiffusionProfile(M){this._scene.enableSubSurfaceForPrePass()&&M&&(this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(M))}get volumeIndexOfRefraction(){return this._volumeIndexOfRefraction>=1?this._volumeIndexOfRefraction:this._indexOfRefraction}set volumeIndexOfRefraction(M){this._volumeIndexOfRefraction=M>=1?M:-1}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markScenePrePassDirty(){this._internalMarkAllSubMeshesAsTexturesDirty(),this._internalMarkScenePrePassDirty()}isCompatible(){return!0}constructor(M){let E=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(M,"PBRSubSurface",130,new F,E),this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isDispersionEnabled=!1,this.isDispersionEnabled=!1,this._isScatteringEnabled=!1,this.isScatteringEnabled=!1,this._scatteringDiffusionProfileIndex=0,this.refractionIntensity=1,this.translucencyIntensity=1,this.useAlbedoToTintRefraction=!1,this.useAlbedoToTintTranslucency=!1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1.5,this.indexOfRefraction=1.5,this._volumeIndexOfRefraction=-1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.useThicknessAsDepth=!1,this.tintColor=r.e.White(),this.tintColorAtDistance=1,this.dispersion=0,this.diffusionDistance=r.e.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._refractionIntensityTexture=null,this.refractionIntensityTexture=null,this._translucencyIntensityTexture=null,this.translucencyIntensityTexture=null,this.translucencyColor=null,this._translucencyColorTexture=null,this.translucencyColorTexture=null,this._useGltfStyleTextures=!0,this.useGltfStyleTextures=!0,this._scene=M.va(),this.registerForExtraEvents=!0,this._internalMarkAllSubMeshesAsTexturesDirty=M._dirtyCallbacks[1],this._internalMarkScenePrePassDirty=M._dirtyCallbacks[32]}isReadyForSubMesh(M,E){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return!0;if(M._areTexturesDirty&&E.texturesEnabled){if(this._thicknessTexture&&S.e.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;if(this._translucencyColorTexture&&S.e.TranslucencyColorTextureEnabled&&!this._translucencyColorTexture.isReadyOrNotBlocking())return!1;if(this._translucencyIntensityTexture&&S.e.TranslucencyIntensityTextureEnabled&&!this._translucencyIntensityTexture.isReadyOrNotBlocking())return!1;const M=this._getRefractionTexture(E);if(M&&S.e.RefractionTextureEnabled&&!M.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(M,E){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return M.SUBSURFACE=!1,M.SS_DISPERSION=!1,M.SS_TRANSLUCENCY=!1,M.SS_SCATTERING=!1,M.SS_REFRACTION=!1,M.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,M.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,M.SS_THICKNESSANDMASK_TEXTURE=!1,M.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,M.SS_HAS_THICKNESS=!1,M.SS_REFRACTIONINTENSITY_TEXTURE=!1,M.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,M.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,M.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,M.SS_REFRACTIONMAP_3D=!1,M.SS_REFRACTIONMAP_OPPOSITEZ=!1,M.SS_LODINREFRACTIONALPHA=!1,M.SS_GAMMAREFRACTION=!1,M.SS_RGBDREFRACTION=!1,M.SS_LINEARSPECULARREFRACTION=!1,M.SS_LINKREFRACTIONTOTRANSPARENCY=!1,M.SS_ALBEDOFORREFRACTIONTINT=!1,M.SS_ALBEDOFORTRANSLUCENCYTINT=!1,M.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,M.SS_USE_THICKNESS_AS_DEPTH=!1,M.SS_USE_GLTF_TEXTURES=!1,M.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,void(M.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0);if(M._areTexturesDirty){if(M.SUBSURFACE=!0,M.SS_DISPERSION=this._isDispersionEnabled,M.SS_TRANSLUCENCY=this._isTranslucencyEnabled,M.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,M.SS_SCATTERING=this._isScatteringEnabled,M.SS_THICKNESSANDMASK_TEXTURE=!1,M.SS_REFRACTIONINTENSITY_TEXTURE=!1,M.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,M.SS_HAS_THICKNESS=!1,M.SS_USE_GLTF_TEXTURES=!1,M.SS_REFRACTION=!1,M.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,M.SS_REFRACTIONMAP_3D=!1,M.SS_GAMMAREFRACTION=!1,M.SS_RGBDREFRACTION=!1,M.SS_LINEARSPECULARREFRACTION=!1,M.SS_REFRACTIONMAP_OPPOSITEZ=!1,M.SS_LODINREFRACTIONALPHA=!1,M.SS_LINKREFRACTIONTOTRANSPARENCY=!1,M.SS_ALBEDOFORREFRACTIONTINT=!1,M.SS_ALBEDOFORTRANSLUCENCYTINT=!1,M.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,M.SS_USE_THICKNESS_AS_DEPTH=!1,M.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,M._areTexturesDirty&&E.texturesEnabled&&(this._thicknessTexture&&S.e.ThicknessTextureEnabled&&(0,U.O)(this._thicknessTexture,M,"SS_THICKNESSANDMASK_TEXTURE"),this._refractionIntensityTexture&&S.e.RefractionIntensityTextureEnabled&&(0,U.O)(this._refractionIntensityTexture,M,"SS_REFRACTIONINTENSITY_TEXTURE"),this._translucencyIntensityTexture&&S.e.TranslucencyIntensityTextureEnabled&&(0,U.O)(this._translucencyIntensityTexture,M,"SS_TRANSLUCENCYINTENSITY_TEXTURE"),this._translucencyColorTexture&&S.e.TranslucencyColorTextureEnabled&&(0,U.O)(this._translucencyColorTexture,M,"SS_TRANSLUCENCYCOLOR_TEXTURE")),M.SS_HAS_THICKNESS=this.maximumThickness-this.minimumThickness!==0,M.SS_USE_GLTF_TEXTURES=this._useGltfStyleTextures,M.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._refractionIntensityTexture,M.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._translucencyIntensityTexture,this._isRefractionEnabled&&E.texturesEnabled){const b=this._getRefractionTexture(E);b&&S.e.RefractionTextureEnabled&&(M.SS_REFRACTION=!0,M.SS_REFRACTIONMAP_3D=b.isCube,M.SS_GAMMAREFRACTION=b.gammaSpace,M.SS_RGBDREFRACTION=b.isRGBD,M.SS_LINEARSPECULARREFRACTION=b.linearSpecularLOD,M.SS_REFRACTIONMAP_OPPOSITEZ=this._scene.useRightHandedSystem&&b.isCube?!b.invertZ:b.invertZ,M.SS_LODINREFRACTIONALPHA=b.lodLevelInAlpha,M.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency,M.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction,M.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=b.isCube&&b.boundingBoxSize,M.SS_USE_THICKNESS_AS_DEPTH=this.useThicknessAsDepth)}this._isTranslucencyEnabled&&(M.SS_ALBEDOFORTRANSLUCENCYTINT=this.useAlbedoToTintTranslucency)}}hardBindForSubMesh(M,E,b,x){if(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled)if(0===this.maximumThickness&&0===this.minimumThickness)M.updateFloat2("vThicknessParam",0,0);else{x.getRenderingMesh().getWorldMatrix().decompose(u.i.Fd[0]);const E=Math.max(Math.abs(u.i.Fd[0].x),Math.abs(u.i.Fd[0].y),Math.abs(u.i.Fd[0].z));M.updateFloat2("vThicknessParam",this.minimumThickness*E,(this.maximumThickness-this.minimumThickness)*E)}}bindForSubMesh(M,E,b,x){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return;const k=x.materialDefines,a=this._material.isFrozen,g=this._material.realTimeFiltering,n=k.LODBASEDMICROSFURACE,J=this._getRefractionTexture(E);if(!M.useUbo||!a||!M.isSync){if(this._thicknessTexture&&S.e.ThicknessTextureEnabled&&(M.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),(0,U.p)(this._thicknessTexture,M,"thickness")),this._refractionIntensityTexture&&S.e.RefractionIntensityTextureEnabled&&k.SS_REFRACTIONINTENSITY_TEXTURE&&(M.updateFloat2("vRefractionIntensityInfos",this._refractionIntensityTexture.coordinatesIndex,this._refractionIntensityTexture.level),(0,U.p)(this._refractionIntensityTexture,M,"refractionIntensity")),this._translucencyColorTexture&&S.e.TranslucencyColorTextureEnabled&&k.SS_TRANSLUCENCYCOLOR_TEXTURE&&(M.updateFloat2("vTranslucencyColorInfos",this._translucencyColorTexture.coordinatesIndex,this._translucencyColorTexture.level),(0,U.p)(this._translucencyColorTexture,M,"translucencyColor")),this._translucencyIntensityTexture&&S.e.TranslucencyIntensityTextureEnabled&&k.SS_TRANSLUCENCYINTENSITY_TEXTURE&&(M.updateFloat2("vTranslucencyIntensityInfos",this._translucencyIntensityTexture.coordinatesIndex,this._translucencyIntensityTexture.level),(0,U.p)(this._translucencyIntensityTexture,M,"translucencyIntensity")),J&&S.e.RefractionTextureEnabled){M.ne("refractionMatrix",J.getRefractionTextureMatrix());let E=1;J.isCube||J.depth&&(E=J.depth);const b=J.getSize().width,x=this.volumeIndexOfRefraction;if(M.updateFloat4("vRefractionInfos",J.level,1/x,E,this._invertRefractionY?-1:1),M.updateFloat4("vRefractionMicrosurfaceInfos",b,J.lodGenerationScale,J.lodGenerationOffset,1/this.indexOfRefraction),g&&M.updateFloat2("vRefractionFilteringInfo",b,Math.log2(b)),J.boundingBoxSize){const E=J;M.updateVector3("vRefractionPosition",E.boundingBoxPosition),M.updateVector3("vRefractionSize",E.boundingBoxSize)}}this._isScatteringEnabled&&M.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex),M.updateColor3("vDiffusionDistance",this.diffusionDistance),M.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintColorAtDistance)),M.updateColor4("vTranslucencyColor",this.translucencyColor??this.tintColor,0),M.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0),M.updateFloat("dispersion",this.dispersion)}E.texturesEnabled&&(this._thicknessTexture&&S.e.ThicknessTextureEnabled&&M.setTexture("thicknessSampler",this._thicknessTexture),this._refractionIntensityTexture&&S.e.RefractionIntensityTextureEnabled&&k.SS_REFRACTIONINTENSITY_TEXTURE&&M.setTexture("refractionIntensitySampler",this._refractionIntensityTexture),this._translucencyIntensityTexture&&S.e.TranslucencyIntensityTextureEnabled&&k.SS_TRANSLUCENCYINTENSITY_TEXTURE&&M.setTexture("translucencyIntensitySampler",this._translucencyIntensityTexture),this._translucencyColorTexture&&S.e.TranslucencyColorTextureEnabled&&k.SS_TRANSLUCENCYCOLOR_TEXTURE&&M.setTexture("translucencyColorSampler",this._translucencyColorTexture),J&&S.e.RefractionTextureEnabled&&(n?M.setTexture("refractionSampler",J):(M.setTexture("refractionSampler",J._lodTextureMid||J),M.setTexture("refractionSamplerLow",J._lodTextureLow||J),M.setTexture("refractionSamplerHigh",J._lodTextureHigh||J))))}_getRefractionTexture(M){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?M.environmentTexture:null}get disableAlphaBlending(){return this._isRefractionEnabled&&this._linkRefractionWithTransparency}fillRenderTargetTextures(M){S.e.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&M.push(this._refractionTexture)}hasTexture(M){return this._thicknessTexture===M||(this._refractionTexture===M||(this._refractionIntensityTexture===M||(this._translucencyIntensityTexture===M||this._translucencyColorTexture===M)))}hasRenderTargetTextures(){return!!(S.e.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)}getActiveTextures(M){this._thicknessTexture&&M.push(this._thicknessTexture),this._refractionTexture&&M.push(this._refractionTexture),this._translucencyColorTexture&&M.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&M.push(this._translucencyIntensityTexture)}getAnimatables(M){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&M.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&M.push(this._refractionTexture),this._translucencyColorTexture&&this._translucencyColorTexture.animations&&this._translucencyColorTexture.animations.length>0&&M.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.animations&&this._translucencyIntensityTexture.animations.length>0&&M.push(this._translucencyIntensityTexture)}dispose(M){M&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose(),this._translucencyColorTexture&&this._translucencyColorTexture.dispose(),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.dispose())}getClassName(){return"PBRSubSurfaceConfiguration"}addFallbacks(M,E,b){return M.SS_SCATTERING&&E.addFallback(b++,"SS_SCATTERING"),M.SS_TRANSLUCENCY&&E.addFallback(b++,"SS_TRANSLUCENCY"),b}getSamplers(M){M.push("thicknessSampler","refractionIntensitySampler","translucencyIntensitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh","translucencyColorSampler")}getUniforms(){return{ubo:[{name:"vRefractionMicrosurfaceInfos",size:4,type:"vec4"},{name:"vRefractionFilteringInfo",size:2,type:"vec2"},{name:"vTranslucencyIntensityInfos",size:2,type:"vec2"},{name:"vRefractionInfos",size:4,type:"vec4"},{name:"refractionMatrix",size:16,type:"mat4"},{name:"vThicknessInfos",size:2,type:"vec2"},{name:"vRefractionIntensityInfos",size:2,type:"vec2"},{name:"thicknessMatrix",size:16,type:"mat4"},{name:"refractionIntensityMatrix",size:16,type:"mat4"},{name:"translucencyIntensityMatrix",size:16,type:"mat4"},{name:"vThicknessParam",size:2,type:"vec2"},{name:"vDiffusionDistance",size:3,type:"vec3"},{name:"vTintColor",size:4,type:"vec4"},{name:"vSubSurfaceIntensity",size:3,type:"vec3"},{name:"vRefractionPosition",size:3,type:"vec3"},{name:"vRefractionSize",size:3,type:"vec3"},{name:"scatteringDiffusionProfile",size:1,type:"float"},{name:"dispersion",size:1,type:"float"},{name:"vTranslucencyColor",size:4,type:"vec4"},{name:"vTranslucencyColorInfos",size:2,type:"vec2"},{name:"translucencyColorMatrix",size:16,type:"mat4"}]}}}(0,x.d)([(0,k.E)(),(0,k.e)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"isRefractionEnabled",void 0),(0,x.d)([(0,k.E)(),(0,k.e)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"isTranslucencyEnabled",void 0),(0,x.d)([(0,k.E)(),(0,k.e)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"isDispersionEnabled",void 0),(0,x.d)([(0,k.E)(),(0,k.e)("_markScenePrePassDirty")],l.prototype,"isScatteringEnabled",void 0),(0,x.d)([(0,k.E)()],l.prototype,"_scatteringDiffusionProfileIndex",void 0),(0,x.d)([(0,k.E)()],l.prototype,"refractionIntensity",void 0),(0,x.d)([(0,k.E)()],l.prototype,"translucencyIntensity",void 0),(0,x.d)([(0,k.E)()],l.prototype,"useAlbedoToTintRefraction",void 0),(0,x.d)([(0,k.E)()],l.prototype,"useAlbedoToTintTranslucency",void 0),(0,x.d)([(0,k.A)(),(0,k.e)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"thicknessTexture",void 0),(0,x.d)([(0,k.A)(),(0,k.e)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"refractionTexture",void 0),(0,x.d)([(0,k.E)(),(0,k.e)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"indexOfRefraction",void 0),(0,x.d)([(0,k.E)()],l.prototype,"_volumeIndexOfRefraction",void 0),(0,x.d)([(0,k.e)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"volumeIndexOfRefraction",null),(0,x.d)([(0,k.E)(),(0,k.e)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"invertRefractionY",void 0),(0,x.d)([(0,k.E)(),(0,k.e)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"linkRefractionWithTransparency",void 0),(0,x.d)([(0,k.E)()],l.prototype,"minimumThickness",void 0),(0,x.d)([(0,k.E)()],l.prototype,"maximumThickness",void 0),(0,x.d)([(0,k.E)()],l.prototype,"useThicknessAsDepth",void 0),(0,x.d)([(0,k.m)()],l.prototype,"tintColor",void 0),(0,x.d)([(0,k.E)()],l.prototype,"tintColorAtDistance",void 0),(0,x.d)([(0,k.E)()],l.prototype,"dispersion",void 0),(0,x.d)([(0,k.m)()],l.prototype,"diffusionDistance",void 0),(0,x.d)([(0,k.E)(),(0,k.e)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"useMaskFromThicknessTexture",void 0),(0,x.d)([(0,k.A)(),(0,k.e)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"refractionIntensityTexture",void 0),(0,x.d)([(0,k.A)(),(0,k.e)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"translucencyIntensityTexture",void 0),(0,x.d)([(0,k.m)()],l.prototype,"translucencyColor",void 0),(0,x.d)([(0,k.A)(),(0,k.e)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"translucencyColorTexture",void 0),(0,x.d)([(0,k.E)(),(0,k.e)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"useGltfStyleTextures",void 0);var d=b(1399),W=b(1373),m=b(1414);const o={effect:null,subMesh:null};class j extends V.d{constructor(M){super(M),this.PBR=!0,this.NUM_SAMPLES="0",this.REALTIME_FILTERING=!1,this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.ALBEDO=!1,this.GAMMAALBEDO=!1,this.ALBEDODIRECTUV=0,this.VERTEXCOLOR=!1,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.AMBIENTINGRAYSCALE=!1,this.OPACITY=!1,this.VERTEXALPHA=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHABLEND=!1,this.ALPHAFROMALBEDO=!1,this.ALPHATESTVALUE="0.5",this.SPECULAROVERALPHA=!1,this.RADIANCEOVERALPHA=!1,this.ALPHAFRESNEL=!1,this.LINEARALPHAFRESNEL=!1,this.PREMULTIPLYALPHA=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.GAMMAEMISSIVE=!1,this.REFLECTIVITY=!1,this.REFLECTIVITY_GAMMA=!1,this.REFLECTIVITYDIRECTUV=0,this.SPECULARTERM=!1,this.MICROSURFACEFROMREFLECTIVITYMAP=!1,this.MICROSURFACEAUTOMATIC=!1,this.LODBASEDMICROSFURACE=!1,this.MICROSURFACEMAP=!1,this.MICROSURFACEMAPDIRECTUV=0,this.METALLICWORKFLOW=!1,this.ROUGHNESSSTOREINMETALMAPALPHA=!1,this.ROUGHNESSSTOREINMETALMAPGREEN=!1,this.METALLNESSSTOREINMETALMAPBLUE=!1,this.AOSTOREINMETALMAPRED=!1,this.METALLIC_REFLECTANCE=!1,this.METALLIC_REFLECTANCE_GAMMA=!1,this.METALLIC_REFLECTANCEDIRECTUV=0,this.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=!1,this.REFLECTANCE=!1,this.REFLECTANCE_GAMMA=!1,this.REFLECTANCEDIRECTUV=0,this.ENVIRONMENTBRDF=!1,this.ENVIRONMENTBRDF_RGBD=!1,this.NORMAL=!1,this.TANGENT=!1,this.BUMP=!1,this.BUMPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.NORMALXYSCALE=!0,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.USELIGHTMAPASSHADOWMAP=!1,this.GAMMALIGHTMAP=!1,this.RGBDLIGHTMAP=!1,this.REFLECTION=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.INVERTCUBICMAP=!1,this.USESPHERICALFROMREFLECTIONMAP=!1,this.USEIRRADIANCEMAP=!1,this.USESPHERICALINVERTEX=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.LODINREFLECTIONALPHA=!1,this.GAMMAREFLECTION=!1,this.RGBDREFLECTION=!1,this.LINEARSPECULARREFLECTION=!1,this.RADIANCEOCCLUSION=!1,this.HORIZONOCCLUSION=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.NONUNIFORMSCALING=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.EXPOSURE=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.USEPHYSICALLIGHTFALLOFF=!1,this.USEGLTFLIGHTFALLOFF=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.LOGARITHMICDEPTH=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.FORCENORMALFORWARD=!1,this.SPECULARAA=!1,this.UNLIT=!1,this.DECAL_AFTER_DETAIL=!1,this.DEBUGMODE=0,this.rebuild()}reset(){super.reset(),this.ALPHATESTVALUE="0.5",this.PBR=!0,this.NORMALXYSCALE=!0}}class s extends R.c{get realTimeFiltering(){return this._realTimeFiltering}set realTimeFiltering(M){this._realTimeFiltering=M,this.ge(1)}get realTimeFilteringQuality(){return this._realTimeFilteringQuality}set realTimeFilteringQuality(M){this._realTimeFilteringQuality=M,this.ge(1)}get canRenderToMRT(){return!0}_attachImageProcessingConfiguration(M){M!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=M||this.va().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}constructor(M,E){super(M,E,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||s.ForceGLSL),this._directIntensity=1,this._emissiveIntensity=1,this._environmentIntensity=1,this._specularIntensity=1,this._lightingInfos=new u.o(this._directIntensity,this._emissiveIntensity,this._environmentIntensity,this._specularIntensity),this._disableBumpMap=!1,this._albedoTexture=null,this._ambientTexture=null,this._ambientTextureStrength=1,this._ambientTextureImpactOnAnalyticalLights=s.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._reflectivityTexture=null,this._metallicTexture=null,this._metallic=null,this._roughness=null,this._metallicF0Factor=1,this._metallicReflectanceColor=r.e.White(),this._useOnlyMetallicFromMetallicReflectanceTexture=!1,this._metallicReflectanceTexture=null,this._reflectanceTexture=null,this._microSurfaceTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._ambientColor=new r.e(0,0,0),this._albedoColor=new r.e(1,1,1),this._reflectivityColor=new r.e(1,1,1),this._reflectionColor=new r.e(1,1,1),this._emissiveColor=new r.e(0,0,0),this._microSurface=.9,this._useLightmapAsShadowmap=!1,this._useHorizonOcclusion=!0,this._useRadianceOcclusion=!0,this._useAlphaFromAlbedoTexture=!1,this._useSpecularOverAlpha=!0,this._useMicroSurfaceFromReflectivityMapAlpha=!1,this._useRoughnessFromMetallicTextureAlpha=!0,this._useRoughnessFromMetallicTextureGreen=!1,this._useMetallnessFromMetallicTextureBlue=!1,this._useAmbientOcclusionFromMetallicTextureRed=!1,this._useAmbientInGrayScale=!1,this._useAutoMicroSurfaceFromReflectivityMap=!1,this._lightFalloff=s.LIGHTFALLOFF_PHYSICAL,this._useRadianceOverAlpha=!0,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this._parallaxScaleBias=.05,this._disableLighting=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._alphaCutOff=.4,this._forceAlphaTest=!1,this._useAlphaFresnel=!1,this._useLinearAlphaFresnel=!1,this._environmentBRDFTexture=null,this._forceIrradianceInFragment=!1,this._realTimeFiltering=!1,this._realTimeFilteringQuality=8,this._forceNormalForward=!1,this._enableSpecularAntiAliasing=!1,this._imageProcessingObserver=null,this._renderTargets=new g.f(16),this._globalAmbientColor=new r.e(0,0,0),this._unlit=!1,this._applyDecalMapAfterDetailMap=!1,this._debugMode=0,this._shadersLoaded=!1,this._breakShaderLoadedCheck=!1,this.debugMode=0,this.debugLimit=-1,this.debugFactor=1,this._cacheHasRenderTargetTextures=!1,this.brdf=new y(this),this.clearCoat=new N(this),this.iridescence=new h(this),this.anisotropy=new O(this),this.sheen=new P(this),this.subSurface=new l(this),this.detailMap=new d.b(this),this._attachImageProcessingConfiguration(null),this.getRenderTargetTextures=()=>(this._renderTargets.reset(),S.e.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets),this._environmentBRDFTexture=(0,n.d)(this.va()),this.prePassConfiguration=new B.d}get hasRenderTargetTextures(){return!!(S.e.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures}get isPrePassCapable(){return!this.disableDepthWrite}getClassName(){return"PBRBaseMaterial"}get _disableAlphaBlending(){var M;return this._transparencyMode===s.PBRMATERIAL_OPAQUE||this._transparencyMode===s.PBRMATERIAL_ALPHATEST||(null===(M=this.subSurface)||void 0===M?void 0:M.disableAlphaBlending)}needAlphaBlending(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())}needAlphaTesting(){var M;return!!this._forceAlphaTest||(null===(M=this.subSurface)||void 0===M||!M.disableAlphaBlending)&&(this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===s.PBRMATERIAL_ALPHATEST))}_shouldUseAlphaFromAlbedoTexture(){return null!=this._albedoTexture&&this._albedoTexture.bc&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==s.PBRMATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._albedoTexture&&this._albedoTexture.bc||null!=this._opacityTexture}getAlphaTestTexture(){return this._albedoTexture}isReadyForSubMesh(M,E,b){this._uniformBufferLayoutBuilt||this.buildUniformLayout();const x=E._drawWrapper;if(x.effect&&this.isFrozen&&x._wasPreviouslyReady&&x._wasPreviouslyUsingInstances===b)return!0;E.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),E.materialDefines=new j(this._eventInfo.defineNames));const k=E.materialDefines;if(this._isReadyForSubMesh(E))return!0;const g=this.va(),n=g.getEngine();if(k._areTexturesDirty&&(this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,g.texturesEnabled)){if(this._albedoTexture&&S.e.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&S.e.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&S.e.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;const M=this._getReflectionTexture();if(M&&S.e.ReflectionTextureEnabled){if(!M.isReadyOrNotBlocking())return!1;var J;if(M.irradianceTexture){if(!M.irradianceTexture.isReadyOrNotBlocking())return!1}else if(!M.sphericalPolynomial&&null!==(J=M.getInternalTexture())&&void 0!==J&&J._sphericalPolynomialPromise)return!1}if(this._lightmapTexture&&S.e.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&S.e.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(S.e.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._metallicReflectanceTexture&&!this._metallicReflectanceTexture.isReadyOrNotBlocking())return!1;if(this._reflectanceTexture&&!this._reflectanceTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(n.getCaps().standardDerivatives&&this._bumpTexture&&S.e.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;if(this._environmentBRDFTexture&&S.e.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=k,this._eventInfo.subMesh=E,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(k._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;n.getCaps().standardDerivatives||M.isVerticesDataPresent(T.g.NormalKind)||(M.createNormals(!0),a.d.Warn("PBRMaterial: Normals have been created for the mesh: "+M.name));const u=E.effect,V=k._areLightsDisposed;let I=this._prepareEffect(M,k,this.onCompiled,this.onError,b,null,E.getRenderingMesh().hasThinInstances),t=!1;if(I)if(this._onEffectCreatedObservable&&(o.effect=I,o.subMesh=E,this._onEffectCreatedObservable.notifyObservers(o)),this.allowShaderHotSwapping&&u&&!I.isReady()){if(I=u,k.markAsUnprocessed(),t=this.isFrozen,V)return k._areLightsDisposed=!0,!1}else g.resetCachedMaterial(),E.setEffect(I,k,this._materialContext);return!(!E.effect||!E.effect.isReady())&&(k._renderId=g.getRenderId(),x._wasPreviouslyReady=!t,x._wasPreviouslyUsingInstances=!!b,this._checkScenePerformancePriority(),!0)}isMetallicWorkflow(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)}_prepareEffect(M,E){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,n=arguments.length>6?arguments[6]:void 0;if(this._prepareDefines(M,E,a,g,n),!E.isDirty)return null;E.markAsProcessed();const J=this.va().getEngine(),u=new X.e;let V=0;E.USESPHERICALINVERTEX&&u.addFallback(V++,"USESPHERICALINVERTEX"),E.FOG&&u.addFallback(V,"FOG"),E.SPECULARAA&&u.addFallback(V,"SPECULARAA"),E.POINTSIZE&&u.addFallback(V,"POINTSIZE"),E.LOGARITHMICDEPTH&&u.addFallback(V,"LOGARITHMICDEPTH"),E.PARALLAX&&u.addFallback(V,"PARALLAX"),E.PARALLAX_RHS&&u.addFallback(V,"PARALLAX_RHS"),E.PARALLAXOCCLUSION&&u.addFallback(V++,"PARALLAXOCCLUSION"),E.ENVIRONMENTBRDF&&u.addFallback(V++,"ENVIRONMENTBRDF"),E.TANGENT&&u.addFallback(V++,"TANGENT"),E.BUMP&&u.addFallback(V++,"BUMP"),V=(0,U.t)(E,u,this._maxSimultaneousLights,V++),E.SPECULARTERM&&u.addFallback(V++,"SPECULARTERM"),E.USESPHERICALFROMREFLECTIONMAP&&u.addFallback(V++,"USESPHERICALFROMREFLECTIONMAP"),E.USEIRRADIANCEMAP&&u.addFallback(V++,"USEIRRADIANCEMAP"),E.LIGHTMAP&&u.addFallback(V++,"LIGHTMAP"),E.NORMAL&&u.addFallback(V++,"NORMAL"),E.AMBIENT&&u.addFallback(V++,"AMBIENT"),E.EMISSIVE&&u.addFallback(V++,"EMISSIVE"),E.VERTEXCOLOR&&u.addFallback(V++,"VERTEXCOLOR"),E.MORPHTARGETS&&u.addFallback(V++,"MORPHTARGETS"),E.MULTIVIEW&&u.addFallback(0,"MULTIVIEW");const I=[T.g.PositionKind];E.NORMAL&&I.push(T.g.NormalKind),E.TANGENT&&I.push(T.g.TangentKind);for(let b=1;b<=6;++b)E["UV"+b]&&I.push(`uv${1===b?"":b}`);E.VERTEXCOLOR&&I.push(T.g.ColorKind),(0,U.y)(I,M,E,u),(0,U.C)(I,E),(0,U.E)(I,M,E),(0,U.x)(I,M,E);let t="pbr";const y=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vReflectionFilteringInfo","vMetallicReflectanceInfos","vReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","albedoMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","reflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vTangentSpaceParams","boneTextureWidth","vDebugMode","morphTargetTextureInfo","morphTargetTextureIndices"],r=["albedoSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler","reflectanceSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],C=["Material","Scene","Mesh"],R={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:E.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=u,this._eventInfo.fallbackRank=V,this._eventInfo.defines=E,this._eventInfo.uniforms=y,this._eventInfo.attributes=I,this._eventInfo.samplers=r,this._eventInfo.uniformBuffersNames=C,this._eventInfo.customCode=void 0,this._eventInfo.mesh=M,this._eventInfo.indexParameters=R,this._callbackPluginEventGeneric(128,this._eventInfo),m.c.AddUniformsAndSamplers(y,r),B.d.AddUniforms(y),B.d.AddSamplers(r),(0,W.b)(y),c.b&&(c.b.PrepareUniforms(y,E),c.b.PrepareSamplers(r,E)),(0,U.Z)({uniformsNames:y,uniformBuffersNames:C,samplers:r,defines:E,maxSimultaneousLights:this._maxSimultaneousLights});const w={};this.customShaderNameResolve&&(t=this.customShaderNameResolve(t,y,C,r,E,I,w));const S=E.toString(),v=J.createEffect(t,{attributes:I,uniformsNames:y,uniformBuffersNames:C,samplers:r,defines:S,fallbacks:u,onCompiled:x,onError:k,indexParameters:R,processFinalCode:w.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:E.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this.shaderLanguage?await Promise.all([Promise.all([b.e(15),b.e(44)]).then(b.bind(b,12822)),Promise.all([b.e(16),b.e(45)]).then(b.bind(b,12844))]):await Promise.all([Promise.all([b.e(21),b.e(46)]).then(b.bind(b,12847)),Promise.all([b.e(23),b.e(47)]).then(b.bind(b,12860))]),this._shadersLoaded=!0}},J);return this._eventInfo.customCode=void 0,v}_prepareDefines(M,E){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,k=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const a=this.va(),g=a.getEngine();(0,U.L)(a,M,E,!0,this._maxSimultaneousLights,this._disableLighting),E._needNormals=!0,(0,U.S)(a,E);const n=this.needAlphaBlendingForMesh(M)&&this.va().useOrderIndependentTransparency;if((0,U.V)(a,E,this.canRenderToMRT&&!n),(0,U.U)(a,E,n),m.c.PrepareDefines(g.currentRenderPassId,M,E),E.METALLICWORKFLOW=this.isMetallicWorkflow(),E._areTexturesDirty){E._needUVs=!1;for(let M=1;M<=6;++M)E["MAINUV"+M]=!1;if(a.texturesEnabled){E.ALBEDODIRECTUV=0,E.AMBIENTDIRECTUV=0,E.OPACITYDIRECTUV=0,E.EMISSIVEDIRECTUV=0,E.REFLECTIVITYDIRECTUV=0,E.MICROSURFACEMAPDIRECTUV=0,E.METALLIC_REFLECTANCEDIRECTUV=0,E.REFLECTANCEDIRECTUV=0,E.BUMPDIRECTUV=0,E.LIGHTMAPDIRECTUV=0,g.getCaps().textureLOD&&(E.LODBASEDMICROSFURACE=!0),this._albedoTexture&&S.e.DiffuseTextureEnabled?((0,U.O)(this._albedoTexture,E,"ALBEDO"),E.GAMMAALBEDO=this._albedoTexture.gammaSpace):E.ALBEDO=!1,this._ambientTexture&&S.e.AmbientTextureEnabled?((0,U.O)(this._ambientTexture,E,"AMBIENT"),E.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):E.AMBIENT=!1,this._opacityTexture&&S.e.OpacityTextureEnabled?((0,U.O)(this._opacityTexture,E,"OPACITY"),E.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):E.OPACITY=!1;const M=this._getReflectionTexture();if(M&&S.e.ReflectionTextureEnabled){switch(E.REFLECTION=!0,E.GAMMAREFLECTION=M.gammaSpace,E.RGBDREFLECTION=M.isRGBD,E.LODINREFLECTIONALPHA=M.lodLevelInAlpha,E.LINEARSPECULARREFLECTION=M.linearSpecularLOD,this.realTimeFiltering&&this.realTimeFilteringQuality>0?(E.NUM_SAMPLES=""+this.realTimeFilteringQuality,g._features.needTypeSuffixInShaderConstants&&(E.NUM_SAMPLES=E.NUM_SAMPLES+"u"),E.REALTIME_FILTERING=!0):E.REALTIME_FILTERING=!1,E.INVERTCUBICMAP=M.coordinatesMode===w.e.INVCUBIC_MODE,E.REFLECTIONMAP_3D=M.isCube,E.REFLECTIONMAP_OPPOSITEZ=E.REFLECTIONMAP_3D&&this.va().useRightHandedSystem?!M.invertZ:M.invertZ,E.REFLECTIONMAP_CUBIC=!1,E.REFLECTIONMAP_EXPLICIT=!1,E.REFLECTIONMAP_PLANAR=!1,E.REFLECTIONMAP_PROJECTION=!1,E.REFLECTIONMAP_SKYBOX=!1,E.REFLECTIONMAP_SPHERICAL=!1,E.REFLECTIONMAP_EQUIRECTANGULAR=!1,E.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,E.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,M.coordinatesMode){case w.e.EXPLICIT_MODE:E.REFLECTIONMAP_EXPLICIT=!0;break;case w.e.PLANAR_MODE:E.REFLECTIONMAP_PLANAR=!0;break;case w.e.PROJECTION_MODE:E.REFLECTIONMAP_PROJECTION=!0;break;case w.e.SKYBOX_MODE:E.REFLECTIONMAP_SKYBOX=!0;break;case w.e.SPHERICAL_MODE:E.REFLECTIONMAP_SPHERICAL=!0;break;case w.e.EQUIRECTANGULAR_MODE:E.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case w.e.FIXED_EQUIRECTANGULAR_MODE:E.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case w.e.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:E.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case w.e.CUBIC_MODE:case w.e.INVCUBIC_MODE:default:E.REFLECTIONMAP_CUBIC=!0,E.USE_LOCAL_REFLECTIONMAP_CUBIC=!!M.boundingBoxSize}M.coordinatesMode!==w.e.SKYBOX_MODE&&(M.irradianceTexture?(E.USEIRRADIANCEMAP=!0,E.USESPHERICALFROMREFLECTIONMAP=!1):M.isCube&&(E.USESPHERICALFROMREFLECTIONMAP=!0,E.USEIRRADIANCEMAP=!1,this._forceIrradianceInFragment||this.realTimeFiltering||this._twoSidedLighting||g.getCaps().maxVaryingVectors<=8?E.USESPHERICALINVERTEX=!1:E.USESPHERICALINVERTEX=!0))}else E.REFLECTION=!1,E.REFLECTIONMAP_3D=!1,E.REFLECTIONMAP_SPHERICAL=!1,E.REFLECTIONMAP_PLANAR=!1,E.REFLECTIONMAP_CUBIC=!1,E.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,E.REFLECTIONMAP_PROJECTION=!1,E.REFLECTIONMAP_SKYBOX=!1,E.REFLECTIONMAP_EXPLICIT=!1,E.REFLECTIONMAP_EQUIRECTANGULAR=!1,E.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,E.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,E.INVERTCUBICMAP=!1,E.USESPHERICALFROMREFLECTIONMAP=!1,E.USEIRRADIANCEMAP=!1,E.USESPHERICALINVERTEX=!1,E.REFLECTIONMAP_OPPOSITEZ=!1,E.LODINREFLECTIONALPHA=!1,E.GAMMAREFLECTION=!1,E.RGBDREFLECTION=!1,E.LINEARSPECULARREFLECTION=!1;this._lightmapTexture&&S.e.LightmapTextureEnabled?((0,U.O)(this._lightmapTexture,E,"LIGHTMAP"),E.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,E.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,E.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):E.LIGHTMAP=!1,this._emissiveTexture&&S.e.EmissiveTextureEnabled?((0,U.O)(this._emissiveTexture,E,"EMISSIVE"),E.GAMMAEMISSIVE=this._emissiveTexture.gammaSpace):E.EMISSIVE=!1,S.e.SpecularTextureEnabled?(this._metallicTexture?((0,U.O)(this._metallicTexture,E,"REFLECTIVITY"),E.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,E.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,E.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,E.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed,E.REFLECTIVITY_GAMMA=!1):this._reflectivityTexture?((0,U.O)(this._reflectivityTexture,E,"REFLECTIVITY"),E.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,E.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap,E.REFLECTIVITY_GAMMA=this._reflectivityTexture.gammaSpace):E.REFLECTIVITY=!1,this._metallicReflectanceTexture||this._reflectanceTexture?(E.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=this._useOnlyMetallicFromMetallicReflectanceTexture,this._metallicReflectanceTexture?((0,U.O)(this._metallicReflectanceTexture,E,"METALLIC_REFLECTANCE"),E.METALLIC_REFLECTANCE_GAMMA=this._metallicReflectanceTexture.gammaSpace):E.METALLIC_REFLECTANCE=!1,this._reflectanceTexture&&(!this._metallicReflectanceTexture||this._metallicReflectanceTexture&&this._useOnlyMetallicFromMetallicReflectanceTexture)?((0,U.O)(this._reflectanceTexture,E,"REFLECTANCE"),E.REFLECTANCE_GAMMA=this._reflectanceTexture.gammaSpace):E.REFLECTANCE=!1):(E.METALLIC_REFLECTANCE=!1,E.REFLECTANCE=!1),this._microSurfaceTexture?(0,U.O)(this._microSurfaceTexture,E,"MICROSURFACEMAP"):E.MICROSURFACEMAP=!1):(E.REFLECTIVITY=!1,E.MICROSURFACEMAP=!1),g.getCaps().standardDerivatives&&this._bumpTexture&&S.e.BumpTextureEnabled&&!this._disableBumpMap?((0,U.O)(this._bumpTexture,E,"BUMP"),this._useParallax&&this._albedoTexture&&S.e.DiffuseTextureEnabled?(E.PARALLAX=!0,E.PARALLAX_RHS=a.useRightHandedSystem,E.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):E.PARALLAX=!1,E.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):(E.BUMP=!1,E.PARALLAX=!1,E.PARALLAX_RHS=!1,E.PARALLAXOCCLUSION=!1,E.OBJECTSPACE_NORMALMAP=!1),this._environmentBRDFTexture&&S.e.ReflectionTextureEnabled?(E.ENVIRONMENTBRDF=!0,E.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(E.ENVIRONMENTBRDF=!1,E.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?E.ALPHAFROMALBEDO=!0:E.ALPHAFROMALBEDO=!1}E.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===s.LIGHTFALLOFF_STANDARD?(E.USEPHYSICALLIGHTFALLOFF=!1,E.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===s.LIGHTFALLOFF_GLTF?(E.USEPHYSICALLIGHTFALLOFF=!1,E.USEGLTFLIGHTFALLOFF=!0):(E.USEPHYSICALLIGHTFALLOFF=!0,E.USEGLTFLIGHTFALLOFF=!1),E.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.je&&this._twoSidedLighting?E.TWOSIDEDLIGHTING=!0:E.TWOSIDEDLIGHTING=!1,E.SPECULARAA=g.getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(E._areTexturesDirty||E._areMiscDirty)&&(E.ALPHATESTVALUE=`${this._alphaCutOff}${this._alphaCutOff%1===0?".":""}`,E.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,E.ALPHABLEND=this.needAlphaBlendingForMesh(M),E.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,E.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),E._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(E),E.FORCENORMALFORWARD=this._forceNormalForward,E.RADIANCEOCCLUSION=this._useRadianceOcclusion,E.HORIZONOCCLUSION=this._useHorizonOcclusion,E._areMiscDirty&&((0,U.Q)(M,a,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(M)||this._forceAlphaTest,E,this._applyDecalMapAfterDetailMap),E.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!M.isVerticesDataPresent(T.g.NormalKind),E.DEBUGMODE=this._debugMode),(0,U.K)(a,g,this,E,!!b,x,k),this._eventInfo.defines=E,this._eventInfo.mesh=M,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,U.H)(M,E,!0,!0,!0,this._transparencyMode!==s.PBRMATERIAL_OPAQUE),this._callbackPluginEventPrepareDefines(this._eventInfo)}forceCompilation(M,E,b){const x={clipPlane:!1,useInstances:!1,...b};this._uniformBufferLayoutBuilt||this.buildUniformLayout(),this._callbackPluginEventGeneric(4,this._eventInfo);(()=>{if(this._breakShaderLoadedCheck)return;const b=new j(this._eventInfo.defineNames),k=this._prepareEffect(M,b,void 0,void 0,x.useInstances,x.clipPlane,M.hasThinInstances);this._onEffectCreatedObservable&&(o.effect=k,o.subMesh=null,this._onEffectCreatedObservable.notifyObservers(o)),k.isReady()?E&&E(this):k.onCompileObservable.add((()=>{E&&E(this)}))})()}buildUniformLayout(){const M=this._uniformBuffer;M.addUniform("vAlbedoInfos",2),M.addUniform("vAmbientInfos",4),M.addUniform("vOpacityInfos",2),M.addUniform("vEmissiveInfos",2),M.addUniform("vLightmapInfos",2),M.addUniform("vReflectivityInfos",3),M.addUniform("vMicroSurfaceSamplerInfos",2),M.addUniform("vReflectionInfos",2),M.addUniform("vReflectionFilteringInfo",2),M.addUniform("vReflectionPosition",3),M.addUniform("vReflectionSize",3),M.addUniform("vBumpInfos",3),M.addUniform("albedoMatrix",16),M.addUniform("ambientMatrix",16),M.addUniform("opacityMatrix",16),M.addUniform("emissiveMatrix",16),M.addUniform("lightmapMatrix",16),M.addUniform("reflectivityMatrix",16),M.addUniform("microSurfaceSamplerMatrix",16),M.addUniform("bumpMatrix",16),M.addUniform("vTangentSpaceParams",2),M.addUniform("reflectionMatrix",16),M.addUniform("vReflectionColor",3),M.addUniform("vAlbedoColor",4),M.addUniform("vLightingIntensity",4),M.addUniform("vReflectionMicrosurfaceInfos",3),M.addUniform("pointSize",1),M.addUniform("vReflectivityColor",4),M.addUniform("vEmissiveColor",3),M.addUniform("vAmbientColor",3),M.addUniform("vDebugMode",2),M.addUniform("vMetallicReflectanceFactors",4),M.addUniform("vMetallicReflectanceInfos",2),M.addUniform("metallicReflectanceMatrix",16),M.addUniform("vReflectanceInfos",2),M.addUniform("reflectanceMatrix",16),M.addUniform("vSphericalL00",3),M.addUniform("vSphericalL1_1",3),M.addUniform("vSphericalL10",3),M.addUniform("vSphericalL11",3),M.addUniform("vSphericalL2_2",3),M.addUniform("vSphericalL2_1",3),M.addUniform("vSphericalL20",3),M.addUniform("vSphericalL21",3),M.addUniform("vSphericalL22",3),M.addUniform("vSphericalX",3),M.addUniform("vSphericalY",3),M.addUniform("vSphericalZ",3),M.addUniform("vSphericalXX_ZZ",3),M.addUniform("vSphericalYY_ZZ",3),M.addUniform("vSphericalZZ",3),M.addUniform("vSphericalXY",3),M.addUniform("vSphericalYZ",3),M.addUniform("vSphericalZX",3),super.buildUniformLayout()}bindForSubMesh(M,E,b){const x=this.va(),k=b.materialDefines;if(!k)return;const a=b.effect;if(!a)return;this._activeEffect=a,E.getMeshUniformBuffer().bindToEffect(a,"Mesh"),E.transferToEffect(M);const g=x.getEngine();this._uniformBuffer.bindToEffect(a,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,x,E,M,this.isFrozen),m.c.Bind(g.currentRenderPassId,this._activeEffect,E,M),this._eventInfo.subMesh=b,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),k.OBJECTSPACE_NORMALMAP&&(M.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const n=this._mustRebind(x,a,b,E.visibility);(0,U.d)(E,this._activeEffect,this.prePassConfiguration);let u=null;const T=this._uniformBuffer;if(n){if(this.bindViewProjection(a),u=this._getReflectionTexture(),!T.useUbo||!this.isFrozen||!T.isSync||b._drawWrapper._forceRebindOnNextCall){var V;if(x.texturesEnabled){if(this._albedoTexture&&S.e.DiffuseTextureEnabled&&(T.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),(0,U.p)(this._albedoTexture,T,"albedo")),this._ambientTexture&&S.e.AmbientTextureEnabled&&(T.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),(0,U.p)(this._ambientTexture,T,"ambient")),this._opacityTexture&&S.e.OpacityTextureEnabled&&(T.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,U.p)(this._opacityTexture,T,"opacity")),u&&S.e.ReflectionTextureEnabled){if(T.ne("reflectionMatrix",u.getReflectionTextureMatrix()),T.updateFloat2("vReflectionInfos",u.level,0),u.boundingBoxSize){const M=u;T.updateVector3("vReflectionPosition",M.boundingBoxPosition),T.updateVector3("vReflectionSize",M.boundingBoxSize)}if(this.realTimeFiltering){const M=u.getSize().width;T.updateFloat2("vReflectionFilteringInfo",M,Math.log2(M))}if(!k.USEIRRADIANCEMAP){const M=u.sphericalPolynomial;if(k.USESPHERICALFROMREFLECTIONMAP&&M)if(k.SPHERICAL_HARMONICS){const E=M.preScaledHarmonics;T.updateVector3("vSphericalL00",E.l00),T.updateVector3("vSphericalL1_1",E.l1_1),T.updateVector3("vSphericalL10",E.l10),T.updateVector3("vSphericalL11",E.l11),T.updateVector3("vSphericalL2_2",E.l2_2),T.updateVector3("vSphericalL2_1",E.l2_1),T.updateVector3("vSphericalL20",E.l20),T.updateVector3("vSphericalL21",E.l21),T.updateVector3("vSphericalL22",E.l22)}else T.updateFloat3("vSphericalX",M.x.x,M.x.y,M.x.z),T.updateFloat3("vSphericalY",M.y.x,M.y.y,M.y.z),T.updateFloat3("vSphericalZ",M.z.x,M.z.y,M.z.z),T.updateFloat3("vSphericalXX_ZZ",M.xx.x-M.zz.x,M.xx.y-M.zz.y,M.xx.z-M.zz.z),T.updateFloat3("vSphericalYY_ZZ",M.yy.x-M.zz.x,M.yy.y-M.zz.y,M.yy.z-M.zz.z),T.updateFloat3("vSphericalZZ",M.zz.x,M.zz.y,M.zz.z),T.updateFloat3("vSphericalXY",M.xy.x,M.xy.y,M.xy.z),T.updateFloat3("vSphericalYZ",M.yz.x,M.yz.y,M.yz.z),T.updateFloat3("vSphericalZX",M.zx.x,M.zx.y,M.zx.z)}T.updateFloat3("vReflectionMicrosurfaceInfos",u.getSize().width,u.lodGenerationScale,u.lodGenerationOffset)}this._emissiveTexture&&S.e.EmissiveTextureEnabled&&(T.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,U.p)(this._emissiveTexture,T,"emissive")),this._lightmapTexture&&S.e.LightmapTextureEnabled&&(T.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,U.p)(this._lightmapTexture,T,"lightmap")),S.e.SpecularTextureEnabled&&(this._metallicTexture?(T.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),(0,U.p)(this._metallicTexture,T,"reflectivity")):this._reflectivityTexture&&(T.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),(0,U.p)(this._reflectivityTexture,T,"reflectivity")),this._metallicReflectanceTexture&&(T.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level),(0,U.p)(this._metallicReflectanceTexture,T,"metallicReflectance")),this._reflectanceTexture&&k.REFLECTANCE&&(T.updateFloat2("vReflectanceInfos",this._reflectanceTexture.coordinatesIndex,this._reflectanceTexture.level),(0,U.p)(this._reflectanceTexture,T,"reflectance")),this._microSurfaceTexture&&(T.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),(0,U.p)(this._microSurfaceTexture,T,"microSurfaceSampler"))),this._bumpTexture&&g.getCaps().standardDerivatives&&S.e.BumpTextureEnabled&&!this._disableBumpMap&&(T.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),(0,U.p)(this._bumpTexture,T,"bump"),x._mirroredCameraPosition?T.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):T.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&T.updateFloat("pointSize",this.pointSize),k.METALLICWORKFLOW){var I;r.i.te[0].r=void 0===this._metallic||null===this._metallic?1:this._metallic,r.i.te[0].g=void 0===this._roughness||null===this._roughness?1:this._roughness,T.updateColor4("vReflectivityColor",r.i.te[0],1);const M=(null===(I=this.subSurface)||void 0===I?void 0:I._indexOfRefraction)??1.5,E=1,b=Math.pow((M-E)/(M+E),2);this._metallicReflectanceColor.scaleToRef(b*this._metallicF0Factor,r.i.te[0]);const x=this._metallicF0Factor;T.updateColor4("vMetallicReflectanceFactors",r.i.te[0],x)}else T.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);T.updateColor3("vEmissiveColor",S.e.EmissiveTextureEnabled?this._emissiveColor:r.e.BlackReadOnly),T.updateColor3("vReflectionColor",this._reflectionColor),!k.SS_REFRACTION&&null!==(V=this.subSurface)&&void 0!==V&&V._linkRefractionWithTransparency?T.updateColor4("vAlbedoColor",this._albedoColor,1):T.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*x.environmentIntensity,this._lightingInfos.w=this._specularIntensity,T.updateVector4("vLightingIntensity",this._lightingInfos),x.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor),T.updateColor3("vAmbientColor",this._globalAmbientColor),T.updateFloat2("vDebugMode",this.debugLimit,this.debugFactor)}x.texturesEnabled&&(this._albedoTexture&&S.e.DiffuseTextureEnabled&&T.setTexture("albedoSampler",this._albedoTexture),this._ambientTexture&&S.e.AmbientTextureEnabled&&T.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&S.e.OpacityTextureEnabled&&T.setTexture("opacitySampler",this._opacityTexture),u&&S.e.ReflectionTextureEnabled&&(k.LODBASEDMICROSFURACE?T.setTexture("reflectionSampler",u):(T.setTexture("reflectionSampler",u._lodTextureMid||u),T.setTexture("reflectionSamplerLow",u._lodTextureLow||u),T.setTexture("reflectionSamplerHigh",u._lodTextureHigh||u)),k.USEIRRADIANCEMAP&&T.setTexture("irradianceSampler",u.irradianceTexture)),k.ENVIRONMENTBRDF&&T.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&S.e.EmissiveTextureEnabled&&T.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&S.e.LightmapTextureEnabled&&T.setTexture("lightmapSampler",this._lightmapTexture),S.e.SpecularTextureEnabled&&(this._metallicTexture?T.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&T.setTexture("reflectivitySampler",this._reflectivityTexture),this._metallicReflectanceTexture&&T.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture),this._reflectanceTexture&&k.REFLECTANCE&&T.setTexture("reflectanceSampler",this._reflectanceTexture),this._microSurfaceTexture&&T.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&g.getCaps().standardDerivatives&&S.e.BumpTextureEnabled&&!this._disableBumpMap&&T.setTexture("bumpSampler",this._bumpTexture)),this.va().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(E)&&this.va().depthPeelingRenderer.bind(a),this._eventInfo.subMesh=b,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,W.e)(this._activeEffect,this,x),this.bindEyePosition(a)}else x.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(n||!this.isFrozen){var t;if(x.lightsEnabled&&!this._disableLighting&&(0,U.g)(x,E,this._activeEffect,k,this._maxSimultaneousLights),(x.fogEnabled&&E.applyFog&&x.fogMode!==J.d.FOGMODE_NONE||u||this.subSurface.refractionTexture||E.receiveShadows||k.PREPASS)&&this.bindView(a),(0,U.e)(x,E,this._activeEffect,!0),k.NUM_MORPH_INFLUENCERS&&(0,U.l)(E,this._activeEffect),k.BAKED_VERTEX_ANIMATION_TEXTURE)null===(t=E.bakedVertexAnimationManager)||void 0===t||t.bind(a,k.INSTANCES);this._imageProcessingConfiguration.bind(this._activeEffect),(0,U.k)(k,this._activeEffect,x)}this._afterBind(E,this._activeEffect,b),T.update()}getAnimatables(){const M=super.getAnimatables();return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&M.push(this._albedoTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&M.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&M.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&M.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&M.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?M.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&M.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&M.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&M.push(this._lightmapTexture),this._metallicReflectanceTexture&&this._metallicReflectanceTexture.animations&&this._metallicReflectanceTexture.animations.length>0&&M.push(this._metallicReflectanceTexture),this._reflectanceTexture&&this._reflectanceTexture.animations&&this._reflectanceTexture.animations.length>0&&M.push(this._reflectanceTexture),this._microSurfaceTexture&&this._microSurfaceTexture.animations&&this._microSurfaceTexture.animations.length>0&&M.push(this._microSurfaceTexture),M}_getReflectionTexture(){return this._reflectionTexture?this._reflectionTexture:this.va().environmentTexture}getActiveTextures(){const M=super.getActiveTextures();return this._albedoTexture&&M.push(this._albedoTexture),this._ambientTexture&&M.push(this._ambientTexture),this._opacityTexture&&M.push(this._opacityTexture),this._reflectionTexture&&M.push(this._reflectionTexture),this._emissiveTexture&&M.push(this._emissiveTexture),this._reflectivityTexture&&M.push(this._reflectivityTexture),this._metallicTexture&&M.push(this._metallicTexture),this._metallicReflectanceTexture&&M.push(this._metallicReflectanceTexture),this._reflectanceTexture&&M.push(this._reflectanceTexture),this._microSurfaceTexture&&M.push(this._microSurfaceTexture),this._bumpTexture&&M.push(this._bumpTexture),this._lightmapTexture&&M.push(this._lightmapTexture),M}hasTexture(M){return!!super.hasTexture(M)||(this._albedoTexture===M||(this._ambientTexture===M||(this._opacityTexture===M||(this._reflectionTexture===M||(this._emissiveTexture===M||(this._reflectivityTexture===M||(this._metallicTexture===M||(this._metallicReflectanceTexture===M||(this._reflectanceTexture===M||(this._microSurfaceTexture===M||(this._bumpTexture===M||this._lightmapTexture===M)))))))))))}setPrePassRenderer(){var M;if(null===(M=this.subSurface)||void 0===M||!M.isScatteringEnabled)return!1;const E=this.va().enableSubSurfaceForPrePass();return E&&(E.enabled=!0),!0}dispose(M,E){var b,x,k,a,g,n,J,u,T,V,I,t;(this._breakShaderLoadedCheck=!0,E)&&(this._environmentBRDFTexture&&this.va().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),null===(b=this._albedoTexture)||void 0===b||b.dispose(),null===(x=this._ambientTexture)||void 0===x||x.dispose(),null===(k=this._opacityTexture)||void 0===k||k.dispose(),null===(a=this._reflectionTexture)||void 0===a||a.dispose(),null===(g=this._emissiveTexture)||void 0===g||g.dispose(),null===(n=this._metallicTexture)||void 0===n||n.dispose(),null===(J=this._reflectivityTexture)||void 0===J||J.dispose(),null===(u=this._bumpTexture)||void 0===u||u.dispose(),null===(T=this._lightmapTexture)||void 0===T||T.dispose(),null===(V=this._metallicReflectanceTexture)||void 0===V||V.dispose(),null===(I=this._reflectanceTexture)||void 0===I||I.dispose(),null===(t=this._microSurfaceTexture)||void 0===t||t.dispose());this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(M,E)}}s.PBRMATERIAL_OPAQUE=C.e.MATERIAL_OPAQUE,s.PBRMATERIAL_ALPHATEST=C.e.MATERIAL_ALPHATEST,s.PBRMATERIAL_ALPHABLEND=C.e.MATERIAL_ALPHABLEND,s.PBRMATERIAL_ALPHATESTANDBLEND=C.e.MATERIAL_ALPHATESTANDBLEND,s.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,s.LIGHTFALLOFF_PHYSICAL=0,s.LIGHTFALLOFF_GLTF=1,s.LIGHTFALLOFF_STANDARD=2,s.ForceGLSL=!1,(0,x.d)([(0,k.s)()],s.prototype,"_imageProcessingConfiguration",void 0),(0,x.d)([(0,k.e)("_markAllSubMeshesAsMiscDirty")],s.prototype,"debugMode",void 0)},12164:(M,E,b)=>{"use strict";b.d(E,{e:()=>I});var x=b(948),k=b(953),a=b(1176),g=b(970),n=b(1015),J=b(942),u=b(989),T=b(962),V=b(1124);b(1559);class I extends n.e{set boundingBoxSize(M){if(this._boundingBoxSize&&this._boundingBoxSize.equals(M))return;this._boundingBoxSize=M;const E=this.va();E&&E.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(M){this._rotationY=M,this.setReflectionTextureMatrix(g.d.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(M,E,b){let x="";return M.forEach((M=>x+=M)),new I(x,E,null,b,M)}static CreateFromPrefilteredData(M,E){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,x=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const k=E.useDelayedTextureLoading;E.useDelayedTextureLoading=!1;const a=new I(M,E,null,!1,null,null,null,void 0,!0,b,x);return E.useDelayedTextureLoading=k,a}constructor(M,E){var b;let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,k=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,V=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,I=arguments.length>8&&void 0!==arguments[8]&&arguments[8],t=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,y=arguments.length>10&&void 0!==arguments[10]&&arguments[10],B=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,r=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,c=arguments.length>13?arguments[13]:void 0,C=arguments.length>14?arguments[14]:void 0;super(E),this.onLoadObservable=new T.b,this.boundingBoxPosition=g.m.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new g.d,this._buffer=null,this.name=M,this.url=M,this._noMipmap=k,this.bc=!1,this.isCube=!0,this._textureMatrix=g.d.Identity(),this.coordinatesMode=J.e.CUBIC_MODE;let R=null,w=null;null===x||Array.isArray(x)?(this._noMipmap=k,this._format=V,this._createPolynomials=y,R=x,this._loaderOptions=c,this._useSRGBBuffer=C,this._lodScale=B,this._lodOffset=r):(R=x.extensions??null,this._noMipmap=x.noMipmap??!1,a=x.files??null,w=x.buffer??null,this._format=x.format??5,I=x.prefiltered??!1,t=x.forcedExtension??null,this._createPolynomials=x.createPolynomials??!1,this._lodScale=x.lodScale??.8,this._lodOffset=x.lodOffset??0,this._loaderOptions=x.loaderOptions,this._useSRGBBuffer=x.useSRGBBuffer,n=x.X??null,u=x.onError??null),(M||a)&&this.updateURL(M,t,n,I,u,R,null===(b=this.va())||void 0===b?void 0:b.useDelayedTextureLoading,a,w)}getClassName(){return"CubeTexture"}updateURL(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,x=arguments.length>3&&void 0!==arguments[3]&&arguments[3],k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,g=arguments.length>6&&void 0!==arguments[6]&&arguments[6],n=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,J=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=M),this.url=M,E&&(this._forcedExtension=E);const u=M.lastIndexOf("."),T=E||(u>-1?M.substring(u).toLowerCase():""),V=0===T.indexOf(".dds"),I=0===T.indexOf(".env"),t=0===T.indexOf(".basis");if(I?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=x,x&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),n)this._files=n;else if(t||I||V||a||(a=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,a){for(let E=0;E<a.length;E++)this._files.push(M+a[E]);this._extensions=a}this._buffer=J,g?(this.delayLoadState=4,this._delayedOnLoad=b,this._delayedOnError=k):this._loadTexture(b,k)}delayLoad(M){4===this.delayLoadState&&(M&&(this._forcedExtension=M),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(M){var E,b;if(M.updateFlag===this._textureMatrix.updateFlag)return;M.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(b=this.va())||void 0===b||b.markAllMaterialsAsDirty(1,(M=>-1!==M.getActiveTextures().indexOf(this))));if(this._textureMatrix=M,null===(E=this.va())||void 0===E||!E.useRightHandedSystem)return;const x=g.i.Fd[0],k=g.i.Quaternion[0],a=g.i.Fd[1];this._textureMatrix.decompose(x,k,a),k.z*=-1,k.w*=-1,g.d.ComposeToRef(x,k,a,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var M;return null!==(M=this.va())&&void 0!==M&&M.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const b=this.va(),x=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const k=()=>{var E;(this.onLoadObservable.notifyObservers(this),x)&&(x.dispose(),null===(E=this.va())||void 0===E||E.markAllMaterialsAsDirty(1));M&&M()},g=(M,b)=>{this._loadingError=!0,this._errorObject={message:M,exception:b},E&&E(M,b),J.e.OnTextureLoadErrorObservable.notifyObservers(this)};var n;this._texture?this._texture.isReady?a.e.SetImmediate((()=>k())):this._texture.onLoadedObservable.add((()=>k())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,b,this._lodScale,this._lodOffset,M,g,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,b,this._files,this._noMipmap,M,g,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(n=this._texture)||void 0===n||n.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(M,E,b){const x=V.b.Parse((()=>{let x=!1;return M.prefiltered&&(x=M.prefiltered),new I(b+(M.url??M.name),E,M.extensions,!1,M.files||null,null,null,void 0,x,M.forcedExtension)}),M,E);if(M.boundingBoxPosition&&(x.boundingBoxPosition=g.m.Id(M.boundingBoxPosition)),M.boundingBoxSize&&(x.boundingBoxSize=g.m.Id(M.boundingBoxSize)),M.animations)for(let k=0;k<M.animations.length;k++){const E=M.animations[k],b=(0,u.e)("BABYLON.Animation");b&&x.animations.push(b.Parse(E))}return x}clone(){let M=0;const E=V.b.Clone((()=>{const E=new I(this.url,this.va()||this._getEngine(),this._extensions,this._noMipmap,this._files);return M=E.uniqueId,E}),this);return E.uniqueId=M,E}}(0,x.d)([(0,k.E)()],I.prototype,"url",void 0),(0,x.d)([(0,k.C)()],I.prototype,"boundingBoxPosition",void 0),(0,x.d)([(0,k.C)()],I.prototype,"boundingBoxSize",null),(0,x.d)([(0,k.E)("rotationY")],I.prototype,"rotationY",null),(0,x.d)([(0,k.E)("files")],I.prototype,"_files",void 0),(0,x.d)([(0,k.E)("forcedExtension")],I.prototype,"_forcedExtension",void 0),(0,x.d)([(0,k.E)("extensions")],I.prototype,"_extensions",void 0),(0,x.d)([(0,k.t)("textureMatrix")],I.prototype,"_textureMatrix",void 0),(0,x.d)([(0,k.t)("textureMatrixRefraction")],I.prototype,"_textureMatrixRefraction",void 0),J.e._CubeTextureParser=I.Parse,(0,u.h)("BABYLON.CubeTexture",I)},12532:(M,E,b)=>{"use strict";b.d(E,{b:()=>J});var x=b(1060),k=b(942),a=b(1188),g=b(1433),n=b(1104);g.ThinEngine.prototype.createDynamicTexture=function(M,E,b,x){const k=new n.c(this,4);return k.baseWidth=M,k.baseHeight=E,b&&(M=this.needPOTTextures?(0,a.d)(M,this._caps.maxTextureSize):M,E=this.needPOTTextures?(0,a.d)(E,this._caps.maxTextureSize):E),k.width=M,k.height=E,k.isReady=!1,k.generateMipMaps=b,k.samplingMode=x,this.updateTextureSamplingMode(x,k),this._internalTexturesCache.push(k),k},g.ThinEngine.prototype.updateDynamicTexture=function(M,E,b){let x=arguments.length>3&&void 0!==arguments[3]&&arguments[3],k=arguments.length>4?arguments[4]:void 0,a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!M)return;const g=this._gl,n=g.TEXTURE_2D,J=this._bindTextureDirectly(n,M,!0,a);this._unpackFlipY(void 0===b?M.invertY:b),x&&g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const u=this._getWebGLTextureType(M.type),T=this._getInternalFormat(k||M.format),V=this._getRGBABufferInternalSizedFormat(M.type,T);g.texImage2D(n,0,V,T,u,E),M.generateMipMaps&&g.generateMipmap(n),J||this._bindTextureDirectly(n,null),x&&g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),k&&(M.format=k),M._dynamicTextureSource=E,M._premulAlpha=x,M.invertY=b||!1,M.isReady=!0};class J extends k.e{constructor(M,E,b){let x=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,n=arguments.length>6?arguments[6]:void 0;const J=!b||b._isScene;super(null,J?b:null===b||void 0===b?void 0:b.Ae,J?!x:b,n,a,void 0,void 0,void 0,void 0,g),this.name=M,this.wrapU=k.e.CLAMP_ADDRESSMODE,this.wrapV=k.e.CLAMP_ADDRESSMODE,this._generateMipMaps=x;const u=this._getEngine();if(!u)return;if(E.getContext)this._canvas=E,this._ownCanvas=!1,this._texture=u.createDynamicTexture(this._canvas.width,this._canvas.height,x,a);else{this._canvas=u.createCanvas(1,1),this._ownCanvas=!0;const M=E;M.width||0===M.width?this._texture=u.createDynamicTexture(M.width,M.height,x,a):this._texture=u.createDynamicTexture(E,E,x,a)}const T=this.getSize();this._canvas.width!==T.width&&(this._canvas.width=T.width),this._canvas.height!==T.height&&(this._canvas.height=T.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(M){this._canvas.width=M.width,this._canvas.height=M.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(M.width,M.height,this._generateMipMaps,this.samplingMode)}scale(M){const E=this.getSize();E.width*=M,E.height*=M,this._recreate(E)}scaleTo(M,E){const b=this.getSize();b.width=M,b.height=E,this._recreate(b)}getContext(){return this._context}clear(M){const E=this.getSize();M&&(this._context.fillStyle=M),this._context.clearRect(0,0,E.width,E.height)}update(M){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===M||M,E,this._format||void 0,void 0,b)}drawText(M,E,b,x,k,a,g){let n=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const J=this.getSize();if(a&&(this._context.fillStyle=a,this._context.fillRect(0,0,J.width,J.height)),this._context.font=x,null===E||void 0===E){const b=this._context.measureText(M);E=(J.width-b.width)/2}if(null===b||void 0===b){const M=parseInt(x.replace(/\D/g,""));b=J.height/2+M/3.65}this._context.fillStyle=k||"",this._context.fillText(M,E,b),n&&this.update(g)}dispose(){var M,E;(super.dispose(),this._ownCanvas)&&(null===(M=this._canvas)||void 0===M||null===(E=M.remove)||void 0===E||E.call(M));this._canvas=null,this._context=null}clone(){const M=this.va();if(!M)return this;const E=this.getSize(),b=new J(this.name,E,M,this._generateMipMaps);return b.bc=this.bc,b.level=this.level,b.wrapU=this.wrapU,b.wrapV=this.wrapV,b}serialize(){const M=this.va();M&&!M.isReady()&&x.d.Warn("The scene must be ready before serializing the dynamic texture");const E=super.serialize();return J._IsCanvasElement(this._canvas)&&(E.base64String=this._canvas.toDataURL()),E.invertY=this._invertY,E.samplingMode=this.samplingMode,E}static _IsCanvasElement(M){return void 0!==M.toDataURL}_rebuild(){this.update()}}},11701:(M,E,b)=>{"use strict";b.d(E,{c:()=>k});var x=b(942);class k extends x.e{constructor(M,E,b,k,a){let g=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],n=arguments.length>6&&void 0!==arguments[6]&&arguments[6],J=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,T=arguments.length>9?arguments[9]:void 0,V=arguments.length>10?arguments[10]:void 0;super(null,a,!g,n,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,T),this.format=k,this._engine&&(this._engine._caps.textureFloatLinearFiltering||1!==u||(J=1),this._engine._caps.textureHalfFloatLinearFiltering||2!==u||(J=1),this._texture=this._engine.createRawTexture(M,E,b,k,g,n,J,null,u,T??0,V??!1),this.wrapU=x.e.CLAMP_ADDRESSMODE,this.wrapV=x.e.CLAMP_ADDRESSMODE)}update(M){this._getEngine().updateRawTexture(this._texture,M,this._texture.format,this._texture.invertY,null,this._texture.type,this._texture._useSRGBBuffer)}clone(){if(!this._texture)return super.clone();const M=new k(null,this.getSize().width,this.getSize().height,this.format,this.va(),this._texture.generateMipMaps,this._invertY,this.samplingMode,this._texture.type,this._texture._creationFlags,this._useSRGBBuffer);return M._texture=this._texture,this._texture.incrementReferences(),M}static CreateLuminanceTexture(M,E,b,x){return new k(M,E,b,1,x,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateLuminanceAlphaTexture(M,E,b,x){return new k(M,E,b,2,x,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateAlphaTexture(M,E,b,x){return new k(M,E,b,0,x,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateRGBTexture(M,E,b,x){return new k(M,E,b,4,x,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBATexture(M,E,b,x){return new k(M,E,b,5,x,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBAStorageTexture(M,E,b,x){return new k(M,E,b,5,x,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,1,arguments.length>8&&void 0!==arguments[8]&&arguments[8])}static CreateRTexture(M,E,b,a){let g=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],n=arguments.length>5&&void 0!==arguments[5]&&arguments[5],J=arguments.length>6&&void 0!==arguments[6]?arguments[6]:x.e.TRILINEAR_SAMPLINGMODE;return new k(M,E,b,6,a,g,n,J,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1)}static CreateRStorageTexture(M,E,b,a){let g=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],n=arguments.length>5&&void 0!==arguments[5]&&arguments[5],J=arguments.length>6&&void 0!==arguments[6]?arguments[6]:x.e.TRILINEAR_SAMPLINGMODE;return new k(M,E,b,6,a,g,n,J,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,1)}}},11580:(M,E,b)=>{"use strict";b.d(E,{e:()=>g});var x=b(1326),k=b(1126),a=b(989);class g extends x.e{get vg(){return this._subMaterials}set vg(M){this._subMaterials=M,this._hookArray(M)}getChildren(){return this.vg}constructor(M,E){super(M,E,!0),this._waitingSubMaterialsUniqueIds=[],this.va().addMultiMaterial(this),this.vg=[],this._storeEffectOnSubMeshes=!0}_hookArray(M){var E=this;const b=M.push;M.push=function(){for(var x=arguments.length,k=new Array(x),a=0;a<x;a++)k[a]=arguments[a];const g=b.apply(M,k);return E._markAllSubMeshesAsTexturesDirty(),g};const x=M.splice;M.splice=(E,b)=>{const k=x.apply(M,[E,b]);return this._markAllSubMeshesAsTexturesDirty(),k}}getSubMaterial(M){return M<0||M>=this.vg.length?this.va().defaultMaterial:this.vg[M]}getActiveTextures(){return super.getActiveTextures().concat(...this.vg.map((M=>M?M.getActiveTextures():[])))}hasTexture(M){if(super.hasTexture(M))return!0;for(let b=0;b<this.vg.length;b++){var E;if(null!==(E=this.vg[b])&&void 0!==E&&E.hasTexture(M))return!0}return!1}getClassName(){return"MultiMaterial"}isReadyForSubMesh(M,E,b){for(let x=0;x<this.vg.length;x++){const k=this.vg[x];if(k){if(k._storeEffectOnSubMeshes){if(!k.isReadyForSubMesh(M,E,b))return!1;continue}if(!k.isReady(M))return!1}}return!0}clone(M,E){const b=new g(M,this.va());for(let x=0;x<this.vg.length;x++){let k=null;const a=this.vg[x];k=E&&a?a.clone(M+"-"+a.name):this.vg[x],b.vg.push(k)}return b}serialize(){const M={};M.name=this.name,M.id=this.id,M.uniqueId=this.uniqueId,k.b&&(M.tags=k.b.GetTags(this)),M.materialsUniqueIds=[],M.materials=[];for(let E=0;E<this.vg.length;E++){const b=this.vg[E];b?(M.materialsUniqueIds.push(b.uniqueId),M.materials.push(b.id)):(M.materialsUniqueIds.push(null),M.materials.push(null))}return M}dispose(M,E,b){const x=this.va();if(!x)return;if(b)for(let a=0;a<this.vg.length;a++){const b=this.vg[a];b&&b.dispose(M,E)}const k=x.multiMaterials.indexOf(this);k>=0&&x.multiMaterials.splice(k,1),super.dispose(M,E)}static ParseMultiMaterial(M,E){const b=new g(M.name,E);return b.id=M.id,b._loadedUniqueId=M.uniqueId,k.b&&k.b.AddTagsTo(b,M.tags),M.materialsUniqueIds?b._waitingSubMaterialsUniqueIds=M.materialsUniqueIds:M.materials.forEach((M=>b.vg.push(E.getLastMaterialById(M)))),b}}(0,a.h)("BABYLON.MultiMaterial",g)},11585:(M,E,b)=>{"use strict";b.d(E,{d:()=>T,h:()=>u});var x=b(970),k=b(1133),a=b(11537),g=b(11557),n=b(1152);b(11591);function J(M){let E=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const b=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],a=[];let J=[];const u=M.width||M.size||1,T=M.height||M.size||1,V=M.depth||M.size||1,I=M.wrap||!1;let t=void 0===M.topBaseAt?1:M.topBaseAt,y=void 0===M.bottomBaseAt?0:M.bottomBaseAt;t=(t+4)%4,y=(y+4)%4;let B=[2,0,3,1][t],r=[2,0,1,3][y],c=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(I){E=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],c=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let M=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],b=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const x=[17,18,19,16],k=[22,23,20,21];for(;B>0;)M.unshift(M.pop()),x.unshift(x.pop()),B--;for(;r>0;)b.unshift(b.pop()),k.unshift(k.pop()),r--;M=M.flat(),b=b.flat(),c=c.concat(M).concat(b),E.push(x[0],x[2],x[3],x[0],x[1],x[2]),E.push(k[0],k[2],k[3],k[0],k[1],k[2])}const C=[u/2,T/2,V/2];J=c.reduce(((M,E,b)=>M.concat(E*C[b%3])),[]);const R=0===M.sideOrientation?0:M.sideOrientation||g.d.DEFAULTSIDE,w=M.faceUV||new Array(6),S=M.faceColors,X=[];for(let g=0;g<6;g++)void 0===w[g]&&(w[g]=new x.o(0,0,1,1)),S&&void 0===S[g]&&(S[g]=new k.h(1,1,1,1));for(let x=0;x<6;x++)if(a.push(w[x].z,n.c?1-w[x].w:w[x].w),a.push(w[x].x,n.c?1-w[x].w:w[x].w),a.push(w[x].x,n.c?1-w[x].y:w[x].y),a.push(w[x].z,n.c?1-w[x].y:w[x].y),S)for(let M=0;M<4;M++)X.push(S[x].r,S[x].g,S[x].b,S[x].a);g.d._ComputeSides(R,J,E,b,a,M.frontUVs,M.backUVs);const U=new g.d;if(U.indices=E,U.xa=J,U.ya=b,U.Aa=a,S){const M=R===g.d.DOUBLESIDE?X.concat(X):X;U.za=M}return U}function u(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const x=new a.e(M,b);E.sideOrientation=a.e._GetDefaultSideOrientation(E.sideOrientation),x._originalBuilderSideOrientation=E.sideOrientation;return J(E).Ca(x,E.updatable),x}const T={CreateBox:u};g.d.CreateBox=J,a.e.CreateBox=function(M,E){return u(M,{size:E,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},11719:(M,E,b)=>{"use strict";b.d(E,{c:()=>n});var x=b(11537),k=b(11557),a=b(1152);function g(M){const E=[],b=[],x=[],g=[],n=M.i||.5,J=M.Qk||64,u=M.arc&&(M.arc<=0||M.arc>1)?1:M.arc||1,T=0===M.sideOrientation?0:M.sideOrientation||k.d.DEFAULTSIDE;E.push(0,0,0),g.push(.5,.5);const V=2*Math.PI*u,I=1===u?V/J:V/(J-1);let t=0;for(let k=0;k<J;k++){const M=Math.cos(t),b=Math.sin(t),x=(M+1)/2,k=(1-b)/2;E.push(n*M,n*b,0),g.push(x,a.c?1-k:k),t+=I}1===u&&(E.push(E[3],E[4],E[5]),g.push(g[2],a.c?1-g[3]:g[3]));const y=E.length/3;for(let k=1;k<y-1;k++)b.push(k+1,0,k);k.d.ComputeNormals(E,b,x),k.d._ComputeSides(T,E,b,x,g,M.frontUVs,M.backUVs);const B=new k.d;return B.indices=b,B.xa=E,B.ya=x,B.Aa=g,B}function n(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const k=new x.e(M,b);E.sideOrientation=x.e._GetDefaultSideOrientation(E.sideOrientation),k._originalBuilderSideOrientation=E.sideOrientation;return g(E).Ca(k,E.updatable),k}k.d.nb=g,x.e.nb=function(M,E,b){return n(M,{i:E,Qk:b,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},11591:(M,E,b)=>{"use strict";b.d(E,{e:()=>r,d:()=>C,i:()=>c});var x=b(970),k=b(1133),a=b(11537),g=b(11557),n=b(1228);a.e._GroundMeshParser=(M,E)=>J.Parse(M,E);class J extends a.e{constructor(M,E){super(M,E),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=M,this._subdivisionsY=M,this.subdivide(M);const b=this;b.createOrUpdateSubmeshesOctree&&b.createOrUpdateSubmeshesOctree(E)}getHeightAtCoordinates(M,E){const b=this.getWorldMatrix(),k=x.i.Matrix[5];b.invertToRef(k);const a=x.i.Fd[8];if(x.m.TransformCoordinatesFromFloatsToRef(M,0,E,k,a),M=a.x,E=a.z,M<this._minX||M>=this._maxX||E<=this._minZ||E>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const g=this._getFacetAt(M,E),n=-(g.x*M+g.z*E+g.w)/g.y;return x.m.TransformCoordinatesFromFloatsToRef(0,n,0,b,a),a.y}getNormalAtCoordinates(M,E){const b=new x.m(0,1,0);return this.getNormalAtCoordinatesToRef(M,E,b),b}getNormalAtCoordinatesToRef(M,E,b){const k=this.getWorldMatrix(),a=x.i.Matrix[5];k.invertToRef(a);const g=x.i.Fd[8];if(x.m.TransformCoordinatesFromFloatsToRef(M,0,E,a,g),M=g.x,E=g.z,M<this._minX||M>this._maxX||E<this._minZ||E>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const n=this._getFacetAt(M,E);return x.m.TransformNormalFromFloatsToRef(n.x,n.y,n.z,k,b),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(M,E){const b=Math.floor((M+this._maxX)*this._subdivisionsX/this._width),x=Math.floor(-(E+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),k=this._heightQuads[x*this._subdivisionsX+b];let a;return a=E<k.slope.x*M+k.slope.y?k.facet1:k.facet2,a}_initHeightQuads(){const M=this._subdivisionsX,E=this._subdivisionsY;this._heightQuads=new Array;for(let b=0;b<E;b++)for(let E=0;E<M;E++){const k={slope:x.l.Zero(),facet1:new x.o(0,0,0,0),facet2:new x.o(0,0,0,0)};this._heightQuads[b*M+E]=k}return this}_computeHeightQuads(){const M=this.getVerticesData(n.g.PositionKind);if(!M)return this;const E=x.i.Fd[3],b=x.i.Fd[2],k=x.i.Fd[1],a=x.i.Fd[0],g=x.i.Fd[4],J=x.i.Fd[5],u=x.i.Fd[6],T=x.i.Fd[7],V=x.i.Fd[8];let I=0,t=0,y=0,B=0,r=0,c=0,C=0;const R=this._subdivisionsX,w=this._subdivisionsY;for(let n=0;n<w;n++)for(let w=0;w<R;w++){I=3*w,t=n*(R+1)*3,y=(n+1)*(R+1)*3,E.x=M[t+I],E.y=M[t+I+1],E.z=M[t+I+2],b.x=M[t+I+3],b.y=M[t+I+4],b.z=M[t+I+5],k.x=M[y+I],k.y=M[y+I+1],k.z=M[y+I+2],a.x=M[y+I+3],a.y=M[y+I+4],a.z=M[y+I+5],B=(a.z-E.z)/(a.x-E.x),r=E.z-B*E.x,b.subtractToRef(E,g),k.subtractToRef(E,J),a.subtractToRef(E,u),x.m.CrossToRef(u,J,T),x.m.CrossToRef(g,u,V),T.normalize(),V.normalize(),c=-(T.x*E.x+T.y*E.y+T.z*E.z),C=-(V.x*b.x+V.y*b.y+V.z*b.z);const S=this._heightQuads[n*R+w];S.slope.Hd(B,r),S.facet1.Hd(T.x,T.y,T.z,c),S.facet2.Hd(V.x,V.y,V.z,C)}return this}serialize(M){super.serialize(M),M.subdivisionsX=this._subdivisionsX,M.subdivisionsY=this._subdivisionsY,M.minX=this._minX,M.maxX=this._maxX,M.bj=this._minZ,M.maxZ=this._maxZ,M.width=this._width,M.height=this._height}static Parse(M,E){const b=new J(M.name,E);return b._subdivisionsX=M.subdivisionsX||1,b._subdivisionsY=M.subdivisionsY||1,b._minX=M.minX,b._maxX=M.maxX,b._minZ=M.bj,b._maxZ=M.maxZ,b._width=M.width,b._height=M.height,b}}var u=b(1176),T=b(1005),V=b(977),I=b(1152);function t(M){const E=[],b=[],k=[],a=[];let n,J;const u=M.width||M.size||1,T=M.height||M.size||1,V=0|(M.subdivisionsX||M.subdivisions||1),t=0|(M.subdivisionsY||M.subdivisions||1);for(n=0;n<=t;n++)for(J=0;J<=V;J++){const M=new x.m(J*u/V-u/2,0,(t-n)*T/t-T/2),E=new x.m(0,1,0);b.push(M.x,M.y,M.z),k.push(E.x,E.y,E.z),a.push(J/V,I.c?n/t:1-n/t)}for(n=0;n<t;n++)for(J=0;J<V;J++)E.push(J+1+(n+1)*(V+1)),E.push(J+1+n*(V+1)),E.push(J+n*(V+1)),E.push(J+(n+1)*(V+1)),E.push(J+1+(n+1)*(V+1)),E.push(J+n*(V+1));const y=new g.d;return y.indices=E,y.xa=b,y.ya=k,y.Aa=a,y}function y(M){const E=void 0!==M.xmin&&null!==M.xmin?M.xmin:-1,b=void 0!==M.zmin&&null!==M.zmin?M.zmin:-1,k=void 0!==M.xmax&&null!==M.xmax?M.xmax:1,a=void 0!==M.zmax&&null!==M.zmax?M.zmax:1,n=M.subdivisions||{w:1,h:1},J=M.precision||{w:1,h:1},u=[],T=[],V=[],I=[];let t,y,B,r;n.h=n.h<1?1:n.h,n.w=n.w<1?1:n.w,J.w=J.w<1?1:J.w,J.h=J.h<1?1:J.h;const c=(k-E)/n.w,C=(a-b)/n.h;function R(M,E,b,k){const a=T.length/3,g=J.w+1;for(t=0;t<J.h;t++)for(y=0;y<J.w;y++){const M=[a+y+t*g,a+(y+1)+t*g,a+(y+1)+(t+1)*g,a+y+(t+1)*g];u.push(M[1]),u.push(M[2]),u.push(M[3]),u.push(M[0]),u.push(M[1]),u.push(M[3])}const n=x.m.Zero(),B=new x.m(0,1,0);for(t=0;t<=J.h;t++)for(n.z=t*(k-E)/J.h+E,y=0;y<=J.w;y++)n.x=y*(b-M)/J.w+M,n.y=0,T.push(n.x,n.y,n.z),V.push(B.x,B.y,B.z),I.push(y/J.w,t/J.h)}for(B=0;B<n.h;B++)for(r=0;r<n.w;r++)R(E+r*c,b+B*C,E+(r+1)*c,b+(B+1)*C);const w=new g.d;return w.indices=u,w.xa=T,w.ya=V,w.Aa=I,w}function B(M){const E=[],b=[],a=[],n=[];let J,u;const T=M.colorFilter||new k.e(.3,.59,.11),I=M.alphaFilter||0;let t=!1;if(M.minHeight>M.maxHeight){t=!0;const E=M.maxHeight;M.maxHeight=M.minHeight,M.minHeight=E}for(J=0;J<=M.subdivisions;J++)for(u=0;u<=M.subdivisions;u++){const E=new x.m(u*M.width/M.subdivisions-M.width/2,0,(M.subdivisions-J)*M.height/M.subdivisions-M.height/2),k=4*(((E.x+M.width/2)/M.width*(M.bufferWidth-1)|0)+((1-(E.z+M.height/2)/M.height)*(M.bufferHeight-1)|0)*M.bufferWidth);let g=M.buffer[k]/255,y=M.buffer[k+1]/255,B=M.buffer[k+2]/255;const r=M.buffer[k+3]/255;t&&(g=1-g,y=1-y,B=1-B);const c=g*T.r+y*T.g+B*T.b;E.y=r>=I?M.minHeight+(M.maxHeight-M.minHeight)*c:M.minHeight-V.b,M.heightBuffer&&(M.heightBuffer[J*(M.subdivisions+1)+u]=E.y),b.push(E.x,E.y,E.z),a.push(0,0,0),n.push(u/M.subdivisions,1-J/M.subdivisions)}for(J=0;J<M.subdivisions;J++)for(u=0;u<M.subdivisions;u++){const x=u+1+(J+1)*(M.subdivisions+1),k=u+1+J*(M.subdivisions+1),a=u+J*(M.subdivisions+1),g=u+(J+1)*(M.subdivisions+1),n=b[3*x+1]>=M.minHeight,T=b[3*k+1]>=M.minHeight,V=b[3*a+1]>=M.minHeight;n&&T&&V&&(E.push(x),E.push(k),E.push(a));b[3*g+1]>=M.minHeight&&n&&V&&(E.push(g),E.push(x),E.push(a))}g.d.ComputeNormals(b,E,a);const y=new g.d;return y.indices=E,y.xa=b,y.ya=a,y.Aa=n,y}function r(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const b=new J(M,arguments.length>2?arguments[2]:void 0);b._setReady(!1),b._subdivisionsX=E.subdivisionsX||E.subdivisions||1,b._subdivisionsY=E.subdivisionsY||E.subdivisions||1,b._width=E.width||1,b._height=E.height||1,b._maxX=b._width/2,b._maxZ=b._height/2,b._minX=-b._maxX,b._minZ=-b._maxZ;return t(E).Ca(b,E.updatable),b._setReady(!0),b}function c(M,E){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const x=new a.e(M,b);return y(E).Ca(x,E.updatable),x}function C(M,E){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const a=b.width||10,g=b.height||10,n=b.subdivisions||1,V=b.minHeight||0,I=b.maxHeight||1,t=b.colorFilter||new k.e(.3,.59,.11),y=b.alphaFilter||0,r=b.updatable,c=b.onReady;x=x||T.b.LastCreatedScene;const C=new J(M,x);let R;C._subdivisionsX=n,C._subdivisionsY=n,C._width=a,C._height=g,C._maxX=C._width/2,C._maxZ=C._height/2,C._minX=-C._maxX,C._minZ=-C._maxZ,C._setReady(!1),b.passHeightBufferInCallback&&(R=new Float32Array((n+1)*(n+1)));const w=(M,E,b)=>{B({width:a,height:g,subdivisions:n,minHeight:V,maxHeight:I,colorFilter:t,buffer:M,bufferWidth:E,bufferHeight:b,alphaFilter:y,heightBuffer:R}).Ca(C,r),c&&c(C,R),C._setReady(!0)};if("string"===typeof E){const M=M=>{var E;const b=M.width,k=M.height;if(x.u)return;const a=null===(E=x)||void 0===E?void 0:E.getEngine().resizeImageBitmap(M,b,k);w(a,b,k)};u.e.LoadImage(E,M,b.onError?b.onError:()=>{},x.offlineProvider)}else w(E.data,E.width,E.height);return C}g.d.CreateGround=t,g.d.CreateTiledGround=y,g.d.CreateGroundFromHeightMap=B,a.e.CreateGround=(M,E,b,x,k,a)=>r(M,{width:E,height:b,subdivisions:x,updatable:a},k),a.e.CreateTiledGround=(M,E,b,x,k,a,g,n,J)=>c(M,{xmin:E,zmin:b,xmax:x,zmax:k,subdivisions:a,precision:g,updatable:J},n),a.e.CreateGroundFromHeightMap=(M,E,b,x,k,a,g,n,J,u,T)=>C(M,E,{width:b,height:x,subdivisions:k,minHeight:a,maxHeight:g,updatable:J,onReady:u,alphaFilter:T},n)},12525:(M,E,b)=>{"use strict";b.d(E,{d:()=>O,h:()=>h,l:()=>Z});var x=b(970),k=b(11537),a=b(11557),g=b(1133),n=b(1228),J=b(12144),u=b(1326),T=b(1124),V=b(1171),I=b(942),t=b(989),y=b(1397),B=b(1026),r=b(1386),c=b(1005),C=b(1373),R=b(1367);const w={effect:null,subMesh:null};class S extends r.c{constructor(M,E,b){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(M,E,!(arguments.length>4&&void 0!==arguments[4])||arguments[4]),this._textures={},this._textureArrays={},this._externalTextures={},this._floats={},this._ints={},this._uints={},this._floatsArrays={},this._colors3={},this._colors3Arrays={},this._colors4={},this._colors4Arrays={},this._vectors2={},this._vectors3={},this._vectors4={},this._quaternions={},this._quaternionsArrays={},this._matrices={},this._matrixArrays={},this._matrices3x3={},this._matrices2x2={},this._vectors2Arrays={},this._vectors3Arrays={},this._vectors4Arrays={},this._uniformBuffers={},this._textureSamplers={},this._storageBuffers={},this._cachedWorldViewMatrix=new x.d,this._cachedWorldViewProjectionMatrix=new x.d,this._multiview=!1,this._materialHelperNeedsPreviousMatrices=!1,this._shaderPath=b,this._options={needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","de","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],externalTextures:[],samplerObjects:[],storageBuffers:[],defines:[],useClipPlane:!1,...k}}get shaderPath(){return this._shaderPath}set shaderPath(M){this._shaderPath=M}get options(){return this._options}get isMultiview(){return this._multiview}getClassName(){return"ShaderMaterial"}needAlphaBlending(){return this.alpha<1||this._options.needAlphaBlending}needAlphaTesting(){return this._options.needAlphaTesting}_checkUniform(M){-1===this._options.uniforms.indexOf(M)&&this._options.uniforms.push(M)}setTexture(M,E){return-1===this._options.samplers.indexOf(M)&&this._options.samplers.push(M),this._textures[M]=E,this}removeTexture(M){delete this._textures[M]}setTextureArray(M,E){return-1===this._options.samplers.indexOf(M)&&this._options.samplers.push(M),this._checkUniform(M),this._textureArrays[M]=E,this}setExternalTexture(M,E){return-1===this._options.externalTextures.indexOf(M)&&this._options.externalTextures.push(M),this._externalTextures[M]=E,this}setFloat(M,E){return this._checkUniform(M),this._floats[M]=E,this}setInt(M,E){return this._checkUniform(M),this._ints[M]=E,this}setUInt(M,E){return this._checkUniform(M),this._uints[M]=E,this}setFloats(M,E){return this._checkUniform(M),this._floatsArrays[M]=E,this}setColor3(M,E){return this._checkUniform(M),this._colors3[M]=E,this}setColor3Array(M,E){return this._checkUniform(M),this._colors3Arrays[M]=E.reduce(((M,E)=>(E.toArray(M,M.length),M)),[]),this}setColor4(M,E){return this._checkUniform(M),this._colors4[M]=E,this}setColor4Array(M,E){return this._checkUniform(M),this._colors4Arrays[M]=E.reduce(((M,E)=>(E.toArray(M,M.length),M)),[]),this}setVector2(M,E){return this._checkUniform(M),this._vectors2[M]=E,this}setVector3(M,E){return this._checkUniform(M),this._vectors3[M]=E,this}setVector4(M,E){return this._checkUniform(M),this._vectors4[M]=E,this}setQuaternion(M,E){return this._checkUniform(M),this._quaternions[M]=E,this}setQuaternionArray(M,E){return this._checkUniform(M),this._quaternionsArrays[M]=E.reduce(((M,E)=>(E.toArray(M,M.length),M)),[]),this}setMatrix(M,E){return this._checkUniform(M),this._matrices[M]=E,this}setMatrices(M,E){this._checkUniform(M);const b=new Float32Array(16*E.length);for(let x=0;x<E.length;x++){E[x].copyToArray(b,16*x)}return this._matrixArrays[M]=b,this}setMatrix3x3(M,E){return this._checkUniform(M),this._matrices3x3[M]=E,this}setMatrix2x2(M,E){return this._checkUniform(M),this._matrices2x2[M]=E,this}setArray2(M,E){return this._checkUniform(M),this._vectors2Arrays[M]=E,this}setArray3(M,E){return this._checkUniform(M),this._vectors3Arrays[M]=E,this}setArray4(M,E){return this._checkUniform(M),this._vectors4Arrays[M]=E,this}setUniformBuffer(M,E){return-1===this._options.uniformBuffers.indexOf(M)&&this._options.uniformBuffers.push(M),this._uniformBuffers[M]=E,this}setTextureSampler(M,E){return-1===this._options.samplerObjects.indexOf(M)&&this._options.samplerObjects.push(M),this._textureSamplers[M]=E,this}setStorageBuffer(M,E){return-1===this._options.storageBuffers.indexOf(M)&&this._options.storageBuffers.push(M),this._storageBuffers[M]=E,this}setDefine(M,E){const b=M.trimEnd()+" ",x=this.options.defines.findIndex((E=>E===M||E.startsWith(b)));return x>=0&&this.options.defines.splice(x,1),("boolean"!==typeof E||E)&&this.options.defines.push(b+E),this}isReadyForSubMesh(M,E,b){return this.isReady(M,b,E)}isReady(M,E,b){var x;const k=b&&this._storeEffectOnSubMeshes;if(this.isFrozen){const M=k?b._drawWrapper:this._drawWrapper;if(M.effect&&M._wasPreviouslyReady&&M._wasPreviouslyUsingInstances===E)return!0}const a=this.va(),g=a.getEngine(),J=[],u=[],T=new y.e;let I=this._shaderPath,t=this._options.uniforms,B=this._options.uniformBuffers,r=this._options.samplers;g.getCaps().multiview&&a.activeCamera&&a.activeCamera.outputRenderTarget&&a.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,J.push("#define MULTIVIEW"),-1!==t.indexOf("viewProjection")&&-1===t.indexOf("viewProjectionR")&&t.push("viewProjectionR"));for(let n=0;n<this._options.defines.length;n++){const M=0===this._options.defines[n].indexOf("#define")?this._options.defines[n]:`#define ${this._options.defines[n]}`;J.push(M)}for(let n=0;n<this._options.attributes.length;n++)u.push(this._options.attributes[n]);if(M&&M.isVerticesDataPresent(n.g.ColorKind)&&(-1===u.indexOf(n.g.ColorKind)&&u.push(n.g.ColorKind),J.push("#define VERTEXCOLOR")),E&&(J.push("#define INSTANCES"),(0,R.bb)(u,this._materialHelperNeedsPreviousMatrices),null!==M&&void 0!==M&&M.hasThinInstances&&(J.push("#define THIN_INSTANCES"),M&&M.isVerticesDataPresent(n.g.ColorInstanceKind)&&(u.push(n.g.ColorInstanceKind),J.push("#define INSTANCESCOLOR")))),M&&M.useBones&&M.computeBonesUsingShaders&&M.skeleton){u.push(n.g.MatricesIndicesKind),u.push(n.g.MatricesWeightsKind),M.numBoneInfluencers>4&&(u.push(n.g.MatricesIndicesExtraKind),u.push(n.g.MatricesWeightsExtraKind));const E=M.skeleton;J.push("#define NUM_BONE_INFLUENCERS "+M.numBoneInfluencers),T.addCPUSkinningFallback(0,M),E.isUsingTextureForMatrices?(J.push("#define BONETEXTURE"),-1===t.indexOf("boneTextureWidth")&&t.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(J.push("#define BonesPerMesh "+(E.bones.length+1)),-1===t.indexOf("mBones")&&t.push("mBones"))}else J.push("#define NUM_BONE_INFLUENCERS 0");let c=0;const S=M?M.morphTargetManager:null;if(S){const M=S.supportsUVs&&-1!==J.indexOf("#define UV1"),E=S.supportsTangents&&-1!==J.indexOf("#define TANGENT"),b=S.supportsNormals&&-1!==J.indexOf("#define NORMAL");c=S.numMaxInfluencers||S.numInfluencers,M&&J.push("#define MORPHTARGETS_UV"),E&&J.push("#define MORPHTARGETS_TANGENT"),b&&J.push("#define MORPHTARGETS_NORMAL"),c>0&&J.push("#define MORPHTARGETS"),S.isUsingTextureForTargets&&(J.push("#define MORPHTARGETS_TEXTURE"),-1===t.indexOf("morphTargetTextureIndices")&&t.push("morphTargetTextureIndices"),-1===this._options.samplers.indexOf("morphTargets")&&this._options.samplers.push("morphTargets")),J.push("#define NUM_MORPH_INFLUENCERS "+c);for(let x=0;x<c;x++)u.push(n.g.PositionKind+x),b&&u.push(n.g.NormalKind+x),E&&u.push(n.g.TangentKind+x),M&&u.push(n.g.UVKind+"_"+x);c>0&&(t=t.slice(),t.push("morphTargetInfluences"),t.push("morphTargetCount"),t.push("morphTargetTextureInfo"),t.push("morphTargetTextureIndices"))}else J.push("#define NUM_MORPH_INFLUENCERS 0");if(M){const E=M.bakedVertexAnimationManager;E&&E.isEnabled&&(J.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),-1===t.indexOf("bakedVertexAnimationSettings")&&t.push("bakedVertexAnimationSettings"),-1===t.indexOf("bakedVertexAnimationTextureSizeInverted")&&t.push("bakedVertexAnimationTextureSizeInverted"),-1===t.indexOf("bakedVertexAnimationTime")&&t.push("bakedVertexAnimationTime"),-1===this._options.samplers.indexOf("bakedVertexAnimationTexture")&&this._options.samplers.push("bakedVertexAnimationTexture")),(0,R.x)(u,M,J)}for(const n in this._textures)if(!this._textures[n].isReady())return!1;M&&this._shouldTurnAlphaTestOn(M)&&J.push("#define ALPHATEST"),!1!==this._options.useClipPlane&&((0,C.b)(t),(0,C.k)(this,a,J)),a.fogEnabled&&null!==M&&void 0!==M&&M.applyFog&&a.fogMode!==V.d.FOGMODE_NONE&&(J.push("#define FOG"),-1===t.indexOf("view")&&t.push("view"),-1===t.indexOf("vFogInfos")&&t.push("vFogInfos"),-1===t.indexOf("vFogColor")&&t.push("vFogColor")),this._useLogarithmicDepth&&(J.push("#define LOGARITHMICDEPTH"),-1===t.indexOf("logarithmicDepthConstant")&&t.push("logarithmicDepthConstant")),this.customShaderNameResolve&&(t=t.slice(),B=B.slice(),r=r.slice(),I=this.customShaderNameResolve(this.name,t,B,r,J,u));const X=k?b._getDrawWrapper(void 0,!0):this._drawWrapper,U=(null===X||void 0===X?void 0:X.effect)??null,v=(null===X||void 0===X?void 0:X.defines)??null,N=J.join("\n");let K=U;return v!==N&&(K=g.createEffect(I,{attributes:u,uniformsNames:t,uniformBuffersNames:B,samplers:r,defines:N,fallbacks:T,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousMorphTargets:c},shaderLanguage:this._options.shaderLanguage,extraInitializationsAsync:this._options.extraInitializationsAsync},g),k?b.setEffect(K,N,this._materialContext):X&&X.setEffect(K,N),this._onEffectCreatedObservable&&(w.effect=K,w.subMesh=b??(null===M||void 0===M?void 0:M.Td[0])??null,this._onEffectCreatedObservable.notifyObservers(w))),X._wasPreviouslyUsingInstances=!!E,!((null===(x=K)||void 0===x||!x.isReady())??1)&&(U!==K&&a.resetCachedMaterial(),X._wasPreviouslyReady=!0,!0)}bindOnlyWorldMatrix(M,E){const b=this.va(),x=E??this.getEffect();x&&(-1!==this._options.uniforms.indexOf("world")&&x.setMatrix("world",M),-1!==this._options.uniforms.indexOf("worldView")&&(M.multiplyToRef(b.getViewMatrix(),this._cachedWorldViewMatrix),x.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==this._options.uniforms.indexOf("worldViewProjection")&&(M.multiplyToRef(b.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),x.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)),-1!==this._options.uniforms.indexOf("view")&&x.setMatrix("view",b.getViewMatrix()))}bindForSubMesh(M,E,b){var x;this.bind(M,E,null===(x=b._drawWrapperOverride)||void 0===x?void 0:x.effect,b)}bind(M,E,b,x){const k=x&&this._storeEffectOnSubMeshes,a=b??(k?x.effect:this.getEffect());if(!a)return;const g=this.va();this._activeEffect=a,this.bindOnlyWorldMatrix(M,b);const n=this._options.uniformBuffers;let J=!1;if(a&&n&&n.length>0&&g.getEngine().supportsUniformBuffers)for(let V=0;V<n.length;++V){switch(n[V]){case"Mesh":E&&(E.getMeshUniformBuffer().bindToEffect(a,"Mesh"),E.transferToEffect(M));break;case"Scene":(0,R.m)(a,g.getSceneUniformBuffer()),g.finalizeSceneUbo(),J=!0}}const u=E&&k?this._mustRebind(g,a,x,E.visibility):g.getCachedMaterial()!==this;if(a&&u){let M;for(M in J||-1===this._options.uniforms.indexOf("view")||a.setMatrix("view",g.getViewMatrix()),J||-1===this._options.uniforms.indexOf("projection")||a.setMatrix("projection",g.getProjectionMatrix()),J||-1===this._options.uniforms.indexOf("viewProjection")||(a.setMatrix("viewProjection",g.getTransformMatrix()),this._multiview&&a.setMatrix("viewProjectionR",g._transformMatrixR)),g.activeCamera&&-1!==this._options.uniforms.indexOf("cameraPosition")&&a.setVector3("cameraPosition",g.activeCamera.globalPosition),(0,R.d)(E,a),(0,C.e)(a,this,g),this._useLogarithmicDepth&&(0,R.k)(k?x.materialDefines:a.defines,a,g),E&&(0,R.e)(g,E,a),this._textures)a.setTexture(M,this._textures[M]);for(M in this._textureArrays)a.setTextureArray(M,this._textureArrays[M]);for(M in this._ints)a.setInt(M,this._ints[M]);for(M in this._uints)a.setUInt(M,this._uints[M]);for(M in this._floats)a.setFloat(M,this._floats[M]);for(M in this._floatsArrays)a.setArray(M,this._floatsArrays[M]);for(M in this._colors3)a.setColor3(M,this._colors3[M]);for(M in this._colors3Arrays)a.setArray3(M,this._colors3Arrays[M]);for(M in this._colors4){const E=this._colors4[M];a.setFloat4(M,E.r,E.g,E.b,E.a)}for(M in this._colors4Arrays)a.setArray4(M,this._colors4Arrays[M]);for(M in this._vectors2)a.setVector2(M,this._vectors2[M]);for(M in this._vectors3)a.setVector3(M,this._vectors3[M]);for(M in this._vectors4)a.setVector4(M,this._vectors4[M]);for(M in this._quaternions)a.setQuaternion(M,this._quaternions[M]);for(M in this._matrices)a.setMatrix(M,this._matrices[M]);for(M in this._matrixArrays)a.setMatrices(M,this._matrixArrays[M]);for(M in this._matrices3x3)a.setMatrix3x3(M,this._matrices3x3[M]);for(M in this._matrices2x2)a.setMatrix2x2(M,this._matrices2x2[M]);for(M in this._vectors2Arrays)a.setArray2(M,this._vectors2Arrays[M]);for(M in this._vectors3Arrays)a.setArray3(M,this._vectors3Arrays[M]);for(M in this._vectors4Arrays)a.setArray4(M,this._vectors4Arrays[M]);for(M in this._quaternionsArrays)a.setArray4(M,this._quaternionsArrays[M]);for(M in this._uniformBuffers){const E=this._uniformBuffers[M].getBuffer();E&&a.bindUniformBuffer(E,M)}const b=g.getEngine(),n=b.setExternalTexture;if(n)for(M in this._externalTextures)n.call(b,M,this._externalTextures[M]);const u=b.setTextureSampler;if(u)for(M in this._textureSamplers)u.call(b,M,this._textureSamplers[M]);const T=b.setStorageBuffer;if(T)for(M in this._storageBuffers)T.call(b,M,this._storageBuffers[M])}if(a&&E&&(u||!this.isFrozen)){const M=E.morphTargetManager;M&&M.numInfluencers>0&&(0,R.l)(E,a);const b=E.bakedVertexAnimationManager;if(b&&b.isEnabled){var T;const M=k?x._drawWrapper:this._drawWrapper;null===(T=E.bakedVertexAnimationManager)||void 0===T||T.bind(a,!!M._wasPreviouslyUsingInstances)}}this._afterBind(E,a,x)}getActiveTextures(){const M=super.getActiveTextures();for(const E in this._textures)M.push(this._textures[E]);for(const E in this._textureArrays){const b=this._textureArrays[E];for(let E=0;E<b.length;E++)M.push(b[E])}return M}hasTexture(M){if(super.hasTexture(M))return!0;for(const E in this._textures)if(this._textures[E]===M)return!0;for(const E in this._textureArrays){const b=this._textureArrays[E];for(let E=0;E<b.length;E++)if(b[E]===M)return!0}return!1}clone(M){const E=T.b.Clone((()=>new S(M,this.va(),this._shaderPath,this._options,this._storeEffectOnSubMeshes)),this);E.name=M,E.id=M,"object"===typeof E._shaderPath&&(E._shaderPath={...E._shaderPath}),this._options={...this._options},Object.keys(this._options).forEach((M=>{const E=this._options[M];Array.isArray(E)&&(this._options[M]=E.slice(0))})),this.stencil.copyTo(E.stencil);for(const b in this._textures)E.setTexture(b,this._textures[b]);for(const b in this._textureArrays)E.setTextureArray(b,this._textureArrays[b]);for(const b in this._externalTextures)E.setExternalTexture(b,this._externalTextures[b]);for(const b in this._ints)E.setInt(b,this._ints[b]);for(const b in this._uints)E.setUInt(b,this._uints[b]);for(const b in this._floats)E.setFloat(b,this._floats[b]);for(const b in this._floatsArrays)E.setFloats(b,this._floatsArrays[b]);for(const b in this._colors3)E.setColor3(b,this._colors3[b]);for(const b in this._colors3Arrays)E._colors3Arrays[b]=this._colors3Arrays[b];for(const b in this._colors4)E.setColor4(b,this._colors4[b]);for(const b in this._colors4Arrays)E._colors4Arrays[b]=this._colors4Arrays[b];for(const b in this._vectors2)E.setVector2(b,this._vectors2[b]);for(const b in this._vectors3)E.setVector3(b,this._vectors3[b]);for(const b in this._vectors4)E.setVector4(b,this._vectors4[b]);for(const b in this._quaternions)E.setQuaternion(b,this._quaternions[b]);for(const b in this._quaternionsArrays)E._quaternionsArrays[b]=this._quaternionsArrays[b];for(const b in this._matrices)E.setMatrix(b,this._matrices[b]);for(const b in this._matrixArrays)E._matrixArrays[b]=this._matrixArrays[b].slice();for(const b in this._matrices3x3)E.setMatrix3x3(b,this._matrices3x3[b]);for(const b in this._matrices2x2)E.setMatrix2x2(b,this._matrices2x2[b]);for(const b in this._vectors2Arrays)E.setArray2(b,this._vectors2Arrays[b]);for(const b in this._vectors3Arrays)E.setArray3(b,this._vectors3Arrays[b]);for(const b in this._vectors4Arrays)E.setArray4(b,this._vectors4Arrays[b]);for(const b in this._uniformBuffers)E.setUniformBuffer(b,this._uniformBuffers[b]);for(const b in this._textureSamplers)E.setTextureSampler(b,this._textureSamplers[b]);for(const b in this._storageBuffers)E.setStorageBuffer(b,this._storageBuffers[b]);return E}dispose(M,E,b){if(E){let M;for(M in this._textures)this._textures[M].dispose();for(M in this._textureArrays){const E=this._textureArrays[M];for(let M=0;M<E.length;M++)E[M].dispose()}}this._textures={},super.dispose(M,E,b)}serialize(){const M=T.b.Serialize(this);let E;for(E in M.customType="BABYLON.ShaderMaterial",M.uniqueId=this.uniqueId,M.options=this._options,M.shaderPath=this._shaderPath,M.storeEffectOnSubMeshes=this._storeEffectOnSubMeshes,M.stencil=this.stencil.serialize(),M.textures={},this._textures)M.textures[E]=this._textures[E].serialize();for(E in M.textureArrays={},this._textureArrays){M.textureArrays[E]=[];const b=this._textureArrays[E];for(let x=0;x<b.length;x++)M.textureArrays[E].push(b[x].serialize())}for(E in M.ints={},this._ints)M.ints[E]=this._ints[E];for(E in M.uints={},this._uints)M.uints[E]=this._uints[E];for(E in M.floats={},this._floats)M.floats[E]=this._floats[E];for(E in M.floatsArrays={},this._floatsArrays)M.floatsArrays[E]=this._floatsArrays[E];for(E in M.colors3={},this._colors3)M.colors3[E]=this._colors3[E].Vd();for(E in M.colors3Arrays={},this._colors3Arrays)M.colors3Arrays[E]=this._colors3Arrays[E];for(E in M.colors4={},this._colors4)M.colors4[E]=this._colors4[E].Vd();for(E in M.colors4Arrays={},this._colors4Arrays)M.colors4Arrays[E]=this._colors4Arrays[E];for(E in M.vectors2={},this._vectors2)M.vectors2[E]=this._vectors2[E].Vd();for(E in M.vectors3={},this._vectors3)M.vectors3[E]=this._vectors3[E].Vd();for(E in M.vectors4={},this._vectors4)M.vectors4[E]=this._vectors4[E].Vd();for(E in M.quaternions={},this._quaternions)M.quaternions[E]=this._quaternions[E].Vd();for(E in M.matrices={},this._matrices)M.matrices[E]=this._matrices[E].Vd();for(E in M.matrixArray={},this._matrixArrays)M.matrixArray[E]=this._matrixArrays[E];for(E in M.matrices3x3={},this._matrices3x3)M.matrices3x3[E]=this._matrices3x3[E];for(E in M.matrices2x2={},this._matrices2x2)M.matrices2x2[E]=this._matrices2x2[E];for(E in M.vectors2Arrays={},this._vectors2Arrays)M.vectors2Arrays[E]=this._vectors2Arrays[E];for(E in M.vectors3Arrays={},this._vectors3Arrays)M.vectors3Arrays[E]=this._vectors3Arrays[E];for(E in M.vectors4Arrays={},this._vectors4Arrays)M.vectors4Arrays[E]=this._vectors4Arrays[E];for(E in M.quaternionsArrays={},this._quaternionsArrays)M.quaternionsArrays[E]=this._quaternionsArrays[E];return M}static Parse(M,E,b){const k=T.b.Parse((()=>new S(M.name,E,M.shaderPath,M.options,M.storeEffectOnSubMeshes)),M,E,b);let a;for(a in M.stencil&&k.stencil.parse(M.stencil,E,b),M.textures)k.setTexture(a,I.e.Parse(M.textures[a],E,b));for(a in M.textureArrays){const x=M.textureArrays[a],g=[];for(let M=0;M<x.length;M++)g.push(I.e.Parse(x[M],E,b));k.setTextureArray(a,g)}for(a in M.ints)k.setInt(a,M.ints[a]);for(a in M.uints)k.setUInt(a,M.uints[a]);for(a in M.floats)k.setFloat(a,M.floats[a]);for(a in M.floatsArrays)k.setFloats(a,M.floatsArrays[a]);for(a in M.colors3)k.setColor3(a,g.e.Id(M.colors3[a]));for(a in M.colors3Arrays){const E=M.colors3Arrays[a].reduce(((M,E,b)=>(b%3===0?M.push([E]):M[M.length-1].push(E),M)),[]).map((M=>g.e.Id(M)));k.setColor3Array(a,E)}for(a in M.colors4)k.setColor4(a,g.h.Id(M.colors4[a]));for(a in M.colors4Arrays){const E=M.colors4Arrays[a].reduce(((M,E,b)=>(b%4===0?M.push([E]):M[M.length-1].push(E),M)),[]).map((M=>g.h.Id(M)));k.setColor4Array(a,E)}for(a in M.vectors2)k.setVector2(a,x.l.Id(M.vectors2[a]));for(a in M.vectors3)k.setVector3(a,x.m.Id(M.vectors3[a]));for(a in M.vectors4)k.setVector4(a,x.o.Id(M.vectors4[a]));for(a in M.quaternions)k.setQuaternion(a,x.e.Id(M.quaternions[a]));for(a in M.matrices)k.setMatrix(a,x.d.Id(M.matrices[a]));for(a in M.matrixArray)k._matrixArrays[a]=new Float32Array(M.matrixArray[a]);for(a in M.matrices3x3)k.setMatrix3x3(a,M.matrices3x3[a]);for(a in M.matrices2x2)k.setMatrix2x2(a,M.matrices2x2[a]);for(a in M.vectors2Arrays)k.setArray2(a,M.vectors2Arrays[a]);for(a in M.vectors3Arrays)k.setArray3(a,M.vectors3Arrays[a]);for(a in M.vectors4Arrays)k.setArray4(a,M.vectors4Arrays[a]);for(a in M.quaternionsArrays)k.setArray4(a,M.quaternionsArrays[a]);return k}static ParseFromFileAsync(M,E,b){let x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return new Promise(((k,a)=>{const g=new B.d;g.addEventListener("readystatechange",(()=>{if(4==g.readyState)if(200==g.status){const E=JSON.parse(g.responseText),a=this.Parse(E,b||c.b.LastCreatedScene,x);M&&(a.name=M),k(a)}else a("Unable to load the ShaderMaterial")})),g.open("GET",E),g.send()}))}static ParseFromSnippetAsync(M,E){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Promise(((x,k)=>{const a=new B.d;a.addEventListener("readystatechange",(()=>{if(4==a.readyState)if(200==a.status){const k=JSON.parse(JSON.parse(a.responseText).jsonPayload),g=JSON.parse(k.shaderMaterial),n=this.Parse(g,E||c.b.LastCreatedScene,b);n.snippetId=M,x(n)}else k("Unable to load the snippet "+M)})),a.open("GET",this.SnippetUrl+"/"+M.replace(/#/g,"/")),a.send()}))}}S.SnippetUrl="https://snippet.babylonjs.com",S.CreateFromSnippetAsync=S.ParseFromSnippetAsync,(0,t.h)("BABYLON.ShaderMaterial",S),k.e._LinesMeshParser=(M,E)=>X.Parse(M,E);class X extends k.e{_isShaderMaterial(M){return"ShaderMaterial"===M.getClassName()}constructor(M){let E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,x=arguments.length>5?arguments[5]:void 0,k=arguments.length>6?arguments[6]:void 0,a=arguments.length>7?arguments[7]:void 0;super(M,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,E,arguments.length>4?arguments[4]:void 0),this.useVertexColor=x,this.useVertexAlpha=k,this.color=new g.e(1,1,1),this.alpha=1,this._shaderLanguage=0,E&&(this.color=E.color.clone(),this.alpha=E.alpha,this.useVertexColor=E.useVertexColor,this.useVertexAlpha=E.useVertexAlpha),this.intersectionThreshold=.1;const J={attributes:[n.g.PositionKind],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:[],useClipPlane:null,shaderLanguage:0};if(!1===k?J.needAlphaBlending=!1:J.defines.push("#define VERTEXALPHA"),x?(J.defines.push("#define VERTEXCOLOR"),J.attributes.push(n.g.ColorKind)):(J.uniforms.push("color"),this._color4=new g.h),a)this.material=a;else{this.va().getEngine().isWebGPU&&!X.ForceGLSL&&(this._shaderLanguage=1),J.shaderLanguage=this._shaderLanguage,J.extraInitializationsAsync=async()=>{1===this._shaderLanguage?await Promise.all([b.e(19).then(b.bind(b,12863)),b.e(48).then(b.bind(b,12865))]):await Promise.all([b.e(26).then(b.bind(b,12867)),b.e(49).then(b.bind(b,12871))])},this.material=new S("colorShader",this.va(),"color",J,!1),this.material.doNotSerialize=!0}}isReady(){return!!this._lineMaterial.isReady(this,!!this._userInstancedBuffersStorage||this.hasThinInstances)&&super.isReady()}getClassName(){return"LinesMesh"}get material(){return this._lineMaterial}set material(M){this._lineMaterial=M,this._lineMaterial.fillMode=u.e.LineListDrawMode}get checkCollisions(){return!1}set checkCollisions(M){}_bind(M,E){if(!this._geometry)return this;const b=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(!this._userInstancedBuffersStorage||this.hasThinInstances?this._geometry._bind(E,b):this._geometry._bind(E,b,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects),!this.useVertexColor&&this._isShaderMaterial(this._lineMaterial)){const{r:M,g:E,b:b}=this.color;this._color4.set(M,E,b,this.alpha),this._lineMaterial.setColor4("color",this._color4)}return this}_draw(M,E,b){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const x=this.va().getEngine();return this._unIndexed?x.drawArraysType(u.e.LineListDrawMode,M.verticesStart,M.verticesCount,b):x.drawElementsType(u.e.LineListDrawMode,M.indexStart,M.indexCount,b),this}dispose(M){(arguments.length>2?arguments[2]:void 0)||this._lineMaterial.dispose(!1,!1,!0),super.dispose(M)}clone(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2?arguments[2]:void 0;return new X(M,this.va(),E,this,b)}gd(M){const E=new U(M,this);if(this.instancedBuffers){E.instancedBuffers={};for(const M in this.instancedBuffers)E.instancedBuffers[M]=this.instancedBuffers[M]}return E}serialize(M){super.serialize(M),M.color=this.color.Vd(),M.alpha=this.alpha}static Parse(M,E){const b=new X(M.name,E);return b.color=g.e.Id(M.color),b.alpha=M.alpha,b}}X.ForceGLSL=!1;class U extends J.d{constructor(M,E){super(M,E),this.intersectionThreshold=E.intersectionThreshold}getClassName(){return"InstancedLinesMesh"}}var v=b(1060);function N(M){const E=[],b=[],x=M.lines,k=M.za,g=[];let n=0;for(let a=0;a<x.length;a++){const M=x[a];for(let x=0;x<M.length;x++){const{x:J,y:u,z:T}=M[x];if(b.push(J,u,T),k){const M=k[a],{r:E,g:b,b:n,a:J}=M[x];g.push(E,b,n,J)}x>0&&(E.push(n-1),E.push(n)),n++}}const J=new a.d;return J.indices=E,J.xa=b,k&&(J.za=g),J}function K(M){const E=M.dashSize||3,b=M.gapSize||1,k=M.dashNb||200,g=M.points,n=[],J=[],u=x.m.Zero();let T=0,V=0,I=0,t=0,y=0,B=0,r=0;for(r=0;r<g.length-1;r++)g[r+1].subtractToRef(g[r],u),T+=u.length();for(I=T/k,t=E*I/(E+b),r=0;r<g.length-1;r++){g[r+1].subtractToRef(g[r],u),V=Math.floor(u.length()/I),u.normalize();for(let M=0;M<V;M++)y=I*M,n.push(g[r].x+y*u.x,g[r].y+y*u.y,g[r].z+y*u.z),n.push(g[r].x+(y+t)*u.x,g[r].y+(y+t)*u.y,g[r].z+(y+t)*u.z),J.push(B,B+1),B+=2}const c=new a.d;return c.xa=n,c.indices=J,c}function h(M,E){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const x=E.instance,k=E.lines,a=E.za;if(x){const M=x.getVerticesData(n.g.PositionKind);let E,b;a&&(E=x.getVerticesData(n.g.ColorKind));let g=0,J=0;for(let x=0;x<k.length;x++){const n=k[x];for(let k=0;k<n.length;k++)M[g]=n[k].x,M[g+1]=n[k].y,M[g+2]=n[k].z,a&&E&&(b=a[x],E[J]=b[k].r,E[J+1]=b[k].g,E[J+2]=b[k].b,E[J+3]=b[k].a,J+=4),g+=3}return x.updateVerticesData(n.g.PositionKind,M,!1,!1),a&&E&&x.updateVerticesData(n.g.ColorKind,E,!1,!1),x.refreshBoundingInfo(),x}const g=new X(M,b,null,void 0,void 0,!!a,E.useVertexAlpha,E.material);return N(E).Ca(g,E.updatable),g}function Z(M,E){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const x=E.za?[E.za]:null;return h(M,{lines:[E.points],updatable:E.updatable,instance:E.instance,za:x,useVertexAlpha:E.useVertexAlpha,material:E.material},b)}function O(M,E){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const a=E.points,g=E.instance,n=E.gapSize||1,J=E.dashSize||3;if(g){const M=M=>{const E=x.m.Zero(),b=M.length/6;let k=0,n=0,J=0,u=0,T=0,V=0,I=0,t=0;for(I=0;I<a.length-1;I++)a[I+1].subtractToRef(a[I],E),k+=E.length();J=k/b;const y=g._creationDataStorage.dashSize;for(u=y*J/(y+g._creationDataStorage.gapSize),I=0;I<a.length-1;I++)for(a[I+1].subtractToRef(a[I],E),n=Math.floor(E.length()/J),E.normalize(),t=0;t<n&&V<M.length;)T=J*t,M[V]=a[I].x+T*E.x,M[V+1]=a[I].y+T*E.y,M[V+2]=a[I].z+T*E.z,M[V+3]=a[I].x+(T+u)*E.x,M[V+4]=a[I].y+(T+u)*E.y,M[V+5]=a[I].z+(T+u)*E.z,V+=6,t++;for(;V<M.length;)M[V]=a[I].x,M[V+1]=a[I].y,M[V+2]=a[I].z,V+=3};return(E.dashNb||E.dashSize||E.gapSize||E.useVertexAlpha||E.material)&&v.d.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),g.updateMeshPositions(M,!1),g}const u=new X(M,b,null,void 0,void 0,void 0,E.useVertexAlpha,E.material);return K(E).Ca(u,E.updatable),u._creationDataStorage=new k.f,u._creationDataStorage.dashSize=J,u._creationDataStorage.gapSize=n,u}a.d.CreateLineSystem=N,a.d.CreateDashedLines=K,k.e.ob=function(M,E){return Z(M,{points:E,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},k.e.CreateDashedLines=function(M,E,b,x,k){return O(M,{points:E,dashSize:b,gapSize:x,dashNb:k,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},11639:(M,E,b)=>{"use strict";b.d(E,{e:()=>n,i:()=>J});var x=b(11537),k=b(11557),a=b(1152);function g(M){const E=[],b=[],x=[],g=[],n=M.width||M.size||1,J=M.height||M.size||1,u=0===M.sideOrientation?0:M.sideOrientation||k.d.DEFAULTSIDE,T=n/2,V=J/2;b.push(-T,-V,0),x.push(0,0,-1),g.push(0,a.c?1:0),b.push(T,-V,0),x.push(0,0,-1),g.push(1,a.c?1:0),b.push(T,V,0),x.push(0,0,-1),g.push(1,a.c?0:1),b.push(-T,V,0),x.push(0,0,-1),g.push(0,a.c?0:1),E.push(0),E.push(1),E.push(2),E.push(0),E.push(2),E.push(3),k.d._ComputeSides(u,b,E,x,g,M.frontUVs,M.backUVs);const I=new k.d;return I.indices=E,I.xa=b,I.ya=x,I.Aa=g,I}function n(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const k=new x.e(M,b);E.sideOrientation=x.e._GetDefaultSideOrientation(E.sideOrientation),k._originalBuilderSideOrientation=E.sideOrientation;return g(E).Ca(k,E.updatable),E.sourcePlane&&(k.translate(E.sourcePlane.de,-E.sourcePlane.d),k.setDirection(E.sourcePlane.de.scale(-1))),k}const J={yg:n};k.d.yg=g,x.e.yg=(M,E,b,x,k)=>n(M,{size:E,width:E,height:E,sideOrientation:k,updatable:x},b)},11709:(M,E,b)=>{"use strict";b.d(E,{e:()=>J});var x=b(970),k=b(11537),a=b(11557),g=b(1152);function n(M){const E=0|(M.segments||32),b=M.diameterX||M.diameter||1,k=M.diameterY||M.diameter||1,n=M.diameterZ||M.diameter||1,J=M.arc&&(M.arc<=0||M.arc>1)?1:M.arc||1,u=M.slice&&M.slice<=0?1:M.slice||1,T=0===M.sideOrientation?0:M.sideOrientation||a.d.DEFAULTSIDE,V=!!M.dedupTopBottomIndices,I=new x.m(b/2,k/2,n/2),t=2+E,y=2*t,B=[],r=[],c=[],C=[];for(let a=0;a<=t;a++){const M=a/t,E=M*Math.PI*u;for(let b=0;b<=y;b++){const k=b/y,a=k*Math.PI*2*J,n=x.d.RotationZ(-E),u=x.d.RotationY(a),T=x.m.TransformCoordinates(x.m.Up(),n),V=x.m.TransformCoordinates(T,u),t=V.multiply(I),B=V.divide(I).normalize();r.push(t.x,t.y,t.z),c.push(B.x,B.y,B.z),C.push(k,g.c?1-M:M)}if(a>0){const M=r.length/3;for(let E=M-2*(y+1);E+y+2<M;E++)V?(a>1&&(B.push(E),B.push(E+1),B.push(E+y+1)),(a<t||u<1)&&(B.push(E+y+1),B.push(E+1),B.push(E+y+2))):(B.push(E),B.push(E+1),B.push(E+y+1),B.push(E+y+1),B.push(E+1),B.push(E+y+2))}}a.d._ComputeSides(T,r,B,c,C,M.frontUVs,M.backUVs);const R=new a.d;return R.indices=B,R.xa=r,R.ya=c,R.Aa=C,R}function J(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const x=new k.e(M,b);E.sideOrientation=k.e._GetDefaultSideOrientation(E.sideOrientation),x._originalBuilderSideOrientation=E.sideOrientation;return n(E).Ca(x,E.updatable),x}a.d.CreateSphere=n,k.e.CreateSphere=(M,E,b,x,k,a)=>J(M,{segments:E,diameterX:b,diameterY:b,diameterZ:b,sideOrientation:a,updatable:k},x)},12181:(M,E,b)=>{"use strict";b.d(E,{e:()=>V});var x=b(1176),k=b(10519),a=b(11562),g=b(1228),n=b(11557),J=b(1060);function u(M,E,b,x,k){let a=null,g=null,n=null;try{let J;a=new M.Decoder,g=new M.DecoderBuffer,g.Init(E,E.byteLength);const u=a.GetEncodedGeometryType(g);switch(u){case M.TRIANGULAR_MESH:{const E=new M.Mesh;if(J=a.DecodeBufferToMesh(g,E),!J.ok()||0===E.ptr)throw new Error(J.error_msg());const b=3*E.num_faces(),k=4*b,u=M._malloc(k);try{a.GetTrianglesUInt32Array(E,k,u);const g=new Uint32Array(b);g.set(new Uint32Array(M.HEAPF32.buffer,u,b)),x(g)}finally{M._free(u)}n=E;break}case M.POINT_CLOUD:{const E=new M.PointCloud;if(J=a.DecodeBufferToPointCloud(g,E),!J.ok()||!E.ptr)throw new Error(J.error_msg());n=E;break}default:throw new Error(`Invalid geometry type ${u}`)}const T=n.num_points(),V=(E,b,x,a)=>{const g=a.data_type(),n=a.num_components(),J=a.normalized(),u=a.byte_stride(),V=a.byte_offset(),I={[M.DT_FLOAT32]:{typedArrayConstructor:Float32Array,heap:M.HEAPF32},[M.DT_INT8]:{typedArrayConstructor:Int8Array,heap:M.HEAP8},[M.DT_INT16]:{typedArrayConstructor:Int16Array,heap:M.HEAP16},[M.DT_INT32]:{typedArrayConstructor:Int32Array,heap:M.HEAP32},[M.DT_UINT8]:{typedArrayConstructor:Uint8Array,heap:M.HEAPU8},[M.DT_UINT16]:{typedArrayConstructor:Uint16Array,heap:M.HEAPU16},[M.DT_UINT32]:{typedArrayConstructor:Uint32Array,heap:M.HEAPU32}}[g];if(!I)throw new Error(`Invalid data type ${g}`);const t=T*n,y=t*I.typedArrayConstructor.BYTES_PER_ELEMENT,B=M._malloc(y);try{E.GetAttributeDataArrayForAllPoints(b,a,g,y,B);const M=new I.typedArrayConstructor(I.heap.buffer,B,t);k(x,M.slice(),n,V,u,J)}finally{M._free(B)}};if(b)for(const M in b){const E=b[M],x=a.GetAttributeByUniqueId(n,E);V(a,n,M,x)}else{const E={position:M.POSITION,de:M.NORMAL,color:M.COLOR,uv:M.TEX_COORD};for(const M in E){const b=a.GetAttributeId(n,E[M]);if(-1!==b){const E=a.GetAttribute(n,b);V(a,n,M,E)}}}return T}finally{n&&M.destroy(n),g&&M.destroy(g),a&&M.destroy(a)}}function T(){let M;onmessage=E=>{const b=E.data;switch(b.id){case"init":{const E=b.decoder;E.url&&importScripts(E.url);const x=E.wasmBinary?{wasmBinary:E.wasmBinary}:{};M=DracoDecoderModule(x),postMessage({id:"initDone"});break}case"decodeMesh":if(!M)throw new Error("Draco decoder module is not available");M.then((M=>{const E=u(M,b.dataView,b.attributes,(M=>{postMessage({id:"indices",data:M},[M.buffer])}),((M,E,b,x,k,a)=>{postMessage({id:"attribute",kind:M,data:E,size:b,byteOffset:x,byteStride:k,normalized:a},[E.buffer])}));postMessage({id:"decodeMeshDone",totalVertices:E})}))}}}class V{static get DecoderAvailable(){const M=V.Configuration.decoder;return!!(M.wasmUrl&&M.wasmBinaryUrl&&"object"===typeof WebAssembly||M.fallbackUrl)}static GetDefaultNumWorkers(){return"object"===typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1}static get Default(){return V._Default||(V._Default=new V),V._Default}static ResetDefault(M){V._Default&&(M||V._Default.dispose(),V._Default=null)}constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:V.DefaultNumWorkers;const E=V.Configuration.decoder;if(E.workerPool||"object"===typeof M&&M.workerPool)this._workerPoolPromise=Promise.resolve(E.workerPool||M.workerPool);else{const b=E.wasmBinary||"object"===typeof M&&M.wasmBinary,a="number"===typeof M?M:M.numWorkers,g=a&&"function"===typeof Worker&&"function"===typeof URL,n=g||!g&&!E.jsModule,J=E.wasmUrl&&E.wasmBinaryUrl&&"object"===typeof WebAssembly?{url:n?x.e.GetBabylonScriptURL(E.wasmUrl,!0):"",wasmBinaryPromise:b?Promise.resolve(b):x.e.LoadFileAsync(x.e.GetBabylonScriptURL(E.wasmBinaryUrl,!0))}:{url:n?x.e.GetBabylonScriptURL(E.fallbackUrl):"",wasmBinaryPromise:Promise.resolve(void 0)};g?this._workerPoolPromise=J.wasmBinaryPromise.then((M=>{const E=`${u}(${T})()`,b=URL.createObjectURL(new Blob([E],{type:"application/javascript"}));return new k.b(a,(()=>function(M,E,b){return new Promise(((x,k)=>{const a=E=>{M.removeEventListener("error",a),M.removeEventListener("message",g),k(E)},g=E=>{"initDone"===E.data.id&&(M.removeEventListener("error",a),M.removeEventListener("message",g),x(M))};if(M.addEventListener("error",a),M.addEventListener("message",g),E){const x=E.slice(0);M.postMessage({id:"init",decoder:{url:b,wasmBinary:x}},[x])}else M.postMessage({id:"init",decoder:{url:b}})}))}(new Worker(b),M,J.url)))})):this._decoderModulePromise=J.wasmBinaryPromise.then((async M=>{if("undefined"===typeof DracoDecoderModule&&!E.jsModule){if(!J.url)throw new Error("Draco decoder module is not available");await x.e.LoadBabylonScriptAsync(J.url)}return await(b=M,k=E.jsModule,new Promise((M=>{(k||DracoDecoderModule)({wasmBinary:b}).then((E=>{M({module:E})}))})));var b,k}))}}dispose(){this._workerPoolPromise&&this._workerPoolPromise.then((M=>{M.dispose()})),delete this._workerPoolPromise,delete this._decoderModulePromise}async whenReadyAsync(){this._workerPoolPromise?await this._workerPoolPromise:this._decoderModulePromise&&await this._decoderModulePromise}decodeMeshToMeshDataAsync(M,E,b){const x=M instanceof ArrayBuffer?new Int8Array(M):new Int8Array(M.buffer,M.byteOffset,M.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((M=>new Promise(((k,a)=>{M.push(((M,g)=>{let n=null;const u=[],T=E=>{M.removeEventListener("error",T),M.removeEventListener("message",V),a(E),g()},V=E=>{const x=E.data;switch(x.id){case"decodeMeshDone":M.removeEventListener("error",T),M.removeEventListener("message",V),k({indices:n,attributes:u,totalVertices:x.totalVertices}),g();break;case"indices":n=x.data;break;case"attribute":u.push({kind:x.kind,data:x.data,size:x.size,byteOffset:x.byteOffset,byteStride:x.byteStride,normalized:(a=x.kind,I=x.normalized,b&&void 0!==b[a]?(I!==b[a]&&J.d.Warn(`Normalized flag from Draco data (${I}) does not match normalized flag from glTF accessor (${b[a]}). Using flag from glTF accessor.`),b[a]):I)})}var a,I};M.addEventListener("error",T),M.addEventListener("message",V);const I=x.slice();M.postMessage({id:"decodeMesh",dataView:I,attributes:E},[I.buffer])}))}))));if(this._decoderModulePromise)return this._decoderModulePromise.then((M=>{let b=null;const k=[],a=u(M.module,x,E,(M=>{b=M}),((M,E,b,x,a,g)=>{k.push({kind:M,data:E,size:b,byteOffset:x,byteStride:a,normalized:g})}));return{indices:b,attributes:k,totalVertices:a}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(M,E,b,x){const k=await this.decodeMeshToMeshDataAsync(b,x),n=new a.b(M,E);k.indices&&n.setIndices(k.indices);for(const a of k.attributes)n.setVerticesBuffer(new g.g(E.getEngine(),a.data,a.kind,!1,void 0,a.byteStride,void 0,a.byteOffset,a.size,void 0,a.normalized,!0),k.totalVertices);return n}async _decodeMeshToGeometryForGltfAsync(M,E,b,x,k){const n=await this.decodeMeshToMeshDataAsync(b,x,k),J=new a.b(M,E);n.indices&&J.setIndices(n.indices);for(const a of n.attributes)J.setVerticesBuffer(new g.g(E.getEngine(),a.data,a.kind,!1,void 0,a.byteStride,void 0,a.byteOffset,a.size,void 0,a.normalized,!0),n.totalVertices);return J}async decodeMeshAsync(M,E){const b=await this.decodeMeshToMeshDataAsync(M,E),x=new n.d;b.indices&&(x.indices=b.indices);for(const k of b.attributes){const M=g.g.GetFloatData(k.data,k.size,g.g.GetDataType(k.data),k.byteOffset,k.byteStride,k.normalized,b.totalVertices);x.set(M,k.kind)}return x}}V.Configuration={decoder:{wasmUrl:`${x.e._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${x.e._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${x.e._DefaultCdnUrl}/draco_decoder_gltf.js`}},V.DefaultNumWorkers=V.GetDefaultNumWorkers(),V._Default=null},11569:(M,E,b)=>{"use strict";b.d(E,{d:()=>U});var x=b(948),k=b(962),a=b(970),g=b(1228),n=b(11557),J=b(11578),u=b(1222),T=b(1343),V=b(1217);class I{constructor(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new a.m(0,0,0),this._diffPositionForCollisions=new a.m(0,0,0),this._collisionResponse=!0}}var t=b(1056),y=b(1357),B=b(1133),r=b(977),c=b(1512),C=b(989),R=b(953),w=b(1073);class S{constructor(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=a.m.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1}}class X{constructor(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new S,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=null,this._currentLODIsUpToDate=!1,this._collisionRetryCount=3,this._morphTargetManager=null,this._renderingGroupId=0,this._bakedVertexAnimationManager=null,this._material=null,this._positions=null,this._pointerOverDisableMeshTesting=!1,this._meshCollisionData=new I,this._enableDistantPicking=!1,this._rawBoundingInfo=null,this._sideOrientationHint=!1,this._inheritVisibility=!1}}class U extends J.c{static get BILLBOARDMODE_NONE(){return J.c.BILLBOARDMODE_NONE}static get BILLBOARDMODE_X(){return J.c.BILLBOARDMODE_X}static get BILLBOARDMODE_Y(){return J.c.BILLBOARDMODE_Y}static get BILLBOARDMODE_Z(){return J.c.BILLBOARDMODE_Z}static get BILLBOARDMODE_ALL(){return J.c.BILLBOARDMODE_ALL}static get BILLBOARDMODE_USE_POSITION(){return J.c.BILLBOARDMODE_USE_POSITION}get facetNb(){return this._internalAbstractMeshDataInfo._facetData.facetNb}get partitioningSubdivisions(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions}set partitioningSubdivisions(M){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=M}get partitioningBBoxRatio(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio}set partitioningBBoxRatio(M){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=M}get mustDepthSortFacets(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort}set mustDepthSortFacets(M){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=M}get facetDepthSortFrom(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom}set facetDepthSortFrom(M){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=M}get collisionRetryCount(){return this._internalAbstractMeshDataInfo._collisionRetryCount}set collisionRetryCount(M){this._internalAbstractMeshDataInfo._collisionRetryCount=M}get isFacetDataEnabled(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled}get morphTargetManager(){return this._internalAbstractMeshDataInfo._morphTargetManager}set morphTargetManager(M){this._internalAbstractMeshDataInfo._morphTargetManager!==M&&(this._internalAbstractMeshDataInfo._morphTargetManager=M,this._syncGeometryWithMorphTargetManager())}get bakedVertexAnimationManager(){return this._internalAbstractMeshDataInfo._bakedVertexAnimationManager}set bakedVertexAnimationManager(M){this._internalAbstractMeshDataInfo._bakedVertexAnimationManager!==M&&(this._internalAbstractMeshDataInfo._bakedVertexAnimationManager=M,this._markSubMeshesAsAttributesDirty())}_syncGeometryWithMorphTargetManager(){}_updateNonUniformScalingState(M){return!!super._updateNonUniformScalingState(M)&&(this._markSubMeshesAsMiscDirty(),!0)}get rawBoundingInfo(){return this._internalAbstractMeshDataInfo._rawBoundingInfo}set rawBoundingInfo(M){this._internalAbstractMeshDataInfo._rawBoundingInfo=M}set Fk(M){this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver=this.onCollideObservable.add(M)}set onCollisionPositionChange(M){this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(M)}get visibility(){return this._internalAbstractMeshDataInfo._visibility}set visibility(M){if(this._internalAbstractMeshDataInfo._visibility===M)return;const E=this._internalAbstractMeshDataInfo._visibility;this._internalAbstractMeshDataInfo._visibility=M,(1===E&&1!==M||1!==E&&1===M)&&this._markSubMeshesAsDirty((M=>{M.markAsMiscDirty(),M.markAsPrePassDirty()}))}get inheritVisibility(){return this._internalAbstractMeshDataInfo._inheritVisibility}set inheritVisibility(M){this._internalAbstractMeshDataInfo._inheritVisibility=M}get isVisible(){if(!this._isVisible||!this.inheritVisibility||!this._parentNode)return this._isVisible;if(this._isVisible){let M=this._parentNode;for(;M;){const E=M.isVisible;if("undefined"!==typeof E)return E;M=M.parent}}return this._isVisible}set isVisible(M){this._isVisible=M}get pointerOverDisableMeshTesting(){return this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting}set pointerOverDisableMeshTesting(M){this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting=M}get renderingGroupId(){return this._internalAbstractMeshDataInfo._renderingGroupId}set renderingGroupId(M){this._internalAbstractMeshDataInfo._renderingGroupId=M}get material(){return this._internalAbstractMeshDataInfo._material}set material(M){this._setMaterial(M)}_setMaterial(M){this._internalAbstractMeshDataInfo._material!==M&&(this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._material=M,M&&M.meshMap&&(M.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.Td&&(this.resetDrawCache(),this._unBindEffect()))}getMaterialForRenderPass(M){var E;return null===(E=this._internalAbstractMeshDataInfo._materialForRenderPass)||void 0===E?void 0:E[M]}setMaterialForRenderPass(M,E){this.resetDrawCache(M),this._internalAbstractMeshDataInfo._materialForRenderPass||(this._internalAbstractMeshDataInfo._materialForRenderPass=[]),this._internalAbstractMeshDataInfo._materialForRenderPass[M]=E}get receiveShadows(){return this._internalAbstractMeshDataInfo._receiveShadows}set receiveShadows(M){this._internalAbstractMeshDataInfo._receiveShadows!==M&&(this._internalAbstractMeshDataInfo._receiveShadows=M,this._markSubMeshesAsLightDirty())}get hasVertexAlpha(){return this._internalAbstractMeshDataInfo._hasVertexAlpha}set hasVertexAlpha(M){this._internalAbstractMeshDataInfo._hasVertexAlpha!==M&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=M,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())}get useVertexColors(){return this._internalAbstractMeshDataInfo._useVertexColors}set useVertexColors(M){this._internalAbstractMeshDataInfo._useVertexColors!==M&&(this._internalAbstractMeshDataInfo._useVertexColors=M,this._markSubMeshesAsAttributesDirty())}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(M){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==M&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=M,this._markSubMeshesAsAttributesDirty())}get numBoneInfluencers(){return this._internalAbstractMeshDataInfo._numBoneInfluencers}set numBoneInfluencers(M){this._internalAbstractMeshDataInfo._numBoneInfluencers!==M&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=M,this._markSubMeshesAsAttributesDirty())}get applyFog(){return this._internalAbstractMeshDataInfo._applyFog}set applyFog(M){this._internalAbstractMeshDataInfo._applyFog!==M&&(this._internalAbstractMeshDataInfo._applyFog=M,this._markSubMeshesAsMiscDirty())}get enableDistantPicking(){return this._internalAbstractMeshDataInfo._enableDistantPicking}set enableDistantPicking(M){this._internalAbstractMeshDataInfo._enableDistantPicking=M}get layerMask(){return this._internalAbstractMeshDataInfo._layerMask}set layerMask(M){M!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=M,this._resyncLightSources())}get collisionMask(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask}set collisionMask(M){this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask=isNaN(M)?-1:M}get collisionResponse(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse}set collisionResponse(M){this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse=M}get collisionGroup(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup}set collisionGroup(M){this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup=isNaN(M)?-1:M}get surroundingMeshes(){return this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes}set surroundingMeshes(M){this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes=M}get lightSources(){return this._lightSources}set skeleton(M){const E=this._internalAbstractMeshDataInfo._skeleton;E&&E.needInitialSkinMatrix&&E._unregisterMeshWithPoseMatrix(this),M&&M.needInitialSkinMatrix&&M._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=M,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()}get skeleton(){return this._internalAbstractMeshDataInfo._skeleton}constructor(M){var E;let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;switch(super(M,b,!1),E=this,this._internalAbstractMeshDataInfo=new X,this._waitingMaterialId=null,this._waitingMorphTargetManagerId=null,this.xe=U.Oi,this.onCollideObservable=new k.b,this.onCollisionPositionChangeObservable=new k.b,this.onMaterialChangedObservable=new k.b,this.definedFacingForward=!0,this._occlusionQuery=null,this._renderingGroup=null,this.alphaIndex=Number.MAX_VALUE,this._isVisible=!0,this.Be=!0,this.isNearPickable=!1,this.isNearGrabbable=!1,this.showSubMeshesBoundingBox=!1,this.isBlocker=!1,this.enablePointerMoveEvents=!1,this.outlineColor=B.e.Red(),this.outlineWidth=.02,this.overlayColor=B.e.Red(),this.overlayAlpha=.5,this.useOctreeForRenderingSelection=!0,this.useOctreeForPicking=!0,this.useOctreeForCollisions=!0,this.Oe=!1,this.Da=!1,this.actionManager=null,this.ellipsoid=new a.m(.5,1,.5),this.ellipsoidOffset=new a.m(0,0,0),this.edgesWidth=1,this.edgesColor=new B.h(1,0,0,1),this._edgesRenderer=null,this._masterMesh=null,this._boundingInfo=null,this._boundingInfoIsDirty=!0,this._renderId=0,this._intersectionsInProgress=new Array,this._unIndexed=!1,this._lightSources=new Array,this._waitingData={lods:null,actions:null,ai:null},this._bonesTransformMatrices=null,this._transformMatrixTexture=null,this.onRebuildObservable=new k.b,this._onCollisionPositionChange=function(M,b){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;b.subtractToRef(E._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,E._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),E._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions.length()>w.c.CollisionsEpsilon&&E.position.addInPlace(E._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),x&&E.onCollideObservable.notifyObservers(x),E.onCollisionPositionChangeObservable.notifyObservers(E.position)},b=this.va(),b.Le(this),this._resyncLightSources(),this._uniformBuffer=new V.c(this.va().getEngine(),void 0,void 0,M,!this.va().getEngine().isWebGPU),this._buildUniformLayout(),b.performancePriority){case 2:this.Da=!0;case 1:this.Oe=!0,this.Be=!1}}_buildUniformLayout(){this._uniformBuffer.addUniform("world",16),this._uniformBuffer.addUniform("visibility",1),this._uniformBuffer.create()}transferToEffect(M){const E=this._uniformBuffer;E.ne("world",M),E.updateFloat("visibility",this._internalAbstractMeshDataInfo._visibility),E.update()}getMeshUniformBuffer(){return this._uniformBuffer}getClassName(){return"AbstractMesh"}toString(M){let E="Name: "+this.name+", isInstance: "+("InstancedMesh"!==this.getClassName()?"YES":"NO");E+=", # of submeshes: "+(this.Td?this.Td.length:0);const b=this._internalAbstractMeshDataInfo._skeleton;return b&&(E+=", skeleton: "+b.name),M&&(E+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],E+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.ai?"YES":"NO")),E}_getEffectiveParent(){return this._masterMesh&&this.billboardMode!==J.c.BILLBOARDMODE_NONE?this._masterMesh:super._getEffectiveParent()}_getActionManagerForTrigger(M){let E=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.actionManager&&(E||this.actionManager.isRecursive)){if(!M)return this.actionManager;if(this.actionManager.hasSpecificTrigger(M))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(M,!1):null}_rebuild(){if(this.onRebuildObservable.notifyObservers(this),null!==this._occlusionQuery&&(this._occlusionQuery=null),this.Td){for(const M of this.Td)M._rebuild();this.resetDrawCache()}}_resyncLightSources(){this._lightSources.length=0;for(const M of this.va().lights)M.isEnabled()&&M.canAffectMesh(this)&&this._lightSources.push(M);this._markSubMeshesAsLightDirty()}_resyncLightSource(M){const E=M.isEnabled()&&M.canAffectMesh(this),b=this._lightSources.indexOf(M);let x=!1;if(-1===b){if(!E)return;this._lightSources.push(M)}else{if(E)return;x=!0,this._lightSources.splice(b,1)}this._markSubMeshesAsLightDirty(x)}_unBindEffect(){for(const M of this.Td)M.setEffect(null)}_removeLightSource(M,E){const b=this._lightSources.indexOf(M);-1!==b&&(this._lightSources.splice(b,1),this._markSubMeshesAsLightDirty(E))}_markSubMeshesAsDirty(M){if(this.Td)for(const E of this.Td)for(let b=0;b<E._drawWrappers.length;++b){const x=E._drawWrappers[b];x&&x.defines&&x.defines.markAllAsDirty&&M(x.defines)}}_markSubMeshesAsLightDirty(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._markSubMeshesAsDirty((E=>E.markAsLightDirty(M)))}_markSubMeshesAsAttributesDirty(){this._markSubMeshesAsDirty((M=>M.markAsAttributesDirty()))}_markSubMeshesAsMiscDirty(){this._markSubMeshesAsDirty((M=>M.markAsMiscDirty()))}ge(M){return this._currentRenderId=Number.MAX_VALUE,super.ge(M),this._isDirty=!0,this}resetDrawCache(M){if(this.Td)for(const E of this.Td)E.resetDrawCache(M)}get isBlocked(){return!1}getLOD(M){return this}getTotalVertices(){return 0}getTotalIndices(){return 0}Ed(){return null}getVerticesData(M){return null}Ga(M,E,b,x){return this}updateVerticesData(M,E,b,x){return this}setIndices(M,E){return this}isVerticesDataPresent(M){return!1}getBoundingInfo(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfoIsDirty&&(this._boundingInfoIsDirty=!1,this.Ea()),this._boundingInfo)}getRawBoundingInfo(){return this.rawBoundingInfo??this.getBoundingInfo()}setBoundingInfo(M){return this._boundingInfo=M,this}get hasBoundingInfo(){return null!==this._boundingInfo}buildBoundingInfo(M,E,b){return this._boundingInfo=new T.d(M,E,b),this._boundingInfo}normalizeToUnitCube(){let M=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2?arguments[2]:void 0;return super.normalizeToUnitCube(M,E,b)}get useBones(){return this.skeleton&&this.va().skeletonsEnabled&&this.isVerticesDataPresent(g.g.MatricesIndicesKind)&&this.isVerticesDataPresent(g.g.MatricesWeightsKind)}_preActivate(){}_preActivateForIntermediateRendering(M){}_activate(M,E){return this._renderId=M,!0}_postActivate(){}_freeze(){}_unFreeze(){}getWorldMatrix(){return this._masterMesh&&this.billboardMode===J.c.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():super.getWorldMatrix()}_getWorldMatrixDeterminant(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():super._getWorldMatrixDeterminant()}get isAnInstance(){return!1}get hasInstances(){return!1}get hasThinInstances(){return!1}movePOV(M,E,b){return this.position.addInPlace(this.calcMovePOV(M,E,b)),this}calcMovePOV(M,E,b){const x=new a.d;(this.rotationQuaternion?this.rotationQuaternion:a.e.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(x);const k=a.m.Zero(),g=this.definedFacingForward?-1:1;return a.m.TransformCoordinatesFromFloatsToRef(M*g,E,b*g,x,k),k}rotatePOV(M,E,b){return this.rotation.addInPlace(this.calcRotatePOV(M,E,b)),this}calcRotatePOV(M,E,b){const x=this.definedFacingForward?1:-1;return new a.m(M*x,E,b*x)}Fa(M,E){if(M){const b=(0,y.e)(M,0,this.getTotalVertices(),E);this._boundingInfo?this._boundingInfo.reConstruct(b.minimum,b.maximum):this._boundingInfo=new T.d(b.minimum,b.maximum)}if(this.Td)for(let b=0;b<this.Td.length;b++)this.Td[b].refreshBoundingInfo(M);this.Ea()}_refreshBoundingInfoDirect(M){if(this._boundingInfo?this._boundingInfo.reConstruct(M.minimum,M.maximum):this._boundingInfo=new T.d(M.minimum,M.maximum),this.Td)for(let E=0;E<this.Td.length;E++)this.Td[E].refreshBoundingInfo(null);this.Ea()}static _ApplySkeleton(M,E,b,x,k,n,J){!function(M,E,b,x,k,n,J){const u=a.i.Fd[0],T=a.i.Matrix[0],V=a.i.Matrix[1],I=E===g.g.NormalKind?a.m.TransformNormalFromFloatsToRef:a.m.TransformCoordinatesFromFloatsToRef;for(let g=0,t=0;g<M.length;g+=3,t+=4){let E,y;for(T.reset(),E=0;E<4;E++)y=k[t+E],y>0&&(a.d.FromFloat32ArrayToRefScaled(b,Math.floor(16*x[t+E]),y,V),T.addToSelf(V));if(n&&J)for(E=0;E<4;E++)y=J[t+E],y>0&&(a.d.FromFloat32ArrayToRefScaled(b,Math.floor(16*n[t+E]),y,V),T.addToSelf(V));I(M[g],M[g+1],M[g+2],T,u),u.toArray(M,g)}}(M,E,b,x,k,n,J)}_getData(M,E){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:g.g.PositionKind;const x=M.cache,k=M=>{if(x){const E=x._vertexData||(x._vertexData={});return E[M]||this.copyVerticesData(M,E),E[M]}return this.getVerticesData(M)};if(E||(E=k(b)),!E)return null;if(x?(x._outputData?x._outputData.set(E):x._outputData=new Float32Array(E),E=x._outputData):(M.applyMorph&&this.morphTargetManager||M.applySkeleton&&this.skeleton)&&(E=E.slice()),M.applyMorph&&this.morphTargetManager&&function(M,E,b){let x=null;switch(E){case g.g.PositionKind:x=M=>M.getPositions();break;case g.g.NormalKind:x=M=>M.getNormals();break;case g.g.TangentKind:x=M=>M.getTangents();break;case g.g.UVKind:x=M=>M.getUVs();break;default:return}for(let k=0;k<M.length;k++){let E=M[k];for(let a=0;a<b.numTargets;a++){const g=b.getTarget(a),n=g.influence;if(0!==n){const b=x(g);b&&(E+=(b[k]-M[k])*n)}}M[k]=E}}(E,b,this.morphTargetManager),M.applySkeleton&&this.skeleton){const M=k(g.g.MatricesIndicesKind),x=k(g.g.MatricesWeightsKind);if(x&&M){const a=this.numBoneInfluencers>4,n=a?k(g.g.MatricesIndicesExtraKind):null,J=a?k(g.g.MatricesWeightsExtraKind):null,u=this.skeleton.getTransformMatrices(this);U._ApplySkeleton(E,b,u,M,x,n,J)}}if(!1!==M.updatePositionsArray&&b===g.g.PositionKind){const M=this._internalAbstractMeshDataInfo._positions||[],b=M.length;if(M.length=E.length/3,b<M.length)for(let E=b;E<M.length;E++)M[E]=new a.m;for(let x=0,k=0;x<M.length;x++,k+=3)M[x].Hd(E[k],E[k+1],E[k+2]);this._internalAbstractMeshDataInfo._positions=M}return E}getNormalsData(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0],E=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getData({applySkeleton:M,applyMorph:E,updatePositionsArray:!1},null,g.g.NormalKind)}If(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0],E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this._getData({applySkeleton:M,applyMorph:E,updatePositionsArray:!1},b,g.g.PositionKind)}Ea(){return this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=new T.d(a.m.Zero(),a.m.Zero(),this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}_updateSubMeshesBoundingInfo(M){if(!this.Td)return this;const E=this.Td.length;for(let b=0;b<E;b++){const x=this.Td[b];(E>1||!x.IsGlobal)&&x.updateBoundingInfo(M)}return this}_afterComputeWorldMatrix(){this.Da||(this._boundingInfoIsDirty=!0)}isInFrustum(M){return this.getBoundingInfo().isInFrustum(M,this.xe)}isCompletelyInFrustum(M){return this.getBoundingInfo().isCompletelyInFrustum(M)}intersectsMesh(M){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2?arguments[2]:void 0;const x=this.getBoundingInfo(),k=M.getBoundingInfo();if(x.intersects(k,E))return!0;if(b)for(const a of this.getChildMeshes())if(a.intersectsMesh(M,E,!0))return!0;return!1}intersectsPoint(M){return this.getBoundingInfo().intersectsPoint(M)}get checkCollisions(){return this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions}set checkCollisions(M){this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions=M}get collider(){return this._internalAbstractMeshDataInfo._meshCollisionData._collider}moveWithCollisions(M){this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions);const E=this.va().collisionCoordinator;return this._internalAbstractMeshDataInfo._meshCollisionData._collider||(this._internalAbstractMeshDataInfo._meshCollisionData._collider=E.createCollider()),this._internalAbstractMeshDataInfo._meshCollisionData._collider._radius=this.ellipsoid,E.getNewPosition(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,M,this._internalAbstractMeshDataInfo._meshCollisionData._collider,this.collisionRetryCount,this,this._onCollisionPositionChange,this.uniqueId),this}_collideForSubMesh(M,E,b){var x;if(this._generatePointsArray(),!this._positions)return this;if(!M._lastColliderWorldVertices||!M._lastColliderTransformMatrix.equals(E)){M._lastColliderTransformMatrix=E.clone(),M._lastColliderWorldVertices=[],M._trianglePlanes=[];const b=M.verticesStart,x=M.verticesStart+M.verticesCount;for(let k=b;k<x;k++)M._lastColliderWorldVertices.push(a.m.TransformCoordinates(this._positions[k],E))}return b._collide(M._trianglePlanes,M._lastColliderWorldVertices,this.Ed(),M.indexStart,M.indexStart+M.indexCount,M.verticesStart,!!M.Ha(),this,this._shouldConvertRHS(),7===(null===(x=M.Ha())||void 0===x?void 0:x.fillMode)),this}_processCollisionsForSubMeshes(M,E){const b=this._scene.getCollidingSubMeshCandidates(this,M),x=b.length;for(let k=0;k<x;k++){const a=b.data[k];x>1&&!a._checkCollision(M)||this._collideForSubMesh(a,E,M)}return this}_shouldConvertRHS(){return!1}_checkCollision(M){if(!this.getBoundingInfo()._checkCollision(M))return this;const E=a.i.Matrix[0],b=a.i.Matrix[1];return a.d.ScalingToRef(1/M._radius.x,1/M._radius.y,1/M._radius.z,E),this.worldMatrixFromCache.multiplyToRef(E,b),this._processCollisionsForSubMeshes(M,b),this}_generatePointsArray(){return!1}intersects(M,E,b){let x=arguments.length>3&&void 0!==arguments[3]&&arguments[3],k=arguments.length>4?arguments[4]:void 0,g=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const n=new u.b,J=this.getClassName(),T="InstancedLinesMesh"===J||"LinesMesh"===J||"GreasedLineMesh"===J?this.intersectionThreshold:0,V=this.getBoundingInfo();if(!this.Td)return n;if(!g&&(!M.intersectsSphere(V.boundingSphere,T)||!M.intersectsBox(V.boundingBox,T)))return n;if(x)return n.hit=!g,n.pickedMesh=g?null:this,n.distance=g?0:a.m.Distance(M.origin,V.boundingSphere.center),n.subMeshId=0,n;if(!this._generatePointsArray())return n;let I=null;const t=this._scene.getIntersectingSubMeshCandidates(this,M),y=t.length;let B=!1;for(let a=0;a<y;a++){const M=t.data[a].Ha();if(M&&(7==M.fillMode||0==M.fillMode||1==M.fillMode||2==M.fillMode||4==M.fillMode)){B=!0;break}}if(!B)return n.hit=!0,n.pickedMesh=this,n.distance=a.m.Distance(M.origin,V.boundingSphere.center),n.subMeshId=-1,n;for(let a=0;a<y;a++){const x=t.data[a];if(y>1&&!g&&!x.canIntersects(M))continue;const k=x.intersects(M,this._positions,this.Ed(),E,b);if(k&&(E||!I||k.distance<I.distance)&&(I=k,I.subMeshId=a,E))break}if(I){const E=k??this.getWorldMatrix(),b=a.i.Fd[0],x=a.i.Fd[1];a.m.TransformCoordinatesToRef(M.origin,E,b),M.direction.scaleToRef(I.distance,x);const g=a.m.TransformNormal(x,E).addInPlace(b);return n.hit=!0,n.distance=a.m.Distance(b,g),n.pickedPoint=g,n.pickedMesh=this,n.bu=I.bu||0,n.bv=I.bv||0,n.subMeshFaceId=I.faceId,n.faceId=I.faceId+t.data[I.subMeshId].indexStart/(-1!==this.getClassName().indexOf("LinesMesh")?2:3),n.subMeshId=I.subMeshId,n}return n}clone(M,E,b){return null}releaseSubMeshes(){if(this.Td)for(;this.Td.length;)this.Td[0].dispose();else this.Td=[];return this}dispose(M){let E,b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const x=this.va();for(this._scene.useMaterialMeshMap&&this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),x.freeActiveMeshes(),x.freeRenderingGroups(),x.renderingManager.maintainStateBetweenFrames&&x.renderingManager.restoreDispachedFlags(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.disposeWhenUnowned&&!this._scene.meshes.some((M=>M!==this&&M.actionManager===this.actionManager))&&this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),E=0;E<this._intersectionsInProgress.length;E++){const M=this._intersectionsInProgress[E],b=M._intersectionsInProgress.indexOf(this);M._intersectionsInProgress.splice(b,1)}this._intersectionsInProgress.length=0;x.lights.forEach((M=>{let E=M.includedOnlyMeshes.indexOf(this);-1!==E&&M.includedOnlyMeshes.splice(E,1),E=M.excludedMeshes.indexOf(this),-1!==E&&M.excludedMeshes.splice(E,1);const b=M.getShadowGenerators();if(b){const M=b.values();for(let b=M.next();!0!==b.done;b=M.next()){const M=b.value.getShadowMap();M&&M.renderList&&(E=M.renderList.indexOf(this),-1!==E&&M.renderList.splice(E,1))}}})),"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes();const k=x.getEngine();if(null!==this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,k.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),k.wipeCaches(),x.Me(this),this._parentContainer){const M=this._parentContainer.meshes.indexOf(this);M>-1&&this._parentContainer.meshes.splice(M,1),this._parentContainer=null}if(b&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!M)for(E=0;E<x.ae.length;E++)x.ae[E].k===this&&(x.ae[E].dispose(),E--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this._uniformBuffer.dispose(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),super.dispose(M,b)}_initFacetData(){const M=this._internalAbstractMeshDataInfo._facetData;M.facetNormals||(M.facetNormals=[]),M.facetPositions||(M.facetPositions=[]),M.facetPartitioning||(M.facetPartitioning=new Array),M.facetNb=this.Ed().length/3|0,M.partitioningSubdivisions=M.partitioningSubdivisions?M.partitioningSubdivisions:10,M.partitioningBBoxRatio=M.partitioningBBoxRatio?M.partitioningBBoxRatio:1.01;for(let E=0;E<M.facetNb;E++)M.facetNormals[E]=a.m.Zero(),M.facetPositions[E]=a.m.Zero();return M.facetDataEnabled=!0,this}updateFacetData(){const M=this._internalAbstractMeshDataInfo._facetData;M.facetDataEnabled||this._initFacetData();const E=this.getVerticesData(g.g.PositionKind),b=this.Ed(),x=this.getVerticesData(g.g.NormalKind),k=this.getBoundingInfo();if(M.facetDepthSort&&!M.facetDepthSortEnabled){if(M.facetDepthSortEnabled=!0,b instanceof Uint16Array)M.depthSortedIndices=new Uint16Array(b);else if(b instanceof Uint32Array)M.depthSortedIndices=new Uint32Array(b);else{let E=!1;for(let M=0;M<b.length;M++)if(b[M]>65535){E=!0;break}M.depthSortedIndices=E?new Uint32Array(b):new Uint16Array(b)}if(M.facetDepthSortFunction=function(M,E){return E.sqDistance-M.sqDistance},!M.facetDepthSortFrom){const E=this.va().activeCamera;M.facetDepthSortFrom=E?E.position:a.m.Zero()}M.depthSortedFacets=[];for(let E=0;E<M.facetNb;E++){const b={ind:3*E,sqDistance:0};M.depthSortedFacets.push(b)}M.invertedMatrix=a.d.Identity(),M.facetDepthSortOrigin=a.m.Zero()}M.bbSize.x=k.maximum.x-k.minimum.x>r.b?k.maximum.x-k.minimum.x:r.b,M.bbSize.y=k.maximum.y-k.minimum.y>r.b?k.maximum.y-k.minimum.y:r.b,M.bbSize.z=k.maximum.z-k.minimum.z>r.b?k.maximum.z-k.minimum.z:r.b;let J=M.bbSize.x>M.bbSize.y?M.bbSize.x:M.bbSize.y;if(J=J>M.bbSize.z?J:M.bbSize.z,M.subDiv.max=M.partitioningSubdivisions,M.subDiv.X=Math.floor(M.subDiv.max*M.bbSize.x/J),M.subDiv.Y=Math.floor(M.subDiv.max*M.bbSize.y/J),M.subDiv.Z=Math.floor(M.subDiv.max*M.bbSize.z/J),M.subDiv.X=M.subDiv.X<1?1:M.subDiv.X,M.subDiv.Y=M.subDiv.Y<1?1:M.subDiv.Y,M.subDiv.Z=M.subDiv.Z<1?1:M.subDiv.Z,M.facetParameters.facetNormals=this.getFacetLocalNormals(),M.facetParameters.facetPositions=this.getFacetLocalPositions(),M.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),M.facetParameters.bInfo=k,M.facetParameters.bbSize=M.bbSize,M.facetParameters.subDiv=M.subDiv,M.facetParameters.ratio=this.partitioningBBoxRatio,M.facetParameters.depthSort=M.facetDepthSort,M.facetDepthSort&&M.facetDepthSortEnabled&&(this.ce(!0),this._worldMatrix.invertToRef(M.invertedMatrix),a.m.TransformCoordinatesToRef(M.facetDepthSortFrom,M.invertedMatrix,M.facetDepthSortOrigin),M.facetParameters.distanceTo=M.facetDepthSortOrigin),M.facetParameters.depthSortedFacets=M.depthSortedFacets,x&&n.d.ComputeNormals(E,b,x,M.facetParameters),M.facetDepthSort&&M.facetDepthSortEnabled){M.depthSortedFacets.sort(M.facetDepthSortFunction);const E=M.depthSortedIndices.length/3|0;for(let x=0;x<E;x++){const E=M.depthSortedFacets[x].ind;M.depthSortedIndices[3*x]=b[E],M.depthSortedIndices[3*x+1]=b[E+1],M.depthSortedIndices[3*x+2]=b[E+2]}this.updateIndices(M.depthSortedIndices,void 0,!0)}return this}getFacetLocalNormals(){const M=this._internalAbstractMeshDataInfo._facetData;return M.facetNormals||this.updateFacetData(),M.facetNormals}getFacetLocalPositions(){const M=this._internalAbstractMeshDataInfo._facetData;return M.facetPositions||this.updateFacetData(),M.facetPositions}getFacetLocalPartitioning(){const M=this._internalAbstractMeshDataInfo._facetData;return M.facetPartitioning||this.updateFacetData(),M.facetPartitioning}getFacetPosition(M){const E=a.m.Zero();return this.getFacetPositionToRef(M,E),E}getFacetPositionToRef(M,E){const b=this.getFacetLocalPositions()[M],x=this.getWorldMatrix();return a.m.TransformCoordinatesToRef(b,x,E),this}getFacetNormal(M){const E=a.m.Zero();return this.getFacetNormalToRef(M,E),E}getFacetNormalToRef(M,E){const b=this.getFacetLocalNormals()[M];return a.m.TransformNormalToRef(b,this.getWorldMatrix(),E),this}getFacetsAtLocalCoordinates(M,E,b){const x=this.getBoundingInfo(),k=this._internalAbstractMeshDataInfo._facetData,a=Math.floor((M-x.minimum.x*k.partitioningBBoxRatio)*k.subDiv.X*k.partitioningBBoxRatio/k.bbSize.x),g=Math.floor((E-x.minimum.y*k.partitioningBBoxRatio)*k.subDiv.Y*k.partitioningBBoxRatio/k.bbSize.y),n=Math.floor((b-x.minimum.z*k.partitioningBBoxRatio)*k.subDiv.Z*k.partitioningBBoxRatio/k.bbSize.z);return a<0||a>k.subDiv.max||g<0||g>k.subDiv.max||n<0||n>k.subDiv.max?null:k.facetPartitioning[a+k.subDiv.max*g+k.subDiv.max*k.subDiv.max*n]}getClosestFacetAtCoordinates(M,E,b,x){let k=arguments.length>4&&void 0!==arguments[4]&&arguments[4],g=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const n=this.getWorldMatrix(),J=a.i.Matrix[5];n.invertToRef(J);const u=a.i.Fd[8];a.m.TransformCoordinatesFromFloatsToRef(M,E,b,J,u);const T=this.getClosestFacetAtLocalCoordinates(u.x,u.y,u.z,x,k,g);return x&&a.m.TransformCoordinatesFromFloatsToRef(x.x,x.y,x.z,n,x),T}getClosestFacetAtLocalCoordinates(M,E,b,x){let k=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],g=null,n=0,J=0,u=0,T=0,V=0,I=0,t=0,y=0;const B=this.getFacetLocalPositions(),r=this.getFacetLocalNormals(),c=this.getFacetsAtLocalCoordinates(M,E,b);if(!c)return null;let C,R,w,S=Number.MAX_VALUE,X=S;for(let U=0;U<c.length;U++)C=c[U],R=r[C],w=B[C],T=(M-w.x)*R.x+(E-w.y)*R.y+(b-w.z)*R.z,(!k||k&&a&&T>=0||k&&!a&&T<=0)&&(T=R.x*w.x+R.y*w.y+R.z*w.z,V=-(R.x*M+R.y*E+R.z*b-T)/(R.x*R.x+R.y*R.y+R.z*R.z),I=M+R.x*V,t=E+R.y*V,y=b+R.z*V,n=I-M,J=t-E,u=y-b,X=n*n+J*J+u*u,X<S&&(S=X,g=C,x&&(x.x=I,x.y=t,x.z=y)));return g}getFacetDataParameters(){return this._internalAbstractMeshDataInfo._facetData.facetParameters}disableFacetData(){const M=this._internalAbstractMeshDataInfo._facetData;return M.facetDataEnabled&&(M.facetDataEnabled=!1,M.facetPositions=[],M.facetNormals=[],M.facetPartitioning=new Array,M.facetParameters=null,M.depthSortedIndices=new Uint32Array(0)),this}updateIndices(M,E){return this}createNormals(M){const E=this.getVerticesData(g.g.PositionKind),b=this.Ed();let x;return x=this.isVerticesDataPresent(g.g.NormalKind)?this.getVerticesData(g.g.NormalKind):[],n.d.ComputeNormals(E,b,x,{useRightHandedSystem:this.va().useRightHandedSystem}),this.Ga(g.g.NormalKind,x,M),this}alignWithNormal(M,E){E||(E=c.d.Y);const b=a.i.Fd[0],x=a.i.Fd[1];return a.m.CrossToRef(E,M,x),a.m.CrossToRef(M,x,b),this.rotationQuaternion?a.e.RotationQuaternionFromAxisToRef(b,M,x,this.rotationQuaternion):a.m.RotationFromAxisToRef(b,M,x,this.rotation),this}_checkOcclusionQuery(){return!1}disableEdgesRendering(){throw(0,t.b)("EdgesRenderer")}enableEdgesRendering(M,E,b){throw(0,t.b)("EdgesRenderer")}qj(){return this._scene.ae.filter((M=>M.k===this))}}U.OCCLUSION_TYPE_NONE=0,U.OCCLUSION_TYPE_OPTIMISTIC=1,U.OCCLUSION_TYPE_STRICT=2,U.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,U.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,U.CULLINGSTRATEGY_STANDARD=0,U.Oi=1,U.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,U.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,(0,x.d)([R.g.filter((function(){for(var M=arguments.length,E=new Array(M),b=0;b<M;b++)E[b]=arguments[b];let[x,k,a,g,n]=E;return!Array.isArray(x)&&!Array.isArray(k)&&!Array.isArray(a)&&!Array.isArray(g)&&!Array.isArray(n)}))],U,"_ApplySkeleton",null),(0,C.h)("BABYLON.AbstractMesh",U)},11562:(M,E,b)=>{"use strict";b.d(E,{b:()=>r});var x=b(970),k=b(1133),a=b(11557),g=b(1228),n=b(1328),J=b(11565),u=b(1343),T=b(1176),V=b(1126),I=b(1357),t=b(1005),y=b(1152),B=b(1060);class r{get boundingBias(){return this._boundingBias}set boundingBias(M){this._boundingBias?this._boundingBias.p(M):this._boundingBias=M.clone(),this.Ea(!0,null)}static CreateGeometryForMesh(M){const E=new r(r.RandomId(),M.va());return E.Ca(M),E}get meshes(){return this._meshes}constructor(M,E,b){let x=arguments.length>3&&void 0!==arguments[3]&&arguments[3],k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this._positionsCache=[],this._parentContainer=null,this.useBoundingInfoFromGeometry=!1,this._scene=E||t.b.LastCreatedScene,this._scene&&(this.id=M,this.uniqueId=this._scene.getUniqueId(),this._engine=this._scene.getEngine(),this._meshes=[],this._vertexBuffers={},this._indices=[],this._updatable=x,b?this.setAllVerticesData(b,x):this._totalVertices=0,this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),k&&(this.Ca(k),k.ce(!0)))}get extend(){return this._extend}va(){return this._scene}getEngine(){return this._engine}isReady(){return 1===this.delayLoadState||0===this.delayLoadState}get doNotSerialize(){for(let M=0;M<this._meshes.length;M++)if(!this._meshes[M].doNotSerialize)return!1;return!0}_rebuild(){this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer"));const M=new Set;for(const E in this._vertexBuffers)M.add(this._vertexBuffers[E].getWrapperBuffer());M.forEach((M=>{M._rebuild()}))}setAllVerticesData(M,E){M.applyToGeometry(this,E),this._notifyUpdate()}Ga(M,E){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],x=arguments.length>3?arguments[3]:void 0;b&&Array.isArray(E)&&(E=new Float32Array(E));const k=new g.g(this._engine,E,M,{updatable:b,postponeInternalCreation:0===this._meshes.length,stride:x,label:"Geometry_"+this.id+"_"+M});this.setVerticesBuffer(k)}removeVerticesData(M){this._vertexBuffers[M]&&(this._vertexBuffers[M].dispose(),delete this._vertexBuffers[M]),this._vertexArrayObjects&&this._disposeVertexArrayObjects()}setVerticesBuffer(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const k=M.getKind();this._vertexBuffers[k]&&b&&this._vertexBuffers[k].dispose(),M._buffer&&M._buffer._increaseReferences(),this._vertexBuffers[k]=M;const a=this._meshes,n=a.length;if(k===g.g.PositionKind){this._totalVertices=E??M._maxVerticesCount,this._updateExtend(M.getFloatData(this._totalVertices)),this._resetPointsArrayCache();const b=this._extend&&this._extend.minimum||new x.m(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),k=this._extend&&this._extend.maximum||new x.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);for(let M=0;M<n;M++){const E=a[M];E.buildBoundingInfo(b,k),E._createGlobalSubMesh(E.isUnIndexed),E.ce(!0),E.synchronizeInstances()}}this._notifyUpdate(k)}updateVerticesDataDirectly(M,E,b){let x=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const k=this.getVertexBuffer(M);k&&(k.updateDirectly(E,b,x),this._notifyUpdate(M))}updateVerticesData(M,E){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const x=this.getVertexBuffer(M);x&&(x.update(E),M===g.g.PositionKind&&this.Ea(b,E),this._notifyUpdate(M))}Ea(M,E){if(M&&this._updateExtend(E),this._resetPointsArrayCache(),M){const M=this._meshes;for(const E of M){E.hasBoundingInfo?E.getBoundingInfo().reConstruct(this._extend.minimum,this._extend.maximum):E.buildBoundingInfo(this._extend.minimum,this._extend.maximum);const M=E.Td;for(const E of M)E.refreshBoundingInfo()}}}_bind(M,E,b,x){if(!M)return;void 0===E&&(E=this._indexBuffer);const k=this.getVertexBuffers();if(!k)return;if(E!=this._indexBuffer||!this._vertexArrayObjects&&!x)return void this._engine.bindBuffers(k,E,M,b);const a=x||this._vertexArrayObjects,g=this._engine;a[M.key]||(a[M.key]=g.recordVertexArrayObject(k,E,M,b)),g.bindVertexArrayObject(a[M.key],E)}getTotalVertices(){return this.isReady()?this._totalVertices:0}getVerticesData(M,E,b){const x=this.getVertexBuffer(M);return x?x.getFloatData(this._totalVertices,b||E&&1!==this._meshes.length):null}copyVerticesData(M,E){const b=this.getVertexBuffer(M);if(!b)return;E[M]||(E[M]=new Float32Array(this._totalVertices*b.getSize()));const x=b.getData();x&&function(M,E,b,x,k,a,n,J){const u=E*g.g.GetTypeByteLength(b),T=n*E;if(J.length!==T)throw new Error("Output length is not valid");if(b===g.g.FLOAT&&k===u)if(M instanceof Array){const E=x/4;J.set(M,E)}else if(M instanceof ArrayBuffer){const E=new Float32Array(M,x,T);J.set(E)}else{const E=M.byteOffset+x;if(E%4)return B.d.Warn("CopyFloatData: copied misaligned data."),void J.set(new Float32Array(M.buffer.slice(E,E+4*T)));const b=new Float32Array(M.buffer,E,T);J.set(b)}else g.g.ForEach(M,x,k,E,b,T,a,((M,E)=>J[E]=M))}(x,b.getSize(),b.type,b.byteOffset,b.byteStride,b.normalized,this._totalVertices,E[M])}isVertexBufferUpdatable(M){const E=this._vertexBuffers[M];return!!E&&E.isUpdatable()}getVertexBuffer(M){return this.isReady()?this._vertexBuffers[M]:null}getVertexBuffers(){return this.isReady()?this._vertexBuffers:null}isVerticesDataPresent(M){return this._vertexBuffers?void 0!==this._vertexBuffers[M]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(M)}getVerticesDataKinds(){const M=[];let E;if(!this._vertexBuffers&&this._delayInfo)for(E in this._delayInfo)M.push(E);else for(E in this._vertexBuffers)M.push(E);return M}updateIndices(M,E){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._indexBuffer)if(this._indexBufferIsUpdatable){const x=M.length!==this._indices.length;if(b||(this._indices=M.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,M,E),x)for(const M of this._meshes)M._createGlobalSubMesh(!0)}else this.setIndices(M,null,!0)}setIndexBuffer(M,E,b){this._indices=[],this._indexBufferIsUpdatable=!1,this._indexBuffer=M,this._totalVertices=E,this._totalIndices=b,M.is32Bits||(M.is32Bits=this._totalIndices>65535);for(const x of this._meshes)x._createGlobalSubMesh(!0),x.synchronizeInstances();this._notifyUpdate()}setIndices(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],x=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=M,this._indexBufferIsUpdatable=b,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,b,"Geometry_"+this.id+"_IndexBuffer")),void 0!=E&&(this._totalVertices=E);for(const k of this._meshes)k._createGlobalSubMesh(!x),k.synchronizeInstances();this._notifyUpdate()}getTotalIndices(){return this.isReady()?void 0!==this._totalIndices?this._totalIndices:this._indices.length:0}Ed(M,E){if(!this.isReady())return null;const b=this._indices;return E||M&&1!==this._meshes.length?b.slice():b}getIndexBuffer(){return this.isReady()?this._indexBuffer:null}_releaseVertexArrayObject(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;M&&this._vertexArrayObjects&&this._vertexArrayObjects[M.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[M.key]),delete this._vertexArrayObjects[M.key])}releaseForMesh(M,E){const b=this._meshes,x=b.indexOf(M);-1!==x&&(b.splice(x,1),this._vertexArrayObjects&&M._invalidateInstanceVertexArrayObject(),M._geometry=null,0===b.length&&E&&this.dispose())}Ca(M){if(M._geometry===this)return;const E=M._geometry;E&&E.releaseForMesh(M),this._vertexArrayObjects&&M._invalidateInstanceVertexArrayObject();const b=this._meshes;M._geometry=this,M._internalAbstractMeshDataInfo._positions=null,this._scene.pushGeometry(this),b.push(M),this.isReady()?this._applyToMesh(M):this._boundingInfo&&M.setBoundingInfo(this._boundingInfo)}_updateExtend(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.useBoundingInfoFromGeometry&&this._boundingInfo)this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()};else{if(!M&&(M=this.getVerticesData(g.g.PositionKind),!M))return;this._extend=(0,I.e)(M,0,this._totalVertices,this.boundingBias,3)}}_applyToMesh(M){const E=this._meshes.length;for(const b in this._vertexBuffers)1===E&&this._vertexBuffers[b].create(),b===g.g.PositionKind&&(this._extend||this._updateExtend(),M.buildBoundingInfo(this._extend.minimum,this._extend.maximum),M._createGlobalSubMesh(M.isUnIndexed),M.Ea());1===E&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer")),M._syncGeometryWithMorphTargetManager(),M.synchronizeInstances()}_notifyUpdate(M){this.onGeometryUpdated&&this.onGeometryUpdated(this,M),this._vertexArrayObjects&&this._disposeVertexArrayObjects();for(const E of this._meshes)E._markSubMeshesAsAttributesDirty()}load(M,E){2!==this.delayLoadState&&(this.isReady()?E&&E():(this.delayLoadState=2,this._queueLoad(M,E)))}_queueLoad(M,E){this.delayLoadingFile&&(M.addPendingData(this),M._loadFile(this.delayLoadingFile,(b=>{if(!this._delayLoadingFunction)return;this._delayLoadingFunction(JSON.parse(b),this),this.delayLoadState=1,this._delayInfo=[],M.removePendingData(this);const x=this._meshes,k=x.length;for(let M=0;M<k;M++)this._applyToMesh(x[M]);E&&E()}),void 0,!0))}toLeftHanded(){const M=this.Ed(!1);if(null!=M&&M.length>0){for(let E=0;E<M.length;E+=3){const b=M[E+0];M[E+0]=M[E+2],M[E+2]=b}this.setIndices(M)}const E=this.getVerticesData(g.g.PositionKind,!1);if(null!=E&&E.length>0){for(let M=0;M<E.length;M+=3)E[M+2]=-E[M+2];this.Ga(g.g.PositionKind,E,!1)}const b=this.getVerticesData(g.g.NormalKind,!1);if(null!=b&&b.length>0){for(let M=0;M<b.length;M+=3)b[M+2]=-b[M+2];this.Ga(g.g.NormalKind,b,!1)}}_resetPointsArrayCache(){this._positions=null}_generatePointsArray(){if(this._positions)return!0;const M=this.getVerticesData(g.g.PositionKind);if(!M||0===M.length)return!1;for(let E=3*this._positionsCache.length,b=this._positionsCache.length;E<M.length;E+=3,++b)this._positionsCache[b]=x.m.Id(M,E);for(let E=0,b=0;E<M.length;E+=3,++b)this._positionsCache[b].set(M[0+E],M[1+E],M[2+E]);return this._positionsCache.length=M.length/3,this._positions=this._positionsCache,!0}u(){return this._isDisposed}_disposeVertexArrayObjects(){if(this._vertexArrayObjects){for(const b in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[b]);this._vertexArrayObjects={};const M=this._meshes,E=M.length;for(let b=0;b<E;b++)M[b]._invalidateInstanceVertexArrayObject()}}dispose(){const M=this._meshes,E=M.length;let b;for(b=0;b<E;b++)this.releaseForMesh(M[b]);this._meshes.length=0,this._disposeVertexArrayObjects();for(const x in this._vertexBuffers)this._vertexBuffers[x].dispose();if(this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._parentContainer){const M=this._parentContainer.geometries.indexOf(this);M>-1&&this._parentContainer.geometries.splice(M,1),this._parentContainer=null}this._isDisposed=!0}j(M){const E=new a.d;E.indices=[];const b=this.Ed();if(b)for(let a=0;a<b.length;a++)E.indices.push(b[a]);let x,k=!1,g=!1;for(x in this._vertexBuffers){const M=this.getVerticesData(x);if(M&&(M instanceof Float32Array?E.set(new Float32Array(M),x):E.set(M.slice(0),x),!g)){const M=this.getVertexBuffer(x);M&&(k=M.isUpdatable(),g=!k)}}const n=new r(M,this._scene,E,k);for(x in n.delayLoadState=this.delayLoadState,n.delayLoadingFile=this.delayLoadingFile,n._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)n._delayInfo=n._delayInfo||[],n._delayInfo.push(x);return n._boundingInfo=new u.d(this._extend.minimum,this._extend.maximum),n}serialize(){const M={};return M.id=this.id,M.uniqueId=this.uniqueId,M.updatable=this._updatable,V.b&&V.b.HasTags(this)&&(M.tags=V.b.GetTags(this)),M}_toNumberArray(M){return Array.isArray(M)?M:Array.prototype.slice.call(M)}clearCachedData(){this._indices=[],this._resetPointsArrayCache();for(const M in this._vertexBuffers)Object.prototype.hasOwnProperty.call(this._vertexBuffers,M)&&(this._vertexBuffers[M]._buffer._data=null)}serializeVerticeData(){const M=this.serialize();return this.isVerticesDataPresent(g.g.PositionKind)&&(M.xa=this._toNumberArray(this.getVerticesData(g.g.PositionKind)),this.isVertexBufferUpdatable(g.g.PositionKind)&&(M.xa._updatable=!0)),this.isVerticesDataPresent(g.g.NormalKind)&&(M.ya=this._toNumberArray(this.getVerticesData(g.g.NormalKind)),this.isVertexBufferUpdatable(g.g.NormalKind)&&(M.ya._updatable=!0)),this.isVerticesDataPresent(g.g.TangentKind)&&(M.tangents=this._toNumberArray(this.getVerticesData(g.g.TangentKind)),this.isVertexBufferUpdatable(g.g.TangentKind)&&(M.tangents._updatable=!0)),this.isVerticesDataPresent(g.g.UVKind)&&(M.Aa=this._toNumberArray(this.getVerticesData(g.g.UVKind)),this.isVertexBufferUpdatable(g.g.UVKind)&&(M.Aa._updatable=!0)),this.isVerticesDataPresent(g.g.UV2Kind)&&(M.uvs2=this._toNumberArray(this.getVerticesData(g.g.UV2Kind)),this.isVertexBufferUpdatable(g.g.UV2Kind)&&(M.uvs2._updatable=!0)),this.isVerticesDataPresent(g.g.UV3Kind)&&(M.uvs3=this._toNumberArray(this.getVerticesData(g.g.UV3Kind)),this.isVertexBufferUpdatable(g.g.UV3Kind)&&(M.uvs3._updatable=!0)),this.isVerticesDataPresent(g.g.UV4Kind)&&(M.uvs4=this._toNumberArray(this.getVerticesData(g.g.UV4Kind)),this.isVertexBufferUpdatable(g.g.UV4Kind)&&(M.uvs4._updatable=!0)),this.isVerticesDataPresent(g.g.UV5Kind)&&(M.uvs5=this._toNumberArray(this.getVerticesData(g.g.UV5Kind)),this.isVertexBufferUpdatable(g.g.UV5Kind)&&(M.uvs5._updatable=!0)),this.isVerticesDataPresent(g.g.UV6Kind)&&(M.uvs6=this._toNumberArray(this.getVerticesData(g.g.UV6Kind)),this.isVertexBufferUpdatable(g.g.UV6Kind)&&(M.uvs6._updatable=!0)),this.isVerticesDataPresent(g.g.ColorKind)&&(M.za=this._toNumberArray(this.getVerticesData(g.g.ColorKind)),this.isVertexBufferUpdatable(g.g.ColorKind)&&(M.za._updatable=!0)),this.isVerticesDataPresent(g.g.MatricesIndicesKind)&&(M.matricesIndices=this._toNumberArray(this.getVerticesData(g.g.MatricesIndicesKind)),M.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(g.g.MatricesIndicesKind)&&(M.matricesIndices._updatable=!0)),this.isVerticesDataPresent(g.g.MatricesWeightsKind)&&(M.matricesWeights=this._toNumberArray(this.getVerticesData(g.g.MatricesWeightsKind)),this.isVertexBufferUpdatable(g.g.MatricesWeightsKind)&&(M.matricesWeights._updatable=!0)),M.indices=this._toNumberArray(this.Ed()),M}static ExtractFromMesh(M,E){const b=M._geometry;return b?b.j(E):null}static RandomId(){return T.e.RandomId()}static _GetGeometryByLoadedUniqueId(M,E){for(let b=0;b<E.geometries.length;b++)if(E.geometries[b]._loadedUniqueId===M)return E.geometries[b];return null}static _ImportGeometry(M,E){const b=E.va(),x=M.geometryUniqueId,a=M.geometryId;if(x||a){const M=x?this._GetGeometryByLoadedUniqueId(x,b):b.getGeometryById(a);M&&M.Ca(E)}else if(M instanceof ArrayBuffer){const b=E._binaryInfo;if(b.positionsAttrDesc&&b.positionsAttrDesc.count>0){const x=new Float32Array(M,b.positionsAttrDesc.offset,b.positionsAttrDesc.count);E.Ga(g.g.PositionKind,x,!1)}if(b.normalsAttrDesc&&b.normalsAttrDesc.count>0){const x=new Float32Array(M,b.normalsAttrDesc.offset,b.normalsAttrDesc.count);E.Ga(g.g.NormalKind,x,!1)}if(b.tangetsAttrDesc&&b.tangetsAttrDesc.count>0){const x=new Float32Array(M,b.tangetsAttrDesc.offset,b.tangetsAttrDesc.count);E.Ga(g.g.TangentKind,x,!1)}if(b.uvsAttrDesc&&b.uvsAttrDesc.count>0){const x=new Float32Array(M,b.uvsAttrDesc.offset,b.uvsAttrDesc.count);if(y.c)for(let M=1;M<x.length;M+=2)x[M]=1-x[M];E.Ga(g.g.UVKind,x,!1)}if(b.uvs2AttrDesc&&b.uvs2AttrDesc.count>0){const x=new Float32Array(M,b.uvs2AttrDesc.offset,b.uvs2AttrDesc.count);if(y.c)for(let M=1;M<x.length;M+=2)x[M]=1-x[M];E.Ga(g.g.UV2Kind,x,!1)}if(b.uvs3AttrDesc&&b.uvs3AttrDesc.count>0){const x=new Float32Array(M,b.uvs3AttrDesc.offset,b.uvs3AttrDesc.count);if(y.c)for(let M=1;M<x.length;M+=2)x[M]=1-x[M];E.Ga(g.g.UV3Kind,x,!1)}if(b.uvs4AttrDesc&&b.uvs4AttrDesc.count>0){const x=new Float32Array(M,b.uvs4AttrDesc.offset,b.uvs4AttrDesc.count);if(y.c)for(let M=1;M<x.length;M+=2)x[M]=1-x[M];E.Ga(g.g.UV4Kind,x,!1)}if(b.uvs5AttrDesc&&b.uvs5AttrDesc.count>0){const x=new Float32Array(M,b.uvs5AttrDesc.offset,b.uvs5AttrDesc.count);if(y.c)for(let M=1;M<x.length;M+=2)x[M]=1-x[M];E.Ga(g.g.UV5Kind,x,!1)}if(b.uvs6AttrDesc&&b.uvs6AttrDesc.count>0){const x=new Float32Array(M,b.uvs6AttrDesc.offset,b.uvs6AttrDesc.count);if(y.c)for(let M=1;M<x.length;M+=2)x[M]=1-x[M];E.Ga(g.g.UV6Kind,x,!1)}if(b.colorsAttrDesc&&b.colorsAttrDesc.count>0){const x=new Float32Array(M,b.colorsAttrDesc.offset,b.colorsAttrDesc.count);E.Ga(g.g.ColorKind,x,!1,b.colorsAttrDesc.stride)}if(b.matricesIndicesAttrDesc&&b.matricesIndicesAttrDesc.count>0){const x=new Int32Array(M,b.matricesIndicesAttrDesc.offset,b.matricesIndicesAttrDesc.count),k=[];for(let M=0;M<x.length;M++){const E=x[M];k.push(255&E),k.push((65280&E)>>8),k.push((16711680&E)>>16),k.push(E>>24&255)}E.Ga(g.g.MatricesIndicesKind,k,!1)}if(b.matricesIndicesExtraAttrDesc&&b.matricesIndicesExtraAttrDesc.count>0){const x=new Int32Array(M,b.matricesIndicesExtraAttrDesc.offset,b.matricesIndicesExtraAttrDesc.count),k=[];for(let M=0;M<x.length;M++){const E=x[M];k.push(255&E),k.push((65280&E)>>8),k.push((16711680&E)>>16),k.push(E>>24&255)}E.Ga(g.g.MatricesIndicesExtraKind,k,!1)}if(b.matricesWeightsAttrDesc&&b.matricesWeightsAttrDesc.count>0){const x=new Float32Array(M,b.matricesWeightsAttrDesc.offset,b.matricesWeightsAttrDesc.count);E.Ga(g.g.MatricesWeightsKind,x,!1)}if(b.indicesAttrDesc&&b.indicesAttrDesc.count>0){const x=new Int32Array(M,b.indicesAttrDesc.offset,b.indicesAttrDesc.count);E.setIndices(x,null)}if(b.subMeshesAttrDesc&&b.subMeshesAttrDesc.count>0){const x=new Int32Array(M,b.subMeshesAttrDesc.offset,5*b.subMeshesAttrDesc.count);E.Td=[];for(let M=0;M<b.subMeshesAttrDesc.count;M++){const b=x[5*M+0],k=x[5*M+1],a=x[5*M+2],g=x[5*M+3],J=x[5*M+4];n.b.AddToMesh(b,k,a,g,J,E)}}}else if(M.xa&&M.ya&&M.indices){if(E.Ga(g.g.PositionKind,M.xa,M.xa._updatable),E.Ga(g.g.NormalKind,M.ya,M.ya._updatable),M.tangents&&E.Ga(g.g.TangentKind,M.tangents,M.tangents._updatable),M.Aa&&E.Ga(g.g.UVKind,M.Aa,M.Aa._updatable),M.uvs2&&E.Ga(g.g.UV2Kind,M.uvs2,M.uvs2._updatable),M.uvs3&&E.Ga(g.g.UV3Kind,M.uvs3,M.uvs3._updatable),M.uvs4&&E.Ga(g.g.UV4Kind,M.uvs4,M.uvs4._updatable),M.uvs5&&E.Ga(g.g.UV5Kind,M.uvs5,M.uvs5._updatable),M.uvs6&&E.Ga(g.g.UV6Kind,M.uvs6,M.uvs6._updatable),M.za&&E.Ga(g.g.ColorKind,k.h.CheckColors4(M.za,M.xa.length/3),M.za._updatable),M.matricesIndices)if(M.matricesIndices._isExpanded)delete M.matricesIndices._isExpanded,E.Ga(g.g.MatricesIndicesKind,M.matricesIndices,M.matricesIndices._updatable);else{const b=[];for(let E=0;E<M.matricesIndices.length;E++){const x=M.matricesIndices[E];b.push(255&x),b.push((65280&x)>>8),b.push((16711680&x)>>16),b.push(x>>24&255)}E.Ga(g.g.MatricesIndicesKind,b,M.matricesIndices._updatable)}if(M.matricesIndicesExtra)if(M.matricesIndicesExtra._isExpanded)delete M.matricesIndices._isExpanded,E.Ga(g.g.MatricesIndicesExtraKind,M.matricesIndicesExtra,M.matricesIndicesExtra._updatable);else{const b=[];for(let E=0;E<M.matricesIndicesExtra.length;E++){const x=M.matricesIndicesExtra[E];b.push(255&x),b.push((65280&x)>>8),b.push((16711680&x)>>16),b.push(x>>24&255)}E.Ga(g.g.MatricesIndicesExtraKind,b,M.matricesIndicesExtra._updatable)}M.matricesWeights&&(r._CleanMatricesWeights(M,E),E.Ga(g.g.MatricesWeightsKind,M.matricesWeights,M.matricesWeights._updatable)),M.matricesWeightsExtra&&E.Ga(g.g.MatricesWeightsExtraKind,M.matricesWeightsExtra,M.matricesWeights._updatable),E.setIndices(M.indices,null)}if(M.Td){E.Td=[];for(let b=0;b<M.Td.length;b++){const x=M.Td[b];n.b.AddToMesh(x.materialIndex,x.verticesStart,x.verticesCount,x.indexStart,x.indexCount,E)}}E._shouldGenerateFlatShading&&(E.convertToFlatShadedMesh(),E._shouldGenerateFlatShading=!1),E.ce(!0),b.onMeshImportedObservable.notifyObservers(E)}static _CleanMatricesWeights(M,E){const b=.001;if(!J.d.CleanBoneMatrixWeights)return;let x=0;if(!(M.skeletonId>-1))return;{const b=E.va().getLastSkeletonById(M.skeletonId);if(!b)return;x=b.bones.length}const k=E.getVerticesData(g.g.MatricesIndicesKind),a=E.getVerticesData(g.g.MatricesIndicesExtraKind),n=M.matricesWeights,u=M.matricesWeightsExtra,T=M.numBoneInfluencer,V=n.length;for(let g=0;g<V;g+=4){let M=0,E=-1;for(let x=0;x<4;x++){const k=n[g+x];M+=k,k<b&&E<0&&(E=x)}if(u)for(let x=0;x<4;x++){const k=u[g+x];M+=k,k<b&&E<0&&(E=x+4)}if((E<0||E>T-1)&&(E=T-1),M>b){const E=1/M;for(let M=0;M<4;M++)n[g+M]*=E;if(u)for(let M=0;M<4;M++)u[g+M]*=E}else E>=4?(u[g+E-4]=1-M,a[g+E-4]=x):(n[g+E]=1-M,k[g+E]=x)}E.Ga(g.g.MatricesIndicesKind,k),M.matricesWeightsExtra&&E.Ga(g.g.MatricesIndicesExtraKind,a)}static Parse(M,E,b){const k=new r(M.id,E,void 0,M.updatable);return k._loadedUniqueId=M.uniqueId,V.b&&V.b.AddTagsTo(k,M.tags),M.delayLoadingFile?(k.delayLoadState=4,k.delayLoadingFile=b+M.delayLoadingFile,k._boundingInfo=new u.d(x.m.Id(M.boundingBoxMinimum),x.m.Id(M.boundingBoxMaximum)),k._delayInfo=[],M.hasUVs&&k._delayInfo.push(g.g.UVKind),M.hasUVs2&&k._delayInfo.push(g.g.UV2Kind),M.hasUVs3&&k._delayInfo.push(g.g.UV3Kind),M.hasUVs4&&k._delayInfo.push(g.g.UV4Kind),M.hasUVs5&&k._delayInfo.push(g.g.UV5Kind),M.hasUVs6&&k._delayInfo.push(g.g.UV6Kind),M.hasColors&&k._delayInfo.push(g.g.ColorKind),M.hasMatricesIndices&&k._delayInfo.push(g.g.MatricesIndicesKind),M.hasMatricesWeights&&k._delayInfo.push(g.g.MatricesWeightsKind),k._delayLoadingFunction=a.d.ImportVertexData):a.d.ImportVertexData(M,k),E.pushGeometry(k,!0),k}}},12144:(M,E,b)=>{"use strict";b.d(E,{d:()=>I});var x=b(970),k=b(1060),a=b(11569),g=b(11537),n=b(1182),J=b(11578),u=b(1228),T=b(1176),V=b(989);g.e._instancedMeshFactory=(M,E)=>{const b=new I(M,E);if(E.instancedBuffers){b.instancedBuffers={};for(const M in E.instancedBuffers)b.instancedBuffers[M]=E.instancedBuffers[M]}return b};class I extends a.d{constructor(M,E){super(M,E.va()),this._indexInSourceMeshInstanceArray=-1,this._distanceToCamera=0,E.Ej(this),this._sourceMesh=E,this._unIndexed=E._unIndexed,this.position.p(E.position),this.rotation.p(E.rotation),this.ve.p(E.ve),E.rotationQuaternion&&(this.rotationQuaternion=E.rotationQuaternion.clone()),this.animations=E.animations.slice();for(const b of E.getAnimationRanges())null!=b&&this.createAnimationRange(b.name,b.from,b.to);this.infiniteDistance=E.infiniteDistance,this.setPivotMatrix(E.getPivotMatrix()),this.refreshBoundingInfo(!0,!0),this._syncSubMeshes()}getClassName(){return"InstancedMesh"}get lightSources(){return this._sourceMesh._lightSources}_resyncLightSources(){}_resyncLightSource(){}_removeLightSource(){}get receiveShadows(){return this._sourceMesh.receiveShadows}set receiveShadows(M){var E;(null===(E=this._sourceMesh)||void 0===E?void 0:E.receiveShadows)!==M&&T.e.Warn("Setting receiveShadows on an instanced mesh has no effect")}get material(){return this._sourceMesh.material}set material(M){var E;(null===(E=this._sourceMesh)||void 0===E?void 0:E.material)!==M&&T.e.Warn("Setting material on an instanced mesh has no effect")}get visibility(){return this._sourceMesh.visibility}set visibility(M){var E;(null===(E=this._sourceMesh)||void 0===E?void 0:E.visibility)!==M&&T.e.Warn("Setting visibility on an instanced mesh has no effect")}get skeleton(){return this._sourceMesh.skeleton}set skeleton(M){var E;(null===(E=this._sourceMesh)||void 0===E?void 0:E.skeleton)!==M&&T.e.Warn("Setting skeleton on an instanced mesh has no effect")}get renderingGroupId(){return this._sourceMesh.renderingGroupId}set renderingGroupId(M){this._sourceMesh&&M!==this._sourceMesh.renderingGroupId&&k.d.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")}getTotalVertices(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0}getTotalIndices(){return this._sourceMesh.getTotalIndices()}get sourceMesh(){return this._sourceMesh}gd(M){return this._sourceMesh.gd(M)}isReady(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._sourceMesh.isReady(M,!0)}getVerticesData(M,E,b){return this._sourceMesh.getVerticesData(M,E,b)}copyVerticesData(M,E){this._sourceMesh.copyVerticesData(M,E)}Ga(M,E,b,x){return this.sourceMesh&&this.sourceMesh.Ga(M,E,b,x),this.sourceMesh}updateVerticesData(M,E,b,x){return this.sourceMesh&&this.sourceMesh.updateVerticesData(M,E,b,x),this.sourceMesh}setIndices(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.sourceMesh&&this.sourceMesh.setIndices(M,E),this.sourceMesh}isVerticesDataPresent(M){return this._sourceMesh.isVerticesDataPresent(M)}Ed(){return this._sourceMesh.Ed()}get _positions(){return this._sourceMesh._positions}refreshBoundingInfo(){let M,E=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;M="object"===typeof E?E:{applySkeleton:E,applyMorph:b};const x=this._sourceMesh.le?this._sourceMesh.le.boundingBias:null;return this.Fa(this._sourceMesh._getData(M,null,u.g.PositionKind),x),this}_preActivate(){return this._currentLOD&&this._currentLOD._preActivate(),this}_activate(M,E){if(super._activate(M,E),this._sourceMesh.Td||k.d.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!==this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,M),E){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1}_postActivate(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)}getWorldMatrix(){if(this._currentLOD&&this._currentLOD.billboardMode!==J.c.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new x.d);const M=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,x.i.Fd[7].p(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.p(this._currentLOD.ce(!0)),this._currentLOD.position.p(x.i.Fd[7]),this._currentLOD._masterMesh=M,this._billboardWorldMatrix}return super.getWorldMatrix()}get isAnInstance(){return!0}getLOD(M){if(!M)return this;const E=this.sourceMesh.getLODLevels();if(E&&0!==E.length){const E=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(M,E.boundingSphere)}else this._currentLOD=this.sourceMesh;return this._currentLOD}_preActivateForIntermediateRendering(M){return this.sourceMesh._preActivateForIntermediateRendering(M)}_syncSubMeshes(){if(this.releaseSubMeshes(),this._sourceMesh.Td)for(let M=0;M<this._sourceMesh.Td.length;M++)this._sourceMesh.Td[M].clone(this,this._sourceMesh);return this}_generatePointsArray(){return this._sourceMesh._generatePointsArray()}Ea(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}clone(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2?arguments[2]:void 0;const x=((arguments.length>3?arguments[3]:void 0)||this._sourceMesh).gd(M);if(n.e.DeepCopy(this,x,["name","Td","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","pj","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo"],[]),this.refreshBoundingInfo(),E&&(x.parent=E),!b)for(let k=0;k<this.va().meshes.length;k++){const M=this.va().meshes[k];M.parent===this&&M.clone(M.name,x)}return x.ce(!0),this.onClonedObservable.notifyObservers(x),x}dispose(M){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._sourceMesh.Dj(this),super.dispose(M,E)}_serializeAsParent(M){super._serializeAsParent(M),M.parentId=this._sourceMesh.uniqueId,M.parentInstanceIndex=this._indexInSourceMeshInstanceArray}instantiateHierarchy(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,E=arguments.length>1?arguments[1]:void 0,b=arguments.length>2?arguments[2]:void 0;const x=this.clone("Clone of "+(this.name||this.id),M||this.parent,!0,E&&E.newSourcedMesh);x&&b&&b(this,x);for(const k of this.getChildTransformNodes(!0))k.instantiateHierarchy(x,E,b);return x}}g.e.prototype.registerInstancedBuffer=function(M,E){var b,x;if(null===(b=this._userInstancedBuffersStorage)||void 0===b||null===(x=b.vertexBuffers[M])||void 0===x||x.dispose(),!this.instancedBuffers){this.instancedBuffers={};for(const M of this.instances)M.instancedBuffers={}}this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this.instancedBuffers[M]=null,this._userInstancedBuffersStorage.strides[M]=E,this._userInstancedBuffersStorage.sizes[M]=32*E,this._userInstancedBuffersStorage.data[M]=new Float32Array(this._userInstancedBuffersStorage.sizes[M]),this._userInstancedBuffersStorage.vertexBuffers[M]=new u.g(this.getEngine(),this._userInstancedBuffersStorage.data[M],M,!0,!1,E,!0);for(const k of this.instances)k.instancedBuffers[M]=null;this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()},g.e.prototype._processInstancedBuffers=function(M,E){const b=M?M.length:0;for(const x in this.instancedBuffers){let k=this._userInstancedBuffersStorage.sizes[x];const a=this._userInstancedBuffersStorage.strides[x],g=(b+1)*a;for(;k<g;)k*=2;this._userInstancedBuffersStorage.data[x].length!=k&&(this._userInstancedBuffersStorage.data[x]=new Float32Array(k),this._userInstancedBuffersStorage.sizes[x]=k,this._userInstancedBuffersStorage.vertexBuffers[x]&&(this._userInstancedBuffersStorage.vertexBuffers[x].dispose(),this._userInstancedBuffersStorage.vertexBuffers[x]=null));const n=this._userInstancedBuffersStorage.data[x];let J=0;if(E){const M=this.instancedBuffers[x];M.toArray?M.toArray(n,J):M.copyToArray?M.copyToArray(n,J):n[J]=M,J+=a}for(let E=0;E<b;E++){const b=M[E].instancedBuffers[x];b.toArray?b.toArray(n,J):b.copyToArray?b.copyToArray(n,J):n[J]=b,J+=a}this._userInstancedBuffersStorage.vertexBuffers[x]?this._userInstancedBuffersStorage.vertexBuffers[x].updateDirectly(n,0):(this._userInstancedBuffersStorage.vertexBuffers[x]=new u.g(this.getEngine(),this._userInstancedBuffersStorage.data[x],x,!0,!1,a,!0),this._invalidateInstanceVertexArrayObject())}},g.e.prototype._invalidateInstanceVertexArrayObject=function(){if(this._userInstancedBuffersStorage&&void 0!==this._userInstancedBuffersStorage.vertexArrayObjects){for(const M in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[M]);this._userInstancedBuffersStorage.vertexArrayObjects={}}},g.e.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(const M in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[M]&&this._userInstancedBuffersStorage.vertexBuffers[M].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}},(0,V.h)("BABYLON.InstancedMesh",I)},11537:(M,E,b)=>{"use strict";b.d(E,{e:()=>P,f:()=>K});var x=b(962),k=b(1176),a=b(1182),g=b(1126),n=b(11546),J=b(11548),u=b(970),T=b(1133),V=b(11554),I=b(1228),t=b(11557),y=b(11562),B=b(11569),r=b(1328),c=b(1326),C=b(11580),R=b(11565),w=b(1124),S=b(1060),X=b(989),U=b(1056),v=b(1260);class N{constructor(M,E){this.distanceOrScreenCoverage=M,this.mesh=E}}class K{}class h{constructor(){this.visibleInstances={},this.batchCache=new Z,this.batchCacheReplacementModeInFrozenMode=new Z,this.instancesBufferSize=2048}}class Z{constructor(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=[],this.hardwareInstancedRendering=[]}}class O{constructor(){this.instancesCount=0,this.matrixBuffer=null,this.previousMatrixBuffer=null,this.matrixBufferSize=512,this.matrixData=null,this.boundingVectors=[],this.worldMatrices=null}}class p{constructor(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._useLODScreenCoverage=!1,this._effectiveMaterial=null,this._forcedInstanceCount=0,this._overrideRenderingFillMode=null}}class P extends B.d{static _GetDefaultSideOrientation(M){return M||P.FRONTSIDE}get useLODScreenCoverage(){return this._internalMeshDataInfo._useLODScreenCoverage}set useLODScreenCoverage(M){this._internalMeshDataInfo._useLODScreenCoverage=M,this._sortLODLevels()}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(M){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==M&&(M&&this._internalMeshDataInfo._sourcePositions&&(this.Ga(I.g.PositionKind,this._internalMeshDataInfo._sourcePositions,!0),this._internalMeshDataInfo._sourceNormals&&this.Ga(I.g.NormalKind,this._internalMeshDataInfo._sourceNormals,!0),this._internalMeshDataInfo._sourcePositions=null,this._internalMeshDataInfo._sourceNormals=null),this._internalAbstractMeshDataInfo._computeBonesUsingShaders=M,this._markSubMeshesAsAttributesDirty())}get onBeforeRenderObservable(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new x.b),this._internalMeshDataInfo._onBeforeRenderObservable}get onBeforeBindObservable(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new x.b),this._internalMeshDataInfo._onBeforeBindObservable}get onAfterRenderObservable(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new x.b),this._internalMeshDataInfo._onAfterRenderObservable}get onBetweenPassObservable(){return this._internalMeshDataInfo._onBetweenPassObservable||(this._internalMeshDataInfo._onBetweenPassObservable=new x.b),this._internalMeshDataInfo._onBetweenPassObservable}get onBeforeDrawObservable(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new x.b),this._internalMeshDataInfo._onBeforeDrawObservable}set onBeforeDraw(M){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(M)}get hasInstances(){return this.instances.length>0}get hasThinInstances(){return(this.forcedInstanceCount||this._thinInstanceDataStorage.instancesCount||0)>0}get forcedInstanceCount(){return this._internalMeshDataInfo._forcedInstanceCount}set forcedInstanceCount(M){this._internalMeshDataInfo._forcedInstanceCount=M}get sideOrientation(){return this._internalMeshDataInfo._sideOrientation}set sideOrientation(M){this._internalMeshDataInfo._sideOrientation=M,this._internalAbstractMeshDataInfo._sideOrientationHint=this._scene.useRightHandedSystem&&1===M||!this._scene.useRightHandedSystem&&0===M}get overrideMaterialSideOrientation(){return this.sideOrientation}set overrideMaterialSideOrientation(M){this.sideOrientation=M,this.material&&(this.material.sideOrientation=null)}get overrideRenderingFillMode(){return this._internalMeshDataInfo._overrideRenderingFillMode}set overrideRenderingFillMode(M){this._internalMeshDataInfo._overrideRenderingFillMode=M}get material(){return this._internalAbstractMeshDataInfo._material}set material(M){M&&(this.material&&null===this.material.sideOrientation||this._internalAbstractMeshDataInfo._sideOrientationHint)&&(M.sideOrientation=null),this._setMaterial(M)}get source(){return this._internalMeshDataInfo._source}get cloneMeshMap(){return this._internalMeshDataInfo.meshMap}get isUnIndexed(){return this._unIndexed}set isUnIndexed(M){this._unIndexed!==M&&(this._unIndexed=M,this._markSubMeshesAsAttributesDirty())}get worldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesData}get previousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesPreviousData}get manualUpdateOfWorldMatrixInstancedBuffer(){return this._instanceDataStorage.manualUpdate}set manualUpdateOfWorldMatrixInstancedBuffer(M){this._instanceDataStorage.manualUpdate=M}get manualUpdateOfPreviousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.previousManualUpdate}set manualUpdateOfPreviousWorldMatrixInstancedBuffer(M){this._instanceDataStorage.previousManualUpdate=M}get forceWorldMatrixInstancedBufferUpdate(){return this._instanceDataStorage.forceMatrixUpdates}set forceWorldMatrixInstancedBufferUpdate(M){this._instanceDataStorage.forceMatrixUpdates=M}_copySource(M,E){let b=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const x=this.va();if(M._geometry&&M._geometry.Ca(this),a.e.DeepCopy(M,this,["name","material","skeleton","instances","parent","uniqueId","source","metadata","morphTargetManager","hasInstances","worldMatrixInstancedBuffer","previousWorldMatrixInstancedBuffer","hasLODLevels","le","isBlocked","areNormalsFrozen","facetNb","isFacetDataEnabled","lightSources","useBones","isAnInstance","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","pj","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","cloneMeshMap","hasBoundingInfo","physicsBody","physicsImpostor"],["_poseMatrix"]),this._internalMeshDataInfo._source=M,x.useClonedMeshMap&&(M._internalMeshDataInfo.meshMap||(M._internalMeshDataInfo.meshMap={}),M._internalMeshDataInfo.meshMap[this.uniqueId]=this),this._originalBuilderSideOrientation=M._originalBuilderSideOrientation,this._creationDataStorage=M._creationDataStorage,M._ranges){const E=M._ranges;for(const M in E)Object.prototype.hasOwnProperty.call(E,M)&&E[M]&&this.createAnimationRange(M,E[M].from,E[M].to)}if(M.metadata&&M.metadata.clone?this.metadata=M.metadata.clone():this.metadata=M.metadata,this._internalMetadata=M._internalMetadata,g.b&&g.b.HasTags(M)&&g.b.AddTagsTo(this,g.b.GetTags(M,!0)),this.wg(M.isEnabled(!1)),this.parent=M.parent,this.setPivotMatrix(M.getPivotMatrix(),this._postMultiplyPivotMatrix),this.id=this.name+"."+M.id,this.material=M.material,!E){const E=M.getDescendants(!0);for(let M=0;M<E.length;M++){const b=E[M];b.clone&&b.clone(this.name+"."+b.name,this)}}if(M.morphTargetManager&&(this.morphTargetManager=M.morphTargetManager),x.getPhysicsEngine){const E=x.getPhysicsEngine();if(b&&E)if(1===E.getPluginVersion()){const b=E.getImpostorForPhysicsObject(M);b&&(this.physicsImpostor=b.clone(this))}else 2===E.getPluginVersion()&&M.physicsBody&&M.physicsBody.clone(this)}for(let k=0;k<x.ae.length;k++){const E=x.ae[k];E.k===M&&E.clone(E.name,this)}this.skeleton=M.skeleton,this.refreshBoundingInfo(!0,!0),this.ce(!0)}constructor(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4?arguments[4]:void 0,g=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];super(M,E),this._internalMeshDataInfo=new p,this.delayLoadState=0,this.instances=[],this._creationDataStorage=null,this._geometry=null,this._instanceDataStorage=new h,this._thinInstanceDataStorage=new O,this._shouldGenerateFlatShading=!1,this._originalBuilderSideOrientation=P.DEFAULTSIDE,this.ignoreCameraMaxZ=!1,E=this.va(),this._scene.useRightHandedSystem?this.sideOrientation=0:this.sideOrientation=1,this._onBeforeDraw=(M,E,b)=>{M&&b&&(this._uniformBuffer?this.transferToEffect(E):b.bindOnlyWorldMatrix(E))},k&&this._copySource(k,a,g),null!==b&&(this.parent=b),this._instanceDataStorage.hardwareInstancedRendering=this.getEngine().getCaps().instancedArrays,this._internalMeshDataInfo._onMeshReadyObserverAdded=M=>{M.unregisterOnNextCall=!0,this.isReady(!0)?this.onMeshReadyObservable.notifyObservers(this):this._internalMeshDataInfo._checkReadinessObserver||(this._internalMeshDataInfo._checkReadinessObserver=this._scene.onBeforeRenderObservable.add((()=>{this.isReady(!0)&&(this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),this._internalMeshDataInfo._checkReadinessObserver=null,this.onMeshReadyObservable.notifyObservers(this))})))},this.onMeshReadyObservable=new x.b(this._internalMeshDataInfo._onMeshReadyObserverAdded),k&&k.onClonedObservable.notifyObservers(this)}instantiateHierarchy(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,E=arguments.length>1?arguments[1]:void 0,b=arguments.length>2?arguments[2]:void 0;const x=0===this.getTotalVertices()||E&&E.doNotInstantiate&&(!0===E.doNotInstantiate||E.doNotInstantiate(this))?this.clone("Clone of "+(this.name||this.id),M||this.parent,!0):this.gd("instance of "+(this.name||this.id));x.parent=M||this.parent,x.position=this.position.clone(),x.ve=this.ve.clone(),this.rotationQuaternion?x.rotationQuaternion=this.rotationQuaternion.clone():x.rotation=this.rotation.clone(),b&&b(this,x);for(const k of this.getChildTransformNodes(!0))"InstancedMesh"===k.getClassName()&&"Mesh"===x.getClassName()&&k.sourceMesh===this?k.instantiateHierarchy(x,{doNotInstantiate:E&&E.doNotInstantiate||!1,newSourcedMesh:x},b):k.instantiateHierarchy(x,E,b);return x}getClassName(){return"Mesh"}get _isMesh(){return!0}toString(M){let E=super.toString(M);if(E+=", n vertices: "+this.getTotalVertices(),E+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(let b=0;b<this.animations.length;b++)E+=", animation[0]: "+this.animations[b].toString(M);if(M)if(this._geometry){const M=this.Ed(),b=this.getVerticesData(I.g.PositionKind);b&&M&&(E+=", flat shading: "+(b.length/3===M.length?"YES":"NO"))}else E+=", flat shading: UNKNOWN";return E}_unBindEffect(){super._unBindEffect();for(const M of this.instances)M._unBindEffect()}get hasLODLevels(){return this._internalMeshDataInfo._LODLevels.length>0}getLODLevels(){return this._internalMeshDataInfo._LODLevels}_sortLODLevels(){const M=this._internalMeshDataInfo._useLODScreenCoverage?-1:1;this._internalMeshDataInfo._LODLevels.sort(((E,b)=>E.distanceOrScreenCoverage<b.distanceOrScreenCoverage?M:E.distanceOrScreenCoverage>b.distanceOrScreenCoverage?-M:0))}addLODLevel(M,E){if(E&&E._masterMesh)return S.d.Warn("You cannot use a mesh as LOD level twice"),this;const b=new N(M,E);return this._internalMeshDataInfo._LODLevels.push(b),E&&(E._masterMesh=this),this._sortLODLevels(),this}getLODLevelAtDistance(M){const E=this._internalMeshDataInfo;for(let b=0;b<E._LODLevels.length;b++){const x=E._LODLevels[b];if(x.distanceOrScreenCoverage===M)return x.mesh}return null}removeLODLevel(M){const E=this._internalMeshDataInfo;for(let b=0;b<E._LODLevels.length;b++)E._LODLevels[b].mesh===M&&(E._LODLevels.splice(b,1),M&&(M._masterMesh=null));return this._sortLODLevels(),this}getLOD(M,E){const b=this._internalMeshDataInfo;if(!b._LODLevels||0===b._LODLevels.length)return this;const x=E||this.getBoundingInfo().boundingSphere,k=M.mode===J.c.ORTHOGRAPHIC_CAMERA?M.bj:x.centerWorld.Qc(M.globalPosition).length();let a=k,g=1;if(b._useLODScreenCoverage){const E=M.screenArea;let b=x.radiusWorld*M.bj/k;b=b*b*Math.PI,a=b/E,g=-1}if(g*b._LODLevels[b._LODLevels.length-1].distanceOrScreenCoverage>g*a)return this.onLODLevelSelection&&this.onLODLevelSelection(a,this,this),this;for(let n=0;n<b._LODLevels.length;n++){const M=b._LODLevels[n];if(g*M.distanceOrScreenCoverage<g*a){if(M.mesh){if(4===M.mesh.delayLoadState)return M.mesh._checkDelayState(),this;if(2===M.mesh.delayLoadState)return this;M.mesh._preActivate(),M.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)}return this.onLODLevelSelection&&this.onLODLevelSelection(a,this,M.mesh),M.mesh}}return this.onLODLevelSelection&&this.onLODLevelSelection(a,this,this),this}get le(){return this._geometry}getTotalVertices(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()}getVerticesData(M,E,b,x){var k,a;if(!this._geometry)return null;let g=x||null===(k=this._userInstancedBuffersStorage)||void 0===k||null===(a=k.vertexBuffers[M])||void 0===a?void 0:a.getFloatData(this.instances.length+1,b||E&&1!==this._geometry.meshes.length);return g||(g=this._geometry.getVerticesData(M,E,b)),g}copyVerticesData(M,E){this._geometry&&this._geometry.copyVerticesData(M,E)}getVertexBuffer(M,E){var b;return this._geometry?(E||null===(b=this._userInstancedBuffersStorage)||void 0===b?void 0:b.vertexBuffers[M])??this._geometry.getVertexBuffer(M):null}isVerticesDataPresent(M,E){var b;return this._geometry?!E&&void 0!==(null===(b=this._userInstancedBuffersStorage)||void 0===b?void 0:b.vertexBuffers[M])||this._geometry.isVerticesDataPresent(M):!!this._delayInfo&&-1!==this._delayInfo.indexOf(M)}isVertexBufferUpdatable(M,E){if(!this._geometry)return!!this._delayInfo&&-1!==this._delayInfo.indexOf(M);if(!E){var b;const E=null===(b=this._userInstancedBuffersStorage)||void 0===b?void 0:b.vertexBuffers[M];if(E)return E.isUpdatable()}return this._geometry.isVertexBufferUpdatable(M)}getVerticesDataKinds(M){if(!this._geometry){const M=[];return this._delayInfo&&this._delayInfo.forEach((function(E){M.push(E)})),M}const E=this._geometry.getVerticesDataKinds();if(!M&&this._userInstancedBuffersStorage)for(const b in this._userInstancedBuffersStorage.vertexBuffers)-1===E.indexOf(b)&&E.push(b);return E}getTotalIndices(){return this._geometry?this._geometry.getTotalIndices():0}Ed(M,E){return this._geometry?this._geometry.Ed(M,E):[]}get isBlocked(){return null!==this._masterMesh&&void 0!==this._masterMesh}isReady(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0],E=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(2===this.delayLoadState)return!1;if(!super.isReady(M))return!1;if(!this.Td||0===this.Td.length)return!0;if(!M)return!0;const b=this.getEngine(),x=this.va(),k=E||b.getCaps().instancedArrays&&(this.instances.length>0||this.hasThinInstances);this.ce();const a=this.material||x.defaultMaterial;if(a)if(a._storeEffectOnSubMeshes)for(const I of this.Td){const M=I.Ha();if(M)if(M._storeEffectOnSubMeshes){if(!M.isReadyForSubMesh(this,I,k))return!1}else if(!M.isReady(this,k))return!1}else if(!a.isReady(this,k))return!1;const g=b.currentRenderPassId;for(const I of this.lightSources){const M=I.getShadowGenerators();if(!M)continue;const E=M.values();for(let x=E.next();!0!==x.done;x=E.next()){var n,J,u,T;const M=x.value;if(M&&(null===(n=M.getShadowMap())||void 0===n||!n.renderList||null!==(J=M.getShadowMap())&&void 0!==J&&J.renderList&&-1!==(null===(u=M.getShadowMap())||void 0===u||null===(T=u.renderList)||void 0===T?void 0:T.indexOf(this)))){const E=M.getShadowMap().renderPassIds??[b.currentRenderPassId];for(let x=0;x<E.length;++x){b.currentRenderPassId=E[x];for(const E of this.Td){var V;if(!M.isReady(E,k,(null===(V=E.Ha())||void 0===V?void 0:V.needAlphaBlendingForMesh(this))??!1))return b.currentRenderPassId=g,!1}}b.currentRenderPassId=g}}}for(const I of this._internalMeshDataInfo._LODLevels)if(I.mesh&&!I.mesh.isReady(k))return!1;return!0}get areNormalsFrozen(){return this._internalMeshDataInfo._areNormalsFrozen}$h(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this}unfreezeNormals(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this}set overridenInstanceCount(M){this._instanceDataStorage.overridenInstanceCount=M}_preActivate(){const M=this._internalMeshDataInfo,E=this.va().getRenderId();return M._preActivateId===E||(M._preActivateId=E,this._instanceDataStorage.visibleInstances=null),this}_preActivateForIntermediateRendering(M){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=M),this}_registerInstanceForRenderId(M,E){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:E,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[E]||(void 0!==this._instanceDataStorage.previousRenderId&&this._instanceDataStorage.isFrozen&&(this._instanceDataStorage.visibleInstances[this._instanceDataStorage.previousRenderId]=null),this._instanceDataStorage.previousRenderId=E,this._instanceDataStorage.visibleInstances[E]=new Array),this._instanceDataStorage.visibleInstances[E].push(M),this}_afterComputeWorldMatrix(){super._afterComputeWorldMatrix(),this.hasThinInstances&&(this.Da||this.thinInstanceRefreshBoundingInfo(!1))}_postActivate(){this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup&&(this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer),this.edgesRenderer.customInstances.push(this.getWorldMatrix()))}refreshBoundingInfo(){let M,E=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;M="object"===typeof E?E:{applySkeleton:E,applyMorph:b};const x=this.le?this.le.boundingBias:null;return this.Fa(this._getData(M,null,I.g.PositionKind),x),this}_createGlobalSubMesh(M){const E=this.getTotalVertices();if(!E||!this.Ed())return null;if(this.Td&&this.Td.length>0){const b=this.Ed();if(!b)return null;const x=b.length;let k=!1;if(M)k=!0;else for(const M of this.Td){if(M.indexStart+M.indexCount>x){k=!0;break}if(M.verticesStart+M.verticesCount>E){k=!0;break}}if(!k)return this.Td[0]}return this.releaseSubMeshes(),new r.b(0,0,E,0,this.getTotalIndices(),this)}subdivide(M){if(M<1)return;const E=this.getTotalIndices();let b=E/M|0,x=0;for(;b%3!==0;)b++;this.releaseSubMeshes();for(let k=0;k<M&&!(x>=E);k++)r.b.CreateFromIndices(0,x,k===M-1?E-x:b,this,void 0,!1),x+=b;this.refreshBoundingInfo(),this.synchronizeInstances()}Ga(M,E){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],x=arguments.length>3?arguments[3]:void 0;if(this._geometry)this._geometry.Ga(M,E,b,x);else{const x=new t.d;x.set(E,M);const k=this.va();new y.b(y.b.RandomId(),k,x,b,this)}return this}removeVerticesData(M){this._geometry&&this._geometry.removeVerticesData(M)}markVerticesDataAsUpdatable(M){let E=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const b=this.getVertexBuffer(M);b&&b.isUpdatable()!==E&&this.Ga(M,this.getVerticesData(M),E)}setVerticesBuffer(M){let E=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._geometry||(this._geometry=y.b.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(M,null,E),this}updateVerticesData(M,E,b,x){return this._geometry?(x?(this.makeGeometryUnique(),this.updateVerticesData(M,E,b,!1)):this._geometry.updateVerticesData(M,E,b),this):this}updateMeshPositions(M){let E=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const b=this.getVerticesData(I.g.PositionKind);if(!b)return this;if(M(b),this.updateVerticesData(I.g.PositionKind,b,!1,!1),E){const M=this.Ed(),E=this.getVerticesData(I.g.NormalKind);if(!E)return this;t.d.ComputeNormals(b,M,E),this.updateVerticesData(I.g.NormalKind,E,!1,!1)}return this}makeGeometryUnique(){if(!this._geometry)return this;if(1===this._geometry.meshes.length)return this;const M=this._geometry,E=this._geometry.j(y.b.RandomId());return M.releaseForMesh(this,!0),E.Ca(this),this}setIndexBuffer(M,E,b){let x=this._geometry;x||(x=new y.b(y.b.RandomId(),this.va(),void 0,void 0,this)),x.setIndexBuffer(M,E,b)}setIndices(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],x=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this._geometry)this._geometry.setIndices(M,E,b,x);else{const E=new t.d;E.indices=M;const x=this.va();new y.b(y.b.RandomId(),x,E,b,this)}return this}updateIndices(M,E){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this._geometry?(this._geometry.updateIndices(M,E,b),this):this}toLeftHanded(){return this._geometry?(this._geometry.toLeftHanded(),this):this}_bind(M,E,b){let x=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!this._geometry)return this;const k=this.va().getEngine();let a;if(this._unIndexed)if(this._getRenderingFillMode(b)===c.e.WireFrameFillMode)a=M._getLinesIndexBuffer(this.Ed(),k);else a=null;else switch(this._getRenderingFillMode(b)){case c.e.PointFillMode:a=null;break;case c.e.WireFrameFillMode:a=M._getLinesIndexBuffer(this.Ed(),k);break;default:case c.e.TriangleFillMode:a=this._geometry.getIndexBuffer()}return this._bindDirect(E,a,x)}_bindDirect(M,E){let b=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this._geometry?(this.morphTargetManager&&this.morphTargetManager.isUsingTextureForTargets&&this.morphTargetManager._bind(M),b&&this._userInstancedBuffersStorage&&!this.hasThinInstances?this._geometry._bind(M,E,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects):this._geometry._bind(M,E),this):this}_draw(M,E,b){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);const x=this.va().getEngine();return this._unIndexed&&E!==c.e.WireFrameFillMode||E==c.e.PointFillMode?x.drawArraysType(E,M.verticesStart,M.verticesCount,this.forcedInstanceCount||b):E==c.e.WireFrameFillMode?x.drawElementsType(E,0,M._linesIndexCount,this.forcedInstanceCount||b):x.drawElementsType(E,M.indexStart,M.indexCount,this.forcedInstanceCount||b),this}registerBeforeRender(M){return this.onBeforeRenderObservable.add(M),this}unregisterBeforeRender(M){return this.onBeforeRenderObservable.removeCallback(M),this}registerAfterRender(M){return this.onAfterRenderObservable.add(M),this}unregisterAfterRender(M){return this.onAfterRenderObservable.removeCallback(M),this}_getInstancesRenderList(M){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._instanceDataStorage.isFrozen){if(E)return this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.hardwareInstancedRendering[M]=!1,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.renderSelf[M]=!0,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode;if(this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch}const b=this.va(),x=b._isInIntermediateRendering(),k=x?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,a=this._instanceDataStorage.batchCache;if(a.mustReturn=!1,a.renderSelf[M]=E||!k&&this.isEnabled()&&this.isVisible,a.visibleInstances[M]=null,this._instanceDataStorage.visibleInstances&&!E){const E=this._instanceDataStorage.visibleInstances,k=b.getRenderId(),g=x?E.intermediateDefaultRenderId:E.defaultRenderId;a.visibleInstances[M]=E[k],!a.visibleInstances[M]&&g&&(a.visibleInstances[M]=E[g])}return a.hardwareInstancedRendering[M]=!E&&this._instanceDataStorage.hardwareInstancedRendering&&null!==a.visibleInstances[M]&&void 0!==a.visibleInstances[M],this._instanceDataStorage.previousBatch=a,a}_renderWithInstances(M,E,b,x,k){const a=b.visibleInstances[M._id],g=a?a.length:0,n=this._instanceDataStorage,J=n.instancesBufferSize;let T=n.instancesBuffer,V=n.instancesPreviousBuffer;const t=16*(g+1)*4;for(;n.instancesBufferSize<t;)n.instancesBufferSize*=2;n.instancesData&&J==n.instancesBufferSize||(n.instancesData=new Float32Array(n.instancesBufferSize/4)),(this._scene.needsPreviousWorldMatrices&&!n.instancesPreviousData||J!=n.instancesBufferSize)&&(n.instancesPreviousData=new Float32Array(n.instancesBufferSize/4));let y=0,B=0;const r=b.renderSelf[M._id],c=!T||J!==n.instancesBufferSize||this._scene.needsPreviousWorldMatrices&&!n.instancesPreviousBuffer;if(this._instanceDataStorage.manualUpdate||n.isFrozen&&!c)B=(r?1:0)+g;else{const E=this.getWorldMatrix();if(r&&(this._scene.needsPreviousWorldMatrices&&(n.masterMeshPreviousWorldMatrix?(n.masterMeshPreviousWorldMatrix.copyToArray(n.instancesPreviousData,y),n.masterMeshPreviousWorldMatrix.p(E)):(n.masterMeshPreviousWorldMatrix=E.clone(),n.masterMeshPreviousWorldMatrix.copyToArray(n.instancesPreviousData,y))),E.copyToArray(n.instancesData,y),y+=16,B++),a){var C;if(P.INSTANCEDMESH_SORT_TRANSPARENT&&this._scene.activeCamera&&null!==(C=M.Ha())&&void 0!==C&&C.needAlphaBlendingForMesh(M.getRenderingMesh())){const M=this._scene.activeCamera.globalPosition;for(let E=0;E<a.length;E++){const b=a[E];b._distanceToCamera=u.m.Distance(b.getBoundingInfo().boundingSphere.centerWorld,M)}a.sort(((M,E)=>M._distanceToCamera>E._distanceToCamera?-1:M._distanceToCamera<E._distanceToCamera?1:0))}for(let M=0;M<a.length;M++){const E=a[M],b=E.getWorldMatrix();b.copyToArray(n.instancesData,y),this._scene.needsPreviousWorldMatrices&&(E._previousWorldMatrix?(E._previousWorldMatrix.copyToArray(n.instancesPreviousData,y),E._previousWorldMatrix.p(b)):(E._previousWorldMatrix=b.clone(),E._previousWorldMatrix.copyToArray(n.instancesPreviousData,y))),y+=16,B++}}}return c?(T&&T.dispose(),V&&V.dispose(),T=new I.d(k,n.instancesData,!0,16,!1,!0),n.instancesBuffer=T,this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this._userInstancedBuffersStorage.vertexBuffers.world0=T.createVertexBuffer("world0",0,4),this._userInstancedBuffersStorage.vertexBuffers.world1=T.createVertexBuffer("world1",4,4),this._userInstancedBuffersStorage.vertexBuffers.world2=T.createVertexBuffer("world2",8,4),this._userInstancedBuffersStorage.vertexBuffers.world3=T.createVertexBuffer("world3",12,4),this._scene.needsPreviousWorldMatrices&&(V=new I.d(k,n.instancesPreviousData,!0,16,!1,!0),n.instancesPreviousBuffer=V,this._userInstancedBuffersStorage.vertexBuffers.previousWorld0=V.createVertexBuffer("previousWorld0",0,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld1=V.createVertexBuffer("previousWorld1",4,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld2=V.createVertexBuffer("previousWorld2",8,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld3=V.createVertexBuffer("previousWorld3",12,4)),this._invalidateInstanceVertexArrayObject()):this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||(T.updateDirectly(n.instancesData,0,B),!this._scene.needsPreviousWorldMatrices||this._instanceDataStorage.manualUpdate&&!this._instanceDataStorage.previousManualUpdate||V.updateDirectly(n.instancesPreviousData,0,B)),this._processInstancedBuffers(a,r),this.va()._activeIndices.addCount(M.indexCount*B,!1),k._currentDrawContext&&(k._currentDrawContext.useInstancing=!0),this._bind(M,x,E),this._draw(M,E,B),!this._scene.needsPreviousWorldMatrices||c||!this._instanceDataStorage.manualUpdate||this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||this._instanceDataStorage.previousManualUpdate||V.updateDirectly(n.instancesData,0,B),k.unbindInstanceAttributes(),this}_renderWithThinInstances(M,E,b,x){var k;const a=(null===(k=this._thinInstanceDataStorage)||void 0===k?void 0:k.instancesCount)??0;this.va()._activeIndices.addCount(M.indexCount*a,!1),x._currentDrawContext&&(x._currentDrawContext.useInstancing=!0),this._bind(M,b,E),this._draw(M,E,a),this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&this._thinInstanceDataStorage.matrixData&&(this._thinInstanceDataStorage.previousMatrixBuffer?this._thinInstanceDataStorage.previousMatrixBuffer.updateDirectly(this._thinInstanceDataStorage.matrixData,0,a):this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.matrixData,!1)),x.unbindInstanceAttributes()}_processInstancedBuffers(M,E){}_processRendering(M,E,b,x,k,a,g,n){const J=this.va(),u=J.getEngine();if(x=this._getRenderingFillMode(x),a&&E.getRenderingMesh().hasThinInstances)return this._renderWithThinInstances(E,x,b,u),this;if(a)this._renderWithInstances(E,x,k,b,u);else{u._currentDrawContext&&(u._currentDrawContext.useInstancing=!1);let b=0;k.renderSelf[E._id]&&(g&&g(!1,M.getWorldMatrix(),n),b++,this._draw(E,x,this._instanceDataStorage.overridenInstanceCount));const a=k.visibleInstances[E._id];if(a){const M=a.length;b+=M;for(let b=0;b<M;b++){const M=a[b].getWorldMatrix();g&&g(!0,M,n),this._draw(E,x)}}J._activeIndices.addCount(E.indexCount*b,!1)}return this}_rebuild(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._instanceDataStorage.instancesBuffer&&(M&&this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),this._userInstancedBuffersStorage){for(const E in this._userInstancedBuffersStorage.vertexBuffers){const b=this._userInstancedBuffersStorage.vertexBuffers[E];b&&(M&&b.dispose(),this._userInstancedBuffersStorage.vertexBuffers[E]=null)}this._userInstancedBuffersStorage.vertexArrayObjects&&(this._userInstancedBuffersStorage.vertexArrayObjects={})}this._internalMeshDataInfo._effectiveMaterial=null,super._rebuild(M)}_freeze(){if(this.Td){for(let M=0;M<this.Td.length;M++)this._getInstancesRenderList(M);this._internalMeshDataInfo._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}}_unFreeze(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null}renderWithRenderPassId(M,E,b,x){let k=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const a=this._scene.getEngine(),g=a.currentRenderPassId;if(void 0!==M&&(a.currentRenderPassId=M),x)(!k||k&&x.isInFrustum(this._scene._frustumPlanes))&&this.render(x,!!E,b);else for(let n=0;n<this.Td.length;n++){const M=this.Td[n];(!k||k&&M.isInFrustum(this._scene._frustumPlanes))&&this.render(M,!!E,b)}return void 0!==M&&(a.currentRenderPassId=g),this}directRender(){if(!this.Td)return this;for(const M of this.Td)this.render(M,!1);return this}render(M,E,b){var x,k,a;const g=this.va();this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1;const n=(null===(x=g.activeCameras)||void 0===x?void 0:x.length)??0;if((n>1&&g.activeCamera===g.activeCameras[0]||n<=1)&&this._checkOcclusionQuery()&&!this._occlusionDataStorage.forceRenderingWhenOccluded)return this;const J=this._getInstancesRenderList(M._id,!!b);if(J.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const u=g.getEngine();let T=0,V=null;this.ignoreCameraMaxZ&&g.activeCamera&&!g._isInIntermediateRendering()&&(T=g.activeCamera.maxZ,V=g.activeCamera,g.activeCamera.maxZ=0,g.updateTransformMatrix(!0)),this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);const I=M.getRenderingMesh(),t=J.hardwareInstancedRendering[M._id]||I.hasThinInstances||!!this._userInstancedBuffersStorage&&!M.getMesh()._internalAbstractMeshDataInfo._actAsRegularMesh,y=this._instanceDataStorage,B=M.Ha();if(!B)return V&&(V.maxZ=T,g.updateTransformMatrix(!0)),this;if(y.isFrozen&&this._internalMeshDataInfo._effectiveMaterial&&this._internalMeshDataInfo._effectiveMaterial===B){if(B._storeEffectOnSubMeshes&&(null===(k=M._drawWrapper)||void 0===k||!k._wasPreviouslyReady)||!B._storeEffectOnSubMeshes&&!B._getDrawWrapper()._wasPreviouslyReady)return V&&(V.maxZ=T,g.updateTransformMatrix(!0)),this}else{if(B._storeEffectOnSubMeshes){if(!B.isReadyForSubMesh(this,M,t))return V&&(V.maxZ=T,g.updateTransformMatrix(!0)),this}else if(!B.isReady(this,t))return V&&(V.maxZ=T,g.updateTransformMatrix(!0)),this;this._internalMeshDataInfo._effectiveMaterial=B}let r;E&&u.setAlphaMode(this._internalMeshDataInfo._effectiveMaterial.alphaMode),r=this._internalMeshDataInfo._effectiveMaterial._storeEffectOnSubMeshes?M._drawWrapper:this._internalMeshDataInfo._effectiveMaterial._getDrawWrapper();const C=(null===(a=r)||void 0===a?void 0:a.effect)??null;for(const c of g._beforeRenderingMeshStage)c.action(this,M,J,C);if(!r||!C)return V&&(V.maxZ=T,g.updateTransformMatrix(!0)),this;const R=b||this;let w;if(y.isFrozen||!this._internalMeshDataInfo._effectiveMaterial.je&&null===this._internalMeshDataInfo._effectiveMaterial.sideOrientation&&!this._internalMeshDataInfo._effectiveMaterial.twoSidedLighting)w=y.sideOrientation;else{const M=R._getWorldMatrixDeterminant();w=this._internalMeshDataInfo._effectiveMaterial._getEffectiveOrientation(this),M<0&&(w=w===c.e.ClockWiseSideOrientation?c.e.CounterClockWiseSideOrientation:c.e.ClockWiseSideOrientation),y.sideOrientation=w}const S=this._internalMeshDataInfo._effectiveMaterial._preBind(r,w);this._internalMeshDataInfo._effectiveMaterial.forceDepthWrite&&u.setDepthWrite(!0);const X=this._internalMeshDataInfo._effectiveMaterial,U=X.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),t||this._bind(M,C,U,!1);const v=R.getWorldMatrix();X._storeEffectOnSubMeshes?X.bindForSubMesh(v,this,M):X.bind(v,this),!X.je&&X.separateCullingPass&&(u.setState(!0,X.zOffset,!1,!S,X.cullBackFaces,X.stencil,X.zOffsetUnits),this._processRendering(this,M,C,U,J,t,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),u.setState(!0,X.zOffset,!1,S,X.cullBackFaces,X.stencil,X.zOffsetUnits),this._internalMeshDataInfo._onBetweenPassObservable&&this._internalMeshDataInfo._onBetweenPassObservable.notifyObservers(M)),this._processRendering(this,M,C,U,J,t,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),this._internalMeshDataInfo._effectiveMaterial.unbind();for(const c of g._afterRenderingMeshStage)c.action(this,M,J,C);return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),V&&(V.maxZ=T,g.updateTransformMatrix(!0)),2!==g.performancePriority||y.isFrozen||this._freeze(),this}cleanMatrixWeights(){this.isVerticesDataPresent(I.g.MatricesWeightsKind)&&(this.isVerticesDataPresent(I.g.MatricesWeightsExtraKind)?this._normalizeSkinWeightsAndExtra():this._normalizeSkinFourWeights())}_normalizeSkinFourWeights(){const M=this.getVerticesData(I.g.MatricesWeightsKind),E=M.length;for(let b=0;b<E;b+=4){const E=M[b]+M[b+1]+M[b+2]+M[b+3];if(0===E)M[b]=1;else{const x=1/E;M[b]*=x,M[b+1]*=x,M[b+2]*=x,M[b+3]*=x}}this.Ga(I.g.MatricesWeightsKind,M)}_normalizeSkinWeightsAndExtra(){const M=this.getVerticesData(I.g.MatricesWeightsExtraKind),E=this.getVerticesData(I.g.MatricesWeightsKind),b=E.length;for(let x=0;x<b;x+=4){let b=E[x]+E[x+1]+E[x+2]+E[x+3];if(b+=M[x]+M[x+1]+M[x+2]+M[x+3],0===b)E[x]=1;else{const k=1/b;E[x]*=k,E[x+1]*=k,E[x+2]*=k,E[x+3]*=k,M[x]*=k,M[x+1]*=k,M[x+2]*=k,M[x+3]*=k}}this.Ga(I.g.MatricesWeightsKind,E),this.Ga(I.g.MatricesWeightsKind,M)}validateSkinning(){const M=this.getVerticesData(I.g.MatricesWeightsExtraKind),E=this.getVerticesData(I.g.MatricesWeightsKind);if(null===E||null==this.skeleton)return{skinned:!1,valid:!0,ye:"not skinned"};const b=E.length;let x=0,k=0,a=0,g=0;const n=null===M?4:8,J=[];for(let I=0;I<=n;I++)J[I]=0;for(let I=0;I<b;I+=4){let b=E[I],u=b,T=0===u?0:1;for(let k=1;k<n;k++){const a=k<4?E[I+k]:M[I+k-4];a>b&&x++,0!==a&&T++,u+=a,b=a}if(J[T]++,T>a&&(a=T),0===u)k++;else{const b=1/u;let x=0;for(let k=0;k<n;k++)x+=k<4?Math.abs(E[I+k]-E[I+k]*b):Math.abs(M[I+k-4]-M[I+k-4]*b);x>.001&&g++}}const u=this.skeleton.bones.length,T=this.getVerticesData(I.g.MatricesIndicesKind),V=this.getVerticesData(I.g.MatricesIndicesExtraKind);let t=0;for(let I=0;I<b;I+=4)for(let M=0;M<n;M++){const E=M<4?T[I+M]:V[I+M-4];(E>=u||E<0)&&t++}return{skinned:!0,valid:0===k&&0===g&&0===t,ye:"Number of Weights = "+b/4+"\nMaximum influences = "+a+"\nMissing Weights = "+k+"\nNot Sorted = "+x+"\nNot Normalized = "+g+"\nWeightCounts = ["+J+"]\nNumber of bones = "+u+"\nBad Bone Indices = "+t}}_checkDelayState(){const M=this.va();return this._geometry?this._geometry.load(M):4===this.delayLoadState&&(this.delayLoadState=2,this._queueLoad(M)),this}_queueLoad(M){M.addPendingData(this);const E=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return k.e.LoadFile(this.delayLoadingFile,(E=>{E instanceof ArrayBuffer?this._delayLoadingFunction(E,this):this._delayLoadingFunction(JSON.parse(E),this),this.instances.forEach((M=>{M.refreshBoundingInfo(),M._syncSubMeshes()})),this.delayLoadState=1,M.removePendingData(this)}),(()=>{}),M.offlineProvider,E),this}isInFrustum(M){return 2!==this.delayLoadState&&(!!super.isInFrustum(M)&&(this._checkDelayState(),!0))}setMaterialById(M){const E=this.va().materials;let b;for(b=E.length-1;b>-1;b--)if(E[b].id===M)return this.material=E[b],this;const x=this.va().multiMaterials;for(b=x.length-1;b>-1;b--)if(x[b].id===M)return this.material=x[b],this;return this}getAnimatables(){const M=[];return this.material&&M.push(this.material),this.skeleton&&M.push(this.skeleton),M}bakeTransformIntoVertices(M){if(!this.isVerticesDataPresent(I.g.PositionKind))return this;const E=this.Td.splice(0);this._resetPointsArrayCache();let b=this.getVerticesData(I.g.PositionKind);const x=u.m.Zero();let k;for(k=0;k<b.length;k+=3)u.m.TransformCoordinatesFromFloatsToRef(b[k],b[k+1],b[k+2],M,x).toArray(b,k);if(this.Ga(I.g.PositionKind,b,this.getVertexBuffer(I.g.PositionKind).isUpdatable()),this.isVerticesDataPresent(I.g.NormalKind)){for(b=this.getVerticesData(I.g.NormalKind),k=0;k<b.length;k+=3)u.m.TransformNormalFromFloatsToRef(b[k],b[k+1],b[k+2],M,x).normalize().toArray(b,k);this.Ga(I.g.NormalKind,b,this.getVertexBuffer(I.g.NormalKind).isUpdatable())}if(this.isVerticesDataPresent(I.g.TangentKind)){for(b=this.getVerticesData(I.g.TangentKind),k=0;k<b.length;k+=4)u.m.TransformNormalFromFloatsToRef(b[k],b[k+1],b[k+2],M,x).normalize().toArray(b,k);this.Ga(I.g.TangentKind,b,this.getVertexBuffer(I.g.TangentKind).isUpdatable())}return M.determinant()<0&&this.flipFaces(),this.releaseSubMeshes(),this.Td=E,this}bakeCurrentTransformIntoVertices(){let M=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.bakeTransformIntoVertices(this.ce(!0)),this.resetLocalMatrix(M),this}get _positions(){return this._internalAbstractMeshDataInfo._positions||this._geometry&&this._geometry._positions||null}_resetPointsArrayCache(){return this._geometry&&this._geometry._resetPointsArrayCache(),this}_generatePointsArray(){return!!this._geometry&&this._geometry._generatePointsArray()}clone(){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,E=arguments.length>2?arguments[2]:void 0,b=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return new P(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",this.va(),M,this,E,b)}dispose(M){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);const b=this._internalMeshDataInfo;if(b._onBeforeDrawObservable&&b._onBeforeDrawObservable.clear(),b._onBeforeBindObservable&&b._onBeforeBindObservable.clear(),b._onBeforeRenderObservable&&b._onBeforeRenderObservable.clear(),b._onAfterRenderObservable&&b._onAfterRenderObservable.clear(),b._onBetweenPassObservable&&b._onBetweenPassObservable.clear(),this._scene.useClonedMeshMap){if(b.meshMap)for(const M in b.meshMap){const E=b.meshMap[M];E&&(E._internalMeshDataInfo._source=null,b.meshMap[M]=void 0)}b._source&&b._source._internalMeshDataInfo.meshMap&&(b._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else{const M=this.va().meshes;for(const E of M){const M=E;M._internalMeshDataInfo&&M._internalMeshDataInfo._source&&M._internalMeshDataInfo._source===this&&(M._internalMeshDataInfo._source=null)}}b._source=null,this._instanceDataStorage.visibleInstances={},this._disposeInstanceSpecificData(),this._disposeThinInstanceSpecificData(),this._internalMeshDataInfo._checkReadinessObserver&&this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),super.dispose(M,E)}_disposeInstanceSpecificData(){}_disposeThinInstanceSpecificData(){}_invalidateInstanceVertexArrayObject(){}applyDisplacementMap(M,E,b,x,a,g){let n=arguments.length>6&&void 0!==arguments[6]&&arguments[6],J=arguments.length>7?arguments[7]:void 0;const u=this.va();return k.e.LoadImage(M,(M=>{const k=M.width,J=M.height,u=this.getEngine().createCanvas(k,J).getContext("2d");u.drawImage(M,0,0);const T=u.getImageData(0,0,k,J).data;this.applyDisplacementMapFromBuffer(T,k,J,E,b,a,g,n),x&&x(this)}),J||(()=>{}),u.offlineProvider),this}applyDisplacementMapFromBuffer(M,E,b,x,k,a,g){let n=arguments.length>7&&void 0!==arguments[7]&&arguments[7];if(!this.isVerticesDataPresent(I.g.PositionKind)||!this.isVerticesDataPresent(I.g.NormalKind)||!this.isVerticesDataPresent(I.g.UVKind))return S.d.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;const J=this.getVerticesData(I.g.PositionKind,!0,!0),T=this.getVerticesData(I.g.NormalKind),V=this.getVerticesData(I.g.UVKind);let y=u.m.Zero();const B=u.m.Zero(),r=u.l.Zero();a=a||u.l.Zero(),g=g||new u.l(1,1);for(let I=0;I<J.length;I+=3){u.m.FromArrayToRef(J,I,y),u.m.FromArrayToRef(T,I,B),u.l.FromArrayToRef(V,I/3*2,r);const n=4*((Math.abs(r.x*g.x+a.x%1)*(E-1)%E|0)+(Math.abs(r.y*g.y+a.y%1)*(b-1)%b|0)*E),t=.3*(M[n]/255)+.59*(M[n+1]/255)+.11*(M[n+2]/255);B.normalize(),B.scaleInPlace(x+(k-x)*t),y=y.add(B),y.toArray(J,I)}return t.d.ComputeNormals(J,this.Ed(),T),n?(this.Ga(I.g.PositionKind,J),this.Ga(I.g.NormalKind,T),this.Ga(I.g.UVKind,V)):(this.updateVerticesData(I.g.PositionKind,J),this.updateVerticesData(I.g.NormalKind,T)),this}_getFlattenedNormals(M,E){const b=new Float32Array(3*M.length);let x=0;const k=this.sideOrientation===(this._scene.useRightHandedSystem?1:0);for(let a=0;a<M.length;a+=3){const g=u.m.Id(E,3*M[a]),n=u.m.Id(E,3*M[a+1]),J=u.m.Id(E,3*M[a+2]),T=g.Qc(n),V=J.Qc(n),I=u.m.Normalize(u.m.Cross(T,V));k&&I.scaleInPlace(-1);for(let M=0;M<3;M++)b[x++]=I.x,b[x++]=I.y,b[x++]=I.z}return b}_convertToUnIndexedMesh(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const E=this.getVerticesDataKinds().filter((M=>{var E;return!(null!==(E=this.getVertexBuffer(M))&&void 0!==E&&E.getIsInstanced())})),b=this.Ed(),x={},k=(M,E)=>{const x=new Float32Array(b.length*E);let k=0;for(let a=0;a<b.length;a++)for(let g=0;g<E;g++)x[k++]=M[b[a]*E+g];return x},a=this.getBoundingInfo(),g=this.le?this.Td.slice(0):[];for(const n of E)x[n]=this.getVerticesData(n);for(const n of E){const E=this.getVertexBuffer(n),a=E.getSize();if(M&&n===I.g.NormalKind){const M=this._getFlattenedNormals(b,x[I.g.PositionKind]);this.Ga(I.g.NormalKind,M,E.isUpdatable(),a)}else this.Ga(n,k(x[n],a),E.isUpdatable(),a)}if(this.morphTargetManager){for(let E=0;E<this.morphTargetManager.numTargets;E++){const x=this.morphTargetManager.getTarget(E),a=x.getPositions();x.setPositions(k(a,3));const g=x.getNormals();g&&x.setNormals(M?this._getFlattenedNormals(b,a):k(g,3));const n=x.getTangents();n&&x.setTangents(k(n,3));const J=x.getUVs();J&&x.setUVs(k(J,2))}this.morphTargetManager.synchronize()}for(let n=0;n<b.length;n++)b[n]=n;this.setIndices(b),this._unIndexed=!0,this.releaseSubMeshes();for(const n of g){const M=n.getBoundingInfo();r.b.AddToMesh(n.materialIndex,n.indexStart,n.indexCount,n.indexStart,n.indexCount,this).setBoundingInfo(M)}return this.setBoundingInfo(a),this.synchronizeInstances(),this}convertToFlatShadedMesh(){return this._convertToUnIndexedMesh(!0)}convertToUnIndexedMesh(){return this._convertToUnIndexedMesh()}flipFaces(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const E=t.d.ExtractFromMesh(this);let b;if(M&&this.isVerticesDataPresent(I.g.NormalKind)&&E.ya){for(b=0;b<E.ya.length;b++)E.ya[b]*=-1;this.Ga(I.g.NormalKind,E.ya,this.isVertexBufferUpdatable(I.g.NormalKind))}if(E.indices){let M;for(b=0;b<E.indices.length;b+=3)M=E.indices[b+1],E.indices[b+1]=E.indices[b+2],E.indices[b+2]=M;this.setIndices(E.indices,null,this.isVertexBufferUpdatable(I.g.PositionKind),!0)}return this}increaseVertices(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const E=t.d.ExtractFromMesh(this),b=E.indices&&!Array.isArray(E.indices)&&Array.from?Array.from(E.indices):E.indices,x=E.xa&&!Array.isArray(E.xa)&&Array.from?Array.from(E.xa):E.xa,k=E.Aa&&!Array.isArray(E.Aa)&&Array.from?Array.from(E.Aa):E.Aa,a=E.ya&&!Array.isArray(E.ya)&&Array.from?Array.from(E.ya):E.ya;if(b&&x){E.indices=b,E.xa=x,k&&(E.Aa=k),a&&(E.ya=a);const g=M+1,n=new Array;for(let M=0;M<g+1;M++)n[M]=new Array;let J,T;const V=new u.m(0,0,0),t=new u.m(0,0,0),y=new u.l(0,0),B=new Array,r=new Array,c=new Array;let C,R,w,S=x.length;k&&(R=k.length),a&&(w=a.length);for(let M=0;M<b.length;M+=3){r[0]=b[M],r[1]=b[M+1],r[2]=b[M+2];for(let M=0;M<3;M++)if(J=r[M],T=r[(M+1)%3],void 0===c[J]&&void 0===c[T]?(c[J]=new Array,c[T]=new Array):(void 0===c[J]&&(c[J]=new Array),void 0===c[T]&&(c[T]=new Array)),void 0===c[J][T]&&void 0===c[T][J]){c[J][T]=[],V.x=(x[3*T]-x[3*J])/g,V.y=(x[3*T+1]-x[3*J+1])/g,V.z=(x[3*T+2]-x[3*J+2])/g,a&&(t.x=(a[3*T]-a[3*J])/g,t.y=(a[3*T+1]-a[3*J+1])/g,t.z=(a[3*T+2]-a[3*J+2])/g),k&&(y.x=(k[2*T]-k[2*J])/g,y.y=(k[2*T+1]-k[2*J+1])/g),c[J][T].push(J);for(let M=1;M<g;M++)c[J][T].push(x.length/3),x[S++]=x[3*J]+M*V.x,x[S++]=x[3*J+1]+M*V.y,x[S++]=x[3*J+2]+M*V.z,a&&(a[w++]=a[3*J]+M*t.x,a[w++]=a[3*J+1]+M*t.y,a[w++]=a[3*J+2]+M*t.z),k&&(k[R++]=k[2*J]+M*y.x,k[R++]=k[2*J+1]+M*y.y);c[J][T].push(T),c[T][J]=new Array,C=c[J][T].length;for(let M=0;M<C;M++)c[T][J][M]=c[J][T][C-1-M]}n[0][0]=b[M],n[1][0]=c[b[M]][b[M+1]][1],n[1][1]=c[b[M]][b[M+2]][1];for(let E=2;E<g;E++){n[E][0]=c[b[M]][b[M+1]][E],n[E][E]=c[b[M]][b[M+2]][E],V.x=(x[3*n[E][E]]-x[3*n[E][0]])/E,V.y=(x[3*n[E][E]+1]-x[3*n[E][0]+1])/E,V.z=(x[3*n[E][E]+2]-x[3*n[E][0]+2])/E,a&&(t.x=(a[3*n[E][E]]-a[3*n[E][0]])/E,t.y=(a[3*n[E][E]+1]-a[3*n[E][0]+1])/E,t.z=(a[3*n[E][E]+2]-a[3*n[E][0]+2])/E),k&&(y.x=(k[2*n[E][E]]-k[2*n[E][0]])/E,y.y=(k[2*n[E][E]+1]-k[2*n[E][0]+1])/E);for(let M=1;M<E;M++)n[E][M]=x.length/3,x[S++]=x[3*n[E][0]]+M*V.x,x[S++]=x[3*n[E][0]+1]+M*V.y,x[S++]=x[3*n[E][0]+2]+M*V.z,a&&(a[w++]=a[3*n[E][0]]+M*t.x,a[w++]=a[3*n[E][0]+1]+M*t.y,a[w++]=a[3*n[E][0]+2]+M*t.z),k&&(k[R++]=k[2*n[E][0]]+M*y.x,k[R++]=k[2*n[E][0]+1]+M*y.y)}n[g]=c[b[M+1]][b[M+2]],B.push(n[0][0],n[1][0],n[1][1]);for(let M=1;M<g;M++){let E;for(E=0;E<M;E++)B.push(n[M][E],n[M+1][E],n[M+1][E+1]),B.push(n[M][E],n[M+1][E+1],n[M][E+1]);B.push(n[M][E],n[M+1][E],n[M+1][E+1])}}E.indices=B,E.Ca(this,this.isVertexBufferUpdatable(I.g.PositionKind))}else S.d.Warn("Couldn't increase number of vertices : VertexData must contain at least indices and positions")}forceSharedVertices(){const M=t.d.ExtractFromMesh(this),E=M.Aa,b=M.indices,x=M.xa,k=M.za,a=M.matricesIndices,g=M.matricesWeights,n=M.matricesIndicesExtra,J=M.matricesWeightsExtra;if(void 0===b||void 0===x||null===b||null===x)S.d.Warn("VertexData contains empty entries");else{const u=new Array,T=new Array,V=new Array,y=new Array,B=new Array,r=new Array,c=new Array,C=new Array;let R=new Array,w=0;const S={};let X,U;for(let M=0;M<b.length;M+=3){U=[b[M],b[M+1],b[M+2]],R=[];for(let M=0;M<3;M++){R[M]="";for(let E=0;E<3;E++)Math.abs(x[3*U[M]+E])<1e-8&&(x[3*U[M]+E]=0),R[M]+=x[3*U[M]+E]+"|"}if(R[0]!=R[1]&&R[0]!=R[2]&&R[1]!=R[2])for(let M=0;M<3;M++){if(X=S[R[M]],void 0===X){S[R[M]]=w,X=w++;for(let E=0;E<3;E++)u.push(x[3*U[M]+E]);if(null!==k&&void 0!==k)for(let E=0;E<4;E++)y.push(k[4*U[M]+E]);if(null!==E&&void 0!==E)for(let b=0;b<2;b++)V.push(E[2*U[M]+b]);if(null!==a&&void 0!==a)for(let E=0;E<4;E++)B.push(a[4*U[M]+E]);if(null!==g&&void 0!==g)for(let E=0;E<4;E++)r.push(g[4*U[M]+E]);if(null!==n&&void 0!==n)for(let E=0;E<4;E++)c.push(n[4*U[M]+E]);if(null!==J&&void 0!==J)for(let E=0;E<4;E++)C.push(J[4*U[M]+E])}T.push(X)}}const v=new Array;t.d.ComputeNormals(u,T,v),M.xa=u,M.indices=T,M.ya=v,null!==E&&void 0!==E&&(M.Aa=V),null!==k&&void 0!==k&&(M.za=y),null!==a&&void 0!==a&&(M.matricesIndices=B),null!==g&&void 0!==g&&(M.matricesWeights=r),null!==n&&void 0!==n&&(M.matricesIndicesExtra=c),null!==g&&void 0!==g&&(M.matricesWeightsExtra=C),M.Ca(this,this.isVertexBufferUpdatable(I.g.PositionKind))}}static _instancedMeshFactory(M,E){throw(0,U.b)("InstancedMesh")}static _PhysicsImpostorParser(M,E,b){throw(0,U.b)("PhysicsImpostor")}gd(M){const E=P._instancedMeshFactory(M,this);return E.parent=this.parent,E}synchronizeInstances(){for(let M=0;M<this.instances.length;M++){this.instances[M]._syncSubMeshes()}return this}optimizeIndices(M){const E=this.Ed(),b=this.getVerticesData(I.g.PositionKind);if(!b||!E)return this;const x=[];for(let k=0;k<b.length;k+=3)x.push(u.m.Id(b,k));const a=[];return k.b.SyncAsyncForLoop(x.length,40,(M=>{const E=x.length-1-M,b=x[E];for(let k=0;k<E;++k){const M=x[k];if(b.equals(M)){a[E]=k;break}}}),(()=>{for(let M=0;M<E.length;++M)E[M]=a[E[M]]||E[M];const b=this.Td.slice(0);this.setIndices(E),this.Td=b,M&&M(this)})),this}serialize(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};M.name=this.name,M.id=this.id,M.uniqueId=this.uniqueId,M.type=this.getClassName(),g.b&&g.b.HasTags(this)&&(M.tags=g.b.GetTags(this)),M.position=this.position.Vd(),this.rotationQuaternion?M.rotationQuaternion=this.rotationQuaternion.Vd():this.rotation&&(M.rotation=this.rotation.Vd()),M.ve=this.ve.Vd(),this._postMultiplyPivotMatrix?M.pivotMatrix=this.getPivotMatrix().Vd():M.localMatrix=this.getPivotMatrix().Vd(),M.isEnabled=this.isEnabled(!1),M.isVisible=this.isVisible,M.infiniteDistance=this.infiniteDistance,M.pickable=this.Be,M.receiveShadows=this.receiveShadows,M.billboardMode=this.billboardMode,M.visibility=this.visibility,M.Oe=this.Oe,M.checkCollisions=this.checkCollisions,M.ellipsoid=this.ellipsoid.Vd(),M.ellipsoidOffset=this.ellipsoidOffset.Vd(),M.Da=this.Da,M.isBlocker=this.isBlocker,M.sideOrientation=this.sideOrientation,this.parent&&this.parent._serializeAsParent(M),M.isUnIndexed=this.isUnIndexed;const E=this._geometry;if(E&&this.Td){M.geometryUniqueId=E.uniqueId,M.geometryId=E.id,M.Td=[];for(let E=0;E<this.Td.length;E++){const b=this.Td[E];M.Td.push({materialIndex:b.materialIndex,verticesStart:b.verticesStart,verticesCount:b.verticesCount,indexStart:b.indexStart,indexCount:b.indexCount})}}if(this.material?this.material.doNotSerialize||(M.materialUniqueId=this.material.uniqueId,M.materialId=this.material.id):(this.material=null,M.materialUniqueId=this._scene.defaultMaterial.uniqueId,M.materialId=this._scene.defaultMaterial.id),this.morphTargetManager&&(M.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(M.skeletonId=this.skeleton.id,M.numBoneInfluencers=this.numBoneInfluencers),this.va()._getComponent(v.c.NAME_PHYSICSENGINE)){const E=this.getPhysicsImpostor();E&&(M.physicsMass=E.getParam("mass"),M.physicsFriction=E.getParam("friction"),M.physicsRestitution=E.getParam("mass"),M.physicsImpostor=E.type)}this.metadata&&(M.metadata=this.metadata),M.instances=[];for(let b=0;b<this.instances.length;b++){const E=this.instances[b];if(E.doNotSerialize)continue;const x={name:E.name,id:E.id,isEnabled:E.isEnabled(!1),isVisible:E.isVisible,Be:E.Be,checkCollisions:E.checkCollisions,position:E.position.Vd(),ve:E.ve.Vd()};if(E.parent&&E.parent._serializeAsParent(x),E.rotationQuaternion?x.rotationQuaternion=E.rotationQuaternion.Vd():E.rotation&&(x.rotation=E.rotation.Vd()),this.va()._getComponent(v.c.NAME_PHYSICSENGINE)){const M=E.getPhysicsImpostor();M&&(x.physicsMass=M.getParam("mass"),x.physicsFriction=M.getParam("friction"),x.physicsRestitution=M.getParam("mass"),x.physicsImpostor=M.type)}E.metadata&&(x.metadata=E.metadata),E.actionManager&&(x.actions=E.actionManager.serialize(E.name)),M.instances.push(x),w.b.AppendSerializedAnimations(E,x),x.ranges=E.serializeAnimationRanges()}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData&&(M.thinInstances={instancesCount:this._thinInstanceDataStorage.instancesCount,matrixData:Array.from(this._thinInstanceDataStorage.matrixData),matrixBufferSize:this._thinInstanceDataStorage.matrixBufferSize,enablePicking:this.thinInstanceEnablePicking},this._userThinInstanceBuffersStorage)){const E={data:{},sizes:{},strides:{}};for(const M in this._userThinInstanceBuffersStorage.data)E.data[M]=Array.from(this._userThinInstanceBuffersStorage.data[M]),E.sizes[M]=this._userThinInstanceBuffersStorage.sizes[M],E.strides[M]=this._userThinInstanceBuffersStorage.strides[M];M.thinInstances.userThinInstance=E}return w.b.AppendSerializedAnimations(this,M),M.ranges=this.serializeAnimationRanges(),M.layerMask=this.layerMask,M.alphaIndex=this.alphaIndex,M.hasVertexAlpha=this.hasVertexAlpha,M.overlayAlpha=this.overlayAlpha,M.overlayColor=this.overlayColor.Vd(),M.renderOverlay=this.renderOverlay,M.applyFog=this.applyFog,this.actionManager&&(M.actions=this.actionManager.serialize(this.name)),M}_syncGeometryWithMorphTargetManager(){if(!this.le)return;this._markSubMeshesAsAttributesDirty();const M=this._internalAbstractMeshDataInfo._morphTargetManager;if(M&&M.vertexCount){if(M.vertexCount!==this.getTotalVertices())return S.d.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);if(M.isUsingTextureForTargets)return;for(let E=0;E<M.numInfluencers;E++){const b=M.getActiveTarget(E),x=b.getPositions();if(!x)return void S.d.Error("Invalid morph target. Target must have positions.");this.le.Ga(I.g.PositionKind+E,x,!1,3);const k=b.getNormals();k&&this.le.Ga(I.g.NormalKind+E,k,!1,3);const a=b.getTangents();a&&this.le.Ga(I.g.TangentKind+E,a,!1,3);const g=b.getUVs();g&&this.le.Ga(I.g.UVKind+"_"+E,g,!1,2)}}else{let M=0;for(;this.le.isVerticesDataPresent(I.g.PositionKind+M);)this.le.removeVerticesData(I.g.PositionKind+M),this.le.isVerticesDataPresent(I.g.NormalKind+M)&&this.le.removeVerticesData(I.g.NormalKind+M),this.le.isVerticesDataPresent(I.g.TangentKind+M)&&this.le.removeVerticesData(I.g.TangentKind+M),this.le.isVerticesDataPresent(I.g.UVKind+M)&&this.le.removeVerticesData(I.g.UVKind+"_"+M),M++}}static Parse(M,E,b){let x;if(x=M.type&&"LinesMesh"===M.type?P._LinesMeshParser(M,E):M.type&&"GroundMesh"===M.type?P._GroundMeshParser(M,E):M.type&&"GoldbergMesh"===M.type?P._GoldbergMeshParser(M,E):M.type&&"GreasedLineMesh"===M.type?P._GreasedLineMeshParser(M,E):M.type&&"TrailMesh"===M.type?P._TrailMeshParser(M,E):new P(M.name,E),x.id=M.id,x._waitingParsedUniqueId=M.uniqueId,g.b&&g.b.AddTagsTo(x,M.tags),x.position=u.m.Id(M.position),void 0!==M.metadata&&(x.metadata=M.metadata),M.rotationQuaternion?x.rotationQuaternion=u.e.Id(M.rotationQuaternion):M.rotation&&(x.rotation=u.m.Id(M.rotation)),x.ve=u.m.Id(M.ve),M.localMatrix?x.setPreTransformMatrix(u.d.Id(M.localMatrix)):M.pivotMatrix&&x.setPivotMatrix(u.d.Id(M.pivotMatrix)),x.wg(M.isEnabled),x.isVisible=M.isVisible,x.infiniteDistance=M.infiniteDistance,x.Oe=!!M.Oe,x.showBoundingBox=M.showBoundingBox,x.showSubMeshesBoundingBox=M.showSubMeshesBoundingBox,void 0!==M.applyFog&&(x.applyFog=M.applyFog),void 0!==M.pickable&&(x.Be=M.pickable),void 0!==M.alphaIndex&&(x.alphaIndex=M.alphaIndex),x.receiveShadows=M.receiveShadows,void 0!==M.billboardMode&&(x.billboardMode=M.billboardMode),void 0!==M.visibility&&(x.visibility=M.visibility),x.checkCollisions=M.checkCollisions,x.Da=!!M.Da,M.ellipsoid&&(x.ellipsoid=u.m.Id(M.ellipsoid)),M.ellipsoidOffset&&(x.ellipsoidOffset=u.m.Id(M.ellipsoidOffset)),null!=M.overrideMaterialSideOrientation&&(x.sideOrientation=M.overrideMaterialSideOrientation),void 0!==M.sideOrientation&&(x.sideOrientation=M.sideOrientation),void 0!==M.isBlocker&&(x.isBlocker=M.isBlocker),x._shouldGenerateFlatShading=M.useFlatShading,M.ai&&(x._waitingData.ai=M.ai),void 0!==M.parentId&&(x._waitingParentId=M.parentId),void 0!==M.parentInstanceIndex&&(x._waitingParentInstanceIndex=M.parentInstanceIndex),void 0!==M.actions&&(x._waitingData.actions=M.actions),void 0!==M.overlayAlpha&&(x.overlayAlpha=M.overlayAlpha),void 0!==M.overlayColor&&(x.overlayColor=T.e.Id(M.overlayColor)),void 0!==M.renderOverlay&&(x.renderOverlay=M.renderOverlay),x.isUnIndexed=!!M.isUnIndexed,x.hasVertexAlpha=M.hasVertexAlpha,M.delayLoadingFile?(x.delayLoadState=4,x.delayLoadingFile=b+M.delayLoadingFile,x.buildBoundingInfo(u.m.Id(M.boundingBoxMinimum),u.m.Id(M.boundingBoxMaximum)),M._binaryInfo&&(x._binaryInfo=M._binaryInfo),x._delayInfo=[],M.hasUVs&&x._delayInfo.push(I.g.UVKind),M.hasUVs2&&x._delayInfo.push(I.g.UV2Kind),M.hasUVs3&&x._delayInfo.push(I.g.UV3Kind),M.hasUVs4&&x._delayInfo.push(I.g.UV4Kind),M.hasUVs5&&x._delayInfo.push(I.g.UV5Kind),M.hasUVs6&&x._delayInfo.push(I.g.UV6Kind),M.hasColors&&x._delayInfo.push(I.g.ColorKind),M.hasMatricesIndices&&x._delayInfo.push(I.g.MatricesIndicesKind),M.hasMatricesWeights&&x._delayInfo.push(I.g.MatricesWeightsKind),x._delayLoadingFunction=y.b._ImportGeometry,R.d.ForceFullSceneLoadingForIncremental&&x._checkDelayState()):y.b._ImportGeometry(M,x),M.materialUniqueId?x._waitingMaterialId=M.materialUniqueId:M.materialId&&(x._waitingMaterialId=M.materialId),M.morphTargetManagerId>-1&&(x._waitingMorphTargetManagerId=M.morphTargetManagerId),void 0!==M.skeletonId&&null!==M.skeletonId&&(x.skeleton=E.getLastSkeletonById(M.skeletonId),M.numBoneInfluencers&&(x.numBoneInfluencers=M.numBoneInfluencers)),M.animations){for(let E=0;E<M.animations.length;E++){const b=M.animations[E],k=(0,X.e)("BABYLON.Animation");k&&x.animations.push(k.Parse(b))}V.d.ParseAnimationRanges(x,M,E)}if(M.autoAnimate&&E.beginAnimation(x,M.autoAnimateFrom,M.autoAnimateTo,M.autoAnimateLoop,M.autoAnimateSpeed||1),M.layerMask&&!isNaN(M.layerMask)?x.layerMask=Math.abs(parseInt(M.layerMask)):x.layerMask=268435455,M.physicsImpostor&&(x.physicsImpostor=P._PhysicsImpostorParser(E,x,M)),M.lodMeshIds&&(x._waitingData.lods={ids:M.lodMeshIds,distances:M.lodDistances?M.lodDistances:null,coverages:M.lodCoverages?M.lodCoverages:null}),M.instances)for(let k=0;k<M.instances.length;k++){const b=M.instances[k],a=x.gd(b.name);if(b.id&&(a.id=b.id),g.b&&(b.tags?g.b.AddTagsTo(a,b.tags):g.b.AddTagsTo(a,M.tags)),a.position=u.m.Id(b.position),void 0!==b.metadata&&(a.metadata=b.metadata),void 0!==b.parentId&&(a._waitingParentId=b.parentId),void 0!==b.parentInstanceIndex&&(a._waitingParentInstanceIndex=b.parentInstanceIndex),void 0!==b.isEnabled&&null!==b.isEnabled&&a.wg(b.isEnabled),void 0!==b.isVisible&&null!==b.isVisible&&(a.isVisible=b.isVisible),void 0!==b.Be&&null!==b.Be&&(a.Be=b.Be),b.rotationQuaternion?a.rotationQuaternion=u.e.Id(b.rotationQuaternion):b.rotation&&(a.rotation=u.m.Id(b.rotation)),a.ve=u.m.Id(b.ve),void 0!=b.checkCollisions&&null!=b.checkCollisions&&(a.checkCollisions=b.checkCollisions),void 0!=b.pickable&&null!=b.pickable&&(a.Be=b.pickable),void 0!=b.showBoundingBox&&null!=b.showBoundingBox&&(a.showBoundingBox=b.showBoundingBox),void 0!=b.showSubMeshesBoundingBox&&null!=b.showSubMeshesBoundingBox&&(a.showSubMeshesBoundingBox=b.showSubMeshesBoundingBox),void 0!=b.alphaIndex&&null!=b.showSubMeshesBoundingBox&&(a.alphaIndex=b.alphaIndex),b.physicsImpostor&&(a.physicsImpostor=P._PhysicsImpostorParser(E,a,b)),void 0!==b.actions&&(a._waitingData.actions=b.actions),b.animations){for(let M=0;M<b.animations.length;M++){const E=b.animations[M],x=(0,X.e)("BABYLON.Animation");x&&a.animations.push(x.Parse(E))}V.d.ParseAnimationRanges(a,b,E),b.autoAnimate&&E.beginAnimation(a,b.autoAnimateFrom,b.autoAnimateTo,b.autoAnimateLoop,b.autoAnimateSpeed||1)}}if(M.thinInstances){const E=M.thinInstances;if(x.thinInstanceEnablePicking=!!E.enablePicking,E.matrixData?(x.Oj("matrix",new Float32Array(E.matrixData),16,!1),x._thinInstanceDataStorage.matrixBufferSize=E.matrixBufferSize,x._thinInstanceDataStorage.instancesCount=E.instancesCount):x._thinInstanceDataStorage.matrixBufferSize=E.matrixBufferSize,M.thinInstances.userThinInstance){const E=M.thinInstances.userThinInstance;for(const M in E.data)x.Oj(M,new Float32Array(E.data[M]),E.strides[M],!1),x._userThinInstanceBuffersStorage.sizes[M]=E.sizes[M]}}return x}setPositionsForCPUSkinning(){const M=this._internalMeshDataInfo;if(!M._sourcePositions){const E=this.getVerticesData(I.g.PositionKind);if(!E)return M._sourcePositions;M._sourcePositions=new Float32Array(E),this.isVertexBufferUpdatable(I.g.PositionKind)||this.Ga(I.g.PositionKind,E,!0)}return M._sourcePositions}setNormalsForCPUSkinning(){const M=this._internalMeshDataInfo;if(!M._sourceNormals){const E=this.getVerticesData(I.g.NormalKind);if(!E)return M._sourceNormals;M._sourceNormals=new Float32Array(E),this.isVertexBufferUpdatable(I.g.NormalKind)||this.Ga(I.g.NormalKind,E,!0)}return M._sourceNormals}applySkeleton(M){if(!this.le)return this;if(this.le._softwareSkinningFrameId==this.va().getFrameId())return this;if(this.le._softwareSkinningFrameId=this.va().getFrameId(),!this.isVerticesDataPresent(I.g.PositionKind))return this;if(!this.isVerticesDataPresent(I.g.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(I.g.MatricesWeightsKind))return this;const E=this.isVerticesDataPresent(I.g.NormalKind),b=this._internalMeshDataInfo;if(!b._sourcePositions){const M=this.Td.slice();this.setPositionsForCPUSkinning(),this.Td=M}E&&!b._sourceNormals&&this.setNormalsForCPUSkinning();let x=this.getVerticesData(I.g.PositionKind);if(!x)return this;x instanceof Float32Array||(x=new Float32Array(x));let k=this.getVerticesData(I.g.NormalKind);if(E){if(!k)return this;k instanceof Float32Array||(k=new Float32Array(k))}const a=this.getVerticesData(I.g.MatricesIndicesKind),g=this.getVerticesData(I.g.MatricesWeightsKind);if(!g||!a)return this;const n=this.numBoneInfluencers>4,J=n?this.getVerticesData(I.g.MatricesIndicesExtraKind):null,T=n?this.getVerticesData(I.g.MatricesWeightsExtraKind):null,V=M.getTransformMatrices(this),t=u.m.Zero(),y=new u.d,B=new u.d;let r,c=0;for(let I=0;I<x.length;I+=3,c+=4){let M;for(r=0;r<4;r++)M=g[c+r],M>0&&(u.d.FromFloat32ArrayToRefScaled(V,Math.floor(16*a[c+r]),M,B),y.addToSelf(B));if(n)for(r=0;r<4;r++)M=T[c+r],M>0&&(u.d.FromFloat32ArrayToRefScaled(V,Math.floor(16*J[c+r]),M,B),y.addToSelf(B));u.m.TransformCoordinatesFromFloatsToRef(b._sourcePositions[I],b._sourcePositions[I+1],b._sourcePositions[I+2],y,t),t.toArray(x,I),E&&(u.m.TransformNormalFromFloatsToRef(b._sourceNormals[I],b._sourceNormals[I+1],b._sourceNormals[I+2],y,t),t.toArray(k,I)),y.reset()}return this.updateVerticesData(I.g.PositionKind,x),E&&this.updateVerticesData(I.g.NormalKind,k),this}static MinMax(M){let E=null,b=null;return M.forEach((function(M){const x=M.getBoundingInfo().boundingBox;E&&b?(E.minimizeInPlace(x.minimumWorld),b.maximizeInPlace(x.maximumWorld)):(E=x.minimumWorld,b=x.maximumWorld)})),E&&b?{min:E,max:b}:{min:u.m.Zero(),max:u.m.Zero()}}static Center(M){const E=M instanceof Array?P.MinMax(M):M;return u.m.Center(E.min,E.max)}static MergeMeshes(M){let E=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],b=arguments.length>2?arguments[2]:void 0,x=arguments.length>3?arguments[3]:void 0,k=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0;return(0,n.l)(P._MergeMeshesCoroutine(M,E,b,x,k,a,!1))}static MergeMeshesAsync(M){let E=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],b=arguments.length>2?arguments[2]:void 0,x=arguments.length>3?arguments[3]:void 0,k=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0;return(0,n.k)(P._MergeMeshesCoroutine(M,E,b,x,k,a,!0),(0,n.e)())}static*_MergeMeshesCoroutine(M){let E,b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],x=arguments.length>2?arguments[2]:void 0,k=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,g=arguments.length>5?arguments[5]:void 0,n=arguments.length>6?arguments[6]:void 0;if(0===(M=M.filter(Boolean)).length)return null;if(!x){let b=0;for(E=0;E<M.length;E++)if(b+=M[E].getTotalVertices(),b>=65536)return S.d.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}g&&(a=!1);const J=new Array,u=new Array,T=new Array,V=M[0].sideOrientation;for(E=0;E<M.length;E++){const b=M[E];if(b.isAnInstance)return S.d.Warn("Cannot merge instance meshes."),null;if(V!==b.sideOrientation)return S.d.Warn("Cannot merge meshes with different sideOrientation values."),null;if(a&&T.push(b.getTotalIndices()),g)if(b.material){const M=b.material;if(M instanceof C.e){for(let E=0;E<M.vg.length;E++)J.indexOf(M.vg[E])<0&&J.push(M.vg[E]);for(let E=0;E<b.Td.length;E++)u.push(J.indexOf(M.vg[b.Td[E].materialIndex])),T.push(b.Td[E].indexCount)}else{J.indexOf(M)<0&&J.push(M);for(let E=0;E<b.Td.length;E++)u.push(J.indexOf(M)),T.push(b.Td[E].indexCount)}}else for(let M=0;M<b.Td.length;M++)u.push(0),T.push(b.Td[M].indexCount)}const I=M[0],y=M=>{const E=M.ce(!0);return{vertexData:t.d.ExtractFromMesh(M,!1,!1),transform:E}},{vertexData:B,transform:c}=y(I);n&&(yield);const R=new Array(M.length-1);for(let t=1;t<M.length;t++)R[t-1]=y(M[t]),n&&(yield);const w=B._mergeCoroutine(c,R,x,n,!b);let X=w.next();for(;!X.done;)n&&(yield),X=w.next();const U=X.value;k||(k=new P(I.name+"_merged",I.va()));const v=U._applyToCoroutine(k,void 0,n);let N=v.next();for(;!N.done;)n&&(yield),N=v.next();if(k.checkCollisions=I.checkCollisions,k.sideOrientation=I.sideOrientation,b)for(E=0;E<M.length;E++)M[E].dispose();if(a||g){k.releaseSubMeshes(),E=0;let M=0;for(;E<T.length;)r.b.CreateFromIndices(0,M,T[E],k,void 0,!1),M+=T[E],E++;for(const E of k.Td)E.refreshBoundingInfo();k.ce(!0)}if(g){const M=new C.e(I.name+"_merged",I.va());M.vg=J;for(let E=0;E<k.Td.length;E++)k.Td[E].materialIndex=u[E];k.material=M}else k.material=I.material;return k}Ej(M){M._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(M)}Dj(M){const E=M._indexInSourceMeshInstanceArray;if(-1!=E){if(E!==this.instances.length-1){const M=this.instances[this.instances.length-1];this.instances[E]=M,M._indexInSourceMeshInstanceArray=E}M._indexInSourceMeshInstanceArray=-1,this.instances.pop()}}_shouldConvertRHS(){return this._scene.useRightHandedSystem&&this.sideOrientation===c.e.CounterClockWiseSideOrientation}_getRenderingFillMode(M){const E=this.va();return E.forcePointsCloud?c.e.PointFillMode:E.forceWireframe?c.e.WireFrameFillMode:this.overrideRenderingFillMode??M}setMaterialByID(M){return this.setMaterialById(M)}static CreateRibbon(M,E,b,x,k,a,g,n,J){throw new Error("Import MeshBuilder to populate this function")}static nb(M,E,b,x,k,a){throw new Error("Import MeshBuilder to populate this function")}static CreateBox(M,E,b,x,k){throw new Error("Import MeshBuilder to populate this function")}static CreateSphere(M,E,b,x,k,a){throw new Error("Import MeshBuilder to populate this function")}static CreateHemisphere(M,E,b,x){throw new Error("Import MeshBuilder to populate this function")}static CreateCylinder(M,E,b,x,k,a,g,n,J){throw new Error("Import MeshBuilder to populate this function")}static CreateTorus(M,E,b,x,k,a,g){throw new Error("Import MeshBuilder to populate this function")}static CreateTorusKnot(M,E,b,x,k,a,g,n,J,u){throw new Error("Import MeshBuilder to populate this function")}static ob(M,E,b,x,k){throw new Error("Import MeshBuilder to populate this function")}static CreateDashedLines(M,E,b,x,k,a,g,n){throw new Error("Import MeshBuilder to populate this function")}static CreatePolygon(M,E,b,x,k,a,g){throw new Error("Import MeshBuilder to populate this function")}static ExtrudePolygon(M,E,b,x,k,a,g,n){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShape(M,E,b,x,k,a,g,n,J,u){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShapeCustom(M,E,b,x,k,a,g,n,J,u,T,V){throw new Error("Import MeshBuilder to populate this function")}static CreateLathe(M,E,b,x,k,a,g){throw new Error("Import MeshBuilder to populate this function")}static yg(M,E,b,x,k){throw new Error("Import MeshBuilder to populate this function")}static CreateGround(M,E,b,x,k,a){throw new Error("Import MeshBuilder to populate this function")}static CreateTiledGround(M,E,b,x,k,a,g,n,J){throw new Error("Import MeshBuilder to populate this function")}static CreateGroundFromHeightMap(M,E,b,x,k,a,g,n,J,u,T){throw new Error("Import MeshBuilder to populate this function")}static CreateTube(M,E,b,x,k,a,g,n,J,u){throw new Error("Import MeshBuilder to populate this function")}static CreatePolyhedron(M,E,b){throw new Error("Import MeshBuilder to populate this function")}static CreateIcoSphere(M,E,b){throw new Error("Import MeshBuilder to populate this function")}static CreateDecal(M,E,b,x,k,a){throw new Error("Import MeshBuilder to populate this function")}static CreateCapsule(M,E,b){throw new Error("Import MeshBuilder to populate this function")}static ExtendToGoldberg(M){throw new Error("Import MeshBuilder to populate this function")}}P.FRONTSIDE=t.d.FRONTSIDE,P.BACKSIDE=t.d.BACKSIDE,P.DOUBLESIDE=t.d.DOUBLESIDE,P.DEFAULTSIDE=t.d.DEFAULTSIDE,P.NO_CAP=0,P.CAP_START=1,P.CAP_END=2,P.CAP_ALL=3,P.NO_FLIP=0,P.FLIP_TILE=1,P.ROTATE_TILE=2,P.FLIP_ROW=3,P.ROTATE_ROW=4,P.FLIP_N_ROTATE_TILE=5,P.FLIP_N_ROTATE_ROW=6,P.CENTER=0,P.LEFT=1,P.RIGHT=2,P.TOP=3,P.BOTTOM=4,P.INSTANCEDMESH_SORT_TRANSPARENT=!1,P._GroundMeshParser=(M,E)=>{throw(0,U.b)("GroundMesh")},P._GoldbergMeshParser=(M,E)=>{throw(0,U.b)("GoldbergMesh")},P._LinesMeshParser=(M,E)=>{throw(0,U.b)("LinesMesh")},P._GreasedLineMeshParser=(M,E)=>{throw(0,U.b)("GreasedLineMesh")},P._GreasedLineRibbonMeshParser=(M,E)=>{throw(0,U.b)("GreasedLineRibbonMesh")},P._TrailMeshParser=(M,E)=>{throw(0,U.b)("TrailMesh")},(0,X.h)("BABYLON.Mesh",P)},11557:(M,E,b)=>{"use strict";b.d(E,{d:()=>y});var x=b(948),k=b(970),a=b(1228),g=b(1056),n=b(1133),J=b(1060),u=b(953),T=b(11546),V=b(1041),I=b(1328);class t{}class y{constructor(){this.uniqueId=0,this.metadata={},this._applyTo=(0,T.i)(this._applyToCoroutine.bind(this)),this.uniqueId=y._UniqueIDGenerator,y._UniqueIDGenerator++}set(M,E){switch(M.length||J.d.Warn(`Setting vertex data kind '${E}' with an empty array`),E){case a.g.PositionKind:this.xa=M;break;case a.g.NormalKind:this.ya=M;break;case a.g.TangentKind:this.tangents=M;break;case a.g.UVKind:this.Aa=M;break;case a.g.UV2Kind:this.uvs2=M;break;case a.g.UV3Kind:this.uvs3=M;break;case a.g.UV4Kind:this.uvs4=M;break;case a.g.UV5Kind:this.uvs5=M;break;case a.g.UV6Kind:this.uvs6=M;break;case a.g.ColorKind:this.za=M;break;case a.g.MatricesIndicesKind:this.matricesIndices=M;break;case a.g.MatricesWeightsKind:this.matricesWeights=M;break;case a.g.MatricesIndicesExtraKind:this.matricesIndicesExtra=M;break;case a.g.MatricesWeightsExtraKind:this.matricesWeightsExtra=M}}Ca(M,E){return this._applyTo(M,E,!1),this}applyToGeometry(M,E){return this._applyTo(M,E,!1),this}updateMesh(M){return this._update(M),this}updateGeometry(M){return this._update(M),this}*_applyToCoroutine(M){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2?arguments[2]:void 0;if(this.xa&&(M.Ga(a.g.PositionKind,this.xa,E),b&&(yield)),this.ya&&(M.Ga(a.g.NormalKind,this.ya,E),b&&(yield)),this.tangents&&(M.Ga(a.g.TangentKind,this.tangents,E),b&&(yield)),this.Aa&&(M.Ga(a.g.UVKind,this.Aa,E),b&&(yield)),this.uvs2&&(M.Ga(a.g.UV2Kind,this.uvs2,E),b&&(yield)),this.uvs3&&(M.Ga(a.g.UV3Kind,this.uvs3,E),b&&(yield)),this.uvs4&&(M.Ga(a.g.UV4Kind,this.uvs4,E),b&&(yield)),this.uvs5&&(M.Ga(a.g.UV5Kind,this.uvs5,E),b&&(yield)),this.uvs6&&(M.Ga(a.g.UV6Kind,this.uvs6,E),b&&(yield)),this.za&&(M.Ga(a.g.ColorKind,this.za,E),this.hasVertexAlpha&&void 0!==M.hasVertexAlpha&&(M.hasVertexAlpha=!0),b&&(yield)),this.matricesIndices&&(M.Ga(a.g.MatricesIndicesKind,this.matricesIndices,E),b&&(yield)),this.matricesWeights&&(M.Ga(a.g.MatricesWeightsKind,this.matricesWeights,E),b&&(yield)),this.matricesIndicesExtra&&(M.Ga(a.g.MatricesIndicesExtraKind,this.matricesIndicesExtra,E),b&&(yield)),this.matricesWeightsExtra&&(M.Ga(a.g.MatricesWeightsExtraKind,this.matricesWeightsExtra,E),b&&(yield)),this.indices?(M.setIndices(this.indices,null,E),b&&(yield)):M.setIndices([],null),M.Td&&this.materialInfos&&this.materialInfos.length>1){const E=M;E.Td=[];for(const M of this.materialInfos)new I.b(M.materialIndex,M.verticesStart,M.verticesCount,M.indexStart,M.indexCount,E)}return this}_update(M,E,b){return this.xa&&M.updateVerticesData(a.g.PositionKind,this.xa,E,b),this.ya&&M.updateVerticesData(a.g.NormalKind,this.ya,E,b),this.tangents&&M.updateVerticesData(a.g.TangentKind,this.tangents,E,b),this.Aa&&M.updateVerticesData(a.g.UVKind,this.Aa,E,b),this.uvs2&&M.updateVerticesData(a.g.UV2Kind,this.uvs2,E,b),this.uvs3&&M.updateVerticesData(a.g.UV3Kind,this.uvs3,E,b),this.uvs4&&M.updateVerticesData(a.g.UV4Kind,this.uvs4,E,b),this.uvs5&&M.updateVerticesData(a.g.UV5Kind,this.uvs5,E,b),this.uvs6&&M.updateVerticesData(a.g.UV6Kind,this.uvs6,E,b),this.za&&M.updateVerticesData(a.g.ColorKind,this.za,E,b),this.matricesIndices&&M.updateVerticesData(a.g.MatricesIndicesKind,this.matricesIndices,E,b),this.matricesWeights&&M.updateVerticesData(a.g.MatricesWeightsKind,this.matricesWeights,E,b),this.matricesIndicesExtra&&M.updateVerticesData(a.g.MatricesIndicesExtraKind,this.matricesIndicesExtra,E,b),this.matricesWeightsExtra&&M.updateVerticesData(a.g.MatricesWeightsExtraKind,this.matricesWeightsExtra,E,b),this.indices&&M.setIndices(this.indices,null),this}static _TransformVector3Coordinates(M,E){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:M.length;const a=k.i.Fd[0],g=k.i.Fd[1];for(let n=b;n<b+x;n+=3)k.m.FromArrayToRef(M,n,a),k.m.TransformCoordinatesToRef(a,E,g),M[n]=g.x,M[n+1]=g.y,M[n+2]=g.z}static _TransformVector3Normals(M,E){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:M.length;const a=k.i.Fd[0],g=k.i.Fd[1];for(let n=b;n<b+x;n+=3)k.m.FromArrayToRef(M,n,a),k.m.TransformNormalToRef(a,E,g),M[n]=g.x,M[n+1]=g.y,M[n+2]=g.z}static _TransformVector4Normals(M,E){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:M.length;const a=k.i.Vector4[0],g=k.i.Vector4[1];for(let n=b;n<b+x;n+=4)k.o.FromArrayToRef(M,n,a),k.o.TransformNormalToRef(a,E,g),M[n]=g.x,M[n+1]=g.y,M[n+2]=g.z,M[n+3]=g.w}static _FlipFaces(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:M.length;for(let x=E;x<E+b;x+=3){const E=M[x+1];M[x+1]=M[x+2],M[x+2]=E}}transform(M){const E=M.determinant()<0;return this.xa&&y._TransformVector3Coordinates(this.xa,M),this.ya&&y._TransformVector3Normals(this.ya,M),this.tangents&&y._TransformVector4Normals(this.tangents,M),E&&this.indices&&y._FlipFaces(this.indices),this}splitBasedOnMaterialID(){if(!this.materialInfos||this.materialInfos.length<2)return[this];const M=[];for(const E of this.materialInfos){const b=new y;if(this.xa&&(b.xa=this.xa.slice(3*E.verticesStart,3*(E.verticesCount+E.verticesStart))),this.ya&&(b.ya=this.ya.slice(3*E.verticesStart,3*(E.verticesCount+E.verticesStart))),this.tangents&&(b.tangents=this.tangents.slice(4*E.verticesStart,4*(E.verticesCount+E.verticesStart))),this.za&&(b.za=this.za.slice(4*E.verticesStart,4*(E.verticesCount+E.verticesStart))),this.Aa&&(b.Aa=this.Aa.slice(2*E.verticesStart,2*(E.verticesCount+E.verticesStart))),this.uvs2&&(b.uvs2=this.uvs2.slice(2*E.verticesStart,2*(E.verticesCount+E.verticesStart))),this.uvs3&&(b.uvs3=this.uvs3.slice(2*E.verticesStart,2*(E.verticesCount+E.verticesStart))),this.uvs4&&(b.uvs4=this.uvs4.slice(2*E.verticesStart,2*(E.verticesCount+E.verticesStart))),this.uvs5&&(b.uvs5=this.uvs5.slice(2*E.verticesStart,2*(E.verticesCount+E.verticesStart))),this.uvs6&&(b.uvs6=this.uvs6.slice(2*E.verticesStart,2*(E.verticesCount+E.verticesStart))),this.matricesIndices&&(b.matricesIndices=this.matricesIndices.slice(4*E.verticesStart,4*(E.verticesCount+E.verticesStart))),this.matricesIndicesExtra&&(b.matricesIndicesExtra=this.matricesIndicesExtra.slice(4*E.verticesStart,4*(E.verticesCount+E.verticesStart))),this.matricesWeights&&(b.matricesWeights=this.matricesWeights.slice(4*E.verticesStart,4*(E.verticesCount+E.verticesStart))),this.matricesWeightsExtra&&(b.matricesWeightsExtra=this.matricesWeightsExtra.slice(4*E.verticesStart,4*(E.verticesCount+E.verticesStart))),this.indices){b.indices=[];for(let M=E.indexStart;M<E.indexStart+E.indexCount;M++)b.indices.push(this.indices[M]-E.verticesStart)}const x=new t;x.indexStart=0,x.indexCount=b.indices?b.indices.length:0,x.materialIndex=E.materialIndex,x.verticesStart=0,x.verticesCount=(b.xa?b.xa.length:0)/3,b.materialInfos=[x],M.push(b)}return M}merge(M){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],x=arguments.length>3&&void 0!==arguments[3]&&arguments[3],k=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const a=Array.isArray(M)?M.map((M=>({vertexData:M}))):[{vertexData:M}];return(0,T.l)(this._mergeCoroutine(void 0,a,E,!1,b,x,k))}*_mergeCoroutine(M,E){var b,x;let k=arguments.length>2&&void 0!==arguments[2]&&arguments[2],g=arguments.length>3?arguments[3]:void 0,n=arguments.length>4?arguments[4]:void 0,J=arguments.length>5&&void 0!==arguments[5]&&arguments[5],u=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this._validate();let T=E.map((M=>M.vertexData)),V=this;if(u)for(const a of T)a&&(a._validate(),!this.ya&&a.ya&&(this.ya=new Float32Array(this.xa.length)),!this.tangents&&a.tangents&&(this.tangents=new Float32Array(this.xa.length/3*4)),!this.Aa&&a.Aa&&(this.Aa=new Float32Array(this.xa.length/3*2)),!this.uvs2&&a.uvs2&&(this.uvs2=new Float32Array(this.xa.length/3*2)),!this.uvs3&&a.uvs3&&(this.uvs3=new Float32Array(this.xa.length/3*2)),!this.uvs4&&a.uvs4&&(this.uvs4=new Float32Array(this.xa.length/3*2)),!this.uvs5&&a.uvs5&&(this.uvs5=new Float32Array(this.xa.length/3*2)),!this.uvs6&&a.uvs6&&(this.uvs6=new Float32Array(this.xa.length/3*2)),!this.za&&a.za&&(this.za=new Float32Array(this.xa.length/3*4),this.za.fill(1)),!this.matricesIndices&&a.matricesIndices&&(this.matricesIndices=new Float32Array(this.xa.length/3*4)),!this.matricesWeights&&a.matricesWeights&&(this.matricesWeights=new Float32Array(this.xa.length/3*4)),!this.matricesIndicesExtra&&a.matricesIndicesExtra&&(this.matricesIndicesExtra=new Float32Array(this.xa.length/3*4)),!this.matricesWeightsExtra&&a.matricesWeightsExtra&&(this.matricesWeightsExtra=new Float32Array(this.xa.length/3*4)));for(const a of T)if(a)if(u)this.ya&&!a.ya&&(a.ya=new Float32Array(a.xa.length)),this.tangents&&!a.tangents&&(a.tangents=new Float32Array(a.xa.length/3*4)),this.Aa&&!a.Aa&&(a.Aa=new Float32Array(a.xa.length/3*2)),this.uvs2&&!a.uvs2&&(a.uvs2=new Float32Array(a.xa.length/3*2)),this.uvs3&&!a.uvs3&&(a.uvs3=new Float32Array(a.xa.length/3*2)),this.uvs4&&!a.uvs4&&(a.uvs4=new Float32Array(a.xa.length/3*2)),this.uvs5&&!a.uvs5&&(a.uvs5=new Float32Array(a.xa.length/3*2)),this.uvs6&&!a.uvs6&&(a.uvs6=new Float32Array(a.xa.length/3*2)),this.za&&!a.za&&(a.za=new Float32Array(a.xa.length/3*4),a.za.fill(1)),this.matricesIndices&&!a.matricesIndices&&(a.matricesIndices=new Float32Array(a.xa.length/3*4)),this.matricesWeights&&!a.matricesWeights&&(a.matricesWeights=new Float32Array(a.xa.length/3*4)),this.matricesIndicesExtra&&!a.matricesIndicesExtra&&(a.matricesIndicesExtra=new Float32Array(a.xa.length/3*4)),this.matricesWeightsExtra&&!a.matricesWeightsExtra&&(a.matricesWeightsExtra=new Float32Array(a.xa.length/3*4));else if(a._validate(),!this.ya!==!a.ya||!this.tangents!==!a.tangents||!this.Aa!==!a.Aa||!this.uvs2!==!a.uvs2||!this.uvs3!==!a.uvs3||!this.uvs4!==!a.uvs4||!this.uvs5!==!a.uvs5||!this.uvs6!==!a.uvs6||!this.za!==!a.za||!this.matricesIndices!==!a.matricesIndices||!this.matricesWeights!==!a.matricesWeights||!this.matricesIndicesExtra!==!a.matricesIndicesExtra||!this.matricesWeightsExtra!==!a.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(J){let b=0,x=0,k=0;const a=[];let g=null;const n=[];for(const E of this.splitBasedOnMaterialID())n.push({vertexData:E,transform:M});for(const M of E)if(M.vertexData)for(const E of M.vertexData.splitBasedOnMaterialID())n.push({vertexData:E,transform:M.transform});n.sort(((M,E)=>{const b=M.vertexData.materialInfos?M.vertexData.materialInfos[0].materialIndex:0,x=E.vertexData.materialInfos?E.vertexData.materialInfos[0].materialIndex:0;return b>x?1:b===x?0:-1}));for(const M of n){const E=M.vertexData;if(b=E.materialInfos?E.materialInfos[0].materialIndex:0,g&&g.materialIndex===b)g.indexCount+=E.indices.length,g.verticesCount+=E.xa.length/3;else{const M=new t;M.materialIndex=b,M.indexStart=x,M.indexCount=E.indices.length,M.verticesStart=k,M.verticesCount=E.xa.length/3,a.push(M),g=M}x+=E.indices.length,k+=E.xa.length/3}const J=n.splice(0,1)[0];V=J.vertexData,M=J.transform,T=n.map((M=>M.vertexData)),E=n,this.materialInfos=a}const I=T.reduce(((M,E)=>{var b;return M+((null===(b=E.indices)||void 0===b?void 0:b.length)??0)}),(null===(b=V.indices)||void 0===b?void 0:b.length)??0);let B=n||T.some((M=>M.indices===V.indices))?null===(x=V.indices)||void 0===x?void 0:x.slice():V.indices;if(I>0){var r;let b=(null===(r=B)||void 0===r?void 0:r.length)??0;if(B||(B=new Array(I)),B.length!==I){if(Array.isArray(B))B.length=I;else{const M=k||B instanceof Uint32Array?new Uint32Array(I):new Uint16Array(I);M.set(B),B=M}M&&M.determinant()<0&&y._FlipFaces(B,0,b)}let x=V.xa?V.xa.length/3:0;for(const{vertexData:M,transform:k}of E)if(M.indices){for(let E=0;E<M.indices.length;E++)B[b+E]=M.indices[E]+x;k&&k.determinant()<0&&y._FlipFaces(B,b,M.indices.length),x+=M.xa.length/3,b+=M.indices.length,g&&(yield)}}return this.indices=B,this.xa=y._MergeElement(a.g.PositionKind,V.xa,M,E.map((M=>[M.vertexData.xa,M.transform]))),g&&(yield),V.ya&&(this.ya=y._MergeElement(a.g.NormalKind,V.ya,M,E.map((M=>[M.vertexData.ya,M.transform]))),g&&(yield)),V.tangents&&(this.tangents=y._MergeElement(a.g.TangentKind,V.tangents,M,E.map((M=>[M.vertexData.tangents,M.transform]))),g&&(yield)),V.Aa&&(this.Aa=y._MergeElement(a.g.UVKind,V.Aa,M,E.map((M=>[M.vertexData.Aa,M.transform]))),g&&(yield)),V.uvs2&&(this.uvs2=y._MergeElement(a.g.UV2Kind,V.uvs2,M,E.map((M=>[M.vertexData.uvs2,M.transform]))),g&&(yield)),V.uvs3&&(this.uvs3=y._MergeElement(a.g.UV3Kind,V.uvs3,M,E.map((M=>[M.vertexData.uvs3,M.transform]))),g&&(yield)),V.uvs4&&(this.uvs4=y._MergeElement(a.g.UV4Kind,V.uvs4,M,E.map((M=>[M.vertexData.uvs4,M.transform]))),g&&(yield)),V.uvs5&&(this.uvs5=y._MergeElement(a.g.UV5Kind,V.uvs5,M,E.map((M=>[M.vertexData.uvs5,M.transform]))),g&&(yield)),V.uvs6&&(this.uvs6=y._MergeElement(a.g.UV6Kind,V.uvs6,M,E.map((M=>[M.vertexData.uvs6,M.transform]))),g&&(yield)),V.za&&(this.za=y._MergeElement(a.g.ColorKind,V.za,M,E.map((M=>[M.vertexData.za,M.transform]))),(void 0!==V.hasVertexAlpha||E.some((M=>void 0!==M.vertexData.hasVertexAlpha)))&&(this.hasVertexAlpha=V.hasVertexAlpha||E.some((M=>M.vertexData.hasVertexAlpha))),g&&(yield)),V.matricesIndices&&(this.matricesIndices=y._MergeElement(a.g.MatricesIndicesKind,V.matricesIndices,M,E.map((M=>[M.vertexData.matricesIndices,M.transform]))),g&&(yield)),V.matricesWeights&&(this.matricesWeights=y._MergeElement(a.g.MatricesWeightsKind,V.matricesWeights,M,E.map((M=>[M.vertexData.matricesWeights,M.transform]))),g&&(yield)),V.matricesIndicesExtra&&(this.matricesIndicesExtra=y._MergeElement(a.g.MatricesIndicesExtraKind,V.matricesIndicesExtra,M,E.map((M=>[M.vertexData.matricesIndicesExtra,M.transform]))),g&&(yield)),V.matricesWeightsExtra&&(this.matricesWeightsExtra=y._MergeElement(a.g.MatricesWeightsExtraKind,V.matricesWeightsExtra,M,E.map((M=>[M.vertexData.matricesWeightsExtra,M.transform])))),this}static _MergeElement(M,E,b,x){const k=x.filter((M=>null!==M[0]&&void 0!==M[0]));if(!E&&0==k.length)return E;if(!E)return this._MergeElement(M,k[0][0],k[0][1],k.slice(1));const g=k.reduce(((M,E)=>M+E[0].length),E.length),n=M===a.g.PositionKind?y._TransformVector3Coordinates:M===a.g.NormalKind?y._TransformVector3Normals:M===a.g.TangentKind?y._TransformVector4Normals:()=>{};if(E instanceof Float32Array){const M=new Float32Array(g);M.set(E),b&&n(M,b,0,E.length);let x=E.length;for(const[E,b]of k)M.set(E,x),b&&n(M,b,x,E.length),x+=E.length;return M}{const M=new Array(g);for(let b=0;b<E.length;b++)M[b]=E[b];b&&n(M,b,0,E.length);let x=E.length;for(const[E,b]of k){for(let b=0;b<E.length;b++)M[x+b]=E[b];b&&n(M,b,x,E.length),x+=E.length}return M}}_validate(){if(!this.xa)throw new V.g("Positions are required",V.f.MeshInvalidPositionsError);const M=(M,E)=>{const b=a.g.DeduceStride(M);if(E.length%b!==0)throw new Error("The "+M+"s array count must be a multiple of "+b);return E.length/b},E=M(a.g.PositionKind,this.xa),b=(b,x)=>{const k=M(b,x);if(k!==E)throw new Error("The "+b+"s element count ("+k+") does not match the positions count ("+E+")")};this.ya&&b(a.g.NormalKind,this.ya),this.tangents&&b(a.g.TangentKind,this.tangents),this.Aa&&b(a.g.UVKind,this.Aa),this.uvs2&&b(a.g.UV2Kind,this.uvs2),this.uvs3&&b(a.g.UV3Kind,this.uvs3),this.uvs4&&b(a.g.UV4Kind,this.uvs4),this.uvs5&&b(a.g.UV5Kind,this.uvs5),this.uvs6&&b(a.g.UV6Kind,this.uvs6),this.za&&b(a.g.ColorKind,this.za),this.matricesIndices&&b(a.g.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&b(a.g.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&b(a.g.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&b(a.g.MatricesWeightsExtraKind,this.matricesWeightsExtra)}clone(){const M=this.serialize();return y.Parse(M)}serialize(){const M={};if(this.xa&&(M.xa=Array.from(this.xa)),this.ya&&(M.ya=Array.from(this.ya)),this.tangents&&(M.tangents=Array.from(this.tangents)),this.Aa&&(M.Aa=Array.from(this.Aa)),this.uvs2&&(M.uvs2=Array.from(this.uvs2)),this.uvs3&&(M.uvs3=Array.from(this.uvs3)),this.uvs4&&(M.uvs4=Array.from(this.uvs4)),this.uvs5&&(M.uvs5=Array.from(this.uvs5)),this.uvs6&&(M.uvs6=Array.from(this.uvs6)),this.za&&(M.za=Array.from(this.za),M.hasVertexAlpha=this.hasVertexAlpha),this.matricesIndices&&(M.matricesIndices=Array.from(this.matricesIndices),M.matricesIndices._isExpanded=!0),this.matricesWeights&&(M.matricesWeights=Array.from(this.matricesWeights)),this.matricesIndicesExtra&&(M.matricesIndicesExtra=Array.from(this.matricesIndicesExtra),M.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(M.matricesWeightsExtra=Array.from(this.matricesWeightsExtra)),M.indices=Array.from(this.indices),this.materialInfos){M.materialInfos=[];for(const E of this.materialInfos){const b={indexStart:E.indexStart,indexCount:E.indexCount,materialIndex:E.materialIndex,verticesStart:E.verticesStart,verticesCount:E.verticesCount};M.materialInfos.push(b)}}return M}static ExtractFromMesh(M,E,b){return y._ExtractFrom(M,E,b)}static ExtractFromGeometry(M,E,b){return y._ExtractFrom(M,E,b)}static _ExtractFrom(M,E,b){const x=new y;if(M.isVerticesDataPresent(a.g.PositionKind)&&(x.xa=M.getVerticesData(a.g.PositionKind,E,b)),M.isVerticesDataPresent(a.g.NormalKind)&&(x.ya=M.getVerticesData(a.g.NormalKind,E,b)),M.isVerticesDataPresent(a.g.TangentKind)&&(x.tangents=M.getVerticesData(a.g.TangentKind,E,b)),M.isVerticesDataPresent(a.g.UVKind)&&(x.Aa=M.getVerticesData(a.g.UVKind,E,b)),M.isVerticesDataPresent(a.g.UV2Kind)&&(x.uvs2=M.getVerticesData(a.g.UV2Kind,E,b)),M.isVerticesDataPresent(a.g.UV3Kind)&&(x.uvs3=M.getVerticesData(a.g.UV3Kind,E,b)),M.isVerticesDataPresent(a.g.UV4Kind)&&(x.uvs4=M.getVerticesData(a.g.UV4Kind,E,b)),M.isVerticesDataPresent(a.g.UV5Kind)&&(x.uvs5=M.getVerticesData(a.g.UV5Kind,E,b)),M.isVerticesDataPresent(a.g.UV6Kind)&&(x.uvs6=M.getVerticesData(a.g.UV6Kind,E,b)),M.isVerticesDataPresent(a.g.ColorKind)){const k=M.le||M,g=k.getVertexBuffer(a.g.ColorKind),n=k.getVerticesData(a.g.ColorKind,E,b);if(3===g.getSize()){const M=new Float32Array(4*n.length/3);for(let E=0,b=0;E<n.length;E+=3,b+=4)M[b]=n[E],M[b+1]=n[E+1],M[b+2]=n[E+2],M[b+3]=1;x.za=M}else{if(4!==g.getSize())throw new Error(`Unexpected number of color components: ${g.getSize()}`);x.za=n}}return M.isVerticesDataPresent(a.g.MatricesIndicesKind)&&(x.matricesIndices=M.getVerticesData(a.g.MatricesIndicesKind,E,b)),M.isVerticesDataPresent(a.g.MatricesWeightsKind)&&(x.matricesWeights=M.getVerticesData(a.g.MatricesWeightsKind,E,b)),M.isVerticesDataPresent(a.g.MatricesIndicesExtraKind)&&(x.matricesIndicesExtra=M.getVerticesData(a.g.MatricesIndicesExtraKind,E,b)),M.isVerticesDataPresent(a.g.MatricesWeightsExtraKind)&&(x.matricesWeightsExtra=M.getVerticesData(a.g.MatricesWeightsExtraKind,E,b)),x.indices=M.Ed(E,b),x}static CreateRibbon(M){throw(0,g.b)("ribbonBuilder")}static CreateBox(M){throw(0,g.b)("boxBuilder")}static CreateTiledBox(M){throw(0,g.b)("tiledBoxBuilder")}static CreateTiledPlane(M){throw(0,g.b)("tiledPlaneBuilder")}static CreateSphere(M){throw(0,g.b)("sphereBuilder")}static CreateCylinder(M){throw(0,g.b)("cylinderBuilder")}static CreateTorus(M){throw(0,g.b)("torusBuilder")}static CreateLineSystem(M){throw(0,g.b)("linesBuilder")}static CreateDashedLines(M){throw(0,g.b)("linesBuilder")}static CreateGround(M){throw(0,g.b)("groundBuilder")}static CreateTiledGround(M){throw(0,g.b)("groundBuilder")}static CreateGroundFromHeightMap(M){throw(0,g.b)("groundBuilder")}static yg(M){throw(0,g.b)("planeBuilder")}static nb(M){throw(0,g.b)("discBuilder")}static CreatePolygon(M,E,b,x,k,a,n){throw(0,g.b)("polygonBuilder")}static CreateIcoSphere(M){throw(0,g.b)("icoSphereBuilder")}static CreatePolyhedron(M){throw(0,g.b)("polyhedronBuilder")}static CreateCapsule(){arguments.length>0&&void 0!==arguments[0]||k.m.Up();throw(0,g.b)("capsuleBuilder")}static CreateTorusKnot(M){throw(0,g.b)("torusKnotBuilder")}static ComputeNormals(M,E,b,x){let a=0,g=0,n=0,J=0,u=0,T=0,V=0,I=0,t=0,y=0,B=0,r=0,c=0,C=0,R=0,w=0,S=0,X=0,U=0,v=0,N=!1,K=!1,h=!1,Z=!1,O=1,p=0,P=null;x&&(N=!!x.facetNormals,K=!!x.facetPositions,h=!!x.facetPartitioning,O=!0===x.useRightHandedSystem?-1:1,p=x.ratio||0,Z=!!x.depthSort,P=x.distanceTo,Z&&void 0===P&&(P=k.m.Zero()));let F=0,l=0,d=0,W=0;for(h&&x&&x.bbSize&&(F=x.subDiv.X*p/x.bbSize.x,l=x.subDiv.Y*p/x.bbSize.y,d=x.subDiv.Z*p/x.bbSize.z,W=x.subDiv.max*x.subDiv.max,x.facetPartitioning.length=0),a=0;a<M.length;a++)b[a]=0;const m=E.length/3|0;for(a=0;a<m;a++){if(r=3*E[3*a],c=r+1,C=r+2,R=3*E[3*a+1],w=R+1,S=R+2,X=3*E[3*a+2],U=X+1,v=X+2,g=M[r]-M[R],n=M[c]-M[w],J=M[C]-M[S],u=M[X]-M[R],T=M[U]-M[w],V=M[v]-M[S],I=O*(n*V-J*T),t=O*(J*u-g*V),y=O*(g*T-n*u),B=Math.sqrt(I*I+t*t+y*y),B=0===B?1:B,I/=B,t/=B,y/=B,N&&x&&(x.facetNormals[a].x=I,x.facetNormals[a].y=t,x.facetNormals[a].z=y),K&&x&&(x.facetPositions[a].x=(M[r]+M[R]+M[X])/3,x.facetPositions[a].y=(M[c]+M[w]+M[U])/3,x.facetPositions[a].z=(M[C]+M[S]+M[v])/3),h&&x){const E=Math.floor((x.facetPositions[a].x-x.bInfo.minimum.x*p)*F),b=Math.floor((x.facetPositions[a].y-x.bInfo.minimum.y*p)*l),k=Math.floor((x.facetPositions[a].z-x.bInfo.minimum.z*p)*d),g=Math.floor((M[r]-x.bInfo.minimum.x*p)*F),n=Math.floor((M[c]-x.bInfo.minimum.y*p)*l),J=Math.floor((M[C]-x.bInfo.minimum.z*p)*d),u=Math.floor((M[R]-x.bInfo.minimum.x*p)*F),T=Math.floor((M[w]-x.bInfo.minimum.y*p)*l),V=Math.floor((M[S]-x.bInfo.minimum.z*p)*d),I=Math.floor((M[X]-x.bInfo.minimum.x*p)*F),t=Math.floor((M[U]-x.bInfo.minimum.y*p)*l),y=Math.floor((M[v]-x.bInfo.minimum.z*p)*d),B=g+x.subDiv.max*n+W*J,N=u+x.subDiv.max*T+W*V,K=I+x.subDiv.max*t+W*y,h=E+x.subDiv.max*b+W*k;x.facetPartitioning[h]=x.facetPartitioning[h]?x.facetPartitioning[h]:new Array,x.facetPartitioning[B]=x.facetPartitioning[B]?x.facetPartitioning[B]:new Array,x.facetPartitioning[N]=x.facetPartitioning[N]?x.facetPartitioning[N]:new Array,x.facetPartitioning[K]=x.facetPartitioning[K]?x.facetPartitioning[K]:new Array,x.facetPartitioning[B].push(a),N!=B&&x.facetPartitioning[N].push(a),K!=N&&K!=B&&x.facetPartitioning[K].push(a),h!=B&&h!=N&&h!=K&&x.facetPartitioning[h].push(a)}if(Z&&x&&x.facetPositions){const M=x.depthSortedFacets[a];M.ind=3*a,M.sqDistance=k.m.DistanceSquared(x.facetPositions[a],P)}b[r]+=I,b[c]+=t,b[C]+=y,b[R]+=I,b[w]+=t,b[S]+=y,b[X]+=I,b[U]+=t,b[v]+=y}for(a=0;a<b.length/3;a++)I=b[3*a],t=b[3*a+1],y=b[3*a+2],B=Math.sqrt(I*I+t*t+y*y),B=0===B?1:B,I/=B,t/=B,y/=B,b[3*a]=I,b[3*a+1]=t,b[3*a+2]=y}static _ComputeSides(M,E,b,x,a,g,n){const J=b.length,u=x.length;let T,V;switch(M=M||y.DEFAULTSIDE){case y.FRONTSIDE:break;case y.BACKSIDE:for(T=0;T<J;T+=3){const M=b[T];b[T]=b[T+2],b[T+2]=M}for(V=0;V<u;V++)x[V]=-x[V];break;case y.DOUBLESIDE:{const M=E.length,I=M/3;for(let b=0;b<M;b++)E[M+b]=E[b];for(T=0;T<J;T+=3)b[T+J]=b[T+2]+I,b[T+1+J]=b[T+1]+I,b[T+2+J]=b[T]+I;for(V=0;V<u;V++)x[u+V]=-x[V];const t=a.length;let y=0;for(y=0;y<t;y++)a[y+t]=a[y];for(g=g||new k.o(0,0,1,1),n=n||new k.o(0,0,1,1),y=0,T=0;T<t/2;T++)a[y]=g.x+(g.z-g.x)*a[y],a[y+1]=g.y+(g.w-g.y)*a[y+1],a[y+t]=n.x+(n.z-n.x)*a[y+t],a[y+t+1]=n.y+(n.w-n.y)*a[y+t+1],y+=2;break}}}static Parse(M){const E=new y,b=M.xa;b&&E.set(b,a.g.PositionKind);const x=M.ya;x&&E.set(x,a.g.NormalKind);const k=M.tangents;k&&E.set(k,a.g.TangentKind);const g=M.Aa;g&&E.set(g,a.g.UVKind);const J=M.uvs2;J&&E.set(J,a.g.UV2Kind);const u=M.uvs3;u&&E.set(u,a.g.UV3Kind);const T=M.uvs4;T&&E.set(T,a.g.UV4Kind);const V=M.uvs5;V&&E.set(V,a.g.UV5Kind);const I=M.uvs6;I&&E.set(I,a.g.UV6Kind);const B=M.za;B&&(E.set(n.h.CheckColors4(B,b.length/3),a.g.ColorKind),void 0!==M.hasVertexAlpha&&(E.hasVertexAlpha=M.hasVertexAlpha));const r=M.matricesIndices;r&&E.set(r,a.g.MatricesIndicesKind);const c=M.matricesWeights;c&&E.set(c,a.g.MatricesWeightsKind);const C=M.indices;C&&(E.indices=C);const R=M.materialInfos;if(R){E.materialInfos=[];for(const M of R){const b=new t;b.indexCount=M.indexCount,b.indexStart=M.indexStart,b.verticesCount=M.verticesCount,b.verticesStart=M.verticesStart,b.materialIndex=M.materialIndex,E.materialInfos.push(b)}}return E}static ImportVertexData(M,E){const b=y.Parse(M);E.setAllVerticesData(b,M.updatable)}}y.FRONTSIDE=0,y.BACKSIDE=1,y.DOUBLESIDE=2,y.DEFAULTSIDE=0,y._UniqueIDGenerator=0,(0,x.d)([u.g.filter((function(){for(var M=arguments.length,E=new Array(M),b=0;b<M;b++)E[b]=arguments[b];let[x]=E;return!Array.isArray(x)}))],y,"_TransformVector3Coordinates",null),(0,x.d)([u.g.filter((function(){for(var M=arguments.length,E=new Array(M),b=0;b<M;b++)E[b]=arguments[b];let[x]=E;return!Array.isArray(x)}))],y,"_TransformVector3Normals",null),(0,x.d)([u.g.filter((function(){for(var M=arguments.length,E=new Array(M),b=0;b<M;b++)E[b]=arguments[b];let[x]=E;return!Array.isArray(x)}))],y,"_TransformVector4Normals",null),(0,x.d)([u.g.filter((function(){for(var M=arguments.length,E=new Array(M),b=0;b<M;b++)E[b]=arguments[b];let[x]=E;return!Array.isArray(x)}))],y,"_FlipFaces",null)},12517:(M,E,b)=>{"use strict";b.d(E,{d:()=>BM});var x=b(970),k=b(11537),a=b(1228),g=b(11557),n=b(1152);function J(M){let E=M.pathArray;const b=M.closeArray||!1,x=M.closePath||!1,k=M.invertUV||!1,J=Math.floor(E[0].length/2);let u=M.offset||J;u=u>J?J:Math.floor(u);const T=0===M.sideOrientation?0:M.sideOrientation||g.d.DEFAULTSIDE,V=M.Aa,I=M.za,t=[],y=[],B=[],r=[],c=[],C=[],R=[],w=[];let S;const X=[],U=[];let v,N,K;if(E.length<2){const M=[],b=[];for(N=0;N<E[0].length-u;N++)M.push(E[0][N]),b.push(E[0][N+u]);E=[M,b]}let h=0;const Z=x?1:0,O=b?1:0;let p,P,F,l,d,W;for(S=E[0].length,v=0;v<E.length+O;v++){for(R[v]=0,c[v]=[0],p=v===E.length?E[0]:E[v],P=p.length,S=S<P?S:P,K=0;K<P;)t.push(p[K].x,p[K].y,p[K].z),K>0&&(F=p[K].Qc(p[K-1]).length(),l=F+R[v],c[v].push(l),R[v]=l),K++;x&&(K--,t.push(p[0].x,p[0].y,p[0].z),F=p[K].Qc(p[0]).length(),l=F+R[v],c[v].push(l),R[v]=l),X[v]=P+Z,U[v]=h,h+=P+Z}let m,o,j=null,s=null;for(N=0;N<S+Z;N++)for(w[N]=0,C[N]=[0],v=0;v<E.length-1+O;v++)d=E[v],W=v===E.length-1?E[0]:E[v+1],N===S?(j=d[0],s=W[0]):(j=d[N],s=W[N]),F=s.Qc(j).length(),l=F+w[N],C[N].push(l),w[N]=l;if(V)for(v=0;v<V.length;v++)r.push(V[v].x,n.c?1-V[v].y:V[v].y);else for(v=0;v<E.length+O;v++)for(N=0;N<S+Z;N++)m=0!=R[v]?c[v][N]/R[v]:0,o=0!=w[N]?C[N][v]/w[N]:0,k?r.push(o,m):r.push(m,n.c?1-o:o);v=0;let q=0,D=X[v]-1,z=X[v+1]-1,A=D<z?D:z,Y=U[1]-U[0];const i=X.length-1;for(;q<=A&&v<i;)y.push(q,q+Y,q+1),y.push(q+Y+1,q+1,q+Y),q+=1,q===A&&(v++,Y=U[v+1]-U[v],D=X[v]-1,z=X[v+1]-1,q=U[v],A=D<z?D+q:z+q);if(g.d.ComputeNormals(t,y,B),x){let M=0,b=0;for(v=0;v<E.length;v++){M=3*U[v],b=v+1<E.length?3*(U[v+1]-1):B.length-3,B[M]=.5*(B[M]+B[b]),B[M+1]=.5*(B[M+1]+B[b+1]),B[M+2]=.5*(B[M+2]+B[b+2]);const x=Math.sqrt(B[M]*B[M]+B[M+1]*B[M+1]+B[M+2]*B[M+2]);B[M]/=x,B[M+1]/=x,B[M+2]/=x,B[b]=B[M],B[b+1]=B[M+1],B[b+2]=B[M+2]}}if(b){let M=3*U[0],b=3*U[E.length];for(N=0;N<S+Z;N++){B[M]=.5*(B[M]+B[b]),B[M+1]=.5*(B[M+1]+B[b+1]),B[M+2]=.5*(B[M+2]+B[b+2]);const E=Math.sqrt(B[M]*B[M]+B[M+1]*B[M+1]+B[M+2]*B[M+2]);B[M]/=E,B[M+1]/=E,B[M+2]/=E,B[b]=B[M],B[b+1]=B[M+1],B[b+2]=B[M+2],M+=3,b+=3}}g.d._ComputeSides(T,t,y,B,r,M.frontUVs,M.backUVs);let G=null;if(I){G=new Float32Array(4*I.length);for(let M=0;M<I.length;M++)G[4*M]=I[M].r,G[4*M+1]=I[M].g,G[4*M+2]=I[M].b,G[4*M+3]=I[M].a}const H=new g.d,e=new Float32Array(t),Q=new Float32Array(B),L=new Float32Array(r);return H.indices=y,H.xa=e,H.ya=Q,H.Aa=L,G&&H.set(G,a.g.ColorKind),x&&(H._idx=U),H}function u(M,E){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const u=E.pathArray,T=E.closeArray,V=E.closePath,I=k.e._GetDefaultSideOrientation(E.sideOrientation),t=E.instance,y=E.updatable;if(t){const M=x.i.Fd[0].Kd(Number.MAX_VALUE),b=x.i.Fd[1].Kd(-Number.MAX_VALUE),J=E=>{let x=u[0].length;const a=t;let g=0;const n=a._originalBuilderSideOrientation===k.e.DOUBLESIDE?2:1;for(let k=1;k<=n;++k)for(let n=0;n<u.length;++n){const k=u[n],J=k.length;x=x<J?x:J;for(let a=0;a<x;++a){const x=k[a];E[g]=x.x,E[g+1]=x.y,E[g+2]=x.z,M.minimizeInPlaceFromFloats(x.x,x.y,x.z),b.maximizeInPlaceFromFloats(x.x,x.y,x.z),g+=3}if(a._creationDataStorage&&a._creationDataStorage.closePath){const M=k[0];E[g]=M.x,E[g+1]=M.y,E[g+2]=M.z,g+=3}}},T=t.getVerticesData(a.g.PositionKind);if(J(T),t.hasBoundingInfo?t.getBoundingInfo().reConstruct(M,b,t._worldMatrix):t.buildBoundingInfo(M,b,t._worldMatrix),t.updateVerticesData(a.g.PositionKind,T,!1,!1),E.za){const M=t.getVerticesData(a.g.ColorKind);for(let b=0,x=0;b<E.za.length;b++,x+=4){const k=E.za[b];M[x]=k.r,M[x+1]=k.g,M[x+2]=k.b,M[x+3]=k.a}t.updateVerticesData(a.g.ColorKind,M,!1,!1)}if(E.Aa){const M=t.getVerticesData(a.g.UVKind);for(let b=0;b<E.Aa.length;b++)M[2*b]=E.Aa[b].x,M[2*b+1]=n.c?1-E.Aa[b].y:E.Aa[b].y;t.updateVerticesData(a.g.UVKind,M,!1,!1)}if(!t.areNormalsFrozen||t.isFacetDataEnabled){const M=t.Ed(),E=t.getVerticesData(a.g.NormalKind),b=t.isFacetDataEnabled?t.getFacetDataParameters():null;if(g.d.ComputeNormals(T,M,E,b),t._creationDataStorage&&t._creationDataStorage.closePath){let M=0,b=0;for(let x=0;x<u.length;x++)M=3*t._creationDataStorage.idx[x],b=x+1<u.length?3*(t._creationDataStorage.idx[x+1]-1):E.length-3,E[M]=.5*(E[M]+E[b]),E[M+1]=.5*(E[M+1]+E[b+1]),E[M+2]=.5*(E[M+2]+E[b+2]),E[b]=E[M],E[b+1]=E[M+1],E[b+2]=E[M+2]}t.areNormalsFrozen||t.updateVerticesData(a.g.NormalKind,E,!1,!1)}return t}{const x=new k.e(M,b);x._originalBuilderSideOrientation=I,x._creationDataStorage=new k.f;const a=J(E);return V&&(x._creationDataStorage.idx=a._idx),x._creationDataStorage.closePath=V,x._creationDataStorage.closeArray=T,a.Ca(x,y),x}}g.d.CreateRibbon=J,k.e.CreateRibbon=function(M,E){return u(M,{pathArray:E,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var T=b(11719),V=b(11585),I=b(1133);function t(M){const E=M.pattern||k.e.NO_FLIP,b=M.tileWidth||M.tileSize||1,x=M.tileHeight||M.tileSize||1,a=M.alignHorizontal||0,n=M.alignVertical||0,J=M.width||M.size||1,u=Math.floor(J/b);let T=J-u*b;const V=M.height||M.size||1,I=Math.floor(V/x);let t=V-I*x;const y=b*u/2,B=x*I/2;let r=0,c=0,C=0,R=0,w=0,S=0;if(T>0||t>0){switch(C=-y,R=-B,w=y,S=B,a){case k.e.CENTER:T/=2,C-=T,w+=T;break;case k.e.LEFT:w+=T,r=-T/2;break;case k.e.RIGHT:C-=T,r=T/2}switch(n){case k.e.CENTER:t/=2,R-=t,S+=t;break;case k.e.BOTTOM:S+=t,c=-t/2;break;case k.e.TOP:R-=t,c=t/2}}const X=[],U=[],v=[];v[0]=[0,0,1,0,1,1,0,1],v[1]=[0,0,1,0,1,1,0,1],E!==k.e.ROTATE_TILE&&E!==k.e.ROTATE_ROW||(v[1]=[1,1,0,1,0,0,1,0]),E!==k.e.FLIP_TILE&&E!==k.e.FLIP_ROW||(v[1]=[1,0,0,0,0,1,1,1]),E!==k.e.FLIP_N_ROTATE_TILE&&E!==k.e.FLIP_N_ROTATE_ROW||(v[1]=[0,1,1,1,1,0,0,0]);let N=[];const K=[],h=[];let Z=0;for(let g=0;g<I;g++)for(let M=0;M<u;M++)X.push(M*b-y+r,g*x-B+c,0),X.push((M+1)*b-y+r,g*x-B+c,0),X.push((M+1)*b-y+r,(g+1)*x-B+c,0),X.push(M*b-y+r,(g+1)*x-B+c,0),h.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),N=E===k.e.FLIP_TILE||E===k.e.ROTATE_TILE||E===k.e.FLIP_N_ROTATE_TILE?N.concat(v[(M%2+g%2)%2]):E===k.e.FLIP_ROW||E===k.e.ROTATE_ROW||E===k.e.FLIP_N_ROTATE_ROW?N.concat(v[g%2]):N.concat(v[0]),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),U.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),Z+=4;if(T>0||t>0){const M=t>0&&(n===k.e.CENTER||n===k.e.TOP),g=t>0&&(n===k.e.CENTER||n===k.e.BOTTOM),J=T>0&&(a===k.e.CENTER||a===k.e.RIGHT),V=T>0&&(a===k.e.CENTER||a===k.e.LEFT);let v,O,p,P,F=[];if(M&&J&&(X.push(C+r,R+c,0),X.push(-y+r,R+c,0),X.push(-y+r,R+t+c,0),X.push(C+r,R+t+c,0),h.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),Z+=4,v=1-T/b,O=1-t/x,p=1,P=1,F=[v,O,p,O,p,P,v,P],E===k.e.ROTATE_ROW&&(F=[1-v,1-O,1-p,1-O,1-p,1-P,1-v,1-P]),E===k.e.FLIP_ROW&&(F=[1-v,O,1-p,O,1-p,P,1-v,P]),E===k.e.FLIP_N_ROTATE_ROW&&(F=[v,1-O,p,1-O,p,1-P,v,1-P]),N=N.concat(F),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),U.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),M&&V&&(X.push(y+r,R+c,0),X.push(w+r,R+c,0),X.push(w+r,R+t+c,0),X.push(y+r,R+t+c,0),h.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),Z+=4,v=0,O=1-t/x,p=T/b,P=1,F=[v,O,p,O,p,P,v,P],(E===k.e.ROTATE_ROW||E===k.e.ROTATE_TILE&&u%2===0)&&(F=[1-v,1-O,1-p,1-O,1-p,1-P,1-v,1-P]),(E===k.e.FLIP_ROW||E===k.e.FLIP_TILE&&u%2===0)&&(F=[1-v,O,1-p,O,1-p,P,1-v,P]),(E===k.e.FLIP_N_ROTATE_ROW||E===k.e.FLIP_N_ROTATE_TILE&&u%2===0)&&(F=[v,1-O,p,1-O,p,1-P,v,1-P]),N=N.concat(F),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),U.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),g&&J&&(X.push(C+r,B+c,0),X.push(-y+r,B+c,0),X.push(-y+r,S+c,0),X.push(C+r,S+c,0),h.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),Z+=4,v=1-T/b,O=0,p=1,P=t/x,F=[v,O,p,O,p,P,v,P],(E===k.e.ROTATE_ROW&&I%2===1||E===k.e.ROTATE_TILE&&I%1===0)&&(F=[1-v,1-O,1-p,1-O,1-p,1-P,1-v,1-P]),(E===k.e.FLIP_ROW&&I%2===1||E===k.e.FLIP_TILE&&I%2===0)&&(F=[1-v,O,1-p,O,1-p,P,1-v,P]),(E===k.e.FLIP_N_ROTATE_ROW&&I%2===1||E===k.e.FLIP_N_ROTATE_TILE&&I%2===0)&&(F=[v,1-O,p,1-O,p,1-P,v,1-P]),N=N.concat(F),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),U.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),g&&V&&(X.push(y+r,B+c,0),X.push(w+r,B+c,0),X.push(w+r,S+c,0),X.push(y+r,S+c,0),h.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),Z+=4,v=0,O=0,p=T/b,P=t/x,F=[v,O,p,O,p,P,v,P],(E===k.e.ROTATE_ROW&&I%2===1||E===k.e.ROTATE_TILE&&(I+u)%2===1)&&(F=[1-v,1-O,1-p,1-O,1-p,1-P,1-v,1-P]),(E===k.e.FLIP_ROW&&I%2===1||E===k.e.FLIP_TILE&&(I+u)%2===1)&&(F=[1-v,O,1-p,O,1-p,P,1-v,P]),(E===k.e.FLIP_N_ROTATE_ROW&&I%2===1||E===k.e.FLIP_N_ROTATE_TILE&&(I+u)%2===1)&&(F=[v,1-O,p,1-O,p,1-P,v,1-P]),N=N.concat(F),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),U.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),M){const M=[];v=0,O=1-t/x,p=1,P=1,M[0]=[v,O,p,O,p,P,v,P],M[1]=[v,O,p,O,p,P,v,P],E!==k.e.ROTATE_TILE&&E!==k.e.ROTATE_ROW||(M[1]=[1-v,1-O,1-p,1-O,1-p,1-P,1-v,1-P]),E!==k.e.FLIP_TILE&&E!==k.e.FLIP_ROW||(M[1]=[1-v,O,1-p,O,1-p,P,1-v,P]),E!==k.e.FLIP_N_ROTATE_TILE&&E!==k.e.FLIP_N_ROTATE_ROW||(M[1]=[v,1-O,p,1-O,p,1-P,v,1-P]);for(let x=0;x<u;x++)X.push(x*b-y+r,R+c,0),X.push((x+1)*b-y+r,R+c,0),X.push((x+1)*b-y+r,R+t+c,0),X.push(x*b-y+r,R+t+c,0),h.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),Z+=4,N=E===k.e.FLIP_TILE||E===k.e.ROTATE_TILE||E===k.e.FLIP_N_ROTATE_TILE?N.concat(M[(x+1)%2]):E===k.e.FLIP_ROW||E===k.e.ROTATE_ROW||E===k.e.FLIP_N_ROTATE_ROW?N.concat(M[1]):N.concat(M[0]),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),U.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(g){const M=[];v=0,O=0,p=1,P=t/x,M[0]=[v,O,p,O,p,P,v,P],M[1]=[v,O,p,O,p,P,v,P],E!==k.e.ROTATE_TILE&&E!==k.e.ROTATE_ROW||(M[1]=[1-v,1-O,1-p,1-O,1-p,1-P,1-v,1-P]),E!==k.e.FLIP_TILE&&E!==k.e.FLIP_ROW||(M[1]=[1-v,O,1-p,O,1-p,P,1-v,P]),E!==k.e.FLIP_N_ROTATE_TILE&&E!==k.e.FLIP_N_ROTATE_ROW||(M[1]=[v,1-O,p,1-O,p,1-P,v,1-P]);for(let x=0;x<u;x++)X.push(x*b-y+r,S-t+c,0),X.push((x+1)*b-y+r,S-t+c,0),X.push((x+1)*b-y+r,S+c,0),X.push(x*b-y+r,S+c,0),h.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),Z+=4,N=E===k.e.FLIP_TILE||E===k.e.ROTATE_TILE||E===k.e.FLIP_N_ROTATE_TILE?N.concat(M[(x+I)%2]):E===k.e.FLIP_ROW||E===k.e.ROTATE_ROW||E===k.e.FLIP_N_ROTATE_ROW?N.concat(M[I%2]):N.concat(M[0]),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),U.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(J){const M=[];v=1-T/b,O=0,p=1,P=1,M[0]=[v,O,p,O,p,P,v,P],M[1]=[v,O,p,O,p,P,v,P],E!==k.e.ROTATE_TILE&&E!==k.e.ROTATE_ROW||(M[1]=[1-v,1-O,1-p,1-O,1-p,1-P,1-v,1-P]),E!==k.e.FLIP_TILE&&E!==k.e.FLIP_ROW||(M[1]=[1-v,O,1-p,O,1-p,P,1-v,P]),E!==k.e.FLIP_N_ROTATE_TILE&&E!==k.e.FLIP_N_ROTATE_ROW||(M[1]=[v,1-O,p,1-O,p,1-P,v,1-P]);for(let b=0;b<I;b++)X.push(C+r,b*x-B+c,0),X.push(C+T+r,b*x-B+c,0),X.push(C+T+r,(b+1)*x-B+c,0),X.push(C+r,(b+1)*x-B+c,0),h.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),Z+=4,N=E===k.e.FLIP_TILE||E===k.e.ROTATE_TILE||E===k.e.FLIP_N_ROTATE_TILE?N.concat(M[(b+1)%2]):E===k.e.FLIP_ROW||E===k.e.ROTATE_ROW||E===k.e.FLIP_N_ROTATE_ROW?N.concat(M[b%2]):N.concat(M[0]),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),U.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(V){const M=[];v=0,O=0,p=T/x,P=1,M[0]=[v,O,p,O,p,P,v,P],M[1]=[v,O,p,O,p,P,v,P],E!==k.e.ROTATE_TILE&&E!==k.e.ROTATE_ROW||(M[1]=[1-v,1-O,1-p,1-O,1-p,1-P,1-v,1-P]),E!==k.e.FLIP_TILE&&E!==k.e.FLIP_ROW||(M[1]=[1-v,O,1-p,O,1-p,P,1-v,P]),E!==k.e.FLIP_N_ROTATE_TILE&&E!==k.e.FLIP_N_ROTATE_ROW||(M[1]=[v,1-O,p,1-O,p,1-P,v,1-P]);for(let b=0;b<I;b++)X.push(w-T+r,b*x-B+c,0),X.push(w+r,b*x-B+c,0),X.push(w+r,(b+1)*x-B+c,0),X.push(w-T+r,(b+1)*x-B+c,0),h.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),Z+=4,N=E===k.e.FLIP_TILE||E===k.e.ROTATE_TILE||E===k.e.FLIP_N_ROTATE_TILE?N.concat(M[(b+u)%2]):E===k.e.FLIP_ROW||E===k.e.ROTATE_ROW||E===k.e.FLIP_N_ROTATE_ROW?N.concat(M[b%2]):N.concat(M[0]),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),U.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const O=0===M.sideOrientation?0:M.sideOrientation||g.d.DEFAULTSIDE;g.d._ComputeSides(O,X,h,U,N,M.frontUVs,M.backUVs);const p=new g.d;p.indices=h,p.xa=X,p.ya=U,p.Aa=N;const P=O===g.d.DOUBLESIDE?K.concat(K):K;return p.za=P,p}function y(M,E){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const x=new k.e(M,b);E.sideOrientation=k.e._GetDefaultSideOrientation(E.sideOrientation),x._originalBuilderSideOrientation=E.sideOrientation;return t(E).Ca(x,E.updatable),x}function B(M){const E=M.faceUV||new Array(6),b=M.faceColors,a=M.pattern||k.e.NO_FLIP,J=M.width||M.size||1,u=M.height||M.size||1,T=M.depth||M.size||1,V=M.tileWidth||M.tileSize||1,y=M.tileHeight||M.tileSize||1,B=M.alignHorizontal||0,r=M.alignVertical||0,c=0===M.sideOrientation?0:M.sideOrientation||g.d.DEFAULTSIDE;for(let k=0;k<6;k++)void 0===E[k]&&(E[k]=new x.o(0,0,1,1)),b&&void 0===b[k]&&(b[k]=new I.h(1,1,1,1));const C=J/2,R=u/2,w=T/2,S=[];for(let x=0;x<2;x++)S[x]=t({pattern:a,tileWidth:V,tileHeight:y,width:J,height:u,alignVertical:r,alignHorizontal:B,sideOrientation:c});for(let x=2;x<4;x++)S[x]=t({pattern:a,tileWidth:V,tileHeight:y,width:T,height:u,alignVertical:r,alignHorizontal:B,sideOrientation:c});let X=r;r===k.e.BOTTOM?X=k.e.TOP:r===k.e.TOP&&(X=k.e.BOTTOM);for(let x=4;x<6;x++)S[x]=t({pattern:a,tileWidth:V,tileHeight:y,width:J,height:T,alignVertical:X,alignHorizontal:B,sideOrientation:c});let U=[],v=[],N=[],K=[];const h=[],Z=[],O=[],p=[];let P=0,F=0;for(let k=0;k<6;k++){const M=S[k].xa.length;Z[k]=[],O[k]=[];for(let E=0;E<M/3;E++)Z[k].push(new x.m(S[k].xa[3*E],S[k].xa[3*E+1],S[k].xa[3*E+2])),O[k].push(new x.m(S[k].ya[3*E],S[k].ya[3*E+1],S[k].ya[3*E+2]));P=S[k].Aa.length,p[k]=[];for(let b=0;b<P;b+=2)p[k][b]=E[k].x+(E[k].z-E[k].x)*S[k].Aa[b],p[k][b+1]=E[k].y+(E[k].w-E[k].y)*S[k].Aa[b+1],n.c&&(p[k][b+1]=1-p[k][b+1]);if(N=N.concat(p[k]),K=K.concat(S[k].indices.map((M=>M+F))),F+=Z[k].length,b)for(let E=0;E<4;E++)h.push(b[k].r,b[k].g,b[k].b,b[k].a)}const l=new x.m(0,0,w),d=x.d.RotationY(Math.PI);U=Z[0].map((M=>x.m.TransformNormal(M,d).add(l))).map((M=>[M.x,M.y,M.z])).reduce(((M,E)=>M.concat(E)),[]),v=O[0].map((M=>x.m.TransformNormal(M,d))).map((M=>[M.x,M.y,M.z])).reduce(((M,E)=>M.concat(E)),[]),U=U.concat(Z[1].map((M=>M.Qc(l))).map((M=>[M.x,M.y,M.z])).reduce(((M,E)=>M.concat(E)),[])),v=v.concat(O[1].map((M=>[M.x,M.y,M.z])).reduce(((M,E)=>M.concat(E)),[]));const W=new x.m(C,0,0),m=x.d.RotationY(-Math.PI/2);U=U.concat(Z[2].map((M=>x.m.TransformNormal(M,m).add(W))).map((M=>[M.x,M.y,M.z])).reduce(((M,E)=>M.concat(E)),[])),v=v.concat(O[2].map((M=>x.m.TransformNormal(M,m))).map((M=>[M.x,M.y,M.z])).reduce(((M,E)=>M.concat(E)),[]));const o=x.d.RotationY(Math.PI/2);U=U.concat(Z[3].map((M=>x.m.TransformNormal(M,o).Qc(W))).map((M=>[M.x,M.y,M.z])).reduce(((M,E)=>M.concat(E)),[])),v=v.concat(O[3].map((M=>x.m.TransformNormal(M,o))).map((M=>[M.x,M.y,M.z])).reduce(((M,E)=>M.concat(E)),[]));const j=new x.m(0,R,0),s=x.d.RotationX(Math.PI/2);U=U.concat(Z[4].map((M=>x.m.TransformNormal(M,s).add(j))).map((M=>[M.x,M.y,M.z])).reduce(((M,E)=>M.concat(E)),[])),v=v.concat(O[4].map((M=>x.m.TransformNormal(M,s))).map((M=>[M.x,M.y,M.z])).reduce(((M,E)=>M.concat(E)),[]));const q=x.d.RotationX(-Math.PI/2);U=U.concat(Z[5].map((M=>x.m.TransformNormal(M,q).Qc(j))).map((M=>[M.x,M.y,M.z])).reduce(((M,E)=>M.concat(E)),[])),v=v.concat(O[5].map((M=>x.m.TransformNormal(M,q))).map((M=>[M.x,M.y,M.z])).reduce(((M,E)=>M.concat(E)),[])),g.d._ComputeSides(c,U,K,v,N);const D=new g.d;if(D.indices=K,D.xa=U,D.ya=v,D.Aa=N,b){const M=c===g.d.DOUBLESIDE?h.concat(h):h;D.za=M}return D}function r(M,E){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const x=new k.e(M,b);E.sideOrientation=k.e._GetDefaultSideOrientation(E.sideOrientation),x._originalBuilderSideOrientation=E.sideOrientation;return B(E).Ca(x,E.updatable),x}g.d.CreateTiledPlane=t;g.d.CreateTiledBox=B;var c=b(11709),C=b(1171),R=b(1512);function w(M){const E=M.height||2;let b=0===M.diameterTop?0:M.diameterTop||M.diameter||1,a=0===M.diameterBottom?0:M.diameterBottom||M.diameter||1;b=b||1e-5,a=a||1e-5;const J=0|(M.Qk||24),u=0|(M.subdivisions||1),T=!!M.hasRings,V=!!M.enclose,t=0===M.cap?0:M.cap||k.e.CAP_ALL,y=M.arc&&(M.arc<=0||M.arc>1)?1:M.arc||1,B=0===M.sideOrientation?0:M.sideOrientation||g.d.DEFAULTSIDE,r=M.faceUV||new Array(3),c=M.faceColors,C=2+(1+(1!==y&&V?2:0))*(T?u:1);let w;for(w=0;w<C;w++)c&&void 0===c[w]&&(c[w]=new I.h(1,1,1,1));for(w=0;w<C;w++)r&&void 0===r[w]&&(r[w]=new x.o(0,0,1,1));const S=[],X=[],U=[],v=[],N=[],K=2*Math.PI*y/J;let h,Z,O;const p=(a-b)/2/E,P=x.m.Zero(),F=x.m.Zero(),l=x.m.Zero(),d=x.m.Zero(),W=x.m.Zero(),m=R.d.Y;let o,j,s,q=1,D=1,z=0,A=0;for(o=0;o<=u;o++)for(Z=o/u,O=(Z*(b-a)+a)/2,q=T&&0!==o&&o!==u?2:1,s=0;s<q;s++){for(T&&(D+=s),V&&(D+=2*s),j=0;j<=J;j++)h=j*K,P.x=Math.cos(-h)*O,P.y=-E/2+Z*E,P.z=Math.sin(-h)*O,0===b&&o===u?(F.x=U[U.length-3*(J+1)],F.y=U[U.length-3*(J+1)+1],F.z=U[U.length-3*(J+1)+2]):(F.x=P.x,F.z=P.z,F.y=Math.sqrt(F.x*F.x+F.z*F.z)*p,F.normalize()),0===j&&(l.p(P),d.p(F)),X.push(P.x,P.y,P.z),U.push(F.x,F.y,F.z),A=T?z!==D?r[D].y:r[D].w:r[D].y+(r[D].w-r[D].y)*Z,v.push(r[D].x+(r[D].z-r[D].x)*j/J,n.c?1-A:A),c&&N.push(c[D].r,c[D].g,c[D].b,c[D].a);1!==y&&V&&(X.push(P.x,P.y,P.z),X.push(0,P.y,0),X.push(0,P.y,0),X.push(l.x,l.y,l.z),x.m.CrossToRef(m,F,W),W.normalize(),U.push(W.x,W.y,W.z,W.x,W.y,W.z),x.m.CrossToRef(d,m,W),W.normalize(),U.push(W.x,W.y,W.z,W.x,W.y,W.z),A=T?z!==D?r[D+1].y:r[D+1].w:r[D+1].y+(r[D+1].w-r[D+1].y)*Z,v.push(r[D+1].x,n.c?1-A:A),v.push(r[D+1].z,n.c?1-A:A),A=T?z!==D?r[D+2].y:r[D+2].w:r[D+2].y+(r[D+2].w-r[D+2].y)*Z,v.push(r[D+2].x,n.c?1-A:A),v.push(r[D+2].z,n.c?1-A:A),c&&(N.push(c[D+1].r,c[D+1].g,c[D+1].b,c[D+1].a),N.push(c[D+1].r,c[D+1].g,c[D+1].b,c[D+1].a),N.push(c[D+2].r,c[D+2].g,c[D+2].b,c[D+2].a),N.push(c[D+2].r,c[D+2].g,c[D+2].b,c[D+2].a))),z!==D&&(z=D)}const Y=1!==y&&V?J+4:J;for(o=0,D=0;D<u;D++){let M=0,E=0,b=0,x=0;for(j=0;j<J;j++)M=o*(Y+1)+j,E=(o+1)*(Y+1)+j,b=o*(Y+1)+(j+1),x=(o+1)*(Y+1)+(j+1),S.push(M,E,b),S.push(x,b,E);1!==y&&V&&(S.push(M+2,E+2,b+2),S.push(x+2,b+2,E+2),S.push(M+4,E+4,b+4),S.push(x+4,b+4,E+4)),o=T?o+2:o+1}const i=M=>{const k=M?b/2:a/2;if(0===k)return;let g,u,T;const V=M?r[C-1]:r[0];let I=null;c&&(I=M?c[C-1]:c[0]);const t=X.length/3,B=M?E/2:-E/2,R=new x.m(0,B,0);X.push(R.x,R.y,R.z),U.push(0,M?1:-1,0);const w=V.y+.5*(V.w-V.y);v.push(V.x+.5*(V.z-V.x),n.c?1-w:w),I&&N.push(I.r,I.g,I.b,I.a);const K=new x.l(.5,.5);for(T=0;T<=J;T++){g=2*Math.PI*T*y/J;const E=Math.cos(-g),b=Math.sin(-g);u=new x.m(E*k,B,b*k);const a=new x.l(E*K.x+.5,b*K.y+.5);X.push(u.x,u.y,u.z),U.push(0,M?1:-1,0);const t=V.y+(V.w-V.y)*a.y;v.push(V.x+(V.z-V.x)*a.x,n.c?1-t:t),I&&N.push(I.r,I.g,I.b,I.a)}for(T=0;T<J;T++)M?(S.push(t),S.push(t+(T+2)),S.push(t+(T+1))):(S.push(t),S.push(t+(T+1)),S.push(t+(T+2)))};t!==k.e.CAP_START&&t!==k.e.CAP_ALL||i(!1),t!==k.e.CAP_END&&t!==k.e.CAP_ALL||i(!0),g.d._ComputeSides(B,X,S,U,v,M.frontUVs,M.backUVs);const G=new g.d;return G.indices=S,G.xa=X,G.ya=U,G.Aa=v,c&&(G.za=N),G}function S(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2?arguments[2]:void 0;const x=new k.e(M,b);E.sideOrientation=k.e._GetDefaultSideOrientation(E.sideOrientation),x._originalBuilderSideOrientation=E.sideOrientation;return w(E).Ca(x,E.updatable),x}function X(M){const E=[],b=[],k=[],a=[],J=M.diameter||1,u=M.thickness||.5,T=0|(M.Qk||16),V=0===M.sideOrientation?0:M.sideOrientation||g.d.DEFAULTSIDE,I=T+1;for(let g=0;g<=T;g++){const M=g/T,V=g*Math.PI*2/T-Math.PI/2,t=x.d.Translation(J/2,0,0).multiply(x.d.RotationY(V));for(let J=0;J<=T;J++){const V=1-J/T,y=J*Math.PI*2/T+Math.PI,B=Math.cos(y),r=Math.sin(y);let c=new x.m(B,r,0),C=c.scale(u/2);const R=new x.l(M,V);C=x.m.TransformCoordinates(C,t),c=x.m.TransformNormal(c,t),b.push(C.x,C.y,C.z),k.push(c.x,c.y,c.z),a.push(R.x,n.c?1-R.y:R.y);const w=(g+1)%I,S=(J+1)%I;E.push(g*I+J),E.push(g*I+S),E.push(w*I+J),E.push(g*I+S),E.push(w*I+S),E.push(w*I+J)}}g.d._ComputeSides(V,b,E,k,a,M.frontUVs,M.backUVs);const t=new g.d;return t.indices=E,t.xa=b,t.ya=k,t.Aa=a,t}function U(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2?arguments[2]:void 0;const x=new k.e(M,b);E.sideOrientation=k.e._GetDefaultSideOrientation(E.sideOrientation),x._originalBuilderSideOrientation=E.sideOrientation;return X(E).Ca(x,E.updatable),x}g.d.CreateCylinder=w,k.e.CreateCylinder=(M,E,b,x,a,g,n,J,u)=>{void 0!==n&&n instanceof C.d||(void 0!==n&&(u=J||k.e.DEFAULTSIDE,J=n),n=g,g=1);return S(M,{height:E,diameterTop:b,diameterBottom:x,Qk:a,subdivisions:g,sideOrientation:u,updatable:J},n)};function v(M){const E=[],b=[],k=[],a=[],J=M.i||2,u=M.tube||.5,T=M.radialSegments||32,V=M.tubularSegments||32,I=M.p||2,t=M.q||3,y=0===M.sideOrientation?0:M.sideOrientation||g.d.DEFAULTSIDE,B=M=>{const E=Math.cos(M),b=Math.sin(M),k=t/I*M,a=Math.cos(k),g=J*(2+a)*.5*E,n=J*(2+a)*b*.5,u=J*Math.sin(k)*.5;return new x.m(g,n,u)};let r,c;for(r=0;r<=T;r++){const M=r%T/T*2*I*Math.PI,E=B(M),k=B(M+.01),g=k.Qc(E);let J=k.add(E);const t=x.m.Cross(g,J);for(J=x.m.Cross(t,g),t.normalize(),J.normalize(),c=0;c<V;c++){const M=c%V/V*2*Math.PI,x=-u*Math.cos(M),k=u*Math.sin(M);b.push(E.x+x*J.x+k*t.x),b.push(E.y+x*J.y+k*t.y),b.push(E.z+x*J.z+k*t.z),a.push(r/T),a.push(n.c?1-c/V:c/V)}}for(r=0;r<T;r++)for(c=0;c<V;c++){const M=(c+1)%V,b=r*V+c,x=(r+1)*V+c,k=(r+1)*V+M,a=r*V+M;E.push(a),E.push(x),E.push(b),E.push(a),E.push(k),E.push(x)}g.d.ComputeNormals(b,E,k),g.d._ComputeSides(y,b,E,k,a,M.frontUVs,M.backUVs);const C=new g.d;return C.indices=E,C.xa=b,C.ya=k,C.Aa=a,C}function N(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2?arguments[2]:void 0;const x=new k.e(M,b);E.sideOrientation=k.e._GetDefaultSideOrientation(E.sideOrientation),x._originalBuilderSideOrientation=E.sideOrientation;return v(E).Ca(x,E.updatable),x}g.d.CreateTorus=X,k.e.CreateTorus=(M,E,b,x,k,a,g)=>U(M,{diameter:E,thickness:b,Qk:x,sideOrientation:g,updatable:a},k);g.d.CreateTorusKnot=v,k.e.CreateTorusKnot=(M,E,b,x,k,a,g,n,J,u)=>N(M,{i:E,tube:b,radialSegments:x,tubularSegments:k,p:a,q:g,sideOrientation:u,updatable:J},n);var K=b(12525),h=b(1060),Z=b(1517),O=b(977),p=b(1005);class P extends x.l{constructor(M,E){super(M.x,M.y),this.index=E}}class F{constructor(){this.elements=[]}add(M){const E=[];return M.forEach((M=>{const b=new P(M,this.elements.length);E.push(b),this.elements.push(b)})),E}computeBounds(){const M=new x.l(this.elements[0].x,this.elements[0].y),E=new x.l(this.elements[0].x,this.elements[0].y);return this.elements.forEach((b=>{b.x<M.x?M.x=b.x:b.x>E.x&&(E.x=b.x),b.y<M.y?M.y=b.y:b.y>E.y&&(E.y=b.y)})),{min:M,max:E,width:E.x-M.x,height:E.y-M.y}}}class l{_addToepoint(M){for(const E of M)this._epoints.push(E.x,E.y)}constructor(M,E,b){let x,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;this._points=new F,this._outlinepoints=new F,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=k,this._name=M,this._scene=b||p.b.LastCreatedScene,x=E instanceof Z.i?E.getPoints():E,this._addToepoint(x),this._points.add(x),this._outlinepoints.add(x),"undefined"===typeof this.bjsEarcut&&h.d.Warn("Earcut was not found, the polygon will not be built.")}addHole(M){this._points.add(M);const E=new F;return E.add(M),this._holes.push(E),this._eholes.push(this._epoints.length/2),this._addToepoint(M),this}build(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0],E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const x=new k.e(this._name,this._scene),g=this.buildVertexData(E,b);return x.Ga(a.g.PositionKind,g.xa,M),x.Ga(a.g.NormalKind,g.ya,M),x.Ga(a.g.UVKind,g.Aa,M),x.setIndices(g.indices),x}buildVertexData(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const b=new g.d,x=[],k=[],a=[],n=this._points.computeBounds();this._points.elements.forEach((M=>{x.push(0,1,0),k.push(M.x,0,M.y),a.push((M.x-n.min.x)/n.width,(M.y-n.min.y)/n.height)}));const J=[],u=this.bjsEarcut(this._epoints,this._eholes,2);for(let g=0;g<u.length;g++)J.push(u[g]);if(M>0){const b=k.length/3;this._points.elements.forEach((E=>{x.push(0,-1,0),k.push(E.x,-M,E.y),a.push(1-(E.x-n.min.x)/n.width,1-(E.y-n.min.y)/n.height)}));const g=J.length;for(let M=0;M<g;M+=3){const E=J[M+0],x=J[M+1],k=J[M+2];J.push(k+b),J.push(x+b),J.push(E+b)}this._addSide(k,x,a,J,n,this._outlinepoints,M,!1,E),this._holes.forEach((b=>{this._addSide(k,x,a,J,n,b,M,!0,E)}))}return b.indices=J,b.xa=k,b.ya=x,b.Aa=a,b}_addSide(M,E,b,k,a,g,n,J,u){let T=M.length/3,V=0;for(let I=0;I<g.elements.length;I++){const t=g.elements[I],y=g.elements[(I+1)%g.elements.length];M.push(t.x,0,t.y),M.push(t.x,-n,t.y),M.push(y.x,0,y.y),M.push(y.x,-n,y.y);const B=g.elements[(I+g.elements.length-1)%g.elements.length],r=g.elements[(I+2)%g.elements.length];let c=new x.m(-(y.y-t.y),0,y.x-t.x),C=new x.m(-(t.y-B.y),0,t.x-B.x),R=new x.m(-(r.y-y.y),0,r.x-y.x);J||(c=c.scale(-1),C=C.scale(-1),R=R.scale(-1));const w=c.normalizeToNew();let S=C.normalizeToNew(),X=R.normalizeToNew();const U=x.m.Dot(S,w);S=U>u?U<O.b-1?new x.m(t.x,0,t.y).Qc(new x.m(y.x,0,y.y)).normalize():C.add(c).normalize():w;const v=x.m.Dot(R,c);X=v>u?v<O.b-1?new x.m(y.x,0,y.y).Qc(new x.m(t.x,0,t.y)).normalize():R.add(c).normalize():w,b.push(V/a.width,0),b.push(V/a.width,1),V+=c.length(),b.push(V/a.width,0),b.push(V/a.width,1),E.push(S.x,S.y,S.z),E.push(S.x,S.y,S.z),E.push(X.x,X.y,X.z),E.push(X.x,X.y,X.z),J?(k.push(T),k.push(T+2),k.push(T+1),k.push(T+1),k.push(T+2),k.push(T+3)):(k.push(T),k.push(T+1),k.push(T+2),k.push(T+1),k.push(T+3),k.push(T+2)),T+=4}}}function d(M,E,b,k,J,u,T){const V=b||new Array(3),t=k,y=[],B=T||!1;for(let a=0;a<3;a++)void 0===V[a]&&(V[a]=new x.o(0,0,1,1)),t&&void 0===t[a]&&(t[a]=new I.h(1,1,1,1));const r=M.getVerticesData(a.g.PositionKind),c=M.getVerticesData(a.g.NormalKind),C=M.getVerticesData(a.g.UVKind),R=M.Ed(),w=r.length/9;let S=0,X=0,U=0,v=0,N=0;const K=[0];if(B)for(let x=w;x<r.length/3;x+=4)X=r[3*(x+2)]-r[3*x],U=r[3*(x+2)+2]-r[3*x+2],v=Math.sqrt(X*X+U*U),N+=v,K.push(N);let h=0,Z=0;for(let x=0;x<c.length;x+=3)Math.abs(c[x+1])<.001&&(Z=1),Math.abs(c[x+1]-1)<.001&&(Z=0),Math.abs(c[x+1]+1)<.001&&(Z=2),h=x/3,1===Z?(S=h-w,C[2*h]=S%4<1.5?B?V[Z].x+(V[Z].z-V[Z].x)*K[Math.floor(S/4)]/N:V[Z].x:B?V[Z].x+(V[Z].z-V[Z].x)*K[Math.floor(S/4)+1]/N:V[Z].z,C[2*h+1]=S%2===0?n.c?1-V[Z].w:V[Z].w:n.c?1-V[Z].y:V[Z].y):(C[2*h]=(1-C[2*h])*V[Z].x+C[2*h]*V[Z].z,C[2*h+1]=(1-C[2*h+1])*V[Z].y+C[2*h+1]*V[Z].w,n.c&&(C[2*h+1]=1-C[2*h+1])),t&&y.push(t[Z].r,t[Z].g,t[Z].b,t[Z].a);g.d._ComputeSides(E,r,R,c,C,J,u);const O=new g.d;if(O.indices=R,O.xa=r,O.ya=c,O.Aa=C,t){const M=E===g.d.DOUBLESIDE?y.concat(y):y;O.za=M}return O}function W(M,E){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;E.sideOrientation=k.e._GetDefaultSideOrientation(E.sideOrientation);const g=E.shape,n=E.holes||[],J=E.depth||0,u=E.smoothingThreshold||2,T=[];let V=[];for(let k=0;k<g.length;k++)T[k]=new x.l(g[k].x,g[k].z);T[0].equalsWithEpsilon(T[T.length-1],1e-8)&&T.pop();const I=new l(M,T,b||p.b.LastCreatedScene,a);for(let k=0;k<n.length;k++){V=[];for(let M=0;M<n[k].length;M++)V.push(new x.l(n[k][M].x,n[k][M].z));I.addHole(V)}const t=I.build(!1,J,u);t._originalBuilderSideOrientation=E.sideOrientation;return d(t,E.sideOrientation,E.faceUV,E.faceColors,E.frontUVs,E.backUVs,E.wrap).Ca(t,E.updatable),t}function m(M,E){return W(M,E,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut)}function o(M,E){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const x=E.path,a=E.shape,g=E.scale||1,n=E.rotation||0,J=0===E.cap?0:E.cap||k.e.NO_CAP,u=E.updatable,T=k.e._GetDefaultSideOrientation(E.sideOrientation),V=E.instance||null,I=E.invertUV||!1,t=E.closeShape||!1;return s(M,a,x,g,n,null,null,E.closePath||!1,t,J,!1,b,!!u,T,V,I,E.frontUVs||null,E.backUVs||null,E.firstNormal||null,!!E.adjustFrame)}function j(M,E){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const x=E.path,a=E.shape,g=E.scaleFunction||(()=>1),n=E.rotationFunction||(()=>0),J=E.closePath||E.ribbonCloseArray||!1,u=E.closeShape||E.ribbonClosePath||!1,T=0===E.cap?0:E.cap||k.e.NO_CAP,V=E.updatable,I=E.firstNormal||null,t=E.adjustFrame||!1;return s(M,a,x,null,null,g,n,J,u,T,!0,b,!!V,k.e._GetDefaultSideOrientation(E.sideOrientation),E.instance||null,E.invertUV||!1,E.frontUVs||null,E.backUVs||null,I,t)}function s(M,E,b,a,g,n,J,T,V,I,t,y,B,r,c,C,R,w,S,X){const U=(M,E,b,a,g,n,J,u,T,V,I)=>{const t=b.getTangents(),y=b.getNormals(),B=b.getBinormals(),r=b.getDistances();if(I)for(let k=0;k<t.length;k++)if(0==t[k].x&&0==t[k].y&&0==t[k].z&&t[k].p(t[k-1]),0==y[k].x&&0==y[k].y&&0==y[k].z&&y[k].p(y[k-1]),0==B[k].x&&0==B[k].y&&0==B[k].z&&B[k].p(B[k-1]),k>0){let M=t[k-1];x.m.Dot(M,t[k])<0&&t[k].scaleInPlace(-1),M=y[k-1],x.m.Dot(M,y[k])<0&&y[k].scaleInPlace(-1),M=B[k-1],x.m.Dot(M,B[k])<0&&B[k].scaleInPlace(-1)}let c=0;const C=V&&u?u:()=>null!==n?n:0,R=V&&J?J:()=>null!==g?g:1;let w=T===k.e.NO_CAP||T===k.e.CAP_END?0:2;const S=x.i.Matrix[0];for(let k=0;k<E.length;k++){const b=[],g=C(k,r[k]),n=R(k,r[k]);x.d.RotationAxisToRef(t[k],c,S);for(let a=0;a<M.length;a++){const g=t[k].scale(M[a].z).add(y[k].scale(M[a].x)).add(B[k].scale(M[a].y)),J=x.m.Zero();x.m.TransformCoordinatesToRef(g,S,J),J.scaleInPlace(n).addInPlace(E[k]),b[a]=J}a[w]=b,c+=g,w++}const X=M=>{const E=Array(),b=x.m.Zero();let k;for(k=0;k<M.length;k++)b.addInPlace(M[k]);for(b.scaleInPlace(1/M.length),k=0;k<M.length;k++)E.push(b);return E};switch(T){case k.e.NO_CAP:break;case k.e.CAP_START:a[0]=X(a[2]),a[1]=a[2];break;case k.e.CAP_END:a[w]=a[w-1],a[w+1]=X(a[w-1]);break;case k.e.CAP_ALL:a[0]=X(a[2]),a[1]=a[2],a[w]=a[w-1],a[w+1]=X(a[w-1])}return a};let v,N;if(c){const M=c._creationDataStorage;return v=S?M.path3D.update(b,S):M.path3D.update(b),N=U(E,b,M.path3D,M.pathArray,a,g,n,J,M.cap,t,X),c=u("",{pathArray:N,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:c},y||void 0)}v=S?new Z.k(b,S):new Z.k(b);N=U(E,b,v,new Array,a,g,n,J,I=I<0||I>3?0:I,t,X);const K=u(M,{pathArray:N,closeArray:T,closePath:V,updatable:B,sideOrientation:r,invertUV:C,frontUVs:R||void 0,backUVs:w||void 0},y);return K._creationDataStorage.pathArray=N,K._creationDataStorage.path3D=v,K._creationDataStorage.cap=I,K}g.d.CreatePolygon=d,k.e.CreatePolygon=function(M,E,b,x,k,a){return W(M,{shape:E,holes:x,updatable:k,sideOrientation:a},b,arguments.length>6&&void 0!==arguments[6]?arguments[6]:earcut)},k.e.ExtrudePolygon=function(M,E,b,x,k,a,g){return m(M,{shape:E,holes:k,depth:b,updatable:a,sideOrientation:g},x,arguments.length>7&&void 0!==arguments[7]?arguments[7]:earcut)};function q(M,E){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const a=E.arc?E.arc<=0||E.arc>1?1:E.arc:1,g=void 0===E.closed||E.closed,n=E.shape,J=E.i||1,T=E.Qk||64,V=E.clip||0,I=E.updatable,t=k.e._GetDefaultSideOrientation(E.sideOrientation),y=E.cap||k.e.NO_CAP,B=2*Math.PI,r=[],c=E.invertUV||!1;let C=0,R=0;const w=B/T*a;let S,X;for(C=0;C<=T-V;C++){for(X=[],y!=k.e.CAP_START&&y!=k.e.CAP_ALL||(X.push(new x.m(0,n[0].y,0)),X.push(new x.m(Math.cos(C*w)*n[0].x*J,n[0].y,Math.sin(C*w)*n[0].x*J))),R=0;R<n.length;R++)S=new x.m(Math.cos(C*w)*n[R].x*J,n[R].y,Math.sin(C*w)*n[R].x*J),X.push(S);y!=k.e.CAP_END&&y!=k.e.CAP_ALL||(X.push(new x.m(Math.cos(C*w)*n[n.length-1].x*J,n[n.length-1].y,Math.sin(C*w)*n[n.length-1].x*J)),X.push(new x.m(0,n[n.length-1].y,0))),r.push(X)}return u(M,{pathArray:r,closeArray:g,sideOrientation:t,updatable:I,invertUV:c,frontUVs:E.frontUVs,backUVs:E.backUVs},b)}k.e.ExtrudeShape=function(M,E,b,x,a,g){let n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,J=arguments.length>7?arguments[7]:void 0,u=arguments.length>8?arguments[8]:void 0,T=arguments.length>9?arguments[9]:void 0;return o(M,{shape:E,path:b,scale:x,rotation:a,cap:0===g?0:g||k.e.NO_CAP,sideOrientation:u,instance:T,updatable:J},n)},k.e.ExtrudeShapeCustom=(M,E,b,x,a,g,n,J,u,T,V,I)=>j(M,{shape:E,path:b,scaleFunction:x,rotationFunction:a,ribbonCloseArray:g,ribbonClosePath:n,cap:0===J?0:J||k.e.NO_CAP,sideOrientation:V,instance:I,updatable:T},u);k.e.CreateLathe=(M,E,b,x,k,a,g)=>q(M,{shape:E,i:b,Qk:x,sideOrientation:g,updatable:a},k);var D=b(11639),z=b(11591);function A(M,E){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const a=E.path;let g=E.instance,n=1;void 0!==E.i?n=E.i:g&&(n=g._creationDataStorage.i);const J=E.Qk||64,T=E.radiusFunction||null;let V=E.cap||k.e.NO_CAP;const I=E.invertUV||!1,t=E.updatable,y=k.e._GetDefaultSideOrientation(E.sideOrientation);E.arc=E.arc&&(E.arc<=0||E.arc>1)?1:E.arc||1;const B=(M,E,b,a,g,n,J,u)=>{const T=E.getTangents(),V=E.getNormals(),I=E.getDistances(),t=2*Math.PI/g*u,y=n||(()=>a);let B,r,c,C;const R=x.i.Matrix[0];let w=J===k.e.NO_CAP||J===k.e.CAP_END?0:2;for(let k=0;k<M.length;k++){r=y(k,I[k]),B=Array(),c=V[k];for(let E=0;E<g;E++)x.d.RotationAxisToRef(T[k],t*E,R),C=B[E]?B[E]:x.m.Zero(),x.m.TransformCoordinatesToRef(c,R,C),C.scaleInPlace(r).addInPlace(M[k]),B[E]=C;b[w]=B,w++}const S=(E,b)=>{const x=Array();for(let k=0;k<E;k++)x.push(M[b]);return x};switch(J){case k.e.NO_CAP:break;case k.e.CAP_START:b[0]=S(g,0),b[1]=b[2].slice(0);break;case k.e.CAP_END:b[w]=b[w-1].slice(0),b[w+1]=S(g,M.length-1);break;case k.e.CAP_ALL:b[0]=S(g,0),b[1]=b[2].slice(0),b[w]=b[w-1].slice(0),b[w+1]=S(g,M.length-1)}return b};let r,c;if(g){const M=g._creationDataStorage,b=E.arc||M.arc;return r=M.path3D.update(a),c=B(a,r,M.pathArray,n,M.Qk,T,M.cap,b),g=u("",{pathArray:c,instance:g}),M.path3D=r,M.pathArray=c,M.arc=b,M.i=n,g}r=new Z.k(a);V=V<0||V>3?0:V,c=B(a,r,new Array,n,J,T,V,E.arc);const C=u(M,{pathArray:c,closePath:!0,closeArray:!1,updatable:t,sideOrientation:y,invertUV:I,frontUVs:E.frontUVs,backUVs:E.backUVs},b);return C._creationDataStorage.pathArray=c,C._creationDataStorage.path3D=r,C._creationDataStorage.Qk=J,C._creationDataStorage.cap=V,C._creationDataStorage.arc=E.arc,C._creationDataStorage.i=n,C}function Y(M){const E=[];E[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},E[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},E[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},E[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},E[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},E[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},E[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},E[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},E[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},E[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},E[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},E[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},E[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},E[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},E[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const b=M.type&&(M.type<0||M.type>=E.length)?0:M.type||0,k=M.size,a=M.sizeX||k||1,J=M.sizeY||k||1,u=M.sizeZ||k||1,T=M.custom||E[b],V=T.face.length,t=M.faceUV||new Array(V),y=M.faceColors,B=void 0===M.flat||M.flat,r=0===M.sideOrientation?0:M.sideOrientation||g.d.DEFAULTSIDE,c=[],C=[],R=[],w=[],S=[];let X=0,U=0;const v=[];let N,K,h,Z,O,p,P=0,F=0;if(B)for(F=0;F<V;F++)y&&void 0===y[F]&&(y[F]=new I.h(1,1,1,1)),t&&void 0===t[F]&&(t[F]=new x.o(0,0,1,1));if(B)for(F=0;F<V;F++){const M=T.face[F].length;for(h=2*Math.PI/M,Z=.5*Math.tan(h/2),O=.5,P=0;P<M;P++)c.push(T.vertex[T.face[F][P]][0]*a,T.vertex[T.face[F][P]][1]*J,T.vertex[T.face[F][P]][2]*u),v.push(X),X++,N=t[F].x+(t[F].z-t[F].x)*(.5+Z),K=t[F].y+(t[F].w-t[F].y)*(O-.5),w.push(N,n.c?1-K:K),p=Z*Math.cos(h)-O*Math.sin(h),O=Z*Math.sin(h)+O*Math.cos(h),Z=p,y&&S.push(y[F].r,y[F].g,y[F].b,y[F].a);for(P=0;P<M-2;P++)C.push(v[0+U],v[P+2+U],v[P+1+U]);U+=M}else{for(P=0;P<T.vertex.length;P++)c.push(T.vertex[P][0]*a,T.vertex[P][1]*J,T.vertex[P][2]*u),w.push(0,n.c?1:0);for(F=0;F<V;F++)for(P=0;P<T.face[F].length-2;P++)C.push(T.face[F][0],T.face[F][P+2],T.face[F][P+1])}g.d.ComputeNormals(c,C,R),g.d._ComputeSides(r,c,C,R,w,M.frontUVs,M.backUVs);const l=new g.d;return l.xa=c,l.indices=C,l.ya=R,l.Aa=w,y&&B&&(l.za=S),l}function i(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const x=new k.e(M,b);E.sideOrientation=k.e._GetDefaultSideOrientation(E.sideOrientation),x._originalBuilderSideOrientation=E.sideOrientation;return Y(E).Ca(x,E.updatable),x}k.e.CreateTube=(M,E,b,x,k,a,g,n,J,u)=>A(M,{path:E,i:b,Qk:x,radiusFunction:k,arc:1,cap:a,updatable:n,sideOrientation:J,instance:u},g);function G(M){const E=M.sideOrientation||g.d.DEFAULTSIDE,b=M.i||1,k=void 0===M.flat||M.flat,a=0|(M.subdivisions||4),J=M.radiusX||b,u=M.radiusY||b,T=M.radiusZ||b,V=(1+Math.sqrt(5))/2,I=[-1,V,-0,1,V,0,-1,-V,0,1,-V,0,0,-1,-V,0,1,-V,0,-1,V,0,1,V,V,0,1,V,0,-1,-V,0,1,-V,0,-1],t=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],y=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],B=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],r=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],c=[],C=[],R=[],w=[];let S=0;const X=new Array(3),U=new Array(3);let v;for(v=0;v<3;v++)X[v]=x.m.Zero(),U[v]=x.l.Zero();for(let g=0;g<20;g++){for(v=0;v<3;v++){const M=t[3*g+v];X[v].Hd(I[3*y[M]],I[3*y[M]+1],I[3*y[M]+2]),X[v].normalize(),U[v].Hd(.134765625*B[2*M]+.05859375+-.0390625*r[g],.2333984375*B[2*M+1]+.025390625+.01953125*r[g])}const M=(M,E,b,g)=>{const V=x.m.Lerp(X[0],X[2],E/a),I=x.m.Lerp(X[1],X[2],E/a),t=a===E?X[2]:x.m.Lerp(V,I,M/(a-E));let y;if(t.normalize(),k){const M=x.m.Lerp(X[0],X[2],g/a),E=x.m.Lerp(X[1],X[2],g/a);y=x.m.Lerp(M,E,b/(a-g))}else y=new x.m(t.x,t.y,t.z);y.x/=J,y.y/=u,y.z/=T,y.normalize();const B=x.l.Lerp(U[0],U[2],E/a),r=x.l.Lerp(U[1],U[2],E/a),v=a===E?U[2]:x.l.Lerp(B,r,M/(a-E));C.push(t.x*J,t.y*u,t.z*T),R.push(y.x,y.y,y.z),w.push(v.x,n.c?1-v.y:v.y),c.push(S),S++};for(let E=0;E<a;E++)for(let b=0;b+E<a;b++)M(b,E,b+1/3,E+1/3),M(b+1,E,b+1/3,E+1/3),M(b,E+1,b+1/3,E+1/3),b+E+1<a&&(M(b+1,E,b+2/3,E+2/3),M(b+1,E+1,b+2/3,E+2/3),M(b,E+1,b+2/3,E+2/3))}g.d._ComputeSides(E,C,c,R,w,M.frontUVs,M.backUVs);const N=new g.d;return N.indices=c,N.xa=C,N.ya=R,N.Aa=w,N}function H(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const x=new k.e(M,b);E.sideOrientation=k.e._GetDefaultSideOrientation(E.sideOrientation),x._originalBuilderSideOrientation=E.sideOrientation;return G(E).Ca(x,E.updatable),x}g.d.CreatePolyhedron=Y,k.e.CreatePolyhedron=(M,E,b)=>i(M,E,b);g.d.CreateIcoSphere=G,k.e.CreateIcoSphere=(M,E,b)=>H(M,E,b);var e=b(1009);const Q=new x.m(1,0,0),L=new x.m(-1,0,0),f=new x.m(0,1,0),MM=new x.m(0,-1,0),EM=new x.m(0,0,1),bM=new x.m(0,0,-1);class xM{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x.m.Zero(),E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:x.m.Up(),b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:x.l.Zero(),k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,J=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=M,this.de=E,this.uv=b,this.vertexIdx=k,this.vertexIdxForBones=a,this.localPositionOverride=g,this.localNormalOverride=n,this.matrixIndicesOverride=J,this.matrixWeightsOverride=u}clone(){var M,E,b,x;return new xM(this.position.clone(),this.de.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(M=this.localPositionOverride)||void 0===M?void 0:M.slice(),null===(E=this.localNormalOverride)||void 0===E?void 0:E.slice(),null===(b=this.matrixIndicesOverride)||void 0===b?void 0:b.slice(),null===(x=this.matrixWeightsOverride)||void 0===x?void 0:x.slice())}}function kM(M,E,b){var J,u,T,V;const I=!!E.skeleton,t=b.localMode||I,y=E.Ed(),B=I?E.If(!0,!0):E.getVerticesData(a.g.PositionKind),r=I?E.getNormalsData(!0,!0):E.getVerticesData(a.g.NormalKind),c=t?I?E.getVerticesData(a.g.PositionKind):B:null,C=t?I?E.getVerticesData(a.g.NormalKind):r:null,R=E.getVerticesData(a.g.UVKind),w=I?E.getVerticesData(a.g.MatricesIndicesKind):null,S=I?E.getVerticesData(a.g.MatricesWeightsKind):null,X=I?E.getVerticesData(a.g.MatricesIndicesExtraKind):null,U=I?E.getVerticesData(a.g.MatricesWeightsExtraKind):null,v=b.position||x.m.Zero();let N=b.de||x.m.Up();const K=b.size||x.m.One(),h=b.angle||0;if(!N){const M=new x.m(0,0,1),b=E.va().activeCamera,k=x.m.TransformCoordinates(M,b.getWorldMatrix());N=b.globalPosition.Qc(k)}const Z=-Math.atan2(N.z,N.x)-Math.PI/2,O=Math.sqrt(N.x*N.x+N.z*N.z),p=Math.atan2(N.y,O),P=new g.d;P.indices=[],P.xa=[],P.ya=[],P.Aa=[],P.matricesIndices=I?[]:null,P.matricesWeights=I?[]:null,P.matricesIndicesExtra=X?[]:null,P.matricesWeightsExtra=U?[]:null;let F=0;const l=(M,E)=>{const k=new xM;if(!y||!B||!r)return k;const a=y[M];if(k.vertexIdx=3*a,k.vertexIdxForBones=4*a,k.position=new x.m(B[3*a],B[3*a+1],B[3*a+2]),x.m.TransformCoordinatesToRef(k.position,E,k.position),k.de=new x.m(r[3*a],r[3*a+1],r[3*a+2]),x.m.TransformNormalToRef(k.de,E,k.de),b.captureUVS&&R){const M=R[2*a+1];k.uv=new x.l(R[2*a],n.c?1-M:M)}return k},d=[0,0,0,0],W=(M,E)=>{if(0===M.length)return M;const b=.5*Math.abs(x.m.Dot(K,E)),k=(M,E,b,x)=>{for(let k=0;k<x;++k)if(M[b+k]===E)return b+k;return-1},a=(M,a)=>{const g=x.m.GetClipFactor(M.position,a.position,E,b);let n=d,J=d;if(w&&S){const E=M.matrixIndicesOverride?0:M.vertexIdxForBones,b=M.matrixIndicesOverride??w,x=M.matrixWeightsOverride??S,u=a.matrixIndicesOverride?0:a.vertexIdxForBones,T=a.matrixIndicesOverride??w,V=a.matrixWeightsOverride??S;n=[0,0,0,0],J=[0,0,0,0];let I=0;for(let M=0;M<4;++M)if(x[E+M]>0){const a=k(T,b[E+M],u,4);n[I]=b[E+M],J[I]=(0,e.m)(x[E+M],a>=0?V[a]:0,g),I++}for(let M=0;M<4&&I<4;++M){const x=T[u+M];-1===k(b,x,E,4)&&(n[I]=x,J[I]=(0,e.m)(0,V[u+M],g),I++)}const t=J[0]+J[1]+J[2]+J[3];J[0]/=t,J[1]/=t,J[2]/=t,J[3]/=t}const u=M.localPositionOverride?M.localPositionOverride[0]:(null===c||void 0===c?void 0:c[M.vertexIdx])??0,T=M.localPositionOverride?M.localPositionOverride[1]:(null===c||void 0===c?void 0:c[M.vertexIdx+1])??0,V=M.localPositionOverride?M.localPositionOverride[2]:(null===c||void 0===c?void 0:c[M.vertexIdx+2])??0,I=a.localPositionOverride?a.localPositionOverride[0]:(null===c||void 0===c?void 0:c[a.vertexIdx])??0,t=a.localPositionOverride?a.localPositionOverride[1]:(null===c||void 0===c?void 0:c[a.vertexIdx+1])??0,y=a.localPositionOverride?a.localPositionOverride[2]:(null===c||void 0===c?void 0:c[a.vertexIdx+2])??0,B=M.localNormalOverride?M.localNormalOverride[0]:(null===C||void 0===C?void 0:C[M.vertexIdx])??0,r=M.localNormalOverride?M.localNormalOverride[1]:(null===C||void 0===C?void 0:C[M.vertexIdx+1])??0,R=M.localNormalOverride?M.localNormalOverride[2]:(null===C||void 0===C?void 0:C[M.vertexIdx+2])??0,X=B+((a.localNormalOverride?a.localNormalOverride[0]:(null===C||void 0===C?void 0:C[a.vertexIdx])??0)-B)*g,U=r+((a.localNormalOverride?a.localNormalOverride[1]:(null===C||void 0===C?void 0:C[a.vertexIdx+1])??0)-r)*g,v=R+((a.localNormalOverride?a.localNormalOverride[2]:(null===C||void 0===C?void 0:C[a.vertexIdx+2])??0)-R)*g,N=Math.sqrt(X*X+U*U+v*v);return new xM(x.m.Lerp(M.position,a.position,g),x.m.Lerp(M.de,a.de,g).normalize(),x.l.Lerp(M.uv,a.uv,g),-1,-1,c?[u+(I-u)*g,T+(t-T)*g,V+(y-V)*g]:null,C?[X/N,U/N,v/N]:null,n,J)};let g=null;M.length>3&&(g=[]);for(let n=0;n<M.length;n+=3){let k=0,J=null,u=null,T=null,V=null;const I=x.m.Dot(M[n].position,E)-b>0,t=x.m.Dot(M[n+1].position,E)-b>0,y=x.m.Dot(M[n+2].position,E)-b>0;switch(k=(I?1:0)+(t?1:0)+(y?1:0),k){case 0:M.length>3?(g.push(M[n]),g.push(M[n+1]),g.push(M[n+2])):g=M;break;case 1:if(g=g??new Array,I&&(J=M[n+1],u=M[n+2],T=a(M[n],J),V=a(M[n],u)),t){J=M[n],u=M[n+2],T=a(M[n+1],J),V=a(M[n+1],u),g.push(T),g.push(u.clone()),g.push(J.clone()),g.push(u.clone()),g.push(T.clone()),g.push(V);break}y&&(J=M[n],u=M[n+1],T=a(M[n+2],J),V=a(M[n+2],u)),J&&u&&T&&V&&(g.push(J.clone()),g.push(u.clone()),g.push(T),g.push(V),g.push(T.clone()),g.push(u.clone()));break;case 2:g=g??new Array,I||(J=M[n].clone(),u=a(J,M[n+1]),T=a(J,M[n+2]),g.push(J),g.push(u),g.push(T)),t||(J=M[n+1].clone(),u=a(J,M[n+2]),T=a(J,M[n]),g.push(J),g.push(u),g.push(T)),y||(J=M[n+2].clone(),u=a(J,M[n]),T=a(J,M[n+1]),g.push(J),g.push(u),g.push(T))}}return g},m=E instanceof k.e?E:null,o=null===m||void 0===m?void 0:m._thinInstanceDataStorage.matrixData,j=(null===m||void 0===m?void 0:m.Kj)||1,s=x.i.Matrix[0];s.p(x.d.IdentityReadOnly);for(let k=0;k<j;++k){if(null!==m&&void 0!==m&&m.hasThinInstances&&o){const M=16*k;s.setRowFromFloats(0,o[M+0],o[M+1],o[M+2],o[M+3]),s.setRowFromFloats(1,o[M+4],o[M+5],o[M+6],o[M+7]),s.setRowFromFloats(2,o[M+8],o[M+9],o[M+10],o[M+11]),s.setRowFromFloats(3,o[M+12],o[M+13],o[M+14],o[M+15])}const M=x.d.RotationYawPitchRoll(Z,p,h).multiply(x.d.Translation(v.x,v.y,v.z)),a=x.d.Invert(M),g=E.getWorldMatrix(),J=s.multiply(g).multiply(a),u=new Array(3);for(let E=0;E<y.length;E+=3){let M=u;if(M[0]=l(E,J),M[1]=l(E+1,J),M[2]=l(E+2,J),!(b.cullBackFaces&&-M[0].de.z<=0&&-M[1].de.z<=0&&-M[2].de.z<=0)&&(M=W(M,Q),M&&(M=W(M,L),M&&(M=W(M,f),M&&(M=W(M,MM),M&&(M=W(M,EM),M&&(M=W(M,bM),M)))))))for(let E=0;E<M.length;E++){const x=M[E];if(P.indices.push(F),t?(x.localPositionOverride?(P.xa[3*F]=x.localPositionOverride[0],P.xa[3*F+1]=x.localPositionOverride[1],P.xa[3*F+2]=x.localPositionOverride[2]):c&&(P.xa[3*F]=c[x.vertexIdx],P.xa[3*F+1]=c[x.vertexIdx+1],P.xa[3*F+2]=c[x.vertexIdx+2]),x.localNormalOverride?(P.ya[3*F]=x.localNormalOverride[0],P.ya[3*F+1]=x.localNormalOverride[1],P.ya[3*F+2]=x.localNormalOverride[2]):C&&(P.ya[3*F]=C[x.vertexIdx],P.ya[3*F+1]=C[x.vertexIdx+1],P.ya[3*F+2]=C[x.vertexIdx+2])):(x.position.toArray(P.xa,3*F),x.de.toArray(P.ya,3*F)),P.matricesIndices&&P.matricesWeights&&(x.matrixIndicesOverride?(P.matricesIndices[4*F]=x.matrixIndicesOverride[0],P.matricesIndices[4*F+1]=x.matrixIndicesOverride[1],P.matricesIndices[4*F+2]=x.matrixIndicesOverride[2],P.matricesIndices[4*F+3]=x.matrixIndicesOverride[3]):(w&&(P.matricesIndices[4*F]=w[x.vertexIdxForBones],P.matricesIndices[4*F+1]=w[x.vertexIdxForBones+1],P.matricesIndices[4*F+2]=w[x.vertexIdxForBones+2],P.matricesIndices[4*F+3]=w[x.vertexIdxForBones+3]),X&&P.matricesIndicesExtra&&(P.matricesIndicesExtra[4*F]=X[x.vertexIdxForBones],P.matricesIndicesExtra[4*F+1]=X[x.vertexIdxForBones+1],P.matricesIndicesExtra[4*F+2]=X[x.vertexIdxForBones+2],P.matricesIndicesExtra[4*F+3]=X[x.vertexIdxForBones+3])),x.matrixWeightsOverride?(P.matricesWeights[4*F]=x.matrixWeightsOverride[0],P.matricesWeights[4*F+1]=x.matrixWeightsOverride[1],P.matricesWeights[4*F+2]=x.matrixWeightsOverride[2],P.matricesWeights[4*F+3]=x.matrixWeightsOverride[3]):(S&&(P.matricesWeights[4*F]=S[x.vertexIdxForBones],P.matricesWeights[4*F+1]=S[x.vertexIdxForBones+1],P.matricesWeights[4*F+2]=S[x.vertexIdxForBones+2],P.matricesWeights[4*F+3]=S[x.vertexIdxForBones+3]),U&&P.matricesWeightsExtra&&(P.matricesWeightsExtra[4*F]=U[x.vertexIdxForBones],P.matricesWeightsExtra[4*F+1]=U[x.vertexIdxForBones+1],P.matricesWeightsExtra[4*F+2]=U[x.vertexIdxForBones+2],P.matricesWeightsExtra[4*F+3]=U[x.vertexIdxForBones+3]))),b.captureUVS)x.uv.toArray(P.Aa,2*F);else{P.Aa.push(.5+x.position.x/K.x);const M=.5+x.position.y/K.y;P.Aa.push(n.c?1-M:M)}F++}}}0===P.indices.length&&(P.indices=null),0===P.xa.length&&(P.xa=null),0===P.ya.length&&(P.ya=null),0===P.Aa.length&&(P.Aa=null),0===(null===(J=P.matricesIndices)||void 0===J?void 0:J.length)&&(P.matricesIndices=null),0===(null===(u=P.matricesWeights)||void 0===u?void 0:u.length)&&(P.matricesWeights=null),0===(null===(T=P.matricesIndicesExtra)||void 0===T?void 0:T.length)&&(P.matricesIndicesExtra=null),0===(null===(V=P.matricesWeightsExtra)||void 0===V?void 0:V.length)&&(P.matricesWeightsExtra=null);const q=new k.e(M,E.va());return P.Ca(q),t?(q.skeleton=E.skeleton,q.parent=E):(q.position=v.clone(),q.rotation=new x.m(p,Z,h)),q.ce(!0),q.refreshBoundingInfo(!0,!0),q}function aM(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,Qk:16,height:1,i:.25,capSubdivisions:6};const E=0|Math.max(M.subdivisions?M.subdivisions:2,1),b=0|Math.max(M.Qk?M.Qk:16,3),k=Math.max(M.height?M.height:1,0),a=Math.max(M.i?M.i:.25,0),J=0|Math.max(M.capSubdivisions?M.capSubdivisions:6,1),u=b,T=E,V=Math.max(M.radiusTop?M.radiusTop:a,0),I=Math.max(M.radiusBottom?M.radiusBottom:a,0),t=k-(V+I),y=2*Math.PI,B=Math.max(M.topCapSubdivisions?M.topCapSubdivisions:J,1),r=Math.max(M.bottomCapSubdivisions?M.bottomCapSubdivisions:J,1),c=Math.acos((I-V)/k);let C=[];const R=[],w=[],S=[];let X=0;const U=[],v=.5*t,N=.5*Math.PI;let K,h;const Z=x.m.Zero(),O=x.m.Zero(),p=Math.cos(c),P=Math.sin(c),F=new x.l(V*P,v+V*p).Qc(new x.l(I*P,I*p-v)).length(),l=V*c+F+I*(N-c);let d=0;for(h=0;h<=B;h++){const M=[],E=N-c*(h/B);d+=V*c/B;const b=Math.cos(E),x=Math.sin(E),k=b*V;for(K=0;K<=u;K++){const E=K/u,a=E*y+0,g=Math.sin(a),J=Math.cos(a);O.x=k*g,O.y=v+x*V,O.z=k*J,R.push(O.x,O.y,O.z),Z.set(b*g,x,b*J),w.push(Z.x,Z.y,Z.z),S.push(E,n.c?d/l:1-d/l),M.push(X),X++}U.push(M)}const W=k-V-I+p*V-p*I,m=P*(I-V)/W;for(h=1;h<=T;h++){const M=[];d+=F/T;const E=P*(h*(I-V)/T+V);for(K=0;K<=u;K++){const b=K/u,x=b*y+0,k=Math.sin(x),a=Math.cos(x);O.x=E*k,O.y=v+p*V-h*W/T,O.z=E*a,R.push(O.x,O.y,O.z),Z.set(k,m,a).normalize(),w.push(Z.x,Z.y,Z.z),S.push(b,n.c?d/l:1-d/l),M.push(X),X++}U.push(M)}for(h=1;h<=r;h++){const M=[],E=N-c-(Math.PI-c)*(h/r);d+=I*c/r;const b=Math.cos(E),x=Math.sin(E),k=b*I;for(K=0;K<=u;K++){const E=K/u,a=E*y+0,g=Math.sin(a),J=Math.cos(a);O.x=k*g,O.y=x*I-v,O.z=k*J,R.push(O.x,O.y,O.z),Z.set(b*g,x,b*J),w.push(Z.x,Z.y,Z.z),S.push(E,n.c?d/l:1-d/l),M.push(X),X++}U.push(M)}for(K=0;K<u;K++)for(h=0;h<B+T+r;h++){const M=U[h][K],E=U[h+1][K],b=U[h+1][K+1],x=U[h][K+1];C.push(M),C.push(E),C.push(x),C.push(E),C.push(b),C.push(x)}if(C=C.reverse(),M.orientation&&!M.orientation.equals(x.m.Up())){const E=new x.d;M.orientation.clone().scale(.5*Math.PI).cross(x.m.Up()).toQuaternion().toRotationMatrix(E);const b=x.m.Zero();for(let M=0;M<R.length;M+=3)b.set(R[M],R[M+1],R[M+2]),x.m.TransformCoordinatesToRef(b.clone(),E,b),R[M]=b.x,R[M+1]=b.y,R[M+2]=b.z}const o=new g.d;return o.xa=R,o.ya=w,o.Aa=S,o.indices=C,o}function gM(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:x.m.Up(),subdivisions:2,Qk:16,height:1,i:.25,capSubdivisions:6,updatable:!1},b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const a=new k.e(M,b);return aM(E).Ca(a,E.updatable),a}k.e.CreateDecal=(M,E,b,x,k,a)=>kM(M,E,{position:b,de:x,size:k,angle:a});k.e.CreateCapsule=(M,E,b)=>gM(M,E,b),g.d.CreateCapsule=aM;class nM{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=M,this.y=E,M!==Math.floor(M)&&(M=Math.floor(M),h.d.Warn("x is not an integer, floor(x) used")),E!==Math.floor(E)&&(E=Math.floor(E),h.d.Warn("y is not an integer, floor(y) used"))}clone(){return new nM(this.x,this.y)}rotate60About(M){const E=this.x;return this.x=M.x+M.y-this.y,this.y=E+this.y-M.x,this}rotateNeg60About(M){const E=this.x;return this.x=E+this.y-M.y,this.y=M.x+M.y-E,this}rotate120(M,E){M!==Math.floor(M)&&(M=Math.floor(M),h.d.Warn("m not an integer only floor(m) used")),E!==Math.floor(E)&&(E=Math.floor(E),h.d.Warn("n not an integer only floor(n) used"));const b=this.x;return this.x=M-b-this.y,this.y=E+b,this}rotateNeg120(M,E){M!==Math.floor(M)&&(M=Math.floor(M),h.d.Warn("m is not an integer, floor(m) used")),E!==Math.floor(E)&&(E=Math.floor(E),h.d.Warn("n is not an integer,   floor(n) used"));const b=this.x;return this.x=this.y-E,this.y=M+E-b-this.y,this}toCartesianOrigin(M,E){const b=x.m.Zero();return b.x=M.x+2*this.x*E+this.y*E,b.y=M.y+Math.sqrt(3)*this.y*E,b}static Zero(){return new nM(0,0)}}class JM{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new uM("icosahedron","Regular",[[0,O.f,-1],[-O.f,1,0],[-1,0,-O.f],[1,0,-O.f],[O.f,1,0],[0,O.f,1],[-1,0,O.f],[-O.f,-1,0],[0,-O.f,-1],[O.f,-1,0],[1,0,O.f],[0,-O.f,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let M=12;const E={},b=this.m,x=this.n;let k,a,g,n,J,u=b,T=1,V=0;0!==x&&(u=(0,e.f)(b,x)),T=b/u,V=x/u;const I=nM.Zero(),t=new nM(b,x),y=new nM(-x,b+x),B=nM.Zero(),r=nM.Zero(),c=nM.Zero();let C,R,w,S,X=[];const U=[],v=this.vertByDist,N=(b,x,k,a)=>{C=b+"|"+k,R=x+"|"+a,C in E||R in E?C in E&&!(R in E)?E[R]=E[C]:R in E&&!(C in E)&&(E[C]=E[R]):(E[C]=M,E[R]=M,M++),v[k][0]>2?U[E[C]]=[-v[k][0],v[k][1],E[C]]:U[E[C]]=[X[v[k][0]],v[k][1],E[C]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let K=0;K<20;K++){if(X=this.IDATA.face[K],g=X[2],n=X[1],J=X[0],w=I.x+"|"+I.y,C=K+"|"+w,C in E||(E[C]=g,U[g]=[X[v[w][0]],v[w][1]]),w=t.x+"|"+t.y,C=K+"|"+w,C in E||(E[C]=n,U[n]=[X[v[w][0]],v[w][1]]),w=y.x+"|"+y.y,C=K+"|"+w,C in E||(E[C]=J,U[J]=[X[v[w][0]],v[w][1]]),k=this.IDATA.edgematch[K][0],a=this.IDATA.edgematch[K][1],"B"===a)for(let M=1;M<u;M++)r.x=b-M*(T+V),r.y=x+M*T,c.x=-M*V,c.y=M*(T+V),w=r.x+"|"+r.y,S=c.x+"|"+c.y,N(K,k,w,S);if("O"===a)for(let M=1;M<u;M++)c.x=-M*V,c.y=M*(T+V),B.x=M*T,B.y=M*V,w=c.x+"|"+c.y,S=B.x+"|"+B.y,N(K,k,w,S);if(k=this.IDATA.edgematch[K][2],a=this.IDATA.edgematch[K][3],a&&"A"===a)for(let M=1;M<u;M++)B.x=M*T,B.y=M*V,r.x=b-(u-M)*(T+V),r.y=x+(u-M)*T,w=B.x+"|"+B.y,S=r.x+"|"+r.y,N(K,k,w,S);for(let b=0;b<this.vertices.length;b++)w=this.vertices[b].x+"|"+this.vertices[b].y,C=K+"|"+w,C in E||(E[C]=M++,v[w][0]>2?U[E[C]]=[-v[w][0],v[w][1],E[C]]:U[E[C]]=[X[v[w][0]],v[w][1],E[C]])}this.closestTo=U,this.vecToidx=E}calcCoeffs(){const M=this.m,E=this.n,b=Math.sqrt(3)/3,x=M*M+E*E+M*E;this.coau=(M+E)/x,this.cobu=-E/x,this.coav=-b*(M-E)/x,this.cobv=b*(2*M+E)/x}createInnerFacets(){const M=this.m,E=this.n;for(let b=0;b<E+M+1;b++)for(let M=this.min[b];M<this.max[b]+1;M++)M<this.max[b]&&M<this.max[b+1]+1&&this.innerFacets.push(["|"+M+"|"+b,"|"+M+"|"+(b+1),"|"+(M+1)+"|"+b]),b>0&&M<this.max[b-1]&&M+1<this.max[b]+1&&this.innerFacets.push(["|"+M+"|"+b,"|"+(M+1)+"|"+b,"|"+(M+1)+"|"+(b-1)])}edgeVecsABOB(){const M=this.m,E=this.n,b=new nM(-E,M+E);for(let x=1;x<M+E;x++){const M=new nM(this.min[x],x),E=new nM(this.min[x-1],x-1),k=new nM(this.min[x+1],x+1),a=M.clone(),g=E.clone(),n=k.clone();a.rotate60About(b),g.rotate60About(b),n.rotate60About(b);const J=new nM(this.max[a.y],a.y),u=new nM(this.max[a.y-1],a.y-1),T=new nM(this.max[a.y-1]-1,a.y-1);a.x===J.x&&a.y===J.y||(a.x!==u.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([M,u,T]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([M,T,J])):a.y===n.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([M,E,u]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([M,u,k])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([M,E,u]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([M,u,J])))}}mapABOBtoOBOA(){const M=new nM(0,0);for(let E=0;E<this.isoVecsABOB.length;E++){const b=[];for(let x=0;x<3;x++)M.x=this.isoVecsABOB[E][x].x,M.y=this.isoVecsABOB[E][x].y,0===this.vertexTypes[E][x]&&M.rotateNeg120(this.m,this.n),b.push(M.clone());this.isoVecsOBOA.push(b)}}mapABOBtoBAOA(){const M=new nM(0,0);for(let E=0;E<this.isoVecsABOB.length;E++){const b=[];for(let x=0;x<3;x++)M.x=this.isoVecsABOB[E][x].x,M.y=this.isoVecsABOB[E][x].y,1===this.vertexTypes[E][x]&&M.rotate120(this.m,this.n),b.push(M.clone());this.isoVecsBAOA.push(b)}}MapToFace(M,E){const b=this.IDATA.face[M],k=b[2],a=b[1],g=b[0],n=x.m.Id(this.IDATA.vertex[k]),J=x.m.Id(this.IDATA.vertex[a]),u=x.m.Id(this.IDATA.vertex[g]),T=J.Qc(n),V=u.Qc(n),I=T.scale(this.coau).add(V.scale(this.cobu)),t=T.scale(this.coav).add(V.scale(this.cobv)),y=[];let B,r=x.i.Fd[0];for(let x=0;x<this.cartesian.length;x++)r=I.scale(this.cartesian[x].x).add(t.scale(this.cartesian[x].y)).add(n),y[x]=[r.x,r.y,r.z],B=M+"|"+this.vertices[x].x+"|"+this.vertices[x].y,E.vertex[this.vecToidx[B]]=[r.x,r.y,r.z]}build(M,E){const b=[],x=nM.Zero(),k=new nM(M,E),a=new nM(-E,M+E);b.push(x,k,a);for(let w=E;w<M+1;w++)for(let E=0;E<M+1-w;E++)b.push(new nM(E,w));if(E>0){const x=(0,e.f)(M,E),k=M/x,a=E/x;for(let n=1;n<x;n++)b.push(new nM(n*k,n*a)),b.push(new nM(-n*a,n*(k+a))),b.push(new nM(M-n*(k+a),E+n*k));const g=M/E;for(let n=1;n<E;n++)for(let x=0;x<n*g;x++)b.push(new nM(x,n)),b.push(new nM(x,n).rotate120(M,E)),b.push(new nM(x,n).rotateNeg120(M,E))}b.sort(((M,E)=>M.x-E.x)),b.sort(((M,E)=>M.y-E.y));const g=new Array(M+E+1),n=new Array(M+E+1);for(let w=0;w<g.length;w++)g[w]=1/0,n[w]=-1/0;let J=0,u=0;const T=b.length;for(let w=0;w<T;w++)u=b[w].x,J=b[w].y,g[J]=Math.min(u,g[J]),n[J]=Math.max(u,n[J]);const V=(b,x)=>{const k=b.clone();return"A"===x&&k.rotateNeg120(M,E),"B"===x&&k.rotate120(M,E),k.x<0?k.y:k.x+k.y},I=[],t=[],y=[],B=[],r={},c=[];let C=-1,R=-1;for(let w=0;w<T;w++)I[w]=b[w].toCartesianOrigin(new nM(0,0),.5),t[w]=V(b[w],"O"),y[w]=V(b[w],"A"),B[w]=V(b[w],"B"),t[w]===y[w]&&y[w]===B[w]?(C=3,R=t[w]):t[w]===y[w]?(C=4,R=t[w]):y[w]===B[w]?(C=5,R=y[w]):B[w]===t[w]&&(C=6,R=t[w]),t[w]<y[w]&&t[w]<B[w]&&(C=2,R=t[w]),y[w]<t[w]&&y[w]<B[w]&&(C=1,R=y[w]),B[w]<y[w]&&B[w]<t[w]&&(C=0,R=B[w]),c.push([C,R,b[w].x,b[w].y]);c.sort(((M,E)=>M[2]-E[2])),c.sort(((M,E)=>M[3]-E[3])),c.sort(((M,E)=>M[1]-E[1])),c.sort(((M,E)=>M[0]-E[0]));for(let w=0;w<c.length;w++)r[c[w][2]+"|"+c[w][3]]=[c[w][0],c[w][1],w];return this.m=M,this.n=E,this.vertices=b,this.vertByDist=r,this.cartesian=I,this.min=g,this.max=n,this}}class uM{constructor(M,E,b,x){this.name=M,this.category=E,this.vertex=b,this.face=x}}class TM extends uM{innerToData(M,E){for(let b=0;b<E.innerFacets.length;b++)this.face.push(E.innerFacets[b].map((b=>E.vecToidx[M+b])))}mapABOBtoDATA(M,E){const b=E.IDATA.edgematch[M][0];for(let x=0;x<E.isoVecsABOB.length;x++){const k=[];for(let a=0;a<3;a++)0===E.vertexTypes[x][a]?k.push(M+"|"+E.isoVecsABOB[x][a].x+"|"+E.isoVecsABOB[x][a].y):k.push(b+"|"+E.isoVecsABOB[x][a].x+"|"+E.isoVecsABOB[x][a].y);this.face.push([E.vecToidx[k[0]],E.vecToidx[k[1]],E.vecToidx[k[2]]])}}mapOBOAtoDATA(M,E){const b=E.IDATA.edgematch[M][0];for(let x=0;x<E.isoVecsOBOA.length;x++){const k=[];for(let a=0;a<3;a++)1===E.vertexTypes[x][a]?k.push(M+"|"+E.isoVecsOBOA[x][a].x+"|"+E.isoVecsOBOA[x][a].y):k.push(b+"|"+E.isoVecsOBOA[x][a].x+"|"+E.isoVecsOBOA[x][a].y);this.face.push([E.vecToidx[k[0]],E.vecToidx[k[1]],E.vecToidx[k[2]]])}}mapBAOAtoDATA(M,E){const b=E.IDATA.edgematch[M][2];for(let x=0;x<E.isoVecsBAOA.length;x++){const k=[];for(let a=0;a<3;a++)1===E.vertexTypes[x][a]?k.push(M+"|"+E.isoVecsBAOA[x][a].x+"|"+E.isoVecsBAOA[x][a].y):k.push(b+"|"+E.isoVecsBAOA[x][a].x+"|"+E.isoVecsBAOA[x][a].y);this.face.push([E.vecToidx[k[0]],E.vecToidx[k[1]],E.vecToidx[k[2]]])}}orderData(M){const E=[];for(let a=0;a<13;a++)E[a]=[];const b=M.closestTo;for(let a=0;a<b.length;a++)b[a][0]>-1?b[a][1]>0&&E[b[a][0]].push([a,b[a][1]]):E[12].push([a,b[a][0]]);const x=[];for(let a=0;a<12;a++)x[a]=a;let k=12;for(let a=0;a<12;a++){E[a].sort(((M,E)=>M[1]-E[1]));for(let M=0;M<E[a].length;M++)x[E[a][M][0]]=k++}for(let a=0;a<E[12].length;a++)x[E[12][a][0]]=k++;for(let a=0;a<this.vertex.length;a++)this.vertex[a].push(x[a]);this.vertex.sort(((M,E)=>M[3]-E[3]));for(let a=0;a<this.vertex.length;a++)this.vertex[a].pop();for(let a=0;a<this.face.length;a++)for(let M=0;M<this.face[a].length;M++)this.face[a][M]=x[this.face[a][M]];this.sharedNodes=E[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(M,E){const b=[],x=[];let k=E.pop();x.push(k);let a=this.face[k].indexOf(M);a=(a+2)%3;let g=this.face[k][a];b.push(g);let n=0;for(;E.length>0;)k=E[n],this.face[k].indexOf(g)>-1?(a=(this.face[k].indexOf(g)+1)%3,g=this.face[k][a],b.push(g),x.push(k),E.splice(n,1),n=0):n++;return this.adjacentFaces.push(b),x}toGoldbergPolyhedronData(){const M=new uM("GeoDual","Goldberg",[],[]);M.name="GD dual";const E=this.vertex.length,b=new Array(E);for(let J=0;J<E;J++)b[J]=[];for(let J=0;J<this.face.length;J++)for(let M=0;M<3;M++)b[this.face[J][M]].push(J);let x=0,k=0,a=0,g=[],n=[];this.adjacentFaces=[];for(let J=0;J<b.length;J++)M.face[J]=this.setOrder(J,b[J].concat([])),b[J].forEach((E=>{x=0,k=0,a=0,g=this.face[E];for(let M=0;M<3;M++)n=this.vertex[g[M]],x+=n[0],k+=n[1],a+=n[2];M.vertex[E]=[x/3,k/3,a/3]}));return M}static BuildGeodesicData(M){const E=new TM("Geodesic-m-n","Geodesic",[[0,O.f,-1],[-O.f,1,0],[-1,0,-O.f],[1,0,-O.f],[O.f,1,0],[0,O.f,1],[-1,0,O.f],[-O.f,-1,0],[0,-O.f,-1],[O.f,-1,0],[1,0,O.f],[0,-O.f,1]],[]);M.setIndices(),M.calcCoeffs(),M.createInnerFacets(),M.edgeVecsABOB(),M.mapABOBtoOBOA(),M.mapABOBtoBAOA();for(let b=0;b<M.IDATA.face.length;b++)M.MapToFace(b,E),E.innerToData(b,M),"B"===M.IDATA.edgematch[b][1]&&E.mapABOBtoDATA(b,M),"O"===M.IDATA.edgematch[b][1]&&E.mapOBOAtoDATA(b,M),"A"===M.IDATA.edgematch[b][3]&&E.mapBAOAtoDATA(b,M);E.orderData(M);return E.vertex=E.vertex.map((function(M){const E=M[0],b=M[1],x=M[2],k=Math.sqrt(E*E+b*b+x*x);return M[0]*=1/k,M[1]*=1/k,M[2]*=1/k,M})),E}}k.e._GoldbergMeshParser=(M,E)=>VM.Parse(M,E);class VM extends k.e{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(M,E){return void 0===E?(M>this.goldbergData.nbUnsharedFaces-1&&(h.d.Warn("Maximum number of unshared faces used"),M=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+M):(M>11&&(h.d.Warn("Last pole used"),M=11),E>this.goldbergData.nbFacesAtPole-1&&(h.d.Warn("Maximum number of faces at a pole used"),E=this.goldbergData.nbFacesAtPole-1),12+M*this.goldbergData.nbFacesAtPole+E)}_changeGoldbergFaceColors(M){for(let b=0;b<M.length;b++){const E=M[b][0],x=M[b][1],k=M[b][2];for(let M=E;M<x+1;M++)this.goldbergData.faceColors[M]=k}const E=[];for(let b=0;b<12;b++)for(let M=0;M<5;M++)E.push(this.goldbergData.faceColors[b].r,this.goldbergData.faceColors[b].g,this.goldbergData.faceColors[b].b,this.goldbergData.faceColors[b].a);for(let b=12;b<this.goldbergData.faceColors.length;b++)for(let M=0;M<6;M++)E.push(this.goldbergData.faceColors[b].r,this.goldbergData.faceColors[b].g,this.goldbergData.faceColors[b].b,this.goldbergData.faceColors[b].a);return E}setGoldbergFaceColors(M){const E=this._changeGoldbergFaceColors(M);this.Ga(a.g.ColorKind,E)}updateGoldbergFaceColors(M){const E=this._changeGoldbergFaceColors(M);this.updateVerticesData(a.g.ColorKind,E)}_changeGoldbergFaceUVs(M){const E=this.getVerticesData(a.g.UVKind);for(let b=0;b<M.length;b++){const x=M[b][0],k=M[b][1],a=M[b][2],g=M[b][3],n=M[b][4],J=[],u=[];let T,V;for(let M=0;M<5;M++)T=a.x+g*Math.cos(n+M*Math.PI/2.5),V=a.y+g*Math.sin(n+M*Math.PI/2.5),T<0&&(T=0),T>1&&(T=1),J.push(T,V);for(let M=0;M<6;M++)T=a.x+g*Math.cos(n+M*Math.PI/3),V=a.y+g*Math.sin(n+M*Math.PI/3),T<0&&(T=0),T>1&&(T=1),u.push(T,V);for(let M=x;M<Math.min(12,k+1);M++)for(let b=0;b<5;b++)E[10*M+2*b]=J[2*b],E[10*M+2*b+1]=J[2*b+1];for(let M=Math.max(12,x);M<k+1;M++)for(let b=0;b<6;b++)E[12*M-24+2*b]=u[2*b],E[12*M-23+2*b]=u[2*b+1]}return E}setGoldbergFaceUVs(M){const E=this._changeGoldbergFaceUVs(M);this.Ga(a.g.UVKind,E)}updateGoldbergFaceUVs(M){const E=this._changeGoldbergFaceUVs(M);this.updateVerticesData(a.g.UVKind,E)}placeOnGoldbergFaceAt(M,E,b){const k=x.m.RotationFromAxis(this.goldbergData.faceXaxis[E],this.goldbergData.faceYaxis[E],this.goldbergData.faceZaxis[E]);M.rotation=k,M.position=this.goldbergData.faceCenters[E].add(this.goldbergData.faceXaxis[E].scale(b.x)).add(this.goldbergData.faceYaxis[E].scale(b.y)).add(this.goldbergData.faceZaxis[E].scale(b.z))}serialize(M){super.serialize(M),M.type="GoldbergMesh";const E={};if(E.adjacentFaces=this.goldbergData.adjacentFaces,E.nbSharedFaces=this.goldbergData.nbSharedFaces,E.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,E.nbFaces=this.goldbergData.nbFaces,E.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){E.faceColors=[];for(const M of this.goldbergData.faceColors)E.faceColors.push(M.Vd())}if(this.goldbergData.faceCenters){E.faceCenters=[];for(const M of this.goldbergData.faceCenters)E.faceCenters.push(M.Vd())}if(this.goldbergData.faceZaxis){E.faceZaxis=[];for(const M of this.goldbergData.faceZaxis)E.faceZaxis.push(M.Vd())}if(this.goldbergData.faceYaxis){E.faceYaxis=[];for(const M of this.goldbergData.faceYaxis)E.faceYaxis.push(M.Vd())}if(this.goldbergData.faceXaxis){E.faceXaxis=[];for(const M of this.goldbergData.faceXaxis)E.faceXaxis.push(M.Vd())}M.goldbergData=E}static Parse(M,E){const b=M.goldbergData;b.faceColors=b.faceColors.map((M=>I.h.Id(M))),b.faceCenters=b.faceCenters.map((M=>x.m.Id(M))),b.faceZaxis=b.faceZaxis.map((M=>x.m.Id(M))),b.faceXaxis=b.faceXaxis.map((M=>x.m.Id(M))),b.faceYaxis=b.faceYaxis.map((M=>x.m.Id(M)));const k=new VM(M.name,E);return k.goldbergData=b,k}}var IM=b(11578);class tM{constructor(M){this._paths=[],this._tempPaths=[],this._holes=[],this._resolution=M}moveTo(M,E){this._currentPath=new Z.i(M,E),this._tempPaths.push(this._currentPath)}lineTo(M,E){this._currentPath.addLineTo(M,E)}quadraticCurveTo(M,E,b,x){this._currentPath.addQuadraticCurveTo(M,E,b,x,this._resolution)}bezierCurveTo(M,E,b,x,k,a){this._currentPath.addBezierCurveTo(M,E,b,x,k,a,this._resolution)}extractHoles(){for(const M of this._tempPaths)M.area()>0?this._holes.push(M):this._paths.push(M);if(!this._paths.length&&this._holes.length){const M=this._holes;this._holes=this._paths,this._paths=M}this._tempPaths.length=0}get paths(){return this._paths}get holes(){return this._holes}}function yM(M,E,b,x,k,a){const g=a.glyphs[M]||a.glyphs["?"];if(!g)return null;const n=new tM(k);if(g.o){const M=g.o.split(" ");for(let k=0,a=M.length;k<a;){switch(M[k++]){case"m":{const a=parseInt(M[k++])*E+b,g=parseInt(M[k++])*E+x;n.moveTo(a,g);break}case"l":{const a=parseInt(M[k++])*E+b,g=parseInt(M[k++])*E+x;n.lineTo(a,g);break}case"q":{const a=parseInt(M[k++])*E+b,g=parseInt(M[k++])*E+x,J=parseInt(M[k++])*E+b,u=parseInt(M[k++])*E+x;n.quadraticCurveTo(J,u,a,g);break}case"b":{const a=parseInt(M[k++])*E+b,g=parseInt(M[k++])*E+x,J=parseInt(M[k++])*E+b,u=parseInt(M[k++])*E+x,T=parseInt(M[k++])*E+b,V=parseInt(M[k++])*E+x;n.bezierCurveTo(J,u,T,V,a,g);break}}}}return n.extractHoles(),{offsetX:g.ha*E,shapePath:n}}const BM={CreateBox:V.h,CreateTiledBox:r,CreateSphere:c.e,nb:T.c,CreateIcoSphere:H,CreateRibbon:u,CreateCylinder:S,CreateTorus:U,CreateTorusKnot:N,CreateLineSystem:K.h,ob:K.l,CreateDashedLines:K.d,ExtrudeShape:o,ExtrudeShapeCustom:j,CreateLathe:q,CreateTiledPlane:y,yg:D.e,CreateGround:z.e,CreateTiledGround:z.i,CreateGroundFromHeightMap:z.d,CreatePolygon:W,ExtrudePolygon:m,CreateTube:A,CreatePolyhedron:i,CreateGeodesic:function(M,E){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,x=E.m||1;x!==Math.floor(x)&&(x=Math.floor(x),h.d.Warn("m not an integer only floor(m) used"));let k=E.n||0;if(k!==Math.floor(k)&&(k=Math.floor(k),h.d.Warn("n not an integer only floor(n) used")),k>x){const M=k;k=x,x=M,h.d.Warn("n > m therefore m and n swapped")}const a=new JM;return a.build(x,k),i(M,{custom:TM.BuildGeodesicData(a),size:E.size,sizeX:E.sizeX,sizeY:E.sizeY,sizeZ:E.sizeZ,faceUV:E.faceUV,faceColors:E.faceColors,flat:E.flat,updatable:E.updatable,sideOrientation:E.sideOrientation,frontUVs:E.frontUVs,backUVs:E.backUVs},b)},CreateGoldberg:function(M,E){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const a=E.size,J=E.sizeX||a||1,u=E.sizeY||a||1,T=E.sizeZ||a||1;let V=E.m||1;V!==Math.floor(V)&&(V=Math.floor(V),h.d.Warn("m not an integer only floor(m) used"));let t=E.n||0;if(t!==Math.floor(t)&&(t=Math.floor(t),h.d.Warn("n not an integer only floor(n) used")),t>V){const M=t;t=V,V=M,h.d.Warn("n > m therefore m and n swapped")}const y=new JM;y.build(V,t);const B=TM.BuildGeodesicData(y),r=B.toGoldbergPolyhedronData(),c=new VM(M,b);E.sideOrientation=k.e._GetDefaultSideOrientation(E.sideOrientation),c._originalBuilderSideOrientation=E.sideOrientation;(function(M,E){const b=M.size,k=M.sizeX||b||1,a=M.sizeY||b||1,J=M.sizeZ||b||1,u=0===M.sideOrientation?0:M.sideOrientation||g.d.DEFAULTSIDE,T=[],V=[],I=[],t=[];let y=1/0,B=-1/0,r=1/0,c=-1/0;for(let x=0;x<E.vertex.length;x++)y=Math.min(y,E.vertex[x][0]*k),B=Math.max(B,E.vertex[x][0]*k),r=Math.min(r,E.vertex[x][1]*a),c=Math.max(c,E.vertex[x][1]*a);let C=0;for(let g=0;g<E.face.length;g++){const M=E.face[g],b=x.m.Id(E.vertex[M[0]]),u=x.m.Id(E.vertex[M[2]]),R=x.m.Id(E.vertex[M[1]]),w=u.Qc(b),S=R.Qc(b),X=x.m.Cross(S,w).normalize();for(let x=0;x<M.length;x++){I.push(X.x,X.y,X.z);const b=E.vertex[M[x]];T.push(b[0]*k,b[1]*a,b[2]*J);const g=(b[1]*a-r)/(c-r);t.push((b[0]*k-y)/(B-y),n.c?1-g:g)}for(let E=0;E<M.length-2;E++)V.push(C,C+E+2,C+E+1);C+=M.length}g.d._ComputeSides(u,T,V,I,t);const R=new g.d;return R.xa=T,R.indices=V,R.ya=I,R.Aa=t,R})(E,r).Ca(c,E.updatable),c.goldbergData.nbSharedFaces=B.sharedNodes,c.goldbergData.nbUnsharedFaces=B.poleNodes,c.goldbergData.adjacentFaces=B.adjacentFaces,c.goldbergData.nbFaces=c.goldbergData.nbSharedFaces+c.goldbergData.nbUnsharedFaces,c.goldbergData.nbFacesAtPole=(c.goldbergData.nbUnsharedFaces-12)/12;for(let k=0;k<B.vertex.length;k++)c.goldbergData.faceCenters.push(x.m.Id(B.vertex[k])),c.goldbergData.faceCenters[k].x*=J,c.goldbergData.faceCenters[k].y*=u,c.goldbergData.faceCenters[k].z*=T,c.goldbergData.faceColors.push(new I.h(1,1,1,1));for(let k=0;k<r.face.length;k++){const M=r.face[k],E=x.m.Id(r.vertex[M[0]]),b=x.m.Id(r.vertex[M[2]]),a=x.m.Id(r.vertex[M[1]]),g=b.Qc(E),n=a.Qc(E),J=x.m.Cross(n,g).normalize(),u=x.m.Cross(n,J).normalize();c.goldbergData.faceXaxis.push(n.normalize()),c.goldbergData.faceYaxis.push(J),c.goldbergData.faceZaxis.push(u)}return c},CreateDecal:kM,CreateCapsule:gM,CreateText:function(M,E,b){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{size:50,resolution:8,depth:1},g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:earcut;const J=function(M,E,b,x){const k=Array.from(M),a=E/x.resolution,g=(x.boundingBox.yMax-x.boundingBox.yMin+x.underlineThickness)*a,n=[];let J=0,u=0;for(let T=0;T<k.length;T++){const M=k[T];if("\n"===M)J=0,u-=g;else{const E=yM(M,a,J,u,b,x);E&&(J+=E.offsetX,n.push(E.shapePath))}}return n}(E,a.size||50,a.resolution||8,b),u=[];let T=0;for(const y of J){if(!y.paths.length)continue;const E=y.holes.slice();for(const b of y.paths){var V,I;const J=[],t=[],y=b.getPoints();for(const M of y)t.push(new x.m(M.x,0,M.y));const B=E.slice();for(const M of B){const k=M.getPoints();let a=!1;for(const M of k)if(b.isPointInside(M)){a=!0;break}if(!a)continue;const g=[];for(const M of k)g.push(new x.m(M.x,0,M.y));J.push(g),E.splice(E.indexOf(M),1)}if(!J.length&&E.length)for(const M of E){const E=M.getPoints(),b=[];for(const M of E)b.push(new x.m(M.x,0,M.y));J.push(b)}const r=m(M,{shape:t,holes:J.length?J:void 0,depth:a.depth||1,faceUV:a.faceUV||(null===(V=a.perLetterFaceUV)||void 0===V?void 0:V.call(a,T)),faceColors:a.faceColors||(null===(I=a.perLetterFaceColors)||void 0===I?void 0:I.call(a,T)),sideOrientation:k.e._GetDefaultSideOrientation(a.sideOrientation||k.e.DOUBLESIDE)},g,n);u.push(r),T++}}const t=k.e.MergeMeshes(u,!0,!0);if(t){const E=t.getBoundingInfo().boundingBox;t.position.x+=-(E.minimumWorld.x+E.maximumWorld.x)/2,t.position.y+=-(E.minimumWorld.y+E.maximumWorld.y)/2,t.position.z+=-(E.minimumWorld.z+E.maximumWorld.z)/2+E.extendSize.z,t.name=M;const b=new IM.c("pivot",g);b.rotation.x=-Math.PI/2,t.parent=b,t.bakeCurrentTransformIntoVertices(),t.parent=null,b.dispose()}return t}}},12172:(M,E,b)=>{"use strict";var x=b(11537),k=b(1228),a=b(970),g=b(1060),n=b(1343);x.e.prototype.thinInstanceAdd=function(M){let E=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.va().getEngine().getCaps().instancedArrays)return g.d.Error("Thin Instances are not supported on this device as Instanced Array extension not supported"),-1;this._thinInstanceUpdateBufferSize("matrix",Array.isArray(M)?M.length:1);const b=this._thinInstanceDataStorage.instancesCount;if(Array.isArray(M))for(let x=0;x<M.length;++x)this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,M[x],x===M.length-1&&E);else this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,M,E);return b},x.e.prototype.thinInstanceAddSelf=function(){let M=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.thinInstanceAdd(a.d.IdentityReadOnly,M)},x.e.prototype.thinInstanceRegisterAttribute=function(M,E){M===k.g.ColorKind&&(M=k.g.ColorInstanceKind),this.removeVerticesData(M),this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.strides[M]=E,this._userThinInstanceBuffersStorage.sizes[M]=E*Math.max(32,this._thinInstanceDataStorage.instancesCount),this._userThinInstanceBuffersStorage.data[M]=new Float32Array(this._userThinInstanceBuffersStorage.sizes[M]),this._userThinInstanceBuffersStorage.vertexBuffers[M]=new k.g(this.getEngine(),this._userThinInstanceBuffersStorage.data[M],M,!0,!1,E,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[M])},x.e.prototype.thinInstanceSetMatrixAt=function(M,E){let b=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!this._thinInstanceDataStorage.matrixData||M>=this._thinInstanceDataStorage.instancesCount)return!1;const x=this._thinInstanceDataStorage.matrixData;return E.copyToArray(x,16*M),this._thinInstanceDataStorage.worldMatrices&&(this._thinInstanceDataStorage.worldMatrices[M]=E),b&&(this.Nj("matrix"),this.Da||this.thinInstanceRefreshBoundingInfo(!1)),!0},x.e.prototype.thinInstanceSetAttributeAt=function(M,E,b){let x=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return M===k.g.ColorKind&&(M=k.g.ColorInstanceKind),!(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.data[M]||E>=this._thinInstanceDataStorage.instancesCount)&&(this._thinInstanceUpdateBufferSize(M,0),this._userThinInstanceBuffersStorage.data[M].set(b,E*this._userThinInstanceBuffersStorage.strides[M]),x&&this.Nj(M),!0)},Object.defineProperty(x.e.prototype,"Kj",{get:function(){return this._thinInstanceDataStorage.instancesCount},set:function(M){var E;const b=this._thinInstanceDataStorage.matrixData??(null===(E=this.source)||void 0===E?void 0:E._thinInstanceDataStorage.matrixData);M<=(b?b.length/16:0)&&(this._thinInstanceDataStorage.instancesCount=M)},enumerable:!0,configurable:!0}),x.e.prototype._thinInstanceCreateMatrixBuffer=function(M,E){let b=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const x=new k.d(this.getEngine(),E,!b,16,!1,!0);for(let k=0;k<4;k++)this.setVerticesBuffer(x.createVertexBuffer(M+k,4*k,4));return x},x.e.prototype.Oj=function(M,E){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,x=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];var a;if(b=b||16,"matrix"===M)null===(a=this._thinInstanceDataStorage.matrixBuffer)||void 0===a||a.dispose(),this._thinInstanceDataStorage.matrixBuffer=null,this._thinInstanceDataStorage.matrixBufferSize=E?E.length:32*b,this._thinInstanceDataStorage.matrixData=E,this._thinInstanceDataStorage.worldMatrices=null,null!==E?(this._thinInstanceDataStorage.instancesCount=E.length/b,this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",E,x),this.Da||this.thinInstanceRefreshBoundingInfo(!1)):(this._thinInstanceDataStorage.instancesCount=0,this.Da||this.refreshBoundingInfo());else if("previousMatrix"===M){var g;null===(g=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===g||g.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=null,this._thinInstanceDataStorage.previousMatrixData=E,null!==E&&(this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",E,x))}else{var n;if(M===k.g.ColorKind&&(M=k.g.ColorInstanceKind),null===E)null!==(n=this._userThinInstanceBuffersStorage)&&void 0!==n&&n.data[M]&&(this.removeVerticesData(M),delete this._userThinInstanceBuffersStorage.data[M],delete this._userThinInstanceBuffersStorage.strides[M],delete this._userThinInstanceBuffersStorage.sizes[M],delete this._userThinInstanceBuffersStorage.vertexBuffers[M]);else this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.data[M]=E,this._userThinInstanceBuffersStorage.strides[M]=b,this._userThinInstanceBuffersStorage.sizes[M]=E.length,this._userThinInstanceBuffersStorage.vertexBuffers[M]=new k.g(this.getEngine(),E,M,!x,!1,b,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[M])}},x.e.prototype.Nj=function(M){var E;if("matrix"===M)this.Jj&&this._thinInstanceDataStorage.matrixBuffer&&!this._thinInstanceDataStorage.matrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(M),null===(E=this._thinInstanceDataStorage.matrixBuffer)||void 0===E||E.updateDirectly(this._thinInstanceDataStorage.matrixData,0,this._thinInstanceDataStorage.instancesCount);else if("previousMatrix"===M){var b;this.Jj&&this._thinInstanceDataStorage.previousMatrixBuffer&&!this._thinInstanceDataStorage.previousMatrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(M),null===(b=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===b||b.updateDirectly(this._thinInstanceDataStorage.previousMatrixData,0,this._thinInstanceDataStorage.instancesCount)}else{var x;M===k.g.ColorKind&&(M=k.g.ColorInstanceKind),null!==(x=this._userThinInstanceBuffersStorage)&&void 0!==x&&x.vertexBuffers[M]&&(this.Jj&&!this._userThinInstanceBuffersStorage.vertexBuffers[M].isUpdatable()&&this._thinInstanceRecreateBuffer(M),this._userThinInstanceBuffersStorage.vertexBuffers[M].updateDirectly(this._userThinInstanceBuffersStorage.data[M],0))}},x.e.prototype.thinInstancePartialBufferUpdate=function(M,E,b){var x;"matrix"===M?this._thinInstanceDataStorage.matrixBuffer&&this._thinInstanceDataStorage.matrixBuffer.updateDirectly(E,b):(M===k.g.ColorKind&&(M=k.g.ColorInstanceKind),null!==(x=this._userThinInstanceBuffersStorage)&&void 0!==x&&x.vertexBuffers[M]&&this._userThinInstanceBuffersStorage.vertexBuffers[M].updateDirectly(E,b))},x.e.prototype.thinInstanceGetWorldMatrices=function(){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return[];const M=this._thinInstanceDataStorage.matrixData;if(!this._thinInstanceDataStorage.worldMatrices){this._thinInstanceDataStorage.worldMatrices=[];for(let E=0;E<this._thinInstanceDataStorage.instancesCount;++E)this._thinInstanceDataStorage.worldMatrices[E]=a.d.Id(M,16*E)}return this._thinInstanceDataStorage.worldMatrices},x.e.prototype.thinInstanceRefreshBoundingInfo=function(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0],E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return;const x=this._thinInstanceDataStorage.boundingVectors;if(M||!this.rawBoundingInfo){x.length=0,this.refreshBoundingInfo(E,b);const M=this.getBoundingInfo();this.rawBoundingInfo=new n.d(M.minimum,M.maximum)}const k=this.getBoundingInfo(),g=this._thinInstanceDataStorage.matrixData;if(0===x.length)for(let a=0;a<k.boundingBox.vectors.length;++a)x.push(k.boundingBox.vectors[a].clone());a.i.Fd[0].Kd(Number.POSITIVE_INFINITY),a.i.Fd[1].Kd(Number.NEGATIVE_INFINITY);for(let n=0;n<this._thinInstanceDataStorage.instancesCount;++n){a.d.FromArrayToRef(g,16*n,a.i.Matrix[0]);for(let M=0;M<x.length;++M)a.m.TransformCoordinatesToRef(x[M],a.i.Matrix[0],a.i.Fd[2]),a.i.Fd[0].minimizeInPlace(a.i.Fd[2]),a.i.Fd[1].maximizeInPlace(a.i.Fd[2])}k.reConstruct(a.i.Fd[0],a.i.Fd[1]),this.Ea()},x.e.prototype._thinInstanceRecreateBuffer=function(M){let E=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var b;if("matrix"===M)null===(b=this._thinInstanceDataStorage.matrixBuffer)||void 0===b||b.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",this._thinInstanceDataStorage.matrixData,E);else if("previousMatrix"===M){var x;if(this._scene.needsPreviousWorldMatrices)null===(x=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===x||x.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.previousMatrixData??this._thinInstanceDataStorage.matrixData,E)}else{var a;M===k.g.ColorKind&&(M=k.g.ColorInstanceKind),null===(a=this._userThinInstanceBuffersStorage.vertexBuffers[M])||void 0===a||a.dispose(),this._userThinInstanceBuffersStorage.vertexBuffers[M]=new k.g(this.getEngine(),this._userThinInstanceBuffersStorage.data[M],M,!E,!1,this._userThinInstanceBuffersStorage.strides[M],!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[M])}},x.e.prototype._thinInstanceUpdateBufferSize=function(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;M===k.g.ColorKind&&(M=k.g.ColorInstanceKind);const b="matrix"===M;if(!b&&(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.strides[M]))return;const x=b?16:this._userThinInstanceBuffersStorage.strides[M],a=b?this._thinInstanceDataStorage.matrixBufferSize:this._userThinInstanceBuffersStorage.sizes[M];let g=b?this._thinInstanceDataStorage.matrixData:this._userThinInstanceBuffersStorage.data[M];const n=(this._thinInstanceDataStorage.instancesCount+E)*x;let J=a;for(;J<n;)J*=2;if(!g||a!=J){if(g){const M=new Float32Array(J);M.set(g,0),g=M}else g=new Float32Array(J);var u,T,V;if(b){if(null===(u=this._thinInstanceDataStorage.matrixBuffer)||void 0===u||u.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",g,!1),this._thinInstanceDataStorage.matrixData=g,this._thinInstanceDataStorage.matrixBufferSize=J,this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData)null===(T=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===T||T.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",g,!1)}else null===(V=this._userThinInstanceBuffersStorage.vertexBuffers[M])||void 0===V||V.dispose(),this._userThinInstanceBuffersStorage.data[M]=g,this._userThinInstanceBuffersStorage.sizes[M]=J,this._userThinInstanceBuffersStorage.vertexBuffers[M]=new k.g(this.getEngine(),g,M,!0,!1,x,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[M])}},x.e.prototype._thinInstanceInitializeUserStorage=function(){this._userThinInstanceBuffersStorage||(this._userThinInstanceBuffersStorage={data:{},sizes:{},vertexBuffers:{},strides:{}})},x.e.prototype._disposeThinInstanceSpecificData=function(){var M;null!==(M=this._thinInstanceDataStorage)&&void 0!==M&&M.matrixBuffer&&(this._thinInstanceDataStorage.matrixBuffer.dispose(),this._thinInstanceDataStorage.matrixBuffer=null)}},11578:(M,E,b)=>{"use strict";b.d(E,{c:()=>V});var x=b(948),k=b(953),a=b(1124),g=b(962),n=b(970),J=b(11554),u=b(989);const T=n.d.Compose(n.m.One(),n.e.FromEulerAngles(0,Math.PI,0),n.m.Zero());class V extends J.d{get billboardMode(){return this._billboardMode}set billboardMode(M){this._billboardMode!==M&&(this._billboardMode=M,this._cache.useBillboardPosition=0!==(this._billboardMode&V.BILLBOARDMODE_USE_POSITION),this._computeUseBillboardPath())}get preserveParentRotationForBillboard(){return this._preserveParentRotationForBillboard}set preserveParentRotationForBillboard(M){M!==this._preserveParentRotationForBillboard&&(this._preserveParentRotationForBillboard=M,this._computeUseBillboardPath())}_computeUseBillboardPath(){this._cache.useBillboardPath=this._billboardMode!==V.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}get infiniteDistance(){return this._infiniteDistance}set infiniteDistance(M){this._infiniteDistance!==M&&(this._infiniteDistance=M)}constructor(M){let E=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(M,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,!1),this._forward=new n.m(0,0,1),this._up=new n.m(0,1,0),this._right=new n.m(1,0,0),this._position=n.m.Zero(),this._rotation=n.m.Zero(),this._rotationQuaternion=null,this._scaling=n.m.One(),this._transformToBoneReferal=null,this._isAbsoluteSynced=!1,this._billboardMode=V.BILLBOARDMODE_NONE,this._preserveParentRotationForBillboard=!1,this.scalingDeterminant=1,this._infiniteDistance=!1,this.ignoreNonUniformScaling=!1,this.reIntegrateRotationIntoRotationQuaternion=!1,this._poseMatrix=null,this.Mj=n.d.Zero(),this._usePivotMatrix=!1,this._absolutePosition=n.m.Zero(),this._absoluteScaling=n.m.Zero(),this._absoluteRotationQuaternion=n.e.Identity(),this._pivotMatrix=n.d.Identity(),this._postMultiplyPivotMatrix=!1,this._isWorldMatrixFrozen=!1,this._indexInSceneTransformNodesArray=-1,this.onAfterWorldMatrixUpdateObservable=new g.b,this._nonUniformScaling=!1,E&&this.va().addTransformNode(this)}getClassName(){return"pb"}get position(){return this._position}set position(M){this._position=M,this._markAsDirtyInternal()}isUsingPivotMatrix(){return this._usePivotMatrix}isUsingPostMultiplyPivotMatrix(){return this._postMultiplyPivotMatrix}get rotation(){return this._rotation}set rotation(M){this._rotation=M,this._rotationQuaternion=null,this._markAsDirtyInternal()}get ve(){return this._scaling}set ve(M){this._scaling=M,this._markAsDirtyInternal()}get rotationQuaternion(){return this._rotationQuaternion}set rotationQuaternion(M){this._rotationQuaternion=M,M&&this._rotation.Kd(0),this._markAsDirtyInternal()}_markAsDirtyInternal(){this._isDirty||(this._isDirty=!0,this.customMarkAsDirty&&this.customMarkAsDirty())}get forward(){return n.m.TransformNormalFromFloatsToRef(0,0,this.va().useRightHandedSystem?-1:1,this.getWorldMatrix(),this._forward),this._forward.normalize()}get up(){return n.m.TransformNormalFromFloatsToRef(0,1,0,this.getWorldMatrix(),this._up),this._up.normalize()}get right(){return n.m.TransformNormalFromFloatsToRef(this.va().useRightHandedSystem?-1:1,0,0,this.getWorldMatrix(),this._right),this._right.normalize()}updatePoseMatrix(M){return this._poseMatrix?(this._poseMatrix.p(M),this):(this._poseMatrix=M.clone(),this)}getPoseMatrix(){return this._poseMatrix||(this._poseMatrix=n.d.Identity()),this._poseMatrix}_isSynchronized(){const M=this._cache;return this._billboardMode===M.billboardMode&&this._billboardMode===V.BILLBOARDMODE_NONE&&(!M.pivotMatrixUpdated&&(!this._infiniteDistance&&(!this._position._isDirty&&(!this._scaling._isDirty&&!(this._rotationQuaternion&&this._rotationQuaternion._isDirty||this._rotation._isDirty)))))}_initCache(){super._initCache();const M=this._cache;M.localMatrixUpdated=!1,M.billboardMode=-1,M.infiniteDistance=!1,M.useBillboardPosition=!1,M.useBillboardPath=!1}get absolutePosition(){return this.getAbsolutePosition()}get absoluteScaling(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling}get absoluteRotationQuaternion(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion}setPreTransformMatrix(M){return this.setPivotMatrix(M,!1)}setPivotMatrix(M){let E=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._pivotMatrix.p(M),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=E,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=n.d.Invert(this._pivotMatrix)),this}getPivotMatrix(){return this._pivotMatrix}instantiateHierarchy(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,E=arguments.length>1?arguments[1]:void 0,b=arguments.length>2?arguments[2]:void 0;const x=this.clone("Clone of "+(this.name||this.id),M||this.parent,!0);x&&b&&b(this,x);for(const k of this.getChildTransformNodes(!0))k.instantiateHierarchy(x,E,b);return x}ai(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return M?arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(this._rotation.Kd(0),this._rotationQuaternion=this._rotationQuaternion||n.e.Identity(),M.decompose(this._scaling,this._rotationQuaternion,this._position),this.ce(!0)):(this._worldMatrix=M,this._absolutePosition.Hd(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._afterComputeWorldMatrix()):(this._isWorldMatrixFrozen=!1,this.ce(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this}unfreezeWorldMatrix(){return this._isWorldMatrixFrozen=!1,this.ce(!0),this}get pj(){return this._isWorldMatrixFrozen}getAbsolutePosition(){return this.ce(),this._absolutePosition}setAbsolutePosition(M){if(!M)return this;let E,b,x;if(void 0===M.x){if(arguments.length<3)return this;E=arguments[0],b=arguments[1],x=arguments[2]}else E=M.x,b=M.y,x=M.z;if(this.parent){const M=n.i.Matrix[0];this.parent.getWorldMatrix().invertToRef(M),n.m.TransformCoordinatesFromFloatsToRef(E,b,x,M,this.position)}else this.position.x=E,this.position.y=b,this.position.z=x;return this._absolutePosition.p(M),this}setPositionWithLocalVector(M){return this.ce(),this.position=n.m.TransformNormal(M,this.Mj),this}getPositionExpressedInLocalSpace(){this.ce();const M=n.i.Matrix[0];return this.Mj.invertToRef(M),n.m.TransformNormal(this.position,M)}locallyTranslate(M){return this.ce(!0),this.position=n.m.TransformCoordinates(M,this.Mj),this}lookAt(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const a=V._LookAtVectorCache,g=0===k?this.position:this.getAbsolutePosition();if(M.subtractToRef(g,a),this.setDirection(a,E,b,x),1===k&&this.parent)if(this.rotationQuaternion){const M=n.i.Matrix[0];this.rotationQuaternion.toRotationMatrix(M);const E=n.i.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(E),E.invert(),M.multiplyToRef(E,M),this.rotationQuaternion.fromRotationMatrix(M)}else{const M=n.i.Quaternion[0];n.e.FromEulerVectorToRef(this.rotation,M);const E=n.i.Matrix[0];M.toRotationMatrix(E);const b=n.i.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(b),b.invert(),E.multiplyToRef(b,E),M.fromRotationMatrix(E),M.toEulerAnglesToRef(this.rotation)}return this}hf(M){const E=n.m.Zero();return this.getDirectionToRef(M,E),E}getDirectionToRef(M,E){return n.m.TransformNormalToRef(M,this.getWorldMatrix(),E),this}setDirection(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const k=-Math.atan2(M.z,M.x)+Math.PI/2,a=Math.sqrt(M.x*M.x+M.z*M.z),g=-Math.atan2(M.y,a);return this.rotationQuaternion?n.e.RotationYawPitchRollToRef(k+E,g+b,x,this.rotationQuaternion):(this.rotation.x=g+b,this.rotation.y=k+E,this.rotation.z=x),this}setPivotPoint(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;0==this.va().getRenderId()&&this.ce(!0);const b=this.getWorldMatrix();if(1==E){const E=n.i.Matrix[0];b.invertToRef(E),M=n.m.TransformCoordinates(M,E)}return this.setPivotMatrix(n.d.Translation(-M.x,-M.y,-M.z),!0)}getPivotPoint(){const M=n.m.Zero();return this.getPivotPointToRef(M),M}getPivotPointToRef(M){return M.x=-this._pivotMatrix.m[12],M.y=-this._pivotMatrix.m[13],M.z=-this._pivotMatrix.m[14],this}getAbsolutePivotPoint(){const M=n.m.Zero();return this.getAbsolutePivotPointToRef(M),M}getAbsolutePivotPointToRef(M){return this.getPivotPointToRef(M),n.m.TransformCoordinatesToRef(M,this.getWorldMatrix(),M),this}ge(M){if(this._isDirty)return this;if(this._children)for(const E of this._children)E.ge(M);return super.ge(M)}setParent(M){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!M&&!this.parent)return this;const x=n.i.Quaternion[0],k=n.i.Fd[0],a=n.i.Fd[1],g=n.i.Matrix[1];n.d.IdentityToRef(g);const J=n.i.Matrix[0];this.ce(!0);let u=this.rotationQuaternion;return u||(u=V._TmpRotation,n.e.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,u)),n.d.ComposeToRef(this.ve,u,this.position,J),this.parent&&J.multiplyToRef(this.parent.ce(!0),J),M&&(M.ce(!0).invertToRef(g),J.multiplyToRef(g,J)),J.decompose(a,x,k,E?this:void 0),this.rotationQuaternion?this.rotationQuaternion.p(x):x.toEulerAnglesToRef(this.rotation),this.ve.p(a),this.position.p(k),this.parent=M,b&&this.setPivotMatrix(n.d.Identity()),this}addChild(M){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return M.setParent(this,E),this}removeChild(M){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return M.setParent(null,E),this}get nonUniformScaling(){return this._nonUniformScaling}_updateNonUniformScalingState(M){return this._nonUniformScaling!==M&&(this._nonUniformScaling=M,!0)}attachToBone(M,E){return this._currentParentWhenAttachingToBone=this.parent,this._transformToBoneReferal=E,this.parent=M,M.getSkeleton().prepare(!0),M.getFinalMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this}detachFromBone(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=M?this._currentParentWhenAttachingToBone:null,this):(M&&(this.parent=this._currentParentWhenAttachingToBone),this)}rotate(M,E,b){let x;if(M.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.Kd(0)),b&&0!==b){if(this.parent){const b=this.parent.getWorldMatrix(),x=n.i.Matrix[0];b.invertToRef(x),M=n.m.TransformNormal(M,x),b.determinant()<0&&(E*=-1)}x=n.e.RotationAxisToRef(M,E,V._RotationAxisCache),x.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else x=n.e.RotationAxisToRef(M,E,V._RotationAxisCache),this.rotationQuaternion.multiplyToRef(x,this.rotationQuaternion);return this}rotateAround(M,E,b){E.normalize(),this.rotationQuaternion||(this.rotationQuaternion=n.e.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.Kd(0));const x=n.i.Fd[0],k=n.i.Fd[1],a=n.i.Fd[2],g=n.i.Quaternion[0],J=n.i.Matrix[0],u=n.i.Matrix[1],T=n.i.Matrix[2],V=n.i.Matrix[3];return M.subtractToRef(this.position,x),n.d.TranslationToRef(x.x,x.y,x.z,J),n.d.TranslationToRef(-x.x,-x.y,-x.z,u),n.d.RotationAxisToRef(E,b,T),u.multiplyToRef(T,V),V.multiplyToRef(J,V),V.decompose(k,g,a),this.position.addInPlace(a),g.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this}translate(M,E,b){const x=M.scale(E);if(b&&0!==b)this.setAbsolutePosition(this.getAbsolutePosition().add(x));else{const M=this.getPositionExpressedInLocalSpace().add(x);this.setPositionWithLocalVector(M)}return this}addRotation(M,E,b){let x;this.rotationQuaternion?x=this.rotationQuaternion:(x=n.i.Quaternion[1],n.e.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,x));const k=n.i.Quaternion[0];return n.e.RotationYawPitchRollToRef(E,M,b,k),x.multiplyInPlace(k),this.rotationQuaternion||x.toEulerAnglesToRef(this.rotation),this}_getEffectiveParent(){return this.parent}isWorldMatrixCameraDependent(){return this._infiniteDistance&&!this.parent||this._billboardMode!==V.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}ce(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0],E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;const b=this.va().getRenderId();if(!this._isDirty&&!M&&(this._currentRenderId===b||this.isSynchronized()))return this._currentRenderId=b,this._worldMatrix;E=E||this.va().activeCamera,this._updateCache();const x=this._cache;x.pivotMatrixUpdated=!1,x.billboardMode=this.billboardMode,x.infiniteDistance=this.infiniteDistance,x.parent=this._parentNode,this._currentRenderId=b,this._childUpdateId+=1,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;const k=this._getEffectiveParent(),a=V._TmpScaling;let g,J=this._position;if(this._infiniteDistance&&!this.parent&&E){const M=E.getWorldMatrix(),b=new n.m(M.m[12],M.m[13],M.m[14]);J=V._TmpTranslation,J.Hd(this._position.x+b.x,this._position.y+b.y,this._position.z+b.z)}if(a.Hd(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant),this._rotationQuaternion){if(this._rotationQuaternion._isDirty=!1,g=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion){this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(n.e.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.Hd(0,0,0))}}else g=V._TmpRotation,n.e.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,g);if(this._usePivotMatrix){const M=n.i.Matrix[1];n.d.ScalingToRef(a.x,a.y,a.z,M);const E=n.i.Matrix[0];g.toRotationMatrix(E),this._pivotMatrix.multiplyToRef(M,n.i.Matrix[4]),n.i.Matrix[4].multiplyToRef(E,this.Mj),this._postMultiplyPivotMatrix&&this.Mj.multiplyToRef(this._pivotMatrixInverse,this.Mj),this.Mj.addTranslationFromFloats(J.x,J.y,J.z)}else n.d.ComposeToRef(a,g,J,this.Mj);if(k&&k.getWorldMatrix){if(M&&k.ce(M),x.useBillboardPath){if(this._transformToBoneReferal){const M=this.parent;M.getSkeleton().prepare(),M.getFinalMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),n.i.Matrix[7])}else n.i.Matrix[7].p(k.getWorldMatrix());const M=n.i.Fd[5],E=n.i.Fd[6],b=n.i.Quaternion[0];n.i.Matrix[7].decompose(E,b,M),n.d.ScalingToRef(E.x,E.y,E.z,n.i.Matrix[7]),n.i.Matrix[7].setTranslation(M),V.BillboardUseParentOrientation&&(this._position.applyRotationQuaternionToRef(b,M),this.Mj.setTranslation(M)),this.Mj.multiplyToRef(n.i.Matrix[7],this._worldMatrix)}else if(this._transformToBoneReferal){const M=this.parent;M.getSkeleton().prepare(),this.Mj.multiplyToRef(M.getFinalMatrix(),n.i.Matrix[6]),n.i.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)}else this.Mj.multiplyToRef(k.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.p(this.Mj);if(x.useBillboardPath&&E&&this.billboardMode&&!x.useBillboardPosition){const M=n.i.Fd[0];if(this._worldMatrix.getTranslationToRef(M),n.i.Matrix[1].p(E.getViewMatrix()),this._scene.useRightHandedSystem&&n.i.Matrix[1].multiplyToRef(T,n.i.Matrix[1]),n.i.Matrix[1].setTranslationFromFloats(0,0,0),n.i.Matrix[1].invertToRef(n.i.Matrix[0]),(this.billboardMode&V.BILLBOARDMODE_ALL)!==V.BILLBOARDMODE_ALL){n.i.Matrix[0].decompose(void 0,n.i.Quaternion[0],void 0);const M=n.i.Fd[1];n.i.Quaternion[0].toEulerAnglesToRef(M),(this.billboardMode&V.BILLBOARDMODE_X)!==V.BILLBOARDMODE_X&&(M.x=0),(this.billboardMode&V.BILLBOARDMODE_Y)!==V.BILLBOARDMODE_Y&&(M.y=0),(this.billboardMode&V.BILLBOARDMODE_Z)!==V.BILLBOARDMODE_Z&&(M.z=0),n.d.RotationYawPitchRollToRef(M.y,M.x,M.z,n.i.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(n.i.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(n.i.Fd[0])}else if(x.useBillboardPath&&E&&x.useBillboardPosition){const M=n.i.Fd[0];this._worldMatrix.getTranslationToRef(M);const b=E.globalPosition;this._worldMatrix.invertToRef(n.i.Matrix[1]);const x=n.i.Fd[1];n.m.TransformCoordinatesToRef(b,n.i.Matrix[1],x),x.normalize();const k=-Math.atan2(x.z,x.x)+Math.PI/2,a=Math.sqrt(x.x*x.x+x.z*x.z),g=-Math.atan2(x.y,a);if(n.e.RotationYawPitchRollToRef(k,g,0,n.i.Quaternion[0]),(this.billboardMode&V.BILLBOARDMODE_ALL)!==V.BILLBOARDMODE_ALL){const M=n.i.Fd[1];n.i.Quaternion[0].toEulerAnglesToRef(M),(this.billboardMode&V.BILLBOARDMODE_X)!==V.BILLBOARDMODE_X&&(M.x=0),(this.billboardMode&V.BILLBOARDMODE_Y)!==V.BILLBOARDMODE_Y&&(M.y=0),(this.billboardMode&V.BILLBOARDMODE_Z)!==V.BILLBOARDMODE_Z&&(M.z=0),n.d.RotationYawPitchRollToRef(M.y,M.x,M.z,n.i.Matrix[0])}else n.d.FromQuaternionToRef(n.i.Quaternion[0],n.i.Matrix[0]);this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(n.i.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(n.i.Fd[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):k&&k._nonUniformScaling?this._updateNonUniformScalingState(k._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.Hd(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=n.d.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix}resetLocalMatrix(){let M=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.ce(),M){const M=this.getChildren();for(let E=0;E<M.length;++E){const b=M[E];if(b){b.ce();const M=n.i.Matrix[0];b.Mj.multiplyToRef(this.Mj,M);const E=n.i.Quaternion[0];M.decompose(b.ve,E,b.position),b.rotationQuaternion?b.rotationQuaternion.p(E):E.toEulerAnglesToRef(b.rotation)}}}this.ve.Hd(1,1,1),this.position.Hd(0,0,0),this.rotation.Hd(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=n.e.Identity()),this._worldMatrix=n.d.Identity()}_afterComputeWorldMatrix(){}registerAfterWorldMatrixUpdate(M){return this.onAfterWorldMatrixUpdateObservable.add(M),this}unregisterAfterWorldMatrixUpdate(M){return this.onAfterWorldMatrixUpdateObservable.removeCallback(M),this}getPositionInCameraSpace(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return M||(M=this.va().activeCamera),n.m.TransformCoordinates(this.getAbsolutePosition(),M.getViewMatrix())}getDistanceToCamera(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return M||(M=this.va().activeCamera),this.getAbsolutePosition().Qc(M.globalPosition).length()}clone(M,E,b){const x=a.b.Clone((()=>new V(M,this.va())),this);if(x.name=M,x.id=M,E&&(x.parent=E),!b){const E=this.getDescendants(!0);for(let b=0;b<E.length;b++){const k=E[b];k.clone&&k.clone(M+"."+k.name,x)}}return x}serialize(M){const E=a.b.Serialize(this,M);return E.type=this.getClassName(),E.uniqueId=this.uniqueId,this.parent&&this.parent._serializeAsParent(E),E.localMatrix=this.getPivotMatrix().Vd(),E.isEnabled=this.isEnabled(),a.b.AppendSerializedAnimations(this,E),E.ranges=this.serializeAnimationRanges(),E}static Parse(M,E,b){const x=a.b.Parse((()=>new V(M.name,E)),M,E,b);if(M.localMatrix?x.setPreTransformMatrix(n.d.Id(M.localMatrix)):M.pivotMatrix&&x.setPivotMatrix(n.d.Id(M.pivotMatrix)),x.wg(M.isEnabled),x._waitingParsedUniqueId=M.uniqueId,void 0!==M.parentId&&(x._waitingParentId=M.parentId),void 0!==M.parentInstanceIndex&&(x._waitingParentInstanceIndex=M.parentInstanceIndex),M.animations){for(let E=0;E<M.animations.length;E++){const b=M.animations[E],k=(0,u.e)("BABYLON.Animation");k&&x.animations.push(k.Parse(b))}J.d.ParseAnimationRanges(x,M,E)}return M.autoAnimate&&E.beginAnimation(x,M.autoAnimateFrom,M.autoAnimateTo,M.autoAnimateLoop,M.autoAnimateSpeed||1),x}getChildTransformNodes(M,E){const b=[];return this._getDescendants(b,M,(M=>(!E||E(M))&&M instanceof V)),b}dispose(M){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.va().stopAnimation(this),this.va().removeTransformNode(this),this._parentContainer){const M=this._parentContainer.transformNodes.indexOf(this);M>-1&&this._parentContainer.transformNodes.splice(M,1),this._parentContainer=null}if(this.onAfterWorldMatrixUpdateObservable.clear(),M){const M=this.getChildTransformNodes(!0);for(const E of M)E.parent=null,E.ce(!0)}super.dispose(M,E)}normalizeToUnitCube(){let M=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2?arguments[2]:void 0,x=null,k=null;E&&(this.rotationQuaternion?(k=this.rotationQuaternion.clone(),this.rotationQuaternion.Hd(0,0,0,1)):this.rotation&&(x=this.rotation.clone(),this.rotation.Hd(0,0,0)));const a=this.getHierarchyBoundingVectors(M,b),g=a.max.Qc(a.min),n=Math.max(g.x,g.y,g.z);if(0===n)return this;const J=1/n;return this.ve.scaleInPlace(J),E&&(this.rotationQuaternion&&k?this.rotationQuaternion.p(k):this.rotation&&x&&this.rotation.p(x)),this}_syncAbsoluteScalingAndRotation(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)}}V.BILLBOARDMODE_NONE=0,V.BILLBOARDMODE_X=1,V.BILLBOARDMODE_Y=2,V.BILLBOARDMODE_Z=4,V.BILLBOARDMODE_ALL=7,V.BILLBOARDMODE_USE_POSITION=128,V.BillboardUseParentOrientation=!1,V._TmpRotation=n.e.Zero(),V._TmpScaling=n.m.Zero(),V._TmpTranslation=n.m.Zero(),V._LookAtVectorCache=new n.m(0,0,0),V._RotationAxisCache=new n.e,(0,x.d)([(0,k.C)("position")],V.prototype,"_position",void 0),(0,x.d)([(0,k.C)("rotation")],V.prototype,"_rotation",void 0),(0,x.d)([(0,k.w)("rotationQuaternion")],V.prototype,"_rotationQuaternion",void 0),(0,x.d)([(0,k.C)("ve")],V.prototype,"_scaling",void 0),(0,x.d)([(0,k.E)("billboardMode")],V.prototype,"_billboardMode",void 0),(0,x.d)([(0,k.E)()],V.prototype,"scalingDeterminant",void 0),(0,x.d)([(0,k.E)("infiniteDistance")],V.prototype,"_infiniteDistance",void 0),(0,x.d)([(0,k.E)()],V.prototype,"ignoreNonUniformScaling",void 0),(0,x.d)([(0,k.E)()],V.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0)},12127:(M,E,b)=>{"use strict";b.d(E,{d:()=>g});var x=b(942),k=b(10496);let a=0;const g=M=>{if(!M.environmentBRDFTexture){const E=M.useDelayedTextureLoading;M.useDelayedTextureLoading=!1;const b=M._blockEntityCollection;M._blockEntityCollection=!1;const g=x.e.CreateFromBase64String("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR42u29yY5tWXIlZnbuiSaTbZFUkZRKrCKhElASQA0EoQABgn6hJvoXzfUP+gP9hWb6Bg00IgRoQJaKqUxmZmTEe8/v0uB2u7Fm2T7HIyIrnz88uPvt3f2a2WrMbOvf/u3PvvzP/sUf/N6//i8vf/lv/3v5H//d//Sb//Uq/5u8yf8hV/m/5Cp/L1f5hVzlG7nKJ7mKyJuIXN/hPwqXI/g++zq6rPI5u8z+WqfLre+zy7PrVv9L8brsMiGvk8XLmM/sdfHXal4e3ad6GXPdyu2ij8u/+uv/5cuf/OSLfdtEfvUr+dnf/d0X//t3H/7bf/hP//N/928h/0Yg/4VA/kogfyGQP5Wr/IFAvhbIlwK5CGQTPP+9z5uPeePJSW+yo2+s/GtN30Rnv1E+f5zxof9R/lSXv/nr//mrr3+i+5dfyX7ZZQP07Tffys//8R/l/9TtX7790T/7r/8G8pdy+/8XAvnnAvkzgfwzgfyxQP5AIL8vkJ8K5KsmMVzu1U7p5PA5AXxOAJ8TwPf7sX/51ZeXfcemqnp9w/W77/S7X/6T/vzf/7383RWCX3/z05/9i3/13/0PX//eX/2FyP8tIv+PiPy9iPy/IvIzEfm5iPxCRH4lIt/c/393//9BRD6KyKf7f488fP74/PH544dJAF9cLl98IZfLBZtuqterXr/7Dt9982v95S9+Lv+gF/3i7Spv/8lf/vnf/vGf/dF/JfKnIvLnIvLvReQ/NEngn0TklyLy6/v/34jIt00iGJOBlxAsdvv54/PH5493SQCXy9t2ueh2ueimKorrFbjq9eNH+fDtb+TXv/ol/vHyhX4Fxfbx7euPf/Lnf/PfiPyeiPyhiPxxkwB+fk8AvxzQgJcIrGTwFsiAEXH4/PH54/PHUgLY7whgu2C7bLqpQgHB2xvePn6SDx8+6G9+84384vKF/IPu8iVU9Y/+7C/+jWxffiHytYj8VER+X0T+oEEBvxqQwCMJeIngo5EI3goIwVMIPn98/vj8ESaAbbtu2ybbvl8u2ybbdtluSECA65u8ffqIDx8+6G++/VZ/efkV/sO261dQXP7wT/7kX8vl8qXIFyLylbySwe/dE0CLAr65B/9vGn0gQwRMMqgmhM/J4fPH548eAezbZd/lsm3YtssNAYiqiogAAkCvb5/k46cP8u2HD/rrb7+R/2/b9Wu9yJe//8d/9Ney6S5yEZFdRL68/38khG/uKOCnAwoYkcCoEXwkEgGDDq7CeQfyOTl8/vhd1QCum26ybZtu2yabbrKpQvXue1yvuF6v+vbpTT5+/CDffviAX1++1V9sO77WXb/66R/+4V/dgkbllQi+aBLBV/dE8LWRALwkYCWCNyMZXElkwLTMeMkga/P4/PH547ccAVwuctkvdxSw6bbdtYDbTfSZBN7e8PHTR/3u4wf55vKd/nL7DX6mu3791U9//5+/gkNFZGuSgZUQvnKowKgLWLTAQgRtEniTuEfwaELw0MJvf3LQzynud+53uG+X6y3gN9kul+2y6XVT1U27JCDAFVc8ksAn/e7jR/nN5YP+avtWfq6Xy9f7Vz/9w1dgRYngiyYhfNkkgzYBWHTg44AEMmqQUYQKOmDaiCIa8TmsfmzB+DnZDQjgcpGLbti2y3bZHjRAdRMVvb/dcYU8kcDbPQlsH/CrbddfbF98+RPZfvLFnAQeieCRDC5DMvju/vmD4JkEvjRQgKULeGggowdHkAHTYxihg89vu88I5UeGAPSOAFTlrgPopiqbKPSmCKreUoAAkCcSePukHz590m8vH+WbD9/JP335k6/+tA86KxFchv8jMvhiogE4JQm8XhfKqOAqx5qRPyeGzx8/cgSwbXcUoLJtim27C4Oi93+4v6VxQwKAvl2v+Hj9pB8+fZJvt4/yzfbF9lPdv/wJnsE2BogmyeCRED40tGFvksIXiSbgiYSRRpDNDZ6BDI6ghM+J4fPHeyKAO+zX7cb9t4tedMMNAQju5V+f1uAtBSiu1zsduMrHy5t8ePsk3376KN98sX/xE5FPAnm7/782o0DiUINXMkCXCB7/P94/e87AWUmARQWVvgMuKej9t1RLBp+Tw+ePgwngsutFFdu26WXbbl+rSvdfbnqAiuA23QcBgCugV1zl7e1NPm5v+LC96XfbJ/1W9y++fgXjA3bDYXV+MuhRwSPwL3JLMFYC+HS/LU8HYrGwIhwyNOF12SvgM4SgztdifP85MXz+KGsA2C6X7aJ6bXSAOwrY5OYIqGy3d5uq4P5GhABXuV6veLvRAf10fZMPb2/y3b7vX7+g+9v98/WOBq7GG7RNAlYy+Dgkhhb+Xxp0sE8IAC4SGAP/TbgVJK/PoJPBnAiwPKxsXfbbnRg+i3s/JAK4Q/4b9NfLtomBAqCickMBjy7BuywAUVyv8na94tMjCVzf9KNcLl/0SeA6oAEYb1i9g+FtSALb/bKL8/+t+wxXFMyswqiHoK4ToIgKqslgpg1qUC0QoYbvJZg/B/q5v4szHmPX7YEAsD0CX25OwEUVm9xag1+agKg+nxQArnKjAtDr9U0+Xd/k4/UqH7bL5YsewrcBBiMJZPRAp6TwQgWfjM9vgRbgUYGL8AvLWH2gqhesCokeUmCSwPsnhs8fP2YNYMO2XeSmAWxy2VQaXeDmDIhApf33rD4PTUCuV+DtCn27XuXT5ir8VmCJ2G5BpBM8/r/dEcJb8/0lEQMtJHA5TAlqNuLRhJChhEpSqFabH3di+G1AGj+W1/dyAR4IYJNNnuLf6+tWC9CHHiAtFhAIFLjK2/Uqn65X+SS67aK+3QeTDoy/IG2ogQ7fb/dAtz5vBgrYGqrwNtCHsVfgIvwK07OTQBURVNCBFpKCOjqCHn5L/67TgTN+fpySAC56nwSUi256kXsSuFGAVyLoUIDo8/Pz7fdoErr/v17lk162HbgHvFpIYDfoAJJfW4sGPjkU4VNAF8ZEcLmLhdc7kljdY1y1Dq9yLiI4IiRqcLujb138KIPn80ejATwRwIbtBvn1cqv+2J78/5EI5N4cJA8qIPcmwRsKAHDF9WYP6mV7VmrgLuTpxYTcMEW0LAmoQxFsuvAI8tv/a/C5fV2ZMMiKg++FCM7RDPRu8ebWY7VG6VJi+Bzk35MI2LsAckMAgwvQ0gC5DQjd3ABg2HQLAPpEAlZ1Bu7VV7MGHDFRAbo3VKsTbAY9sPWC/uvx86gBbDK3D1eEQS8pbAeSgSwmhepnJb6uBv/o/PzHLzxWA/X7TH77De5j6AGQi6o0CUGfCOD2X7cXAlCFQABtEsGLDtxuOyQB2UTQBKZe5GUPXgkUYCUAbZJRhBDeuq8xBf+bgwbehDm+BFQi2IJksOocvA8ysIMfxluVcRsY/eB3JzH8GFDAXQO48X/dcIf9jyDHptIigDsFkEe066tBSETQUYF7ElDdYEBytN4+rk9UcBPfrKaZqFHWcw3i4J8/X4ev2//bSXqAhwTay6OEIPLD2Ipt8OtAGzxkwLw9WVFRjTc/qC6H3+YK/b1oAA0KuOizHfieCLaHHiAb5NYTIC9EMEbZrVEQt1xwhVy1UfBh8PUOquMizwaap3tQXfY5B//tea/NZdfhsvbz+PURQTDSGWB87VX/7WSd4KxjUqrIgE0IUkoKGnhIvwvawpGf6eECXJ7tv4qbA7DJgwpsKthEmmYgfaAAffYF3HLxo0vwNjJ0SwRWMG4db4eh1gPNm18vQ+us/0eGmxDemu/fnM/X4evq/8342ksGHgLY5LyT/zg0wM8lcMjgGFXwqIOVFJBQw99eCvF9oZL9Mfl3QwAvIXDsBRC9R+fz8x0FPBLB0xJEpwUobrfAkARgIAF41h3wQgP6QAmX5E/7eI43IxGwwf/moIkRyWRJQIPgt9CA9b39nzt4bYUWjAlCjWDPgv8IEjgLJfzuaAsrv9VdVG4OwOXW/fdoA35qAdL0BDwvf6AAUVHd8LIEu94A3K+Q+2YxaB84MOH62P//qoo38fCRDERE2zf0JfmDa+MieElAjcDPKz+mRKCOtdgGtXaBjgNJ4H2owSpNeAW/rRH4CaHSpMwnBYYycjgSJwfie9CR6mPu20Uv8kABF206AvXlBMiIBPSlB9wjBW1fwEuSb94296VCqgMaGCt/G1BbExi3IG+r3a3J6P48Gv/J0YmEYoiGY7V/SxwFCwGoE/xa0AJ0CEiV9QPCJb1OJ5F1VTjEY2/MO9AEJvj1BJTQpqLfTlGwjABuzT962e4IoKnyrdh3+/6mzDVJ4PHOxj0JqGKoy20+wBMN6D1gLWi9NQHfVP5MEEPzjGYy8BMAOnTAJgEr8HUIejRo5xrA5xkR5AngmiSHs+zDDAmMgWzTg55GSJEmHE8IvWPAoYTfhWak/Wn/bQ0CGLSAjv83SUEfKp5q24LXuQICpzrjrgWoza8xVE00CQCORdhMJuTUT/rjuls0gO4Iby8BIEgK6gS7BsGuTtDrScH/fR68biUHNVGBnxjeNyHEvQe/ve3LZQqgG3rof6cEclsNflG9J4KtaQ8WHcVBHS1BtHE4QP9OBMS98mpbKTeDW7dJwRsnHpMBTFJpV4I+b0kY/NqInVFSyBLANbnMSgBM8F+Fqfxq/h657/Up+GaBnwV9hRqc9bZ/vA6vu+T9E8KPJWns94UfTeCj2QXwCHS9dNL8Xf3Ho/rfewSeFODGDV69AU0y6NFAE1DP3qK++rdB7/1HRxf86gT376zOr99T/h/ioBiXWQkgQgVeIrCC/WomhDmQK+hASI2ARQZKooHMLdCJwGEBBXC3+uERwg+VOHZ9ioAt9H80AI06wGgJ3nQA3BoCut6AhxYwgcPOFnxuFnrphk+NIKIGrWPQtgz3b0i7Y6D5rs1GKqTop0nQX52vmQC4BkjA+r4a7Kx9WLENGeegkhSETBCrNXIMdi/444Rw1n6E96ry7OPuj8UfLxtQ78NA2iSBbg7gIiIbdDLsb5agPhLC3RkYKv8NDbS2YGsatNRAG2oQwf9ZIOydgy1MAzBkAw8UwEEIDzSAqdPQ6za0PkeJAMH3Z0wXniUSZoHvBXU2mcjQgv56TedIKglCpIoQfgwCIjOytd8WgN0bfxoR8Fn9Gx0Aj5Zgq0lIZbsH/ibSJoFnS+C98g9ooHEELI3gliy25yONIiE6pb0NfBlyNEYyENoodkKwgl6I6s8kARgJ4ZoEfuYWHLEJa0LhSBXm7kImGeSfVdoJ1DO2G7WXsehAptupSOoyrCSF904k+6vt98X/ZcM98Hsd4JYIXhQAIg3/f9AAUYhsLQKAtkHVBnzjCKhOoYl2ym+iBtvzDzQ2DLXJ4PUmbJHAVnBQX4jkxfvHhNDqAdHXGQJgv0aSDGItgOseHIU+K9hXnIJzkoGlEKzNHagTdJ6VWEUH4iCKH4fd2AwDPaYBm4Wgng4gQ9V/CoGiuNmD04AQtNGMGzSAAQ2I2pzfogY9LRh7BrbOh4+D30sAencljFu2CUFrwY8UAWRfWwGvVOVfbx2uIILM0pwDv082dUTw8hYs8L+uIWiHGpWgClnAa1lMPJogovvvbePPs/q3Xr++kgCsfgB5oQF9WYKPJqEn6G+OE3i5AqouF59FQOmahQC8rlPLj38kg1c2f30vw+XaoIX24/pMGIgSBoZqoH3wo0sIIGlA9PWcCPrAtpPB8eBf6x1o6cHra+2+tpIFP4PgBfxZtZUJfo4qxELT948D9ucK8Mt9+ccjIQw6QJcEbrD/1g340ATuDgDkFfx6twSf1f9xvuBECYxq/7ythQQGm+5JDx6Brw4CkMGT3wgscCUoQ4sU2t6DR2ciBjTgtcpenQoZVX9NuL4Owc+dVaDursYVkVALX+shjSBKBuvCYDUZjE5BdNkxdHAUBexyHwB6NP7Iyw7sxUDViwge1t+mz8B/LAvVx/c3PeBBCToB8IUGOgqA3iV4yUg6UAOxaUFHDx6CYS8SorMOue0CCJGAf5YfRhoAI+A1CvwxqNkAY5yAIx2EQmkFfeWOXi+nEdSQQA0ZHMEItiagJArQxDXIrj8nCfQi4HZPAttrIahso9oPQ/2/JwV5JQU8zw+7I4D7/sBn4EO6rjw0FR+i3Z9fHtahzsFvJgM0X+tmVH5vaYiNDGAigewAz+gyNLThnjCURQFR1b9d3lZvnVqmj9mEPDKIUIC4KCCjBXywS4N+otp/Hk3QVthOkwEKlV9PQwXjT7s/zwF4Qf9toAAzFdjuaEB6S7D1//U5FIQu2MevO0rQQH8ZmoXE6B/IkgE60XCjVoq8gt2iCG0S8L5GdxkM1cGsfsCMArSCAnrr7dzAZxCEEpepvB8tqHJ/q+bmJGGts/AcAXFOMMeTwC7Pw0B6CtCtA2vWgonqBQJFSwH0JQK29OB2kvgj2HHXAoyeAIsCQO0kMNECAhFMqCBf8mElAkyBbX1tJQP2RJ/ha0gpAfS9l+/5n00CkrQpq0MZbOdAuxmMvHswog62jZj7BnYQe19b14kxNq2D/ehX/p68HEcF+x3yP7z/V/A/q/5DA3i5A/dzA5pdgbKp3v3/wQF4Bb70WkCTHGRAA6+KL0bFl6FJaFw0ImZwm6igSwbbwPn9RMBWf3sN2JgA/BVh/Rg0kQBgePf6HglAHLFQwqQQOwDjbdVxNZjR4iM6Qa3WxwvNxh0JFb3g/WzFQQS8b/ttKcDWoABtUMAd8j9hf0MB2uDXhzX4CHj03L9DBU3Qjz0C0l4mLSLQPicOOwZoVCB6P6dA7nDbGkVuxcNr8PU2JQO4wX5trEqmccZaHU4q8oCDFOpzAnOwqyMIMktNNNAHouDGxO37DgArQZzlmp/14W1QlqHTMaIIx7SCx0+5yza7AKJ3IXBrNAHVDcMZAU/BT/vgv/ULPOA+XiLggAREDF2g0ci6xNDRglegd7P7TWWH5oJfayliEg7bScQRBVgI4Ookg/F6rvpLWP29swREqA3CaG8/FpKqS8DTAV4TiBqIqtxfzaQRLys5I0XEFIFrPbZRQb+16Fgi2LvJv8EFUPW1gGfQv1T/F/d/HBnccP7rAwnIIyHI4ArgWeGbU4eHy6Tx/EeTZIb5bo/BsMBjmjBE08f/RB0PHYBd9eVRAGY7cHRwiBf8WeCPHY1bgBTa9xKTELzEkQX9CPtl0gJiqsAmCT7I8xbjivh3JGFI+D2nBcSJQJ8agDX+O9iBL7UfG4bzAkcaICrbtYHz1ycSmGmAjJfL3CMgT3tQpmrfB7gxSzC1DnvdhQMieG47u75+kTouKNkM8c/+vq/Q7ZYjO/hhVvRq8F/9gGfhP8aqE9EIdR6LTwJ1h0BItyDqB8iFwuNqASscRnYioxOg9ApvnYA35f8e9Ohbfe8J4rknoFkO0lmA2gmAG0YK0DkB4ieEjiLoMD8wBzom27ANZkzIoU8EMHk/uo1mzeVoEoRWKn8L/62EYAX/lsB7D/LXg74uAMr9oGivJ0CNJCGD6i9DhZdQF+gtOp4S+NODRzsDVbhdgv4BqTMNyIL9SCKwL9/FGPp5oQKxIf8A/UX6r231H7YIqLML0Ae2GtrADOvRQH5b/MPE9dt9BGLNG8jVTAQvIaK5TtvvvWQgDvyXIClUA78S9Nfg7VtIBlO7cbsEYkQDMot+ygQ7QwmOawTHnAM2XUSnJvPIYRYMmYPS+sv3J+cfP3d04JYIXsF/EwMbBKB9Q9AY+BiSwFj9mzrSXmcJhFPVHySTbgHJCPvRQ/z7G/SVUETsg0ZF+i3CRoCjhf7y1A9mOiDD7TwdwEoEXjLwAv+avLE2B7Jnb+OqDpBoAchoQJskxKnss0vu7Q2YhcDv4ySeLOg9GsCKiUIihP7yfW7zbTsBh0TQfN0iAWn9f72Z56/Ax9P7j5OAH/Qvv3/QxKfk0DgDuP+R3USg3bzBC7bO/QT9Eeh9QvDPG7glBQzJwK740lAFFgFk8P88CqDGAa223YckWYhr+c0BPdwetl2ocnsfzePAWcVnnAIp6gDVhDLyfV4nqFEDPxHsbWD3k4BDkN+pARqKMLYBPzYEvxp9xmCHQQdgWH/9EtH2TIFpu3AH/cdGydv1j0TQbRrq+D/mLcX3ZACZ15bF378CG0My6Kq/zoGOQwhASDFwFbxyNGBuSxbCEhQ/uEPe/6gAERWQObCVVfjPpQX+rexxYhYFxIkgpgX7Y/vPs+Pvxf9vwt8kAs7i32t3QCP+3SPaTwIytQXP38u0PESm+YER+o9B3vr8mETAUfDrEkPI80ck0FZ0dXh9U+HRbhey0cAc2H7A4y4egoD6y8JfkBiigLdFP8v2W00E8deT2IeAKujZ/QAVKpAtKI20gLWksHedfgPcb+0+NEHefd9vB9rayi8h7J91gBbaw20MsnWAF5xHkyDUCOoXp+yrOwwxcKj0aL6fFppaaKDv6OpHR5sgx5BAlK/+fYhuP1D196o8e7lFBaKqv5YIMnFQpd0FGVR35RJCnCDaABaXBtgbiSwtICMtalKC+1JQ6bx/PLcDPQL91QFodQNKpwOgF/9eqcBxBBqRcKAAVk+ArQOMx1RYGgB6naDhlK+uQQwJYx4meQbxtNnYQwMjt/d4f3M9ZE4UOld1LAh99fbfzOxiEkKFCkTJIUIMUeVnJ/9sDt8/e1NEJOi9oVHDGYhgnSLss9DX2IAqw1zALUncKcDr0FB5NP+0cBQNrEezDiyiADPkt9qGpwoPdL0AGPx/NOKeyf3b9WJNdfcFv6bKd2cLMJVfJ6Y3B6wB9WFUfWWEwKMfGiQL+3bz9XGQz2EHKhF41GCtZyDi/gUCsNhYoAr3UNJ58YidHKqnMb/6AB5J4N73/4L+t7mAkeeP3P+1LNSB/l0SkMEd8DcEuUlguEw6t2AU/PCE/q++Akw6QFf1u6SBrj1ZnnhG50AfkoGIdf7gJv1KcSfgzWWkQ9U33Z3tHXYASKJ9e/YhU90rvD+q9Ej69/wxYJVs506Eg/r3DkMDzEdDBRGgcZay49XihLA30P+l8N+hf1f57/0AoxbQbwYaan/rBMirE9Dk+sBzTkC8JNDEUlv5McB8PP19Y01Gayep+hC/2zvQ/2HGLAurowsNGlA1cnqGGzeH5weiYLZm7h3QQC4O2tXdhvMMk1ZS5ebpgI8eMrPvPGkwaxayk8Yc6PMOBPEdC1XZ+2UfbfOPtxLMQQAG9BcZFoF0gp/RKjxe7+oAw9T7ZPWhgedodgz0gf5KBtrtIZhQAZpAV1Bi36w6t98qVfH7hqGI318lLCjLCUFlxRHwqYEH9a2qb4XjWvDT7kBwfbZA5P0+PNuRuW1yf4yNQH3zzwv6b70QOJ0G9OT/dhoYRUGT15uQH/71MjQLtQlxfDuiCXrtM+SkA+icQdH6sU/xz7Ze7FlubV4TpoTQ2osdpaEjtqADmEU7OkBEFoLeC3IWFFeswJXKXzkboNL+wzcFHU8hTGKIboO7CLi1/P+5F+gydQhuvRbwEgxvtACmANikhLTbj0gCYk8KdlYgmj+4Ymaod7TwahwadICuX0Cm2fE5iNHPK0x/CDV66Kyg1MnqjNFBnhBoLQCgUULfaVe5nq/6EQWY67bXCszUb+7232fVPz51iGB12owK9peyP1T4raMFF/OEYJP792mgXYfZ04GHMAhBkCSmSj+dKqRPgVFGHbpLEGMiGFeQWfSgrY52VxaeDUPSNJI0P7NoisG729HHl78z6hxfs9rV3m4JjgM/lsui2qmThjCfDFSb+I9vwUqG5wwL55U7C+6ot8B+7N2o6r3q37T9trfpjgmTvv7PSQATLLeRAOZhIJHBQfDQQJPBdUwEbVW3+L08EcEE/9G4ANrCeWcnPKRHDupbNynMx5AA9IRYLmrc/YLSiD5EaEBS/s/TgnU9ILcH19n+CpHwegLejx7Mn/d25fdN+e9U/1vgb7bqf08MOtf8EXxaoh+GY8L6gDfhvs4i6HQ7seYI2sv1GchdMsBIG3xlvxcCRzdgCPTn+6q/TW00VE8Q9FaFv+R2VlOM1vm/hhjhDCdgNflVKME5B47I9xT8z0YgPAJ8myb/LqHy36j/Mwqw9AALxuO1JVjiuQAYLcFzIhiEPe05fk8tRjGw7yWQbsfuLAT2VqOId1osnr0F49VM8INACPHDoBz4B5mqqSnUgyh3ArjXxfQH5BbgUS8gP7aU+w0zHD9GGD0CGHf+P1p/DeivlhU4BbxR9a2kYFR58YaDZCUR2P0DMmgED2eg77puegy6PgDphEB0CwlG/i9d+/Hs34pBEQrBn0W51mqGnJAk3ACCHeiqkQ1XFQA5AlKH7Lk8yJKWY3/nym14h2C3JvxeMwD9ZVMz0BPMi1n1RbKl1cYhIVblF3G0ATsRiCMUvoK9//OgcwYMoe+ZKOLlC6/Xk50br9NFz9fanqA8UIYSpCwlBO4kHc4WLLBfBHVaKwKgLQjmP4Un61Vq+3s7Bsyi0WztmLjJwJwFeE0I2vD/1Q6MVwefxfUf32skCPbCnxQqf+QMPEUDHZ7vGeyj020JgkPXXwsldA7SYR1RE3h94NvNtugswcgxXEkIcBPCGZ1rmrgDC0A4K88nm2fn/eTnpQtWyZfybRoK8Dro4zYDIMGsf7saTBzvX0SMbkAD6o9CYbsfMK38cJKD9l2FJt9/VGs0h5Gib33pxMKWNsigFUh3G2un+/N1WUglI/EEx8fq27vUNnwsiOoKecL7kQS8VnWAGCFUgn6dBtQhv40CmIYggwK0uwDHRGAuBXVdfwzHUjZzATLMAoyJ4FmBhzaWBlrHld9CCWpPHRqofBqMReMGTJ78q9rDes1Tv7/0m0v0AFHXNR6P6g30SHivin7V1BOhh3iWPwvps/yE836L2XiwnUT8x2iHgfqhnwn667QHEE8oLQjEvtEW7GYBZDrDVkwNIO4G5GiBDf9fGoFM6n+vbEtzXwP6u9AduaWnGYSLAlVdl/AU+ikrSeEIKgwdaZ4AACAASURBVKj4/wtgHcHtdO2nWKcBkPfxcvnNQvsj2Me9f02r76T8q0IBn9OLKfz1HX8yVXQYGoAB/2UeBQ5/5kCL6+H/OGGoRnLSwdd3oH8r7KkGTbgIxEwVWvnF8KOpHnyzfF9Jod5Px+IF1h8owyitDw/XEgRb5bPqbt1uvn7qBIQ16vtS/u+DP3cR7CH0WWJgd5mTJKYgNzoGjQrfvu99NDBC+bnyW1x/qhTatv2OaMKgJWPvv5kwnMgxHYGFRtJW8VMl3uP+MgoqSZyWFKr7+KIDw1d6+IiOgZI4+d5iYL3imzbgyO+tph9t2oSBxOM3ugHtPoFZ1LM0hF4kXNEBssvVgPdjdXZWK7uKvyS3q1Xb1WQwtVDqSUggq+Vw3t56JA2cz7PXOwGNW1ecwxPhfe3QEUsDsFaAz8jg0nf+iZMAHNg/XSazDuC18Iq1HBRrOsAQ8NLB+16g614jmuSgs3bROxE55D+WDDQNA4ivdMJ9M1b309UqknaDU8ObV9/PwmMPATvTMAxpABLBzugUtV9bLdhNDQA+7B9tQJ06/7QNDHGSwtgZOCIA47InIoDdROQGtt0U1HI3GaoUnCnC/rzBMQJteN17+VaAzYNA7e+PFqHQUyXPUYB7iQYa5ZFjq1Zqpx8Uqu/XT7+6BWC1Xaj0GlBIwMoHu7UzcI/6/Acb8KIq+hzmGWmAYnADrIpvKP7TZeLaf0LAeQkGgebbq9FToI44p654F47tekKkI0L5PQNZPsDwPBpy/ni+wKMN76Vav4+2cFZFf8+JwAraMt0DFB7beA/u4Zz/a+RXx0M/ct4/jwaNAS8G17eSwmta0Fhx0VRxJkHMivso+onMXr+YwdWKbgioy1jp4x4AzIKg5lEA7wvHEYCRmdx11TAuT6lDLVl4KvXkAET9P4RT8H2u+lg9EPQIpw+/NpJ7RwE8HaDv/Mu4f3OdNkq/EfAiEiOANjEALvcWL9gfFV4NZbgbQc6qPky4Pm35QZxtH1f4j+P/jXuaYPcWwIEH/fmEPBoAO4m4LGxV3txOQqDU+dXgey+UwSzuqP++uImO/u/6ogCb7wTc1n61sL+vZi87rxnrNas+giTg6QLzaUCjIp6JfhwtGI7AjBBB9JjDY4ePYVR6ZPgN4owVv6Q2N5hhVHwNeYrM+w6dN6K1sMHZm/Ce7bHe3dzKr1xw1w4JrSQMZtgnoQHlr18fzunAszD4qurNUg/TDqzx/lfCaO6t4tACMUQ6P6htWjDPC1hCoZ8kpODzJ70MUR9AODcgwyqyPhmE+wfHYB/hvSqt6qeXUShhXH+d9SR8DzrDaZZdpSp/HxqLMQuATgDU/qDPRgOIeT8cvz/h/XC6BtE7ACLOWPE0KIS4UUjmZaJ2grBphiWgT41BUVWZfP3AnEIT6OrfoF122l2rMycBoU5i/OXoUZ4/aglsXwLzHNU++FVF3qikOj5HXm2PBitT1WuvJRAB+6O//W0/PY8vQH5IrAsMs/WuVmAdHBrQgrbOxJShXwRSsu08h8JMBpo0+aDTALwV4tbswgzHrftG/dJKIAQb5h9KCssWIMeto+GYqG12/HWGjx8kzqNJaa0noMWOr2KwW01AMwJoNvhMQda2/RKQP/3ecABM3g9uD6BY68Ntz9+nDOMb5iV+hIE+dP/Zs/wwJhJ9mgBnohBuStABUXjugF3hkXF9ZZJAjefKdHZCc389LoStKvIl7QIEb1d9RyciQgFDI9Cjyccc/23Aam7/PZJBhgDgin5CtQvbCzX8ip9YgIFtOAt+w0owp/hOiCWgEGbVHuYjRigPGR/YOnEoqPDoV5z5YqB3mRq2ox5ICmSSgAP1Ne+XV2NE+/vuFbCTRADxtS70VRBCjgBk2OyDUQiUgfl77b7DwaHm2rAZ7osRSOOUoHgKfNBSLI767+oDYrfwZvqChSpGfj3pFwZFsCJg2jeIQQBUiyI4WgD68ww4qO8khuWkkIuDrxWv2nv+UTBpJYiPd0KemTA8qqFiuUF1jWS3BoG6pADJq751JqBI0wvAVPyMQvjcX1zbELltKK+zBiXRFiRxG+b7q3M9xuLdzR8g0gCGNzSM5gNYfqGO9CBT8OHct6oB3KsSDBisUnwsFuISQaRHxDSv0vptt2oeLHMERfRn/FG/Cx01EpgIQG8LP+/i37PKw53xn6sYCM4/JwSRrCnIeB1ZkLsawDhaPKv/njU3wnZ/dBdGE8+YTHSG8+ofGgIjsC19YnwdM/KAnTSsqj6ig7uGgIPw3nYFzhhIIvriAxFP9CQd4HSlnzgxONIdrE7A8ZDPx9fjib8ifgegNIliRgdx95+E1T7+3nQVNNhEzDgGA3T2rEDLduwtPpuuouPcs8swwXFjdTaMKt+jA5gUAQPcf95KJQxYU0cYxEDvsBSmYuukp7AwnqniC9Afa5z8vboI68ImT0t26CvwBzSggkj447r9IojvCn7U92J/Hw0QSdwZKNNjxPCfSxRqnATkdwpOwh88oc4J8KTSm/wdbZjrc+4iFP8YO0/5JJDCfaijK5xVXevqfg6zGRrQf83chvX4aRfAE//6vv5+6490U4ADdO7QgM/5bcHP/n4OtCQhBEFeDWSvos8DPq8/IwzLzjpa8/U6MMSkBklDm8e0mn3QIY7XG1Om8wzN48y7HwhOK3P0/ZwUQHHv4psbdoVeb9VlAjChBCdtDDpOKTh9ZfcagOYq31RFjN4/gwBYzp8lAwYNwBELhZoxECeZxMlAzWGdCRV0fQWGHo8+8Kx+AAxnCIzowAxy9KvNepWfsfp4RR9kUrD88CPVTuXRybhqqTHcnxEGndsgub1Gdug8yz9fHt3Hpl57x/mfCOC29FOSQ7/noAZR5W3Ob24UMpuPYAYiQrQgk1gnFoUIKr4vKFpV15pHUJO3Y5rfH3UFHU4bGkU+NKJ9f2hJyOMxDBDpjAgwiYqvk5TqNl9EH2Arb6fA3yaA4cBtPWewhkEcIQJBlGzYp6zRmr1v+e3Fv27xpzvyI44NGDkCIi7CGNV9Dw0M8NtHC2vUwHINumCGNG8erxOwtQINsW88Tlwdoc+F85nI559ngEDpt2F/Uu3hiXYrkN/pBFS26hYDAkFgErMK67y9mGBA3L5ore5izf8b3n805MOq/t7XU4WHv1DUF/5gugCSOAIW/59uMwl6CHWAib8bvfxWl9/rBGEMTTwDfG+ezEYG4yk6FvRPuPwE+wvc39IRjENWM+/cm5b0W4Pf4WuKUnw/vD6eDbB1ETs5vl77Dhnm/51g6wPWwQAqxnivgQaeS3gy/u/1H4hpTPrIgHAN0mSgXUX13YP5PMIuQAfBr/f70cdeE+QoCX3i8nFMLcAjInBoAIYqt1LhC1WdtvmSab28AYffaeivCB+ohdYQgfUa/WS4ToMsNLHLc9nnvPZLwn1/EefPVf+U/xvnCVSEQEkEQEnEQJO7S7RvYDxNeNYKrG7DKMhtsQ8cMmhgPKKKj+F7CiHYFR5KIIPxOmg5IVAtu3ACQSPh7CzUQOgAej5CWEkIe3vgxz0ROGO//qYfz/dnLT+ZxDr4QW0eNCJBorCFOVC312Ec2TiY5Bk0cAaQmiA1VH1MOwDHQ0kHdEDDf+2UTWhS4Z8diQMicLx8MLBfverLcP/jQzF0P8EJj5+NGK9RCz755S6F/f1+X/gxeP+Wsedv+vF8/54aSPJYFjIQd624MDz/UDLQnr8HU3ztKHRf8Qeno1vyAQJBaLcMtTV3cvgP56COCqd/QP9xLgBkH4BxO13n4hNUDtACC6G1S3zqooZ6Ba4lp/zcAFb7iERKQwQcF39IFJjdXECGADw0IE4gg674pYAnk4HoHPx54tD5daO5vxrugSkMjgiiqc7TVKAT6AT8R4ckbHEQCYR/IZBxJgA+XZjsR7vaoRpIxWqeqfXuGC2CxwudicwePEB1kNkaZCuwyF0DuKv/4sz9mzP/Qxdg3BDkBTMC8Q+loD6UGBzx0Kz6eAX/KArOQTlPHFoI4vVtf4rNuLrca9edRn4xBP7k8w+9AgZCgBfEUZWfEs8iFNZ3UO7TqmkjCO/rWdgco/yIqHcQWaC2EGTzgz5y/iXQAvyx3riyxxV/JeBriaGB9OrTA5g9/eokM+37GszqfA/UZk9iW5UnCtBqBl3XoNN6Ag/+zy6A5evPAp+TIFDn15gQw9rjrOzFX0s2JBVAxa/nP1a6AsNWYGjPNGPLTQgBsNUFvOA3Ht9o/rGDN0tWOCcxJGp+f7++kkP7PxcGv1+GjkaLt/fawpwwerQxBJNW4b+PJsYEgiAYYdEAGIlDNaAbRkIgK3ut0jKByp+8yz23X6GttmBmjwDvChgiYLP5V/zhH6/110sGcKo5CkggCngxnIPoPja0j2B+1BRkiYJiviaLJqghDI63G2nAgAxMCuDdnoD0wIQm+urMB3VuAwbBrFGgGgnhAFqg9+ujKsLxB3qGCQNEEtPinIQlAj4WgIw7/iXc9V/x/yUWFs2KH504bAh4aYWf4TrTLGTy9YbftyLeVOWNfYNyt/ji29mQnqMAltU3ioTtbX343yv/1u0YPUBz6zB702tQucnX0gWaFh6DgPdmhXaapGotw0SFz1qDiTMdd8h45HfcqCPRUhA3+NmKz1l9teCPaMd4urGaewRitNBDdahR5c3AfQmDCFT9vmtQEwqAYXX4XI2n23Z9B/Yb1FL+LWox6wHGbZSo6FR1LzyG+3hriSZvWT6jfXhl2cmQZJDrAbuYAqAHo1GA/EOgD8eGcU7A8eDvH4fQBuAhBL/Zp/vamPTrRENDGLTV/7E1WEPLDlP/PwzU4YhusIMUgfIPAr6Dhv5R4y2r8ldFwiFoYHnmr8TAHbhRQSZOctH598ZYhqt6wP7q/ouqe77RJxvzFYaji/z4vna4v5cUMDXqDAJ5ytktqtBDckyjvJg04hl16LB0xFfyMfD77PZjErGQRRjYIfSvoAXntks0ok8MsUC4KARWnYPlJBeIgLeFrUgDOHYCag0/XNAbWgRwQuLAsaQwIhC1g7+jCNKuT38JfnYSyTi+QQEwwHeT4/dWHYxJPxfOj5oAnRQqgU3YgGZSOaDyK3n/qkDYBKptzR3oD6B4fyRKjp2AzSl80YR/3P+/1vBjX18Jbu+YsrMRgbqPP8zrDLTAaupphfeZtyPs9BPztpLSBZjowF3woYRwBwOWaqbev15b7X4RWsiqYiY6ZkFEIoUwUA2OrkeEQE8HYNyD/rl3m88jCGgO/nPW3xy8x4Q/HBcM1dYg5q8N+B/SBSYhtD0EY1PRGLDoKIBHF3yLz4H/gSYQJRETgqeB2d4vC8L2NVnQn4PoVJJAcP0inahAfdXVI8CFszjRagCTtRdV7Sr895NBpRKXIT64RMFw/iw5eChhEvmmyUIH+k+Qu3cLzOAN6ILlFvgWnx3YWFDz0f38ze9GlfP6UQ3ojEY0gtqRIEbA5/WgQFhsEuIeL75uTzvqHktAWfj/OD6sQXssROcGiRgFn0QVkld7OznMDT7CJKzhMIqxW9B+LCOQdH4uyxIcE49VTSeLj0wKjzcp2oDXQA8YoDEGBLMW0BJw+eAxXejPV/IXd59/tp5rVyYXDw5BlRetSpQAcvgfOwVM8ObzBq/AQ2wX4lwkQV3vNhYFfn2LFgaoDU1ogqsfqGkJYmrj9Tr22KQwBLzbLuzDeA9yzyJjVRfwegWq0H+FThDPA6ZhZwX2M2Kh4waovCzAWJTzD/qY00c+6PM8coz08VNqglzx54LfHuTJK7z2rwX35ABLg1DzsZ7Qv7l/f2yXDlbf4C/irg0MJ0aCuD0wP74MrxfdFlX7tq+vtRdCpvt599EG9Yz3V+P+Oj/n4zLruZHcJ7oMt/MNp9eD6HEeFb6/TMfbWo85Pb79HJo8t3371/PuIAZqMvjPC34nVV6ZB4hEuA7AzA5cfU0y2n6ux89D/35/n2/vWY5Bf0qwf3tPLISO1Tap9qzFB6eap/beqI94NCCbGwgqOItY3CGl446CaQ8i2Q9g0AvmgJOnBoAA0gu17tsKtKS7D4udgCYERy2QIceCX/P7mBW+g/7D9S6Mn50CS0eAoQPDcBjopIA5+EcxEjLweRjXq0UbLIjcBxsGx2IZvlf0ATjz/6qypAmY7bhrk4ahsIis6ccXKHdueAfUgk+RWPCLh42c6zEeKyJpRTdRAOqBbl/Wq/uT+q+Fx3FoTIuCzc6+hN8j4veGjuAnhSE5gKnco3A3XwYlq2sq+lmP4yEOpqEoG0M+mGDYuYT0pKCFHgLHKt3T7T9p8GcWH+n1UwGa8X6kQt2x4CeqPexegT6o/Z4Cr313PHdgrsS2ZReLfpKIf+IMFnmVmwxQ9AhithYT73+p2s+JIVfrjwiHnpAZrSsr9CMstQXP1+1+510N/q8E/YoekMN9OMFvi5LvkRDsy9rgFCOoPdpgaQIWBZjf5KCSQszZJ1ivTvLokpen6tsJAVND0NFqb6GUGg2Im4Dyx9Pn7/0dm4pADAslJzTv+dKNrAPQ0wyySm7bj1RQgbAXsRa4R+mBJzpaQmHLmy0BLoL+Nh2ZRca8uUc6P37k97n451fvTieAE8BdZ2ItqFEK6oOJIYPsiU4woo140Oh+H/UC++gatHYcOFT+2y3AYvD1rM/fpxdUcsAi70c0OxAEP45X/hymE9XeoC0zfYhbcqfbhs09HpwnKMDR6g0mmYyKth/UcLl9ITGQ8N1S6s+gA1HvQCc2pluPvN2Br8SyZyfyxPP/VhCi1L1HWX2CQCuAE8TIq/sBYdANZmTIwqq0sb0HIzhhugBeUpBZLFyA8y+EErsBUYDZHYN9QAAooQwOws+uQlhdESSSqk5Qsh8LSYI6LDS1AbmOvLlRBqQIeITvM36+TP63VfE5hFClCTr9zEyVFwS3STQBy66DMHB+PJWIrfgGnYBx2dTboPa2X49GaBVlePA7CFx4iaGi4ns0aLVjMGvtPTDtmO4XEE8E5Kb/8qYai+NHl60LgAICcUCoJPVeiYG6Pxw/X9VFNVbFn9FNPzXoIRDTyzcpREYB5Fm1EQQn3KRi9wKApR8Tz48SwxnV3qM0q7ZhpdKvr0zfY+gO4oQf+EGPFYW/Xf5hwWsUgxiBbShGoGIx+D2eH1h2EeR3UQMH4zMaUKr4033nzkSkfQADelFbLOQCalxdxvN8mInhPas9bxtGJw29Fx3Y8429MAS0fL33Oeo7qFZeiToCC3B/VSNYuU0fgDnkhxGgMFdxiYEY7MYel+OHPH30IMeVFK1C79l+QdXVpFqHlMAXEf3EYDyfkkGdNvJ8f3RAXU0jpgM7jMNA5yCrtfzOicKG/M9bgEkEjqqPPDEcDfqVwGZv6zcO9avDfOhf4OmLFd9OLBHHdxp51HvOBlnAoQksYjASA1xnIhPsapTCPjbsGB2YevpPpgM73EYeSYIftgPgte6CWesVBB9QEgfnWYMgoeC8ql69bWoRIqYHvSIv/u26bj/jdqZ9KSGk74JRo6QS9PuTiSHm6Z62kLUGH0UO4rwWrhtRETkR4iKRdI8giJ2D2nUCMjsA0TXiVDb98NAf/rCMlajA9wesWHZrAe1dlwRyVI2jx4KkyUHSx7YDe6YD4tOC6XW01puEdAJwaEJzf1uATHi6ZlSCpBQscsh6C1xRcWEG4bCFeKcAVhVlDu54JQIkTT21hptIT/Afk0kMcS9BKfjBJozcDXCrtgbWXxbMAw3INQIxtQJPAGwXmYaBbYh4SCsuKwLOAQ5awKskCMmRg8P3xwlBfbosQaDqyZqBkyQe1CLQACoTgN4qbyHsPwkTiF2pYaj6MAXBmUosQHnUEYCsBL3MW39SNKMJ5PfoBsT33DVJCEbFnBCMOkHfvj6Xq8uw+dgRIhGgAiUqf5QgKDFyhe8nnYrlqn9sG1GoAfirubygX4H+8IM1CmQrMFAJ5ExzKIp54nPoVU2Auh6eBShDlTV4u5c4HE/fVvjFrsII0Ik6QX+Iq68jB19ziLoKC27FYe0gC+j1RSS+BgB7AvAM3m8HLdy5fV60C8RMVuhD1ieQB32MCCq0QPJuvuw5IHF/geMKwOPdpmsxBwVEfGEOgeincJqNmuSFIPhPq/xM81CWIIi+gCFBqDX3QPYd2OcCRo6GZBoA3AM+00aesAOQ7/2Pe/vBCXoguD4OBD1WfPwClzcui12AuH+gC0gEwW72KfjBCQRBr05D0IQc7N8PzOCMehPWK384MPVDJQim7yDdoiRTItzzFV/ZOX9sYFetP0fsQzb6O7wOoFjxk89YoQXv+BmSN+yYHYO+BsDRAXHhuJXsEFbdIEGZQWUkNVNzGA9NZUVBIQL7jASR0AclE4Pb7JN3BO72mG92+o8UG3nybj+mASh0FsLKn9GPxDrEcS2Au35BzHO1BksriIJdpqWjKR1wlpR4fN977rZqI+XbYjYDgVDpcYQalOYKMiuQbB3G6Pu/HlMbi9a0EMkksXtjvvXTfgMKAEZRN/i/O7yD8Da2S2Bdh3ICWfp8yuMkYl5a4df4vVWt4UF0yyqEnaT6swYyWB8/j111Y1ERS9oB0SLMtBGDEBD1PEHwtdjUEAHnqmoHU4wCDAoAS+lHwtu9eQLUAgmxVvAuMB9cELMV3m8EUtcBYYI9nkNIEEJYrQeUHfnzzRyC39j8CgSkir/E0P2odnAmAqDnDIhqrtV9BDNS2POjv/0pwKr6z1h/PMz3uf9ykFYq9TtoAXSwpz0HljdvBCVAPY6t7osv6gFhMpkX13rcfXQMIpuTsfTibkfOPRAC2meLRipI4mDPwMD5x+v3+Ey+qEfACwoUEkKQSMZxYJDz9R68PyP43yvo2aYf881rNQbZgRU/jp80QnW/hdXqJxMvCFxXQSNHpE8QiF4XI+wFfQcw7VL2Md7RRajsKgh2D+6SLAKPF356+/7yXYBTUgFy/38StUjFHweD+iiHh8/LV/i/TSvGk4L5x7F6AsIKbgb4C0YjgdGRIToGUx7cgS3JKP8pRcgak95BJGQbjaJdBYQ1qHYnYHL8F45QgHx2gLMQ2cDxBD/4SeR0LSDi5XzPQNjM4ySE/HGG6g+ugltLNSARn281BPtNO72eJLjdX4ITSEgpQvJYFEUg24f1qAYQNQdxx6Q/RcB85j9f+03zf2QV33IDPHegNgPABTfqFR8cZK9TA7/ll0EQbUUHW8Gr1d+MSadia+LRHwhunv87yWoJ3h/pRDwJAbDNQQFd2P2mH4kP/wDT/ZeN3CK3+ZjvgVpw4r20AMafb58j4N1UMknuj6iCx883PU9g2VHVH5JX2eEcPghSgRBCKPzK0Q3fknwPN0Hk0CyC0zBkz//7duEetgFjVtypASDI4CsknYJgYDhqsBxxy29+eyxrAZX75EEf8f+CkOcijMDDHx4ASYGGu8WHgPwpHJc0qOG8FgFTuVk0cRZVePFwHEIUEu8xSHoL5qWg4I7/HgOKXe2dcnu2SSdCGIDTA+AcxY1zYL6Q6AAFu+/1GvjKPSeEoJV3NiM4Dz9C6oWkEav+NWjPWXNOIkKgNTi2I8LeBgaZHJxqrC4oNXoB9pzzMws/OW3ghSyQJgjbygOVEDhoj4nHLld8HPD6UUMFVLIgKrTL7cFoBRLQgEdXIseZ2/HhFPKbk4d5tYWwwR0nIFQSD2P5gQhs6meVfB+Bkyz2fOIvX/zxqsSODuAGIOLtPNnmIPCrv6Kqvgz3q4tCwNl9lWYfnsdHj2HTgQw5IBHwULmfSu1jEV3gDFSxTBmqSEVqiYK2IkWcRiAkwV/cyW9YhqHXDw9dkNQAcO6HFNJT7oChfrPUYc3KY17zAd+evAwF2w5SCKLV4EuCEKsKfjBVWHu9Q9Arh4CoBqEMWYBsNX7YgKP/69uC3M7/mOOz232QT+ox4iCyJGEFP4oBHd+GVvXBwX35nqp7qeIbV6L6tdZub3ueJ+gBIKgC6S5gOQFxDoGr+Bv2nzqbknd7ph/EmXzO0o+kZdc/wqvQkAOUffVMzKtYgx5Vob1/+HAfCdzHSiXHenX35/2JTr3KZ9Ruj2lYiMhLIFoNyMq9hFroeYMTE0bSLbhb4l3YlFPa6hMd2jk8dmrDgdQCnC4/+ANFlYTB6ATlx2GDGXP1rvL+SnWHw+cJes5/rRWt4H2pw9GklD4uSMpwasIQiaYR92gIyFX5S8dtRZt/nCAH48VXW3hRE/HKOsGquj8EM85Q9cfeAV4XwNGAlmIFIwPYrfLKuxV476RRetzcdeAsRSZhiHizCKEIOHn3EMOWy5X4uIJnXX6sFiBFLaBm/THOQAkVJK9j6TKwiSDTBWpwHkSPQJX7U959uAkoaTUuug6oQCBz1Zlxm0OJSIoIw04M+7zCGuYiznCfHww9AN6Ir+HXA7lfn2oBSJ2FOOh8SzINfmcAyITq8JX/sOMPx6A9LeYtVfwgCBZhdu25OB9/XmWWNPUEPD5dUuJ68wd1AqD2+w1PI9KxE9BW5t3z/igdYGWiL7L+wPv9jgVY8f0ZcbCKCuLAHN+c5wa69Zpr0J9t2KnpAGzyiAIPiFalJ8/xXrrA6Y+/8NoDnWCPNwFJzf5DpVkHte8hx76P+HU1+HEytEeSEIzAsu5r6wPJGu6oLz8VrKofXLce+ywIHhNa/Dmw8LrptWXZ4NKZm4pr/QQ7Qk8ehMrPtAF7PQCD309QgRgRZMKgAbFREAfBBXNalbHA9cEHMo4IgIUuPjjBWEUFEQpYTkhVO43eRiynJw9Jjj8TOUIlJExK+0wA4gWgQvcFBHAc7P4/u78/Ff4CC5ATB3P3oUwFClYgcALcxzp/B9Ez4DUV8RjBbsCBrMH4dLNwIDaCGhA6o3pXksdBvYBsktrXDgNJKAFy1Z+ZGIy5NXgXoBT8a3ZgVSPIUAMV6DjLxhsV8wX4n4ibbONObHNyCr8Z4FinNFjg8ziiF5zSV8A99u7Zdf5OisvVaAAAG3VJREFU/kIPAJLWX3hUIFD6o7MD4WkHIMXBk4IftSrPNBJVk0OoC7ice8HGS8XBKDoz/YFBLaQi392lGpCMJfhD9xVkx5Xbj73P9V4m1j0v73x9FjDDPlYvATkgFAVWcdNvJBamliOjAwRV0EpeRymAe717kMYRyy/j5FwFBX0fP7Dyx8gq8wn2ZXi8GfGYR+lFcGJSxa3Y84WgzBHetlU4cvKY44Ps4iP9fsgsPGEhQTAcHqwwGCj61SoPexKwasXFqtxq8qhD9SixoBBYcJEDNzmIoi3J7QkoJActVHocTVpPBCDhElAvMDK1PT/Sq3DwB/ygmyB9GNhYDH4so4Foy48kkPtZfZEv1PQTxYpyX0EI3Bu+/5krcN8fgwVdwWu2JNVNWAk+PcOOPMNdGFyAZ5Aj6gicgzNfwuHZg0HrLxBWfjSRl88fVCo/apX/IBrIvf65ZxtEoK9Bec4KZIPLe76osQns46NwW0pUPCPAyMc4A/KXOwZzFLGbAqD5xhhbgBcWfoJBAlarcCSQgdQJ+Movnih4gjZQTw51rz588y/ZgxVUEAQ8soCfX8OR26JwujCLGFAMsOjnwGrlPuQw9D/PPv8BYVR7pG/eeFtQpsLzR2KFI8SwKj9KlX++HeLOPuSBKrKeHBi7L4b+Kx184+ptAp4Trcscv69oARVYzWgaK01H1X0K3zNSmARKtxXYHvwJuT+8gLGGWgpHcWOmBeljFB2Ckg6wiAYOqfxEK3GMCAj6kIiTWdCBCXhkjUKMgJcLk271N9uLSbtvvK0S69OXAvoA5z94VsFubbmZvx4QAnXgBnJxENyQjy38wef81uPhxMpPJIQzr5ckuUTKe0wZyN57iFTWga8GvCwlh5UqvYgmaNV9XSxEVWs40kkosFwA70RgNOu8mLZfR6wDiwRa35y7j08NksqPQhcfkRBK/J8R75Iz+9C8gJpqzwiIeZII3QnYOkJWbVEI5jNuA+o2BwK82ifwnpSgHwaC+GNAdmW2VXfC+vPu6wR6lBj84C9WfvivZyUhZMJlJhjSukDlFJ3g4AvGJfC1iEpQJ/CaEd7G9wds7p71+odruKrHip/C7RdsxeVjzIxhoNkFGOW/+sk/YVAGtltfzZAIfzix8gcHhZCXpcGN2u69qWqD9OlRFAy7x2fQBhHUiETB+DocqvArYt98f+AEAXApsEmEcNLC0t2uPHCqPQIXwHYDfI4/9+8LMpchqr5HK39MJSrBXwnutNqjovjHFdq+fcHLp7YLR4mGgduW5hFpAXUoL4cTTuW5HJSkB5PC0S7A+8c+837DyoM1J9iv/po/o3BunlDqPjOSO/YbLFd+FGy9sxKFeT8b+nLNPrkAyD53FtT27yUS32yqUaEGTMBiASGcZ0FmK8nWxbvjC1q6WQC4VdWdAcBY8eFoAzIrC0b7Wt8wlPcIdE1FhUWeKU1Igv8Q/0dl4k/NnYSxdlDon8diUDeuQB4c8XVzcahRgyyZmNC+LAgeCfSVALde8/t1DCYawNoePGT83wlOpFUdOZKwxn89OsMEf0X8CxJCBN/dwKbFwkSMgx0ACJJDJD4iC1JEYh6XcEqVHpx4+J4I4UiAl26r5x64sttvSlAn3LBuQCz6edU8C+J5epBrC4YP52EFDgHrCw1B0eU9bOaTgh3wmYvQV3Oqqcf53XnVNXUBELX1xtSgFrirlII5d3HFulxBCNEfZx0h7K2f34XwdHpuYQcguN189Ow/nPXclaUcqMH5leCXjKOjbv3F0a7i2ZaRHmBe5zwnhA9S736ZC8AH8LHkg/T5znYgmES1dtuzGo92qwHIquiWX+4KgVLd8utv9Ml1BQNhEJW/FOgweiTguCUoQHkEwYhjfQIgm8eAzPKzHqAG5xGiiPyxeGRRaYetUpDVpHVC1T9bHGyaknb/TQTnuG7rDYwYCUT7/cMjtILzA+Go/FPw581F/mWeTkDuBsBCAK8ki+A29nMzPn4Rzjv6QV7xWW4fzQFUxb9jQQ1qc28kMi4mDl1NBr4usIsz5ltZqNm7AeJXfuTHd7nioLEyPBISU+8/tP1AC4Il/n+YGmjg2NiBRdl6yCw//zG5ph7bqaBuz8B4VMU/TqSsNPbwCeZA1cdxyG9SgKzRZPL+GXFOiH1/SFZ9wX8M3zUgvH8a4rMBjZj/h1W9MrwTiN6MlsCKiI4gycBzgV/xUaQGjGDHwHiYi0VIzeEAasCpNuL76AC7BIEl7i4AIxnAfoMxk35eJbZ68wWEUChs8IPz/EEE9BkUoNA4RCWSLJkY1h0Y/dG9bVCtUVPe7QRhtStXG4nOECDfUxc4Uw/Ik8JkA9o9+a83IrfHH11EdFUWc4phNgVFWkPsIHBnCvCCYBSgqEN9qtoXuwHhByYoJJA7BxIkkRwpDGgAHo+vQ3ZGOwCFJCJKUAx4MBpFZWvReeLgtBBkDDQu2OJxXa7SE/P4ZiUPHABjY1DsFIhPAaygWewiXK72hHjow/k8gCL6gKES8qcDZ7A+EhYlWCPGCX1wXIwzkQEKt8cP6iqkC0FEhFj/ZYtvXCtwuBLcDT5wXN+9H6ZEIkTwV/x/s78fXFX3siWHEKrC3tw7EFZ31Ll7ttknQyEMGgAqCaVe1bGk8r8nFWCQQR0h7CY0dsU/mIeIuA1AGCo02Q0YVXxub36sG1Qgfo0CBBUXxap+ECFEycQVyViBEBFPt14TK9rZHB9EwMG7DPXOv0OVHkdtx7OSCXfb3av4CFZGTwQBwT7/hKPHE4PzpJ4L4+FM9r1n8B+B+9R9I4Fu9brYUZgCunZWNxdQgIs8mASBQ4F8hJpEiaf4GPihk8FdAxin/kybjZjTj+mAQy6ihZ9whDvHAWB6BKrBXQr+5SBfqPaINwiz12UIwoTmbPACZY/fshBBBKNlW8ZCHwH/cVKSOZMm4Mxk4OwE9JeB+EFkn1IzcPQoiSB4vGgNeJSoik1A7m0TCmE/HrggB+/1M12C1Z18ACGoIeH1pH2IhAqFWgBq+kDFEWAvA3X8tpW0cnSD5WAOriOHhnYraF1eLTkS8P/QsHUBdtMPnOrMaANJE9AZiaKWII5Ue/8PTHn/UcCSTgIF2xN4zdmAQYIAKeBFl6FiO0aKfq5jcImHfPwTxcEdRmD3LcFoAva1Hdjm9UgGggI9YOoPkOBYLsT8HlG3nucMDGkOOJ8CkNOELdSO7D5qqAeJYBb2GpABgRi2gxLITgrOQ9C937HgB+0i7MeRx3gfPWCXLtgbLJAu/gCFBPzRX8eADJqCvA3FViC/BlOQC4LZyrBq8BdQAOUKoKjqR7v7EFfVFMojPgEoSlJesNIePyLHwW9NRgq7E6HvUN8A0yj0wyWDHRZ3J2A1jHdMyu3hCGwSDwdRir7h9VP7AKLgPoMCgKziOFLtrUm8aIFHlgxYfz8WBYUU55iAXauo+evJaIK/NTgRJM9sUcZRzcCnMdNKMJc7usnAyrpxHYkTRHK+n1HxS01LheAHqRWwKIDqLvQC0+PupHZgBawfVGsiniTVHwZHRqbUI/D4Cd+ftgyLAR1ehkIiqaKFw7MJEwUIuK5zsu4svoFYCFKgBJZACBuppOId2RDkPZas8H9kULcA9a0KTCQDGtpnzT+RMJiOGseHl4BQ1C29AWUXIIf/OIwwqoNEK3SCuA7FRiBrE9B4/PcrGJ1OQNj83F4Xbol/TgVHfMiIZLAdcaVkgh8sLrd+liNQH/FqsNTfj15m1J0X+ffZuq/gTY7QnvIfJz6UzBJLs83ItQpt3RfZz5iuGfNPajpngUm0R8DoA5jDlzsOTAwZjzsC3Jjxg7H914PjlcskGdghgx9HG4OOQH34uwQyzz61/0qiYNQjXxECuWYbGM/DrjtPH/Mw/K+gBLLSA+cEfPr4MroArzcDuybbr8Zc72i2UnzeHnTgzD4Ug78SzIvCoARVOQxaFFR3TzWnkkHUVFShEuqKxZnKz4p4YYcf8ZhYhuu8wFgSHcuuwCJagI4bgchJQK/qe9c/RT6nGcg6KGREJpb+MI0EY/b0jcsni3AJBeCQNsBOFVYoApcM2Aom4VFgIRdHpeIG8D3YaxBD+qCiQ+rBOSVnci8hzkAG1t/pgHA4uwDzmu8xFKkkkIqCfkIRs204r/hiDgutoAAcowBMZ9+KS0CcXVBOHCvJw2jMQSJyeoeExF2DuTuRcuWAo9sefyUQ6/oBaIjPtiRH1KvQKvygAHb171d+vc4GRMDPoxN/kL5pwlVh1mBQ1quQJAJ5j0TgOAis+h8d3mnC8xTKE34+8sDNjyVXE6nFMN+H39TQDmocHScENvN74LoGScGU4f7g6IG3n3C3qnG6JBS+Z5tHOOzRYQx+u7MZmAl0OSsRLAS/VIKfRAWU92+12aaVPksGDBWQuCMvgNy2M2Mt8EwqbjosZAec5xLEAmXmcFTHiOWARWglpNpjdEtBQRxJJU5VL5/7F1X86XntXgUK4q+KggsUoIIK8oA+kgy4+zLaACqQGTVOX6MBWdehL6BxHn+tlyBMDGAqufd7WOX5WTJwKYDfXJJP2GXDPk7Tj5Ed7BOG7DMFaBRAJgI/+H2Ngeb2SKb0zkoGlQBHkefDr7xMA5HZeJPtKIzyApI9gmnPgf1c3mulfhe0gFekDCdNFnrOwi4Gs6eTACNjB+Uegcgojog4V25P8bctRYY6RL8AJklE9ACFAGZdBEahd4d4CmghFhbzcwaXYH5qTlS6DY+KfNH5Avzjo2JJ0poDkSCMxLn73H/eB+ifvgvyIFCWAji7BWC8hd0qj0FziMdrS70BlVbgamIgcmotGZDNPwm0L9l5iHv7WRoAFx57ScFS2r2iwot8oKu8l+TOCOg2mZ2nFdjTgOFQENzKkJ8OjEnsE8f6AzyXwT6MNF3RDRnuj0Lwo6wTlBMDIyqaz6G+RiLJMg/KUrQV/rh9uH0tWduwoxmky0kSMQ+rnXxZsGadgnxfgk1pCnsIsGYltvfdzTOBIclIsN8MLAGcz5gBwj94AE8DuC9Molip/JGwB57nRyJiyD3pyk6q5ij+3TzRLohcqyqCEQBTepF15+WVmW8SEr5jMUUkx3oMIsrH3ndwAQganKzyMpOJNxMQooGBYwcByw7axIhgPRGEr6GSGJhkAELoQ1YRg+dPeD5IIRDIqq5PA2Jh0Rq0YcS8XBi0ghGRFpCtWTdum5+yLOsQf2EuYY8AfnbQZDgCjHxBSKwTGpt8QCIDVH3/4H5OwEvldhliINwAFLsEyyIfGKV+vm3eEehVqKTdNxtDiPoLHCRiuwTJxCECxMDqDjTvZ63KaPKvRgV2i/F3ohm88V8LN8hgJcXD5pVGIPPNn9EBqSQC0I4AMxBUcQNCkarkFgSn/oCs9GCVep4eUG5BRAOcQOCWlGSc3If0IFqRfURQGRrKewPKEJ9sLnIowKCcw+f48N6UHjqYtgInaCCkBbPSj8VEkCr2g8U43wY1xX/BNkwreQrzg+oaJghOCGTU8RBxuIp6VFOGoEXgEsBLIgV6gBgxoLSI5CgiYNT+GBHsU01GthrceiMUtv9KgAYktgVNeGrBbtiOQVi9x8WjiAW7UNUnm4Vet7WtsFgDCDYEwQ/EVL1PnQf/xCDLTowTh4c4HPRDoQaiwhKIAae4B7xgCBydI/CDPOrevK0FR4p6w3VfoXgQiB3T1N8Y1PCD0X19JqcHGfzB5WkQE4p/kdeXBcEVUXEIFqSij82lMyrWq/7c+LFHA7z5/dwOHHg8s/Y8C2CmhbmALtare+4UWLfb25BmXABKABTniC8gRAP2yvDAiUAsElnrxFzITQa/sAFecAOY7zPV/8jMQHSbWAiUPGkQNABhw85xrSCv+mMSzFR8+7mjw01A8f4F8S/td4jnDHYxpT8/OEyV3gz2+GTfdAeAszswfJNGlQhEIjB0Bls0BKn4Iw7WKu9f1gmSagmvqleEwJwnZwjO7npz1HdCJ1hS/mlBcRXyF3i/M7NxqJFoeH27z7nnJaBmpUZKHsTbGUc1ALEoIGsGYl9ixS50gjAT/VhB8IzvGTrBVfWEz1MzAkRFTtecW731VdjNQPukVdhdn0Y8d/a7WYH6i/TBPBzUFwAlHwtGHOQISrgb1AMUgDETTA3+THAdeRJhg59V/Ektofa9I8wxVICkC7QQSAd2O3cftzPzdMK6aA4iZI4ILfYRbb9RgqICt2AxVnYZ4kkBvHOBxT/zN9ybHx/f5Ql2fkGCX6ANm6F8WCfqAS+Eq5AGcHJd2IFHagTMHAAj+mWBnDXuc81CjhsAi5dL2K8QCYI1aJ/PJtSSxEFXASv7C2I3ZB9/a0j/7nDn/j1pHsz9Jr8fNpxPBUAUUYD4wz5GBlmyAiORjtAIGDFwzSUwqiNZ1d1tPiB7/Q9VeI9KeJU16/knkEeQJEALjY4rkp74fCZiMDSA/PgvT/aT2gYgp5E/P29AKBQAo6TRth5T4VesQFb0i4K7RA2MZpgyFXCEQHCOixuYMPgy2L7+45ezSSKt2oUkURlpXkEMOLSiXPuDQZjk63N5bmzOSxQdLHX7AhwUEA0BAeQPJIQzkAuFlOK/GtyLdiGDKEBdllQ7YouxV2Xdwza9So4Kp5Z0yAgUhTlJgFzSFrznIHYIwKcCu2/L3LsCg6UI1b1/CA+ApIV5/32HqOIjdQusE4azip5Wc1b0q/QGIAlaWEJbXP3r/L+AEipw/+BtkQVY9fIM2i/ZhgVEgJO6DZ1ksVtlYdoQAPhVO0oKmYBmnAYco4DRCRB3TwCziptaE0auER9/VzRqKNOEYINOQg2m1l9GpGNQAhh1v6UmxNQh2M4+LmlUzll0OTjYQOaGlZAEMCrdhmBphaMBwBADrSQQc3//He8KgFETT7p6BHnjj2X9EXsDjrgBS6ihoAmcSQVYmE4JgYWFpp1waAQRoqDzxDhU+HxSnZHz/9JEY6Y5MJA+cwoWrt99+U3Mc/9g/NQTFaigAEtwB1yBzwzucZSX7RZEILhR1d5GDCsBLVUdIQvsldZfEJt5i/MHx2hGJZFkVVyK242iFeh58oBUFqIQbkfp2DV2X0CkAYgv1sU+P+I/HmBu8nErugdRnUWhfp+A/ddlbEH3uQlBsNobUEMHasK1HOYn8BEEvCUaiuigXRIKj+sGOPA4KAWz9/s7WxcgB4+a6/fI2osEwv4yOENAiPf+wQhbc/5f0gGisWuQaRFmGoIqguARWsBQgTTocDLMT5OJUQnhqdCEig+/EShKSEgTVV0MBMnz04BcshPnLk/+OaV0/dwKzB4QUt1NB6uTDfGOP+cNm9mEsBAFiM7AQh9AKVEU75vy68jeOxrUC4mDEuYO0oLqoSdHaEF2eXYYSm0V+oEOwpLmYFOF3Z4CmAeBTIGueiIw2xoKPzDBJVBXQ5g5O8/twwA+QguIjJt3+g0NQEcDfUXgO5gsqlTBLkQLdl86K3CWneitQ8sg/5oWAUJP2C3V3RoEyji5n4b9lB4t9pz2CA+cAFn1Z9I/uzYsU/ELtEBOCHYQQqGcFejV+yeuRJX31zsKV5IGjway9z6PLDxKwNEPsBuOEiqw57jGgOtZ1Y++T50AuMFl7hPIbhskiOwsATtRoc7rS7dXrpcgrMCGJca6ELJo+Y0be0BW5ZKGcFz4y8W9BduwcDnK9iO5fagsKpp9ANnvDPxeP8THNyIVFo1AMas8Qk5v2Ytm0LCCYAXqn+wQsPTBh/5Bcnne14Os3uCQt28vsK1WUESJFviBgAW//3u9PLxusXchcCR2WsNzv/ImvgZzzkUByDUAIrjTvmSHAowpJBQE4SUlxMxnARlQbIqkArVAJ6pBBvELCCKlkyCDAP45BYfEPfcUpfMch3Vn4bheYK4E66BxAxHSVd5INgEPgU/NBCDfNQ8Ho1CoINAPQAW/QT8OCIZlNFCB84XhoDChFByHGjx35v9BLgyhmojqHYb5QYXnuAecvua0hZe6BV9f7v4ibvgvamrmAc1TmaEir0LQ9h97eYAYVoM/nWA60i8Q3Ifezha9BqaaL3zvqd6IAuwwLSCCuCLuJWch4h30giPtyiAphKEBcCu9BV5wwzkMxID8rhMwdwMhcSFgrBT3RUTQboAUg3+p+Qe1IGarOioVnazmefV3lHpwA0AcLWCahUiXwePHWJsP+GH1gnp/we5KfOhJAbsj0H/BIEb04TbrTPsAyb2LLu93KwfCvn5PLAwrOXAa72eEQRo1CNdw5IprsAZ3hApy9zlcITG2vpCihsRSYxNS+J4vdBZ6B52eqRcQ/QXmSjAWSfa/5GA5qEg4iJFtm624AqXLrSA2gx8p1Mdqcghv41S0lSp/xAYs9gakQc4Ie2RTUYwYgt748mV+FU1Xgp14eW3XYZ6cdqGTNHwHICTwEeTPl0jEZwIgP9gDEaogeg5IHWCF+1eoAhvEKPB/EAeTRsM/pSAP5wjWEUMM1/NJRhwJbpJSgK7S7zF3EOsI5jBQBK9DV80Z8Y0COzvmWzJXgDl40KEC6cqvqgi4OB5cpgLFYK/1CvDiItXqC6/S87wfAUfPtxqfGNzlYaOjlf1IsHPPvffHgDAoEeEST4ZLZUd/RSo91/BjXY5ggWgQ4In3fyj4mUqPrInHOCLKO3wUwRsfyXpt1nEIRLrqcWeTuk7bigsbid1zD4iDRQtnIdQsyIXnFCn1I9D7ADgxEhOvR5AJosoUbu1FkJyYCi9OhQERoIx+4AX/YqUXQhtYEwKN4Cy1HntLMmtaAQpqfrT/UCoLSxeswjA5UWPPi0mjajUWxMTdVusNvt/ChMdmILK5IRMFu90BMEzFYHdg2GAgeYVHMMJIBTA7EFTx/5fpgTFXz9w/en0ZjD8kCDoKPNGwlB01BmoWQbh+AxR689mBponGJOr9OwmMu3dtJ/ylW1Tik4ElUPmR9RqII+pVhD9ychABMQ51gOIZg+/G+5mGIzLB1JJC5WhzYjhJ7IWmLDpA8jzsAafUPkB2WnFBF4iSxkq1ty7f25rv/+EQLOxs2oUdTSA9HIR9swdBlCcFe9owPC3XWDDC0ISVzsEVbSCF/sWdA5Fu4HJqankp2SeQCYYrImNalfmhpVxYrGkUS4LeSUjg8dD7+D7w/ybIfy7vlB9/HJ978zr7/45Qgajzj+4EjIK/ULHPRAOlKr/aG0AFcqCyu0GcW45Igh6JMJmhA49/U+cEssHNJhtXDC1MOya3j/sAiAGcrEtqtgjBD6wEzSDc7D8o6C8rIqAZyPk+NQoNLAZ1hR64Yl1FBY648smUYKnSg1Xwk/0DyRyArByMUobyByhCcPnOaPyoegREFS4jNfYAw+IHCjdC1J2WDZBke/OyN85J24WiXwDYPoJyYuCD238ulvuzwt6KgHf0shWKsqCFFGjB/w8HU8eeTED9wAAAAABJRU5ErkJggg==","EnvironmentBRDFTexture"+a++,M,!0,!1,x.e.BILINEAR_SAMPLINGMODE);M._blockEntityCollection=b;const n=M.getEngine().getLoadedTexturesCache(),J=n.indexOf(g.getInternalTexture());-1!==J&&n.splice(J,1),g.isRGBD=!0,g.wrapU=x.e.CLAMP_ADDRESSMODE,g.wrapV=x.e.CLAMP_ADDRESSMODE,M.environmentBRDFTexture=g,M.useDelayedTextureLoading=E,k.c.ExpandRGBDTexture(g);const u=M.getEngine().onContextRestoredObservable.add((()=>{g.isRGBD=!0;const E=M.onBeforeRenderObservable.add((()=>{g.isReady()&&(M.onBeforeRenderObservable.remove(E),k.c.ExpandRGBDTexture(g))}))}));M.Rd.add((()=>{M.getEngine().onContextRestoredObservable.remove(u)}))}return M.environmentBRDFTexture}},11546:(M,E,b)=>{"use strict";function x(M,E,b){try{const x=M.next();x.done?E(x):x.value?x.value.then((()=>{x.value=void 0,E(x)}),b):E(x)}catch(x){b(x)}}function k(){let M,E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:25;return(b,k,a)=>{const g=performance.now();void 0===M||g-M>E?(M=g,setTimeout((()=>{x(b,k,a)}),0)):x(b,k,a)}}function a(M,E,b,x,k){const a=()=>{let g;const n=M=>{M.done?b(M.value):void 0===g?g=!0:a()};do{g=void 0,k&&k.aborted?x(new Error("Aborted")):E(M,n,x),void 0===g&&(g=!1)}while(g)};a()}function g(M,E){let b;return a(M,x,(M=>b=M),(M=>{throw M}),E),b}function n(M,E,b){return new Promise(((x,k)=>{a(M,E,x,k,b)}))}function J(M,E){return function(){return g(M(...arguments),E)}}b.d(E,{e:()=>k,i:()=>J,k:()=>n,l:()=>g})},10519:(M,E,b)=>{"use strict";b.d(E,{b:()=>k});class x{constructor(M){this._pendingActions=new Array,this._workerInfos=M.map((M=>({workerPromise:Promise.resolve(M),idle:!0})))}dispose(){for(const M of this._workerInfos)M.workerPromise.then((M=>{M.terminate()}));this._workerInfos.length=0,this._pendingActions.length=0}push(M){this._executeOnIdleWorker(M)||this._pendingActions.push(M)}_executeOnIdleWorker(M){for(const E of this._workerInfos)if(E.idle)return this._execute(E,M),!0;return!1}_execute(M,E){M.idle=!1,M.workerPromise.then((b=>{E(b,(()=>{const E=this._pendingActions.shift();E?this._execute(M,E):M.idle=!0}))}))}}class k extends x{constructor(M,E){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:k.DefaultOptions;super([]),this._maxWorkers=M,this._createWorkerAsync=E,this._options=b}push(M){if(!this._executeOnIdleWorker(M))if(this._workerInfos.length<this._maxWorkers){const E={workerPromise:this._createWorkerAsync(),idle:!1};this._workerInfos.push(E),this._execute(E,M)}else this._pendingActions.push(M)}_execute(M,E){M.timeoutId&&(clearTimeout(M.timeoutId),delete M.timeoutId),super._execute(M,((b,x)=>{E(b,(()=>{x(),M.idle&&(M.timeoutId=setTimeout((()=>{M.workerPromise.then((M=>{M.terminate()}));const E=this._workerInfos.indexOf(M);-1!==E&&this._workerInfos.splice(E,1)}),this._options.idleTimeElapsedBeforeRelease))}))}))}}k.DefaultOptions={idleTimeElapsedBeforeRelease:1e3}},11696:(M,E,b)=>{"use strict";b.d(E,{e:()=>cM});var x=b(970),k=b(1378);class a extends k.d{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var g=b(1133),n=(b(1473),b(989));class J{get noiseTexture(){return this._noiseTexture}set noiseTexture(M){this._noiseTexture!==M&&(this._noiseTexture=M,this._reset())}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(M){this._isAnimationSheetEnabled!=M&&(this._isAnimationSheetEnabled=M,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(M){this._useLogarithmicDepth=M&&this.va().getEngine().getCaps().fragmentDepthSupported}va(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:x.m.Zero()}set direction1(M){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=M)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:x.m.Zero()}set direction2(M){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=M)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:x.m.Zero()}set minEmitBox(M){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=M)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:x.m.Zero()}set maxEmitBox(M){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=M)}get billboardMode(){return this._billboardMode}set billboardMode(M){this._billboardMode!==M&&(this._billboardMode=M,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(M){this._isBillboardBased!==M&&(this._isBillboardBased=M,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(M){this._attachImageProcessingConfiguration(M)}_attachImageProcessingConfiguration(M){M!==this._imageProcessingConfiguration&&(!M&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=M)}_reset(){}_removeGradientAndTexture(M,E,b){if(!E)return this;let x=0;for(const k of E){if(k.gradient===M){E.splice(x,1);break}x++}return b&&b.dispose(),this}constructor(M){this.animations=[],this.renderingGroupId=0,this.k=x.m.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this.targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new x.m(10,10,10),this.onAnimationEnd=null,this.blendMode=J.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new x.l(0,0),this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.mg=new x.m(0,0,0),this._useLogarithmicDepth=!1,this.gravity=x.m.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new g.h(1,1,1,1),this.color2=new g.h(1,1,1,1),this.colorDead=new g.h(0,0,0,1),this.textureMask=new g.h(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new a,this.id=M,this.name=M}createPointEmitter(M,E){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new x.m(0,1,0),arguments.length>2&&void 0!==arguments[2]||new x.m(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new x.m(0,1,0),arguments.length>4&&void 0!==arguments[4]||new x.m(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new x.m(0,1,0),arguments.length>3&&void 0!==arguments[3]||new x.m(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(M,E,b,x){throw new Error("Method not implemented.")}}J.BLENDMODE_ONEONE=0,J.BLENDMODE_STANDARD=1,J.BLENDMODE_ADD=2,J.BLENDMODE_MULTIPLY=3,J.BLENDMODE_MULTIPLYADD=4,(0,n.h)("BABYLON.BaseParticleSystem",J);var u=b(1009),T=b(1182);class V{constructor(){this.direction1=new x.m(0,1,0),this.direction2=new x.m(0,1,0),this.minEmitBox=new x.m(-.5,-.5,-.5),this.maxEmitBox=new x.m(.5,.5,.5)}startDirectionFunction(M,E,b,k){const a=(0,u.q)(this.direction1.x,this.direction2.x),g=(0,u.q)(this.direction1.y,this.direction2.y),n=(0,u.q)(this.direction1.z,this.direction2.z);if(k)return E.x=a,E.y=g,void(E.z=n);x.m.TransformNormalFromFloatsToRef(a,g,n,M,E)}startPositionFunction(M,E,b,k){const a=(0,u.q)(this.minEmitBox.x,this.maxEmitBox.x),g=(0,u.q)(this.minEmitBox.y,this.maxEmitBox.y),n=(0,u.q)(this.minEmitBox.z,this.maxEmitBox.z);if(k)return E.x=a,E.y=g,void(E.z=n);x.m.TransformCoordinatesFromFloatsToRef(a,g,n,M,E)}clone(){const M=new V;return T.e.DeepCopy(this,M),M}applyToShader(M){M.setVector3("direction1",this.direction1),M.setVector3("direction2",this.direction2),M.setVector3("minEmitBox",this.minEmitBox),M.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(M){M.addUniform("direction1",3),M.addUniform("direction2",3),M.addUniform("minEmitBox",3),M.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const M={};return M.type=this.getClassName(),M.direction1=this.direction1.Vd(),M.direction2=this.direction2.Vd(),M.minEmitBox=this.minEmitBox.Vd(),M.maxEmitBox=this.maxEmitBox.Vd(),M}parse(M){x.m.FromArrayToRef(M.direction1,0,this.direction1),x.m.FromArrayToRef(M.direction2,0,this.direction2),x.m.FromArrayToRef(M.minEmitBox,0,this.minEmitBox),x.m.FromArrayToRef(M.maxEmitBox,0,this.maxEmitBox)}}class I{get i(){return this._radius}set i(M){this._radius=M,this._buildHeight()}get angle(){return this._angle}set angle(M){this._angle=M,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=b,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=E,this.i=M}startDirectionFunction(M,E,b,k){k?x.i.Fd[0].p(b.rg).normalize():b.position.subtractToRef(M.getTranslation(),x.i.Fd[0]).normalize();const a=(0,u.q)(0,this.directionRandomizer),g=(0,u.q)(0,this.directionRandomizer),n=(0,u.q)(0,this.directionRandomizer);E.x=x.i.Fd[0].x+a,E.y=x.i.Fd[0].y+g,E.z=x.i.Fd[0].z+n,E.normalize()}startPositionFunction(M,E,b,k){const a=(0,u.q)(0,2*Math.PI);let g;this.emitFromSpawnPointOnly?g=1e-4:(g=(0,u.q)(0,this.heightRange),g=1-g*g);let n=this._radius-(0,u.q)(0,this._radius*this.radiusRange);n*=g;const J=n*Math.sin(a),T=n*Math.cos(a),V=g*this._height;if(k)return E.x=J,E.y=V,void(E.z=T);x.m.TransformCoordinatesFromFloatsToRef(J,V,T,M,E)}clone(){const M=new I(this._radius,this._angle,this.directionRandomizer);return T.e.DeepCopy(this,M),M}applyToShader(M){M.setFloat2("i",this._radius,this.radiusRange),M.setFloat("coneAngle",this._angle),M.setFloat2("height",this._height,this.heightRange),M.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(M){M.addUniform("i",2),M.addUniform("coneAngle",1),M.addUniform("height",2),M.addUniform("directionRandomizer",1)}getEffectDefines(){let M="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(M+="\n#define CONEEMITTERSPAWNPOINT"),M}getClassName(){return"ConeParticleEmitter"}serialize(){const M={};return M.type=this.getClassName(),M.i=this._radius,M.angle=this._angle,M.directionRandomizer=this.directionRandomizer,M.radiusRange=this.radiusRange,M.heightRange=this.heightRange,M.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,M}parse(M){this.i=M.i,this.angle=M.angle,this.directionRandomizer=M.directionRandomizer,this.radiusRange=void 0!==M.radiusRange?M.radiusRange:1,this.heightRange=void 0!==M.radiusRange?M.heightRange:1,this.emitFromSpawnPointOnly=void 0!==M.emitFromSpawnPointOnly&&M.emitFromSpawnPointOnly}}class t extends I{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new x.m(0,1,0),k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new x.m(0,1,0);super(M,E),this.direction1=b,this.direction2=k}startDirectionFunction(M,E){const b=(0,u.q)(this.direction1.x,this.direction2.x),k=(0,u.q)(this.direction1.y,this.direction2.y),a=(0,u.q)(this.direction1.z,this.direction2.z);x.m.TransformNormalFromFloatsToRef(b,k,a,M,E)}clone(){const M=new t(this.i,this.angle,this.direction1,this.direction2);return T.e.DeepCopy(this,M),M}applyToShader(M){M.setFloat("i",this.i),M.setFloat("radiusRange",this.radiusRange),M.setVector3("direction1",this.direction1),M.setVector3("direction2",this.direction2)}buildUniformLayout(M){M.addUniform("i",1),M.addUniform("radiusRange",1),M.addUniform("direction1",3),M.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const M=super.serialize();return M.direction1=this.direction1.Vd(),M.direction2=this.direction2.Vd(),M}parse(M){super.parse(M),this.direction1.p(M.direction1),this.direction2.p(M.direction2)}}class y{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.i=M,this.height=E,this.radiusRange=b,this.directionRandomizer=k,this._tempVector=x.m.Zero()}startDirectionFunction(M,E,b,k,a){b.position.subtractToRef(M.getTranslation(),this._tempVector),this._tempVector.normalize(),x.m.TransformNormalToRef(this._tempVector,a,this._tempVector);const g=(0,u.q)(-this.directionRandomizer/2,this.directionRandomizer/2);let n=Math.atan2(this._tempVector.x,this._tempVector.z);n+=(0,u.q)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=g,this._tempVector.x=Math.sin(n),this._tempVector.z=Math.cos(n),this._tempVector.normalize(),k?E.p(this._tempVector):x.m.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,M,E)}startPositionFunction(M,E,b,k){const a=(0,u.q)(-this.height/2,this.height/2),g=(0,u.q)(0,2*Math.PI),n=(0,u.q)((1-this.radiusRange)*(1-this.radiusRange),1),J=Math.sqrt(n)*this.i,T=J*Math.cos(g),V=J*Math.sin(g);k?E.Hd(T,a,V):x.m.TransformCoordinatesFromFloatsToRef(T,a,V,M,E)}clone(){const M=new y(this.i,this.directionRandomizer);return T.e.DeepCopy(this,M),M}applyToShader(M){M.setFloat("i",this.i),M.setFloat("height",this.height),M.setFloat("radiusRange",this.radiusRange),M.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(M){M.addUniform("i",1),M.addUniform("height",1),M.addUniform("radiusRange",1),M.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const M={};return M.type=this.getClassName(),M.i=this.i,M.height=this.height,M.radiusRange=this.radiusRange,M.directionRandomizer=this.directionRandomizer,M}parse(M){this.i=M.i,this.height=M.height,this.radiusRange=M.radiusRange,this.directionRandomizer=M.directionRandomizer}}class B extends y{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new x.m(0,1,0),a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new x.m(0,1,0);super(M,E,b),this.direction1=k,this.direction2=a}startDirectionFunction(M,E,b,k){const a=(0,u.q)(this.direction1.x,this.direction2.x),g=(0,u.q)(this.direction1.y,this.direction2.y),n=(0,u.q)(this.direction1.z,this.direction2.z);k?E.Hd(a,g,n):x.m.TransformNormalFromFloatsToRef(a,g,n,M,E)}clone(){const M=new B(this.i,this.height,this.radiusRange,this.direction1,this.direction2);return T.e.DeepCopy(this,M),M}applyToShader(M){M.setFloat("i",this.i),M.setFloat("height",this.height),M.setFloat("radiusRange",this.radiusRange),M.setVector3("direction1",this.direction1),M.setVector3("direction2",this.direction2)}buildUniformLayout(M){M.addUniform("i",1),M.addUniform("height",1),M.addUniform("radiusRange",1),M.addUniform("direction1",3),M.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const M=super.serialize();return M.direction1=this.direction1.Vd(),M.direction2=this.direction2.Vd(),M}parse(M){super.parse(M),x.m.FromArrayToRef(M.direction1,0,this.direction1),x.m.FromArrayToRef(M.direction2,0,this.direction2)}}class r{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.i=M,this.radiusRange=E,this.directionRandomizer=b}startDirectionFunction(M,E,b,k){const a=b.position.Qc(M.getTranslation()).normalize(),g=(0,u.q)(0,this.directionRandomizer),n=(0,u.q)(0,this.directionRandomizer),J=(0,u.q)(0,this.directionRandomizer);a.x+=g,a.y+=n,a.z+=J,a.normalize(),k?E.p(a):x.m.TransformNormalFromFloatsToRef(a.x,a.y,a.z,M,E)}startPositionFunction(M,E,b,k){const a=this.i-(0,u.q)(0,this.i*this.radiusRange),g=(0,u.q)(0,1),n=(0,u.q)(0,2*Math.PI),J=Math.acos(2*g-1),T=a*Math.cos(n)*Math.sin(J),V=a*Math.cos(J),I=a*Math.sin(n)*Math.sin(J);k?E.Hd(T,Math.abs(V),I):x.m.TransformCoordinatesFromFloatsToRef(T,Math.abs(V),I,M,E)}clone(){const M=new r(this.i,this.directionRandomizer);return T.e.DeepCopy(this,M),M}applyToShader(M){M.setFloat("i",this.i),M.setFloat("radiusRange",this.radiusRange),M.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(M){M.addUniform("i",1),M.addUniform("radiusRange",1),M.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const M={};return M.type=this.getClassName(),M.i=this.i,M.radiusRange=this.radiusRange,M.directionRandomizer=this.directionRandomizer,M}parse(M){this.i=M.i,this.radiusRange=M.radiusRange,this.directionRandomizer=M.directionRandomizer}}class c{constructor(){this.direction1=new x.m(0,1,0),this.direction2=new x.m(0,1,0)}startDirectionFunction(M,E,b,k){const a=(0,u.q)(this.direction1.x,this.direction2.x),g=(0,u.q)(this.direction1.y,this.direction2.y),n=(0,u.q)(this.direction1.z,this.direction2.z);k?E.Hd(a,g,n):x.m.TransformNormalFromFloatsToRef(a,g,n,M,E)}startPositionFunction(M,E,b,k){k?E.Hd(0,0,0):x.m.TransformCoordinatesFromFloatsToRef(0,0,0,M,E)}clone(){const M=new c;return T.e.DeepCopy(this,M),M}applyToShader(M){M.setVector3("direction1",this.direction1),M.setVector3("direction2",this.direction2)}buildUniformLayout(M){M.addUniform("direction1",3),M.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const M={};return M.type=this.getClassName(),M.direction1=this.direction1.Vd(),M.direction2=this.direction2.Vd(),M}parse(M){x.m.FromArrayToRef(M.direction1,0,this.direction1),x.m.FromArrayToRef(M.direction2,0,this.direction2)}}class C{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.i=M,this.radiusRange=E,this.directionRandomizer=b}startDirectionFunction(M,E,b,k){const a=b.position.Qc(M.getTranslation()).normalize(),g=(0,u.q)(0,this.directionRandomizer),n=(0,u.q)(0,this.directionRandomizer),J=(0,u.q)(0,this.directionRandomizer);a.x+=g,a.y+=n,a.z+=J,a.normalize(),k?E.p(a):x.m.TransformNormalFromFloatsToRef(a.x,a.y,a.z,M,E)}startPositionFunction(M,E,b,k){const a=this.i-(0,u.q)(0,this.i*this.radiusRange),g=(0,u.q)(0,1),n=(0,u.q)(0,2*Math.PI),J=Math.acos(2*g-1),T=a*Math.cos(n)*Math.sin(J),V=a*Math.cos(J),I=a*Math.sin(n)*Math.sin(J);k?E.Hd(T,V,I):x.m.TransformCoordinatesFromFloatsToRef(T,V,I,M,E)}clone(){const M=new C(this.i,this.directionRandomizer);return T.e.DeepCopy(this,M),M}applyToShader(M){M.setFloat("i",this.i),M.setFloat("radiusRange",this.radiusRange),M.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(M){M.addUniform("i",1),M.addUniform("radiusRange",1),M.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const M={};return M.type=this.getClassName(),M.i=this.i,M.radiusRange=this.radiusRange,M.directionRandomizer=this.directionRandomizer,M}parse(M){this.i=M.i,this.radiusRange=M.radiusRange,this.directionRandomizer=M.directionRandomizer}}class R extends C{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new x.m(0,1,0),b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new x.m(0,1,0);super(M),this.direction1=E,this.direction2=b}startDirectionFunction(M,E){const b=(0,u.q)(this.direction1.x,this.direction2.x),k=(0,u.q)(this.direction1.y,this.direction2.y),a=(0,u.q)(this.direction1.z,this.direction2.z);x.m.TransformNormalFromFloatsToRef(b,k,a,M,E)}clone(){const M=new R(this.i,this.direction1,this.direction2);return T.e.DeepCopy(this,M),M}applyToShader(M){M.setFloat("i",this.i),M.setFloat("radiusRange",this.radiusRange),M.setVector3("direction1",this.direction1),M.setVector3("direction2",this.direction2)}buildUniformLayout(M){M.addUniform("i",1),M.addUniform("radiusRange",1),M.addUniform("direction1",3),M.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const M=super.serialize();return M.direction1=this.direction1.Vd(),M.direction2=this.direction2.Vd(),M}parse(M){super.parse(M),this.direction1.p(M.direction1),this.direction2.p(M.direction2)}}class w{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{}}startDirectionFunction(M,E,b,k){const a=x.i.Fd[0];if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,b,a);const M=x.i.Fd[1];a.subtractToRef(b.position,M),M.scaleToRef(1/b.lifeTime,a)}else a.set(0,0,0);k?E.p(a):x.m.TransformNormalToRef(a,M,E)}startPositionFunction(M,E,b,k){const a=x.i.Fd[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,b,a):a.set(0,0,0),k?E.p(a):x.m.TransformCoordinatesToRef(a,M,E)}clone(){const M=new w;return T.e.DeepCopy(this,M),M}applyToShader(M){}buildUniformLayout(M){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const M={};return M.type=this.getClassName(),M.particlePositionGenerator=this.particlePositionGenerator,M.particleDestinationGenerator=this.particleDestinationGenerator,M}parse(M){M.particlePositionGenerator&&(this.particlePositionGenerator=M.particlePositionGenerator),M.particleDestinationGenerator&&(this.particleDestinationGenerator=M.particleDestinationGenerator)}}var S=b(1228);class X{get mesh(){return this.ee}set mesh(M){this.ee!==M&&(this.ee=M,M?(this._indices=M.Ed(),this._positions=M.getVerticesData(S.g.PositionKind),this._normals=M.getVerticesData(S.g.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=x.m.Zero(),this.ee=null,this.direction1=new x.m(0,1,0),this.direction2=new x.m(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=M}startDirectionFunction(M,E,b,k){if(this.useMeshNormalsForDirection&&this._normals)return void x.m.TransformNormalToRef(this._storedNormal,M,E);const a=(0,u.q)(this.direction1.x,this.direction2.x),g=(0,u.q)(this.direction1.y,this.direction2.y),n=(0,u.q)(this.direction1.z,this.direction2.z);k?E.Hd(a,g,n):x.m.TransformNormalFromFloatsToRef(a,g,n,M,E)}startPositionFunction(M,E,b,k){if(!this._indices||!this._positions)return;const a=3*Math.random()*(this._indices.length/3)|0,g=Math.random(),n=Math.random()*(1-g),J=1-g-n,u=this._indices[a],T=this._indices[a+1],V=this._indices[a+2],I=x.i.Fd[0],t=x.i.Fd[1],y=x.i.Fd[2],B=x.i.Fd[3];x.m.FromArrayToRef(this._positions,3*u,I),x.m.FromArrayToRef(this._positions,3*T,t),x.m.FromArrayToRef(this._positions,3*V,y),B.x=g*I.x+n*t.x+J*y.x,B.y=g*I.y+n*t.y+J*y.y,B.z=g*I.z+n*t.z+J*y.z,k?E.Hd(B.x,B.y,B.z):x.m.TransformCoordinatesFromFloatsToRef(B.x,B.y,B.z,M,E),this.useMeshNormalsForDirection&&this._normals&&(x.m.FromArrayToRef(this._normals,3*u,I),x.m.FromArrayToRef(this._normals,3*T,t),x.m.FromArrayToRef(this._normals,3*V,y),this._storedNormal.x=g*I.x+n*t.x+J*y.x,this._storedNormal.y=g*I.y+n*t.y+J*y.y,this._storedNormal.z=g*I.z+n*t.z+J*y.z)}clone(){const M=new X(this.mesh);return T.e.DeepCopy(this,M),M}applyToShader(M){M.setVector3("direction1",this.direction1),M.setVector3("direction2",this.direction2)}buildUniformLayout(M){M.addUniform("direction1",3),M.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var M;const E={};return E.type=this.getClassName(),E.direction1=this.direction1.Vd(),E.direction2=this.direction2.Vd(),E.meshId=null===(M=this.mesh)||void 0===M?void 0:M.id,E.useMeshNormalsForDirection=this.useMeshNormalsForDirection,E}parse(M,E){x.m.FromArrayToRef(M.direction1,0,this.direction1),x.m.FromArrayToRef(M.direction2,0,this.direction2),M.meshId&&E&&(this.mesh=E.getLastMeshById(M.meshId)),this.useMeshNormalsForDirection=M.useMeshNormalsForDirection}}var U=b(1076);class v{_isUbo(M){return void 0!==M.addUniform}constructor(M){this._isUbo(M)?(this.setMatrix3x3=M.updateMatrix3x3.bind(M),this.setMatrix2x2=M.updateMatrix2x2.bind(M),this.setFloat=M.updateFloat.bind(M),this.setFloat2=M.updateFloat2.bind(M),this.setFloat3=M.updateFloat3.bind(M),this.setFloat4=M.updateFloat4.bind(M),this.setFloatArray=M.updateFloatArray.bind(M),this.setArray=M.updateArray.bind(M),this.setIntArray=M.updateIntArray.bind(M),this.setMatrix=M.ne.bind(M),this.setMatrices=M.updateMatrices.bind(M),this.setVector3=M.updateVector3.bind(M),this.setVector4=M.updateVector4.bind(M),this.setColor3=M.updateColor3.bind(M),this.setColor4=M.updateColor4.bind(M),this.setDirectColor4=M.updateDirectColor4.bind(M),this.setInt=M.updateInt.bind(M),this.setInt2=M.updateInt2.bind(M),this.setInt3=M.updateInt3.bind(M),this.setInt4=M.updateInt4.bind(M)):(this.setMatrix3x3=M.setMatrix3x3.bind(M),this.setMatrix2x2=M.setMatrix2x2.bind(M),this.setFloat=M.setFloat.bind(M),this.setFloat2=M.setFloat2.bind(M),this.setFloat3=M.setFloat3.bind(M),this.setFloat4=M.setFloat4.bind(M),this.setFloatArray=M.setFloatArray.bind(M),this.setArray=M.setArray.bind(M),this.setIntArray=M.setIntArray.bind(M),this.setMatrix=M.setMatrix.bind(M),this.setMatrices=M.setMatrices.bind(M),this.setVector3=M.setVector3.bind(M),this.setVector4=M.setVector4.bind(M),this.setColor3=M.setColor3.bind(M),this.setColor4=M.setColor4.bind(M),this.setDirectColor4=M.setDirectColor4.bind(M),this.setInt=M.setInt.bind(M),this.setInt2=M.setInt2.bind(M),this.setInt3=M.setInt3.bind(M),this.setInt4=M.setInt4.bind(M))}}var N=b(1082);const K="gpuUpdateParticlesPixelShader",h="#version 300 es\nvoid main() {discard;}\n";N.b.ShadersStore[K]=h;const Z="gpuUpdateParticlesVertexShader",O="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";N.b.ShadersStore[Z]=O;(0,n.h)("BABYLON.WebGL2ParticleSystem",class{constructor(M,E){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=M,this._engine=E,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","i","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var M;return(null===(M=this._updateEffect)||void 0===M?void 0:M.isReady())??!1}createUpdateBuffer(M){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof w&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=M,this._updateEffect=new U.b("gpuUpdateParticles",this._updateEffectOptions,this._engine),new v(this._updateEffect)}createVertexBuffers(M,E){this._updateVAO.push(this._createUpdateVAO(M)),this._renderVAO.push(this._engine.recordVertexArrayObject(E,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=E}createParticleBuffer(M){return M}bindDrawBuffers(M,E,b){b?this._engine.bindBuffers(this._renderVertexBuffers,b,E):this._engine.bindVertexArrayObject(this._renderVAO[M],null)}preUpdateParticleBuffer(){const M=this._engine;if(this._engine.enableEffect(this._updateEffect),!M.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(M,E,b){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[M],null);const x=this._engine;x.bindTransformFeedbackBuffer(E.getBuffer()),x.setRasterizerState(!1),x.beginTransformFeedback(!0),x.drawArraysType(3,0,b),x.endTransformFeedback(),x.setRasterizerState(!0),x.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let M=0;M<this._updateVAO.length;M++)this._engine.releaseVertexArrayObject(this._updateVAO[M]);this._updateVAO.length=0;for(let M=0;M<this._renderVAO.length;M++)this._engine.releaseVertexArrayObject(this._renderVAO[M]);this._renderVAO.length=0}_createUpdateVAO(M){const E={};E.position=M.createVertexBuffer("position",0,3);let b=3;E.age=M.createVertexBuffer("age",b,1),b+=1,E.size=M.createVertexBuffer("size",b,3),b+=3,E.life=M.createVertexBuffer("life",b,1),b+=1,E.seed=M.createVertexBuffer("seed",b,4),b+=4,E.direction=M.createVertexBuffer("direction",b,3),b+=3,this._parent.particleEmitterType instanceof w&&(E.initialPosition=M.createVertexBuffer("initialPosition",b,3),b+=3),this._parent._colorGradientsTexture||(E.color=M.createVertexBuffer("color",b,4),b+=4),this._parent._isBillboardBased||(E.initialDirection=M.createVertexBuffer("initialDirection",b,3),b+=3),this._parent.noiseTexture&&(E.noiseCoordinates1=M.createVertexBuffer("noiseCoordinates1",b,3),b+=3,E.noiseCoordinates2=M.createVertexBuffer("noiseCoordinates2",b,3),b+=3),this._parent._angularSpeedGradientsTexture?(E.angle=M.createVertexBuffer("angle",b,1),b+=1):(E.angle=M.createVertexBuffer("angle",b,2),b+=2),this._parent._isAnimationSheetEnabled&&(E.cellIndex=M.createVertexBuffer("cellIndex",b,1),b+=1,this._parent.spriteRandomStartCell&&(E.cellStartOffset=M.createVertexBuffer("cellStartOffset",b,1),b+=1));const x=this._engine.recordVertexArrayObject(E,null,this._updateEffect);return this._engine.bindArrayBuffer(null),x}});class p{constructor(M,E){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,x=arguments.length>3?arguments[3]:void 0;this._engine=M,this._label=x,this._engine._storageBuffers.push(this),this._create(E,b)}_create(M,E){this._bufferSize=M,this._creationFlags=E,this._buffer=this._engine.createStorageBuffer(M,E,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(M,E,b){this._buffer&&this._engine.updateStorageBuffer(this._buffer,M,E,b)}read(M,E,b,x){return this._engine.readFromStorageBuffer(this._buffer,M,E,b,x)}dispose(){const M=this._engine._storageBuffers,E=M.indexOf(this);-1!==E&&(M[E]=M[M.length-1],M.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var P=b(948),F=b(953),l=b(1124),d=b(942),W=b(1307),m=b(1060),o=b(1111),j=b(1300);class s{constructor(){this._gpuTimeInFrameId=-1,this.counter=new j.c}_addDuration(M,E){M<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==M?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(E,!1),this._gpuTimeInFrameId=M):this.counter.addCount(E,!1))}}class q{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(M,E,b){let x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=M,this._engine=E,this.uniqueId=W.c.UniqueId,E.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new s),this._engine.getCaps().supportComputeShaders?x.bindingsMapping?(this._context=E.createComputeContext(),this._shaderPath=b,this._options={bindingsMapping:{},defines:[],...x}):m.d.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):m.d.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(M,E){let b=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const x=this._bindings[M];this._bindings[M]={type:b?0:4,object:E,indexInGroupEntries:null===x||void 0===x?void 0:x.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!x||x.object!==E||x.type!==this._bindings[M].type)}setStorageTexture(M,E){const b=this._bindings[M];this._contextIsDirty||(this._contextIsDirty=!b||b.object!==E),this._bindings[M]={type:1,object:E,indexInGroupEntries:null===b||void 0===b?void 0:b.indexInGroupEntries}}setExternalTexture(M,E){const b=this._bindings[M];this._contextIsDirty||(this._contextIsDirty=!b||b.object!==E),this._bindings[M]={type:6,object:E,indexInGroupEntries:null===b||void 0===b?void 0:b.indexInGroupEntries}}setVideoTexture(M,E){return!!E.externalTexture&&(this.setExternalTexture(M,E.externalTexture),!0)}setUniformBuffer(M,E){const b=this._bindings[M];this._contextIsDirty||(this._contextIsDirty=!b||b.object!==E),this._bindings[M]={type:q._BufferIsDataBuffer(E)?7:2,object:E,indexInGroupEntries:null===b||void 0===b?void 0:b.indexInGroupEntries}}setStorageBuffer(M,E){const b=this._bindings[M];this._contextIsDirty||(this._contextIsDirty=!b||b.object!==E),this._bindings[M]={type:q._BufferIsDataBuffer(E)?7:3,object:E,indexInGroupEntries:null===b||void 0===b?void 0:b.indexInGroupEntries}}setTextureSampler(M,E){const b=this._bindings[M];this._contextIsDirty||(this._contextIsDirty=!b||!E.compareSampler(b.object)),this._bindings[M]={type:5,object:E,indexInGroupEntries:null===b||void 0===b?void 0:b.indexInGroupEntries}}isReady(){let M=this._effect;for(const k in this._bindings){const M=this._bindings[k],E=M.type,b=M.object;switch(E){case 0:case 4:case 1:if(!b.isReady())return!1;break;case 6:if(!b.isReady())return!1;break}}const E=[],b=this._shaderPath;if(this._options.defines)for(let k=0;k<this._options.defines.length;k++)E.push(this._options.defines[k]);const x=E.join("\n");return this._cachedDefines!==x&&(this._cachedDefines=x,M=this._engine.createComputeEffect(b,{defines:x,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=M),!!M.isReady()}dispatch(M,E,b){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,M,E,b,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const b=q._BufferIsDataBuffer(M)?M:M.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,b,E,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const E in this._bindings){const b=this._bindings[E];if(!this._options.bindingsMapping[E])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+E+"'");switch(b.type){case 0:{const x=this._samplers[E],k=b.object;var M;if(!x||!k._texture||!x.compareSampler(k._texture))this._samplers[E]=(new o.b).setParameters(k.wrapU,k.wrapV,k.wrapR,k.anisotropicFilteringLevel,k._texture.samplingMode,null===(M=k._texture)||void 0===M?void 0:M._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const M=b.object;M.getBuffer()!==b.buffer&&(b.buffer=M.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}dispatchWhenReady(M,E,b){let x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return new Promise((k=>{const a=()=>{this.dispatch(M,E,b)?k():setTimeout(a,x)};a()}))}serialize(){const M=l.b.Serialize(this);M.options=this._options,M.shaderPath=this._shaderPath,M.wj={},M.textures={};for(const E in this._bindings){const b=this._bindings[E],x=b.object;switch(b.type){case 0:case 4:case 1:{const k=x.serialize();k&&(M.textures[E]=k,M.wj[E]={type:b.type});break}}}return M}static Parse(M,E,b){const x=l.b.Parse((()=>new q(M.name,E.getEngine(),M.shaderPath,M.options)),M,E,b);for(const k in M.textures){const a=M.wj[k],g=d.e.Parse(M.textures[k],E,b);0===a.type?x.setTexture(k,g):4===a.type?x.setTexture(k,g,!1):x.setStorageTexture(k,g)}return x}static _BufferIsDataBuffer(M){return void 0!==M.underlyingResource}}(0,P.d)([(0,F.E)()],q.prototype,"name",void 0),(0,P.d)([(0,F.E)()],q.prototype,"fastMode",void 0),(0,n.h)("BABYLON.ComputeShader",q);var D=b(1217);const z="gpuUpdateParticlesComputeShader",A="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";N.b.ShadersStoreWGSL[z]=A;(0,n.h)("BABYLON.ComputeShaderParticleSystem",class{constructor(M,E){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=M,this._engine=E}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var M;return(null===(M=this._updateComputeShader)||void 0===M?void 0:M.isReady())??!1}createUpdateBuffer(M){var E;const b={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(b.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(b.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(b.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(b.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(b.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(b.noiseTexture={group:1,binding:11}),this._updateComputeShader=new q("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:b,defines:M.split("\n")}),null===(E=this._simParamsComputeShader)||void 0===E||E.dispose(),this._simParamsComputeShader=new D.c(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new v(this._simParamsComputeShader)}createVertexBuffers(M,E){this._renderVertexBuffers.push(E)}createParticleBuffer(M){const E=new p(this._engine,4*M.length,11,"ComputeShaderParticleSystemBuffer");return E.update(M),this._bufferComputeShader.push(E),E.getBuffer()}bindDrawBuffers(M,E,b){this._engine.bindBuffers(this._renderVertexBuffers[M],b,E)}preUpdateParticleBuffer(){}updateParticleBuffer(M,E,b){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[M]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^M]),this._updateComputeShader.dispatch(Math.ceil(b/64))}releaseBuffers(){var M;for(let E=0;E<this._bufferComputeShader.length;++E)this._bufferComputeShader[E].dispose();this._bufferComputeShader.length=0,null===(M=this._simParamsComputeShader)||void 0===M||M.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class Y{constructor(M,E,b){this.gradient=M,this.color1=E,this.color2=b}getColorToRef(M){this.color2?g.h.LerpToRef(this.color1,this.color2,Math.random(),M):M.p(this.color1)}}class i{constructor(M,E){this.gradient=M,this.color=E}}class G{constructor(M,E,b){this.gradient=M,this.factor1=E,this.factor2=b}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class H{static GetCurrentGradient(M,E,b){if(E[0].gradient>M)return void b(E[0],E[0],1);for(let k=0;k<E.length-1;k++){const x=E[k],a=E[k+1];if(M>=x.gradient&&M<=a.gradient){return void b(x,a,(M-x.gradient)/(a.gradient-x.gradient))}}const x=E.length-1;b(E[x],E[x],1)}}var e=b(962),Q=b(11701),L=b(1005);class f{constructor(M){this.particleSystem=M,this.position=x.m.Zero(),this.direction=x.m.Zero(),this.color=new g.h(0,0,0,0),this.colorStep=new g.h(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new x.l(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new g.h(0,0,0,0),this._currentColor2=new g.h(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=f._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let M=this.age,E=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===E?(E=1,M=this._randomCellOffset):M+=this._randomCellOffset);const b=this._initialEndSpriteCellID-this._initialStartSpriteCellID+1;let x;x=this._initialSpriteCellLoop?(0,u.d)(M*E%this.lifeTime/this.lifeTime):(0,u.d)(M*E/this.lifeTime),this.cellIndex=this._initialStartSpriteCellID+x*b|0}_inheritParticleInfoToSubEmitter(M){if(M.particleSystem.k.position){const E=M.particleSystem.k;if(E.position.p(this.position),M.inheritDirection){const M=x.i.Fd[0];this.direction.normalizeToRef(M),E.setDirection(M,0,Math.PI/2)}}else{M.particleSystem.k.p(this.position)}this.direction.scaleToRef(M.inheritedVelocityAmount/2,x.i.Fd[0]),M.particleSystem._inheritedVelocityOffset.p(x.i.Fd[0])}_inheritParticleInfoToSubEmitters(){this._attachedSubEmitters&&this._attachedSubEmitters.length>0&&this._attachedSubEmitters.forEach((M=>{this._inheritParticleInfoToSubEmitter(M)}))}_reset(){this.age=0,this.id=f._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(M){M.position.p(this.position),this._initialDirection?M._initialDirection?M._initialDirection.p(this._initialDirection):M._initialDirection=this._initialDirection.clone():M._initialDirection=null,M.direction.p(this.direction),this.rg&&(M.rg?M.rg.p(this.rg):M.rg=this.rg.clone()),M.color.p(this.color),M.colorStep.p(this.colorStep),M.lifeTime=this.lifeTime,M.age=this.age,M._randomCellOffset=this._randomCellOffset,M.size=this.size,M.scale.p(this.scale),M.angle=this.angle,M.angularSpeed=this.angularSpeed,M.particleSystem=this.particleSystem,M.cellIndex=this.cellIndex,M.id=this.id,M._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(M._currentColorGradient=this._currentColorGradient,M._currentColor1.p(this._currentColor1),M._currentColor2.p(this._currentColor2)),this._currentSizeGradient&&(M._currentSizeGradient=this._currentSizeGradient,M._currentSize1=this._currentSize1,M._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(M._currentAngularSpeedGradient=this._currentAngularSpeedGradient,M._currentAngularSpeed1=this._currentAngularSpeed1,M._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(M._currentVelocityGradient=this._currentVelocityGradient,M._currentVelocity1=this._currentVelocity1,M._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(M._currentLimitVelocityGradient=this._currentLimitVelocityGradient,M._currentLimitVelocity1=this._currentLimitVelocity1,M._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(M._currentDragGradient=this._currentDragGradient,M._currentDrag1=this._currentDrag1,M._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(M._initialStartSpriteCellID=this._initialStartSpriteCellID,M._initialEndSpriteCellID=this._initialEndSpriteCellID,M._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(M.remapData&&this.remapData?M.remapData.p(this.remapData):M.remapData=new x.o(0,0,0,0)),this._randomNoiseCoordinates1&&(M._randomNoiseCoordinates1?(M._randomNoiseCoordinates1.p(this._randomNoiseCoordinates1),M._randomNoiseCoordinates2.p(this._randomNoiseCoordinates2)):(M._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),M._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}f._Count=0;var MM=b(1364),EM=(b(1466),b(1373)),bM=b(1367),xM=b(1210);class kM extends J{set onDispose(M){this._onDisposeObserver&&this.Rd.remove(this._onDisposeObserver),this._onDisposeObserver=this.Rd.add(M)}get useRampGradients(){return this._useRampGradients}set useRampGradients(M){this._useRampGradients!==M&&(this._useRampGradients=M,this._resetEffect())}get particles(){return this.rj}get shaderLanguage(){return this._shaderLanguage}getActiveCount(){return this.rj.length}getClassName(){return"Pe"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var M;let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(M=this._customWrappers[E])||void 0===M?void 0:M.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[M]??this._customWrappers[0]}setCustomEffect(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[E]=new MM.d(this._engine),this._customWrappers[E].effect=M,this._customWrappers[E].drawContext&&(this._customWrappers[E].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new e.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}constructor(M,E,b){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01;super(M),this._emitterInverseWorldMatrix=x.d.Identity(),this._inheritedVelocityOffset=new x.m,this.Rd=new e.b,this.onStoppedObservable=new e.b,this.rj=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new g.h(0,0,0,0),this._colorDiff=new g.h(0,0,0,0),this._scaledDirection=x.m.Zero(),this._scaledGravity=x.m.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this.isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=M=>{},this.recycleParticle=M=>{const E=this.rj.pop();E!==M&&E.copyTo(M),this._stockParticles.push(E)},this._createParticle=()=>{let M;return 0!==this._stockParticles.length?(M=this._stockParticles.pop(),M._reset()):M=new f(this),this._prepareParticle(M),M},this._shadersLoaded=!1,this._capacity=E,this._epsilon=n,this._isAnimationSheetEnabled=a,b&&"Scene"!==b.getClassName()?(this._engine=b,this.defaultProjectionMatrix=x.d.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=b||L.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.ae.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._attachImageProcessingConfiguration(null),this._customWrappers={0:new MM.d(this._engine)},this._customWrappers[0].effect=k,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new V;let J=null;this.updateFunction=M=>{let E=null;var b;this.noiseTexture&&(E=this.noiseTexture.getSize(),null===(b=this.noiseTexture.getContent())||void 0===b||b.then((M=>{J=M})));const k=M===this.rj;for(let a=0;a<M.length;a++){const b=M[a];let n=this._scaledUpdateSpeed;const T=b.age;if(b.age+=n,b.age>b.lifeTime){const M=b.age-T;n=(b.lifeTime-T)*n/M,b.age=b.lifeTime}const V=b.age/b.lifeTime;this._colorGradients&&this._colorGradients.length>0?H.GetCurrentGradient(V,this._colorGradients,((M,E,x)=>{M!==b._currentColorGradient&&(b._currentColor1.p(b._currentColor2),E.getColorToRef(b._currentColor2),b._currentColorGradient=M),g.h.LerpToRef(b._currentColor1,b._currentColor2,x,b.color)})):(b.colorStep.scaleToRef(n,this._scaledColorStep),b.color.addInPlace(this._scaledColorStep),b.color.a<0&&(b.color.a=0)),this._angularSpeedGradients&&this._angularSpeedGradients.length>0&&H.GetCurrentGradient(V,this._angularSpeedGradients,((M,E,x)=>{M!==b._currentAngularSpeedGradient&&(b._currentAngularSpeed1=b._currentAngularSpeed2,b._currentAngularSpeed2=E.getFactor(),b._currentAngularSpeedGradient=M),b.angularSpeed=(0,u.m)(b._currentAngularSpeed1,b._currentAngularSpeed2,x)})),b.angle+=b.angularSpeed*n;let I=n;if(this._velocityGradients&&this._velocityGradients.length>0&&H.GetCurrentGradient(V,this._velocityGradients,((M,E,x)=>{M!==b._currentVelocityGradient&&(b._currentVelocity1=b._currentVelocity2,b._currentVelocity2=E.getFactor(),b._currentVelocityGradient=M),I*=(0,u.m)(b._currentVelocity1,b._currentVelocity2,x)})),b.direction.scaleToRef(I,this._scaledDirection),this._limitVelocityGradients&&this._limitVelocityGradients.length>0&&H.GetCurrentGradient(V,this._limitVelocityGradients,((M,E,x)=>{M!==b._currentLimitVelocityGradient&&(b._currentLimitVelocity1=b._currentLimitVelocity2,b._currentLimitVelocity2=E.getFactor(),b._currentLimitVelocityGradient=M);const k=(0,u.m)(b._currentLimitVelocity1,b._currentLimitVelocity2,x);b.direction.length()>k&&b.direction.scaleInPlace(this.limitVelocityDamping)})),this._dragGradients&&this._dragGradients.length>0&&H.GetCurrentGradient(V,this._dragGradients,((M,E,x)=>{M!==b._currentDragGradient&&(b._currentDrag1=b._currentDrag2,b._currentDrag2=E.getFactor(),b._currentDragGradient=M);const k=(0,u.m)(b._currentDrag1,b._currentDrag2,x);this._scaledDirection.scaleInPlace(1-k)})),this.isLocal&&b.rg?(b.rg.addInPlace(this._scaledDirection),x.m.TransformCoordinatesToRef(b.rg,this._emitterWorldMatrix,b.position)):b.position.addInPlace(this._scaledDirection),J&&E&&b._randomNoiseCoordinates1){const M=this._fetchR(b._randomNoiseCoordinates1.x,b._randomNoiseCoordinates1.y,E.width,E.height,J),k=this._fetchR(b._randomNoiseCoordinates1.z,b._randomNoiseCoordinates2.x,E.width,E.height,J),a=this._fetchR(b._randomNoiseCoordinates2.y,b._randomNoiseCoordinates2.z,E.width,E.height,J),g=x.i.Fd[0],u=x.i.Fd[1];g.Hd((2*M-1)*this.noiseStrength.x,(2*k-1)*this.noiseStrength.y,(2*a-1)*this.noiseStrength.z),g.scaleToRef(n,u),b.direction.addInPlace(u)}this.gravity.scaleToRef(n,this._scaledGravity),b.direction.addInPlace(this._scaledGravity),this._sizeGradients&&this._sizeGradients.length>0&&H.GetCurrentGradient(V,this._sizeGradients,((M,E,x)=>{M!==b._currentSizeGradient&&(b._currentSize1=b._currentSize2,b._currentSize2=E.getFactor(),b._currentSizeGradient=M),b.size=(0,u.m)(b._currentSize1,b._currentSize2,x)})),this._useRampGradients&&(this._colorRemapGradients&&this._colorRemapGradients.length>0&&H.GetCurrentGradient(V,this._colorRemapGradients,((M,E,x)=>{const k=(0,u.m)(M.factor1,E.factor1,x),a=(0,u.m)(M.factor2,E.factor2,x);b.remapData.x=k,b.remapData.y=a-k})),this._alphaRemapGradients&&this._alphaRemapGradients.length>0&&H.GetCurrentGradient(V,this._alphaRemapGradients,((M,E,x)=>{const k=(0,u.m)(M.factor1,E.factor1,x),a=(0,u.m)(M.factor2,E.factor2,x);b.remapData.z=k,b.remapData.w=a-k}))),this._isAnimationSheetEnabled&&b.updateCellIndex(),b._inheritParticleInfoToSubEmitters(),b.age>=b.lifeTime&&(this._emitFromParticle(b),b._attachedSubEmitters&&(b._attachedSubEmitters.forEach((M=>{M.particleSystem.disposeOnStop=!0,M.particleSystem.stop()})),b._attachedSubEmitters=null),this.recycleParticle(b),k&&a--)}}}serialize(M){throw new Error("Method not implemented.")}clone(M,E){throw new Error("Method not implemented.")}_addFactorGradient(M,E,b,x){const k=new G(E,b,x);M.push(k),M.sort(((M,E)=>M.gradient<E.gradient?-1:M.gradient>E.gradient?1:0))}_removeFactorGradient(M,E){if(!M)return;let b=0;for(const x of M){if(x.gradient===E){M.splice(b,1);break}b++}}addLifeTimeGradient(M,E,b){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,M,E,b),this}removeLifeTimeGradient(M){return this._removeFactorGradient(this._lifeTimeGradients,M),this}addSizeGradient(M,E,b){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,M,E,b),this}removeSizeGradient(M){return this._removeFactorGradient(this._sizeGradients,M),this}addColorRemapGradient(M,E,b){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,M,E,b),this}removeColorRemapGradient(M){return this._removeFactorGradient(this._colorRemapGradients,M),this}addAlphaRemapGradient(M,E,b){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,M,E,b),this}removeAlphaRemapGradient(M){return this._removeFactorGradient(this._alphaRemapGradients,M),this}addAngularSpeedGradient(M,E,b){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,M,E,b),this}removeAngularSpeedGradient(M){return this._removeFactorGradient(this._angularSpeedGradients,M),this}addVelocityGradient(M,E,b){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,M,E,b),this}removeVelocityGradient(M){return this._removeFactorGradient(this._velocityGradients,M),this}addLimitVelocityGradient(M,E,b){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,M,E,b),this}removeLimitVelocityGradient(M){return this._removeFactorGradient(this._limitVelocityGradients,M),this}addDragGradient(M,E,b){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,M,E,b),this}removeDragGradient(M){return this._removeFactorGradient(this._dragGradients,M),this}addEmitRateGradient(M,E,b){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,M,E,b),this}removeEmitRateGradient(M){return this._removeFactorGradient(this._emitRateGradients,M),this}addStartSizeGradient(M,E,b){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,M,E,b),this}removeStartSizeGradient(M){return this._removeFactorGradient(this._startSizeGradients,M),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const M=new Uint8Array(4*this._rawTextureWidth),E=g.i.te[0];for(let b=0;b<this._rawTextureWidth;b++){const x=b/this._rawTextureWidth;H.GetCurrentGradient(x,this._rampGradients,((x,k,a)=>{g.e.LerpToRef(x.color,k.color,a,E),M[4*b]=255*E.r,M[4*b+1]=255*E.g,M[4*b+2]=255*E.b,M[4*b+3]=255}))}this._rampGradientsTexture=Q.c.CreateRGBATexture(M,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((M,E)=>M.gradient<E.gradient?-1:M.gradient>E.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(M,E){this._rampGradients||(this._rampGradients=[]);const b=new i(M,E);return this._rampGradients.push(b),this._syncRampGradientTexture(),this}removeRampGradient(M){return this._removeGradientAndTexture(M,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(M,E,b){this._colorGradients||(this._colorGradients=[]);const x=new Y(M,E,b);return this._colorGradients.push(x),this._colorGradients.sort(((M,E)=>M.gradient<E.gradient?-1:M.gradient>E.gradient?1:0)),this}removeColorGradient(M){if(!this._colorGradients)return this;let E=0;for(const b of this._colorGradients){if(b.gradient===M){this._colorGradients.splice(E,1);break}E++}return this}resetDrawCache(){for(const M of this._drawWrappers)if(M)for(const E of M)null===E||void 0===E||E.dispose();this._drawWrappers=[]}_fetchR(M,E,b,x,k){return k[4*(((M=.5*Math.abs(M)+.5)*b%b|0)+((E=.5*Math.abs(E)+.5)*x%x|0)*b)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const M=this._engine,E=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*E),this._vertexBuffer=new S.d(M,this._vertexData,!0,E);let b=0;const x=this._vertexBuffer.createVertexBuffer(S.g.PositionKind,b,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[S.g.PositionKind]=x,b+=3;const k=this._vertexBuffer.createVertexBuffer(S.g.ColorKind,b,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[S.g.ColorKind]=k,b+=4;const a=this._vertexBuffer.createVertexBuffer("angle",b,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=a,b+=1;const g=this._vertexBuffer.createVertexBuffer("size",b,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=g,b+=2,this._isAnimationSheetEnabled){const M=this._vertexBuffer.createVertexBuffer("cellIndex",b,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=M,b+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const M=this._vertexBuffer.createVertexBuffer("direction",b,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=M,b+=3}if(this._useRampGradients){const M=this._vertexBuffer.createVertexBuffer("remapData",b,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=M,b+=4}let n;if(this._useInstancing){const E=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new S.d(M,E,!1,2),n=this._spriteBuffer.createVertexBuffer("offset",0,2)}else n=this._vertexBuffer.createVertexBuffer("offset",b,2,this._vertexBufferSize,this._useInstancing),b+=2;this._vertexBuffers.offset=n,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const M=[],E=[];let b=0;for(let x=0;x<this._capacity;x++)M.push(b),M.push(b+1),M.push(b+2),M.push(b),M.push(b+2),M.push(b+3),E.push(b,b+1,b+1,b+2,b+2,b+3,b+3,b,b,b+3),b+=4;this._indexBuffer=this._engine.createIndexBuffer(M),this._linesIndexBuffer=this._engine.createIndexBuffer(E)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(M)setTimeout((()=>{this.start(0)}),M);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var E;-1!==(null===(E=this.k)||void 0===E?void 0:E.getClassName().indexOf("Mesh"))&&this.k.ce(!0);const M=this.noiseTexture;if(M&&M.onGeneratedObservable)M.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let E=0;E<this.preWarmCycles;E++)this.animate(!0),M.render()}))}));else for(let E=0;E<this.preWarmCycles;E++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop)}}stop(){let M=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(M))}_postStop(M){}reset(){this._stockParticles.length=0,this.rj.length=0}_appendParticleVertex(M,E,b,k){let a=M*this._vertexBufferSize;if(this._vertexData[a++]=E.position.x+this.mg.x,this._vertexData[a++]=E.position.y+this.mg.y,this._vertexData[a++]=E.position.z+this.mg.z,this._vertexData[a++]=E.color.r,this._vertexData[a++]=E.color.g,this._vertexData[a++]=E.color.b,this._vertexData[a++]=E.color.a,this._vertexData[a++]=E.angle,this._vertexData[a++]=E.scale.x*E.size,this._vertexData[a++]=E.scale.y*E.size,this._isAnimationSheetEnabled&&(this._vertexData[a++]=E.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[a++]=E.direction.x,this._vertexData[a++]=E.direction.y,this._vertexData[a++]=E.direction.z);else if(E._initialDirection){let M=E._initialDirection;this.isLocal&&(x.m.TransformNormalToRef(M,this._emitterWorldMatrix,x.i.Fd[0]),M=x.i.Fd[0]),0===M.x&&0===M.z&&(M.x=.001),this._vertexData[a++]=M.x,this._vertexData[a++]=M.y,this._vertexData[a++]=M.z}else{let M=E.direction;this.isLocal&&(x.m.TransformNormalToRef(M,this._emitterWorldMatrix,x.i.Fd[0]),M=x.i.Fd[0]),0===M.x&&0===M.z&&(M.x=.001),this._vertexData[a++]=M.x,this._vertexData[a++]=M.y,this._vertexData[a++]=M.z}this._useRampGradients&&E.remapData&&(this._vertexData[a++]=E.remapData.x,this._vertexData[a++]=E.remapData.y,this._vertexData[a++]=E.remapData.z,this._vertexData[a++]=E.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===b?b=this._epsilon:1===b&&(b=1-this._epsilon),0===k?k=this._epsilon:1===k&&(k=1-this._epsilon)),this._vertexData[a++]=b,this._vertexData[a++]=k)}_prepareParticle(M){}_update(M){if(this._alive=this.rj.length>0,this.k.position){const M=this.k;this._emitterWorldMatrix=M.getWorldMatrix()}else{const M=this.k;this._emitterWorldMatrix=x.d.Translation(M.x,M.y,M.z)}let E;this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.rj);for(let b=0;b<M&&this.rj.length!==this._capacity;b++){if(E=this._createParticle(),this.rj.push(E),this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0){const M=(0,u.d)(this._actualFrame/this.targetStopDuration);H.GetCurrentGradient(M,this._lifeTimeGradients,((b,x)=>{const k=b,a=x,g=k.getFactor(),n=a.getFactor(),J=(M-k.gradient)/(a.gradient-k.gradient);E.lifeTime=(0,u.m)(g,n,J)}))}else E.lifeTime=(0,u.q)(this.minLifeTime,this.maxLifeTime);const M=(0,u.q)(this.minEmitPower,this.maxEmitPower);if(this.startPositionFunction?this.startPositionFunction(this._emitterWorldMatrix,E.position,E,this.isLocal):this.particleEmitterType.startPositionFunction(this._emitterWorldMatrix,E.position,E,this.isLocal),this.isLocal&&(E.rg?E.rg.p(E.position):E.rg=E.position.clone(),x.m.TransformCoordinatesToRef(E.rg,this._emitterWorldMatrix,E.position)),this.startDirectionFunction?this.startDirectionFunction(this._emitterWorldMatrix,E.direction,E,this.isLocal):this.particleEmitterType.startDirectionFunction(this._emitterWorldMatrix,E.direction,E,this.isLocal,this._emitterInverseWorldMatrix),0===M?E._initialDirection?E._initialDirection.p(E.direction):E._initialDirection=E.direction.clone():E._initialDirection=null,E.direction.scaleInPlace(M),this._sizeGradients&&0!==this._sizeGradients.length?(E._currentSizeGradient=this._sizeGradients[0],E._currentSize1=E._currentSizeGradient.getFactor(),E.size=E._currentSize1,this._sizeGradients.length>1?E._currentSize2=this._sizeGradients[1].getFactor():E._currentSize2=E._currentSize1):E.size=(0,u.q)(this.minSize,this.maxSize),E.scale.Hd((0,u.q)(this.minScaleX,this.maxScaleX),(0,u.q)(this.minScaleY,this.maxScaleY)),this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration){const M=this._actualFrame/this.targetStopDuration;H.GetCurrentGradient(M,this._startSizeGradients,((M,b,x)=>{M!==this._currentStartSizeGradient&&(this._currentStartSize1=this._currentStartSize2,this._currentStartSize2=b.getFactor(),this._currentStartSizeGradient=M);const k=(0,u.m)(this._currentStartSize1,this._currentStartSize2,x);E.scale.scaleInPlace(k)}))}if(this._angularSpeedGradients&&0!==this._angularSpeedGradients.length?(E._currentAngularSpeedGradient=this._angularSpeedGradients[0],E.angularSpeed=E._currentAngularSpeedGradient.getFactor(),E._currentAngularSpeed1=E.angularSpeed,this._angularSpeedGradients.length>1?E._currentAngularSpeed2=this._angularSpeedGradients[1].getFactor():E._currentAngularSpeed2=E._currentAngularSpeed1):E.angularSpeed=(0,u.q)(this.minAngularSpeed,this.maxAngularSpeed),E.angle=(0,u.q)(this.minInitialRotation,this.maxInitialRotation),this._velocityGradients&&this._velocityGradients.length>0&&(E._currentVelocityGradient=this._velocityGradients[0],E._currentVelocity1=E._currentVelocityGradient.getFactor(),this._velocityGradients.length>1?E._currentVelocity2=this._velocityGradients[1].getFactor():E._currentVelocity2=E._currentVelocity1),this._limitVelocityGradients&&this._limitVelocityGradients.length>0&&(E._currentLimitVelocityGradient=this._limitVelocityGradients[0],E._currentLimitVelocity1=E._currentLimitVelocityGradient.getFactor(),this._limitVelocityGradients.length>1?E._currentLimitVelocity2=this._limitVelocityGradients[1].getFactor():E._currentLimitVelocity2=E._currentLimitVelocity1),this._dragGradients&&this._dragGradients.length>0&&(E._currentDragGradient=this._dragGradients[0],E._currentDrag1=E._currentDragGradient.getFactor(),this._dragGradients.length>1?E._currentDrag2=this._dragGradients[1].getFactor():E._currentDrag2=E._currentDrag1),this._colorGradients&&0!==this._colorGradients.length)E._currentColorGradient=this._colorGradients[0],E._currentColorGradient.getColorToRef(E.color),E._currentColor1.p(E.color),this._colorGradients.length>1?this._colorGradients[1].getColorToRef(E._currentColor2):E._currentColor2.p(E.color);else{const M=(0,u.q)(0,1);g.h.LerpToRef(this.color1,this.color2,M,E.color),this.colorDead.subtractToRef(E.color,this._colorDiff),this._colorDiff.scaleToRef(1/E.lifeTime,E.colorStep)}this._isAnimationSheetEnabled&&(E._initialStartSpriteCellID=this.startSpriteCellID,E._initialEndSpriteCellID=this.endSpriteCellID,E._initialSpriteCellLoop=this.spriteCellLoop),E.direction.addInPlace(this._inheritedVelocityOffset),this._useRampGradients&&(E.remapData=new x.o(0,1,0,1)),this.noiseTexture&&(E._randomNoiseCoordinates1?(E._randomNoiseCoordinates1.Hd(Math.random(),Math.random(),Math.random()),E._randomNoiseCoordinates2.Hd(Math.random(),Math.random(),Math.random())):(E._randomNoiseCoordinates1=new x.m(Math.random(),Math.random(),Math.random()),E._randomNoiseCoordinates2=new x.m(Math.random(),Math.random(),Math.random()))),E._inheritParticleInfoToSubEmitters()}}static _GetAttributeNamesOrOptions(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0],E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const x=[S.g.PositionKind,S.g.ColorKind,"angle","offset","size"];return M&&x.push("cellIndex"),E||x.push("direction"),b&&x.push("remapData"),x}static _GetEffectCreationOptions(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0],E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const x=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,EM.b)(x),M&&x.push("particlesInfos"),E&&x.push("logarithmicDepthConstant"),b&&(x.push("vFogInfos"),x.push("vFogColor")),x}fillDefines(M,E){let b=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,EM.k)(this,this._scene,M),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&M.push("#define FOG")),this._isAnimationSheetEnabled&&M.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&M.push("#define LOGARITHMICDEPTH"),E===J.BLENDMODE_MULTIPLY&&M.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&M.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(M.push("#define BILLBOARD"),this.billboardMode){case 2:M.push("#define BILLBOARDY");break;case 8:case 9:M.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&M.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:M.push("#define BILLBOARDMODE_ALL")}b&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),M.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(M,E,b){E.push(...kM._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),M.push(...kM._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),b.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,xM.f)(M,this._imageProcessingConfigurationDefines),(0,xM.d)(b,this._imageProcessingConfigurationDefines))}_getWrapper(M){const E=this._getCustomDrawWrapper(M);if(null!==E&&void 0!==E&&E.effect)return E;const b=[];this.fillDefines(b,M);const x=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let k=this._drawWrappers[x];k||(k=this._drawWrappers[x]=[]);let a=k[M];a||(a=new MM.d(this._engine),a.drawContext&&(a.drawContext.useInstancing=this._useInstancing),k[M]=a);const g=b.join("\n");if(a.defines!==g){const M=[],E=[],b=[];this.fillUniformsAttributesAndSamplerNames(E,M,b),a.setEffect(this._engine.createEffect("particles",M,E,b,g,void 0,void 0,void 0,void 0,this._shaderLanguage),g)}return a}animate(){var M;let E,b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started){if(!b&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(b?this.preWarmStepOffset:(null===(M=this._scene)||void 0===M?void 0:M.getAnimationRatio())||1),this.manualEmitCount>-1)E=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let M=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const E=this._actualFrame/this.targetStopDuration;H.GetCurrentGradient(E,this._emitRateGradients,((E,b,x)=>{E!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=b.getFactor(),this._currentEmitRateGradient=E),M=(0,u.m)(this._currentEmitRate1,this._currentEmitRate2,x)}))}E=M*this._scaledUpdateSpeed|0,this._newPartsExcess+=M*this._scaledUpdateSpeed-E}if(this._newPartsExcess>1&&(E+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?E=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(E),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!b){let M=0;for(let E=0;E<this.rj.length;E++){const b=this.rj[E];this._appendParticleVertices(M,b),M+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.rj.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(M,E){this._appendParticleVertex(M++,E,0,0),this._useInstancing||(this._appendParticleVertex(M++,E,1,0),this._appendParticleVertex(M++,E,1,1),this._appendParticleVertex(M++,E,0,1))}rebuild(){var M;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(M=this._spriteBuffer)||void 0===M||M._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!kM.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(b.bind(b,11755)),Promise.resolve().then(b.bind(b,11748))])):await Promise.all([Promise.resolve().then(b.bind(b,11741)),Promise.resolve().then(b.bind(b,11733))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.k||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==J.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(J.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(J.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(M){const E=this._getWrapper(M),b=E.effect,k=this._engine;k.enableEffect(E);const a=this.defaultViewMatrix??this._scene.getViewMatrix();if(b.setTexture("diffuseSampler",this.particleTexture),b.setMatrix("view",a),b.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const M=this.particleTexture.getBaseSize();b.setFloat3("particlesInfos",this.spriteCellWidth/M.width,this.spriteCellHeight/M.height,this.spriteCellWidth/M.width)}if(b.setVector2("translationPivot",this.translationPivot),b.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const M=this._scene.activeCamera;b.setVector3("eyePosition",M.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),b.setTexture("rampSampler",this._rampGradientsTexture));const g=b.defines;var n,u,T,V,I,t;(this._scene&&((0,EM.e)(b,this,this._scene),this.applyFog&&(0,bM.e)(this._scene,void 0,b)),g.indexOf("#define BILLBOARDMODE_ALL")>=0&&(a.invertToRef(x.i.Matrix[0]),b.setMatrix("invView",x.i.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(n=this._scene)&&void 0!==n&&n.forceWireframe?k.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,b):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,b)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(u=this._scene)&&void 0!==u&&u.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?k.bindBuffers(this._vertexBuffers,null!==(T=this._scene)&&void 0!==T&&T.forceWireframe?this._linesIndexBuffer:this._indexBuffer,b):k.bindBuffers(this._vertexBuffers,null!==(V=this._scene)&&void 0!==V&&V.forceWireframe?this._linesIndexBufferUseInstancing:null,b);switch(this.useLogarithmicDepth&&this._scene&&(0,bM.k)(g,b,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(b),M){case J.BLENDMODE_ADD:k.setAlphaMode(1);break;case J.BLENDMODE_ONEONE:k.setAlphaMode(6);break;case J.BLENDMODE_STANDARD:k.setAlphaMode(2);break;case J.BLENDMODE_MULTIPLY:k.setAlphaMode(4)}(this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(b),this._useInstancing)?null!==(I=this._scene)&&void 0!==I&&I.forceWireframe?k.drawElementsType(6,0,10,this.rj.length):k.drawArraysType(7,0,4,this.rj.length):null!==(t=this._scene)&&void 0!==t&&t.forceWireframe?k.drawElementsType(1,0,10*this.rj.length):k.drawElementsType(0,0,6*this.rj.length);return this.rj.length}render(){if(!this.isReady()||!this.rj.length)return 0;const M=this._engine;M.setState&&(M.setState(!1),this.forceDepthWrite&&M.setDepthWrite(!0));let E=0;return E=this.blendMode===J.BLENDMODE_MULTIPLYADD?this._render(J.BLENDMODE_MULTIPLY)+this._render(J.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),E}_onDispose(){}dispose(){let M=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),M&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),M&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(E,b),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const M=this._scene.ae.indexOf(this);M>-1&&this._scene.ae.splice(M,1),this._scene._activeParticleSystems.dispose()}this.Rd.notifyObservers(this),this.Rd.clear(),this.onStoppedObservable.clear(),this.reset()}}kM.ForceGLSL=!1;var aM,gM=b(1056);!function(M){M[M.ATTACHED=0]="ATTACHED",M[M.END=1]="END"}(aM||(aM={}));class nM{constructor(M){if(this.particleSystem=M,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!M.k||!M.k.dispose){const E=(0,n.e)("BABYLON.AbstractMesh");M.k=new E("SubemitterSystemEmitter",M.va()),M._disposeEmitterOnDispose=!0}}clone(){let M=this.particleSystem.k;if(M){if(M instanceof x.m)M=M.clone();else if(-1!==M.getClassName().indexOf("Mesh")){M=new((0,n.e)("BABYLON.Mesh"))("",M.va()),M.isVisible=!1}}else M=new x.m;const E=new nM(this.particleSystem.clone(this.particleSystem.name,M));return E.particleSystem.name+="Clone",E.type=this.type,E.inheritDirection=this.inheritDirection,E.inheritedVelocityAmount=this.inheritedVelocityAmount,E.particleSystem._disposeEmitterOnDispose=!0,E.particleSystem.disposeOnStop=!0,E}serialize(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const E={};return E.type=this.type,E.inheritDirection=this.inheritDirection,E.inheritedVelocityAmount=this.inheritedVelocityAmount,E.particleSystem=this.particleSystem.serialize(M),E}static _ParseParticleSystem(M,E,b){throw(0,gM.b)("ParseParticle")}static Parse(M,E,b){const x=M.particleSystem,k=new nM(nM._ParseParticleSystem(x,E,b,!0));return k.type=M.type,k.inheritDirection=M.inheritDirection,k.inheritedVelocityAmount=M.inheritedVelocityAmount,k.particleSystem._isSubEmitter=!0,k}dispose(){this.particleSystem.dispose()}}var JM=b(1073);function uM(M,E){const b=new c;return b.direction1=M,b.direction2=E,b}function TM(){return new r(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function VM(){return new C(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function IM(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new x.m(0,1,0),b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new x.m(0,1,0);return new R(M,E,b)}function tM(){return new y(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function yM(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new x.m(0,1,0),a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new x.m(0,1,0);return new B(M,E,b,k,a)}function BM(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new I(M,E)}function rM(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new x.m(0,1,0),k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new x.m(0,1,0);return new t(M,E,b,k)}class cM extends kM{constructor(){super(...arguments),this._disposeEmitterOnDispose=!1,this._emitFromParticle=M=>{if(!this._subEmitters||0===this._subEmitters.length)return;const E=Math.floor(Math.random()*this._subEmitters.length);this._subEmitters[E].forEach((E=>{if(1===E.type){const b=E.clone();M._inheritParticleInfoToSubEmitter(b),b.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(b.particleSystem),b.particleSystem.start()}}))}}createPointEmitter(M,E){const b=uM(M,E);return this.particleEmitterType=b,b}createHemisphericEmitter(){const M=TM(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=M,M}createSphereEmitter(){const M=VM(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=M,M}createDirectedSphereEmitter(){const M=IM(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new x.m(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new x.m(0,1,0));return this.particleEmitterType=M,M}createCylinderEmitter(){const M=tM(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=M,M}createDirectedCylinderEmitter(){const M=yM(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new x.m(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new x.m(0,1,0));return this.particleEmitterType=M,M}createConeEmitter(){const M=BM(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=M,M}createDirectedConeEmitter(){const M=rM(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new x.m(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new x.m(0,1,0));return this.particleEmitterType=M,M}createBoxEmitter(M,E,b,x){const k=new V;return this.particleEmitterType=k,this.direction1=M,this.direction2=E,this.minEmitBox=b,this.maxEmitBox=x,k}_prepareSubEmitterInternalArray(){this._subEmitters=new Array,this.subEmitters&&this.subEmitters.forEach((M=>{M instanceof cM?this._subEmitters.push([new nM(M)]):M instanceof nM?this._subEmitters.push([M]):M instanceof Array&&this._subEmitters.push(M)}))}_stopSubEmitters(){this.activeSubSystems&&(this.activeSubSystems.forEach((M=>{M.stop(!0)})),this.activeSubSystems=[])}_removeFromRoot(){if(!this._rootParticleSystem)return;const M=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==M&&this._rootParticleSystem.activeSubSystems.splice(M,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(M){M&&this._stopSubEmitters()}_prepareParticle(M){if(this._subEmitters&&this._subEmitters.length>0){const E=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];M._attachedSubEmitters=[],E.forEach((E=>{if(0===E.type){const b=E.clone();M._attachedSubEmitters.push(b),b.particleSystem.start()}}))}}_onDispose(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0],E=arguments.length>1&&void 0!==arguments[1]&&arguments[1];var b;(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),M)&&(null===(b=this.particles)||void 0===b||b.forEach((M=>{if(M._attachedSubEmitters)for(let E=M._attachedSubEmitters.length-1;E>=0;E-=1)M._attachedSubEmitters[E].dispose()})));if(E&&this.activeSubSystems)for(let x=this.activeSubSystems.length-1;x>=0;x-=1)this.activeSubSystems[x].dispose();if(this._subEmitters&&this._subEmitters.length){for(let M=0;M<this._subEmitters.length;M++)for(const E of this._subEmitters[M])E.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.k&&this.k.dispose&&this.k.dispose(!0)}static _Parse(M,E,b,k){let a;a=b instanceof JM.c?null:b;const J=(0,n.e)("BABYLON.Texture");if(J&&a&&(M.texture?E.particleTexture=J.Parse(M.texture,a,k):M.textureName&&(E.particleTexture=new J(k+M.textureName,a,!1,void 0===M.invertY||M.invertY),E.particleTexture.name=M.textureName)),M.emitterId||0===M.emitterId||void 0!==M.k?M.emitterId&&a?E.k=a.getLastMeshById(M.emitterId):E.k=x.m.Id(M.k):E.k=x.m.Zero(),E.isLocal=!!M.isLocal,void 0!==M.renderingGroupId&&(E.renderingGroupId=M.renderingGroupId),void 0!==M.isBillboardBased&&(E.isBillboardBased=M.isBillboardBased),void 0!==M.billboardMode&&(E.billboardMode=M.billboardMode),void 0!==M.useLogarithmicDepth&&(E.useLogarithmicDepth=M.useLogarithmicDepth),M.animations){for(let b=0;b<M.animations.length;b++){const x=M.animations[b],k=(0,n.e)("BABYLON.Animation");k&&E.animations.push(k.Parse(x))}E.beginAnimationOnStart=M.beginAnimationOnStart,E.beginAnimationFrom=M.beginAnimationFrom,E.beginAnimationTo=M.beginAnimationTo,E.beginAnimationLoop=M.beginAnimationLoop}if(M.autoAnimate&&a&&a.beginAnimation(E,M.autoAnimateFrom,M.autoAnimateTo,M.autoAnimateLoop,M.autoAnimateSpeed||1),E.startDelay=0|M.startDelay,E.minAngularSpeed=M.minAngularSpeed,E.maxAngularSpeed=M.maxAngularSpeed,E.minSize=M.minSize,E.maxSize=M.maxSize,M.minScaleX&&(E.minScaleX=M.minScaleX,E.maxScaleX=M.maxScaleX,E.minScaleY=M.minScaleY,E.maxScaleY=M.maxScaleY),void 0!==M.preWarmCycles&&(E.preWarmCycles=M.preWarmCycles,E.preWarmStepOffset=M.preWarmStepOffset),void 0!==M.minInitialRotation&&(E.minInitialRotation=M.minInitialRotation,E.maxInitialRotation=M.maxInitialRotation),E.minLifeTime=M.minLifeTime,E.maxLifeTime=M.maxLifeTime,E.minEmitPower=M.minEmitPower,E.maxEmitPower=M.maxEmitPower,E.emitRate=M.emitRate,E.gravity=x.m.Id(M.gravity),M.noiseStrength&&(E.noiseStrength=x.m.Id(M.noiseStrength)),E.color1=g.h.Id(M.color1),E.color2=g.h.Id(M.color2),E.colorDead=g.h.Id(M.colorDead),E.updateSpeed=M.updateSpeed,E.targetStopDuration=M.targetStopDuration,E.blendMode=M.blendMode,M.colorGradients)for(const x of M.colorGradients)E.addColorGradient(x.gradient,g.h.Id(x.color1),x.color2?g.h.Id(x.color2):void 0);if(M.rampGradients){for(const b of M.rampGradients)E.addRampGradient(b.gradient,g.e.Id(b.color));E.useRampGradients=M.useRampGradients}if(M.colorRemapGradients)for(const x of M.colorRemapGradients)E.addColorRemapGradient(x.gradient,void 0!==x.factor1?x.factor1:x.factor,x.factor2);if(M.alphaRemapGradients)for(const x of M.alphaRemapGradients)E.addAlphaRemapGradient(x.gradient,void 0!==x.factor1?x.factor1:x.factor,x.factor2);if(M.sizeGradients)for(const x of M.sizeGradients)E.addSizeGradient(x.gradient,void 0!==x.factor1?x.factor1:x.factor,x.factor2);if(M.angularSpeedGradients)for(const x of M.angularSpeedGradients)E.addAngularSpeedGradient(x.gradient,void 0!==x.factor1?x.factor1:x.factor,x.factor2);if(M.velocityGradients)for(const x of M.velocityGradients)E.addVelocityGradient(x.gradient,void 0!==x.factor1?x.factor1:x.factor,x.factor2);if(M.dragGradients)for(const x of M.dragGradients)E.addDragGradient(x.gradient,void 0!==x.factor1?x.factor1:x.factor,x.factor2);if(M.emitRateGradients)for(const x of M.emitRateGradients)E.addEmitRateGradient(x.gradient,void 0!==x.factor1?x.factor1:x.factor,x.factor2);if(M.startSizeGradients)for(const x of M.startSizeGradients)E.addStartSizeGradient(x.gradient,void 0!==x.factor1?x.factor1:x.factor,x.factor2);if(M.lifeTimeGradients)for(const x of M.lifeTimeGradients)E.addLifeTimeGradient(x.gradient,void 0!==x.factor1?x.factor1:x.factor,x.factor2);if(M.limitVelocityGradients){for(const b of M.limitVelocityGradients)E.addLimitVelocityGradient(b.gradient,void 0!==b.factor1?b.factor1:b.factor,b.factor2);E.limitVelocityDamping=M.limitVelocityDamping}if(M.noiseTexture&&a){const b=(0,n.e)("BABYLON.ProceduralTexture");E.noiseTexture=b.Parse(M.noiseTexture,a,k)}let u;if(M.particleEmitterType){switch(M.particleEmitterType.type){case"SphereParticleEmitter":u=new C;break;case"SphereDirectedParticleEmitter":u=new R;break;case"ConeEmitter":case"ConeParticleEmitter":u=new I;break;case"ConeDirectedParticleEmitter":u=new t;break;case"CylinderParticleEmitter":u=new y;break;case"CylinderDirectedParticleEmitter":u=new B;break;case"HemisphericParticleEmitter":u=new r;break;case"PointParticleEmitter":u=new c;break;case"MeshParticleEmitter":u=new X;break;case"CustomParticleEmitter":u=new w;break;default:u=new V}u.parse(M.particleEmitterType,a)}else u=new V,u.parse(M,a);E.particleEmitterType=u,E.startSpriteCellID=M.startSpriteCellID,E.endSpriteCellID=M.endSpriteCellID,E.spriteCellLoop=M.spriteCellLoop??!0,E.spriteCellWidth=M.spriteCellWidth,E.spriteCellHeight=M.spriteCellHeight,E.spriteCellChangeSpeed=M.spriteCellChangeSpeed,E.spriteRandomStartCell=M.spriteRandomStartCell,E.disposeOnStop=M.disposeOnStop??!1,E.manualEmitCount=M.manualEmitCount??-1}static Parse(M,E,b){let k=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4?arguments[4]:void 0;const n=M.name;let J,u,T=null,V=null;if(E instanceof JM.c?J=E:(u=E,J=u.getEngine()),M.customShader&&J.createEffectForParticles){V=M.customShader;const E=V.shaderOptions.defines.length>0?V.shaderOptions.defines.join("\n"):"";T=J.createEffectForParticles(V.shaderPath.fragmentElement,V.shaderOptions.uniforms,V.shaderOptions.samplers,E)}const I=new cM(n,a||M.Dd,E,T,M.isAnimationSheetEnabled);if(I.customShader=V,I._rootUrl=b,M.id&&(I.id=M.id),M.subEmitters){I.subEmitters=[];for(const x of M.subEmitters){const M=[];for(const k of x)M.push(nM.Parse(k,E,b));I.subEmitters.push(M)}}return cM._Parse(M,I,E,b),M.textureMask&&(I.textureMask=g.h.Id(M.textureMask)),M.mg&&(I.mg=x.m.Id(M.mg)),M.preventAutoStart&&(I.preventAutoStart=M.preventAutoStart),k||I.preventAutoStart||I.start(),I}serialize(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const E={};if(cM._Serialize(E,this,M),E.textureMask=this.textureMask.Vd(),E.customShader=this.customShader,E.preventAutoStart=this.preventAutoStart,E.mg=this.mg.Vd(),this.subEmitters){E.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const b of this._subEmitters){const x=[];for(const E of b)x.push(E.serialize(M));E.subEmitters.push(x)}}return E}static _Serialize(M,E,b){if(M.name=E.name,M.id=E.id,M.Dd=E.getCapacity(),M.disposeOnStop=E.disposeOnStop,M.manualEmitCount=E.manualEmitCount,E.k.position){const b=E.k;M.emitterId=b.id}else{const b=E.k;M.k=b.Vd()}E.particleEmitterType&&(M.particleEmitterType=E.particleEmitterType.serialize()),E.particleTexture&&(b?M.texture=E.particleTexture.serialize():(M.textureName=E.particleTexture.name,M.invertY=!!E.particleTexture._invertY)),M.isLocal=E.isLocal,l.b.AppendSerializedAnimations(E,M),M.beginAnimationOnStart=E.beginAnimationOnStart,M.beginAnimationFrom=E.beginAnimationFrom,M.beginAnimationTo=E.beginAnimationTo,M.beginAnimationLoop=E.beginAnimationLoop,M.startDelay=E.startDelay,M.renderingGroupId=E.renderingGroupId,M.isBillboardBased=E.isBillboardBased,M.billboardMode=E.billboardMode,M.minAngularSpeed=E.minAngularSpeed,M.maxAngularSpeed=E.maxAngularSpeed,M.minSize=E.minSize,M.maxSize=E.maxSize,M.minScaleX=E.minScaleX,M.maxScaleX=E.maxScaleX,M.minScaleY=E.minScaleY,M.maxScaleY=E.maxScaleY,M.minEmitPower=E.minEmitPower,M.maxEmitPower=E.maxEmitPower,M.minLifeTime=E.minLifeTime,M.maxLifeTime=E.maxLifeTime,M.emitRate=E.emitRate,M.gravity=E.gravity.Vd(),M.noiseStrength=E.noiseStrength.Vd(),M.color1=E.color1.Vd(),M.color2=E.color2.Vd(),M.colorDead=E.colorDead.Vd(),M.updateSpeed=E.updateSpeed,M.targetStopDuration=E.targetStopDuration,M.blendMode=E.blendMode,M.preWarmCycles=E.preWarmCycles,M.preWarmStepOffset=E.preWarmStepOffset,M.minInitialRotation=E.minInitialRotation,M.maxInitialRotation=E.maxInitialRotation,M.startSpriteCellID=E.startSpriteCellID,M.spriteCellLoop=E.spriteCellLoop,M.endSpriteCellID=E.endSpriteCellID,M.spriteCellChangeSpeed=E.spriteCellChangeSpeed,M.spriteCellWidth=E.spriteCellWidth,M.spriteCellHeight=E.spriteCellHeight,M.spriteRandomStartCell=E.spriteRandomStartCell,M.isAnimationSheetEnabled=E.isAnimationSheetEnabled,M.useLogarithmicDepth=E.useLogarithmicDepth;const x=E.getColorGradients();if(x){M.colorGradients=[];for(const E of x){const b={gradient:E.gradient,color1:E.color1.Vd()};E.color2?b.color2=E.color2.Vd():b.color2=E.color1.Vd(),M.colorGradients.push(b)}}const k=E.getRampGradients();if(k){M.rampGradients=[];for(const E of k){const b={gradient:E.gradient,color:E.color.Vd()};M.rampGradients.push(b)}M.useRampGradients=E.useRampGradients}const a=E.getColorRemapGradients();if(a){M.colorRemapGradients=[];for(const E of a){const b={gradient:E.gradient,factor1:E.factor1};void 0!==E.factor2?b.factor2=E.factor2:b.factor2=E.factor1,M.colorRemapGradients.push(b)}}const g=E.getAlphaRemapGradients();if(g){M.alphaRemapGradients=[];for(const E of g){const b={gradient:E.gradient,factor1:E.factor1};void 0!==E.factor2?b.factor2=E.factor2:b.factor2=E.factor1,M.alphaRemapGradients.push(b)}}const n=E.getSizeGradients();if(n){M.sizeGradients=[];for(const E of n){const b={gradient:E.gradient,factor1:E.factor1};void 0!==E.factor2?b.factor2=E.factor2:b.factor2=E.factor1,M.sizeGradients.push(b)}}const J=E.getAngularSpeedGradients();if(J){M.angularSpeedGradients=[];for(const E of J){const b={gradient:E.gradient,factor1:E.factor1};void 0!==E.factor2?b.factor2=E.factor2:b.factor2=E.factor1,M.angularSpeedGradients.push(b)}}const u=E.getVelocityGradients();if(u){M.velocityGradients=[];for(const E of u){const b={gradient:E.gradient,factor1:E.factor1};void 0!==E.factor2?b.factor2=E.factor2:b.factor2=E.factor1,M.velocityGradients.push(b)}}const T=E.getDragGradients();if(T){M.dragGradients=[];for(const E of T){const b={gradient:E.gradient,factor1:E.factor1};void 0!==E.factor2?b.factor2=E.factor2:b.factor2=E.factor1,M.dragGradients.push(b)}}const V=E.getEmitRateGradients();if(V){M.emitRateGradients=[];for(const E of V){const b={gradient:E.gradient,factor1:E.factor1};void 0!==E.factor2?b.factor2=E.factor2:b.factor2=E.factor1,M.emitRateGradients.push(b)}}const I=E.getStartSizeGradients();if(I){M.startSizeGradients=[];for(const E of I){const b={gradient:E.gradient,factor1:E.factor1};void 0!==E.factor2?b.factor2=E.factor2:b.factor2=E.factor1,M.startSizeGradients.push(b)}}const t=E.getLifeTimeGradients();if(t){M.lifeTimeGradients=[];for(const E of t){const b={gradient:E.gradient,factor1:E.factor1};void 0!==E.factor2?b.factor2=E.factor2:b.factor2=E.factor1,M.lifeTimeGradients.push(b)}}const y=E.getLimitVelocityGradients();if(y){M.limitVelocityGradients=[];for(const E of y){const b={gradient:E.gradient,factor1:E.factor1};void 0!==E.factor2?b.factor2=E.factor2:b.factor2=E.factor1,M.limitVelocityGradients.push(b)}M.limitVelocityDamping=E.limitVelocityDamping}E.noiseTexture&&(M.noiseTexture=E.noiseTexture.serialize())}clone(M,E){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const x={...this._customWrappers};let k=null;const a=this._engine;if(a.createEffectForParticles&&null!=this.customShader){k=this.customShader;const M=k.shaderOptions.defines.length>0?k.shaderOptions.defines.join("\n"):"",E=a.createEffectForParticles(k.shaderPath.fragmentElement,k.shaderOptions.uniforms,k.shaderOptions.samplers,M);x[0]?x[0].effect=E:this.setCustomEffect(E,0)}const g=this.serialize(b),n=cM.Parse(g,this._scene||this._engine,this._rootUrl);return n.name=M,n.customShader=k,n._customWrappers=x,void 0===E&&(E=this.k),this.noiseTexture&&(n.noiseTexture=this.noiseTexture.clone()),n.k=E,this.preventAutoStart||n.start(),n}}cM.BILLBOARDMODE_Y=2,cM.BILLBOARDMODE_ALL=7,cM.BILLBOARDMODE_STRETCHED=8,cM.BILLBOARDMODE_STRETCHED_LOCAL=9,nM._ParseParticleSystem=cM.Parse;var CM=b(1197),RM=b(1171),wM=b(1425);wM.e.prototype.createTransformFeedback=function(){const M=this._gl.createTransformFeedback();if(!M)throw new Error("Unable to create Transform Feedback");return M},wM.e.prototype.deleteTransformFeedback=function(M){this._gl.deleteTransformFeedback(M)},wM.e.prototype.bindTransformFeedback=function(M){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,M)},wM.e.prototype.beginTransformFeedback=function(){let M=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(M?this._gl.POINTS:this._gl.TRIANGLES)},wM.e.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},wM.e.prototype.setTranformFeedbackVaryings=function(M,E){this._gl.transformFeedbackVaryings(M,E,this._gl.INTERLEAVED_ATTRIBS)},wM.e.prototype.bindTransformFeedbackBuffer=function(M){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,M?M.underlyingResource:null)},wM.e.prototype.readTransformFeedbackBuffer=function(M){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,M)};const SM="clipPlaneFragmentDeclaration2",XM="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";N.b.IncludesShadersStore[SM]=XM;b(11040),b(10924),b(10853),b(11045),b(11072),b(11079),b(11100),b(11106);const UM="gpuRenderParticlesPixelShader",vM="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";N.b.ShadersStore[UM]=vM;const NM="clipPlaneVertexDeclaration2",KM="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";N.b.IncludesShadersStore[NM]=KM;b(10896),b(10975),b(10977),b(10999);const hM="gpuRenderParticlesVertexShader",ZM="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";N.b.ShadersStore[hM]=ZM;class OM extends J{static get IsSupported(){if(!L.b.LastCreatedEngine)return!1;const M=L.b.LastCreatedEngine.getCaps();return M.supportTransformFeedbacks||M.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(M){this._maxActiveParticleCount=Math.min(M,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(M){this.maxActiveParticleCount=M}createPointEmitter(M,E){const b=uM(M,E);return this.particleEmitterType=b,b}createHemisphericEmitter(){const M=TM(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=M,M}createSphereEmitter(){const M=VM(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=M,M}createDirectedSphereEmitter(){const M=IM(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new x.m(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new x.m(0,1,0));return this.particleEmitterType=M,M}createCylinderEmitter(){const M=tM(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=M,M}createDirectedCylinderEmitter(){const M=yM(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new x.m(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new x.m(0,1,0));return this.particleEmitterType=M,M}createConeEmitter(){const M=BM(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=M,M}createDirectedConeEmitter(){const M=rM(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new x.m(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new x.m(0,1,0));return this.particleEmitterType=M,M}createBoxEmitter(M,E,b,x){const k=new V;return this.particleEmitterType=k,this.direction1=M,this.direction2=E,this.minEmitBox=b,this.maxEmitBox=x,k}isReady(){if(!this.k||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==cM.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(cM.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(cM.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";M?setTimeout((()=>{this.start(0)}),M):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var M;let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(M=this._customWrappers[E])||void 0===M?void 0:M.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[M]??this._customWrappers[0]}setCustomEffect(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[E]=new MM.d(this._engine),this._customWrappers[E].effect=M}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new e.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(M,E,b){return super._removeGradientAndTexture(M,E,b),this._releaseBuffers(),this}addColorGradient(M,E){this._colorGradients||(this._colorGradients=[]);const b=new Y(M,E);return this._colorGradients.push(b),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(M&&this._colorGradients.sort(((M,E)=>M.gradient<E.gradient?-1:M.gradient>E.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(M){return this._removeGradientAndTexture(M,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const E in this._drawWrappers){var M;null===(M=this._drawWrappers[E].drawContext)||void 0===M||M.reset()}}_addFactorGradient(M,E,b){const x=new G(E,b);M.push(x),this._releaseBuffers()}addSizeGradient(M,E){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,M,E),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(M){return this._removeGradientAndTexture(M,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(M,E){if(!M)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&M.sort(((M,E)=>M.gradient<E.gradient?-1:M.gradient>E.gradient?1:0));const b=this;b[E]&&(b[E].dispose(),b[E]=null)}addAngularSpeedGradient(M,E){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,M,E),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(M){return this._removeGradientAndTexture(M,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(M,E){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,M,E),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(M){return this._removeGradientAndTexture(M,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(M,E){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,M,E),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(M){return this._removeGradientAndTexture(M,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(M,E){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,M,E),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(M){return this._removeGradientAndTexture(M,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(M){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(M,E,b){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(M),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.Rd=new e.b,this.onStoppedObservable=new e.b,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._onBeforeDrawParticlesObservable=null,b&&"Scene"!==b.getClassName()?(this._engine=b,this.defaultProjectionMatrix=x.d.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=b||L.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.ae.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,n.e)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,n.e)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,n.e)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,n.e)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new MM.d(this._engine)},this._customWrappers[0].effect=k,this._drawWrappers={0:new MM.d(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(E=E??{}).randomTextureSize||delete E.randomTextureSize;const g={Dd:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...E},J=E;isFinite(J)&&(g.Dd=J),this._capacity=g.Dd,this._maxActiveParticleCount=g.Dd,this._currentActiveCount=0,this._isAnimationSheetEnabled=a,this.particleEmitterType=new V;const u=Math.min(this._engine.getCaps().maxTextureSize,g.randomTextureSize);let T=[];for(let x=0;x<u;++x)T.push(Math.random()),T.push(Math.random()),T.push(Math.random()),T.push(Math.random());this._randomTexture=new Q.c(new Float32Array(T),u,1,5,b,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,T=[];for(let x=0;x<u;++x)T.push(Math.random()),T.push(Math.random()),T.push(Math.random()),T.push(Math.random());this._randomTexture2=new Q.c(new Float32Array(T),u,1,5,b,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=u}_reset(){this._releaseBuffers()}_createVertexBuffers(M,E,b){const x={};x.position=E.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let k=3;x.age=E.createVertexBuffer("age",k,1,this._attributesStrideSize,!0),k+=1,x.size=E.createVertexBuffer("size",k,3,this._attributesStrideSize,!0),k+=3,x.life=E.createVertexBuffer("life",k,1,this._attributesStrideSize,!0),k+=1,k+=4,this.billboardMode===cM.BILLBOARDMODE_STRETCHED&&(x.direction=E.createVertexBuffer("direction",k,3,this._attributesStrideSize,!0)),k+=3,this._platform.alignDataInBuffer&&(k+=1),this.particleEmitterType instanceof w&&(k+=3,this._platform.alignDataInBuffer&&(k+=1)),this._colorGradientsTexture||(x.color=E.createVertexBuffer("color",k,4,this._attributesStrideSize,!0),k+=4),this._isBillboardBased||(x.initialDirection=E.createVertexBuffer("initialDirection",k,3,this._attributesStrideSize,!0),k+=3,this._platform.alignDataInBuffer&&(k+=1)),this.noiseTexture&&(x.noiseCoordinates1=E.createVertexBuffer("noiseCoordinates1",k,3,this._attributesStrideSize,!0),k+=3,this._platform.alignDataInBuffer&&(k+=1),x.noiseCoordinates2=E.createVertexBuffer("noiseCoordinates2",k,3,this._attributesStrideSize,!0),k+=3,this._platform.alignDataInBuffer&&(k+=1)),x.angle=E.createVertexBuffer("angle",k,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?k++:k+=2,this._isAnimationSheetEnabled&&(x.cellIndex=E.createVertexBuffer("cellIndex",k,1,this._attributesStrideSize,!0),k+=1,this.spriteRandomStartCell&&(x.cellStartOffset=E.createVertexBuffer("cellStartOffset",k,1,this._attributesStrideSize,!0),k+=1)),x.offset=b.createVertexBuffer("offset",0,2),x.uv=b.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(x),this._platform.createVertexBuffers(M,x),this.resetDrawCache()}_initialize(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!M)return;const E=this._engine,b=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof w&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const k=this.particleEmitterType instanceof w,a=x.i.Fd[0];let g=0;for(let x=0;x<this._capacity;x++)if(b.push(0),b.push(0),b.push(0),b.push(0),b.push(0),b.push(0),b.push(0),b.push(0),b.push(Math.random()),b.push(Math.random()),b.push(Math.random()),b.push(Math.random()),k?(this.particleEmitterType.particleDestinationGenerator(x,null,a),b.push(a.x),b.push(a.y),b.push(a.z)):(b.push(0),b.push(0),b.push(0)),this._platform.alignDataInBuffer&&b.push(0),g+=16,k&&(this.particleEmitterType.particlePositionGenerator(x,null,a),b.push(a.x),b.push(a.y),b.push(a.z),this._platform.alignDataInBuffer&&b.push(0),g+=4),this._colorGradientsTexture||(b.push(0),b.push(0),b.push(0),b.push(0),g+=4),this.isBillboardBased||(b.push(0),b.push(0),b.push(0),this._platform.alignDataInBuffer&&b.push(0),g+=4),this.noiseTexture&&(b.push(Math.random()),b.push(Math.random()),b.push(Math.random()),this._platform.alignDataInBuffer&&b.push(0),b.push(Math.random()),b.push(Math.random()),b.push(Math.random()),this._platform.alignDataInBuffer&&b.push(0),g+=8),b.push(0),g+=1,this._angularSpeedGradientsTexture||(b.push(0),g+=1),this._isAnimationSheetEnabled&&(b.push(0),g+=1,this.spriteRandomStartCell&&(b.push(0),g+=1)),this._platform.alignDataInBuffer){let M=3-(g+3&3);for(g+=M;M-- >0;)b.push(0)}const n=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),J=this._platform.createParticleBuffer(b),u=this._platform.createParticleBuffer(b);this._buffer0=new S.d(E,J,!1,this._attributesStrideSize),this._buffer1=new S.d(E,u,!1,this._attributesStrideSize),this._spriteBuffer=new S.d(E,n,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let M=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(M+="\n#define BILLBOARD"),this._colorGradientsTexture&&(M+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(M+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(M+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(M+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(M+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(M+="\n#define DRAGGRADIENTS"),this.isAnimationSheetEnabled&&(M+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(M+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(M+="\n#define NOISE"),this.isLocal&&(M+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===M||(this._cachedUpdateDefines=M,this._updateBuffer=this._platform.createUpdateBuffer(M)),this._platform.isUpdateBufferReady()}_getWrapper(M){const E=this._getCustomDrawWrapper(M);if(null!==E&&void 0!==E&&E.effect)return E;const b=[];this.fillDefines(b,M);let x=this._drawWrappers[M];x||(x=new MM.d(this._engine),x.drawContext&&(x.drawContext.useInstancing=!0),this._drawWrappers[M]=x);const k=b.join("\n");if(x.defines!==k){const M=[],E=[],b=[];this.fillUniformsAttributesAndSamplerNames(E,M,b),x.setEffect(this._engine.createEffect("gpuRenderParticles",M,E,b,k),k)}return x}static _GetAttributeNamesOrOptions(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0],E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],x=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const k=[S.g.PositionKind,"age","life","size","angle"];return M||k.push(S.g.ColorKind),E&&k.push("cellIndex"),b||k.push("initialDirection"),x&&k.push("direction"),k.push("offset",S.g.UVKind),k}static _GetEffectCreationOptions(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0],E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const x=["emitterWM","mg","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,EM.b)(x),M&&x.push("sheetInfos"),E&&x.push("logarithmicDepthConstant"),b&&(x.push("vFogInfos"),x.push("vFogColor")),x}fillDefines(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,EM.k)(this,this._scene,M),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==RM.d.FOGMODE_NONE&&M.push("#define FOG")),E===cM.BLENDMODE_MULTIPLY&&M.push("#define BLENDMULTIPLYMODE"),this.isLocal&&M.push("#define LOCAL"),this.useLogarithmicDepth&&M.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(M.push("#define BILLBOARD"),this.billboardMode){case cM.BILLBOARDMODE_Y:M.push("#define BILLBOARDY");break;case cM.BILLBOARDMODE_STRETCHED:M.push("#define BILLBOARDSTRETCHED");break;case cM.BILLBOARDMODE_ALL:M.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&M.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&M.push("#define ANIMATESHEET"),b&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),M.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(M,E,b){E.push(...OM._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===cM.BILLBOARDMODE_STRETCHED)),M.push(...OM._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),b.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(CM.b.PrepareUniforms(M,this._imageProcessingConfigurationDefines),CM.b.PrepareSamplers(b,this._imageProcessingConfigurationDefines))}animate(){var M;let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(E?this.preWarmStepOffset:(null===(M=this._scene)||void 0===M?void 0:M.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(M,E){const b=this[E];if(!M||!M.length||b)return;const x=new Float32Array(this._rawTextureWidth);for(let k=0;k<this._rawTextureWidth;k++){const E=k/this._rawTextureWidth;H.GetCurrentGradient(E,M,((M,E,b)=>{x[k]=(0,u.m)(M.factor1,E.factor1,b)}))}this[E]=Q.c.CreateRTexture(x,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[E].name=E.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const M=new Uint8Array(4*this._rawTextureWidth),E=g.i.ue[0];for(let b=0;b<this._rawTextureWidth;b++){const x=b/this._rawTextureWidth;H.GetCurrentGradient(x,this._colorGradients,((x,k,a)=>{g.h.LerpToRef(x.color1,k.color1,a,E),M[4*b]=255*E.r,M[4*b+1]=255*E.g,M[4*b+2]=255*E.b,M[4*b+3]=255*E.a}))}this._colorGradientsTexture=Q.c.CreateRGBATexture(M,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(M,E){var b,k,a,g;const n=this._getWrapper(M),J=n.effect;this._engine.enableEffect(n);const u=(null===(b=this._scene)||void 0===b?void 0:b.getViewMatrix())||x.d.IdentityReadOnly;if(J.setMatrix("view",u),J.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),J.setTexture("diffuseSampler",this.particleTexture),J.setVector2("translationPivot",this.translationPivot),J.setVector3("mg",this.mg),this.isLocal&&J.setMatrix("emitterWM",E),this._colorGradientsTexture?J.setTexture("colorGradientSampler",this._colorGradientsTexture):J.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const M=this.particleTexture.getBaseSize();J.setFloat3("sheetInfos",this.spriteCellWidth/M.width,this.spriteCellHeight/M.height,M.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const M=this._scene.activeCamera;J.setVector3("eyePosition",M.globalPosition)}const T=J.defines;if(this._scene&&((0,EM.e)(J,this,this._scene),this.applyFog&&(0,bM.e)(this._scene,void 0,J)),T.indexOf("#define BILLBOARDMODE_ALL")>=0){const M=u.clone();M.invert(),J.setMatrix("invView",M)}switch(this.useLogarithmicDepth&&this._scene&&(0,bM.k)(T,J,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(J),M){case cM.BLENDMODE_ADD:this._engine.setAlphaMode(1);break;case cM.BLENDMODE_ONEONE:this._engine.setAlphaMode(6);break;case cM.BLENDMODE_STANDARD:this._engine.setAlphaMode(2);break;case cM.BLENDMODE_MULTIPLY:this._engine.setAlphaMode(4)}return this._platform.bindDrawBuffers(this._targetIndex,J,null!==(k=this._scene)&&void 0!==k&&k.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(J),null!==(a=this._scene)&&void 0!==a&&a.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(g=this._scene)&&void 0!==g&&g.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(M){if(!this.k||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!M)if(this.k.position){M=this.k.getWorldMatrix()}else{const E=this.k;M=x.i.Matrix[0],x.d.TranslationToRef(E.x,E.y,E.z,M)}this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this.isLocal||this._updateBuffer.setMatrix("emitterWM",M),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const E=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=E}render(){let M,E=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!E&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let M=0;M<this.preWarmCycles;M++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>1){const M=0|this._accumulatedCount;this._accumulatedCount-=M,this._currentActiveCount+=M}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.k.position){M=this.k.getWorldMatrix()}else{const E=this.k;M=x.i.Matrix[0],x.d.TranslationToRef(E.x,E.y,E.z,M)}const k=this._engine;this.updateInAnimate||this._update(M);let a=0;return E||b||(k.setState(!1),this.forceDepthWrite&&k.setDepthWrite(!0),a=this.blendMode===cM.BLENDMODE_MULTIPLYADD?this._render(cM.BLENDMODE_MULTIPLY,M)+this._render(cM.BLENDMODE_ADD,M):this._render(this.blendMode,M),this._engine.setAlphaMode(0)),a}rebuild(){const M=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(M,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,M()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let M=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const E in this._drawWrappers){this._drawWrappers[E].dispose()}if(this._drawWrappers={},this._scene){const M=this._scene.ae.indexOf(this);M>-1&&this._scene.ae.splice(M,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let E=0;E<this._renderVertexBuffers.length;++E){const M=this._renderVertexBuffers[E];for(const E in M)M[E].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),M&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),M&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.Rd.notifyObservers(this),this.Rd.clear()}clone(M,E){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const x={...this._customWrappers};let k=null;const a=this._engine;if(a.createEffectForParticles&&null!=this.customShader){k=this.customShader;const M=k.shaderOptions.defines.length>0?k.shaderOptions.defines.join("\n"):"";x[0]=a.createEffectForParticles(k.shaderPath.fragmentElement,k.shaderOptions.uniforms,k.shaderOptions.samplers,M,void 0,void 0,void 0,this)}const g=this.serialize(b),n=OM.Parse(g,this._scene||this._engine,this._rootUrl);return n.name=M,n.customShader=k,n._customWrappers=x,void 0===E&&(E=this.k),this.noiseTexture&&(n.noiseTexture=this.noiseTexture.clone()),n.k=E,n}serialize(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const E={};return cM._Serialize(E,this,M),E.activeParticleCount=this.activeParticleCount,E.randomTextureSize=this._randomTextureSize,E.customShader=this.customShader,E}static Parse(M,E,b){let x=arguments.length>3&&void 0!==arguments[3]&&arguments[3],k=arguments.length>4?arguments[4]:void 0;const a=M.name;let g,n;E instanceof JM.c?g=E:(n=E,g=n.getEngine());const J=new OM(a,{Dd:k||M.Dd,randomTextureSize:M.randomTextureSize},E,null,M.isAnimationSheetEnabled);if(J._rootUrl=b,M.customShader&&g.createEffectForParticles){const E=M.customShader,b=E.shaderOptions.defines.length>0?E.shaderOptions.defines.join("\n"):"",x=g.createEffectForParticles(E.shaderPath.fragmentElement,E.shaderOptions.uniforms,E.shaderOptions.samplers,b,void 0,void 0,void 0,J);J.setCustomEffect(x,0),J.customShader=E}return M.id&&(J.id=M.id),M.activeParticleCount&&(J.activeParticleCount=M.activeParticleCount),cM._Parse(M,J,E,b),M.preventAutoStart&&(J.preventAutoStart=M.preventAutoStart),x||J.preventAutoStart||J.start(),J}}var pM=b(1176),PM=b(11709),FM=b(1161);class lM{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(M){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const E of this.systems)E.k=M;this._emitterNode=M}setEmitterAsSphere(M,E,b){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:M,renderingGroupId:E};const x=(0,PM.e)("emitterSphere",{diameter:M.diameter,segments:M.segments},b);x.renderingGroupId=E;const k=new FM.b("emitterSphereMaterial",b);k.emissiveColor=M.color,x.material=k;for(const a of this.systems)a.k=x;this._emitterNode=x}start(M){for(const E of this.systems)M&&(E.k=M),E.start()}dispose(){for(const M of this.systems)M.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const E={systems:[]};for(const b of this.systems)E.systems.push(b.serialize(M));return this._emitterNode&&(E.k=this._emitterCreationOptions),E}static Parse(M,E){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],x=arguments.length>3?arguments[3]:void 0;const k=new lM,a=this.BaseAssetsUrl+"/textures/";E=E||L.b.LastCreatedScene;for(const g of M.systems)k.systems.push(b?OM.Parse(g,E,a,!0,x):cM.Parse(g,E,a,!0,x));if(M.k){const b=M.k.options;if("Sphere"===M.k.kind)k.setEmitterAsSphere({diameter:b.diameter,segments:b.segments,color:g.e.Id(b.color)},M.k.renderingGroupId,E)}return k}}lM.BaseAssetsUrl="https://assets.babylonjs.com/particles";var dM=b(1026);class WM{static CreateDefault(M){let E,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,x=arguments.length>2?arguments[2]:void 0;return E=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new OM("default system",{Dd:b},x):new cM("default system",b,x),E.k=M,E.particleTexture=new d.e("https://assets.babylonjs.com/textures/flare.png",E.va()),E.createConeEmitter(.1,Math.PI/4),E.color1=new g.h(1,1,1,1),E.color2=new g.h(1,1,1,1),E.colorDead=new g.h(1,1,1,0),E.minSize=.1,E.maxSize=.1,E.minEmitPower=2,E.maxEmitPower=2,E.updateSpeed=1/60,E.emitRate=30,E}static CreateAsync(M,E){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],x=arguments.length>3?arguments[3]:void 0;E||(E=L.b.LastCreatedScene);const k={};return E.addPendingData(k),new Promise(((a,g)=>{if(b&&!OM.IsSupported)return E.removePendingData(k),g("Particle system with GPU is not supported.");pM.e.LoadFile(`${WM.BaseAssetsUrl}/systems/${M}.json`,(M=>{E.removePendingData(k);const g=JSON.parse(M.toString());return a(lM.Parse(g,E,b,x))}),void 0,void 0,void 0,(()=>(E.removePendingData(k),g(`An error occurred with the creation of your particle system. Check if your type '${M}' exists.`))))}))}static ExportSet(M){const E=new lM;for(const b of M)E.systems.push(b);return E}static ParseFromFileAsync(M,E,b){let x=arguments.length>3&&void 0!==arguments[3]&&arguments[3],k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",a=arguments.length>5?arguments[5]:void 0;return new Promise(((g,n)=>{const J=new dM.d;J.addEventListener("readystatechange",(()=>{if(4==J.readyState)if(200==J.status){const E=JSON.parse(J.responseText);let n;n=x?OM.Parse(E,b,k,!1,a):cM.Parse(E,b,k,!1,a),M&&(n.name=M),g(n)}else n("Unable to load the particle system")})),J.open("GET",E),J.send()}))}static ParseFromSnippetAsync(M,E){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",k=arguments.length>4?arguments[4]:void 0;if("_BLANK"===M){const M=this.CreateDefault(null);return M.start(),Promise.resolve(M)}return new Promise(((a,g)=>{const n=new dM.d;n.addEventListener("readystatechange",(()=>{if(4==n.readyState)if(200==n.status){const g=JSON.parse(JSON.parse(n.responseText).jsonPayload),J=JSON.parse(g.particleSystem);let u;u=b?OM.Parse(J,E,x,!1,k):cM.Parse(J,E,x,!1,k),u.snippetId=M,a(u)}else g("Unable to load the snippet "+M)})),n.open("GET",this.SnippetUrl+"/"+M.replace(/#/g,"/")),n.send()}))}}WM.BaseAssetsUrl=lM.BaseAssetsUrl,WM.SnippetUrl="https://snippet.babylonjs.com",WM.CreateFromSnippetAsync=WM.ParseFromSnippetAsync;var mM=b(11537),oM=b(1260),jM=b(11712);(0,jM.e)(oM.c.NAME_PARTICLESYSTEM,((M,E,b,x)=>{const k=(0,jM.g)(oM.c.NAME_PARTICLESYSTEM);if(k&&void 0!==M.ae&&null!==M.ae)for(let a=0,g=M.ae.length;a<g;a++){const g=M.ae[a];b.ae.push(k(g,E,x))}})),(0,jM.b)(oM.c.NAME_PARTICLESYSTEM,((M,E,b)=>{if(M.activeParticleCount){return OM.Parse(M,E,b)}return cM.Parse(M,E,b)})),JM.c.prototype.createEffectForParticles=function(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",a=arguments.length>4?arguments[4]:void 0,g=arguments.length>5?arguments[5]:void 0,n=arguments.length>6?arguments[6]:void 0,J=arguments.length>7?arguments[7]:void 0,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,T=[],V=[];const I=[];return J?J.fillUniformsAttributesAndSamplerNames(V,T,I):(T=cM._GetAttributeNamesOrOptions(),V=cM._GetEffectCreationOptions()),-1===k.indexOf(" BILLBOARD")&&(k+="\n#define BILLBOARD\n"),null!==J&&void 0!==J&&J.isAnimationSheetEnabled&&-1===k.indexOf(" ANIMATESHEET")&&(k+="\n#define ANIMATESHEET\n"),-1===x.indexOf("diffuseSampler")&&x.push("diffuseSampler"),this.createEffect({vertex:(null===J||void 0===J?void 0:J.vertexShaderName)??"particles",fragmentElement:M},T,V.concat(E),I.concat(x),k,a,g,n,void 0,u,(async()=>{0===u?await Promise.resolve().then(b.bind(b,11741)):await Promise.resolve().then(b.bind(b,11755))}))},mM.e.prototype.getEmittedParticleSystems=function(){const M=[];for(let E=0;E<this.va().ae.length;E++){const b=this.va().ae[E];b.k===this&&M.push(b)}return M},mM.e.prototype.getHierarchyEmittedParticleSystems=function(){const M=[],E=this.getDescendants();E.push(this);for(let b=0;b<this.va().ae.length;b++){const x=this.va().ae[b],k=x.k;k.position&&-1!==E.indexOf(k)&&M.push(x)}return M};b(1343),b(1355),b(11569);b(11557),b(11719),b(1512),b(1328),b(11580);b(1505);var sM;b(11726),b(1015);!function(M){M[M.Color=2]="Color",M[M.UV=1]="UV",M[M.Random=0]="Random",M[M.Stated=3]="Stated"}(sM||(sM={}));b(11733),b(11741),b(11748),b(11755)},10788:(M,E,b)=>{"use strict";const x="clipPlaneFragment",k="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";b(1082).b.IncludesShadersStoreWGSL[x]=k},10774:(M,E,b)=>{"use strict";const x="clipPlaneFragmentDeclaration",k="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";b(1082).b.IncludesShadersStoreWGSL[x]=k},10691:(M,E,b)=>{"use strict";const x="clipPlaneVertex",k="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";b(1082).b.IncludesShadersStoreWGSL[x]=k},10603:(M,E,b)=>{"use strict";const x="clipPlaneVertexDeclaration",k="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";b(1082).b.IncludesShadersStoreWGSL[x]=k},10812:(M,E,b)=>{"use strict";const x="fogFragment",k="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";b(1082).b.IncludesShadersStoreWGSL[x]=k},10782:(M,E,b)=>{"use strict";const x="fogFragmentDeclaration",k="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";b(1082).b.IncludesShadersStoreWGSL[x]=k},10693:(M,E,b)=>{"use strict";const x="fogVertex",k="#ifdef FOG\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#endif\n";b(1082).b.IncludesShadersStoreWGSL[x]=k},10610:(M,E,b)=>{"use strict";const x="fogVertexDeclaration",k="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";b(1082).b.IncludesShadersStoreWGSL[x]=k},10564:(M,E,b)=>{"use strict";const x="helperFunctions",k="const PI: f32=3.1415926535897932384626433832795;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3<f32>=vec3<f32> (0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(0.0),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);} \nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3<f32>=inMatrix[0];let i1: vec3<f32>=inMatrix[1];let i2: vec3<f32>=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3<f32>)->vec3<f32>\n{let nearZeroSection: vec3<f32>=0.0773993808*color;let remainingSection: vec3<f32>=pow(0.947867299*(color+vec3<f32>(0.055)),vec3<f32>(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3<f32>(0.04045)));}\nfn toGammaSpaceExact(color: vec3<f32>)->vec3<f32>\n{let nearZeroSection: vec3<f32>=12.92*color;let remainingSection: vec3<f32>=1.055*pow(color,vec3<f32>(0.41666))-vec3<f32>(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3<f32>(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3<f32>)->vec3<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3<f32>(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3<f32>(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3<f32>)->vec3<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3<f32>(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3<f32>)->vec3<f32>\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3<f32>)->f32\n{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3<f32>)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3<f32> =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(clamp(rgb,vec3<f32>(0.,0.,0.),vec3<f32>(1.,1.,1.)),D); }\nfn fromRGBD(rgbd: vec4<f32>)->vec3<f32> {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3<f32>,origVec: vec3<f32>,cubeSize: vec3<f32>,cubePos: vec3<f32>)->vec3<f32> {let invOrigVec: vec3<f32>=vec3<f32>(1.0,1.0,1.0)/origVec;let halfSize: vec3<f32>=cubeSize*0.5;let intersecAtMaxPlane: vec3<f32>=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3<f32>=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3<f32>=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3<f32>=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\n";b(1082).b.IncludesShadersStoreWGSL[x]=k},10755:(M,E,b)=>{"use strict";const x="imageProcessingDeclaration",k="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";b(1082).b.IncludesShadersStoreWGSL[x]=k},10760:(M,E,b)=>{"use strict";const x="imageProcessingFunctions",k="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";b(1082).b.IncludesShadersStoreWGSL[x]=k},10630:(M,E,b)=>{"use strict";const x="logDepthDeclaration",k="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";b(1082).b.IncludesShadersStoreWGSL[x]=k},10808:(M,E,b)=>{"use strict";const x="logDepthFragment",k="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";b(1082).b.IncludesShadersStoreWGSL[x]=k},10707:(M,E,b)=>{"use strict";const x="logDepthVertex",k="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";b(1082).b.IncludesShadersStoreWGSL[x]=k},11748:(M,E,b)=>{"use strict";b.r(E),b.d(E,{particlesPixelShaderWGSL:()=>g});var x=b(1082);b(10774),b(10755),b(10630),b(10564),b(10760),b(10782),b(10788),b(10808),b(10812);const k="particlesPixelShader",a="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";x.b.ShadersStoreWGSL[k]=a;const g={name:k,shader:a}},11755:(M,E,b)=>{"use strict";b.r(E),b.d(E,{particlesVertexShaderWGSL:()=>g});var x=b(1082);b(10603),b(10610),b(10630),b(10691),b(10693),b(10707);const k="particlesVertexShader",a="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return input.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";x.b.ShadersStoreWGSL[k]=a;const g={name:k,shader:a}},11079:(M,E,b)=>{"use strict";const x="clipPlaneFragment",k="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";b(1082).b.IncludesShadersStore[x]=k},11063:(M,E,b)=>{"use strict";const x="clipPlaneFragmentDeclaration",k="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";b(1082).b.IncludesShadersStore[x]=k},10975:(M,E,b)=>{"use strict";const x="clipPlaneVertex",k="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";b(1082).b.IncludesShadersStore[x]=k},10893:(M,E,b)=>{"use strict";const x="clipPlaneVertexDeclaration",k="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";b(1082).b.IncludesShadersStore[x]=k},11106:(M,E,b)=>{"use strict";const x="fogFragment",k="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";b(1082).b.IncludesShadersStore[x]=k},11072:(M,E,b)=>{"use strict";const x="fogFragmentDeclaration",k="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";b(1082).b.IncludesShadersStore[x]=k},10977:(M,E,b)=>{"use strict";const x="fogVertex",k="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";b(1082).b.IncludesShadersStore[x]=k},10896:(M,E,b)=>{"use strict";const x="fogVertexDeclaration",k="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";b(1082).b.IncludesShadersStore[x]=k},10853:(M,E,b)=>{"use strict";const x="helperFunctions",k="const float PI=3.1415926535897932384626433832795;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.0;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(clamp(rgb,0.,1.),D); }\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.0,1.0,1.0)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\n";b(1082).b.IncludesShadersStore[x]=k},11040:(M,E,b)=>{"use strict";const x="imageProcessingDeclaration",k="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";b(1082).b.IncludesShadersStore[x]=k},11045:(M,E,b)=>{"use strict";const x="imageProcessingFunctions",k="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";b(1082).b.IncludesShadersStore[x]=k},10924:(M,E,b)=>{"use strict";const x="logDepthDeclaration",k="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";b(1082).b.IncludesShadersStore[x]=k},11100:(M,E,b)=>{"use strict";const x="logDepthFragment",k="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";b(1082).b.IncludesShadersStore[x]=k},10999:(M,E,b)=>{"use strict";const x="logDepthVertex",k="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";b(1082).b.IncludesShadersStore[x]=k},11733:(M,E,b)=>{"use strict";b.r(E),b.d(E,{particlesPixelShader:()=>g});var x=b(1082);b(11063),b(11040),b(10924),b(10853),b(11045),b(11072),b(11079),b(11100),b(11106);const k="particlesPixelShader",a="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";x.b.ShadersStore[k]=a;const g={name:k,shader:a}},11741:(M,E,b)=>{"use strict";b.r(E),b.d(E,{particlesVertexShader:()=>g});var x=b(1082);b(10893),b(10896),b(10924),b(10975),b(10977),b(10999);const k="particlesVertexShader",a="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";x.b.ShadersStore[k]=a;const g={name:k,shader:a}},11554:(M,E,b)=>{"use strict";b.d(E,{d:()=>V});var x=b(948),k=b(970),a=b(953),g=b(962),n=b(1005),J=b(1056),u=b(1124);class T{constructor(){this._doNotSerialize=!1,this._isDisposed=!1,this._sceneRootNodesIndex=-1,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._onEnabledStateChangedObservable=new g.b,this._onClonedObservable=new g.b}}class V{static AddNodeConstructor(M,E){this._NodeConstructors[M]=E}static Construct(M,E,b,x){const k=this._NodeConstructors[M];return k?k(E,b,x):null}set accessibilityTag(M){this._accessibilityTag=M,this.onAccessibilityTagChangedObservable.notifyObservers(M)}get accessibilityTag(){return this._accessibilityTag}get doNotSerialize(){return!!this._nodeDataStorage._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize}set doNotSerialize(M){this._nodeDataStorage._doNotSerialize=M}u(){return this._nodeDataStorage._isDisposed}set parent(M){if(this._parentNode===M)return;const E=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){const E=this._parentNode._children.indexOf(this);-1!==E&&this._parentNode._children.splice(E,1),M||this._nodeDataStorage._isDisposed||this._addToSceneRootNodes()}this._parentNode=M,this._isDirty=!0,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),E||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}get parent(){return this._parentNode}_serializeAsParent(M){M.parentId=this.uniqueId}_addToSceneRootNodes(){-1===this._nodeDataStorage._sceneRootNodesIndex&&(this._nodeDataStorage._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))}_removeFromSceneRootNodes(){if(-1!==this._nodeDataStorage._sceneRootNodesIndex){const M=this._scene.rootNodes,E=M.length-1;M[this._nodeDataStorage._sceneRootNodesIndex]=M[E],M[this._nodeDataStorage._sceneRootNodesIndex]._nodeDataStorage._sceneRootNodesIndex=this._nodeDataStorage._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._nodeDataStorage._sceneRootNodesIndex=-1}}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(M){this._animationPropertiesOverride=M}getClassName(){return"Node"}set onDispose(M){this._onDisposeObserver&&this.Rd.remove(this._onDisposeObserver),this._onDisposeObserver=this.Rd.add(M)}get onEnabledStateChangedObservable(){return this._nodeDataStorage._onEnabledStateChangedObservable}get onClonedObservable(){return this._nodeDataStorage._onClonedObservable}constructor(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._isDirty=!1,this._nodeDataStorage=new T,this.state="",this.metadata=null,this.reservedDataStore=null,this._accessibilityTag=null,this.onAccessibilityTagChangedObservable=new g.b,this._parentContainer=null,this.animations=[],this._ranges={},this.onReady=null,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._waitingParentInstanceIndex=null,this._waitingParsedUniqueId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=k.d.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._animationPropertiesOverride=null,this._isNode=!0,this.Rd=new g.b,this._onDisposeObserver=null,this._behaviors=new Array,this.name=M,this.id=M,this._scene=E||n.b.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache(),b&&this._addToSceneRootNodes()}va(){return this._scene}getEngine(){return this._scene.getEngine()}addBehavior(M){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return-1!==this._behaviors.indexOf(M)||(M.init(),this._scene.isLoading&&!E?this._scene.onDataLoadedObservable.addOnce((()=>{M.attach(this)})):M.attach(this),this._behaviors.push(M)),this}removeBehavior(M){const E=this._behaviors.indexOf(M);return-1===E||(this._behaviors[E].detach(),this._behaviors.splice(E,1)),this}get behaviors(){return this._behaviors}getBehaviorByName(M){for(const E of this._behaviors)if(E.name===M)return E;return null}getWorldMatrix(){return this._currentRenderId!==this._scene.getRenderId()&&this.ce(),this._worldMatrix}_getWorldMatrixDeterminant(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant}get worldMatrixFromCache(){return this._worldMatrix}_initCache(){this._cache={}}updateCache(M){!M&&this.isSynchronized()||this._updateCache()}_getActionManagerForTrigger(M){return this.parent?this.parent._getActionManagerForTrigger(M,!1):null}_updateCache(M){}_isSynchronized(){return!0}_markSyncedWithParent(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)}isSynchronizedWithParent(){return!this._parentNode||!this._parentNode._isDirty&&this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()}isSynchronized(){return!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()}isReady(){return this._nodeDataStorage._isReady}ge(M){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}isEnabled(){return!1===(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])?this._nodeDataStorage._isEnabled:!!this._nodeDataStorage._isEnabled&&this._nodeDataStorage._isParentEnabled}_syncParentEnabledState(){this._nodeDataStorage._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children&&this._children.forEach((M=>{M._syncParentEnabledState()}))}wg(M){this._nodeDataStorage._isEnabled!==M&&(this._nodeDataStorage._isEnabled=M,this._syncParentEnabledState(),this._nodeDataStorage._onEnabledStateChangedObservable.notifyObservers(M))}isDescendantOf(M){return!!this.parent&&(this.parent===M||this.parent.isDescendantOf(M))}_getDescendants(M){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2?arguments[2]:void 0;if(this._children)for(let x=0;x<this._children.length;x++){const k=this._children[x];b&&!b(k)||M.push(k),E||k._getDescendants(M,!1,b)}}getDescendants(M,E){const b=[];return this._getDescendants(b,M,E),b}getChildMeshes(M,E){const b=[];return this._getDescendants(b,M,(M=>(!E||E(M))&&void 0!==M.xe)),b}getChildren(M){let E=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.getDescendants(E,M)}_setReady(M){M!==this._nodeDataStorage._isReady&&(M?(this.onReady&&this.onReady(this),this._nodeDataStorage._isReady=!0):this._nodeDataStorage._isReady=!1)}getAnimationByName(M){for(let E=0;E<this.animations.length;E++){const b=this.animations[E];if(b.name===M)return b}return null}createAnimationRange(M,E,b){if(!this._ranges[M]){this._ranges[M]=V._AnimationRangeFactory(M,E,b);for(let x=0,k=this.animations.length;x<k;x++)this.animations[x]&&this.animations[x].createRange(M,E,b)}}deleteAnimationRange(M){let E=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let b=0,x=this.animations.length;b<x;b++)this.animations[b]&&this.animations[b].deleteRange(M,E);this._ranges[M]=null}getAnimationRange(M){return this._ranges[M]||null}clone(M,E,b){const x=u.b.Clone((()=>new V(M,this.va())),this);if(E&&(x.parent=E),!b){const E=this.getDescendants(!0);for(let b=0;b<E.length;b++){const k=E[b];k.clone(M+"."+k.name,x)}}return x}getAnimationRanges(){const M=[];let E;for(E in this._ranges)M.push(this._ranges[E]);return M}beginAnimation(M,E,b,x){const k=this.getAnimationRange(M);return k?this._scene.beginAnimation(this,k.from,k.to,E,b,x):null}serializeAnimationRanges(){const M=[];for(const E in this._ranges){const b=this._ranges[E];if(!b)continue;const x={};x.name=E,x.from=b.from,x.to=b.to,M.push(x)}return M}ce(M){return this._worldMatrix||(this._worldMatrix=k.d.Identity()),this._worldMatrix}dispose(M){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._nodeDataStorage._isDisposed=!0,!M){const b=this.getDescendants(!0);for(const x of b)x.dispose(M,E)}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.Rd.notifyObservers(this),this.Rd.clear(),this.onEnabledStateChangedObservable.clear(),this.onClonedObservable.clear();for(const b of this._behaviors)b.detach();this._behaviors.length=0,this.metadata=null}static ParseAnimationRanges(M,E,b){if(E.ranges)for(let x=0;x<E.ranges.length;x++){const b=E.ranges[x];M.createAnimationRange(b.name,b.from,b.to)}}getHierarchyBoundingVectors(){let M,E,b=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.va().incrementRenderId(),this.ce(!0);const a=this;if(a.getBoundingInfo&&a.Td){const b=a.getBoundingInfo();M=b.boundingBox.minimumWorld.clone(),E=b.boundingBox.maximumWorld.clone()}else M=new k.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),E=new k.m(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(b){const b=this.getDescendants(!1);for(const a of b){const b=a;if(b.ce(!0),x&&!x(b))continue;if(!b.getBoundingInfo||0===b.getTotalVertices())continue;const g=b.getBoundingInfo().boundingBox,n=g.minimumWorld,J=g.maximumWorld;k.m.CheckExtends(n,M,E),k.m.CheckExtends(J,M,E)}}return{min:M,max:E}}}V._AnimationRangeFactory=(M,E,b)=>{throw(0,J.b)("AnimationRange")},V._NodeConstructors={},(0,x.d)([(0,a.E)()],V.prototype,"name",void 0),(0,x.d)([(0,a.E)()],V.prototype,"id",void 0),(0,x.d)([(0,a.E)()],V.prototype,"uniqueId",void 0),(0,x.d)([(0,a.E)()],V.prototype,"state",void 0),(0,x.d)([(0,a.E)()],V.prototype,"metadata",void 0)},12095:(M,E,b)=>{"use strict";class x{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((M,E)=>{this._resolve=M,this._reject=E}))}}var k=b(970),a=b(1133),g=b(1176),n=b(11548),J=b(12098),u=b(12114),T=b(962),V=b(11701),I=b(12117),t=b(12119),y=b(1005),B=b(1060),r=b(1182);class c{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(M){this._useTextureToStoreBoneMatrices=M,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(M){this._animationPropertiesOverride=M}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(M,E,b){this.name=M,this.id=E,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=k.d.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new T.b,this.bones=[],this._scene=b||y.b.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const x=this._scene.getEngine().getCaps();this._canUseTextureForBones=x.textureFloat&&x.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((M=>!M.getParent()))}getTransformMatrices(M){if(this.needInitialSkinMatrix){if(!M)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return M._bonesTransformMatrices||this.prepare(!0),M._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(M){return this.needInitialSkinMatrix&&M._transformMatrixTexture?M._transformMatrixTexture:this._transformMatrixTexture}va(){return this._scene}toString(M){let E=`Name: ${this.name}, nBones: ${this.bones.length}`;if(E+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,M){E+=", Ranges: {";let M=!0;for(const b in this._ranges)M&&(E+=", ",M=!1),E+=b;E+="}"}return E}getBoneIndexByName(M){for(let E=0,b=this.bones.length;E<b;E++)if(this.bones[E].name===M)return E;return-1}createAnimationRange(M,E,b){if(!this._ranges[M]){this._ranges[M]=new t.e(M,E,b);for(let x=0,k=this.bones.length;x<k;x++)this.bones[x].animations[0]&&this.bones[x].animations[0].createRange(M,E,b)}}deleteAnimationRange(M){let E=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let b=0,x=this.bones.length;b<x;b++)this.bones[b].animations[0]&&this.bones[b].animations[0].deleteRange(M,E);this._ranges[M]=null}getAnimationRange(M){return this._ranges[M]||null}getAnimationRanges(){const M=[];let E;for(E in this._ranges)M.push(this._ranges[E]);return M}copyAnimationRange(M,E){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[E]||!M.getAnimationRange(E))return!1;let x=!0;const k=this._getHighestAnimationFrame()+1,a={},g=M.bones;let n,J;for(J=0,n=g.length;J<n;J++)a[g[J].name]=g[J];this.bones.length!==g.length&&(B.d.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${g.length}`),x=!1);const u=b&&this.dimensionsAtRest&&M.dimensionsAtRest?this.dimensionsAtRest.divide(M.dimensionsAtRest):null;for(J=0,n=this.bones.length;J<n;J++){const M=this.bones[J].name,g=a[M];g?x=x&&this.bones[J].copyAnimationRange(g,E,k,b,u):(B.d.Warn("copyAnimationRange: not same rig, missing source bone "+M),x=!1)}const T=M.getAnimationRange(E);return T&&(this._ranges[E]=new t.e(E,T.from+k,T.to+k)),x}returnToRest(){for(const M of this.bones)-1!==M._index&&M.returnToRest()}_getHighestAnimationFrame(){let M=0;for(let E=0,b=this.bones.length;E<b;E++)if(this.bones[E].animations[0]){const b=this.bones[E].animations[0].getHighestFrame();M<b&&(M=b)}return M}beginAnimation(M,E,b,x){const k=this.getAnimationRange(M);return k?this._scene.beginAnimation(this,k.from,k.to,E,b,x):null}static MakeAnimationAdditive(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2?arguments[2]:void 0;const x=M.getAnimationRange(b);if(!x)return null;const k=M._scene.getAllAnimatablesByTarget(M);let a=null;for(let n=0;n<k.length;n++){const M=k[n];if(M.fromFrame===(null===x||void 0===x?void 0:x.from)&&M.toFrame===(null===x||void 0===x?void 0:x.to)){a=M;break}}const g=M.getAnimatables();for(let n=0;n<g.length;n++){const M=g[n].animations;if(M)for(let x=0;x<M.length;x++)I.d.MakeAnimationAdditive(M[x],E,b)}return a&&(a.isAdditive=!0),M}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(M){this._meshesWithPoseMatrix.push(M)}_unregisterMeshWithPoseMatrix(M){const E=this._meshesWithPoseMatrix.indexOf(M);E>-1&&this._meshesWithPoseMatrix.splice(E,1)}_computeTransformMatrices(M,E){this.onBeforeComputeObservable.notifyObservers(this);for(let b=0;b<this.bones.length;b++){const x=this.bones[b];x._childUpdateId++;const k=x.getParent();if(k?x.getLocalMatrix().multiplyToRef(k.getFinalMatrix(),x.getFinalMatrix()):E?x.getLocalMatrix().multiplyToRef(E,x.getFinalMatrix()):x.getFinalMatrix().p(x.getLocalMatrix()),-1!==x._index){const E=null===x._index?b:x._index;x.getAbsoluteInverseBindMatrix().multiplyToArray(x.getFinalMatrix(),M,16*E)}}this._identity.copyToArray(M,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const M=this.va().getRenderId();if(this._currentRenderId===M)return;this._currentRenderId=M}if(this._numBonesWithLinkedTransformNode>0)for(const M of this.bones)if(M._linkedTransformNode){const E=M._linkedTransformNode;M.position=E.position,E.rotationQuaternion?M.rotationQuaternion=E.rotationQuaternion:M.rotation=E.rotation,M.ve=E.ve}if(this.needInitialSkinMatrix)for(const M of this._meshesWithPoseMatrix){const E=M.getPoseMatrix();let b=this._isDirty;if(M._bonesTransformMatrices&&M._bonesTransformMatrices.length===16*(this.bones.length+1)||(M._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),b=!0),b){if(this._synchronizedWithMesh!==M){this._synchronizedWithMesh=M;for(const M of this.bones)if(!M.getParent()){M.getBindMatrix().multiplyToRef(E,k.i.Matrix[1]),M._updateAbsoluteBindMatrices(k.i.Matrix[1])}if(this.isUsingTextureForMatrices){const E=4*(this.bones.length+1);M._transformMatrixTexture&&M._transformMatrixTexture.getSize().width===E||(M._transformMatrixTexture&&M._transformMatrixTexture.dispose(),M._transformMatrixTexture=V.c.CreateRGBATexture(M._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(M._bonesTransformMatrices,E),this.isUsingTextureForMatrices&&M._transformMatrixTexture&&M._transformMatrixTexture.update(M._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=V.c.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let M=0;M<this.bones.length;M++)this._animatables.push(this.bones[M])}return this._animatables}clone(M,E){const b=new c(M,E||M,this._scene);b.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let x=0;x<this.bones.length;x++){const M=this.bones[x];let E=null;const k=M.getParent();if(k){const M=this.bones.indexOf(k);E=b.bones[M]}const a=new u.b(M.name,b,E,M.getBindMatrix().clone(),M.getRestMatrix().clone());a._index=M._index,M._linkedTransformNode&&a.linkTransformNode(M._linkedTransformNode),r.e.DeepCopy(M.animations,a.animations)}if(this._ranges){b._ranges={};for(const M in this._ranges){const E=this._ranges[M];E&&(b._ranges[M]=E.clone())}}return this._isDirty=!0,b.prepare(!0),b}enableBlending(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;this.bones.forEach((E=>{E.animations.forEach((E=>{E.enableBlending=!0,E.blendingSpeed=M}))}))}dispose(){if(this._meshesWithPoseMatrix.length=0,this.va().stopAnimation(this),this.va().removeSkeleton(this),this._parentContainer){const M=this._parentContainer.skeletons.indexOf(this);M>-1&&this._parentContainer.skeletons.splice(M,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const M={};M.name=this.name,M.id=this.id,this.dimensionsAtRest&&(M.dimensionsAtRest=this.dimensionsAtRest.Vd()),M.bones=[],M.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let b=0;b<this.bones.length;b++){var E;const x=this.bones[b],k=x.getParent(),a={parentBoneIndex:k?this.bones.indexOf(k):-1,index:x.getIndex(),name:x.name,id:x.id,matrix:x.getBindMatrix().Vd(),rest:x.getRestMatrix().Vd(),linkedTransformNodeId:null===(E=x.getTransformNode())||void 0===E?void 0:E.id};M.bones.push(a),x.length&&(a.length=x.length),x.metadata&&(a.metadata=x.metadata),x.animations&&x.animations.length>0&&(a.animation=x.animations[0].serialize()),M.ranges=[];for(const E in this._ranges){const b=this._ranges[E];if(!b)continue;const x={};x.name=E,x.from=b.from,x.to=b.to,M.ranges.push(x)}}return M}static Parse(M,E){const b=new c(M.name,M.id,E);let x;for(M.dimensionsAtRest&&(b.dimensionsAtRest=k.m.Id(M.dimensionsAtRest)),b.needInitialSkinMatrix=M.needInitialSkinMatrix,x=0;x<M.bones.length;x++){const E=M.bones[x],a=M.bones[x].index;let g=null;E.parentBoneIndex>-1&&(g=b.bones[E.parentBoneIndex]);const n=E.rest?k.d.Id(E.rest):null,J=new u.b(E.name,b,g,k.d.Id(E.matrix),n,null,a);void 0!==E.id&&null!==E.id&&(J.id=E.id),E.length&&(J.length=E.length),E.metadata&&(J.metadata=E.metadata),E.animation&&J.animations.push(I.d.Parse(E.animation)),void 0!==E.linkedTransformNodeId&&null!==E.linkedTransformNodeId&&(b._hasWaitingData=!0,J._waitingTransformNodeId=E.linkedTransformNodeId)}if(M.ranges)for(x=0;x<M.ranges.length;x++){const E=M.ranges[x];b.createAnimationRange(E.name,E.from,E.to)}return b}computeAbsoluteMatrices(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||M)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(M)}getPoseMatrix(){let M=null;return this._meshesWithPoseMatrix.length>0&&(M=this._meshesWithPoseMatrix[0].getPoseMatrix()),M}sortBones(){const M=[],E=new Array(this.bones.length);for(let b=0;b<this.bones.length;b++)this._sortBones(b,M,E);this.bones=M}_sortBones(M,E,b){if(b[M])return;b[M]=!0;const x=this.bones[M];if(!x)return;void 0===x._index&&(x._index=M);const k=x.getParent();k&&this._sortBones(this.bones.indexOf(k),E,b),E.push(x)}setCurrentPoseAsRest(){this.bones.forEach((M=>{M.setCurrentPoseAsRest()}))}}var C=b(1326),R=b(948),w=b(953),S=b(12127),X=b(12130),U=b(989),v=b(1124);class N extends X.d{get refractionTexture(){return this.subSurface.refractionTexture}set refractionTexture(M){this.subSurface.refractionTexture=M,M?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)}get indexOfRefraction(){return this.subSurface.indexOfRefraction}set indexOfRefraction(M){this.subSurface.indexOfRefraction=M}get invertRefractionY(){return this.subSurface.invertRefractionY}set invertRefractionY(M){this.subSurface.invertRefractionY=M}get linkRefractionWithTransparency(){return this.subSurface.linkRefractionWithTransparency}set linkRefractionWithTransparency(M){this.subSurface.linkRefractionWithTransparency=M,M&&(this.subSurface.isRefractionEnabled=!0)}get usePhysicalLightFalloff(){return this._lightFalloff===X.d.LIGHTFALLOFF_PHYSICAL}set usePhysicalLightFalloff(M){M!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=M?X.d.LIGHTFALLOFF_PHYSICAL:X.d.LIGHTFALLOFF_STANDARD)}get useGLTFLightFalloff(){return this._lightFalloff===X.d.LIGHTFALLOFF_GLTF}set useGLTFLightFalloff(M){M!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=M?X.d.LIGHTFALLOFF_GLTF:X.d.LIGHTFALLOFF_STANDARD)}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(M){this._attachImageProcessingConfiguration(M),this._markAllSubMeshesAsTexturesDirty()}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(M){this.imageProcessingConfiguration.colorCurvesEnabled=M}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(M){this.imageProcessingConfiguration.colorGradingEnabled=M}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(M){this._imageProcessingConfiguration.toneMappingEnabled=M}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(M){this._imageProcessingConfiguration.exposure=M}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(M){this._imageProcessingConfiguration.contrast=M}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(M){this._imageProcessingConfiguration.colorGradingTexture=M}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(M){this._imageProcessingConfiguration.colorCurves=M}constructor(M,E){super(M,E,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.directIntensity=1,this.emissiveIntensity=1,this.environmentIntensity=1,this.specularIntensity=1,this.disableBumpMap=!1,this.ambientTextureStrength=1,this.ambientTextureImpactOnAnalyticalLights=N.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this.metallicF0Factor=1,this.metallicReflectanceColor=a.e.White(),this.useOnlyMetallicFromMetallicReflectanceTexture=!1,this.ambientColor=new a.e(0,0,0),this.albedoColor=new a.e(1,1,1),this.reflectivityColor=new a.e(1,1,1),this.reflectionColor=new a.e(1,1,1),this.emissiveColor=new a.e(0,0,0),this.microSurface=1,this.useLightmapAsShadowmap=!1,this.useAlphaFromAlbedoTexture=!1,this.forceAlphaTest=!1,this.alphaCutOff=.4,this.useSpecularOverAlpha=!0,this.useMicroSurfaceFromReflectivityMapAlpha=!1,this.useRoughnessFromMetallicTextureAlpha=!0,this.useRoughnessFromMetallicTextureGreen=!1,this.useMetallnessFromMetallicTextureBlue=!1,this.useAmbientOcclusionFromMetallicTextureRed=!1,this.useAmbientInGrayScale=!1,this.useAutoMicroSurfaceFromReflectivityMap=!1,this.useRadianceOverAlpha=!0,this.useObjectSpaceNormalMap=!1,this.useParallax=!1,this.useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this.disableLighting=!1,this.forceIrradianceInFragment=!1,this.maxSimultaneousLights=4,this.invertNormalMapX=!1,this.invertNormalMapY=!1,this.twoSidedLighting=!1,this.useAlphaFresnel=!1,this.useLinearAlphaFresnel=!1,this.environmentBRDFTexture=null,this.forceNormalForward=!1,this.enableSpecularAntiAliasing=!1,this.useHorizonOcclusion=!0,this.useRadianceOcclusion=!0,this.unlit=!1,this.applyDecalMapAfterDetailMap=!1,this._environmentBRDFTexture=(0,S.d)(this.va())}getClassName(){return"PBRMaterial"}clone(M){let E=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const x=v.b.Clone((()=>new N(M,this.va())),this,{cloneTexturesOnlyOnce:E});return x.id=M,x.name=M,this.stencil.copyTo(x.stencil),this._clonePlugins(x,b),x}serialize(){const M=super.serialize();return M.customType="BABYLON.PBRMaterial",M}static Parse(M,E,b){const x=v.b.Parse((()=>new N(M.name,E)),M,E,b);return M.stencil&&x.stencil.parse(M.stencil,E,b),C.e._ParsePlugins(M,x,E,b),M.clearCoat&&x.clearCoat.parse(M.clearCoat,E,b),M.anisotropy&&x.anisotropy.parse(M.anisotropy,E,b),M.brdf&&x.brdf.parse(M.brdf,E,b),M.sheen&&x.sheen.parse(M.sheen,E,b),M.subSurface&&x.subSurface.parse(M.subSurface,E,b),M.iridescence&&x.iridescence.parse(M.iridescence,E,b),x}}N.PBRMATERIAL_OPAQUE=X.d.PBRMATERIAL_OPAQUE,N.PBRMATERIAL_ALPHATEST=X.d.PBRMATERIAL_ALPHATEST,N.PBRMATERIAL_ALPHABLEND=X.d.PBRMATERIAL_ALPHABLEND,N.PBRMATERIAL_ALPHATESTANDBLEND=X.d.PBRMATERIAL_ALPHATESTANDBLEND,N.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=X.d.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,(0,R.d)([(0,w.E)(),(0,w.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"directIntensity",void 0),(0,R.d)([(0,w.E)(),(0,w.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"emissiveIntensity",void 0),(0,R.d)([(0,w.E)(),(0,w.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"environmentIntensity",void 0),(0,R.d)([(0,w.E)(),(0,w.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"specularIntensity",void 0),(0,R.d)([(0,w.E)(),(0,w.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"disableBumpMap",void 0),(0,R.d)([(0,w.A)(),(0,w.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"albedoTexture",void 0),(0,R.d)([(0,w.A)(),(0,w.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"ambientTexture",void 0),(0,R.d)([(0,w.E)(),(0,w.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"ambientTextureStrength",void 0),(0,R.d)([(0,w.E)(),(0,w.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),(0,R.d)([(0,w.A)(),(0,w.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],N.prototype,"opacityTexture",void 0),(0,R.d)([(0,w.A)(),(0,w.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"reflectionTexture",void 0),(0,R.d)([(0,w.A)(),(0,w.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"emissiveTexture",void 0),(0,R.d)([(0,w.A)(),(0,w.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"reflectivityTexture",void 0),(0,R.d)([(0,w.A)(),(0,w.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"metallicTexture",void 0),(0,R.d)([(0,w.E)(),(0,w.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"metallic",void 0),(0,R.d)([(0,w.E)(),(0,w.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"roughness",void 0),(0,R.d)([(0,w.E)(),(0,w.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"metallicF0Factor",void 0),(0,R.d)([(0,w.m)(),(0,w.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"metallicReflectanceColor",void 0),(0,R.d)([(0,w.E)(),(0,w.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"useOnlyMetallicFromMetallicReflectanceTexture",void 0),(0,R.d)([(0,w.A)(),(0,w.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"metallicReflectanceTexture",void 0),(0,R.d)([(0,w.A)(),(0,w.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"reflectanceTexture",void 0),(0,R.d)([(0,w.A)(),(0,w.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"microSurfaceTexture",void 0),(0,R.d)([(0,w.A)(),(0,w.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"bumpTexture",void 0),(0,R.d)([(0,w.A)(),(0,w.e)("_markAllSubMeshesAsTexturesDirty",null)],N.prototype,"lightmapTexture",void 0),(0,R.d)([(0,w.m)("ambient"),(0,w.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"ambientColor",void 0),(0,R.d)([(0,w.m)("albedo"),(0,w.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"albedoColor",void 0),(0,R.d)([(0,w.m)("reflectivity"),(0,w.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"reflectivityColor",void 0),(0,R.d)([(0,w.m)("reflection"),(0,w.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"reflectionColor",void 0),(0,R.d)([(0,w.m)("emissive"),(0,w.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"emissiveColor",void 0),(0,R.d)([(0,w.E)(),(0,w.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"microSurface",void 0),(0,R.d)([(0,w.E)(),(0,w.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"useLightmapAsShadowmap",void 0),(0,R.d)([(0,w.E)(),(0,w.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],N.prototype,"useAlphaFromAlbedoTexture",void 0),(0,R.d)([(0,w.E)(),(0,w.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],N.prototype,"forceAlphaTest",void 0),(0,R.d)([(0,w.E)(),(0,w.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],N.prototype,"alphaCutOff",void 0),(0,R.d)([(0,w.E)(),(0,w.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"useSpecularOverAlpha",void 0),(0,R.d)([(0,w.E)(),(0,w.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),(0,R.d)([(0,w.E)(),(0,w.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),(0,R.d)([(0,w.E)(),(0,w.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"useRoughnessFromMetallicTextureGreen",void 0),(0,R.d)([(0,w.E)(),(0,w.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"useMetallnessFromMetallicTextureBlue",void 0),(0,R.d)([(0,w.E)(),(0,w.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),(0,R.d)([(0,w.E)(),(0,w.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"useAmbientInGrayScale",void 0),(0,R.d)([(0,w.E)(),(0,w.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),(0,R.d)([(0,w.E)()],N.prototype,"usePhysicalLightFalloff",null),(0,R.d)([(0,w.E)()],N.prototype,"useGLTFLightFalloff",null),(0,R.d)([(0,w.E)(),(0,w.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"useRadianceOverAlpha",void 0),(0,R.d)([(0,w.E)(),(0,w.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"useObjectSpaceNormalMap",void 0),(0,R.d)([(0,w.E)(),(0,w.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"useParallax",void 0),(0,R.d)([(0,w.E)(),(0,w.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"useParallaxOcclusion",void 0),(0,R.d)([(0,w.E)(),(0,w.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"parallaxScaleBias",void 0),(0,R.d)([(0,w.E)(),(0,w.e)("_markAllSubMeshesAsLightsDirty")],N.prototype,"disableLighting",void 0),(0,R.d)([(0,w.E)(),(0,w.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"forceIrradianceInFragment",void 0),(0,R.d)([(0,w.E)(),(0,w.e)("_markAllSubMeshesAsLightsDirty")],N.prototype,"maxSimultaneousLights",void 0),(0,R.d)([(0,w.E)(),(0,w.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"invertNormalMapX",void 0),(0,R.d)([(0,w.E)(),(0,w.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"invertNormalMapY",void 0),(0,R.d)([(0,w.E)(),(0,w.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"twoSidedLighting",void 0),(0,R.d)([(0,w.E)(),(0,w.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"useAlphaFresnel",void 0),(0,R.d)([(0,w.E)(),(0,w.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"useLinearAlphaFresnel",void 0),(0,R.d)([(0,w.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"environmentBRDFTexture",void 0),(0,R.d)([(0,w.E)(),(0,w.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"forceNormalForward",void 0),(0,R.d)([(0,w.E)(),(0,w.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"enableSpecularAntiAliasing",void 0),(0,R.d)([(0,w.E)(),(0,w.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"useHorizonOcclusion",void 0),(0,R.d)([(0,w.E)(),(0,w.e)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"useRadianceOcclusion",void 0),(0,R.d)([(0,w.E)(),(0,w.e)("_markAllSubMeshesAsMiscDirty")],N.prototype,"unlit",void 0),(0,R.d)([(0,w.E)(),(0,w.e)("_markAllSubMeshesAsMiscDirty")],N.prototype,"applyDecalMapAfterDetailMap",void 0),(0,U.h)("BABYLON.PBRMaterial",N);var K=b(942),h=b(11578),Z=b(1228),O=b(11562),p=b(11569),P=b(11537);class F{get influence(){return this._influence}set influence(M){if(this._influence===M)return;const E=this._influence;this._influence=M,this.onInfluenceChanged.hasObservers()&&this.onInfluenceChanged.notifyObservers(0===E||0===M)}get animationPropertiesOverride(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride}set animationPropertiesOverride(M){this._animationPropertiesOverride=M}constructor(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.name=M,this.animations=[],this._positions=null,this._normals=null,this._tangents=null,this._uvs=null,this._uniqueId=0,this.onInfluenceChanged=new T.b,this._onDataLayoutChanged=new T.b,this._animationPropertiesOverride=null,this.id=M,this._scene=b||y.b.LastCreatedScene,this.influence=E,this._scene&&(this._uniqueId=this._scene.getUniqueId())}get uniqueId(){return this._uniqueId}get hasPositions(){return!!this._positions}get hasNormals(){return!!this._normals}get hasTangents(){return!!this._tangents}get hasUVs(){return!!this._uvs}setPositions(M){const E=this.hasPositions;this._positions=M,E!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)}getPositions(){return this._positions}setNormals(M){const E=this.hasNormals;this._normals=M,E!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)}getNormals(){return this._normals}setTangents(M){const E=this.hasTangents;this._tangents=M,E!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)}getTangents(){return this._tangents}setUVs(M){const E=this.hasUVs;this._uvs=M,E!==this.hasUVs&&this._onDataLayoutChanged.notifyObservers(void 0)}getUVs(){return this._uvs}clone(){const M=v.b.Clone((()=>new F(this.name,this.influence,this._scene)),this);return M._positions=this._positions,M._normals=this._normals,M._tangents=this._tangents,M._uvs=this._uvs,M}serialize(){const M={};return M.name=this.name,M.influence=this.influence,M.xa=Array.prototype.slice.call(this.getPositions()),null!=this.id&&(M.id=this.id),this.hasNormals&&(M.ya=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(M.tangents=Array.prototype.slice.call(this.getTangents())),this.hasUVs&&(M.Aa=Array.prototype.slice.call(this.getUVs())),v.b.AppendSerializedAnimations(this,M),M}getClassName(){return"MorphTarget"}static Parse(M,E){const b=new F(M.name,M.influence);if(b.setPositions(M.xa),null!=M.id&&(b.id=M.id),M.ya&&b.setNormals(M.ya),M.tangents&&b.setTangents(M.tangents),M.Aa&&b.setUVs(M.Aa),M.animations){for(let E=0;E<M.animations.length;E++){const x=M.animations[E],k=(0,U.e)("BABYLON.Animation");k&&b.animations.push(k.Parse(x))}M.autoAnimate&&E&&E.beginAnimation(b,M.autoAnimateFrom,M.autoAnimateTo,M.autoAnimateLoop,M.autoAnimateSpeed||1)}return b}static FromMesh(M,E,b){E||(E=M.name);const x=new F(E,b,M.va());return x.setPositions(M.getVerticesData(Z.g.PositionKind)),M.isVerticesDataPresent(Z.g.NormalKind)&&x.setNormals(M.getVerticesData(Z.g.NormalKind)),M.isVerticesDataPresent(Z.g.TangentKind)&&x.setTangents(M.getVerticesData(Z.g.TangentKind)),M.isVerticesDataPresent(Z.g.UVKind)&&x.setUVs(M.getVerticesData(Z.g.UVKind)),x}}(0,R.d)([(0,w.E)()],F.prototype,"id",void 0);var l=b(1166),d=b(1572);class W{set areUpdatesFrozen(M){M?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(!0)))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new l.f(16),this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,M||(M=y.b.LastCreatedScene),this._scene=M,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const M=this._scene.getEngine().getCaps();this._canUseTextureForTargets=M.canUseGLVertexID&&M.textureFloat&&M.maxVertexTextureImageUnits>0&&M.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return this._numMaxInfluencers}set numMaxInfluencers(M){this._numMaxInfluencers!==M&&(this._numMaxInfluencers=M,this._syncActiveTargets(!0))}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(M){this._useTextureToStoreTargets=M}get isUsingTextureForTargets(){var M;return W.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(M=this._scene)&&void 0!==M&&M.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(M){return this._activeTargets.data[M]}getTarget(M){return this._targets[M]}getTargetByName(M){for(const E of this._targets)if(E.name===M)return E;return null}addTarget(M){this._targets.push(M),this._targetInfluenceChangedObservers.push(M.onInfluenceChanged.add((M=>{this._syncActiveTargets(M)}))),this._targetDataLayoutChangedObservers.push(M._onDataLayoutChanged.add((()=>{this._syncActiveTargets(!0)}))),this._syncActiveTargets(!0)}removeTarget(M){const E=this._targets.indexOf(M);E>=0&&(this._targets.splice(E,1),M.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(E,1)[0]),M._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(E,1)[0]),this._syncActiveTargets(!0)),this._scene&&this._scene.stopAnimation(M)}_bind(M){M.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),M.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),M.setTexture("morphTargets",this._targetStoreTexture),M.setInt("morphTargetCount",this.numInfluencers)}clone(){const M=new W(this._scene);for(const E of this._targets)M.addTarget(E.clone());return M.enableNormalMorphing=this.enableNormalMorphing,M.enableTangentMorphing=this.enableTangentMorphing,M.enableUVMorphing=this.enableUVMorphing,M}serialize(){const M={};M.id=this.uniqueId,M.targets=[];for(const E of this._targets)M.targets.push(E.serialize());return M}_syncActiveTargets(M){if(this.areUpdatesFrozen)return;let E=0;this._activeTargets.reset(),this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._vertexCount=0,this._scene&&this._targets.length>this._scene.getEngine().getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let b=-1;for(const x of this._targets){if(b++,0===x.influence&&this.optimizeInfluencers)continue;if(this._activeTargets.length>=W.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(x),this._morphTargetTextureIndices[E]=b,this._tempInfluences[E++]=x.influence,this._supportsNormals=this._supportsNormals&&x.hasNormals,this._supportsTangents=this._supportsTangents&&x.hasTangents,this._supportsUVs=this._supportsUVs&&x.hasUVs;const M=x.getPositions();if(M){const E=M.length/3;if(0===this._vertexCount)this._vertexCount=E;else if(this._vertexCount!==E)return void B.d.Error("Incompatible target. Targets must all have the same vertices count.")}}this._morphTargetTextureIndices.length!==E&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,E)),this._influences&&this._influences.length===E||(this._influences=new Float32Array(E));for(let x=0;x<E;x++)this._influences[x]=this._tempInfluences[x];M&&this.synchronize()}synchronize(){if(this._scene&&!this.areUpdatesFrozen){if(this.isUsingTextureForTargets&&(this._vertexCount||this.numMaxInfluencers>0)){this._textureVertexStride=1,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const M=this._scene.getEngine().getCaps().maxTextureSize;this._textureWidth>M&&(this._textureHeight=Math.ceil(this._textureWidth/M),this._textureWidth=M);let E=!0;if(this._targetStoreTexture){const M=this._targetStoreTexture.getSize();M.width===this._textureWidth&&M.height===this._textureHeight&&this._targetStoreTexture.depth===this._targets.length&&(E=!1)}if(E){this._targetStoreTexture&&this._targetStoreTexture.dispose();const M=this._targets.length,E=new Float32Array(M*this._textureWidth*this._textureHeight*4);let b=0;for(let x=0;x<M;x++){const M=this._targets[x],k=M.getPositions(),a=M.getNormals(),g=M.getUVs(),n=M.getTangents();if(!k)return void(0===x&&B.d.Error("Invalid morph target. Target must have positions."));b=x*this._textureWidth*this._textureHeight*4;for(let x=0;x<this._vertexCount;x++)E[b]=k[3*x],E[b+1]=k[3*x+1],E[b+2]=k[3*x+2],b+=4,this._supportsNormals&&a&&(E[b]=a[3*x],E[b+1]=a[3*x+1],E[b+2]=a[3*x+2],b+=4),this._supportsUVs&&g&&(E[b]=g[2*x],E[b+1]=g[2*x+1],b+=4),this._supportsTangents&&n&&(E[b]=n[3*x],E[b+1]=n[3*x+1],E[b+2]=n[3*x+2],b+=4)}this._targetStoreTexture=d.e.CreateRGBATexture(E,this._textureWidth,this._textureHeight,M,this._scene,!1,!1,1,1)}}for(const M of this._scene.meshes)M.morphTargetManager===this&&M._syncGeometryWithMorphTargetManager()}}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const M=this._parentContainer.morphTargetManagers.indexOf(this);M>-1&&this._parentContainer.morphTargetManagers.splice(M,1),this._parentContainer=null}for(const M of this._targets)this._scene.stopAnimation(M)}}static Parse(M,E){const b=new W(E);for(const x of M.targets)b.addTarget(F.Parse(x,E));return b}}W.EnableTextureStorage=!0,W.MaxActiveMorphTargetsInVertexAttributeMode=8;var m=b(12138),o=b(1022),j=b(1343);function s(M,E,b,x){return k.m.Id(E,b).scaleInPlace(x)}class q{constructor(M,E,b,x){this.type=M,this.name=E,this.getValue=b,this.getStride=x}_buildAnimation(M,E,b){const x=new I.d(M,this.name,E,this.type);return x.setKeys(b),x}}class D extends q{buildAnimations(M,E,b,x,k){k(M._babylonTransformNode,this._buildAnimation(E,b,x))}}const z={translation:[new D(I.d.ANIMATIONTYPE_VECTOR3,"position",s,(()=>3))],rotation:[new D(I.d.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",(function(M,E,b,x){return k.e.Id(E,b).scaleInPlace(x)}),(()=>4))],scale:[new D(I.d.ANIMATIONTYPE_VECTOR3,"ve",s,(()=>3))],weights:[new class extends q{buildAnimations(M,E,b,x,k){if(M._numMorphTargets)for(let a=0;a<M._numMorphTargets;a++){const g=new I.d(`${E}_${a}`,this.name,b,this.type);if(g.setKeys(x.map((M=>({frame:M.frame,inTangent:M.inTangent?M.inTangent[a]:void 0,value:M.value[a],outTangent:M.outTangent?M.outTangent[a]:void 0,interpolation:M.interpolation})))),M._primitiveBabylonMeshes)for(const E of M._primitiveBabylonMeshes)if(E.morphTargetManager){const M=E.morphTargetManager.getTarget(a),b=g.clone();M.animations.push(b),k(M,b)}}}}(I.d.ANIMATIONTYPE_FLOAT,"influence",(function(M,E,b,x){const k=new Array(M._numMorphTargets);for(let a=0;a<k.length;a++)k[a]=E[b++]*x;return k}),(M=>M._numMorphTargets))]},A=new Map,Y=A;function i(M,E,b){G(M)&&B.d.Warn(`Extension with the name '${M}' already exists`),A.set(M,{isGLTFExtension:E,factory:b})}function G(M){return A.delete(M)}function H(){const M=M=>M&&"object"===typeof M;for(var E=arguments.length,b=new Array(E),x=0;x<E;x++)b[x]=arguments[x];return b.reduce(((E,b)=>(Object.keys(b).forEach((x=>{const k=E[x],a=b[x];Array.isArray(k)&&Array.isArray(a)?E[x]=k.concat(...a):M(k)&&M(a)?E[x]=H(k,a):E[x]=a})),E)),{})}class e{static Get(M,E,b){if(!E||void 0==b||!E[b])throw new Error(`${M}: Failed to find index (${b})`);return E[b]}static TryGet(M,E){return M&&void 0!=E&&M[E]?M[E]:null}static Assign(M){if(M)for(let E=0;E<M.length;E++)M[E].index=E}}class Q{static RegisterExtension(M,E){i(M,!1,E)}static UnregisterExtension(M){return G(M)}get Yi(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(M){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=M}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((M=>M.dispose&&M.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}importMeshAsync(M,E,b,x,k,a){let g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return Promise.resolve().then((()=>{this._babylonScene=E,this._assetContainer=b,this._loadData(x);let a=null;if(M){const E={};if(this._gltf.nodes)for(const M of this._gltf.nodes)M.name&&(E[M.name]=M.index);a=(M instanceof Array?M:[M]).map((M=>{const b=E[M];if(void 0===b)throw new Error(`Failed to find node '${M}'`);return b}))}return this._loadAsync(k,g,a,(()=>({meshes:this._getMeshes(),ae:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}loadAsync(M,E,b,x){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return Promise.resolve().then((()=>(this._babylonScene=M,this._loadData(E),this._loadAsync(b,k,null,(()=>{})))))}_loadAsync(M,E,b,x){return Promise.resolve().then((async()=>{this._rootUrl=M,this._uniqueRootUrl=!M.startsWith("file:")&&E?M:`${M}${Date.now()}/`,this._fileName=E,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const k=`${m.m[m.m.LOADING]} => ${m.m[m.m.READY]}`,a=`${m.m[m.m.LOADING]} => ${m.m[m.m.COMPLETE]}`;this._parent._startPerformanceCounter(k),this._parent._startPerformanceCounter(a),this._parent._setState(m.m.LOADING),this._extensionsOnLoading();const n=new Array;if(!this.parent.loadOnlyMaterials)if(b)n.push(this.loadSceneAsync("/nodes",{nodes:b,index:-1}));else if(void 0!=this._gltf.Ae||this._gltf.scenes&&this._gltf.scenes[0]){const M=e.Get("/scene",this._gltf.scenes,this._gltf.Ae||0);n.push(this.loadSceneAsync(`/scenes/${M.index}`,M))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let M=0;M<this._gltf.materials.length;++M){const E=this._gltf.materials[M],b="/materials/"+M,x=C.e.TriangleFillMode;n.push(this._loadMaterialAsync(b,E,null,x,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&n.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&n.push(this._compileShadowGeneratorsAsync());return Promise.all(n).then((()=>(this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.wg(!0),this._extensionsOnReady(),this._parent._setState(m.m.READY),this._startAnimations(),x()))).then((M=>(this._parent._endPerformanceCounter(k),g.e.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(a),this._parent._setState(m.m.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(M=>{this._parent.onErrorObservable.notifyObservers(M),this._parent.onErrorObservable.clear(),this.dispose()}))})),M)))})).catch((M=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(M),this._parent.onErrorObservable.clear(),this.dispose()),M}))}_loadData(M){if(this._gltf=M.json,this._setupData(),M.bin){const E=this._gltf.buffers;if(E&&E[0]&&!E[0].uri){const b=E[0];(b.byteLength<M.bin.byteLength-3||b.byteLength>M.bin.byteLength)&&B.d.Warn(`Binary buffer length (${b.byteLength}) from JSON does not match chunk length (${M.bin.byteLength})`),this._bin=M.bin}else B.d.Warn("Unexpected BIN chunk")}}_setupData(){if(e.Assign(this._gltf.accessors),e.Assign(this._gltf.animations),e.Assign(this._gltf.buffers),e.Assign(this._gltf.bufferViews),e.Assign(this._gltf.cameras),e.Assign(this._gltf.images),e.Assign(this._gltf.materials),e.Assign(this._gltf.meshes),e.Assign(this._gltf.nodes),e.Assign(this._gltf.samplers),e.Assign(this._gltf.scenes),e.Assign(this._gltf.skins),e.Assign(this._gltf.textures),this._gltf.nodes){const M={};for(const b of this._gltf.nodes)if(b.children)for(const E of b.children)M[E]=b.index;const E=this._createRootNode();for(const b of this._gltf.nodes){const x=M[b.index];b.parent=void 0===x?E:this._gltf.nodes[x]}}}async _loadExtensionsAsync(){const M=[];if(Y.forEach(((E,b)=>{var x;!1===(null===(x=this.parent.extensionOptions[b])||void 0===x?void 0:x.enabled)?E.isGLTFExtension&&this.isExtensionUsed(b)&&B.d.Warn(`Extension ${b} is used but has been explicitly disabled.`):E.isGLTFExtension&&!this.isExtensionUsed(b)||M.push((async()=>{const M=await E.factory(this);return M.name!==b&&B.d.Warn(`The name of the glTF loader extension instance does not match the registered name: ${M.name} !== ${b}`),this._parent.onExtensionLoadedObservable.notifyObservers(M),M})())})),this._extensions.push(...await Promise.all(M)),this._extensions.sort(((M,E)=>(M.order||Number.MAX_VALUE)-(E.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const b of this._gltf.extensionsRequired){if(!this._extensions.some((M=>M.name===b&&M.enabled))){var E;if(!1===(null===(E=this.parent.extensionOptions[b])||void 0===E?void 0:E.enabled))throw new Error(`Required extension ${b} is disabled`);throw new Error(`Required extension ${b} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const M=new P.e("__root__",this._babylonScene);this._rootBabylonMesh=M,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.wg(!1);const E={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case m.i.AUTO:this._babylonScene.useRightHandedSystem||(E.rotation=[0,1,0,0],E.scale=[1,1,-1],Q._LoadTransform(E,this._rootBabylonMesh));break;case m.i.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(M),E}loadSceneAsync(M,E){const b=this._extensionsLoadSceneAsync(M,E);if(b)return b;const x=new Array;if(this.logOpen(`${M} ${E.name||""}`),E.nodes)for(const k of E.nodes){const E=e.Get(`${M}/nodes/${k}`,this._gltf.nodes,k);x.push(this.loadNodeAsync(`/nodes/${E.index}`,E,(M=>{M.parent=this._rootBabylonMesh})))}for(const k of this._postSceneLoadActions)k();return x.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(x).then((()=>{}))}_forEachPrimitive(M,E){if(M._primitiveBabylonMeshes)for(const b of M._primitiveBabylonMeshes)E(b)}_getGeometries(){const M=[],E=this._gltf.nodes;if(E)for(const b of E)this._forEachPrimitive(b,(E=>{const b=E.le;b&&-1===M.indexOf(b)&&M.push(b)}));return M}_getMeshes(){const M=[];this._rootBabylonMesh instanceof p.d&&M.push(this._rootBabylonMesh);const E=this._gltf.nodes;if(E)for(const b of E)this._forEachPrimitive(b,(E=>{M.push(E)}));return M}_getTransformNodes(){const M=[],E=this._gltf.nodes;if(E)for(const b of E)b._babylonTransformNode&&"pb"===b._babylonTransformNode.getClassName()&&M.push(b._babylonTransformNode),b._babylonTransformNodeForSkin&&M.push(b._babylonTransformNodeForSkin);return M}_getSkeletons(){const M=[],E=this._gltf.skins;if(E)for(const b of E)b._data&&M.push(b._data.babylonSkeleton);return M}_getAnimationGroups(){const M=[],E=this._gltf.animations;if(E)for(const b of E)b._babylonAnimationGroup&&M.push(b._babylonAnimationGroup);return M}_startAnimations(){switch(this._parent.animationStartMode){case m.e.NONE:break;case m.e.FIRST:{const M=this._getAnimationGroups();0!==M.length&&M[0].start(!0);break}case m.e.ALL:{const M=this._getAnimationGroups();for(const E of M)E.start(!0);break}default:return void B.d.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(M,E){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const x=this._extensionsLoadNodeAsync(M,E,b);if(x)return x;if(E._babylonTransformNode)throw new Error(`${M}: Invalid recursive node hierarchy`);const k=new Array;this.logOpen(`${M} ${E.name||""}`);const a=x=>{if(Q.AddPointerMetadata(x,M),Q._LoadTransform(E,x),void 0!=E.camera){const b=e.Get(`${M}/camera`,this._gltf.cameras,E.camera);k.push(this.loadCameraAsync(`/cameras/${b.index}`,b,(M=>{M.parent=x})))}if(E.children)for(const b of E.children){const E=e.Get(`${M}/children/${b}`,this._gltf.nodes,b);k.push(this.loadNodeAsync(`/nodes/${E.index}`,E,(M=>{M.parent=x})))}b(x)},g=void 0!=E.mesh,n=this._parent.loadSkins&&void 0!=E.skin;if(!g||n){const M=E.name||`node${E.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const b=new h.c(M,this._babylonScene);b._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==E.mesh?E._babylonTransformNode=b:E._babylonTransformNodeForSkin=b,a(b)}if(g)if(n){const b=e.Get(`${M}/mesh`,this._gltf.meshes,E.mesh);k.push(this._loadMeshAsync(`/meshes/${b.index}`,E,b,(b=>{const x=E._babylonTransformNodeForSkin;b.metadata=H(x.metadata,b.metadata||{});const a=e.Get(`${M}/skin`,this._gltf.skins,E.skin);k.push(this._loadSkinAsync(`/skins/${a.index}`,E,a,(M=>{this._forEachPrimitive(E,(E=>{E.skeleton=M})),this._postSceneLoadActions.push((()=>{if(void 0!=a.skeleton){const M=e.Get(`/skins/${a.index}/skeleton`,this._gltf.nodes,a.skeleton).parent;E.index===M.index?b.parent=x.parent:b.parent=M._babylonTransformNode}else b.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:x,skinnedNode:b})}))})))})))}else{const b=e.Get(`${M}/mesh`,this._gltf.meshes,E.mesh);k.push(this._loadMeshAsync(`/meshes/${b.index}`,E,b,a))}return this.logClose(),Promise.all(k).then((()=>(this._forEachPrimitive(E,(M=>{M.le&&M.le.useBoundingInfoFromGeometry?M.Ea():M.refreshBoundingInfo(!0,!0)})),E._babylonTransformNode)))}_loadMeshAsync(M,E,b,x){const k=b.primitives;if(!k||!k.length)throw new Error(`${M}: Primitives are missing`);void 0==k[0].index&&e.Assign(k);const a=new Array;this.logOpen(`${M} ${b.name||""}`);const g=E.name||`node${E.index}`;if(1===k.length){const x=b.primitives[0];a.push(this._loadMeshPrimitiveAsync(`${M}/primitives/${x.index}`,g,E,b,x,(M=>{E._babylonTransformNode=M,E._primitiveBabylonMeshes=[M]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,E._babylonTransformNode=new h.c(g,this._babylonScene),E._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,E._primitiveBabylonMeshes=[];for(const x of k)a.push(this._loadMeshPrimitiveAsync(`${M}/primitives/${x.index}`,`${g}_primitive${x.index}`,E,b,x,(M=>{M.parent=E._babylonTransformNode,E._primitiveBabylonMeshes.push(M)})))}return x(E._babylonTransformNode),this.logClose(),Promise.all(a).then((()=>E._babylonTransformNode))}_loadMeshPrimitiveAsync(M,E,b,x,k,a){const g=this._extensionsLoadMeshPrimitiveAsync(M,E,b,x,k,a);if(g)return g;this.logOpen(`${M}`);const n=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==b.skin&&!x.primitives[0].targets;let J,u;if(n&&k._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,J=k._instanceData.babylonSourceMesh.gd(E),J._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,u=k._instanceData.promise;else{const a=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const g=new P.e(E,this._babylonScene);g._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,g.sideOrientation=this._babylonScene.useRightHandedSystem?C.e.CounterClockWiseSideOrientation:C.e.ClockWiseSideOrientation,this._createMorphTargets(M,b,x,k,g),a.push(this._loadVertexDataAsync(M,k,g).then((E=>this._loadMorphTargetsAsync(M,k,g,E).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,E.Ca(g),E._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const T=Q._GetDrawMode(M,k.mode);if(void 0==k.material){let M=this._defaultBabylonMaterialData[T];M||(M=this._createDefaultMaterial("__GLTFLoader._default",T),this._parent.onMaterialLoadedObservable.notifyObservers(M),this._defaultBabylonMaterialData[T]=M),g.material=M}else if(!this.parent.skipMaterials){const E=e.Get(`${M}/material`,this._gltf.materials,k.material);a.push(this._loadMaterialAsync(`/materials/${E.index}`,E,g,T,(M=>{g.material=M})))}u=Promise.all(a),n&&(k._instanceData={babylonSourceMesh:g,promise:u}),J=g}return Q.AddPointerMetadata(J,M),this._parent.onMeshLoadedObservable.notifyObservers(J),a(J),this.logClose(),u.then((()=>J))}_loadVertexDataAsync(M,E,b){const x=this._extensionsLoadVertexDataAsync(M,E,b);if(x)return x;const a=E.attributes;if(!a)throw new Error(`${M}: Attributes are missing`);const g=new Array,n=new O.b(b.name,this._babylonScene);if(void 0==E.indices)b.isUnIndexed=!0;else{const b=e.Get(`${M}/indices`,this._gltf.accessors,E.indices);g.push(this._loadIndicesAccessorAsync(`/accessors/${b.index}`,b).then((M=>{n.setIndices(M)})))}const J=(E,x,J)=>{if(void 0==a[E])return;b._delayInfo=b._delayInfo||[],-1===b._delayInfo.indexOf(x)&&b._delayInfo.push(x);const u=e.Get(`${M}/attributes/${E}`,this._gltf.accessors,a[E]);g.push(this._loadVertexAccessorAsync(`/accessors/${u.index}`,u,x).then((M=>{if(M.getKind()===Z.g.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!b.skeleton&&u.min&&u.max){const M=k.i.Fd[0].Hd(...u.min),E=k.i.Fd[1].Hd(...u.max);if(u.normalized&&5126!==u.componentType){let b=1;switch(u.componentType){case 5120:b=127;break;case 5121:b=255;break;case 5122:b=32767;break;case 5123:b=65535}const x=1/b;M.scaleInPlace(x),E.scaleInPlace(x)}n._boundingInfo=new j.d(M,E),n.useBoundingInfoFromGeometry=!0}n.setVerticesBuffer(M,u.count)}))),x==Z.g.MatricesIndicesExtraKind&&(b.numBoneInfluencers=8),J&&J(u)};return J("POSITION",Z.g.PositionKind),J("NORMAL",Z.g.NormalKind),J("TANGENT",Z.g.TangentKind),J("TEXCOORD_0",Z.g.UVKind),J("TEXCOORD_1",Z.g.UV2Kind),J("TEXCOORD_2",Z.g.UV3Kind),J("TEXCOORD_3",Z.g.UV4Kind),J("TEXCOORD_4",Z.g.UV5Kind),J("TEXCOORD_5",Z.g.UV6Kind),J("JOINTS_0",Z.g.MatricesIndicesKind),J("WEIGHTS_0",Z.g.MatricesWeightsKind),J("JOINTS_1",Z.g.MatricesIndicesExtraKind),J("WEIGHTS_1",Z.g.MatricesWeightsExtraKind),J("COLOR_0",Z.g.ColorKind,(M=>{"VEC4"===M.type&&(b.hasVertexAlpha=!0)})),Promise.all(g).then((()=>n))}_createMorphTargets(M,E,b,x,k){if(!x.targets||!this._parent.loadMorphTargets)return;if(void 0==E._numMorphTargets)E._numMorphTargets=x.targets.length;else if(x.targets.length!==E._numMorphTargets)throw new Error(`${M}: Primitives do not have the same number of targets`);const a=b.extras?b.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,k.morphTargetManager=new W(this._babylonScene),k.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,k.morphTargetManager.areUpdatesFrozen=!0;for(let g=0;g<x.targets.length;g++){const M=E.weights?E.weights[g]:b.weights?b.weights[g]:0,x=a?a[g]:`morphTarget${g}`;k.morphTargetManager.addTarget(new F(x,M,k.va()))}}_loadMorphTargetsAsync(M,E,b,x){if(!E.targets||!this._parent.loadMorphTargets)return Promise.resolve();const k=new Array,a=b.morphTargetManager;for(let g=0;g<a.numTargets;g++){const b=a.getTarget(g);k.push(this._loadMorphTargetVertexDataAsync(`${M}/targets/${g}`,x,E.targets[g],b))}return Promise.all(k).then((()=>{a.areUpdatesFrozen=!1}))}_loadMorphTargetVertexDataAsync(M,E,b,x){const k=new Array,a=(x,a,g)=>{if(void 0==b[x])return;const n=E.getVertexBuffer(a);if(!n)return;const J=e.Get(`${M}/${x}`,this._gltf.accessors,b[x]);k.push(this._loadFloatAccessorAsync(`/accessors/${J.index}`,J).then((M=>{g(n,M)})))};return a("POSITION",Z.g.PositionKind,((M,E)=>{const b=new Float32Array(E.length);M.forEach(E.length,((M,x)=>{b[x]=E[x]+M})),x.setPositions(b)})),a("NORMAL",Z.g.NormalKind,((M,E)=>{const b=new Float32Array(E.length);M.forEach(b.length,((M,x)=>{b[x]=E[x]+M})),x.setNormals(b)})),a("TANGENT",Z.g.TangentKind,((M,E)=>{const b=new Float32Array(E.length/3*4);let k=0;M.forEach(E.length/3*4,((M,x)=>{(x+1)%4!==0&&(b[k]=E[k]+M,k++)})),x.setTangents(b)})),Promise.all(k).then((()=>{}))}static _LoadTransform(M,E){if(void 0!=M.skin)return;let b=k.m.Zero(),x=k.e.Identity(),a=k.m.One();if(M.matrix){k.d.Id(M.matrix).decompose(a,x,b)}else M.translation&&(b=k.m.Id(M.translation)),M.rotation&&(x=k.e.Id(M.rotation)),M.scale&&(a=k.m.Id(M.scale));E.position=b,E.rotationQuaternion=x,E.ve=a}_loadSkinAsync(M,E,b,x){if(!this._parent.loadSkins)return Promise.resolve();const k=this._extensionsLoadSkinAsync(M,E,b);if(k)return k;if(b._data)return x(b._data.babylonSkeleton),b._data.promise;const a=`skeleton${b.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const g=new c(b.name||a,a,this._babylonScene);g._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(M,b,g);const n=this._loadSkinInverseBindMatricesDataAsync(M,b).then((M=>{this._updateBoneMatrices(g,M)}));return b._data={babylonSkeleton:g,promise:n},x(g),n}_loadBones(M,E,b){if(void 0==E.skeleton||this._parent.alwaysComputeSkeletonRootNode){const b=this._findSkeletonRootNode(`${M}/joints`,E.joints);if(b)if(void 0===E.skeleton)E.skeleton=b.index;else{const x=(M,E)=>{for(;E.parent;E=E.parent)if(E.parent===M)return!0;return!1},k=e.Get(`${M}/skeleton`,this._gltf.nodes,E.skeleton);k===b||x(k,b)||(B.d.Warn(`${M}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),E.skeleton=b.index)}else B.d.Warn(`${M}: Failed to find common root`)}const x={};for(const k of E.joints){const a=e.Get(`${M}/joints/${k}`,this._gltf.nodes,k);this._loadBone(a,E,b,x)}}_findSkeletonRootNode(M,E){if(0===E.length)return null;const b={};for(const k of E){const E=[];let x=e.Get(`${M}/${k}`,this._gltf.nodes,k);for(;-1!==x.index;)E.unshift(x),x=x.parent;b[k]=E}let x=null;for(let k=0;;++k){let M=b[E[0]];if(k>=M.length)return x;const a=M[k];for(let g=1;g<E.length;++g)if(M=b[E[g]],k>=M.length||a!==M[k])return x;x=a}}_loadBone(M,E,b,x){M._isJoint=!0;let k=x[M.index];if(k)return k;let a=null;M.index!==E.skeleton&&(M.parent&&-1!==M.parent.index?a=this._loadBone(M.parent,E,b,x):void 0!==E.skeleton&&B.d.Warn(`/skins/${E.index}/skeleton: Skeleton node is not a common root`));const g=E.joints.indexOf(M.index);return k=new u.b(M.name||`joint${M.index}`,b,a,this._getNodeMatrix(M),null,null,g),x[M.index]=k,this._postSceneLoadActions.push((()=>{k.linkTransformNode(M._babylonTransformNode)})),k}_loadSkinInverseBindMatricesDataAsync(M,E){if(void 0==E.inverseBindMatrices)return Promise.resolve(null);const b=e.Get(`${M}/inverseBindMatrices`,this._gltf.accessors,E.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${b.index}`,b)}_updateBoneMatrices(M,E){for(const b of M.bones){const M=k.d.Identity(),x=b._index;E&&-1!==x&&(k.d.FromArrayToRef(E,16*x,M),M.invertToRef(M));const a=b.getParent();a&&M.multiplyToRef(a.getAbsoluteInverseBindMatrix(),M),b.ne(M,!1,!1),b._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(M){return M.matrix?k.d.Id(M.matrix):k.d.Compose(M.scale?k.m.Id(M.scale):k.m.One(),M.rotation?k.e.Id(M.rotation):k.e.Identity(),M.translation?k.m.Id(M.translation):k.m.Zero())}loadCameraAsync(M,E){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const x=this._extensionsLoadCameraAsync(M,E,b);if(x)return x;const a=new Array;this.logOpen(`${M} ${E.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const g=new J.c(E.name||`camera${E.index}`,k.m.Zero(),this._babylonScene,!1);switch(g._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,g.ignoreParentScaling=!0,E._babylonCamera=g,g.rotation.set(0,Math.PI,0),E.type){case"perspective":{const b=E.perspective;if(!b)throw new Error(`${M}: Camera perspective properties are missing`);g.fov=b.yfov,g.bj=b.znear,g.maxZ=b.zfar||0;break}case"orthographic":if(!E.orthographic)throw new Error(`${M}: Camera orthographic properties are missing`);g.mode=n.c.ORTHOGRAPHIC_CAMERA,g.orthoLeft=-E.orthographic.xmag,g.orthoRight=E.orthographic.xmag,g.orthoBottom=-E.orthographic.ymag,g.orthoTop=E.orthographic.ymag,g.bj=E.orthographic.znear,g.maxZ=E.orthographic.zfar;break;default:throw new Error(`${M}: Invalid camera type (${E.type})`)}return Q.AddPointerMetadata(g,M),this._parent.onCameraLoadedObservable.notifyObservers(g),b(g),this.logClose(),Promise.all(a).then((()=>g))}_loadAnimationsAsync(){const M=this._gltf.animations;if(!M)return Promise.resolve();const E=new Array;for(let b=0;b<M.length;b++){const x=M[b];E.push(this.loadAnimationAsync(`/animations/${x.index}`,x).then((M=>{0===M.targetedAnimations.length&&M.dispose()})))}return Promise.all(E).then((()=>{}))}loadAnimationAsync(M,E){const x=this._extensionsLoadAnimationAsync(M,E);return x||b.e(43).then(b.bind(b,12814)).then((b=>{let{AnimationGroup:x}=b;this._babylonScene._blockEntityCollection=!!this._assetContainer;const k=new x(E.name||`animation${E.index}`,this._babylonScene);k._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,E._babylonAnimationGroup=k;const a=new Array;e.Assign(E.channels),e.Assign(E.samplers);for(const g of E.channels)a.push(this._loadAnimationChannelAsync(`${M}/channels/${g.index}`,M,E,g,((M,E)=>{M.animations=M.animations||[],M.animations.push(E),k.addTargetedAnimation(E,M)})));return Promise.all(a).then((()=>(k.normalize(0),k)))}))}_loadAnimationChannelAsync(M,E,b,x,k){const a=this._extensionsLoadAnimationChannelAsync(M,E,b,x,k);if(a)return a;if(void 0==x.target.node)return Promise.resolve();const g=e.Get(`${M}/target/node`,this._gltf.nodes,x.target.node),n=x.target.path,J="weights"===n;if(J&&!g._numMorphTargets||!J&&!g._babylonTransformNode)return Promise.resolve();if(!this._parent.loadNodeAnimations&&!J&&!g._isJoint)return Promise.resolve();let u;switch(n){case"translation":u=z.translation;break;case"rotation":u=z.rotation;break;case"scale":u=z.scale;break;case"weights":u=z.weights;break;default:throw new Error(`${M}/target/path: Invalid value (${x.target.path})`)}const T={object:g,info:u};return this._loadAnimationChannelFromTargetInfoAsync(M,E,b,x,T,k)}_loadAnimationChannelFromTargetInfoAsync(M,E,b,x,k,a){const g=this.parent.targetFps,n=1/g,J=e.Get(`${M}/sampler`,b.samplers,x.sampler);return this._loadAnimationSamplerAsync(`${E}/samplers/${x.sampler}`,J).then((M=>{let E=0;const J=k.object,u=k.info;for(const k of u){const u=k.getStride(J),T=M.input,V=M.output,I=new Array(T.length);let t=0;switch(M.interpolation){case"STEP":for(let M=0;M<T.length;M++){const E=k.getValue(J,V,t,1);t+=u,I[M]={frame:T[M]*g,value:E,interpolation:1}}break;case"CUBICSPLINE":for(let M=0;M<T.length;M++){const E=k.getValue(J,V,t,n);t+=u;const b=k.getValue(J,V,t,1);t+=u;const x=k.getValue(J,V,t,n);t+=u,I[M]={frame:T[M]*g,inTangent:E,value:b,outTangent:x}}break;case"LINEAR":for(let M=0;M<T.length;M++){const E=k.getValue(J,V,t,1);t+=u,I[M]={frame:T[M]*g,value:E}}}if(t>0){const M=`${b.name||`animation${b.index}`}_channel${x.index}_${E}`;k.buildAnimations(J,M,g,I,((M,b)=>{++E,a(M,b)}))}}}))}_loadAnimationSamplerAsync(M,E){if(E._data)return E._data;const b=E.interpolation||"LINEAR";switch(b){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${M}/interpolation: Invalid value (${E.interpolation})`)}const x=e.Get(`${M}/input`,this._gltf.accessors,E.input),k=e.Get(`${M}/output`,this._gltf.accessors,E.output);return E._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${x.index}`,x),this._loadFloatAccessorAsync(`/accessors/${k.index}`,k)]).then((M=>{let[E,x]=M;return{input:E,interpolation:b,output:x}})),E._data}loadBufferAsync(M,E,b,x){const k=this._extensionsLoadBufferAsync(M,E,b,x);if(k)return k;if(!E._data)if(E.uri)E._data=this.loadUriAsync(`${M}/uri`,E,E.uri);else{if(!this._bin)throw new Error(`${M}: Uri is missing or the binary glTF is missing its binary chunk`);E._data=this._bin.readAsync(0,E.byteLength)}return E._data.then((E=>{try{return new Uint8Array(E.buffer,E.byteOffset+b,x)}catch(k){throw new Error(`${M}: ${k.message}`)}}))}loadBufferViewAsync(M,E){const b=this._extensionsLoadBufferViewAsync(M,E);if(b)return b;if(E._data)return E._data;const x=e.Get(`${M}/buffer`,this._gltf.buffers,E.buffer);return E._data=this.loadBufferAsync(`/buffers/${x.index}`,x,E.byteOffset||0,E.byteLength),E._data}_loadAccessorAsync(M,E,b){if(E._data)return E._data;const x=Q._GetNumComponents(M,E.type),k=x*Z.g.GetTypeByteLength(E.componentType),a=x*E.count;if(void 0==E.bufferView)E._data=Promise.resolve(new b(a));else{const g=e.Get(`${M}/bufferView`,this._gltf.bufferViews,E.bufferView);E._data=this.loadBufferViewAsync(`/bufferViews/${g.index}`,g).then((n=>{if(5126!==E.componentType||E.normalized||g.byteStride&&g.byteStride!==k){const M=new b(a);return Z.g.ForEach(n,E.byteOffset||0,g.byteStride||k,x,E.componentType,M.length,E.normalized||!1,((E,b)=>{M[b]=E})),M}return Q._GetTypedArray(M,E.componentType,n,E.byteOffset,a)}))}if(E.sparse){const a=E.sparse;E._data=E._data.then((g=>{const n=g,J=e.Get(`${M}/sparse/indices/bufferView`,this._gltf.bufferViews,a.indices.bufferView),u=e.Get(`${M}/sparse/values/bufferView`,this._gltf.bufferViews,a.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${J.index}`,J),this.loadBufferViewAsync(`/bufferViews/${u.index}`,u)]).then((g=>{let[J,u]=g;const T=Q._GetTypedArray(`${M}/sparse/indices`,a.indices.componentType,J,a.indices.byteOffset,a.count),V=x*a.count;let I;if(5126!==E.componentType||E.normalized){const g=Q._GetTypedArray(`${M}/sparse/values`,E.componentType,u,a.values.byteOffset,V);I=new b(V),Z.g.ForEach(g,0,k,x,E.componentType,I.length,E.normalized||!1,((M,E)=>{I[E]=M}))}else I=Q._GetTypedArray(`${M}/sparse/values`,E.componentType,u,a.values.byteOffset,V);let t=0;for(let M=0;M<T.length;M++){let E=T[M]*x;for(let M=0;M<x;M++)n[E++]=I[t++]}return n}))}))}return E._data}_loadFloatAccessorAsync(M,E){return this._loadAccessorAsync(M,E,Float32Array)}_loadIndicesAccessorAsync(M,E){if("SCALAR"!==E.type)throw new Error(`${M}/type: Invalid value ${E.type}`);if(5121!==E.componentType&&5123!==E.componentType&&5125!==E.componentType)throw new Error(`${M}/componentType: Invalid value ${E.componentType}`);if(E._data)return E._data;if(E.sparse){const b=Q._GetTypedArrayConstructor(`${M}/componentType`,E.componentType);E._data=this._loadAccessorAsync(M,E,b)}else{const b=e.Get(`${M}/bufferView`,this._gltf.bufferViews,E.bufferView);E._data=this.loadBufferViewAsync(`/bufferViews/${b.index}`,b).then((b=>Q._GetTypedArray(M,E.componentType,b,E.byteOffset,E.count)))}return E._data}_loadVertexBufferViewAsync(M){if(M._babylonBuffer)return M._babylonBuffer;const E=this._babylonScene.getEngine();return M._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${M.index}`,M).then((M=>new Z.d(E,M,!1))),M._babylonBuffer}_loadVertexAccessorAsync(M,E,b){var x;if(null!==(x=E._babylonVertexBuffer)&&void 0!==x&&x[b])return E._babylonVertexBuffer[b];E._babylonVertexBuffer||(E._babylonVertexBuffer={});const k=this._babylonScene.getEngine();if(E.sparse||void 0==E.bufferView)E._babylonVertexBuffer[b]=this._loadFloatAccessorAsync(M,E).then((M=>new Z.g(k,M,b,!1)));else{const x=e.Get(`${M}/bufferView`,this._gltf.bufferViews,E.bufferView);E._babylonVertexBuffer[b]=this._loadVertexBufferViewAsync(x).then((a=>{const g=Q._GetNumComponents(M,E.type);return new Z.g(k,a,b,!1,void 0,x.byteStride,void 0,E.byteOffset,g,E.componentType,E.normalized,!0,void 0,!0)}))}return E._babylonVertexBuffer[b]}_loadMaterialMetallicRoughnessPropertiesAsync(M,E,b){if(!(b instanceof N))throw new Error(`${M}: Material type not supported`);const x=new Array;return E&&(E.baseColorFactor?(b.albedoColor=a.e.Id(E.baseColorFactor),b.alpha=E.baseColorFactor[3]):b.albedoColor=a.e.White(),b.metallic=void 0==E.metallicFactor?1:E.metallicFactor,b.roughness=void 0==E.roughnessFactor?1:E.roughnessFactor,E.baseColorTexture&&x.push(this.loadTextureInfoAsync(`${M}/baseColorTexture`,E.baseColorTexture,(M=>{M.name=`${b.name} (Base Color)`,b.albedoTexture=M}))),E.metallicRoughnessTexture&&(E.metallicRoughnessTexture.nonColorData=!0,x.push(this.loadTextureInfoAsync(`${M}/metallicRoughnessTexture`,E.metallicRoughnessTexture,(M=>{M.name=`${b.name} (Metallic Roughness)`,b.metallicTexture=M}))),b.useMetallnessFromMetallicTextureBlue=!0,b.useRoughnessFromMetallicTextureGreen=!0,b.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(x).then((()=>{}))}_loadMaterialAsync(M,E,b,x){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const a=this._extensionsLoadMaterialAsync(M,E,b,x,k);if(a)return a;E._data=E._data||{};let g=E._data[x];if(!g){this.logOpen(`${M} ${E.name||""}`);const b=this.createMaterial(M,E,x);g={babylonMaterial:b,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(M,E,b)},E._data[x]=g,Q.AddPointerMetadata(b,M),this._parent.onMaterialLoadedObservable.notifyObservers(b),this.logClose()}return b&&(g.babylonMeshes.push(b),b.Rd.addOnce((()=>{const M=g.babylonMeshes.indexOf(b);-1!==M&&g.babylonMeshes.splice(M,1)}))),k(g.babylonMaterial),g.promise.then((()=>g.babylonMaterial))}_createDefaultMaterial(M,E){this._babylonScene._blockEntityCollection=!!this._assetContainer;const b=new N(M,this._babylonScene);return b._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,b.fillMode=E,b.enableSpecularAntiAliasing=!0,b.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,b.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,b.transparencyMode=N.PBRMATERIAL_OPAQUE,b.metallic=1,b.roughness=1,b}createMaterial(M,E,b){const x=this._extensionsCreateMaterial(M,E,b);if(x)return x;const k=E.name||`material${E.index}`;return this._createDefaultMaterial(k,b)}loadMaterialPropertiesAsync(M,E,b){const x=this._extensionsLoadMaterialPropertiesAsync(M,E,b);if(x)return x;const k=new Array;return k.push(this.loadMaterialBasePropertiesAsync(M,E,b)),E.pbrMetallicRoughness&&k.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${M}/pbrMetallicRoughness`,E.pbrMetallicRoughness,b)),this.loadMaterialAlphaProperties(M,E,b),Promise.all(k).then((()=>{}))}loadMaterialBasePropertiesAsync(M,E,b){if(!(b instanceof N))throw new Error(`${M}: Material type not supported`);const x=new Array;return b.emissiveColor=E.emissiveFactor?a.e.Id(E.emissiveFactor):new a.e(0,0,0),E.doubleSided&&(b.je=!1,b.twoSidedLighting=!0),E.normalTexture&&(E.normalTexture.nonColorData=!0,x.push(this.loadTextureInfoAsync(`${M}/normalTexture`,E.normalTexture,(M=>{M.name=`${b.name} (Normal)`,b.bumpTexture=M}))),b.invertNormalMapX=!this._babylonScene.useRightHandedSystem,b.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=E.normalTexture.scale&&b.bumpTexture&&(b.bumpTexture.level=E.normalTexture.scale),b.forceIrradianceInFragment=!0),E.occlusionTexture&&(E.occlusionTexture.nonColorData=!0,x.push(this.loadTextureInfoAsync(`${M}/occlusionTexture`,E.occlusionTexture,(M=>{M.name=`${b.name} (Occlusion)`,b.ambientTexture=M}))),b.useAmbientInGrayScale=!0,void 0!=E.occlusionTexture.strength&&(b.ambientTextureStrength=E.occlusionTexture.strength)),E.emissiveTexture&&x.push(this.loadTextureInfoAsync(`${M}/emissiveTexture`,E.emissiveTexture,(M=>{M.name=`${b.name} (Emissive)`,b.emissiveTexture=M}))),Promise.all(x).then((()=>{}))}loadMaterialAlphaProperties(M,E,b){if(!(b instanceof N))throw new Error(`${M}: Material type not supported`);switch(E.alphaMode||"OPAQUE"){case"OPAQUE":b.transparencyMode=N.PBRMATERIAL_OPAQUE,b.alpha=1;break;case"MASK":b.transparencyMode=N.PBRMATERIAL_ALPHATEST,b.alphaCutOff=void 0==E.alphaCutoff?.5:E.alphaCutoff,b.albedoTexture&&(b.albedoTexture.bc=!0);break;case"BLEND":b.transparencyMode=N.PBRMATERIAL_ALPHABLEND,b.albedoTexture&&(b.albedoTexture.bc=!0,b.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${M}/alphaMode: Invalid value (${E.alphaMode})`)}}loadTextureInfoAsync(M,E){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const x=this._extensionsLoadTextureInfoAsync(M,E,b);if(x)return x;if(this.logOpen(`${M}`),E.texCoord>=6)throw new Error(`${M}/texCoord: Invalid value (${E.texCoord})`);const k=e.Get(`${M}/index`,this._gltf.textures,E.index);k._textureInfo=E;const a=this._loadTextureAsync(`/textures/${E.index}`,k,(x=>{x.coordinatesIndex=E.texCoord||0,Q.AddPointerMetadata(x,M),this._parent.onTextureLoadedObservable.notifyObservers(x),b(x)}));return this.logClose(),a}_loadTextureAsync(M,E){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const x=this._extensionsLoadTextureAsync(M,E,b);if(x)return x;this.logOpen(`${M} ${E.name||""}`);const k=void 0==E.sampler?Q.DefaultSampler:e.Get(`${M}/sampler`,this._gltf.samplers,E.sampler),a=e.Get(`${M}/source`,this._gltf.images,E.source),g=this._createTextureAsync(M,k,a,b,void 0,!E._textureInfo.nonColorData);return this.logClose(),g}_createTextureAsync(M,E,b){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},a=arguments.length>4?arguments[4]:void 0,g=arguments.length>5?arguments[5]:void 0;const n=this._loadSampler(`/samplers/${E.index}`,E),J=new Array,u=new x;this._babylonScene._blockEntityCollection=!!this._assetContainer;const T={noMipmap:n.noMipMaps,invertY:!1,samplingMode:n.samplingMode,X:()=>{this._disposed||u.resolve()},onError:(E,b)=>{this._disposed||u.reject(new Error(`${M}: ${b&&b.message?b.message:E||"Failed to load texture"}`))},mimeType:b.mimeType,loaderOptions:a,useSRGBBuffer:!!g&&this._parent.useSRGBBuffers},V=new K.e(null,this._babylonScene,T);return V._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,J.push(u.promise),J.push(this.loadImageAsync(`/images/${b.index}`,b).then((M=>{const E=b.uri||`${this._fileName}#image${b.index}`,x=`data:${this._uniqueRootUrl}${E}`;V.updateURL(x,M);const k=V.getInternalTexture();k&&(k.label=b.name)}))),V.wrapU=n.wrapU,V.wrapV=n.wrapV,k(V),this._parent.useGltfTextureNames&&(V.name=b.name||b.uri||`image${b.index}`),Promise.all(J).then((()=>V))}_loadSampler(M,E){return E._data||(E._data={noMipMaps:9728===E.minFilter||9729===E.minFilter,samplingMode:Q._GetTextureSamplingMode(M,E),wrapU:Q._GetTextureWrapMode(`${M}/wrapS`,E.wrapS),wrapV:Q._GetTextureWrapMode(`${M}/wrapT`,E.wrapT)}),E._data}loadImageAsync(M,E){if(!E._data){if(this.logOpen(`${M} ${E.name||""}`),E.uri)E._data=this.loadUriAsync(`${M}/uri`,E,E.uri);else{const b=e.Get(`${M}/bufferView`,this._gltf.bufferViews,E.bufferView);E._data=this.loadBufferViewAsync(`/bufferViews/${b.index}`,b)}this.logClose()}return E._data}loadUriAsync(M,E,b){const x=this._extensionsLoadUriAsync(M,E,b);if(x)return x;if(!Q._ValidateUri(b))throw new Error(`${M}: '${b}' is invalid`);if((0,o.h)(b)){const E=new Uint8Array((0,o.c)(b));return this.log(`${M}: Decoded ${b.substring(0,64)}... (${E.length} bytes)`),Promise.resolve(E)}return this.log(`${M}: Loading ${b}`),this._parent.preprocessUrlAsync(this._rootUrl+b).then((E=>new Promise(((x,k)=>{this._parent._loadFile(this._babylonScene,E,(E=>{this._disposed||(this.log(`${M}: Loaded ${b} (${E.byteLength} bytes)`),x(new Uint8Array(E)))}),!0,(E=>{k(new o.j(`${M}: Failed to load '${b}'${E?": "+E.status+" "+E.statusText:""}`,E))}))}))))}static AddPointerMetadata(M,E){M.metadata=M.metadata||{};const b=M._internalMetadata=M._internalMetadata||{},x=b.Yi=b.Yi||{};(x.pointers=x.pointers||[]).push(E)}static _GetTextureWrapMode(M,E){switch(E=void 0==E?10497:E){case 33071:return K.e.CLAMP_ADDRESSMODE;case 33648:return K.e.MIRROR_ADDRESSMODE;case 10497:return K.e.WRAP_ADDRESSMODE;default:return B.d.Warn(`${M}: Invalid value (${E})`),K.e.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(M,E){const b=void 0==E.magFilter?9729:E.magFilter,x=void 0==E.minFilter?9987:E.minFilter;if(9729===b)switch(x){case 9728:return K.e.LINEAR_NEAREST;case 9729:return K.e.LINEAR_LINEAR;case 9984:return K.e.LINEAR_NEAREST_MIPNEAREST;case 9985:return K.e.LINEAR_LINEAR_MIPNEAREST;case 9986:return K.e.LINEAR_NEAREST_MIPLINEAR;case 9987:return K.e.LINEAR_LINEAR_MIPLINEAR;default:return B.d.Warn(`${M}/minFilter: Invalid value (${x})`),K.e.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==b&&B.d.Warn(`${M}/magFilter: Invalid value (${b})`),x){case 9728:return K.e.NEAREST_NEAREST;case 9729:return K.e.NEAREST_LINEAR;case 9984:return K.e.NEAREST_NEAREST_MIPNEAREST;case 9985:return K.e.NEAREST_LINEAR_MIPNEAREST;case 9986:return K.e.NEAREST_NEAREST_MIPLINEAR;case 9987:return K.e.NEAREST_LINEAR_MIPLINEAR;default:return B.d.Warn(`${M}/minFilter: Invalid value (${x})`),K.e.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(M,E){switch(E){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`${M}: Invalid component type ${E}`)}}static _GetTypedArray(M,E,b,x,k){const a=b.buffer;x=b.byteOffset+(x||0);const g=Q._GetTypedArrayConstructor(`${M}/componentType`,E),n=Z.g.GetTypeByteLength(E);return x%n!==0?(B.d.Warn(`${M}: Copying buffer as byte offset (${x}) is not a multiple of component type byte length (${n})`),new g(a.slice(x,x+k*n),0)):new g(a,x,k)}static _GetNumComponents(M,E){switch(E){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${M}: Invalid type (${E})`)}static _ValidateUri(M){return g.e.IsBase64(M)||-1===M.indexOf("..")}static _GetDrawMode(M,E){switch(void 0==E&&(E=4),E){case 0:return C.e.PointListDrawMode;case 1:return C.e.LineListDrawMode;case 2:return C.e.LineLoopDrawMode;case 3:return C.e.LineStripDrawMode;case 4:return C.e.TriangleFillMode;case 5:return C.e.TriangleStripDrawMode;case 6:return C.e.TriangleFanDrawMode}throw new Error(`${M}: Invalid mesh primitive mode (${E})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const M=new Array;if(this._gltf.materials)for(const E of this._gltf.materials)if(E._data)for(const b in E._data){const x=E._data[b];for(const E of x.babylonMeshes){E.ce(!0);const b=x.babylonMaterial;M.push(b.forceCompilationAsync(E)),M.push(b.forceCompilationAsync(E,{useInstances:!0})),this._parent.useClipPlane&&(M.push(b.forceCompilationAsync(E,{clipPlane:!0})),M.push(b.forceCompilationAsync(E,{clipPlane:!0,useInstances:!0})))}}return Promise.all(M).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const M=new Array,E=this._babylonScene.lights;for(const b of E){const E=b.getShadowGenerator();E&&M.push(E.forceCompilationAsync())}return Promise.all(M).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(M){for(const E of this._extensions)E.enabled&&M(E)}_applyExtensions(M,E,b){for(const x of this._extensions)if(x.enabled){const k=`${x.name}.${E}`,a=M;a._activeLoaderExtensionFunctions=a._activeLoaderExtensionFunctions||{};const g=a._activeLoaderExtensionFunctions;if(!g[k]){g[k]=!0;try{const M=b(x);if(M)return M}finally{delete g[k]}}}return null}_extensionsOnLoading(){this._forEachExtensions((M=>M.onLoading&&M.onLoading()))}_extensionsOnReady(){this._forEachExtensions((M=>M.onReady&&M.onReady()))}_extensionsLoadSceneAsync(M,E){return this._applyExtensions(E,"loadScene",(b=>b.loadSceneAsync&&b.loadSceneAsync(M,E)))}_extensionsLoadNodeAsync(M,E,b){return this._applyExtensions(E,"loadNode",(x=>x.loadNodeAsync&&x.loadNodeAsync(M,E,b)))}_extensionsLoadCameraAsync(M,E,b){return this._applyExtensions(E,"loadCamera",(x=>x.loadCameraAsync&&x.loadCameraAsync(M,E,b)))}_extensionsLoadVertexDataAsync(M,E,b){return this._applyExtensions(E,"loadVertexData",(x=>x._loadVertexDataAsync&&x._loadVertexDataAsync(M,E,b)))}_extensionsLoadMeshPrimitiveAsync(M,E,b,x,k,a){return this._applyExtensions(k,"loadMeshPrimitive",(g=>g._loadMeshPrimitiveAsync&&g._loadMeshPrimitiveAsync(M,E,b,x,k,a)))}_extensionsLoadMaterialAsync(M,E,b,x,k){return this._applyExtensions(E,"loadMaterial",(a=>a._loadMaterialAsync&&a._loadMaterialAsync(M,E,b,x,k)))}_extensionsCreateMaterial(M,E,b){return this._applyExtensions(E,"createMaterial",(x=>x.createMaterial&&x.createMaterial(M,E,b)))}_extensionsLoadMaterialPropertiesAsync(M,E,b){return this._applyExtensions(E,"loadMaterialProperties",(x=>x.loadMaterialPropertiesAsync&&x.loadMaterialPropertiesAsync(M,E,b)))}_extensionsLoadTextureInfoAsync(M,E,b){return this._applyExtensions(E,"loadTextureInfo",(x=>x.loadTextureInfoAsync&&x.loadTextureInfoAsync(M,E,b)))}_extensionsLoadTextureAsync(M,E,b){return this._applyExtensions(E,"loadTexture",(x=>x._loadTextureAsync&&x._loadTextureAsync(M,E,b)))}_extensionsLoadAnimationAsync(M,E){return this._applyExtensions(E,"loadAnimation",(b=>b.loadAnimationAsync&&b.loadAnimationAsync(M,E)))}_extensionsLoadAnimationChannelAsync(M,E,b,x,k){return this._applyExtensions(b,"loadAnimationChannel",(a=>a._loadAnimationChannelAsync&&a._loadAnimationChannelAsync(M,E,b,x,k)))}_extensionsLoadSkinAsync(M,E,b){return this._applyExtensions(b,"loadSkin",(x=>x._loadSkinAsync&&x._loadSkinAsync(M,E,b)))}_extensionsLoadUriAsync(M,E,b){return this._applyExtensions(E,"loadUri",(x=>x._loadUriAsync&&x._loadUriAsync(M,E,b)))}_extensionsLoadBufferViewAsync(M,E){return this._applyExtensions(E,"loadBufferView",(b=>b.loadBufferViewAsync&&b.loadBufferViewAsync(M,E)))}_extensionsLoadBufferAsync(M,E,b,x){return this._applyExtensions(E,"loadBuffer",(k=>k.loadBufferAsync&&k.loadBufferAsync(M,E,b,x)))}static LoadExtensionAsync(M,E,b,x){if(!E.extensions)return null;const k=E.extensions[b];return k?x(`${M}/extensions/${b}`,k):null}static LoadExtraAsync(M,E,b,x){if(!E.extras)return null;const k=E.extras[b];return k?x(`${M}/extras/${b}`,k):null}isExtensionUsed(M){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(M)}logOpen(M){this._parent._logOpen(M)}logClose(){this._parent._logClose()}log(M){this._parent._log(M)}startPerformanceCounter(M){this._parent._startPerformanceCounter(M)}endPerformanceCounter(M){this._parent._endPerformanceCounter(M)}}Q.DefaultSampler={index:-1},m.d._CreateGLTF2Loader=M=>new Q(M);var L=b(1499),f=b(10488),MM=b(12164);class EM extends MM.e{constructor(M,E,b){let x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],g=arguments.length>6&&void 0!==arguments[6]&&arguments[6],n=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,J=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",M),this._texture=M.getEngine().createRawCubeTexture(E,b,x,k,a,g,n,J)}update(M,E,b,x){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,M,E,b,x,k)}updateRGBDAsync(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,f.k)(this._texture,M,E,b,x).then((()=>{}))}clone(){return v.b.Clone((()=>{const M=this.va(),E=this._texture,b=new EM(M,E._bufferViewArray,E.width,E.format,E.type,E.generateMipMaps,E.invertY,E.samplingMode,E._compression);return 13===E.source&&b.updateRGBDAsync(E._bufferViewArrayArray,E._sphericalPolynomial,E._lodGenerationScale,E._lodGenerationOffset),b}),this)}}const bM="EXT_lights_image_based";class xM{constructor(M){this.name=bM,this._loader=M,this.enabled=this._loader.isExtensionUsed(bM)}dispose(){this._loader=null,delete this._lights}onLoading(){const M=this._loader.Yi.extensions;if(M&&M[this.name]){const E=M[this.name];this._lights=E.lights}}loadSceneAsync(M,E){return Q.LoadExtensionAsync(M,E,this.name,((b,x)=>{this._loader._allMaterialsDirtyRequired=!0;const k=new Array;k.push(this._loader.loadSceneAsync(M,E)),this._loader.logOpen(`${b}`);const a=e.Get(`${b}/light`,this._lights,x.fb);return k.push(this._loadLightAsync(`/extensions/${this.name}/lights/${x.fb}`,a).then((M=>{this._loader.babylonScene.environmentTexture=M}))),this._loader.logClose(),Promise.all(k).then((()=>{}))}))}_loadLightAsync(M,E){if(!E._loaded){const b=new Array;this._loader.logOpen(`${M}`);const x=new Array(E.specularImages.length);for(let k=0;k<E.specularImages.length;k++){const a=E.specularImages[k];x[k]=new Array(a.length);for(let E=0;E<a.length;E++){const g=`${M}/specularImages/${k}/${E}`;this._loader.logOpen(`${g}`);const n=a[E],J=e.Get(g,this._loader.Yi.images,n);b.push(this._loader.loadImageAsync(`/images/${n}`,J).then((M=>{x[k][E]=M}))),this._loader.logClose()}}this._loader.logClose(),E._loaded=Promise.all(b).then((()=>{const b=new EM(this._loader.babylonScene,null,E.specularImageSize);if(b.name=E.name||"environment",E._babylonTexture=b,void 0!=E.fj&&(b.level=E.fj),E.rotation){let M=k.e.Id(E.rotation);this._loader.babylonScene.useRightHandedSystem||(M=k.e.Inverse(M)),k.d.FromQuaternionToRef(M,b.getReflectionTextureMatrix())}if(!E.irradianceCoefficients)throw new Error(`${M}: Irradiance coefficients are missing`);const a=L.c.Id(E.irradianceCoefficients);a.scaleInPlace(E.fj),a.convertIrradianceToLambertianRadiance();const g=L.d.FromHarmonics(a),n=(x.length-1)/Math.log2(E.specularImageSize);return b.updateRGBDAsync(x,g,n)}))}return E._loaded.then((()=>E._babylonTexture))}}G(bM),i(bM,!0,(M=>new xM(M)));b(12172);const kM="EXT_mesh_gpu_instancing";class aM{constructor(M){this.name=kM,this._loader=M,this.enabled=this._loader.isExtensionUsed(kM)}dispose(){this._loader=null}loadNodeAsync(M,E,b){return Q.LoadExtensionAsync(M,E,this.name,((M,x)=>{this._loader._disableInstancedMesh++;const a=this._loader.loadNodeAsync(`/nodes/${E.index}`,E,b);if(this._loader._disableInstancedMesh--,!E._primitiveBabylonMeshes)return a;const g=new Array;let n=0;const J=E=>{if(void 0==x.attributes[E])return void g.push(Promise.resolve(null));const b=e.Get(`${M}/attributes/${E}`,this._loader.Yi.accessors,x.attributes[E]);if(g.push(this._loader._loadFloatAccessorAsync(`/accessors/${b.bufferView}`,b)),0===n)n=b.count;else if(n!==b.count)throw new Error(`${M}/attributes: Instance buffer accessors do not have the same count.`)};return J("TRANSLATION"),J("ROTATION"),J("SCALE"),a.then((M=>Promise.all(g).then((b=>{let[x,a,g]=b;const J=new Float32Array(16*n);k.i.Fd[0].Hd(0,0,0),k.i.Quaternion[0].Hd(0,0,0,1),k.i.Fd[1].Hd(1,1,1);for(let M=0;M<n;++M)x&&k.m.FromArrayToRef(x,3*M,k.i.Fd[0]),a&&k.e.FromArrayToRef(a,4*M,k.i.Quaternion[0]),g&&k.m.FromArrayToRef(g,3*M,k.i.Fd[1]),k.d.ComposeToRef(k.i.Fd[1],k.i.Quaternion[0],k.i.Fd[0],k.i.Matrix[0]),k.i.Matrix[0].copyToArray(J,16*M);for(const M of E._primitiveBabylonMeshes)M.Oj("matrix",J,16,!0);return M}))))}))}}G(kM),i(kM,!0,(M=>new aM(M)));class gM{static get Default(){return gM._Default||(gM._Default=new gM),gM._Default}constructor(){const M=gM.Configuration.decoder;this._decoderModulePromise=g.e.LoadBabylonScriptAsync(M.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}decodeGltfBufferAsync(M,E,b,x,k){return this._decoderModulePromise.then((async()=>{MeshoptDecoder.useWorkers(1);const a=await MeshoptDecoder.decodeGltfBufferAsync(E,b,M,x,k);return MeshoptDecoder.useWorkers(0),a}))}}gM.Configuration={decoder:{url:`${g.e._DefaultCdnUrl}/meshopt_decoder.js`}},gM._Default=null;const nM="EXT_meshopt_compression";class JM{constructor(M){this.name=nM,this.enabled=M.isExtensionUsed(nM),this._loader=M}dispose(){this._loader=null}loadBufferViewAsync(M,E){return Q.LoadExtensionAsync(M,E,this.name,((b,x)=>{const k=E;if(k._meshOptData)return k._meshOptData;const a=e.Get(`${M}/buffer`,this._loader.Yi.buffers,x.buffer);return k._meshOptData=this._loader.loadBufferAsync(`/buffers/${a.index}`,a,x.byteOffset||0,x.byteLength).then((M=>gM.Default.decodeGltfBufferAsync(M,x.count,x.byteStride,x.mode,x.filter))),k._meshOptData}))}}G(nM),i(nM,!0,(M=>new JM(M)));const uM="EXT_texture_webp";class TM{constructor(M){this.name=uM,this._loader=M,this.enabled=M.isExtensionUsed(uM)}dispose(){this._loader=null}_loadTextureAsync(M,E,b){return Q.LoadExtensionAsync(M,E,this.name,((x,k)=>{const a=void 0==E.sampler?Q.DefaultSampler:e.Get(`${M}/sampler`,this._loader.Yi.samplers,E.sampler),g=e.Get(`${x}/source`,this._loader.Yi.images,k.source);return this._loader._createTextureAsync(M,a,g,(M=>{b(M)}),void 0,!E._textureInfo.nonColorData)}))}}G(uM),i(uM,!0,(M=>new TM(M)));const VM="EXT_texture_avif";class IM{constructor(M){this.name=VM,this._loader=M,this.enabled=M.isExtensionUsed(VM)}dispose(){this._loader=null}_loadTextureAsync(M,E,b){return Q.LoadExtensionAsync(M,E,this.name,((x,k)=>{const a=void 0==E.sampler?Q.DefaultSampler:e.Get(`${M}/sampler`,this._loader.Yi.samplers,E.sampler),g=e.Get(`${x}/source`,this._loader.Yi.images,k.source);return this._loader._createTextureAsync(M,a,g,(M=>{b(M)}),void 0,!E._textureInfo.nonColorData)}))}}G(VM),i(VM,!0,(M=>new IM(M)));var tM=b(12181);const yM="KHR_draco_mesh_compression";class BM{constructor(M){this.name=yM,this.useNormalizedFlagFromAccessor=!0,this._loader=M,this.enabled=tM.e.DecoderAvailable&&this._loader.isExtensionUsed(yM)}dispose(){delete this.dracoCompression,this._loader=null}_loadVertexDataAsync(M,E,b){return Q.LoadExtensionAsync(M,E,this.name,((x,k)=>{if(void 0!=E.mode&&4!==E.mode&&5!==E.mode)throw new Error(`${M}: Unsupported mode ${E.mode}`);const a={},g={},n=(M,x)=>{const n=k.attributes[M];if(void 0!=n&&(b._delayInfo=b._delayInfo||[],-1===b._delayInfo.indexOf(x)&&b._delayInfo.push(x),a[x]=n,this.useNormalizedFlagFromAccessor)){const b=e.TryGet(this._loader.Yi.accessors,E.attributes[M]);b&&(g[x]=b.normalized||!1)}};n("POSITION",Z.g.PositionKind),n("NORMAL",Z.g.NormalKind),n("TANGENT",Z.g.TangentKind),n("TEXCOORD_0",Z.g.UVKind),n("TEXCOORD_1",Z.g.UV2Kind),n("TEXCOORD_2",Z.g.UV3Kind),n("TEXCOORD_3",Z.g.UV4Kind),n("TEXCOORD_4",Z.g.UV5Kind),n("TEXCOORD_5",Z.g.UV6Kind),n("JOINTS_0",Z.g.MatricesIndicesKind),n("WEIGHTS_0",Z.g.MatricesWeightsKind),n("COLOR_0",Z.g.ColorKind);const J=e.Get(x,this._loader.Yi.bufferViews,k.bufferView);return J._dracoBabylonGeometry||(J._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${J.index}`,J).then((E=>(this.dracoCompression||tM.e.Default)._decodeMeshToGeometryForGltfAsync(b.name,this._loader.babylonScene,E,a,g).catch((E=>{throw new Error(`${M}: ${E.message}`)}))))),J._dracoBabylonGeometry}))}}G(yM),i(yM,!0,(M=>new BM(M)));var rM=b(12187),cM=b(11554),CM=b(12152),RM=b(12194);cM.d.AddNodeConstructor("Light_Type_0",((M,E)=>()=>new wM(M,k.m.Zero(),E)));class wM extends RM.b{get shadowAngle(){return this._shadowAngle}set shadowAngle(M){this._shadowAngle=M,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(M){const E=this.needCube();if(this._direction=M,this.needCube()!==E&&this._shadowGenerators){const M=this._shadowGenerators.values();for(let E=M.next();!0!==E.done;E=M.next()){E.value.recreateShadowMap()}}}constructor(M,E,b){super(M,b),this._shadowAngle=Math.PI/2,this.position=E}getClassName(){return"PointLight"}getTypeID(){return CM.e.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(M){if(this.direction)return super.getShadowDirection(M);switch(M){case 0:return new k.m(1,0,0);case 1:return new k.m(-1,0,0);case 2:return new k.m(0,-1,0);case 3:return new k.m(0,1,0);case 4:return new k.m(0,0,1);case 5:return new k.m(0,0,-1)}return k.m.Zero()}_setDefaultShadowProjectionMatrix(M,E,b){const x=this.va().activeCamera;if(!x)return;const a=void 0!==this.shadowMinZ?this.shadowMinZ:x.bj,g=void 0!==this.shadowMaxZ?this.shadowMaxZ:x.maxZ,n=this.va().getEngine().useReverseDepthBuffer;k.d.PerspectiveFovLHToRef(this.shadowAngle,1,n?g:a,n?a:g,M,!0,this._scene.getEngine().isNDCHalfZRange,void 0,n)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(M,E){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,E):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,E),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,E),this}transferToNodeMaterialEffect(M,E){return this.computeTransformedInformation()?M.setFloat3(E,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):M.setFloat3(E,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(M,E){M["POINTLIGHT"+E]=!0}}(0,R.d)([(0,w.E)()],wM.prototype,"shadowAngle",null),(0,U.h)("BABYLON.PointLight",wM),cM.d.AddNodeConstructor("Light_Type_2",((M,E)=>()=>new SM(M,k.m.Zero(),k.m.Zero(),0,0,E)));class SM extends RM.b{get angle(){return this._angle}set angle(M){this._angle=M,this._cosHalfAngle=Math.cos(.5*M),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(M){this._innerAngle=M,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(M){this._shadowAngleScale=M,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(M){this._projectionTextureLightNear=M,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(M){this._projectionTextureLightFar=M,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(M){this._projectionTextureUpDirection=M,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(M){this._projectionTexture!==M&&(this._projectionTexture=M,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(SM._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):SM._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(M){return void 0!==M.onGeneratedObservable}static _IsTexture(M){return void 0!==M.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(M){this._projectionTextureProjectionLightMatrix=M,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(M,E,b,x,a,g){super(M,g),this._innerAngle=0,this._projectionTextureMatrix=k.d.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=k.m.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=k.m.Zero(),this._projectionTextureViewLightMatrix=k.d.Zero(),this._projectionTextureProjectionLightMatrix=k.d.Zero(),this._projectionTextureScalingMatrix=k.d.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=E,this.direction=b,this.angle=x,this.exponent=a}getClassName(){return"SpotLight"}getTypeID(){return CM.e.LIGHTTYPEID_SPOTLIGHT}_setDirection(M){super._setDirection(M),this._projectionTextureViewLightDirty=!0}_setPosition(M){super._setPosition(M),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(M,E,b){const x=this.va().activeCamera;if(!x)return;this._shadowAngleScale=this._shadowAngleScale||1;const a=this._shadowAngleScale*this._angle,g=void 0!==this.shadowMinZ?this.shadowMinZ:x.bj,n=void 0!==this.shadowMaxZ?this.shadowMaxZ:x.maxZ,J=this.va().getEngine().useReverseDepthBuffer;k.d.PerspectiveFovLHToRef(a,1,J?n:g,J?g:n,M,!0,this._scene.getEngine().isNDCHalfZRange,void 0,J)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),k.d.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const M=this.projectionTextureLightFar,E=this.projectionTextureLightNear,b=M/(M-E),x=-b*E,a=1/Math.tan(this._angle/2);k.d.FromValuesToRef(a/1,0,0,0,0,a,0,0,0,0,b,1,0,0,x,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof K.e){const M=this._projectionTexture.uScale/2,E=this._projectionTexture.vScale/2;k.d.FromValuesToRef(M,0,0,0,0,E,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(M,E){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),M.setMatrix("textureProjectionMatrix"+E,this._projectionTextureMatrix),M.setTexture("projectionLightTexture"+E,this.projectionTexture)),this}transferToEffect(M,E){let b;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,E),b=k.m.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,E),b=k.m.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",b.x,b.y,b.z,this._cosHalfAngle,E),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,E),this}transferToNodeMaterialEffect(M,E){let b;return b=this.computeTransformedInformation()?k.m.Normalize(this.transformedDirection):k.m.Normalize(this.direction),this.va().useRightHandedSystem?M.setFloat3(E,-b.x,-b.y,-b.z):M.setFloat3(E,b.x,b.y,b.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose()}getDepthMinZ(M){const E=this._scene.getEngine(),b=void 0!==this.shadowMinZ?this.shadowMinZ:M.bj;return E.useReverseDepthBuffer&&E.isNDCHalfZRange?b:this._scene.getEngine().isNDCHalfZRange?0:b}getDepthMaxZ(M){const E=this._scene.getEngine(),b=void 0!==this.shadowMaxZ?this.shadowMaxZ:M.maxZ;return E.useReverseDepthBuffer&&E.isNDCHalfZRange?0:b}prepareLightSpecificDefines(M,E){M["SPOTLIGHT"+E]=!0,M["PROJECTEDLIGHTTEXTURE"+E]=!(!this.projectionTexture||!this.projectionTexture.isReady())}}(0,R.d)([(0,w.E)()],SM.prototype,"angle",null),(0,R.d)([(0,w.E)()],SM.prototype,"innerAngle",null),(0,R.d)([(0,w.E)()],SM.prototype,"shadowAngleScale",null),(0,R.d)([(0,w.E)()],SM.prototype,"exponent",void 0),(0,R.d)([(0,w.E)()],SM.prototype,"projectionTextureLightNear",null),(0,R.d)([(0,w.E)()],SM.prototype,"projectionTextureLightFar",null),(0,R.d)([(0,w.E)()],SM.prototype,"projectionTextureUpDirection",null),(0,R.d)([(0,w.A)("projectedLightTexture")],SM.prototype,"_projectionTexture",void 0),(0,U.h)("BABYLON.SpotLight",SM);const XM="KHR_lights_punctual";class UM{constructor(M){this.name=XM,this._loader=M,this.enabled=this._loader.isExtensionUsed(XM)}dispose(){this._loader=null,delete this._lights}onLoading(){const M=this._loader.Yi.extensions;if(M&&M[this.name]){const E=M[this.name];this._lights=E.lights,e.Assign(this._lights)}}loadNodeAsync(M,E,b){return Q.LoadExtensionAsync(M,E,this.name,((x,g)=>(this._loader._allMaterialsDirtyRequired=!0,this._loader.loadNodeAsync(M,E,(M=>{let E;const n=e.Get(x,this._lights,g.fb),J=n.name||M.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,n.type){case"directional":{const M=new rM.d(J,k.m.Backward(),this._loader.babylonScene);M.position.Kd(0),E=M;break}case"point":E=new wM(J,k.m.Zero(),this._loader.babylonScene);break;case"spot":{const M=new SM(J,k.m.Zero(),k.m.Backward(),0,1,this._loader.babylonScene);M.angle=2*(n.spot&&n.spot.outerConeAngle||Math.PI/4),M.innerAngle=2*(n.spot&&n.spot.innerConeAngle||0),E=M;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${x}: Invalid light type (${n.type})`)}E._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,n._babylonLight=E,E.falloffType=CM.e.FALLOFF_GLTF,E.Nh=n.color?a.e.Id(n.color):a.e.White(),E.fj=void 0==n.fj?1:n.fj,E.range=void 0==n.range?Number.MAX_VALUE:n.range,E.parent=M,this._loader._babylonLights.push(E),Q.AddPointerMetadata(E,x),b(M)})))))}}G(XM),i(XM,!0,(M=>new UM(M)));const vM="KHR_materials_pbrSpecularGlossiness";class NM{constructor(M){this.name=vM,this.order=200,this._loader=M,this.enabled=this._loader.isExtensionUsed(vM)}dispose(){this._loader=null}loadMaterialPropertiesAsync(M,E,b){return Q.LoadExtensionAsync(M,E,this.name,((x,k)=>{const a=new Array;return a.push(this._loader.loadMaterialBasePropertiesAsync(M,E,b)),a.push(this._loadSpecularGlossinessPropertiesAsync(x,k,b)),this._loader.loadMaterialAlphaProperties(M,E,b),Promise.all(a).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(M,E,b){if(!(b instanceof N))throw new Error(`${M}: Material type not supported`);const x=new Array;return b.metallic=null,b.roughness=null,E.diffuseFactor?(b.albedoColor=a.e.Id(E.diffuseFactor),b.alpha=E.diffuseFactor[3]):b.albedoColor=a.e.White(),b.reflectivityColor=E.specularFactor?a.e.Id(E.specularFactor):a.e.White(),b.microSurface=void 0==E.glossinessFactor?1:E.glossinessFactor,E.diffuseTexture&&x.push(this._loader.loadTextureInfoAsync(`${M}/diffuseTexture`,E.diffuseTexture,(M=>{M.name=`${b.name} (Diffuse)`,b.albedoTexture=M}))),E.specularGlossinessTexture&&(x.push(this._loader.loadTextureInfoAsync(`${M}/specularGlossinessTexture`,E.specularGlossinessTexture,(M=>{M.name=`${b.name} (Specular Glossiness)`,b.reflectivityTexture=M,b.reflectivityTexture.bc=!0}))),b.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(x).then((()=>{}))}}G(vM),i(vM,!0,(M=>new NM(M)));const KM="KHR_materials_unlit";class hM{constructor(M){this.name=KM,this.order=210,this._loader=M,this.enabled=this._loader.isExtensionUsed(KM)}dispose(){this._loader=null}loadMaterialPropertiesAsync(M,E,b){return Q.LoadExtensionAsync(M,E,this.name,(()=>this._loadUnlitPropertiesAsync(M,E,b)))}_loadUnlitPropertiesAsync(M,E,b){if(!(b instanceof N))throw new Error(`${M}: Material type not supported`);const x=new Array;b.unlit=!0;const k=E.pbrMetallicRoughness;return k&&(k.baseColorFactor?(b.albedoColor=a.e.Id(k.baseColorFactor),b.alpha=k.baseColorFactor[3]):b.albedoColor=a.e.White(),k.baseColorTexture&&x.push(this._loader.loadTextureInfoAsync(`${M}/baseColorTexture`,k.baseColorTexture,(M=>{M.name=`${b.name} (Base Color)`,b.albedoTexture=M})))),E.doubleSided&&(b.je=!1,b.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(M,E,b),Promise.all(x).then((()=>{}))}}G(KM),i(KM,!0,(M=>new hM(M)));const ZM="KHR_materials_clearcoat";class OM{constructor(M){this.name=ZM,this.order=190,this._loader=M,this.enabled=this._loader.isExtensionUsed(ZM)}dispose(){this._loader=null}loadMaterialPropertiesAsync(M,E,b){return Q.LoadExtensionAsync(M,E,this.name,((x,k)=>{const a=new Array;return a.push(this._loader.loadMaterialPropertiesAsync(M,E,b)),a.push(this._loadClearCoatPropertiesAsync(x,k,b)),Promise.all(a).then((()=>{}))}))}_loadClearCoatPropertiesAsync(M,E,b){if(!(b instanceof N))throw new Error(`${M}: Material type not supported`);const x=new Array;return b.clearCoat.isEnabled=!0,b.clearCoat.useRoughnessFromMainTexture=!1,b.clearCoat.remapF0OnInterfaceChange=!1,void 0!=E.clearcoatFactor?b.clearCoat.fj=E.clearcoatFactor:b.clearCoat.fj=0,E.clearcoatTexture&&x.push(this._loader.loadTextureInfoAsync(`${M}/clearcoatTexture`,E.clearcoatTexture,(M=>{M.name=`${b.name} (ClearCoat)`,b.clearCoat.texture=M}))),void 0!=E.clearcoatRoughnessFactor?b.clearCoat.roughness=E.clearcoatRoughnessFactor:b.clearCoat.roughness=0,E.clearcoatRoughnessTexture&&(E.clearcoatRoughnessTexture.nonColorData=!0,x.push(this._loader.loadTextureInfoAsync(`${M}/clearcoatRoughnessTexture`,E.clearcoatRoughnessTexture,(M=>{M.name=`${b.name} (ClearCoat Roughness)`,b.clearCoat.textureRoughness=M})))),E.clearcoatNormalTexture&&(E.clearcoatNormalTexture.nonColorData=!0,x.push(this._loader.loadTextureInfoAsync(`${M}/clearcoatNormalTexture`,E.clearcoatNormalTexture,(M=>{M.name=`${b.name} (ClearCoat Normal)`,b.clearCoat.bumpTexture=M}))),b.invertNormalMapX=!b.va().useRightHandedSystem,b.invertNormalMapY=b.va().useRightHandedSystem,void 0!=E.clearcoatNormalTexture.scale&&(b.clearCoat.bumpTexture.level=E.clearcoatNormalTexture.scale)),Promise.all(x).then((()=>{}))}}G(ZM),i(ZM,!0,(M=>new OM(M)));const pM="KHR_materials_iridescence";class PM{constructor(M){this.name=pM,this.order=195,this._loader=M,this.enabled=this._loader.isExtensionUsed(pM)}dispose(){this._loader=null}loadMaterialPropertiesAsync(M,E,b){return Q.LoadExtensionAsync(M,E,this.name,((x,k)=>{const a=new Array;return a.push(this._loader.loadMaterialPropertiesAsync(M,E,b)),a.push(this._loadIridescencePropertiesAsync(x,k,b)),Promise.all(a).then((()=>{}))}))}_loadIridescencePropertiesAsync(M,E,b){if(!(b instanceof N))throw new Error(`${M}: Material type not supported`);const x=new Array;return b.iridescence.isEnabled=!0,b.iridescence.fj=E.iridescenceFactor??0,b.iridescence.indexOfRefraction=E.iridescenceIor??E.iridescenceIOR??1.3,b.iridescence.minimumThickness=E.iridescenceThicknessMinimum??100,b.iridescence.maximumThickness=E.iridescenceThicknessMaximum??400,E.iridescenceTexture&&x.push(this._loader.loadTextureInfoAsync(`${M}/iridescenceTexture`,E.iridescenceTexture,(M=>{M.name=`${b.name} (Iridescence)`,b.iridescence.texture=M}))),E.iridescenceThicknessTexture&&x.push(this._loader.loadTextureInfoAsync(`${M}/iridescenceThicknessTexture`,E.iridescenceThicknessTexture,(M=>{M.name=`${b.name} (Iridescence Thickness)`,b.iridescence.thicknessTexture=M}))),Promise.all(x).then((()=>{}))}}G(pM),i(pM,!0,(M=>new PM(M)));const FM="KHR_materials_anisotropy";class lM{constructor(M){this.name=FM,this.order=195,this._loader=M,this.enabled=this._loader.isExtensionUsed(FM)}dispose(){this._loader=null}loadMaterialPropertiesAsync(M,E,b){return Q.LoadExtensionAsync(M,E,this.name,((x,k)=>{const a=new Array;return a.push(this._loader.loadMaterialPropertiesAsync(M,E,b)),a.push(this._loadIridescencePropertiesAsync(x,k,b)),Promise.all(a).then((()=>{}))}))}_loadIridescencePropertiesAsync(M,E,b){if(!(b instanceof N))throw new Error(`${M}: Material type not supported`);const x=new Array;return b.anisotropy.isEnabled=!0,b.anisotropy.fj=E.anisotropyStrength??0,b.anisotropy.angle=E.anisotropyRotation??0,E.anisotropyTexture&&(E.anisotropyTexture.nonColorData=!0,x.push(this._loader.loadTextureInfoAsync(`${M}/anisotropyTexture`,E.anisotropyTexture,(M=>{M.name=`${b.name} (Anisotropy Intensity)`,b.anisotropy.texture=M})))),Promise.all(x).then((()=>{}))}}G(FM),i(FM,!0,(M=>new lM(M)));const dM="KHR_materials_emissive_strength";class WM{constructor(M){this.name=dM,this.order=170,this._loader=M,this.enabled=this._loader.isExtensionUsed(dM)}dispose(){this._loader=null}loadMaterialPropertiesAsync(M,E,b){return Q.LoadExtensionAsync(M,E,this.name,((x,k)=>this._loader.loadMaterialPropertiesAsync(M,E,b).then((()=>{this._loadEmissiveProperties(x,k,b)}))))}_loadEmissiveProperties(M,E,b){if(!(b instanceof N))throw new Error(`${M}: Material type not supported`);void 0!==E.emissiveStrength&&(b.emissiveIntensity=E.emissiveStrength)}}G(dM),i(dM,!0,(M=>new WM(M)));const mM="KHR_materials_sheen";class oM{constructor(M){this.name=mM,this.order=190,this._loader=M,this.enabled=this._loader.isExtensionUsed(mM)}dispose(){this._loader=null}loadMaterialPropertiesAsync(M,E,b){return Q.LoadExtensionAsync(M,E,this.name,((x,k)=>{const a=new Array;return a.push(this._loader.loadMaterialPropertiesAsync(M,E,b)),a.push(this._loadSheenPropertiesAsync(x,k,b)),Promise.all(a).then((()=>{}))}))}_loadSheenPropertiesAsync(M,E,b){if(!(b instanceof N))throw new Error(`${M}: Material type not supported`);const x=new Array;return b.sheen.isEnabled=!0,b.sheen.fj=1,void 0!=E.sheenColorFactor?b.sheen.color=a.e.Id(E.sheenColorFactor):b.sheen.color=a.e.Black(),E.sheenColorTexture&&x.push(this._loader.loadTextureInfoAsync(`${M}/sheenColorTexture`,E.sheenColorTexture,(M=>{M.name=`${b.name} (Sheen Color)`,b.sheen.texture=M}))),void 0!==E.sheenRoughnessFactor?b.sheen.roughness=E.sheenRoughnessFactor:b.sheen.roughness=0,E.sheenRoughnessTexture&&(E.sheenRoughnessTexture.nonColorData=!0,x.push(this._loader.loadTextureInfoAsync(`${M}/sheenRoughnessTexture`,E.sheenRoughnessTexture,(M=>{M.name=`${b.name} (Sheen Roughness)`,b.sheen.textureRoughness=M})))),b.sheen.albedoScaling=!0,b.sheen.useRoughnessFromMainTexture=!1,Promise.all(x).then((()=>{}))}}G(mM),i(mM,!0,(M=>new oM(M)));const jM="KHR_materials_specular";class sM{constructor(M){this.name=jM,this.order=190,this._loader=M,this.enabled=this._loader.isExtensionUsed(jM)}dispose(){this._loader=null}loadMaterialPropertiesAsync(M,E,b){return Q.LoadExtensionAsync(M,E,this.name,((x,k)=>{const a=new Array;return a.push(this._loader.loadMaterialPropertiesAsync(M,E,b)),a.push(this._loadSpecularPropertiesAsync(x,k,b)),Promise.all(a).then((()=>{}))}))}_loadSpecularPropertiesAsync(M,E,b){if(!(b instanceof N))throw new Error(`${M}: Material type not supported`);const x=new Array;return void 0!==E.specularFactor&&(b.metallicF0Factor=E.specularFactor),void 0!==E.specularColorFactor&&(b.metallicReflectanceColor=a.e.Id(E.specularColorFactor)),E.specularTexture&&(E.specularTexture.nonColorData=!0,x.push(this._loader.loadTextureInfoAsync(`${M}/specularTexture`,E.specularTexture,(M=>{M.name=`${b.name} (Specular)`,b.metallicReflectanceTexture=M,b.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),E.specularColorTexture&&x.push(this._loader.loadTextureInfoAsync(`${M}/specularColorTexture`,E.specularColorTexture,(M=>{M.name=`${b.name} (Specular Color)`,b.reflectanceTexture=M}))),Promise.all(x).then((()=>{}))}}G(jM),i(jM,!0,(M=>new sM(M)));const qM="KHR_materials_ior";class DM{constructor(M){this.name=qM,this.order=180,this._loader=M,this.enabled=this._loader.isExtensionUsed(qM)}dispose(){this._loader=null}loadMaterialPropertiesAsync(M,E,b){return Q.LoadExtensionAsync(M,E,this.name,((x,k)=>{const a=new Array;return a.push(this._loader.loadMaterialPropertiesAsync(M,E,b)),a.push(this._loadIorPropertiesAsync(x,k,b)),Promise.all(a).then((()=>{}))}))}_loadIorPropertiesAsync(M,E,b){if(!(b instanceof N))throw new Error(`${M}: Material type not supported`);return void 0!==E.ior?b.indexOfRefraction=E.ior:b.indexOfRefraction=DM._DEFAULT_IOR,Promise.resolve()}}DM._DEFAULT_IOR=1.5,G(qM),i(qM,!0,(M=>new DM(M)));const zM="KHR_materials_variants";class AM{constructor(M){this.name=zM,this._loader=M,this.enabled=this._loader.isExtensionUsed(zM)}dispose(){this._loader=null}static GetAvailableVariants(M){const E=this._GetExtensionMetadata(M);return E?Object.keys(E.variants):[]}getAvailableVariants(M){return AM.GetAvailableVariants(M)}static SelectVariant(M,E){const b=this._GetExtensionMetadata(M);if(!b)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${zM} extension`);const x=M=>{const E=b.variants[M];if(E)for(const b of E)b.mesh.material=b.material};if(E instanceof Array)for(const k of E)x(k);else x(E);b.lastSelected=E}selectVariant(M,E){AM.SelectVariant(M,E)}static Reset(M){const E=this._GetExtensionMetadata(M);if(!E)throw new Error(`Cannot reset on a glTF mesh that does not have the ${zM} extension`);for(const b of E.original)b.mesh.material=b.material;E.lastSelected=null}reset(M){AM.Reset(M)}static GetLastSelectedVariant(M){const E=this._GetExtensionMetadata(M);if(!E)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${zM} extension`);return E.lastSelected}getLastSelectedVariant(M){return AM.GetLastSelectedVariant(M)}static _GetExtensionMetadata(M){var E,b;return(null===M||void 0===M||null===(E=M._internalMetadata)||void 0===E||null===(b=E.Yi)||void 0===b?void 0:b[zM])||null}onLoading(){const M=this._loader.Yi.extensions;if(M&&M[this.name]){const E=M[this.name];this._variants=E.variants}}_loadMeshPrimitiveAsync(M,E,b,x,k,a){return Q.LoadExtensionAsync(M,k,this.name,((g,n)=>{const J=new Array;return J.push(this._loader._loadMeshPrimitiveAsync(M,E,b,x,k,(E=>{if(a(E),E instanceof P.e){const b=Q._GetDrawMode(M,k.mode),x=this._loader.rootBabylonMesh,a=x?x._internalMetadata=x._internalMetadata||{}:{},u=a.Yi=a.Yi||{},T=u[zM]=u[zM]||{lastSelected:null,original:[],variants:{}};T.original.push({mesh:E,material:E.material});for(let M=0;M<n.mappings.length;++M){const k=n.mappings[M],a=e.Get(`${g}/mappings/${M}/material`,this._loader.Yi.materials,k.material);J.push(this._loader._loadMaterialAsync(`#/materials/${k.material}`,a,E,b,(M=>{for(let b=0;b<k.variants.length;++b){const a=k.variants[b],g=e.Get(`/extensions/${zM}/variants/${a}`,this._variants,a);T.variants[g.name]=T.variants[g.name]||[],T.variants[g.name].push({mesh:E,material:M}),E.onClonedObservable.add((M=>{const b=M;let k=null,a=b;do{if(a=a.parent,!a)return;k=AM._GetExtensionMetadata(a)}while(null===k);if(x&&k===AM._GetExtensionMetadata(x)){a._internalMetadata={};for(const M in x._internalMetadata)a._internalMetadata[M]=x._internalMetadata[M];a._internalMetadata.Yi=[];for(const M in x._internalMetadata.Yi)a._internalMetadata.Yi[M]=x._internalMetadata.Yi[M];a._internalMetadata.Yi[zM]={lastSelected:null,original:[],variants:{}};for(const M of k.original)a._internalMetadata.Yi[zM].original.push({mesh:M.mesh,material:M.material});for(const M in k.variants)if(Object.prototype.hasOwnProperty.call(k.variants,M)){a._internalMetadata.Yi[zM].variants[M]=[];for(const E of k.variants[M])a._internalMetadata.Yi[zM].variants[M].push({mesh:E.mesh,material:E.material})}k=a._internalMetadata.Yi[zM]}for(const x of k.original)x.mesh===E&&(x.mesh=b);for(const x of k.variants[g.name])x.mesh===E&&(x.mesh=b)}))}})))}}}))),Promise.all(J).then((M=>{let[E]=M;return E}))}))}}G(zM),i(zM,!0,(M=>new AM(M)));var YM=b(1536);class iM{}iM.AUTOSAMPLERSUFFIX="Sampler",iM.DISABLEUA="#define DISABLE_UNIFORMITY_ANALYSIS",iM.ALPHA_DISABLE=0,iM.ALPHA_ADD=1,iM.ALPHA_COMBINE=2,iM.ALPHA_SUBTRACT=3,iM.ALPHA_MULTIPLY=4,iM.ALPHA_MAXIMIZED=5,iM.ALPHA_ONEONE=6,iM.ALPHA_PREMULTIPLIED=7,iM.ALPHA_PREMULTIPLIED_PORTERDUFF=8,iM.ALPHA_INTERPOLATE=9,iM.ALPHA_SCREENMODE=10,iM.ALPHA_ONEONE_ONEONE=11,iM.ALPHA_ALPHATOCOLOR=12,iM.ALPHA_REVERSEONEMINUS=13,iM.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,iM.ALPHA_ONEONE_ONEZERO=15,iM.ALPHA_EXCLUSION=16,iM.ALPHA_LAYER_ACCUMULATE=17,iM.ALPHA_EQUATION_ADD=0,iM.ALPHA_EQUATION_SUBSTRACT=1,iM.ALPHA_EQUATION_REVERSE_SUBTRACT=2,iM.ALPHA_EQUATION_MAX=3,iM.ALPHA_EQUATION_MIN=4,iM.ALPHA_EQUATION_DARKEN=5,iM.DELAYLOADSTATE_NONE=0,iM.DELAYLOADSTATE_LOADED=1,iM.DELAYLOADSTATE_LOADING=2,iM.DELAYLOADSTATE_NOTLOADED=4,iM.NEVER=512,iM.ALWAYS=519,iM.LESS=513,iM.EQUAL=514,iM.LEQUAL=515,iM.GREATER=516,iM.GEQUAL=518,iM.NOTEQUAL=517,iM.KEEP=7680,iM.ZERO=0,iM.REPLACE=7681,iM.INCR=7682,iM.DECR=7683,iM.INVERT=5386,iM.INCR_WRAP=34055,iM.DECR_WRAP=34056,iM.TEXTURE_CLAMP_ADDRESSMODE=0,iM.TEXTURE_WRAP_ADDRESSMODE=1,iM.TEXTURE_MIRROR_ADDRESSMODE=2,iM.TEXTURE_CREATIONFLAG_STORAGE=1,iM.TEXTUREFORMAT_ALPHA=0,iM.TEXTUREFORMAT_LUMINANCE=1,iM.TEXTUREFORMAT_LUMINANCE_ALPHA=2,iM.TEXTUREFORMAT_RGB=4,iM.TEXTUREFORMAT_RGBA=5,iM.TEXTUREFORMAT_RED=6,iM.TEXTUREFORMAT_R=6,iM.TEXTUREFORMAT_RG=7,iM.TEXTUREFORMAT_RED_INTEGER=8,iM.TEXTUREFORMAT_R_INTEGER=8,iM.TEXTUREFORMAT_RG_INTEGER=9,iM.TEXTUREFORMAT_RGB_INTEGER=10,iM.TEXTUREFORMAT_RGBA_INTEGER=11,iM.TEXTUREFORMAT_BGRA=12,iM.TEXTUREFORMAT_DEPTH24_STENCIL8=13,iM.TEXTUREFORMAT_DEPTH32_FLOAT=14,iM.TEXTUREFORMAT_DEPTH16=15,iM.TEXTUREFORMAT_DEPTH24=16,iM.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17,iM.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18,iM.TEXTUREFORMAT_STENCIL8=19,iM.TEXTUREFORMAT_UNDEFINED=4294967295,iM.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492,iM.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493,iM.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495,iM.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494,iM.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779,iM.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919,iM.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778,iM.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918,iM.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777,iM.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776,iM.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917,iM.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916,iM.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808,iM.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840,iM.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196,iM.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492,iM.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493,iM.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494,iM.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495,iM.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496,iM.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497,iM.TEXTURETYPE_UNSIGNED_BYTE=0,iM.TEXTURETYPE_UNSIGNED_INT=0,iM.TEXTURETYPE_FLOAT=1,iM.TEXTURETYPE_HALF_FLOAT=2,iM.TEXTURETYPE_BYTE=3,iM.TEXTURETYPE_SHORT=4,iM.TEXTURETYPE_UNSIGNED_SHORT=5,iM.TEXTURETYPE_INT=6,iM.TEXTURETYPE_UNSIGNED_INTEGER=7,iM.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,iM.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,iM.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,iM.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,iM.TEXTURETYPE_UNSIGNED_INT_24_8=12,iM.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,iM.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,iM.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,iM.TEXTURETYPE_UNDEFINED=16,iM.TEXTURE_2D=3553,iM.TEXTURE_2D_ARRAY=35866,iM.TEXTURE_CUBE_MAP=34067,iM.TEXTURE_CUBE_MAP_ARRAY=3735928559,iM.TEXTURE_3D=32879,iM.TEXTURE_NEAREST_SAMPLINGMODE=1,iM.TEXTURE_NEAREST_NEAREST=1,iM.TEXTURE_BILINEAR_SAMPLINGMODE=2,iM.TEXTURE_LINEAR_LINEAR=2,iM.TEXTURE_TRILINEAR_SAMPLINGMODE=3,iM.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,iM.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,iM.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,iM.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,iM.TEXTURE_NEAREST_LINEAR=7,iM.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,iM.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,iM.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,iM.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,iM.TEXTURE_LINEAR_NEAREST=12,iM.TEXTURE_EXPLICIT_MODE=0,iM.TEXTURE_SPHERICAL_MODE=1,iM.TEXTURE_PLANAR_MODE=2,iM.TEXTURE_CUBIC_MODE=3,iM.TEXTURE_PROJECTION_MODE=4,iM.TEXTURE_SKYBOX_MODE=5,iM.TEXTURE_INVCUBIC_MODE=6,iM.TEXTURE_EQUIRECTANGULAR_MODE=7,iM.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,iM.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,iM.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,iM.TEXTURE_FILTERING_QUALITY_HIGH=64,iM.TEXTURE_FILTERING_QUALITY_MEDIUM=16,iM.TEXTURE_FILTERING_QUALITY_LOW=8,iM.SCALEMODE_FLOOR=1,iM.SCALEMODE_NEAREST=2,iM.SCALEMODE_CEILING=3,iM.MATERIAL_TextureDirtyFlag=1,iM.MATERIAL_LightDirtyFlag=2,iM.MATERIAL_FresnelDirtyFlag=4,iM.MATERIAL_AttributesDirtyFlag=8,iM.MATERIAL_MiscDirtyFlag=16,iM.MATERIAL_PrePassDirtyFlag=32,iM.MATERIAL_AllDirtyFlag=63,iM.MATERIAL_TriangleFillMode=0,iM.MATERIAL_WireFrameFillMode=1,iM.MATERIAL_PointFillMode=2,iM.MATERIAL_PointListDrawMode=3,iM.MATERIAL_LineListDrawMode=4,iM.MATERIAL_LineLoopDrawMode=5,iM.MATERIAL_LineStripDrawMode=6,iM.MATERIAL_TriangleStripDrawMode=7,iM.MATERIAL_TriangleFanDrawMode=8,iM.MATERIAL_ClockWiseSideOrientation=0,iM.MATERIAL_CounterClockWiseSideOrientation=1,iM.ACTION_NothingTrigger=0,iM.ACTION_OnPickTrigger=1,iM.ACTION_OnLeftPickTrigger=2,iM.ACTION_OnRightPickTrigger=3,iM.ACTION_OnCenterPickTrigger=4,iM.ACTION_OnPickDownTrigger=5,iM.ACTION_OnDoublePickTrigger=6,iM.ACTION_OnPickUpTrigger=7,iM.ACTION_OnPickOutTrigger=16,iM.ACTION_OnLongPressTrigger=8,iM.ACTION_OnPointerOverTrigger=9,iM.ACTION_OnPointerOutTrigger=10,iM.ACTION_OnEveryFrameTrigger=11,iM.ACTION_OnIntersectionEnterTrigger=12,iM.ACTION_OnIntersectionExitTrigger=13,iM.ACTION_OnKeyDownTrigger=14,iM.ACTION_OnKeyUpTrigger=15,iM.PARTICLES_BILLBOARDMODE_Y=2,iM.PARTICLES_BILLBOARDMODE_ALL=7,iM.PARTICLES_BILLBOARDMODE_STRETCHED=8,iM.PARTICLES_BILLBOARDMODE_STRETCHED_LOCAL=9,iM.MESHES_CULLINGSTRATEGY_STANDARD=0,iM.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,iM.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,iM.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,iM.SCENELOADER_NO_LOGGING=0,iM.SCENELOADER_MINIMAL_LOGGING=1,iM.SCENELOADER_SUMMARY_LOGGING=2,iM.SCENELOADER_DETAILED_LOGGING=3,iM.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,iM.PREPASS_POSITION_TEXTURE_TYPE=1,iM.PREPASS_VELOCITY_TEXTURE_TYPE=2,iM.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,iM.PREPASS_COLOR_TEXTURE_TYPE=4,iM.PREPASS_DEPTH_TEXTURE_TYPE=5,iM.PREPASS_NORMAL_TEXTURE_TYPE=6,iM.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7,iM.PREPASS_WORLD_NORMAL_TEXTURE_TYPE=8,iM.PREPASS_LOCAL_POSITION_TEXTURE_TYPE=9,iM.PREPASS_SCREENSPACE_DEPTH_TEXTURE_TYPE=10,iM.PREPASS_VELOCITY_LINEAR_TEXTURE_TYPE=11,iM.PREPASS_ALBEDO_TEXTURE_TYPE=12,iM.BUFFER_CREATIONFLAG_READ=1,iM.BUFFER_CREATIONFLAG_WRITE=2,iM.BUFFER_CREATIONFLAG_READWRITE=3,iM.BUFFER_CREATIONFLAG_UNIFORM=4,iM.BUFFER_CREATIONFLAG_VERTEX=8,iM.BUFFER_CREATIONFLAG_INDEX=16,iM.BUFFER_CREATIONFLAG_STORAGE=32,iM.BUFFER_CREATIONFLAG_INDIRECT=64,iM.RENDERPASS_MAIN=0,iM.INPUT_ALT_KEY=18,iM.INPUT_CTRL_KEY=17,iM.INPUT_META_KEY1=91,iM.INPUT_META_KEY2=92,iM.INPUT_META_KEY3=93,iM.INPUT_SHIFT_KEY=16,iM.SNAPSHOTRENDERING_STANDARD=0,iM.SNAPSHOTRENDERING_FAST=1,iM.PERSPECTIVE_CAMERA=0,iM.ORTHOGRAPHIC_CAMERA=1,iM.FOVMODE_VERTICAL_FIXED=0,iM.FOVMODE_HORIZONTAL_FIXED=1,iM.RIG_MODE_NONE=0,iM.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,iM.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,iM.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,iM.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,iM.RIG_MODE_STEREOSCOPIC_INTERLACED=14,iM.RIG_MODE_VR=20,iM.RIG_MODE_CUSTOM=22,iM.MAX_SUPPORTED_UV_SETS=6,iM.GL_ALPHA_EQUATION_ADD=32774,iM.GL_ALPHA_EQUATION_MIN=32775,iM.GL_ALPHA_EQUATION_MAX=32776,iM.GL_ALPHA_EQUATION_SUBTRACT=32778,iM.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779,iM.GL_ALPHA_FUNCTION_SRC=768,iM.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769,iM.GL_ALPHA_FUNCTION_SRC_ALPHA=770,iM.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771,iM.GL_ALPHA_FUNCTION_DST_ALPHA=772,iM.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773,iM.GL_ALPHA_FUNCTION_DST_COLOR=774,iM.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775,iM.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776,iM.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769,iM.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770,iM.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771,iM.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772,iM.GL_ALPHA_FUNCTION_SRC1_COLOR=35065,iM.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_COLOR=35066,iM.GL_ALPHA_FUNCTION_SRC1_ALPHA=34185,iM.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_ALPHA=35067,iM.SnippetUrl="https://snippet.babylonjs.com",iM.FOGMODE_NONE=0,iM.FOGMODE_EXP=1,iM.FOGMODE_EXP2=2,iM.FOGMODE_LINEAR=3,iM.BYTE=5120,iM.UNSIGNED_BYTE=5121,iM.SHORT=5122,iM.UNSIGNED_SHORT=5123,iM.INT=5124,iM.UNSIGNED_INT=5125,iM.FLOAT=5126,iM.PositionKind="position",iM.NormalKind="de",iM.TangentKind="tangent",iM.UVKind="uv",iM.UV2Kind="uv2",iM.UV3Kind="uv3",iM.UV4Kind="uv4",iM.UV5Kind="uv5",iM.UV6Kind="uv6",iM.ColorKind="color",iM.ColorInstanceKind="instanceColor",iM.MatricesIndicesKind="matricesIndices",iM.MatricesWeightsKind="matricesWeights",iM.MatricesIndicesExtraKind="matricesIndicesExtra",iM.MatricesWeightsExtraKind="matricesWeightsExtra";class GM{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:iM.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(M,E){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...GM._GetDefaultOptions(),...M},this._scene=E,this._scene._transmissionHelper=this,this.onErrorObservable=new T.b,this._scene.Rd.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(M){if(!Object.keys(M).filter((E=>this._options[E]!==M[E])).length)return;const E={...this._options,...M},b=this._options;this._options=E,E.renderSize===b.renderSize&&E.renderTargetTextureType===b.renderTargetTextureType&&E.generateMipmaps===b.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=E.samples,this._opaqueRenderTarget.lodGenerationScale=E.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=E.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(M){return!!M&&!!(M instanceof N&&M.subSurface.isRefractionEnabled)}_addMesh(M){this._materialObservers[M.uniqueId]=M.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),g.e.SetImmediate((()=>{this._shouldRenderAsTransmission(M.material)?(M.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(M)&&this._transparentMeshesCache.push(M)):-1===this._opaqueMeshesCache.indexOf(M)&&this._opaqueMeshesCache.push(M)}))}_removeMesh(M){M.onMaterialChangedObservable.remove(this._materialObservers[M.uniqueId]),delete this._materialObservers[M.uniqueId];let E=this._transparentMeshesCache.indexOf(M);-1!==E&&this._transparentMeshesCache.splice(E,1),E=this._opaqueMeshesCache.indexOf(M),-1!==E&&this._opaqueMeshesCache.splice(E,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(M){const E=this._transparentMeshesCache.indexOf(M),b=this._opaqueMeshesCache.indexOf(M);this._shouldRenderAsTransmission(M.material)?(M.material instanceof N&&(M.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==b?(this._opaqueMeshesCache.splice(b,1),this._transparentMeshesCache.push(M)):-1===E&&this._transparentMeshesCache.push(M)):-1!==E?(this._transparentMeshesCache.splice(E,1),this._opaqueMeshesCache.push(M)):-1===b&&this._opaqueMeshesCache.push(M)}_isRenderTargetValid(){var M;return null!==(null===(M=this._opaqueRenderTarget)||void 0===M?void 0:M.getInternalTexture())}_setupRenderTargets(){var M;let E,b;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new YM.d("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(M=this._options.clearColor)||void 0===M?void 0:M.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((M=>{b=this._scene.environmentIntensity,this._scene.environmentIntensity=1,E=this._scene.imageProcessingConfiguration.applyByPostProcess,this._options.clearColor?M.clearColor.p(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(M.clearColor,this._scene.getEngine().useExactSrgbConversions),this._scene.imageProcessingConfiguration._applyByPostProcess=!0})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=b,this._scene.imageProcessingConfiguration._applyByPostProcess=E})),this._transparentMeshesCache.forEach((M=>{this._shouldRenderAsTransmission(M.material)&&(M.material.refractionTexture=this._opaqueRenderTarget)}))}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const HM="KHR_materials_transmission";class eM{constructor(M){this.name=HM,this.order=175,this._loader=M,this.enabled=this._loader.isExtensionUsed(HM),this.enabled&&(M.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(M,E,b){return Q.LoadExtensionAsync(M,E,this.name,((x,k)=>{const a=new Array;return a.push(this._loader.loadMaterialPropertiesAsync(M,E,b)),a.push(this._loadTransparentPropertiesAsync(x,E,b,k)),Promise.all(a).then((()=>{}))}))}_loadTransparentPropertiesAsync(M,E,b,x){if(!(b instanceof N))throw new Error(`${M}: Material type not supported`);const k=b;if(k.subSurface.isRefractionEnabled=!0,k.subSurface.volumeIndexOfRefraction=1,k.subSurface.useAlbedoToTintRefraction=!0,void 0===x.transmissionFactor)return k.subSurface.refractionIntensity=0,k.subSurface.isRefractionEnabled=!1,Promise.resolve();{var a;k.subSurface.refractionIntensity=x.transmissionFactor;const M=k.va();if(k.subSurface.refractionIntensity&&!M._transmissionHelper)new GM({},k.va());else if(k.subSurface.refractionIntensity&&(null===(a=M._transmissionHelper)||void 0===a||!a._isRenderTargetValid())){var g;null===(g=M._transmissionHelper)||void 0===g||g._setupRenderTargets()}}return k.subSurface.minimumThickness=0,k.subSurface.maximumThickness=0,x.transmissionTexture?(x.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${M}/transmissionTexture`,x.transmissionTexture,void 0).then((M=>{M.name=`${b.name} (Transmission)`,k.subSurface.refractionIntensityTexture=M,k.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}G(HM),i(HM,!0,(M=>new eM(M)));const QM="KHR_materials_diffuse_transmission";class LM{constructor(M){this.name=QM,this.order=174,this._loader=M,this.enabled=this._loader.isExtensionUsed(QM),this.enabled&&(M.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(M,E,b){return Q.LoadExtensionAsync(M,E,this.name,((x,k)=>{const a=new Array;return a.push(this._loader.loadMaterialPropertiesAsync(M,E,b)),a.push(this._loadTranslucentPropertiesAsync(x,E,b,k)),Promise.all(a).then((()=>{}))}))}_loadTranslucentPropertiesAsync(M,E,b,x){if(!(b instanceof N))throw new Error(`${M}: Material type not supported`);const k=b;if(k.subSurface.isTranslucencyEnabled=!0,k.subSurface.volumeIndexOfRefraction=1,k.subSurface.minimumThickness=0,k.subSurface.maximumThickness=0,k.subSurface.useAlbedoToTintTranslucency=!1,void 0===x.diffuseTransmissionFactor)return k.subSurface.translucencyIntensity=0,k.subSurface.isTranslucencyEnabled=!1,Promise.resolve();k.subSurface.translucencyIntensity=x.diffuseTransmissionFactor;const g=new Array;return k.subSurface.useGltfStyleTextures=!0,x.diffuseTransmissionTexture&&(x.diffuseTransmissionTexture.nonColorData=!0,g.push(this._loader.loadTextureInfoAsync(`${M}/diffuseTransmissionTexture`,x.diffuseTransmissionTexture).then((M=>{M.name=`${b.name} (Diffuse Transmission)`,k.subSurface.translucencyIntensityTexture=M})))),void 0!==x.diffuseTransmissionColorFactor?k.subSurface.translucencyColor=a.e.Id(x.diffuseTransmissionColorFactor):k.subSurface.translucencyColor=a.e.White(),x.diffuseTransmissionColorTexture&&g.push(this._loader.loadTextureInfoAsync(`${M}/diffuseTransmissionColorTexture`,x.diffuseTransmissionColorTexture).then((M=>{M.name=`${b.name} (Diffuse Transmission Color)`,k.subSurface.translucencyColorTexture=M}))),Promise.all(g).then((()=>{}))}}G(QM),i(QM,!0,(M=>new LM(M)));const fM="KHR_materials_volume";class ME{constructor(M){this.name=fM,this.order=173,this._loader=M,this.enabled=this._loader.isExtensionUsed(fM),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(M,E,b){return Q.LoadExtensionAsync(M,E,this.name,((x,k)=>{const a=new Array;return a.push(this._loader.loadMaterialPropertiesAsync(M,E,b)),a.push(this._loadVolumePropertiesAsync(x,E,b,k)),Promise.all(a).then((()=>{}))}))}_loadVolumePropertiesAsync(M,E,b,x){if(!(b instanceof N))throw new Error(`${M}: Material type not supported`);if(!b.subSurface.isRefractionEnabled&&!b.subSurface.isTranslucencyEnabled||!x.thicknessFactor)return Promise.resolve();b.subSurface.volumeIndexOfRefraction=b.indexOfRefraction;const k=void 0!==x.attenuationDistance?x.attenuationDistance:Number.MAX_VALUE;return b.subSurface.tintColorAtDistance=k,void 0!==x.attenuationColor&&3==x.attenuationColor.length&&b.subSurface.tintColor.Hd(x.attenuationColor[0],x.attenuationColor[1],x.attenuationColor[2]),b.subSurface.minimumThickness=0,b.subSurface.maximumThickness=x.thicknessFactor,b.subSurface.useThicknessAsDepth=!0,x.thicknessTexture?(x.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${M}/thicknessTexture`,x.thicknessTexture).then((M=>{M.name=`${b.name} (Thickness)`,b.subSurface.thicknessTexture=M,b.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}G(fM),i(fM,!0,(M=>new ME(M)));const EE="KHR_materials_dispersion";class bE{constructor(M){this.name=EE,this.order=174,this._loader=M,this.enabled=this._loader.isExtensionUsed(EE)}dispose(){this._loader=null}loadMaterialPropertiesAsync(M,E,b){return Q.LoadExtensionAsync(M,E,this.name,((x,k)=>{const a=new Array;return a.push(this._loader.loadMaterialPropertiesAsync(M,E,b)),a.push(this._loadDispersionPropertiesAsync(x,E,b,k)),Promise.all(a).then((()=>{}))}))}_loadDispersionPropertiesAsync(M,E,b,x){if(!(b instanceof N))throw new Error(`${M}: Material type not supported`);return b.subSurface.isRefractionEnabled&&x.dispersion?(b.subSurface.isDispersionEnabled=!0,b.subSurface.dispersion=x.dispersion,Promise.resolve()):Promise.resolve()}}G(EE),i(EE,!0,(M=>new bE(M)));const xE="KHR_mesh_quantization";class kE{constructor(M){this.name=xE,this.enabled=M.isExtensionUsed(xE)}dispose(){}}G(xE),i(xE,!0,(M=>new kE(M)));const aE="KHR_texture_basisu";class gE{constructor(M){this.name=aE,this._loader=M,this.enabled=M.isExtensionUsed(aE)}dispose(){this._loader=null}_loadTextureAsync(M,E,b){return Q.LoadExtensionAsync(M,E,this.name,((x,k)=>{const a=void 0==E.sampler?Q.DefaultSampler:e.Get(`${M}/sampler`,this._loader.Yi.samplers,E.sampler),g=e.Get(`${x}/source`,this._loader.Yi.images,k.source);return this._loader._createTextureAsync(M,a,g,(M=>{b(M)}),E._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!E._textureInfo.nonColorData)}))}}G(aE),i(aE,!0,(M=>new gE(M)));const nE="KHR_texture_transform";class JE{constructor(M){this.name=nE,this._loader=M,this.enabled=this._loader.isExtensionUsed(nE)}dispose(){this._loader=null}loadTextureInfoAsync(M,E,b){return Q.LoadExtensionAsync(M,E,this.name,((x,k)=>this._loader.loadTextureInfoAsync(M,E,(M=>{if(!(M instanceof K.e))throw new Error(`${x}: Texture type not supported`);k.offset&&(M.uOffset=k.offset[0],M.vOffset=k.offset[1]),M.uRotationCenter=0,M.vRotationCenter=0,k.rotation&&(M.wAng=-k.rotation),k.scale&&(M.uScale=k.scale[0],M.vScale=k.scale[1]),void 0!=k.texCoord&&(M.coordinatesIndex=k.texCoord),b(M)}))))}}G(nE),i(nE,!0,(M=>new JE(M)));const uE="KHR_xmp_json_ld";class TE{constructor(M){this.name=uE,this.order=100,this._loader=M,this.enabled=this._loader.isExtensionUsed(uE)}dispose(){this._loader=null}onLoading(){var M,E,b;if(null===this._loader.rootBabylonMesh)return;const x=null===(M=this._loader.Yi.extensions)||void 0===M?void 0:M.KHR_xmp_json_ld,k=null===(E=this._loader.Yi.asset)||void 0===E||null===(b=E.extensions)||void 0===b?void 0:b.KHR_xmp_json_ld;if(x&&k){const M=+k.packet;x.packets&&M<x.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=x.packets[M])}}}function VE(M,E,b,x){return a.e.Id(E,b).scale(x)}function IE(M,E,b,x){return E[b]*x}function tE(M,E,b,x){return-E[b]*x}function yE(M,E,b,x){return E[b+1]*x}function BE(M,E,b,x){return E[b]*x*2}function rE(M){return{scale:[new CE(I.d.ANIMATIONTYPE_FLOAT,`${M}.uScale`,IE,(()=>2)),new CE(I.d.ANIMATIONTYPE_FLOAT,`${M}.vScale`,yE,(()=>2))],offset:[new CE(I.d.ANIMATIONTYPE_FLOAT,`${M}.uOffset`,IE,(()=>2)),new CE(I.d.ANIMATIONTYPE_FLOAT,`${M}.vOffset`,yE,(()=>2))],rotation:[new CE(I.d.ANIMATIONTYPE_FLOAT,`${M}.wAng`,tE,(()=>1))]}}G(uE),i(uE,!0,(M=>new TE(M)));class cE extends q{buildAnimations(M,E,b,x,k){k(M._babylonCamera,this._buildAnimation(E,b,x))}}class CE extends q{buildAnimations(M,E,b,x,k){for(const a in M._data)k(M._data[a].babylonMaterial,this._buildAnimation(E,b,x))}}class RE extends q{buildAnimations(M,E,b,x,k){k(M._babylonLight,this._buildAnimation(E,b,x))}}const wE={__array__:{__target__:!0,...z}},SE={__array__:{__target__:!0,orthographic:{xmag:[new cE(I.d.ANIMATIONTYPE_FLOAT,"orthoLeft",tE,(()=>1)),new cE(I.d.ANIMATIONTYPE_FLOAT,"orthoRight",yE,(()=>1))],ymag:[new cE(I.d.ANIMATIONTYPE_FLOAT,"orthoBottom",tE,(()=>1)),new cE(I.d.ANIMATIONTYPE_FLOAT,"orthoTop",yE,(()=>1))],zfar:[new cE(I.d.ANIMATIONTYPE_FLOAT,"maxZ",IE,(()=>1))],znear:[new cE(I.d.ANIMATIONTYPE_FLOAT,"bj",IE,(()=>1))]},perspective:{yfov:[new cE(I.d.ANIMATIONTYPE_FLOAT,"fov",IE,(()=>1))],zfar:[new cE(I.d.ANIMATIONTYPE_FLOAT,"maxZ",IE,(()=>1))],znear:[new cE(I.d.ANIMATIONTYPE_FLOAT,"bj",IE,(()=>1))]}}},XE={nodes:wE,materials:{__array__:{__target__:!0,pbrMetallicRoughness:{baseColorFactor:[new CE(I.d.ANIMATIONTYPE_COLOR3,"albedoColor",VE,(()=>4)),new CE(I.d.ANIMATIONTYPE_FLOAT,"alpha",(function(M,E,b,x){return E[b+3]*x}),(()=>4))],metallicFactor:[new CE(I.d.ANIMATIONTYPE_FLOAT,"metallic",IE,(()=>1))],roughnessFactor:[new CE(I.d.ANIMATIONTYPE_FLOAT,"roughness",IE,(()=>1))],baseColorTexture:{extensions:{KHR_texture_transform:rE("albedoTexture")}},metallicRoughnessTexture:{extensions:{KHR_texture_transform:rE("metallicTexture")}}},emissiveFactor:[new CE(I.d.ANIMATIONTYPE_COLOR3,"emissiveColor",VE,(()=>3))],normalTexture:{scale:[new CE(I.d.ANIMATIONTYPE_FLOAT,"bumpTexture.level",IE,(()=>1))],extensions:{KHR_texture_transform:rE("bumpTexture")}},occlusionTexture:{strength:[new CE(I.d.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",IE,(()=>1))],extensions:{KHR_texture_transform:rE("ambientTexture")}},emissiveTexture:{extensions:{KHR_texture_transform:rE("emissiveTexture")}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:[new CE(I.d.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",IE,(()=>1))],anisotropyRotation:[new CE(I.d.ANIMATIONTYPE_FLOAT,"anisotropy.angle",IE,(()=>1))],anisotropyTexture:{extensions:{KHR_texture_transform:rE("anisotropy.texture")}}},KHR_materials_clearcoat:{clearcoatFactor:[new CE(I.d.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",IE,(()=>1))],clearcoatRoughnessFactor:[new CE(I.d.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",IE,(()=>1))],clearcoatTexture:{extensions:{KHR_texture_transform:rE("clearCoat.texture")}},clearcoatNormalTexture:{scale:[new CE(I.d.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",IE,(()=>1))],extensions:{KHR_texture_transform:rE("clearCoat.bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:rE("clearCoat.textureRoughness")}}},KHR_materials_dispersion:{dispersion:[new CE(I.d.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",IE,(()=>1))]},KHR_materials_emissive_strength:{emissiveStrength:[new CE(I.d.ANIMATIONTYPE_FLOAT,"emissiveIntensity",IE,(()=>1))]},KHR_materials_ior:{ior:[new CE(I.d.ANIMATIONTYPE_FLOAT,"indexOfRefraction",IE,(()=>1))]},KHR_materials_iridescence:{iridescenceFactor:[new CE(I.d.ANIMATIONTYPE_FLOAT,"iridescence.intensity",IE,(()=>1))],iridescenceIor:[new CE(I.d.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",IE,(()=>1))],iridescenceThicknessMinimum:[new CE(I.d.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",IE,(()=>1))],iridescenceThicknessMaximum:[new CE(I.d.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",IE,(()=>1))],iridescenceTexture:{extensions:{KHR_texture_transform:rE("iridescence.texture")}},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:rE("iridescence.thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:[new CE(I.d.ANIMATIONTYPE_COLOR3,"sheen.color",VE,(()=>3))],sheenRoughnessFactor:[new CE(I.d.ANIMATIONTYPE_FLOAT,"sheen.roughness",IE,(()=>1))],sheenColorTexture:{extensions:{KHR_texture_transform:rE("sheen.texture")}},sheenRoughnessTexture:{extensions:{KHR_texture_transform:rE("sheen.textureRoughness")}}},KHR_materials_specular:{specularFactor:[new CE(I.d.ANIMATIONTYPE_FLOAT,"metallicF0Factor",IE,(()=>1))],specularColorFactor:[new CE(I.d.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",VE,(()=>3))],specularTexture:{extensions:{KHR_texture_transform:rE("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:rE("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:[new CE(I.d.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",IE,(()=>1))],transmissionTexture:{extensions:{KHR_texture_transform:rE("subSurface.refractionIntensityTexture")}}},KHR_materials_volume:{attenuationColor:[new CE(I.d.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",VE,(()=>3))],attenuationDistance:[new CE(I.d.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",IE,(()=>1))],thicknessFactor:[new CE(I.d.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",IE,(()=>1))],thicknessTexture:{extensions:{KHR_texture_transform:rE("subSurface.thicknessTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:[new CE(I.d.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",IE,(()=>1))],diffuseTransmissionTexture:{extensions:{KHR_texture_transform:rE("subSurface.translucencyIntensityTexture")}},diffuseTransmissionColorFactor:[new CE(I.d.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",VE,(()=>3))],diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:rE("subSurface.translucencyColorTexture")}}}}}},cameras:SE,extensions:{KHR_lights_punctual:{lights:{__array__:{__target__:!0,color:[new RE(I.d.ANIMATIONTYPE_COLOR3,"diffuse",VE,(()=>3))],fj:[new RE(I.d.ANIMATIONTYPE_FLOAT,"intensity",IE,(()=>1))],range:[new RE(I.d.ANIMATIONTYPE_FLOAT,"range",IE,(()=>1))],spot:{innerConeAngle:[new RE(I.d.ANIMATIONTYPE_FLOAT,"innerAngle",BE,(()=>1))],outerConeAngle:[new RE(I.d.ANIMATIONTYPE_FLOAT,"angle",BE,(()=>1))]}}}}}};class UE{constructor(M,E){this._gltf=M,this._infoTree=E}convert(M){let E,b=this._gltf,x=this._infoTree;if(!M.startsWith("/"))throw new Error("Path must start with a /");const k=M.split("/");k.shift();for(const a of k){if(x.__array__)x=x.__array__;else if(x=x[a],!x)throw new Error(`Path ${M} is invalid`);if(void 0===b)throw new Error(`Path ${M} is invalid`);b=b[a],x.__target__&&(E=b)}return{object:E,info:x}}}const vE="KHR_animation_pointer";class NE extends UE{constructor(M){super(M,XE)}}class KE{constructor(M){this.name=vE,this._loader=M,this._pathToObjectConverter=new NE(this._loader.Yi)}get enabled(){return this._loader.isExtensionUsed(vE)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(M,E,b,x,k){var a;const g=null===(a=x.target.extensions)||void 0===a?void 0:a.KHR_animation_pointer;if(!g||!this._pathToObjectConverter)return null;"pointer"!==x.target.path&&B.d.Warn(`${M}/target/path: Value (${x.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=x.target.node&&B.d.Warn(`${M}/target/node: Value (${x.target.node}) must not be present when using the ${this.name} extension`);const n=`${M}/extensions/${this.name}`,J=g.pointer;if(!J)throw new Error(`${n}: Pointer is missing`);try{const a=this._pathToObjectConverter.convert(J);return this._loader._loadAnimationChannelFromTargetInfoAsync(M,E,b,x,a,k)}catch(u){return B.d.Warn(`${n}/pointer: Invalid pointer (${J}) skipped`),null}}}G(vE),i(vE,!0,(M=>new KE(M)));class hE{constructor(M,E,b){this.frame=M,this.action=E,this.onlyOnce=b,this.isDone=!1}_clone(){return new hE(this.frame,this.action,this.onlyOnce)}}var ZE=b(1056),OE=b(1073);class pE{get loop(){return this._loop}set loop(M){M!==this._loop&&(this._loop=M,this.updateOptions({loop:M}))}get currentTime(){var M;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(M=OE.c.audioEngine)&&void 0!==M&&M.audioContext&&(this.isPlaying||this.isPaused)){const M=this.isPaused?0:OE.c.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+M}return 0}get spatialSound(){return this._spatialSound}set spatialSound(M){if(M==this._spatialSound)return;const E=this.isPlaying;this.pause(),M?(this._spatialSound=M,this._updateSpatialParameters()):this._disableSpatialSound(),E&&this.play()}constructor(M,E,b){var x;let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new T.b,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=k.m.Zero(),this._localDirection=new k.m(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=M,b=b||y.b.LastCreatedScene)if(this._scene=b,pE._SceneComponentInitialization(b),this._readyToPlayCallback=a,this._customAttenuationFunction=(M,E,b,x,k)=>E<b?M*(1-E/b):0,n&&(this.autoplay=n.autoplay||!1,this._loop=n.loop||!1,void 0!==n.volume&&(this._volume=n.volume),this._spatialSound=n.spatialSound??!1,this.maxDistance=n.maxDistance??100,this.useCustomAttenuation=n.useCustomAttenuation??!1,this.rolloffFactor=n.rolloffFactor||1,this.refDistance=n.refDistance||1,this.distanceModel=n.distanceModel||"linear",this._playbackRate=n.playbackRate||1,this._streaming=n.streaming??!1,this._length=n.length,this._offset=n.offset),null!==(x=OE.c.audioEngine)&&void 0!==x&&x.canUseWebAudio&&OE.c.audioEngine.audioContext){this._soundGain=OE.c.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let M=!0;if(E)try{"string"===typeof E?(this._urlType="String",this._url=E):E instanceof ArrayBuffer?this._urlType="ArrayBuffer":E instanceof HTMLMediaElement?this._urlType="MediaElement":E instanceof MediaStream?this._urlType="MediaStream":E instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(E)&&(this._urlType="Array");let b=[],x=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=OE.c.audioEngine.audioContext.createMediaElementSource(E),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=OE.c.audioEngine.audioContext.createMediaStreamSource(E),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":E.byteLength>0&&(x=!0,this._soundLoaded(E));break;case"AudioBuffer":this._audioBufferLoaded(E);break;case"String":b.push(E);case"Array":0===b.length&&(b=E);for(let M=0;M<b.length;M++){const E=b[M];if(x=n&&n.skipCodecCheck||-1!==E.indexOf(".mp3",E.length-4)&&OE.c.audioEngine.isMP3supported||-1!==E.indexOf(".ogg",E.length-4)&&OE.c.audioEngine.isOGGsupported||-1!==E.indexOf(".wav",E.length-4)||-1!==E.indexOf(".m4a",E.length-4)||-1!==E.indexOf(".mp4",E.length-4)||-1!==E.indexOf("blob:"),x){this._streaming?(this._htmlAudioElement=new Audio(E),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,g.e.SetCorsBehavior(E,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(E,(M=>{this._soundLoaded(M)}),void 0,!0,!0,(M=>{M&&B.d.Error("XHR "+M.status+" error on: "+E+"."),B.d.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:M=!1}M?x||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):B.d.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(J){B.d.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),OE.c.audioEngine&&!OE.c.audioEngine.WarnedWebAudioUnsupported&&(B.d.Error("Web Audio is not supported by your browser."),OE.c.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var M;null!==(M=OE.c.audioEngine)&&void 0!==M&&M.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(M){var E;null!==(E=OE.c.audioEngine)&&void 0!==E&&E.audioContext&&(this._audioBuffer=M,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(M){var E;null!==(E=OE.c.audioEngine)&&void 0!==E&&E.audioContext&&OE.c.audioEngine.audioContext.decodeAudioData(M,(M=>{this._audioBufferLoaded(M)}),(M=>{B.d.Error("Error while decoding audio data for: "+this.name+" / Error: "+M)}))}setAudioBuffer(M){var E;null!==(E=OE.c.audioEngine)&&void 0!==E&&E.canUseWebAudio&&(this._audioBuffer=M,this._isReadyToPlay=!0)}updateOptions(M){M&&(this.loop=M.loop??this.loop,this.maxDistance=M.maxDistance??this.maxDistance,this.useCustomAttenuation=M.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=M.rolloffFactor??this.rolloffFactor,this.refDistance=M.refDistance??this.refDistance,this.distanceModel=M.distanceModel??this.distanceModel,this._playbackRate=M.playbackRate??this._playbackRate,this._length=M.length??void 0,this.spatialSound=M.spatialSound??this._spatialSound,this._setOffset(M.offset??void 0),this.setVolume(M.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var M;null!==(M=OE.c.audioEngine)&&void 0!==M&&M.canUseWebAudio&&OE.c.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??OE.c.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var M;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(M=this._soundPanner)||void 0===M||M.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var M;null!==(M=OE.c.audioEngine)&&void 0!==M&&M.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(M){var E;null!==(E=OE.c.audioEngine)&&void 0!==E&&E.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(M),this._isOutputConnected=!0)}setDirectionalCone(M,E,b){E<M?B.d.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=M,this._coneOuterAngle=E,this._coneOuterGain=b,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(M){if(M!=this._coneInnerAngle){var E;if(this._coneOuterAngle<M)return void B.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=M,null!==(E=OE.c.audioEngine)&&void 0!==E&&E.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(M){if(M!=this._coneOuterAngle){var E;if(M<this._coneInnerAngle)return void B.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=M,null!==(E=OE.c.audioEngine)&&void 0!==E&&E.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(M){var E;M.equals(this._position)||(this._position.p(M),null!==(E=OE.c.audioEngine)&&void 0!==E&&E.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(M){var E;this._localDirection=M,null!==(E=OE.c.audioEngine)&&void 0!==E&&E.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const M=this._connectedTransformNode.getWorldMatrix(),E=k.m.TransformNormal(this._localDirection,M);E.normalize(),this._soundPanner.orientationX.value=E.x,this._soundPanner.orientationY.value=E.y,this._soundPanner.orientationZ.value=E.z}updateDistanceFromListener(){var M;if(null!==(M=OE.c.audioEngine)&&void 0!==M&&M.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const M=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.Qc(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,M,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(M){this._customAttenuationFunction=M}play(M,E,b){var x;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(x=OE.c.audioEngine)&&void 0!==x&&x.audioContext)try{var k,a;this._clearTimeoutsAndObservers();let x=M?(null===(k=OE.c.audioEngine)||void 0===k?void 0:k.audioContext.currentTime)+M:null===(a=OE.c.audioEngine)||void 0===a?void 0:a.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=OE.c.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const M=()=>{var b;if(null!==(b=OE.c.audioEngine)&&void 0!==b&&b.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=E??0;const b=this._htmlAudioElement.play();void 0!==b&&b.catch((()=>{var E,b;(null===(E=OE.c.audioEngine)||void 0===E||E.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(b=OE.c.audioEngine)||void 0===b?void 0:b.onAudioUnlockedObservable.addOnce((()=>{M()})))}))}else{var x;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(x=OE.c.audioEngine)||void 0===x?void 0:x.onAudioUnlockedObservable.addOnce((()=>{M()}))}};M()}}else{var g;const k=()=>{var k;if(null!==(k=OE.c.audioEngine)&&void 0!==k&&k.audioContext){var a;if(b=b||this._length,void 0!==E&&this._setOffset(E),this._soundSource){const M=this._soundSource;M.onended=()=>{M.disconnect()}}if(this._soundSource=null===(a=OE.c.audioEngine)||void 0===a?void 0:a.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var g;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==E&&(this._soundSource.loopStart=E),void 0!==b&&(this._soundSource.loopEnd=(0|E)+b),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},x=M?(null===(g=OE.c.audioEngine)||void 0===g?void 0:g.audioContext.currentTime)+M:OE.c.audioEngine.audioContext.currentTime;const k=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(x,k,this.loop?void 0:b)}}};"suspended"===(null===(g=OE.c.audioEngine)||void 0===g?void 0:g.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var M;"suspended"===(null===(M=OE.c.audioEngine)||void 0===M?void 0:M.audioContext.state)?(OE.c.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=OE.c.audioEngine.onAudioUnlockedObservable.addOnce((()=>{k()})))):k()}),500):k()}this._startTime=x,this.isPlaying=!0,this.isPaused=!1}catch(n){B.d.Error("Error while trying to play audio: "+this.name+", "+n.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(M){var E;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var b;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(b=this._streamingSource)||void 0===b||b.disconnect();this.isPlaying=!1}else if(null!==(E=OE.c.audioEngine)&&void 0!==E&&E.audioContext&&this._soundSource){const E=M?OE.c.audioEngine.audioContext.currentTime+M:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(E)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var M;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var E;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(E=this._streamingSource)||void 0===E||E.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(M=OE.c.audioEngine)&&void 0!==M&&M.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=OE.c.audioEngine.audioContext.currentTime-this._startTime)}setVolume(M,E){var b;null!==(b=OE.c.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._soundGain&&(E&&OE.c.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(OE.c.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,OE.c.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(M,OE.c.audioEngine.audioContext.currentTime+E)):this._soundGain.gain.value=M),this._volume=M}setPlaybackRate(M){this._playbackRate=M,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(M){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=M,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=M=>this._onRegisterAfterWorldMatrixUpdate(M),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(M){var E;if(M.getBoundingInfo){const E=M.getBoundingInfo();this.setPosition(E.boundingSphere.centerWorld)}else this.setPosition(M.absolutePosition);null!==(E=OE.c.audioEngine)&&void 0!==E&&E.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const M=()=>{this._isReadyToPlay?(b._audioBuffer=this.getAudioBuffer(),b._isReadyToPlay=!0,b.autoplay&&b.play(0,this._offset,this._length)):setTimeout(M,300)},E={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},b=new pE(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,E);return this.useCustomAttenuation&&b.setAttenuationFunction(this._customAttenuationFunction),b.setPosition(this._position),b.setPlaybackRate(this._playbackRate),M(),b}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const M={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(M.connectedMeshId=this._connectedTransformNode.id),M.position=this._position.Vd(),M.refDistance=this.refDistance,M.distanceModel=this.distanceModel,M.isDirectional=this._isDirectional,M.localDirectionToMesh=this._localDirection.Vd(),M.coneInnerAngle=this._coneInnerAngle,M.coneOuterAngle=this._coneOuterAngle,M.coneOuterGain=this._coneOuterGain),M}static Parse(M,E,b,x){const a=M.name;let g;g=M.url?b+M.url:b+a;const n={autoplay:M.autoplay,loop:M.loop,volume:M.volume,spatialSound:M.spatialSound,maxDistance:M.maxDistance,rolloffFactor:M.rolloffFactor,refDistance:M.refDistance,distanceModel:M.distanceModel,playbackRate:M.playbackRate};let J;if(x){const M=()=>{x._isReadyToPlay?(J._audioBuffer=x.getAudioBuffer(),J._isReadyToPlay=!0,J.autoplay&&J.play(0,J._offset,J._length)):setTimeout(M,300)};J=new pE(a,new ArrayBuffer(0),E,null,n),M()}else J=new pE(a,g,E,(()=>{E.removePendingData(J)}),n),E.addPendingData(J);if(M.position){const E=k.m.Id(M.position);J.setPosition(E)}if(M.isDirectional&&(J.setDirectionalCone(M.coneInnerAngle||360,M.coneOuterAngle||360,M.coneOuterGain||0),M.localDirectionToMesh)){const E=k.m.Id(M.localDirectionToMesh);J.setLocalDirectionToMesh(E)}if(M.connectedMeshId){const b=E.getMeshById(M.connectedMeshId);b&&J.attachToMesh(b)}return M.metadata&&(J.metadata=M.metadata),J}_setOffset(M){this._offset!==M&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=M)}_clearTimeoutsAndObservers(){var M;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(M=OE.c.audioEngine)||void 0===M||M.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}pE._SceneComponentInitialization=M=>{throw(0,ZE.b)("AudioSceneComponent")},(0,U.h)("BABYLON.Sound",pE);class PE{constructor(M,E,b){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],E.length!==b.length)throw new Error("Sounds length does not equal weights length");this.loop=M,this._weights=b;let x=0;for(const a of b)x+=a;const k=x>0?1/x:0;for(let a=0;a<this._weights.length;a++)this._weights[a]*=k;this._sounds=E;for(const a of this._sounds)a.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(M){if(M!==this._coneInnerAngle){if(this._coneOuterAngle<M)return void B.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=M;for(const E of this._sounds)E.directionalConeInnerAngle=M}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(M){if(M!==this._coneOuterAngle){if(M<this._coneInnerAngle)return void B.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=M;for(const E of this._sounds)E.directionalConeOuterAngle=M}}get volume(){return this._volume}set volume(M){if(M!==this._volume)for(const E of this._sounds)E.setVolume(M)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(M){if(!this.isPaused){this.stop();const M=Math.random();let E=0;for(let b=0;b<this._weights.length;b++)if(E+=this._weights[b],M<=E){this._currentIndex=b;break}}const E=this._sounds[this._currentIndex??0];E.isReady()?E.play(0,this.isPaused?void 0:M):E.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class FE{constructor(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(M=M||y.b.LastCreatedScene)&&(this._scene=M,this.soundCollection=[],this._options=E,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var M;null!==(M=OE.c.audioEngine)&&void 0!==M&&M.canUseWebAudio&&OE.c.audioEngine.audioContext&&(this._outputAudioNode=OE.c.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(OE.c.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(OE.c.audioEngine&&OE.c.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(M){var E;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(E=OE.c.audioEngine)&&void 0!==E&&E.canUseWebAudio&&this._outputAudioNode&&M.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==M.soundTrackId&&(-1===M.soundTrackId?this._scene.mainSoundTrack.removeSound(M):this._scene.soundTracks&&this._scene.soundTracks[M.soundTrackId].removeSound(M)),this.soundCollection.push(M),M.soundTrackId=this.id}removeSound(M){const E=this.soundCollection.indexOf(M);-1!==E&&this.soundCollection.splice(E,1)}setVolume(M){var E;null!==(E=OE.c.audioEngine)&&void 0!==E&&E.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=M)}switchPanningModelToHRTF(){var M;if(null!==(M=OE.c.audioEngine)&&void 0!==M&&M.canUseWebAudio)for(let E=0;E<this.soundCollection.length;E++)this.soundCollection[E].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var M;if(null!==(M=OE.c.audioEngine)&&void 0!==M&&M.canUseWebAudio)for(let E=0;E<this.soundCollection.length;E++)this.soundCollection[E].switchPanningModelToEqualPower()}connectToAnalyser(M){var E;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=M,null!==(E=OE.c.audioEngine)&&void 0!==E&&E.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,OE.c.audioEngine.masterGain))}}var lE=b(1260),dE=b(1171),WE=(b(1565),b(1099));(0,b(11712).e)(lE.c.NAME_AUDIO,((M,E,b,x)=>{let k,a=[];if(b.Ke=b.Ke||[],void 0!==M.Ke&&null!==M.Ke)for(let n=0,J=M.Ke.length;n<J;n++){var g;const J=M.Ke[n];null!==(g=OE.c.audioEngine)&&void 0!==g&&g.canUseWebAudio?(J.url||(J.url=J.name),a[J.url]?b.Ke.push(pE.Parse(J,E,x,a[J.url])):(k=pE.Parse(J,E,x),a[J.url]=k,b.Ke.push(k))):b.Ke.push(new pE(J.name,null,E))}a=[]})),Object.defineProperty(dE.d.prototype,"mainSoundTrack",{get:function(){let M=this._getComponent(lE.c.NAME_AUDIO);return M||(M=new mE(this),this.Ie(M)),this._mainSoundTrack||(this._mainSoundTrack=new FE(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),dE.d.prototype.getSoundByName=function(M){let E;for(E=0;E<this.mainSoundTrack.soundCollection.length;E++)if(this.mainSoundTrack.soundCollection[E].name===M)return this.mainSoundTrack.soundCollection[E];if(this.soundTracks)for(let b=0;b<this.soundTracks.length;b++)for(E=0;E<this.soundTracks[b].soundCollection.length;E++)if(this.soundTracks[b].soundCollection[E].name===M)return this.soundTracks[b].soundCollection[E];return null},Object.defineProperty(dE.d.prototype,"audioEnabled",{get:function(){let M=this._getComponent(lE.c.NAME_AUDIO);return M||(M=new mE(this),this.Ie(M)),M.audioEnabled},set:function(M){let E=this._getComponent(lE.c.NAME_AUDIO);E||(E=new mE(this),this.Ie(E)),M?E.enableAudio():E.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(dE.d.prototype,"headphone",{get:function(){let M=this._getComponent(lE.c.NAME_AUDIO);return M||(M=new mE(this),this.Ie(M)),M.headphone},set:function(M){let E=this._getComponent(lE.c.NAME_AUDIO);E||(E=new mE(this),this.Ie(E)),M?E.switchAudioModeForHeadphones():E.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(dE.d.prototype,"audioListenerPositionProvider",{get:function(){let M=this._getComponent(lE.c.NAME_AUDIO);return M||(M=new mE(this),this.Ie(M)),M.audioListenerPositionProvider},set:function(M){let E=this._getComponent(lE.c.NAME_AUDIO);if(E||(E=new mE(this),this.Ie(E)),M&&"function"!==typeof M)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");E.audioListenerPositionProvider=M},enumerable:!0,configurable:!0}),Object.defineProperty(dE.d.prototype,"audioListenerRotationProvider",{get:function(){let M=this._getComponent(lE.c.NAME_AUDIO);return M||(M=new mE(this),this.Ie(M)),M.audioListenerRotationProvider},set:function(M){let E=this._getComponent(lE.c.NAME_AUDIO);if(E||(E=new mE(this),this.Ie(E)),M&&"function"!==typeof M)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");E.audioListenerRotationProvider=M},enumerable:!0,configurable:!0}),Object.defineProperty(dE.d.prototype,"audioPositioningRefreshRate",{get:function(){let M=this._getComponent(lE.c.NAME_AUDIO);return M||(M=new mE(this),this.Ie(M)),M.audioPositioningRefreshRate},set:function(M){let E=this._getComponent(lE.c.NAME_AUDIO);E||(E=new mE(this),this.Ie(E)),E.audioPositioningRefreshRate=M},enumerable:!0,configurable:!0});class mE{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(M){this.name=lE.c.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new k.m,this._cachedCameraPosition=new k.m,this._lastCheck=0,this._invertMatrixTemp=new k.d,this._cameraDirectionTemp=new k.m,(M=M||y.b.LastCreatedScene)&&(this.Ae=M,M.soundTracks=[],M.Ke=[])}register(){this.Ae._afterRenderStage.registerStep(lE.c.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(M){if(M.Ke=[],this.Ae.soundTracks)for(let E=0;E<this.Ae.soundTracks.length;E++){const b=this.Ae.soundTracks[E];for(let E=0;E<b.soundCollection.length;E++)M.Ke.push(b.soundCollection[E].serialize())}}addFromContainer(M){M.Ke&&M.Ke.forEach((M=>{M.play(),M.autoplay=!0,this.Ae.mainSoundTrack.addSound(M)}))}removeFromContainer(M){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1];M.Ke&&M.Ke.forEach((M=>{M.stop(),M.autoplay=!1,this.Ae.mainSoundTrack.removeSound(M),E&&M.dispose()}))}dispose(){const M=this.Ae;if(M._mainSoundTrack&&M.mainSoundTrack.dispose(),M.soundTracks)for(let E=0;E<M.soundTracks.length;E++)M.soundTracks[E].dispose()}disableAudio(){const M=this.Ae;let E;for(this._audioEnabled=!1,OE.c.audioEngine&&OE.c.audioEngine.audioContext&&OE.c.audioEngine.audioContext.suspend(),E=0;E<M.mainSoundTrack.soundCollection.length;E++)M.mainSoundTrack.soundCollection[E].pause();if(M.soundTracks)for(E=0;E<M.soundTracks.length;E++)for(let b=0;b<M.soundTracks[E].soundCollection.length;b++)M.soundTracks[E].soundCollection[b].pause()}enableAudio(){const M=this.Ae;let E;for(this._audioEnabled=!0,OE.c.audioEngine&&OE.c.audioEngine.audioContext&&OE.c.audioEngine.audioContext.resume(),E=0;E<M.mainSoundTrack.soundCollection.length;E++)M.mainSoundTrack.soundCollection[E].isPaused&&M.mainSoundTrack.soundCollection[E].play();if(M.soundTracks)for(E=0;E<M.soundTracks.length;E++)for(let b=0;b<M.soundTracks[E].soundCollection.length;b++)M.soundTracks[E].soundCollection[b].isPaused&&M.soundTracks[E].soundCollection[b].play()}switchAudioModeForHeadphones(){const M=this.Ae;if(this._headphone=!0,M.mainSoundTrack.switchPanningModelToHRTF(),M.soundTracks)for(let E=0;E<M.soundTracks.length;E++)M.soundTracks[E].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const M=this.Ae;if(this._headphone=!1,M.mainSoundTrack.switchPanningModelToEqualPower(),M.soundTracks)for(let E=0;E<M.soundTracks.length;E++)M.soundTracks[E].switchPanningModelToEqualPower()}_afterRender(){const M=WE.e.Now;if(this._lastCheck&&M-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=M;const E=this.Ae;if(!this._audioEnabled||!E._mainSoundTrack||!E.soundTracks||0===E._mainSoundTrack.soundCollection.length&&1===E.soundTracks.length)return;const b=OE.c.audioEngine;if(b&&b.audioContext){let M,x=E.activeCamera;if(E.activeCameras&&E.activeCameras.length>0&&(x=E.activeCameras[0]),this.audioListenerPositionProvider){const M=this.audioListenerPositionProvider();b.audioContext.listener.setPosition(M.x||0,M.y||0,M.z||0)}else x?this._cachedCameraPosition.equals(x.globalPosition)||(this._cachedCameraPosition.p(x.globalPosition),b.audioContext.listener.setPosition(x.globalPosition.x,x.globalPosition.y,x.globalPosition.z)):b.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const M=this.audioListenerRotationProvider();b.audioContext.listener.setOrientation(M.x||0,M.y||0,M.z||0,0,1,0)}else x?(x.rigCameras&&x.rigCameras.length>0&&(x=x.rigCameras[0]),x.getViewMatrix().invertToRef(this._invertMatrixTemp),k.m.TransformNormalToRef(mE._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.p(this._cameraDirectionTemp),b.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):b.audioContext.listener.setOrientation(0,0,0,0,1,0);for(M=0;M<E.mainSoundTrack.soundCollection.length;M++){const b=E.mainSoundTrack.soundCollection[M];b.useCustomAttenuation&&b.updateDistanceFromListener()}if(E.soundTracks)for(M=0;M<E.soundTracks.length;M++)for(let b=0;b<E.soundTracks[M].soundCollection.length;b++){const x=E.soundTracks[M].soundCollection[b];x.useCustomAttenuation&&x.updateDistanceFromListener()}}}}mE._CameraDirection=new k.m(0,0,-1),pE._SceneComponentInitialization=M=>{let E=M._getComponent(lE.c.NAME_AUDIO);E||(E=new mE(M),M.Ie(E))};const oE="MSFT_audio_emitter";class jE{constructor(M){this.name=oE,this._loader=M,this.enabled=this._loader.isExtensionUsed(oE)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const M=this._loader.Yi.extensions;if(M&&M[this.name]){const E=M[this.name];this._clips=E.clips,this._emitters=E.emitters,e.Assign(this._clips),e.Assign(this._emitters)}}loadSceneAsync(M,E){return Q.LoadExtensionAsync(M,E,this.name,((b,x)=>{const k=new Array;k.push(this._loader.loadSceneAsync(M,E));for(const M of x.emitters){const E=e.Get(`${b}/emitters`,this._emitters,M);if(void 0!=E.refDistance||void 0!=E.maxDistance||void 0!=E.rolloffFactor||void 0!=E.distanceModel||void 0!=E.innerAngle||void 0!=E.outerAngle)throw new Error(`${b}: Direction or Distance properties are not allowed on emitters attached to a scene`);k.push(this._loadEmitterAsync(`${b}/emitters/${E.index}`,E))}return Promise.all(k).then((()=>{}))}))}loadNodeAsync(M,E,b){return Q.LoadExtensionAsync(M,E,this.name,((M,x)=>{const a=new Array;return this._loader.loadNodeAsync(M,E,(E=>{for(const b of x.emitters){const x=e.Get(`${M}/emitters`,this._emitters,b);a.push(this._loadEmitterAsync(`${M}/emitters/${x.index}`,x).then((()=>{for(const M of x._babylonSounds)M.attachToMesh(E),void 0==x.innerAngle&&void 0==x.outerAngle||(M.setLocalDirectionToMesh(k.m.Forward()),M.setDirectionalCone(2*g.e.ToDegrees(void 0==x.innerAngle?Math.PI:x.innerAngle),2*g.e.ToDegrees(void 0==x.outerAngle?Math.PI:x.outerAngle),0))})))}b(E)})).then((M=>Promise.all(a).then((()=>M))))}))}loadAnimationAsync(M,E){return Q.LoadExtensionAsync(M,E,this.name,((b,x)=>this._loader.loadAnimationAsync(M,E).then((k=>{const a=new Array;e.Assign(x.events);for(const g of x.events)a.push(this._loadAnimationEventAsync(`${b}/events/${g.index}`,M,E,g,k));return Promise.all(a).then((()=>k))}))))}_loadClipAsync(M,E){if(E._objectURL)return E._objectURL;let b;if(E.uri)b=this._loader.loadUriAsync(M,E,E.uri);else{const x=e.Get(`${M}/bufferView`,this._loader.Yi.bufferViews,E.bufferView);b=this._loader.loadBufferViewAsync(`/bufferViews/${x.index}`,x)}return E._objectURL=b.then((M=>URL.createObjectURL(new Blob([M],{type:E.mimeType})))),E._objectURL}_loadEmitterAsync(M,E){if(E._babylonSounds=E._babylonSounds||[],!E._babylonData){const M=new Array,b=E.name||`emitter${E.index}`,x={loop:!1,autoplay:!1,volume:void 0==E.volume?1:E.volume};for(let a=0;a<E.clips.length;a++){const k=`/extensions/${this.name}/clips`,g=e.Get(k,this._clips,E.clips[a].clip);M.push(this._loadClipAsync(`${k}/${E.clips[a].clip}`,g).then((M=>{const k=E._babylonSounds[a]=new pE(b,M,this._loader.babylonScene,null,x);k.refDistance=E.refDistance||1,k.maxDistance=E.maxDistance||256,k.rolloffFactor=E.rolloffFactor||1,k.distanceModel=E.distanceModel||"exponential"})))}const k=Promise.all(M).then((()=>{const M=E.clips.map((M=>M.weight||1)),b=new PE(E.loop||!1,E._babylonSounds,M);E.innerAngle&&(b.directionalConeInnerAngle=2*g.e.ToDegrees(E.innerAngle)),E.outerAngle&&(b.directionalConeOuterAngle=2*g.e.ToDegrees(E.outerAngle)),E.volume&&(b.volume=E.volume),E._babylonData.sound=b}));E._babylonData={loaded:k}}return E._babylonData.loaded}_getEventAction(M,E,b,x,k){switch(b){case"play":return M=>{const b=(k||0)+(M-x);E.play(b)};case"stop":return()=>{E.stop()};case"pause":return()=>{E.pause()};default:throw new Error(`${M}: Unsupported action ${b}`)}}_loadAnimationEventAsync(M,E,b,x,k){if(0==k.targetedAnimations.length)return Promise.resolve();const a=k.targetedAnimations[0],g=x.k,n=e.Get(`/extensions/${this.name}/emitters`,this._emitters,g);return this._loadEmitterAsync(M,n).then((()=>{const E=n._babylonData.sound;if(E){const b=new hE(x.time,this._getEventAction(M,E,x.action,x.time,x.startOffset));a.animation.addEvent(b),k.onAnimationGroupEndObservable.add((()=>{E.stop()})),k.onAnimationGroupPauseObservable.add((()=>{E.pause()}))}}))}}G(oE),i(oE,!0,(M=>new jE(M)));const sE="MSFT_lod";class qE{constructor(M){var E;this.name=sE,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new T.b,this.onMaterialLODsLoadedObservable=new T.b,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=M,this.maxLODsToLoad=(null===(E=this._loader.parent.extensionOptions[sE])||void 0===E?void 0:E.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(sE)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let M=0;M<this._nodePromiseLODs.length;M++){const E=Promise.all(this._nodePromiseLODs[M]).then((()=>{0!==M&&(this._loader.endPerformanceCounter(`Node LOD ${M}`),this._loader.log(`Loaded node LOD ${M}`)),this.onNodeLODsLoadedObservable.notifyObservers(M),M!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${M+1}`),this._loadBufferLOD(this._nodeBufferLODs,M+1),this._nodeSignalLODs[M]&&this._nodeSignalLODs[M].resolve())}));this._loader._completePromises.push(E)}for(let M=0;M<this._materialPromiseLODs.length;M++){const E=Promise.all(this._materialPromiseLODs[M]).then((()=>{0!==M&&(this._loader.endPerformanceCounter(`Material LOD ${M}`),this._loader.log(`Loaded material LOD ${M}`)),this.onMaterialLODsLoadedObservable.notifyObservers(M),M!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${M+1}`),this._loadBufferLOD(this._materialBufferLODs,M+1),this._materialSignalLODs[M]&&this._materialSignalLODs[M].resolve())}));this._loader._completePromises.push(E)}}loadSceneAsync(M,E){const b=this._loader.loadSceneAsync(M,E);return this._loadBufferLOD(this._bufferLODs,0),b}loadNodeAsync(M,E,b){return Q.LoadExtensionAsync(M,E,this.name,((M,k)=>{let a;const g=this._getLODs(M,E,this._loader.Yi.nodes,k.ids);this._loader.logOpen(`${M}`);for(let E=0;E<g.length;E++){const M=g[E];0!==E&&(this._nodeIndexLOD=E,this._nodeSignalLODs[E]=this._nodeSignalLODs[E]||new x);const k=M=>{b(M),M.wg(!1)},n=this._loader.loadNodeAsync(`/nodes/${M.index}`,M,k).then((M=>{if(0!==E){const M=g[E-1];M._babylonTransformNode&&(this._disposeTransformNode(M._babylonTransformNode),delete M._babylonTransformNode)}return M.wg(!0),M}));this._nodePromiseLODs[E]=this._nodePromiseLODs[E]||[],0===E?a=n:(this._nodeIndexLOD=null,this._nodePromiseLODs[E].push(n))}return this._loader.logClose(),a}))}_loadMaterialAsync(M,E,b,x,k){return this._nodeIndexLOD?null:Q.LoadExtensionAsync(M,E,this.name,((M,a)=>{let g;const n=this._getLODs(M,E,this._loader.Yi.materials,a.ids);this._loader.logOpen(`${M}`);for(let E=0;E<n.length;E++){const M=n[E];0!==E&&(this._materialIndexLOD=E);const a=this._loader._loadMaterialAsync(`/materials/${M.index}`,M,b,x,(M=>{0===E&&k(M)})).then((M=>{if(0!==E){k(M);const b=n[E-1]._data;b[x]&&(this._disposeMaterials([b[x].babylonMaterial]),delete b[x])}return M}));this._materialPromiseLODs[E]=this._materialPromiseLODs[E]||[],0===E?g=a:(this._materialIndexLOD=null,this._materialPromiseLODs[E].push(a))}return this._loader.logClose(),g}))}_loadUriAsync(M,E,b){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const k=this._nodeIndexLOD-1;return this._nodeSignalLODs[k]=this._nodeSignalLODs[k]||new x,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((()=>this._loader.loadUriAsync(M,E,b)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const k=this._materialIndexLOD-1;return this._materialSignalLODs[k]=this._materialSignalLODs[k]||new x,this._materialSignalLODs[k].promise.then((()=>this._loader.loadUriAsync(M,E,b)))}return null}loadBufferAsync(M,E,b,k){if(this._loader.parent.useRangeRequests&&!E.uri){if(!this._loader.bin)throw new Error(`${M}: Uri is missing or the binary glTF is missing its binary chunk`);const E=(M,E)=>{const a=b,g=a+k-1;let n=M[E];return n?(n.start=Math.min(n.start,a),n.end=Math.max(n.end,g)):(n={start:a,end:g,loaded:new x},M[E]=n),n.loaded.promise.then((M=>new Uint8Array(M.buffer,M.byteOffset+b-n.start,k)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?E(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?E(this._materialBufferLODs,this._materialIndexLOD):E(this._bufferLODs,0)}return null}_loadBufferLOD(M,E){const b=M[E];b&&(this._loader.log(`Loading buffer range [${b.start}-${b.end}]`),this._loader.bin.readAsync(b.start,b.end-b.start+1).then((M=>{b.loaded.resolve(M)}),(M=>{b.loaded.reject(M)})))}_getLODs(M,E,b,x){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const k=[];for(let a=x.length-1;a>=0;a--)if(k.push(e.Get(`${M}/ids/${x[a]}`,b,x[a])),k.length===this.maxLODsToLoad)return k;return k.push(E),k}_disposeTransformNode(M){const E=[],b=M.material;b&&E.push(b);for(const k of M.getChildMeshes())k.material&&E.push(k.material);M.dispose();const x=E.filter((M=>this._loader.babylonScene.meshes.every((E=>E.material!=M))));this._disposeMaterials(x)}_disposeMaterials(M){const E={};for(const b of M){for(const M of b.getActiveTextures())E[M.uniqueId]=M;b.dispose()}for(const b in E)for(const M of this._loader.babylonScene.materials)M.hasTexture(E[b])&&delete E[b];for(const b in E)E[b].dispose()}}G(sE),i(sE,!0,(M=>new qE(M)));const DE="MSFT_minecraftMesh";class zE{constructor(M){this.name=DE,this._loader=M,this.enabled=this._loader.isExtensionUsed(DE)}dispose(){this._loader=null}loadMaterialPropertiesAsync(M,E,b){return Q.LoadExtraAsync(M,E,this.name,((x,k)=>{if(k){if(!(b instanceof N))throw new Error(`${x}: Material type not supported`);const k=this._loader.loadMaterialPropertiesAsync(M,E,b);return b.needAlphaBlending()&&(b.forceDepthWrite=!0,b.separateCullingPass=!0),b.je=b.forceDepthWrite,b.twoSidedLighting=!0,k}return null}))}}G(DE),i(DE,!0,(M=>new zE(M)));const AE="MSFT_sRGBFactors";class YE{constructor(M){this.name=AE,this._loader=M,this.enabled=this._loader.isExtensionUsed(AE)}dispose(){this._loader=null}loadMaterialPropertiesAsync(M,E,b){return Q.LoadExtraAsync(M,E,this.name,((x,k)=>{if(k){if(!(b instanceof N))throw new Error(`${x}: Material type not supported`);const k=this._loader.loadMaterialPropertiesAsync(M,E,b),a=b.va().getEngine().useExactSrgbConversions;return b.albedoTexture||b.albedoColor.toLinearSpaceToRef(b.albedoColor,a),b.reflectivityTexture||b.reflectivityColor.toLinearSpaceToRef(b.reflectivityColor,a),k}return null}))}}G(AE),i(AE,!0,(M=>new YE(M)));var iE,GE=b(1019);!function(M){M[M.Input=0]="Input",M[M.Output=1]="Output"}(iE||(iE={}));class HE{constructor(M,E,b){this._ownerBlock=b,this._connectedPoint=[],this.uniqueId=(0,GE.e)(),this.connectedPointIds=[],this.name=M,this._connectionType=E}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(M){if(this._connectionType===M._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||M._isSingularConnection()&&M._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(M),M._connectedPoint.push(this)}serialize(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};M.uniqueId=this.uniqueId,M.name=this.name,M._connectionType=this._connectionType,M.connectedPointIds=[],M.className=this.getClassName();for(const E of this._connectedPoint)M.connectedPointIds.push(E.uniqueId)}getClassName(){return"FGConnection"}deserialize(M){this.uniqueId=M.uniqueId,this.name=M.name,this._connectionType=M._connectionType,this.connectedPointIds=M.connectedPointIds}static Parse(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},E=arguments.length>1?arguments[1]:void 0;const b=new(g.e.Instantiate(M.className))(M.name,M._connectionType,E);return b.deserialize(M),b}}class eE{constructor(M){this.value=this._toInt(M)}_toInt(M){return 0|M}add(M){return new eE(this.value+M.value)}Qc(M){return new eE(this.value-M.value)}multiply(M){return new eE(Math.imul(this.value,M.value))}divide(M){return new eE(this.value/M.value)}getClassName(){return eE.ClassName}equals(M){return this.value===M.value}static Parse(M){return new eE(M.value)}}eE.ClassName="FlowGraphInteger",(0,U.h)("FlowGraphInteger",eE);class QE{constructor(M,E){this.typeName=M,this.defaultValue=E}serialize(M){M.typeName=this.typeName,M.defaultValue=this.defaultValue}static Parse(M){return new QE(M.typeName,M.defaultValue)}}const LE=new QE("any",void 0),fE=(new QE("string",""),new QE("number",0)),Mb=new QE("boolean",!1),Eb=new QE("Vector2",k.l.Zero()),bb=new QE("Fd",k.m.Zero()),xb=(new QE("Vector4",k.o.Zero()),new QE("Matrix",k.d.Identity())),kb=(new QE("te",a.e.Black()),new QE("ue",new a.h(0,0,0,0)),new QE("Quaternion",k.e.Identity()),new QE("FlowGraphInteger",new eE(0)));class ab extends HE{constructor(M,E,b,x){super(M,E,b),this.richType=x}_isSingularConnection(){return 0===this.connectionType}setValue(M,E){E._setConnectionValue(this,M)}connectTo(M){super.connectTo(M)}_getValueOrDefault(M){return M._hasConnectionValue(this)?M._getConnectionValue(this):this.richType.defaultValue}getValue(M){return 1===this.connectionType?(M._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(M),this._getValueOrDefault(M)):this.isConnected()?this._connectedPoint[0].getValue(M):this._getValueOrDefault(M)}getClassName(){return"FGDataConnection"}serialize(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(M),M.richType={},this.richType.serialize(M.richType)}static Parse(M,E){const b=HE.Parse(M,E);return b.richType=QE.Parse(M.richType),b}}function gb(M){return"Mesh"===M||"AbstractMesh"===M||"GroundMesh"===M||"InstanceMesh"===M||"LinesMesh"===M||"GoldbergMesh"===M||"GreasedLineMesh"===M||"TrailMesh"===M}function nb(M){return"Vector2"===M||"Fd"===M||"Vector4"===M||"Quaternion"===M||"te"===M||"ue"===M}function Jb(M,E,b){var x;const k=(null===E||void 0===E||null===(x=E.getClassName)||void 0===x?void 0:x.call(E))??"";gb(k)?b[M]={name:E.name,className:k}:nb(k)?b[M]={value:E.Vd(),className:k}:b[M]=E}function ub(M,E,b){const x=E[M];let g;const n=null===x||void 0===x?void 0:x.className;return g=gb(n)?b.getMeshByName(x.name):nb(n)?function(M,E){if("Vector2"===M)return k.l.Id(E);if("Fd"===M)return k.m.Id(E);if("Vector4"===M)return k.o.Id(E);if("Quaternion"===M)return k.e.Id(E);if("te"===M)return new a.e(E[0],E[1],E[2]);if("ue"===M)return new a.h(E[0],E[1],E[2],E[3]);throw new Error(`Unknown vector class name ${M}`)}(n,x.value):"Matrix"===n?k.d.Id(x.value):n===eE.ClassName?eE.Parse(x):x&&void 0!==x.value?x.value:x,g}(0,U.h)("FGDataConnection",ab);class Tb{constructor(M){var E;this.config=M,this.uniqueId=(0,GE.e)(),this.name=(null===(E=this.config)||void 0===E?void 0:E.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(M){}registerDataInput(M,E){const b=new ab(M,0,this,E);return this.dataInputs.push(b),b}registerDataOutput(M,E){const b=new ab(M,1,this,E);return this.dataOutputs.push(b),b}getDataInput(M){return this.dataInputs.find((E=>E.name===M))}getDataOutput(M){return this.dataOutputs.find((E=>E.name===M))}serialize(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};M.uniqueId=this.uniqueId,M.config={},this.config&&(M.config.name=this.config.name),M.dataInputs=[],M.dataOutputs=[],M.className=this.getClassName();for(const E of this.dataInputs){const b={};E.serialize(b),M.dataInputs.push(b)}for(const E of this.dataOutputs){const b={};E.serialize(b),M.dataOutputs.push(b)}}getClassName(){return"FGBlock"}static Parse(M,E){const b=g.e.Instantiate(M.className),x={},k=E.valueParseFunction??ub;if(M.config)for(const g in M.config)x[g]=k(g,M.config,E.Ae);var a;("FGSetPropertyBlock"===(a=M.className)||"FGGetPropertyBlock"===a||"FGPlayAnimationBlock"===a||"FGMeshPickEventBlock"===a)&&(x.pathConverter=E.pathConverter);const n=new b(x);n.uniqueId=M.uniqueId;for(let g=0;g<M.dataInputs.length;g++){const E=n.getDataInput(M.dataInputs[g].name);if(!E)throw new Error("Could not find data input with name "+M.dataInputs[g].name+" in block "+M.className);E.deserialize(M.dataInputs[g])}for(let g=0;g<M.dataOutputs.length;g++){const E=n.getDataOutput(M.dataOutputs[g].name);if(!E)throw new Error("Could not find data output with name "+M.dataOutputs[g].name+" in block "+M.className);E.deserialize(M.dataOutputs[g])}return n.metadata=M.metadata,n.deserialize&&n.deserialize(M),n}}class Vb extends HE{_isSingularConnection(){return 1===this.connectionType}_activateSignal(M){var E;0===this.connectionType?(M._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(M,this),M._increaseExecutionId()):null===(E=this._connectedPoint[0])||void 0===E||E._activateSignal(M)}}(0,U.h)("FlowGraphSignalConnection",Vb);class Ib extends Tb{constructor(M){super(M),this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in")}_registerSignalInput(M){const E=new Vb(M,0,this);return this.signalInputs.push(E),E}_registerSignalOutput(M){const E=new Vb(M,1,this);return this.signalOutputs.push(E),E}getSignalInput(M){return this.signalInputs.find((E=>E.name===M))}getSignalOutput(M){return this.signalOutputs.find((E=>E.name===M))}serialize(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(M),M.signalInputs=[],M.signalOutputs=[];for(const E of this.signalInputs){const b={};E.serialize(b),M.signalInputs.push(b)}for(const E of this.signalOutputs){const b={};E.serialize(b),M.signalOutputs.push(b)}}deserialize(M){for(let E=0;E<M.signalInputs.length;E++){const b=this.getSignalInput(M.signalInputs[E].name);if(!b)throw new Error("Could not find signal input with name "+M.signalInputs[E].name+" in block "+M.className);b.deserialize(M.signalInputs[E])}for(let E=0;E<M.signalOutputs.length;E++){const b=this.getSignalOutput(M.signalOutputs[E].name);if(!b)throw new Error("Could not find signal output with name "+M.signalOutputs[E].name+" in block "+M.className);b.deserialize(M.signalOutputs[E])}}getClassName(){return"FGExecutionBlock"}}class tb extends Ib{constructor(M){super(M),this.out=this._registerSignalOutput("out"),this.done=this._registerSignalOutput("done")}_startPendingTasks(M){this._preparePendingTasks(M),M._addPendingBlock(this)}}class yb extends tb{_execute(M){M._notifyExecuteNode(this),this.out._activateSignal(M)}}class Bb{constructor(M){this.uniqueId=(0,GE.e)(),this._userVariables={},this._executionVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new T.b,this._configuration=M}hasVariable(M){return M in this._userVariables}setVariable(M,E){this._userVariables[M]=E}getVariable(M){return this._userVariables[M]}get userVariables(){return this._userVariables}_getUniqueIdPrefixedName(M,E){return`${M.uniqueId}_${E}`}_setExecutionVariable(M,E,b){this._executionVariables[this._getUniqueIdPrefixedName(M,E)]=b}_getExecutionVariable(M,E,b){return this._hasExecutionVariable(M,E)?this._executionVariables[this._getUniqueIdPrefixedName(M,E)]:b}_deleteExecutionVariable(M,E){delete this._executionVariables[this._getUniqueIdPrefixedName(M,E)]}_hasExecutionVariable(M,E){return this._getUniqueIdPrefixedName(M,E)in this._executionVariables}_hasConnectionValue(M){return M.uniqueId in this._connectionValues}_setConnectionValue(M,E){this._connectionValues[M.uniqueId]=E}_getConnectionValue(M){return this._connectionValues[M.uniqueId]}get configuration(){return this._configuration}_addPendingBlock(M){this._pendingBlocks.push(M)}_removePendingBlock(M){const E=this._pendingBlocks.indexOf(M);-1!==E&&this._pendingBlocks.splice(E,1)}_clearPendingBlocks(){for(const M of this._pendingBlocks)M._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(M){this.onNodeExecutedObservable.notifyObservers(M)}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Jb;M.uniqueId=this.uniqueId,M._userVariables={};for(const b in this._userVariables)E(b,this._userVariables[b],M._userVariables);M._connectionValues={};for(const b in this._connectionValues)E(b,this._connectionValues[b],M._connectionValues)}getClassName(){return"FGContext"}static Parse(M,E){const b=E.graph.createContext(),x=E.valueParseFunction??ub;b.uniqueId=M.uniqueId;for(const k in M._userVariables){const E=x(k,M._userVariables,b._configuration.Ae);b._userVariables[k]=E}for(const k in M._connectionValues){const E=x(k,M._connectionValues,b._configuration.Ae);b._connectionValues[k]=E}return b}}(0,R.d)([(0,w.E)()],Bb.prototype,"uniqueId",void 0);var rb,cb,Cb=b(1269);function Rb(M,E){return!(!M.parent||M.parent!==E&&!Rb(M.parent,E))}class wb extends yb{constructor(M){super(M),this.config=M}_getReferencedMesh(){const M=this.config.pathConverter.convert(this.config.path),E=M.info.getObject(M.object);if(!E||!(E instanceof p.d))throw new Error("Mesh pick event block requires a valid mesh");return E}_preparePendingTasks(M){let E=M._getExecutionVariable(this,"meshPickObserver");if(!E){const b=this._getReferencedMesh();M._setExecutionVariable(this,"mesh",b),E=b.va().onPointerObservable.add((E=>{var x,k,a;E.type===Cb.d.POINTERPICK&&null!==(x=E.pickInfo)&&void 0!==x&&x.pickedMesh&&((null===(k=E.pickInfo)||void 0===k?void 0:k.pickedMesh)===b||Rb(null===(a=E.pickInfo)||void 0===a?void 0:a.pickedMesh,b))&&this._execute(M)}));const x=b.Rd.add((()=>this._onDispose));M._setExecutionVariable(this,"meshPickObserver",E),M._setExecutionVariable(this,"meshDisposeObserver",x)}}_onDispose(M){this._cancelPendingTasks(M),M._removePendingBlock(this)}_cancelPendingTasks(M){const E=M._getExecutionVariable(this,"mesh"),b=M._getExecutionVariable(this,"meshPickObserver"),x=M._getExecutionVariable(this,"meshDisposeObserver");E.va().onPointerObservable.remove(b),E.Rd.remove(x),M._deleteExecutionVariable(this,"mesh"),M._deleteExecutionVariable(this,"meshPickObserver"),M._deleteExecutionVariable(this,"meshDisposeObserver")}getClassName(){return wb.ClassName}serialize(M){super.serialize(M),M.config.path=this.config.path}}wb.ClassName="FGMeshPickEventBlock",(0,U.h)(wb.ClassName,wb),function(M){M[M.Stopped=0]="Stopped",M[M.Started=1]="Started"}(rb||(rb={}));class Sb{constructor(M){this._eventBlocks=[],this._executionContexts=[],this.state=0,this._scene=M.Ae,this._coordinator=M.coordinator,this._sceneDisposeObserver=this._scene.Rd.add((()=>this.dispose()))}createContext(){const M=new Bb({Ae:this._scene,coordinator:this._coordinator});return this._executionContexts.push(M),M}getContext(M){return this._executionContexts[M]}addEventBlock(M){this._eventBlocks.push(M)}start(){if(1!==this.state){this.state=1,0===this._executionContexts.length&&this.createContext();for(const M of this._executionContexts){const E=this._getContextualOrder();for(const b of E)b._startPendingTasks(M)}}}_getContextualOrder(){const M=[];for(const E of this._eventBlocks)if(E.getClassName()===wb.ClassName){const b=E._getReferencedMesh();let x=0;for(;x<M.length;x++){const E=M[x]._getReferencedMesh();if(b&&E&&Rb(b,E))break}M.splice(x,0,E)}else M.push(E);return M}dispose(){if(0!==this.state){this.state=0;for(const M of this._executionContexts)M._clearPendingBlocks();this._executionContexts.length=0,this._eventBlocks.length=0,this._scene.Rd.remove(this._sceneDisposeObserver),this._sceneDisposeObserver=null}}visitAllBlocks(M){const E=[],b=new Set;for(const x of this._eventBlocks)E.push(x),b.add(x.uniqueId);for(;E.length>0;){const x=E.pop();M(x);for(const M of x.dataInputs)for(const x of M._connectedPoint)b.has(x._ownerBlock.uniqueId)||(E.push(x._ownerBlock),b.add(x._ownerBlock.uniqueId));if(x instanceof Ib)for(const M of x.signalOutputs)for(const x of M._connectedPoint)b.has(x._ownerBlock.uniqueId)||(E.push(x._ownerBlock),b.add(x._ownerBlock.uniqueId))}}serialize(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},E=arguments.length>1?arguments[1]:void 0;M.allBlocks=[],this.visitAllBlocks((E=>{const b={};E.serialize(b),M.allBlocks.push(b)})),M.executionContexts=[];for(const b of this._executionContexts){const x={};b.serialize(x,E),M.executionContexts.push(x)}}static GetDataOutConnectionByUniqueId(M,E){for(const b of M)for(const M of b.dataOutputs)if(M.uniqueId===E)return M;throw new Error("Could not find data out connection with unique id "+E)}static GetSignalInConnectionByUniqueId(M,E){for(const b of M)if(b instanceof Ib)for(const M of b.signalInputs)if(M.uniqueId===E)return M;throw new Error("Could not find signal in connection with unique id "+E)}static Parse(M,E){const b=E.coordinator.createGraph(),x=[],k=E.valueParseFunction??ub;for(const a of M.allBlocks){const M=Tb.Parse(a,{Ae:E.coordinator.config.Ae,pathConverter:E.pathConverter,valueParseFunction:k});x.push(M),M instanceof yb&&b.addEventBlock(M)}for(const a of x){for(const M of a.dataInputs)for(const E of M.connectedPointIds){const b=Sb.GetDataOutConnectionByUniqueId(x,E);M.connectTo(b)}if(a instanceof Ib)for(const M of a.signalOutputs)for(const E of M.connectedPointIds){const b=Sb.GetSignalInConnectionByUniqueId(x,E);M.connectTo(b)}}for(const a of M.executionContexts)Bb.Parse(a,{graph:b,valueParseFunction:k});return b}}class Xb{constructor(M){this.config=M,this._flowGraphs=[],this._customEventsMap=new Map,this.config.Ae.Rd.add((()=>{this.dispose()}));(Xb.SceneCoordinators.get(this.config.Ae)??[]).push(this)}createGraph(){const M=new Sb({Ae:this.config.Ae,coordinator:this});return this._flowGraphs.push(M),M}removeGraph(M){const E=this._flowGraphs.indexOf(M);-1!==E&&(M.dispose(),this._flowGraphs.splice(E,1))}start(){this._flowGraphs.forEach((M=>M.start()))}dispose(){this._flowGraphs.forEach((M=>M.dispose())),this._flowGraphs.length=0;const M=Xb.SceneCoordinators.get(this.config.Ae)??[],E=M.indexOf(this);-1!==E&&M.splice(E,1)}serialize(M,E){M._flowGraphs=[],this._flowGraphs.forEach((b=>{const x={};b.serialize(x,E),M._flowGraphs.push(x)}))}static Parse(M,E){var b;const x=E.valueParseFunction??ub,k=new Xb({Ae:E.Ae});return null===(b=M._flowGraphs)||void 0===b||b.forEach((M=>{Sb.Parse(M,{coordinator:k,valueParseFunction:x,pathConverter:E.pathConverter})})),k}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(M){let E=this._customEventsMap.get(M);return E||(E=new T.b,this._customEventsMap.set(M,E)),E}notifyCustomEvent(M,E){const b=this._customEventsMap.get(M);b&&b.notifyObservers(E)}}Xb.SceneCoordinators=new Map;class Ub extends yb{_preparePendingTasks(M){if(!M._getExecutionVariable(this,"sceneReadyObserver")){const E=M.configuration.Ae.onReadyObservable.add((()=>{this._execute(M)}));M._setExecutionVariable(this,"sceneReadyObserver",E)}}_cancelPendingTasks(M){const E=M._getExecutionVariable(this,"sceneReadyObserver");M.configuration.Ae.onReadyObservable.remove(E),M._deleteExecutionVariable(this,"sceneReadyObserver")}getClassName(){return Ub.ClassName}}Ub.ClassName="FGSceneReadyEventBlock",(0,U.h)("FGSceneReadyEventBlock",Ub);class vb extends yb{_preparePendingTasks(M){if(!M._getExecutionVariable(this,"sceneBeforeRender")){const E=M.configuration.Ae.onBeforeRenderObservable.add((()=>{this._execute(M)}));M._setExecutionVariable(this,"sceneBeforeRender",E)}}_cancelPendingTasks(M){const E=M._getExecutionVariable(this,"sceneBeforeRender");M.configuration.Ae.onBeforeRenderObservable.remove(E),M._deleteExecutionVariable(this,"sceneBeforeRender")}getClassName(){return vb.ClassName}}vb.ClassName="FGSceneTickEventBlock",(0,U.h)(vb.ClassName,vb);class Nb extends Ib{constructor(M){super(M),this.out=this._registerSignalOutput("out")}}class Kb extends Nb{constructor(M){super(M),this.message=this.registerDataInput("message",LE)}_execute(M){const E=this.message.getValue(M);B.d.Log(E),this.out._activateSignal(M)}getClassName(){return Kb.ClassName}}Kb.ClassName="FGConsoleLogBlock",(0,U.h)(Kb.ClassName,Kb),function(M){M[M.INIT=0]="INIT",M[M.STARTED=1]="STARTED",M[M.ENDED=2]="ENDED"}(cb||(cb={}));class hb{constructor(M){this.onEachCountObservable=new T.b,this.onTimerAbortedObservable=new T.b,this.onTimerEndedObservable=new T.b,this.onStateChangedObservable=new T.b,this._observer=null,this._breakOnNextTick=!1,this._tick=M=>{const E=Date.now();this._timer=E-this._startTime;const b={startTime:this._startTime,currentTime:E,deltaTime:this._timer,completeRate:this._timer/this._timeToEnd,payload:M},x=this._breakOnNextTick||this._breakCondition(b);x||this._timer>=this._timeToEnd?this._stop(b,x):this.onEachCountObservable.notifyObservers(b)},this._setState(0),this._contextObservable=M.contextObservable,this._observableParameters=M.observableParameters??{},this._breakCondition=M.breakCondition??(()=>!1),this._timeToEnd=M.timeout,M.onEnded&&this.onTimerEndedObservable.add(M.onEnded),M.pi&&this.onEachCountObservable.add(M.pi),M.onAborted&&this.onTimerAbortedObservable.add(M.onAborted)}set breakCondition(M){this._breakCondition=M}clearObservables(){this.onEachCountObservable.clear(),this.onTimerAbortedObservable.clear(),this.onTimerEndedObservable.clear(),this.onStateChangedObservable.clear()}start(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._timeToEnd;if(1===this._state)throw new Error("Timer already started. Please stop it before starting again");this._timeToEnd=M,this._startTime=Date.now(),this._timer=0,this._observer=this._contextObservable.add(this._tick,this._observableParameters.mask,this._observableParameters.insertFirst,this._observableParameters.scope),this._setState(1)}stop(){1===this._state&&(this._breakOnNextTick=!0)}dispose(){this._observer&&this._contextObservable.remove(this._observer),this.clearObservables()}_setState(M){this._state=M,this.onStateChangedObservable.notifyObservers(this._state)}_stop(M){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._contextObservable.remove(this._observer),this._setState(2),E?this.onTimerAbortedObservable.notifyObservers(M):this.onTimerEndedObservable.notifyObservers(M)}}class Zb extends tb{constructor(M){super(M),this.timeout=this.registerDataInput("timeout",fE)}_preparePendingTasks(M){const E=this.timeout.getValue(M);if(void 0!==E&&E>=0){const b=M._getExecutionVariable(this,"runningTimers")||[],x=M.configuration.Ae,k=new hb({timeout:E,contextObservable:x.onBeforeRenderObservable,onEnded:()=>this._onEnded(k,M)});k.start(),b.push(k),M._setExecutionVariable(this,"runningTimers",b)}}_execute(M){this._startPendingTasks(M),this.out._activateSignal(M)}_onEnded(M,E){const b=E._getExecutionVariable(this,"runningTimers")||[],x=b.indexOf(M);-1!==x?b.splice(x,1):g.e.Warn("FlowGraphTimerBlock: Timer ended but was not found in the running timers list"),E._removePendingBlock(this),this.done._activateSignal(E)}_cancelPendingTasks(M){const E=M._getExecutionVariable(this,"runningTimers")||[];for(const b of E)b.dispose();M._deleteExecutionVariable(this,"runningTimers")}getClassName(){return Zb.ClassName}}Zb.ClassName="FGTimerBlock",(0,U.h)("FGTimerBlock",Zb);class Ob extends Nb{constructor(M){super(M),this.config=M;for(let E=0;E<this.config.eventData.length;E++){const M=this.config.eventData[E];this.registerDataInput(M,LE)}}_execute(M){const E=this.config.eventId,b=this.dataInputs.map((E=>E.getValue(M)));M.configuration.coordinator.notifyCustomEvent(E,b),this.out._activateSignal(M)}getClassName(){return Ob.ClassName}}Ob.ClassName="FGSendCustomEventBlock",(0,U.h)("FGSendCustomEventBlock",Ob);class pb extends yb{constructor(M){super(M),this.config=M;for(let E=0;E<this.config.eventData.length;E++){const M=this.config.eventData[E];this.registerDataOutput(M,LE)}}_preparePendingTasks(M){const E=M.configuration.coordinator.getCustomEventObservable(this.config.eventId);this._eventObserver=E.add((E=>{for(let b=0;b<E.length;b++)this.dataOutputs[b].setValue(E[b],M);this._execute(M)}))}_cancelPendingTasks(M){const E=M.configuration.coordinator.getCustomEventObservable(this.config.eventId);E?E.remove(this._eventObserver):g.e.Warn(`FlowGraphReceiveCustomEventBlock: Missing observable for event ${this.config.eventId}`)}getClassName(){return pb.ClassName}serialize(M){super.serialize(M),M.eventId=this.config.eventId,M.eventData=this.config.eventData}}pb.ClassName="FGReceiveCustomEventBlock",(0,U.h)(pb.ClassName,pb);class Pb extends Ib{constructor(M){super(M),this.config=M,this.outFlows=[];for(let E=0;E<this.config.numberOutputFlows;E++)this.outFlows.push(this._registerSignalOutput(`${E}`))}_execute(M){for(let E=0;E<this.config.numberOutputFlows;E++)this.outFlows[E]._activateSignal(M)}getClassName(){return Pb.ClassName}}Pb.ClassName="FGSequenceBlock",(0,U.h)(Pb.ClassName,Pb);const Fb=new RegExp(/\{(\w+)\}/g);class lb{constructor(M,E){this.path=M,this.ownerBlock=E,this.templatedInputs=[];let b=Fb.exec(M);for(;b;){const[,x]=b;this.templatedInputs.push(E.registerDataInput(x,kb)),b=Fb.exec(M)}}getAccessor(M,E){let b=this.path;for(const x of this.templatedInputs){const M=x.getValue(E).value;b=b.replace(`{${x.name}}`,M.toString())}return M.convert(b)}}class db extends Tb{constructor(M){super(M),this.config=M,this.value=this.registerDataOutput("value",LE),this.templateComponent=new lb(M.path,this)}_updateOutputs(M){const E=this.templateComponent.getAccessor(this.config.pathConverter,M),b=E.info.get(E.object);this.value.setValue(b,M)}getClassName(){return db.ClassName}serialize(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(M),M.config.path=this.config.path}}db.ClassName="FGGetPropertyBlock",(0,U.h)(db.ClassName,db);class Wb extends Nb{constructor(M){super(M),this.config=M,this.a=this.registerDataInput("a",LE),this.templateComponent=new lb(M.path,this)}_execute(M){const E=this.a.getValue(M),b=this.templateComponent.getAccessor(this.config.pathConverter,M);b.info.set(E,b.object),this.out._activateSignal(M)}serialize(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(M),M.config.path=this.config.path}getClassName(){return Wb.ClassName}}Wb.ClassName="FGSetPropertyBlock",(0,U.h)("FGSetPropertyBlock",Wb);const mb="cachedOperationValue",ob="cachedExecutionId";class jb extends Tb{constructor(M,E){super(E),this.value=this.registerDataOutput("value",M)}_updateOutputs(M){const E=M._getExecutionVariable(this,ob),b=M._getExecutionVariable(this,mb);if(void 0!==b&&E===M.executionId)this.value.setValue(b,M);else{const E=this._doOperation(M);M._setExecutionVariable(this,mb,E),M._setExecutionVariable(this,ob,M.executionId),this.value.setValue(E,M)}}}class sb extends jb{constructor(M,E,b,x,k,a){super(b,a),this._operation=x,this._className=k,this.a=this.registerDataInput("a",M),this.b=this.registerDataInput("b",E)}_doOperation(M){return this._operation(this.a.getValue(M),this.b.getValue(M))}getClassName(){return this._className}}class qb extends jb{constructor(M,E,b,x){super(M,x),this._operation=E,this._className=b}_doOperation(M){return this._operation()}getClassName(){return this._className}}class Db extends jb{constructor(M,E,b,x,k){super(E,k),this._operation=b,this._className=x,this.a=this.registerDataInput("a",M)}_doOperation(M){return this._operation(this.a.getValue(M))}getClassName(){return this._className}}class zb extends jb{constructor(M,E,b,x,k,a,g){super(x,g),this._operation=k,this._className=a,this.a=this.registerDataInput("a",M),this.b=this.registerDataInput("b",E),this.c=this.registerDataInput("c",b)}_doOperation(M){return this._operation(this.a.getValue(M),this.b.getValue(M),this.c.getValue(M))}getClassName(){return this._className}}function Ab(M){return M.getClassName?M.getClassName():""}function Yb(M,E){return"Vector2"===M&&"Vector2"===E||"Fd"===M&&"Fd"===E||"Vector4"===M&&"Vector4"===E}function ib(M,E){return"Matrix"===M&&"Matrix"===E}function Gb(M,E){return"FlowGraphInteger"===M&&"FlowGraphInteger"===E}class Hb extends sb{constructor(M){super(LE,LE,LE,((M,E)=>this._polymorphicAdd(M,E)),Hb.ClassName,M)}_polymorphicAdd(M,E){const b=Ab(M),x=Ab(E);return Yb(b,x)||ib(b,x)||Gb(b,x)?M.add(E):M+E}}Hb.ClassName="FGAddBlock",(0,U.h)(Hb.ClassName,Hb);class eb extends sb{constructor(M){super(LE,LE,LE,((M,E)=>this._polymorphicAdd(M,E)),eb.ClassName,M)}_polymorphicAdd(M,E){const b=Ab(M),x=Ab(E);return Yb(b,x)||Gb(b,x)?M.Qc(E):ib(b,x)?M.add(E.scale(-1)):M-E}}eb.ClassName="FGSubBlock",(0,U.h)(eb.ClassName,eb);class Qb extends sb{constructor(M){super(LE,LE,LE,((M,E)=>this._polymorphicMultiply(M,E)),Qb.ClassName,M)}_polymorphicMultiply(M,E){const b=Ab(M),x=Ab(E);return Yb(b,x)||Gb(b,x)?M.multiply(E):ib(b,x)?k.d.FromValues(M.m[0]*E.m[0],M.m[4]*E.m[4],M.m[8]*E.m[8],M.m[12]*E.m[12],M.m[1]*E.m[1],M.m[5]*E.m[5],M.m[9]*E.m[9],M.m[13]*E.m[13],M.m[2]*E.m[2],M.m[6]*E.m[6],M.m[10]*E.m[10],M.m[14]*E.m[14],M.m[3]*E.m[3],M.m[7]*E.m[7],M.m[11]*E.m[11],M.m[15]*E.m[15]):M*E}}Qb.ClassName="FGMultiplyBlock",(0,U.h)(Qb.ClassName,Qb);class Lb extends sb{constructor(M){super(LE,LE,LE,((M,E)=>this._polymorphicDivide(M,E)),Lb.ClassName,M)}_polymorphicDivide(M,E){const b=Ab(M),x=Ab(E);return Yb(b,x)||Gb(b,x)?M.divide(E):ib(b,x)?k.d.FromValues(M.m[0]/E.m[0],M.m[4]/E.m[4],M.m[8]/E.m[8],M.m[12]/E.m[12],M.m[1]/E.m[1],M.m[5]/E.m[5],M.m[9]/E.m[9],M.m[13]/E.m[13],M.m[2]/E.m[2],M.m[6]/E.m[6],M.m[10]/E.m[10],M.m[14]/E.m[14],M.m[3]/E.m[3],M.m[7]/E.m[7],M.m[11]/E.m[11],M.m[15]/E.m[15]):M/E}}Lb.ClassName="FGDivideBlock",(0,U.h)(Lb.ClassName,Lb);class fb extends qb{constructor(M){super(fE,(()=>Math.random()),fb.ClassName,M)}}fb.ClassName="FGRandomBlock",(0,U.h)(fb.ClassName,fb);class Mx extends sb{constructor(M){super(LE,LE,fE,((M,E)=>this._polymorphicDot(M,E)),Mx.ClassName,M)}_polymorphicDot(M,E){switch(Ab(M)){case"Vector2":return k.l.Dot(M,E);case"Fd":return k.m.Dot(M,E);case"Vector4":return k.o.Dot(M,E);default:throw new Error(`Cannot get dot product of ${M} and ${E}`)}}}Mx.ClassName="FGDotBlock",(0,U.h)(Mx.ClassName,Mx);class Ex extends qb{constructor(M){super(fE,(()=>Math.E),Ex.ClassName,M)}}Ex.ClassName="FGEBlock",(0,U.h)(Ex.ClassName,Ex);class bx extends qb{constructor(M){super(fE,(()=>Math.PI),bx.ClassName,M)}}bx.ClassName="FGPIBlock",(0,U.h)(bx.ClassName,bx);class xx extends qb{constructor(M){super(fE,(()=>Number.POSITIVE_INFINITY),xx.ClassName,M)}}xx.ClassName="FGInfBlock",(0,U.h)(xx.ClassName,xx);class kx extends qb{constructor(M){super(fE,(()=>Number.NaN),kx.ClassName,M)}}function ax(M,E){switch(Ab(M)){case"FlowGraphInteger":return new eE(E(M.value));case"Vector2":return new k.l(E(M.x),E(M.y));case"Fd":return new k.m(E(M.x),E(M.y),E(M.z));case"Vector4":return new k.o(E(M.x),E(M.y),E(M.z),E(M.w));case"Matrix":return k.d.FromValues(E(M.m[0]),E(M.m[4]),E(M.m[8]),E(M.m[12]),E(M.m[1]),E(M.m[5]),E(M.m[9]),E(M.m[13]),E(M.m[2]),E(M.m[6]),E(M.m[10]),E(M.m[14]),E(M.m[3]),E(M.m[7]),E(M.m[11]),E(M.m[15]));default:return E(M)}}kx.ClassName="FGNaNBlock",(0,U.h)(kx.ClassName,kx);class gx extends Db{constructor(M){super(LE,LE,(M=>this._polymorphicAbs(M)),gx.ClassName,M)}_polymorphicAbs(M){return ax(M,Math.abs)}}gx.ClassName="FGAbsBlock",(0,U.h)(gx.ClassName,gx);class nx extends Db{constructor(M){super(LE,LE,(M=>this._polymorphicSign(M)),nx.ClassName,M)}_polymorphicSign(M){return ax(M,Math.sign)}}nx.ClassName="FGSignBlock",(0,U.h)(nx.ClassName,nx);class Jx extends Db{constructor(M){super(LE,LE,(M=>this._polymorphicTrunc(M)),Jx.ClassName,M)}_polymorphicTrunc(M){return ax(M,Math.trunc)}}Jx.ClassName="FGTruncBlock",(0,U.h)(Jx.ClassName,Jx);class ux extends Db{constructor(M){super(LE,LE,(M=>this._polymorphicFloor(M)),ux.ClassName,M)}_polymorphicFloor(M){return ax(M,Math.floor)}}ux.ClassName="FGFloorBlock",(0,U.h)(ux.ClassName,ux);class Tx extends Db{constructor(M){super(LE,LE,(M=>this._polymorphicCeiling(M)),Tx.ClassName,M)}_polymorphicCeiling(M){return ax(M,Math.ceil)}}Tx.ClassName="FGCeilBlock",(0,U.h)(Tx.ClassName,Tx);class Vx extends Db{constructor(M){super(LE,LE,(M=>this._polymorphicFract(M)),Vx.ClassName,M)}_polymorphicFract(M){return ax(M,(M=>M-Math.floor(M)))}}Vx.ClassName="FGFractBlock",(0,U.h)(Vx.ClassName,Vx);class Ix extends Db{constructor(M){super(LE,LE,(M=>this._polymorphicNeg(M)),Ix.ClassName,M)}_polymorphicNeg(M){return ax(M,(M=>-M))}}function tx(M,E,b){switch(Ab(M)){case"FlowGraphInteger":return new eE(b(M.value,E.value));case"Vector2":return new k.l(b(M.x,E.x),b(M.y,E.y));case"Fd":return new k.m(b(M.x,E.x),b(M.y,E.y),b(M.z,E.z));case"Vector4":return new k.o(b(M.x,E.x),b(M.y,E.y),b(M.z,E.z),b(M.w,E.w));case"Matrix":return k.d.FromValues(b(M.m[0],E.m[0]),b(M.m[4],E.m[4]),b(M.m[8],E.m[8]),b(M.m[12],E.m[12]),b(M.m[1],E.m[1]),b(M.m[5],E.m[5]),b(M.m[9],E.m[9]),b(M.m[13],E.m[13]),b(M.m[2],E.m[2]),b(M.m[6],E.m[6]),b(M.m[10],E.m[10]),b(M.m[14],E.m[14]),b(M.m[3],E.m[3]),b(M.m[7],E.m[7]),b(M.m[11],E.m[11]),b(M.m[15],E.m[15]));default:return b(M,E)}}Ix.ClassName="FGNegBlock",(0,U.h)(Ix.ClassName,Ix);class yx extends sb{constructor(M){super(LE,LE,LE,((M,E)=>this._polymorphicRemainder(M,E)),yx.ClassName,M)}_polymorphicRemainder(M,E){return tx(M,E,((M,E)=>M%E))}}yx.ClassName="FGRemainderBlock",(0,U.h)(yx.ClassName,yx);class Bx extends sb{constructor(M){super(LE,LE,LE,((M,E)=>this._polymorphicMin(M,E)),Bx.ClassName,M)}_polymorphicMin(M,E){return tx(M,E,Math.min)}}Bx.ClassName="FGMinBlock",(0,U.h)(Bx.ClassName,Bx);class rx extends sb{constructor(M){super(LE,LE,LE,((M,E)=>this._polymorphicMax(M,E)),rx.ClassName,M)}_polymorphicMax(M,E){return tx(M,E,Math.max)}}function cx(M,E,b){return Math.min(Math.max(M,Math.min(E,b)),Math.max(E,b))}function Cx(M,E,b,x){switch(Ab(M)){case"FlowGraphInteger":return new eE(x(M.value,E.value,b.value));case"Vector2":return new k.l(x(M.x,E.x,b.x),x(M.y,E.y,b.y));case"Fd":return new k.m(x(M.x,E.x,b.x),x(M.y,E.y,b.y),x(M.z,E.z,b.z));case"Vector4":return new k.o(x(M.x,E.x,b.x),x(M.y,E.y,b.y),x(M.z,E.z,b.z),x(M.w,E.w,b.w));case"Matrix":return k.d.FromValues(x(M.m[0],E.m[0],b.m[0]),x(M.m[4],E.m[4],b.m[4]),x(M.m[8],E.m[8],b.m[8]),x(M.m[12],E.m[12],b.m[12]),x(M.m[1],E.m[1],b.m[1]),x(M.m[5],E.m[5],b.m[5]),x(M.m[9],E.m[9],b.m[9]),x(M.m[13],E.m[13],b.m[13]),x(M.m[2],E.m[2],b.m[2]),x(M.m[6],E.m[6],b.m[6]),x(M.m[10],E.m[10],b.m[10]),x(M.m[14],E.m[14],b.m[14]),x(M.m[3],E.m[3],b.m[3]),x(M.m[7],E.m[7],b.m[7]),x(M.m[11],E.m[11],b.m[11]),x(M.m[15],E.m[15],b.m[15]));default:return x(M,E,b)}}rx.ClassName="FGMaxBlock",(0,U.h)(rx.ClassName,rx);class Rx extends zb{constructor(M){super(LE,LE,LE,LE,((M,E,b)=>this._polymorphicClamp(M,E,b)),Rx.ClassName,M)}_polymorphicClamp(M,E,b){return Cx(M,E,b,cx)}}function wx(M){return Math.min(Math.max(M,0),1)}Rx.ClassName="FGClampBlock",(0,U.h)(Rx.ClassName,Rx);class Sx extends Db{constructor(M){super(LE,LE,(M=>this._polymorphicSaturate(M)),Sx.ClassName,M)}_polymorphicSaturate(M){return ax(M,wx)}}Sx.ClassName="FGSaturateBlock",(0,U.h)(Sx.ClassName,Sx);class Xx extends zb{constructor(M){super(LE,LE,LE,LE,((M,E,b)=>this._polymorphicInterpolate(M,E,b)),Xx.ClassName,M)}_interpolate(M,E,b){return(1-b)*M+b*E}_polymorphicInterpolate(M,E,b){return Cx(M,E,b,this._interpolate)}}Xx.ClassName="FGInterpolateBlock",(0,U.h)(Xx.ClassName,Xx);class Ux extends sb{constructor(M){super(LE,LE,Mb,((M,E)=>this._polymorphicEq(M,E)),Ux.ClassName,M)}_polymorphicEq(M,E){const b=Ab(M),x=Ab(E);return Yb(b,x)||ib(b,x)||Gb(b,x)?M.equals(E):M===E}}function vx(M,E,b){const x=Ab(M);if(x===Ab(E)){if(""===x)return b(M,E);if("FlowGraphInteger"===x)return b(M.value,E.value);throw new Error(`Cannot compare ${M} and ${E}`)}throw new Error(`${M} and ${E} are of different types.`)}Ux.ClassName="FGEqBlock",(0,U.h)(Ux.ClassName,Ux);class Nx extends sb{constructor(M){super(LE,LE,Mb,((M,E)=>this._polymorphicLessThan(M,E)),Nx.ClassName,M)}_polymorphicLessThan(M,E){return vx(M,E,((M,E)=>M<E))}}Nx.ClassName="FGLessThanBlock",(0,U.h)(Nx.ClassName,Nx);class Kx extends sb{constructor(M){super(LE,LE,Mb,((M,E)=>this._polymorphicLessThanOrEqual(M,E)),Kx.ClassName,M)}_polymorphicLessThanOrEqual(M,E){return vx(M,E,((M,E)=>M<=E))}}Kx.ClassName="FGLessThanOrEqualBlock";class hx extends sb{constructor(M){super(LE,LE,Mb,((M,E)=>this._polymorphicGreaterThan(M,E)),hx.ClassName,M)}_polymorphicGreaterThan(M,E){return vx(M,E,((M,E)=>M>E))}}hx.ClassName="FGGreaterThanBlock",(0,U.h)(hx.ClassName,hx);class Zx extends sb{constructor(M){super(LE,LE,Mb,((M,E)=>this._polymorphicGreaterThanOrEqual(M,E)),Zx.ClassName,M)}_polymorphicGreaterThanOrEqual(M,E){return vx(M,E,((M,E)=>M>=E))}}Zx.ClassName="FGGreaterThanOrEqualBlock",(0,U.h)(Zx.ClassName,Zx);class Ox extends Db{constructor(M){super(LE,Mb,(M=>this._polymorphicIsNan(M)),Ox.ClassName,M)}_polymorphicIsNan(M){const E=Ab(M);if(""===E)return isNaN(M);if("FlowGraphInteger"===E)return isNaN(M.value);throw new Error(`Cannot get NaN of ${M}`)}}Ox.ClassName="FGIsNanBlock",(0,U.h)(Ox.ClassName,Ox);class px extends Db{constructor(M){super(LE,Mb,(M=>this._polymorphicIsInf(M)),px.ClassName,M)}_polymorphicIsInf(M){const E=Ab(M);if(""===E)return!isFinite(M);if("FlowGraphInteger"===E)return!isFinite(M.value);throw new Error(`Cannot get isInf of ${M}`)}}px.ClassName="FGIsInfBlock";class Px extends Db{constructor(M){super(LE,LE,(M=>this._polymorphicDegToRad(M)),Px.ClassName,M)}_degToRad(M){return M*Math.PI/180}_polymorphicDegToRad(M){return ax(M,this._degToRad)}}Px.ClassName="FGDegToRadBlock",(0,U.h)(Px.ClassName,Px);class Fx extends Db{constructor(M){super(LE,LE,(M=>this._polymorphicRadToDeg(M)),Fx.ClassName,M)}_radToDeg(M){return 180*M/Math.PI}_polymorphicRadToDeg(M){return ax(M,this._radToDeg)}}Fx.ClassName="FGRadToDegBlock",(0,U.h)(Fx.ClassName,Fx);class lx extends Db{constructor(M){super(LE,LE,(M=>this._polymorphicSin(M)),lx.ClassName,M)}_polymorphicSin(M){return ax(M,Math.sin)}}lx.ClassName="FGSinBlock",(0,U.h)(lx.ClassName,lx);class dx extends Db{constructor(M){super(LE,LE,(M=>this._polymorphicCos(M)),dx.ClassName,M)}_polymorphicCos(M){return ax(M,Math.cos)}}dx.ClassName="FGCosBlock",(0,U.h)(dx.ClassName,dx);class Wx extends Db{constructor(M){super(LE,LE,(M=>this._polymorphicTan(M)),Wx.ClassName,M)}_polymorphicTan(M){return ax(M,Math.tan)}}Wx.ClassName="FGTanBlock",(0,U.h)(Wx.ClassName,Wx);class mx extends Db{constructor(M){super(LE,LE,(M=>this._polymorphicAsin(M)),mx.ClassName,M)}_polymorphicAsin(M){return ax(M,Math.asin)}}mx.ClassName="FGAsinBlock",(0,U.h)(mx.ClassName,mx);class ox extends Db{constructor(M){super(LE,LE,(M=>this._polymorphicAcos(M)),ox.ClassName,M)}_polymorphicAcos(M){return ax(M,Math.acos)}}ox.ClassName="FGAcosBlock",(0,U.h)(ox.ClassName,ox);class jx extends Db{constructor(M){super(LE,LE,(M=>this._polymorphicAtan(M)),jx.ClassName,M)}_polymorphicAtan(M){return ax(M,Math.atan)}}jx.ClassName="FGAtanBlock",(0,U.h)(jx.ClassName,jx);class sx extends sb{constructor(M){super(LE,LE,LE,((M,E)=>this._polymorphicAtan2(M,E)),sx.ClassName,M)}_polymorphicAtan2(M,E){return tx(M,E,Math.atan2)}}sx.ClassName="FGAtan2Block",(0,U.h)(sx.ClassName,sx);class qx extends Db{constructor(M){super(LE,LE,(M=>this._polymorphicSinh(M)),qx.ClassName,M)}_polymorphicSinh(M){return ax(M,Math.sinh)}}qx.ClassName="FGSinhBlock",(0,U.h)(qx.ClassName,qx);class Dx extends Db{constructor(M){super(LE,LE,(M=>this._polymorphicCosh(M)),Dx.ClassName,M)}_polymorphicCosh(M){return ax(M,Math.cosh)}}Dx.ClassName="FGCoshBlock",(0,U.h)(Dx.ClassName,Dx);class zx extends Db{constructor(M){super(LE,LE,(M=>this._polymorphicTanh(M)),zx.ClassName,M)}_polymorphicTanh(M){return ax(M,Math.tanh)}}zx.ClassName="FGTanhBlock",(0,U.h)(zx.ClassName,zx);class Ax extends Db{constructor(M){super(LE,fE,(M=>this._polymorphicAsinh(M)),Ax.ClassName,M)}_polymorphicAsinh(M){return ax(M,Math.asinh)}}Ax.ClassName="FGAsinhBlock",(0,U.h)(Ax.ClassName,Ax);class Yx extends Db{constructor(M){super(LE,fE,(M=>this._polymorphicAcosh(M)),Yx.ClassName,M)}_polymorphicAcosh(M){return ax(M,Math.acosh)}}Yx.ClassName="FGAcoshBlock",(0,U.h)(Yx.ClassName,Yx);class ix extends Db{constructor(M){super(LE,fE,(M=>this._polymorphicAtanh(M)),ix.ClassName,M)}_polymorphicAtanh(M){return ax(M,Math.atanh)}}ix.ClassName="FGAtanhBlock",(0,U.h)(ix.ClassName,ix);class Gx extends Db{constructor(M){super(LE,fE,(M=>this._polymorphicExp(M)),Gx.ClassName,M)}_polymorphicExp(M){return ax(M,Math.exp)}}Gx.ClassName="FGExpBlock",(0,U.h)(Gx.ClassName,Gx);class Hx extends Db{constructor(M){super(LE,fE,(M=>this._polymorphicLog(M)),Hx.ClassName,M)}_polymorphicLog(M){return ax(M,Math.log)}}Hx.ClassName="FGLogBlock",(0,U.h)(Hx.ClassName,Hx);class ex extends Db{constructor(M){super(LE,fE,(M=>this._polymorphicLog2(M)),ex.ClassName,M)}_polymorphicLog2(M){return ax(M,Math.log2)}}ex.ClassName="FGLog2Block",(0,U.h)(ex.ClassName,ex);class Qx extends Db{constructor(M){super(LE,fE,(M=>this._polymorphicLog10(M)),Qx.ClassName,M)}_polymorphicLog10(M){return ax(M,Math.log10)}}Qx.ClassName="FGLog10Block",(0,U.h)(Qx.ClassName,Qx);class Lx extends Db{constructor(M){super(LE,fE,(M=>this._polymorphicSqrt(M)),Lx.ClassName,M)}_polymorphicSqrt(M){return ax(M,Math.sqrt)}}Lx.ClassName="FGSqrtBlock",(0,U.h)(Lx.ClassName,Lx);class fx extends Db{constructor(M){super(LE,fE,(M=>this._polymorphicCubeRoot(M)),fx.ClassName,M)}_polymorphicCubeRoot(M){return ax(M,Math.cbrt)}}fx.ClassName="FGCubeRootBlock",(0,U.h)(fx.ClassName,fx);class Mk extends sb{constructor(M){super(LE,fE,fE,((M,E)=>this._polymorphicPow(M,E)),Mk.ClassName,M)}_polymorphicPow(M,E){return tx(M,E,Math.pow)}}Mk.ClassName="FGPowBlock",(0,U.h)(Mk.ClassName,Mk);class Ek extends Db{constructor(M){super(LE,fE,(M=>this._polymorphicLength(M)),Ek.ClassName,M)}_polymorphicLength(M){switch(Ab(M)){case"Vector2":case"Fd":case"Vector4":return M.length();default:throw new Error(`Cannot compute length of value ${M}`)}}}Ek.ClassName="FGLengthBlock",(0,U.h)(Ek.ClassName,Ek);class bk extends Db{constructor(M){super(LE,LE,(M=>this._polymorphicNormalize(M)),bk.ClassName,M)}_polymorphicNormalize(M){switch(Ab(M)){case"Vector2":case"Fd":case"Vector4":return M.normalize();default:throw new Error(`Cannot normalize value ${M}`)}}}bk.ClassName="FGNormalizeBlock",(0,U.h)(bk.ClassName,bk);class xk extends sb{constructor(M){super(bb,bb,bb,((M,E)=>k.m.Cross(M,E)),xk.ClassName,M)}}xk.ClassName="FGCrossBlock",(0,U.h)(xk.ClassName,xk);class kk extends sb{constructor(M){super(Eb,fE,Eb,((M,E)=>k.l.Transform(M,k.d.RotationZ(E))),kk.ClassName,M)}}kk.ClassName="FGRotate2DBlock",(0,U.h)(kk.ClassName,kk);class ak extends zb{constructor(M){super(bb,bb,fE,bb,((M,E,b)=>k.m.TransformCoordinates(M,k.d.RotationAxis(E,b))),ak.ClassName,M)}}ak.ClassName="FGRotate3DBlock",(0,U.h)(ak.ClassName,ak);class gk extends Db{constructor(M){super(xb,xb,(M=>k.d.Transpose(M)),gk.ClassName,M)}}gk.ClassName="FGTransposeBlock",(0,U.h)(gk.ClassName,gk);class nk extends Db{constructor(M){super(xb,fE,(M=>M.determinant()),nk.ClassName,M)}}nk.ClassName="FGDeterminantBlock",(0,U.h)(nk.ClassName,nk);class Jk extends Db{constructor(M){super(xb,xb,(M=>k.d.Invert(M)),Jk.ClassName,M)}}Jk.ClassName="FGInvertMatrixBlock",(0,U.h)(Jk.ClassName,Jk);class uk extends sb{constructor(M){super(xb,xb,xb,((M,E)=>E.multiply(M)),uk.ClassName,M)}}uk.ClassName="FGMatMulBlock",(0,U.h)(uk.ClassName,uk);class Tk extends Db{constructor(M){super(kb,kb,(M=>new eE(~M.value)),Tk.ClassName,M)}}Tk.ClassName="FGBitwiseNotBlock",(0,U.h)(Tk.ClassName,Tk);class Vk extends sb{constructor(M){super(kb,kb,kb,((M,E)=>new eE(M.value&E.value)),Vk.ClassName,M)}}Vk.ClassName="FGBitwiseAndBlock",(0,U.h)(Vk.ClassName,Vk);class Ik extends sb{constructor(M){super(kb,kb,kb,((M,E)=>new eE(M.value|E.value)),Ik.ClassName,M)}}Ik.ClassName="FGBitwiseOrBlock",(0,U.h)(Ik.ClassName,Ik);class tk extends sb{constructor(M){super(kb,kb,kb,((M,E)=>new eE(M.value^E.value)),tk.ClassName,M)}}tk.ClassName="FGBitwiseXorBlock",(0,U.h)(tk.ClassName,tk);class yk extends sb{constructor(M){super(kb,kb,kb,((M,E)=>new eE(M.value<<E.value)),yk.ClassName,M)}}yk.ClassName="FGBitwiseLeftShiftBlock",(0,U.h)(yk.ClassName,yk);class Bk extends sb{constructor(M){super(kb,kb,kb,((M,E)=>new eE(M.value>>E.value)),Bk.ClassName,M)}}Bk.ClassName="FGBitwiseRightShiftBlock",(0,U.h)(Bk.ClassName,Bk);class rk extends Db{constructor(M){super(kb,kb,(M=>new eE(Math.clz32(M.value))),rk.ClassName,M)}}rk.ClassName="FGCountLeadingZerosBlock",(0,U.h)(rk.ClassName,rk);class ck extends Db{constructor(M){super(kb,kb,(M=>new eE(M.value?31-Math.clz32(M.value&-M.value):32)),ck.ClassName,M)}}ck.ClassName="FGCountTrailingZerosBlock",(0,U.h)(ck.ClassName,ck);class Ck extends Db{constructor(M){super(kb,kb,(M=>new eE(function(M){let E=0;for(;M;)E+=1&M,M>>=1;return E}(M.value))),Ck.ClassName,M)}}Ck.ClassName="FGCountOneBitsBlock",(0,U.h)(Ck.ClassName,Ck);class Rk extends Nb{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{startIndex:new eE(0)};super(M),this.config=M,this.reset=this._registerSignalInput("reset"),this.n=this.registerDataInput("n",kb),this.value=this.registerDataOutput("value",kb)}_execute(M,E){if(E===this.reset)this.value.setValue(this.config.startIndex,M);else{const E=this.value.getValue(M);E.value<this.n.getValue(M).value&&(this.value.setValue(new eE(E.value+1),M),this.out._activateSignal(M))}}getClassName(){return Rk.ClassName}}Rk.ClassName="FGDoNBlock",(0,U.h)(Rk.ClassName,Rk);class wk extends Tb{constructor(M){super(M),this.config=M,this.output=this.registerDataOutput(M.variableName,LE)}_updateOutputs(M){const E=this.config.variableName;M.hasVariable(E)&&this.output.setValue(M.getVariable(E),M)}getClassName(){return wk.ClassName}serialize(M){super.serialize(M),M.config.variableName=this.config.variableName}}wk.ClassName="FGGetVariableBlock",(0,U.h)(wk.ClassName,wk);class Sk extends Nb{constructor(M){super(M),this.config=M,this.input=this.registerDataInput(M.variableName,LE)}_execute(M){const E=this.config.variableName,b=this.input.getValue(M);M.setVariable(E,b),this.out._activateSignal(M)}getClassName(){return Sk.ClassName}}Sk.ClassName="FGSetVariableBlock",(0,U.h)(Sk.ClassName,Sk);class Xk extends Nb{constructor(M){super(M),this.config=M,this.condition=this.registerDataInput("condition",Mb),this.loopBody=this._registerSignalOutput("loopBody")}_execute(M,E){var b;let x=this.condition.getValue(M);for(null!==(b=this.config)&&void 0!==b&&b.isDo&&!x&&this.loopBody._activateSignal(M);x;)this.loopBody._activateSignal(M),x=this.condition.getValue(M);this.out._activateSignal(M)}getClassName(){return Xk.ClassName}serialize(M){var E;super.serialize(M),M.isDo=null===(E=this.config)||void 0===E?void 0:E.isDo}}Xk.ClassName="FGWhileLoopBlock",(0,U.h)(Xk.ClassName,Xk);const Uk={"lifecycle/onStart":Ub.ClassName,"lifecycle/onTick":vb.ClassName,log:Kb.ClassName,"flow/delay":Zb.ClassName,"customEvent/send":Ob.ClassName,"customEvent/receive":pb.ClassName,"flow/sequence":Pb.ClassName,"world/get":db.ClassName,"world/set":Wb.ClassName,"flow/doN":Rk.ClassName,"variable/get":wk.ClassName,"variable/set":Sk.ClassName,"flow/whileLoop":Xk.ClassName,"math/random":fb.ClassName,"math/e":Ex.ClassName,"math/pi":bx.ClassName,"math/inf":xx.ClassName,"math/nan":kx.ClassName,"math/abs":gx.ClassName,"math/sign":nx.ClassName,"math/trunc":Jx.ClassName,"math/floor":ux.ClassName,"math/ceil":Tx.ClassName,"math/fract":Vx.ClassName,"math/neg":Ix.ClassName,"math/add":Hb.ClassName,"math/sub":eb.ClassName,"math/mul":Qb.ClassName,"math/div":Lb.ClassName,"math/rem":yx.ClassName,"math/min":Bx.ClassName,"math/max":rx.ClassName,"math/clamp":Rx.ClassName,"math/saturate":Sx.ClassName,"math/mix":Xx.ClassName,"math/eq":Ux.ClassName,"math/lt":Nx.ClassName,"math/le":Kx.ClassName,"math/gt":hx.ClassName,"math/ge":Zx.ClassName,"math/isnan":Ox.ClassName,"math/isinf":px.ClassName,"math/rad":Px.ClassName,"math/deg":Fx.ClassName,"math/sin":lx.ClassName,"math/cos":dx.ClassName,"math/tan":Wx.ClassName,"math/asin":mx.ClassName,"math/acos":ox.ClassName,"math/atan":jx.ClassName,"math/atan2":sx.ClassName,"math/sinh":qx.ClassName,"math/cosh":Dx.ClassName,"math/tanh":zx.ClassName,"math/asinh":Ax.ClassName,"math/acosh":Yx.ClassName,"math/atanh":ix.ClassName,"math/exp":Gx.ClassName,"math/log":Hx.ClassName,"math/log2":ex.ClassName,"math/log10":Qx.ClassName,"math/sqrt":Lx.ClassName,"math/cbrt":fx.ClassName,"math/pow":Mk.ClassName,"math/length":Ek.ClassName,"math/normalize":bk.ClassName,"math/dot":Mx.ClassName,"math/cross":xk.ClassName,"math/rotate2d":kk.ClassName,"math/rotate3d":ak.ClassName,"math/transpose":gk.ClassName,"math/determinant":nk.ClassName,"math/inverse":Jk.ClassName,"math/matmul":uk.ClassName,"math/not":Tk.ClassName,"math/and":Vk.ClassName,"math/or":Ik.ClassName,"math/xor":tk.ClassName,"math/asr":Bk.ClassName,"math/lsl":yk.ClassName,"math/clz":rk.ClassName,"math/ctz":ck.ClassName,"math/popcnt":Ck.ClassName},vk={float2:"Vector2",float3:"Fd",float4:"Vector4",float4x4:"Matrix",int:"FlowGraphInteger"};function Nk(M,E,b){if(void 0!==M.type){const x=E.types&&E.types[M.type];if(!x)throw new Error(`${b}: Unknown type: ${M.type}`);const k=x.signature;if(!k)throw new Error(`${b}: Type ${M.type} has no signature`);const a=vk[k];return{value:M.value,className:a}}return M.value}function Kk(M,E,b){const x=Uk[E.type];if(!x)throw new Error(`/extensions/KHR_interactivity/nodes/${M}: Unknown block type: ${E.type}`);const k=M.toString(),a=function(M,E,b){const x={},k=M.configuration??[];for(const a of k)if("customEvent"===a.id){const M=E.customEvents&&E.customEvents[a.value];if(!M)throw new Error(`/extensions/KHR_interactivity/nodes/${b}: Unknown custom event: ${a.value}`);x.eventId=M.id,x.eventData=M.values.map((M=>M.id))}else if("variable"===a.id){const M=E.variables&&E.variables[a.value];if(!M)throw new Error(`/extensions/KHR_interactivity/nodes/${b}: Unknown variable: ${a.value}`);x.variableName=M.id}else if("path"===a.id){const M=a.value;x.path=M}else x[a.id]=Nk(a,E,`/extensions/KHR_interactivity/nodes/${b}`);return x}(E,b,k);return{className:x,config:a,uniqueId:k,metadata:E.metadata,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[]}}class hk extends UE{constructor(M){super(M,Ok)}}const Zk={__array__:{__target__:!0,translation:{type:"Fd",get:M=>M._babylonTransformNode.position,set:(M,E)=>{E._babylonTransformNode.position=M},getObject:M=>M._babylonTransformNode}}},Ok={nodes:Zk},pk="KHR_interactivity";class Pk{constructor(M){this._loader=M,this.name=pk,this.enabled=this._loader.isExtensionUsed(pk),this._pathConverter=new hk(this._loader.Yi)}dispose(){this._loader=null,delete this._pathConverter}onReady(){var M;if(!this._loader.babylonScene||!this._pathConverter)return;const E=this._loader.babylonScene,b=function(M){const E={uniqueId:(0,GE.e)(),_userVariables:{},_connectionValues:{}},b=[E],x=[];for(let a=0;a<M.nodes.length;a++){const E=Kk(a,M.nodes[a],M);x.push(E)}for(let a=0;a<M.nodes.length;a++){const b=M.nodes[a],k=x[a],g=b.flows??[];for(const M of g){const E=M.id,b={uniqueId:(0,GE.e)(),name:E,_connectionType:1,connectedPointIds:[]};k.signalOutputs.push(b);const g=M.node,n=M.socket,J=x[g];if(!J)throw new Error(`/extensions/KHR_interactivity/nodes/${a}: Could not find node with id ${g} that connects its input with with node ${a}'s output ${E}`);let u=J.signalInputs.find((M=>M.name===n));u||(u={uniqueId:(0,GE.e)(),name:n,_connectionType:0,connectedPointIds:[]},J.signalInputs.push(u)),u.connectedPointIds.push(b.uniqueId),b.connectedPointIds.push(u.uniqueId)}const n=b.values??[];for(const J of n){const b=J.id,g={uniqueId:(0,GE.e)(),name:b,_connectionType:0,connectedPointIds:[]};if(k.dataInputs.push(g),void 0!==J.value){const b=Nk(J,M,`/extensions/KHR_interactivity/nodes/${a}`);E._connectionValues[g.uniqueId]=b}else{if(void 0===J.node||void 0===J.socket)throw new Error(`/extensions/KHR_interactivity/nodes/${a}: Invalid socket ${b} in node ${a}`);{const M=J.node,E=J.socket,k=x[M];if(!k)throw new Error(`/extensions/KHR_interactivity/nodes/${a}: Could not find node with id ${M} that connects its output with node${a}'s input ${b}`);let n=k.dataOutputs.find((M=>M.name===E));n||(n={uniqueId:(0,GE.e)(),name:E,_connectionType:1,connectedPointIds:[]},k.dataOutputs.push(n)),g.connectedPointIds.push(n.uniqueId),n.connectedPointIds.push(g.uniqueId)}}}}const k=M.variables??[];for(let a=0;a<k.length;a++){const b=k[a],x=b.id;E._userVariables[x]=Nk(b,M,`/extensions/KHR_interactivity/variables/${a}`)}return{allBlocks:x,executionContexts:b}}(null===(M=this._loader.Yi.extensions)||void 0===M?void 0:M.KHR_interactivity),x=new Xb({Ae:E});Sb.Parse(b,{coordinator:x,pathConverter:this._pathConverter}),x.start()}}G(pk),i(pk,!0,(M=>new Pk(M)));const Fk="KHR_node_visibility";class lk{constructor(M){this.name=Fk,this._loader=M,this.enabled=M.isExtensionUsed(Fk)}async onReady(){var M;null===(M=this._loader.Yi.nodes)||void 0===M||M.forEach((M=>{var E,b,x,k;(null===(E=M._primitiveBabylonMeshes)||void 0===E||E.forEach((M=>{M.inheritVisibility=!0})),null!==(b=M.extensions)&&void 0!==b&&b.KHR_node_visibility)&&(!1===(null===(x=M.extensions)||void 0===x?void 0:x.KHR_node_visibility.visible)&&(M._babylonTransformNode&&(M._babylonTransformNode.isVisible=!1),null===(k=M._primitiveBabylonMeshes)||void 0===k||k.forEach((M=>{M.isVisible=!1}))))}))}dispose(){this._loader=null}}G(Fk),i(Fk,!0,(M=>new lk(M)));const dk="ExtrasAsMetadata";class Wk{_assignExtras(M,E){if(E.extras&&Object.keys(E.extras).length>0){const b=M.metadata=M.metadata||{};(b.Yi=b.Yi||{}).extras=E.extras}}constructor(M){this.name=dk,this.enabled=!0,this._loader=M}dispose(){this._loader=null}loadNodeAsync(M,E,b){return this._loader.loadNodeAsync(M,E,(M=>{this._assignExtras(M,E),b(M)}))}loadCameraAsync(M,E,b){return this._loader.loadCameraAsync(M,E,(M=>{this._assignExtras(M,E),b(M)}))}createMaterial(M,E,b){const x=this._loader.createMaterial(M,E,b);return this._assignExtras(x,E),x}}G(dk),i(dk,!1,(M=>new Wk(M)))},12138:(M,E,b)=>{"use strict";b.d(E,{d:()=>p,e:()=>v,i:()=>U,m:()=>N});var x=b(962),k=b(1176),a=b(11630),g=b(11537),n=b(11578),J=b(11569),u=b(1060),T=b(1005),V=b(12144),I=b(12152),t=b(11548);class y{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.ae=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.Ke=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(M){this._environmentTexture=M}getNodes(){let M=[];return M=M.concat(this.meshes),M=M.concat(this.lights),M=M.concat(this.cameras),M=M.concat(this.transformNodes),this.skeletons.forEach((E=>M=M.concat(E.bones))),M}}class B extends y{}class r{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){this.rootNodes.slice(0).forEach((M=>{M.dispose()})),this.rootNodes.length=0,this.skeletons.slice(0).forEach((M=>{M.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((M=>{M.dispose()})),this.animationGroups.length=0}}class c extends y{constructor(M){super(),this._wasAddedToScene=!1,(M=M||T.b.LastCreatedScene)&&(this.Ae=M,this.proceduralTextures=[],M.Rd.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=M.getEngine().onContextRestoredObservable.add((()=>{for(const M of this.geometries)M._rebuild();for(const M of this.meshes)M._rebuild();for(const M of this.ae)M.rebuild();for(const M of this.textures)M._rebuild()})))}_topologicalSort(M){const E=new Map;for(const g of M)E.set(g.uniqueId,g);const b={dependsOn:new Map,dependedBy:new Map};for(const g of M){const M=g.uniqueId;b.dependsOn.set(M,new Set),b.dependedBy.set(M,new Set)}for(const g of M){const M=g.uniqueId,x=b.dependsOn.get(M);if(g instanceof V.d){const k=g.sourceMesh;E.has(k.uniqueId)&&(x.add(k.uniqueId),b.dependedBy.get(k.uniqueId).add(M))}const k=b.dependedBy.get(M);for(const a of g.getDescendants()){const x=a.uniqueId;if(E.has(x)){k.add(x);b.dependsOn.get(x).add(M)}}}const x=[],k=[];for(const g of M){const M=g.uniqueId;0===b.dependsOn.get(M).size&&(k.push(g),E.delete(M))}const a=k;for(;a.length>0;){const M=a.shift();x.push(M);const k=b.dependedBy.get(M.uniqueId);for(const x of Array.from(k.values())){const k=b.dependsOn.get(x);k.delete(M.uniqueId),0===k.size&&E.get(x)&&(a.push(E.get(x)),E.delete(x))}}return E.size>0&&(u.d.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),E.forEach((M=>u.d.Error(M.name)))),x}_addNodeAndDescendantsToList(M,E,b,x){if(b&&(!x||x(b))&&!E.has(b.uniqueId)){M.push(b),E.add(b.uniqueId);for(const k of b.getDescendants(!0))this._addNodeAndDescendantsToList(M,E,k,x)}}_isNodeInContainer(M){return M instanceof J.d&&-1!==this.meshes.indexOf(M)||(M instanceof n.c&&-1!==this.transformNodes.indexOf(M)||(M instanceof I.e&&-1!==this.lights.indexOf(M)||M instanceof t.c&&-1!==this.cameras.indexOf(M)))}_isValidHierarchy(){for(const M of this.meshes)if(M.parent&&!this._isNodeInContainer(M.parent))return u.d.Warn(`Node ${M.name} has a parent that is not in the container.`),!1;for(const M of this.transformNodes)if(M.parent&&!this._isNodeInContainer(M.parent))return u.d.Warn(`Node ${M.name} has a parent that is not in the container.`),!1;for(const M of this.lights)if(M.parent&&!this._isNodeInContainer(M.parent))return u.d.Warn(`Node ${M.name} has a parent that is not in the container.`),!1;for(const M of this.cameras)if(M.parent&&!this._isNodeInContainer(M.parent))return u.d.Warn(`Node ${M.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(M){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||k.e.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const x={},a={},n=new r,J=[],u=[],T={doNotInstantiate:!0,...b},V=[],I=new Set;for(const k of this.transformNodes)null===k.parent&&this._addNodeAndDescendantsToList(V,I,k,T.predicate);for(const k of this.meshes)null===k.parent&&this._addNodeAndDescendantsToList(V,I,k,T.predicate);const t=this._topologicalSort(V),y=(b,k)=>{if(((E,b)=>{if(x[E.uniqueId]=b.uniqueId,a[b.uniqueId]=b,M&&(b.name=M(E.name)),b instanceof g.e){const M=b;if(M.morphTargetManager){const b=E.morphTargetManager;M.morphTargetManager=b.clone();for(let E=0;E<b.numTargets;E++){const k=b.getTarget(E),g=M.morphTargetManager.getTarget(E);x[k.uniqueId]=g.uniqueId,a[g.uniqueId]=g}}}})(b,k),b.parent){const M=x[b.parent.uniqueId],E=a[M];k.parent=E||b.parent}if(k.position&&b.position&&k.position.p(b.position),k.rotationQuaternion&&b.rotationQuaternion&&k.rotationQuaternion.p(b.rotationQuaternion),k.rotation&&b.rotation&&k.rotation.p(b.rotation),k.ve&&b.ve&&k.ve.p(b.ve),k.material){const g=k;if(g.material)if(E){const E=b.material;if(-1===u.indexOf(E)){let b=E.clone(M?M(E.name):"Clone of "+E.name);if(u.push(E),x[E.uniqueId]=b.uniqueId,a[b.uniqueId]=b,"MultiMaterial"===E.getClassName()){const k=E;for(const E of k.vg)E&&(b=E.clone(M?M(E.name):"Clone of "+E.name),u.push(E),x[E.uniqueId]=b.uniqueId,a[b.uniqueId]=b);k.vg=k.vg.map((M=>M&&a[x[M.uniqueId]]))}}"InstancedMesh"!==g.getClassName()&&(g.material=a[x[E.uniqueId]])}else"MultiMaterial"===g.material.getClassName()?-1===this.Ae.multiMaterials.indexOf(g.material)&&this.Ae.addMultiMaterial(g.material):-1===this.Ae.materials.indexOf(g.material)&&this.Ae.addMaterial(g.material)}null===k.parent&&n.rootNodes.push(k)};return t.forEach((M=>{if("InstancedMesh"===M.getClassName()){const E=M,b=E.sourceMesh,k=x[b.uniqueId],g=("number"===typeof k?a[k]:b).gd(E.name);y(E,g)}else{let E=!0;"pb"===M.getClassName()||"Node"===M.getClassName()||M.skeleton||!M.getTotalVertices||0===M.getTotalVertices()?E=!1:T.doNotInstantiate&&(E="function"===typeof T.doNotInstantiate?!T.doNotInstantiate(M):!T.doNotInstantiate);const b=E?M.gd(`instance of ${M.name}`):M.clone(`Clone of ${M.name}`,null,!0);if(!b)throw new Error(`Could not clone or instantiate node on Asset Container ${M.name}`);y(M,b)}})),this.skeletons.forEach((E=>{if(T.predicate&&!T.predicate(E))return;const b=E.clone(M?M(E.name):"Clone of "+E.name);for(const M of this.meshes)if(M.skeleton===E&&!M.isAnInstance){const E=a[x[M.uniqueId]];if(!E||E.isAnInstance)continue;if(E.skeleton=b,-1!==J.indexOf(b))continue;J.push(b);for(const M of b.bones)M._linkedTransformNode&&(M._linkedTransformNode=a[x[M._linkedTransformNode.uniqueId]])}n.skeletons.push(b)})),this.animationGroups.forEach((E=>{if(T.predicate&&!T.predicate(E))return;const b=E.clone(M?M(E.name):"Clone of "+E.name,(M=>a[x[M.uniqueId]]||M));n.animationGroups.push(b)})),n}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||k.e.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.Ae.environmentTexture=this.environmentTexture);for(const M of this.Ae._serializableComponents)M.addFromContainer(this);this.Ae.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const E=[];this.cameras.forEach((b=>{M&&!M(b)||(this.Ae.addCamera(b),E.push(b))})),this.lights.forEach((b=>{M&&!M(b)||(this.Ae.addLight(b),E.push(b))})),this.meshes.forEach((b=>{M&&!M(b)||(this.Ae.Le(b),E.push(b))})),this.skeletons.forEach((E=>{M&&!M(E)||this.Ae.addSkeleton(E)})),this.animations.forEach((E=>{M&&!M(E)||this.Ae.addAnimation(E)})),this.animationGroups.forEach((E=>{M&&!M(E)||this.Ae.addAnimationGroup(E)})),this.multiMaterials.forEach((E=>{M&&!M(E)||this.Ae.addMultiMaterial(E)})),this.materials.forEach((E=>{M&&!M(E)||this.Ae.addMaterial(E)})),this.morphTargetManagers.forEach((E=>{M&&!M(E)||this.Ae.addMorphTargetManager(E)})),this.geometries.forEach((E=>{M&&!M(E)||this.Ae.addGeometry(E)})),this.transformNodes.forEach((b=>{M&&!M(b)||(this.Ae.addTransformNode(b),E.push(b))})),this.actionManagers.forEach((E=>{M&&!M(E)||this.Ae.addActionManager(E)})),this.textures.forEach((E=>{M&&!M(E)||this.Ae.addTexture(E)})),this.reflectionProbes.forEach((E=>{M&&!M(E)||this.Ae.addReflectionProbe(E)}));for(const b of E)b.parent&&-1===this.Ae.getNodes().indexOf(b.parent)&&(b.setParent?b.setParent(null):b.parent=null)}removeAllFromScene(){this._isValidHierarchy()||k.e.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.Ae.environmentTexture&&(this.Ae.environmentTexture=null);for(const M of this.Ae._serializableComponents)M.removeFromContainer(this)}removeFromScene(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.cameras.forEach((E=>{M&&!M(E)||this.Ae.removeCamera(E)})),this.lights.forEach((E=>{M&&!M(E)||this.Ae.removeLight(E)})),this.meshes.forEach((E=>{M&&!M(E)||this.Ae.Me(E,!0)})),this.skeletons.forEach((E=>{M&&!M(E)||this.Ae.removeSkeleton(E)})),this.animations.forEach((E=>{M&&!M(E)||this.Ae.removeAnimation(E)})),this.animationGroups.forEach((E=>{M&&!M(E)||this.Ae.removeAnimationGroup(E)})),this.multiMaterials.forEach((E=>{M&&!M(E)||this.Ae.removeMultiMaterial(E)})),this.materials.forEach((E=>{M&&!M(E)||this.Ae.removeMaterial(E)})),this.morphTargetManagers.forEach((E=>{M&&!M(E)||this.Ae.removeMorphTargetManager(E)})),this.geometries.forEach((E=>{M&&!M(E)||this.Ae.removeGeometry(E)})),this.transformNodes.forEach((E=>{M&&!M(E)||this.Ae.removeTransformNode(E)})),this.actionManagers.forEach((E=>{M&&!M(E)||this.Ae.removeActionManager(E)})),this.textures.forEach((E=>{M&&!M(E)||this.Ae.removeTexture(E)})),this.reflectionProbes.forEach((E=>{M&&!M(E)||this.Ae.removeReflectionProbe(E)}))}dispose(){this.cameras.slice(0).forEach((M=>{M.dispose()})),this.cameras.length=0,this.lights.slice(0).forEach((M=>{M.dispose()})),this.lights.length=0,this.meshes.slice(0).forEach((M=>{M.dispose()})),this.meshes.length=0,this.skeletons.slice(0).forEach((M=>{M.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((M=>{M.dispose()})),this.animationGroups.length=0,this.multiMaterials.slice(0).forEach((M=>{M.dispose()})),this.multiMaterials.length=0,this.materials.slice(0).forEach((M=>{M.dispose()})),this.materials.length=0,this.geometries.slice(0).forEach((M=>{M.dispose()})),this.geometries.length=0,this.transformNodes.slice(0).forEach((M=>{M.dispose()})),this.transformNodes.length=0,this.actionManagers.slice(0).forEach((M=>{M.dispose()})),this.actionManagers.length=0,this.textures.slice(0).forEach((M=>{M.dispose()})),this.textures.length=0,this.reflectionProbes.slice(0).forEach((M=>{M.dispose()})),this.reflectionProbes.length=0,this.morphTargetManagers.slice(0).forEach((M=>{M.dispose()})),this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const M of this.Ae._serializableComponents)M.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.Ae.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(M,E,b){if(M&&E)for(const x of M){let M=!0;if(b)for(const E of b)if(x===E){M=!1;break}M&&(E.push(x),x._parentContainer=this)}}moveAllFromScene(M){this._wasAddedToScene=!1,void 0===M&&(M=new B);for(const E in this)Object.prototype.hasOwnProperty.call(this,E)&&(this[E]=this[E]||("_environmentTexture"===E?null:[]),this._moveAssets(this.Ae[E],this[E],M[E]));this.environmentTexture=this.Ae.environmentTexture,this.removeAllFromScene()}createRootMesh(){const M=new g.e("assetContainerRootMesh",this.Ae);return this.meshes.forEach((E=>{E.parent||M.addChild(E)})),this.meshes.unshift(M),M}mergeAnimationsTo(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:T.b.LastCreatedScene,E=arguments.length>1?arguments[1]:void 0,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!M)return u.d.Error("No scene available to merge animations to"),[];const x=b||(E=>{let b=null;const x=E.animations.length?E.animations[0].targetProperty:"",k=E.name.split(".").join("").split("_primitive")[0];switch(x){case"position":case"rotationQuaternion":b=M.getTransformNodeByName(E.name)||M.getTransformNodeByName(k);break;case"influence":b=M.getMorphTargetByName(E.name)||M.getMorphTargetByName(k);break;default:b=M.getNodeByName(E.name)||M.getNodeByName(k)}return b});this.getNodes().forEach((M=>{const E=x(M);if(null!==E){for(const b of M.animations){const M=E.animations.filter((M=>M.targetProperty===b.targetProperty));for(const b of M){const M=E.animations.indexOf(b,0);M>-1&&E.animations.splice(M,1)}}E.animations=E.animations.concat(M.animations)}}));const k=[];return this.animationGroups.slice().forEach((M=>{k.push(M.clone(M.name,x)),M.animatables.forEach((M=>{M.stop()}))})),E.forEach((E=>{const b=x(E.target);b&&(M.beginAnimation(b,E.fromFrame,E.toFrame,E.loopAnimation,E.speedRatio,E.onAnimationEnd?E.onAnimationEnd:void 0,void 0,!0,void 0,E.onAnimationLoop?E.onAnimationLoop:void 0),M.stopAnimation(E.target))})),k}populateRootNodes(){this.rootNodes.length=0,this.meshes.forEach((M=>{M.parent||-1!==this.rootNodes.indexOf(M)||this.rootNodes.push(M)})),this.transformNodes.forEach((M=>{M.parent||-1!==this.rootNodes.indexOf(M)||this.rootNodes.push(M)})),this.lights.forEach((M=>{M.parent||-1!==this.rootNodes.indexOf(M)||this.rootNodes.push(M)})),this.cameras.forEach((M=>{M.parent||-1!==this.rootNodes.indexOf(M)||this.rootNodes.push(M)}))}addAllAssetsToContainer(M){if(!M)return;const E=[],b=new Set;for(E.push(M);E.length>0;){const M=E.pop();if(M instanceof g.e?(M.le&&-1===this.geometries.indexOf(M.le)&&this.geometries.push(M.le),this.meshes.push(M)):M instanceof n.c?this.transformNodes.push(M):M instanceof I.e?this.lights.push(M):M instanceof t.c&&this.cameras.push(M),M instanceof J.d){if(M.material&&-1===this.materials.indexOf(M.material)){this.materials.push(M.material);for(const E of M.material.getActiveTextures())-1===this.textures.indexOf(E)&&this.textures.push(E)}M.skeleton&&-1===this.skeletons.indexOf(M.skeleton)&&this.skeletons.push(M.skeleton),M.morphTargetManager&&-1===this.morphTargetManagers.indexOf(M.morphTargetManager)&&this.morphTargetManagers.push(M.morphTargetManager)}for(const x of M.getChildren())b.has(x)||E.push(x);b.add(M)}this.populateRootNodes()}}var C=b(1047);class R{constructor(M){this.byteOffset=0,this.buffer=M}loadAsync(M){return this.buffer.readAsync(this.byteOffset,M).then((M=>{this._dataView=new DataView(M.buffer,M.byteOffset,M.byteLength),this._dataByteOffset=0}))}readUint32(){const M=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,M}readUint8Array(M){const E=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,M);return this._dataByteOffset+=M,this.byteOffset+=M,E}readString(M){return(0,C.h)(this.readUint8Array(M))}skipBytes(M){this._dataByteOffset+=M,this.byteOffset+=M}}var w=b(12160);const S="Z2xURg",X={name:"Yi",extensions:{".gltf":{isBinary:!1},".glb":{isBinary:!0}},canDirectLoad:M=>-1!==M.indexOf("asset")&&-1!==M.indexOf("version")||M.startsWith("data:base64,"+S)||M.startsWith("data:;base64,"+S)||M.startsWith("data:application/octet-stream;base64,"+S)||M.startsWith("data:model/gltf-binary;base64,"+S)};var U,v,N,K=b(1022),h=b(1041);function Z(M,E,b){try{return Promise.resolve(new Uint8Array(M,E,b))}catch(x){return Promise.reject(x)}}!function(M){M[M.AUTO=0]="AUTO",M[M.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(U||(U={})),function(M){M[M.NONE=0]="NONE",M[M.FIRST=1]="FIRST",M[M.ALL=2]="ALL"}(v||(v={})),function(M){M[M.LOADING=0]="LOADING",M[M.READY=1]="READY",M[M.COMPLETE=2]="COMPLETE"}(N||(N={}));class O{constructor(){this.coordinateSystemMode=U.AUTO,this.animationStartMode=v.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=M=>Promise.resolve(M),this.extensionOptions={}}p(M){M&&(this.onParsed=M.onParsed,this.coordinateSystemMode=M.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=M.animationStartMode??this.animationStartMode,this.loadNodeAnimations=M.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=M.loadSkins??this.loadSkins,this.loadMorphTargets=M.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=M.compileMaterials??this.compileMaterials,this.useClipPlane=M.useClipPlane??this.useClipPlane,this.compileShadowGenerators=M.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=M.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=M.useRangeRequests??this.useRangeRequests,this.createInstances=M.createInstances??this.createInstances,this.alwaysComputeBoundingBox=M.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=M.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=M.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=M.skipMaterials??this.skipMaterials,this.useSRGBBuffers=M.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=M.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=M.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=M.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=M.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=M.customRootNode,this.onMeshLoaded=M.onMeshLoaded,this.onSkinLoaded=M.onSkinLoaded,this.onTextureLoaded=M.onTextureLoaded,this.onMaterialLoaded=M.onMaterialLoaded,this.onCameraLoaded=M.onCameraLoaded,this.extensionOptions=M.extensionOptions??this.extensionOptions)}}class p extends O{constructor(M){super(),this.onParsedObservable=new x.b,this.onMeshLoadedObservable=new x.b,this.onSkinLoadedObservable=new x.b,this.onTextureLoadedObservable=new x.b,this.onMaterialLoadedObservable=new x.b,this.onCameraLoadedObservable=new x.b,this.onCompleteObservable=new x.b,this.onErrorObservable=new x.b,this.Rd=new x.b,this.onExtensionLoadedObservable=new x.b,this.validate=!1,this.onValidatedObservable=new x.b,this._loader=null,this._state=null,this._requests=new Array,this.name=X.name,this.extensions=X.extensions,this.onLoaderStateChangedObservable=new x.b,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.p(M)}set onParsed(M){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),M&&(this._onParsedObserver=this.onParsedObservable.add(M))}set onMeshLoaded(M){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),M&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(M))}set onSkinLoaded(M){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),M&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((E=>M(E.node,E.skinnedNode))))}set onTextureLoaded(M){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),M&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(M))}set onMaterialLoaded(M){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),M&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(M))}set onCameraLoaded(M){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),M&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(M))}set onComplete(M){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(M)}set onError(M){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(M)}set onDispose(M){this._onDisposeObserver&&this.Rd.remove(this._onDisposeObserver),this._onDisposeObserver=this.Rd.add(M)}set onExtensionLoaded(M){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(M)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(M){this._loggingEnabled!==M&&(this._loggingEnabled=M,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(M){this._capturePerformanceCounters!==M&&(this._capturePerformanceCounters=M,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(M){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(M)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const M of this._requests)M.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=M=>Promise.resolve(M),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.Rd.notifyObservers(void 0),this.Rd.clear()}loadFile(M,E,b,a,g,n,J,T){if(ArrayBuffer.isView(E))return this._loadBinary(M,E,b,a,J,T),null;this._progressCallback=g;const V=E.name||k.e.GetFilename(E);if(n){if(this.useRangeRequests){this.validate&&u.d.Warn("glTF validation is not supported when range requests are enabled");const b={abort:()=>{},onCompleteObservable:new x.b},k={readAsync:(b,x)=>new Promise(((k,a)=>{this._loadFile(M,E,(M=>{k(new Uint8Array(M))}),!0,(M=>{a(M)}),(M=>{M.setRequestHeader("Range",`bytes=${b}-${b+x-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new R(k)).then((M=>{b.onCompleteObservable.notifyObservers(b),a(M)}),J?M=>J(void 0,M):void 0),b}return this._loadFile(M,E,(E=>{this._validate(M,new Uint8Array(E,0,E.byteLength),b,V),this._unpackBinaryAsync(new R({readAsync:(M,b)=>Z(E,M,b),byteLength:E.byteLength})).then((M=>{a(M)}),J?M=>J(void 0,M):void 0)}),!0,J)}return this._loadFile(M,E,(E=>{try{this._validate(M,E,b,V),a({json:this._parseJson(E)})}catch{J&&J()}}),!1,J)}_loadBinary(M,E,b,x,k,a){this._validate(M,new Uint8Array(E.buffer,E.byteOffset,E.byteLength),b,a),this._unpackBinaryAsync(new R({readAsync:(M,b)=>function(M,E,b){try{if(E<0||E>=M.byteLength)throw new RangeError("Offset is out of range.");if(E+b>M.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(M.buffer,M.byteOffset+E,b))}catch(x){return Promise.reject(x)}}(E,M,b),byteLength:E.byteLength})).then((M=>{x(M)}),k?M=>k(void 0,M):void 0)}importMeshAsync(M,E,b,x,k,a){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(b),this.onParsedObservable.clear(),this._log(`Loading ${a||""}`),this._loader=this._getLoader(b),this._loader.importMeshAsync(M,E,null,b,x,k,a))))}loadAsync(M,E,b,x,k){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(E),this.onParsedObservable.clear(),this._log(`Loading ${k||""}`),this._loader=this._getLoader(E),this._loader.loadAsync(M,E,b,x,k))))}loadAssetContainerAsync(M,E,b,x,k){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(E),this.onParsedObservable.clear(),this._log(`Loading ${k||""}`),this._loader=this._getLoader(E);const a=new c(M),g=[];this.onMaterialLoadedObservable.add((M=>{g.push(M)}));const n=[];this.onTextureLoadedObservable.add((M=>{n.push(M)}));const J=[];this.onCameraLoadedObservable.add((M=>{J.push(M)}));const u=[];return this.onMeshLoadedObservable.add((M=>{M.morphTargetManager&&u.push(M.morphTargetManager)})),this._loader.importMeshAsync(null,M,a,E,b,x,k).then((M=>(Array.prototype.push.apply(a.geometries,M.geometries),Array.prototype.push.apply(a.meshes,M.meshes),Array.prototype.push.apply(a.ae,M.ae),Array.prototype.push.apply(a.skeletons,M.skeletons),Array.prototype.push.apply(a.animationGroups,M.animationGroups),Array.prototype.push.apply(a.materials,g),Array.prototype.push.apply(a.textures,n),Array.prototype.push.apply(a.lights,M.lights),Array.prototype.push.apply(a.transformNodes,M.transformNodes),Array.prototype.push.apply(a.cameras,J),Array.prototype.push.apply(a.morphTargetManagers,u),a)))}))}canDirectLoad(M){return X.canDirectLoad(M)}directLoad(M,E){if(E.startsWith("base64,"+S)||E.startsWith(";base64,"+S)||E.startsWith("application/octet-stream;base64,"+S)||E.startsWith("model/gltf-binary;base64,"+S)){const b=(0,K.c)(E);return this._validate(M,new Uint8Array(b,0,b.byteLength)),this._unpackBinaryAsync(new R({readAsync:(M,E)=>Z(b,M,E),byteLength:b.byteLength}))}return this._validate(M,E),Promise.resolve({json:this._parseJson(E)})}createPlugin(M){return new p(M[X.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((M,E)=>{this.onCompleteObservable.addOnce((()=>{M()})),this.onErrorObservable.addOnce((M=>{E(M)}))}))}_setState(M){this._state!==M&&(this._state=M,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(N[this._state]))}_loadFile(M,E,b,x,k,a){const g=M._loadFile(E,b,(M=>{this._onProgress(M,g)}),!0,x,k,a);return g.onCompleteObservable.add((()=>{g._lengthComputable=!0,g._total=g._loaded})),this._requests.push(g),g}_onProgress(M,E){if(!this._progressCallback)return;E._lengthComputable=M.lengthComputable,E._loaded=M.loaded,E._total=M.total;let b=!0,x=0,k=0;for(const a of this._requests){if(void 0===a._lengthComputable||void 0===a._loaded||void 0===a._total)return;b=b&&a._lengthComputable,x+=a._loaded,k+=a._total}this._progressCallback({lengthComputable:b,loaded:x,total:b?k:0})}_validate(M,E){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),w.c.ValidateAsync(E,b,x,(E=>this.preprocessUrlAsync(b+E).then((E=>M._loadFileAsync(E,void 0,!0,!0).then((M=>new Uint8Array(M,0,M.byteLength))))))).then((M=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(M),this.onValidatedObservable.clear()}),(M=>{this._endPerformanceCounter("Validate JSON"),k.e.Warn(`Failed to validate: ${M.message}`),this.onValidatedObservable.clear()})))}_getLoader(M){const E=M.json.asset||{};this._log(`Asset version: ${E.version}`),E.minVersion&&this._log(`Asset minimum version: ${E.minVersion}`),E.generator&&this._log(`Asset generator: ${E.generator}`);const b=p._parseVersion(E.version);if(!b)throw new Error("Invalid version: "+E.version);if(void 0!==E.minVersion){const M=p._parseVersion(E.minVersion);if(!M)throw new Error("Invalid minimum version: "+E.minVersion);if(p._compareVersion(M,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+E.minVersion)}const x={1:p._CreateGLTF1Loader,2:p._CreateGLTF2Loader}[b.major];if(!x)throw new Error("Unsupported version: "+E.version);return x(this)}_parseJson(M){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${M.length}`);const E=JSON.parse(M);return this._endPerformanceCounter("Parse JSON"),E}_unpackBinaryAsync(M){return this._startPerformanceCounter("Unpack Binary"),M.loadAsync(20).then((()=>{const E=M.readUint32();if(1179937895!==E)throw new h.g("Unexpected magic: "+E,h.f.GLTFLoaderUnexpectedMagicError);const b=M.readUint32();this.loggingEnabled&&this._log(`Binary version: ${b}`);const x=M.readUint32();let k;switch(this.useRangeRequests||x===M.buffer.byteLength||u.d.Warn(`Length in header does not match actual data length: ${x} != ${M.buffer.byteLength}`),b){case 1:k=this._unpackBinaryV1Async(M,x);break;case 2:k=this._unpackBinaryV2Async(M,x);break;default:throw new Error("Unsupported version: "+b)}return this._endPerformanceCounter("Unpack Binary"),k}))}_unpackBinaryV1Async(M,E){const b=M.readUint32(),x=M.readUint32();if(0!==x)throw new Error(`Unexpected content format: ${x}`);const k=E-M.byteOffset,a={json:this._parseJson(M.readString(b)),bin:null};if(0!==k){const E=M.byteOffset;a.bin={readAsync:(b,x)=>M.buffer.readAsync(E+b,x),byteLength:k}}return Promise.resolve(a)}_unpackBinaryV2Async(M,E){const b=1313821514,x=5130562,k=M.readUint32();if(M.readUint32()!==b)throw new Error("First chunk format is not JSON");return M.byteOffset+k===E?M.loadAsync(k).then((()=>({json:this._parseJson(M.readString(k)),bin:null}))):M.loadAsync(k+8).then((()=>{const a={json:this._parseJson(M.readString(k)),bin:null},g=()=>{const k=M.readUint32();switch(M.readUint32()){case b:throw new Error("Unexpected JSON chunk");case x:{const E=M.byteOffset;a.bin={readAsync:(b,x)=>M.buffer.readAsync(E+b,x),byteLength:k},M.skipBytes(k);break}default:M.skipBytes(k)}return M.byteOffset!==E?M.loadAsync(8).then(g):Promise.resolve(a)};return g()}))}static _parseVersion(M){if("1.0"===M||"1.0.1"===M)return{major:1,minor:0};const E=(M+"").match(/^(\d+)\.(\d+)/);return E?{major:parseInt(E[1]),minor:parseInt(E[2])}:null}static _compareVersion(M,E){return M.major>E.major?1:M.major<E.major?-1:M.minor>E.minor?1:M.minor<E.minor?-1:0}_logOpen(M){this._log(M),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(M){const E=p._logSpaces.substring(0,2*this._logIndentLevel);u.d.Log(`${E}${M}`)}_logDisabled(M){}_startPerformanceCounterEnabled(M){k.e.StartPerformanceCounter(M)}_startPerformanceCounterDisabled(M){}_endPerformanceCounterEnabled(M){k.e.EndPerformanceCounter(M)}_endPerformanceCounterDisabled(M){}}p.IncrementalLoading=!0,p.HomogeneousCoordinates=!1,p._logSpaces="                                ",(0,a.g)(new p)},12160:(M,E,b)=>{"use strict";b.d(E,{c:()=>g});var x=b(1176);function k(M,E,b,x){const k={externalResourceFunction:x};return b&&(k.uri="file:"===E?b:E+b),ArrayBuffer.isView(M)?GLTFValidator.validateBytes(M,k):GLTFValidator.validateString(M,k)}function a(){const M=[];onmessage=E=>{const b=E.data;switch(b.id){case"init":importScripts(b.url);break;case"validate":k(b.data,b.rootUrl,b.fileName,(E=>new Promise(((b,x)=>{const k=M.length;M.push({resolve:b,reject:x}),postMessage({id:"getExternalResource",index:k,uri:E})})))).then((M=>{postMessage({id:"validate.resolve",value:M})}),(M=>{postMessage({id:"validate.reject",reason:M})}));break;case"getExternalResource.resolve":M[b.index].resolve(b.value);break;case"getExternalResource.reject":M[b.index].reject(b.reason)}}}class g{static ValidateAsync(M,E,b,g){return"function"===typeof Worker?new Promise(((n,J)=>{const u=`${k}(${a})()`,T=URL.createObjectURL(new Blob([u],{type:"application/javascript"})),V=new Worker(T),I=M=>{V.removeEventListener("error",I),V.removeEventListener("message",t),J(M)},t=M=>{const E=M.data;switch(E.id){case"getExternalResource":g(E.uri).then((M=>{V.postMessage({id:"getExternalResource.resolve",index:E.index,value:M},[M.buffer])}),(M=>{V.postMessage({id:"getExternalResource.reject",index:E.index,reason:M})}));break;case"validate.resolve":V.removeEventListener("error",I),V.removeEventListener("message",t),n(E.value),V.terminate();break;case"validate.reject":V.removeEventListener("error",I),V.removeEventListener("message",t),J(E.reason),V.terminate()}};if(V.addEventListener("error",I),V.addEventListener("message",t),V.postMessage({id:"init",url:x.e.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(M)){const x=M.slice();V.postMessage({id:"validate",data:x,rootUrl:E,fileName:b},[x.buffer])}else V.postMessage({id:"validate",data:M,rootUrl:E,fileName:b})})):(this._LoadScriptPromise||(this._LoadScriptPromise=x.e.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>k(M,E,b,g))))}}g.Configuration={url:`${x.e._DefaultCdnUrl}/gltf_validator.js`}},12538:(M,E,b)=>{"use strict";b.d(E,{e:()=>U});var x=b(948),k=b(953),a=b(1124),g=b(970),n=b(1378),J=b(1386),u=b(1228),T=b(1171),V=b(989),I=b(1082);b(11063),b(10924),b(11072),b(10853),b(11079),b(11100),b(11106);const t="imageProcessingCompatibility",y="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";I.b.IncludesShadersStore[t]=y;const B="skyPixelShader",r="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";I.b.ShadersStore[B]=r;b(10893),b(10896),b(10975),b(10999),b(10977);const c="skyVertexShader",C="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";I.b.ShadersStore[c]=C;var R=b(1397),w=b(1373),S=b(1367);class X extends n.d{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class U extends J.c{constructor(M,E){super(M,E),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new g.m(0,100,0),this.useSunPosition=!1,this.cameraOffset=g.m.Zero(),this.up=g.m.Up(),this.dithering=!1,this._cameraPosition=g.m.Zero(),this._skyOrientation=new g.e}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(M,E){const b=E._drawWrapper;if(this.isFrozen&&b.effect&&b._wasPreviouslyReady)return!0;E.materialDefines||(E.materialDefines=new X);const x=E.materialDefines,k=this.va();if(this._isReadyForSubMesh(E))return!0;if((0,S.Q)(M,k,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,x),(0,S.H)(M,x,!0,!1),x.IMAGEPROCESSINGPOSTPROCESS!==k.imageProcessingConfiguration.applyByPostProcess&&x.markAsMiscDirty(),x.DITHER!==this.dithering&&x.markAsMiscDirty(),x.isDirty){x.markAsProcessed(),k.resetCachedMaterial();const M=new R.e;x.FOG&&M.addFallback(1,"FOG"),x.IMAGEPROCESSINGPOSTPROCESS=k.imageProcessingConfiguration.applyByPostProcess,x.DITHER=this.dithering;const b=[u.g.PositionKind];x.VERTEXCOLOR&&b.push(u.g.ColorKind);const a="sky",g=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,w.b)(g);const n=x.toString();E.setEffect(k.getEngine().createEffect(a,b,g,[],n,M,this.onCompiled,this.onError),x,this._materialContext)}return!(!E.effect||!E.effect.isReady())&&(x._renderId=k.getRenderId(),b._wasPreviouslyReady=!0,!0)}bindForSubMesh(M,E,b){const x=this.va(),k=b.materialDefines;if(!k)return;const a=b.effect;if(!a)return;this._activeEffect=a,this.bindOnlyWorldMatrix(M),this._activeEffect.setMatrix("viewProjection",x.getTransformMatrix()),this._mustRebind(x,a,b)&&((0,w.e)(a,this,x),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,S.k)(k,a,x)),x.fogEnabled&&E.applyFog&&x.fogMode!==T.d.FOGMODE_NONE&&this._activeEffect.setMatrix("view",x.getViewMatrix()),(0,S.e)(x,E,this._activeEffect);const n=x.activeCamera;if(n){const M=n.getWorldMatrix();this._cameraPosition.x=M.m[12],this._cameraPosition.y=M.m[13],this._cameraPosition.z=M.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const M=Math.PI*(this.inclination-.5),E=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(E)*Math.cos(M),this.sunPosition.y=this.distance*Math.sin(-M),this.sunPosition.z=this.distance*Math.sin(E)*Math.cos(M),g.e.FromUnitVectorsToRef(g.m.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(E,this._activeEffect,b)}getAnimatables(){return[]}dispose(M){super.dispose(M)}clone(M){return a.b.Clone((()=>new U(M,this.va())),this)}serialize(){const M=super.serialize();return M.customType="BABYLON.SkyMaterial",M}getClassName(){return"SkyMaterial"}static Parse(M,E,b){return a.b.Parse((()=>new U(M.name,E)),M,E,b)}}(0,x.d)([(0,k.E)()],U.prototype,"luminance",void 0),(0,x.d)([(0,k.E)()],U.prototype,"turbidity",void 0),(0,x.d)([(0,k.E)()],U.prototype,"rayleigh",void 0),(0,x.d)([(0,k.E)()],U.prototype,"mieCoefficient",void 0),(0,x.d)([(0,k.E)()],U.prototype,"mieDirectionalG",void 0),(0,x.d)([(0,k.E)()],U.prototype,"distance",void 0),(0,x.d)([(0,k.E)()],U.prototype,"inclination",void 0),(0,x.d)([(0,k.E)()],U.prototype,"azimuth",void 0),(0,x.d)([(0,k.C)()],U.prototype,"sunPosition",void 0),(0,x.d)([(0,k.E)()],U.prototype,"useSunPosition",void 0),(0,x.d)([(0,k.C)()],U.prototype,"cameraOffset",void 0),(0,x.d)([(0,k.C)()],U.prototype,"up",void 0),(0,x.d)([(0,k.E)()],U.prototype,"dithering",void 0),(0,V.h)("BABYLON.SkyMaterial",U)},11233:(M,E,b)=>{"use strict";function x(M,E){E.headers=M.headers||{},E.statusMessage=M.statusText,E.statusCode=M.status,E.data=M.response}function k(M,E,b){return new Promise((function(k,a){b=b||{};var g,n,J,u=new XMLHttpRequest,T=b.body,V=b.headers||{};for(g in b.timeout&&(u.timeout=b.timeout),u.ontimeout=u.onerror=function(M){M.timeout="timeout"==M.type,a(M)},u.open(M,E.href||E),u.onload=function(){for(J=u.getAllResponseHeaders().trim().split(/[\r\n]+/),x(u,u);n=J.shift();)n=n.split(": "),u.headers[n.shift().toLowerCase()]=n.join(": ");if((n=u.headers["content-type"])&&~n.indexOf("application/json"))try{u.data=JSON.parse(u.data,b.reviver)}catch(M){return x(u,M),a(M)}(u.status>=400?a:k)(u)},typeof FormData<"u"&&T instanceof FormData||T&&"object"==typeof T&&(V["content-type"]="application/json",T=JSON.stringify(T)),u.withCredentials=!!b.withCredentials,V)u.setRequestHeader(g,V[g]);u.send(T)}))}b.r(E),b.d(E,{del:()=>J,get:()=>a,patch:()=>n,post:()=>g,put:()=>u,send:()=>k});var a=k.bind(k,"GET"),g=k.bind(k,"POST"),n=k.bind(k,"PATCH"),J=k.bind(k,"DELETE"),u=k.bind(k,"PUT")},12669:(M,E,b)=>{"use strict";b.d(E,{d:()=>V});const x=.5*(Math.sqrt(3)-1),k=(3-Math.sqrt(3))/6,a=1/3,g=1/6,n=(Math.sqrt(5)-1)/4,J=(5-Math.sqrt(5))/20,u=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),T=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const V=class{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const E="function"==typeof M?M:function(M){let E=0,b=0,x=0,k=1;const a=function(){let M=4022871197;return function(E){E=E.toString();for(let b=0;b<E.length;b++){M+=E.charCodeAt(b);let x=.02519603282416938*M;M=x>>>0,x-=M,x*=M,M=x>>>0,x-=M,M+=4294967296*x}return 2.3283064365386963e-10*(M>>>0)}}();E=a(" "),b=a(" "),x=a(" "),E-=a(M),E<0&&(E+=1);b-=a(M),b<0&&(b+=1);x-=a(M),x<0&&(x+=1);return function(){const M=2091639*E+2.3283064365386963e-10*k;return E=b,b=x,x=M-(k=0|M)}}(M);this.p=function(M){const E=new Uint8Array(256);for(let b=0;b<256;b++)E[b]=b;for(let b=0;b<255;b++){const x=b+~~(M()*(256-b)),k=E[b];E[b]=E[x],E[x]=k}return E}(E),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let b=0;b<512;b++)this.perm[b]=this.p[255&b],this.permMod12[b]=this.perm[b]%12}noise2D(M,E){const b=this.permMod12,a=this.perm;let g=0,n=0,J=0;const T=(M+E)*x,V=Math.floor(M+T),I=Math.floor(E+T),t=(V+I)*k,y=M-(V-t),B=E-(I-t);let r,c;y>B?(r=1,c=0):(r=0,c=1);const C=y-r+k,R=B-c+k,w=y-1+2*k,S=B-1+2*k,X=255&V,U=255&I;let v=.5-y*y-B*B;if(v>=0){const M=3*b[X+a[U]];v*=v,g=v*v*(u[M]*y+u[M+1]*B)}let N=.5-C*C-R*R;if(N>=0){const M=3*b[X+r+a[U+c]];N*=N,n=N*N*(u[M]*C+u[M+1]*R)}let K=.5-w*w-S*S;if(K>=0){const M=3*b[X+1+a[U+1]];K*=K,J=K*K*(u[M]*w+u[M+1]*S)}return 70*(g+n+J)}noise3D(M,E,b){const x=this.permMod12,k=this.perm;let n,J,T,V;const I=(M+E+b)*a,t=Math.floor(M+I),y=Math.floor(E+I),B=Math.floor(b+I),r=(t+y+B)*g,c=M-(t-r),C=E-(y-r),R=b-(B-r);let w,S,X,U,v,N;c>=C?C>=R?(w=1,S=0,X=0,U=1,v=1,N=0):c>=R?(w=1,S=0,X=0,U=1,v=0,N=1):(w=0,S=0,X=1,U=1,v=0,N=1):C<R?(w=0,S=0,X=1,U=0,v=1,N=1):c<R?(w=0,S=1,X=0,U=0,v=1,N=1):(w=0,S=1,X=0,U=1,v=1,N=0);const K=c-w+g,h=C-S+g,Z=R-X+g,O=c-U+2*g,p=C-v+2*g,P=R-N+2*g,F=c-1+.5,l=C-1+.5,d=R-1+.5,W=255&t,m=255&y,o=255&B;let j=.6-c*c-C*C-R*R;if(j<0)n=0;else{const M=3*x[W+k[m+k[o]]];j*=j,n=j*j*(u[M]*c+u[M+1]*C+u[M+2]*R)}let s=.6-K*K-h*h-Z*Z;if(s<0)J=0;else{const M=3*x[W+w+k[m+S+k[o+X]]];s*=s,J=s*s*(u[M]*K+u[M+1]*h+u[M+2]*Z)}let q=.6-O*O-p*p-P*P;if(q<0)T=0;else{const M=3*x[W+U+k[m+v+k[o+N]]];q*=q,T=q*q*(u[M]*O+u[M+1]*p+u[M+2]*P)}let D=.6-F*F-l*l-d*d;if(D<0)V=0;else{const M=3*x[W+1+k[m+1+k[o+1]]];D*=D,V=D*D*(u[M]*F+u[M+1]*l+u[M+2]*d)}return 32*(n+J+T+V)}noise4D(M,E,b,x){const k=this.perm;let a,g,u,V,I;const t=(M+E+b+x)*n,y=Math.floor(M+t),B=Math.floor(E+t),r=Math.floor(b+t),c=Math.floor(x+t),C=(y+B+r+c)*J,R=M-(y-C),w=E-(B-C),S=b-(r-C),X=x-(c-C);let U=0,v=0,N=0,K=0;R>w?U++:v++,R>S?U++:N++,R>X?U++:K++,w>S?v++:N++,w>X?v++:K++,S>X?N++:K++;const h=U>=3?1:0,Z=v>=3?1:0,O=N>=3?1:0,p=K>=3?1:0,P=U>=2?1:0,F=v>=2?1:0,l=N>=2?1:0,d=K>=2?1:0,W=U>=1?1:0,m=v>=1?1:0,o=N>=1?1:0,j=K>=1?1:0,s=R-h+J,q=w-Z+J,D=S-O+J,z=X-p+J,A=R-P+2*J,Y=w-F+2*J,i=S-l+2*J,G=X-d+2*J,H=R-W+3*J,e=w-m+3*J,Q=S-o+3*J,L=X-j+3*J,f=R-1+4*J,MM=w-1+4*J,EM=S-1+4*J,bM=X-1+4*J,xM=255&y,kM=255&B,aM=255&r,gM=255&c;let nM=.6-R*R-w*w-S*S-X*X;if(nM<0)a=0;else{const M=k[xM+k[kM+k[aM+k[gM]]]]%32*4;nM*=nM,a=nM*nM*(T[M]*R+T[M+1]*w+T[M+2]*S+T[M+3]*X)}let JM=.6-s*s-q*q-D*D-z*z;if(JM<0)g=0;else{const M=k[xM+h+k[kM+Z+k[aM+O+k[gM+p]]]]%32*4;JM*=JM,g=JM*JM*(T[M]*s+T[M+1]*q+T[M+2]*D+T[M+3]*z)}let uM=.6-A*A-Y*Y-i*i-G*G;if(uM<0)u=0;else{const M=k[xM+P+k[kM+F+k[aM+l+k[gM+d]]]]%32*4;uM*=uM,u=uM*uM*(T[M]*A+T[M+1]*Y+T[M+2]*i+T[M+3]*G)}let TM=.6-H*H-e*e-Q*Q-L*L;if(TM<0)V=0;else{const M=k[xM+W+k[kM+m+k[aM+o+k[gM+j]]]]%32*4;TM*=TM,V=TM*TM*(T[M]*H+T[M+1]*e+T[M+2]*Q+T[M+3]*L)}let VM=.6-f*f-MM*MM-EM*EM-bM*bM;if(VM<0)I=0;else{const M=k[xM+1+k[kM+1+k[aM+1+k[gM+1]]]]%32*4;VM*=VM,I=VM*VM*(T[M]*f+T[M+1]*MM+T[M+2]*EM+T[M+3]*bM)}return 27*(a+g+u+V+I)}}}}]);