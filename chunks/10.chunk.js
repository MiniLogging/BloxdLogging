/*! For license information please see oa0udh.10.2387fe65.chunk.js.LICENSE.txt */
(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[10],{12508:(C,M,x)=>{"use strict";var f=x(12515),T=x(12519),z=x(12521);x.g.__TYPEDARRAY_POOL||(x.g.__TYPEDARRAY_POOL={UINT8:T([32,0]),UINT16:T([32,0]),UINT32:T([32,0]),INT8:T([32,0]),INT16:T([32,0]),INT32:T([32,0]),FLOAT:T([32,0]),DOUBLE:T([32,0]),DATA:T([32,0]),UINT8C:T([32,0]),BUFFER:T([32,0])});var s="undefined"!==typeof Uint8ClampedArray,S=x.g.__TYPEDARRAY_POOL;S.UINT8C||(S.UINT8C=T([32,0])),S.BUFFER||(S.BUFFER=T([32,0]));var m=S.DATA,Q=S.BUFFER;function V(C){if(C){var M=C.length||C.byteLength,x=f.log2(M);m[x].push(C)}}function y(C){C=f.nextPow2(C);var M=f.log2(C),x=m[M];return x.length>0?x.pop():new ArrayBuffer(C)}function U(C){return new Uint8Array(y(C),0,C)}function O(C){return new Uint16Array(y(2*C),0,C)}function d(C){return new Uint32Array(y(4*C),0,C)}function D(C){return new Int8Array(y(C),0,C)}function o(C){return new Int16Array(y(2*C),0,C)}function L(C){return new Int32Array(y(4*C),0,C)}function t(C){return new Float32Array(y(4*C),0,C)}function A(C){return new Float64Array(y(8*C),0,C)}function H(C){return s?new Uint8ClampedArray(y(C),0,C):U(C)}function j(C){return new DataView(y(C),0,C)}M.free=function(C){if(z(C))Q[f.log2(C.length)].push(C);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(C)&&(C=C.buffer),!C)return;var M=C.length||C.byteLength,x=0|f.log2(M);m[x].push(C)}},M.freeUint8=M.freeUint16=M.freeUint32=M.freeInt8=M.freeInt16=M.freeInt32=M.freeFloat32=M.freeFloat=M.freeFloat64=M.freeDouble=M.freeUint8Clamped=M.freeDataView=function(C){V(C.buffer)},M.freeArrayBuffer=V,M.freeBuffer=function(C){Q[f.log2(C.length)].push(C)},M.malloc=function(C,M){if(void 0===M||"arraybuffer"===M)return y(C);switch(M){case"uint8":return U(C);case"uint16":return O(C);case"uint32":return d(C);case"int8":return D(C);case"int16":return o(C);case"int32":return L(C);case"float":case"float32":return t(C);case"double":case"float64":return A(C);case"uint8_clamped":return H(C);case"buffer":throw"Buffer not supported";case"data":case"dataview":return j(C);default:return null}return null},M.mallocArrayBuffer=y,M.mallocUint8=U,M.mallocUint16=O,M.mallocUint32=d,M.mallocInt8=D,M.mallocInt16=o,M.mallocInt32=L,M.mallocFloat32=M.mallocFloat=t,M.mallocFloat64=M.mallocDouble=A,M.mallocUint8Clamped=H,M.mallocDataView=j,M.clearCache=function(){for(var C=0;C<32;++C)S.UINT8[C].length=0,S.UINT16[C].length=0,S.UINT32[C].length=0,S.INT8[C].length=0,S.INT16[C].length=0,S.INT32[C].length=0,S.FLOAT[C].length=0,S.DOUBLE[C].length=0,S.UINT8C[C].length=0,m[C].length=0,Q[C].length=0}},12601:(C,M,x)=>{C.exports=T;var f=x(12053);function T(C,M){if(!(this instanceof T))return new T(C,M);var x=f.create();f.add(x,C,M),this.ed=f.min(f.create(),C,x),this.Nh=f.clone(M),this.max=f.max(f.create(),C,x),this.mag=f.length(this.Nh)}var z=T.prototype;z.width=function(){return this.Nh[0]},z.height=function(){return this.Nh[1]},z.depth=function(){return this.Nh[2]},z.x0=function(){return this.ed[0]},z.y0=function(){return this.ed[1]},z.z0=function(){return this.ed[2]},z.x1=function(){return this.max[0]},z.y1=function(){return this.max[1]},z.z1=function(){return this.max[2]},z.translate=function(C){return f.add(this.max,this.max,C),f.add(this.ed,this.ed,C),this},z.setPosition=function(C){return f.add(this.max,C,this.Nh),f.j(this.ed,C),this},z.expand=function(C){var M=f.create(),x=f.create();return f.max(M,C.max,this.max),f.min(x,C.ed,this.ed),f.rc(M,M,x),new T(x,M)},z.intersects=function(C){return!(C.ed[0]>this.max[0])&&(!(C.ed[1]>this.max[1])&&(!(C.ed[2]>this.max[2])&&(!(C.max[0]<this.ed[0])&&(!(C.max[1]<this.ed[1])&&!(C.max[2]<this.ed[2])))))},z.touches=function(C){var M=this.union(C);return null!==M&&(0==M.width()||0==M.height()||0==M.depth())},z.union=function(C){if(!this.intersects(C))return null;var M=Math.max(C.ed[0],this.ed[0]),x=Math.max(C.ed[1],this.ed[1]),f=Math.max(C.ed[2],this.ed[2]);return new T([M,x,f],[Math.min(C.max[0],this.max[0])-M,Math.min(C.max[1],this.max[1])-x,Math.min(C.max[2],this.max[2])-f])}},12515:(C,M)=>{"use strict";function x(C){var M=32;return(C&=-C)&&M--,65535&C&&(M-=16),16711935&C&&(M-=8),252645135&C&&(M-=4),858993459&C&&(M-=2),1431655765&C&&(M-=1),M}M.INT_BITS=32,M.INT_MAX=2147483647,M.INT_MIN=-1<<31,M.sign=function(C){return(C>0)-(C<0)},M.abs=function(C){var M=C>>31;return(C^M)-M},M.min=function(C,M){return M^(C^M)&-(C<M)},M.max=function(C,M){return C^(C^M)&-(C<M)},M.isPow2=function(C){return!(C&C-1)&&!!C},M.log2=function(C){var M,x;return M=(C>65535)<<4,M|=x=((C>>>=M)>255)<<3,M|=x=((C>>>=x)>15)<<2,(M|=x=((C>>>=x)>3)<<1)|(C>>>=x)>>1},M.log10=function(C){return C>=1e9?9:C>=1e8?8:C>=1e7?7:C>=1e6?6:C>=1e5?5:C>=1e4?4:C>=1e3?3:C>=100?2:C>=10?1:0},M.popCount=function(C){return 16843009*((C=(858993459&(C-=C>>>1&1431655765))+(C>>>2&858993459))+(C>>>4)&252645135)>>>24},M.countTrailingZeros=x,M.nextPow2=function(C){return C+=0===C,--C,C|=C>>>1,C|=C>>>2,C|=C>>>4,C|=C>>>8,(C|=C>>>16)+1},M.prevPow2=function(C){return C|=C>>>1,C|=C>>>2,C|=C>>>4,C|=C>>>8,(C|=C>>>16)-(C>>>1)},M.parity=function(C){return C^=C>>>16,C^=C>>>8,C^=C>>>4,27030>>>(C&=15)&1};var f=new Array(256);!function(C){for(var M=0;M<256;++M){var x=M,f=M,T=7;for(x>>>=1;x;x>>>=1)f<<=1,f|=1&x,--T;C[M]=f<<T&255}}(f),M.reverse=function(C){return f[255&C]<<24|f[C>>>8&255]<<16|f[C>>>16&255]<<8|f[C>>>24&255]},M.interleave2=function(C,M){return(C=1431655765&((C=858993459&((C=252645135&((C=16711935&((C&=65535)|C<<8))|C<<4))|C<<2))|C<<1))|(M=1431655765&((M=858993459&((M=252645135&((M=16711935&((M&=65535)|M<<8))|M<<4))|M<<2))|M<<1))<<1},M.deinterleave2=function(C,M){return(C=65535&((C=16711935&((C=252645135&((C=858993459&((C=C>>>M&1431655765)|C>>>1))|C>>>2))|C>>>4))|C>>>16))<<16>>16},M.interleave3=function(C,M,x){return C=1227133513&((C=3272356035&((C=251719695&((C=4278190335&((C&=1023)|C<<16))|C<<8))|C<<4))|C<<2),(C|=(M=1227133513&((M=3272356035&((M=251719695&((M=4278190335&((M&=1023)|M<<16))|M<<8))|M<<4))|M<<2))<<1)|(x=1227133513&((x=3272356035&((x=251719695&((x=4278190335&((x&=1023)|x<<16))|x<<8))|x<<4))|x<<2))<<2},M.deinterleave3=function(C,M){return(C=1023&((C=4278190335&((C=251719695&((C=3272356035&((C=C>>>M&1227133513)|C>>>2))|C>>>4))|C>>>8))|C>>>16))<<22>>22},M.nextCombination=function(C){var M=C|C-1;return M+1|(~M&-~M)-1>>>x(C)+1}},12505:(C,M,x)=>{"use strict";C.exports=function(C,M,x){switch(arguments.length){case 1:return f=[],Q(T=C,T,V,!0),f;case 2:return"function"===typeof M?Q(C,C,M,!0):function(C,M){return f=[],Q(C,M,V,!1),f}(C,M);case 3:return Q(C,M,x,!1);default:throw new Error("box-intersect: Invalid arguments")}var T};var f,T=x(12508),z=x(12528),s=x(12542);function S(C,M){for(var x=0;x<C;++x)if(!(M[x]<=M[x+C]))return!0;return!1}function m(C,M,x,f){for(var T=0,z=0,s=0,m=C.length;s<m;++s){var Q=C[s];if(!S(M,Q)){for(var V=0;V<2*M;++V)x[T++]=Q[V];f[z++]=s}}return z}function Q(C,M,x,f){var S=C.length,Q=M.length;if(!(S<=0||Q<=0)){var V=C[0].length>>>1;if(!(V<=0)){var y,U=T.mallocDouble(2*V*S),O=T.mallocInt32(S);if((S=m(C,V,U,O))>0){if(1===V&&f)z.init(S),y=z.sweepComplete(V,x,0,S,U,O,0,S,U,O);else{var d=T.mallocDouble(2*V*Q),D=T.mallocInt32(Q);(Q=m(M,V,d,D))>0&&(z.init(S+Q),y=1===V?z.sweepBipartite(V,x,0,S,U,O,0,Q,d,D):s(V,x,f,S,U,O,Q,d,D),T.free(d),T.free(D))}T.free(U),T.free(O)}return y}}}function V(C,M){f.push([C,M])}},12545:(C,M)=>{"use strict";var x="d",f="ax",T="fp",z="es",s="rs",S="re",m="rb",Q="bs",V="be",y="bb",U=[x,f,"vv",s,S,m,"ri",Q,V,y,"bi"];function O(C){var M="bruteForce"+(C?"Full":"Partial"),f=[],s=U.slice();C||s.splice(3,0,T);var S=["function "+M+"("+s.join()+"){"];function m(M,T){var s=function(C,M,f){var T="bruteForce"+(C?"Red":"Blue")+(M?"Flip":"")+(f?"Full":""),s=["function ",T,"(",U.join(),"){","var ",z,"=2*",x,";"],S="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",m="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(f?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return C?s.push(S,"Q",":",m):s.push(m,"Q",":",S),f?s.push("if(y1<x0||x1<y0)continue;"):M?s.push("if(y0<=x0||x1<y0)continue;"):s.push("if(y0<x0||x1<y0)continue;"),s.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),M?s.push("yi,xi"):s.push("xi,yi"),s.push(");if(rv!==void 0)return rv;}}}"),{name:T,code:s.join("")}}(M,T,C);f.push(s.code),S.push("return "+s.name+"("+U.join()+");")}S.push("if(re-rs>be-bs){"),C?(m(!0,!1),S.push("}else{"),m(!1,!1)):(S.push("if(fp){"),m(!0,!0),S.push("}else{"),m(!0,!1),S.push("}}else{if(fp){"),m(!1,!0),S.push("}else{"),m(!1,!1),S.push("}")),S.push("}}return "+M);var Q=f.join("")+S.join("");return new Function(Q)()}M.partial=O(!1),M.full=O(!0)},12542:(C,M,x)=>{"use strict";C.exports=function(C,M,x,z,V,g,B,F,P){!function(C,M){var x=8*T.log2(M+1)*(C+1)|0,z=T.nextPow2(H*x);b.length<z&&(f.free(b),b=f.mallocInt32(z));var s=T.nextPow2(j*x);R.length<s&&(f.free(R),R=f.mallocDouble(s))}(C,z+B);var h,c=0,q=2*C;n(c++,0,0,z,0,B,x?16:0,-1/0,1/0),x||n(c++,0,0,B,0,z,1,-1/0,1/0);for(;c>0;){var i=(c-=1)*H,Z=b[i],E=b[i+1],K=b[i+2],G=b[i+3],a=b[i+4],J=b[i+5],N=c*j,k=R[N],v=R[N+1],p=1&J,u=!!(16&J),Y=V,W=g,e=F,r=P;if(p&&(Y=F,W=P,e=V,r=g),!(2&J&&E>=(K=o(C,Z,E,K,Y,W,v)))&&!(4&J&&(E=L(C,Z,E,K,Y,W,k))>=K)){var w=K-E,l=a-G;if(u){if(C*w*(w+l)<O){if(void 0!==(h=m.scanComplete(C,Z,M,E,K,Y,W,G,a,e,r)))return h;continue}}else{if(C*Math.min(w,l)<y){if(void 0!==(h=s(C,Z,M,p,E,K,Y,W,G,a,e,r)))return h;continue}if(C*w*l<U){if(void 0!==(h=m.scanBipartite(C,Z,M,p,E,K,Y,W,G,a,e,r)))return h;continue}}var CC=d(C,Z,E,K,Y,W,k,v);if(E<CC)if(C*(CC-E)<y){if(void 0!==(h=S(C,Z+1,M,E,CC,Y,W,G,a,e,r)))return h}else if(Z===C-2){if(void 0!==(h=p?m.sweepBipartite(C,M,G,a,e,r,E,CC,Y,W):m.sweepBipartite(C,M,E,CC,Y,W,G,a,e,r)))return h}else n(c++,Z+1,E,CC,G,a,p,-1/0,1/0),n(c++,Z+1,G,a,E,CC,1^p,-1/0,1/0);if(CC<K){var MC=Q(C,Z,G,a,e,r),xC=e[q*MC+Z],fC=D(C,Z,MC,a,e,r,xC);if(fC<a&&n(c++,Z,CC,K,fC,a,(4|p)+(u?16:0),xC,v),G<MC&&n(c++,Z,CC,K,G,MC,(2|p)+(u?16:0),k,xC),MC+1===fC){if(void 0!==(h=u?X(C,Z,M,CC,K,Y,W,MC,e,r[MC]):I(C,Z,M,p,CC,K,Y,W,MC,e,r[MC])))return h}else if(MC<fC){var TC;if(u){if(CC<(TC=t(C,Z,CC,K,Y,W,xC))){var zC=D(C,Z,CC,TC,Y,W,xC);if(Z===C-2){if(CC<zC&&void 0!==(h=m.sweepComplete(C,M,CC,zC,Y,W,MC,fC,e,r)))return h;if(zC<TC&&void 0!==(h=m.sweepBipartite(C,M,zC,TC,Y,W,MC,fC,e,r)))return h}else CC<zC&&n(c++,Z+1,CC,zC,MC,fC,16,-1/0,1/0),zC<TC&&(n(c++,Z+1,zC,TC,MC,fC,0,-1/0,1/0),n(c++,Z+1,MC,fC,zC,TC,1,-1/0,1/0))}}else CC<(TC=p?A(C,Z,CC,K,Y,W,xC):t(C,Z,CC,K,Y,W,xC))&&(Z===C-2?h=p?m.sweepBipartite(C,M,MC,fC,e,r,CC,TC,Y,W):m.sweepBipartite(C,M,CC,TC,Y,W,MC,fC,e,r):(n(c++,Z+1,CC,TC,MC,fC,p,-1/0,1/0),n(c++,Z+1,MC,fC,CC,TC,1^p,-1/0,1/0)))}}}}};var f=x(12508),T=x(12515),z=x(12545),s=z.partial,S=z.full,m=x(12528),Q=x(12552),V=x(12557),y=128,U=1<<22,O=1<<22,d=V("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),D=V("lo===p0",["p0"]),o=V("lo<p0",["p0"]),L=V("hi<=p0",["p0"]),t=V("lo<=p0&&p0<=hi",["p0"]),A=V("lo<p0&&p0<=hi",["p0"]),H=6,j=2,b=f.mallocInt32(1024),R=f.mallocDouble(1024);function n(C,M,x,f,T,z,s,S,m){var Q=H*C;b[Q]=M,b[Q+1]=x,b[Q+2]=f,b[Q+3]=T,b[Q+4]=z,b[Q+5]=s;var V=j*C;R[V]=S,R[V+1]=m}function I(C,M,x,f,T,z,s,S,m,Q,V){var y=2*C,U=m*y,O=Q[U+M];C:for(var d=T,D=T*y;d<z;++d,D+=y){var o=s[D+M],L=s[D+M+C];if(!(O<o||L<O)&&(!f||O!==o)){for(var t,A=S[d],H=M+1;H<C;++H){o=s[D+H],L=s[D+H+C];var j=Q[U+H],b=Q[U+H+C];if(L<j||b<o)continue C}if(void 0!==(t=f?x(V,A):x(A,V)))return t}}}function X(C,M,x,f,T,z,s,S,m,Q){var V=2*C,y=S*V,U=m[y+M];C:for(var O=f,d=f*V;O<T;++O,d+=V){var D=s[O];if(D!==Q){var o=z[d+M],L=z[d+M+C];if(!(U<o||L<U)){for(var t=M+1;t<C;++t){o=z[d+t],L=z[d+t+C];var A=m[y+t],H=m[y+t+C];if(L<A||H<o)continue C}var j=x(D,Q);if(void 0!==j)return j}}}}},12552:(C,M,x)=>{"use strict";C.exports=function(C,M,x,s,S,m){if(s<=x+1)return x;var Q=x,V=s,y=s+x>>>1,U=2*C,O=y,d=S[U*y+M];for(;Q<V;){if(V-Q<T){z(C,M,Q,V,S,m),d=S[U*y+M];break}var D=V-Q,o=Math.random()*D+Q|0,L=S[U*o+M],t=Math.random()*D+Q|0,A=S[U*t+M],H=Math.random()*D+Q|0,j=S[U*H+M];L<=A?j>=A?(O=t,d=A):L>=j?(O=o,d=L):(O=H,d=j):A>=j?(O=t,d=A):j>=L?(O=o,d=L):(O=H,d=j);for(var b=U*(V-1),R=U*O,n=0;n<U;++n,++b,++R){var I=S[b];S[b]=S[R],S[R]=I}var X=m[V-1];m[V-1]=m[O],m[O]=X;for(b=U*(V-1),R=U*(O=f(C,M,Q,V-1,S,m,d)),n=0;n<U;++n,++b,++R){I=S[b];S[b]=S[R],S[R]=I}X=m[V-1];if(m[V-1]=m[O],m[O]=X,y<O){for(V=O-1;Q<V&&S[U*(V-1)+M]===d;)V-=1;V+=1}else{if(!(O<y))break;for(Q=O+1;Q<V&&S[U*Q+M]===d;)Q+=1}}return f(C,M,x,y,S,m,S[U*y+M])};var f=x(12557)("lo<p0",["p0"]),T=8;function z(C,M,x,f,T,z){for(var s=2*C,S=s*(x+1)+M,m=x+1;m<f;++m,S+=s)for(var Q=T[S],V=m,y=s*(m-1);V>x&&T[y+M]>Q;--V,y-=s){for(var U=y,O=y+s,d=0;d<s;++d,++U,++O){var D=T[U];T[U]=T[O],T[O]=D}var o=z[V];z[V]=z[V-1],z[V-1]=o}}},12557:C=>{"use strict";C.exports=function(C,x){var f="abcdef".split("").concat(x),T=[];C.indexOf("lo")>=0&&T.push("lo=e[k+n]");C.indexOf("hi")>=0&&T.push("hi=e[k+o]");return f.push(M.replace("_",T.join()).replace("$",C)),Function.apply(void 0,f)};var M="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},12533:C=>{"use strict";C.exports=function(C,f){f<=4*M?x(0,f-1,C):Q(0,f-1,C)};var M=32;function x(C,M,x){for(var f=2*(C+1),T=C+1;T<=M;++T){for(var z=x[f++],s=x[f++],S=T,m=f-2;S-- >C;){var Q=x[m-2],V=x[m-1];if(Q<z)break;if(Q===z&&V<s)break;x[m]=Q,x[m+1]=V,m-=2}x[m]=z,x[m+1]=s}}function f(C,M,x){M*=2;var f=x[C*=2],T=x[C+1];x[C]=x[M],x[C+1]=x[M+1],x[M]=f,x[M+1]=T}function T(C,M,x){M*=2,x[C*=2]=x[M],x[C+1]=x[M+1]}function z(C,M,x,f){M*=2,x*=2;var T=f[C*=2],z=f[C+1];f[C]=f[M],f[C+1]=f[M+1],f[M]=f[x],f[M+1]=f[x+1],f[x]=T,f[x+1]=z}function s(C,M,x,f,T){M*=2,T[C*=2]=T[M],T[M]=x,T[C+1]=T[M+1],T[M+1]=f}function S(C,M,x){M*=2;var f=x[C*=2],T=x[M];return!(f<T)&&(f!==T||x[C+1]>x[M+1])}function m(C,M,x,f){var T=f[C*=2];return T<M||T===M&&f[C+1]<x}function Q(C,V,y){var U=(V-C+1)/6|0,O=C+U,d=V-U,D=C+V>>1,o=D-U,L=D+U,t=O,A=o,H=D,j=L,b=d,R=C+1,n=V-1,I=0;S(t,A,y)&&(I=t,t=A,A=I),S(j,b,y)&&(I=j,j=b,b=I),S(t,H,y)&&(I=t,t=H,H=I),S(A,H,y)&&(I=A,A=H,H=I),S(t,j,y)&&(I=t,t=j,j=I),S(H,j,y)&&(I=H,H=j,j=I),S(A,b,y)&&(I=A,A=b,b=I),S(A,H,y)&&(I=A,A=H,H=I),S(j,b,y)&&(I=j,j=b,b=I);for(var X=y[2*A],g=y[2*A+1],B=y[2*j],F=y[2*j+1],P=2*t,h=2*H,c=2*b,q=2*O,i=2*D,Z=2*d,E=0;E<2;++E){var K=y[P+E],G=y[h+E],a=y[c+E];y[q+E]=K,y[i+E]=G,y[Z+E]=a}T(o,C,y),T(L,V,y);for(var J=R;J<=n;++J)if(m(J,X,g,y))J!==R&&f(J,R,y),++R;else if(!m(J,B,F,y))for(;;){if(m(n,B,F,y)){m(n,X,g,y)?(z(J,R,n,y),++R,--n):(f(J,n,y),--n);break}if(--n<J)break}s(C,R-1,X,g,y),s(V,n+1,B,F,y),R-2-C<=M?x(C,R-2,y):Q(C,R-2,y),V-(n+2)<=M?x(n+2,V,y):Q(n+2,V,y),n-R<=M?x(R,n,y):Q(R,n,y)}},12528:(C,M,x)=>{"use strict";C.exports={init:function(C){var M=T.nextPow2(C);m.length<M&&(f.free(m),m=f.mallocInt32(M));Q.length<M&&(f.free(Q),Q=f.mallocInt32(M));V.length<M&&(f.free(V),V=f.mallocInt32(M));y.length<M&&(f.free(y),y=f.mallocInt32(M));U.length<M&&(f.free(U),U=f.mallocInt32(M));O.length<M&&(f.free(O),O=f.mallocInt32(M));var x=8*M;d.length<x&&(f.free(d),d=f.mallocDouble(x))},sweepBipartite:function(C,M,x,f,T,S,U,O,L,t){for(var A=0,H=2*C,j=C-1,b=H-1,R=x;R<f;++R){var n=S[R],I=H*R;d[A++]=T[I+j],d[A++]=-(n+1),d[A++]=T[I+b],d[A++]=n}for(R=U;R<O;++R){n=t[R]+s;var X=H*R;d[A++]=L[X+j],d[A++]=-n,d[A++]=L[X+b],d[A++]=n}var g=A>>>1;z(d,g);var B=0,F=0;for(R=0;R<g;++R){var P=0|d[2*R+1];if(P>=s)D(V,y,F--,P=P-s|0);else if(P>=0)D(m,Q,B--,P);else if(P<=-s){P=-P-s|0;for(var h=0;h<B;++h){if(void 0!==(c=M(m[h],P)))return c}o(V,y,F++,P)}else{P=-P-1|0;for(h=0;h<F;++h){var c;if(void 0!==(c=M(P,V[h])))return c}o(m,Q,B++,P)}}},sweepComplete:function(C,M,x,f,T,s,S,L,t,A){for(var H=0,j=2*C,b=C-1,R=j-1,n=x;n<f;++n){var I=s[n]+1<<1,X=j*n;d[H++]=T[X+b],d[H++]=-I,d[H++]=T[X+R],d[H++]=I}for(n=S;n<L;++n){I=A[n]+1<<1;var g=j*n;d[H++]=t[g+b],d[H++]=1|-I,d[H++]=t[g+R],d[H++]=1|I}var B=H>>>1;z(d,B);var F=0,P=0,h=0;for(n=0;n<B;++n){var c=0|d[2*n+1],q=1&c;if(n<B-1&&c>>1===d[2*n+3]>>1&&(q=2,n+=1),c<0){for(var i=-(c>>1)-1,Z=0;Z<h;++Z){if(void 0!==(E=M(U[Z],i)))return E}if(0!==q)for(Z=0;Z<F;++Z){if(void 0!==(E=M(m[Z],i)))return E}if(1!==q)for(Z=0;Z<P;++Z){var E;if(void 0!==(E=M(V[Z],i)))return E}0===q?o(m,Q,F++,i):1===q?o(V,y,P++,i):2===q&&o(U,O,h++,i)}else{i=(c>>1)-1;0===q?D(m,Q,F--,i):1===q?D(V,y,P--,i):2===q&&D(U,O,h--,i)}}},scanBipartite:function(C,M,x,f,T,S,V,y,U,O,L,t){var A=0,H=2*C,j=M,b=M+C,R=1,n=1;f?n=s:R=s;for(var I=T;I<S;++I){var X=I+R,g=H*I;d[A++]=V[g+j],d[A++]=-X,d[A++]=V[g+b],d[A++]=X}for(I=U;I<O;++I){X=I+n;var B=H*I;d[A++]=L[B+j],d[A++]=-X}var F=A>>>1;z(d,F);var P=0;for(I=0;I<F;++I){var h=0|d[2*I+1];if(h<0){var c=!1;if((X=-h)>=s?(c=!f,X-=s):(c=!!f,X-=1),c)o(m,Q,P++,X);else{var q=t[X],i=H*X,Z=L[i+M+1],E=L[i+M+1+C];C:for(var K=0;K<P;++K){var G=m[K],a=H*G;if(!(E<V[a+M+1]||V[a+M+1+C]<Z)){for(var J=M+2;J<C;++J)if(L[i+J+C]<V[a+J]||V[a+J+C]<L[i+J])continue C;var N,k=y[G];if(void 0!==(N=f?x(q,k):x(k,q)))return N}}}}else D(m,Q,P--,h-R)}},scanComplete:function(C,M,x,f,T,S,Q,V,y,U,O){for(var D=0,o=2*C,L=M,t=M+C,A=f;A<T;++A){var H=A+s,j=o*A;d[D++]=S[j+L],d[D++]=-H,d[D++]=S[j+t],d[D++]=H}for(A=V;A<y;++A){H=A+1;var b=o*A;d[D++]=U[b+L],d[D++]=-H}var R=D>>>1;z(d,R);var n=0;for(A=0;A<R;++A){var I=0|d[2*A+1];if(I<0){if((H=-I)>=s)m[n++]=H-s;else{var X=O[H-=1],g=o*H,B=U[g+M+1],F=U[g+M+1+C];C:for(var P=0;P<n;++P){var h=m[P],c=Q[h];if(c===X)break;var q=o*h;if(!(F<S[q+M+1]||S[q+M+1+C]<B)){for(var i=M+2;i<C;++i)if(U[g+i+C]<S[q+i]||S[q+i+C]<U[g+i])continue C;var Z=x(c,X);if(void 0!==Z)return Z}}}}else{for(H=I-s,P=n-1;P>=0;--P)if(m[P]===H){for(i=P+1;i<n;++i)m[i-1]=m[i];break}--n}}}};var f=x(12508),T=x(12515),z=x(12533),s=1<<28,S=1024,m=f.mallocInt32(S),Q=f.mallocInt32(S),V=f.mallocInt32(S),y=f.mallocInt32(S),U=f.mallocInt32(S),O=f.mallocInt32(S),d=f.mallocDouble(8192);function D(C,M,x,f){var T=M[f],z=C[x-1];C[T]=z,M[z]=T}function o(C,M,x,f){C[x]=f,M[f]=x}},12519:C=>{"use strict";function M(C,x,f){var T=0|C[f];if(T<=0)return[];var z,s=new Array(T);if(f===C.length-1)for(z=0;z<T;++z)s[z]=x;else for(z=0;z<T;++z)s[z]=M(C,x,f+1);return s}C.exports=function(C,x){switch("undefined"===typeof x&&(x=0),typeof C){case"number":if(C>0)return function(C,M){var x,f;for(x=new Array(C),f=0;f<C;++f)x[f]=M;return x}(0|C,x);break;case"object":if("number"===typeof C.length)return M(C,x,0)}return[]}},12471:(C,M,x)=>{C.exports=function(){var C=this;this.components={},this.comps=this.components;var M=this.components,x=1,T={},z=[],s=[],S={timeout:!1,removals:[],multiComps:[]};function m(C,x){var f=M[x],z=T[x],s=z.hash[C];s&&(z.remove(C),f.ab&&(f.multi?(s.forEach((M=>{M&&f.ab(C,M)})),s.length=0):f.ab(C,s)),S.removals.push(z),Q())}function Q(){S.timeout||(S.timeout=!0,setTimeout(V,1))}function V(){S.timeout=!1,y()}function y(){S.multiComps.length&&function(C){for(var M=0;M<C.length;M++){var{entID:x,data:f}=C[M],T=f.hash[x];if(T){for(var z=0;z<T.length;z++)T[z]||(T.splice(z,1),z--);0===T.length&&(f.remove(x),S.removals.push(f))}}C.length=0}(S.multiComps),S.removals.length&&function(C){for(var M=0;M<C.length;M++){C[M].flush()}C.length=0}(S.removals)}this.Xi=T,this._systems=z,this._renderSystems=s,this.Qh=function(M){var f=x++;return Array.isArray(M)&&M.forEach((M=>C.Of(f,M))),f},this.deleteEntity=function(M){return Object.keys(T).forEach((C=>{T[C].hash[M]&&m(M,C)})),C},this.bi=function(C){if(!C)throw new Error("Missing component definition");var x=C.name;if(!x)throw new Error("Component definition must have a name property.");if("string"!==typeof x)throw new Error("Component name must be a string.");if(""===x)throw new Error("Component name must be a non-empty string.");if(T[x])throw new Error(`Component ${x} already exists.`);var S={};return S.name=x,S.multi=!!C.multi,S.order=isNaN(C.order)?99:C.order,S.stateConstructor=C.stateConstructor||null,S.state=C.state||{},S.Zf=C.Zf||null,S.ab=C.ab||null,S.system=C.system||null,S.mh=C.mh||null,M[x]=S,T[x]=new f,T[x]._pendingMultiCleanup=!1,T[x]._multiCleanupIDs=S.multi?[]:null,S.system&&(z.push(x),z.sort(((C,x)=>M[C].order-M[x].order))),S.mh&&(s.push(x),s.sort(((C,x)=>M[C].order-M[x].order))),x},this.overwriteComponent=function(C,x){var f=M[C];if(!f)throw new Error(`Unknown component: ${C}`);if(!x)throw new Error("Missing component definition");if(f.name!==x.name)throw new Error("Overwriting component must use the same name property.");var S={};S.name=C,S.multi=!!x.multi,S.order=isNaN(x.order)?99:x.order,S.state=x.state||{},S.Zf=x.Zf||null,S.ab=x.ab||null,S.system=x.system||null,S.mh=x.mh||null,M[C]=S,T[C]._pendingMultiCleanup=!1,T[C]._multiCleanupIDs=S.multi?[]:null;var m=z.indexOf(C);S.system&&m<0&&z.push(C),!S.system&&m>=0&&z.splice(m,1),z.sort(((C,x)=>M[C].order-M[x].order));var Q=s.indexOf(C);S.mh&&Q<0&&s.push(C),!S.mh&&Q>=0&&s.splice(Q,1),s.sort(((C,x)=>M[C].order-M[x].order));var V=S.state;return this.rh(C).forEach((C=>{for(var M in V)M in C||(C[M]=V[M]);S.Zf&&S.Zf(C.kh,C)})),C},this.deleteComponent=function(x){var f=T[x];if(!f)throw new Error(`Unknown component: ${x}`);f.flush(),f.list.forEach((C=>{C&&m(C.kh||C[0].kh,x)}));var S=z.indexOf(x),Q=s.indexOf(x);return S>-1&&z.splice(S,1),Q>-1&&s.splice(Q,1),T[x].dispose(),delete T[x],delete M[x],C},this.Of=function(C,x,f){var z,s=M[x],S=T[x];if(!S)throw new Error(`Unknown component: ${x}.`);if(S.hash[C]&&!s.multi)throw new Error(`Entity ${C} already has component: ${x}.`);if(s.stateConstructor){if(!(z=new s.stateConstructor).hasOwnProperty("kh"))throw new Error(`Component ${s.name} stateConstructor type does not have property __id`)}else z=Object.assign({},{kh:C},s.state,f);if(z.kh=C,s.multi){var m=S.hash[C];m||(m=[],S.add(C,m)),m.push(z)}else S.add(C,z);return s.Zf&&s.Zf(C,z),this},this.dg=function(C,M){var x=T[M];if(!x)throw new Error(`Unknown component: ${M}.`);return!!x.hash[C]},this.Tf=function(M,x){if(!T[x])throw new Error(`Unknown component: ${x}.`);return m(M,x),C},this.getState=function(C,M){var x=T[M];if(!x)throw new Error(`Unknown component: ${M}.`);return x.hash[C]},this.rh=function(C){var M=T[C];if(!M)throw new Error(`Unknown component: ${C}.`);return y(),M.list},this.Ek=function(C){if(!T[C])throw new Error(`Unknown component: ${C}.`);var M=T[C].hash;return C=>M[C]},this.Hk=function(C){if(!T[C])throw new Error(`Unknown component: ${C}.`);var M=T[C].hash;return C=>!!M[C]},this.wf=function(x){y();for(var f=0;f<z.length;f++){var s=z[f],S=M[s],m=T[s];S.system(x,m.list),y()}return C},this.render=function(x){y();for(var f=0;f<s.length;f++){var z=s[f],S=M[z],m=T[z];S.mh(x,m.list),y()}return C},this.removeMultiComponent=function(x,f,z){var s=M[f],m=T[f];if(!m)throw new Error(`Unknown component: ${f}.`);if(!s.multi)throw new Error("removeMultiComponent called on non-multi component");return function(C,M,x,f){var T=x.hash[C];if(T){var z=T[f];z&&(T[f]=null,M.ab&&M.ab(C,z),S.multiComps.push({entID:C,data:x}),Q())}}(x,s,m,z),C}};var f=x(12479)},12479:C=>{function M(C,M){var x=C._map[M];if(delete C.hash[M],delete C._map[M],x===C.list.length-1)C.list.pop();else{var f=C.list.pop();if(C.list[x]=f,null===f||null===f[0]){var T=C.list.length;for(var z in C._map)if(C._map[z]===T)return void(C._map[z]=x)}else{var s=f.kh||f[0].kh;C._map[s]=x}}}C.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(C,M){if("number"===typeof this._map[C]){var x=this._map[C];this.hash[C]=M,this.list[x]=M}else this._map[C]=this.list.length,this.hash[C]=M,this.list.push(M)}remove(C){var M=this._map[C];this.hash[C]=null,this.list[M]=null,this._pendingRemovals.push(C)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var C=0;C<this._pendingRemovals.length;C++){var x=this._pendingRemovals[C];null===this.hash[x]&&M(this,x)}this._pendingRemovals.length=0}}},12427:C=>{"use strict";var M,x="object"===typeof Reflect?Reflect:null,f=function(C,M,x){return Function.prototype.apply.call(C,M,x)};M=x&&"function"===typeof x.ownKeys?x.ownKeys:Object.getOwnPropertySymbols?function(C){return Object.getOwnPropertyNames(C).concat(Object.getOwnPropertySymbols(C))}:function(C){return Object.getOwnPropertyNames(C)};var T=Number.isNaN||function(C){return C!==C};function z(){z.init.call(this)}C.exports=z,C.exports.once=function(C,M){return new Promise((function(x,f){function T(x){C.removeListener(M,z),f(x)}function z(){"function"===typeof C.removeListener&&C.removeListener("error",T),x([].slice.call(arguments))}D(C,M,z,{once:!0}),"error"!==M&&function(C,M,x){"function"===typeof C.on&&D(C,"error",M,x)}(C,T,{once:!0})}))},z.EventEmitter=z,z.prototype._events=void 0,z.prototype._eventsCount=0,z.prototype._maxListeners=void 0;var s=10;function S(C){if("function"!==typeof C)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof C)}function m(C){return void 0===C._maxListeners?z.defaultMaxListeners:C._maxListeners}function Q(C,M,x,f){var T,z,s,Q;if(S(x),void 0===(z=C._events)?(z=C._events=Object.create(null),C._eventsCount=0):(void 0!==z.newListener&&(C.emit("newListener",M,x.listener?x.listener:x),z=C._events),s=z[M]),void 0===s)s=z[M]=x,++C._eventsCount;else if("function"===typeof s?s=z[M]=f?[x,s]:[s,x]:f?s.unshift(x):s.push(x),(T=m(C))>0&&s.length>T&&!s.warned){s.warned=!0;var V=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(M)+" listeners added. Use emitter.setMaxListeners() to increase limit");V.name="MaxListenersExceededWarning",V.k=C,V.type=M,V.count=s.length,Q=V,console&&console.warn&&console.warn(Q)}return C}function V(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function y(C,M,x){var f={fired:!1,wrapFn:void 0,target:C,type:M,listener:x},T=V.bind(f);return T.listener=x,f.wrapFn=T,T}function U(C,M,x){var f=C._events;if(void 0===f)return[];var T=f[M];return void 0===T?[]:"function"===typeof T?x?[T.listener||T]:[T]:x?function(C){for(var M=new Array(C.length),x=0;x<M.length;++x)M[x]=C[x].listener||C[x];return M}(T):d(T,T.length)}function O(C){var M=this._events;if(void 0!==M){var x=M[C];if("function"===typeof x)return 1;if(void 0!==x)return x.length}return 0}function d(C,M){for(var x=new Array(M),f=0;f<M;++f)x[f]=C[f];return x}function D(C,M,x,f){if("function"===typeof C.on)f.once?C.once(M,x):C.on(M,x);else{if("function"!==typeof C.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof C);C.addEventListener(M,(function T(z){f.once&&C.removeEventListener(M,T),x(z)}))}}Object.defineProperty(z,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(C){if("number"!==typeof C||C<0||T(C))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+C+".");s=C}}),z.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},z.prototype.setMaxListeners=function(C){if("number"!==typeof C||C<0||T(C))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+C+".");return this._maxListeners=C,this},z.prototype.getMaxListeners=function(){return m(this)},z.prototype.emit=function(C){for(var M=[],x=1;x<arguments.length;x++)M.push(arguments[x]);var T="error"===C,z=this._events;if(void 0!==z)T=T&&void 0===z.error;else if(!T)return!1;if(T){var s;if(M.length>0&&(s=M[0]),s instanceof Error)throw s;var S=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw S.context=s,S}var m=z[C];if(void 0===m)return!1;if("function"===typeof m)f(m,this,M);else{var Q=m.length,V=d(m,Q);for(x=0;x<Q;++x)f(V[x],this,M)}return!0},z.prototype.addListener=function(C,M){return Q(this,C,M,!1)},z.prototype.on=z.prototype.addListener,z.prototype.prependListener=function(C,M){return Q(this,C,M,!0)},z.prototype.once=function(C,M){return S(M),this.on(C,y(this,C,M)),this},z.prototype.prependOnceListener=function(C,M){return S(M),this.prependListener(C,y(this,C,M)),this},z.prototype.removeListener=function(C,M){var x,f,T,z,s;if(S(M),void 0===(f=this._events))return this;if(void 0===(x=f[C]))return this;if(x===M||x.listener===M)0===--this._eventsCount?this._events=Object.create(null):(delete f[C],f.removeListener&&this.emit("removeListener",C,x.listener||M));else if("function"!==typeof x){for(T=-1,z=x.length-1;z>=0;z--)if(x[z]===M||x[z].listener===M){s=x[z].listener,T=z;break}if(T<0)return this;0===T?x.shift():function(C,M){for(;M+1<C.length;M++)C[M]=C[M+1];C.pop()}(x,T),1===x.length&&(f[C]=x[0]),void 0!==f.removeListener&&this.emit("removeListener",C,s||M)}return this},z.prototype.off=z.prototype.removeListener,z.prototype.removeAllListeners=function(C){var M,x,f;if(void 0===(x=this._events))return this;if(void 0===x.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==x[C]&&(0===--this._eventsCount?this._events=Object.create(null):delete x[C]),this;if(0===arguments.length){var T,z=Object.keys(x);for(f=0;f<z.length;++f)"removeListener"!==(T=z[f])&&this.removeAllListeners(T);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(M=x[C]))this.removeListener(C,M);else if(void 0!==M)for(f=M.length-1;f>=0;f--)this.removeListener(C,M[f]);return this},z.prototype.listeners=function(C){return U(this,C,!0)},z.prototype.rawListeners=function(C){return U(this,C,!1)},z.listenerCount=function(C,M){return"function"===typeof C.listenerCount?C.listenerCount(M):O.call(C,M)},z.prototype.listenerCount=O,z.prototype.eventNames=function(){return this._eventsCount>0?M(this._events):[]}},12740:C=>{"use strict";C.exports=function(C,M,x,f,T,z){var s=+M[0],S=+M[1],m=+M[2],Q=+x[0],V=+x[1],y=+x[2],U=Math.sqrt(Q*Q+V*V+y*y);if(0===U)throw new Error("Can't raycast along a zero vector");return function(C,M,x,f,T,z,s,S,m,Q){for(var V=0,y=Math.floor,U=0|y(M),O=0|y(x),d=0|y(f),D=T>0?1:-1,o=z>0?1:-1,L=s>0?1:-1,t=Math.abs(1/T),A=Math.abs(1/z),H=Math.abs(1/s),j=t<1/0?t*(D>0?U+1-M:M-U):1/0,b=A<1/0?A*(o>0?O+1-x:x-O):1/0,R=H<1/0?H*(L>0?d+1-f:f-d):1/0,n=-1;V<=S;){var I=C(U,O,d);if(I)return m&&(m[0]=M+V*T,m[1]=x+V*z,m[2]=f+V*s),Q&&(Q[0]=Q[1]=Q[2]=0,0===n&&(Q[0]=-D),1===n&&(Q[1]=-o),2===n&&(Q[2]=-L)),I;j<b?j<R?(U+=D,V=j,j+=t,n=0):(d+=L,V=R,R+=H,n=2):b<R?(O+=o,V=b,b+=A,n=1):(d+=L,V=R,R+=H,n=2)}return m&&(m[0]=M+V*T,m[1]=x+V*z,m[2]=f+V*s),Q&&(Q[0]=Q[1]=Q[2]=0),0}(C,s,S,m,Q/=U,V/=U,y/=U,f="undefined"===typeof f?64:+f,T,z)}},12769:(C,M,x)=>{"use strict";x.d(M,{c:()=>z});var f=x(12427);function T(){this.Ej=!1,this.stopPropagation=!1,this.Fj=!1,this.disabled=!1}class z{constructor(C,M){this.version="0.7.0";var x=Object.assign({},new T,M||{});this.element=C||document,this.Ej=!!x.Ej,this.stopPropagation=!!x.stopPropagation,this.Fj=!!x.Fj,this.disabled=!!x.disabled,this.filterEvents=(C,M)=>!0,this.down=new f.EventEmitter,this.up=new f.EventEmitter,this.state={},this.ah={dx:0,dy:0,vk:0,$g:0,wk:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?S(this):document.addEventListener("DOMContentLoaded",(C=>{S(this)}),{once:!0})}bind(C){for(var M=arguments.length,x=new Array(M>1?M-1:0),f=1;f<M;f++)x[f-1]=arguments[f];x.forEach((M=>{var x=this._keyBindmap[M]||[];x.includes(C)||(x.push(C),this._keyBindmap[M]=x)})),this.state[C]=!!this.state[C],this.pressCount[C]=this.pressCount[C]||0,this.releaseCount[C]=this.releaseCount[C]||0}unbind(C){for(var M in this._keyBindmap){var x=this._keyBindmap[M],f=x.indexOf(C);f>-1&&x.splice(f,1)}}getBindings(){var C={};for(var M in this._keyBindmap){this._keyBindmap[M].forEach((x=>{C[x]=C[x]||[],C[x].push(M)}))}return C}wf(){s(this.ah),s(this.pressCount),s(this.releaseCount)}}function s(C){for(var M in C)C[M]=0}function S(C){window.addEventListener("keydown",d.bind(null,C,!0),!1),window.addEventListener("keyup",d.bind(null,C,!1),!1);var M={passive:!0};C.element.addEventListener("touchstart",y.bind(void 0,C),{passive:!1}),C.element.addEventListener("touchend",O.bind(void 0,C),M),C.element.addEventListener("mousedown",D.bind(null,C,!0),M),window.document.addEventListener("mouseup",D.bind(null,C,!1),M),C.element.addEventListener("touchmove",o.bind(null,C),M),C.element.addEventListener("mousemove",o.bind(null,C),M),window.PointerEvent,C.element.addEventListener("wheel",L.bind(null,C),M),C.element.addEventListener("contextmenu",t.bind(null,C),!1),window.addEventListener("blur",A.bind(null,C),!1)}var m=0,Q=0,V=null;function y(C,M){M.preventDefault(),U(M)}function U(C){let M=!1;for(let x=0;x<C.touches.length;++x)if(C.touches[x].identifier===V){M=!0;break}if(!M){const M=C.changedTouches[0];m=M.clientX,Q=M.clientY,V=M.identifier}}function O(C,M){for(var x=M.changedTouches,f=0;f<x.length;++f)x[f].identifier===V&&(V=null)}function d(C,M,x){H(x.code,M,C,x)}function D(C,M,x){if("pointerId"in x)if(M){if(null!==C._touches.currID)return;C._touches.currID=x.pointerId}else{if(C._touches.currID!==x.pointerId)return;C._touches.currID=null}return H("Mouse"+("button"in x?x.button+1:1),M,C,x),!1}function o(C,M){var x=M.movementX||M.mozMovementX||0,f=M.movementY||M.mozMovementY||0;if(M.touches&&0===(x|f)){var T=function(C){U(C);for(let M=0;M<C.changedTouches.length;++M)if(C.changedTouches[M].identifier==V){const x=C.changedTouches[M],f=[x.clientX-m,x.clientY-Q];return m=x.clientX,Q=x.clientY,f}return console.error(`Did not find touch id ${V}`),[0,0]}(M);x=T[0],f=T[1]}C.ah.dx+=x,C.ah.dy+=f}function L(C,M){var x=1;switch(M.deltaMode){case 0:x=1;break;case 1:x=12;break;case 2:x=C.element.clientHeight||window.innerHeight}C.ah.vk+=(M.deltaX||0)*x,C.ah.$g+=(M.deltaY||0)*x,C.ah.wk+=(M.deltaZ||0)*x}function t(C,M){if(!C.Fj)return M.preventDefault(),!1}function A(C){for(var M in C._keyStates)C._keyStates[M]&&(/^Mouse\d/.test(M)||H(M,!1,C,{code:M,note:"This is a mocked KeyboardEvent made by the 'game-inputs' module",preventDefault:()=>{},stopPropagation:()=>{}}))}function H(C,M,x,f){var T=x._keyBindmap[C];T&&(j(x._keyStates[C],M)&&(x._keyStates[C]=M,T.forEach((C=>{(!x.filterEvents||x.filterEvents(f,C))&&function(C,M,x,f){var T=M?x.pressCount:x.releaseCount;T[C]=(T[C]||0)+1;var z=x._bindPressCount[C]||0;(z+=M?1:-1)<0&&(z=0);x._bindPressCount[C]=z;var s=x.state[C];if(j(s,z)){x.state[C]=z>0;var S=M?x.down:x.up;x.disabled||S.emit(C,f)}}(C,M,x,f)}))),"button"in f||(x.Ej&&!f.defaultPrevented&&f.preventDefault(),x.stopPropagation&&f.stopPropagation()))}function j(C,M){return C?!M:M}},12111:C=>{C.exports=function(C,M,x){return C[0]=M[0]+x[0],C[1]=M[1]+x[1],C[2]=M[2]+x[2],C}},12067:(C,M,x)=>{C.exports=function(C,M){var x=f(C[0],C[1],C[2]),s=f(M[0],M[1],M[2]);T(x,x),T(s,s);var S=z(x,s);return S>1?0:Math.acos(S)};var f=x(12076),T=x(12080),z=x(12086)},12157:C=>{C.exports=function(C,M){return C[0]=Math.ceil(M[0]),C[1]=Math.ceil(M[1]),C[2]=Math.ceil(M[2]),C}},12064:C=>{C.exports=function(C){var M=new Float32Array(3);return M[0]=C[0],M[1]=C[1],M[2]=C[2],M}},12091:C=>{C.exports=function(C,M){return C[0]=M[0],C[1]=M[1],C[2]=M[2],C}},12059:C=>{C.exports=function(){var C=new Float32Array(3);return C[0]=0,C[1]=0,C[2]=0,C}},12247:C=>{C.exports=function(C,M,x){var f=M[0],T=M[1],z=M[2],s=x[0],S=x[1],m=x[2];return C[0]=T*m-z*S,C[1]=z*s-f*m,C[2]=f*S-T*s,C}},12187:(C,M,x)=>{C.exports=x(12182)},12182:C=>{C.exports=function(C,M){var x=M[0]-C[0],f=M[1]-C[1],T=M[2]-C[2];return Math.sqrt(x*x+f*f+T*T)}},12140:(C,M,x)=>{C.exports=x(12138)},12138:C=>{C.exports=function(C,M,x){return C[0]=M[0]/x[0],C[1]=M[1]/x[1],C[2]=M[2]/x[2],C}},12086:C=>{C.exports=function(C,M){return C[0]*M[0]+C[1]*M[1]+C[2]*M[2]}},12056:C=>{C.exports=1e-6},12102:(C,M,x)=>{C.exports=function(C,M){var x=C[0],T=C[1],z=C[2],s=M[0],S=M[1],m=M[2];return Math.abs(x-s)<=f*Math.max(1,Math.abs(x),Math.abs(s))&&Math.abs(T-S)<=f*Math.max(1,Math.abs(T),Math.abs(S))&&Math.abs(z-m)<=f*Math.max(1,Math.abs(z),Math.abs(m))};var f=x(12056)},12107:C=>{C.exports=function(C,M){return C[0]===M[0]&&C[1]===M[1]&&C[2]===M[2]}},12155:C=>{C.exports=function(C,M){return C[0]=Math.floor(M[0]),C[1]=Math.floor(M[1]),C[2]=Math.floor(M[2]),C}},12295:(C,M,x)=>{C.exports=function(C,M,x,T,z,s){var S,m;M||(M=3);x||(x=0);m=T?Math.min(T*M+x,C.length):C.length;for(S=x;S<m;S+=M)f[0]=C[S],f[1]=C[S+1],f[2]=C[S+2],z(f,f,s),C[S]=f[0],C[S+1]=f[1],C[S+2]=f[2];return C};var f=x(12059)()},12076:C=>{C.exports=function(C,M,x){var f=new Float32Array(3);return f[0]=C,f[1]=M,f[2]=x,f}},12053:(C,M,x)=>{C.exports={EPSILON:x(12056),create:x(12059),clone:x(12064),angle:x(12067),oc:x(12076),j:x(12091),set:x(12096),equals:x(12102),exactEquals:x(12107),add:x(12111),rc:x(12114),sub:x(12118),multiply:x(12125),mul:x(12133),divide:x(12138),div:x(12140),min:x(12144),max:x(12148),floor:x(12155),ceil:x(12157),round:x(12166),scale:x(12175),vc:x(12177),distance:x(12182),dist:x(12187),Ac:x(12193),sqrDist:x(12200),length:x(12208),len:x(12210),squaredLength:x(12218),Pc:x(12225),negate:x(12234),inverse:x(12241),normalize:x(12080),dot:x(12086),cross:x(12247),Rc:x(12255),random:x(12259),transformMat4:x(12262),transformMat3:x(12271),transformQuat:x(12274),Tc:x(12276),ad:x(12285),dd:x(12290),forEach:x(12295)}},12241:C=>{C.exports=function(C,M){return C[0]=1/M[0],C[1]=1/M[1],C[2]=1/M[2],C}},12210:(C,M,x)=>{C.exports=x(12208)},12208:C=>{C.exports=function(C){var M=C[0],x=C[1],f=C[2];return Math.sqrt(M*M+x*x+f*f)}},12255:C=>{C.exports=function(C,M,x,f){var T=M[0],z=M[1],s=M[2];return C[0]=T+f*(x[0]-T),C[1]=z+f*(x[1]-z),C[2]=s+f*(x[2]-s),C}},12148:C=>{C.exports=function(C,M,x){return C[0]=Math.max(M[0],x[0]),C[1]=Math.max(M[1],x[1]),C[2]=Math.max(M[2],x[2]),C}},12144:C=>{C.exports=function(C,M,x){return C[0]=Math.min(M[0],x[0]),C[1]=Math.min(M[1],x[1]),C[2]=Math.min(M[2],x[2]),C}},12133:(C,M,x)=>{C.exports=x(12125)},12125:C=>{C.exports=function(C,M,x){return C[0]=M[0]*x[0],C[1]=M[1]*x[1],C[2]=M[2]*x[2],C}},12234:C=>{C.exports=function(C,M){return C[0]=-M[0],C[1]=-M[1],C[2]=-M[2],C}},12080:C=>{C.exports=function(C,M){var x=M[0],f=M[1],T=M[2],z=x*x+f*f+T*T;z>0&&(z=1/Math.sqrt(z),C[0]=M[0]*z,C[1]=M[1]*z,C[2]=M[2]*z);return C}},12259:C=>{C.exports=function(C,M){M=M||1;var x=2*Math.random()*Math.PI,f=2*Math.random()-1,T=Math.sqrt(1-f*f)*M;return C[0]=Math.cos(x)*T,C[1]=Math.sin(x)*T,C[2]=f*M,C}},12276:C=>{C.exports=function(C,M,x,f){var T=x[1],z=x[2],s=M[1]-T,S=M[2]-z,m=Math.sin(f),Q=Math.cos(f);return C[0]=M[0],C[1]=T+s*Q-S*m,C[2]=z+s*m+S*Q,C}},12285:C=>{C.exports=function(C,M,x,f){var T=x[0],z=x[2],s=M[0]-T,S=M[2]-z,m=Math.sin(f),Q=Math.cos(f);return C[0]=T+S*m+s*Q,C[1]=M[1],C[2]=z+S*Q-s*m,C}},12290:C=>{C.exports=function(C,M,x,f){var T=x[0],z=x[1],s=M[0]-T,S=M[1]-z,m=Math.sin(f),Q=Math.cos(f);return C[0]=T+s*Q-S*m,C[1]=z+s*m+S*Q,C[2]=M[2],C}},12166:C=>{C.exports=function(C,M){return C[0]=Math.round(M[0]),C[1]=Math.round(M[1]),C[2]=Math.round(M[2]),C}},12175:C=>{C.exports=function(C,M,x){return C[0]=M[0]*x,C[1]=M[1]*x,C[2]=M[2]*x,C}},12177:C=>{C.exports=function(C,M,x,f){return C[0]=M[0]+x[0]*f,C[1]=M[1]+x[1]*f,C[2]=M[2]+x[2]*f,C}},12096:C=>{C.exports=function(C,M,x,f){return C[0]=M,C[1]=x,C[2]=f,C}},12200:(C,M,x)=>{C.exports=x(12193)},12225:(C,M,x)=>{C.exports=x(12218)},12193:C=>{C.exports=function(C,M){var x=M[0]-C[0],f=M[1]-C[1],T=M[2]-C[2];return x*x+f*f+T*T}},12218:C=>{C.exports=function(C){var M=C[0],x=C[1],f=C[2];return M*M+x*x+f*f}},12118:(C,M,x)=>{C.exports=x(12114)},12114:C=>{C.exports=function(C,M,x){return C[0]=M[0]-x[0],C[1]=M[1]-x[1],C[2]=M[2]-x[2],C}},12271:C=>{C.exports=function(C,M,x){var f=M[0],T=M[1],z=M[2];return C[0]=f*x[0]+T*x[3]+z*x[6],C[1]=f*x[1]+T*x[4]+z*x[7],C[2]=f*x[2]+T*x[5]+z*x[8],C}},12262:C=>{C.exports=function(C,M,x){var f=M[0],T=M[1],z=M[2],s=x[3]*f+x[7]*T+x[11]*z+x[15];return s=s||1,C[0]=(x[0]*f+x[4]*T+x[8]*z+x[12])/s,C[1]=(x[1]*f+x[5]*T+x[9]*z+x[13])/s,C[2]=(x[2]*f+x[6]*T+x[10]*z+x[14])/s,C}},12274:C=>{C.exports=function(C,M,x){var f=M[0],T=M[1],z=M[2],s=x[0],S=x[1],m=x[2],Q=x[3],V=Q*f+S*z-m*T,y=Q*T+m*f-s*z,U=Q*z+s*T-S*f,O=-s*f-S*T-m*z;return C[0]=V*Q+O*-s+y*-m-U*-S,C[1]=y*Q+O*-S+U*-s-V*-m,C[2]=U*Q+O*-m+V*-S-y*-s,C}},12452:C=>{"use strict";C.exports=function(C){for(var M=new Array(C),x=0;x<C;++x)M[x]=x;return M}},12521:C=>{C.exports=function(C){return null!=C&&null!=C.constructor&&"function"===typeof C.constructor.isBuffer&&C.constructor.isBuffer(C)}},12744:(C,M,x)=>{"use strict";x.d(M,{c:()=>f});class f{constructor(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.xi=!1,this.yi=!1,this.ui=30,this.wi=0,this.Gi=!1,this.fullscreen=!1,this.Ai=function(C){},this.Bi=function(){},this.Ei=function(){},this.bb=function(){},this.Ci=function(C){},this.onFullscreenChanged=function(C){},Q((()=>{!function(C,M){C._nowObject=performance||Date,C._lastTick=0,C._renderAccum=0,C._rt=0,C._frameCB=S.bind(null,C),requestAnimationFrame(C._frameCB),M>0&&(C._intervalCB=s.bind(null,C),C._interval=setInterval(C._intervalCB,Math.max(M,1e3/C.ui/2)))}(this,M),function(C,M){if(!M)return;var x=!1,f=!1;document.addEventListener("pointerlockchange",(f=>{x=document.pointerLockElement===M,C.Ci(x)})),document.addEventListener("fullscreenchange",(x=>{f=document.fullscreenElement===M,C.onFullscreenChanged(f)})),Object.defineProperty(C,"Gi",{get:()=>x,set:C=>{C&&!x?m(M):x&&!C&&function(C){C.exitPointerLock&&C.exitPointerLock()}(document)}}),Object.defineProperty(C,"fullscreen",{get:()=>f,set:C=>{C&&!f?M.requestFullscreen():f&&!C&&document.exitFullscreen()}}),M.addEventListener("click",(T=>{C.xi&&!x&&m(M),C.yi&&!f&&M.requestFullscreen()}));var T=()=>C.bb();if(window.ResizeObserver){new ResizeObserver(T).observe(M)}else window.addEventListener("resize",T)}(this,C),this.Ei()}))}}var T=3,z=20;function s(C){for(var M=1e3/C.ui,x=C._nowObject.now()+z,f=0;C._nowObject.now()>=C._lastTick+M&&C._nowObject.now()<x&&++f<=T;)C.Ai(M),C._lastTick+=M;var s=5*(M+5),S=C._nowObject.now();if(S-C._lastTick>s)for(;S>=C._lastTick+M;)C._lastTick+=M}function S(C){requestAnimationFrame(C._frameCB),s(C);var M=C._nowObject.now(),x=M-C._rt;if(C._rt=M,C.wi>0){C._renderAccum+=x;var f=1e3/C.wi;if(C._renderAccum<f)return;C._renderAccum=Math.min(C._renderAccum-f,f)}var T=1e3/C.ui,z=(M-C._lastTick)/T;C.Bi(x,z,T)}function m(C){C.requestPointerLock&&C.requestPointerLock()}var Q=C=>{if("loading"===document.readyState){var M=()=>{document.removeEventListener("readystatechange",M),C()};document.addEventListener("readystatechange",M)}else setTimeout(C,1)}},12445:(C,M,x)=>{var f=x(12452),T=x(12454),z="undefined"!==typeof Float64Array;function s(C,M){return C[0]-M[0]}function S(){var C,M=this.stride,x=new Array(M.length);for(C=0;C<x.length;++C)x[C]=[Math.abs(M[C]),C];x.sort(s);var f=new Array(x.length);for(C=0;C<f.length;++C)f[C]=x[C][1];return f}function m(C,M){var x=["View",M,"d",C].join("");M<0&&(x="View_Nil"+C);var T="generic"===C;if(-1===M){var z="function "+x+"(a){this.data=a;};var proto="+x+".prototype;proto.dtype='"+C+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+x+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+x+"(a){return new "+x+"(a);}";return new Function(z)()}if(0===M){z="function "+x+"(a,d) {this.data = a;this.offset = d};var proto="+x+".prototype;proto.dtype='"+C+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+x+"_copy() {return new "+x+"(this.data,this.offset)};proto.pick=function "+x+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+x+"_get(){return "+(T?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+x+"_set(v){return "+(T?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+x+"(a,b,c,d){return new "+x+"(a,d)}";return new Function("TrivialArray",z)(Q[C][0])}z=["'use strict'"];var s=f(M),m=s.map((function(C){return"i"+C})),V="this.offset+"+s.map((function(C){return"this.stride["+C+"]*i"+C})).join("+"),y=s.map((function(C){return"b"+C})).join(","),U=s.map((function(C){return"c"+C})).join(",");z.push("function "+x+"(a,"+y+","+U+",d){this.data=a","this.shape=["+y+"]","this.stride=["+U+"]","this.offset=d|0}","var proto="+x+".prototype","proto.dtype='"+C+"'","proto.dimension="+M),z.push("Object.defineProperty(proto,'size',{get:function "+x+"_size(){return "+s.map((function(C){return"this.shape["+C+"]"})).join("*"),"}})"),1===M?z.push("proto.order=[0]"):(z.push("Object.defineProperty(proto,'order',{get:"),M<4?(z.push("function "+x+"_order(){"),2===M?z.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===M&&z.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):z.push("ORDER})")),z.push("proto.set=function "+x+"_set("+m.join(",")+",v){"),T?z.push("return this.data.set("+V+",v)}"):z.push("return this.data["+V+"]=v}"),z.push("proto.get=function "+x+"_get("+m.join(",")+"){"),T?z.push("return this.data.get("+V+")}"):z.push("return this.data["+V+"]}"),z.push("proto.index=function "+x+"_index(",m.join(),"){return "+V+"}"),z.push("proto.hi=function "+x+"_hi("+m.join(",")+"){return new "+x+"(this.data,"+s.map((function(C){return["(typeof i",C,"!=='number'||i",C,"<0)?this.shape[",C,"]:i",C,"|0"].join("")})).join(",")+","+s.map((function(C){return"this.stride["+C+"]"})).join(",")+",this.offset)}");var O=s.map((function(C){return"a"+C+"=this.shape["+C+"]"})),d=s.map((function(C){return"c"+C+"=this.stride["+C+"]"}));z.push("proto.lo=function "+x+"_lo("+m.join(",")+"){var b=this.offset,d=0,"+O.join(",")+","+d.join(","));for(var D=0;D<M;++D)z.push("if(typeof i"+D+"==='number'&&i"+D+">=0){d=i"+D+"|0;b+=c"+D+"*d;a"+D+"-=d}");z.push("return new "+x+"(this.data,"+s.map((function(C){return"a"+C})).join(",")+","+s.map((function(C){return"c"+C})).join(",")+",b)}"),z.push("proto.step=function "+x+"_step("+m.join(",")+"){var "+s.map((function(C){return"a"+C+"=this.shape["+C+"]"})).join(",")+","+s.map((function(C){return"b"+C+"=this.stride["+C+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(D=0;D<M;++D)z.push("if(typeof i"+D+"==='number'){d=i"+D+"|0;if(d<0){c+=b"+D+"*(a"+D+"-1);a"+D+"=ceil(-a"+D+"/d)}else{a"+D+"=ceil(a"+D+"/d)}b"+D+"*=d}");z.push("return new "+x+"(this.data,"+s.map((function(C){return"a"+C})).join(",")+","+s.map((function(C){return"b"+C})).join(",")+",c)}");var o=new Array(M),L=new Array(M);for(D=0;D<M;++D)o[D]="a[i"+D+"]",L[D]="b[i"+D+"]";z.push("proto.transpose=function "+x+"_transpose("+m+"){"+m.map((function(C,M){return C+"=("+C+"===undefined?"+M+":"+C+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+x+"(this.data,"+o.join(",")+","+L.join(",")+",this.offset)}"),z.push("proto.pick=function "+x+"_pick("+m+"){var a=[],b=[],c=this.offset");for(D=0;D<M;++D)z.push("if(typeof i"+D+"==='number'&&i"+D+">=0){c=(c+this.stride["+D+"]*i"+D+")|0}else{a.push(this.shape["+D+"]);b.push(this.stride["+D+"])}");return z.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),z.push("return function construct_"+x+"(data,shape,stride,offset){return new "+x+"(data,"+s.map((function(C){return"shape["+C+"]"})).join(",")+","+s.map((function(C){return"stride["+C+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",z.join("\n"))(Q[C],S)}var Q={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};C.exports=function(C,M,x,f){if(void 0===C)return(0,Q.array[0])([]);"number"===typeof C&&(C=[C]),void 0===M&&(M=[C.length]);var s=M.length;if(void 0===x){x=new Array(s);for(var S=s-1,V=1;S>=0;--S)x[S]=V,V*=M[S]}if(void 0===f){f=0;for(S=0;S<s;++S)x[S]<0&&(f-=(M[S]-1)*x[S])}for(var y=function(C){if(T(C))return"buffer";if(z)switch(Object.prototype.toString.call(C)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(C)?"array":"generic"}(C),U=Q[y];U.length<=s+1;)U.push(m(y,U.length-1));return(0,U[s+1])(C,M,x,f)}},12454:C=>{function M(C){return!!C.constructor&&"function"===typeof C.constructor.isBuffer&&C.constructor.isBuffer(C)}C.exports=function(C){return null!=C&&(M(C)||function(C){return"function"===typeof C.readFloatLE&&"function"===typeof C.slice&&M(C.slice(0,0))}(C)||!!C._isBuffer)}},12603:C=>{"use strict";var M=[],x=[],f=[],T=[],z=[],s=[],S=[],m=[],Q=[],V=[],y=[],U=[];C.exports=function(C,O,d,D,o,L){for(var t=S,A=Q,H=V,j=U,b=0;b<3;b++)t[b]=+d[b],H[b]=+O.max[b],A[b]=+O.ed[b];L||(L=1e-10);var R=function(C,S,Q,V,U,O){var d=M,D=x,o=f,L=T,t=z,A=s,H=m,j=Math.floor,b=0,R=0,n=0,I=0,X=0;if(g(),0===n)return 0;for(I=P();R<=n;){if(B(I)&&F())return b;I=P()}for(b+=n,X=0;X<3;X++)V[X]+=Q[X],U[X]+=Q[X];return b;function g(){if(R=0,0!==(n=Math.sqrt(Q[0]*Q[0]+Q[1]*Q[1]+Q[2]*Q[2])))for(var C=0;C<3;C++){var M=Q[C]>=0;L[C]=M?1:-1;var x=M?U[C]:V[C];d[C]=M?V[C]:U[C],D[C]=h(x,L[C]),o[C]=c(d[C],L[C]),H[C]=Q[C]/n,t[C]=Math.abs(1/H[C]);var f=M?D[C]+1-x:x-D[C];A[C]=t[C]<1/0?t[C]*f:1/0}}function B(M){for(var x=L[0],f=0===M?D[0]:o[0],T=D[0]+x,z=L[1],s=1===M?D[1]:o[1],S=D[1]+z,m=L[2],Q=2===M?D[2]:o[2],V=D[2]+m,y=f;y!=T;y+=x)for(var U=s;U!=S;U+=z)for(var O=Q;O!=V;O+=m)if(C(y,U,O))return!0;return!1}function F(){b+=R;var C=L[I],M=R/n,x=y;for(X=0;X<3;X++){var f=Q[X]*M;V[X]+=f,U[X]+=f,x[X]=Q[X]-f}if(C>0?U[I]=Math.round(U[I]):V[I]=Math.round(V[I]),S(b,I,C,x))return!0;for(X=0;X<3;X++)Q[X]=x[X];return g(),0===n}function P(){var C=A[0]<A[1]?A[0]<A[2]?0:2:A[1]<A[2]?1:2,M=A[C]-R;for(R=A[C],D[C]+=L[C],A[C]+=t[C],X=0;X<3;X++)d[X]+=M*H[X],o[X]=c(d[X],L[X]);return C}function h(C,M){return j(C-M*O)}function c(C,M){return j(C+M*O)}}(C,D,t,A,H,L);if(!o){for(b=0;b<3;b++)j[b]=d[b]>0?H[b]-O.max[b]:A[b]-O.ed[b];O.translate(j)}return R}},12777:(C,M,x)=>{"use strict";x.d(M,{c:()=>y});var f=x(12601),T=x(12053);class z{constructor(C,M,x,z,s,S,m){this.qh=new f(C.ed,C.Nh),this.mass=M,this.friction=x,this.restitution=z,this.Ob=s,this.Pk=S,this.Vb=!!m,this.Mh=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.Cl=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.yg=T.create(),this.jh=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=T.create(),this._impulses=T.create(),this._sleepFrameCount=10}loadFromCopy(C){T.j(this.qh.ed,C.qh.ed),T.j(this.qh.Nh,C.qh.Nh),T.j(this.qh.max,C.qh.max),this.qh.mag=C.qh.mag,this.mass=C.mass,this.friction=C.friction,this.restitution=C.restitution,this.Ob=C.Ob,this.Pk=C.Pk,this.Vb=C.Vb,this.Mh=C.Mh,this.fluidDrag=C.fluidDrag,this.Cl=C.Cl,this.preventFallOffEdge=C.preventFallOffEdge,this.rolledBackLastTick=C.rolledBackLastTick,T.j(this.yg,C.yg),T.j(this.jh,C.jh),this.inFluid=C.inFluid,this._ratioInFluid=C._ratioInFluid,T.j(this._forces,C._forces),T.j(this._impulses,C._impulses),this._sleepFrameCount=C._sleepFrameCount}setPosition(C){s(C),T.rc(C,C,this.qh.ed),this.qh.translate(C),this.Dg()}cb(){return T.clone(this.qh.ed)}applyForce(C){s(C),T.add(this._forces,this._forces,C),this.Dg()}applyImpulse(C){s(C),T.add(this._impulses,this._impulses,C),this.Dg()}Dg(){this._sleepFrameCount=10}atRestX(){return this.jh[0]}atRestY(){return this.jh[1]}atRestZ(){return this.jh[2]}}var s=C=>{};var S=x(12601),m=x(12053),Q=x(12603);function V(){this.Mh=.1,this.fluidDrag=.4,this.lc=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function y(C,M,x){C=Object.assign(new V,C),this.gravity=C.gravity||[0,-10,0],this.Mh=C.Mh||.1,this.lc=C.lc||2,this.fluidDrag=C.fluidDrag||.4,this.minBounceImpulse=C.minBounceImpulse,this.bodies=[],this.kk=C.kk,this.testSolid=M,this.testFluid=x}y.prototype.Wk=function(C,M,x,f,T,s){C=C||new S([0,0,0],[1,1,1]),"undefined"==typeof M&&(M=1),"undefined"==typeof x&&(x=1),"undefined"==typeof f&&(f=0),"undefined"==typeof T&&(T=1);var m=new z(C,M,x,f,T,s);return this.bodies.push(m),m},y.prototype.Xk=function(C){var M=this.bodies.indexOf(C);M<0||(this.bodies.splice(M,1),C.qh=C.Pk=null)};var U=m.create(),O=m.create(),d=m.create(),D=m.create(),o=m.create(),L=m.create(),t=m.create(),A=new S([0,0,0],[1,1,1]),H=new z(A,1,1,0,1,(()=>{}),!1);function j(C,M,x){return M=x,M*=1-(1-C.ratioInFluid)**2}y.prototype.wf=function(C){C/=1e3;var M=K(0,m.squaredLength(this.gravity));this.bodies.forEach((x=>function(C,M,x,f){m.j(o,M.jh),C.kk&&H.loadFromCopy(M);if(M.mass<=0)return m.set(M.yg,0,0,0),m.set(M._forces,0,0,0),void m.set(M._impulses,0,0,0);var T=f||0===M.Ob;if(function(C,M,x,f){if(M._sleepFrameCount>0)return!1;if(f)return!0;var T=!1,z=.5*x*x*M.Ob;return m.scale(E,C.gravity,z),Q(C.testSolid,M.qh,E,(function(){return T=!0,!0}),!0),T}(C,M,x,T))return;M._sleepFrameCount--,function(C,M){var x=M.qh,f=Math.floor(x.ed[0]),T=Math.floor(x.ed[2]),z=Math.floor(x.ed[1]),s=Math.floor(x.max[1]);if(!C.testFluid(f,z,T))return M.inFluid=!1,void(M.ratioInFluid=0);var S=1,Q=z+1;for(;Q<=s&&C.testFluid(f,Q,T);)S++,Q++;var V=(z+S-x.ed[1])/x.Nh[1];V>1&&(V=1);var y=x.Nh[0]*x.Nh[1]*x.Nh[2]*V,U=R;m.scale(U,C.gravity,-C.lc*y*M.Ob),M.applyForce(U),M.inFluid=!0,M.ratioInFluid=V}(C,M),a(M._forces),a(M._impulses),a(M.yg),a(M.jh),m.scale(U,M._forces,1/M.mass),m.vc(U,U,C.gravity,M.Ob),m.scale(O,M._impulses,1/M.mass),m.vc(O,O,U,x),m.add(M.yg,M.yg,O),M.friction&&(n(C,0,M,O,x),n(C,1,M,O,x),n(C,2,M,O,x));var z=M.fluidDrag>=0?M.fluidDrag:C.fluidDrag,s=M.Mh>=0?M.Mh:C.Mh,S=s,V=s;M.inFluid&&(S=j(M,S,M.fluidDragHoriz>=0?M.fluidDragHoriz:z),V=j(M,V,M.fluidDragVert>=0?M.fluidDragVert:z));S=Math.max(1-S*x/M.mass,0),V=Math.max(1-V*x/M.mass,0),m.set(b,S,V,S),m.multiply(M.yg,M.yg,b),m.scale(d,M.yg,x),m.set(M._forces,0,0,0),m.set(M._impulses,0,0,0),M.Vb&&G(g,M.qh);m.j(L,d),m.set(t,0,0,0),M.preventFallOffEdge&&function(C,M,x,f){if(!M.jh[1]||x[1]>0)return;var T=q;G(T,M.qh);for(var z=0;z<3;z+=2){m.set(c,0,0,0),c[z]=x[z];var s=!0;(s=(s=(s=(s=s&&!Z(C,T.ed[0]+c[0]+1e-5,T.ed[1],T.ed[2]+c[2]+1e-5))&&!Z(C,T.max[0]+c[0]-1e-5,T.ed[1],T.ed[2]+c[2]+1e-5))&&!Z(C,T.ed[0]+c[0]+1e-5,T.ed[1],T.max[2]+c[2]-1e-5))&&!Z(C,T.max[0]+c[0]-1e-5,T.ed[1],T.max[2]+c[2]-1e-5))?(f[z]=x[z]>0?1:-1,x[z]=0):0===z&&(m.set(i,x[0],0,0),X(C,T,i,f,M.slideOnCollision))}}(C,M,d,t);X(C,M.qh,d,M.jh,M.slideOnCollision),M.Vb&&function(C,M,x,f){if(M.jh[1]>=0&&!M.inFluid)return;var T=0!==M.jh[0],z=0!==M.jh[2];if(!T&&!z)return;var s=Math.abs(f[0]/f[2]),S=4;if(!T&&s>S)return;if(!z&&s<1/S)return;m.add(F,x.ed,f);var V=C.testSolid;Q(V,x,f,(function(C,M,x,f){if(1!==M)return!0;f[M]=0}));var y=x.ed[1],U=M.inFluid?1.951:1.001,O=Math.floor(y+U)-y;m.set(P,0,O,0);var d=!1;if(Q(V,x,P,(function(C,M,x,f){return d=!0,!0})),d)return;m.rc(h,F,x.ed),h[1]=0,X(C,x,h,B,!0);var D=K(x.ed[0],F[0]),o=K(x.ed[2],F[2]);if(T&&!D&&(!o||!z))return;if(z&&(!D||!T)&&!o)return;var L=!0;if(L=L&&!Z(C,x.ed[0]+1e-5,x.ed[1],x.ed[2]+1e-5),L=L&&!Z(C,x.max[0]-1e-5,x.ed[1],x.ed[2]+1e-5),L=L&&!Z(C,x.ed[0]+1e-5,x.ed[1],x.max[2]-1e-5),L=L&&!Z(C,x.max[0]-1e-5,x.ed[1],x.max[2]-1e-5),L)return;G(M.qh,x),M.jh[0]=B[0],M.jh[2]=B[2],M.Cl&&M.Cl()}(C,M,g,L);for(var y=0;y<3;++y)M.jh[y]=M.jh[y]||t[y],D[y]=0,M.jh[y]&&(o[y]||(D[y]=-M.yg[y]),M.yg[y]=0);var A=m.length(D);A>.001&&(m.scale(D,D,M.mass),M.Pk&&M.Pk(D),M.restitution>0&&A>C.minBounceImpulse&&(m.scale(D,D,M.restitution),M.applyImpulse(D)));var I=m.squaredLength(M.yg);I>1e-5&&M.Dg();C.kk&&C.kk(M)?(M.loadFromCopy(H),M.rolledBackLastTick=!0):M.rolledBackLastTick=!1}(this,x,C,M)))};var b=m.create([0,0,0]);var R=m.create();function n(C,M,x,f,T){var z=x.jh[M],s=f[M];if(!x.alwaysApplyHorizFriction||1!==M){if(0===z)return;if(z*s<=0)return}m.j(I,x.yg),I[M]=0;var S=m.length(I);if(!K(S,0)){var Q=Math.abs(x.friction*C.gravity[M]*T),V=S>Q?(S-Q)/S:0;x.yg[(M+1)%3]*=V,x.yg[(M+2)%3]*=V}}var I=m.create();function X(C,M,x,f,T){return m.set(f,0,0,0),Q(C.testSolid,M,x,(function(C,M,x,z){f[M]=x,z[M]=0,T||(z[0]=0,z[1]=0,z[2]=0)}))}var g=new S([],[]),B=m.create(),F=m.create(),P=m.create(),h=m.create();var c=m.create(),q=new S([],[]),i=m.create();function Z(C,M,x,f){return C.testSolid(Math.floor(M),Math.floor(x-1),Math.floor(f))}var E=m.create();function K(C,M){return Math.abs(C-M)<1e-5}function G(C,M){for(var x=0;x<3;x++)C.ed[x]=M.ed[x],C.max[x]=M.max[x],C.Nh[x]=M.Nh[x]}var a=function(C){}},11504:function(C,M){!function(C){"use strict";var M=function(C,x){return M=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(C,M){C.__proto__=M}||function(C,M){for(var x in M)Object.prototype.hasOwnProperty.call(M,x)&&(C[x]=M[x])},M(C,x)};function x(C,x){if("function"!==typeof x&&null!==x)throw new TypeError("Class extends value "+String(x)+" is not a constructor or null");function f(){this.constructor=C}M(C,x),C.prototype=null===x?Object.create(x):(f.prototype=x.prototype,new f)}function f(C,M,x,f){var T,z=arguments.length,s=z<3?M:null===f?f=Object.getOwnPropertyDescriptor(M,x):f;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(C,M,x,f);else for(var S=C.length-1;S>=0;S--)(T=C[S])&&(s=(z<3?T(s):z>3?T(M,x,s):T(M,x))||s);return z>3&&s&&Object.defineProperty(M,x,s),s}function T(C,M,x){if(x||2===arguments.length)for(var f,T=0,z=M.length;T<z;T++)!f&&T in M||(f||(f=Array.prototype.slice.call(M,0,T)),f[T]=M[T]);return C.concat(f||Array.prototype.slice.call(M))}var z,s=255,S=213;C.OPERATION=void 0,(z=C.OPERATION||(C.OPERATION={}))[z.ADD=128]="ADD",z[z.REPLACE=0]="REPLACE",z[z.DELETE=64]="DELETE",z[z.DELETE_AND_ADD=192]="DELETE_AND_ADD",z[z.TOUCH=1]="TOUCH",z[z.CLEAR=10]="CLEAR";var m=function(){function M(C,M,x){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=C,this.setParent(M,x)}return M.prototype.setParent=function(C,M,x){var f=this;if(this.indexes||(this.indexes=this.ref instanceof hC?this.ref._definition.indexes:{}),this.parent=C,this.parentIndex=x,M)if(this.root=M,this.ref instanceof hC){var T=this.ref._definition;for(var z in T.schema){var s=this.ref[z];if(s&&s.$changes){var S=T.indexes[z];s.$changes.setParent(this.ref,M,S)}}}else"object"===typeof this.ref&&this.ref.forEach((function(C,M){if(C instanceof hC){var x=C.$changes,T=f.ref.$changes.indexes[M];x.setParent(f.ref,f.root,T)}}))},M.prototype.operation=function(C){this.changes.set(--this.currentCustomOperation,C)},M.prototype.change=function(M,x){void 0===x&&(x=C.OPERATION.ADD);var f="number"===typeof M?M:this.indexes[M];this.assertValidIndex(f,M);var T=this.changes.get(f);T&&T.op!==C.OPERATION.DELETE&&T.op!==C.OPERATION.TOUCH||this.changes.set(f,{op:T&&T.op===C.OPERATION.DELETE?C.OPERATION.DELETE_AND_ADD:x,index:f}),this.allChanges.add(f),this.changed=!0,this.touchParents()},M.prototype.touch=function(M){var x="number"===typeof M?M:this.indexes[M];this.assertValidIndex(x,M),this.changes.has(x)||this.changes.set(x,{op:C.OPERATION.TOUCH,index:x}),this.allChanges.add(x),this.touchParents()},M.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},M.prototype.getType=function(C){if(this.ref._definition)return(M=this.ref._definition).schema[M.fieldsByIndex[C]];var M,x=(M=this.parent._definition).schema[M.fieldsByIndex[this.parentIndex]];return Object.values(x)[0]},M.prototype.getChildrenFilter=function(){var C=this.parent._definition.childFilters;return C&&C[this.parentIndex]},M.prototype.getValue=function(C){return this.ref.getByIndex(C)},M.prototype.delete=function(M){var x="number"===typeof M?M:this.indexes[M];if(void 0!==x){var f=this.getValue(x);this.changes.set(x,{op:C.OPERATION.DELETE,index:x}),this.allChanges.delete(x),delete this.caches[x],f&&f.$changes&&(f.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(M," (").concat(x,")"))},M.prototype.discard=function(M,x){var f=this;void 0===M&&(M=!1),void 0===x&&(x=!1),this.ref instanceof hC||this.changes.forEach((function(M){if(M.op===C.OPERATION.DELETE){var x=f.ref.getIndex(M.index);delete f.indexes[x]}})),this.changes.clear(),this.changed=M,x&&this.allChanges.clear(),this.currentCustomOperation=0},M.prototype.discardAll=function(){var C=this;this.changes.forEach((function(M){var x=C.getValue(M.index);x&&x.$changes&&x.$changes.discardAll()})),this.discard()},M.prototype.cache=function(C,M){this.caches[C]=M},M.prototype.clone=function(){return new M(this.ref,this.parent,this.root)},M.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},M.prototype.assertValidIndex=function(C,M){if(void 0===C)throw new Error('ChangeTree: missing index for field "'.concat(M,'"'))},M}();function Q(C,M,x,f){return C[M]||(C[M]=[]),C[M].push(x),null===f||void 0===f||f.forEach((function(C,M){return x(C,M)})),function(){return y(C[M],C[M].indexOf(x))}}function V(M){var x=this,f="string"!==typeof this.$changes.getType();this.$items.forEach((function(T,z){M.push({refId:x.$changes.refId,op:C.OPERATION.DELETE,field:z,value:void 0,previousValue:T}),f&&x.$changes.root.removeRef(T.$changes.refId)}))}function y(C,M){if(-1===M||M>=C.length)return!1;for(var x=C.length-1,f=M;f<x;f++)C[f]=C[f+1];return C.length=x,!0}var U=function(C,M){var x=C.toString(),f=M.toString();return x<f?-1:x>f?1:0};function O(C){return C.$proxy=!0,C=new Proxy(C,{get:function(C,M){return"symbol"===typeof M||isNaN(M)?C[M]:C.at(M)},set:function(C,M,x){if("symbol"===typeof M||isNaN(M))C[M]=x;else{var f=Array.from(C.$items.keys()),T=parseInt(f[M]||M);void 0===x||null===x?C.deleteAt(T):C.setAt(T,x)}return!0},deleteProperty:function(C,M){return"number"===typeof M?C.deleteAt(M):delete C[M],!0}})}var d=function(){function M(){for(var C=[],M=0;M<arguments.length;M++)C[M]=arguments[M];this.$changes=new m(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,C)}return M.prototype.Zf=function(M,x){return void 0===x&&(x=!0),Q(this.$callbacks||(this.$callbacks=[]),C.OPERATION.ADD,M,x?this.$items:void 0)},M.prototype.ab=function(M){return Q(this.$callbacks||(this.$callbacks=[]),C.OPERATION.DELETE,M)},M.prototype.onChange=function(M){return Q(this.$callbacks||(this.$callbacks=[]),C.OPERATION.REPLACE,M)},M.is=function(C){return Array.isArray(C)||void 0!==C.array},Object.defineProperty(M.prototype,"length",{get:function(){return this.$items.size},set:function(C){0===C?this.clear():this.splice(C,this.length-C)},enumerable:!1,configurable:!0}),M.prototype.push=function(){for(var C,M=this,x=[],f=0;f<arguments.length;f++)x[f]=arguments[f];return x.forEach((function(x){C=M.$refId++,M.setAt(C,x)})),C},M.prototype.pop=function(){var C=Array.from(this.$indexes.values()).pop();if(void 0!==C){this.$changes.delete(C),this.$indexes.delete(C);var M=this.$items.get(C);return this.$items.delete(C),M}},M.prototype.at=function(C){var M=Array.from(this.$items.keys())[C];return this.$items.get(M)},M.prototype.setAt=function(M,x){var f,T;if(void 0!==x&&null!==x){if(this.$items.get(M)!==x){void 0!==x.$changes&&x.$changes.setParent(this,this.$changes.root,M);var z=null!==(T=null===(f=this.$changes.indexes[M])||void 0===f?void 0:f.op)&&void 0!==T?T:C.OPERATION.ADD;this.$changes.indexes[M]=M,this.$indexes.set(M,M),this.$items.set(M,x),this.$changes.change(M,z)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},M.prototype.deleteAt=function(C){var M=Array.from(this.$items.keys())[C];return void 0!==M&&this.$deleteAt(M)},M.prototype.$deleteAt=function(C){return this.$changes.delete(C),this.$indexes.delete(C),this.$items.delete(C)},M.prototype.clear=function(M){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),M&&V.call(this,M),this.$items.clear(),this.$changes.operation({index:0,op:C.OPERATION.CLEAR}),this.$changes.touchParents()},M.prototype.concat=function(){for(var C,x=[],f=0;f<arguments.length;f++)x[f]=arguments[f];return new(M.bind.apply(M,T([void 0],(C=Array.from(this.$items.values())).concat.apply(C,x),!1)))},M.prototype.join=function(C){return Array.from(this.$items.values()).join(C)},M.prototype.reverse=function(){var C=this,M=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(x,f){C.setAt(M[f],x)})),this},M.prototype.shift=function(){var C=Array.from(this.$items.keys()).shift();if(void 0!==C){var M=this.$items.get(C);return this.$deleteAt(C),M}},M.prototype.slice=function(C,x){var f=new M;return f.push.apply(f,Array.from(this.$items.values()).slice(C,x)),f},M.prototype.sort=function(C){var M=this;void 0===C&&(C=U);var x=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(C).forEach((function(C,f){M.setAt(x[f],C)})),this},M.prototype.splice=function(C,M){void 0===M&&(M=this.length-C);for(var x=Array.from(this.$items.keys()),f=[],T=C;T<C+M;T++)f.push(this.$items.get(x[T])),this.$deleteAt(x[T]);return f},M.prototype.unshift=function(){for(var C=this,M=[],x=0;x<arguments.length;x++)M[x]=arguments[x];var f=this.length,T=M.length,z=Array.from(this.$items.values());return M.forEach((function(M,x){C.setAt(x,M)})),z.forEach((function(M,x){C.setAt(T+x,M)})),f+T},M.prototype.indexOf=function(C,M){return Array.from(this.$items.values()).indexOf(C,M)},M.prototype.lastIndexOf=function(C,M){return void 0===M&&(M=this.length-1),Array.from(this.$items.values()).lastIndexOf(C,M)},M.prototype.every=function(C,M){return Array.from(this.$items.values()).every(C,M)},M.prototype.some=function(C,M){return Array.from(this.$items.values()).some(C,M)},M.prototype.forEach=function(C,M){Array.from(this.$items.values()).forEach(C,M)},M.prototype.map=function(C,M){return Array.from(this.$items.values()).map(C,M)},M.prototype.filter=function(C,M){return Array.from(this.$items.values()).filter(C,M)},M.prototype.reduce=function(C,M){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},M.prototype.reduceRight=function(C,M){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},M.prototype.find=function(C,M){return Array.from(this.$items.values()).find(C,M)},M.prototype.findIndex=function(C,M){return Array.from(this.$items.values()).findIndex(C,M)},M.prototype.fill=function(C,M,x){throw new Error("ArraySchema#fill() not implemented")},M.prototype.copyWithin=function(C,M,x){throw new Error("ArraySchema#copyWithin() not implemented")},M.prototype.toString=function(){return this.$items.toString()},M.prototype.toLocaleString=function(){return this.$items.toLocaleString()},M.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(M,Symbol.species,{get:function(){return M},enumerable:!1,configurable:!0}),M.prototype.entries=function(){return this.$items.entries()},M.prototype.keys=function(){return this.$items.keys()},M.prototype.values=function(){return this.$items.values()},M.prototype.includes=function(C,M){return Array.from(this.$items.values()).includes(C,M)},M.prototype.flatMap=function(C,M){throw new Error("ArraySchema#flatMap() is not supported.")},M.prototype.flat=function(C){throw new Error("ArraySchema#flat() is not supported.")},M.prototype.findLast=function(){var C=Array.from(this.$items.values());return C.findLast.apply(C,arguments)},M.prototype.findLastIndex=function(){var C=Array.from(this.$items.values());return C.findLastIndex.apply(C,arguments)},M.prototype.setIndex=function(C,M){this.$indexes.set(C,M)},M.prototype.getIndex=function(C){return this.$indexes.get(C)},M.prototype.getByIndex=function(C){return this.$items.get(this.$indexes.get(C))},M.prototype.deleteByIndex=function(C){var M=this.$indexes.get(C);this.$items.delete(M),this.$indexes.delete(C)},M.prototype.toArray=function(){return Array.from(this.$items.values())},M.prototype.toJSON=function(){return this.toArray().map((function(C){return"function"===typeof C.toJSON?C.toJSON():C}))},M.prototype.clone=function(C){return C?new(M.bind.apply(M,T([void 0],Array.from(this.$items.values()),!1))):new(M.bind.apply(M,T([void 0],this.map((function(C){return C.$changes?C.clone():C})),!1)))},M}();function D(C){return C.$proxy=!0,C=new Proxy(C,{get:function(C,M){return"symbol"!==typeof M&&"undefined"===typeof C[M]?C.get(M):C[M]},set:function(C,M,x){return"symbol"!==typeof M&&-1===M.indexOf("$")&&"Zf"!==M&&"ab"!==M&&"onChange"!==M?C.set(M,x):C[M]=x,!0},deleteProperty:function(C,M){return C.delete(M),!0}})}var o=function(){function M(C){var x=this;if(this.$changes=new m(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,C)if(C instanceof Map||C instanceof M)C.forEach((function(C,M){return x.set(M,C)}));else for(var f in C)this.set(f,C[f])}return M.prototype.Zf=function(M,x){return void 0===x&&(x=!0),Q(this.$callbacks||(this.$callbacks=[]),C.OPERATION.ADD,M,x?this.$items:void 0)},M.prototype.ab=function(M){return Q(this.$callbacks||(this.$callbacks=[]),C.OPERATION.DELETE,M)},M.prototype.onChange=function(M){return Q(this.$callbacks||(this.$callbacks=[]),C.OPERATION.REPLACE,M)},M.is=function(C){return void 0!==C.map},M.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(M.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(M,Symbol.species,{get:function(){return M},enumerable:!1,configurable:!0}),M.prototype.set=function(M,x){if(void 0===x||null===x)throw new Error("MapSchema#set('".concat(M,"', ").concat(x,"): trying to set ").concat(x," value on '").concat(M,"'."));M=M.toString();var f="undefined"!==typeof this.$changes.indexes[M],T=f?this.$changes.indexes[M]:this.$refId++,z=f?C.OPERATION.REPLACE:C.OPERATION.ADD,s=void 0!==x.$changes;if(s&&x.$changes.setParent(this,this.$changes.root,T),f){if(!s&&this.$items.get(M)===x)return;s&&this.$items.get(M)!==x&&(z=C.OPERATION.ADD)}else this.$changes.indexes[M]=T,this.$indexes.set(T,M);return this.$items.set(M,x),this.$changes.change(M,z),this},M.prototype.get=function(C){return this.$items.get(C)},M.prototype.delete=function(C){return this.$changes.delete(C),this.$items.delete(C)},M.prototype.clear=function(M){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),M&&V.call(this,M),this.$items.clear(),this.$changes.operation({index:0,op:C.OPERATION.CLEAR}),this.$changes.touchParents()},M.prototype.has=function(C){return this.$items.has(C)},M.prototype.forEach=function(C){this.$items.forEach(C)},M.prototype.entries=function(){return this.$items.entries()},M.prototype.keys=function(){return this.$items.keys()},M.prototype.values=function(){return this.$items.values()},Object.defineProperty(M.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),M.prototype.setIndex=function(C,M){this.$indexes.set(C,M)},M.prototype.getIndex=function(C){return this.$indexes.get(C)},M.prototype.getByIndex=function(C){return this.$items.get(this.$indexes.get(C))},M.prototype.deleteByIndex=function(C){var M=this.$indexes.get(C);this.$items.delete(M),this.$indexes.delete(C)},M.prototype.toJSON=function(){var C={};return this.forEach((function(M,x){C[x]="function"===typeof M.toJSON?M.toJSON():M})),C},M.prototype.clone=function(C){var x;return C?x=Object.assign(new M,this):(x=new M,this.forEach((function(C,M){C.$changes?x.set(M,C.clone()):x.set(M,C)}))),x},M}(),L={};function t(C,M){L[C]=M}function A(C){return L[C]}var H=function(){function C(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return C.create=function(M){var x=new C;return x.schema=Object.assign({},M&&M.schema||{}),x.indexes=Object.assign({},M&&M.indexes||{}),x.fieldsByIndex=Object.assign({},M&&M.fieldsByIndex||{}),x.descriptors=Object.assign({},M&&M.descriptors||{}),x.deprecated=Object.assign({},M&&M.deprecated||{}),x},C.prototype.addField=function(C,M){var x=this.getNextFieldIndex();this.fieldsByIndex[x]=C,this.indexes[C]=x,this.schema[C]=Array.isArray(M)?{array:M[0]}:M},C.prototype.hasField=function(C){return void 0!==this.indexes[C]},C.prototype.addFilter=function(C,M){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[C]]=M,this.indexesWithFilters.push(this.indexes[C]),!0},C.prototype.addChildrenFilter=function(C,M){var x=this.indexes[C],f=this.schema[C];if(A(Object.keys(f)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[x]=M,!0;console.warn("@filterChildren: field '".concat(C,"' can't have children. Ignoring filter."))},C.prototype.getChildrenFilter=function(C){return this.childFilters&&this.childFilters[this.indexes[C]]},C.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},C}();function j(C){return C._context&&C._context.useFilters}var b=function(){function C(){this.types={},this.schemas=new Map,this.useFilters=!1}return C.prototype.has=function(C){return this.schemas.has(C)},C.prototype.get=function(C){return this.types[C]},C.prototype.add=function(C,M){void 0===M&&(M=this.schemas.size),C._definition=H.create(C._definition),C._typeid=M,this.types[M]=C,this.schemas.set(C,M)},C.create=function(M){return void 0===M&&(M={}),function(x){return M.context||(M.context=new C),n(x,M)}},C}(),R=new b;function n(C,M){return void 0===M&&(M={}),function(x,f){var z=M.context||R,s=x.constructor;if(s._context=z,!C)throw new Error("".concat(s.name,': @type() reference provided for "').concat(f,"\" is undefined. Make sure you don't have any circular dependencies."));z.has(s)||z.add(s);var S=s._definition;if(S.addField(f,C),S.descriptors[f]){if(S.deprecated[f])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(f,"' definition on '").concat(s.name,"'.\nCheck @type() annotation"))}catch(L){var m=L.stack.split("\n")[4].trim();throw new Error("".concat(L.message," ").concat(m))}}var Q=d.is(C),V=!Q&&o.is(C);if("string"!==typeof C&&!hC.is(C)){var y=Object.values(C)[0];"string"===typeof y||z.has(y)||z.add(y)}if(M.manual)S.descriptors[f]={enumerable:!0,configurable:!0,writable:!0};else{var U="_".concat(f);S.descriptors[U]={enumerable:!1,configurable:!1,writable:!0},S.descriptors[f]={get:function(){return this[U]},set:function(C){C!==this[U]&&(void 0!==C&&null!==C?(!Q||C instanceof d||(C=new(d.bind.apply(d,T([void 0],C,!1)))),!V||C instanceof o||(C=new o(C)),void 0===C.$proxy&&(V?C=D(C):Q&&(C=O(C))),this.$changes.change(f),C.$changes&&C.$changes.setParent(this,this.$changes.root,this._definition.indexes[f])):this[U]&&this.$changes.delete(f),this[U]=C)},enumerable:!0,configurable:!0}}}}function I(C){return function(M,x){var f=M.constructor;f._definition.addFilter(x,C)&&(f._context.useFilters=!0)}}function X(C){return function(M,x){var f=M.constructor;f._definition.addChildrenFilter(x,C)&&(f._context.useFilters=!0)}}function g(C){return void 0===C&&(C=!0),function(M,x){var f=M.constructor._definition;f.deprecated[x]=!0,C&&(f.descriptors[x]={get:function(){throw new Error("".concat(x," is deprecated."))},set:function(C){},enumerable:!1,configurable:!0})}}function B(C,M,x){for(var f in void 0===x&&(x={}),x.context||(x.context=C._context||x.context||R),M)n(M[f],x)(C.prototype,f);return C}function F(C){for(var M=0,x=0,f=0,T=C.length;f<T;f++)(M=C.charCodeAt(f))<128?x+=1:M<2048?x+=2:M<55296||M>=57344?x+=3:(f++,x+=4);return x}function P(C,M,x){for(var f=0,T=0,z=x.length;T<z;T++)(f=x.charCodeAt(T))<128?C[M++]=f:f<2048?(C[M++]=192|f>>6,C[M++]=128|63&f):f<55296||f>=57344?(C[M++]=224|f>>12,C[M++]=128|f>>6&63,C[M++]=128|63&f):(T++,f=65536+((1023&f)<<10|1023&x.charCodeAt(T)),C[M++]=240|f>>18,C[M++]=128|f>>12&63,C[M++]=128|f>>6&63,C[M++]=128|63&f)}function h(C,M){C.push(255&M)}function c(C,M){C.push(255&M)}function q(C,M){C.push(255&M),C.push(M>>8&255)}function i(C,M){C.push(255&M),C.push(M>>8&255)}function Z(C,M){C.push(255&M),C.push(M>>8&255),C.push(M>>16&255),C.push(M>>24&255)}function E(C,M){var x=M>>24,f=M>>16,T=M>>8,z=M;C.push(255&z),C.push(255&T),C.push(255&f),C.push(255&x)}function K(C,M){var x=Math.floor(M/Math.pow(2,32));E(C,M>>>0),E(C,x)}function G(C,M){var x=M/Math.pow(2,32)|0;E(C,M>>>0),E(C,x)}function a(C,M){p(C,M)}function J(C,M){u(C,M)}var N=new Int32Array(2),k=new Float32Array(N.buffer),v=new Float64Array(N.buffer);function p(C,M){k[0]=M,Z(C,N[0])}function u(C,M){v[0]=M,Z(C,N[0]),Z(C,N[1])}function Y(C,M){return c(C,M?1:0)}function W(C,M){M||(M="");var x=F(M),f=0;if(x<32)C.push(160|x),f=1;else if(x<256)C.push(217),c(C,x),f=2;else if(x<65536)C.push(218),i(C,x),f=3;else{if(!(x<4294967296))throw new Error("String too long");C.push(219),E(C,x),f=5}return P(C,C.length,M),f+x}function e(C,M){return isNaN(M)?e(C,0):isFinite(M)?M!==(0|M)?(C.push(203),u(C,M),9):M>=0?M<128?(c(C,M),1):M<256?(C.push(204),c(C,M),2):M<65536?(C.push(205),i(C,M),3):M<4294967296?(C.push(206),E(C,M),5):(C.push(207),G(C,M),9):M>=-32?(C.push(224|M+32),1):M>=-128?(C.push(208),h(C,M),2):M>=-32768?(C.push(209),q(C,M),3):M>=-2147483648?(C.push(210),Z(C,M),5):(C.push(211),K(C,M),9):e(C,M>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var r=Object.freeze({__proto__:null,utf8Write:P,int8:h,uint8:c,int16:q,uint16:i,int32:Z,uint32:E,int64:K,uint64:G,float32:a,float64:J,writeFloat32:p,writeFloat64:u,boolean:Y,string:W,number:e});function w(C,M,x){for(var f="",T=0,z=M,s=M+x;z<s;z++){var S=C[z];0!==(128&S)?192!==(224&S)?224!==(240&S)?240!==(248&S)?console.error("Invalid byte "+S.toString(16)):(T=(7&S)<<18|(63&C[++z])<<12|(63&C[++z])<<6|63&C[++z])>=65536?(T-=65536,f+=String.fromCharCode(55296+(T>>>10),56320+(1023&T))):f+=String.fromCharCode(T):f+=String.fromCharCode((15&S)<<12|(63&C[++z])<<6|63&C[++z]):f+=String.fromCharCode((31&S)<<6|63&C[++z]):f+=String.fromCharCode(S)}return f}function l(C,M){return CC(C,M)<<24>>24}function CC(C,M){return C[M.offset++]}function MC(C,M){return xC(C,M)<<16>>16}function xC(C,M){return C[M.offset++]|C[M.offset++]<<8}function fC(C,M){return C[M.offset++]|C[M.offset++]<<8|C[M.offset++]<<16|C[M.offset++]<<24}function TC(C,M){return fC(C,M)>>>0}function zC(C,M){return UC(C,M)}function sC(C,M){return OC(C,M)}function SC(C,M){var x=TC(C,M);return fC(C,M)*Math.pow(2,32)+x}function mC(C,M){var x=TC(C,M);return TC(C,M)*Math.pow(2,32)+x}var QC=new Int32Array(2),VC=new Float32Array(QC.buffer),yC=new Float64Array(QC.buffer);function UC(C,M){return QC[0]=fC(C,M),VC[0]}function OC(C,M){return QC[0]=fC(C,M),QC[1]=fC(C,M),yC[0]}function dC(C,M){return CC(C,M)>0}function DC(C,M){var x,f=C[M.offset++];f<192?x=31&f:217===f?x=CC(C,M):218===f?x=xC(C,M):219===f&&(x=TC(C,M));var T=w(C,M.offset,x);return M.offset+=x,T}function oC(C,M){var x=C[M.offset];return x<192&&x>160||217===x||218===x||219===x}function LC(C,M){var x=C[M.offset++];return x<128?x:202===x?UC(C,M):203===x?OC(C,M):204===x?CC(C,M):205===x?xC(C,M):206===x?TC(C,M):207===x?mC(C,M):208===x?l(C,M):209===x?MC(C,M):210===x?fC(C,M):211===x?SC(C,M):x>223?-1*(255-x+1):void 0}function tC(C,M){var x=C[M.offset];return x<128||x>=202&&x<=211}function AC(C,M){return C[M.offset]<160}function HC(C,M){return C[M.offset-1]===s&&(C[M.offset]<128||C[M.offset]>=202&&C[M.offset]<=211)}var jC=Object.freeze({__proto__:null,int8:l,uint8:CC,int16:MC,uint16:xC,int32:fC,uint32:TC,float32:zC,float64:sC,int64:SC,uint64:mC,readFloat32:UC,readFloat64:OC,boolean:dC,string:DC,stringCheck:oC,number:LC,numberCheck:tC,arrayCheck:AC,switchStructureCheck:HC}),bC=function(){function M(C){var M=this;this.$changes=new m(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,C&&C.forEach((function(C){return M.add(C)}))}return M.prototype.Zf=function(M,x){return void 0===x&&(x=!0),Q(this.$callbacks||(this.$callbacks=[]),C.OPERATION.ADD,M,x?this.$items:void 0)},M.prototype.ab=function(M){return Q(this.$callbacks||(this.$callbacks=[]),C.OPERATION.DELETE,M)},M.prototype.onChange=function(M){return Q(this.$callbacks||(this.$callbacks=[]),C.OPERATION.REPLACE,M)},M.is=function(C){return void 0!==C.collection},M.prototype.add=function(C){var M=this.$refId++;return void 0!==C.$changes&&C.$changes.setParent(this,this.$changes.root,M),this.$changes.indexes[M]=M,this.$indexes.set(M,M),this.$items.set(M,C),this.$changes.change(M),M},M.prototype.at=function(C){var M=Array.from(this.$items.keys())[C];return this.$items.get(M)},M.prototype.entries=function(){return this.$items.entries()},M.prototype.delete=function(C){for(var M,x,f=this.$items.entries();(x=f.next())&&!x.done;)if(C===x.value[1]){M=x.value[0];break}return void 0!==M&&(this.$changes.delete(M),this.$indexes.delete(M),this.$items.delete(M))},M.prototype.clear=function(M){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),M&&V.call(this,M),this.$items.clear(),this.$changes.operation({index:0,op:C.OPERATION.CLEAR}),this.$changes.touchParents()},M.prototype.has=function(C){return Array.from(this.$items.values()).some((function(M){return M===C}))},M.prototype.forEach=function(C){var M=this;this.$items.forEach((function(x,f,T){return C(x,f,M)}))},M.prototype.values=function(){return this.$items.values()},Object.defineProperty(M.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),M.prototype.setIndex=function(C,M){this.$indexes.set(C,M)},M.prototype.getIndex=function(C){return this.$indexes.get(C)},M.prototype.getByIndex=function(C){return this.$items.get(this.$indexes.get(C))},M.prototype.deleteByIndex=function(C){var M=this.$indexes.get(C);this.$items.delete(M),this.$indexes.delete(C)},M.prototype.toArray=function(){return Array.from(this.$items.values())},M.prototype.toJSON=function(){var C=[];return this.forEach((function(M,x){C.push("function"===typeof M.toJSON?M.toJSON():M)})),C},M.prototype.clone=function(C){var x;return C?x=Object.assign(new M,this):(x=new M,this.forEach((function(C){C.$changes?x.add(C.clone()):x.add(C)}))),x},M}(),RC=function(){function M(C){var M=this;this.$changes=new m(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,C&&C.forEach((function(C){return M.add(C)}))}return M.prototype.Zf=function(M,x){return void 0===x&&(x=!0),Q(this.$callbacks||(this.$callbacks=[]),C.OPERATION.ADD,M,x?this.$items:void 0)},M.prototype.ab=function(M){return Q(this.$callbacks||(this.$callbacks=[]),C.OPERATION.DELETE,M)},M.prototype.onChange=function(M){return Q(this.$callbacks||(this.$callbacks=[]),C.OPERATION.REPLACE,M)},M.is=function(C){return void 0!==C.set},M.prototype.add=function(M){var x,f;if(this.has(M))return!1;var T=this.$refId++;void 0!==M.$changes&&M.$changes.setParent(this,this.$changes.root,T);var z=null!==(f=null===(x=this.$changes.indexes[T])||void 0===x?void 0:x.op)&&void 0!==f?f:C.OPERATION.ADD;return this.$changes.indexes[T]=T,this.$indexes.set(T,T),this.$items.set(T,M),this.$changes.change(T,z),T},M.prototype.entries=function(){return this.$items.entries()},M.prototype.delete=function(C){for(var M,x,f=this.$items.entries();(x=f.next())&&!x.done;)if(C===x.value[1]){M=x.value[0];break}return void 0!==M&&(this.$changes.delete(M),this.$indexes.delete(M),this.$items.delete(M))},M.prototype.clear=function(M){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),M&&V.call(this,M),this.$items.clear(),this.$changes.operation({index:0,op:C.OPERATION.CLEAR}),this.$changes.touchParents()},M.prototype.has=function(C){for(var M,x=this.$items.values(),f=!1;(M=x.next())&&!M.done;)if(C===M.value){f=!0;break}return f},M.prototype.forEach=function(C){var M=this;this.$items.forEach((function(x,f,T){return C(x,f,M)}))},M.prototype.values=function(){return this.$items.values()},Object.defineProperty(M.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),M.prototype.setIndex=function(C,M){this.$indexes.set(C,M)},M.prototype.getIndex=function(C){return this.$indexes.get(C)},M.prototype.getByIndex=function(C){return this.$items.get(this.$indexes.get(C))},M.prototype.deleteByIndex=function(C){var M=this.$indexes.get(C);this.$items.delete(M),this.$indexes.delete(C)},M.prototype.toArray=function(){return Array.from(this.$items.values())},M.prototype.toJSON=function(){var C=[];return this.forEach((function(M,x){C.push("function"===typeof M.toJSON?M.toJSON():M)})),C},M.prototype.clone=function(C){var x;return C?x=Object.assign(new M,this):(x=new M,this.forEach((function(C){C.$changes?x.add(C.clone()):x.add(C)}))),x},M}(),nC=function(){function C(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return C.prototype.addRefId=function(C){this.refIds.has(C)||(this.refIds.add(C),this.containerIndexes.set(C,new Set))},C.get=function(M){return void 0===M.$filterState&&(M.$filterState=new C),M.$filterState},C}(),IC=function(){function C(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return C.prototype.getNextUniqueId=function(){return this.nextUniqueId++},C.prototype.addRef=function(C,M,x){void 0===x&&(x=!0),this.refs.set(C,M),x&&(this.refCounts[C]=(this.refCounts[C]||0)+1)},C.prototype.removeRef=function(C){this.refCounts[C]=this.refCounts[C]-1,this.deletedRefs.add(C)},C.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},C.prototype.garbageCollectDeletedRefs=function(){var C=this;this.deletedRefs.forEach((function(M){if(!(C.refCounts[M]>0)){var x=C.refs.get(M);if(x instanceof hC)for(var f in x._definition.schema)"string"!==typeof x._definition.schema[f]&&x[f]&&x[f].$changes&&C.removeRef(x[f].$changes.refId);else{var T=x.$changes.parent._definition,z=T.schema[T.fieldsByIndex[x.$changes.parentIndex]];"function"===typeof Object.values(z)[0]&&Array.from(x.values()).forEach((function(M){return C.removeRef(M.$changes.refId)}))}C.refs.delete(M),delete C.refCounts[M]}})),this.deletedRefs.clear()},C}(),XC=function(C){function M(){return null!==C&&C.apply(this,arguments)||this}return x(M,C),M}(Error);function gC(C,M,x,f){var T,z=!1;switch(M){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":T="number",isNaN(C)&&console.log('trying to encode "NaN" in '.concat(x.constructor.name,"#").concat(f));break;case"string":T="string",z=!0;break;case"boolean":return}if(typeof C!==T&&(!z||z&&null!==C)){var s="'".concat(JSON.stringify(C),"'").concat(C&&C.constructor&&" (".concat(C.constructor.name,")")||"");throw new XC("a '".concat(T,"' was expected, but ").concat(s," was provided in ").concat(x.constructor.name,"#").concat(f))}}function BC(C,M,x,f){if(!(C instanceof M))throw new XC("a '".concat(M.name,"' was expected, but '").concat(C.constructor.name,"' was provided in ").concat(x.constructor.name,"#").concat(f))}function FC(C,M,x,f,T){gC(x,C,f,T);var z=r[C];if(!z)throw new XC("a '".concat(C,"' was expected, but ").concat(x," was provided in ").concat(f.constructor.name,"#").concat(T));z(M,x)}function PC(C,M,x){return jC[C](M,x)}var hC=function(){function M(){for(var C=[],M=0;M<arguments.length;M++)C[M]=arguments[M];Object.defineProperties(this,{$changes:{value:new m(this,void 0,new IC),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var x=this._definition.descriptors;x&&Object.defineProperties(this,x),C[0]&&this.assign(C[0])}return M.onError=function(C){console.error(C)},M.is=function(C){return C._definition&&void 0!==C._definition.schema},M.prototype.onChange=function(M){return Q(this.$callbacks||(this.$callbacks=[]),C.OPERATION.REPLACE,M)},M.prototype.ab=function(M){return Q(this.$callbacks||(this.$callbacks=[]),C.OPERATION.DELETE,M)},M.prototype.assign=function(C){return Object.assign(this,C),this},Object.defineProperty(M.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),M.prototype.setDirty=function(C,M){this.$changes.change(C,M)},M.prototype.listen=function(C,M,x){var f=this;return void 0===x&&(x=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[C]||(this.$callbacks[C]=[]),this.$callbacks[C].push(M),x&&void 0!==this[C]&&M(this[C],void 0),function(){return y(f.$callbacks[C],f.$callbacks[C].indexOf(M))}},M.prototype.decode=function(x,f,T){var z;void 0===f&&(f={offset:0}),void 0===T&&(T=this);var S=[],m=this.$changes.root,Q=x.length,V=0;for(m.refs.set(V,this);f.offset<Q;){var y=x[f.offset++];if(y!=s){var U=T.$changes,O=void 0!==T._definition,D=O?y>>6<<6:y;if(D!==C.OPERATION.CLEAR){var L=O?y%(D||255):LC(x,f),t=O?T._definition.fieldsByIndex[L]:"",H=U.getType(L),j=void 0,b=void 0,R=void 0;if(O?b=T["_".concat(t)]:(b=T.getByIndex(L),(D&C.OPERATION.ADD)===C.OPERATION.ADD?(R=T instanceof o?DC(x,f):L,T.setIndex(L,R)):R=T.getIndex(L)),(D&C.OPERATION.DELETE)===C.OPERATION.DELETE&&(D!==C.OPERATION.DELETE_AND_ADD&&T.deleteByIndex(L),b&&b.$changes&&m.removeRef(b.$changes.refId),j=null),void 0!==t){if(D===C.OPERATION.DELETE);else if(M.is(H)){var n=LC(x,f);if(j=m.refs.get(n),D!==C.OPERATION.REPLACE){var I=this.getSchemaType(x,f,H);j||((j=this.createTypeInstance(I)).$changes.refId=n,b&&(j.$callbacks=b.$callbacks,b.$changes.refId&&n!==b.$changes.refId&&m.removeRef(b.$changes.refId))),m.addRef(n,j,j!==b)}}else if("string"===typeof H)j=PC(H,x,f);else{var X=A(Object.keys(H)[0]),g=LC(x,f),B=m.refs.has(g)?b||m.refs.get(g):new X.constructor;if((j=B.clone(!0)).$changes.refId=g,b&&(j.$callbacks=b.$callbacks,b.$changes.refId&&g!==b.$changes.refId)){m.removeRef(b.$changes.refId);for(var F=b.entries(),P=void 0;(P=F.next())&&!P.done;){var h=(z=P.value)[0],c=z[1];S.push({refId:g,op:C.OPERATION.DELETE,field:h,value:void 0,previousValue:c})}}m.addRef(g,j,B!==b)}if(null!==j&&void 0!==j)if(j.$changes&&j.$changes.setParent(U.ref,U.root,L),T instanceof M)T[t]=j;else if(T instanceof o)h=R,T.$items.set(h,j),T.$changes.allChanges.add(L);else if(T instanceof d)T.setAt(L,j);else if(T instanceof bC){var q=T.add(j);T.setIndex(L,q)}else T instanceof RC&&!1!==(q=T.add(j))&&T.setIndex(L,q);b!==j&&S.push({refId:V,op:D,field:t,dynamicIndex:R,value:j,previousValue:b})}else{console.warn("@colyseus/schema: definition mismatch");for(var i={offset:f.offset};f.offset<Q&&(!HC(x,f)||(i.offset=f.offset+1,!m.refs.has(LC(x,i))));)f.offset++}}else T.clear(S)}else{V=LC(x,f);var Z=m.refs.get(V);if(!Z)throw new Error('"refId" not found: '.concat(V));T=Z}}return this._triggerChanges(S),m.garbageCollectDeletedRefs(),S},M.prototype.encode=function(x,f,T){void 0===x&&(x=!1),void 0===f&&(f=[]),void 0===T&&(T=!1);for(var z=this.$changes,S=new WeakSet,m=[z],Q=1,V=0;V<Q;V++){var y=m[V],U=y.ref,O=U instanceof M;y.ensureRefId(),S.add(y),y!==z&&(y.changed||x)&&(c(f,s),e(f,y.refId));for(var d=x?Array.from(y.allChanges):Array.from(y.changes.values()),D=0,L=d.length;D<L;D++){var t=x?{op:C.OPERATION.ADD,index:d[D]}:d[D],H=t.index,j=O?U._definition.fieldsByIndex&&U._definition.fieldsByIndex[H]:H,b=f.length;if(t.op!==C.OPERATION.TOUCH)if(O)c(f,H|t.op);else{if(c(f,t.op),t.op===C.OPERATION.CLEAR)continue;e(f,H)}if(O||(t.op&C.OPERATION.ADD)!=C.OPERATION.ADD||U instanceof o&&W(f,y.ref.$indexes.get(H)),t.op!==C.OPERATION.DELETE){var R=y.getType(H),n=y.getValue(H);if(n&&n.$changes&&!S.has(n.$changes)&&(m.push(n.$changes),n.$changes.ensureRefId(),Q++),t.op!==C.OPERATION.TOUCH){if(M.is(R))BC(n,R,U,j),e(f,n.$changes.refId),(t.op&C.OPERATION.ADD)===C.OPERATION.ADD&&this.tryEncodeTypeId(f,R,n.constructor);else if("string"===typeof R)FC(R,f,n,U,j);else{var I=A(Object.keys(R)[0]);BC(U["_".concat(j)],I.constructor,U,j),e(f,n.$changes.refId)}T&&y.cache(H,f.slice(b))}}}x||T||y.discard()}return f},M.prototype.encodeAll=function(C){return this.encode(!0,[],C)},M.prototype.applyFilters=function(x,f){var T,z;void 0===f&&(f=!1);for(var S=this,m=new Set,Q=nC.get(x),V=[this.$changes],y=1,U=[],O=function(O){var d=V[O];if(m.has(d.refId))return"continue";var D=d.ref,L=D instanceof M;c(U,s),e(U,d.refId);var t=Q.refIds.has(d),A=f||!t;Q.addRefId(d);var H=Q.containerIndexes.get(d),j=A?Array.from(d.allChanges):Array.from(d.changes.values());!f&&L&&D._definition.indexesWithFilters&&D._definition.indexesWithFilters.forEach((function(M){!H.has(M)&&d.allChanges.has(M)&&(A?j.push(M):j.push({op:C.OPERATION.ADD,index:M}))}));for(var b=0,R=j.length;b<R;b++){var n=A?{op:C.OPERATION.ADD,index:j[b]}:j[b];if(n.op!==C.OPERATION.CLEAR){var I=n.index;if(n.op!==C.OPERATION.DELETE){var X=d.getValue(I),g=d.getType(I);if(L){if((B=D._definition.filters&&D._definition.filters[I])&&!B.call(D,x,X,S)){X&&X.$changes&&m.add(X.$changes.refId);continue}}else{var B,F=d.parent;if((B=d.getChildrenFilter())&&!B.call(F,x,D.$indexes.get(I),X,S)){X&&X.$changes&&m.add(X.$changes.refId);continue}}if(X.$changes&&(V.push(X.$changes),y++),n.op!==C.OPERATION.TOUCH)if(n.op===C.OPERATION.ADD||L)U.push.apply(U,null!==(T=d.caches[I])&&void 0!==T?T:[]),H.add(I);else if(H.has(I))U.push.apply(U,null!==(z=d.caches[I])&&void 0!==z?z:[]);else{if(H.add(I),c(U,C.OPERATION.ADD),e(U,I),D instanceof o){var P=d.ref.$indexes.get(I);W(U,P)}X.$changes?e(U,X.$changes.refId):r[g](U,X)}else X.$changes&&!L&&(c(U,C.OPERATION.ADD),e(U,I),D instanceof o&&(P=d.ref.$indexes.get(I),W(U,P)),e(U,X.$changes.refId))}else L?c(U,n.op|I):(c(U,n.op),e(U,I))}else c(U,n.op)}},d=0;d<y;d++)O(d);return U},M.prototype.clone=function(){var C,M=new this.constructor,x=this._definition.schema;for(var f in x)"object"===typeof this[f]&&"function"===typeof(null===(C=this[f])||void 0===C?void 0:C.clone)?M[f]=this[f].clone():M[f]=this[f];return M},M.prototype.toJSON=function(){var C=this._definition.schema,M=this._definition.deprecated,x={};for(var f in C)M[f]||null===this[f]||"undefined"===typeof this[f]||(x[f]="function"===typeof this[f].toJSON?this[f].toJSON():this["_".concat(f)]);return x},M.prototype.discardAllChanges=function(){this.$changes.discardAll()},M.prototype.getByIndex=function(C){return this[this._definition.fieldsByIndex[C]]},M.prototype.deleteByIndex=function(C){this[this._definition.fieldsByIndex[C]]=void 0},M.prototype.tryEncodeTypeId=function(C,M,x){M._typeid!==x._typeid&&(c(C,S),e(C,x._typeid))},M.prototype.getSchemaType=function(C,M,x){var f;return C[M.offset]===S&&(M.offset++,f=this.constructor._context.get(LC(C,M))),f||x},M.prototype.createTypeInstance=function(C){var M=new C;return M.$changes.root=this.$changes.root,M},M.prototype._triggerChanges=function(x){for(var f,T,z,s,S,m,Q,V,y,U=new Set,O=this.$changes.root.refs,d=function(d){var D=x[d],o=D.refId,L=O.get(o),t=L.$callbacks;if((D.op&C.OPERATION.DELETE)===C.OPERATION.DELETE&&D.previousValue instanceof M&&(null===(T=null===(f=D.previousValue.$callbacks)||void 0===f?void 0:f[C.OPERATION.DELETE])||void 0===T||T.forEach((function(C){return C()}))),!t)return"continue";if(L instanceof M){if(!U.has(o))try{null===(z=null===t||void 0===t?void 0:t[C.OPERATION.REPLACE])||void 0===z||z.forEach((function(C){return C()}))}catch(A){M.onError(A)}try{t.hasOwnProperty(D.field)&&(null===(s=t[D.field])||void 0===s||s.forEach((function(C){return C(D.value,D.previousValue)})))}catch(A){M.onError(A)}}else D.op===C.OPERATION.ADD&&void 0===D.previousValue?null===(S=t[C.OPERATION.ADD])||void 0===S||S.forEach((function(C){var M;return C(D.value,null!==(M=D.dynamicIndex)&&void 0!==M?M:D.field)})):D.op===C.OPERATION.DELETE?void 0!==D.previousValue&&(null===(m=t[C.OPERATION.DELETE])||void 0===m||m.forEach((function(C){var M;return C(D.previousValue,null!==(M=D.dynamicIndex)&&void 0!==M?M:D.field)}))):D.op===C.OPERATION.DELETE_AND_ADD&&(void 0!==D.previousValue&&(null===(Q=t[C.OPERATION.DELETE])||void 0===Q||Q.forEach((function(C){var M;return C(D.previousValue,null!==(M=D.dynamicIndex)&&void 0!==M?M:D.field)}))),null===(V=t[C.OPERATION.ADD])||void 0===V||V.forEach((function(C){var M;return C(D.value,null!==(M=D.dynamicIndex)&&void 0!==M?M:D.field)}))),D.value!==D.previousValue&&(null===(y=t[C.OPERATION.REPLACE])||void 0===y||y.forEach((function(C){var M;return C(D.value,null!==(M=D.dynamicIndex)&&void 0!==M?M:D.field)})));U.add(o)},D=0;D<x.length;D++)d(D)},M._definition=H.create(),M}();function cC(C){for(var M=[C.$changes],x=1,f={},T=f,z=function(C){var x=M[C];x.changes.forEach((function(C){var M=x.ref,f=C.index,z=M._definition?M._definition.fieldsByIndex[f]:M.$indexes.get(f);T[z]=x.getValue(f)}))},s=0;s<x;s++)z(s);return f}var qC={context:new b},iC=function(C){function M(){return null!==C&&C.apply(this,arguments)||this}return x(M,C),f([n("string",qC)],M.prototype,"name",void 0),f([n("string",qC)],M.prototype,"type",void 0),f([n("number",qC)],M.prototype,"referencedType",void 0),M}(hC),ZC=function(C){function M(){var M=null!==C&&C.apply(this,arguments)||this;return M.fields=new d,M}return x(M,C),f([n("number",qC)],M.prototype,"id",void 0),f([n([iC],qC)],M.prototype,"fields",void 0),M}(hC),EC=function(C){function M(){var M=null!==C&&C.apply(this,arguments)||this;return M.types=new d,M}return x(M,C),M.encode=function(C){var x=C.constructor,f=new M;f.rootType=x._typeid;var T=function(C,M){for(var x in M){var T=new iC;T.name=x;var z=void 0;if("string"===typeof M[x])z=M[x];else{var s=M[x],S=void 0;hC.is(s)?(z="ref",S=M[x]):"string"===typeof s[z=Object.keys(s)[0]]?z+=":"+s[z]:S=s[z],T.referencedType=S?S._typeid:-1}T.type=z,C.fields.push(T)}f.types.push(C)},z=x._context.types;for(var s in z){var S=new ZC;S.id=Number(s),T(S,z[s]._definition.schema)}return f.encodeAll()},M.decode=function(C,f){var T=new b,z=new M;z.decode(C,f);var s=z.types.reduce((function(C,M){var f=function(C){function M(){return null!==C&&C.apply(this,arguments)||this}return x(M,C),M}(hC),z=M.id;return C[z]=f,T.add(f,z),C}),{});z.types.forEach((function(C){var M=s[C.id];C.fields.forEach((function(C){var x;if(void 0!==C.referencedType){var f=C.type,z=s[C.referencedType];if(!z){var S=C.type.split(":");f=S[0],z=S[1]}"ref"===f?n(z,{context:T})(M.prototype,C.name):n(((x={})[f]=z,x),{context:T})(M.prototype,C.name)}else n(C.type,{context:T})(M.prototype,C.name)}))}));var S=s[z.rootType],m=new S;for(var Q in S._definition.schema){var V=S._definition.schema[Q];"string"!==typeof V&&(m[Q]="function"===typeof V?new V:new(A(Object.keys(V)[0]).constructor))}return m},f([n([ZC],qC)],M.prototype,"types",void 0),f([n("number",qC)],M.prototype,"rootType",void 0),M}(hC);t("map",{constructor:o}),t("array",{constructor:d}),t("set",{constructor:RC}),t("collection",{constructor:bC}),C.ArraySchema=d,C.CollectionSchema=bC,C.Context=b,C.MapSchema=o,C.Reflection=EC,C.ReflectionField=iC,C.ReflectionType=ZC,C.Schema=hC,C.SchemaDefinition=H,C.SetSchema=RC,C.decode=jC,C.defineTypes=B,C.deprecated=g,C.dumpChanges=cC,C.encode=r,C.filter=I,C.filterChildren=X,C.hasFilter=j,C.registerType=t,C.type=n,Object.defineProperty(C,"__esModule",{value:!0})}(M)},12654:C=>{"use strict";C.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12649:(C,M,x)=>{var f=x(12654),T=x(12657),z=Object.hasOwnProperty,s=Object.create(null);for(var S in f)z.call(f,S)&&(s[f[S]]=S);var m=C.exports={to:{},get:{}};function Q(C,M,x){return Math.min(Math.max(M,C),x)}function V(C){var M=Math.round(C).toString(16).toUpperCase();return M.length<2?"0"+M:M}m.get=function(C){var M,x;switch(C.substring(0,3).toLowerCase()){case"hsl":M=m.get.hsl(C),x="hsl";break;case"hwb":M=m.get.hwb(C),x="hwb";break;default:M=m.get.rgb(C),x="rgb"}return M?{model:x,value:M}:null},m.get.rgb=function(C){if(!C)return null;var M,x,T,s=[0,0,0,1];if(M=C.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(T=M[2],M=M[1],x=0;x<3;x++){var S=2*x;s[x]=parseInt(M.slice(S,S+2),16)}T&&(s[3]=parseInt(T,16)/255)}else if(M=C.match(/^#([a-f0-9]{3,4})$/i)){for(T=(M=M[1])[3],x=0;x<3;x++)s[x]=parseInt(M[x]+M[x],16);T&&(s[3]=parseInt(T+T,16)/255)}else if(M=C.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(x=0;x<3;x++)s[x]=parseInt(M[x+1],0);M[4]&&(M[5]?s[3]=.01*parseFloat(M[4]):s[3]=parseFloat(M[4]))}else{if(!(M=C.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(M=C.match(/^(\w+)$/))?"transparent"===M[1]?[0,0,0,0]:z.call(f,M[1])?((s=f[M[1]])[3]=1,s):null:null;for(x=0;x<3;x++)s[x]=Math.round(2.55*parseFloat(M[x+1]));M[4]&&(M[5]?s[3]=.01*parseFloat(M[4]):s[3]=parseFloat(M[4]))}for(x=0;x<3;x++)s[x]=Q(s[x],0,255);return s[3]=Q(s[3],0,1),s},m.get.hsl=function(C){if(!C)return null;var M=C.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(M){var x=parseFloat(M[4]);return[(parseFloat(M[1])%360+360)%360,Q(parseFloat(M[2]),0,100),Q(parseFloat(M[3]),0,100),Q(isNaN(x)?1:x,0,1)]}return null},m.get.hwb=function(C){if(!C)return null;var M=C.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(M){var x=parseFloat(M[4]);return[(parseFloat(M[1])%360+360)%360,Q(parseFloat(M[2]),0,100),Q(parseFloat(M[3]),0,100),Q(isNaN(x)?1:x,0,1)]}return null},m.to.hex=function(){var C=T(arguments);return"#"+V(C[0])+V(C[1])+V(C[2])+(C[3]<1?V(Math.round(255*C[3])):"")},m.to.rgb=function(){var C=T(arguments);return C.length<4||1===C[3]?"rgb("+Math.round(C[0])+", "+Math.round(C[1])+", "+Math.round(C[2])+")":"rgba("+Math.round(C[0])+", "+Math.round(C[1])+", "+Math.round(C[2])+", "+C[3]+")"},m.to.rgb.percent=function(){var C=T(arguments),M=Math.round(C[0]/255*100),x=Math.round(C[1]/255*100),f=Math.round(C[2]/255*100);return C.length<4||1===C[3]?"rgb("+M+"%, "+x+"%, "+f+"%)":"rgba("+M+"%, "+x+"%, "+f+"%, "+C[3]+")"},m.to.hsl=function(){var C=T(arguments);return C.length<4||1===C[3]?"hsl("+C[0]+", "+C[1]+"%, "+C[2]+"%)":"hsla("+C[0]+", "+C[1]+"%, "+C[2]+"%, "+C[3]+")"},m.to.hwb=function(){var C=T(arguments),M="";return C.length>=4&&1!==C[3]&&(M=", "+C[3]),"hwb("+C[0]+", "+C[1]+"%, "+C[2]+"%"+M+")"},m.to.keyword=function(C){return s[C.slice(0,3)]}},12641:(C,M,x)=>{const f=x(12649),T=x(12670),z=["keyword","gray","hex"],s={};for(const O of Object.keys(T))s[[...T[O].labels].sort().join("")]=O;const S={};function m(C,M){if(!(this instanceof m))return new m(C,M);if(M&&M in z&&(M=null),M&&!(M in T))throw new Error("Unknown model: "+M);let x,Q;if(null==C)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(C instanceof m)this.model=C.model,this.color=[...C.color],this.valpha=C.valpha;else if("string"===typeof C){const M=f.get(C);if(null===M)throw new Error("Unable to parse color from string: "+C);this.model=M.model,Q=T[this.model].channels,this.color=M.value.slice(0,Q),this.valpha="number"===typeof M.value[Q]?M.value[Q]:1}else if(C.length>0){this.model=M||"rgb",Q=T[this.model].channels;const x=Array.prototype.slice.call(C,0,Q);this.color=U(x,Q),this.valpha="number"===typeof C[Q]?C[Q]:1}else if("number"===typeof C)this.model="rgb",this.color=[C>>16&255,C>>8&255,255&C],this.valpha=1;else{this.valpha=1;const M=Object.keys(C);"alpha"in C&&(M.splice(M.indexOf("alpha"),1),this.valpha="number"===typeof C.alpha?C.alpha:0);const f=M.sort().join("");if(!(f in s))throw new Error("Unable to parse color from object: "+JSON.stringify(C));this.model=s[f];const{labels:z}=T[this.model],S=[];for(x=0;x<z.length;x++)S.push(C[z[x]]);this.color=U(S)}if(S[this.model])for(Q=T[this.model].channels,x=0;x<Q;x++){const C=S[this.model][x];C&&(this.color[x]=C(this.color[x]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}m.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(C){let M=this.model in f.to?this:this.rgb();M=M.round("number"===typeof C?C:1);const x=1===M.valpha?M.color:[...M.color,this.valpha];return f.to[M.model](x)},percentString(C){const M=this.rgb().round("number"===typeof C?C:1),x=1===M.valpha?M.color:[...M.color,this.valpha];return f.to.rgb.percent(x)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const C={},{channels:M}=T[this.model],{labels:x}=T[this.model];for(let f=0;f<M;f++)C[x[f]]=this.color[f];return 1!==this.valpha&&(C.alpha=this.valpha),C},unitArray(){const C=this.rgb().color;return C[0]/=255,C[1]/=255,C[2]/=255,1!==this.valpha&&C.push(this.valpha),C},unitObject(){const C=this.rgb().object();return C.r/=255,C.g/=255,C.b/=255,1!==this.valpha&&(C.alpha=this.valpha),C},round(C){return C=Math.max(C||0,0),new m([...this.color.map(Q(C)),this.valpha],this.model)},alpha(C){return void 0!==C?new m([...this.color,Math.max(0,Math.min(1,C))],this.model):this.valpha},red:V("rgb",0,y(255)),green:V("rgb",1,y(255)),blue:V("rgb",2,y(255)),hue:V(["hsl","hsv","hsl","hwb","hcg"],0,(C=>(C%360+360)%360)),saturationl:V("hsl",1,y(100)),lightness:V("hsl",2,y(100)),saturationv:V("hsv",1,y(100)),value:V("hsv",2,y(100)),chroma:V("hcg",1,y(100)),gray:V("hcg",2,y(100)),white:V("hwb",1,y(100)),wblack:V("hwb",2,y(100)),cyan:V("cmyk",0,y(100)),magenta:V("cmyk",1,y(100)),yellow:V("cmyk",2,y(100)),black:V("cmyk",3,y(100)),x:V("xyz",0,y(95.047)),y:V("xyz",1,y(100)),z:V("xyz",2,y(108.833)),l:V("lab",0,y(100)),a:V("lab",1),b:V("lab",2),keyword(C){return void 0!==C?new m(C):T[this.model].keyword(this.color)},hex(C){return void 0!==C?new m(C):f.to.hex(this.rgb().round().color)},hexa(C){if(void 0!==C)return new m(C);const M=this.rgb().round().color;let x=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===x.length&&(x="0"+x),f.to.hex(M)+x},rgbNumber(){const C=this.rgb().color;return(255&C[0])<<16|(255&C[1])<<8|255&C[2]},luminosity(){const C=this.rgb().color,M=[];for(const[x,f]of C.entries()){const C=f/255;M[x]=C<=.04045?C/12.92:((C+.055)/1.055)**2.4}return.2126*M[0]+.7152*M[1]+.0722*M[2]},contrast(C){const M=this.luminosity(),x=C.luminosity();return M>x?(M+.05)/(x+.05):(x+.05)/(M+.05)},level(C){const M=this.contrast(C);return M>=7?"AAA":M>=4.5?"AA":""},isDark(){const C=this.rgb().color;return(2126*C[0]+7152*C[1]+722*C[2])/1e4<128},isLight(){return!this.isDark()},negate(){const C=this.rgb();for(let M=0;M<3;M++)C.color[M]=255-C.color[M];return C},lighten(C){const M=this.hsl();return M.color[2]+=M.color[2]*C,M},darken(C){const M=this.hsl();return M.color[2]-=M.color[2]*C,M},saturate(C){const M=this.hsl();return M.color[1]+=M.color[1]*C,M},desaturate(C){const M=this.hsl();return M.color[1]-=M.color[1]*C,M},whiten(C){const M=this.hwb();return M.color[1]+=M.color[1]*C,M},blacken(C){const M=this.hwb();return M.color[2]+=M.color[2]*C,M},grayscale(){const C=this.rgb().color,M=.3*C[0]+.59*C[1]+.11*C[2];return m.rgb(M,M,M)},fade(C){return this.alpha(this.valpha-this.valpha*C)},opaquer(C){return this.alpha(this.valpha+this.valpha*C)},rotate(C){const M=this.hsl();let x=M.color[0];return x=(x+C)%360,x=x<0?360+x:x,M.color[0]=x,M},mix(C,M){if(!C||!C.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof C);const x=C.rgb(),f=this.rgb(),T=void 0===M?.5:M,z=2*T-1,s=x.alpha()-f.alpha(),S=((z*s===-1?z:(z+s)/(1+z*s))+1)/2,Q=1-S;return m.rgb(S*x.red()+Q*f.red(),S*x.green()+Q*f.green(),S*x.blue()+Q*f.blue(),x.alpha()*T+f.alpha()*(1-T))}};for(const O of Object.keys(T)){if(z.includes(O))continue;const{channels:C}=T[O];m.prototype[O]=function(){if(this.model===O)return new m(this);for(var C=arguments.length,M=new Array(C),x=0;x<C;x++)M[x]=arguments[x];return M.length>0?new m(M,O):new m([...(f=T[this.model][O].raw(this.color),Array.isArray(f)?f:[f]),this.valpha],O);var f},m[O]=function(){for(var M=arguments.length,x=new Array(M),f=0;f<M;f++)x[f]=arguments[f];let T=x[0];return"number"===typeof T&&(T=U(x,C)),new m(T,O)}}function Q(C){return function(M){return function(C,M){return Number(C.toFixed(M))}(M,C)}}function V(C,M,x){C=Array.isArray(C)?C:[C];for(const f of C)(S[f]||(S[f]=[]))[M]=x;return C=C[0],function(f){let T;return void 0!==f?(x&&(f=x(f)),T=this[C](),T.color[M]=f,T):(T=this[C]().color[M],x&&(T=x(T)),T)}}function y(C){return function(M){return Math.max(0,Math.min(C,M))}}function U(C,M){for(let x=0;x<M;x++)"number"!==typeof C[x]&&(C[x]=0);return C}C.exports=m},12672:(C,M,x)=>{const f=x(12676),T={};for(const s of Object.keys(f))T[f[s]]=s;const z={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};C.exports=z;for(const s of Object.keys(z)){if(!("channels"in z[s]))throw new Error("missing channels property: "+s);if(!("labels"in z[s]))throw new Error("missing channel labels property: "+s);if(z[s].labels.length!==z[s].channels)throw new Error("channel and label counts mismatch: "+s);const{channels:C,labels:M}=z[s];delete z[s].channels,delete z[s].labels,Object.defineProperty(z[s],"channels",{value:C}),Object.defineProperty(z[s],"labels",{value:M})}z.rgb.hsl=function(C){const M=C[0]/255,x=C[1]/255,f=C[2]/255,T=Math.min(M,x,f),z=Math.max(M,x,f),s=z-T;let S,m;z===T?S=0:M===z?S=(x-f)/s:x===z?S=2+(f-M)/s:f===z&&(S=4+(M-x)/s),S=Math.min(60*S,360),S<0&&(S+=360);const Q=(T+z)/2;return m=z===T?0:Q<=.5?s/(z+T):s/(2-z-T),[S,100*m,100*Q]},z.rgb.hsv=function(C){let M,x,f,T,z;const s=C[0]/255,S=C[1]/255,m=C[2]/255,Q=Math.max(s,S,m),V=Q-Math.min(s,S,m),y=function(C){return(Q-C)/6/V+.5};return 0===V?(T=0,z=0):(z=V/Q,M=y(s),x=y(S),f=y(m),s===Q?T=f-x:S===Q?T=1/3+M-f:m===Q&&(T=2/3+x-M),T<0?T+=1:T>1&&(T-=1)),[360*T,100*z,100*Q]},z.rgb.hwb=function(C){const M=C[0],x=C[1];let f=C[2];const T=z.rgb.hsl(C)[0],s=1/255*Math.min(M,Math.min(x,f));return f=1-1/255*Math.max(M,Math.max(x,f)),[T,100*s,100*f]},z.rgb.cmyk=function(C){const M=C[0]/255,x=C[1]/255,f=C[2]/255,T=Math.min(1-M,1-x,1-f);return[100*((1-M-T)/(1-T)||0),100*((1-x-T)/(1-T)||0),100*((1-f-T)/(1-T)||0),100*T]},z.rgb.keyword=function(C){const M=T[C];if(M)return M;let x,z=1/0;for(const T of Object.keys(f)){const M=f[T],m=(S=M,((s=C)[0]-S[0])**2+(s[1]-S[1])**2+(s[2]-S[2])**2);m<z&&(z=m,x=T)}var s,S;return x},z.keyword.rgb=function(C){return f[C]},z.rgb.xyz=function(C){let M=C[0]/255,x=C[1]/255,f=C[2]/255;M=M>.04045?((M+.055)/1.055)**2.4:M/12.92,x=x>.04045?((x+.055)/1.055)**2.4:x/12.92,f=f>.04045?((f+.055)/1.055)**2.4:f/12.92;return[100*(.4124*M+.3576*x+.1805*f),100*(.2126*M+.7152*x+.0722*f),100*(.0193*M+.1192*x+.9505*f)]},z.rgb.lab=function(C){const M=z.rgb.xyz(C);let x=M[0],f=M[1],T=M[2];x/=95.047,f/=100,T/=108.883,x=x>.008856?x**(1/3):7.787*x+16/116,f=f>.008856?f**(1/3):7.787*f+16/116,T=T>.008856?T**(1/3):7.787*T+16/116;return[116*f-16,500*(x-f),200*(f-T)]},z.hsl.rgb=function(C){const M=C[0]/360,x=C[1]/100,f=C[2]/100;let T,z,s;if(0===x)return s=255*f,[s,s,s];T=f<.5?f*(1+x):f+x-f*x;const S=2*f-T,m=[0,0,0];for(let Q=0;Q<3;Q++)z=M+1/3*-(Q-1),z<0&&z++,z>1&&z--,s=6*z<1?S+6*(T-S)*z:2*z<1?T:3*z<2?S+(T-S)*(2/3-z)*6:S,m[Q]=255*s;return m},z.hsl.hsv=function(C){const M=C[0];let x=C[1]/100,f=C[2]/100,T=x;const z=Math.max(f,.01);f*=2,x*=f<=1?f:2-f,T*=z<=1?z:2-z;return[M,100*(0===f?2*T/(z+T):2*x/(f+x)),100*((f+x)/2)]},z.hsv.rgb=function(C){const M=C[0]/60,x=C[1]/100;let f=C[2]/100;const T=Math.floor(M)%6,z=M-Math.floor(M),s=255*f*(1-x),S=255*f*(1-x*z),m=255*f*(1-x*(1-z));switch(f*=255,T){case 0:return[f,m,s];case 1:return[S,f,s];case 2:return[s,f,m];case 3:return[s,S,f];case 4:return[m,s,f];case 5:return[f,s,S]}},z.hsv.hsl=function(C){const M=C[0],x=C[1]/100,f=C[2]/100,T=Math.max(f,.01);let z,s;s=(2-x)*f;const S=(2-x)*T;return z=x*T,z/=S<=1?S:2-S,z=z||0,s/=2,[M,100*z,100*s]},z.hwb.rgb=function(C){const M=C[0]/360;let x=C[1]/100,f=C[2]/100;const T=x+f;let z;T>1&&(x/=T,f/=T);const s=Math.floor(6*M),S=1-f;z=6*M-s,0!==(1&s)&&(z=1-z);const m=x+z*(S-x);let Q,V,y;switch(s){default:case 6:case 0:Q=S,V=m,y=x;break;case 1:Q=m,V=S,y=x;break;case 2:Q=x,V=S,y=m;break;case 3:Q=x,V=m,y=S;break;case 4:Q=m,V=x,y=S;break;case 5:Q=S,V=x,y=m}return[255*Q,255*V,255*y]},z.cmyk.rgb=function(C){const M=C[0]/100,x=C[1]/100,f=C[2]/100,T=C[3]/100;return[255*(1-Math.min(1,M*(1-T)+T)),255*(1-Math.min(1,x*(1-T)+T)),255*(1-Math.min(1,f*(1-T)+T))]},z.xyz.rgb=function(C){const M=C[0]/100,x=C[1]/100,f=C[2]/100;let T,z,s;return T=3.2406*M+-1.5372*x+-.4986*f,z=-.9689*M+1.8758*x+.0415*f,s=.0557*M+-.204*x+1.057*f,T=T>.0031308?1.055*T**(1/2.4)-.055:12.92*T,z=z>.0031308?1.055*z**(1/2.4)-.055:12.92*z,s=s>.0031308?1.055*s**(1/2.4)-.055:12.92*s,T=Math.min(Math.max(0,T),1),z=Math.min(Math.max(0,z),1),s=Math.min(Math.max(0,s),1),[255*T,255*z,255*s]},z.xyz.lab=function(C){let M=C[0],x=C[1],f=C[2];M/=95.047,x/=100,f/=108.883,M=M>.008856?M**(1/3):7.787*M+16/116,x=x>.008856?x**(1/3):7.787*x+16/116,f=f>.008856?f**(1/3):7.787*f+16/116;return[116*x-16,500*(M-x),200*(x-f)]},z.lab.xyz=function(C){let M,x,f;x=(C[0]+16)/116,M=C[1]/500+x,f=x-C[2]/200;const T=x**3,z=M**3,s=f**3;return x=T>.008856?T:(x-16/116)/7.787,M=z>.008856?z:(M-16/116)/7.787,f=s>.008856?s:(f-16/116)/7.787,M*=95.047,x*=100,f*=108.883,[M,x,f]},z.lab.lch=function(C){const M=C[0],x=C[1],f=C[2];let T;T=360*Math.atan2(f,x)/2/Math.PI,T<0&&(T+=360);return[M,Math.sqrt(x*x+f*f),T]},z.lch.lab=function(C){const M=C[0],x=C[1],f=C[2]/360*2*Math.PI;return[M,x*Math.cos(f),x*Math.sin(f)]},z.rgb.ansi16=function(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[x,f,T]=C;let s=null===M?z.rgb.hsv(C)[2]:M;if(s=Math.round(s/50),0===s)return 30;let S=30+(Math.round(T/255)<<2|Math.round(f/255)<<1|Math.round(x/255));return 2===s&&(S+=60),S},z.hsv.ansi16=function(C){return z.rgb.ansi16(z.hsv.rgb(C),C[2])},z.rgb.ansi256=function(C){const M=C[0],x=C[1],f=C[2];if(M===x&&x===f)return M<8?16:M>248?231:Math.round((M-8)/247*24)+232;return 16+36*Math.round(M/255*5)+6*Math.round(x/255*5)+Math.round(f/255*5)},z.ansi16.rgb=function(C){let M=C%10;if(0===M||7===M)return C>50&&(M+=3.5),M=M/10.5*255,[M,M,M];const x=.5*(1+~~(C>50));return[(1&M)*x*255,(M>>1&1)*x*255,(M>>2&1)*x*255]},z.ansi256.rgb=function(C){if(C>=232){const M=10*(C-232)+8;return[M,M,M]}let M;C-=16;return[Math.floor(C/36)/5*255,Math.floor((M=C%36)/6)/5*255,M%6/5*255]},z.rgb.hex=function(C){const M=(((255&Math.round(C[0]))<<16)+((255&Math.round(C[1]))<<8)+(255&Math.round(C[2]))).toString(16).toUpperCase();return"000000".substring(M.length)+M},z.hex.rgb=function(C){const M=C.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!M)return[0,0,0];let x=M[0];3===M[0].length&&(x=x.split("").map((C=>C+C)).join(""));const f=parseInt(x,16);return[f>>16&255,f>>8&255,255&f]},z.rgb.hcg=function(C){const M=C[0]/255,x=C[1]/255,f=C[2]/255,T=Math.max(Math.max(M,x),f),z=Math.min(Math.min(M,x),f),s=T-z;let S,m;return S=s<1?z/(1-s):0,m=s<=0?0:T===M?(x-f)/s%6:T===x?2+(f-M)/s:4+(M-x)/s,m/=6,m%=1,[360*m,100*s,100*S]},z.hsl.hcg=function(C){const M=C[1]/100,x=C[2]/100,f=x<.5?2*M*x:2*M*(1-x);let T=0;return f<1&&(T=(x-.5*f)/(1-f)),[C[0],100*f,100*T]},z.hsv.hcg=function(C){const M=C[1]/100,x=C[2]/100,f=M*x;let T=0;return f<1&&(T=(x-f)/(1-f)),[C[0],100*f,100*T]},z.hcg.rgb=function(C){const M=C[0]/360,x=C[1]/100,f=C[2]/100;if(0===x)return[255*f,255*f,255*f];const T=[0,0,0],z=M%1*6,s=z%1,S=1-s;let m=0;switch(Math.floor(z)){case 0:T[0]=1,T[1]=s,T[2]=0;break;case 1:T[0]=S,T[1]=1,T[2]=0;break;case 2:T[0]=0,T[1]=1,T[2]=s;break;case 3:T[0]=0,T[1]=S,T[2]=1;break;case 4:T[0]=s,T[1]=0,T[2]=1;break;default:T[0]=1,T[1]=0,T[2]=S}return m=(1-x)*f,[255*(x*T[0]+m),255*(x*T[1]+m),255*(x*T[2]+m)]},z.hcg.hsv=function(C){const M=C[1]/100,x=M+C[2]/100*(1-M);let f=0;return x>0&&(f=M/x),[C[0],100*f,100*x]},z.hcg.hsl=function(C){const M=C[1]/100,x=C[2]/100*(1-M)+.5*M;let f=0;return x>0&&x<.5?f=M/(2*x):x>=.5&&x<1&&(f=M/(2*(1-x))),[C[0],100*f,100*x]},z.hcg.hwb=function(C){const M=C[1]/100,x=M+C[2]/100*(1-M);return[C[0],100*(x-M),100*(1-x)]},z.hwb.hcg=function(C){const M=C[1]/100,x=1-C[2]/100,f=x-M;let T=0;return f<1&&(T=(x-f)/(1-f)),[C[0],100*f,100*T]},z.apple.rgb=function(C){return[C[0]/65535*255,C[1]/65535*255,C[2]/65535*255]},z.rgb.apple=function(C){return[C[0]/255*65535,C[1]/255*65535,C[2]/255*65535]},z.gray.rgb=function(C){return[C[0]/100*255,C[0]/100*255,C[0]/100*255]},z.gray.hsl=function(C){return[0,0,C[0]]},z.gray.hsv=z.gray.hsl,z.gray.hwb=function(C){return[0,100,C[0]]},z.gray.cmyk=function(C){return[0,0,0,C[0]]},z.gray.lab=function(C){return[C[0],0,0]},z.gray.hex=function(C){const M=255&Math.round(C[0]/100*255),x=((M<<16)+(M<<8)+M).toString(16).toUpperCase();return"000000".substring(x.length)+x},z.rgb.gray=function(C){return[(C[0]+C[1]+C[2])/3/255*100]}},12670:(C,M,x)=>{const f=x(12672),T=x(12681),z={};Object.keys(f).forEach((C=>{z[C]={},Object.defineProperty(z[C],"channels",{value:f[C].channels}),Object.defineProperty(z[C],"labels",{value:f[C].labels});const M=T(C);Object.keys(M).forEach((x=>{const f=M[x];z[C][x]=function(C){const M=function(){for(var M=arguments.length,x=new Array(M),f=0;f<M;f++)x[f]=arguments[f];const T=x[0];if(void 0===T||null===T)return T;T.length>1&&(x=T);const z=C(x);if("object"===typeof z)for(let C=z.length,s=0;s<C;s++)z[s]=Math.round(z[s]);return z};return"conversion"in C&&(M.conversion=C.conversion),M}(f),z[C][x].raw=function(C){const M=function(){for(var M=arguments.length,x=new Array(M),f=0;f<M;f++)x[f]=arguments[f];const T=x[0];return void 0===T||null===T?T:(T.length>1&&(x=T),C(x))};return"conversion"in C&&(M.conversion=C.conversion),M}(f)}))})),C.exports=z},12681:(C,M,x)=>{const f=x(12672);function T(C){const M=function(){const C={},M=Object.keys(f);for(let x=M.length,f=0;f<x;f++)C[M[f]]={distance:-1,parent:null};return C}(),x=[C];for(M[C].distance=0;x.length;){const C=x.pop(),T=Object.keys(f[C]);for(let f=T.length,z=0;z<f;z++){const f=T[z],s=M[f];-1===s.distance&&(s.distance=M[C].distance+1,s.parent=C,x.unshift(f))}}return M}function z(C,M){return function(x){return M(C(x))}}function s(C,M){const x=[M[C].parent,C];let T=f[M[C].parent][C],s=M[C].parent;for(;M[s].parent;)x.unshift(M[s].parent),T=z(f[M[s].parent][s],T),s=M[s].parent;return T.conversion=x,T}C.exports=function(C){const M=T(C),x={},f=Object.keys(M);for(let T=f.length,z=0;z<T;z++){const C=f[z];null!==M[C].parent&&(x[C]=s(C,M))}return x}},12676:C=>{"use strict";C.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},11509:function(C,M,x){"use strict";var f=this&&this.__createBinding||(Object.create?function(C,M,x,f){void 0===f&&(f=x);var T=Object.getOwnPropertyDescriptor(M,x);T&&!("get"in T?!M.__esModule:T.writable||T.configurable)||(T={enumerable:!0,get:function(){return M[x]}}),Object.defineProperty(C,f,T)}:function(C,M,x,f){void 0===f&&(f=x),C[f]=M[x]}),T=this&&this.__setModuleDefault||(Object.create?function(C,M){Object.defineProperty(C,"default",{enumerable:!0,value:M})}:function(C,M){C.default=M}),z=this&&this.__importStar||function(C){if(C&&C.__esModule)return C;var M={};if(null!=C)for(var x in C)"default"!==x&&Object.prototype.hasOwnProperty.call(C,x)&&f(M,C,x);return T(M,C),M},s=this&&this.__awaiter||function(C,M,x,f){return new(x||(x=Promise))((function(T,z){function s(C){try{m(f.next(C))}catch(M){z(M)}}function S(C){try{m(f.throw(C))}catch(M){z(M)}}function m(C){var M;C.done?T(C.value):(M=C.value,M instanceof x?M:new x((function(C){C(M)}))).then(s,S)}m((f=f.apply(C,M||[])).next())}))};Object.defineProperty(M,"__esModule",{value:!0}),M.Auth=M.Platform=void 0;const S=z(x(11444)),m=x(11513),Q="colyseus-auth-token";!function(C){C.ios="ios",C.android="android"}(M.Platform||(M.Platform={}));M.Auth=class{constructor(C){this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=C.replace("ws","http"),(0,m.getItem)(Q,(C=>this.token=C))}get hasToken(){return!!this.token}login(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,void 0,void 0,(function*(){const M=Object.assign({},C);this.hasToken&&(M.token=this.token);const x=yield this.request("post","/auth",M);this.token=x.token,(0,m.setItem)(Q,this.token);for(let C in x)this.hasOwnProperty(C)&&(this[C]=x[C]);return this.registerPingService(),this}))}save(){return s(this,void 0,void 0,(function*(){return yield this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone}),this}))}getFriends(){return s(this,void 0,void 0,(function*(){return yield this.request("get","/friends/all")}))}getOnlineFriends(){return s(this,void 0,void 0,(function*(){return yield this.request("get","/friends/online")}))}getFriendRequests(){return s(this,void 0,void 0,(function*(){return yield this.request("get","/friends/requests")}))}sendFriendRequest(C){return s(this,void 0,void 0,(function*(){return yield this.request("post","/friends/requests",{userId:C})}))}acceptFriendRequest(C){return s(this,void 0,void 0,(function*(){return yield this.request("put","/friends/requests",{userId:C})}))}declineFriendRequest(C){return s(this,void 0,void 0,(function*(){return yield this.request("del","/friends/requests",{userId:C})}))}blockUser(C){return s(this,void 0,void 0,(function*(){return yield this.request("post","/friends/block",{userId:C})}))}unblockUser(C){return s(this,void 0,void 0,(function*(){return yield this.request("put","/friends/block",{userId:C})}))}request(C,M){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},f=arguments.length>3?arguments[3]:void 0,T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return s(this,void 0,void 0,(function*(){T.Accept="application/json",this.hasToken&&(T.Authorization="Bearer "+this.token);const z=[];for(const C in x)z.push(`${C}=${x[C]}`);const s=z.length>0?`?${z.join("&")}`:"",m={headers:T};return f&&(m.body=f),(yield S[C](`${this.endpoint}${M}${s}`,m)).data}))}logout(){this.token=void 0,(0,m.removeItem)(Q),this.unregisterPingService()}registerPingService(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;this.unregisterPingService(),this.keepOnlineInterval=setInterval((()=>this.request("get","/auth")),C)}unregisterPingService(){clearInterval(this.keepOnlineInterval)}}},11437:function(C,M,x){"use strict";var f,T=this&&this.__awaiter||function(C,M,x,f){return new(x||(x=Promise))((function(T,z){function s(C){try{m(f.next(C))}catch(M){z(M)}}function S(C){try{m(f.throw(C))}catch(M){z(M)}}function m(C){var M;C.done?T(C.value):(M=C.value,M instanceof x?M:new x((function(C){C(M)}))).then(s,S)}m((f=f.apply(C,M||[])).next())}))};Object.defineProperty(M,"__esModule",{value:!0}),M.Client=M.MatchMakeError=void 0;const z=x(11444),s=x(11449),S=x(11451);class m extends Error{constructor(C,M){super(C),this.code=M,Object.setPrototypeOf(this,m.prototype)}}M.MatchMakeError=m;const Q="undefined"!==typeof window&&"undefined"!==typeof(null===(f=null===window||void 0===window?void 0:window.location)||void 0===f?void 0:f.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";M.Client=class{constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Q;if("string"===typeof C){const M=new URL(C),x="https:"===M.protocol||"wss:"===M.protocol,f=Number(M.port||(x?443:80));this.settings={hostname:M.hostname,pathname:"/"!==M.pathname?M.pathname:"",port:f,secure:x}}else void 0===C.port&&(C.port=C.secure?443:80),void 0===C.pathname&&(C.pathname=""),this.settings=C}joinOrCreate(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},x=arguments.length>2?arguments[2]:void 0;return T(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",C,M,x)}))}create(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},x=arguments.length>2?arguments[2]:void 0;return T(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",C,M,x)}))}join(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},x=arguments.length>2?arguments[2]:void 0;return T(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",C,M,x)}))}joinById(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},x=arguments.length>2?arguments[2]:void 0;return T(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",C,M,x)}))}reconnect(C,M){return T(this,void 0,void 0,(function*(){if("string"===typeof C&&"string"===typeof M)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[x,f]=C.split(":");return yield this.createMatchMakeRequest("reconnect",x,{reconnectionToken:f},M)}))}getAvailableRooms(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return T(this,void 0,void 0,(function*(){return(yield(0,z.get)(this.getHttpEndpoint(`${C}`),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(C,M,x){return T(this,void 0,void 0,(function*(){const f=this.createRoom(C.room.name,M);f.roomId=C.room.roomId,f.sessionId=C.sessionId;const z={sessionId:f.sessionId};C.reconnectionToken&&(z.reconnectionToken=C.reconnectionToken);const S=x||f;return f.connect(this.buildEndpoint(C.room,z),C.devMode&&(()=>T(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${f.roomId}'...`);let x=0;const z=()=>T(this,void 0,void 0,(function*(){x++;try{yield this.consumeSeatReservation(C,M,S),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${f.roomId}'`)}catch(T){x<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${x} out of 8)`),setTimeout(z,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(z,2e3)}))),S),new Promise(((C,M)=>{const x=(C,x)=>M(new s.ServerError(C,x));S.onError.once(x),S.onJoin.once((()=>{S.onError.remove(x),C(S)}))}))}))}createMatchMakeRequest(C,M){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},f=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0;return T(this,void 0,void 0,(function*(){const T=(yield(0,z.post)(this.getHttpEndpoint(`${C}/${M}`),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(x)})).data;if(T.error)throw new m(T.error,T.code);return"reconnect"===C&&(T.reconnectionToken=x.reconnectionToken),yield this.consumeSeatReservation(T,f,s)}))}createRoom(C,M){return new S.Room(C,M)}buildEndpoint(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const x=[];for(const T in M)M.hasOwnProperty(T)&&x.push(`${T}=${M[T]}`);let f=this.settings.secure?"wss://":"ws://";return C.publicAddress?f+=`${C.publicAddress}`:f+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`,`${f}/${C.processId}/${C.roomId}?${x.join("&")}`}getHttpEndpoint(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}/matchmake/${C}`}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},11462:(C,M,x)=>{"use strict";Object.defineProperty(M,"__esModule",{value:!0}),M.Connection=void 0;const f=x(11470);M.Connection=class{constructor(){this.events={},this.transport=new f.WebSocketTransport(this.events)}send(C){this.transport.send(C)}connect(C){this.transport.connect(C)}close(C,M){this.transport.close(C,M)}get isOpen(){return this.transport.isOpen}}},11480:(C,M)=>{"use strict";Object.defineProperty(M,"__esModule",{value:!0}),M.utf8Length=M.utf8Read=M.ErrorCode=M.Protocol=void 0,function(C){C[C.HANDSHAKE=9]="HANDSHAKE",C[C.JOIN_ROOM=10]="JOIN_ROOM",C[C.ERROR=11]="ERROR",C[C.LEAVE_ROOM=12]="LEAVE_ROOM",C[C.ROOM_DATA=13]="ROOM_DATA",C[C.ROOM_STATE=14]="ROOM_STATE",C[C.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",C[C.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",C[C.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(M.Protocol||(M.Protocol={})),function(C){C[C.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",C[C.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",C[C.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",C[C.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",C[C.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",C[C.AUTH_FAILED=4215]="AUTH_FAILED",C[C.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(M.ErrorCode||(M.ErrorCode={})),M.utf8Read=function(C,M){const x=C[M++];for(var f="",T=0,z=M,s=M+x;z<s;z++){var S=C[z];if(0!==(128&S))if(192!==(224&S))if(224!==(240&S)){if(240!==(248&S))throw new Error("Invalid byte "+S.toString(16));(T=(7&S)<<18|(63&C[++z])<<12|(63&C[++z])<<6|63&C[++z])>=65536?(T-=65536,f+=String.fromCharCode(55296+(T>>>10),56320+(1023&T))):f+=String.fromCharCode(T)}else f+=String.fromCharCode((15&S)<<12|(63&C[++z])<<6|63&C[++z]);else f+=String.fromCharCode((31&S)<<6|63&C[++z]);else f+=String.fromCharCode(S)}return f},M.utf8Length=function(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",M=0,x=0;for(let f=0,T=C.length;f<T;f++)M=C.charCodeAt(f),M<128?x+=1:M<2048?x+=2:M<55296||M>=57344?x+=3:(f++,x+=4);return x+1}},11451:function(C,M,x){"use strict";var f=this&&this.__createBinding||(Object.create?function(C,M,x,f){void 0===f&&(f=x);var T=Object.getOwnPropertyDescriptor(M,x);T&&!("get"in T?!M.__esModule:T.writable||T.configurable)||(T={enumerable:!0,get:function(){return M[x]}}),Object.defineProperty(C,f,T)}:function(C,M,x,f){void 0===f&&(f=x),C[f]=M[x]}),T=this&&this.__setModuleDefault||(Object.create?function(C,M){Object.defineProperty(C,"default",{enumerable:!0,value:M})}:function(C,M){C.default=M}),z=this&&this.__importStar||function(C){if(C&&C.__esModule)return C;var M={};if(null!=C)for(var x in C)"default"!==x&&Object.prototype.hasOwnProperty.call(C,x)&&f(M,C,x);return T(M,C),M};Object.defineProperty(M,"__esModule",{value:!0}),M.Room=void 0;const s=z(x(11457)),S=x(11462),m=x(11480),Q=x(11486),V=x(11493),y=x(11501),U=x(11504),O=x(11449);class d{constructor(C,M){this.onStateChange=(0,y.createSignal)(),this.onError=(0,y.createSignal)(),this.onLeave=(0,y.createSignal)(),this.onJoin=(0,y.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,V.createNanoEvents)(),this.roomId=null,this.name=C,M&&(this.serializer=new((0,Q.getSerializer)("schema")),this.rootSchema=M,this.serializer.state=new M),this.onError(((C,M)=>{var x;return null===(x=console.warn)||void 0===x?void 0:x.call(console,`colyseus.js - onError => (${C}) ${M}`)})),this.onLeave((()=>this.removeAllListeners()))}get id(){return this.roomId}connect(C,M){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;const f=new S.Connection;x.connection=f,f.events.onmessage=d.prototype.onMessageCallback.bind(x),f.events.onclose=function(C){var f;if(!x.hasJoined)return null===(f=console.warn)||void 0===f||f.call(console,`Room connection was closed unexpectedly (${C.code}): ${C.reason}`),void x.onError.invoke(C.code,C.reason);C.code===O.CloseCode.DEVMODE_RESTART&&M?M():(x.onLeave.invoke(C.code),x.destroy())},f.events.onerror=function(C){var M;null===(M=console.warn)||void 0===M||M.call(console,`Room, onError (${C.code}): ${C.reason}`),x.onError.invoke(C.code,C.reason)},f.connect(C)}leave(){let C=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((M=>{this.onLeave((C=>M(C))),this.connection?C?this.connection.send([m.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(O.CloseCode.CONSENTED)}))}onMessage(C,M){return this.onMessageHandlers.on(this.getMessageHandlerKey(C),M)}send(C,M){const x=[m.Protocol.ROOM_DATA];let f;if("string"===typeof C?U.encode.string(x,C):U.encode.number(x,C),void 0!==M){const C=s.encode(M);f=new Uint8Array(x.length+C.byteLength),f.set(new Uint8Array(x),0),f.set(new Uint8Array(C),x.length)}else f=new Uint8Array(x);this.connection.send(f.buffer)}sendBytes(C,M){const x=[m.Protocol.ROOM_DATA_BYTES];let f;"string"===typeof C?U.encode.string(x,C):U.encode.number(x,C),f=new Uint8Array(x.length+(M.byteLength||M.length)),f.set(new Uint8Array(x),0),f.set(new Uint8Array(M),x.length),this.connection.send(f.buffer)}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(C){const M=Array.from(new Uint8Array(C.data)),x=M[0];if(x===m.Protocol.JOIN_ROOM){let C=1;const x=(0,m.utf8Read)(M,C);if(C+=(0,m.utf8Length)(x),this.serializerId=(0,m.utf8Read)(M,C),C+=(0,m.utf8Length)(this.serializerId),!this.serializer){const C=(0,Q.getSerializer)(this.serializerId);this.serializer=new C}M.length>C&&this.serializer.handshake&&this.serializer.handshake(M,{offset:C}),this.reconnectionToken=`${this.roomId}:${x}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([m.Protocol.JOIN_ROOM])}else if(x===m.Protocol.ERROR){const C={offset:1},x=U.decode.number(M,C),f=U.decode.string(M,C);this.onError.invoke(x,f)}else if(x===m.Protocol.LEAVE_ROOM)this.leave();else if(x===m.Protocol.ROOM_DATA_SCHEMA){const C={offset:1},x=this.serializer.getState().constructor._context.get(U.decode.number(M,C)),f=new x;f.decode(M,C),this.dispatchMessage(x,f)}else if(x===m.Protocol.ROOM_STATE)M.shift(),this.setState(M);else if(x===m.Protocol.ROOM_STATE_PATCH)M.shift(),this.patch(M);else if(x===m.Protocol.ROOM_DATA){const x={offset:1},f=U.decode.stringCheck(M,x)?U.decode.string(M,x):U.decode.number(M,x),T=M.length>x.offset?s.decode(C.data,x.offset):void 0;this.dispatchMessage(f,T)}else if(x===m.Protocol.ROOM_DATA_BYTES){const C={offset:1},x=U.decode.stringCheck(M,C)?U.decode.string(M,C):U.decode.number(M,C);this.dispatchMessage(x,new Uint8Array(M.slice(C.offset)))}}setState(C){this.serializer.setState(C),this.onStateChange.invoke(this.serializer.getState())}patch(C){this.serializer.patch(C),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(C,M){var x;const f=this.getMessageHandlerKey(C);this.onMessageHandlers.events[f]?this.onMessageHandlers.emit(f,M):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",C,M):null===(x=console.warn)||void 0===x||x.call(console,`colyseus.js: onMessage() not registered for type '${C}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(C){switch(typeof C){case"function":return`$${C._typeid}`;case"string":return C;case"number":return`i${C}`;default:throw new Error("invalid message type.")}}}M.Room=d},11513:(C,M)=>{"use strict";let x;function f(){return x||(x="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!==typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(C,M){this.cache[C]=M},getItem:function(C){this.cache[C]},removeItem:function(C){delete this.cache[C]}}),x}Object.defineProperty(M,"__esModule",{value:!0}),M.getItem=M.removeItem=M.setItem=void 0,M.setItem=function(C,M){f().setItem(C,M)},M.removeItem=function(C){f().removeItem(C)},M.getItem=function(C,M){const x=f().getItem(C);"undefined"!==typeof Promise&&x instanceof Promise?x.then((C=>M(C))):M(x)}},11493:(C,M)=>{"use strict";Object.defineProperty(M,"__esModule",{value:!0}),M.createNanoEvents=void 0;M.createNanoEvents=()=>({emit(C){let M=this.events[C]||[];for(var x=arguments.length,f=new Array(x>1?x-1:0),T=1;T<x;T++)f[T-1]=arguments[T];for(let z=0,s=M.length;z<s;z++)M[z](...f)},events:{},on(C,M){var x;return(null===(x=this.events[C])||void 0===x?void 0:x.push(M))||(this.events[C]=[M]),()=>{var x;this.events[C]=null===(x=this.events[C])||void 0===x?void 0:x.filter((C=>M!==C))}}})},11501:(C,M)=>{"use strict";Object.defineProperty(M,"__esModule",{value:!0}),M.createSignal=M.EventEmitter=void 0;class x{constructor(){this.handlers=[]}register(C){return this.handlers.push(C),this}invoke(){for(var C=arguments.length,M=new Array(C),x=0;x<C;x++)M[x]=arguments[x];this.handlers.forEach((C=>C.apply(this,M)))}invokeAsync(){for(var C=arguments.length,M=new Array(C),x=0;x<C;x++)M[x]=arguments[x];return Promise.all(this.handlers.map((C=>C.apply(this,M))))}remove(C){const M=this.handlers.indexOf(C);this.handlers[M]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}M.EventEmitter=x,M.createSignal=function(){const C=new x;function M(M){return C.register(M,null===this)}return M.once=M=>{const x=function(){for(var f=arguments.length,T=new Array(f),z=0;z<f;z++)T[z]=arguments[z];M.apply(this,T),C.remove(x)};C.register(x)},M.remove=M=>C.remove(M),M.invoke=function(){return C.invoke(...arguments)},M.invokeAsync=function(){return C.invokeAsync(...arguments)},M.clear=()=>C.clear(),M}},11449:(C,M)=>{"use strict";Object.defineProperty(M,"__esModule",{value:!0}),M.ServerError=M.CloseCode=void 0,function(C){C[C.CONSENTED=4e3]="CONSENTED",C[C.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(M.CloseCode||(M.CloseCode={}));class x extends Error{constructor(C,M){super(M),this.name="ServerError",this.code=C}}M.ServerError=x},11424:(C,M,x)=>{"use strict";M.e=void 0,x(11428);var f=x(11437);Object.defineProperty(M,"e",{enumerable:!0,get:function(){return f.Client}});var T=x(11480);var z=x(11451);var s=x(11509);const S=x(11515);const m=x(11518),Q=x(11486);(0,Q.registerSerializer)("schema",S.SchemaSerializer),(0,Q.registerSerializer)("none",m.NoneSerializer)},11428:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=C=>null!==C&&"object"===typeof C&&C.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},11457:(C,M)=>{"use strict";function x(C,M){if(this._offset=M,C instanceof ArrayBuffer)this._buffer=C,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(C))throw new Error("Invalid argument");this._buffer=C.buffer,this._view=new DataView(this._buffer,C.byteOffset,C.byteLength)}}Object.defineProperty(M,"__esModule",{value:!0}),M.decode=M.encode=void 0,x.prototype._array=function(C){for(var M=new Array(C),x=0;x<C;x++)M[x]=this._parse();return M},x.prototype._map=function(C){for(var M={},x=0;x<C;x++)M[this._parse()]=this._parse();return M},x.prototype._str=function(C){var M=function(C,M,x){for(var f="",T=0,z=M,s=M+x;z<s;z++){var S=C.getUint8(z);if(0!==(128&S))if(192!==(224&S))if(224!==(240&S)){if(240!==(248&S))throw new Error("Invalid byte "+S.toString(16));(T=(7&S)<<18|(63&C.getUint8(++z))<<12|(63&C.getUint8(++z))<<6|63&C.getUint8(++z))>=65536?(T-=65536,f+=String.fromCharCode(55296+(T>>>10),56320+(1023&T))):f+=String.fromCharCode(T)}else f+=String.fromCharCode((15&S)<<12|(63&C.getUint8(++z))<<6|63&C.getUint8(++z));else f+=String.fromCharCode((31&S)<<6|63&C.getUint8(++z));else f+=String.fromCharCode(S)}return f}(this._view,this._offset,C);return this._offset+=C,M},x.prototype._bin=function(C){var M=this._buffer.slice(this._offset,this._offset+C);return this._offset+=C,M},x.prototype._parse=function(){var C,M=this._view.getUint8(this._offset++),x=0,f=0,T=0,z=0;if(M<192)return M<128?M:M<144?this._map(15&M):M<160?this._array(15&M):this._str(31&M);if(M>223)return-1*(255-M+1);switch(M){case 192:return null;case 194:return!1;case 195:return!0;case 196:return x=this._view.getUint8(this._offset),this._offset+=1,this._bin(x);case 197:return x=this._view.getUint16(this._offset),this._offset+=2,this._bin(x);case 198:return x=this._view.getUint32(this._offset),this._offset+=4,this._bin(x);case 199:if(x=this._view.getUint8(this._offset),f=this._view.getInt8(this._offset+1),this._offset+=2,-1===f){var s=this._view.getUint32(this._offset);return T=this._view.getInt32(this._offset+4),z=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*T+z)+s/1e6)}return[f,this._bin(x)];case 200:return x=this._view.getUint16(this._offset),f=this._view.getInt8(this._offset+2),this._offset+=3,[f,this._bin(x)];case 201:return x=this._view.getUint32(this._offset),f=this._view.getInt8(this._offset+4),this._offset+=5,[f,this._bin(x)];case 202:return C=this._view.getFloat32(this._offset),this._offset+=4,C;case 203:return C=this._view.getFloat64(this._offset),this._offset+=8,C;case 204:return C=this._view.getUint8(this._offset),this._offset+=1,C;case 205:return C=this._view.getUint16(this._offset),this._offset+=2,C;case 206:return C=this._view.getUint32(this._offset),this._offset+=4,C;case 207:return T=this._view.getUint32(this._offset)*Math.pow(2,32),z=this._view.getUint32(this._offset+4),this._offset+=8,T+z;case 208:return C=this._view.getInt8(this._offset),this._offset+=1,C;case 209:return C=this._view.getInt16(this._offset),this._offset+=2,C;case 210:return C=this._view.getInt32(this._offset),this._offset+=4,C;case 211:return T=this._view.getInt32(this._offset)*Math.pow(2,32),z=this._view.getUint32(this._offset+4),this._offset+=8,T+z;case 212:return f=this._view.getInt8(this._offset),this._offset+=1,0===f?void(this._offset+=1):[f,this._bin(1)];case 213:return f=this._view.getInt8(this._offset),this._offset+=1,[f,this._bin(2)];case 214:return f=this._view.getInt8(this._offset),this._offset+=1,-1===f?(C=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*C)):[f,this._bin(4)];case 215:return f=this._view.getInt8(this._offset),this._offset+=1,0===f?(T=this._view.getInt32(this._offset)*Math.pow(2,32),z=this._view.getUint32(this._offset+4),this._offset+=8,new Date(T+z)):-1===f?(T=this._view.getUint32(this._offset),z=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&T)+z)+(T>>>2)/1e6)):[f,this._bin(8)];case 216:return f=this._view.getInt8(this._offset),this._offset+=1,[f,this._bin(16)];case 217:return x=this._view.getUint8(this._offset),this._offset+=1,this._str(x);case 218:return x=this._view.getUint16(this._offset),this._offset+=2,this._str(x);case 219:return x=this._view.getUint32(this._offset),this._offset+=4,this._str(x);case 220:return x=this._view.getUint16(this._offset),this._offset+=2,this._array(x);case 221:return x=this._view.getUint32(this._offset),this._offset+=4,this._array(x);case 222:return x=this._view.getUint16(this._offset),this._offset+=2,this._map(x);case 223:return x=this._view.getUint32(this._offset),this._offset+=4,this._map(x)}throw new Error("Could not parse")},M.decode=function(C){var M=new x(C,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),f=M._parse();if(M._offset!==C.byteLength)throw new Error(C.byteLength-M._offset+" trailing bytes");return f};function f(C,M,x){for(var f=0,T=0,z=x.length;T<z;T++)(f=x.charCodeAt(T))<128?C.setUint8(M++,f):f<2048?(C.setUint8(M++,192|f>>6),C.setUint8(M++,128|63&f)):f<55296||f>=57344?(C.setUint8(M++,224|f>>12),C.setUint8(M++,128|f>>6&63),C.setUint8(M++,128|63&f)):(T++,f=65536+((1023&f)<<10|1023&x.charCodeAt(T)),C.setUint8(M++,240|f>>18),C.setUint8(M++,128|f>>12&63),C.setUint8(M++,128|f>>6&63),C.setUint8(M++,128|63&f))}function T(C,M,x){var f=typeof x,z=0,s=0,S=0,m=0,Q=0,V=0;if("string"===f){if(Q=function(C){for(var M=0,x=0,f=0,T=C.length;f<T;f++)(M=C.charCodeAt(f))<128?x+=1:M<2048?x+=2:M<55296||M>=57344?x+=3:(f++,x+=4);return x}(x),Q<32)C.push(160|Q),V=1;else if(Q<256)C.push(217,Q),V=2;else if(Q<65536)C.push(218,Q>>8,Q),V=3;else{if(!(Q<4294967296))throw new Error("String too long");C.push(219,Q>>24,Q>>16,Q>>8,Q),V=5}return M.push({_str:x,_length:Q,_offset:C.length}),V+Q}if("number"===f)return Math.floor(x)===x&&isFinite(x)?x>=0?x<128?(C.push(x),1):x<256?(C.push(204,x),2):x<65536?(C.push(205,x>>8,x),3):x<4294967296?(C.push(206,x>>24,x>>16,x>>8,x),5):(S=x/Math.pow(2,32)|0,m=x>>>0,C.push(207,S>>24,S>>16,S>>8,S,m>>24,m>>16,m>>8,m),9):x>=-32?(C.push(x),1):x>=-128?(C.push(208,x),2):x>=-32768?(C.push(209,x>>8,x),3):x>=-2147483648?(C.push(210,x>>24,x>>16,x>>8,x),5):(S=Math.floor(x/Math.pow(2,32)),m=x>>>0,C.push(211,S>>24,S>>16,S>>8,S,m>>24,m>>16,m>>8,m),9):(C.push(203),M.push({_float:x,_length:8,_offset:C.length}),9);if("object"===f){if(null===x)return C.push(192),1;if(Array.isArray(x)){if((Q=x.length)<16)C.push(144|Q),V=1;else if(Q<65536)C.push(220,Q>>8,Q),V=3;else{if(!(Q<4294967296))throw new Error("Array too large");C.push(221,Q>>24,Q>>16,Q>>8,Q),V=5}for(z=0;z<Q;z++)V+=T(C,M,x[z]);return V}if(x instanceof Date){var y=x.getTime(),U=Math.floor(y/1e3),O=1e6*(y-1e3*U);return U>=0&&O>=0&&U<=17179869183?0===O&&U<=4294967295?(C.push(214,255,U>>24,U>>16,U>>8,U),6):(S=U/4294967296,m=4294967295&U,C.push(215,255,O>>22,O>>14,O>>6,S,m>>24,m>>16,m>>8,m),10):(S=Math.floor(U/4294967296),m=U>>>0,C.push(199,12,255,O>>24,O>>16,O>>8,O,S>>24,S>>16,S>>8,S,m>>24,m>>16,m>>8,m),15)}if(x instanceof ArrayBuffer){if((Q=x.byteLength)<256)C.push(196,Q),V=2;else if(Q<65536)C.push(197,Q>>8,Q),V=3;else{if(!(Q<4294967296))throw new Error("Buffer too large");C.push(198,Q>>24,Q>>16,Q>>8,Q),V=5}return M.push({_bin:x,_length:Q,_offset:C.length}),V+Q}if("function"===typeof x.toJSON)return T(C,M,x.toJSON());var d=[],D="",o=Object.keys(x);for(z=0,s=o.length;z<s;z++)void 0!==x[D=o[z]]&&"function"!==typeof x[D]&&d.push(D);if((Q=d.length)<16)C.push(128|Q),V=1;else if(Q<65536)C.push(222,Q>>8,Q),V=3;else{if(!(Q<4294967296))throw new Error("Object too large");C.push(223,Q>>24,Q>>16,Q>>8,Q),V=5}for(z=0;z<Q;z++)V+=T(C,M,D=d[z]),V+=T(C,M,x[D]);return V}if("boolean"===f)return C.push(x?195:194),1;if("undefined"===f)return C.push(192),1;if("function"===typeof x.toJSON)return T(C,M,x.toJSON());throw new Error("Could not encode")}M.encode=function(C){var M=[],x=[],z=T(M,x,C),s=new ArrayBuffer(z),S=new DataView(s),m=0,Q=0,V=-1;x.length>0&&(V=x[0]._offset);for(var y,U=0,O=0,d=0,D=M.length;d<D;d++)if(S.setUint8(Q+d,M[d]),d+1===V){if(U=(y=x[m])._length,O=Q+V,y._bin)for(var o=new Uint8Array(y._bin),L=0;L<U;L++)S.setUint8(O+L,o[L]);else y._str?f(S,O,y._str):void 0!==y._float&&S.setFloat64(O,y._float);Q+=U,x[++m]&&(V=x[m]._offset)}return s}},11518:(C,M)=>{"use strict";Object.defineProperty(M,"__esModule",{value:!0}),M.NoneSerializer=void 0;M.NoneSerializer=class{setState(C){}getState(){return null}patch(C){}teardown(){}handshake(C){}}},11515:(C,M,x)=>{"use strict";Object.defineProperty(M,"__esModule",{value:!0}),M.SchemaSerializer=void 0;const f=x(11504);M.SchemaSerializer=class{setState(C){return this.state.decode(C)}getState(){return this.state}patch(C){return this.state.decode(C)}teardown(){var C,M;null===(M=null===(C=this.state)||void 0===C?void 0:C.$changes)||void 0===M||M.root.clearRefs()}handshake(C,M){if(this.state){(new f.Reflection).decode(C,M)}else this.state=f.Reflection.decode(C,M)}}},11486:(C,M)=>{"use strict";Object.defineProperty(M,"__esModule",{value:!0}),M.getSerializer=M.registerSerializer=void 0;const x={};M.registerSerializer=function(C,M){x[C]=M},M.getSerializer=function(C){const M=x[C];if(!M)throw new Error("missing serializer: "+C);return M}},11470:function(C,M,x){"use strict";var f=this&&this.__importDefault||function(C){return C&&C.__esModule?C:{default:C}};Object.defineProperty(M,"__esModule",{value:!0}),M.WebSocketTransport=void 0;const T=f(x(11472)),z=globalThis.WebSocket||T.default;M.WebSocketTransport=class{constructor(C){this.events=C}send(C){C instanceof ArrayBuffer?this.ws.send(C):Array.isArray(C)&&this.ws.send(new Uint8Array(C).buffer)}connect(C){this.ws=new z(C,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(C,M){this.ws.close(C,M)}get isOpen(){return this.ws.readyState===z.OPEN}}},11472:C=>{"use strict";C.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},11570:C=>{"use strict";C.exports=function(C){for(var M=new Array(C),x=0;x<C;++x)M[x]=x;return M}},11572:C=>{function M(C){return!!C.constructor&&"function"===typeof C.constructor.isBuffer&&C.constructor.isBuffer(C)}C.exports=function(C){return null!=C&&(M(C)||function(C){return"function"===typeof C.readFloatLE&&"function"===typeof C.slice&&M(C.slice(0,0))}(C)||!!C._isBuffer)}},11563:(C,M,x)=>{var f=x(11570),T=x(11572),z="undefined"!==typeof Float64Array;function s(C,M){return C[0]-M[0]}function S(){var C,M=this.stride,x=new Array(M.length);for(C=0;C<x.length;++C)x[C]=[Math.abs(M[C]),C];x.sort(s);var f=new Array(x.length);for(C=0;C<f.length;++C)f[C]=x[C][1];return f}function m(C,M){var x=["View",M,"d",C].join("");M<0&&(x="View_Nil"+C);var T="generic"===C;if(-1===M){var z="function "+x+"(a){this.data=a;};var proto="+x+".prototype;proto.dtype='"+C+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+x+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+x+"(a){return new "+x+"(a);}";return new Function(z)()}if(0===M){z="function "+x+"(a,d) {this.data = a;this.offset = d};var proto="+x+".prototype;proto.dtype='"+C+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+x+"_copy() {return new "+x+"(this.data,this.offset)};proto.pick=function "+x+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+x+"_get(){return "+(T?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+x+"_set(v){return "+(T?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+x+"(a,b,c,d){return new "+x+"(a,d)}";return new Function("TrivialArray",z)(Q[C][0])}z=["'use strict'"];var s=f(M),m=s.map((function(C){return"i"+C})),V="this.offset+"+s.map((function(C){return"this.stride["+C+"]*i"+C})).join("+"),y=s.map((function(C){return"b"+C})).join(","),U=s.map((function(C){return"c"+C})).join(",");z.push("function "+x+"(a,"+y+","+U+",d){this.data=a","this.shape=["+y+"]","this.stride=["+U+"]","this.offset=d|0}","var proto="+x+".prototype","proto.dtype='"+C+"'","proto.dimension="+M),z.push("Object.defineProperty(proto,'size',{get:function "+x+"_size(){return "+s.map((function(C){return"this.shape["+C+"]"})).join("*"),"}})"),1===M?z.push("proto.order=[0]"):(z.push("Object.defineProperty(proto,'order',{get:"),M<4?(z.push("function "+x+"_order(){"),2===M?z.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===M&&z.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):z.push("ORDER})")),z.push("proto.set=function "+x+"_set("+m.join(",")+",v){"),T?z.push("return this.data.set("+V+",v)}"):z.push("return this.data["+V+"]=v}"),z.push("proto.get=function "+x+"_get("+m.join(",")+"){"),T?z.push("return this.data.get("+V+")}"):z.push("return this.data["+V+"]}"),z.push("proto.index=function "+x+"_index(",m.join(),"){return "+V+"}"),z.push("proto.hi=function "+x+"_hi("+m.join(",")+"){return new "+x+"(this.data,"+s.map((function(C){return["(typeof i",C,"!=='number'||i",C,"<0)?this.shape[",C,"]:i",C,"|0"].join("")})).join(",")+","+s.map((function(C){return"this.stride["+C+"]"})).join(",")+",this.offset)}");var O=s.map((function(C){return"a"+C+"=this.shape["+C+"]"})),d=s.map((function(C){return"c"+C+"=this.stride["+C+"]"}));z.push("proto.lo=function "+x+"_lo("+m.join(",")+"){var b=this.offset,d=0,"+O.join(",")+","+d.join(","));for(var D=0;D<M;++D)z.push("if(typeof i"+D+"==='number'&&i"+D+">=0){d=i"+D+"|0;b+=c"+D+"*d;a"+D+"-=d}");z.push("return new "+x+"(this.data,"+s.map((function(C){return"a"+C})).join(",")+","+s.map((function(C){return"c"+C})).join(",")+",b)}"),z.push("proto.step=function "+x+"_step("+m.join(",")+"){var "+s.map((function(C){return"a"+C+"=this.shape["+C+"]"})).join(",")+","+s.map((function(C){return"b"+C+"=this.stride["+C+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(D=0;D<M;++D)z.push("if(typeof i"+D+"==='number'){d=i"+D+"|0;if(d<0){c+=b"+D+"*(a"+D+"-1);a"+D+"=ceil(-a"+D+"/d)}else{a"+D+"=ceil(a"+D+"/d)}b"+D+"*=d}");z.push("return new "+x+"(this.data,"+s.map((function(C){return"a"+C})).join(",")+","+s.map((function(C){return"b"+C})).join(",")+",c)}");var o=new Array(M),L=new Array(M);for(D=0;D<M;++D)o[D]="a[i"+D+"]",L[D]="b[i"+D+"]";z.push("proto.transpose=function "+x+"_transpose("+m+"){"+m.map((function(C,M){return C+"=("+C+"===undefined?"+M+":"+C+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+x+"(this.data,"+o.join(",")+","+L.join(",")+",this.offset)}"),z.push("proto.pick=function "+x+"_pick("+m+"){var a=[],b=[],c=this.offset");for(D=0;D<M;++D)z.push("if(typeof i"+D+"==='number'&&i"+D+">=0){c=(c+this.stride["+D+"]*i"+D+")|0}else{a.push(this.shape["+D+"]);b.push(this.stride["+D+"])}");return z.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),z.push("return function construct_"+x+"(data,shape,stride,offset){return new "+x+"(data,"+s.map((function(C){return"shape["+C+"]"})).join(",")+","+s.map((function(C){return"stride["+C+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",z.join("\n"))(Q[C],S)}var Q={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};C.exports=function(C,M,x,f){if(void 0===C)return(0,Q.array[0])([]);"number"===typeof C&&(C=[C]),void 0===M&&(M=[C.length]);var s=M.length;if(void 0===x){x=new Array(s);for(var S=s-1,V=1;S>=0;--S)x[S]=V,V*=M[S]}if(void 0===f){f=0;for(S=0;S<s;++S)x[S]<0&&(f-=(M[S]-1)*x[S])}for(var y=function(C){if(T(C))return"buffer";if(z)switch(Object.prototype.toString.call(C)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(C)?"array":"generic"}(C),U=Q[y];U.length<=s+1;)U.push(m(y,U.length-1));return(0,U[s+1])(C,M,x,f)}},11536:C=>{var M;self,M=()=>(()=>{"use strict";var C={d:(M,x)=>{for(var f in x)C.o(x,f)&&!C.o(M,f)&&Object.defineProperty(M,f,{enumerable:!0,get:x[f]})},o:(C,M)=>Object.prototype.hasOwnProperty.call(C,M)},M={};C.d(M,{default:()=>c});var x,f=function(C,M){var x=M.x-C.x,f=M.y-C.y;return Math.sqrt(x*x+f*f)},T=function(C){return C*(Math.PI/180)},z=new Map,s=function(C){z.has(C)&&clearTimeout(z.get(C)),z.set(C,setTimeout(C,100))},S=function(C,M,x){for(var f,T=M.split(/[ ,]+/g),z=0;z<T.length;z+=1)f=T[z],C.addEventListener?C.addEventListener(f,x,!1):C.attachEvent&&C.attachEvent(f,x)},m=function(C,M,x){for(var f,T=M.split(/[ ,]+/g),z=0;z<T.length;z+=1)f=T[z],C.removeEventListener?C.removeEventListener(f,x):C.detachEvent&&C.detachEvent(f,x)},Q=function(C){return C.preventDefault(),C.type.match(/^touch/)?C.changedTouches:C},V=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},y=function(C,M){M.top||M.right||M.bottom||M.left?(C.style.top=M.top,C.style.right=M.right,C.style.bottom=M.bottom,C.style.left=M.left):(C.style.left=M.x+"px",C.style.top=M.y+"px")},U=function(C,M,x){var f=O(C);for(var T in f)if(f.hasOwnProperty(T))if("string"==typeof M)f[T]=M+" "+x;else{for(var z="",s=0,S=M.length;s<S;s+=1)z+=M[s]+" "+x+", ";f[T]=z.slice(0,-2)}return f},O=function(C){var M={};return M[C]="",["webkit","Moz","o"].forEach((function(x){M[x+C.charAt(0).toUpperCase()+C.slice(1)]=""})),M},d=function(C,M){for(var x in M)M.hasOwnProperty(x)&&(C[x]=M[x]);return C},D=function(C,M){if(C.length)for(var x=0,f=C.length;x<f;x+=1)M(C[x]);else M(C)},o="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,L=window.matchMedia("(any-hover: none)").matches,t=!!("ontouchstart"in window),A=!!window.PointerEvent,H=!!window.MSPointerEvent,j={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},b={start:"mousedown",move:"mousemove",end:"mouseup"},R={};function n(){}o&&!L?x=j:A?x={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:H?x={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:t?(x=j,R=b):x=b,n.prototype.on=function(C,M){var x,f=this,T=C.split(/[ ,]+/g);f._handlers_=f._handlers_||{};for(var z=0;z<T.length;z+=1)x=T[z],f._handlers_[x]=f._handlers_[x]||[],f._handlers_[x].push(M);return f},n.prototype.off=function(C,M){var x=this;return x._handlers_=x._handlers_||{},void 0===C?x._handlers_={}:void 0===M?x._handlers_[C]=null:x._handlers_[C]&&x._handlers_[C].indexOf(M)>=0&&x._handlers_[C].splice(x._handlers_[C].indexOf(M),1),x},n.prototype.trigger=function(C,M){var x,f=this,T=C.split(/[ ,]+/g);f._handlers_=f._handlers_||{};for(var z=0;z<T.length;z+=1)x=T[z],f._handlers_[x]&&f._handlers_[x].length&&f._handlers_[x].forEach((function(C){C.call(f,{type:x,target:f},M)}))},n.prototype.config=function(C){var M=this;M.options=M.defaults||{},C&&(M.options=function(C,M){var x={};for(var f in C)C.hasOwnProperty(f)&&M.hasOwnProperty(f)?x[f]=M[f]:C.hasOwnProperty(f)&&(x[f]=C[f]);return x}(M.options,C))},n.prototype.bindEvt=function(C,M){var f=this;return f._domHandlers_=f._domHandlers_||{},f._domHandlers_[M]=function(){"function"==typeof f["on"+M]?f["on"+M].apply(f,arguments):console.warn('[WARNING] : Missing "on'+M+'" handler.')},S(C,x[M],f._domHandlers_[M]),R[M]&&S(C,R[M],f._domHandlers_[M]),f},n.prototype.unbindEvt=function(C,M){var f=this;return f._domHandlers_=f._domHandlers_||{},m(C,x[M],f._domHandlers_[M]),R[M]&&m(C,R[M],f._domHandlers_[M]),delete f._domHandlers_[M],this};const I=n;function X(C,M){return this.identifier=M.identifier,this.position=M.position,this.frontPosition=M.frontPosition,this.collection=C,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(M),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=X.id,X.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}X.prototype=new I,X.constructor=X,X.id=0,X.prototype.buildEl=function(C){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},X.prototype.stylize=function(){if(this.options.dataOnly)return this;var C=this.options.fadeTime+"ms",M=function(){var C=O("borderRadius");for(var M in C)C.hasOwnProperty(M)&&(C[M]="50%");return C}(),x=U("transition","opacity",C),f={};return f.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},f.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},f.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},d(f.el,x),"circle"===this.options.shape&&d(f.back,M),d(f.front,M),this.applyStyles(f),this},X.prototype.applyStyles=function(C){for(var M in this.ui)if(this.ui.hasOwnProperty(M))for(var x in C[M])this.ui[M].style[x]=C[M][x];return this},X.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},X.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},X.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},X.prototype.show=function(C){var M=this;return M.options.dataOnly||(clearTimeout(M.removeTimeout),clearTimeout(M.showTimeout),clearTimeout(M.restTimeout),M.addToDom(),M.restCallback(),setTimeout((function(){M.ui.el.style.opacity=1}),0),M.showTimeout=setTimeout((function(){M.trigger("shown",M.instance),"function"==typeof C&&C.call(this)}),M.options.fadeTime)),M},X.prototype.hide=function(C){var M=this;if(M.options.dataOnly)return M;if(M.ui.el.style.opacity=M.options.restOpacity,clearTimeout(M.removeTimeout),clearTimeout(M.showTimeout),clearTimeout(M.restTimeout),M.removeTimeout=setTimeout((function(){var x="dynamic"===M.options.mode?"none":"block";M.ui.el.style.display=x,"function"==typeof C&&C.call(M),M.trigger("hidden",M.instance)}),M.options.fadeTime),M.options.restJoystick){var x=M.options.restJoystick,f={};f.x=!0===x||!1!==x.x?0:M.instance.frontPosition.x,f.y=!0===x||!1!==x.y?0:M.instance.frontPosition.y,M.setPosition(C,f)}return M},X.prototype.setPosition=function(C,M){var x=this;x.frontPosition={x:M.x,y:M.y};var f=x.options.fadeTime+"ms",T={};T.front=U("transition",["transform"],f);var z={front:{}};z.front={transform:"translate("+x.frontPosition.x+"px,"+x.frontPosition.y+"px)"},x.applyStyles(T),x.applyStyles(z),x.restTimeout=setTimeout((function(){"function"==typeof C&&C.call(x),x.restCallback()}),x.options.fadeTime)},X.prototype.restCallback=function(){var C=this,M={};M.front=U("transition","none",""),C.applyStyles(M),C.trigger("rested",C.instance)},X.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},X.prototype.computeDirection=function(C){var M,x,f,T=C.angle.radian,z=Math.PI/4,s=Math.PI/2;if(T>z&&T<3*z&&!C.lockX?M="up":T>-z&&T<=z&&!C.lockY?M="left":T>3*-z&&T<=-z&&!C.lockX?M="down":C.lockY||(M="right"),C.lockY||(x=T>-s&&T<s?"left":"right"),C.lockX||(f=T>0?"up":"down"),C.force>this.options.threshold){var S,m={};for(S in this.direction)this.direction.hasOwnProperty(S)&&(m[S]=this.direction[S]);var Q={};for(S in this.direction={x:x,y:f,angle:M},C.direction=this.direction,m)m[S]===this.direction[S]&&(Q[S]=!0);if(Q.x&&Q.y&&Q.angle)return C;Q.x&&Q.y||this.trigger("plain",C),Q.x||this.trigger("plain:"+x,C),Q.y||this.trigger("plain:"+f,C),Q.angle||this.trigger("dir dir:"+M,C)}else this.resetDirection();return C};const g=X;function B(C,M){var x=this;x.nipples=[],x.idles=[],x.actives=[],x.ids=[],x.pressureIntervals={},x.manager=C,x.id=B.id,B.id+=1,x.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},x.config(M),"static"!==x.options.mode&&"semi"!==x.options.mode||(x.options.multitouch=!1),x.options.multitouch||(x.options.maxNumberOfNipples=1);var f=getComputedStyle(x.options.zone.parentElement);return f&&"flex"===f.display&&(x.parentIsFlex=!0),x.updateBox(),x.prepareNipples(),x.Gj(),x.begin(),x.nipples}B.prototype=new I,B.constructor=B,B.id=0,B.prototype.prepareNipples=function(){var C=this,M=C.nipples;M.on=C.on.bind(C),M.off=C.off.bind(C),M.options=C.options,M.destroy=C.destroy.bind(C),M.ids=C.ids,M.id=C.id,M.processOnMove=C.processOnMove.bind(C),M.processOnEnd=C.processOnEnd.bind(C),M.get=function(C){if(void 0===C)return M[0];for(var x=0,f=M.length;x<f;x+=1)if(M[x].identifier===C)return M[x];return!1}},B.prototype.Gj=function(){var C=this;C.bindEvt(C.options.zone,"start"),C.options.zone.style.touchAction="none",C.options.zone.style.msTouchAction="none"},B.prototype.begin=function(){var C=this,M=C.options;if("static"===M.mode){var x=C.createNipple(M.position,C.manager.getIdentifier());x.add(),C.idles.push(x)}},B.prototype.createNipple=function(C,M){var x=this,f=x.manager.scroll,T={},z=x.options,s=x.parentIsFlex?f.x:f.x+x.box.left,S=x.parentIsFlex?f.y:f.y+x.box.top;if(C.x&&C.y)T={x:C.x-s,y:C.y-S};else if(C.top||C.right||C.bottom||C.left){var m=document.createElement("DIV");m.style.display="hidden",m.style.top=C.top,m.style.right=C.right,m.style.bottom=C.bottom,m.style.left=C.left,m.style.position="absolute",z.zone.appendChild(m);var Q=m.getBoundingClientRect();z.zone.removeChild(m),T=C,C={x:Q.left+f.x,y:Q.top+f.y}}var V=new g(x,{color:z.color,size:z.size,threshold:z.threshold,fadeTime:z.fadeTime,dataOnly:z.dataOnly,restJoystick:z.restJoystick,restOpacity:z.restOpacity,mode:z.mode,identifier:M,position:C,zone:z.zone,frontPosition:{x:0,y:0},shape:z.shape});return z.dataOnly||(y(V.ui.el,T),y(V.ui.front,V.frontPosition)),x.nipples.push(V),x.trigger("added "+V.identifier+":added",V),x.manager.trigger("added "+V.identifier+":added",V),x.bindNipple(V),V},B.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},B.prototype.bindNipple=function(C){var M,x=this,f=function(C,f){M=C.type+" "+f.id+":"+C.type,x.trigger(M,f)};C.on("destroyed",x.onDestroyed.bind(x)),C.on("shown hidden rested dir plain",f),C.on("dir:up dir:right dir:down dir:left",f),C.on("plain:up plain:right plain:down plain:left",f)},B.prototype.pressureFn=function(C,M,x){var f=this,T=0;clearInterval(f.pressureIntervals[x]),f.pressureIntervals[x]=setInterval(function(){var x=C.force||C.pressure||C.webkitForce||0;x!==T&&(M.trigger("pressure",x),f.trigger("pressure "+M.identifier+":pressure",x),T=x)}.bind(f),100)},B.prototype.onstart=function(C){var M=this,x=M.options,f=C;return C=Q(C),M.updateBox(),D(C,(function(T){M.actives.length<x.maxNumberOfNipples?M.processOnStart(T):f.type.match(/^touch/)&&(Object.keys(M.manager.ids).forEach((function(x){if(Object.values(f.touches).findIndex((function(C){return C.identifier===x}))<0){var T=[C[0]];T.identifier=x,M.processOnEnd(T)}})),M.actives.length<x.maxNumberOfNipples&&M.processOnStart(T))})),M.manager.bindDocument(),!1},B.prototype.processOnStart=function(C){var M,x=this,T=x.options,z=x.manager.getIdentifier(C),s=C.force||C.pressure||C.webkitForce||0,S={x:C.pageX,y:C.pageY},m=x.getOrCreate(z,S);m.identifier!==z&&x.manager.removeIdentifier(m.identifier),m.identifier=z;var Q=function(M){M.trigger("start",M),x.trigger("start "+M.id+":start",M),M.show(),s>0&&x.pressureFn(C,M,M.identifier),x.processOnMove(C)};if((M=x.idles.indexOf(m))>=0&&x.idles.splice(M,1),x.actives.push(m),x.ids.push(m.identifier),"semi"!==T.mode)Q(m);else{if(!(f(S,m.position)<=T.catchDistance))return m.destroy(),void x.processOnStart(C);Q(m)}return m},B.prototype.getOrCreate=function(C,M){var x,f=this,T=f.options;return/(semi|static)/.test(T.mode)?(x=f.idles[0])?(f.idles.splice(0,1),x):"semi"===T.mode?f.createNipple(M,C):(console.warn("Coudln't find the needed nipple."),!1):x=f.createNipple(M,C)},B.prototype.processOnMove=function(C){var M=this,x=M.options,z=M.manager.getIdentifier(C),s=M.nipples.get(z),S=M.manager.scroll;if(function(C){return isNaN(C.buttons)?0!==C.pressure:0!==C.buttons}(C)){if(!s)return console.error("Found zombie joystick with ID "+z),void M.manager.removeIdentifier(z);if(x.dynamicPage){var m=s.el.getBoundingClientRect();s.position={x:S.x+m.left,y:S.y+m.top}}s.identifier=z;var Q=s.options.size/2,V={x:C.pageX,y:C.pageY};x.lockX&&(V.y=s.position.y),x.lockY&&(V.x=s.position.x);var y,U,O,d,D,o,L,t,A,H,j=f(V,s.position),b=(y=V,O=(U=s.position).x-y.x,d=U.y-y.y,function(C){return C*(180/Math.PI)}(Math.atan2(d,O))),R=T(b),n=j/Q,I={distance:j,position:V};if("circle"===s.options.shape?(D=Math.min(j,Q),L=s.position,t=D,H={x:0,y:0},A=T(A=b),H.x=L.x-t*Math.cos(A),H.y=L.y-t*Math.sin(A),o=H):(o=function(C,M,x){return{x:Math.min(Math.max(C.x,M.x-x),M.x+x),y:Math.min(Math.max(C.y,M.y-x),M.y+x)}}(V,s.position,Q),D=f(o,s.position)),x.follow){if(j>Q){var X=V.x-o.x,g=V.y-o.y;s.position.x+=X,s.position.y+=g,s.el.style.top=s.position.y-(M.box.top+S.y)+"px",s.el.style.left=s.position.x-(M.box.left+S.x)+"px",j=f(V,s.position)}}else V=o,j=D;var B=V.x-s.position.x,F=V.y-s.position.y;s.frontPosition={x:B,y:F},x.dataOnly||(s.ui.front.style.transform="translate("+B+"px,"+F+"px)");var P={identifier:s.identifier,position:V,force:n,pressure:C.force||C.pressure||C.webkitForce||0,distance:j,angle:{radian:R,degree:b},vector:{x:B/Q,y:-F/Q},raw:I,instance:s,lockX:x.lockX,lockY:x.lockY};(P=s.computeDirection(P)).angle={radian:T(180-b),degree:180-b},s.trigger("move",P),M.trigger("move "+s.id+":move",P)}else this.processOnEnd(C)},B.prototype.processOnEnd=function(C){var M=this,x=M.options,f=M.manager.getIdentifier(C),T=M.nipples.get(f),z=M.manager.removeIdentifier(T.identifier);T&&(x.dataOnly||T.hide((function(){"dynamic"===x.mode&&(T.trigger("removed",T),M.trigger("removed "+T.id+":removed",T),M.manager.trigger("removed "+T.id+":removed",T),T.destroy())})),clearInterval(M.pressureIntervals[T.identifier]),T.resetDirection(),T.trigger("end",T),M.trigger("end "+T.id+":end",T),M.ids.indexOf(T.identifier)>=0&&M.ids.splice(M.ids.indexOf(T.identifier),1),M.actives.indexOf(T)>=0&&M.actives.splice(M.actives.indexOf(T),1),/(semi|static)/.test(x.mode)?M.idles.push(T):M.nipples.indexOf(T)>=0&&M.nipples.splice(M.nipples.indexOf(T),1),M.manager.unbindDocument(),/(semi|static)/.test(x.mode)&&(M.manager.ids[z.id]=z.identifier))},B.prototype.onDestroyed=function(C,M){var x=this;x.nipples.indexOf(M)>=0&&x.nipples.splice(x.nipples.indexOf(M),1),x.actives.indexOf(M)>=0&&x.actives.splice(x.actives.indexOf(M),1),x.idles.indexOf(M)>=0&&x.idles.splice(x.idles.indexOf(M),1),x.ids.indexOf(M.identifier)>=0&&x.ids.splice(x.ids.indexOf(M.identifier),1),x.manager.removeIdentifier(M.identifier),x.manager.unbindDocument()},B.prototype.destroy=function(){var C=this;for(var M in C.unbindEvt(C.options.zone,"start"),C.nipples.forEach((function(C){C.destroy()})),C.pressureIntervals)C.pressureIntervals.hasOwnProperty(M)&&clearInterval(C.pressureIntervals[M]);C.trigger("destroyed",C.nipples),C.manager.unbindDocument(),C.off()};const F=B;function P(C){var M=this;M.ids={},M.index=0,M.collections=[],M.scroll=V(),M.config(C),M.prepareCollections();var x=function(){var C;M.collections.forEach((function(x){x.forEach((function(x){C=x.el.getBoundingClientRect(),x.position={x:M.scroll.x+C.left,y:M.scroll.y+C.top}}))}))};S(window,"resize",(function(){s(x)}));var f=function(){M.scroll=V()};return S(window,"scroll",(function(){s(f)})),M.collections}P.prototype=new I,P.constructor=P,P.prototype.prepareCollections=function(){var C=this;C.collections.create=C.create.bind(C),C.collections.on=C.on.bind(C),C.collections.off=C.off.bind(C),C.collections.destroy=C.destroy.bind(C),C.collections.get=function(M){var x;return C.collections.every((function(C){return!(x=C.get(M))})),x}},P.prototype.create=function(C){return this.createCollection(C)},P.prototype.createCollection=function(C){var M=this,x=new F(M,C);return M.bindCollection(x),M.collections.push(x),x},P.prototype.bindCollection=function(C){var M,x=this,f=function(C,f){M=C.type+" "+f.id+":"+C.type,x.trigger(M,f)};C.on("destroyed",x.onDestroyed.bind(x)),C.on("shown hidden rested dir plain",f),C.on("dir:up dir:right dir:down dir:left",f),C.on("plain:up plain:right plain:down plain:left",f)},P.prototype.bindDocument=function(){var C=this;C.binded||(C.bindEvt(document,"move").bindEvt(document,"end"),C.binded=!0)},P.prototype.unbindDocument=function(C){var M=this;Object.keys(M.ids).length&&!0!==C||(M.unbindEvt(document,"move").unbindEvt(document,"end"),M.binded=!1)},P.prototype.getIdentifier=function(C){var M;return C?void 0===(M=void 0===C.identifier?C.pointerId:C.identifier)&&(M=this.latest||0):M=this.index,void 0===this.ids[M]&&(this.ids[M]=this.index,this.index+=1),this.latest=M,this.ids[M]},P.prototype.removeIdentifier=function(C){var M={};for(var x in this.ids)if(this.ids[x]===C){M.id=x,M.identifier=this.ids[x],delete this.ids[x];break}return M},P.prototype.onmove=function(C){return this.onAny("move",C),!1},P.prototype.onend=function(C){return this.onAny("end",C),!1},P.prototype.oncancel=function(C){return this.onAny("end",C),!1},P.prototype.onAny=function(C,M){var x,f=this,T="processOn"+C.charAt(0).toUpperCase()+C.slice(1);M=Q(M);var z=function(C,M,x){x.ids.indexOf(M)>=0&&(x[T](C),C._found_=!0)};return D(M,(function(C){x=f.getIdentifier(C),D(f.collections,z.bind(null,C,x)),C._found_||f.removeIdentifier(x)})),!1},P.prototype.destroy=function(){var C=this;C.unbindDocument(!0),C.ids={},C.index=0,C.collections.forEach((function(C){C.destroy()})),C.off()},P.prototype.onDestroyed=function(C,M){var x=this;if(x.collections.indexOf(M)<0)return!1;x.collections.splice(x.collections.indexOf(M),1)};var h=new P;const c={create:function(C){return h.create(C)},factory:h};return M.default})(),C.exports=M()},11593:(C,M,x)=>{"use strict";const{Deflate:f,deflate:T,deflateRaw:z,gzip:s}=x(11602),{Inflate:S,inflate:m,inflateRaw:Q,ungzip:V}=x(11657),y=x(11630);C.exports.Deflate=f,C.exports.deflate=T,C.exports.deflateRaw=z,C.exports.gzip=s,C.exports.Inflate=S,C.exports.inflate=m,C.exports.inflateRaw=Q,C.exports.ungzip=V,C.exports.constants=y},11602:(C,M,x)=>{"use strict";const f=x(11605),T=x(11637),z=x(11642),s=x(11627),S=x(11648),m=Object.prototype.toString,{Z_NO_FLUSH:Q,Z_SYNC_FLUSH:V,Z_FULL_FLUSH:y,Z_FINISH:U,Z_OK:O,Z_STREAM_END:d,Z_DEFAULT_COMPRESSION:D,Z_DEFAULT_STRATEGY:o,Z_DEFLATED:L}=x(11630);function t(C){this.options=T.assign({level:D,method:L,Ja:16384,windowBits:15,memLevel:8,strategy:o},C||{});let M=this.options;M.raw&&M.windowBits>0?M.windowBits=-M.windowBits:M.gzip&&M.windowBits>0&&M.windowBits<16&&(M.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new S,this.strm.avail_out=0;let x=f.deflateInit2(this.strm,M.level,M.method,M.windowBits,M.memLevel,M.strategy);if(x!==O)throw new Error(s[x]);if(M.header&&f.deflateSetHeader(this.strm,M.header),M.dictionary){let C;if(C="string"===typeof M.dictionary?z.string2buf(M.dictionary):"[object ArrayBuffer]"===m.call(M.dictionary)?new Uint8Array(M.dictionary):M.dictionary,x=f.deflateSetDictionary(this.strm,C),x!==O)throw new Error(s[x]);this._dict_set=!0}}function A(C,M){const x=new t(M);if(x.push(C,!0),x.err)throw x.msg||s[x.err];return x.result}t.prototype.push=function(C,M){const x=this.strm,T=this.options.Ja;let s,S;if(this.ended)return!1;for(S=M===~~M?M:!0===M?U:Q,"string"===typeof C?x.input=z.string2buf(C):"[object ArrayBuffer]"===m.call(C)?x.input=new Uint8Array(C):x.input=C,x.next_in=0,x.avail_in=x.input.length;;)if(0===x.avail_out&&(x.output=new Uint8Array(T),x.next_out=0,x.avail_out=T),(S===V||S===y)&&x.avail_out<=6)this.onData(x.output.subarray(0,x.next_out)),x.avail_out=0;else{if(s=f.deflate(x,S),s===d)return x.next_out>0&&this.onData(x.output.subarray(0,x.next_out)),s=f.deflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===O;if(0!==x.avail_out){if(S>0&&x.next_out>0)this.onData(x.output.subarray(0,x.next_out)),x.avail_out=0;else if(0===x.avail_in)break}else this.onData(x.output)}return!0},t.prototype.onData=function(C){this.chunks.push(C)},t.prototype.onEnd=function(C){C===O&&(this.result=T.flattenChunks(this.chunks)),this.chunks=[],this.err=C,this.msg=this.strm.msg},C.exports.Deflate=t,C.exports.deflate=A,C.exports.deflateRaw=function(C,M){return(M=M||{}).raw=!0,A(C,M)},C.exports.gzip=function(C,M){return(M=M||{}).gzip=!0,A(C,M)},C.exports.constants=x(11630)},11657:(C,M,x)=>{"use strict";const f=x(11663),T=x(11637),z=x(11642),s=x(11627),S=x(11648),m=x(11678),Q=Object.prototype.toString,{Z_NO_FLUSH:V,Z_FINISH:y,Z_OK:U,Z_STREAM_END:O,Z_NEED_DICT:d,Z_STREAM_ERROR:D,Z_DATA_ERROR:o,Z_MEM_ERROR:L}=x(11630);function t(C){this.options=T.assign({Ja:65536,windowBits:15,to:""},C||{});const M=this.options;M.raw&&M.windowBits>=0&&M.windowBits<16&&(M.windowBits=-M.windowBits,0===M.windowBits&&(M.windowBits=-15)),!(M.windowBits>=0&&M.windowBits<16)||C&&C.windowBits||(M.windowBits+=32),M.windowBits>15&&M.windowBits<48&&0===(15&M.windowBits)&&(M.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new S,this.strm.avail_out=0;let x=f.inflateInit2(this.strm,M.windowBits);if(x!==U)throw new Error(s[x]);if(this.header=new m,f.inflateGetHeader(this.strm,this.header),M.dictionary&&("string"===typeof M.dictionary?M.dictionary=z.string2buf(M.dictionary):"[object ArrayBuffer]"===Q.call(M.dictionary)&&(M.dictionary=new Uint8Array(M.dictionary)),M.raw&&(x=f.inflateSetDictionary(this.strm,M.dictionary),x!==U)))throw new Error(s[x])}function A(C,M){const x=new t(M);if(x.push(C),x.err)throw x.msg||s[x.err];return x.result}t.prototype.push=function(C,M){const x=this.strm,T=this.options.Ja,s=this.options.dictionary;let S,m,t;if(this.ended)return!1;for(m=M===~~M?M:!0===M?y:V,"[object ArrayBuffer]"===Q.call(C)?x.input=new Uint8Array(C):x.input=C,x.next_in=0,x.avail_in=x.input.length;;){for(0===x.avail_out&&(x.output=new Uint8Array(T),x.next_out=0,x.avail_out=T),S=f.inflate(x,m),S===d&&s&&(S=f.inflateSetDictionary(x,s),S===U?S=f.inflate(x,m):S===o&&(S=d));x.avail_in>0&&S===O&&x.state.wrap>0&&0!==C[x.next_in];)f.inflateReset(x),S=f.inflate(x,m);switch(S){case D:case o:case d:case L:return this.onEnd(S),this.ended=!0,!1}if(t=x.avail_out,x.next_out&&(0===x.avail_out||S===O))if("string"===this.options.to){let C=z.utf8border(x.output,x.next_out),M=x.next_out-C,f=z.buf2string(x.output,C);x.next_out=M,x.avail_out=T-M,M&&x.output.set(x.output.subarray(C,C+M),0),this.onData(f)}else this.onData(x.output.length===x.next_out?x.output:x.output.subarray(0,x.next_out));if(S!==U||0!==t){if(S===O)return S=f.inflateEnd(this.strm),this.onEnd(S),this.ended=!0,!0;if(0===x.avail_in)break}}return!0},t.prototype.onData=function(C){this.chunks.push(C)},t.prototype.onEnd=function(C){C===U&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=T.flattenChunks(this.chunks)),this.chunks=[],this.err=C,this.msg=this.strm.msg},C.exports.Inflate=t,C.exports.inflate=A,C.exports.inflateRaw=function(C,M){return(M=M||{}).raw=!0,A(C,M)},C.exports.ungzip=A,C.exports.constants=x(11630)},11637:C=>{"use strict";const M=(C,M)=>Object.prototype.hasOwnProperty.call(C,M);C.exports.assign=function(C){const x=Array.prototype.slice.call(arguments,1);for(;x.length;){const f=x.shift();if(f){if("object"!==typeof f)throw new TypeError(f+"must be non-object");for(const x in f)M(f,x)&&(C[x]=f[x])}}return C},C.exports.flattenChunks=C=>{let M=0;for(let f=0,T=C.length;f<T;f++)M+=C[f].length;const x=new Uint8Array(M);for(let f=0,T=0,z=C.length;f<z;f++){let M=C[f];x.set(M,T),T+=M.length}return x}},11642:C=>{"use strict";let M=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(f){M=!1}const x=new Uint8Array(256);for(let T=0;T<256;T++)x[T]=T>=252?6:T>=248?5:T>=240?4:T>=224?3:T>=192?2:1;x[254]=x[254]=1,C.exports.string2buf=C=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(C);let M,x,f,T,z,s=C.length,S=0;for(T=0;T<s;T++)x=C.charCodeAt(T),55296===(64512&x)&&T+1<s&&(f=C.charCodeAt(T+1),56320===(64512&f)&&(x=65536+(x-55296<<10)+(f-56320),T++)),S+=x<128?1:x<2048?2:x<65536?3:4;for(M=new Uint8Array(S),z=0,T=0;z<S;T++)x=C.charCodeAt(T),55296===(64512&x)&&T+1<s&&(f=C.charCodeAt(T+1),56320===(64512&f)&&(x=65536+(x-55296<<10)+(f-56320),T++)),x<128?M[z++]=x:x<2048?(M[z++]=192|x>>>6,M[z++]=128|63&x):x<65536?(M[z++]=224|x>>>12,M[z++]=128|x>>>6&63,M[z++]=128|63&x):(M[z++]=240|x>>>18,M[z++]=128|x>>>12&63,M[z++]=128|x>>>6&63,M[z++]=128|63&x);return M};C.exports.buf2string=(C,f)=>{const T=f||C.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(C.subarray(0,f));let z,s;const S=new Array(2*T);for(s=0,z=0;z<T;){let M=C[z++];if(M<128){S[s++]=M;continue}let f=x[M];if(f>4)S[s++]=65533,z+=f-1;else{for(M&=2===f?31:3===f?15:7;f>1&&z<T;)M=M<<6|63&C[z++],f--;f>1?S[s++]=65533:M<65536?S[s++]=M:(M-=65536,S[s++]=55296|M>>10&1023,S[s++]=56320|1023&M)}}return((C,x)=>{if(x<65534&&C.subarray&&M)return String.fromCharCode.apply(null,C.length===x?C:C.subarray(0,x));let f="";for(let M=0;M<x;M++)f+=String.fromCharCode(C[M]);return f})(S,s)},C.exports.utf8border=(C,M)=>{(M=M||C.length)>C.length&&(M=C.length);let f=M-1;for(;f>=0&&128===(192&C[f]);)f--;return f<0||0===f?M:f+x[C[f]]>M?f:M}},11611:C=>{"use strict";C.exports=(C,M,x,f)=>{let T=65535&C,z=C>>>16&65535,s=0;for(;0!==x;){s=x>2e3?2e3:x,x-=s;do{T=T+M[f++]|0,z=z+T|0}while(--s);T%=65521,z%=65521}return T|z<<16}},11630:C=>{"use strict";C.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},11620:C=>{"use strict";const M=new Uint32Array((()=>{let C,M=[];for(var x=0;x<256;x++){C=x;for(var f=0;f<8;f++)C=1&C?3988292384^C>>>1:C>>>1;M[x]=C}return M})());C.exports=(C,x,f,T)=>{const z=M,s=T+f;C^=-1;for(let M=T;M<s;M++)C=C>>>8^z[255&(C^x[M])];return~C}},11605:(C,M,x)=>{"use strict";const{_tr_init:f,_tr_stored_block:T,_tr_flush_block:z,_tr_tally:s,_tr_align:S}=x(11607),m=x(11611),Q=x(11620),V=x(11627),{Z_NO_FLUSH:y,Z_PARTIAL_FLUSH:U,Z_FULL_FLUSH:O,Z_FINISH:d,Z_BLOCK:D,Z_OK:o,Z_STREAM_END:L,Z_STREAM_ERROR:t,Z_DATA_ERROR:A,Z_BUF_ERROR:H,Z_DEFAULT_COMPRESSION:j,Z_FILTERED:b,Z_HUFFMAN_ONLY:R,Z_RLE:n,Z_FIXED:I,Z_DEFAULT_STRATEGY:X,Z_UNKNOWN:g,Z_DEFLATED:B}=x(11630),F=258,P=262,h=103,c=113,q=666,i=(C,M)=>(C.msg=V[M],M),Z=C=>(C<<1)-(C>4?9:0),E=C=>{let M=C.length;for(;--M>=0;)C[M]=0};let K=(C,M,x)=>(M<<C.hash_shift^x)&C.hash_mask;const G=C=>{const M=C.state;let x=M.pending;x>C.avail_out&&(x=C.avail_out),0!==x&&(C.output.set(M.pending_buf.subarray(M.pending_out,M.pending_out+x),C.next_out),C.next_out+=x,M.pending_out+=x,C.total_out+=x,C.avail_out-=x,M.pending-=x,0===M.pending&&(M.pending_out=0))},a=(C,M)=>{z(C,C.block_start>=0?C.block_start:-1,C.strstart-C.block_start,M),C.block_start=C.strstart,G(C.strm)},J=(C,M)=>{C.pending_buf[C.pending++]=M},N=(C,M)=>{C.pending_buf[C.pending++]=M>>>8&255,C.pending_buf[C.pending++]=255&M},k=(C,M,x,f)=>{let T=C.avail_in;return T>f&&(T=f),0===T?0:(C.avail_in-=T,M.set(C.input.subarray(C.next_in,C.next_in+T),x),1===C.state.wrap?C.adler=m(C.adler,M,T,x):2===C.state.wrap&&(C.adler=Q(C.adler,M,T,x)),C.next_in+=T,C.total_in+=T,T)},v=(C,M)=>{let x,f,T=C.max_chain_length,z=C.strstart,s=C.prev_length,S=C.nice_match;const m=C.strstart>C.w_size-P?C.strstart-(C.w_size-P):0,Q=C.window,V=C.w_mask,y=C.prev,U=C.strstart+F;let O=Q[z+s-1],d=Q[z+s];C.prev_length>=C.good_match&&(T>>=2),S>C.lookahead&&(S=C.lookahead);do{if(x=M,Q[x+s]===d&&Q[x+s-1]===O&&Q[x]===Q[z]&&Q[++x]===Q[z+1]){z+=2,x++;do{}while(Q[++z]===Q[++x]&&Q[++z]===Q[++x]&&Q[++z]===Q[++x]&&Q[++z]===Q[++x]&&Q[++z]===Q[++x]&&Q[++z]===Q[++x]&&Q[++z]===Q[++x]&&Q[++z]===Q[++x]&&z<U);if(f=F-(U-z),z=U-F,f>s){if(C.match_start=M,s=f,f>=S)break;O=Q[z+s-1],d=Q[z+s]}}}while((M=y[M&V])>m&&0!==--T);return s<=C.lookahead?s:C.lookahead},p=C=>{const M=C.w_size;let x,f,T,z,s;do{if(z=C.window_size-C.lookahead-C.strstart,C.strstart>=M+(M-P)){C.window.set(C.window.subarray(M,M+M),0),C.match_start-=M,C.strstart-=M,C.block_start-=M,f=C.hash_size,x=f;do{T=C.head[--x],C.head[x]=T>=M?T-M:0}while(--f);f=M,x=f;do{T=C.prev[--x],C.prev[x]=T>=M?T-M:0}while(--f);z+=M}if(0===C.strm.avail_in)break;if(f=k(C.strm,C.window,C.strstart+C.lookahead,z),C.lookahead+=f,C.lookahead+C.insert>=3)for(s=C.strstart-C.insert,C.ins_h=C.window[s],C.ins_h=K(C,C.ins_h,C.window[s+1]);C.insert&&(C.ins_h=K(C,C.ins_h,C.window[s+3-1]),C.prev[s&C.w_mask]=C.head[C.ins_h],C.head[C.ins_h]=s,s++,C.insert--,!(C.lookahead+C.insert<3)););}while(C.lookahead<P&&0!==C.strm.avail_in)},u=(C,M)=>{let x,f;for(;;){if(C.lookahead<P){if(p(C),C.lookahead<P&&M===y)return 1;if(0===C.lookahead)break}if(x=0,C.lookahead>=3&&(C.ins_h=K(C,C.ins_h,C.window[C.strstart+3-1]),x=C.prev[C.strstart&C.w_mask]=C.head[C.ins_h],C.head[C.ins_h]=C.strstart),0!==x&&C.strstart-x<=C.w_size-P&&(C.match_length=v(C,x)),C.match_length>=3)if(f=s(C,C.strstart-C.match_start,C.match_length-3),C.lookahead-=C.match_length,C.match_length<=C.max_lazy_match&&C.lookahead>=3){C.match_length--;do{C.strstart++,C.ins_h=K(C,C.ins_h,C.window[C.strstart+3-1]),x=C.prev[C.strstart&C.w_mask]=C.head[C.ins_h],C.head[C.ins_h]=C.strstart}while(0!==--C.match_length);C.strstart++}else C.strstart+=C.match_length,C.match_length=0,C.ins_h=C.window[C.strstart],C.ins_h=K(C,C.ins_h,C.window[C.strstart+1]);else f=s(C,0,C.window[C.strstart]),C.lookahead--,C.strstart++;if(f&&(a(C,!1),0===C.strm.avail_out))return 1}return C.insert=C.strstart<2?C.strstart:2,M===d?(a(C,!0),0===C.strm.avail_out?3:4):C.last_lit&&(a(C,!1),0===C.strm.avail_out)?1:2},Y=(C,M)=>{let x,f,T;for(;;){if(C.lookahead<P){if(p(C),C.lookahead<P&&M===y)return 1;if(0===C.lookahead)break}if(x=0,C.lookahead>=3&&(C.ins_h=K(C,C.ins_h,C.window[C.strstart+3-1]),x=C.prev[C.strstart&C.w_mask]=C.head[C.ins_h],C.head[C.ins_h]=C.strstart),C.prev_length=C.match_length,C.prev_match=C.match_start,C.match_length=2,0!==x&&C.prev_length<C.max_lazy_match&&C.strstart-x<=C.w_size-P&&(C.match_length=v(C,x),C.match_length<=5&&(C.strategy===b||3===C.match_length&&C.strstart-C.match_start>4096)&&(C.match_length=2)),C.prev_length>=3&&C.match_length<=C.prev_length){T=C.strstart+C.lookahead-3,f=s(C,C.strstart-1-C.prev_match,C.prev_length-3),C.lookahead-=C.prev_length-1,C.prev_length-=2;do{++C.strstart<=T&&(C.ins_h=K(C,C.ins_h,C.window[C.strstart+3-1]),x=C.prev[C.strstart&C.w_mask]=C.head[C.ins_h],C.head[C.ins_h]=C.strstart)}while(0!==--C.prev_length);if(C.match_available=0,C.match_length=2,C.strstart++,f&&(a(C,!1),0===C.strm.avail_out))return 1}else if(C.match_available){if(f=s(C,0,C.window[C.strstart-1]),f&&a(C,!1),C.strstart++,C.lookahead--,0===C.strm.avail_out)return 1}else C.match_available=1,C.strstart++,C.lookahead--}return C.match_available&&(f=s(C,0,C.window[C.strstart-1]),C.match_available=0),C.insert=C.strstart<2?C.strstart:2,M===d?(a(C,!0),0===C.strm.avail_out?3:4):C.last_lit&&(a(C,!1),0===C.strm.avail_out)?1:2};function W(C,M,x,f,T){this.good_length=C,this.max_lazy=M,this.nice_length=x,this.max_chain=f,this.func=T}const e=[new W(0,0,0,0,((C,M)=>{let x=65535;for(x>C.pending_buf_size-5&&(x=C.pending_buf_size-5);;){if(C.lookahead<=1){if(p(C),0===C.lookahead&&M===y)return 1;if(0===C.lookahead)break}C.strstart+=C.lookahead,C.lookahead=0;const f=C.block_start+x;if((0===C.strstart||C.strstart>=f)&&(C.lookahead=C.strstart-f,C.strstart=f,a(C,!1),0===C.strm.avail_out))return 1;if(C.strstart-C.block_start>=C.w_size-P&&(a(C,!1),0===C.strm.avail_out))return 1}return C.insert=0,M===d?(a(C,!0),0===C.strm.avail_out?3:4):(C.strstart>C.block_start&&(a(C,!1),C.strm.avail_out),1)})),new W(4,4,8,4,u),new W(4,5,16,8,u),new W(4,6,32,32,u),new W(4,4,16,16,Y),new W(8,16,32,32,Y),new W(8,16,128,128,Y),new W(8,32,128,256,Y),new W(32,128,258,1024,Y),new W(32,258,258,4096,Y)];function r(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=B,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),E(this.dyn_ltree),E(this.dyn_dtree),E(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),E(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),E(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const w=C=>{if(!C||!C.state)return i(C,t);C.total_in=C.total_out=0,C.data_type=g;const M=C.state;return M.pending=0,M.pending_out=0,M.wrap<0&&(M.wrap=-M.wrap),M.status=M.wrap?42:c,C.adler=2===M.wrap?0:1,M.last_flush=y,f(M),o},l=C=>{const M=w(C);var x;return M===o&&((x=C.state).window_size=2*x.w_size,E(x.head),x.max_lazy_match=e[x.level].max_lazy,x.good_match=e[x.level].good_length,x.nice_match=e[x.level].nice_length,x.max_chain_length=e[x.level].max_chain,x.strstart=0,x.block_start=0,x.lookahead=0,x.insert=0,x.match_length=x.prev_length=2,x.match_available=0,x.ins_h=0),M},CC=(C,M,x,f,T,z)=>{if(!C)return t;let s=1;if(M===j&&(M=6),f<0?(s=0,f=-f):f>15&&(s=2,f-=16),T<1||T>9||x!==B||f<8||f>15||M<0||M>9||z<0||z>I)return i(C,t);8===f&&(f=9);const S=new r;return C.state=S,S.strm=C,S.wrap=s,S.gzhead=null,S.w_bits=f,S.w_size=1<<S.w_bits,S.w_mask=S.w_size-1,S.hash_bits=T+7,S.hash_size=1<<S.hash_bits,S.hash_mask=S.hash_size-1,S.hash_shift=~~((S.hash_bits+3-1)/3),S.window=new Uint8Array(2*S.w_size),S.head=new Uint16Array(S.hash_size),S.prev=new Uint16Array(S.w_size),S.lit_bufsize=1<<T+6,S.pending_buf_size=4*S.lit_bufsize,S.pending_buf=new Uint8Array(S.pending_buf_size),S.d_buf=1*S.lit_bufsize,S.l_buf=3*S.lit_bufsize,S.level=M,S.strategy=z,S.method=x,l(C)};C.exports.deflateInit=(C,M)=>CC(C,M,B,15,8,X),C.exports.deflateInit2=CC,C.exports.deflateReset=l,C.exports.deflateResetKeep=w,C.exports.deflateSetHeader=(C,M)=>C&&C.state?2!==C.state.wrap?t:(C.state.gzhead=M,o):t,C.exports.deflate=(C,M)=>{let x,f;if(!C||!C.state||M>D||M<0)return C?i(C,t):t;const z=C.state;if(!C.output||!C.input&&0!==C.avail_in||z.status===q&&M!==d)return i(C,0===C.avail_out?H:t);z.strm=C;const m=z.last_flush;if(z.last_flush=M,42===z.status)if(2===z.wrap)C.adler=0,J(z,31),J(z,139),J(z,8),z.gzhead?(J(z,(z.gzhead.text?1:0)+(z.gzhead.hcrc?2:0)+(z.gzhead.extra?4:0)+(z.gzhead.name?8:0)+(z.gzhead.comment?16:0)),J(z,255&z.gzhead.time),J(z,z.gzhead.time>>8&255),J(z,z.gzhead.time>>16&255),J(z,z.gzhead.time>>24&255),J(z,9===z.level?2:z.strategy>=R||z.level<2?4:0),J(z,255&z.gzhead.os),z.gzhead.extra&&z.gzhead.extra.length&&(J(z,255&z.gzhead.extra.length),J(z,z.gzhead.extra.length>>8&255)),z.gzhead.hcrc&&(C.adler=Q(C.adler,z.pending_buf,z.pending,0)),z.gzindex=0,z.status=69):(J(z,0),J(z,0),J(z,0),J(z,0),J(z,0),J(z,9===z.level?2:z.strategy>=R||z.level<2?4:0),J(z,3),z.status=c);else{let M=B+(z.w_bits-8<<4)<<8,x=-1;x=z.strategy>=R||z.level<2?0:z.level<6?1:6===z.level?2:3,M|=x<<6,0!==z.strstart&&(M|=32),M+=31-M%31,z.status=c,N(z,M),0!==z.strstart&&(N(z,C.adler>>>16),N(z,65535&C.adler)),C.adler=1}if(69===z.status)if(z.gzhead.extra){for(x=z.pending;z.gzindex<(65535&z.gzhead.extra.length)&&(z.pending!==z.pending_buf_size||(z.gzhead.hcrc&&z.pending>x&&(C.adler=Q(C.adler,z.pending_buf,z.pending-x,x)),G(C),x=z.pending,z.pending!==z.pending_buf_size));)J(z,255&z.gzhead.extra[z.gzindex]),z.gzindex++;z.gzhead.hcrc&&z.pending>x&&(C.adler=Q(C.adler,z.pending_buf,z.pending-x,x)),z.gzindex===z.gzhead.extra.length&&(z.gzindex=0,z.status=73)}else z.status=73;if(73===z.status)if(z.gzhead.name){x=z.pending;do{if(z.pending===z.pending_buf_size&&(z.gzhead.hcrc&&z.pending>x&&(C.adler=Q(C.adler,z.pending_buf,z.pending-x,x)),G(C),x=z.pending,z.pending===z.pending_buf_size)){f=1;break}f=z.gzindex<z.gzhead.name.length?255&z.gzhead.name.charCodeAt(z.gzindex++):0,J(z,f)}while(0!==f);z.gzhead.hcrc&&z.pending>x&&(C.adler=Q(C.adler,z.pending_buf,z.pending-x,x)),0===f&&(z.gzindex=0,z.status=91)}else z.status=91;if(91===z.status)if(z.gzhead.comment){x=z.pending;do{if(z.pending===z.pending_buf_size&&(z.gzhead.hcrc&&z.pending>x&&(C.adler=Q(C.adler,z.pending_buf,z.pending-x,x)),G(C),x=z.pending,z.pending===z.pending_buf_size)){f=1;break}f=z.gzindex<z.gzhead.comment.length?255&z.gzhead.comment.charCodeAt(z.gzindex++):0,J(z,f)}while(0!==f);z.gzhead.hcrc&&z.pending>x&&(C.adler=Q(C.adler,z.pending_buf,z.pending-x,x)),0===f&&(z.status=h)}else z.status=h;if(z.status===h&&(z.gzhead.hcrc?(z.pending+2>z.pending_buf_size&&G(C),z.pending+2<=z.pending_buf_size&&(J(z,255&C.adler),J(z,C.adler>>8&255),C.adler=0,z.status=c)):z.status=c),0!==z.pending){if(G(C),0===C.avail_out)return z.last_flush=-1,o}else if(0===C.avail_in&&Z(M)<=Z(m)&&M!==d)return i(C,H);if(z.status===q&&0!==C.avail_in)return i(C,H);if(0!==C.avail_in||0!==z.lookahead||M!==y&&z.status!==q){let x=z.strategy===R?((C,M)=>{let x;for(;;){if(0===C.lookahead&&(p(C),0===C.lookahead)){if(M===y)return 1;break}if(C.match_length=0,x=s(C,0,C.window[C.strstart]),C.lookahead--,C.strstart++,x&&(a(C,!1),0===C.strm.avail_out))return 1}return C.insert=0,M===d?(a(C,!0),0===C.strm.avail_out?3:4):C.last_lit&&(a(C,!1),0===C.strm.avail_out)?1:2})(z,M):z.strategy===n?((C,M)=>{let x,f,T,z;const S=C.window;for(;;){if(C.lookahead<=F){if(p(C),C.lookahead<=F&&M===y)return 1;if(0===C.lookahead)break}if(C.match_length=0,C.lookahead>=3&&C.strstart>0&&(T=C.strstart-1,f=S[T],f===S[++T]&&f===S[++T]&&f===S[++T])){z=C.strstart+F;do{}while(f===S[++T]&&f===S[++T]&&f===S[++T]&&f===S[++T]&&f===S[++T]&&f===S[++T]&&f===S[++T]&&f===S[++T]&&T<z);C.match_length=F-(z-T),C.match_length>C.lookahead&&(C.match_length=C.lookahead)}if(C.match_length>=3?(x=s(C,1,C.match_length-3),C.lookahead-=C.match_length,C.strstart+=C.match_length,C.match_length=0):(x=s(C,0,C.window[C.strstart]),C.lookahead--,C.strstart++),x&&(a(C,!1),0===C.strm.avail_out))return 1}return C.insert=0,M===d?(a(C,!0),0===C.strm.avail_out?3:4):C.last_lit&&(a(C,!1),0===C.strm.avail_out)?1:2})(z,M):e[z.level].func(z,M);if(3!==x&&4!==x||(z.status=q),1===x||3===x)return 0===C.avail_out&&(z.last_flush=-1),o;if(2===x&&(M===U?S(z):M!==D&&(T(z,0,0,!1),M===O&&(E(z.head),0===z.lookahead&&(z.strstart=0,z.block_start=0,z.insert=0))),G(C),0===C.avail_out))return z.last_flush=-1,o}return M!==d?o:z.wrap<=0?L:(2===z.wrap?(J(z,255&C.adler),J(z,C.adler>>8&255),J(z,C.adler>>16&255),J(z,C.adler>>24&255),J(z,255&C.total_in),J(z,C.total_in>>8&255),J(z,C.total_in>>16&255),J(z,C.total_in>>24&255)):(N(z,C.adler>>>16),N(z,65535&C.adler)),G(C),z.wrap>0&&(z.wrap=-z.wrap),0!==z.pending?o:L)},C.exports.deflateEnd=C=>{if(!C||!C.state)return t;const M=C.state.status;return 42!==M&&69!==M&&73!==M&&91!==M&&M!==h&&M!==c&&M!==q?i(C,t):(C.state=null,M===c?i(C,A):o)},C.exports.deflateSetDictionary=(C,M)=>{let x=M.length;if(!C||!C.state)return t;const f=C.state,T=f.wrap;if(2===T||1===T&&42!==f.status||f.lookahead)return t;if(1===T&&(C.adler=m(C.adler,M,x,0)),f.wrap=0,x>=f.w_size){0===T&&(E(f.head),f.strstart=0,f.block_start=0,f.insert=0);let C=new Uint8Array(f.w_size);C.set(M.subarray(x-f.w_size,x),0),M=C,x=f.w_size}const z=C.avail_in,s=C.next_in,S=C.input;for(C.avail_in=x,C.next_in=0,C.input=M,p(f);f.lookahead>=3;){let C=f.strstart,M=f.lookahead-2;do{f.ins_h=K(f,f.ins_h,f.window[C+3-1]),f.prev[C&f.w_mask]=f.head[f.ins_h],f.head[f.ins_h]=C,C++}while(--M);f.strstart=C,f.lookahead=2,p(f)}return f.strstart+=f.lookahead,f.block_start=f.strstart,f.insert=f.lookahead,f.lookahead=0,f.match_length=f.prev_length=2,f.match_available=0,C.next_in=s,C.input=S,C.avail_in=z,f.wrap=T,o},C.exports.deflateInfo="pako deflate (from Nodeca project)"},11678:C=>{"use strict";C.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},11668:C=>{"use strict";C.exports=function(C,M){let x,f,T,z,s,S,m,Q,V,y,U,O,d,D,o,L,t,A,H,j,b,R,n,I;const X=C.state;x=C.next_in,n=C.input,f=x+(C.avail_in-5),T=C.next_out,I=C.output,z=T-(M-C.avail_out),s=T+(C.avail_out-257),S=X.dmax,m=X.wsize,Q=X.whave,V=X.wnext,y=X.window,U=X.hold,O=X.bits,d=X.lencode,D=X.distcode,o=(1<<X.lenbits)-1,L=(1<<X.distbits)-1;C:do{O<15&&(U+=n[x++]<<O,O+=8,U+=n[x++]<<O,O+=8),t=d[U&o];M:for(;;){if(A=t>>>24,U>>>=A,O-=A,A=t>>>16&255,0===A)I[T++]=65535&t;else{if(!(16&A)){if(0===(64&A)){t=d[(65535&t)+(U&(1<<A)-1)];continue M}if(32&A){X.mode=12;break C}C.msg="invalid literal/length code",X.mode=30;break C}H=65535&t,A&=15,A&&(O<A&&(U+=n[x++]<<O,O+=8),H+=U&(1<<A)-1,U>>>=A,O-=A),O<15&&(U+=n[x++]<<O,O+=8,U+=n[x++]<<O,O+=8),t=D[U&L];x:for(;;){if(A=t>>>24,U>>>=A,O-=A,A=t>>>16&255,!(16&A)){if(0===(64&A)){t=D[(65535&t)+(U&(1<<A)-1)];continue x}C.msg="invalid distance code",X.mode=30;break C}if(j=65535&t,A&=15,O<A&&(U+=n[x++]<<O,O+=8,O<A&&(U+=n[x++]<<O,O+=8)),j+=U&(1<<A)-1,j>S){C.msg="invalid distance too far back",X.mode=30;break C}if(U>>>=A,O-=A,A=T-z,j>A){if(A=j-A,A>Q&&X.sane){C.msg="invalid distance too far back",X.mode=30;break C}if(b=0,R=y,0===V){if(b+=m-A,A<H){H-=A;do{I[T++]=y[b++]}while(--A);b=T-j,R=I}}else if(V<A){if(b+=m+V-A,A-=V,A<H){H-=A;do{I[T++]=y[b++]}while(--A);if(b=0,V<H){A=V,H-=A;do{I[T++]=y[b++]}while(--A);b=T-j,R=I}}}else if(b+=V-A,A<H){H-=A;do{I[T++]=y[b++]}while(--A);b=T-j,R=I}for(;H>2;)I[T++]=R[b++],I[T++]=R[b++],I[T++]=R[b++],H-=3;H&&(I[T++]=R[b++],H>1&&(I[T++]=R[b++]))}else{b=T-j;do{I[T++]=I[b++],I[T++]=I[b++],I[T++]=I[b++],H-=3}while(H>2);H&&(I[T++]=I[b++],H>1&&(I[T++]=I[b++]))}break}}break}}while(x<f&&T<s);H=O>>3,x-=H,O-=H<<3,U&=(1<<O)-1,C.next_in=x,C.next_out=T,C.avail_in=x<f?f-x+5:5-(x-f),C.avail_out=T<s?s-T+257:257-(T-s),X.hold=U,X.bits=O}},11663:(C,M,x)=>{"use strict";const f=x(11611),T=x(11620),z=x(11668),s=x(11670),{Z_FINISH:S,Z_BLOCK:m,Z_TREES:Q,Z_OK:V,Z_STREAM_END:y,Z_NEED_DICT:U,Z_STREAM_ERROR:O,Z_DATA_ERROR:d,Z_MEM_ERROR:D,Z_BUF_ERROR:o,Z_DEFLATED:L}=x(11630),t=12,A=30,H=C=>(C>>>24&255)+(C>>>8&65280)+((65280&C)<<8)+((255&C)<<24);function j(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const b=C=>{if(!C||!C.state)return O;const M=C.state;return C.total_in=C.total_out=M.total=0,C.msg="",M.wrap&&(C.adler=1&M.wrap),M.mode=1,M.last=0,M.havedict=0,M.dmax=32768,M.head=null,M.hold=0,M.bits=0,M.lencode=M.lendyn=new Int32Array(852),M.distcode=M.distdyn=new Int32Array(592),M.sane=1,M.back=-1,V},R=C=>{if(!C||!C.state)return O;const M=C.state;return M.wsize=0,M.whave=0,M.wnext=0,b(C)},n=(C,M)=>{let x;if(!C||!C.state)return O;const f=C.state;return M<0?(x=0,M=-M):(x=1+(M>>4),M<48&&(M&=15)),M&&(M<8||M>15)?O:(null!==f.window&&f.wbits!==M&&(f.window=null),f.wrap=x,f.wbits=M,R(C))},I=(C,M)=>{if(!C)return O;const x=new j;C.state=x,x.window=null;const f=n(C,M);return f!==V&&(C.state=null),f};let X,g,B=!0;const F=C=>{if(B){X=new Int32Array(512),g=new Int32Array(32);let M=0;for(;M<144;)C.lens[M++]=8;for(;M<256;)C.lens[M++]=9;for(;M<280;)C.lens[M++]=7;for(;M<288;)C.lens[M++]=8;for(s(1,C.lens,0,288,X,0,C.work,{bits:9}),M=0;M<32;)C.lens[M++]=5;s(2,C.lens,0,32,g,0,C.work,{bits:5}),B=!1}C.lencode=X,C.lenbits=9,C.distcode=g,C.distbits=5},P=(C,M,x,f)=>{let T;const z=C.state;return null===z.window&&(z.wsize=1<<z.wbits,z.wnext=0,z.whave=0,z.window=new Uint8Array(z.wsize)),f>=z.wsize?(z.window.set(M.subarray(x-z.wsize,x),0),z.wnext=0,z.whave=z.wsize):(T=z.wsize-z.wnext,T>f&&(T=f),z.window.set(M.subarray(x-f,x-f+T),z.wnext),(f-=T)?(z.window.set(M.subarray(x-f,x),0),z.wnext=f,z.whave=z.wsize):(z.wnext+=T,z.wnext===z.wsize&&(z.wnext=0),z.whave<z.wsize&&(z.whave+=T))),0};C.exports.inflateReset=R,C.exports.inflateReset2=n,C.exports.inflateResetKeep=b,C.exports.inflateInit=C=>I(C,15),C.exports.inflateInit2=I,C.exports.inflate=(C,M)=>{let x,j,b,R,n,I,X,g,B,h,c,q,i,Z,E,K,G,a,J,N,k,v,p=0;const u=new Uint8Array(4);let Y,W;const e=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!C||!C.state||!C.output||!C.input&&0!==C.avail_in)return O;x=C.state,x.mode===t&&(x.mode=13),n=C.next_out,b=C.output,X=C.avail_out,R=C.next_in,j=C.input,I=C.avail_in,g=x.hold,B=x.bits,h=I,c=X,v=V;C:for(;;)switch(x.mode){case 1:if(0===x.wrap){x.mode=13;break}for(;B<16;){if(0===I)break C;I--,g+=j[R++]<<B,B+=8}if(2&x.wrap&&35615===g){x.check=0,u[0]=255&g,u[1]=g>>>8&255,x.check=T(x.check,u,2,0),g=0,B=0,x.mode=2;break}if(x.flags=0,x.head&&(x.head.done=!1),!(1&x.wrap)||(((255&g)<<8)+(g>>8))%31){C.msg="incorrect header check",x.mode=A;break}if((15&g)!==L){C.msg="unknown compression method",x.mode=A;break}if(g>>>=4,B-=4,k=8+(15&g),0===x.wbits)x.wbits=k;else if(k>x.wbits){C.msg="invalid window size",x.mode=A;break}x.dmax=1<<x.wbits,C.adler=x.check=1,x.mode=512&g?10:t,g=0,B=0;break;case 2:for(;B<16;){if(0===I)break C;I--,g+=j[R++]<<B,B+=8}if(x.flags=g,(255&x.flags)!==L){C.msg="unknown compression method",x.mode=A;break}if(57344&x.flags){C.msg="unknown header flags set",x.mode=A;break}x.head&&(x.head.text=g>>8&1),512&x.flags&&(u[0]=255&g,u[1]=g>>>8&255,x.check=T(x.check,u,2,0)),g=0,B=0,x.mode=3;case 3:for(;B<32;){if(0===I)break C;I--,g+=j[R++]<<B,B+=8}x.head&&(x.head.time=g),512&x.flags&&(u[0]=255&g,u[1]=g>>>8&255,u[2]=g>>>16&255,u[3]=g>>>24&255,x.check=T(x.check,u,4,0)),g=0,B=0,x.mode=4;case 4:for(;B<16;){if(0===I)break C;I--,g+=j[R++]<<B,B+=8}x.head&&(x.head.xflags=255&g,x.head.os=g>>8),512&x.flags&&(u[0]=255&g,u[1]=g>>>8&255,x.check=T(x.check,u,2,0)),g=0,B=0,x.mode=5;case 5:if(1024&x.flags){for(;B<16;){if(0===I)break C;I--,g+=j[R++]<<B,B+=8}x.length=g,x.head&&(x.head.extra_len=g),512&x.flags&&(u[0]=255&g,u[1]=g>>>8&255,x.check=T(x.check,u,2,0)),g=0,B=0}else x.head&&(x.head.extra=null);x.mode=6;case 6:if(1024&x.flags&&(q=x.length,q>I&&(q=I),q&&(x.head&&(k=x.head.extra_len-x.length,x.head.extra||(x.head.extra=new Uint8Array(x.head.extra_len)),x.head.extra.set(j.subarray(R,R+q),k)),512&x.flags&&(x.check=T(x.check,j,q,R)),I-=q,R+=q,x.length-=q),x.length))break C;x.length=0,x.mode=7;case 7:if(2048&x.flags){if(0===I)break C;q=0;do{k=j[R+q++],x.head&&k&&x.length<65536&&(x.head.name+=String.fromCharCode(k))}while(k&&q<I);if(512&x.flags&&(x.check=T(x.check,j,q,R)),I-=q,R+=q,k)break C}else x.head&&(x.head.name=null);x.length=0,x.mode=8;case 8:if(4096&x.flags){if(0===I)break C;q=0;do{k=j[R+q++],x.head&&k&&x.length<65536&&(x.head.comment+=String.fromCharCode(k))}while(k&&q<I);if(512&x.flags&&(x.check=T(x.check,j,q,R)),I-=q,R+=q,k)break C}else x.head&&(x.head.comment=null);x.mode=9;case 9:if(512&x.flags){for(;B<16;){if(0===I)break C;I--,g+=j[R++]<<B,B+=8}if(g!==(65535&x.check)){C.msg="header crc mismatch",x.mode=A;break}g=0,B=0}x.head&&(x.head.hcrc=x.flags>>9&1,x.head.done=!0),C.adler=x.check=0,x.mode=t;break;case 10:for(;B<32;){if(0===I)break C;I--,g+=j[R++]<<B,B+=8}C.adler=x.check=H(g),g=0,B=0,x.mode=11;case 11:if(0===x.havedict)return C.next_out=n,C.avail_out=X,C.next_in=R,C.avail_in=I,x.hold=g,x.bits=B,U;C.adler=x.check=1,x.mode=t;case t:if(M===m||M===Q)break C;case 13:if(x.last){g>>>=7&B,B-=7&B,x.mode=27;break}for(;B<3;){if(0===I)break C;I--,g+=j[R++]<<B,B+=8}switch(x.last=1&g,g>>>=1,B-=1,3&g){case 0:x.mode=14;break;case 1:if(F(x),x.mode=20,M===Q){g>>>=2,B-=2;break C}break;case 2:x.mode=17;break;case 3:C.msg="invalid block type",x.mode=A}g>>>=2,B-=2;break;case 14:for(g>>>=7&B,B-=7&B;B<32;){if(0===I)break C;I--,g+=j[R++]<<B,B+=8}if((65535&g)!==(g>>>16^65535)){C.msg="invalid stored block lengths",x.mode=A;break}if(x.length=65535&g,g=0,B=0,x.mode=15,M===Q)break C;case 15:x.mode=16;case 16:if(q=x.length,q){if(q>I&&(q=I),q>X&&(q=X),0===q)break C;b.set(j.subarray(R,R+q),n),I-=q,R+=q,X-=q,n+=q,x.length-=q;break}x.mode=t;break;case 17:for(;B<14;){if(0===I)break C;I--,g+=j[R++]<<B,B+=8}if(x.nlen=257+(31&g),g>>>=5,B-=5,x.ndist=1+(31&g),g>>>=5,B-=5,x.ncode=4+(15&g),g>>>=4,B-=4,x.nlen>286||x.ndist>30){C.msg="too many length or distance symbols",x.mode=A;break}x.have=0,x.mode=18;case 18:for(;x.have<x.ncode;){for(;B<3;){if(0===I)break C;I--,g+=j[R++]<<B,B+=8}x.lens[e[x.have++]]=7&g,g>>>=3,B-=3}for(;x.have<19;)x.lens[e[x.have++]]=0;if(x.lencode=x.lendyn,x.lenbits=7,Y={bits:x.lenbits},v=s(0,x.lens,0,19,x.lencode,0,x.work,Y),x.lenbits=Y.bits,v){C.msg="invalid code lengths set",x.mode=A;break}x.have=0,x.mode=19;case 19:for(;x.have<x.nlen+x.ndist;){for(;p=x.lencode[g&(1<<x.lenbits)-1],E=p>>>24,K=p>>>16&255,G=65535&p,!(E<=B);){if(0===I)break C;I--,g+=j[R++]<<B,B+=8}if(G<16)g>>>=E,B-=E,x.lens[x.have++]=G;else{if(16===G){for(W=E+2;B<W;){if(0===I)break C;I--,g+=j[R++]<<B,B+=8}if(g>>>=E,B-=E,0===x.have){C.msg="invalid bit length repeat",x.mode=A;break}k=x.lens[x.have-1],q=3+(3&g),g>>>=2,B-=2}else if(17===G){for(W=E+3;B<W;){if(0===I)break C;I--,g+=j[R++]<<B,B+=8}g>>>=E,B-=E,k=0,q=3+(7&g),g>>>=3,B-=3}else{for(W=E+7;B<W;){if(0===I)break C;I--,g+=j[R++]<<B,B+=8}g>>>=E,B-=E,k=0,q=11+(127&g),g>>>=7,B-=7}if(x.have+q>x.nlen+x.ndist){C.msg="invalid bit length repeat",x.mode=A;break}for(;q--;)x.lens[x.have++]=k}}if(x.mode===A)break;if(0===x.lens[256]){C.msg="invalid code -- missing end-of-block",x.mode=A;break}if(x.lenbits=9,Y={bits:x.lenbits},v=s(1,x.lens,0,x.nlen,x.lencode,0,x.work,Y),x.lenbits=Y.bits,v){C.msg="invalid literal/lengths set",x.mode=A;break}if(x.distbits=6,x.distcode=x.distdyn,Y={bits:x.distbits},v=s(2,x.lens,x.nlen,x.ndist,x.distcode,0,x.work,Y),x.distbits=Y.bits,v){C.msg="invalid distances set",x.mode=A;break}if(x.mode=20,M===Q)break C;case 20:x.mode=21;case 21:if(I>=6&&X>=258){C.next_out=n,C.avail_out=X,C.next_in=R,C.avail_in=I,x.hold=g,x.bits=B,z(C,c),n=C.next_out,b=C.output,X=C.avail_out,R=C.next_in,j=C.input,I=C.avail_in,g=x.hold,B=x.bits,x.mode===t&&(x.back=-1);break}for(x.back=0;p=x.lencode[g&(1<<x.lenbits)-1],E=p>>>24,K=p>>>16&255,G=65535&p,!(E<=B);){if(0===I)break C;I--,g+=j[R++]<<B,B+=8}if(K&&0===(240&K)){for(a=E,J=K,N=G;p=x.lencode[N+((g&(1<<a+J)-1)>>a)],E=p>>>24,K=p>>>16&255,G=65535&p,!(a+E<=B);){if(0===I)break C;I--,g+=j[R++]<<B,B+=8}g>>>=a,B-=a,x.back+=a}if(g>>>=E,B-=E,x.back+=E,x.length=G,0===K){x.mode=26;break}if(32&K){x.back=-1,x.mode=t;break}if(64&K){C.msg="invalid literal/length code",x.mode=A;break}x.extra=15&K,x.mode=22;case 22:if(x.extra){for(W=x.extra;B<W;){if(0===I)break C;I--,g+=j[R++]<<B,B+=8}x.length+=g&(1<<x.extra)-1,g>>>=x.extra,B-=x.extra,x.back+=x.extra}x.was=x.length,x.mode=23;case 23:for(;p=x.distcode[g&(1<<x.distbits)-1],E=p>>>24,K=p>>>16&255,G=65535&p,!(E<=B);){if(0===I)break C;I--,g+=j[R++]<<B,B+=8}if(0===(240&K)){for(a=E,J=K,N=G;p=x.distcode[N+((g&(1<<a+J)-1)>>a)],E=p>>>24,K=p>>>16&255,G=65535&p,!(a+E<=B);){if(0===I)break C;I--,g+=j[R++]<<B,B+=8}g>>>=a,B-=a,x.back+=a}if(g>>>=E,B-=E,x.back+=E,64&K){C.msg="invalid distance code",x.mode=A;break}x.offset=G,x.extra=15&K,x.mode=24;case 24:if(x.extra){for(W=x.extra;B<W;){if(0===I)break C;I--,g+=j[R++]<<B,B+=8}x.offset+=g&(1<<x.extra)-1,g>>>=x.extra,B-=x.extra,x.back+=x.extra}if(x.offset>x.dmax){C.msg="invalid distance too far back",x.mode=A;break}x.mode=25;case 25:if(0===X)break C;if(q=c-X,x.offset>q){if(q=x.offset-q,q>x.whave&&x.sane){C.msg="invalid distance too far back",x.mode=A;break}q>x.wnext?(q-=x.wnext,i=x.wsize-q):i=x.wnext-q,q>x.length&&(q=x.length),Z=x.window}else Z=b,i=n-x.offset,q=x.length;q>X&&(q=X),X-=q,x.length-=q;do{b[n++]=Z[i++]}while(--q);0===x.length&&(x.mode=21);break;case 26:if(0===X)break C;b[n++]=x.length,X--,x.mode=21;break;case 27:if(x.wrap){for(;B<32;){if(0===I)break C;I--,g|=j[R++]<<B,B+=8}if(c-=X,C.total_out+=c,x.total+=c,c&&(C.adler=x.check=x.flags?T(x.check,b,c,n-c):f(x.check,b,c,n-c)),c=X,(x.flags?g:H(g))!==x.check){C.msg="incorrect data check",x.mode=A;break}g=0,B=0}x.mode=28;case 28:if(x.wrap&&x.flags){for(;B<32;){if(0===I)break C;I--,g+=j[R++]<<B,B+=8}if(g!==(4294967295&x.total)){C.msg="incorrect length check",x.mode=A;break}g=0,B=0}x.mode=29;case 29:v=y;break C;case A:v=d;break C;case 31:return D;default:return O}return C.next_out=n,C.avail_out=X,C.next_in=R,C.avail_in=I,x.hold=g,x.bits=B,(x.wsize||c!==C.avail_out&&x.mode<A&&(x.mode<27||M!==S))&&P(C,C.output,C.next_out,c-C.avail_out)?(x.mode=31,D):(h-=C.avail_in,c-=C.avail_out,C.total_in+=h,C.total_out+=c,x.total+=c,x.wrap&&c&&(C.adler=x.check=x.flags?T(x.check,b,c,C.next_out-c):f(x.check,b,c,C.next_out-c)),C.data_type=x.bits+(x.last?64:0)+(x.mode===t?128:0)+(20===x.mode||15===x.mode?256:0),(0===h&&0===c||M===S)&&v===V&&(v=o),v)},C.exports.inflateEnd=C=>{if(!C||!C.state)return O;let M=C.state;return M.window&&(M.window=null),C.state=null,V},C.exports.inflateGetHeader=(C,M)=>{if(!C||!C.state)return O;const x=C.state;return 0===(2&x.wrap)?O:(x.head=M,M.done=!1,V)},C.exports.inflateSetDictionary=(C,M)=>{const x=M.length;let T,z,s;return C&&C.state?(T=C.state,0!==T.wrap&&11!==T.mode?O:11===T.mode&&(z=1,z=f(z,M,x,0),z!==T.check)?d:(s=P(C,M,x,x),s?(T.mode=31,D):(T.havedict=1,V))):O},C.exports.inflateInfo="pako inflate (from Nodeca project)"},11670:C=>{"use strict";const M=15,x=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),f=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),T=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),z=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);C.exports=(C,s,S,m,Q,V,y,U)=>{const O=U.bits;let d,D,o,L,t,A,H=0,j=0,b=0,R=0,n=0,I=0,X=0,g=0,B=0,F=0,P=null,h=0;const c=new Uint16Array(16),q=new Uint16Array(16);let i,Z,E,K=null,G=0;for(H=0;H<=M;H++)c[H]=0;for(j=0;j<m;j++)c[s[S+j]]++;for(n=O,R=M;R>=1&&0===c[R];R--);if(n>R&&(n=R),0===R)return Q[V++]=20971520,Q[V++]=20971520,U.bits=1,0;for(b=1;b<R&&0===c[b];b++);for(n<b&&(n=b),g=1,H=1;H<=M;H++)if(g<<=1,g-=c[H],g<0)return-1;if(g>0&&(0===C||1!==R))return-1;for(q[1]=0,H=1;H<M;H++)q[H+1]=q[H]+c[H];for(j=0;j<m;j++)0!==s[S+j]&&(y[q[s[S+j]]++]=j);if(0===C?(P=K=y,A=19):1===C?(P=x,h-=257,K=f,G-=257,A=256):(P=T,K=z,A=-1),F=0,j=0,H=b,t=V,I=n,X=0,o=-1,B=1<<n,L=B-1,1===C&&B>852||2===C&&B>592)return 1;for(;;){i=H-X,y[j]<A?(Z=0,E=y[j]):y[j]>A?(Z=K[G+y[j]],E=P[h+y[j]]):(Z=96,E=0),d=1<<H-X,D=1<<I,b=D;do{D-=d,Q[t+(F>>X)+D]=i<<24|Z<<16|E}while(0!==D);for(d=1<<H-1;F&d;)d>>=1;if(0!==d?(F&=d-1,F+=d):F=0,j++,0===--c[H]){if(H===R)break;H=s[S+y[j]]}if(H>n&&(F&L)!==o){for(0===X&&(X=n),t+=b,I=H-X,g=1<<I;I+X<R&&(g-=c[I+X],!(g<=0));)I++,g<<=1;if(B+=1<<I,1===C&&B>852||2===C&&B>592)return 1;o=F&L,Q[o]=n<<24|I<<16|t-V}}return 0!==F&&(Q[t+F]=H-X<<24|64<<16),U.bits=n,0}},11627:C=>{"use strict";C.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},11607:C=>{"use strict";function M(C){let M=C.length;for(;--M>=0;)C[M]=0}const x=256,f=286,T=30,z=15,s=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),S=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),m=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Q=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),V=new Array(576);M(V);const y=new Array(60);M(y);const U=new Array(512);M(U);const O=new Array(256);M(O);const d=new Array(29);M(d);const D=new Array(T);function o(C,M,x,f,T){this.static_tree=C,this.extra_bits=M,this.extra_base=x,this.elems=f,this.max_length=T,this.has_stree=C&&C.length}let L,t,A;function H(C,M){this.dyn_tree=C,this.max_code=0,this.stat_desc=M}M(D);const j=C=>C<256?U[C]:U[256+(C>>>7)],b=(C,M)=>{C.pending_buf[C.pending++]=255&M,C.pending_buf[C.pending++]=M>>>8&255},R=(C,M,x)=>{C.bi_valid>16-x?(C.bi_buf|=M<<C.bi_valid&65535,b(C,C.bi_buf),C.bi_buf=M>>16-C.bi_valid,C.bi_valid+=x-16):(C.bi_buf|=M<<C.bi_valid&65535,C.bi_valid+=x)},n=(C,M,x)=>{R(C,x[2*M],x[2*M+1])},I=(C,M)=>{let x=0;do{x|=1&C,C>>>=1,x<<=1}while(--M>0);return x>>>1},X=(C,M,x)=>{const f=new Array(16);let T,s,S=0;for(T=1;T<=z;T++)f[T]=S=S+x[T-1]<<1;for(s=0;s<=M;s++){let M=C[2*s+1];0!==M&&(C[2*s]=I(f[M]++,M))}},g=C=>{let M;for(M=0;M<f;M++)C.dyn_ltree[2*M]=0;for(M=0;M<T;M++)C.dyn_dtree[2*M]=0;for(M=0;M<19;M++)C.bl_tree[2*M]=0;C.dyn_ltree[512]=1,C.opt_len=C.static_len=0,C.last_lit=C.matches=0},B=C=>{C.bi_valid>8?b(C,C.bi_buf):C.bi_valid>0&&(C.pending_buf[C.pending++]=C.bi_buf),C.bi_buf=0,C.bi_valid=0},F=(C,M,x,f)=>{const T=2*M,z=2*x;return C[T]<C[z]||C[T]===C[z]&&f[M]<=f[x]},P=(C,M,x)=>{const f=C.heap[x];let T=x<<1;for(;T<=C.heap_len&&(T<C.heap_len&&F(M,C.heap[T+1],C.heap[T],C.depth)&&T++,!F(M,f,C.heap[T],C.depth));)C.heap[x]=C.heap[T],x=T,T<<=1;C.heap[x]=f},h=(C,M,f)=>{let T,z,m,Q,V=0;if(0!==C.last_lit)do{T=C.pending_buf[C.d_buf+2*V]<<8|C.pending_buf[C.d_buf+2*V+1],z=C.pending_buf[C.l_buf+V],V++,0===T?n(C,z,M):(m=O[z],n(C,m+x+1,M),Q=s[m],0!==Q&&(z-=d[m],R(C,z,Q)),T--,m=j(T),n(C,m,f),Q=S[m],0!==Q&&(T-=D[m],R(C,T,Q)))}while(V<C.last_lit);n(C,256,M)},c=(C,M)=>{const x=M.dyn_tree,f=M.stat_desc.static_tree,T=M.stat_desc.has_stree,s=M.stat_desc.elems;let S,m,Q,V=-1;for(C.heap_len=0,C.heap_max=573,S=0;S<s;S++)0!==x[2*S]?(C.heap[++C.heap_len]=V=S,C.depth[S]=0):x[2*S+1]=0;for(;C.heap_len<2;)Q=C.heap[++C.heap_len]=V<2?++V:0,x[2*Q]=1,C.depth[Q]=0,C.opt_len--,T&&(C.static_len-=f[2*Q+1]);for(M.max_code=V,S=C.heap_len>>1;S>=1;S--)P(C,x,S);Q=s;do{S=C.heap[1],C.heap[1]=C.heap[C.heap_len--],P(C,x,1),m=C.heap[1],C.heap[--C.heap_max]=S,C.heap[--C.heap_max]=m,x[2*Q]=x[2*S]+x[2*m],C.depth[Q]=(C.depth[S]>=C.depth[m]?C.depth[S]:C.depth[m])+1,x[2*S+1]=x[2*m+1]=Q,C.heap[1]=Q++,P(C,x,1)}while(C.heap_len>=2);C.heap[--C.heap_max]=C.heap[1],((C,M)=>{const x=M.dyn_tree,f=M.max_code,T=M.stat_desc.static_tree,s=M.stat_desc.has_stree,S=M.stat_desc.extra_bits,m=M.stat_desc.extra_base,Q=M.stat_desc.max_length;let V,y,U,O,d,D,o=0;for(O=0;O<=z;O++)C.bl_count[O]=0;for(x[2*C.heap[C.heap_max]+1]=0,V=C.heap_max+1;V<573;V++)y=C.heap[V],O=x[2*x[2*y+1]+1]+1,O>Q&&(O=Q,o++),x[2*y+1]=O,y>f||(C.bl_count[O]++,d=0,y>=m&&(d=S[y-m]),D=x[2*y],C.opt_len+=D*(O+d),s&&(C.static_len+=D*(T[2*y+1]+d)));if(0!==o){do{for(O=Q-1;0===C.bl_count[O];)O--;C.bl_count[O]--,C.bl_count[O+1]+=2,C.bl_count[Q]--,o-=2}while(o>0);for(O=Q;0!==O;O--)for(y=C.bl_count[O];0!==y;)U=C.heap[--V],U>f||(x[2*U+1]!==O&&(C.opt_len+=(O-x[2*U+1])*x[2*U],x[2*U+1]=O),y--)}})(C,M),X(x,V,C.bl_count)},q=(C,M,x)=>{let f,T,z=-1,s=M[1],S=0,m=7,Q=4;for(0===s&&(m=138,Q=3),M[2*(x+1)+1]=65535,f=0;f<=x;f++)T=s,s=M[2*(f+1)+1],++S<m&&T===s||(S<Q?C.bl_tree[2*T]+=S:0!==T?(T!==z&&C.bl_tree[2*T]++,C.bl_tree[32]++):S<=10?C.bl_tree[34]++:C.bl_tree[36]++,S=0,z=T,0===s?(m=138,Q=3):T===s?(m=6,Q=3):(m=7,Q=4))},i=(C,M,x)=>{let f,T,z=-1,s=M[1],S=0,m=7,Q=4;for(0===s&&(m=138,Q=3),f=0;f<=x;f++)if(T=s,s=M[2*(f+1)+1],!(++S<m&&T===s)){if(S<Q)do{n(C,T,C.bl_tree)}while(0!==--S);else 0!==T?(T!==z&&(n(C,T,C.bl_tree),S--),n(C,16,C.bl_tree),R(C,S-3,2)):S<=10?(n(C,17,C.bl_tree),R(C,S-3,3)):(n(C,18,C.bl_tree),R(C,S-11,7));S=0,z=T,0===s?(m=138,Q=3):T===s?(m=6,Q=3):(m=7,Q=4)}};let Z=!1;const E=(C,M,x,f)=>{R(C,0+(f?1:0),3),((C,M,x,f)=>{B(C),f&&(b(C,x),b(C,~x)),C.pending_buf.set(C.window.subarray(M,M+x),C.pending),C.pending+=x})(C,M,x,!0)};C.exports._tr_init=C=>{Z||((()=>{let C,M,x,Q,H;const j=new Array(16);for(x=0,Q=0;Q<28;Q++)for(d[Q]=x,C=0;C<1<<s[Q];C++)O[x++]=Q;for(O[x-1]=Q,H=0,Q=0;Q<16;Q++)for(D[Q]=H,C=0;C<1<<S[Q];C++)U[H++]=Q;for(H>>=7;Q<T;Q++)for(D[Q]=H<<7,C=0;C<1<<S[Q]-7;C++)U[256+H++]=Q;for(M=0;M<=z;M++)j[M]=0;for(C=0;C<=143;)V[2*C+1]=8,C++,j[8]++;for(;C<=255;)V[2*C+1]=9,C++,j[9]++;for(;C<=279;)V[2*C+1]=7,C++,j[7]++;for(;C<=287;)V[2*C+1]=8,C++,j[8]++;for(X(V,287,j),C=0;C<T;C++)y[2*C+1]=5,y[2*C]=I(C,5);L=new o(V,s,257,f,z),t=new o(y,S,0,T,z),A=new o(new Array(0),m,0,19,7)})(),Z=!0),C.l_desc=new H(C.dyn_ltree,L),C.d_desc=new H(C.dyn_dtree,t),C.bl_desc=new H(C.bl_tree,A),C.bi_buf=0,C.bi_valid=0,g(C)},C.exports._tr_stored_block=E,C.exports._tr_flush_block=(C,M,f,T)=>{let z,s,S=0;C.level>0?(2===C.strm.data_type&&(C.strm.data_type=(C=>{let M,f=4093624447;for(M=0;M<=31;M++,f>>>=1)if(1&f&&0!==C.dyn_ltree[2*M])return 0;if(0!==C.dyn_ltree[18]||0!==C.dyn_ltree[20]||0!==C.dyn_ltree[26])return 1;for(M=32;M<x;M++)if(0!==C.dyn_ltree[2*M])return 1;return 0})(C)),c(C,C.l_desc),c(C,C.d_desc),S=(C=>{let M;for(q(C,C.dyn_ltree,C.l_desc.max_code),q(C,C.dyn_dtree,C.d_desc.max_code),c(C,C.bl_desc),M=18;M>=3&&0===C.bl_tree[2*Q[M]+1];M--);return C.opt_len+=3*(M+1)+5+5+4,M})(C),z=C.opt_len+3+7>>>3,s=C.static_len+3+7>>>3,s<=z&&(z=s)):z=s=f+5,f+4<=z&&-1!==M?E(C,M,f,T):4===C.strategy||s===z?(R(C,2+(T?1:0),3),h(C,V,y)):(R(C,4+(T?1:0),3),((C,M,x,f)=>{let T;for(R(C,M-257,5),R(C,x-1,5),R(C,f-4,4),T=0;T<f;T++)R(C,C.bl_tree[2*Q[T]+1],3);i(C,C.dyn_ltree,M-1),i(C,C.dyn_dtree,x-1)})(C,C.l_desc.max_code+1,C.d_desc.max_code+1,S+1),h(C,C.dyn_ltree,C.dyn_dtree)),g(C),T&&B(C)},C.exports._tr_tally=(C,M,f)=>(C.pending_buf[C.d_buf+2*C.last_lit]=M>>>8&255,C.pending_buf[C.d_buf+2*C.last_lit+1]=255&M,C.pending_buf[C.l_buf+C.last_lit]=255&f,C.last_lit++,0===M?C.dyn_ltree[2*f]++:(C.matches++,M--,C.dyn_ltree[2*(O[f]+x+1)]++,C.dyn_dtree[2*j(M)]++),C.last_lit===C.lit_bufsize-1),C.exports._tr_align=C=>{R(C,2,3),n(C,256,V),(C=>{16===C.bi_valid?(b(C,C.bi_buf),C.bi_buf=0,C.bi_valid=0):C.bi_valid>=8&&(C.pending_buf[C.pending++]=255&C.bi_buf,C.bi_buf>>=8,C.bi_valid-=8)})(C)}},11648:C=>{"use strict";C.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},12038:C=>{function M(C,M,x){for(var f=C.length,T=-1/0,z=1/0,s=0;s<f;s++){var S=(x[0][s]-C[s])/M[s],m=(x[1][s]-C[s])/M[s];if(S>m){var Q=S;S=m,m=Q}if(m<T||S>z)return 1/0;S>T&&(T=S),m<z&&(z=m)}return T>z?1/0:T}C.exports=function(C,x,f,T){var z=M(x,f,T);if(z===1/0)C=null;else{C=C||[];for(var s=0;s<x.length;s++)C[s]=x[s]+f[s]*z}return C},C.exports.distance=M},12701:(C,M,x)=>{"use strict";x.d(M,{e:()=>s});var f=x(40);const T=f.useLayoutEffect;const z=function(C){var M=(0,f.useRef)(C);return T((function(){M.current=C})),M};var s=function(C){var M=z(C);(0,f.useEffect)((function(){var C=function(C){var x;if(null!=M.current&&(x=M.current(C)),C.defaultPrevented&&(C.returnValue=""),"string"===typeof x)return C.returnValue=x,x};return window.addEventListener("beforeunload",C),function(){window.removeEventListener("beforeunload",C)}}),[])}},12657:(C,M,x)=>{"use strict";var f=x(12664),T=Array.prototype.concat,z=Array.prototype.slice,s=C.exports=function(C){for(var M=[],x=0,s=C.length;x<s;x++){var S=C[x];f(S)?M=T.call(M,z.call(S)):M.push(S)}return M};s.wrap=function(C){return function(){return C(s(arguments))}}},12664:C=>{C.exports=function(C){return!(!C||"string"===typeof C)&&(C instanceof Array||Array.isArray(C)||C.length>=0&&(C.splice instanceof Function||Object.getOwnPropertyDescriptor(C,C.length-1)&&"String"!==C.constructor.name))}},11551:(C,M,x)=>{var f=x(11556);function T(C){for(var M,x,T=0,z=C.length,s=0;s<C.length;){for(M=C[s],x=0;s<z&&C[s]===M;)++s,++x;T+=f.log2(x)/7|0,T+=f.log2(M>>>0)/7|0,T+=2}return T}M.size=T,M.encode=function(C,M){M||(M=new Uint8Array(T(C)));for(var x,f,z=0,s=M.length,S=0;S<C.length;){for(x=C[S],f=0;S<C.length&&C[S]===x;)++S,++f;for(;z<s&&f>=128;)M[z++]=128+(127&f),f>>>=7;if(z>=s)throw new Error("RLE buffer overflow");for(M[z++]=f,x>>>=0;z<s&&x>=128;)M[z++]=128+(127&x),x>>>=7;if(z>=s)throw new Error("RLE buffer overflow");M[z++]=x}return M},M.decode=function(C,M){for(var x,f,T,z,s=M.length,S=C.length,m=0,Q=0;Q<S;){for(x=0,f=0;Q<S&&C[Q]>=128;)x+=(127&C[Q++])<<f,f+=7;if(x+=C[Q++]<<f,Q>=S)throw new Error("RLE buffer underrun");if(m+x>s)throw new Error("Chunk buffer overflow");for(T=0,f=0;Q<S&&C[Q]>=128;)T+=(127&C[Q++])<<f,f+=7;if(Q>=S)throw new Error("RLE buffer underrun");for(T+=C[Q++]<<f,z=0;z<x;++z)M[m++]=T}return M}},11556:(C,M)=>{"use strict";function x(C){var M=32;return(C&=-C)&&M--,65535&C&&(M-=16),16711935&C&&(M-=8),252645135&C&&(M-=4),858993459&C&&(M-=2),1431655765&C&&(M-=1),M}M.INT_BITS=32,M.INT_MAX=2147483647,M.INT_MIN=-1<<31,M.sign=function(C){return(C>0)-(C<0)},M.abs=function(C){var M=C>>31;return(C^M)-M},M.min=function(C,M){return M^(C^M)&-(C<M)},M.max=function(C,M){return C^(C^M)&-(C<M)},M.isPow2=function(C){return!(C&C-1)&&!!C},M.log2=function(C){var M,x;return M=(C>65535)<<4,M|=x=((C>>>=M)>255)<<3,M|=x=((C>>>=x)>15)<<2,(M|=x=((C>>>=x)>3)<<1)|(C>>>=x)>>1},M.log10=function(C){return C>=1e9?9:C>=1e8?8:C>=1e7?7:C>=1e6?6:C>=1e5?5:C>=1e4?4:C>=1e3?3:C>=100?2:C>=10?1:0},M.popCount=function(C){return 16843009*((C=(858993459&(C-=C>>>1&1431655765))+(C>>>2&858993459))+(C>>>4)&252645135)>>>24},M.countTrailingZeros=x,M.nextPow2=function(C){return C+=0===C,--C,C|=C>>>1,C|=C>>>2,C|=C>>>4,C|=C>>>8,(C|=C>>>16)+1},M.prevPow2=function(C){return C|=C>>>1,C|=C>>>2,C|=C>>>4,C|=C>>>8,(C|=C>>>16)-(C>>>1)},M.parity=function(C){return C^=C>>>16,C^=C>>>8,C^=C>>>4,27030>>>(C&=15)&1};var f=new Array(256);!function(C){for(var M=0;M<256;++M){var x=M,f=M,T=7;for(x>>>=1;x;x>>>=1)f<<=1,f|=1&x,--T;C[M]=f<<T&255}}(f),M.reverse=function(C){return f[255&C]<<24|f[C>>>8&255]<<16|f[C>>>16&255]<<8|f[C>>>24&255]},M.interleave2=function(C,M){return(C=1431655765&((C=858993459&((C=252645135&((C=16711935&((C&=65535)|C<<8))|C<<4))|C<<2))|C<<1))|(M=1431655765&((M=858993459&((M=252645135&((M=16711935&((M&=65535)|M<<8))|M<<4))|M<<2))|M<<1))<<1},M.deinterleave2=function(C,M){return(C=65535&((C=16711935&((C=252645135&((C=858993459&((C=C>>>M&1431655765)|C>>>1))|C>>>2))|C>>>4))|C>>>16))<<16>>16},M.interleave3=function(C,M,x){return C=1227133513&((C=3272356035&((C=251719695&((C=4278190335&((C&=1023)|C<<16))|C<<8))|C<<4))|C<<2),(C|=(M=1227133513&((M=3272356035&((M=251719695&((M=4278190335&((M&=1023)|M<<16))|M<<8))|M<<4))|M<<2))<<1)|(x=1227133513&((x=3272356035&((x=251719695&((x=4278190335&((x&=1023)|x<<16))|x<<8))|x<<4))|x<<2))<<2},M.deinterleave3=function(C,M){return(C=1023&((C=4278190335&((C=251719695&((C=3272356035&((C=C>>>M&1227133513)|C>>>2))|C>>>4))|C>>>8))|C>>>16))<<22>>22},M.nextCombination=function(C){var M=C|C-1;return M+1|(~M&-~M)-1>>>x(C)+1}},11588:C=>{"use strict";C.exports=function(C,M,x,f){var T=self||window;try{try{var z;try{z=new T.Blob([C])}catch(Q){(z=new(T.BlobBuilder||T.WebKitBlobBuilder||T.MozBlobBuilder||T.MSBlobBuilder)).append(C),z=z.getBlob()}var s=T.URL||T.webkitURL,S=s.createObjectURL(z),m=new T[M](S,x);return s.revokeObjectURL(S),m}catch(Q){return new T[M]("data:application/javascript,".concat(encodeURIComponent(C)),x)}}catch(Q){if(!f)throw Error("Inline worker is not supported");return new T[M](f,x)}}},12022:(C,M,x)=>{"use strict";function f(C,M,x,f,T){var z={};return Object.keys(f).forEach((function(C){z[C]=f[C]})),z.enumerable=!!z.enumerable,z.configurable=!!z.configurable,("value"in z||z.initializer)&&(z.writable=!0),z=x.slice().reverse().reduce((function(x,f){return f(C,M,x)||x}),z),T&&void 0!==z.initializer&&(z.value=z.initializer?z.initializer.call(T):void 0,z.initializer=void 0),void 0===z.initializer&&(Object.defineProperty(C,M,z),z=null),z}x.d(M,{e:()=>f})},12019:(C,M,x)=>{"use strict";function f(C,M,x,f){x&&Object.defineProperty(C,M,{enumerable:x.enumerable,configurable:x.configurable,writable:x.writable,value:x.initializer?x.initializer.call(f):void 0})}x.d(M,{d:()=>f})},12330:(C,M,x)=>{"use strict";x.d(M,{b:()=>A,c:()=>o,d:()=>L,g:()=>U,k:()=>D,n:()=>d,q:()=>O});var f=x(978),T=x(1162),z=x(1015),s=x(997),S=x(12339),m=x(11734),Q=x(1140),V=x(1042),y=x(1145);const U=Object.freeze(new f.h(0,0,0,0)),O=Object.freeze(f.m.Zero()),d=Object.freeze(f.j.Zero()),D=Object.freeze(Q.d.Zero()),o=Object.freeze(T.d.Black()),L=Object.freeze(new T.e(0,0,0,0)),t={key:0,repeatCount:0,loopMode:2};class A{static _PrepareAnimation(C,M,x,z,s,S,m,V){let y;if(!isNaN(parseFloat(s))&&isFinite(s)?y=A.ANIMATIONTYPE_FLOAT:s instanceof f.h?y=A.ANIMATIONTYPE_QUATERNION:s instanceof f.m?y=A.ANIMATIONTYPE_VECTOR3:s instanceof f.j?y=A.ANIMATIONTYPE_VECTOR2:s instanceof T.d?y=A.ANIMATIONTYPE_COLOR3:s instanceof T.e?y=A.ANIMATIONTYPE_COLOR4:s instanceof Q.d&&(y=A.ANIMATIONTYPE_SIZE),void 0==y)return null;const U=new A(C,M,x,y,m),O=[{frame:0,value:s},{frame:z,value:S}];return U.setKeys(O),void 0!==V&&U.setEasingFunction(V),U}static CreateAnimation(C,M,x,f){const T=new A(C+"Animation",C,x,M,A.ANIMATIONLOOPMODE_CONSTANT);return T.setEasingFunction(f),T}static CreateAndStartAnimation(C,M,x,f,T,z,s,S,m,Q,V){const y=A._PrepareAnimation(C,x,f,T,z,s,S,m);return y?(M.va&&(V=M.va()),V?V.beginDirectAnimation(M,[y],0,T,1===y.loopMode,1,Q):null):null}static CreateAndStartHierarchyAnimation(C,M,x,f,T,z,s,S,m,Q,V){const y=A._PrepareAnimation(C,f,T,z,s,S,m,Q);if(!y)return null;return M.va().beginDirectHierarchyAnimation(M,x,[y],0,z,1===y.loopMode,1,V)}static CreateMergeAndStartAnimation(C,M,x,f,T,z,s,S,m,Q){const V=A._PrepareAnimation(C,x,f,T,z,s,S,m);return V?(M.animations.push(V),M.va().beginAnimation(M,0,T,1===V.loopMode,1,Q)):null}static MakeAnimationAdditive(C,M,x){let T;T="object"===typeof M?M:{referenceFrame:M??0,range:x,cloneOriginalAnimation:arguments.length>3&&void 0!==arguments[3]&&arguments[3],clonedAnimationName:arguments.length>4?arguments[4]:void 0};let z=C;if(T.cloneOriginalAnimation&&(z=C.clone(),z.name=T.clonedAnimationName||z.name),!z._keys.length)return z;const s=T.referenceFrame&&T.referenceFrame>=0?T.referenceFrame:0;let S=0;const m=z._keys[0];let Q=z._keys.length-1;const V=z._keys[Q],y={referenceValue:m.value,referencePosition:f.i.Md[0],referenceQuaternion:f.i.Quaternion[0],referenceScaling:f.i.Md[1],keyPosition:f.i.Md[2],keyQuaternion:f.i.Quaternion[1],keyScaling:f.i.Md[3]};let U=m.frame,O=V.frame;if(T.range){const C=z.getRange(T.range);C&&(U=C.from,O=C.to)}else U=T.fromFrame??U,O=T.toFrame??O;if(U!==m.frame&&(S=z.createKeyForFrame(U)),O!==V.frame&&(Q=z.createKeyForFrame(O)),1===z._keys.length){const C=z._getKeyValue(z._keys[0]);y.referenceValue=C.clone?C.clone():C}else if(s<=m.frame){const C=z._getKeyValue(m.value);y.referenceValue=C.clone?C.clone():C}else if(s>=V.frame){const C=z._getKeyValue(V.value);y.referenceValue=C.clone?C.clone():C}else{t.key=0;const C=z._interpolate(s,t);y.referenceValue=C.clone?C.clone():C}z.dataType===A.ANIMATIONTYPE_QUATERNION?y.referenceValue.normalize().conjugateInPlace():z.dataType===A.ANIMATIONTYPE_MATRIX&&(y.referenceValue.decompose(y.referenceScaling,y.referenceQuaternion,y.referencePosition),y.referenceQuaternion.normalize().conjugateInPlace());let d=Number.MAX_VALUE;const D=T.clipKeys?[]:null;for(let o=S;o<=Q;o++){let C=z._keys[o];if((D||T.cloneOriginalAnimation)&&(C={frame:C.frame,value:C.value.clone?C.value.clone():C.value,inTangent:C.inTangent,outTangent:C.outTangent,interpolation:C.interpolation,lockedTangent:C.lockedTangent},D&&(d===Number.MAX_VALUE&&(d=C.frame),C.frame-=d,D.push(C))),!o||z.dataType===A.ANIMATIONTYPE_FLOAT||C.value!==m.value)switch(z.dataType){case A.ANIMATIONTYPE_MATRIX:C.value.decompose(y.keyScaling,y.keyQuaternion,y.keyPosition),y.keyPosition.zd(y.referencePosition),y.keyScaling.divideInPlace(y.referenceScaling),y.referenceQuaternion.multiplyToRef(y.keyQuaternion,y.keyQuaternion),f.d.ComposeToRef(y.keyScaling,y.keyQuaternion,y.keyPosition,C.value);break;case A.ANIMATIONTYPE_QUATERNION:y.referenceValue.multiplyToRef(C.value,C.value);break;case A.ANIMATIONTYPE_VECTOR2:case A.ANIMATIONTYPE_VECTOR3:case A.ANIMATIONTYPE_COLOR3:case A.ANIMATIONTYPE_COLOR4:C.value.subtractToRef(y.referenceValue,C.value);break;case A.ANIMATIONTYPE_SIZE:C.value.width-=y.referenceValue.width,C.value.height-=y.referenceValue.height;break;default:C.value-=y.referenceValue}}return D&&z.setKeys(D,!0),z}static TransitionTo(C,M,x,f,T,z,s){let S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;if(s<=0)return x[C]=M,S&&S(),null;const m=T*(s/1e3);z.setKeys([{frame:0,value:x[C].clone?x[C].clone():x[C]},{frame:m,value:M}]),x.animations||(x.animations=[]),x.animations.push(z);const Q=f.beginAnimation(x,0,m,!1);return Q.onAnimationEnd=S,Q}get runtimeAnimations(){return this._runtimeAnimations}get hasRunningRuntimeAnimations(){for(const C of this._runtimeAnimations)if(!C.isStopped())return!0;return!1}constructor(C,M,x,f,T,z){this.name=C,this.targetProperty=M,this.framePerSecond=x,this.dataType=f,this.loopMode=T,this.enableBlending=z,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=M.split("."),this.dataType=f,this.loopMode=void 0===T?A.ANIMATIONLOOPMODE_CYCLE:T,this.uniqueId=A._UniqueIdGenerator++}toString(C){let M="Name: "+this.name+", property: "+this.targetProperty;if(M+=", datatype: "+["Float","Md","Quaternion","Matrix","_d","Vector2"][this.dataType],M+=", nKeys: "+(this._keys?this._keys.length:"none"),M+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),C){M+=", Ranges: {";let C=!0;for(const x in this._ranges)C&&(M+=", ",C=!1),M+=x;M+="}"}return M}addEvent(C){this._events.push(C),this._events.sort(((C,M)=>C.frame-M.frame))}removeEvents(C){for(let M=0;M<this._events.length;M++)this._events[M].frame===C&&(this._events.splice(M,1),M--)}getEvents(){return this._events}createRange(C,M,x){this._ranges[C]||(this._ranges[C]=new S.c(C,M,x))}deleteRange(C){let M=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const x=this._ranges[C];if(x){if(M){const C=x.from,M=x.to;for(let x=this._keys.length-1;x>=0;x--)this._keys[x].frame>=C&&this._keys[x].frame<=M&&this._keys.splice(x,1)}this._ranges[C]=null}}getRange(C){return this._ranges[C]}getKeys(){return this._keys}getHighestFrame(){let C=0;for(let M=0,x=this._keys.length;M<x;M++)C<this._keys[M].frame&&(C=this._keys[M].frame);return C}getEasingFunction(){return this._easingFunction}setEasingFunction(C){this._easingFunction=C}floatInterpolateFunction(C,M,x){return(0,z.q)(C,M,x)}floatInterpolateFunctionWithTangents(C,M,x,f,T){return(0,z.g)(C,M,x,f,T)}quaternionInterpolateFunction(C,M,x){return f.h.Slerp(C,M,x)}quaternionInterpolateFunctionWithTangents(C,M,x,T,z){return f.h.Hermite(C,M,x,T,z).normalize()}vector3InterpolateFunction(C,M,x){return f.m.Lerp(C,M,x)}vector3InterpolateFunctionWithTangents(C,M,x,T,z){return f.m.Hermite(C,M,x,T,z)}vector2InterpolateFunction(C,M,x){return f.j.Lerp(C,M,x)}vector2InterpolateFunctionWithTangents(C,M,x,T,z){return f.j.Hermite(C,M,x,T,z)}sizeInterpolateFunction(C,M,x){return Q.d.Lerp(C,M,x)}color3InterpolateFunction(C,M,x){return T.d.Lerp(C,M,x)}color3InterpolateFunctionWithTangents(C,M,x,f,z){return T.d.Hermite(C,M,x,f,z)}color4InterpolateFunction(C,M,x){return T.e.Lerp(C,M,x)}color4InterpolateFunctionWithTangents(C,M,x,f,z){return T.e.Hermite(C,M,x,f,z)}_getKeyValue(C){return"function"===typeof C?C():C}evaluate(C){return t.key=0,this._interpolate(C,t)}_interpolate(C,M){let x=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(M.loopMode===A.ANIMATIONLOOPMODE_CONSTANT&&M.repeatCount>0)return M.highLimitValue.clone?M.highLimitValue.clone():M.highLimitValue;const f=this._keys,T=f.length;let z=M.key;for(;z>=0&&C<f[z].frame;)--z;for(;z+1<=T-1&&C>=f[z+1].frame;)++z;if(M.key=z,z<0)return x?void 0:this._getKeyValue(f[0].value);if(z+1>T-1)return x?void 0:this._getKeyValue(f[T-1].value);const s=f[z],S=f[z+1];if(x&&(C===s.frame||C===S.frame))return;const m=this._getKeyValue(s.value),Q=this._getKeyValue(S.value);if(1===s.interpolation)return S.frame>C?m:Q;const V=void 0!==s.outTangent&&void 0!==S.inTangent,y=S.frame-s.frame;let t=(C-s.frame)/y;const H=s.easingFunction||this.getEasingFunction();switch(null!==H&&(t=H.ease(t)),this.dataType){case A.ANIMATIONTYPE_FLOAT:{const C=V?this.floatInterpolateFunctionWithTangents(m,s.outTangent*y,Q,S.inTangent*y,t):this.floatInterpolateFunction(m,Q,t);switch(M.loopMode){case A.ANIMATIONLOOPMODE_CYCLE:case A.ANIMATIONLOOPMODE_CONSTANT:case A.ANIMATIONLOOPMODE_YOYO:return C;case A.ANIMATIONLOOPMODE_RELATIVE:case A.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return(M.offsetValue??0)*M.repeatCount+C}break}case A.ANIMATIONTYPE_QUATERNION:{const C=V?this.quaternionInterpolateFunctionWithTangents(m,s.outTangent.scale(y),Q,S.inTangent.scale(y),t):this.quaternionInterpolateFunction(m,Q,t);switch(M.loopMode){case A.ANIMATIONLOOPMODE_CYCLE:case A.ANIMATIONLOOPMODE_CONSTANT:case A.ANIMATIONLOOPMODE_YOYO:return C;case A.ANIMATIONLOOPMODE_RELATIVE:case A.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return C.addInPlace((M.offsetValue||U).scale(M.repeatCount))}return C}case A.ANIMATIONTYPE_VECTOR3:{const C=V?this.vector3InterpolateFunctionWithTangents(m,s.outTangent.scale(y),Q,S.inTangent.scale(y),t):this.vector3InterpolateFunction(m,Q,t);switch(M.loopMode){case A.ANIMATIONLOOPMODE_CYCLE:case A.ANIMATIONLOOPMODE_CONSTANT:case A.ANIMATIONLOOPMODE_YOYO:return C;case A.ANIMATIONLOOPMODE_RELATIVE:case A.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return C.add((M.offsetValue||O).scale(M.repeatCount))}break}case A.ANIMATIONTYPE_VECTOR2:{const C=V?this.vector2InterpolateFunctionWithTangents(m,s.outTangent.scale(y),Q,S.inTangent.scale(y),t):this.vector2InterpolateFunction(m,Q,t);switch(M.loopMode){case A.ANIMATIONLOOPMODE_CYCLE:case A.ANIMATIONLOOPMODE_CONSTANT:case A.ANIMATIONLOOPMODE_YOYO:return C;case A.ANIMATIONLOOPMODE_RELATIVE:case A.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return C.add((M.offsetValue||d).scale(M.repeatCount))}break}case A.ANIMATIONTYPE_SIZE:switch(M.loopMode){case A.ANIMATIONLOOPMODE_CYCLE:case A.ANIMATIONLOOPMODE_CONSTANT:case A.ANIMATIONLOOPMODE_YOYO:return this.sizeInterpolateFunction(m,Q,t);case A.ANIMATIONLOOPMODE_RELATIVE:case A.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return this.sizeInterpolateFunction(m,Q,t).add((M.offsetValue||D).scale(M.repeatCount))}break;case A.ANIMATIONTYPE_COLOR3:{const C=V?this.color3InterpolateFunctionWithTangents(m,s.outTangent.scale(y),Q,S.inTangent.scale(y),t):this.color3InterpolateFunction(m,Q,t);switch(M.loopMode){case A.ANIMATIONLOOPMODE_CYCLE:case A.ANIMATIONLOOPMODE_CONSTANT:case A.ANIMATIONLOOPMODE_YOYO:return C;case A.ANIMATIONLOOPMODE_RELATIVE:case A.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return C.add((M.offsetValue||o).scale(M.repeatCount))}break}case A.ANIMATIONTYPE_COLOR4:{const C=V?this.color4InterpolateFunctionWithTangents(m,s.outTangent.scale(y),Q,S.inTangent.scale(y),t):this.color4InterpolateFunction(m,Q,t);switch(M.loopMode){case A.ANIMATIONLOOPMODE_CYCLE:case A.ANIMATIONLOOPMODE_CONSTANT:case A.ANIMATIONLOOPMODE_YOYO:return C;case A.ANIMATIONLOOPMODE_RELATIVE:case A.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return C.add((M.offsetValue||L).scale(M.repeatCount))}break}case A.ANIMATIONTYPE_MATRIX:switch(M.loopMode){case A.ANIMATIONLOOPMODE_CYCLE:case A.ANIMATIONLOOPMODE_CONSTANT:case A.ANIMATIONLOOPMODE_YOYO:return A.AllowMatricesInterpolation?this.matrixInterpolateFunction(m,Q,t,M.workValue):m;case A.ANIMATIONLOOPMODE_RELATIVE:case A.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return m}}return 0}matrixInterpolateFunction(C,M,x,T){return A.AllowMatrixDecomposeForInterpolation?T?(f.d.DecomposeLerpToRef(C,M,x,T),T):f.d.DecomposeLerp(C,M,x):T?(f.d.LerpToRef(C,M,x,T),T):f.d.Lerp(C,M,x)}clone(){const C=new A(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(C.enableBlending=this.enableBlending,C.blendingSpeed=this.blendingSpeed,this._keys&&C.setKeys(this._keys),this._ranges){C._ranges={};for(const M in this._ranges){const x=this._ranges[M];x&&(C._ranges[M]=x.clone())}}return C}setKeys(C){let M=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._keys=M?C:C.slice(0)}createKeyForFrame(C){t.key=0;const M=this._interpolate(C,t,!0);if(!M)return this._keys[t.key].frame===C?t.key:t.key+1;const x={frame:C,value:M.clone?M.clone():M};return this._keys.splice(t.key+1,0,x),t.key+1}serialize(){const C={};C.name=this.name,C.property=this.targetProperty,C.framePerSecond=this.framePerSecond,C.dataType=this.dataType,C.loopBehavior=this.loopMode,C.enableBlending=this.enableBlending,C.blendingSpeed=this.blendingSpeed;const M=this.dataType;C.keys=[];const x=this.getKeys();for(let f=0;f<x.length;f++){const T=x[f],z={};switch(z.frame=T.frame,M){case A.ANIMATIONTYPE_FLOAT:z.values=[T.value],void 0!==T.inTangent&&z.values.push(T.inTangent),void 0!==T.outTangent&&(void 0===T.inTangent&&z.values.push(void 0),z.values.push(T.outTangent)),void 0!==T.interpolation&&(void 0===T.inTangent&&z.values.push(void 0),void 0===T.outTangent&&z.values.push(void 0),z.values.push(T.interpolation));break;case A.ANIMATIONTYPE_QUATERNION:case A.ANIMATIONTYPE_MATRIX:case A.ANIMATIONTYPE_VECTOR3:case A.ANIMATIONTYPE_COLOR3:case A.ANIMATIONTYPE_COLOR4:z.values=T.value.Gd(),void 0!=T.inTangent&&z.values.push(T.inTangent.Gd()),void 0!=T.outTangent&&(void 0===T.inTangent&&z.values.push(void 0),z.values.push(T.outTangent.Gd())),void 0!==T.interpolation&&(void 0===T.inTangent&&z.values.push(void 0),void 0===T.outTangent&&z.values.push(void 0),z.values.push(T.interpolation))}C.keys.push(z)}C.ranges=[];for(const f in this._ranges){const M=this._ranges[f];if(!M)continue;const x={};x.name=f,x.from=M.from,x.to=M.to,C.ranges.push(x)}return C}static _UniversalLerp(C,M,x){const f=C.constructor;return f.Lerp?f.Lerp(C,M,x):f.Slerp?f.Slerp(C,M,x):C.toFixed?C*(1-x)+x*M:M}static Parse(C){const M=new A(C.name,C.property,C.framePerSecond,C.dataType,C.loopBehavior),x=C.dataType,z=[];let s,S;for(C.enableBlending&&(M.enableBlending=C.enableBlending),C.blendingSpeed&&(M.blendingSpeed=C.blendingSpeed),S=0;S<C.keys.length;S++){const M=C.keys[S];let m,Q,V;switch(x){case A.ANIMATIONTYPE_FLOAT:s=M.values[0],M.values.length>=2&&(m=M.values[1]),M.values.length>=3&&(Q=M.values[2]),M.values.length>=4&&(V=M.values[3]);break;case A.ANIMATIONTYPE_QUATERNION:if(s=f.h.Dd(M.values),M.values.length>=8){const C=f.h.Dd(M.values.slice(4,8));C.equals(f.h.Zero())||(m=C)}if(M.values.length>=12){const C=f.h.Dd(M.values.slice(8,12));C.equals(f.h.Zero())||(Q=C)}M.values.length>=13&&(V=M.values[12]);break;case A.ANIMATIONTYPE_MATRIX:s=f.d.Dd(M.values),M.values.length>=17&&(V=M.values[16]);break;case A.ANIMATIONTYPE_COLOR3:s=T.d.Dd(M.values),M.values[3]&&(m=T.d.Dd(M.values[3])),M.values[4]&&(Q=T.d.Dd(M.values[4])),M.values[5]&&(V=M.values[5]);break;case A.ANIMATIONTYPE_COLOR4:s=T.e.Dd(M.values),M.values[4]&&(m=T.e.Dd(M.values[4])),M.values[5]&&(Q=T.e.Dd(M.values[5])),M.values[6]&&(V=T.e.Dd(M.values[6]));break;case A.ANIMATIONTYPE_VECTOR3:default:s=f.m.Dd(M.values),M.values[3]&&(m=f.m.Dd(M.values[3])),M.values[4]&&(Q=f.m.Dd(M.values[4])),M.values[5]&&(V=M.values[5])}const y={};y.frame=M.frame,y.value=s,void 0!=m&&(y.inTangent=m),void 0!=Q&&(y.outTangent=Q),void 0!=V&&(y.interpolation=V),z.push(y)}if(M.setKeys(z),C.ranges)for(S=0;S<C.ranges.length;S++)s=C.ranges[S],M.createRange(s.name,s.from,s.to);return M}static AppendSerializedAnimations(C,M){y.e.AppendSerializedAnimations(C,M)}static ParseFromFileAsync(C,M){return new Promise(((x,f)=>{const T=new V.d;T.addEventListener("readystatechange",(()=>{if(4==T.readyState)if(200==T.status){let M=JSON.parse(T.responseText);if(M.animations&&(M=M.animations),M.length){const C=[];for(const x of M)C.push(this.Parse(x));x(C)}else{const f=this.Parse(M);C&&(f.name=C),x(f)}}else f("Unable to load the animation")})),T.open("GET",M),T.send()}))}static ParseFromSnippetAsync(C){return new Promise(((M,x)=>{const f=new V.d;f.addEventListener("readystatechange",(()=>{if(4==f.readyState)if(200==f.status){const x=JSON.parse(JSON.parse(f.responseText).jsonPayload);if(x.animations){const f=JSON.parse(x.animations),T=[];for(const M of f.animations){const x=this.Parse(M);x.snippetId=C,T.push(x)}M(T)}else{const f=JSON.parse(x.animation),T=this.Parse(f);T.snippetId=C,M(T)}}else x("Unable to load the snippet "+C)})),f.open("GET",this.SnippetUrl+"/"+C.replace(/#/g,"/")),f.send()}))}}A._UniqueIdGenerator=0,A.AllowMatricesInterpolation=!1,A.AllowMatrixDecomposeForInterpolation=!0,A.SnippetUrl="https://snippet.babylonjs.com",A.ANIMATIONTYPE_FLOAT=0,A.ANIMATIONTYPE_VECTOR3=1,A.ANIMATIONTYPE_QUATERNION=2,A.ANIMATIONTYPE_MATRIX=3,A.ANIMATIONTYPE_COLOR3=4,A.ANIMATIONTYPE_COLOR4=7,A.ANIMATIONTYPE_VECTOR2=5,A.ANIMATIONTYPE_SIZE=6,A.ANIMATIONLOOPMODE_RELATIVE=0,A.ANIMATIONLOOPMODE_CYCLE=1,A.ANIMATIONLOOPMODE_CONSTANT=2,A.ANIMATIONLOOPMODE_YOYO=4,A.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT=5,A.CreateFromSnippetAsync=A.ParseFromSnippetAsync,(0,s.f)("BABYLON.Animation",A),m.e._AnimationRangeFactory=(C,M,x)=>new S.c(C,M,x)},12339:(C,M,x)=>{"use strict";x.d(M,{c:()=>f});class f{constructor(C,M,x){this.name=C,this.from=M,this.to=x}clone(){return new f(this.name,this.from,this.to)}}},12324:(C,M,x)=>{"use strict";x.d(M,{c:()=>s});var f=x(978),T=x(991),z=x(11734);class s extends z.e{get _matrix(){return this._compose(),this.Wj}set _matrix(C){(C.updateFlag!==this.Wj.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.Wj.p(C),this._markAsDirtyAndDecompose())}constructor(C,M){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,S=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(C,M.va(),!1),this.name=C,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=M,this.Wj=(null===T||void 0===T?void 0:T.clone())??f.d.Identity(),this._restMatrix=z??this.Wj.clone(),this._bindMatrix=s??this.Wj.clone(),this._index=S,this._absoluteMatrix=new f.d,this._absoluteBindMatrix=new f.d,this._absoluteInverseBindMatrix=new f.d,this._finalMatrix=new f.d,M.bones.push(this),this.setParent(x,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(C){this.setParent(C)}setParent(C){let M=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==C){if(this.parent){const C=this.parent.children.indexOf(this);-1!==C&&this.parent.children.splice(C,1)}this._parentNode=C,this.parent&&this.parent.children.push(this),M&&this._updateAbsoluteBindMatrices(),this.Fe()}}getLocalMatrix(){return this._compose(),this.Wj}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(C){this._restMatrix.p(C)}setRestPose(C){this.setRestMatrix(C)}getBindPose(){return this.getBindMatrix()}setBindMatrix(C){this.ee(C)}setBindPose(C){this.setBindMatrix(C)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const C=f.i.Md[0],M=f.i.Quaternion[0],x=f.i.Md[1];this.getRestMatrix().decompose(C,M,x),this._linkedTransformNode.position.p(x),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??f.h.Identity(),this._linkedTransformNode.rotationQuaternion.p(M),this._linkedTransformNode.Qd.p(C)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(C){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=C,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.Jg}set position(C){this._decompose(),this.Jg.p(C),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(C){this.setRotation(C)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(C){this.setRotationQuaternion(C)}get Qd(){return this.getScale()}set Qd(C){this.setScale(C)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=f.m.Zero(),this._localRotation=f.h.Zero(),this.Jg=f.m.Zero()),this.Wj.decompose(this._localScaling,this._localRotation,this.Jg))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,f.d.ComposeToRef(this._localScaling,this._localRotation,this.Jg,this.Wj)):this._needToCompose=!1)}ee(C){let M=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],x=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.p(C),M&&this._updateAbsoluteBindMatrices(),x?this._matrix=C:this.Fe()}_updateAbsoluteBindMatrices(C){let M=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(C||(C=this._bindMatrix),this.parent?C.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.p(C),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),M)for(let x=0;x<this.children.length;x++)this.children[x]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}Fe(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.Fe(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.Fe(),this._needToDecompose=!0}_updatePosition(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,x=arguments.length>2?arguments[2]:void 0,T=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const z=this.getLocalMatrix();if(0==M)T?(z.addAtIndex(12,C.x),z.addAtIndex(13,C.y),z.addAtIndex(14,C.z)):z.setTranslationFromFloats(C.x,C.y,C.z);else{let M=null;x&&(M=x.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const S=s._TmpMats[0],m=s._TmpVecs[0];this.parent?x&&M?(S.p(this.parent.getAbsoluteMatrix()),S.multiplyToRef(M,S)):S.p(this.parent.getAbsoluteMatrix()):f.d.IdentityToRef(S),T&&S.setTranslationFromFloats(0,0,0),S.invert(),f.m.TransformCoordinatesToRef(C,S,m),T?(z.addAtIndex(12,m.x),z.addAtIndex(13,m.y),z.addAtIndex(14,m.z)):z.setTranslationFromFloats(m.x,m.y,m.z)}this._markAsDirtyAndDecompose()}translate(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,x=arguments.length>2?arguments[2]:void 0;this._updatePosition(C,M,x,!0)}setPosition(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,x=arguments.length>2?arguments[2]:void 0;this._updatePosition(C,M,x,!1)}setAbsolutePosition(C,M){this.setPosition(C,1,M)}scale(C,M,x){let T=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const z=this.getLocalMatrix(),S=s._TmpMats[0];f.d.ScalingToRef(C,M,x,S),S.multiplyToRef(z,z),S.invert();for(const f of this.children){const T=f.getLocalMatrix();T.multiplyToRef(S,T),T.multiplyAtIndex(12,C),T.multiplyAtIndex(13,M),T.multiplyAtIndex(14,x),f._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),T)for(const f of this.children)f.scale(C,M,x,T)}setScale(C){this._decompose(),this._localScaling.p(C),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(C){this._decompose(),C.p(this._localScaling)}setYawPitchRoll(C,M,x){let T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,z=arguments.length>4?arguments[4]:void 0;if(0===T){const S=s._TmpQuat;return f.h.RotationYawPitchRollToRef(C,M,x,S),void this.setRotationQuaternion(S,T,z)}const S=s._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(S,z))return;const m=s._TmpMats[1];f.d.RotationYawPitchRollToRef(C,M,x,m),S.multiplyToRef(m,m),this._rotateWithMatrix(m,T,z)}rotate(C,M){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,T=arguments.length>3?arguments[3]:void 0;const z=s._TmpMats[0];z.setTranslationFromFloats(0,0,0),f.d.RotationAxisToRef(C,M,z),this._rotateWithMatrix(z,x,T)}setAxisAngle(C,M){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,T=arguments.length>3?arguments[3]:void 0;if(0===x){const z=s._TmpQuat;return f.h.RotationAxisToRef(C,M,z),void this.setRotationQuaternion(z,x,T)}const z=s._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(z,T))return;const S=s._TmpMats[1];f.d.RotationAxisToRef(C,M,S),z.multiplyToRef(S,S),this._rotateWithMatrix(S,x,T)}setRotation(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,x=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(C.y,C.x,C.z,M,x)}setRotationQuaternion(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,x=arguments.length>2?arguments[2]:void 0;if(0===M)return this._decompose(),this._localRotation.p(C),void this._markAsDirtyAndCompose();const T=s._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(T,x))return;const z=s._TmpMats[1];f.d.FromQuaternionToRef(C,z),T.multiplyToRef(z,z),this._rotateWithMatrix(z,M,x)}setRotationMatrix(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,x=arguments.length>2?arguments[2]:void 0;if(0===M){const T=s._TmpQuat;return f.h.FromRotationMatrixToRef(C,T),void this.setRotationQuaternion(T,M,x)}const T=s._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(T,x))return;const z=s._TmpMats[1];z.p(C),T.multiplyToRef(C,z),this._rotateWithMatrix(z,M,x)}_rotateWithMatrix(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,x=arguments.length>2?arguments[2]:void 0;const f=this.getLocalMatrix(),T=f.m[12],z=f.m[13],S=f.m[14],m=this.getParent(),Q=s._TmpMats[3],V=s._TmpMats[4];m&&1==M?(x?(Q.p(x.getWorldMatrix()),m.getAbsoluteMatrix().multiplyToRef(Q,Q)):Q.p(m.getAbsoluteMatrix()),V.p(Q),V.invert(),f.multiplyToRef(Q,f),f.multiplyToRef(C,f),f.multiplyToRef(V,f)):1==M&&x?(Q.p(x.getWorldMatrix()),V.p(Q),V.invert(),f.multiplyToRef(Q,f),f.multiplyToRef(C,f),f.multiplyToRef(V,f)):f.multiplyToRef(C,f),f.setTranslationFromFloats(T,z,S),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(C,M){const x=s._TmpMats[2];return C.p(this.getAbsoluteMatrix()),M?(C.multiplyToRef(M.getWorldMatrix(),C),f.d.ScalingToRef(M.Qd.x,M.Qd.y,M.Qd.z,x)):f.d.IdentityToRef(x),C.invert(),!isNaN(C.m[0])&&(x.multiplyAtIndex(0,this._scalingDeterminant),C.multiplyToRef(x,C),!0)}cb(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const x=f.m.Zero();return this.getPositionToRef(C,M,x),x}getPositionToRef(){let C=arguments.length>1?arguments[1]:void 0,M=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const C=this.getLocalMatrix();M.x=C.m[12],M.y=C.m[13],M.z=C.m[14]}else{let x=null;C&&(x=C.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let f=s._TmpMats[0];C&&x?(f.p(this.getAbsoluteMatrix()),f.multiplyToRef(x,f)):f=this.getAbsoluteMatrix(),M.x=f.m[12],M.y=f.m[13],M.z=f.m[14]}}getAbsolutePosition(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const M=f.m.Zero();return this.getPositionToRef(1,C,M),M}getAbsolutePositionToRef(C,M){this.getPositionToRef(1,C,M)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.Wj.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.p(this.Wj);const C=this._skeleton.getPoseMatrix();C&&this._absoluteMatrix.multiplyToRef(C,this._absoluteMatrix)}const C=this.children,M=C.length;for(let x=0;x<M;x++)C[x].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}Af(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const x=f.m.Zero();return this.getDirectionToRef(C,M,x),x}getDirectionToRef(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,x=arguments.length>2?arguments[2]:void 0,T=null;M&&(T=M.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const z=s._TmpMats[0];z.p(this.getAbsoluteMatrix()),M&&T&&z.multiplyToRef(T,z),f.m.TransformNormalToRef(C,z,x),x.normalize()}getRotation(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const x=f.m.Zero();return this.getRotationToRef(C,M,x),x}getRotationToRef(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,x=arguments.length>2?arguments[2]:void 0;const f=s._TmpQuat;this.getRotationQuaternionToRef(C,M,f),f.toEulerAnglesToRef(x)}getRotationQuaternion(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const x=f.h.Identity();return this.getRotationQuaternionToRef(C,M,x),x}getRotationQuaternionToRef(){let C=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,M=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),M.p(this._localRotation);else{const x=s._TmpMats[0],f=this.getAbsoluteMatrix();C?f.multiplyToRef(C.getWorldMatrix(),x):x.p(f),x.multiplyAtIndex(0,this._scalingDeterminant),x.multiplyAtIndex(1,this._scalingDeterminant),x.multiplyAtIndex(2,this._scalingDeterminant),x.decompose(void 0,M,void 0)}}getRotationMatrix(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,M=arguments.length>1?arguments[1]:void 0;const x=f.d.Identity();return this.getRotationMatrixToRef(C,M,x),x}getRotationMatrixToRef(){let C=arguments.length>1?arguments[1]:void 0,M=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(M);else{const x=s._TmpMats[0],f=this.getAbsoluteMatrix();C?f.multiplyToRef(C.getWorldMatrix(),x):x.p(f),x.multiplyAtIndex(0,this._scalingDeterminant),x.multiplyAtIndex(1,this._scalingDeterminant),x.multiplyAtIndex(2,this._scalingDeterminant),x.getRotationMatrixToRef(M)}}getAbsolutePositionFromLocal(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const x=f.m.Zero();return this.getAbsolutePositionFromLocalToRef(C,M,x),x}getAbsolutePositionFromLocalToRef(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,x=arguments.length>2?arguments[2]:void 0,T=null;M&&(T=M.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const z=s._TmpMats[0];z.p(this.getAbsoluteMatrix()),M&&T&&z.multiplyToRef(T,z),f.m.TransformCoordinatesToRef(C,z,x)}getLocalPositionFromAbsolute(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const x=f.m.Zero();return this.getLocalPositionFromAbsoluteToRef(C,M,x),x}getLocalPositionFromAbsoluteToRef(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,x=arguments.length>2?arguments[2]:void 0,T=null;M&&(T=M.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const z=s._TmpMats[0];z.p(this.getAbsoluteMatrix()),M&&T&&z.multiplyToRef(T,z),z.invert(),f.m.TransformCoordinatesToRef(C,z,x)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}}s._TmpVecs=(0,T.d)(2,f.m.Zero),s._TmpQuat=f.h.Identity(),s._TmpMats=(0,T.d)(5,f.d.Identity)},12690:(C,M,x)=>{"use strict";x.d(M,{d:()=>h});var f=x(951),T=x(959),z=x(971),s=x(978),S=x(11734),m=x(11712),Q=x(1243),V=x(1118),y=x(986);class U{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(C){this._zoomStopsAnimation=C}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(C){this._idleRotationSpeed=C}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(C){this._idleRotationWaitTime=C}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(C){this._idleRotationSpinupTime=C}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(C){this._attachedCamera=C;const M=this._attachedCamera.va();this._onPrePointerObservableObserver=M.onPrePointerObservable.add((C=>{C.type!==Q.c.POINTERDOWN?C.type===Q.c.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=C.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const C=V.e.Now;let M=0;null!=this._lastFrameTime&&(M=C-this._lastFrameTime),this._lastFrameTime=C,this._applyUserInteraction();const x=C-this._lastInteractionTime-this._idleRotationWaitTime,f=Math.max(Math.min(x/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*f,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(M/1e3))}))}detach(){if(!this._attachedCamera)return;const C=this._attachedCamera.va();this._onPrePointerObservableObserver&&C.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(C){this._lastInteractionTime=C??V.e.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<y.c}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let C=!1;return this._lastFrameRadius===this._attachedCamera.i&&0!==this._attachedCamera.inertialRadiusOffset&&(C=!0),this._lastFrameRadius=this._attachedCamera.i,this._zoomStopsAnimation?C:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=V.e.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}x(1456);class O{constructor(){this._easingMode=O.EASINGMODE_EASEIN}setEasingMode(C){const M=Math.min(Math.max(C,0),2);this._easingMode=M}getEasingMode(){return this._easingMode}easeInCore(C){throw new Error("You must implement this method")}ease(C){switch(this._easingMode){case O.EASINGMODE_EASEIN:return this.easeInCore(C);case O.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-C)}return C>=.5?.5*(1-this.easeInCore(2*(1-C)))+.5:.5*this.easeInCore(2*C)}}O.EASINGMODE_EASEIN=0,O.EASINGMODE_EASEOUT=1,O.EASINGMODE_EASEINOUT=2;var d=x(12330);class D{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(C){if(this._autoTransitionRange===C)return;this._autoTransitionRange=C;const M=this._attachedCamera;M&&(C?this._onMeshTargetChangedObserver=M.onMeshTargetChangedObservable.add((C=>{if(C&&(C.Be(!0),C.getBoundingInfo)){const M=C.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*M,this.upperRadiusTransitionRange=.05*M}})):this._onMeshTargetChangedObserver&&M.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(C){this._attachedCamera=C,this._onAfterCheckInputsObserver=C.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(C){return!!this._attachedCamera&&(this._attachedCamera.i===C&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(C){if(!this._attachedCamera)return;this._radiusBounceTransition||(D.EasingFunction.setEasingMode(D.EasingMode),this._radiusBounceTransition=d.b.CreateAnimation("i",d.b.ANIMATIONTYPE_FLOAT,60,D.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const M=d.b.TransitionTo("i",this._attachedCamera.i+C,this._attachedCamera,this._attachedCamera.va(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));M&&this._animatables.push(M)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}D.EasingFunction=new class extends O{constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=C}easeInCore(C){const M=Math.max(0,this.amplitude);return Math.pow(C,3)-C*M*Math.sin(3.141592653589793*C)}}(.3),D.EasingMode=O.EASINGMODE_EASEOUT;class o{constructor(){this.onTargetFramingAnimationEndObservable=new z.c,this._mode=o.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(C){this._mode=C}get mode(){return this._mode}set radiusScale(C){this._radiusScale=C}get radiusScale(){return this._radiusScale}set positionScale(C){this._positionScale=C}get positionScale(){return this._positionScale}set defaultElevation(C){this._defaultElevation=C}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(C){this._elevationReturnTime=C}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(C){this._elevationReturnWaitTime=C}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(C){this._zoomStopsAnimation=C}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(C){this._framingTime=C}get framingTime(){return this._framingTime}init(){}attach(C){this._attachedCamera=C;const M=this._attachedCamera.va();o.EasingFunction.setEasingMode(o.EasingMode),this._onPrePointerObservableObserver=M.onPrePointerObservable.add((C=>{C.type!==Q.c.POINTERDOWN?C.type===Q.c.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=C.onMeshTargetChangedObservable.add((C=>{C&&C.getBoundingInfo&&this.zoomOnMesh(C,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=C.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const C=this._attachedCamera.va();this._onPrePointerObservableObserver&&C.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(C){let M=arguments.length>1&&void 0!==arguments[1]&&arguments[1],x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;C.Be(!0);const f=C.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(f.minimumWorld,f.maximumWorld,M,x)}zoomOnMeshHierarchy(C){let M=arguments.length>1&&void 0!==arguments[1]&&arguments[1],x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;C.Be(!0);const f=C.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(f.min,f.max,M,x)}zoomOnMeshesHierarchy(C){let M=arguments.length>1&&void 0!==arguments[1]&&arguments[1],x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const f=new s.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),T=new s.m(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let z=0;z<C.length;z++){const M=C[z].getHierarchyBoundingVectors(!0);s.m.CheckExtends(M.min,f,T),s.m.CheckExtends(M.max,f,T)}this.zoomOnBoundingInfo(f,T,M,x)}zoomOnBoundingInfo(C,M){let x,f=arguments.length>2&&void 0!==arguments[2]&&arguments[2],T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const z=C.y,S=z+(M.y-z)*this._positionScale,m=M.rc(C).scale(.5);if(f)x=new s.m(0,S,0);else{const M=C.add(m);x=new s.m(M.x,S,M.z)}this._vectorTransition||(this._vectorTransition=d.b.CreateAnimation("target",d.b.ANIMATIONTYPE_VECTOR3,60,o.EasingFunction)),this._betaIsAnimating=!0;let Q=d.b.TransitionTo("target",x,this._attachedCamera,this._attachedCamera.va(),60,this._vectorTransition,this._framingTime);Q&&this._animatables.push(Q);let V=0;if(this._mode===o.FitFrustumSidesMode){const x=this._calculateLowerRadiusFromModelBoundingSphere(C,M);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=m.length()+this._attachedCamera.lj),V=x}else this._mode===o.IgnoreBoundsSizeMode&&(V=this._calculateLowerRadiusFromModelBoundingSphere(C,M),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.lj));if(this.autoCorrectCameraLimitsAndSensibility){const x=M.rc(C).length();this._attachedCamera.panningSensibility=5e3/x,this._attachedCamera.wheelPrecision=100/V}return this._radiusTransition||(this._radiusTransition=d.b.CreateAnimation("i",d.b.ANIMATIONTYPE_FLOAT,60,o.EasingFunction)),Q=d.b.TransitionTo("i",V,this._attachedCamera,this._attachedCamera.va(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),T&&T(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),Q&&this._animatables.push(Q),!0}_calculateLowerRadiusFromModelBoundingSphere(C,M){const x=this._attachedCamera;if(!x)return 0;let f=x._calculateLowerRadiusFromModelBoundingSphere(C,M,this._radiusScale);return x.lowerRadiusLimit&&this._mode===o.IgnoreBoundsSizeMode&&(f=f<x.lowerRadiusLimit?x.lowerRadiusLimit:f),x.upperRadiusLimit&&(f=f>x.upperRadiusLimit?x.upperRadiusLimit:f),f}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const C=V.e.Now-this._lastInteractionTime,M=.5*Math.PI-this._defaultElevation,x=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>x&&C>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=d.b.CreateAnimation("beta",d.b.ANIMATIONTYPE_FLOAT,60,o.EasingFunction));const C=d.b.TransitionTo("beta",M,this._attachedCamera,this._attachedCamera.va(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));C&&this._animatables.push(C)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=V.e.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}o.EasingFunction=new class extends O{constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=C}easeInCore(C){return this.exponent<=0?C:(Math.exp(this.exponent*C)-1)/(Math.exp(this.exponent)-1)}},o.EasingMode=O.EASINGMODE_EASEINOUT,o.IgnoreBoundsSizeMode=0,o.FitFrustumSidesMode=1;var L=x(11726),t=x(12314),A=x(12316),H=x(1192);class j{constructor(){this._currentActiveButton=-1,this.buttons=[0,1,2]}attachControl(C){C=H.i.BackCompatCameraNoPreventDefault(arguments);const M=this.camera.getEngine(),x=M.getInputElement();let f=0,T=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=z=>{var s,S;const m=z.event,V="touch"===m.pointerType;if(z.type!==Q.c.POINTERMOVE&&-1===this.buttons.indexOf(m.button))return;const y=m.target;if(this._altKey=m.altKey,this._ctrlKey=m.ctrlKey,this._metaKey=m.metaKey,this._shiftKey=m.shiftKey,this._buttonsPressed=m.buttons,M.isPointerLock){const C=m.movementX,M=m.movementY;this.onTouch(null,C,M),this._pointA=null,this._pointB=null}else{if(z.type!==Q.c.POINTERDOWN&&z.type!==Q.c.POINTERDOUBLETAP&&V&&(null===(s=this._pointA)||void 0===s?void 0:s.pointerId)!==m.pointerId&&(null===(S=this._pointB)||void 0===S?void 0:S.pointerId)!==m.pointerId)return;if(z.type!==Q.c.POINTERDOWN||-1!==this._currentActiveButton&&!V)if(z.type===Q.c.POINTERDOUBLETAP)this.onDoubleTap(m.pointerType);else if(z.type!==Q.c.POINTERUP||this._currentActiveButton!==m.button&&!V){if(z.type===Q.c.POINTERMOVE)if(C||m.preventDefault(),this._pointA&&null===this._pointB){const C=m.clientX-this._pointA.x,M=m.clientY-this._pointA.y;this._pointA.x=m.clientX,this._pointA.y=m.clientY,this.onTouch(this._pointA,C,M)}else if(this._pointA&&this._pointB){const C=this._pointA.pointerId===m.pointerId?this._pointA:this._pointB;C.x=m.clientX,C.y=m.clientY;const M=this._pointA.x-this._pointB.x,x=this._pointA.y-this._pointB.y,s=M*M+x*x,S={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:m.pointerId,type:z.type};this.onMultiTouch(this._pointA,this._pointB,f,s,T,S),T=S,f=s}}else{try{null===y||void 0===y||y.releasePointerCapture(m.pointerId)}catch(U){}V||(this._pointB=null),M._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==m.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==m.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==f||T)&&(this.onMultiTouch(this._pointA,this._pointB,f,0,T,null),f=0,T=null),this._currentActiveButton=-1,this.onButtonUp(m),C||m.preventDefault()}else{try{null===y||void 0===y||y.setPointerCapture(m.pointerId)}catch(U){}if(null===this._pointA)this._pointA={x:m.clientX,y:m.clientY,pointerId:m.pointerId,type:m.pointerType};else{if(null!==this._pointB)return;this._pointB={x:m.clientX,y:m.clientY,pointerId:m.pointerId,type:m.pointerType}}-1!==this._currentActiveButton||V||(this._currentActiveButton=m.button),this.onButtonDown(m),C||(m.preventDefault(),x&&x.focus())}}},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,Q.c.POINTERDOWN|Q.c.POINTERUP|Q.c.POINTERMOVE|Q.c.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,f=0,T=null,this.onLostFocus()},this._contextMenuBind=C=>this.onContextMenu(C),x&&x.addEventListener("contextmenu",this._contextMenuBind,!1);const z=this.camera.va().getEngine().getHostWindow();z&&H.i.RegisterTopRootEvents(z,[{name:"blur",handler:this._onLostFocus}])}ke(){if(this._onLostFocus){const C=this.camera.va().getEngine().getHostWindow();C&&H.i.UnregisterTopRootEvents(C,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const C=this.camera.va().getEngine().getInputElement();C&&C.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentActiveButton=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(C){}onTouch(C,M,x){}onMultiTouch(C,M,x,f,T,z){}onContextMenu(C){C.preventDefault()}onButtonDown(C){}onButtonUp(C){}onLostFocus(){}}(0,f.e)([(0,T.J)()],j.prototype,"buttons",void 0);class b extends j{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(C,M){if(0!==this.panningSensibility&&C&&M){const x=M.x-C.x,f=M.y-C.y;this.camera.inertialPanningX+=-x/this.panningSensibility,this.camera.inertialPanningY+=f/this.panningSensibility}}_computePinchZoom(C,M){const x=this.camera.i||b.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.i=x*Math.sqrt(C)/Math.sqrt(M):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(M-C)*x*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(M-C)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(C,M,x){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-M/this.panningSensibility,this.camera.inertialPanningY+=x/this.panningSensibility):(this.camera.inertialAlphaOffset-=M/this.angularSensibilityX,this.camera.inertialBetaOffset-=x/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(C,M,x,f,T,z){0===x&&null===T||0===f&&null===z||(this.multiTouchPanAndZoom?(this._computePinchZoom(x,f),this._computeMultiTouchPanning(T,z)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(f)-Math.sqrt(x))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(x,f),this._isPinching=!0):this._computeMultiTouchPanning(T,z)):this.multiTouchPanning?this._computeMultiTouchPanning(T,z):this.pinchZoom&&this._computePinchZoom(x,f))}onButtonDown(C){this._isPanClick=C.button===this.camera._panningMouseButton}onButtonUp(C){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}b.MinimumRadiusForPinch=.001,(0,f.e)([(0,T.J)()],b.prototype,"buttons",void 0),(0,f.e)([(0,T.J)()],b.prototype,"angularSensibilityX",void 0),(0,f.e)([(0,T.J)()],b.prototype,"angularSensibilityY",void 0),(0,f.e)([(0,T.J)()],b.prototype,"pinchPrecision",void 0),(0,f.e)([(0,T.J)()],b.prototype,"pinchDeltaPercentage",void 0),(0,f.e)([(0,T.J)()],b.prototype,"useNaturalPinchZoom",void 0),(0,f.e)([(0,T.J)()],b.prototype,"pinchZoom",void 0),(0,f.e)([(0,T.J)()],b.prototype,"panningSensibility",void 0),(0,f.e)([(0,T.J)()],b.prototype,"multiTouchPanning",void 0),(0,f.e)([(0,T.J)()],b.prototype,"multiTouchPanAndZoom",void 0),A.d.ArcRotateCameraPointersInput=b;var R=x(1250);class n{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(C){C=H.i.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((M=>{const x=M.event;if(!x.metaKey)if(M.type===R.c.KEYDOWN){if(this._ctrlPressed=x.ctrlKey,this._altPressed=x.altKey,-1!==this.keysUp.indexOf(x.keyCode)||-1!==this.keysDown.indexOf(x.keyCode)||-1!==this.keysLeft.indexOf(x.keyCode)||-1!==this.keysRight.indexOf(x.keyCode)||-1!==this.keysReset.indexOf(x.keyCode)){-1===this._keys.indexOf(x.keyCode)&&this._keys.push(x.keyCode),x.preventDefault&&(C||x.preventDefault())}}else if(-1!==this.keysUp.indexOf(x.keyCode)||-1!==this.keysDown.indexOf(x.keyCode)||-1!==this.keysLeft.indexOf(x.keyCode)||-1!==this.keysRight.indexOf(x.keyCode)||-1!==this.keysReset.indexOf(x.keyCode)){const M=this._keys.indexOf(x.keyCode);M>=0&&this._keys.splice(M,1),x.preventDefault&&(C||x.preventDefault())}})))}ke(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const C=this.camera;for(let M=0;M<this._keys.length;M++){const x=this._keys[M];-1!==this.keysLeft.indexOf(x)?this._ctrlPressed&&this.camera._useCtrlForPanning?C.inertialPanningX-=1/this.panningSensibility:C.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(x)?this._ctrlPressed&&this.camera._useCtrlForPanning?C.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?C.inertialRadiusOffset+=1/this.zoomingSensibility:C.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(x)?this._ctrlPressed&&this.camera._useCtrlForPanning?C.inertialPanningX+=1/this.panningSensibility:C.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(x)?this._ctrlPressed&&this.camera._useCtrlForPanning?C.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?C.inertialRadiusOffset-=1/this.zoomingSensibility:C.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(x)&&C.useInputToRestoreState&&C.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,f.e)([(0,T.J)()],n.prototype,"keysUp",void 0),(0,f.e)([(0,T.J)()],n.prototype,"keysDown",void 0),(0,f.e)([(0,T.J)()],n.prototype,"keysLeft",void 0),(0,f.e)([(0,T.J)()],n.prototype,"keysRight",void 0),(0,f.e)([(0,T.J)()],n.prototype,"keysReset",void 0),(0,f.e)([(0,T.J)()],n.prototype,"panningSensibility",void 0),(0,f.e)([(0,T.J)()],n.prototype,"zoomingSensibility",void 0),(0,f.e)([(0,T.J)()],n.prototype,"useAltToZoom",void 0),(0,f.e)([(0,T.J)()],n.prototype,"angularSpeed",void 0),A.d.ArcRotateCameraKeyboardMoveInput=n;var I=x(1176),X=x(1257),g=x(1015);class B{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new s.m(0,0,0),this._globalOffset=new s.m(0,0,0),this._inertialPanning=s.m.Zero()}_computeDeltaFromMouseWheelLegacyEvent(C,M){let x=0;const f=.01*C*this.wheelDeltaPercentage*M;return x=C>0?f/(1+this.wheelDeltaPercentage):f*(1+this.wheelDeltaPercentage),x}attachControl(C){C=H.i.BackCompatCameraNoPreventDefault(arguments),this._wheel=M=>{if(M.type!==Q.c.POINTERWHEEL)return;const x=M.event;let f=0;const T=x.deltaMode===X.c.DOM_DELTA_LINE?40:1,z=-x.deltaY*T;if(this.customComputeDeltaFromMouseWheel)f=this.customComputeDeltaFromMouseWheel(z,this,x);else if(this.wheelDeltaPercentage){if(f=this._computeDeltaFromMouseWheelLegacyEvent(z,this.camera.i),f>0){let C=this.camera.i,M=this.camera.inertialRadiusOffset+f;for(let x=0;x<20&&Math.abs(M)>.001;x++)C-=M,M*=this.camera.inertia;C=(0,g.d)(C,0,Number.MAX_VALUE),f=this._computeDeltaFromMouseWheelLegacyEvent(z,C)}}else f=z/(40*this.wheelPrecision);f&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(f)):this.camera.inertialRadiusOffset+=f),x.preventDefault&&(C||x.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,Q.c.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.Kd(0)}ke(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const C=this.camera;0+C.inertialAlphaOffset+C.inertialBetaOffset+C.inertialRadiusOffset&&(this._updateHitPlane(),C.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(C.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const C=this.camera,M=C.target.rc(C.position);this._hitPlane=I.d.FromPositionAndNormal(C.target,M)}_getPosition(){const C=this.camera,M=C.va(),x=M.createPickingRay(M.pointerX,M.pointerY,s.d.Identity(),C,!1);0===C.targetScreenOffset.x&&0===C.targetScreenOffset.y||(this._viewOffset.set(C.targetScreenOffset.x,C.targetScreenOffset.y,0),C.getViewMatrix().invertToRef(C._cameraTransformMatrix),this._globalOffset=s.m.TransformNormal(this._viewOffset,C._cameraTransformMatrix),x.origin.addInPlace(this._globalOffset));let f=0;return this._hitPlane&&(f=x.intersectsPlane(this._hitPlane)??0),x.origin.addInPlace(x.direction.scaleInPlace(f))}_zoomToMouse(C){const M=this.camera,x=1-M.inertia;if(M.lowerRadiusLimit){const f=M.lowerRadiusLimit??0;M.i-(M.inertialRadiusOffset+C)/x<f&&(C=(M.i-f)*x-M.inertialRadiusOffset)}if(M.upperRadiusLimit){const f=M.upperRadiusLimit??0;M.i-(M.inertialRadiusOffset+C)/x>f&&(C=(M.i-f)*x-M.inertialRadiusOffset)}const f=C/x/M.i,T=this._getPosition(),z=s.i.Md[6];T.subtractToRef(M.target,z),z.scaleInPlace(f),z.scaleInPlace(x),this._inertialPanning.addInPlace(z),M.inertialRadiusOffset+=C}_zeroIfClose(C){Math.abs(C.x)<y.c&&(C.x=0),Math.abs(C.y)<y.c&&(C.y=0),Math.abs(C.z)<y.c&&(C.z=0)}}(0,f.e)([(0,T.J)()],B.prototype,"wheelPrecision",void 0),(0,f.e)([(0,T.J)()],B.prototype,"zoomToMouseLocation",void 0),(0,f.e)([(0,T.J)()],B.prototype,"wheelDeltaPercentage",void 0),A.d.ArcRotateCameraMouseWheelInput=B;class F extends A.f{constructor(C){super(C)}addMouseWheel(){return this.add(new B),this}addPointers(){return this.add(new b),this}addKeyboard(){return this.add(new n),this}}var P=x(997);S.e.AddNodeConstructor("ArcRotateCamera",((C,M)=>()=>new h(C,0,0,1,s.m.Zero(),M)));class h extends t.c{get target(){return this._target}set target(C){this.setTarget(C)}get targetHost(){return this._targetHost}set targetHost(C){C&&this.setTarget(C)}getTarget(){return this.target}get position(){return this._position}set position(C){this.setPosition(C)}set upVector(C){this._upToYMatrix||(this._yToUpMatrix=new s.d,this._upToYMatrix=new s.d,this._upVector=s.m.Zero()),C.normalize(),this._upVector.p(C),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){s.d.RotationAlignToRef(s.m.UpReadOnly,this._upVector,this._yToUpMatrix),s.d.RotationAlignToRef(this._upVector,s.m.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const C=this.inputs.attached.pointers;return C?C.angularSensibilityX:0}set angularSensibilityX(C){const M=this.inputs.attached.pointers;M&&(M.angularSensibilityX=C)}get angularSensibilityY(){const C=this.inputs.attached.pointers;return C?C.angularSensibilityY:0}set angularSensibilityY(C){const M=this.inputs.attached.pointers;M&&(M.angularSensibilityY=C)}get pinchPrecision(){const C=this.inputs.attached.pointers;return C?C.pinchPrecision:0}set pinchPrecision(C){const M=this.inputs.attached.pointers;M&&(M.pinchPrecision=C)}get pinchDeltaPercentage(){const C=this.inputs.attached.pointers;return C?C.pinchDeltaPercentage:0}set pinchDeltaPercentage(C){const M=this.inputs.attached.pointers;M&&(M.pinchDeltaPercentage=C)}get useNaturalPinchZoom(){const C=this.inputs.attached.pointers;return!!C&&C.useNaturalPinchZoom}set useNaturalPinchZoom(C){const M=this.inputs.attached.pointers;M&&(M.useNaturalPinchZoom=C)}get panningSensibility(){const C=this.inputs.attached.pointers;return C?C.panningSensibility:0}set panningSensibility(C){const M=this.inputs.attached.pointers;M&&(M.panningSensibility=C)}get keysUp(){const C=this.inputs.attached.keyboard;return C?C.keysUp:[]}set keysUp(C){const M=this.inputs.attached.keyboard;M&&(M.keysUp=C)}get keysDown(){const C=this.inputs.attached.keyboard;return C?C.keysDown:[]}set keysDown(C){const M=this.inputs.attached.keyboard;M&&(M.keysDown=C)}get keysLeft(){const C=this.inputs.attached.keyboard;return C?C.keysLeft:[]}set keysLeft(C){const M=this.inputs.attached.keyboard;M&&(M.keysLeft=C)}get keysRight(){const C=this.inputs.attached.keyboard;return C?C.keysRight:[]}set keysRight(C){const M=this.inputs.attached.keyboard;M&&(M.keysRight=C)}get wheelPrecision(){const C=this.inputs.attached.mousewheel;return C?C.wheelPrecision:0}set wheelPrecision(C){const M=this.inputs.attached.mousewheel;M&&(M.wheelPrecision=C)}get zoomToMouseLocation(){const C=this.inputs.attached.mousewheel;return!!C&&C.zoomToMouseLocation}set zoomToMouseLocation(C){const M=this.inputs.attached.mousewheel;M&&(M.zoomToMouseLocation=C)}get wheelDeltaPercentage(){const C=this.inputs.attached.mousewheel;return C?C.wheelDeltaPercentage:0}set wheelDeltaPercentage(C){const M=this.inputs.attached.mousewheel;M&&(M.wheelDeltaPercentage=C)}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(C){C!==this.useBouncingBehavior&&(C?(this._bouncingBehavior=new D,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(C){C!==this.useFramingBehavior&&(C?(this._framingBehavior=new o,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(C){C!==this.useAutoRotationBehavior&&(C?(this._autoRotationBehavior=new U,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(C,M,x,f,T,S){var m;let Q=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(C,s.m.Zero(),S,Q),m=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=s.m.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=s.j.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._viewMatrix=new s.d,this.panningAxis=new s.m(1,1,0),this._transformedDirection=new s.m,this.mapPanning=!1,this._progressiveRestore=!1,this.onMeshTargetChangedObservable=new z.c,this.checkCollisions=!1,this.collisionRadius=new s.m(.5,.5,.5),this._previousPosition=s.m.Zero(),this._collisionVelocity=s.m.Zero(),this._newPosition=s.m.Zero(),this._computationVector=s.m.Zero(),this._onCollisionPositionChange=function(C,M){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;x?(m.setPosition(M),m.Pk&&m.Pk(x)):m._previousPosition.p(m._position);const f=Math.cos(m.alpha),T=Math.sin(m.alpha),z=Math.cos(m.beta);let s=Math.sin(m.beta);0===s&&(s=1e-4);const S=m._getTargetPosition();m._computationVector.Hd(m.i*f*s,m.i*z,m.i*T*s),S.addToRef(m._computationVector,m._newPosition),m._position.p(m._newPosition);let Q=m.upVector;m.allowUpsideDown&&m.beta<0&&(Q=Q.clone(),Q=Q.negate()),m._computeViewMatrix(m._position,S,Q),m._viewMatrix.addAtIndex(12,m.targetScreenOffset.x),m._viewMatrix.addAtIndex(13,m.targetScreenOffset.y),m._collisionTriggered=!1},this._target=s.m.Zero(),T&&this.setTarget(T),this.alpha=M,this.beta=x,this.i=f,this.getViewMatrix(),this.inputs=new F(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new s.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.i=void 0,this._cache.targetScreenOffset=s.j.Zero()}_updateCache(C){C||super._updateCache(),this._cache._target.p(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.i=this.i,this._cache.targetScreenOffset.p(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const C=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?C.addToRef(this._targetBoundingCenter,this._target):this._target.p(C)}const C=this._getLockedTargetPosition();return C||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.i,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>y.c&&this.restoreStateInterpolationFactor<1?(this._progressiveRestore=!0,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.i=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.i===this.i&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(C,M){let x=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const T=arguments;M=H.i.BackCompatCameraNoPreventDefault(T),this._useCtrlForPanning=x,this._panningMouseButton=f,"boolean"===typeof T[0]&&(T.length>1&&(this._useCtrlForPanning=T[1]),T.length>2&&(this._panningMouseButton=T[2])),this.inputs.attachElement(M),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}ke(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),this._progressiveRestore){const C=this._scene.getEngine().getDeltaTime()/1e3,M=1-Math.pow(2,-C/this.restoreStateInterpolationFactor);this.setTarget(s.m.Lerp(this.getTarget(),this._storedTarget,M)),s.h.RotationAlphaBetaGammaToRef(this._storedAlpha,this._storedBeta,0,s.i.Quaternion[0]),s.h.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,s.i.Quaternion[1]),s.h.SlerpToRef(s.i.Quaternion[1],s.i.Quaternion[0],M,s.i.Quaternion[2]),s.i.Quaternion[2].normalize(),s.i.Quaternion[2].toAlphaBetaGammaToRef(s.i.Md[0]),this.alpha=s.i.Md[0].x,this.beta=s.i.Md[0].y,this.i+=(this._storedRadius-this.i)*M,s.j.LerpToRef(this.targetScreenOffset,this._storedTargetScreenOffset,M,this.targetScreenOffset),(s.m.DistanceSquared(this.getTarget(),this._storedTarget)<y.c&&s.i.Quaternion[2].equalsWithEpsilon(s.i.Quaternion[0])&&Math.pow(this._storedRadius-this.i,2)<y.c&&s.j.Distance(this.targetScreenOffset,this._storedTargetScreenOffset)<y.c||0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset||0!==this.inertialPanningX||0!==this.inertialPanningY)&&(this._progressiveRestore=!1)}if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){const C=this.invertRotation?-1:1,M=this._calculateHandednessMultiplier();let x=this.inertialAlphaOffset*M;this.beta<0&&(x*=-1),this.alpha+=x*C,this.beta+=this.inertialBetaOffset*C,this.i-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<y.c&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<y.c&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*y.c&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){const C=new s.m(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),C.multiplyInPlace(this.panningAxis),s.m.TransformNormalToRef(C,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const C=this.upVector,M=s.m.CrossToRef(this._transformedDirection,C,this._transformedDirection);s.m.CrossToRef(C,M,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);s.m.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.p(this._transformedDirection)}else{if(this.parent){const C=s.i.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(C),C.transposeToRef(C),s.m.TransformCoordinatesToRef(this._transformedDirection,C,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*y.c&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*y.c&&(this.inertialPanningY=0)}this._checkLimits(),super._checkInputs()}}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.i<this.lowerRadiusLimit&&(this.i=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.i>this.upperRadiusLimit&&(this.i=this.upperRadiusLimit,this.inertialRadiusOffset=0)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||s.m.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.i=this._computationVector.length(),0===this.i&&(this.i=1e-4);const C=this.alpha;0===this._computationVector.x&&0===this._computationVector.z?this.alpha=Math.PI/2:this.alpha=Math.acos(this._computationVector.x/Math.sqrt(Math.pow(this._computationVector.x,2)+Math.pow(this._computationVector.z,2))),this._computationVector.z<0&&(this.alpha=2*Math.PI-this.alpha);const M=Math.round((C-this.alpha)/(2*Math.PI));this.alpha+=2*M*Math.PI,this.beta=Math.acos(this._computationVector.y/this.i),this._checkLimits()}setPosition(C){this._position.equals(C)||(this._position.p(C),this.rebuildAnglesAndRadius())}setTarget(C){let M=arguments.length>1&&void 0!==arguments[1]&&arguments[1],x=arguments.length>2&&void 0!==arguments[2]&&arguments[2],f=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(f=this.overrideCloneAlphaBetaRadius??f,C.Be)M&&C.getBoundingInfo?this._targetBoundingCenter=C.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,C.Be(),this._targetHost=C,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const M=C,f=this._getTargetPosition();if(f&&!x&&f.equals(M))return;this._targetHost=null,this._target=M,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}f||this.rebuildAnglesAndRadius()}_getViewMatrix(){const C=Math.cos(this.alpha),M=Math.sin(this.alpha),x=Math.cos(this.beta);let f=Math.sin(this.beta);0===f&&(f=1e-4),0===this.i&&(this.i=1e-4);const T=this._getTargetPosition();if(this._computationVector.Hd(this.i*C*f,this.i*x,this.i*M*f),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||s.m.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),T.addToRef(this._computationVector,this._newPosition),this.va().collisionsEnabled&&this.checkCollisions){const C=this.va().collisionCoordinator;this._collider||(this._collider=C.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,C.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.p(this._newPosition);let C=this.upVector;this.allowUpsideDown&&f<0&&(C=C.negate()),this._computeViewMatrix(this._position,T,C),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget=T,this._viewMatrix}zoomOn(C){let M=arguments.length>1&&void 0!==arguments[1]&&arguments[1];C=C||this.va().meshes;const x=m.d.MinMax(C);let f=this._calculateLowerRadiusFromModelBoundingSphere(x.min,x.max);f=Math.max(Math.min(f,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.i=f*this.zoomOnFactor,this.focusOn({min:x.min,max:x.max,distance:f},M)}focusOn(C){let M,x,f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===C.min){const f=C||this.va().meshes;M=m.d.MinMax(f),x=s.m.Distance(M.min,M.max)}else{M=C,x=C.distance}this._target=m.d.Center(M),f||(this.maxZ=2*x)}createRigCamera(C,M){let x=0;switch(this.cameraRigMode){case L.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case L.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case L.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case L.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case L.c.RIG_MODE_VR:x=this._cameraRigParams.stereoHalfAngle*(0===M?1:-1);break;case L.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:x=this._cameraRigParams.stereoHalfAngle*(0===M?-1:1)}const f=new h(C,this.alpha+x,this.beta,this.i,this._target,this.va());return f._cameraRigParams={},f.isRigCamera=!0,f.rigParent=this,f.upVector=this.upVector,f.mode=this.mode,f.orthoLeft=this.orthoLeft,f.orthoRight=this.orthoRight,f.orthoBottom=this.orthoBottom,f.orthoTop=this.orthoTop,f}_updateRigCameras(){const C=this._rigCameras[0],M=this._rigCameras[1];switch(C.beta=M.beta=this.beta,this.cameraRigMode){case L.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case L.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case L.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case L.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case L.c.RIG_MODE_VR:C.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,M.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case L.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:C.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,M.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(C,M){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const f=s.m.Distance(C,M),T=this.va().getEngine().getAspectRatio(this),z=Math.tan(this.fov/2),S=z*T,m=.5*f*x,Q=m*Math.sqrt(1+1/(S*S)),V=m*Math.sqrt(1+1/(z*z));return Math.max(Q,V)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,f.e)([(0,T.J)()],h.prototype,"alpha",void 0),(0,f.e)([(0,T.J)()],h.prototype,"beta",void 0),(0,f.e)([(0,T.J)()],h.prototype,"i",void 0),(0,f.e)([(0,T.J)()],h.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,f.e)([(0,T.H)("target")],h.prototype,"_target",void 0),(0,f.e)([(0,T.u)("targetHost")],h.prototype,"_targetHost",void 0),(0,f.e)([(0,T.J)()],h.prototype,"inertialAlphaOffset",void 0),(0,f.e)([(0,T.J)()],h.prototype,"inertialBetaOffset",void 0),(0,f.e)([(0,T.J)()],h.prototype,"inertialRadiusOffset",void 0),(0,f.e)([(0,T.J)()],h.prototype,"lowerAlphaLimit",void 0),(0,f.e)([(0,T.J)()],h.prototype,"upperAlphaLimit",void 0),(0,f.e)([(0,T.J)()],h.prototype,"lowerBetaLimit",void 0),(0,f.e)([(0,T.J)()],h.prototype,"upperBetaLimit",void 0),(0,f.e)([(0,T.J)()],h.prototype,"lowerRadiusLimit",void 0),(0,f.e)([(0,T.J)()],h.prototype,"upperRadiusLimit",void 0),(0,f.e)([(0,T.J)()],h.prototype,"inertialPanningX",void 0),(0,f.e)([(0,T.J)()],h.prototype,"inertialPanningY",void 0),(0,f.e)([(0,T.J)()],h.prototype,"pinchToPanMaxDistance",void 0),(0,f.e)([(0,T.J)()],h.prototype,"panningDistanceLimit",void 0),(0,f.e)([(0,T.H)()],h.prototype,"panningOriginTarget",void 0),(0,f.e)([(0,T.J)()],h.prototype,"panningInertia",void 0),(0,f.e)([(0,T.J)()],h.prototype,"zoomToMouseLocation",null),(0,f.e)([(0,T.J)()],h.prototype,"zoomOnFactor",void 0),(0,f.e)([(0,T.E)()],h.prototype,"targetScreenOffset",void 0),(0,f.e)([(0,T.J)()],h.prototype,"allowUpsideDown",void 0),(0,f.e)([(0,T.J)()],h.prototype,"useInputToRestoreState",void 0),(0,f.e)([(0,T.J)()],h.prototype,"restoreStateInterpolationFactor",void 0),(0,P.f)("BABYLON.ArcRotateCamera",h)},11726:(C,M,x)=>{"use strict";x.d(M,{c:()=>o});var f=x(951),T=x(959),z=x(1188),s=x(1192),S=x(971),m=x(978),Q=x(11734),V=x(1078),y=x(997),U=x(1067),O=x(1459),d=x(1273),D=x(1145);class o extends Q.e{get position(){return this._position}set position(C){this._position=C}set upVector(C){this._upVector=C}get upVector(){return this._upVector}get screenArea(){let C=0,M=0;if(this.mode===o.PERSPECTIVE_CAMERA)this.fovMode===o.FOVMODE_VERTICAL_FIXED?(M=2*this.lj*Math.tan(this.fov/2),C=this.getEngine().getAspectRatio(this)*M):(C=2*this.lj*Math.tan(this.fov/2),M=C/this.getEngine().getAspectRatio(this));else{const x=this.getEngine().getRenderWidth()/2,f=this.getEngine().getRenderHeight()/2;C=(this.orthoRight??x)-(this.orthoLeft??-x),M=(this.orthoTop??f)-(this.orthoBottom??-f)}return C*M}set orthoLeft(C){this._orthoLeft=C;for(const M of this._rigCameras)M.orthoLeft=C}get orthoLeft(){return this._orthoLeft}set orthoRight(C){this._orthoRight=C;for(const M of this._rigCameras)M.orthoRight=C}get orthoRight(){return this._orthoRight}set orthoBottom(C){this._orthoBottom=C;for(const M of this._rigCameras)M.orthoBottom=C}get orthoBottom(){return this._orthoBottom}set orthoTop(C){this._orthoTop=C;for(const M of this._rigCameras)M.orthoTop=C}get orthoTop(){return this._orthoTop}set mode(C){this._mode=C;for(const M of this._rigCameras)M.mode=C}get mode(){return this._mode}get hasMoved(){return this._hasMoved}constructor(C,M,x){let f=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];super(C,x,!1),this._position=m.m.Zero(),this._upVector=m.m.Up(),this.oblique=null,this._orthoLeft=null,this._orthoRight=null,this._orthoBottom=null,this._orthoTop=null,this.fov=.8,this.projectionPlaneTilt=0,this.lj=1,this.maxZ=1e4,this.inertia=.9,this._mode=o.PERSPECTIVE_CAMERA,this.isIntermediate=!1,this.viewport=new O.b(0,0,1,1),this.layerMask=268435455,this.fovMode=o.FOVMODE_VERTICAL_FIXED,this.cameraRigMode=o.RIG_MODE_NONE,this.customRenderTargets=[],this.outputRenderTarget=null,this.onViewMatrixChangedObservable=new S.c,this.onProjectionMatrixChangedObservable=new S.c,this.onAfterCheckInputsObservable=new S.c,this.onRestoreStateObservable=new S.c,this.isRigCamera=!1,this._hasMoved=!1,this._rigCameras=new Array,this._skipRendering=!1,this._projectionMatrix=new m.d,this._postProcesses=new Array,this._activeMeshes=new z.e(256),this._globalPosition=m.m.Zero(),this._computedViewMatrix=m.d.Identity(),this._doNotComputeProjectionMatrix=!1,this._transformMatrix=m.d.Zero(),this._refreshFrustumPlanes=!0,this._absoluteRotation=m.h.Identity(),this._isCamera=!0,this._isLeftCamera=!1,this._isRightCamera=!1,this.va().addCamera(this),f&&!this.va().activeCamera&&(this.va().activeCamera=this),this.position=M,this.renderPassId=this.va().getEngine().createRenderPassId(`Camera ${C}`)}storeState(){return this._stateStored=!0,this._storedFov=this.fov,this}hasStateStored(){return!!this._stateStored}_restoreStateValues(){return!!this._stateStored&&(this.fov=this._storedFov,!0)}restoreState(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)}getClassName(){return"Yh"}toString(C){let M="Name: "+this.name;if(M+=", type: "+this.getClassName(),this.animations)for(let x=0;x<this.animations.length;x++)M+=", animation[0]: "+this.animations[x].toString(C);return M}applyVerticalCorrection(){const C=this.absoluteRotation.toEulerAngles();this.projectionPlaneTilt=this._scene.useRightHandedSystem?-C.x:C.x}get globalPosition(){return this._globalPosition}getActiveMeshes(){return this._activeMeshes}isActiveMesh(C){return-1!==this._activeMeshes.indexOf(C)}isReady(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(C)for(const M of this._postProcesses)if(M&&!M.isReady())return!1;return super.isReady(C)}_initCache(){super._initCache(),this._cache.position=new m.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new m.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.lj=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.obliqueAngle=void 0,this._cache.obliqueLength=void 0,this._cache.obliqueOffset=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0}_updateCache(C){C||super._updateCache(),this._cache.position.p(this.position),this._cache.upVector.p(this.upVector)}_isSynchronized(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()}_isSynchronizedViewMatrix(){return!!super._isSynchronized()&&(this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent())}_isSynchronizedProjectionMatrix(){let C=this._cache.mode===this.mode&&this._cache.lj===this.lj&&this._cache.maxZ===this.maxZ;if(!C)return!1;const M=this.getEngine();return this.mode===o.PERSPECTIVE_CAMERA?C=this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===M.getAspectRatio(this)&&this._cache.projectionPlaneTilt===this.projectionPlaneTilt:(C=this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===M.getRenderWidth()&&this._cache.renderHeight===M.getRenderHeight(),this.oblique&&(C=C&&this._cache.obliqueAngle===this.oblique.angle&&this._cache.obliqueLength===this.oblique.length&&this._cache.obliqueOffset===this.oblique.offset)),C}attachControl(C,M){}ke(C){}update(){this._hasMoved=!1,this._checkInputs(),this.cameraRigMode!==o.RIG_MODE_NONE&&this._updateRigCameras(),this.getViewMatrix(),this.getProjectionMatrix()}_checkInputs(){this.onAfterCheckInputsObservable.notifyObservers(this)}get rigCameras(){return this._rigCameras}get rigPostProcess(){return this._rigPostProcess}_getFirstPostProcess(){for(let C=0;C<this._postProcesses.length;C++)if(null!==this._postProcesses[C])return this._postProcesses[C];return null}_cascadePostProcessesToRigCams(){const C=this._getFirstPostProcess();C&&C.markTextureDirty();for(let M=0,x=this._rigCameras.length;M<x;M++){const C=this._rigCameras[M],x=C._rigPostProcess;if(x){"pass"===x.getEffectName()&&(C.isIntermediate=0===this._postProcesses.length),C._postProcesses=this._postProcesses.slice(0).concat(x),x.markTextureDirty()}else C._postProcesses=this._postProcesses.slice(0)}}attachPostProcess(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return!C.isReusable()&&this._postProcesses.indexOf(C)>-1?(V.e.Error("You're trying to reuse a post process not defined as reusable."),0):(null==M||M<0?this._postProcesses.push(C):null===this._postProcesses[M]?this._postProcesses[M]=C:this._postProcesses.splice(M,0,C),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.Fe(),this._postProcesses.indexOf(C))}detachPostProcess(C){const M=this._postProcesses.indexOf(C);-1!==M&&(this._postProcesses[M]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.Fe(),this._cascadePostProcessesToRigCams()}getWorldMatrix(){return this._isSynchronizedViewMatrix()||this.getViewMatrix(),this._worldMatrix}_getViewMatrix(){return m.d.Identity()}getViewMatrix(C){return!C&&this._isSynchronizedViewMatrix()||(this._hasMoved=!0,this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.va().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix)),this._computedViewMatrix}freezeProjectionMatrix(C){this._doNotComputeProjectionMatrix=!0,void 0!==C&&(this._projectionMatrix=C)}unfreezeProjectionMatrix(){this._doNotComputeProjectionMatrix=!1}getProjectionMatrix(C){if(this._doNotComputeProjectionMatrix||!C&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.lj=this.lj,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;const M=this.getEngine(),x=this.va(),f=M.useReverseDepthBuffer;if(this.mode===o.PERSPECTIVE_CAMERA){let C;this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=M.getAspectRatio(this),this._cache.projectionPlaneTilt=this.projectionPlaneTilt,this.lj<=0&&(this.lj=.1),C=x.useRightHandedSystem?m.d.PerspectiveFovRHToRef:m.d.PerspectiveFovLHToRef,C(this.fov,M.getAspectRatio(this),f?this.maxZ:this.lj,f?this.lj:this.maxZ,this._projectionMatrix,this.fovMode===o.FOVMODE_VERTICAL_FIXED,M.isNDCHalfZRange,this.projectionPlaneTilt,f)}else{var T,z,s;const C=M.getRenderWidth()/2,S=M.getRenderHeight()/2;x.useRightHandedSystem?this.oblique?m.d.ObliqueOffCenterRHToRef(this.orthoLeft??-C,this.orthoRight??C,this.orthoBottom??-S,this.orthoTop??S,f?this.maxZ:this.lj,f?this.lj:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,M.isNDCHalfZRange):m.d.OrthoOffCenterRHToRef(this.orthoLeft??-C,this.orthoRight??C,this.orthoBottom??-S,this.orthoTop??S,f?this.maxZ:this.lj,f?this.lj:this.maxZ,this._projectionMatrix,M.isNDCHalfZRange):this.oblique?m.d.ObliqueOffCenterLHToRef(this.orthoLeft??-C,this.orthoRight??C,this.orthoBottom??-S,this.orthoTop??S,f?this.maxZ:this.lj,f?this.lj:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,M.isNDCHalfZRange):m.d.OrthoOffCenterLHToRef(this.orthoLeft??-C,this.orthoRight??C,this.orthoBottom??-S,this.orthoTop??S,f?this.maxZ:this.lj,f?this.lj:this.maxZ,this._projectionMatrix,M.isNDCHalfZRange),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.obliqueAngle=null===(T=this.oblique)||void 0===T?void 0:T.angle,this._cache.obliqueLength=null===(z=this.oblique)||void 0===z?void 0:z.length,this._cache.obliqueOffset=null===(s=this.oblique)||void 0===s?void 0:s.offset,this._cache.renderWidth=M.getRenderWidth(),this._cache.renderHeight=M.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix}getTransformationMatrix(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix}_computeObliqueDistance(C){return(this.i||(this.target?m.m.Distance(this.position,this.target):this.position.length()))+C}_updateFrustumPlanes(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?d.c.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=d.c.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)}isInFrustum(C){let M=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._updateFrustumPlanes(),M&&this.rigCameras.length>0){let M=!1;return this.rigCameras.forEach((x=>{x._updateFrustumPlanes(),M=M||C.isInFrustum(x._frustumPlanes)})),M}return C.isInFrustum(this._frustumPlanes)}isCompletelyInFrustum(C){return this._updateFrustumPlanes(),C.isCompletelyInFrustum(this._frustumPlanes)}getForwardRay(){throw(0,U.d)("Ray")}getForwardRayToRef(C){throw(0,U.d)("Ray")}dispose(C){let M=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.va().stopAnimation(this),this.va().removeCamera(this);this._rigCameras.length>0;){const C=this._rigCameras.pop();C&&C.dispose()}if(this._parentContainer){const C=this._parentContainer.cameras.indexOf(this);C>-1&&this._parentContainer.cameras.splice(C,1),this._parentContainer=null}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses.length=0;else if(this.cameraRigMode!==o.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses.length=0;else{let C=this._postProcesses.length;for(;--C>=0;){const M=this._postProcesses[C];M&&M.dispose(this)}}let x=this.customRenderTargets.length;for(;--x>=0;)this.customRenderTargets[x].dispose();this.customRenderTargets.length=0,this._activeMeshes.dispose(),this.va().getEngine().releaseRenderPassId(this.renderPassId),super.dispose(C,M)}get isLeftCamera(){return this._isLeftCamera}get isRightCamera(){return this._isRightCamera}get leftCamera(){return this._rigCameras.length<1?null:this._rigCameras[0]}get rightCamera(){return this._rigCameras.length<2?null:this._rigCameras[1]}getLeftTarget(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()}getRightTarget(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()}setCameraRigMode(C,M){if(this.cameraRigMode!==C){for(;this._rigCameras.length>0;){const C=this._rigCameras.pop();C&&C.dispose()}if(this.cameraRigMode=C,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=M.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=s.i.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==o.RIG_MODE_NONE){const C=this.createRigCamera(this.name+"_L",0);C&&(C._isLeftCamera=!0);const M=this.createRigCamera(this.name+"_R",1);M&&(M._isRightCamera=!0),C&&M&&(this._rigCameras.push(C),this._rigCameras.push(M))}this._setRigMode(M),this._cascadePostProcessesToRigCams(),this.update()}}_setRigMode(C){}_getVRProjectionMatrix(){return m.d.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.lj,this.maxZ,this._cameraRigParams.vrWorkMatrix,!0,this.getEngine().isNDCHalfZRange),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix}setCameraRigParameter(C,M){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[C]=M,"interaxialDistance"===C&&(this._cameraRigParams.stereoHalfAngle=s.i.ToRadians(M/.0637))}createRigCamera(C,M){return null}_updateRigCameras(){for(let C=0;C<this._rigCameras.length;C++)this._rigCameras[C].lj=this.lj,this._rigCameras[C].maxZ=this.maxZ,this._rigCameras[C].fov=this.fov,this._rigCameras[C].upVector.p(this.upVector);this.cameraRigMode===o.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)}_setupInputs(){}serialize(){const C=D.e.Serialize(this);return C.uniqueId=this.uniqueId,C.type=this.getClassName(),this.parent&&this.parent._serializeAsParent(C),this.inputs&&this.inputs.serialize(C),D.e.AppendSerializedAnimations(this,C),C.ranges=this.serializeAnimationRanges(),C.isEnabled=this.isEnabled(),C}clone(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const x=D.e.Clone(o.GetConstructorFromName(this.getClassName(),C,this.va(),this.interaxialDistance,this.isStereoscopicSideBySide),this);return x.name=C,x.parent=M,this.onClonedObservable.notifyObservers(x),x}Af(C){const M=m.m.Zero();return this.getDirectionToRef(C,M),M}get absoluteRotation(){return this.getWorldMatrix().decompose(void 0,this._absoluteRotation),this._absoluteRotation}getDirectionToRef(C,M){m.m.TransformNormalToRef(C,this.getWorldMatrix(),M)}static GetConstructorFromName(C,M,x){let f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,T=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const z=Q.e.Construct(C,M,x,{interaxial_distance:f,isStereoscopicSideBySide:T});return z||(()=>o._CreateDefaultParsedCamera(M,x))}Be(){return this.getWorldMatrix()}static Parse(C,M){const x=C.type,f=o.GetConstructorFromName(x,C.name,M,C.interaxial_distance,C.isStereoscopicSideBySide),T=D.e.Parse(f,C,M);if(void 0!==C.parentId&&(T._waitingParentId=C.parentId),void 0!==C.parentInstanceIndex&&(T._waitingParentInstanceIndex=C.parentInstanceIndex),T.inputs&&(T.inputs.parse(C),T._setupInputs()),C.upVector&&(T.upVector=m.m.Dd(C.upVector)),T.setPosition&&(T.position.Hd(0,0,0),T.setPosition(m.m.Dd(C.position))),C.target&&T.setTarget&&T.setTarget(m.m.Dd(C.target)),C.cameraRigMode){const M=C.interaxial_distance?{interaxialDistance:C.interaxial_distance}:{};T.setCameraRigMode(C.cameraRigMode,M)}if(C.animations){for(let M=0;M<C.animations.length;M++){const x=C.animations[M],f=(0,y.c)("BABYLON.Animation");f&&T.animations.push(f.Parse(x))}Q.e.ParseAnimationRanges(T,C,M)}return C.autoAnimate&&M.beginAnimation(T,C.autoAnimateFrom,C.autoAnimateTo,C.autoAnimateLoop,C.autoAnimateSpeed||1),void 0!==C.isEnabled&&T.Og(C.isEnabled),T}_calculateHandednessMultiplier(){let C=this.va().useRightHandedSystem?-1:1;return this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(C*=-1),C}}o._CreateDefaultParsedCamera=(C,M)=>{throw(0,U.d)("UniversalCamera")},o.PERSPECTIVE_CAMERA=0,o.ORTHOGRAPHIC_CAMERA=1,o.FOVMODE_VERTICAL_FIXED=0,o.FOVMODE_HORIZONTAL_FIXED=1,o.RIG_MODE_NONE=0,o.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,o.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,o.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,o.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,o.RIG_MODE_STEREOSCOPIC_INTERLACED=14,o.RIG_MODE_VR=20,o.RIG_MODE_CUSTOM=22,o.ForceAttachControlToAlwaysPreventDefault=!1,(0,f.e)([(0,T.H)("position")],o.prototype,"_position",void 0),(0,f.e)([(0,T.H)("upVector")],o.prototype,"_upVector",void 0),(0,f.e)([(0,T.J)()],o.prototype,"orthoLeft",null),(0,f.e)([(0,T.J)()],o.prototype,"orthoRight",null),(0,f.e)([(0,T.J)()],o.prototype,"orthoBottom",null),(0,f.e)([(0,T.J)()],o.prototype,"orthoTop",null),(0,f.e)([(0,T.J)()],o.prototype,"fov",void 0),(0,f.e)([(0,T.J)()],o.prototype,"projectionPlaneTilt",void 0),(0,f.e)([(0,T.J)()],o.prototype,"lj",void 0),(0,f.e)([(0,T.J)()],o.prototype,"maxZ",void 0),(0,f.e)([(0,T.J)()],o.prototype,"inertia",void 0),(0,f.e)([(0,T.J)()],o.prototype,"mode",null),(0,f.e)([(0,T.J)()],o.prototype,"layerMask",void 0),(0,f.e)([(0,T.J)()],o.prototype,"fovMode",void 0),(0,f.e)([(0,T.J)()],o.prototype,"cameraRigMode",void 0),(0,f.e)([(0,T.J)()],o.prototype,"interaxialDistance",void 0),(0,f.e)([(0,T.J)()],o.prototype,"isStereoscopicSideBySide",void 0)},12316:(C,M,x)=>{"use strict";x.d(M,{d:()=>s,f:()=>S});var f=x(1078),T=x(1145),z=x(11726),s={};class S{constructor(C){this.attachedToElement=!1,this.attached={},this.camera=C,this.checkInputs=()=>{}}add(C){const M=C.getSimpleName();this.attached[M]?f.e.Warn("camera input of type "+M+" already exists on camera"):(this.attached[M]=C,C.camera=this.camera,C.checkInputs&&(this.checkInputs=this._addCheckInputs(C.checkInputs.bind(C))),this.attachedToElement&&C.attachControl(this.noPreventDefault))}remove(C){for(const M in this.attached){const x=this.attached[M];if(x===C)return x.ke(),x.camera=null,delete this.attached[M],void this.rebuildInputCheck()}}removeByType(C){for(const M in this.attached){const x=this.attached[M];x.getClassName()===C&&(x.ke(),x.camera=null,delete this.attached[M],this.rebuildInputCheck())}}_addCheckInputs(C){const M=this.checkInputs;return()=>{M(),C()}}attachInput(C){this.attachedToElement&&C.attachControl(this.noPreventDefault)}attachElement(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){C=!z.c.ForceAttachControlToAlwaysPreventDefault&&C,this.attachedToElement=!0,this.noPreventDefault=C;for(const M in this.attached)this.attached[M].attachControl(C)}}detachElement(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const M in this.attached)this.attached[M].ke(),C&&(this.attached[M].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const C in this.attached){const M=this.attached[C];M.checkInputs&&(this.checkInputs=this._addCheckInputs(M.checkInputs.bind(M)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(C){const M={};for(const x in this.attached){const C=this.attached[x],f=T.e.Serialize(C);M[C.getClassName()]=f}C.inputsmgr=M}parse(C){const M=C.inputsmgr;if(M){this.clear();for(const C in M){const x=s[C];if(x){const f=M[C],z=T.e.Parse((()=>new x),f,null);this.add(z)}}}else for(const x in this.attached){const M=s[this.attached[x].getClassName()];if(M){const f=T.e.Parse((()=>new M),C,null);this.remove(this.attached[x]),this.add(f)}}}}},12307:(C,M,x)=>{"use strict";x.d(M,{e:()=>b});var f=x(951),T=x(959),z=x(978),s=x(12314),S=x(12316),m=x(1250),Q=x(1192);class V{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(C){C=Q.i.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((M=>{const x=M.event;if(!x.metaKey)if(M.type===m.c.KEYDOWN){if(-1!==this.keysUp.indexOf(x.keyCode)||-1!==this.keysDown.indexOf(x.keyCode)||-1!==this.keysLeft.indexOf(x.keyCode)||-1!==this.keysRight.indexOf(x.keyCode)||-1!==this.keysUpward.indexOf(x.keyCode)||-1!==this.keysDownward.indexOf(x.keyCode)||-1!==this.keysRotateLeft.indexOf(x.keyCode)||-1!==this.keysRotateRight.indexOf(x.keyCode)||-1!==this.keysRotateUp.indexOf(x.keyCode)||-1!==this.keysRotateDown.indexOf(x.keyCode)){-1===this._keys.indexOf(x.keyCode)&&this._keys.push(x.keyCode),C||x.preventDefault()}}else if(-1!==this.keysUp.indexOf(x.keyCode)||-1!==this.keysDown.indexOf(x.keyCode)||-1!==this.keysLeft.indexOf(x.keyCode)||-1!==this.keysRight.indexOf(x.keyCode)||-1!==this.keysUpward.indexOf(x.keyCode)||-1!==this.keysDownward.indexOf(x.keyCode)||-1!==this.keysRotateLeft.indexOf(x.keyCode)||-1!==this.keysRotateRight.indexOf(x.keyCode)||-1!==this.keysRotateUp.indexOf(x.keyCode)||-1!==this.keysRotateDown.indexOf(x.keyCode)){const M=this._keys.indexOf(x.keyCode);M>=0&&this._keys.splice(M,1),C||x.preventDefault()}})))}ke(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const C=this.camera;for(let M=0;M<this._keys.length;M++){const x=this._keys[M],f=C._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(x)?C._localDirection.Hd(-f,0,0):-1!==this.keysUp.indexOf(x)?C._localDirection.Hd(0,0,f):-1!==this.keysRight.indexOf(x)?C._localDirection.Hd(f,0,0):-1!==this.keysDown.indexOf(x)?C._localDirection.Hd(0,0,-f):-1!==this.keysUpward.indexOf(x)?C._localDirection.Hd(0,f,0):-1!==this.keysDownward.indexOf(x)?C._localDirection.Hd(0,-f,0):-1!==this.keysRotateLeft.indexOf(x)?(C._localDirection.Hd(0,0,0),C.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(x)?(C._localDirection.Hd(0,0,0),C.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(x)?(C._localDirection.Hd(0,0,0),C.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(x)&&(C._localDirection.Hd(0,0,0),C.cameraRotation.x+=this._getLocalRotation()),C.va().useRightHandedSystem&&(C._localDirection.z*=-1),C.getViewMatrix().invertToRef(C._cameraTransformMatrix),z.m.TransformNormalToRef(C._localDirection,C._cameraTransformMatrix,C._transformedDirection),C.cameraDirection.addInPlace(C._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const C=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*C}}(0,f.e)([(0,T.J)()],V.prototype,"keysUp",void 0),(0,f.e)([(0,T.J)()],V.prototype,"keysUpward",void 0),(0,f.e)([(0,T.J)()],V.prototype,"keysDown",void 0),(0,f.e)([(0,T.J)()],V.prototype,"keysDownward",void 0),(0,f.e)([(0,T.J)()],V.prototype,"keysLeft",void 0),(0,f.e)([(0,T.J)()],V.prototype,"keysRight",void 0),(0,f.e)([(0,T.J)()],V.prototype,"rotationSpeed",void 0),(0,f.e)([(0,T.J)()],V.prototype,"keysRotateLeft",void 0),(0,f.e)([(0,T.J)()],V.prototype,"keysRotateRight",void 0),(0,f.e)([(0,T.J)()],V.prototype,"keysRotateUp",void 0),(0,f.e)([(0,T.J)()],V.prototype,"keysRotateDown",void 0),S.d.FreeCameraKeyboardMoveInput=V;var y=x(971),U=x(1243);class O{constructor(){let C=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=C,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new y.c,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(C){C=Q.i.BackCompatCameraNoPreventDefault(arguments);const M=this.camera.getEngine(),x=M.getInputElement();this._pointerInput||(this._pointerInput=f=>{const T=f.event,z="touch"===T.pointerType;if(!this.touchEnabled&&z)return;if(f.type!==U.c.POINTERMOVE&&-1===this.buttons.indexOf(T.button))return;const s=T.target;if(f.type===U.c.POINTERDOWN){if(z&&-1!==this._activePointerId||!z&&-1!==this._currentActiveButton)return;this._activePointerId=T.pointerId;try{null===s||void 0===s||s.setPointerCapture(T.pointerId)}catch(S){}-1===this._currentActiveButton&&(this._currentActiveButton=T.button),this._previousPosition={x:T.clientX,y:T.clientY},C||(T.preventDefault(),x&&x.focus()),M.isPointerLock&&this._onMouseMove&&this._onMouseMove(f.event)}else if(f.type===U.c.POINTERUP){if(z&&this._activePointerId!==T.pointerId||!z&&this._currentActiveButton!==T.button)return;try{null===s||void 0===s||s.releasePointerCapture(T.pointerId)}catch(S){}this._currentActiveButton=-1,this._previousPosition=null,C||T.preventDefault(),this._activePointerId=-1}else if(f.type===U.c.POINTERMOVE&&(this._activePointerId===T.pointerId||!z))if(M.isPointerLock&&this._onMouseMove)this._onMouseMove(f.event);else if(this._previousPosition){const M=this.camera._calculateHandednessMultiplier(),x=(T.clientX-this._previousPosition.x)*M,f=T.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=x/this.angularSensibility,this.camera.cameraRotation.x+=f/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:x,offsetY:f}),this._previousPosition={x:T.clientX,y:T.clientY},C||T.preventDefault()}}),this._onMouseMove=x=>{if(!M.isPointerLock)return;const f=this.camera._calculateHandednessMultiplier(),T=x.movementX*f;this.camera.cameraRotation.y+=T/this.angularSensibility;const z=x.movementY;this.camera.cameraRotation.x+=z/this.angularSensibility,this._previousPosition=null,C||x.preventDefault()},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,U.c.POINTERDOWN|U.c.POINTERUP|U.c.POINTERMOVE),x&&(this._contextMenuBind=C=>this.onContextMenu(C),x.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(C){C.preventDefault()}ke(){if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const C=this.camera.getEngine().getInputElement();C&&C.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,f.e)([(0,T.J)()],O.prototype,"buttons",void 0),(0,f.e)([(0,T.J)()],O.prototype,"angularSensibility",void 0),S.d.FreeCameraMouseInput=O;var d,D=x(1257);class o{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new y.c,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(C){C=Q.i.BackCompatCameraNoPreventDefault(arguments),this._wheel=M=>{if(M.type!==U.c.POINTERWHEEL)return;const x=M.event,f=x.deltaMode===D.c.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*f*x.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*f*x.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*f*x.deltaZ/this._normalize,x.preventDefault&&(C||x.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,U.c.POINTERWHEEL)}ke(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,f.e)([(0,T.J)()],o.prototype,"wheelPrecisionX",void 0),(0,f.e)([(0,T.J)()],o.prototype,"wheelPrecisionY",void 0),(0,f.e)([(0,T.J)()],o.prototype,"wheelPrecisionZ",void 0),function(C){C[C.MoveRelative=0]="MoveRelative",C[C.RotateRelative=1]="RotateRelative",C[C.MoveScene=2]="MoveScene"}(d||(d={}));class L extends o{constructor(){super(...arguments),this._moveRelative=z.m.Zero(),this._rotateRelative=z.m.Zero(),this._moveScene=z.m.Zero(),this._wheelXAction=d.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=d.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(C){null===C&&this._wheelXAction!==d.MoveRelative||(this._wheelXAction=d.MoveRelative,this._wheelXActionCoordinate=C)}get wheelXMoveRelative(){return this._wheelXAction!==d.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(C){null===C&&this._wheelYAction!==d.MoveRelative||(this._wheelYAction=d.MoveRelative,this._wheelYActionCoordinate=C)}get wheelYMoveRelative(){return this._wheelYAction!==d.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(C){null===C&&this._wheelZAction!==d.MoveRelative||(this._wheelZAction=d.MoveRelative,this._wheelZActionCoordinate=C)}get wheelZMoveRelative(){return this._wheelZAction!==d.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(C){null===C&&this._wheelXAction!==d.RotateRelative||(this._wheelXAction=d.RotateRelative,this._wheelXActionCoordinate=C)}get wheelXRotateRelative(){return this._wheelXAction!==d.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(C){null===C&&this._wheelYAction!==d.RotateRelative||(this._wheelYAction=d.RotateRelative,this._wheelYActionCoordinate=C)}get wheelYRotateRelative(){return this._wheelYAction!==d.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(C){null===C&&this._wheelZAction!==d.RotateRelative||(this._wheelZAction=d.RotateRelative,this._wheelZActionCoordinate=C)}get wheelZRotateRelative(){return this._wheelZAction!==d.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(C){null===C&&this._wheelXAction!==d.MoveScene||(this._wheelXAction=d.MoveScene,this._wheelXActionCoordinate=C)}get wheelXMoveScene(){return this._wheelXAction!==d.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(C){null===C&&this._wheelYAction!==d.MoveScene||(this._wheelYAction=d.MoveScene,this._wheelYActionCoordinate=C)}get wheelYMoveScene(){return this._wheelYAction!==d.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(C){null===C&&this._wheelZAction!==d.MoveScene||(this._wheelZAction=d.MoveScene,this._wheelZActionCoordinate=C)}get wheelZMoveScene(){return this._wheelZAction!==d.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.Kd(0),this._rotateRelative.Kd(0),this._moveScene.Kd(0),this._updateCamera(),this.camera.va().useRightHandedSystem&&(this._moveRelative.z*=-1);const C=z.d.Zero();this.camera.getViewMatrix().invertToRef(C);const M=z.m.Zero();z.m.TransformNormalToRef(this._moveRelative,C,M),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(M),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(C,M,x){if(0===C)return;if(null===M||null===x)return;let f=null;switch(M){case d.MoveRelative:f=this._moveRelative;break;case d.RotateRelative:f=this._rotateRelative;break;case d.MoveScene:f=this._moveScene}switch(x){case 0:f.set(C,0,0);break;case 1:f.set(0,C,0);break;case 2:f.set(0,0,C)}}}(0,f.e)([(0,T.J)()],L.prototype,"wheelXMoveRelative",null),(0,f.e)([(0,T.J)()],L.prototype,"wheelYMoveRelative",null),(0,f.e)([(0,T.J)()],L.prototype,"wheelZMoveRelative",null),(0,f.e)([(0,T.J)()],L.prototype,"wheelXRotateRelative",null),(0,f.e)([(0,T.J)()],L.prototype,"wheelYRotateRelative",null),(0,f.e)([(0,T.J)()],L.prototype,"wheelZRotateRelative",null),(0,f.e)([(0,T.J)()],L.prototype,"wheelXMoveScene",null),(0,f.e)([(0,T.J)()],L.prototype,"wheelYMoveScene",null),(0,f.e)([(0,T.J)()],L.prototype,"wheelZMoveScene",null),S.d.FreeCameraMouseWheelInput=L;class t{constructor(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=C,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=Q.i.IsSafari()}attachControl(C){C=Q.i.BackCompatCameraNoPreventDefault(arguments);let M=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=x=>{const f=x.event,T="mouse"===f.pointerType||this._isSafari&&"undefined"===typeof f.pointerType;if(this.allowMouse||!T)if(x.type===U.c.POINTERDOWN){if(C||f.preventDefault(),this._pointerPressed.push(f.pointerId),1!==this._pointerPressed.length)return;M={x:f.clientX,y:f.clientY}}else if(x.type===U.c.POINTERUP){C||f.preventDefault();const x=this._pointerPressed.indexOf(f.pointerId);if(-1===x)return;if(this._pointerPressed.splice(x,1),0!=x)return;M=null,this._offsetX=null,this._offsetY=null}else if(x.type===U.c.POINTERMOVE){if(C||f.preventDefault(),!M)return;if(0!=this._pointerPressed.indexOf(f.pointerId))return;this._offsetX=f.clientX-M.x,this._offsetY=-(f.clientY-M.y)}}),this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,U.c.POINTERDOWN|U.c.POINTERUP|U.c.POINTERMOVE),this._onLostFocus){const C=this.camera.getEngine().getInputElement();C&&C.addEventListener("blur",this._onLostFocus)}}ke(){if(this._pointerInput){if(this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const C=this.camera.getEngine().getInputElement();C&&C.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const C=this.camera,M=C._calculateHandednessMultiplier();C.cameraRotation.y=M*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)C.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const M=C._computeLocalCameraSpeed(),x=new z.m(0,0,0!==this.touchMoveSensibility?M*this._offsetY/this.touchMoveSensibility:0);z.d.RotationYawPitchRollToRef(C.rotation.y,C.rotation.x,0,C._cameraRotationMatrix),C.cameraDirection.addInPlace(z.m.TransformCoordinates(x,C._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,f.e)([(0,T.J)()],t.prototype,"touchAngularSensibility",void 0),(0,f.e)([(0,T.J)()],t.prototype,"touchMoveSensibility",void 0),S.d.FreeCameraTouchInput=t;class A extends S.f{constructor(C){super(C),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new V),this}addMouse(){let C=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new O(C),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new L,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new t),this}clear(){super.clear(),this._mouseInput=null}}var H=x(997),j=x(1086);class b extends s.c{get angularSensibility(){const C=this.inputs.attached.mouse;return C?C.angularSensibility:0}set angularSensibility(C){const M=this.inputs.attached.mouse;M&&(M.angularSensibility=C)}get keysUp(){const C=this.inputs.attached.keyboard;return C?C.keysUp:[]}set keysUp(C){const M=this.inputs.attached.keyboard;M&&(M.keysUp=C)}get keysUpward(){const C=this.inputs.attached.keyboard;return C?C.keysUpward:[]}set keysUpward(C){const M=this.inputs.attached.keyboard;M&&(M.keysUpward=C)}get keysDown(){const C=this.inputs.attached.keyboard;return C?C.keysDown:[]}set keysDown(C){const M=this.inputs.attached.keyboard;M&&(M.keysDown=C)}get keysDownward(){const C=this.inputs.attached.keyboard;return C?C.keysDownward:[]}set keysDownward(C){const M=this.inputs.attached.keyboard;M&&(M.keysDownward=C)}get keysLeft(){const C=this.inputs.attached.keyboard;return C?C.keysLeft:[]}set keysLeft(C){const M=this.inputs.attached.keyboard;M&&(M.keysLeft=C)}get keysRight(){const C=this.inputs.attached.keyboard;return C?C.keysRight:[]}set keysRight(C){const M=this.inputs.attached.keyboard;M&&(M.keysRight=C)}get keysRotateLeft(){const C=this.inputs.attached.keyboard;return C?C.keysRotateLeft:[]}set keysRotateLeft(C){const M=this.inputs.attached.keyboard;M&&(M.keysRotateLeft=C)}get keysRotateRight(){const C=this.inputs.attached.keyboard;return C?C.keysRotateRight:[]}set keysRotateRight(C){const M=this.inputs.attached.keyboard;M&&(M.keysRotateRight=C)}get keysRotateUp(){const C=this.inputs.attached.keyboard;return C?C.keysRotateUp:[]}set keysRotateUp(C){const M=this.inputs.attached.keyboard;M&&(M.keysRotateUp=C)}get keysRotateDown(){const C=this.inputs.attached.keyboard;return C?C.keysRotateDown:[]}set keysRotateDown(C){const M=this.inputs.attached.keyboard;M&&(M.keysRotateDown=C)}constructor(C,M,x){var f;super(C,M,x,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),f=this,this.ellipsoid=new z.m(.5,1,.5),this.ellipsoidOffset=new z.m(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=z.m.Zero(),this._diffPosition=z.m.Zero(),this._newPosition=z.m.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(C,M){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;f._newPosition.p(M),f._newPosition.subtractToRef(f._oldPosition,f._diffPosition),f._diffPosition.length()>j.e.CollisionsEpsilon&&(f.position.addToRef(f._diffPosition,f._deferredPositionUpdate),f._deferOnly?f._deferredUpdated=!0:f.position.p(f._deferredPositionUpdate),f.Pk&&x&&f.Pk(x))},this.inputs=new A(this),this.inputs.addKeyboard().addMouse()}attachControl(C,M){M=Q.i.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(M)}ke(){this.inputs.detachElement(),this.cameraDirection=new z.m(0,0,0),this.cameraRotation=new z.j(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(C){this._collisionMask=isNaN(C)?-1:C}_collideWithWorld(C){let M;M=this.parent?z.m.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,M.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const x=this.va().collisionCoordinator;this._collider||(this._collider=x.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let f=C;this.applyGravity&&(f=C.add(this.va().gravity)),x.getNewPosition(this._oldPosition,f,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=z.m.Zero(),this._transformedDirection=z.m.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(C){this._needMoveForGravity=C}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.va().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"hb"}}(0,f.e)([(0,T.H)()],b.prototype,"ellipsoid",void 0),(0,f.e)([(0,T.H)()],b.prototype,"ellipsoidOffset",void 0),(0,f.e)([(0,T.J)()],b.prototype,"checkCollisions",void 0),(0,f.e)([(0,T.J)()],b.prototype,"applyGravity",void 0),(0,H.f)("BABYLON.FreeCamera",b)},12314:(C,M,x)=>{"use strict";x.d(M,{c:()=>Q});var f=x(951),T=x(959),z=x(11726),s=x(978),S=x(986),m=x(1447);x(11734).e.AddNodeConstructor("TargetCamera",((C,M)=>()=>new Q(C,s.m.Zero(),M)));class Q extends z.c{constructor(C,M,x){super(C,M,x,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),this._tmpUpVector=s.m.Zero(),this._tmpTargetVector=s.m.Zero(),this.cameraDirection=new s.m(0,0,0),this.cameraRotation=new s.j(0,0),this.ignoreParentScaling=!1,this.updateUpVectorFromRotation=!1,this._tmpQuaternion=new s.h,this.rotation=new s.m(0,0,0),this.speed=2,this.noRotationConstraint=!1,this.invertRotation=!1,this.inverseRotationSpeed=.2,this.lockedTarget=null,this._currentTarget=s.m.Zero(),this._initialFocalDistance=1,this._viewMatrix=s.d.Zero(),this._camMatrix=s.d.Zero(),this._cameraTransformMatrix=s.d.Zero(),this._cameraRotationMatrix=s.d.Zero(),this._referencePoint=new s.m(0,0,1),this._transformedReferencePoint=s.m.Zero(),this._deferredPositionUpdate=new s.m,this._deferredRotationQuaternionUpdate=new s.h,this._deferredRotationUpdate=new s.m,this._deferredUpdated=!1,this._deferOnly=!1,this._defaultUp=s.m.Up(),this._cachedRotationZ=0,this._cachedQuaternionRotationZ=0}getFrontPosition(C){this.getWorldMatrix();const M=this.getTarget().rc(this.position);return M.normalize(),M.scaleInPlace(C),this.globalPosition.add(M)}_getLockedTargetPosition(){if(!this.lockedTarget)return null;if(this.lockedTarget.absolutePosition){const C=this.lockedTarget;C.Be().getTranslationToRef(C.absolutePosition)}return this.lockedTarget.absolutePosition||this.lockedTarget}storeState(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),super.storeState()}_restoreStateValues(){return!!super._restoreStateValues()&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.Hd(0,0,0),this.cameraRotation.Hd(0,0),!0)}_initCache(){super._initCache(),this._cache.lockedTarget=new s.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new s.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new s.h(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}_updateCache(C){C||super._updateCache();const M=this._getLockedTargetPosition();M?this._cache.lockedTarget?this._cache.lockedTarget.p(M):this._cache.lockedTarget=M.clone():this._cache.lockedTarget=null,this._cache.rotation.p(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.p(this.rotationQuaternion)}_isSynchronizedViewMatrix(){if(!super._isSynchronizedViewMatrix())return!1;const C=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(C):!C)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))}_computeLocalCameraSpeed(){const C=this.getEngine();return this.speed*Math.sqrt(C.getDeltaTime()/(100*C.getFps()))}setTarget(C){this.upVector.normalize(),this._initialFocalDistance=C.rc(this.position).length(),this.position.z===C.z&&(this.position.z+=S.c),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),s.d.LookAtLHToRef(this.position,C,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);const M=C.rc(this.position);M.x>=0?this.rotation.y=-Math.atan(M.z/M.x)+Math.PI/2:this.rotation.y=-Math.atan(M.z/M.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&s.h.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)}get target(){return this.getTarget()}set target(C){this.setTarget(C)}getTarget(){return this._currentTarget}_decideIfNeedsToMove(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(s.i.Matrix[0]),s.m.TransformNormalToRef(this.cameraDirection,s.i.Matrix[0],s.i.Md[0]),this._deferredPositionUpdate.addInPlace(s.i.Md[0]),void(this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate));this._deferredPositionUpdate.addInPlace(this.cameraDirection),this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate)}_checkInputs(){const C=this.invertRotation?-this.inverseRotationSpeed:1,M=this._decideIfNeedsToMove(),x=this.cameraRotation.x||this.cameraRotation.y;if(this._deferredUpdated=!1,this._deferredRotationUpdate.p(this.rotation),this._deferredPositionUpdate.p(this.position),this.rotationQuaternion&&this._deferredRotationQuaternionUpdate.p(this.rotationQuaternion),M&&this._updatePosition(),x){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this._deferredRotationUpdate),this._deferredRotationUpdate.x+=this.cameraRotation.x*C,this._deferredRotationUpdate.y+=this.cameraRotation.y*C,!this.noRotationConstraint){const C=1.570796;this._deferredRotationUpdate.x>C&&(this._deferredRotationUpdate.x=C),this._deferredRotationUpdate.x<-C&&(this._deferredRotationUpdate.x=-C)}if(this._deferOnly?this._deferredUpdated=!0:this.rotation.p(this._deferredRotationUpdate),this.rotationQuaternion){this._deferredRotationUpdate.lengthSquared()&&(s.h.RotationYawPitchRollToRef(this._deferredRotationUpdate.y,this._deferredRotationUpdate.x,this._deferredRotationUpdate.z,this._deferredRotationQuaternionUpdate),this._deferOnly?this._deferredUpdated=!0:this.rotationQuaternion.p(this._deferredRotationQuaternionUpdate))}}M&&(Math.abs(this.cameraDirection.x)<this.speed*S.c&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*S.c&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*S.c&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),x&&(Math.abs(this.cameraRotation.x)<this.speed*S.c&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*S.c&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),super._checkInputs()}_updateCameraRotationMatrix(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):s.d.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)}_rotateUpVectorWithCameraRotationMatrix(){return s.m.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this}_getViewMatrix(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),s.m.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?m.d.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(s.h.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),m.d.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix}_computeViewMatrix(C,M,x){if(this.ignoreParentScaling){if(this.parent){const f=this.parent.getWorldMatrix();s.m.TransformCoordinatesToRef(C,f,this._globalPosition),s.m.TransformCoordinatesToRef(M,f,this._tmpTargetVector),s.m.TransformNormalToRef(x,f,this._tmpUpVector),this._markSyncedWithParent()}else this._globalPosition.p(C),this._tmpTargetVector.p(M),this._tmpUpVector.p(x);this.va().useRightHandedSystem?s.d.LookAtRHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix):s.d.LookAtLHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix)}else if(this.va().useRightHandedSystem?s.d.LookAtRHToRef(C,M,x,this._viewMatrix):s.d.LookAtLHToRef(C,M,x,this._viewMatrix),this.parent){const C=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(C,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.p(C)}createRigCamera(C,M){if(this.cameraRigMode!==z.c.RIG_MODE_NONE){const M=new Q(C,this.position.clone(),this.va());return M.isRigCamera=!0,M.rigParent=this,this.cameraRigMode===z.c.RIG_MODE_VR&&(this.rotationQuaternion||(this.rotationQuaternion=new s.h),M._cameraRigParams={},M.rotationQuaternion=new s.h),M.mode=this.mode,M.orthoLeft=this.orthoLeft,M.orthoRight=this.orthoRight,M.orthoTop=this.orthoTop,M.orthoBottom=this.orthoBottom,M}return null}_updateRigCameras(){const C=this._rigCameras[0],M=this._rigCameras[1];switch(this.Be(),this.cameraRigMode){case z.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case z.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case z.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case z.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case z.c.RIG_MODE_STEREOSCOPIC_INTERLACED:{const x=this.cameraRigMode===z.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,f=this.cameraRigMode===z.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*x,C),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*f,M);break}case z.c.RIG_MODE_VR:C.rotationQuaternion?(C.rotationQuaternion.p(this.rotationQuaternion),M.rotationQuaternion.p(this.rotationQuaternion)):(C.rotation.p(this.rotation),M.rotation.p(this.rotation)),C.position.p(this.position),M.position.p(this.position)}super._updateRigCameras()}_getRigCamPositionAndTarget(C,M){this.getTarget().subtractToRef(this.position,Q._TargetFocalPoint),Q._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);const x=Q._TargetFocalPoint.addInPlace(this.position);s.d.TranslationToRef(-x.x,-x.y,-x.z,Q._TargetTransformMatrix),Q._TargetTransformMatrix.multiplyToRef(s.d.RotationAxis(M.upVector,C),Q._RigCamTransformMatrix),s.d.TranslationToRef(x.x,x.y,x.z,Q._TargetTransformMatrix),Q._RigCamTransformMatrix.multiplyToRef(Q._TargetTransformMatrix,Q._RigCamTransformMatrix),s.m.TransformCoordinatesToRef(this.position,Q._RigCamTransformMatrix,M.position),M.setTarget(x)}getClassName(){return"TargetCamera"}}Q._RigCamTransformMatrix=new s.d,Q._TargetTransformMatrix=new s.d,Q._TargetFocalPoint=new s.m,(0,f.e)([(0,T.H)()],Q.prototype,"rotation",void 0),(0,f.e)([(0,T.J)()],Q.prototype,"speed",void 0),(0,f.e)([(0,T.u)("lockedTargetId")],Q.prototype,"lockedTarget",void 0)},12750:(C,M,x)=>{"use strict";x.d(M,{c:()=>z});var f=x(1188),T=x(12759);class z{constructor(C,M){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=x,this.Ji=[],this._maxBlockCapacity=M||64,this._selectionContent=new f.c(1024),this._creationFunc=C}update(C,M,x){T.e._CreateBlocks(C,M,x,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}ye(C){for(let M=0;M<this.ai.length;M++){this.ai[M].addEntry(C)}}Ae(C){for(let M=0;M<this.ai.length;M++){this.ai[M].removeEntry(C)}}select(C,M){this._selectionContent.reset();for(let x=0;x<this.ai.length;x++){this.ai[x].select(C,this._selectionContent,M)}return M?this._selectionContent.concat(this.Ji):this._selectionContent.concatWithNoDuplicate(this.Ji),this._selectionContent}intersects(C,M,x){this._selectionContent.reset();for(let f=0;f<this.ai.length;f++){this.ai[f].intersects(C,M,this._selectionContent,x)}return x?this._selectionContent.concat(this.Ji):this._selectionContent.concatWithNoDuplicate(this.Ji),this._selectionContent}intersectsRay(C){this._selectionContent.reset();for(let M=0;M<this.ai.length;M++){this.ai[M].intersectsRay(C,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.Ji),this._selectionContent}}z.CreationFuncForMeshes=(C,M)=>{const x=C.getBoundingInfo();!C.isBlocked&&x.boundingBox.intersectsMinMax(M.Ni,M.Oi)&&M.entries.push(C)},z.CreationFuncForSubMeshes=(C,M)=>{C.getBoundingInfo().boundingBox.intersectsMinMax(M.Ni,M.Oi)&&M.entries.push(C)}},12759:(C,M,x)=>{"use strict";x.d(M,{e:()=>z});var f=x(978),T=x(1307);class z{constructor(C,M,x,f,T,z){this.entries=[],this.Pi=new Array,this._capacity=x,this._depth=f,this._maxDepth=T,this._creationFunc=z,this._minPoint=C,this._maxPoint=M,this.Pi.push(C.clone()),this.Pi.push(M.clone()),this.Pi.push(C.clone()),this.Pi[2].x=M.x,this.Pi.push(C.clone()),this.Pi[3].y=M.y,this.Pi.push(C.clone()),this.Pi[4].z=M.z,this.Pi.push(M.clone()),this.Pi[5].z=C.z,this.Pi.push(M.clone()),this.Pi[6].x=C.x,this.Pi.push(M.clone()),this.Pi[7].y=C.y}get Ie(){return this._capacity}get Ni(){return this._minPoint}get Oi(){return this._maxPoint}addEntry(C){if(this.ai)for(let M=0;M<this.ai.length;M++){this.ai[M].addEntry(C)}else this._creationFunc(C,this),this.entries.length>this.Ie&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(C){if(this.ai){for(let M=0;M<this.ai.length;M++){this.ai[M].removeEntry(C)}return}const M=this.entries.indexOf(C);M>-1&&this.entries.splice(M,1)}addEntries(C){for(let M=0;M<C.length;M++){const x=C[M];this.addEntry(x)}}select(C,M,x){if(T.c.IsInFrustum(this.Pi,C)){if(this.ai){for(let f=0;f<this.ai.length;f++){this.ai[f].select(C,M,x)}return}x?M.concat(this.entries):M.concatWithNoDuplicate(this.entries)}}intersects(C,M,x,f){if(T.c.IntersectsSphere(this._minPoint,this._maxPoint,C,M)){if(this.ai){for(let T=0;T<this.ai.length;T++){this.ai[T].intersects(C,M,x,f)}return}f?x.concat(this.entries):x.concatWithNoDuplicate(this.entries)}}intersectsRay(C,M){if(C.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.ai){for(let x=0;x<this.ai.length;x++){this.ai[x].intersectsRay(C,M)}return}M.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){z._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(C,M,x,T,s,S,m,Q){m.ai=new Array;const V=new f.m((M.x-C.x)/2,(M.y-C.y)/2,(M.z-C.z)/2);for(let f=0;f<2;f++)for(let M=0;M<2;M++)for(let y=0;y<2;y++){const U=C.add(V.multiplyByFloats(f,M,y)),O=C.add(V.multiplyByFloats(f+1,M+1,y+1)),d=new z(U,O,T,s+1,S,Q);d.addEntries(x),m.ai.push(d)}}}},12761:(C,M,x)=>{"use strict";x.d(M,{b:()=>V});var f=x(1190),T=x(978),z=x(11763),s=x(11891),S=x(1239),m=x(12750),Q=x(1008);f.e.prototype.createOrUpdateSelectionOctree=function(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,x=this._getComponent(S.d.NAME_OCTREE);x||(x=new V(this),this.re(x)),this.Hi||(this.Hi=new m.c(m.c.CreationFuncForMeshes,C,M));const f=this.getWorldExtends();return this.Hi.update(f.min,f.max,this.meshes),this.Hi},Object.defineProperty(f.e.prototype,"selectionOctree",{get:function(){return this.Hi},enumerable:!0,configurable:!0}),z.b.prototype.createOrUpdateSubmeshesOctree=function(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const x=this.va();let f=x._getComponent(S.d.NAME_OCTREE);f||(f=new V(x),x.re(f)),this._submeshesOctree||(this._submeshesOctree=new m.c(m.c.CreationFuncForSubMeshes,C,M)),this.Be(!0);const T=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(T.minimumWorld,T.maximumWorld,this.we),this._submeshesOctree};class V{constructor(C){this.name=S.d.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new s.e(T.m.Zero(),new T.m(1,1,1)),(C=C||Q.c.LastCreatedScene)&&(this.xe=C,this.xe.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.xe.getActiveSubMeshCandidates=C=>this.getActiveSubMeshCandidates(C),this.xe.getCollidingSubMeshCandidates=(C,M)=>this.getCollidingSubMeshCandidates(C,M),this.xe.getIntersectingSubMeshCandidates=(C,M)=>this.getIntersectingSubMeshCandidates(C,M))}register(){this.xe.onMeshRemovedObservable.add((C=>{const M=this.xe.selectionOctree;if(void 0!==M&&null!==M){const x=M.Ji.indexOf(C);-1!==x&&M.Ji.splice(x,1)}})),this.xe.onMeshImportedObservable.add((C=>{const M=this.xe.selectionOctree;void 0!==M&&null!==M&&M.ye(C)}))}getActiveMeshCandidates(){var C;return(null===(C=this.xe.Hi)||void 0===C?void 0:C.select(this.xe.frustumPlanes))||this.xe._getDefaultMeshCandidates()}getActiveSubMeshCandidates(C){if(C._submeshesOctree&&C.useOctreeForRenderingSelection){return C._submeshesOctree.select(this.xe.frustumPlanes)}return this.xe._getDefaultSubMeshCandidates(C)}getIntersectingSubMeshCandidates(C,M){if(C._submeshesOctree&&C.useOctreeForPicking){s.e.TransformToRef(M,C.getWorldMatrix(),this._tempRay);return C._submeshesOctree.intersectsRay(this._tempRay)}return this.xe._getDefaultSubMeshCandidates(C)}getCollidingSubMeshCandidates(C,M){if(C._submeshesOctree&&C.useOctreeForCollisions){const x=M._velocityWorldLength+Math.max(M._radius.x,M._radius.y,M._radius.z);return C._submeshesOctree.intersects(M._basePointWorld,x)}return this.xe._getDefaultSubMeshCandidates(C)}rebuild(){}dispose(){}}},11891:(C,M,x)=>{"use strict";x.d(M,{e:()=>O});var f=x(1190),T=x(11726),z=x(986),s=x(978),S=x(991),m=x(1298),Q=x(1217),V=x(1008),y=x(1262);const U={internalPickerForMesh:void 0};class O{constructor(C,M){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:z.c;this.origin=C,this.direction=M,this.length=x,this.epsilon=f}clone(){return new O(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(C,M){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const f=O._TmpVector3[0].Hd(C.x-x,C.y-x,C.z-x),T=O._TmpVector3[1].Hd(M.x+x,M.y+x,M.z+x);let z,s,S,m,Q=0,V=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<f.x||this.origin.x>T.x)return!1}else if(z=1/this.direction.x,s=(f.x-this.origin.x)*z,S=(T.x-this.origin.x)*z,S===-1/0&&(S=1/0),s>S&&(m=s,s=S,S=m),Q=Math.max(s,Q),V=Math.min(S,V),Q>V)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<f.y||this.origin.y>T.y)return!1}else if(z=1/this.direction.y,s=(f.y-this.origin.y)*z,S=(T.y-this.origin.y)*z,S===-1/0&&(S=1/0),s>S&&(m=s,s=S,S=m),Q=Math.max(s,Q),V=Math.min(S,V),Q>V)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<f.z||this.origin.z>T.z)return!1}else if(z=1/this.direction.z,s=(f.z-this.origin.z)*z,S=(T.z-this.origin.z)*z,S===-1/0&&(S=1/0),s>S&&(m=s,s=S,S=m),Q=Math.max(s,Q),V=Math.min(S,V),Q>V)return!1;return!0}intersectsBox(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(C.minimum,C.maximum,M)}intersectsSphere(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const x=C.center.x-this.origin.x,f=C.center.y-this.origin.y,T=C.center.z-this.origin.z,z=x*x+f*f+T*T,s=C.i+M,S=s*s;if(z<=S)return!0;const m=x*this.direction.x+f*this.direction.y+T*this.direction.z;if(m<0)return!1;return z-m*m<=S}intersectsTriangle(C,M,x){const f=O._TmpVector3[0],T=O._TmpVector3[1],z=O._TmpVector3[2],S=O._TmpVector3[3],Q=O._TmpVector3[4];M.subtractToRef(C,f),x.subtractToRef(C,T),s.m.CrossToRef(this.direction,T,z);const V=s.m.Dot(f,z);if(0===V)return null;const y=1/V;this.origin.subtractToRef(C,S);const U=s.m.Dot(S,z)*y;if(U<-this.epsilon||U>1+this.epsilon)return null;s.m.CrossToRef(S,f,Q);const d=s.m.Dot(this.direction,Q)*y;if(d<-this.epsilon||U+d>1+this.epsilon)return null;const D=s.m.Dot(T,Q)*y;return D>this.length?null:new m.e(1-U-d,U,D)}intersectsPlane(C){let M;const x=s.m.Dot(C.Nd,this.direction);if(Math.abs(x)<9.99999997475243e-7)return null;{const f=s.m.Dot(C.Nd,this.origin);return M=(-C.d-f)/x,M<0?M<-9.99999997475243e-7?null:0:M}}intersectsAxis(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(C){case"y":{const C=(this.origin.y-M)/this.direction.y;return C>0?null:new s.m(this.origin.x+this.direction.x*-C,M,this.origin.z+this.direction.z*-C)}case"x":{const C=(this.origin.x-M)/this.direction.x;return C>0?null:new s.m(M,this.origin.y+this.direction.y*-C,this.origin.z+this.direction.z*-C)}case"z":{const C=(this.origin.z-M)/this.direction.z;return C>0?null:new s.m(this.origin.x+this.direction.x*-C,this.origin.y+this.direction.y*-C,M)}default:return null}}intersectsMesh(C,M,x){let f=arguments.length>3&&void 0!==arguments[3]&&arguments[3],T=arguments.length>4?arguments[4]:void 0,z=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const S=s.i.Matrix[0];return C.getWorldMatrix().invertToRef(S),this._tmpRay?O.TransformToRef(this,S,this._tmpRay):this._tmpRay=O.Transform(this,S),C.intersects(this._tmpRay,M,x,f,T,z)}intersectsMeshes(C,M,x){x?x.length=0:x=[];for(let f=0;f<C.length;f++){const T=this.intersectsMesh(C[f],M);T.hit&&x.push(T)}return x.sort(this._comparePickingInfo),x}_comparePickingInfo(C,M){return C.distance<M.distance?-1:C.distance>M.distance?1:0}intersectionSegment(C,M,x){const f=this.origin,T=s.i.Md[0],z=s.i.Md[1],S=s.i.Md[2],m=s.i.Md[3];M.subtractToRef(C,T),this.direction.scaleToRef(O._Rayl,S),f.addToRef(S,z),C.subtractToRef(f,m);const Q=s.m.Dot(T,T),V=s.m.Dot(T,S),y=s.m.Dot(S,S),U=s.m.Dot(T,m),d=s.m.Dot(S,m),D=Q*y-V*V;let o,L,t=D,A=D;D<O._Smallnum?(o=0,t=1,L=d,A=y):(o=V*d-y*U,L=Q*d-V*U,o<0?(o=0,L=d,A=y):o>t&&(o=t,L=d+V,A=y)),L<0?(L=0,-U<0?o=0:-U>Q?o=t:(o=-U,t=Q)):L>A&&(L=A,-U+V<0?o=0:-U+V>Q?o=t:(o=-U+V,t=Q));const H=Math.abs(o)<O._Smallnum?0:o/t,j=Math.abs(L)<O._Smallnum?0:L/A,b=s.i.Md[4];S.scaleToRef(j,b);const R=s.i.Md[5];T.scaleToRef(H,R),R.addInPlace(m);const n=s.i.Md[6];R.subtractToRef(b,n);return j>0&&j<=this.length&&n.lengthSquared()<x*x?R.length():-1}update(C,M,x,f,T,z,S){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){O._RayDistant||(O._RayDistant=O.Zero()),O._RayDistant.unprojectRayToRef(C,M,x,f,s.d.IdentityReadOnly,z,S);const m=s.i.Matrix[0];T.invertToRef(m),O.TransformToRef(O._RayDistant,m,this)}else this.unprojectRayToRef(C,M,x,f,T,z,S);return this}static Zero(){return new O(s.m.Zero(),s.m.Zero())}static CreateNew(C,M,x,f,T,z,s){return O.Zero().update(C,M,x,f,T,z,s)}static CreateNewFromTo(C,M){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:s.d.IdentityReadOnly;const f=new O(new s.m(0,0,0),new s.m(0,0,0));return O.CreateFromToToRef(C,M,f,x)}static CreateFromToToRef(C,M,x){let f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:s.d.IdentityReadOnly;x.origin.p(C);const T=M.subtractToRef(C,x.direction),z=Math.sqrt(T.x*T.x+T.y*T.y+T.z*T.z);return x.length=z,x.direction.normalize(),O.TransformToRef(x,f,x)}static Transform(C,M){const x=new O(new s.m(0,0,0),new s.m(0,0,0));return O.TransformToRef(C,M,x),x}static TransformToRef(C,M,x){s.m.TransformCoordinatesToRef(C.origin,M,x.origin),s.m.TransformNormalToRef(C.direction,M,x.direction),x.length=C.length,x.epsilon=C.epsilon;const f=x.direction,T=f.length();if(0!==T&&1!==T){const C=1/T;f.x*=C,f.y*=C,f.z*=C,x.length*=T}return x}unprojectRayToRef(C,M,x,f,T,z,S){const m=s.i.Matrix[0];T.multiplyToRef(z,m),m.multiplyToRef(S,m),m.invert();const Q=V.c.LastCreatedEngine,y=s.i.Md[0];y.x=C/x*2-1,y.y=-(M/f*2-1),y.z=null!==Q&&void 0!==Q&&Q.useReverseDepthBuffer?1:null!==Q&&void 0!==Q&&Q.isNDCHalfZRange?0:-1;const U=s.i.Md[1].Hd(y.x,y.y,1-1e-8),O=s.i.Md[2],d=s.i.Md[3];s.m._UnprojectFromInvertedMatrixToRef(y,m,O),s.m._UnprojectFromInvertedMatrixToRef(U,m,d),this.origin.p(O),d.subtractToRef(O,this.direction),this.direction.normalize()}}function d(C,M,x,f,T){let z=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const s=O.Zero();return D(C,M,x,f,s,T,z),s}function D(C,M,x,f,T,z){let S=arguments.length>6&&void 0!==arguments[6]&&arguments[6],m=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const Q=C.getEngine();if(!z&&!(z=C.activeCamera))return C;const V=z.viewport,y=Q.getRenderHeight(),{x:U,y:O,width:d,height:D}=V.toGlobal(Q.getRenderWidth(),y),o=1/Q.getHardwareScalingLevel();return M=M*o-U,x=x*o-(y-O-D),T.update(M,x,d,D,f||s.d.IdentityReadOnly,S?s.d.IdentityReadOnly:z.getViewMatrix(),z.getProjectionMatrix(),m),C}function o(C,M,x,f,T){if(!Q.c)return C;const z=C.getEngine();if(!T&&!(T=C.activeCamera))throw new Error("Active camera not set");const S=T.viewport,m=z.getRenderHeight(),{x:V,y:y,width:U,height:O}=S.toGlobal(z.getRenderWidth(),m),d=s.d.Identity(),D=1/z.getHardwareScalingLevel();return M=M*D-V,x=x*D-(m-y-O),f.update(M,x,U,O,d,d,T.getProjectionMatrix()),C}function L(C,M,x,f,T,z,s,S){const m=M(f,x.enableDistantPicking),Q=x.intersects(m,T,s,z,f,S);return Q&&Q.hit?!T&&null!=C&&Q.distance>=C.distance?null:Q:null}function t(C,M,x,f,T,z){let S=null;const m=!!(C.activeCameras&&C.activeCameras.length>1&&C.cameraToUseForPointers!==C.activeCamera),V=C.cameraToUseForPointers||C.activeCamera,y=U.internalPickerForMesh||L;for(let Q=0;Q<C.meshes.length;Q++){const U=C.meshes[Q];if(x){if(!x(U,-1))continue}else if(!U.isEnabled()||!U.isVisible||!U.ge)continue;const O=m&&U.isWorldMatrixCameraDependent(),d=U.Be(O,V);if(U.hasThinInstances&&U.thinInstanceEnablePicking){const C=y(S,M,U,d,!0,!0,z);if(C){if(T)return C;const m=s.i.Matrix[1],Q=U.thinInstanceGetWorldMatrices();for(let C=0;C<Q.length;C++){if(x&&!x(U,C))continue;Q[C].multiplyToRef(d,m);const s=y(S,M,U,m,f,T,z,!0);if(s&&(S=s,S.thinInstanceIndex=C,f))return S}}}else{const C=y(S,M,U,d,f,T,z);if(C&&(S=C,f))return S}}return S||new Q.c}function A(C,M,x,f){if(!Q.c)return null;const T=[],z=!!(C.activeCameras&&C.activeCameras.length>1&&C.cameraToUseForPointers!==C.activeCamera),S=C.cameraToUseForPointers||C.activeCamera,m=U.internalPickerForMesh||L;for(let Q=0;Q<C.meshes.length;Q++){const V=C.meshes[Q];if(x){if(!x(V,-1))continue}else if(!V.isEnabled()||!V.isVisible||!V.ge)continue;const y=z&&V.isWorldMatrixCameraDependent(),U=V.Be(y,S);if(V.hasThinInstances&&V.thinInstanceEnablePicking){if(m(null,M,V,U,!0,!0,f)){const C=s.i.Matrix[1],z=V.thinInstanceGetWorldMatrices();for(let s=0;s<z.length;s++){if(x&&!x(V,s))continue;z[s].multiplyToRef(U,C);const S=m(null,M,V,C,!1,!1,f,!0);S&&(S.thinInstanceIndex=s,T.push(S))}}}else{const C=m(null,M,V,U,!1,!1,f);C&&T.push(C)}}return T}function H(C,M){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,f=arguments.length>3?arguments[3]:void 0,T=arguments.length>4?arguments[4]:void 0;f||(f=C.getWorldMatrix()),M.length=x,T?M.origin.p(T):M.origin.p(C.position);const z=s.i.Md[2];z.set(0,0,C._scene.useRightHandedSystem?-1:1);const S=s.i.Md[3];return s.m.TransformNormalToRef(z,f,S),s.m.NormalizeToRef(S,M.direction),M}var j,b;O._TmpVector3=(0,S.d)(6,s.m.Zero),O._RayDistant=O.Zero(),O._Smallnum=1e-8,O._Rayl=1e9,j=f.e,(b=T.c)&&(b.prototype.getForwardRay=function(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,M=arguments.length>1?arguments[1]:void 0,x=arguments.length>2?arguments[2]:void 0;return H(this,new O(s.m.Zero(),s.m.Zero(),C),C,M,x)},b.prototype.getForwardRayToRef=function(C){return H(this,C,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),j&&(y.e._IsPickingAvailable=!0,j.prototype.createPickingRay=function(C,M,x,f){return d(this,C,M,x,f,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),f.e.prototype.createPickingRayToRef=function(C,M,x,f,T){return D(this,C,M,x,f,T,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},f.e.prototype.createPickingRayInCameraSpace=function(C,M,x){return function(C,M,x,f){const T=O.Zero();return o(C,M,x,T,f),T}(this,C,M,x)},f.e.prototype.createPickingRayInCameraSpaceToRef=function(C,M,x,f){return o(this,C,M,x,f)},f.e.prototype.pickWithBoundingInfo=function(C,M,x,f,T){return function(C,M,x,f,T,z){if(!Q.c)return null;const S=t(C,(f=>(C._tempPickingRay||(C._tempPickingRay=O.Zero()),D(C,M,x,f,C._tempPickingRay,z||null),C._tempPickingRay)),f,T,!0);return S&&(S.ray=d(C,M,x,s.d.Identity(),z||null)),S}(this,C,M,x,f,T)},f.e.prototype.fe=function(C,M,x,f,T,z){return function(C,M,x,f,T,z,S){const m=t(C,((f,T)=>(C._tempPickingRay||(C._tempPickingRay=O.Zero()),D(C,M,x,f,C._tempPickingRay,z||null,!1,T),C._tempPickingRay)),f,T,!1,S);return m&&(m.ray=d(C,M,x,s.d.Identity(),z||null)),m}(this,C,M,x,f,T,z)},f.e.prototype.pickWithRay=function(C,M,x,f){return function(C,M,x,f,T){const z=t(C,(x=>(C._pickWithRayInverseMatrix||(C._pickWithRayInverseMatrix=s.d.Identity()),x.invertToRef(C._pickWithRayInverseMatrix),C._cachedRayForTransform||(C._cachedRayForTransform=O.Zero()),O.TransformToRef(M,C._pickWithRayInverseMatrix,C._cachedRayForTransform),C._cachedRayForTransform)),x,f,!1,T);return z&&(z.ray=M),z}(this,C,M,x,f)},f.e.prototype.multiPick=function(C,M,x,f,T){return function(C,M,x,f,T,z){return A(C,(f=>d(C,M,x,f,T||null)),f,z)}(this,C,M,x,f,T)},f.e.prototype.multiPickWithRay=function(C,M,x){return function(C,M,x,f){return A(C,(x=>(C._pickWithRayInverseMatrix||(C._pickWithRayInverseMatrix=s.d.Identity()),x.invertToRef(C._pickWithRayInverseMatrix),C._cachedRayForTransform||(C._cachedRayForTransform=O.Zero()),O.TransformToRef(M,C._pickWithRayInverseMatrix,C._cachedRayForTransform),C._cachedRayForTransform)),x,f)}(this,C,M,x)}},12763:(C,M,x)=>{"use strict";x(1078);var f=x(1383);x(1121),x(1228),x(1e3),x(1424),x(1388);f.d},11580:(C,M,x)=>{"use strict";x.r(M),x.d(M,{SceneInstrumentation:()=>z});var f=x(1192),T=x(1269);class z{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(C){C!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=C,C?(this._onBeforeActiveMeshesEvaluationObserver=this.xe.onBeforeActiveMeshesEvaluationObservable.add((()=>{f.i.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.xe.onAfterActiveMeshesEvaluationObservable.add((()=>{f.i.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.xe.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.xe.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(C){C!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=C,C?(this._onBeforeRenderTargetsRenderObserver=this.xe.onBeforeRenderTargetsRenderObservable.add((()=>{f.i.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.xe.onAfterRenderTargetsRenderObservable.add((()=>{f.i.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.xe.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.xe.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(C){C!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=C,C?(this._onBeforeParticlesRenderingObserver=this.xe.onBeforeParticlesRenderingObservable.add((()=>{f.i.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.xe.onAfterParticlesRenderingObservable.add((()=>{f.i.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.xe.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.xe.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(C){C!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=C,this.xe.spriteManagers&&(C?(this._onBeforeSpritesRenderingObserver=this.xe.onBeforeSpritesRenderingObservable.add((()=>{f.i.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.xe.onAfterSpritesRenderingObservable.add((()=>{f.i.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.xe.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.xe.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(C){C!==this._capturePhysicsTime&&this.xe.onBeforePhysicsObservable&&(this._capturePhysicsTime=C,C?(this._onBeforePhysicsObserver=this.xe.onBeforePhysicsObservable.add((()=>{f.i.StartPerformanceCounter("ib"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.xe.onAfterPhysicsObservable.add((()=>{f.i.EndPerformanceCounter("ib"),this._physicsTime.endMonitoring()}))):(this.xe.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.xe.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(C){C!==this._captureAnimationsTime&&(this._captureAnimationsTime=C,C?this._onAfterAnimationsObserver=this.xe.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.xe.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(C){this._captureFrameTime=C}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(C){this._captureInterFrameTime=C}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(C){C!==this._captureRenderTime&&(this._captureRenderTime=C,C?(this._onBeforeDrawPhaseObserver=this.xe.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),f.i.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.xe.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),f.i.EndPerformanceCounter("Main render")}))):(this.xe.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.xe.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(C){C!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=C,C?(this._onBeforeCameraRenderObserver=this.xe.onBeforeCameraRenderObservable.add((C=>{this._cameraRenderTime.beginMonitoring(),f.i.StartPerformanceCounter(`Rendering camera ${C.name}`)})),this._onAfterCameraRenderObserver=this.xe.onAfterCameraRenderObservable.add((C=>{this._cameraRenderTime.endMonitoring(!1),f.i.EndPerformanceCounter(`Rendering camera ${C.name}`)}))):(this.xe.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.xe.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.xe.getEngine()._drawCalls}constructor(C){this.xe=C,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new T.c,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new T.c,this._captureFrameTime=!1,this._frameTime=new T.c,this._captureRenderTime=!1,this._renderTime=new T.c,this._captureInterFrameTime=!1,this._interFrameTime=new T.c,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new T.c,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new T.c,this._capturePhysicsTime=!1,this._physicsTime=new T.c,this._captureAnimationsTime=!1,this._animationsTime=new T.c,this._captureCameraRenderTime=!1,this._cameraRenderTime=new T.c,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._onBeforeAnimationsObserver=C.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(f.i.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.xe.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=C.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(f.i.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.Yd(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.Yd(),this._captureParticlesRenderTime&&this._particlesRenderTime.Yd(),this._captureSpritesRenderTime&&this._spritesRenderTime.Yd(),this._captureRenderTime&&this._renderTime.Yd(),this._captureCameraRenderTime&&this._cameraRenderTime.Yd()}))}dispose(){this.xe.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.xe.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.xe.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.xe.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.xe.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.xe.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.xe.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.xe.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.xe.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.xe.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.xe.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.xe.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.xe.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.xe.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.xe.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.xe.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.xe.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.xe=null}}},12384:(C,M,x)=>{"use strict";x.d(M,{b:()=>V});var f=x(951),T=x(959),z=x(978),s=x(11734),S=x(12359),m=x(12390),Q=x(997);s.e.AddNodeConstructor("Light_Type_1",((C,M)=>()=>new V(C,z.m.Zero(),M)));class V extends m.e{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(C){this._shadowFrustumSize=C,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(C){this._shadowOrthoScale=C,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(C){this._orthoLeft=C}get orthoRight(){return this._orthoRight}set orthoRight(C){this._orthoRight=C}get orthoTop(){return this._orthoTop}set orthoTop(C){this._orthoTop=C}get orthoBottom(){return this._orthoBottom}set orthoBottom(C){this._orthoBottom=C}constructor(C,M,x){super(C,x),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=M.scale(-1),this.direction=M}getClassName(){return"jb"}getTypeID(){return S.c.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(C,M,x){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(C):this._setDefaultAutoExtendShadowProjectionMatrix(C,M,x)}_setDefaultFixedFrustumShadowProjectionMatrix(C){const M=this.va().activeCamera;M&&z.d.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:M.lj,void 0!==this.shadowMaxZ?this.shadowMaxZ:M.maxZ,C,this.va().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(C,M,x){const f=this.va().activeCamera;if(!f)return;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const C=z.m.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let f=Number.MAX_VALUE,T=-Number.MAX_VALUE;for(let s=0;s<x.length;s++){const S=x[s];if(!S)continue;const m=S.getBoundingInfo().boundingBox;for(let x=0;x<m.vectorsWorld.length;x++)z.m.TransformCoordinatesToRef(m.vectorsWorld[x],M,C),C.x<this._orthoLeft&&(this._orthoLeft=C.x),C.y<this._orthoBottom&&(this._orthoBottom=C.y),C.x>this._orthoRight&&(this._orthoRight=C.x),C.y>this._orthoTop&&(this._orthoTop=C.y),this.autoCalcShadowZBounds&&(C.z<f&&(f=C.z),C.z>T&&(T=C.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=f,this._shadowMaxZ=T)}const T=this._orthoRight-this._orthoLeft,s=this._orthoTop-this._orthoBottom,S=void 0!==this.shadowMinZ?this.shadowMinZ:f.lj,m=void 0!==this.shadowMaxZ?this.shadowMaxZ:f.maxZ,Q=this.va().getEngine().useReverseDepthBuffer;z.d.OrthoOffCenterLHToRef(this._orthoLeft-T*this.shadowOrthoScale,this._orthoRight+T*this.shadowOrthoScale,this._orthoBottom-s*this.shadowOrthoScale,this._orthoTop+s*this.shadowOrthoScale,Q?m:S,Q?S:m,C,this.va().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(C,M){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,M),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,M),this)}transferToNodeMaterialEffect(C,M){return this.computeTransformedInformation()?(C.setFloat3(M,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(C.setFloat3(M,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(C){const M=this._scene.getEngine();return!M.useReverseDepthBuffer&&M.isNDCHalfZRange?0:1}getDepthMaxZ(C){const M=this._scene.getEngine();return M.useReverseDepthBuffer&&M.isNDCHalfZRange?0:1}prepareLightSpecificDefines(C,M){C["DIRLIGHT"+M]=!0}}(0,f.e)([(0,T.J)()],V.prototype,"shadowFrustumSize",null),(0,f.e)([(0,T.J)()],V.prototype,"shadowOrthoScale",null),(0,f.e)([(0,T.J)()],V.prototype,"autoUpdateExtends",void 0),(0,f.e)([(0,T.J)()],V.prototype,"autoCalcShadowZBounds",void 0),(0,f.e)([(0,T.J)("orthoLeft")],V.prototype,"_orthoLeft",void 0),(0,f.e)([(0,T.J)("orthoRight")],V.prototype,"_orthoRight",void 0),(0,f.e)([(0,T.J)("orthoTop")],V.prototype,"_orthoTop",void 0),(0,f.e)([(0,T.J)("orthoBottom")],V.prototype,"_orthoBottom",void 0),(0,Q.f)("BABYLON.DirectionalLight",V)},12694:(C,M,x)=>{"use strict";x.d(M,{d:()=>V});var f=x(951),T=x(959),z=x(978),s=x(1162),S=x(11734),m=x(12359),Q=x(997);S.e.AddNodeConstructor("Light_Type_3",((C,M)=>()=>new V(C,z.m.Zero(),M)));class V extends m.c{constructor(C,M,x){super(C,x),this.groundColor=new s.d(0,0,0),this.direction=M||z.m.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"kb"}setDirectionToTarget(C){return this.direction=z.m.Normalize(C.rc(z.m.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(C,M){const x=z.m.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",x.x,x.y,x.z,0,M),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.pj),M),this}transferToNodeMaterialEffect(C,M){const x=z.m.Normalize(this.direction);return C.setFloat3(M,x.x,x.y,x.z),this}Be(){return this._worldMatrix||(this._worldMatrix=z.d.Identity()),this._worldMatrix}getTypeID(){return m.c.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(C,M){C["HEMILIGHT"+M]=!0}}(0,f.e)([(0,T.l)()],V.prototype,"groundColor",void 0),(0,f.e)([(0,T.H)()],V.prototype,"direction",void 0),(0,Q.f)("BABYLON.HemisphericLight",V)},12359:(C,M,x)=>{"use strict";x.d(M,{c:()=>U});var f=x(951),T=x(959),z=x(978),s=x(1162),S=x(11734),m=x(1215),Q=x(997),V=x(1282),y=x(1145);class U extends S.e{get range(){return this._range}set range(C){this._range=C,this._inverseSquaredRange=1/(this.range*this.range)}get intensityMode(){return this._intensityMode}set intensityMode(C){this._intensityMode=C,this._computePhotometricScale()}get i(){return this._radius}set i(C){this._radius=C,this._computePhotometricScale()}get shadowEnabled(){return this._shadowEnabled}set shadowEnabled(C){this._shadowEnabled!==C&&(this._shadowEnabled=C,this._markMeshesAsLightDirty())}get includedOnlyMeshes(){return this._includedOnlyMeshes}set includedOnlyMeshes(C){this._includedOnlyMeshes=C,this._hookArrayForIncludedOnly(C)}get excludedMeshes(){return this._excludedMeshes}set excludedMeshes(C){this._excludedMeshes=C,this._hookArrayForExcluded(C)}get excludeWithLayerMask(){return this._excludeWithLayerMask}set excludeWithLayerMask(C){this._excludeWithLayerMask=C,this._resyncMeshes()}get includeOnlyWithLayerMask(){return this._includeOnlyWithLayerMask}set includeOnlyWithLayerMask(C){this._includeOnlyWithLayerMask=C,this._resyncMeshes()}get lightmapMode(){return this._lightmapMode}set lightmapMode(C){this._lightmapMode!==C&&(this._lightmapMode=C,this._markMeshesAsLightDirty())}getViewMatrix(C){return null}getProjectionMatrix(C,M){return null}constructor(C,M){super(C,M,!1),this.Zh=new s.d(1,1,1),this.Se=new s.d(1,1,1),this.falloffType=U.FALLOFF_DEFAULT,this.pj=1,this._range=Number.MAX_VALUE,this._inverseSquaredRange=0,this._photometricScale=1,this._intensityMode=U.INTENSITYMODE_AUTOMATIC,this._radius=1e-5,this.renderPriority=0,this._shadowEnabled=!0,this._excludeWithLayerMask=0,this._includeOnlyWithLayerMask=0,this._lightmapMode=0,this._shadowGenerators=null,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,this._isLight=!0,this.va().addLight(this),this._uniformBuffer=new m.b(this.va().getEngine(),void 0,void 0,C),this._buildUniformLayout(),this.includedOnlyMeshes=[],this.excludedMeshes=[],this._resyncMeshes()}transferTexturesToEffect(C,M){return this}_bindLight(C,M,x,f){let T=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const z=C.toString();let S=!1;if(this._uniformBuffer.bindToEffect(x,"Light"+z),this._renderId!==M.getRenderId()||this._lastUseSpecular!==f||!this._uniformBuffer.useUbo){this._renderId=M.getRenderId(),this._lastUseSpecular=f;const C=this.getScaledIntensity();this.transferToEffect(x,z),this.Zh.scaleToRef(C,s.f._d[0]),this._uniformBuffer.updateColor4("vLightDiffuse",s.f._d[0],this.range,z),f&&(this.Se.scaleToRef(C,s.f._d[1]),this._uniformBuffer.updateColor4("vLightSpecular",s.f._d[1],this.i,z)),S=!0}if(this.transferTexturesToEffect(x,z),M.shadowsEnabled&&this.shadowEnabled&&T){const C=this.getShadowGenerator(M.activeCamera)??this.getShadowGenerator();C&&(C.bindShadowLight(z,x),S=!0)}S?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()}getClassName(){return"Light"}toString(C){let M="Name: "+this.name;if(M+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(let x=0;x<this.animations.length;x++)M+=", animation[0]: "+this.animations[x].toString(C);return M}_syncParentEnabledState(){super._syncParentEnabledState(),this.u()||this._resyncMeshes()}Og(C){super.Og(C),this._resyncMeshes()}getShadowGenerator(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===this._shadowGenerators?null:this._shadowGenerators.get(C)??null}getShadowGenerators(){return this._shadowGenerators}getAbsolutePosition(){return z.m.Zero()}canAffectMesh(C){return!C||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(C))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(C))&&((0===this.includeOnlyWithLayerMask||0!==(this.includeOnlyWithLayerMask&C.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&C.layerMask)))}dispose(C){let M=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._shadowGenerators){const C=this._shadowGenerators.values();for(let M=C.next();!0!==M.done;M=C.next()){M.value.dispose()}this._shadowGenerators=null}if(this.va().stopAnimation(this),this._parentContainer){const C=this._parentContainer.lights.indexOf(this);C>-1&&this._parentContainer.lights.splice(C,1),this._parentContainer=null}for(const x of this.va().meshes)x._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.va().removeLight(this),super.dispose(C,M)}getTypeID(){return 0}getScaledIntensity(){return this._photometricScale*this.pj}clone(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const x=U.GetConstructorFromName(this.getTypeID(),C,this.va());if(!x)return null;const f=y.e.Clone(x,this);return C&&(f.name=C),M&&(f.parent=M),f.Og(this.isEnabled()),this.onClonedObservable.notifyObservers(f),f}serialize(){const C=y.e.Serialize(this);return C.uniqueId=this.uniqueId,C.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(C),this.excludedMeshes.length>0&&(C.excludedMeshesIds=[],this.excludedMeshes.forEach((M=>{C.excludedMeshesIds.push(M.id)}))),this.includedOnlyMeshes.length>0&&(C.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach((M=>{C.includedOnlyMeshesIds.push(M.id)}))),y.e.AppendSerializedAnimations(this,C),C.ranges=this.serializeAnimationRanges(),C.isEnabled=this.isEnabled(),C}static GetConstructorFromName(C,M,x){const f=S.e.Construct("Light_Type_"+C,M,x);return f||null}static Parse(C,M){const x=U.GetConstructorFromName(C.type,C.name,M);if(!x)return null;const f=y.e.Parse(x,C,M);if(C.excludedMeshesIds&&(f._excludedMeshesIds=C.excludedMeshesIds),C.includedOnlyMeshesIds&&(f._includedOnlyMeshesIds=C.includedOnlyMeshesIds),void 0!==C.parentId&&(f._waitingParentId=C.parentId),void 0!==C.parentInstanceIndex&&(f._waitingParentInstanceIndex=C.parentInstanceIndex),void 0!==C.falloffType&&(f.falloffType=C.falloffType),void 0!==C.lightmapMode&&(f.lightmapMode=C.lightmapMode),C.animations){for(let M=0;M<C.animations.length;M++){const x=C.animations[M],T=(0,Q.c)("BABYLON.Animation");T&&f.animations.push(T.Parse(x))}S.e.ParseAnimationRanges(f,C,M)}return C.autoAnimate&&M.beginAnimation(f,C.autoAnimateFrom,C.autoAnimateTo,C.autoAnimateLoop,C.autoAnimateSpeed||1),void 0!==C.isEnabled&&f.Og(C.isEnabled),f}_hookArrayForExcluded(C){var M=this;const x=C.push;C.push=function(){for(var f=arguments.length,T=new Array(f),z=0;z<f;z++)T[z]=arguments[z];const s=x.apply(C,T);for(const C of T)C._resyncLightSource(M);return s};const f=C.splice;C.splice=(M,x)=>{const T=f.apply(C,[M,x]);for(const C of T)C._resyncLightSource(this);return T};for(const T of C)T._resyncLightSource(this)}_hookArrayForIncludedOnly(C){var M=this;const x=C.push;C.push=function(){for(var f=arguments.length,T=new Array(f),z=0;z<f;z++)T[z]=arguments[z];const s=x.apply(C,T);return M._resyncMeshes(),s};const f=C.splice;C.splice=(M,x)=>{const T=f.apply(C,[M,x]);return this._resyncMeshes(),T},this._resyncMeshes()}_resyncMeshes(){for(const C of this.va().meshes)C._resyncLightSource(this)}_markMeshesAsLightDirty(){for(const C of this.va().meshes)-1!==C.lightSources.indexOf(this)&&C._markSubMeshesAsLightDirty()}_computePhotometricScale(){this._photometricScale=this._getPhotometricScale(),this.va().resetCachedMaterial()}_getPhotometricScale(){let C=0;const M=this.getTypeID();let x=this.intensityMode;switch(x===U.INTENSITYMODE_AUTOMATIC&&(x=M===U.LIGHTTYPEID_DIRECTIONALLIGHT?U.INTENSITYMODE_ILLUMINANCE:U.INTENSITYMODE_LUMINOUSINTENSITY),M){case U.LIGHTTYPEID_POINTLIGHT:case U.LIGHTTYPEID_SPOTLIGHT:switch(x){case U.INTENSITYMODE_LUMINOUSPOWER:C=1/(4*Math.PI);break;case U.INTENSITYMODE_LUMINOUSINTENSITY:C=1;break;case U.INTENSITYMODE_LUMINANCE:C=this.i*this.i}break;case U.LIGHTTYPEID_DIRECTIONALLIGHT:switch(x){case U.INTENSITYMODE_ILLUMINANCE:C=1;break;case U.INTENSITYMODE_LUMINANCE:{let M=this.i;M=Math.max(M,.001);C=2*Math.PI*(1-Math.cos(M));break}}break;case U.LIGHTTYPEID_HEMISPHERICLIGHT:C=1}return C}_reorderLightsInScene(){const C=this.va();0!=this._renderPriority&&(C.requireLightSorting=!0),this.va().sortLightsByPriority()}}U.FALLOFF_DEFAULT=V.b.FALLOFF_DEFAULT,U.FALLOFF_PHYSICAL=V.b.FALLOFF_PHYSICAL,U.FALLOFF_GLTF=V.b.FALLOFF_GLTF,U.FALLOFF_STANDARD=V.b.FALLOFF_STANDARD,U.LIGHTMAP_DEFAULT=V.b.LIGHTMAP_DEFAULT,U.LIGHTMAP_SPECULAR=V.b.LIGHTMAP_SPECULAR,U.LIGHTMAP_SHADOWSONLY=V.b.LIGHTMAP_SHADOWSONLY,U.INTENSITYMODE_AUTOMATIC=V.b.INTENSITYMODE_AUTOMATIC,U.INTENSITYMODE_LUMINOUSPOWER=V.b.INTENSITYMODE_LUMINOUSPOWER,U.INTENSITYMODE_LUMINOUSINTENSITY=V.b.INTENSITYMODE_LUMINOUSINTENSITY,U.INTENSITYMODE_ILLUMINANCE=V.b.INTENSITYMODE_ILLUMINANCE,U.INTENSITYMODE_LUMINANCE=V.b.INTENSITYMODE_LUMINANCE,U.LIGHTTYPEID_POINTLIGHT=V.b.LIGHTTYPEID_POINTLIGHT,U.LIGHTTYPEID_DIRECTIONALLIGHT=V.b.LIGHTTYPEID_DIRECTIONALLIGHT,U.LIGHTTYPEID_SPOTLIGHT=V.b.LIGHTTYPEID_SPOTLIGHT,U.LIGHTTYPEID_HEMISPHERICLIGHT=V.b.LIGHTTYPEID_HEMISPHERICLIGHT,(0,f.e)([(0,T.l)()],U.prototype,"diffuse",void 0),(0,f.e)([(0,T.l)()],U.prototype,"specular",void 0),(0,f.e)([(0,T.J)()],U.prototype,"falloffType",void 0),(0,f.e)([(0,T.J)()],U.prototype,"intensity",void 0),(0,f.e)([(0,T.J)()],U.prototype,"range",null),(0,f.e)([(0,T.J)()],U.prototype,"intensityMode",null),(0,f.e)([(0,T.J)()],U.prototype,"i",null),(0,f.e)([(0,T.J)()],U.prototype,"_renderPriority",void 0),(0,f.e)([(0,T.e)("_reorderLightsInScene")],U.prototype,"renderPriority",void 0),(0,f.e)([(0,T.J)("shadowEnabled")],U.prototype,"_shadowEnabled",void 0),(0,f.e)([(0,T.J)("excludeWithLayerMask")],U.prototype,"_excludeWithLayerMask",void 0),(0,f.e)([(0,T.J)("includeOnlyWithLayerMask")],U.prototype,"_includeOnlyWithLayerMask",void 0),(0,f.e)([(0,T.J)("lightmapMode")],U.prototype,"_lightmapMode",void 0)},12390:(C,M,x)=>{"use strict";x.d(M,{e:()=>m});var f=x(951),T=x(959),z=x(978),s=x(12359),S=x(1447);class m extends s.c{constructor(){super(...arguments),this._needProjectionMatrixCompute=!0,this._viewMatrix=z.d.Identity(),this._projectionMatrix=z.d.Identity()}_setPosition(C){this._position=C}get position(){return this._position}set position(C){this._setPosition(C)}_setDirection(C){this._direction=C}get direction(){return this._direction}set direction(C){this._setDirection(C)}get shadowMinZ(){return this._shadowMinZ}set shadowMinZ(C){this._shadowMinZ=C,this.forceProjectionMatrixCompute()}get shadowMaxZ(){return this._shadowMaxZ}set shadowMaxZ(C){this._shadowMaxZ=C,this.forceProjectionMatrixCompute()}computeTransformedInformation(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=z.m.Zero()),z.m.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=z.m.Zero()),z.m.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)}getDepthScale(){return 50}getShadowDirection(C){return this.transformedDirection?this.transformedDirection:this.direction}getAbsolutePosition(){return this.transformedPosition?this.transformedPosition:this.position}setDirectionToTarget(C){return this.direction=z.m.Normalize(C.rc(this.position)),this.direction}getRotation(){this.direction.normalize();const C=z.m.Cross(this.direction,S.d.Y),M=z.m.Cross(C,this.direction);return z.m.RotationFromAxis(C,M,this.direction)}needCube(){return!1}needProjectionMatrixCompute(){return this._needProjectionMatrixCompute}forceProjectionMatrixCompute(){this._needProjectionMatrixCompute=!0}_initCache(){super._initCache(),this._cache.position=z.m.Zero()}_isSynchronized(){return!!this._cache.position.equals(this.position)}Be(C){return!C&&this.isSynchronized()?(this._currentRenderId=this.va().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.p(this.position),this._worldMatrix||(this._worldMatrix=z.d.Identity()),z.d.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)}getDepthMinZ(C){return void 0!==this.shadowMinZ?this.shadowMinZ:C.lj}getDepthMaxZ(C){return void 0!==this.shadowMaxZ?this.shadowMaxZ:C.maxZ}setShadowProjectionMatrix(C,M,x){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(M,x,C):this._setDefaultShadowProjectionMatrix(C,M,x),this}_syncParentEnabledState(){super._syncParentEnabledState(),this.parent&&this.parent.getWorldMatrix||(this.transformedPosition=null,this.transformedDirection=null)}getViewMatrix(C){const M=z.i.Md[0];let x=this.position;this.computeTransformedInformation()&&(x=this.transformedPosition),z.m.NormalizeToRef(this.getShadowDirection(C),M),1===Math.abs(z.m.Dot(M,z.m.Up()))&&(M.z=1e-13);const f=z.i.Md[1];return x.addToRef(M,f),z.d.LookAtLHToRef(x,f,z.m.Up(),this._viewMatrix),this._viewMatrix}getProjectionMatrix(C,M){return this.setShadowProjectionMatrix(this._projectionMatrix,C??this._viewMatrix,M??[]),this._projectionMatrix}}(0,f.e)([(0,T.H)()],m.prototype,"position",null),(0,f.e)([(0,T.H)()],m.prototype,"direction",null),(0,f.e)([(0,T.J)()],m.prototype,"shadowMinZ",null),(0,f.e)([(0,T.J)()],m.prototype,"shadowMaxZ",null)},11879:(C,M,x)=>{"use strict";x.d(M,{b:()=>s,e:()=>z,f:()=>S});const f={},T={};function z(C,M){f[C]=M}function s(C,M){T[C]=M}function S(C){return T[C]?T[C]:null}},11812:(C,M,x)=>{"use strict";x.d(M,{e:()=>c,g:()=>b});var f,T=x(1192),z=x(971),s=x(1190),S=x(1008),m=x(1078),Q=x(11756),V=x(1035),y=x(1052),U=x(1028),O=x(1086);!function(C){C[C.Clean=0]="Clean",C[C.Stop=1]="Stop",C[C.Sync=2]="Sync",C[C.NoSync=3]="NoSync"}(f||(f={}));const d=new z.c,D={};let o=!1;function L(){return D[".babylon"]}function t(C){const M=D[C];return M||(m.e.Warn("Unable to find a plugin to load "+C+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),L())}function A(C,M,x){let f="Unable to load from "+(C.rawData?"binary data":C.url);return M?f+=`: ${M}`:x&&(f+=`: ${x}`),f}function H(C,M,x,f,T,z,s,S,m){var Q;const y="data:"===(U=C.url).substring(0,5)?U.substring(5):null;var U;if(C.rawData&&!s)throw"When using ArrayBufferView to load data the file extension must be provided.";const o=s?t(s):y?function(C){for(const M in D){const x=D[M].plugin;if(x.canDirectLoad&&x.canDirectLoad(C))return D[M]}return L()}(C.url):function(C){const M=C.indexOf("?");-1!==M&&(C=C.substring(0,M));const x=C.lastIndexOf(".");return t(C.substring(x,C.length).toLowerCase())}(C.url);if(!o)throw new Error(`No plugin or fallback for ${s??C.url}`);if(!1===(null===m||void 0===m||null===(Q=m[o.plugin.name])||void 0===Q?void 0:Q.enabled))throw new Error(`The '${o.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(C.rawData&&!o.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(C=>{if(o.plugin.createPlugin){const M=o.plugin.createPlugin(m??{});return M instanceof Promise?(M.then(C).catch((C=>{T("Error instantiating plugin.",C)})),null):(C(M),M)}return C(o.plugin),o.plugin})((m=>{var Q;if(!m)throw`The loader plugin corresponding to the '${s}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(d.notifyObservers(m),y&&(m.canDirectLoad&&m.canDirectLoad(C.url)||!(0,V.f)(C.url))){if(m.directLoad){const C=m.directLoad(M,y);C instanceof Promise?C.then((C=>{x(m,C)})).catch((C=>{T("Error in directLoad of _loadData: "+C,C)})):x(m,C)}else x(m,y);return}const U=o.isBinary,D=(C,f)=>{M.u?T("Scene has been disposed"):x(m,C,f)};let L=null,t=!1;null===(Q=m.Sd)||void 0===Q||Q.add((()=>{t=!0,L&&(L.abort(),L=null),z()}));const A=()=>{if(t)return;const x=(C,M)=>{T(null===C||void 0===C?void 0:C.statusText,M)};if(!m.loadFile&&C.rawData)throw"Plugin does not support loading ArrayBufferView.";L=m.loadFile?m.loadFile(M,C.rawData||C.file||C.url,C.rootUrl,D,f,U,x,S):M._loadFile(C.file||C.url,D,f,!0,U,x)},H=M.getEngine();let j=H.enableOfflineSupport;if(j){let x=!1;for(const f of M.disableOfflineSupportExceptionRules)if(f.test(C.url)){x=!0;break}j=!x}j&&O.e.OfflineProviderFactory?M.offlineProvider=O.e.OfflineProviderFactory(C.url,A,H.disableManifestCheck):A()}))}function j(C,M){let x,f,z=null,s=null;if(M)if(M.name)x=`file:${M.name}`,f=M.name,z=M;else if(ArrayBuffer.isView(M))x="",f=(0,U.c)(),s=M;else if(M.startsWith("data:"))x=M,f="";else if(C){const z=M;if("/"===z.substring(0,1))return T.i.Error("Wrong sceneFilename parameter"),null;x=C+z,f=z}else x=M,f=T.i.GetFilename(M),C=T.i.GetFolderPath(M);else x=C,f=T.i.GetFilename(C),C=T.i.GetFolderPath(C);return{url:x,rootUrl:C,name:f,file:z,rawData:s}}function b(C){if("string"===typeof C.extensions){const M=C.extensions;D[M.toLowerCase()]={plugin:C,isBinary:!1}}else{const M=C.extensions;Object.keys(M).forEach((x=>{D[x.toLowerCase()]={plugin:C,isBinary:M[x].isBinary}}))}}function R(C,M){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:S.c.LastCreatedScene,T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,V=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",U=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!f)return m.e.Error("No scene available to import mesh to"),null;const O=j(M,x);if(!O)return null;const d={};f.addPendingData(d);const D=()=>{f.removePendingData(d)},o=(C,M)=>{const x=A(O,C,M);s?s(f,x,new y.g(x,y.f.SceneLoaderError,M)):m.e.Error(x),D()},L=z?C=>{try{z(C)}catch(M){o("Error in onProgress callback: "+M,M)}}:void 0,t=(C,M,x,z,s,S,m,Q)=>{if(f.importedMeshesFiles.push(O.url),T)try{T(C,M,x,z,s,S,m,Q)}catch(V){o("Error in onSuccess callback: "+V,V)}f.removePendingData(d)};return H(O,f,((M,x,T)=>{if(M.rewriteRootURL&&(O.rootUrl=M.rewriteRootURL(O.rootUrl,T)),M.importMesh){const T=[],z=[],s=[];if(!M.importMesh(C,f,x,O.rootUrl,T,z,s,o))return;f.loadingPluginName=M.name,t(T,z,s,[],[],[],[],[])}else{M.importMeshAsync(C,f,x,O.rootUrl,L,O.name).then((C=>{f.loadingPluginName=M.name,t(C.meshes,C.te,C.skeletons,C.animationGroups,C.transformNodes,C.geometries,C.lights,C.spriteManagers)})).catch((C=>{o(C.message,C)}))}}),L,o,D,Q,V,U)}function n(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:S.c.LastCreatedEngine,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,V=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",y=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};return x?X(C,M,new s.e(x),f,z,m,Q,V,y):(T.i.Error("No engine available"),null)}function I(C,M,x,f,T,z,s){return new Promise(((S,m)=>{n(C,M,x,(C=>{S(C)}),f,((C,M,x)=>{m(x||new Error(M))}),T,z,s)}))}function X(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:S.c.LastCreatedScene,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,V=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",U=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!x)return m.e.Error("No scene available to append to"),null;const O=j(C,M);if(!O)return null;const d={};x.addPendingData(d);const D=()=>{x.removePendingData(d)};Q.c.ShowLoadingScreen&&!o&&(o=!0,x.getEngine().displayLoadingUI(),x.executeWhenReady((()=>{x.getEngine().hideLoadingUI(),o=!1})));const L=(C,M)=>{const f=A(O,C,M);z?z(x,f,new y.g(f,y.f.SceneLoaderError,M)):m.e.Error(f),D()},t=T?C=>{try{T(C)}catch(M){L("Error in onProgress callback",M)}}:void 0,b=()=>{if(f)try{f(x)}catch(C){L("Error in onSuccess callback",C)}x.removePendingData(d)};return H(O,x,((C,M)=>{if(C.load){if(!C.load(x,M,O.rootUrl,L))return;x.loadingPluginName=C.name,b()}else{C.loadAsync(x,M,O.rootUrl,t,O.name).then((()=>{x.loadingPluginName=C.name,b()})).catch((C=>{L(C.message,C)}))}}),t,L,D,s,V,U)}function g(C,M,x,f,T,z,s){return new Promise(((S,m)=>{X(C,M,x,(C=>{S(C)}),f,((C,M,x)=>{m(x||new Error(M))}),T,z,s)}))}function B(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:S.c.LastCreatedScene,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",V=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!x)return m.e.Error("No scene available to load asset container to"),null;const U=j(C,M);if(!U)return null;const O={};x.addPendingData(O);const d=()=>{x.removePendingData(O)},D=(C,M)=>{const f=A(U,C,M);z?z(x,f,new y.g(f,y.f.SceneLoaderError,M)):m.e.Error(f),d()},o=T?C=>{try{T(C)}catch(M){D("Error in onProgress callback",M)}}:void 0,L=C=>{if(f)try{f(C)}catch(M){D("Error in onSuccess callback",M)}x.removePendingData(O)};return H(U,x,((C,M)=>{if(C.loadAssetContainer){const f=C.loadAssetContainer(x,M,U.rootUrl,D);if(!f)return;f.populateRootNodes(),x.loadingPluginName=C.name,L(f)}else if(C.loadAssetContainerAsync){C.loadAssetContainerAsync(x,M,U.rootUrl,o,U.name).then((M=>{M.populateRootNodes(),x.loadingPluginName=C.name,L(M)})).catch((C=>{D(C.message,C)}))}else D("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),o,D,d,s,Q,V)}function F(C,M,x,f,T,z,s){return new Promise(((S,m)=>{B(C,M,x,(C=>{S(C)}),f,((C,M,x)=>{m(x||new Error(M))}),T,z,s)}))}function P(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:S.c.LastCreatedScene,f=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,V=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,y=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,U=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",O=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!x)return void m.e.Error("No scene available to load animations to");if(f){for(const C of x.animatables)C.reset();x.stopAllAnimations(),x.animationGroups.slice().forEach((C=>{C.dispose()}));x.getNodes().forEach((C=>{C.animations&&(C.animations=[])}))}else switch(T){case 0:x.animationGroups.slice().forEach((C=>{C.dispose()}));break;case 1:x.animationGroups.forEach((C=>{C.stop()}));break;case 2:x.animationGroups.forEach((C=>{C.reset(),C.restart()}));break;case 3:break;default:return void m.e.Error("Unknown animation group loading mode value '"+T+"'")}const d=x.animatables.length;B(C,M,x,(C=>{C.mergeAnimationsTo(x,x.animatables.slice(d),z),C.dispose(),x.onAnimationFileImportedObservable.notifyObservers(x),s&&s(x)}),Q,V,y,U,O)}function h(C,M,x,f,T,z,s,S,m,Q){return new Promise(((V,y)=>{P(C,M,x,f,T,z,(C=>{V(C)}),s,((C,M,x)=>{y(x||new Error(M))}),S,m,Q)}))}class c{static get ForceFullSceneLoadingForIncremental(){return Q.c.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(C){Q.c.ForceFullSceneLoadingForIncremental=C}static get ShowLoadingScreen(){return Q.c.ShowLoadingScreen}static set ShowLoadingScreen(C){Q.c.ShowLoadingScreen=C}static get loggingLevel(){return Q.c.loggingLevel}static set loggingLevel(C){Q.c.loggingLevel=C}static get CleanBoneMatrixWeights(){return Q.c.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(C){Q.c.CleanBoneMatrixWeights=C}static GetDefaultPlugin(){return L()}static GetPluginForExtension(C){var M;return null===(M=t(C))||void 0===M?void 0:M.plugin}static IsPluginForExtensionAvailable(C){return function(C){return!!D[C]}(C)}static RegisterPlugin(C){b(C)}static ImportMesh(C,M,x,f,T,z,s,S,m){return R(C,M,x,f,T,z,s,S,m)}static ImportMeshAsync(C,M,x,f,T,z,s){return function(C,M,x,f,T,z,s,S){return new Promise(((m,Q)=>{R(C,M,x,f,((C,M,x,f,T,z,s,S)=>{m({meshes:C,te:M,skeletons:x,animationGroups:f,transformNodes:T,geometries:z,lights:s,spriteManagers:S})}),T,((C,M,x)=>{Q(x||new Error(M))}),z,s,S)}))}(C,M,x,f,T,z,s)}static Load(C,M,x,f,T,z,s,S){return n(C,M,x,f,T,z,s,S)}static LoadAsync(C,M,x,f,T,z){return I(C,M,x,f,T,z)}static Append(C,M,x,f,T,z,s,S){return X(C,M,x,f,T,z,s,S)}static AppendAsync(C,M,x,f,T,z){return g(C,M,x,f,T,z)}static LoadAssetContainer(C,M,x,f,T,z,s,S){return B(C,M,x,f,T,z,s,S)}static LoadAssetContainerAsync(C,M,x,f,T,z){return F(C,M,x,f,T,z)}static ImportAnimations(C,M,x,f,T,z,s,S,m,Q,V){P(C,M,x,f,T,z,s,S,m,Q,V)}static ImportAnimationsAsync(C,M,x,f,T,z,s,S,m,Q,V){return h(C,M,x,f,T,z,S,Q,V)}}c.NO_LOGGING=0,c.MINIMAL_LOGGING=1,c.SUMMARY_LOGGING=2,c.DETAILED_LOGGING=3,c.OnPluginActivatedObservable=d},11756:(C,M,x)=>{"use strict";x.d(M,{c:()=>f});class f{static get ForceFullSceneLoadingForIncremental(){return f._ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(C){f._ForceFullSceneLoadingForIncremental=C}static get ShowLoadingScreen(){return f._ShowLoadingScreen}static set ShowLoadingScreen(C){f._ShowLoadingScreen=C}static get loggingLevel(){return f._LoggingLevel}static set loggingLevel(C){f._LoggingLevel=C}static get CleanBoneMatrixWeights(){return f._CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(C){f._CleanBoneMatrixWeights=C}}f._ForceFullSceneLoadingForIncremental=!1,f._ShowLoadingScreen=!0,f._CleanBoneMatrixWeights=!1,f._LoggingLevel=0},12350:(C,M,x)=>{"use strict";x.d(M,{d:()=>a});var f=x(951),T=x(959),z=x(1078),s=x(1188),S=x(12342),m=x(1190),Q=x(978),V=x(1224),y=x(1343),U=x(1369);class O extends y.d{constructor(){super(...arguments),this.BRDF_V_HEIGHT_CORRELATED=!1,this.MS_BRDF_ENERGY_CONSERVATION=!1,this.SPHERICAL_HARMONICS=!1,this.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1}}class d extends U.c{_markAllSubMeshesAsMiscDirty(){this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(C){let M=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(C,"PBRBRDF",90,new O,M),this._useEnergyConservation=d.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=d.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=d.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=d.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=d.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=d.DEFAULT_USE_SPHERICAL_HARMONICS,this._useSpecularGlossinessInputEnergyConservation=d.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this.useSpecularGlossinessInputEnergyConservation=d.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this._internalMarkAllSubMeshesAsMiscDirty=C._dirtyCallbacks[16],this._enable(!0)}prepareDefines(C){C.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,C.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,C.SPHERICAL_HARMONICS=this._useSphericalHarmonics,C.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation}getClassName(){return"PBRBRDFConfiguration"}}d.DEFAULT_USE_ENERGY_CONSERVATION=!0,d.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,d.DEFAULT_USE_SPHERICAL_HARMONICS=!0,d.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0,(0,f.e)([(0,T.J)(),(0,T.e)("_markAllSubMeshesAsMiscDirty")],d.prototype,"useEnergyConservation",void 0),(0,f.e)([(0,T.J)(),(0,T.e)("_markAllSubMeshesAsMiscDirty")],d.prototype,"useSmithVisibilityHeightCorrelated",void 0),(0,f.e)([(0,T.J)(),(0,T.e)("_markAllSubMeshesAsMiscDirty")],d.prototype,"useSphericalHarmonics",void 0),(0,f.e)([(0,T.J)(),(0,T.e)("_markAllSubMeshesAsMiscDirty")],d.prototype,"useSpecularGlossinessInputEnergyConservation",void 0);var D=x(1286),o=x(1162),L=x(1201),t=x(1289),A=x(1350),H=x(945),j=x(1353),b=(x(10678),x(1358)),R=x(1329);class n extends y.d{constructor(){super(...arguments),this.CLEARCOAT=!1,this.CLEARCOAT_DEFAULTIOR=!1,this.CLEARCOAT_TEXTURE=!1,this.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this.CLEARCOAT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,this.CLEARCOAT_BUMP=!1,this.CLEARCOAT_BUMPDIRECTUV=0,this.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,this.CLEARCOAT_REMAP_F0=!1,this.CLEARCOAT_TINT=!1,this.CLEARCOAT_TINT_TEXTURE=!1,this.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TINT_GAMMATEXTURE=!1}}class I extends U.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(C){let M=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(C,"PBRClearCoat",100,new n,M),this._isEnabled=!1,this.isEnabled=!1,this.pj=1,this.roughness=0,this._indexOfRefraction=I._DefaultIndexOfRefraction,this.indexOfRefraction=I._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._textureRoughness=null,this.textureRoughness=null,this._remapF0OnInterfaceChange=!0,this.remapF0OnInterfaceChange=!0,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=o.d.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=C._dirtyCallbacks[1]}isReadyForSubMesh(C,M,x){if(!this._isEnabled)return!0;const f=this._material._disableBumpMap;if(C._areTexturesDirty&&M.texturesEnabled){if(this._texture&&j.b.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&j.b.ClearCoatTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1;if(x.getCaps().standardDerivatives&&this._bumpTexture&&j.b.ClearCoatBumpTextureEnabled&&!f&&!this._bumpTexture.isReady())return!1;if(this._isTintEnabled&&this._tintTexture&&j.b.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(C,M){this._isEnabled?(C.CLEARCOAT=!0,C.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,C.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange,C._areTexturesDirty&&M.texturesEnabled&&(this._texture&&j.b.ClearCoatTextureEnabled?(0,R.D)(this._texture,C,"CLEARCOAT_TEXTURE"):C.CLEARCOAT_TEXTURE=!1,this._textureRoughness&&j.b.ClearCoatTextureEnabled?(0,R.D)(this._textureRoughness,C,"CLEARCOAT_TEXTURE_ROUGHNESS"):C.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this._bumpTexture&&j.b.ClearCoatBumpTextureEnabled?(0,R.D)(this._bumpTexture,C,"CLEARCOAT_BUMP"):C.CLEARCOAT_BUMP=!1,C.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===I._DefaultIndexOfRefraction,this._isTintEnabled?(C.CLEARCOAT_TINT=!0,this._tintTexture&&j.b.ClearCoatTintTextureEnabled?((0,R.D)(this._tintTexture,C,"CLEARCOAT_TINT_TEXTURE"),C.CLEARCOAT_TINT_GAMMATEXTURE=this._tintTexture.gammaSpace):C.CLEARCOAT_TINT_TEXTURE=!1):(C.CLEARCOAT_TINT=!1,C.CLEARCOAT_TINT_TEXTURE=!1))):(C.CLEARCOAT=!1,C.CLEARCOAT_TEXTURE=!1,C.CLEARCOAT_TEXTURE_ROUGHNESS=!1,C.CLEARCOAT_BUMP=!1,C.CLEARCOAT_TINT=!1,C.CLEARCOAT_TINT_TEXTURE=!1,C.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,C.CLEARCOAT_DEFAULTIOR=!1,C.CLEARCOAT_TEXTUREDIRECTUV=0,C.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,C.CLEARCOAT_BUMPDIRECTUV=0,C.CLEARCOAT_REMAP_F0=!1,C.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,C.CLEARCOAT_TINT_GAMMATEXTURE=!1)}bindForSubMesh(C,M,x,f){if(!this._isEnabled)return;const T=f.materialDefines,z=this._material.isFrozen,s=this._material._disableBumpMap,S=this._material._invertNormalMapX,m=this._material._invertNormalMapY;if(!C.useUbo||!z||!C.isSync){var Q,V,y,U;if((this._texture||this._textureRoughness)&&j.b.ClearCoatTextureEnabled)C.updateFloat4("vClearCoatInfos",(null===(Q=this._texture)||void 0===Q?void 0:Q.coordinatesIndex)??0,(null===(V=this._texture)||void 0===V?void 0:V.level)??0,(null===(y=this._textureRoughness)||void 0===y?void 0:y.coordinatesIndex)??0,(null===(U=this._textureRoughness)||void 0===U?void 0:U.level)??0),this._texture&&(0,R.r)(this._texture,C,"clearCoat"),this._textureRoughness&&!T.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,R.r)(this._textureRoughness,C,"clearCoatRoughness");this._bumpTexture&&x.getCaps().standardDerivatives&&j.b.ClearCoatTextureEnabled&&!s&&(C.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),(0,R.r)(this._bumpTexture,C,"clearCoatBump"),M._mirroredCameraPosition?C.updateFloat2("vClearCoatTangentSpaceParams",S?1:-1,m?1:-1):C.updateFloat2("vClearCoatTangentSpaceParams",S?-1:1,m?-1:1)),this._tintTexture&&j.b.ClearCoatTintTextureEnabled&&(C.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),(0,R.r)(this._tintTexture,C,"clearCoatTint")),C.updateFloat2("vClearCoatParams",this.pj,this.roughness);const f=1-this._indexOfRefraction,z=1+this._indexOfRefraction,O=Math.pow(-f/z,2),d=1/this._indexOfRefraction;C.updateFloat4("vClearCoatRefractionParams",O,d,f,z),this._isTintEnabled&&(C.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),C.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}M.texturesEnabled&&(this._texture&&j.b.ClearCoatTextureEnabled&&C.setTexture("clearCoatSampler",this._texture),this._textureRoughness&&!T.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&j.b.ClearCoatTextureEnabled&&C.setTexture("clearCoatRoughnessSampler",this._textureRoughness),this._bumpTexture&&x.getCaps().standardDerivatives&&j.b.ClearCoatBumpTextureEnabled&&!s&&C.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&j.b.ClearCoatTintTextureEnabled&&C.setTexture("clearCoatTintSampler",this._tintTexture))}hasTexture(C){return this._texture===C||(this._textureRoughness===C||(this._bumpTexture===C||this._tintTexture===C))}getActiveTextures(C){this._texture&&C.push(this._texture),this._textureRoughness&&C.push(this._textureRoughness),this._bumpTexture&&C.push(this._bumpTexture),this._tintTexture&&C.push(this._tintTexture)}getAnimatables(C){this._texture&&this._texture.animations&&this._texture.animations.length>0&&C.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&C.push(this._textureRoughness),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&C.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&C.push(this._tintTexture)}dispose(C){var M,x,f,T;C&&(null===(M=this._texture)||void 0===M||M.dispose(),null===(x=this._textureRoughness)||void 0===x||x.dispose(),null===(f=this._bumpTexture)||void 0===f||f.dispose(),null===(T=this._tintTexture)||void 0===T||T.dispose())}getClassName(){return"PBRClearCoatConfiguration"}addFallbacks(C,M,x){return C.CLEARCOAT_BUMP&&M.addFallback(x++,"CLEARCOAT_BUMP"),C.CLEARCOAT_TINT&&M.addFallback(x++,"CLEARCOAT_TINT"),C.CLEARCOAT&&M.addFallback(x++,"CLEARCOAT"),x}getSamplers(C){C.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler")}getUniforms(){return{ubo:[{name:"vClearCoatParams",size:2,type:"vec2"},{name:"vClearCoatRefractionParams",size:4,type:"vec4"},{name:"vClearCoatInfos",size:4,type:"vec4"},{name:"clearCoatMatrix",size:16,type:"mat4"},{name:"clearCoatRoughnessMatrix",size:16,type:"mat4"},{name:"vClearCoatBumpInfos",size:2,type:"vec2"},{name:"vClearCoatTangentSpaceParams",size:2,type:"vec2"},{name:"clearCoatBumpMatrix",size:16,type:"mat4"},{name:"vClearCoatTintParams",size:4,type:"vec4"},{name:"clearCoatColorAtDistance",size:1,type:"float"},{name:"vClearCoatTintInfos",size:2,type:"vec2"},{name:"clearCoatTintMatrix",size:16,type:"mat4"}]}}}I._DefaultIndexOfRefraction=1.5,(0,f.e)([(0,T.J)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"isEnabled",void 0),(0,f.e)([(0,T.J)()],I.prototype,"intensity",void 0),(0,f.e)([(0,T.J)()],I.prototype,"roughness",void 0),(0,f.e)([(0,T.J)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"indexOfRefraction",void 0),(0,f.e)([(0,T.A)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"texture",void 0),(0,f.e)([(0,T.J)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"useRoughnessFromMainTexture",void 0),(0,f.e)([(0,T.A)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"textureRoughness",void 0),(0,f.e)([(0,T.J)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"remapF0OnInterfaceChange",void 0),(0,f.e)([(0,T.A)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"bumpTexture",void 0),(0,f.e)([(0,T.J)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"isTintEnabled",void 0),(0,f.e)([(0,T.l)()],I.prototype,"tintColor",void 0),(0,f.e)([(0,T.J)()],I.prototype,"tintColorAtDistance",void 0),(0,f.e)([(0,T.J)()],I.prototype,"tintThickness",void 0),(0,f.e)([(0,T.A)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"tintTexture",void 0);class X extends y.d{constructor(){super(...arguments),this.IRIDESCENCE=!1,this.IRIDESCENCE_TEXTURE=!1,this.IRIDESCENCE_TEXTUREDIRECTUV=0,this.IRIDESCENCE_THICKNESS_TEXTURE=!1,this.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0}}class g extends U.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(C){let M=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(C,"PBRIridescence",110,new X,M),this._isEnabled=!1,this.isEnabled=!1,this.pj=1,this.minimumThickness=g._DefaultMinimumThickness,this.maximumThickness=g._DefaultMaximumThickness,this.indexOfRefraction=g._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._thicknessTexture=null,this.thicknessTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=C._dirtyCallbacks[1]}isReadyForSubMesh(C,M){if(!this._isEnabled)return!0;if(C._areTexturesDirty&&M.texturesEnabled){if(this._texture&&j.b.IridescenceTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._thicknessTexture&&j.b.IridescenceTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(C,M){this._isEnabled?(C.IRIDESCENCE=!0,C._areTexturesDirty&&M.texturesEnabled&&(this._texture&&j.b.IridescenceTextureEnabled?(0,R.D)(this._texture,C,"IRIDESCENCE_TEXTURE"):C.IRIDESCENCE_TEXTURE=!1,this._thicknessTexture&&j.b.IridescenceTextureEnabled?(0,R.D)(this._thicknessTexture,C,"IRIDESCENCE_THICKNESS_TEXTURE"):C.IRIDESCENCE_THICKNESS_TEXTURE=!1)):(C.IRIDESCENCE=!1,C.IRIDESCENCE_TEXTURE=!1,C.IRIDESCENCE_THICKNESS_TEXTURE=!1,C.IRIDESCENCE_TEXTUREDIRECTUV=0,C.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0)}bindForSubMesh(C,M){if(!this._isEnabled)return;const x=this._material.isFrozen;if(!C.useUbo||!x||!C.isSync){var f,T,z,s;if((this._texture||this._thicknessTexture)&&j.b.IridescenceTextureEnabled)C.updateFloat4("vIridescenceInfos",(null===(f=this._texture)||void 0===f?void 0:f.coordinatesIndex)??0,(null===(T=this._texture)||void 0===T?void 0:T.level)??0,(null===(z=this._thicknessTexture)||void 0===z?void 0:z.coordinatesIndex)??0,(null===(s=this._thicknessTexture)||void 0===s?void 0:s.level)??0),this._texture&&(0,R.r)(this._texture,C,"iridescence"),this._thicknessTexture&&(0,R.r)(this._thicknessTexture,C,"iridescenceThickness");C.updateFloat4("vIridescenceParams",this.pj,this.indexOfRefraction,this.minimumThickness,this.maximumThickness)}M.texturesEnabled&&(this._texture&&j.b.IridescenceTextureEnabled&&C.setTexture("iridescenceSampler",this._texture),this._thicknessTexture&&j.b.IridescenceTextureEnabled&&C.setTexture("iridescenceThicknessSampler",this._thicknessTexture))}hasTexture(C){return this._texture===C||this._thicknessTexture===C}getActiveTextures(C){this._texture&&C.push(this._texture),this._thicknessTexture&&C.push(this._thicknessTexture)}getAnimatables(C){this._texture&&this._texture.animations&&this._texture.animations.length>0&&C.push(this._texture),this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&C.push(this._thicknessTexture)}dispose(C){var M,x;C&&(null===(M=this._texture)||void 0===M||M.dispose(),null===(x=this._thicknessTexture)||void 0===x||x.dispose())}getClassName(){return"PBRIridescenceConfiguration"}addFallbacks(C,M,x){return C.IRIDESCENCE&&M.addFallback(x++,"IRIDESCENCE"),x}getSamplers(C){C.push("iridescenceSampler","iridescenceThicknessSampler")}getUniforms(){return{ubo:[{name:"vIridescenceParams",size:4,type:"vec4"},{name:"vIridescenceInfos",size:4,type:"vec4"},{name:"iridescenceMatrix",size:16,type:"mat4"},{name:"iridescenceThicknessMatrix",size:16,type:"mat4"}]}}}g._DefaultMinimumThickness=100,g._DefaultMaximumThickness=400,g._DefaultIndexOfRefraction=1.3,(0,f.e)([(0,T.J)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"isEnabled",void 0),(0,f.e)([(0,T.J)()],g.prototype,"intensity",void 0),(0,f.e)([(0,T.J)()],g.prototype,"minimumThickness",void 0),(0,f.e)([(0,T.J)()],g.prototype,"maximumThickness",void 0),(0,f.e)([(0,T.J)()],g.prototype,"indexOfRefraction",void 0),(0,f.e)([(0,T.A)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"texture",void 0),(0,f.e)([(0,T.A)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"thicknessTexture",void 0);class B extends y.d{constructor(){super(...arguments),this.ANISOTROPIC=!1,this.ANISOTROPIC_TEXTURE=!1,this.ANISOTROPIC_TEXTUREDIRECTUV=0,this.ANISOTROPIC_LEGACY=!1,this.MAINUV1=!1}}class F extends U.c{set angle(C){this.direction.x=Math.cos(C),this.direction.y=Math.sin(C)}get angle(){return Math.atan2(this.direction.y,this.direction.x)}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markAllSubMeshesAsMiscDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(C){let M=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(C,"PBRAnisotropic",110,new B,M),this._isEnabled=!1,this.isEnabled=!1,this.pj=1,this.direction=new Q.j(1,0),this._texture=null,this.texture=null,this._legacy=!1,this.legacy=!1,this._internalMarkAllSubMeshesAsTexturesDirty=C._dirtyCallbacks[1],this._internalMarkAllSubMeshesAsMiscDirty=C._dirtyCallbacks[16]}isReadyForSubMesh(C,M){return!this._isEnabled||!(C._areTexturesDirty&&M.texturesEnabled&&this._texture&&j.b.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())}prepareDefinesBeforeAttributes(C,M,x){this._isEnabled?(C.ANISOTROPIC=this._isEnabled,this._isEnabled&&!x.isVerticesDataPresent(V.h.TangentKind)&&(C._needUVs=!0,C.MAINUV1=!0),C._areTexturesDirty&&M.texturesEnabled&&(this._texture&&j.b.AnisotropicTextureEnabled?(0,R.D)(this._texture,C,"ANISOTROPIC_TEXTURE"):C.ANISOTROPIC_TEXTURE=!1),C._areMiscDirty&&(C.ANISOTROPIC_LEGACY=this._legacy)):(C.ANISOTROPIC=!1,C.ANISOTROPIC_TEXTURE=!1,C.ANISOTROPIC_TEXTUREDIRECTUV=0,C.ANISOTROPIC_LEGACY=!1)}bindForSubMesh(C,M){if(!this._isEnabled)return;const x=this._material.isFrozen;C.useUbo&&x&&C.isSync||(this._texture&&j.b.AnisotropicTextureEnabled&&(C.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),(0,R.r)(this._texture,C,"anisotropy")),C.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.pj)),M.texturesEnabled&&this._texture&&j.b.AnisotropicTextureEnabled&&C.setTexture("anisotropySampler",this._texture)}hasTexture(C){return this._texture===C}getActiveTextures(C){this._texture&&C.push(this._texture)}getAnimatables(C){this._texture&&this._texture.animations&&this._texture.animations.length>0&&C.push(this._texture)}dispose(C){C&&this._texture&&this._texture.dispose()}getClassName(){return"PBRAnisotropicConfiguration"}addFallbacks(C,M,x){return C.ANISOTROPIC&&M.addFallback(x++,"ANISOTROPIC"),x}getSamplers(C){C.push("anisotropySampler")}getUniforms(){return{ubo:[{name:"vAnisotropy",size:3,type:"vec3"},{name:"vAnisotropyInfos",size:2,type:"vec2"},{name:"anisotropyMatrix",size:16,type:"mat4"}]}}parse(C,M,x){super.parse(C,M,x),void 0===C.legacy&&(this.legacy=!0)}}(0,f.e)([(0,T.J)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"isEnabled",void 0),(0,f.e)([(0,T.J)()],F.prototype,"intensity",void 0),(0,f.e)([(0,T.E)()],F.prototype,"direction",void 0),(0,f.e)([(0,T.A)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"texture",void 0),(0,f.e)([(0,T.J)(),(0,T.e)("_markAllSubMeshesAsMiscDirty")],F.prototype,"legacy",void 0);class P extends y.d{constructor(){super(...arguments),this.SHEEN=!1,this.SHEEN_TEXTURE=!1,this.SHEEN_GAMMATEXTURE=!1,this.SHEEN_TEXTURE_ROUGHNESS=!1,this.SHEEN_TEXTUREDIRECTUV=0,this.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0,this.SHEEN_LINKWITHALBEDO=!1,this.SHEEN_ROUGHNESS=!1,this.SHEEN_ALBEDOSCALING=!1,this.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1}}class h extends U.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(C){let M=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(C,"Sheen",120,new P,M),this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.pj=1,this.color=o.d.White(),this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._roughness=null,this.roughness=null,this._textureRoughness=null,this.textureRoughness=null,this._albedoScaling=!1,this.albedoScaling=!1,this._internalMarkAllSubMeshesAsTexturesDirty=C._dirtyCallbacks[1]}isReadyForSubMesh(C,M){if(!this._isEnabled)return!0;if(C._areTexturesDirty&&M.texturesEnabled){if(this._texture&&j.b.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&j.b.SheenTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(C,M){this._isEnabled?(C.SHEEN=!0,C.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,C.SHEEN_ROUGHNESS=null!==this._roughness,C.SHEEN_ALBEDOSCALING=this._albedoScaling,C.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,C._areTexturesDirty&&M.texturesEnabled&&(this._texture&&j.b.SheenTextureEnabled?((0,R.D)(this._texture,C,"SHEEN_TEXTURE"),C.SHEEN_GAMMATEXTURE=this._texture.gammaSpace):C.SHEEN_TEXTURE=!1,this._textureRoughness&&j.b.SheenTextureEnabled?(0,R.D)(this._textureRoughness,C,"SHEEN_TEXTURE_ROUGHNESS"):C.SHEEN_TEXTURE_ROUGHNESS=!1)):(C.SHEEN=!1,C.SHEEN_TEXTURE=!1,C.SHEEN_TEXTURE_ROUGHNESS=!1,C.SHEEN_LINKWITHALBEDO=!1,C.SHEEN_ROUGHNESS=!1,C.SHEEN_ALBEDOSCALING=!1,C.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,C.SHEEN_GAMMATEXTURE=!1,C.SHEEN_TEXTUREDIRECTUV=0,C.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0)}bindForSubMesh(C,M,x,f){if(!this._isEnabled)return;const T=f.materialDefines,z=this._material.isFrozen;if(!C.useUbo||!z||!C.isSync){var s,S,m,Q;if((this._texture||this._textureRoughness)&&j.b.SheenTextureEnabled)C.updateFloat4("vSheenInfos",(null===(s=this._texture)||void 0===s?void 0:s.coordinatesIndex)??0,(null===(S=this._texture)||void 0===S?void 0:S.level)??0,(null===(m=this._textureRoughness)||void 0===m?void 0:m.coordinatesIndex)??0,(null===(Q=this._textureRoughness)||void 0===Q?void 0:Q.level)??0),this._texture&&(0,R.r)(this._texture,C,"sheen"),this._textureRoughness&&!T.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,R.r)(this._textureRoughness,C,"sheenRoughness");C.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.pj),null!==this._roughness&&C.updateFloat("vSheenRoughness",this._roughness)}M.texturesEnabled&&(this._texture&&j.b.SheenTextureEnabled&&C.setTexture("sheenSampler",this._texture),this._textureRoughness&&!T.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&j.b.SheenTextureEnabled&&C.setTexture("sheenRoughnessSampler",this._textureRoughness))}hasTexture(C){return this._texture===C||this._textureRoughness===C}getActiveTextures(C){this._texture&&C.push(this._texture),this._textureRoughness&&C.push(this._textureRoughness)}getAnimatables(C){this._texture&&this._texture.animations&&this._texture.animations.length>0&&C.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&C.push(this._textureRoughness)}dispose(C){var M,x;C&&(null===(M=this._texture)||void 0===M||M.dispose(),null===(x=this._textureRoughness)||void 0===x||x.dispose())}getClassName(){return"PBRSheenConfiguration"}addFallbacks(C,M,x){return C.SHEEN&&M.addFallback(x++,"SHEEN"),x}getSamplers(C){C.push("sheenSampler","sheenRoughnessSampler")}getUniforms(){return{ubo:[{name:"vSheenColor",size:4,type:"vec4"},{name:"vSheenRoughness",size:1,type:"float"},{name:"vSheenInfos",size:4,type:"vec4"},{name:"sheenMatrix",size:16,type:"mat4"},{name:"sheenRoughnessMatrix",size:16,type:"mat4"}]}}}(0,f.e)([(0,T.J)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],h.prototype,"isEnabled",void 0),(0,f.e)([(0,T.J)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],h.prototype,"linkSheenWithAlbedo",void 0),(0,f.e)([(0,T.J)()],h.prototype,"intensity",void 0),(0,f.e)([(0,T.l)()],h.prototype,"color",void 0),(0,f.e)([(0,T.A)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],h.prototype,"texture",void 0),(0,f.e)([(0,T.J)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],h.prototype,"useRoughnessFromMainTexture",void 0),(0,f.e)([(0,T.J)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],h.prototype,"roughness",void 0),(0,f.e)([(0,T.A)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],h.prototype,"textureRoughness",void 0),(0,f.e)([(0,T.J)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],h.prototype,"albedoScaling",void 0);class c extends y.d{constructor(){super(...arguments),this.SUBSURFACE=!1,this.SS_REFRACTION=!1,this.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_TRANSLUCENCY=!1,this.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_SCATTERING=!1,this.SS_DISPERSION=!1,this.SS_THICKNESSANDMASK_TEXTURE=!1,this.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,this.SS_HAS_THICKNESS=!1,this.SS_REFRACTIONINTENSITY_TEXTURE=!1,this.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,this.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,this.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,this.SS_REFRACTIONMAP_3D=!1,this.SS_REFRACTIONMAP_OPPOSITEZ=!1,this.SS_LODINREFRACTIONALPHA=!1,this.SS_GAMMAREFRACTION=!1,this.SS_RGBDREFRACTION=!1,this.SS_LINEARSPECULARREFRACTION=!1,this.SS_LINKREFRACTIONTOTRANSPARENCY=!1,this.SS_ALBEDOFORREFRACTIONTINT=!1,this.SS_ALBEDOFORTRANSLUCENCYTINT=!1,this.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.SS_USE_THICKNESS_AS_DEPTH=!1,this.SS_USE_GLTF_TEXTURES=!1}}class q extends U.c{get scatteringDiffusionProfile(){return this._scene.subSurfaceConfiguration?this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex]:null}set scatteringDiffusionProfile(C){this._scene.enableSubSurfaceForPrePass()&&C&&(this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(C))}get volumeIndexOfRefraction(){return this._volumeIndexOfRefraction>=1?this._volumeIndexOfRefraction:this._indexOfRefraction}set volumeIndexOfRefraction(C){this._volumeIndexOfRefraction=C>=1?C:-1}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markScenePrePassDirty(){this._internalMarkAllSubMeshesAsTexturesDirty(),this._internalMarkScenePrePassDirty()}isCompatible(){return!0}constructor(C){let M=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(C,"PBRSubSurface",130,new c,M),this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isDispersionEnabled=!1,this.isDispersionEnabled=!1,this._isScatteringEnabled=!1,this.isScatteringEnabled=!1,this._scatteringDiffusionProfileIndex=0,this.refractionIntensity=1,this.translucencyIntensity=1,this.useAlbedoToTintRefraction=!1,this.useAlbedoToTintTranslucency=!1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1.5,this.indexOfRefraction=1.5,this._volumeIndexOfRefraction=-1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.useThicknessAsDepth=!1,this.tintColor=o.d.White(),this.tintColorAtDistance=1,this.dispersion=0,this.diffusionDistance=o.d.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._refractionIntensityTexture=null,this.refractionIntensityTexture=null,this._translucencyIntensityTexture=null,this.translucencyIntensityTexture=null,this.translucencyColor=null,this._translucencyColorTexture=null,this.translucencyColorTexture=null,this._useGltfStyleTextures=!0,this.useGltfStyleTextures=!0,this._scene=C.va(),this.registerForExtraEvents=!0,this._internalMarkAllSubMeshesAsTexturesDirty=C._dirtyCallbacks[1],this._internalMarkScenePrePassDirty=C._dirtyCallbacks[32]}isReadyForSubMesh(C,M){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return!0;if(C._areTexturesDirty&&M.texturesEnabled){if(this._thicknessTexture&&j.b.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;if(this._translucencyColorTexture&&j.b.TranslucencyColorTextureEnabled&&!this._translucencyColorTexture.isReadyOrNotBlocking())return!1;if(this._translucencyIntensityTexture&&j.b.TranslucencyIntensityTextureEnabled&&!this._translucencyIntensityTexture.isReadyOrNotBlocking())return!1;const C=this._getRefractionTexture(M);if(C&&j.b.RefractionTextureEnabled&&!C.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(C,M){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return C.SUBSURFACE=!1,C.SS_DISPERSION=!1,C.SS_TRANSLUCENCY=!1,C.SS_SCATTERING=!1,C.SS_REFRACTION=!1,C.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,C.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,C.SS_THICKNESSANDMASK_TEXTURE=!1,C.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,C.SS_HAS_THICKNESS=!1,C.SS_REFRACTIONINTENSITY_TEXTURE=!1,C.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,C.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,C.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,C.SS_REFRACTIONMAP_3D=!1,C.SS_REFRACTIONMAP_OPPOSITEZ=!1,C.SS_LODINREFRACTIONALPHA=!1,C.SS_GAMMAREFRACTION=!1,C.SS_RGBDREFRACTION=!1,C.SS_LINEARSPECULARREFRACTION=!1,C.SS_LINKREFRACTIONTOTRANSPARENCY=!1,C.SS_ALBEDOFORREFRACTIONTINT=!1,C.SS_ALBEDOFORTRANSLUCENCYTINT=!1,C.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,C.SS_USE_THICKNESS_AS_DEPTH=!1,C.SS_USE_GLTF_TEXTURES=!1,C.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,void(C.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0);if(C._areTexturesDirty){if(C.SUBSURFACE=!0,C.SS_DISPERSION=this._isDispersionEnabled,C.SS_TRANSLUCENCY=this._isTranslucencyEnabled,C.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,C.SS_SCATTERING=this._isScatteringEnabled,C.SS_THICKNESSANDMASK_TEXTURE=!1,C.SS_REFRACTIONINTENSITY_TEXTURE=!1,C.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,C.SS_HAS_THICKNESS=!1,C.SS_USE_GLTF_TEXTURES=!1,C.SS_REFRACTION=!1,C.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,C.SS_REFRACTIONMAP_3D=!1,C.SS_GAMMAREFRACTION=!1,C.SS_RGBDREFRACTION=!1,C.SS_LINEARSPECULARREFRACTION=!1,C.SS_REFRACTIONMAP_OPPOSITEZ=!1,C.SS_LODINREFRACTIONALPHA=!1,C.SS_LINKREFRACTIONTOTRANSPARENCY=!1,C.SS_ALBEDOFORREFRACTIONTINT=!1,C.SS_ALBEDOFORTRANSLUCENCYTINT=!1,C.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,C.SS_USE_THICKNESS_AS_DEPTH=!1,C.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,C._areTexturesDirty&&M.texturesEnabled&&(this._thicknessTexture&&j.b.ThicknessTextureEnabled&&(0,R.D)(this._thicknessTexture,C,"SS_THICKNESSANDMASK_TEXTURE"),this._refractionIntensityTexture&&j.b.RefractionIntensityTextureEnabled&&(0,R.D)(this._refractionIntensityTexture,C,"SS_REFRACTIONINTENSITY_TEXTURE"),this._translucencyIntensityTexture&&j.b.TranslucencyIntensityTextureEnabled&&(0,R.D)(this._translucencyIntensityTexture,C,"SS_TRANSLUCENCYINTENSITY_TEXTURE"),this._translucencyColorTexture&&j.b.TranslucencyColorTextureEnabled&&(0,R.D)(this._translucencyColorTexture,C,"SS_TRANSLUCENCYCOLOR_TEXTURE")),C.SS_HAS_THICKNESS=this.maximumThickness-this.minimumThickness!==0,C.SS_USE_GLTF_TEXTURES=this._useGltfStyleTextures,C.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._refractionIntensityTexture,C.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._translucencyIntensityTexture,this._isRefractionEnabled&&M.texturesEnabled){const x=this._getRefractionTexture(M);x&&j.b.RefractionTextureEnabled&&(C.SS_REFRACTION=!0,C.SS_REFRACTIONMAP_3D=x.isCube,C.SS_GAMMAREFRACTION=x.gammaSpace,C.SS_RGBDREFRACTION=x.isRGBD,C.SS_LINEARSPECULARREFRACTION=x.linearSpecularLOD,C.SS_REFRACTIONMAP_OPPOSITEZ=this._scene.useRightHandedSystem&&x.isCube?!x.invertZ:x.invertZ,C.SS_LODINREFRACTIONALPHA=x.lodLevelInAlpha,C.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency,C.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction,C.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=x.isCube&&x.boundingBoxSize,C.SS_USE_THICKNESS_AS_DEPTH=this.useThicknessAsDepth)}this._isTranslucencyEnabled&&(C.SS_ALBEDOFORTRANSLUCENCYTINT=this.useAlbedoToTintTranslucency)}}hardBindForSubMesh(C,M,x,f){if(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled)if(0===this.maximumThickness&&0===this.minimumThickness)C.updateFloat2("vThicknessParam",0,0);else{f.getRenderingMesh().getWorldMatrix().decompose(Q.i.Md[0]);const M=Math.max(Math.abs(Q.i.Md[0].x),Math.abs(Q.i.Md[0].y),Math.abs(Q.i.Md[0].z));C.updateFloat2("vThicknessParam",this.minimumThickness*M,(this.maximumThickness-this.minimumThickness)*M)}}bindForSubMesh(C,M,x,f){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return;const T=f.materialDefines,z=this._material.isFrozen,s=this._material.realTimeFiltering,S=T.LODBASEDMICROSFURACE,m=this._getRefractionTexture(M);if(!C.useUbo||!z||!C.isSync){if(this._thicknessTexture&&j.b.ThicknessTextureEnabled&&(C.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),(0,R.r)(this._thicknessTexture,C,"thickness")),this._refractionIntensityTexture&&j.b.RefractionIntensityTextureEnabled&&T.SS_REFRACTIONINTENSITY_TEXTURE&&(C.updateFloat2("vRefractionIntensityInfos",this._refractionIntensityTexture.coordinatesIndex,this._refractionIntensityTexture.level),(0,R.r)(this._refractionIntensityTexture,C,"refractionIntensity")),this._translucencyColorTexture&&j.b.TranslucencyColorTextureEnabled&&T.SS_TRANSLUCENCYCOLOR_TEXTURE&&(C.updateFloat2("vTranslucencyColorInfos",this._translucencyColorTexture.coordinatesIndex,this._translucencyColorTexture.level),(0,R.r)(this._translucencyColorTexture,C,"translucencyColor")),this._translucencyIntensityTexture&&j.b.TranslucencyIntensityTextureEnabled&&T.SS_TRANSLUCENCYINTENSITY_TEXTURE&&(C.updateFloat2("vTranslucencyIntensityInfos",this._translucencyIntensityTexture.coordinatesIndex,this._translucencyIntensityTexture.level),(0,R.r)(this._translucencyIntensityTexture,C,"translucencyIntensity")),m&&j.b.RefractionTextureEnabled){C.ee("refractionMatrix",m.getRefractionTextureMatrix());let M=1;m.isCube||m.depth&&(M=m.depth);const x=m.getSize().width,f=this.volumeIndexOfRefraction;if(C.updateFloat4("vRefractionInfos",m.level,1/f,M,this._invertRefractionY?-1:1),C.updateFloat4("vRefractionMicrosurfaceInfos",x,m.lodGenerationScale,m.lodGenerationOffset,1/this.indexOfRefraction),s&&C.updateFloat2("vRefractionFilteringInfo",x,Math.log2(x)),m.boundingBoxSize){const M=m;C.updateVector3("vRefractionPosition",M.boundingBoxPosition),C.updateVector3("vRefractionSize",M.boundingBoxSize)}}this._isScatteringEnabled&&C.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex),C.updateColor3("vDiffusionDistance",this.diffusionDistance),C.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintColorAtDistance)),C.updateColor4("vTranslucencyColor",this.translucencyColor??this.tintColor,0),C.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0),C.updateFloat("dispersion",this.dispersion)}M.texturesEnabled&&(this._thicknessTexture&&j.b.ThicknessTextureEnabled&&C.setTexture("thicknessSampler",this._thicknessTexture),this._refractionIntensityTexture&&j.b.RefractionIntensityTextureEnabled&&T.SS_REFRACTIONINTENSITY_TEXTURE&&C.setTexture("refractionIntensitySampler",this._refractionIntensityTexture),this._translucencyIntensityTexture&&j.b.TranslucencyIntensityTextureEnabled&&T.SS_TRANSLUCENCYINTENSITY_TEXTURE&&C.setTexture("translucencyIntensitySampler",this._translucencyIntensityTexture),this._translucencyColorTexture&&j.b.TranslucencyColorTextureEnabled&&T.SS_TRANSLUCENCYCOLOR_TEXTURE&&C.setTexture("translucencyColorSampler",this._translucencyColorTexture),m&&j.b.RefractionTextureEnabled&&(S?C.setTexture("refractionSampler",m):(C.setTexture("refractionSampler",m._lodTextureMid||m),C.setTexture("refractionSamplerLow",m._lodTextureLow||m),C.setTexture("refractionSamplerHigh",m._lodTextureHigh||m))))}_getRefractionTexture(C){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?C.environmentTexture:null}get disableAlphaBlending(){return this._isRefractionEnabled&&this._linkRefractionWithTransparency}fillRenderTargetTextures(C){j.b.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&C.push(this._refractionTexture)}hasTexture(C){return this._thicknessTexture===C||(this._refractionTexture===C||(this._refractionIntensityTexture===C||(this._translucencyIntensityTexture===C||this._translucencyColorTexture===C)))}hasRenderTargetTextures(){return!!(j.b.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)}getActiveTextures(C){this._thicknessTexture&&C.push(this._thicknessTexture),this._refractionTexture&&C.push(this._refractionTexture),this._translucencyColorTexture&&C.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&C.push(this._translucencyIntensityTexture)}getAnimatables(C){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&C.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&C.push(this._refractionTexture),this._translucencyColorTexture&&this._translucencyColorTexture.animations&&this._translucencyColorTexture.animations.length>0&&C.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.animations&&this._translucencyIntensityTexture.animations.length>0&&C.push(this._translucencyIntensityTexture)}dispose(C){C&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose(),this._translucencyColorTexture&&this._translucencyColorTexture.dispose(),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.dispose())}getClassName(){return"PBRSubSurfaceConfiguration"}addFallbacks(C,M,x){return C.SS_SCATTERING&&M.addFallback(x++,"SS_SCATTERING"),C.SS_TRANSLUCENCY&&M.addFallback(x++,"SS_TRANSLUCENCY"),x}getSamplers(C){C.push("thicknessSampler","refractionIntensitySampler","translucencyIntensitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh","translucencyColorSampler")}getUniforms(){return{ubo:[{name:"vRefractionMicrosurfaceInfos",size:4,type:"vec4"},{name:"vRefractionFilteringInfo",size:2,type:"vec2"},{name:"vTranslucencyIntensityInfos",size:2,type:"vec2"},{name:"vRefractionInfos",size:4,type:"vec4"},{name:"refractionMatrix",size:16,type:"mat4"},{name:"vThicknessInfos",size:2,type:"vec2"},{name:"vRefractionIntensityInfos",size:2,type:"vec2"},{name:"thicknessMatrix",size:16,type:"mat4"},{name:"refractionIntensityMatrix",size:16,type:"mat4"},{name:"translucencyIntensityMatrix",size:16,type:"mat4"},{name:"vThicknessParam",size:2,type:"vec2"},{name:"vDiffusionDistance",size:3,type:"vec3"},{name:"vTintColor",size:4,type:"vec4"},{name:"vSubSurfaceIntensity",size:3,type:"vec3"},{name:"vRefractionPosition",size:3,type:"vec3"},{name:"vRefractionSize",size:3,type:"vec3"},{name:"scatteringDiffusionProfile",size:1,type:"float"},{name:"dispersion",size:1,type:"float"},{name:"vTranslucencyColor",size:4,type:"vec4"},{name:"vTranslucencyColorInfos",size:2,type:"vec2"},{name:"translucencyColorMatrix",size:16,type:"mat4"}]}}}(0,f.e)([(0,T.J)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"isRefractionEnabled",void 0),(0,f.e)([(0,T.J)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"isTranslucencyEnabled",void 0),(0,f.e)([(0,T.J)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"isDispersionEnabled",void 0),(0,f.e)([(0,T.J)(),(0,T.e)("_markScenePrePassDirty")],q.prototype,"isScatteringEnabled",void 0),(0,f.e)([(0,T.J)()],q.prototype,"_scatteringDiffusionProfileIndex",void 0),(0,f.e)([(0,T.J)()],q.prototype,"refractionIntensity",void 0),(0,f.e)([(0,T.J)()],q.prototype,"translucencyIntensity",void 0),(0,f.e)([(0,T.J)()],q.prototype,"useAlbedoToTintRefraction",void 0),(0,f.e)([(0,T.J)()],q.prototype,"useAlbedoToTintTranslucency",void 0),(0,f.e)([(0,T.A)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"thicknessTexture",void 0),(0,f.e)([(0,T.A)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"refractionTexture",void 0),(0,f.e)([(0,T.J)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"indexOfRefraction",void 0),(0,f.e)([(0,T.J)()],q.prototype,"_volumeIndexOfRefraction",void 0),(0,f.e)([(0,T.e)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"volumeIndexOfRefraction",null),(0,f.e)([(0,T.J)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"invertRefractionY",void 0),(0,f.e)([(0,T.J)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"linkRefractionWithTransparency",void 0),(0,f.e)([(0,T.J)()],q.prototype,"minimumThickness",void 0),(0,f.e)([(0,T.J)()],q.prototype,"maximumThickness",void 0),(0,f.e)([(0,T.J)()],q.prototype,"useThicknessAsDepth",void 0),(0,f.e)([(0,T.l)()],q.prototype,"tintColor",void 0),(0,f.e)([(0,T.J)()],q.prototype,"tintColorAtDistance",void 0),(0,f.e)([(0,T.J)()],q.prototype,"dispersion",void 0),(0,f.e)([(0,T.l)()],q.prototype,"diffusionDistance",void 0),(0,f.e)([(0,T.J)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"useMaskFromThicknessTexture",void 0),(0,f.e)([(0,T.A)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"refractionIntensityTexture",void 0),(0,f.e)([(0,T.A)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"translucencyIntensityTexture",void 0),(0,f.e)([(0,T.l)()],q.prototype,"translucencyColor",void 0),(0,f.e)([(0,T.A)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"translucencyColorTexture",void 0),(0,f.e)([(0,T.J)(),(0,T.e)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"useGltfStyleTextures",void 0);var i=x(1365),Z=x(1335),E=x(1375);const K={effect:null,subMesh:null};class G extends y.d{constructor(C){super(C),this.PBR=!0,this.NUM_SAMPLES="0",this.REALTIME_FILTERING=!1,this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.ALBEDO=!1,this.GAMMAALBEDO=!1,this.ALBEDODIRECTUV=0,this.VERTEXCOLOR=!1,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.AMBIENTINGRAYSCALE=!1,this.OPACITY=!1,this.VERTEXALPHA=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHABLEND=!1,this.ALPHAFROMALBEDO=!1,this.ALPHATESTVALUE="0.5",this.SPECULAROVERALPHA=!1,this.RADIANCEOVERALPHA=!1,this.ALPHAFRESNEL=!1,this.LINEARALPHAFRESNEL=!1,this.PREMULTIPLYALPHA=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.GAMMAEMISSIVE=!1,this.REFLECTIVITY=!1,this.REFLECTIVITY_GAMMA=!1,this.REFLECTIVITYDIRECTUV=0,this.SPECULARTERM=!1,this.MICROSURFACEFROMREFLECTIVITYMAP=!1,this.MICROSURFACEAUTOMATIC=!1,this.LODBASEDMICROSFURACE=!1,this.MICROSURFACEMAP=!1,this.MICROSURFACEMAPDIRECTUV=0,this.METALLICWORKFLOW=!1,this.ROUGHNESSSTOREINMETALMAPALPHA=!1,this.ROUGHNESSSTOREINMETALMAPGREEN=!1,this.METALLNESSSTOREINMETALMAPBLUE=!1,this.AOSTOREINMETALMAPRED=!1,this.METALLIC_REFLECTANCE=!1,this.METALLIC_REFLECTANCE_GAMMA=!1,this.METALLIC_REFLECTANCEDIRECTUV=0,this.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=!1,this.REFLECTANCE=!1,this.REFLECTANCE_GAMMA=!1,this.REFLECTANCEDIRECTUV=0,this.ENVIRONMENTBRDF=!1,this.ENVIRONMENTBRDF_RGBD=!1,this.NORMAL=!1,this.TANGENT=!1,this.BUMP=!1,this.BUMPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.NORMALXYSCALE=!0,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.USELIGHTMAPASSHADOWMAP=!1,this.GAMMALIGHTMAP=!1,this.RGBDLIGHTMAP=!1,this.REFLECTION=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.INVERTCUBICMAP=!1,this.USESPHERICALFROMREFLECTIONMAP=!1,this.USEIRRADIANCEMAP=!1,this.USESPHERICALINVERTEX=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.LODINREFLECTIONALPHA=!1,this.GAMMAREFLECTION=!1,this.RGBDREFLECTION=!1,this.LINEARSPECULARREFLECTION=!1,this.RADIANCEOCCLUSION=!1,this.HORIZONOCCLUSION=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.NONUNIFORMSCALING=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.EXPOSURE=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.USEPHYSICALLIGHTFALLOFF=!1,this.USEGLTFLIGHTFALLOFF=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.LOGARITHMICDEPTH=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.FORCENORMALFORWARD=!1,this.SPECULARAA=!1,this.UNLIT=!1,this.DECAL_AFTER_DETAIL=!1,this.DEBUGMODE=0,this.rebuild()}reset(){super.reset(),this.ALPHATESTVALUE="0.5",this.PBR=!0,this.NORMALXYSCALE=!0}}class a extends A.e{get realTimeFiltering(){return this._realTimeFiltering}set realTimeFiltering(C){this._realTimeFiltering=C,this.Fe(1)}get realTimeFilteringQuality(){return this._realTimeFilteringQuality}set realTimeFilteringQuality(C){this._realTimeFilteringQuality=C,this.Fe(1)}get canRenderToMRT(){return!0}_attachImageProcessingConfiguration(C){C!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=C||this.va().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}constructor(C,M){super(C,M,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||a.ForceGLSL),this._directIntensity=1,this._emissiveIntensity=1,this._environmentIntensity=1,this._specularIntensity=1,this._lightingInfos=new Q.q(this._directIntensity,this._emissiveIntensity,this._environmentIntensity,this._specularIntensity),this._disableBumpMap=!1,this._albedoTexture=null,this._ambientTexture=null,this._ambientTextureStrength=1,this._ambientTextureImpactOnAnalyticalLights=a.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._reflectivityTexture=null,this._metallicTexture=null,this._metallic=null,this._roughness=null,this._metallicF0Factor=1,this._metallicReflectanceColor=o.d.White(),this._useOnlyMetallicFromMetallicReflectanceTexture=!1,this._metallicReflectanceTexture=null,this._reflectanceTexture=null,this._microSurfaceTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._ambientColor=new o.d(0,0,0),this._albedoColor=new o.d(1,1,1),this._reflectivityColor=new o.d(1,1,1),this._reflectionColor=new o.d(1,1,1),this._emissiveColor=new o.d(0,0,0),this._microSurface=.9,this._useLightmapAsShadowmap=!1,this._useHorizonOcclusion=!0,this._useRadianceOcclusion=!0,this._useAlphaFromAlbedoTexture=!1,this._useSpecularOverAlpha=!0,this._useMicroSurfaceFromReflectivityMapAlpha=!1,this._useRoughnessFromMetallicTextureAlpha=!0,this._useRoughnessFromMetallicTextureGreen=!1,this._useMetallnessFromMetallicTextureBlue=!1,this._useAmbientOcclusionFromMetallicTextureRed=!1,this._useAmbientInGrayScale=!1,this._useAutoMicroSurfaceFromReflectivityMap=!1,this._lightFalloff=a.LIGHTFALLOFF_PHYSICAL,this._useRadianceOverAlpha=!0,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this._parallaxScaleBias=.05,this._disableLighting=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._alphaCutOff=.4,this._forceAlphaTest=!1,this._useAlphaFresnel=!1,this._useLinearAlphaFresnel=!1,this._environmentBRDFTexture=null,this._forceIrradianceInFragment=!1,this._realTimeFiltering=!1,this._realTimeFilteringQuality=8,this._forceNormalForward=!1,this._enableSpecularAntiAliasing=!1,this._imageProcessingObserver=null,this._renderTargets=new s.e(16),this._globalAmbientColor=new o.d(0,0,0),this._unlit=!1,this._applyDecalMapAfterDetailMap=!1,this._debugMode=0,this._shadersLoaded=!1,this._breakShaderLoadedCheck=!1,this.debugMode=0,this.debugLimit=-1,this.debugFactor=1,this._cacheHasRenderTargetTextures=!1,this.brdf=new d(this),this.clearCoat=new I(this),this.iridescence=new g(this),this.anisotropy=new F(this),this.sheen=new h(this),this.subSurface=new q(this),this.detailMap=new i.e(this),this._attachImageProcessingConfiguration(null),this.getRenderTargetTextures=()=>(this._renderTargets.reset(),j.b.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets),this._environmentBRDFTexture=(0,S.c)(this.va()),this.prePassConfiguration=new D.b}get hasRenderTargetTextures(){return!!(j.b.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures}get isPrePassCapable(){return!this.disableDepthWrite}getClassName(){return"PBRBaseMaterial"}get _disableAlphaBlending(){var C;return this._transparencyMode===a.PBRMATERIAL_OPAQUE||this._transparencyMode===a.PBRMATERIAL_ALPHATEST||(null===(C=this.subSurface)||void 0===C?void 0:C.disableAlphaBlending)}needAlphaBlending(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())}needAlphaTesting(){var C;return!!this._forceAlphaTest||(null===(C=this.subSurface)||void 0===C||!C.disableAlphaBlending)&&(this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===a.PBRMATERIAL_ALPHATEST))}_shouldUseAlphaFromAlbedoTexture(){return null!=this._albedoTexture&&this._albedoTexture.rd&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==a.PBRMATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._albedoTexture&&this._albedoTexture.rd||null!=this._opacityTexture}getAlphaTestTexture(){return this._albedoTexture}isReadyForSubMesh(C,M,x){this._uniformBufferLayoutBuilt||this.buildUniformLayout();const f=M._drawWrapper;if(f.effect&&this.isFrozen&&f._wasPreviouslyReady&&f._wasPreviouslyUsingInstances===x)return!0;M.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),M.materialDefines=new G(this._eventInfo.defineNames));const T=M.materialDefines;if(this._isReadyForSubMesh(M))return!0;const s=this.va(),S=s.getEngine();if(T._areTexturesDirty&&(this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,s.texturesEnabled)){if(this._albedoTexture&&j.b.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&j.b.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&j.b.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;const C=this._getReflectionTexture();if(C&&j.b.ReflectionTextureEnabled){if(!C.isReadyOrNotBlocking())return!1;var m;if(C.irradianceTexture){if(!C.irradianceTexture.isReadyOrNotBlocking())return!1}else if(!C.sphericalPolynomial&&null!==(m=C.getInternalTexture())&&void 0!==m&&m._sphericalPolynomialPromise)return!1}if(this._lightmapTexture&&j.b.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&j.b.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(j.b.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._metallicReflectanceTexture&&!this._metallicReflectanceTexture.isReadyOrNotBlocking())return!1;if(this._reflectanceTexture&&!this._reflectanceTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(S.getCaps().standardDerivatives&&this._bumpTexture&&j.b.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;if(this._environmentBRDFTexture&&j.b.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=T,this._eventInfo.subMesh=M,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(T._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;S.getCaps().standardDerivatives||C.isVerticesDataPresent(V.h.NormalKind)||(C.createNormals(!0),z.e.Warn("PBRMaterial: Normals have been created for the mesh: "+C.name));const Q=M.effect,y=T._areLightsDisposed;let U=this._prepareEffect(C,T,this.onCompiled,this.onError,x,null,M.getRenderingMesh().hasThinInstances),O=!1;if(U)if(this._onEffectCreatedObservable&&(K.effect=U,K.subMesh=M,this._onEffectCreatedObservable.notifyObservers(K)),this.allowShaderHotSwapping&&Q&&!U.isReady()){if(U=Q,T.markAsUnprocessed(),O=this.isFrozen,y)return T._areLightsDisposed=!0,!1}else s.resetCachedMaterial(),M.setEffect(U,T,this._materialContext);return!(!M.effect||!M.effect.isReady())&&(T._renderId=s.getRenderId(),f._wasPreviouslyReady=!O,f._wasPreviouslyUsingInstances=!!x,this._checkScenePerformancePriority(),!0)}isMetallicWorkflow(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)}_prepareEffect(C,M){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,S=arguments.length>6?arguments[6]:void 0;if(this._prepareDefines(C,M,z,s,S),!M.isDirty)return null;M.markAsProcessed();const m=this.va().getEngine(),Q=new b.e;let y=0;M.USESPHERICALINVERTEX&&Q.addFallback(y++,"USESPHERICALINVERTEX"),M.FOG&&Q.addFallback(y,"FOG"),M.SPECULARAA&&Q.addFallback(y,"SPECULARAA"),M.POINTSIZE&&Q.addFallback(y,"POINTSIZE"),M.LOGARITHMICDEPTH&&Q.addFallback(y,"LOGARITHMICDEPTH"),M.PARALLAX&&Q.addFallback(y,"PARALLAX"),M.PARALLAX_RHS&&Q.addFallback(y,"PARALLAX_RHS"),M.PARALLAXOCCLUSION&&Q.addFallback(y++,"PARALLAXOCCLUSION"),M.ENVIRONMENTBRDF&&Q.addFallback(y++,"ENVIRONMENTBRDF"),M.TANGENT&&Q.addFallback(y++,"TANGENT"),M.BUMP&&Q.addFallback(y++,"BUMP"),y=(0,R.s)(M,Q,this._maxSimultaneousLights,y++),M.SPECULARTERM&&Q.addFallback(y++,"SPECULARTERM"),M.USESPHERICALFROMREFLECTIONMAP&&Q.addFallback(y++,"USESPHERICALFROMREFLECTIONMAP"),M.USEIRRADIANCEMAP&&Q.addFallback(y++,"USEIRRADIANCEMAP"),M.LIGHTMAP&&Q.addFallback(y++,"LIGHTMAP"),M.NORMAL&&Q.addFallback(y++,"NORMAL"),M.AMBIENT&&Q.addFallback(y++,"AMBIENT"),M.EMISSIVE&&Q.addFallback(y++,"EMISSIVE"),M.VERTEXCOLOR&&Q.addFallback(y++,"VERTEXCOLOR"),M.MORPHTARGETS&&Q.addFallback(y++,"MORPHTARGETS"),M.MULTIVIEW&&Q.addFallback(0,"MULTIVIEW");const U=[V.h.PositionKind];M.NORMAL&&U.push(V.h.NormalKind),M.TANGENT&&U.push(V.h.TangentKind);for(let x=1;x<=6;++x)M["UV"+x]&&U.push(`uv${1===x?"":x}`);M.VERTEXCOLOR&&U.push(V.h.ColorKind),(0,R.w)(U,C,M,Q),(0,R.x)(U,M),(0,R.y)(U,C,M),(0,R.u)(U,C,M);let O="pbr";const d=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vReflectionFilteringInfo","vMetallicReflectanceInfos","vReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","albedoMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","reflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vTangentSpaceParams","boneTextureWidth","vDebugMode","morphTargetTextureInfo","morphTargetTextureIndices"],o=["albedoSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler","reflectanceSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],t=["Material","Scene","Mesh"],A={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:M.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=Q,this._eventInfo.fallbackRank=y,this._eventInfo.defines=M,this._eventInfo.uniforms=d,this._eventInfo.attributes=U,this._eventInfo.samplers=o,this._eventInfo.uniformBuffersNames=t,this._eventInfo.customCode=void 0,this._eventInfo.mesh=C,this._eventInfo.indexParameters=A,this._callbackPluginEventGeneric(128,this._eventInfo),E.d.AddUniformsAndSamplers(d,o),D.b.AddUniforms(d),D.b.AddSamplers(o),(0,Z.b)(d),L.c&&(L.c.PrepareUniforms(d,M),L.c.PrepareSamplers(o,M)),(0,R.N)({uniformsNames:d,uniformBuffersNames:t,samplers:o,defines:M,maxSimultaneousLights:this._maxSimultaneousLights});const H={};this.customShaderNameResolve&&(O=this.customShaderNameResolve(O,d,t,o,M,U,H));const j=M.toString(),n=m.createEffect(O,{attributes:U,uniformsNames:d,uniformBuffersNames:t,samplers:o,defines:j,fallbacks:Q,onCompiled:f,onError:T,indexParameters:A,processFinalCode:H.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:M.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this.shaderLanguage?await Promise.all([Promise.all([x.e(15),x.e(44)]).then(x.bind(x,13013)),Promise.all([x.e(16),x.e(45)]).then(x.bind(x,13034))]):await Promise.all([Promise.all([x.e(21),x.e(46)]).then(x.bind(x,13039)),Promise.all([x.e(23),x.e(47)]).then(x.bind(x,13061))]),this._shadersLoaded=!0}},m);return this._eventInfo.customCode=void 0,n}_prepareDefines(C,M){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,T=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const z=this.va(),s=z.getEngine();(0,R.C)(z,C,M,!0,this._maxSimultaneousLights,this._disableLighting),M._needNormals=!0,(0,R.H)(z,M);const S=this.needAlphaBlendingForMesh(C)&&this.va().useOrderIndependentTransparency;if((0,R.K)(z,M,this.canRenderToMRT&&!S),(0,R.J)(z,M,S),E.d.PrepareDefines(s.currentRenderPassId,C,M),M.METALLICWORKFLOW=this.isMetallicWorkflow(),M._areTexturesDirty){M._needUVs=!1;for(let C=1;C<=6;++C)M["MAINUV"+C]=!1;if(z.texturesEnabled){M.ALBEDODIRECTUV=0,M.AMBIENTDIRECTUV=0,M.OPACITYDIRECTUV=0,M.EMISSIVEDIRECTUV=0,M.REFLECTIVITYDIRECTUV=0,M.MICROSURFACEMAPDIRECTUV=0,M.METALLIC_REFLECTANCEDIRECTUV=0,M.REFLECTANCEDIRECTUV=0,M.BUMPDIRECTUV=0,M.LIGHTMAPDIRECTUV=0,s.getCaps().textureLOD&&(M.LODBASEDMICROSFURACE=!0),this._albedoTexture&&j.b.DiffuseTextureEnabled?((0,R.D)(this._albedoTexture,M,"ALBEDO"),M.GAMMAALBEDO=this._albedoTexture.gammaSpace):M.ALBEDO=!1,this._ambientTexture&&j.b.AmbientTextureEnabled?((0,R.D)(this._ambientTexture,M,"AMBIENT"),M.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):M.AMBIENT=!1,this._opacityTexture&&j.b.OpacityTextureEnabled?((0,R.D)(this._opacityTexture,M,"OPACITY"),M.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):M.OPACITY=!1;const C=this._getReflectionTexture();if(C&&j.b.ReflectionTextureEnabled){switch(M.REFLECTION=!0,M.GAMMAREFLECTION=C.gammaSpace,M.RGBDREFLECTION=C.isRGBD,M.LODINREFLECTIONALPHA=C.lodLevelInAlpha,M.LINEARSPECULARREFLECTION=C.linearSpecularLOD,this.realTimeFiltering&&this.realTimeFilteringQuality>0?(M.NUM_SAMPLES=""+this.realTimeFilteringQuality,s._features.needTypeSuffixInShaderConstants&&(M.NUM_SAMPLES=M.NUM_SAMPLES+"u"),M.REALTIME_FILTERING=!0):M.REALTIME_FILTERING=!1,M.INVERTCUBICMAP=C.coordinatesMode===H.b.INVCUBIC_MODE,M.REFLECTIONMAP_3D=C.isCube,M.REFLECTIONMAP_OPPOSITEZ=M.REFLECTIONMAP_3D&&this.va().useRightHandedSystem?!C.invertZ:C.invertZ,M.REFLECTIONMAP_CUBIC=!1,M.REFLECTIONMAP_EXPLICIT=!1,M.REFLECTIONMAP_PLANAR=!1,M.REFLECTIONMAP_PROJECTION=!1,M.REFLECTIONMAP_SKYBOX=!1,M.REFLECTIONMAP_SPHERICAL=!1,M.REFLECTIONMAP_EQUIRECTANGULAR=!1,M.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,M.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,C.coordinatesMode){case H.b.EXPLICIT_MODE:M.REFLECTIONMAP_EXPLICIT=!0;break;case H.b.PLANAR_MODE:M.REFLECTIONMAP_PLANAR=!0;break;case H.b.PROJECTION_MODE:M.REFLECTIONMAP_PROJECTION=!0;break;case H.b.SKYBOX_MODE:M.REFLECTIONMAP_SKYBOX=!0;break;case H.b.SPHERICAL_MODE:M.REFLECTIONMAP_SPHERICAL=!0;break;case H.b.EQUIRECTANGULAR_MODE:M.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case H.b.FIXED_EQUIRECTANGULAR_MODE:M.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case H.b.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:M.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case H.b.CUBIC_MODE:case H.b.INVCUBIC_MODE:default:M.REFLECTIONMAP_CUBIC=!0,M.USE_LOCAL_REFLECTIONMAP_CUBIC=!!C.boundingBoxSize}C.coordinatesMode!==H.b.SKYBOX_MODE&&(C.irradianceTexture?(M.USEIRRADIANCEMAP=!0,M.USESPHERICALFROMREFLECTIONMAP=!1):C.isCube&&(M.USESPHERICALFROMREFLECTIONMAP=!0,M.USEIRRADIANCEMAP=!1,this._forceIrradianceInFragment||this.realTimeFiltering||this._twoSidedLighting||s.getCaps().maxVaryingVectors<=8?M.USESPHERICALINVERTEX=!1:M.USESPHERICALINVERTEX=!0))}else M.REFLECTION=!1,M.REFLECTIONMAP_3D=!1,M.REFLECTIONMAP_SPHERICAL=!1,M.REFLECTIONMAP_PLANAR=!1,M.REFLECTIONMAP_CUBIC=!1,M.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,M.REFLECTIONMAP_PROJECTION=!1,M.REFLECTIONMAP_SKYBOX=!1,M.REFLECTIONMAP_EXPLICIT=!1,M.REFLECTIONMAP_EQUIRECTANGULAR=!1,M.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,M.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,M.INVERTCUBICMAP=!1,M.USESPHERICALFROMREFLECTIONMAP=!1,M.USEIRRADIANCEMAP=!1,M.USESPHERICALINVERTEX=!1,M.REFLECTIONMAP_OPPOSITEZ=!1,M.LODINREFLECTIONALPHA=!1,M.GAMMAREFLECTION=!1,M.RGBDREFLECTION=!1,M.LINEARSPECULARREFLECTION=!1;this._lightmapTexture&&j.b.LightmapTextureEnabled?((0,R.D)(this._lightmapTexture,M,"LIGHTMAP"),M.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,M.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,M.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):M.LIGHTMAP=!1,this._emissiveTexture&&j.b.EmissiveTextureEnabled?((0,R.D)(this._emissiveTexture,M,"EMISSIVE"),M.GAMMAEMISSIVE=this._emissiveTexture.gammaSpace):M.EMISSIVE=!1,j.b.SpecularTextureEnabled?(this._metallicTexture?((0,R.D)(this._metallicTexture,M,"REFLECTIVITY"),M.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,M.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,M.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,M.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed,M.REFLECTIVITY_GAMMA=!1):this._reflectivityTexture?((0,R.D)(this._reflectivityTexture,M,"REFLECTIVITY"),M.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,M.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap,M.REFLECTIVITY_GAMMA=this._reflectivityTexture.gammaSpace):M.REFLECTIVITY=!1,this._metallicReflectanceTexture||this._reflectanceTexture?(M.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=this._useOnlyMetallicFromMetallicReflectanceTexture,this._metallicReflectanceTexture?((0,R.D)(this._metallicReflectanceTexture,M,"METALLIC_REFLECTANCE"),M.METALLIC_REFLECTANCE_GAMMA=this._metallicReflectanceTexture.gammaSpace):M.METALLIC_REFLECTANCE=!1,this._reflectanceTexture&&(!this._metallicReflectanceTexture||this._metallicReflectanceTexture&&this._useOnlyMetallicFromMetallicReflectanceTexture)?((0,R.D)(this._reflectanceTexture,M,"REFLECTANCE"),M.REFLECTANCE_GAMMA=this._reflectanceTexture.gammaSpace):M.REFLECTANCE=!1):(M.METALLIC_REFLECTANCE=!1,M.REFLECTANCE=!1),this._microSurfaceTexture?(0,R.D)(this._microSurfaceTexture,M,"MICROSURFACEMAP"):M.MICROSURFACEMAP=!1):(M.REFLECTIVITY=!1,M.MICROSURFACEMAP=!1),s.getCaps().standardDerivatives&&this._bumpTexture&&j.b.BumpTextureEnabled&&!this._disableBumpMap?((0,R.D)(this._bumpTexture,M,"BUMP"),this._useParallax&&this._albedoTexture&&j.b.DiffuseTextureEnabled?(M.PARALLAX=!0,M.PARALLAX_RHS=z.useRightHandedSystem,M.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):M.PARALLAX=!1,M.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):(M.BUMP=!1,M.PARALLAX=!1,M.PARALLAX_RHS=!1,M.PARALLAXOCCLUSION=!1,M.OBJECTSPACE_NORMALMAP=!1),this._environmentBRDFTexture&&j.b.ReflectionTextureEnabled?(M.ENVIRONMENTBRDF=!0,M.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(M.ENVIRONMENTBRDF=!1,M.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?M.ALPHAFROMALBEDO=!0:M.ALPHAFROMALBEDO=!1}M.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===a.LIGHTFALLOFF_STANDARD?(M.USEPHYSICALLIGHTFALLOFF=!1,M.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===a.LIGHTFALLOFF_GLTF?(M.USEPHYSICALLIGHTFALLOFF=!1,M.USEGLTFLIGHTFALLOFF=!0):(M.USEPHYSICALLIGHTFALLOFF=!0,M.USEGLTFLIGHTFALLOFF=!1),M.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.Me&&this._twoSidedLighting?M.TWOSIDEDLIGHTING=!0:M.TWOSIDEDLIGHTING=!1,M.SPECULARAA=s.getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(M._areTexturesDirty||M._areMiscDirty)&&(M.ALPHATESTVALUE=`${this._alphaCutOff}${this._alphaCutOff%1===0?".":""}`,M.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,M.ALPHABLEND=this.needAlphaBlendingForMesh(C),M.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,M.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),M._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(M),M.FORCENORMALFORWARD=this._forceNormalForward,M.RADIANCEOCCLUSION=this._useRadianceOcclusion,M.HORIZONOCCLUSION=this._useHorizonOcclusion,M._areMiscDirty&&((0,R.G)(C,z,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(C)||this._forceAlphaTest,M,this._applyDecalMapAfterDetailMap),M.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!C.isVerticesDataPresent(V.h.NormalKind),M.DEBUGMODE=this._debugMode),(0,R.A)(z,s,this,M,!!x,f,T),this._eventInfo.defines=M,this._eventInfo.mesh=C,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,R.z)(C,M,!0,!0,!0,this._transparencyMode!==a.PBRMATERIAL_OPAQUE),this._callbackPluginEventPrepareDefines(this._eventInfo)}forceCompilation(C,M,x){const f={clipPlane:!1,useInstances:!1,...x};this._uniformBufferLayoutBuilt||this.buildUniformLayout(),this._callbackPluginEventGeneric(4,this._eventInfo);(()=>{if(this._breakShaderLoadedCheck)return;const x=new G(this._eventInfo.defineNames),T=this._prepareEffect(C,x,void 0,void 0,f.useInstances,f.clipPlane,C.hasThinInstances);this._onEffectCreatedObservable&&(K.effect=T,K.subMesh=null,this._onEffectCreatedObservable.notifyObservers(K)),T.isReady()?M&&M(this):T.onCompileObservable.add((()=>{M&&M(this)}))})()}buildUniformLayout(){const C=this._uniformBuffer;C.addUniform("vAlbedoInfos",2),C.addUniform("vAmbientInfos",4),C.addUniform("vOpacityInfos",2),C.addUniform("vEmissiveInfos",2),C.addUniform("vLightmapInfos",2),C.addUniform("vReflectivityInfos",3),C.addUniform("vMicroSurfaceSamplerInfos",2),C.addUniform("vReflectionInfos",2),C.addUniform("vReflectionFilteringInfo",2),C.addUniform("vReflectionPosition",3),C.addUniform("vReflectionSize",3),C.addUniform("vBumpInfos",3),C.addUniform("albedoMatrix",16),C.addUniform("ambientMatrix",16),C.addUniform("opacityMatrix",16),C.addUniform("emissiveMatrix",16),C.addUniform("lightmapMatrix",16),C.addUniform("reflectivityMatrix",16),C.addUniform("microSurfaceSamplerMatrix",16),C.addUniform("bumpMatrix",16),C.addUniform("vTangentSpaceParams",2),C.addUniform("reflectionMatrix",16),C.addUniform("vReflectionColor",3),C.addUniform("vAlbedoColor",4),C.addUniform("vLightingIntensity",4),C.addUniform("vReflectionMicrosurfaceInfos",3),C.addUniform("pointSize",1),C.addUniform("vReflectivityColor",4),C.addUniform("vEmissiveColor",3),C.addUniform("vAmbientColor",3),C.addUniform("vDebugMode",2),C.addUniform("vMetallicReflectanceFactors",4),C.addUniform("vMetallicReflectanceInfos",2),C.addUniform("metallicReflectanceMatrix",16),C.addUniform("vReflectanceInfos",2),C.addUniform("reflectanceMatrix",16),C.addUniform("vSphericalL00",3),C.addUniform("vSphericalL1_1",3),C.addUniform("vSphericalL10",3),C.addUniform("vSphericalL11",3),C.addUniform("vSphericalL2_2",3),C.addUniform("vSphericalL2_1",3),C.addUniform("vSphericalL20",3),C.addUniform("vSphericalL21",3),C.addUniform("vSphericalL22",3),C.addUniform("vSphericalX",3),C.addUniform("vSphericalY",3),C.addUniform("vSphericalZ",3),C.addUniform("vSphericalXX_ZZ",3),C.addUniform("vSphericalYY_ZZ",3),C.addUniform("vSphericalZZ",3),C.addUniform("vSphericalXY",3),C.addUniform("vSphericalYZ",3),C.addUniform("vSphericalZX",3),super.buildUniformLayout()}bindForSubMesh(C,M,x){const f=this.va(),T=x.materialDefines;if(!T)return;const z=x.effect;if(!z)return;this._activeEffect=z,M.getMeshUniformBuffer().bindToEffect(z,"Mesh"),M.transferToEffect(C);const s=f.getEngine();this._uniformBuffer.bindToEffect(z,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,f,M,C,this.isFrozen),E.d.Bind(s.currentRenderPassId,this._activeEffect,M,C),this._eventInfo.subMesh=x,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),T.OBJECTSPACE_NORMALMAP&&(C.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const S=this._mustRebind(f,z,x,M.visibility);(0,R.b)(M,this._activeEffect,this.prePassConfiguration);let Q=null;const V=this._uniformBuffer;if(S){if(this.bindViewProjection(z),Q=this._getReflectionTexture(),!V.useUbo||!this.isFrozen||!V.isSync||x._drawWrapper._forceRebindOnNextCall){var y;if(f.texturesEnabled){if(this._albedoTexture&&j.b.DiffuseTextureEnabled&&(V.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),(0,R.r)(this._albedoTexture,V,"albedo")),this._ambientTexture&&j.b.AmbientTextureEnabled&&(V.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),(0,R.r)(this._ambientTexture,V,"ambient")),this._opacityTexture&&j.b.OpacityTextureEnabled&&(V.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,R.r)(this._opacityTexture,V,"opacity")),Q&&j.b.ReflectionTextureEnabled){if(V.ee("reflectionMatrix",Q.getReflectionTextureMatrix()),V.updateFloat2("vReflectionInfos",Q.level,0),Q.boundingBoxSize){const C=Q;V.updateVector3("vReflectionPosition",C.boundingBoxPosition),V.updateVector3("vReflectionSize",C.boundingBoxSize)}if(this.realTimeFiltering){const C=Q.getSize().width;V.updateFloat2("vReflectionFilteringInfo",C,Math.log2(C))}if(!T.USEIRRADIANCEMAP){const C=Q.sphericalPolynomial;if(T.USESPHERICALFROMREFLECTIONMAP&&C)if(T.SPHERICAL_HARMONICS){const M=C.preScaledHarmonics;V.updateVector3("vSphericalL00",M.l00),V.updateVector3("vSphericalL1_1",M.l1_1),V.updateVector3("vSphericalL10",M.l10),V.updateVector3("vSphericalL11",M.l11),V.updateVector3("vSphericalL2_2",M.l2_2),V.updateVector3("vSphericalL2_1",M.l2_1),V.updateVector3("vSphericalL20",M.l20),V.updateVector3("vSphericalL21",M.l21),V.updateVector3("vSphericalL22",M.l22)}else V.updateFloat3("vSphericalX",C.x.x,C.x.y,C.x.z),V.updateFloat3("vSphericalY",C.y.x,C.y.y,C.y.z),V.updateFloat3("vSphericalZ",C.z.x,C.z.y,C.z.z),V.updateFloat3("vSphericalXX_ZZ",C.xx.x-C.zz.x,C.xx.y-C.zz.y,C.xx.z-C.zz.z),V.updateFloat3("vSphericalYY_ZZ",C.yy.x-C.zz.x,C.yy.y-C.zz.y,C.yy.z-C.zz.z),V.updateFloat3("vSphericalZZ",C.zz.x,C.zz.y,C.zz.z),V.updateFloat3("vSphericalXY",C.xy.x,C.xy.y,C.xy.z),V.updateFloat3("vSphericalYZ",C.yz.x,C.yz.y,C.yz.z),V.updateFloat3("vSphericalZX",C.zx.x,C.zx.y,C.zx.z)}V.updateFloat3("vReflectionMicrosurfaceInfos",Q.getSize().width,Q.lodGenerationScale,Q.lodGenerationOffset)}this._emissiveTexture&&j.b.EmissiveTextureEnabled&&(V.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,R.r)(this._emissiveTexture,V,"emissive")),this._lightmapTexture&&j.b.LightmapTextureEnabled&&(V.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,R.r)(this._lightmapTexture,V,"lightmap")),j.b.SpecularTextureEnabled&&(this._metallicTexture?(V.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),(0,R.r)(this._metallicTexture,V,"reflectivity")):this._reflectivityTexture&&(V.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),(0,R.r)(this._reflectivityTexture,V,"reflectivity")),this._metallicReflectanceTexture&&(V.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level),(0,R.r)(this._metallicReflectanceTexture,V,"metallicReflectance")),this._reflectanceTexture&&T.REFLECTANCE&&(V.updateFloat2("vReflectanceInfos",this._reflectanceTexture.coordinatesIndex,this._reflectanceTexture.level),(0,R.r)(this._reflectanceTexture,V,"reflectance")),this._microSurfaceTexture&&(V.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),(0,R.r)(this._microSurfaceTexture,V,"microSurfaceSampler"))),this._bumpTexture&&s.getCaps().standardDerivatives&&j.b.BumpTextureEnabled&&!this._disableBumpMap&&(V.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),(0,R.r)(this._bumpTexture,V,"bump"),f._mirroredCameraPosition?V.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):V.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&V.updateFloat("pointSize",this.pointSize),T.METALLICWORKFLOW){var U;o.f._d[0].r=void 0===this._metallic||null===this._metallic?1:this._metallic,o.f._d[0].g=void 0===this._roughness||null===this._roughness?1:this._roughness,V.updateColor4("vReflectivityColor",o.f._d[0],1);const C=(null===(U=this.subSurface)||void 0===U?void 0:U._indexOfRefraction)??1.5,M=1,x=Math.pow((C-M)/(C+M),2);this._metallicReflectanceColor.scaleToRef(x*this._metallicF0Factor,o.f._d[0]);const f=this._metallicF0Factor;V.updateColor4("vMetallicReflectanceFactors",o.f._d[0],f)}else V.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);V.updateColor3("vEmissiveColor",j.b.EmissiveTextureEnabled?this._emissiveColor:o.d.BlackReadOnly),V.updateColor3("vReflectionColor",this._reflectionColor),!T.SS_REFRACTION&&null!==(y=this.subSurface)&&void 0!==y&&y._linkRefractionWithTransparency?V.updateColor4("vAlbedoColor",this._albedoColor,1):V.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*f.environmentIntensity,this._lightingInfos.w=this._specularIntensity,V.updateVector4("vLightingIntensity",this._lightingInfos),f.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor),V.updateColor3("vAmbientColor",this._globalAmbientColor),V.updateFloat2("vDebugMode",this.debugLimit,this.debugFactor)}f.texturesEnabled&&(this._albedoTexture&&j.b.DiffuseTextureEnabled&&V.setTexture("albedoSampler",this._albedoTexture),this._ambientTexture&&j.b.AmbientTextureEnabled&&V.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&j.b.OpacityTextureEnabled&&V.setTexture("opacitySampler",this._opacityTexture),Q&&j.b.ReflectionTextureEnabled&&(T.LODBASEDMICROSFURACE?V.setTexture("reflectionSampler",Q):(V.setTexture("reflectionSampler",Q._lodTextureMid||Q),V.setTexture("reflectionSamplerLow",Q._lodTextureLow||Q),V.setTexture("reflectionSamplerHigh",Q._lodTextureHigh||Q)),T.USEIRRADIANCEMAP&&V.setTexture("irradianceSampler",Q.irradianceTexture)),T.ENVIRONMENTBRDF&&V.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&j.b.EmissiveTextureEnabled&&V.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&j.b.LightmapTextureEnabled&&V.setTexture("lightmapSampler",this._lightmapTexture),j.b.SpecularTextureEnabled&&(this._metallicTexture?V.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&V.setTexture("reflectivitySampler",this._reflectivityTexture),this._metallicReflectanceTexture&&V.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture),this._reflectanceTexture&&T.REFLECTANCE&&V.setTexture("reflectanceSampler",this._reflectanceTexture),this._microSurfaceTexture&&V.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&s.getCaps().standardDerivatives&&j.b.BumpTextureEnabled&&!this._disableBumpMap&&V.setTexture("bumpSampler",this._bumpTexture)),this.va().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(M)&&this.va().depthPeelingRenderer.bind(z),this._eventInfo.subMesh=x,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,Z.f)(this._activeEffect,this,f),this.bindEyePosition(z)}else f.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(S||!this.isFrozen){var O;if(f.lightsEnabled&&!this._disableLighting&&(0,R.i)(f,M,this._activeEffect,T,this._maxSimultaneousLights),(f.fogEnabled&&M.applyFog&&f.fogMode!==m.e.FOGMODE_NONE||Q||this.subSurface.refractionTexture||M.receiveShadows||T.PREPASS)&&this.bindView(z),(0,R.f)(f,M,this._activeEffect,!0),T.NUM_MORPH_INFLUENCERS&&(0,R.n)(M,this._activeEffect),T.BAKED_VERTEX_ANIMATION_TEXTURE)null===(O=M.bakedVertexAnimationManager)||void 0===O||O.bind(z,T.INSTANCES);this._imageProcessingConfiguration.bind(this._activeEffect),(0,R.j)(T,this._activeEffect,f)}this._afterBind(M,this._activeEffect,x),V.update()}getAnimatables(){const C=super.getAnimatables();return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&C.push(this._albedoTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&C.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&C.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&C.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&C.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?C.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&C.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&C.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&C.push(this._lightmapTexture),this._metallicReflectanceTexture&&this._metallicReflectanceTexture.animations&&this._metallicReflectanceTexture.animations.length>0&&C.push(this._metallicReflectanceTexture),this._reflectanceTexture&&this._reflectanceTexture.animations&&this._reflectanceTexture.animations.length>0&&C.push(this._reflectanceTexture),this._microSurfaceTexture&&this._microSurfaceTexture.animations&&this._microSurfaceTexture.animations.length>0&&C.push(this._microSurfaceTexture),C}_getReflectionTexture(){return this._reflectionTexture?this._reflectionTexture:this.va().environmentTexture}getActiveTextures(){const C=super.getActiveTextures();return this._albedoTexture&&C.push(this._albedoTexture),this._ambientTexture&&C.push(this._ambientTexture),this._opacityTexture&&C.push(this._opacityTexture),this._reflectionTexture&&C.push(this._reflectionTexture),this._emissiveTexture&&C.push(this._emissiveTexture),this._reflectivityTexture&&C.push(this._reflectivityTexture),this._metallicTexture&&C.push(this._metallicTexture),this._metallicReflectanceTexture&&C.push(this._metallicReflectanceTexture),this._reflectanceTexture&&C.push(this._reflectanceTexture),this._microSurfaceTexture&&C.push(this._microSurfaceTexture),this._bumpTexture&&C.push(this._bumpTexture),this._lightmapTexture&&C.push(this._lightmapTexture),C}hasTexture(C){return!!super.hasTexture(C)||(this._albedoTexture===C||(this._ambientTexture===C||(this._opacityTexture===C||(this._reflectionTexture===C||(this._emissiveTexture===C||(this._reflectivityTexture===C||(this._metallicTexture===C||(this._metallicReflectanceTexture===C||(this._reflectanceTexture===C||(this._microSurfaceTexture===C||(this._bumpTexture===C||this._lightmapTexture===C)))))))))))}setPrePassRenderer(){var C;if(null===(C=this.subSurface)||void 0===C||!C.isScatteringEnabled)return!1;const M=this.va().enableSubSurfaceForPrePass();return M&&(M.enabled=!0),!0}dispose(C,M){var x,f,T,z,s,S,m,Q,V,y,U,O;(this._breakShaderLoadedCheck=!0,M)&&(this._environmentBRDFTexture&&this.va().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),null===(x=this._albedoTexture)||void 0===x||x.dispose(),null===(f=this._ambientTexture)||void 0===f||f.dispose(),null===(T=this._opacityTexture)||void 0===T||T.dispose(),null===(z=this._reflectionTexture)||void 0===z||z.dispose(),null===(s=this._emissiveTexture)||void 0===s||s.dispose(),null===(S=this._metallicTexture)||void 0===S||S.dispose(),null===(m=this._reflectivityTexture)||void 0===m||m.dispose(),null===(Q=this._bumpTexture)||void 0===Q||Q.dispose(),null===(V=this._lightmapTexture)||void 0===V||V.dispose(),null===(y=this._metallicReflectanceTexture)||void 0===y||y.dispose(),null===(U=this._reflectanceTexture)||void 0===U||U.dispose(),null===(O=this._microSurfaceTexture)||void 0===O||O.dispose());this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(C,M)}}a.PBRMATERIAL_OPAQUE=t.c.MATERIAL_OPAQUE,a.PBRMATERIAL_ALPHATEST=t.c.MATERIAL_ALPHATEST,a.PBRMATERIAL_ALPHABLEND=t.c.MATERIAL_ALPHABLEND,a.PBRMATERIAL_ALPHATESTANDBLEND=t.c.MATERIAL_ALPHATESTANDBLEND,a.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,a.LIGHTFALLOFF_PHYSICAL=0,a.LIGHTFALLOFF_GLTF=1,a.LIGHTFALLOFF_STANDARD=2,a.ForceGLSL=!1,(0,f.e)([(0,T.s)()],a.prototype,"_imageProcessingConfiguration",void 0),(0,f.e)([(0,T.e)("_markAllSubMeshesAsMiscDirty")],a.prototype,"debugMode",void 0)},12368:(C,M,x)=>{"use strict";x.d(M,{d:()=>U});var f=x(951),T=x(959),z=x(1192),s=x(978),S=x(1019),m=x(945),Q=x(997),V=x(971),y=x(1145);x(1491);class U extends S.e{set boundingBoxSize(C){if(this._boundingBoxSize&&this._boundingBoxSize.equals(C))return;this._boundingBoxSize=C;const M=this.va();M&&M.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(C){this._rotationY=C,this.setReflectionTextureMatrix(s.d.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(C,M,x){let f="";return C.forEach((C=>f+=C)),new U(f,M,null,x,C)}static CreateFromPrefilteredData(C,M){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,f=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const T=M.useDelayedTextureLoading;M.useDelayedTextureLoading=!1;const z=new U(C,M,null,!1,null,null,null,void 0,!0,x,f);return M.useDelayedTextureLoading=T,z}constructor(C,M){var x;let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,T=arguments.length>3&&void 0!==arguments[3]&&arguments[3],z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,U=arguments.length>8&&void 0!==arguments[8]&&arguments[8],O=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,d=arguments.length>10&&void 0!==arguments[10]&&arguments[10],D=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,o=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,L=arguments.length>13?arguments[13]:void 0,t=arguments.length>14?arguments[14]:void 0;super(M),this.onLoadObservable=new V.c,this.boundingBoxPosition=s.m.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new s.d,this._buffer=null,this.name=C,this.url=C,this._noMipmap=T,this.rd=!1,this.isCube=!0,this._textureMatrix=s.d.Identity(),this.coordinatesMode=m.b.CUBIC_MODE;let A=null,H=null;null===f||Array.isArray(f)?(this._noMipmap=T,this._format=y,this._createPolynomials=d,A=f,this._loaderOptions=L,this._useSRGBBuffer=t,this._lodScale=D,this._lodOffset=o):(A=f.extensions??null,this._noMipmap=f.noMipmap??!1,z=f.files??null,H=f.buffer??null,this._format=f.format??5,U=f.prefiltered??!1,O=f.forcedExtension??null,this._createPolynomials=f.createPolynomials??!1,this._lodScale=f.lodScale??.8,this._lodOffset=f.lodOffset??0,this._loaderOptions=f.loaderOptions,this._useSRGBBuffer=f.useSRGBBuffer,S=f.X??null,Q=f.onError??null),(C||z)&&this.updateURL(C,O,S,U,Q,A,null===(x=this.va())||void 0===x?void 0:x.useDelayedTextureLoading,z,H)}getClassName(){return"CubeTexture"}updateURL(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,f=arguments.length>3&&void 0!==arguments[3]&&arguments[3],T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,m=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=C),this.url=C,M&&(this._forcedExtension=M);const Q=C.lastIndexOf("."),V=M||(Q>-1?C.substring(Q).toLowerCase():""),y=0===V.indexOf(".dds"),U=0===V.indexOf(".env"),O=0===V.indexOf(".basis");if(U?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=f,f&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),S)this._files=S;else if(O||U||y||z||(z=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,z){for(let M=0;M<z.length;M++)this._files.push(C+z[M]);this._extensions=z}this._buffer=m,s?(this.delayLoadState=4,this._delayedOnLoad=x,this._delayedOnError=T):this._loadTexture(x,T)}delayLoad(C){4===this.delayLoadState&&(C&&(this._forcedExtension=C),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(C){var M,x;if(C.updateFlag===this._textureMatrix.updateFlag)return;C.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(x=this.va())||void 0===x||x.markAllMaterialsAsDirty(1,(C=>-1!==C.getActiveTextures().indexOf(this))));if(this._textureMatrix=C,null===(M=this.va())||void 0===M||!M.useRightHandedSystem)return;const f=s.i.Md[0],T=s.i.Quaternion[0],z=s.i.Md[1];this._textureMatrix.decompose(f,T,z),T.z*=-1,T.w*=-1,s.d.ComposeToRef(f,T,z,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var C;return null!==(C=this.va())&&void 0!==C&&C.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const x=this.va(),f=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const T=()=>{var M;(this.onLoadObservable.notifyObservers(this),f)&&(f.dispose(),null===(M=this.va())||void 0===M||M.markAllMaterialsAsDirty(1));C&&C()},s=(C,x)=>{this._loadingError=!0,this._errorObject={message:C,exception:x},M&&M(C,x),m.b.OnTextureLoadErrorObservable.notifyObservers(this)};var S;this._texture?this._texture.isReady?z.i.SetImmediate((()=>T())):this._texture.onLoadedObservable.add((()=>T())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,x,this._lodScale,this._lodOffset,C,s,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,x,this._files,this._noMipmap,C,s,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(S=this._texture)||void 0===S||S.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(C,M,x){const f=y.e.Parse((()=>{let f=!1;return C.prefiltered&&(f=C.prefiltered),new U(x+(C.url??C.name),M,C.extensions,!1,C.files||null,null,null,void 0,f,C.forcedExtension)}),C,M);if(C.boundingBoxPosition&&(f.boundingBoxPosition=s.m.Dd(C.boundingBoxPosition)),C.boundingBoxSize&&(f.boundingBoxSize=s.m.Dd(C.boundingBoxSize)),C.animations)for(let T=0;T<C.animations.length;T++){const M=C.animations[T],x=(0,Q.c)("BABYLON.Animation");x&&f.animations.push(x.Parse(M))}return f}clone(){let C=0;const M=y.e.Clone((()=>{const M=new U(this.url,this.va()||this._getEngine(),this._extensions,this._noMipmap,this._files);return C=M.uniqueId,M}),this);return M.uniqueId=C,M}}(0,f.e)([(0,T.J)()],U.prototype,"url",void 0),(0,f.e)([(0,T.H)()],U.prototype,"boundingBoxPosition",void 0),(0,f.e)([(0,T.H)()],U.prototype,"boundingBoxSize",null),(0,f.e)([(0,T.J)("rotationY")],U.prototype,"rotationY",null),(0,f.e)([(0,T.J)("files")],U.prototype,"_files",void 0),(0,f.e)([(0,T.J)("forcedExtension")],U.prototype,"_forcedExtension",void 0),(0,f.e)([(0,T.J)("extensions")],U.prototype,"_extensions",void 0),(0,f.e)([(0,T.t)("textureMatrix")],U.prototype,"_textureMatrix",void 0),(0,f.e)([(0,T.t)("textureMatrixRefraction")],U.prototype,"_textureMatrixRefraction",void 0),m.b._CubeTextureParser=U.Parse,(0,Q.f)("BABYLON.CubeTexture",U)},12724:(C,M,x)=>{"use strict";x.d(M,{c:()=>m});var f=x(1078),T=x(945),z=x(1198),s=x(1386),S=x(1121);s.ThinEngine.prototype.createDynamicTexture=function(C,M,x,f){const T=new S.c(this,4);return T.baseWidth=C,T.baseHeight=M,x&&(C=this.needPOTTextures?(0,z.e)(C,this._caps.maxTextureSize):C,M=this.needPOTTextures?(0,z.e)(M,this._caps.maxTextureSize):M),T.width=C,T.height=M,T.isReady=!1,T.generateMipMaps=x,T.samplingMode=f,this.updateTextureSamplingMode(f,T),this._internalTexturesCache.push(T),T},s.ThinEngine.prototype.updateDynamicTexture=function(C,M,x){let f=arguments.length>3&&void 0!==arguments[3]&&arguments[3],T=arguments.length>4?arguments[4]:void 0,z=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!C)return;const s=this._gl,S=s.TEXTURE_2D,m=this._bindTextureDirectly(S,C,!0,z);this._unpackFlipY(void 0===x?C.invertY:x),f&&s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const Q=this._getWebGLTextureType(C.type),V=this._getInternalFormat(T||C.format),y=this._getRGBABufferInternalSizedFormat(C.type,V);s.texImage2D(S,0,y,V,Q,M),C.generateMipMaps&&s.generateMipmap(S),m||this._bindTextureDirectly(S,null),f&&s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),T&&(C.format=T),C._dynamicTextureSource=M,C._premulAlpha=f,C.invertY=x||!1,C.isReady=!0};class m extends T.b{constructor(C,M,x){let f=arguments.length>3&&void 0!==arguments[3]&&arguments[3],z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,S=arguments.length>6?arguments[6]:void 0;const m=!x||x._isScene;super(null,m?x:null===x||void 0===x?void 0:x.xe,m?!f:x,S,z,void 0,void 0,void 0,void 0,s),this.name=C,this.wrapU=T.b.CLAMP_ADDRESSMODE,this.wrapV=T.b.CLAMP_ADDRESSMODE,this._generateMipMaps=f;const Q=this._getEngine();if(!Q)return;if(M.getContext)this._canvas=M,this._ownCanvas=!1,this._texture=Q.createDynamicTexture(this._canvas.width,this._canvas.height,f,z);else{this._canvas=Q.createCanvas(1,1),this._ownCanvas=!0;const C=M;C.width||0===C.width?this._texture=Q.createDynamicTexture(C.width,C.height,f,z):this._texture=Q.createDynamicTexture(M,M,f,z)}const V=this.getSize();this._canvas.width!==V.width&&(this._canvas.width=V.width),this._canvas.height!==V.height&&(this._canvas.height=V.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(C){this._canvas.width=C.width,this._canvas.height=C.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(C.width,C.height,this._generateMipMaps,this.samplingMode)}scale(C){const M=this.getSize();M.width*=C,M.height*=C,this._recreate(M)}scaleTo(C,M){const x=this.getSize();x.width=C,x.height=M,this._recreate(x)}getContext(){return this._context}clear(C){const M=this.getSize();C&&(this._context.fillStyle=C),this._context.clearRect(0,0,M.width,M.height)}update(C){let M=arguments.length>1&&void 0!==arguments[1]&&arguments[1],x=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===C||C,M,this._format||void 0,void 0,x)}drawText(C,M,x,f,T,z,s){let S=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const m=this.getSize();if(z&&(this._context.fillStyle=z,this._context.fillRect(0,0,m.width,m.height)),this._context.font=f,null===M||void 0===M){const x=this._context.measureText(C);M=(m.width-x.width)/2}if(null===x||void 0===x){const C=parseInt(f.replace(/\D/g,""));x=m.height/2+C/3.65}this._context.fillStyle=T||"",this._context.fillText(C,M,x),S&&this.update(s)}dispose(){var C,M;(super.dispose(),this._ownCanvas)&&(null===(C=this._canvas)||void 0===C||null===(M=C.remove)||void 0===M||M.call(C));this._canvas=null,this._context=null}clone(){const C=this.va();if(!C)return this;const M=this.getSize(),x=new m(this.name,M,C,this._generateMipMaps);return x.rd=this.rd,x.level=this.level,x.wrapU=this.wrapU,x.wrapV=this.wrapV,x}serialize(){const C=this.va();C&&!C.isReady()&&f.e.Warn("The scene must be ready before serializing the dynamic texture");const M=super.serialize();return m._IsCanvasElement(this._canvas)&&(M.base64String=this._canvas.toDataURL()),M.invertY=this._invertY,M.samplingMode=this.samplingMode,M}static _IsCanvasElement(C){return void 0!==C.toDataURL}_rebuild(){this.update()}}},11867:(C,M,x)=>{"use strict";x.d(M,{e:()=>T});var f=x(945);class T extends f.b{constructor(C,M,x,T,z){let s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],S=arguments.length>6&&void 0!==arguments[6]&&arguments[6],m=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,Q=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,V=arguments.length>9?arguments[9]:void 0,y=arguments.length>10?arguments[10]:void 0;super(null,z,!s,S,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,V),this.format=T,this._engine&&(this._engine._caps.textureFloatLinearFiltering||1!==Q||(m=1),this._engine._caps.textureHalfFloatLinearFiltering||2!==Q||(m=1),this._texture=this._engine.createRawTexture(C,M,x,T,s,S,m,null,Q,V??0,y??!1),this.wrapU=f.b.CLAMP_ADDRESSMODE,this.wrapV=f.b.CLAMP_ADDRESSMODE)}update(C){this._getEngine().updateRawTexture(this._texture,C,this._texture.format,this._texture.invertY,null,this._texture.type,this._texture._useSRGBBuffer)}clone(){if(!this._texture)return super.clone();const C=new T(null,this.getSize().width,this.getSize().height,this.format,this.va(),this._texture.generateMipMaps,this._invertY,this.samplingMode,this._texture.type,this._texture._creationFlags,this._useSRGBBuffer);return C._texture=this._texture,this._texture.incrementReferences(),C}static CreateLuminanceTexture(C,M,x,f){return new T(C,M,x,1,f,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateLuminanceAlphaTexture(C,M,x,f){return new T(C,M,x,2,f,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateAlphaTexture(C,M,x,f){return new T(C,M,x,0,f,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateRGBTexture(C,M,x,f){return new T(C,M,x,4,f,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBATexture(C,M,x,f){return new T(C,M,x,5,f,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBAStorageTexture(C,M,x,f){return new T(C,M,x,5,f,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,1,arguments.length>8&&void 0!==arguments[8]&&arguments[8])}static CreateRTexture(C,M,x,z){let s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],S=arguments.length>5&&void 0!==arguments[5]&&arguments[5],m=arguments.length>6&&void 0!==arguments[6]?arguments[6]:f.b.TRILINEAR_SAMPLINGMODE;return new T(C,M,x,6,z,s,S,m,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1)}static CreateRStorageTexture(C,M,x,z){let s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],S=arguments.length>5&&void 0!==arguments[5]&&arguments[5],m=arguments.length>6&&void 0!==arguments[6]?arguments[6]:f.b.TRILINEAR_SAMPLINGMODE;return new T(C,M,x,6,z,s,S,m,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,1)}}},11768:(C,M,x)=>{"use strict";x.d(M,{b:()=>s});var f=x(1289),T=x(1154),z=x(997);class s extends f.c{get Mg(){return this._subMaterials}set Mg(C){this._subMaterials=C,this._hookArray(C)}getChildren(){return this.Mg}constructor(C,M){super(C,M,!0),this._waitingSubMaterialsUniqueIds=[],this.va().addMultiMaterial(this),this.Mg=[],this._storeEffectOnSubMeshes=!0}_hookArray(C){var M=this;const x=C.push;C.push=function(){for(var f=arguments.length,T=new Array(f),z=0;z<f;z++)T[z]=arguments[z];const s=x.apply(C,T);return M._markAllSubMeshesAsTexturesDirty(),s};const f=C.splice;C.splice=(M,x)=>{const T=f.apply(C,[M,x]);return this._markAllSubMeshesAsTexturesDirty(),T}}getSubMaterial(C){return C<0||C>=this.Mg.length?this.va().defaultMaterial:this.Mg[C]}getActiveTextures(){return super.getActiveTextures().concat(...this.Mg.map((C=>C?C.getActiveTextures():[])))}hasTexture(C){if(super.hasTexture(C))return!0;for(let x=0;x<this.Mg.length;x++){var M;if(null!==(M=this.Mg[x])&&void 0!==M&&M.hasTexture(C))return!0}return!1}getClassName(){return"MultiMaterial"}isReadyForSubMesh(C,M,x){for(let f=0;f<this.Mg.length;f++){const T=this.Mg[f];if(T){if(T._storeEffectOnSubMeshes){if(!T.isReadyForSubMesh(C,M,x))return!1;continue}if(!T.isReady(C))return!1}}return!0}clone(C,M){const x=new s(C,this.va());for(let f=0;f<this.Mg.length;f++){let T=null;const z=this.Mg[f];T=M&&z?z.clone(C+"-"+z.name):this.Mg[f],x.Mg.push(T)}return x}serialize(){const C={};C.name=this.name,C.id=this.id,C.uniqueId=this.uniqueId,T.d&&(C.tags=T.d.GetTags(this)),C.materialsUniqueIds=[],C.materials=[];for(let M=0;M<this.Mg.length;M++){const x=this.Mg[M];x?(C.materialsUniqueIds.push(x.uniqueId),C.materials.push(x.id)):(C.materialsUniqueIds.push(null),C.materials.push(null))}return C}dispose(C,M,x){const f=this.va();if(!f)return;if(x)for(let z=0;z<this.Mg.length;z++){const x=this.Mg[z];x&&x.dispose(C,M)}const T=f.multiMaterials.indexOf(this);T>=0&&f.multiMaterials.splice(T,1),super.dispose(C,M)}static ParseMultiMaterial(C,M){const x=new s(C.name,M);return x.id=C.id,x._loadedUniqueId=C.uniqueId,T.d&&T.d.AddTagsTo(x,C.tags),C.materialsUniqueIds?x._waitingSubMaterialsUniqueIds=C.materialsUniqueIds:C.materials.forEach((C=>x.Mg.push(M.getLastMaterialById(C)))),x}}(0,z.f)("BABYLON.MultiMaterial",s)},11770:(C,M,x)=>{"use strict";x.d(M,{e:()=>V,i:()=>Q});var f=x(978),T=x(1162),z=x(11712),s=x(11739),S=x(1178);x(11773);function m(C){let M=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const x=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],z=[];let m=[];const Q=C.width||C.size||1,V=C.height||C.size||1,y=C.depth||C.size||1,U=C.wrap||!1;let O=void 0===C.topBaseAt?1:C.topBaseAt,d=void 0===C.bottomBaseAt?0:C.bottomBaseAt;O=(O+4)%4,d=(d+4)%4;let D=[2,0,3,1][O],o=[2,0,1,3][d],L=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(U){M=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],L=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let C=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],x=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const f=[17,18,19,16],T=[22,23,20,21];for(;D>0;)C.unshift(C.pop()),f.unshift(f.pop()),D--;for(;o>0;)x.unshift(x.pop()),T.unshift(T.pop()),o--;C=C.flat(),x=x.flat(),L=L.concat(C).concat(x),M.push(f[0],f[2],f[3],f[0],f[1],f[2]),M.push(T[0],T[2],T[3],T[0],T[1],T[2])}const t=[Q/2,V/2,y/2];m=L.reduce(((C,M,x)=>C.concat(M*t[x%3])),[]);const A=0===C.sideOrientation?0:C.sideOrientation||s.b.DEFAULTSIDE,H=C.faceUV||new Array(6),j=C.faceColors,b=[];for(let s=0;s<6;s++)void 0===H[s]&&(H[s]=new f.q(0,0,1,1)),j&&void 0===j[s]&&(j[s]=new T.e(1,1,1,1));for(let f=0;f<6;f++)if(z.push(H[f].z,S.c?1-H[f].w:H[f].w),z.push(H[f].x,S.c?1-H[f].w:H[f].w),z.push(H[f].x,S.c?1-H[f].y:H[f].y),z.push(H[f].z,S.c?1-H[f].y:H[f].y),j)for(let C=0;C<4;C++)b.push(j[f].r,j[f].g,j[f].b,j[f].a);s.b._ComputeSides(A,m,M,x,z,C.frontUVs,C.backUVs);const R=new s.b;if(R.indices=M,R.xa=m,R.ya=x,R.Aa=z,j){const C=A===s.b.DOUBLESIDE?b.concat(b):b;R.za=C}return R}function Q(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const f=new z.d(C,x);M.sideOrientation=z.d._GetDefaultSideOrientation(M.sideOrientation),f._originalBuilderSideOrientation=M.sideOrientation;return m(M).Ca(f,M.updatable),f}const V={CreateBox:Q};s.b.CreateBox=m,z.d.CreateBox=function(C,M){return Q(C,{size:M,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},11883:(C,M,x)=>{"use strict";x.d(M,{d:()=>S});var f=x(11712),T=x(11739),z=x(1178);function s(C){const M=[],x=[],f=[],s=[],S=C.i||.5,m=C.$k||64,Q=C.arc&&(C.arc<=0||C.arc>1)?1:C.arc||1,V=0===C.sideOrientation?0:C.sideOrientation||T.b.DEFAULTSIDE;M.push(0,0,0),s.push(.5,.5);const y=2*Math.PI*Q,U=1===Q?y/m:y/(m-1);let O=0;for(let T=0;T<m;T++){const C=Math.cos(O),x=Math.sin(O),f=(C+1)/2,T=(1-x)/2;M.push(S*C,S*x,0),s.push(f,z.c?1-T:T),O+=U}1===Q&&(M.push(M[3],M[4],M[5]),s.push(s[2],z.c?1-s[3]:s[3]));const d=M.length/3;for(let T=1;T<d-1;T++)x.push(T+1,0,T);T.b.ComputeNormals(M,x,f),T.b._ComputeSides(V,M,x,f,s,C.frontUVs,C.backUVs);const D=new T.b;return D.indices=x,D.xa=M,D.ya=f,D.Aa=s,D}function S(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const T=new f.d(C,x);M.sideOrientation=f.d._GetDefaultSideOrientation(M.sideOrientation),T._originalBuilderSideOrientation=M.sideOrientation;return s(M).Ca(T,M.updatable),T}T.b.lb=s,f.d.lb=function(C,M,x){return S(C,{i:M,$k:x,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},11773:(C,M,x)=>{"use strict";x.d(M,{e:()=>o,b:()=>t,i:()=>L});var f=x(978),T=x(1162),z=x(11712),s=x(11739),S=x(1224);z.d._GroundMeshParser=(C,M)=>m.Parse(C,M);class m extends z.d{constructor(C,M){super(C,M),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=C,this._subdivisionsY=C,this.subdivide(C);const x=this;x.createOrUpdateSubmeshesOctree&&x.createOrUpdateSubmeshesOctree(M)}getHeightAtCoordinates(C,M){const x=this.getWorldMatrix(),T=f.i.Matrix[5];x.invertToRef(T);const z=f.i.Md[8];if(f.m.TransformCoordinatesFromFloatsToRef(C,0,M,T,z),C=z.x,M=z.z,C<this._minX||C>=this._maxX||M<=this._minZ||M>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const s=this._getFacetAt(C,M),S=-(s.x*C+s.z*M+s.w)/s.y;return f.m.TransformCoordinatesFromFloatsToRef(0,S,0,x,z),z.y}getNormalAtCoordinates(C,M){const x=new f.m(0,1,0);return this.getNormalAtCoordinatesToRef(C,M,x),x}getNormalAtCoordinatesToRef(C,M,x){const T=this.getWorldMatrix(),z=f.i.Matrix[5];T.invertToRef(z);const s=f.i.Md[8];if(f.m.TransformCoordinatesFromFloatsToRef(C,0,M,z,s),C=s.x,M=s.z,C<this._minX||C>this._maxX||M<this._minZ||M>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const S=this._getFacetAt(C,M);return f.m.TransformNormalFromFloatsToRef(S.x,S.y,S.z,T,x),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(C,M){const x=Math.floor((C+this._maxX)*this._subdivisionsX/this._width),f=Math.floor(-(M+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),T=this._heightQuads[f*this._subdivisionsX+x];let z;return z=M<T.slope.x*C+T.slope.y?T.facet1:T.facet2,z}_initHeightQuads(){const C=this._subdivisionsX,M=this._subdivisionsY;this._heightQuads=new Array;for(let x=0;x<M;x++)for(let M=0;M<C;M++){const T={slope:f.j.Zero(),facet1:new f.q(0,0,0,0),facet2:new f.q(0,0,0,0)};this._heightQuads[x*C+M]=T}return this}_computeHeightQuads(){const C=this.getVerticesData(S.h.PositionKind);if(!C)return this;const M=f.i.Md[3],x=f.i.Md[2],T=f.i.Md[1],z=f.i.Md[0],s=f.i.Md[4],m=f.i.Md[5],Q=f.i.Md[6],V=f.i.Md[7],y=f.i.Md[8];let U=0,O=0,d=0,D=0,o=0,L=0,t=0;const A=this._subdivisionsX,H=this._subdivisionsY;for(let S=0;S<H;S++)for(let H=0;H<A;H++){U=3*H,O=S*(A+1)*3,d=(S+1)*(A+1)*3,M.x=C[O+U],M.y=C[O+U+1],M.z=C[O+U+2],x.x=C[O+U+3],x.y=C[O+U+4],x.z=C[O+U+5],T.x=C[d+U],T.y=C[d+U+1],T.z=C[d+U+2],z.x=C[d+U+3],z.y=C[d+U+4],z.z=C[d+U+5],D=(z.z-M.z)/(z.x-M.x),o=M.z-D*M.x,x.subtractToRef(M,s),T.subtractToRef(M,m),z.subtractToRef(M,Q),f.m.CrossToRef(Q,m,V),f.m.CrossToRef(s,Q,y),V.normalize(),y.normalize(),L=-(V.x*M.x+V.y*M.y+V.z*M.z),t=-(y.x*x.x+y.y*x.y+y.z*x.z);const j=this._heightQuads[S*A+H];j.slope.Hd(D,o),j.facet1.Hd(V.x,V.y,V.z,L),j.facet2.Hd(y.x,y.y,y.z,t)}return this}serialize(C){super.serialize(C),C.subdivisionsX=this._subdivisionsX,C.subdivisionsY=this._subdivisionsY,C.minX=this._minX,C.maxX=this._maxX,C.lj=this._minZ,C.maxZ=this._maxZ,C.width=this._width,C.height=this._height}static Parse(C,M){const x=new m(C.name,M);return x._subdivisionsX=C.subdivisionsX||1,x._subdivisionsY=C.subdivisionsY||1,x._minX=C.minX,x._maxX=C.maxX,x._minZ=C.lj,x._maxZ=C.maxZ,x._width=C.width,x._height=C.height,x}}var Q=x(1192),V=x(1008),y=x(986),U=x(1178);function O(C){const M=[],x=[],T=[],z=[];let S,m;const Q=C.width||C.size||1,V=C.height||C.size||1,y=0|(C.subdivisionsX||C.subdivisions||1),O=0|(C.subdivisionsY||C.subdivisions||1);for(S=0;S<=O;S++)for(m=0;m<=y;m++){const C=new f.m(m*Q/y-Q/2,0,(O-S)*V/O-V/2),M=new f.m(0,1,0);x.push(C.x,C.y,C.z),T.push(M.x,M.y,M.z),z.push(m/y,U.c?S/O:1-S/O)}for(S=0;S<O;S++)for(m=0;m<y;m++)M.push(m+1+(S+1)*(y+1)),M.push(m+1+S*(y+1)),M.push(m+S*(y+1)),M.push(m+(S+1)*(y+1)),M.push(m+1+(S+1)*(y+1)),M.push(m+S*(y+1));const d=new s.b;return d.indices=M,d.xa=x,d.ya=T,d.Aa=z,d}function d(C){const M=void 0!==C.xmin&&null!==C.xmin?C.xmin:-1,x=void 0!==C.zmin&&null!==C.zmin?C.zmin:-1,T=void 0!==C.xmax&&null!==C.xmax?C.xmax:1,z=void 0!==C.zmax&&null!==C.zmax?C.zmax:1,S=C.subdivisions||{w:1,h:1},m=C.precision||{w:1,h:1},Q=[],V=[],y=[],U=[];let O,d,D,o;S.h=S.h<1?1:S.h,S.w=S.w<1?1:S.w,m.w=m.w<1?1:m.w,m.h=m.h<1?1:m.h;const L=(T-M)/S.w,t=(z-x)/S.h;function A(C,M,x,T){const z=V.length/3,s=m.w+1;for(O=0;O<m.h;O++)for(d=0;d<m.w;d++){const C=[z+d+O*s,z+(d+1)+O*s,z+(d+1)+(O+1)*s,z+d+(O+1)*s];Q.push(C[1]),Q.push(C[2]),Q.push(C[3]),Q.push(C[0]),Q.push(C[1]),Q.push(C[3])}const S=f.m.Zero(),D=new f.m(0,1,0);for(O=0;O<=m.h;O++)for(S.z=O*(T-M)/m.h+M,d=0;d<=m.w;d++)S.x=d*(x-C)/m.w+C,S.y=0,V.push(S.x,S.y,S.z),y.push(D.x,D.y,D.z),U.push(d/m.w,O/m.h)}for(D=0;D<S.h;D++)for(o=0;o<S.w;o++)A(M+o*L,x+D*t,M+(o+1)*L,x+(D+1)*t);const H=new s.b;return H.indices=Q,H.xa=V,H.ya=y,H.Aa=U,H}function D(C){const M=[],x=[],z=[],S=[];let m,Q;const V=C.colorFilter||new T.d(.3,.59,.11),U=C.alphaFilter||0;let O=!1;if(C.minHeight>C.maxHeight){O=!0;const M=C.maxHeight;C.maxHeight=C.minHeight,C.minHeight=M}for(m=0;m<=C.subdivisions;m++)for(Q=0;Q<=C.subdivisions;Q++){const M=new f.m(Q*C.width/C.subdivisions-C.width/2,0,(C.subdivisions-m)*C.height/C.subdivisions-C.height/2),T=4*(((M.x+C.width/2)/C.width*(C.bufferWidth-1)|0)+((1-(M.z+C.height/2)/C.height)*(C.bufferHeight-1)|0)*C.bufferWidth);let s=C.buffer[T]/255,d=C.buffer[T+1]/255,D=C.buffer[T+2]/255;const o=C.buffer[T+3]/255;O&&(s=1-s,d=1-d,D=1-D);const L=s*V.r+d*V.g+D*V.b;M.y=o>=U?C.minHeight+(C.maxHeight-C.minHeight)*L:C.minHeight-y.c,C.heightBuffer&&(C.heightBuffer[m*(C.subdivisions+1)+Q]=M.y),x.push(M.x,M.y,M.z),z.push(0,0,0),S.push(Q/C.subdivisions,1-m/C.subdivisions)}for(m=0;m<C.subdivisions;m++)for(Q=0;Q<C.subdivisions;Q++){const f=Q+1+(m+1)*(C.subdivisions+1),T=Q+1+m*(C.subdivisions+1),z=Q+m*(C.subdivisions+1),s=Q+(m+1)*(C.subdivisions+1),S=x[3*f+1]>=C.minHeight,V=x[3*T+1]>=C.minHeight,y=x[3*z+1]>=C.minHeight;S&&V&&y&&(M.push(f),M.push(T),M.push(z));x[3*s+1]>=C.minHeight&&S&&y&&(M.push(s),M.push(f),M.push(z))}s.b.ComputeNormals(x,M,z);const d=new s.b;return d.indices=M,d.xa=x,d.ya=z,d.Aa=S,d}function o(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const x=new m(C,arguments.length>2?arguments[2]:void 0);x._setReady(!1),x._subdivisionsX=M.subdivisionsX||M.subdivisions||1,x._subdivisionsY=M.subdivisionsY||M.subdivisions||1,x._width=M.width||1,x._height=M.height||1,x._maxX=x._width/2,x._maxZ=x._height/2,x._minX=-x._maxX,x._minZ=-x._maxZ;return O(M).Ca(x,M.updatable),x._setReady(!0),x}function L(C,M){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const f=new z.d(C,x);return d(M).Ca(f,M.updatable),f}function t(C,M){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const z=x.width||10,s=x.height||10,S=x.subdivisions||1,y=x.minHeight||0,U=x.maxHeight||1,O=x.colorFilter||new T.d(.3,.59,.11),d=x.alphaFilter||0,o=x.updatable,L=x.onReady;f=f||V.c.LastCreatedScene;const t=new m(C,f);let A;t._subdivisionsX=S,t._subdivisionsY=S,t._width=z,t._height=s,t._maxX=t._width/2,t._maxZ=t._height/2,t._minX=-t._maxX,t._minZ=-t._maxZ,t._setReady(!1),x.passHeightBufferInCallback&&(A=new Float32Array((S+1)*(S+1)));const H=(C,M,x)=>{D({width:z,height:s,subdivisions:S,minHeight:y,maxHeight:U,colorFilter:O,buffer:C,bufferWidth:M,bufferHeight:x,alphaFilter:d,heightBuffer:A}).Ca(t,o),L&&L(t,A),t._setReady(!0)};if("string"===typeof M){const C=C=>{var M;const x=C.width,T=C.height;if(f.u)return;const z=null===(M=f)||void 0===M?void 0:M.getEngine().resizeImageBitmap(C,x,T);H(z,x,T)};Q.i.LoadImage(M,C,x.onError?x.onError:()=>{},f.offlineProvider)}else H(M.data,M.width,M.height);return t}s.b.CreateGround=O,s.b.CreateTiledGround=d,s.b.CreateGroundFromHeightMap=D,z.d.CreateGround=(C,M,x,f,T,z)=>o(C,{width:M,height:x,subdivisions:f,updatable:z},T),z.d.CreateTiledGround=(C,M,x,f,T,z,s,S,m)=>L(C,{xmin:M,zmin:x,xmax:f,zmax:T,subdivisions:z,precision:s,updatable:m},S),z.d.CreateGroundFromHeightMap=(C,M,x,f,T,z,s,S,m,Q,V)=>t(C,M,{width:x,height:f,subdivisions:T,minHeight:z,maxHeight:s,updatable:m,onReady:Q,alphaFilter:V},S)},12717:(C,M,x)=>{"use strict";x.d(M,{e:()=>F,h:()=>g,k:()=>B});var f=x(978),T=x(11712),z=x(11739),s=x(1162),S=x(1224),m=x(12357),Q=x(1289),V=x(1145),y=x(1190),U=x(945),O=x(997),d=x(1358),D=x(1042),o=x(1350),L=x(1008),t=x(1335),A=x(1329);const H={effect:null,subMesh:null};class j extends o.e{constructor(C,M,x){let T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(C,M,!(arguments.length>4&&void 0!==arguments[4])||arguments[4]),this._textures={},this._textureArrays={},this._externalTextures={},this._floats={},this._ints={},this._uints={},this._floatsArrays={},this._colors3={},this._colors3Arrays={},this._colors4={},this._colors4Arrays={},this._vectors2={},this._vectors3={},this._vectors4={},this._quaternions={},this._quaternionsArrays={},this._matrices={},this._matrixArrays={},this._matrices3x3={},this._matrices2x2={},this._vectors2Arrays={},this._vectors3Arrays={},this._vectors4Arrays={},this._uniformBuffers={},this._textureSamplers={},this._storageBuffers={},this._cachedWorldViewMatrix=new f.d,this._cachedWorldViewProjectionMatrix=new f.d,this._multiview=!1,this._materialHelperNeedsPreviousMatrices=!1,this._shaderPath=x,this._options={needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","Nd","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],externalTextures:[],samplerObjects:[],storageBuffers:[],defines:[],useClipPlane:!1,...T}}get shaderPath(){return this._shaderPath}set shaderPath(C){this._shaderPath=C}get options(){return this._options}get isMultiview(){return this._multiview}getClassName(){return"ShaderMaterial"}needAlphaBlending(){return this.alpha<1||this._options.needAlphaBlending}needAlphaTesting(){return this._options.needAlphaTesting}_checkUniform(C){-1===this._options.uniforms.indexOf(C)&&this._options.uniforms.push(C)}setTexture(C,M){return-1===this._options.samplers.indexOf(C)&&this._options.samplers.push(C),this._textures[C]=M,this}removeTexture(C){delete this._textures[C]}setTextureArray(C,M){return-1===this._options.samplers.indexOf(C)&&this._options.samplers.push(C),this._checkUniform(C),this._textureArrays[C]=M,this}setExternalTexture(C,M){return-1===this._options.externalTextures.indexOf(C)&&this._options.externalTextures.push(C),this._externalTextures[C]=M,this}setFloat(C,M){return this._checkUniform(C),this._floats[C]=M,this}setInt(C,M){return this._checkUniform(C),this._ints[C]=M,this}setUInt(C,M){return this._checkUniform(C),this._uints[C]=M,this}setFloats(C,M){return this._checkUniform(C),this._floatsArrays[C]=M,this}setColor3(C,M){return this._checkUniform(C),this._colors3[C]=M,this}setColor3Array(C,M){return this._checkUniform(C),this._colors3Arrays[C]=M.reduce(((C,M)=>(M.toArray(C,C.length),C)),[]),this}setColor4(C,M){return this._checkUniform(C),this._colors4[C]=M,this}setColor4Array(C,M){return this._checkUniform(C),this._colors4Arrays[C]=M.reduce(((C,M)=>(M.toArray(C,C.length),C)),[]),this}setVector2(C,M){return this._checkUniform(C),this._vectors2[C]=M,this}setVector3(C,M){return this._checkUniform(C),this._vectors3[C]=M,this}setVector4(C,M){return this._checkUniform(C),this._vectors4[C]=M,this}setQuaternion(C,M){return this._checkUniform(C),this._quaternions[C]=M,this}setQuaternionArray(C,M){return this._checkUniform(C),this._quaternionsArrays[C]=M.reduce(((C,M)=>(M.toArray(C,C.length),C)),[]),this}setMatrix(C,M){return this._checkUniform(C),this._matrices[C]=M,this}setMatrices(C,M){this._checkUniform(C);const x=new Float32Array(16*M.length);for(let f=0;f<M.length;f++){M[f].copyToArray(x,16*f)}return this._matrixArrays[C]=x,this}setMatrix3x3(C,M){return this._checkUniform(C),this._matrices3x3[C]=M,this}setMatrix2x2(C,M){return this._checkUniform(C),this._matrices2x2[C]=M,this}setArray2(C,M){return this._checkUniform(C),this._vectors2Arrays[C]=M,this}setArray3(C,M){return this._checkUniform(C),this._vectors3Arrays[C]=M,this}setArray4(C,M){return this._checkUniform(C),this._vectors4Arrays[C]=M,this}setUniformBuffer(C,M){return-1===this._options.uniformBuffers.indexOf(C)&&this._options.uniformBuffers.push(C),this._uniformBuffers[C]=M,this}setTextureSampler(C,M){return-1===this._options.samplerObjects.indexOf(C)&&this._options.samplerObjects.push(C),this._textureSamplers[C]=M,this}setStorageBuffer(C,M){return-1===this._options.storageBuffers.indexOf(C)&&this._options.storageBuffers.push(C),this._storageBuffers[C]=M,this}setDefine(C,M){const x=C.trimEnd()+" ",f=this.options.defines.findIndex((M=>M===C||M.startsWith(x)));return f>=0&&this.options.defines.splice(f,1),("boolean"!==typeof M||M)&&this.options.defines.push(x+M),this}isReadyForSubMesh(C,M,x){return this.isReady(C,x,M)}isReady(C,M,x){var f;const T=x&&this._storeEffectOnSubMeshes;if(this.isFrozen){const C=T?x._drawWrapper:this._drawWrapper;if(C.effect&&C._wasPreviouslyReady&&C._wasPreviouslyUsingInstances===M)return!0}const z=this.va(),s=z.getEngine(),m=[],Q=[],V=new d.e;let U=this._shaderPath,O=this._options.uniforms,D=this._options.uniformBuffers,o=this._options.samplers;s.getCaps().multiview&&z.activeCamera&&z.activeCamera.outputRenderTarget&&z.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,m.push("#define MULTIVIEW"),-1!==O.indexOf("viewProjection")&&-1===O.indexOf("viewProjectionR")&&O.push("viewProjectionR"));for(let S=0;S<this._options.defines.length;S++){const C=0===this._options.defines[S].indexOf("#define")?this._options.defines[S]:`#define ${this._options.defines[S]}`;m.push(C)}for(let S=0;S<this._options.attributes.length;S++)Q.push(this._options.attributes[S]);if(C&&C.isVerticesDataPresent(S.h.ColorKind)&&(-1===Q.indexOf(S.h.ColorKind)&&Q.push(S.h.ColorKind),m.push("#define VERTEXCOLOR")),M&&(m.push("#define INSTANCES"),(0,A.P)(Q,this._materialHelperNeedsPreviousMatrices),null!==C&&void 0!==C&&C.hasThinInstances&&(m.push("#define THIN_INSTANCES"),C&&C.isVerticesDataPresent(S.h.ColorInstanceKind)&&(Q.push(S.h.ColorInstanceKind),m.push("#define INSTANCESCOLOR")))),C&&C.useBones&&C.computeBonesUsingShaders&&C.skeleton){Q.push(S.h.MatricesIndicesKind),Q.push(S.h.MatricesWeightsKind),C.numBoneInfluencers>4&&(Q.push(S.h.MatricesIndicesExtraKind),Q.push(S.h.MatricesWeightsExtraKind));const M=C.skeleton;m.push("#define NUM_BONE_INFLUENCERS "+C.numBoneInfluencers),V.addCPUSkinningFallback(0,C),M.isUsingTextureForMatrices?(m.push("#define BONETEXTURE"),-1===O.indexOf("boneTextureWidth")&&O.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(m.push("#define BonesPerMesh "+(M.bones.length+1)),-1===O.indexOf("mBones")&&O.push("mBones"))}else m.push("#define NUM_BONE_INFLUENCERS 0");let L=0;const j=C?C.morphTargetManager:null;if(j){const C=j.supportsUVs&&-1!==m.indexOf("#define UV1"),M=j.supportsTangents&&-1!==m.indexOf("#define TANGENT"),x=j.supportsNormals&&-1!==m.indexOf("#define NORMAL");L=j.numMaxInfluencers||j.numInfluencers,C&&m.push("#define MORPHTARGETS_UV"),M&&m.push("#define MORPHTARGETS_TANGENT"),x&&m.push("#define MORPHTARGETS_NORMAL"),L>0&&m.push("#define MORPHTARGETS"),j.isUsingTextureForTargets&&(m.push("#define MORPHTARGETS_TEXTURE"),-1===O.indexOf("morphTargetTextureIndices")&&O.push("morphTargetTextureIndices"),-1===this._options.samplers.indexOf("morphTargets")&&this._options.samplers.push("morphTargets")),m.push("#define NUM_MORPH_INFLUENCERS "+L);for(let f=0;f<L;f++)Q.push(S.h.PositionKind+f),x&&Q.push(S.h.NormalKind+f),M&&Q.push(S.h.TangentKind+f),C&&Q.push(S.h.UVKind+"_"+f);L>0&&(O=O.slice(),O.push("morphTargetInfluences"),O.push("morphTargetCount"),O.push("morphTargetTextureInfo"),O.push("morphTargetTextureIndices"))}else m.push("#define NUM_MORPH_INFLUENCERS 0");if(C){const M=C.bakedVertexAnimationManager;M&&M.isEnabled&&(m.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),-1===O.indexOf("bakedVertexAnimationSettings")&&O.push("bakedVertexAnimationSettings"),-1===O.indexOf("bakedVertexAnimationTextureSizeInverted")&&O.push("bakedVertexAnimationTextureSizeInverted"),-1===O.indexOf("bakedVertexAnimationTime")&&O.push("bakedVertexAnimationTime"),-1===this._options.samplers.indexOf("bakedVertexAnimationTexture")&&this._options.samplers.push("bakedVertexAnimationTexture")),(0,A.u)(Q,C,m)}for(const S in this._textures)if(!this._textures[S].isReady())return!1;C&&this._shouldTurnAlphaTestOn(C)&&m.push("#define ALPHATEST"),!1!==this._options.useClipPlane&&((0,t.b)(O),(0,t.k)(this,z,m)),z.fogEnabled&&null!==C&&void 0!==C&&C.applyFog&&z.fogMode!==y.e.FOGMODE_NONE&&(m.push("#define FOG"),-1===O.indexOf("view")&&O.push("view"),-1===O.indexOf("vFogInfos")&&O.push("vFogInfos"),-1===O.indexOf("vFogColor")&&O.push("vFogColor")),this._useLogarithmicDepth&&(m.push("#define LOGARITHMICDEPTH"),-1===O.indexOf("logarithmicDepthConstant")&&O.push("logarithmicDepthConstant")),this.customShaderNameResolve&&(O=O.slice(),D=D.slice(),o=o.slice(),U=this.customShaderNameResolve(this.name,O,D,o,m,Q));const b=T?x._getDrawWrapper(void 0,!0):this._drawWrapper,R=(null===b||void 0===b?void 0:b.effect)??null,n=(null===b||void 0===b?void 0:b.defines)??null,I=m.join("\n");let X=R;return n!==I&&(X=s.createEffect(U,{attributes:Q,uniformsNames:O,uniformBuffersNames:D,samplers:o,defines:I,fallbacks:V,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousMorphTargets:L},shaderLanguage:this._options.shaderLanguage,extraInitializationsAsync:this._options.extraInitializationsAsync},s),T?x.setEffect(X,I,this._materialContext):b&&b.setEffect(X,I),this._onEffectCreatedObservable&&(H.effect=X,H.subMesh=x??(null===C||void 0===C?void 0:C.we[0])??null,this._onEffectCreatedObservable.notifyObservers(H))),b._wasPreviouslyUsingInstances=!!M,!((null===(f=X)||void 0===f||!f.isReady())??1)&&(R!==X&&z.resetCachedMaterial(),b._wasPreviouslyReady=!0,!0)}bindOnlyWorldMatrix(C,M){const x=this.va(),f=M??this.getEffect();f&&(-1!==this._options.uniforms.indexOf("world")&&f.setMatrix("world",C),-1!==this._options.uniforms.indexOf("worldView")&&(C.multiplyToRef(x.getViewMatrix(),this._cachedWorldViewMatrix),f.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==this._options.uniforms.indexOf("worldViewProjection")&&(C.multiplyToRef(x.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),f.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)),-1!==this._options.uniforms.indexOf("view")&&f.setMatrix("view",x.getViewMatrix()))}bindForSubMesh(C,M,x){var f;this.bind(C,M,null===(f=x._drawWrapperOverride)||void 0===f?void 0:f.effect,x)}bind(C,M,x,f){const T=f&&this._storeEffectOnSubMeshes,z=x??(T?f.effect:this.getEffect());if(!z)return;const s=this.va();this._activeEffect=z,this.bindOnlyWorldMatrix(C,x);const S=this._options.uniformBuffers;let m=!1;if(z&&S&&S.length>0&&s.getEngine().supportsUniformBuffers)for(let y=0;y<S.length;++y){switch(S[y]){case"Mesh":M&&(M.getMeshUniformBuffer().bindToEffect(z,"Mesh"),M.transferToEffect(C));break;case"Scene":(0,A.o)(z,s.getSceneUniformBuffer()),s.finalizeSceneUbo(),m=!0}}const Q=M&&T?this._mustRebind(s,z,f,M.visibility):s.getCachedMaterial()!==this;if(z&&Q){let C;for(C in m||-1===this._options.uniforms.indexOf("view")||z.setMatrix("view",s.getViewMatrix()),m||-1===this._options.uniforms.indexOf("projection")||z.setMatrix("projection",s.getProjectionMatrix()),m||-1===this._options.uniforms.indexOf("viewProjection")||(z.setMatrix("viewProjection",s.getTransformMatrix()),this._multiview&&z.setMatrix("viewProjectionR",s._transformMatrixR)),s.activeCamera&&-1!==this._options.uniforms.indexOf("cameraPosition")&&z.setVector3("cameraPosition",s.activeCamera.globalPosition),(0,A.b)(M,z),(0,t.f)(z,this,s),this._useLogarithmicDepth&&(0,A.j)(T?f.materialDefines:z.defines,z,s),M&&(0,A.f)(s,M,z),this._textures)z.setTexture(C,this._textures[C]);for(C in this._textureArrays)z.setTextureArray(C,this._textureArrays[C]);for(C in this._ints)z.setInt(C,this._ints[C]);for(C in this._uints)z.setUInt(C,this._uints[C]);for(C in this._floats)z.setFloat(C,this._floats[C]);for(C in this._floatsArrays)z.setArray(C,this._floatsArrays[C]);for(C in this._colors3)z.setColor3(C,this._colors3[C]);for(C in this._colors3Arrays)z.setArray3(C,this._colors3Arrays[C]);for(C in this._colors4){const M=this._colors4[C];z.setFloat4(C,M.r,M.g,M.b,M.a)}for(C in this._colors4Arrays)z.setArray4(C,this._colors4Arrays[C]);for(C in this._vectors2)z.setVector2(C,this._vectors2[C]);for(C in this._vectors3)z.setVector3(C,this._vectors3[C]);for(C in this._vectors4)z.setVector4(C,this._vectors4[C]);for(C in this._quaternions)z.setQuaternion(C,this._quaternions[C]);for(C in this._matrices)z.setMatrix(C,this._matrices[C]);for(C in this._matrixArrays)z.setMatrices(C,this._matrixArrays[C]);for(C in this._matrices3x3)z.setMatrix3x3(C,this._matrices3x3[C]);for(C in this._matrices2x2)z.setMatrix2x2(C,this._matrices2x2[C]);for(C in this._vectors2Arrays)z.setArray2(C,this._vectors2Arrays[C]);for(C in this._vectors3Arrays)z.setArray3(C,this._vectors3Arrays[C]);for(C in this._vectors4Arrays)z.setArray4(C,this._vectors4Arrays[C]);for(C in this._quaternionsArrays)z.setArray4(C,this._quaternionsArrays[C]);for(C in this._uniformBuffers){const M=this._uniformBuffers[C].getBuffer();M&&z.bindUniformBuffer(M,C)}const x=s.getEngine(),S=x.setExternalTexture;if(S)for(C in this._externalTextures)S.call(x,C,this._externalTextures[C]);const Q=x.setTextureSampler;if(Q)for(C in this._textureSamplers)Q.call(x,C,this._textureSamplers[C]);const V=x.setStorageBuffer;if(V)for(C in this._storageBuffers)V.call(x,C,this._storageBuffers[C])}if(z&&M&&(Q||!this.isFrozen)){const C=M.morphTargetManager;C&&C.numInfluencers>0&&(0,A.n)(M,z);const x=M.bakedVertexAnimationManager;if(x&&x.isEnabled){var V;const C=T?f._drawWrapper:this._drawWrapper;null===(V=M.bakedVertexAnimationManager)||void 0===V||V.bind(z,!!C._wasPreviouslyUsingInstances)}}this._afterBind(M,z,f)}getActiveTextures(){const C=super.getActiveTextures();for(const M in this._textures)C.push(this._textures[M]);for(const M in this._textureArrays){const x=this._textureArrays[M];for(let M=0;M<x.length;M++)C.push(x[M])}return C}hasTexture(C){if(super.hasTexture(C))return!0;for(const M in this._textures)if(this._textures[M]===C)return!0;for(const M in this._textureArrays){const x=this._textureArrays[M];for(let M=0;M<x.length;M++)if(x[M]===C)return!0}return!1}clone(C){const M=V.e.Clone((()=>new j(C,this.va(),this._shaderPath,this._options,this._storeEffectOnSubMeshes)),this);M.name=C,M.id=C,"object"===typeof M._shaderPath&&(M._shaderPath={...M._shaderPath}),this._options={...this._options},Object.keys(this._options).forEach((C=>{const M=this._options[C];Array.isArray(M)&&(this._options[C]=M.slice(0))})),this.stencil.copyTo(M.stencil);for(const x in this._textures)M.setTexture(x,this._textures[x]);for(const x in this._textureArrays)M.setTextureArray(x,this._textureArrays[x]);for(const x in this._externalTextures)M.setExternalTexture(x,this._externalTextures[x]);for(const x in this._ints)M.setInt(x,this._ints[x]);for(const x in this._uints)M.setUInt(x,this._uints[x]);for(const x in this._floats)M.setFloat(x,this._floats[x]);for(const x in this._floatsArrays)M.setFloats(x,this._floatsArrays[x]);for(const x in this._colors3)M.setColor3(x,this._colors3[x]);for(const x in this._colors3Arrays)M._colors3Arrays[x]=this._colors3Arrays[x];for(const x in this._colors4)M.setColor4(x,this._colors4[x]);for(const x in this._colors4Arrays)M._colors4Arrays[x]=this._colors4Arrays[x];for(const x in this._vectors2)M.setVector2(x,this._vectors2[x]);for(const x in this._vectors3)M.setVector3(x,this._vectors3[x]);for(const x in this._vectors4)M.setVector4(x,this._vectors4[x]);for(const x in this._quaternions)M.setQuaternion(x,this._quaternions[x]);for(const x in this._quaternionsArrays)M._quaternionsArrays[x]=this._quaternionsArrays[x];for(const x in this._matrices)M.setMatrix(x,this._matrices[x]);for(const x in this._matrixArrays)M._matrixArrays[x]=this._matrixArrays[x].slice();for(const x in this._matrices3x3)M.setMatrix3x3(x,this._matrices3x3[x]);for(const x in this._matrices2x2)M.setMatrix2x2(x,this._matrices2x2[x]);for(const x in this._vectors2Arrays)M.setArray2(x,this._vectors2Arrays[x]);for(const x in this._vectors3Arrays)M.setArray3(x,this._vectors3Arrays[x]);for(const x in this._vectors4Arrays)M.setArray4(x,this._vectors4Arrays[x]);for(const x in this._uniformBuffers)M.setUniformBuffer(x,this._uniformBuffers[x]);for(const x in this._textureSamplers)M.setTextureSampler(x,this._textureSamplers[x]);for(const x in this._storageBuffers)M.setStorageBuffer(x,this._storageBuffers[x]);return M}dispose(C,M,x){if(M){let C;for(C in this._textures)this._textures[C].dispose();for(C in this._textureArrays){const M=this._textureArrays[C];for(let C=0;C<M.length;C++)M[C].dispose()}}this._textures={},super.dispose(C,M,x)}serialize(){const C=V.e.Serialize(this);let M;for(M in C.customType="BABYLON.ShaderMaterial",C.uniqueId=this.uniqueId,C.options=this._options,C.shaderPath=this._shaderPath,C.storeEffectOnSubMeshes=this._storeEffectOnSubMeshes,C.stencil=this.stencil.serialize(),C.textures={},this._textures)C.textures[M]=this._textures[M].serialize();for(M in C.textureArrays={},this._textureArrays){C.textureArrays[M]=[];const x=this._textureArrays[M];for(let f=0;f<x.length;f++)C.textureArrays[M].push(x[f].serialize())}for(M in C.ints={},this._ints)C.ints[M]=this._ints[M];for(M in C.uints={},this._uints)C.uints[M]=this._uints[M];for(M in C.floats={},this._floats)C.floats[M]=this._floats[M];for(M in C.floatsArrays={},this._floatsArrays)C.floatsArrays[M]=this._floatsArrays[M];for(M in C.colors3={},this._colors3)C.colors3[M]=this._colors3[M].Gd();for(M in C.colors3Arrays={},this._colors3Arrays)C.colors3Arrays[M]=this._colors3Arrays[M];for(M in C.colors4={},this._colors4)C.colors4[M]=this._colors4[M].Gd();for(M in C.colors4Arrays={},this._colors4Arrays)C.colors4Arrays[M]=this._colors4Arrays[M];for(M in C.vectors2={},this._vectors2)C.vectors2[M]=this._vectors2[M].Gd();for(M in C.vectors3={},this._vectors3)C.vectors3[M]=this._vectors3[M].Gd();for(M in C.vectors4={},this._vectors4)C.vectors4[M]=this._vectors4[M].Gd();for(M in C.quaternions={},this._quaternions)C.quaternions[M]=this._quaternions[M].Gd();for(M in C.matrices={},this._matrices)C.matrices[M]=this._matrices[M].Gd();for(M in C.matrixArray={},this._matrixArrays)C.matrixArray[M]=this._matrixArrays[M];for(M in C.matrices3x3={},this._matrices3x3)C.matrices3x3[M]=this._matrices3x3[M];for(M in C.matrices2x2={},this._matrices2x2)C.matrices2x2[M]=this._matrices2x2[M];for(M in C.vectors2Arrays={},this._vectors2Arrays)C.vectors2Arrays[M]=this._vectors2Arrays[M];for(M in C.vectors3Arrays={},this._vectors3Arrays)C.vectors3Arrays[M]=this._vectors3Arrays[M];for(M in C.vectors4Arrays={},this._vectors4Arrays)C.vectors4Arrays[M]=this._vectors4Arrays[M];for(M in C.quaternionsArrays={},this._quaternionsArrays)C.quaternionsArrays[M]=this._quaternionsArrays[M];return C}static Parse(C,M,x){const T=V.e.Parse((()=>new j(C.name,M,C.shaderPath,C.options,C.storeEffectOnSubMeshes)),C,M,x);let z;for(z in C.stencil&&T.stencil.parse(C.stencil,M,x),C.textures)T.setTexture(z,U.b.Parse(C.textures[z],M,x));for(z in C.textureArrays){const f=C.textureArrays[z],s=[];for(let C=0;C<f.length;C++)s.push(U.b.Parse(f[C],M,x));T.setTextureArray(z,s)}for(z in C.ints)T.setInt(z,C.ints[z]);for(z in C.uints)T.setUInt(z,C.uints[z]);for(z in C.floats)T.setFloat(z,C.floats[z]);for(z in C.floatsArrays)T.setFloats(z,C.floatsArrays[z]);for(z in C.colors3)T.setColor3(z,s.d.Dd(C.colors3[z]));for(z in C.colors3Arrays){const M=C.colors3Arrays[z].reduce(((C,M,x)=>(x%3===0?C.push([M]):C[C.length-1].push(M),C)),[]).map((C=>s.d.Dd(C)));T.setColor3Array(z,M)}for(z in C.colors4)T.setColor4(z,s.e.Dd(C.colors4[z]));for(z in C.colors4Arrays){const M=C.colors4Arrays[z].reduce(((C,M,x)=>(x%4===0?C.push([M]):C[C.length-1].push(M),C)),[]).map((C=>s.e.Dd(C)));T.setColor4Array(z,M)}for(z in C.vectors2)T.setVector2(z,f.j.Dd(C.vectors2[z]));for(z in C.vectors3)T.setVector3(z,f.m.Dd(C.vectors3[z]));for(z in C.vectors4)T.setVector4(z,f.q.Dd(C.vectors4[z]));for(z in C.quaternions)T.setQuaternion(z,f.h.Dd(C.quaternions[z]));for(z in C.matrices)T.setMatrix(z,f.d.Dd(C.matrices[z]));for(z in C.matrixArray)T._matrixArrays[z]=new Float32Array(C.matrixArray[z]);for(z in C.matrices3x3)T.setMatrix3x3(z,C.matrices3x3[z]);for(z in C.matrices2x2)T.setMatrix2x2(z,C.matrices2x2[z]);for(z in C.vectors2Arrays)T.setArray2(z,C.vectors2Arrays[z]);for(z in C.vectors3Arrays)T.setArray3(z,C.vectors3Arrays[z]);for(z in C.vectors4Arrays)T.setArray4(z,C.vectors4Arrays[z]);for(z in C.quaternionsArrays)T.setArray4(z,C.quaternionsArrays[z]);return T}static ParseFromFileAsync(C,M,x){let f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return new Promise(((T,z)=>{const s=new D.d;s.addEventListener("readystatechange",(()=>{if(4==s.readyState)if(200==s.status){const M=JSON.parse(s.responseText),z=this.Parse(M,x||L.c.LastCreatedScene,f);C&&(z.name=C),T(z)}else z("Unable to load the ShaderMaterial")})),s.open("GET",M),s.send()}))}static ParseFromSnippetAsync(C,M){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Promise(((f,T)=>{const z=new D.d;z.addEventListener("readystatechange",(()=>{if(4==z.readyState)if(200==z.status){const T=JSON.parse(JSON.parse(z.responseText).jsonPayload),s=JSON.parse(T.shaderMaterial),S=this.Parse(s,M||L.c.LastCreatedScene,x);S.snippetId=C,f(S)}else T("Unable to load the snippet "+C)})),z.open("GET",this.SnippetUrl+"/"+C.replace(/#/g,"/")),z.send()}))}}j.SnippetUrl="https://snippet.babylonjs.com",j.CreateFromSnippetAsync=j.ParseFromSnippetAsync,(0,O.f)("BABYLON.ShaderMaterial",j),T.d._LinesMeshParser=(C,M)=>b.Parse(C,M);class b extends T.d{_isShaderMaterial(C){return"ShaderMaterial"===C.getClassName()}constructor(C){let M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,f=arguments.length>5?arguments[5]:void 0,T=arguments.length>6?arguments[6]:void 0,z=arguments.length>7?arguments[7]:void 0;super(C,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,M,arguments.length>4?arguments[4]:void 0),this.useVertexColor=f,this.useVertexAlpha=T,this.color=new s.d(1,1,1),this.alpha=1,this._shaderLanguage=0,M&&(this.color=M.color.clone(),this.alpha=M.alpha,this.useVertexColor=M.useVertexColor,this.useVertexAlpha=M.useVertexAlpha),this.intersectionThreshold=.1;const m={attributes:[S.h.PositionKind],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:[],useClipPlane:null,shaderLanguage:0};if(!1===T?m.needAlphaBlending=!1:m.defines.push("#define VERTEXALPHA"),f?(m.defines.push("#define VERTEXCOLOR"),m.attributes.push(S.h.ColorKind)):(m.uniforms.push("color"),this._color4=new s.e),z)this.material=z;else{this.va().getEngine().isWebGPU&&!b.ForceGLSL&&(this._shaderLanguage=1),m.shaderLanguage=this._shaderLanguage,m.extraInitializationsAsync=async()=>{1===this._shaderLanguage?await Promise.all([x.e(19).then(x.bind(x,13064)),x.e(48).then(x.bind(x,13070))]):await Promise.all([x.e(26).then(x.bind(x,13079)),x.e(49).then(x.bind(x,13081))])},this.material=new j("colorShader",this.va(),"color",m,!1),this.material.doNotSerialize=!0}}isReady(){return!!this._lineMaterial.isReady(this,!!this._userInstancedBuffersStorage||this.hasThinInstances)&&super.isReady()}getClassName(){return"LinesMesh"}get material(){return this._lineMaterial}set material(C){this._lineMaterial=C,this._lineMaterial.fillMode=Q.c.LineListDrawMode}get checkCollisions(){return!1}set checkCollisions(C){}_bind(C,M){if(!this._geometry)return this;const x=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(!this._userInstancedBuffersStorage||this.hasThinInstances?this._geometry._bind(M,x):this._geometry._bind(M,x,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects),!this.useVertexColor&&this._isShaderMaterial(this._lineMaterial)){const{r:C,g:M,b:x}=this.color;this._color4.set(C,M,x,this.alpha),this._lineMaterial.setColor4("color",this._color4)}return this}_draw(C,M,x){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const f=this.va().getEngine();return this._unIndexed?f.drawArraysType(Q.c.LineListDrawMode,C.verticesStart,C.verticesCount,x):f.drawElementsType(Q.c.LineListDrawMode,C.indexStart,C.indexCount,x),this}dispose(C){(arguments.length>2?arguments[2]:void 0)||this._lineMaterial.dispose(!1,!1,!0),super.dispose(C)}clone(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,x=arguments.length>2?arguments[2]:void 0;return new b(C,this.va(),M,this,x)}Bb(C){const M=new R(C,this);if(this.instancedBuffers){M.instancedBuffers={};for(const C in this.instancedBuffers)M.instancedBuffers[C]=this.instancedBuffers[C]}return M}serialize(C){super.serialize(C),C.color=this.color.Gd(),C.alpha=this.alpha}static Parse(C,M){const x=new b(C.name,M);return x.color=s.d.Dd(C.color),x.alpha=C.alpha,x}}b.ForceGLSL=!1;class R extends m.d{constructor(C,M){super(C,M),this.intersectionThreshold=M.intersectionThreshold}getClassName(){return"InstancedLinesMesh"}}var n=x(1078);function I(C){const M=[],x=[],f=C.lines,T=C.za,s=[];let S=0;for(let z=0;z<f.length;z++){const C=f[z];for(let f=0;f<C.length;f++){const{x:m,y:Q,z:V}=C[f];if(x.push(m,Q,V),T){const C=T[z],{r:M,g:x,b:S,a:m}=C[f];s.push(M,x,S,m)}f>0&&(M.push(S-1),M.push(S)),S++}}const m=new z.b;return m.indices=M,m.xa=x,T&&(m.za=s),m}function X(C){const M=C.dashSize||3,x=C.gapSize||1,T=C.dashNb||200,s=C.points,S=[],m=[],Q=f.m.Zero();let V=0,y=0,U=0,O=0,d=0,D=0,o=0;for(o=0;o<s.length-1;o++)s[o+1].subtractToRef(s[o],Q),V+=Q.length();for(U=V/T,O=M*U/(M+x),o=0;o<s.length-1;o++){s[o+1].subtractToRef(s[o],Q),y=Math.floor(Q.length()/U),Q.normalize();for(let C=0;C<y;C++)d=U*C,S.push(s[o].x+d*Q.x,s[o].y+d*Q.y,s[o].z+d*Q.z),S.push(s[o].x+(d+O)*Q.x,s[o].y+(d+O)*Q.y,s[o].z+(d+O)*Q.z),m.push(D,D+1),D+=2}const L=new z.b;return L.xa=S,L.indices=m,L}function g(C,M){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const f=M.instance,T=M.lines,z=M.za;if(f){const C=f.getVerticesData(S.h.PositionKind);let M,x;z&&(M=f.getVerticesData(S.h.ColorKind));let s=0,m=0;for(let f=0;f<T.length;f++){const S=T[f];for(let T=0;T<S.length;T++)C[s]=S[T].x,C[s+1]=S[T].y,C[s+2]=S[T].z,z&&M&&(x=z[f],M[m]=x[T].r,M[m+1]=x[T].g,M[m+2]=x[T].b,M[m+3]=x[T].a,m+=4),s+=3}return f.updateVerticesData(S.h.PositionKind,C,!1,!1),z&&M&&f.updateVerticesData(S.h.ColorKind,M,!1,!1),f.refreshBoundingInfo(),f}const s=new b(C,x,null,void 0,void 0,!!z,M.useVertexAlpha,M.material);return I(M).Ca(s,M.updatable),s}function B(C,M){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const f=M.za?[M.za]:null;return g(C,{lines:[M.points],updatable:M.updatable,instance:M.instance,za:f,useVertexAlpha:M.useVertexAlpha,material:M.material},x)}function F(C,M){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=M.points,s=M.instance,S=M.gapSize||1,m=M.dashSize||3;if(s){const C=C=>{const M=f.m.Zero(),x=C.length/6;let T=0,S=0,m=0,Q=0,V=0,y=0,U=0,O=0;for(U=0;U<z.length-1;U++)z[U+1].subtractToRef(z[U],M),T+=M.length();m=T/x;const d=s._creationDataStorage.dashSize;for(Q=d*m/(d+s._creationDataStorage.gapSize),U=0;U<z.length-1;U++)for(z[U+1].subtractToRef(z[U],M),S=Math.floor(M.length()/m),M.normalize(),O=0;O<S&&y<C.length;)V=m*O,C[y]=z[U].x+V*M.x,C[y+1]=z[U].y+V*M.y,C[y+2]=z[U].z+V*M.z,C[y+3]=z[U].x+(V+Q)*M.x,C[y+4]=z[U].y+(V+Q)*M.y,C[y+5]=z[U].z+(V+Q)*M.z,y+=6,O++;for(;y<C.length;)C[y]=z[U].x,C[y+1]=z[U].y,C[y+2]=z[U].z,y+=3};return(M.dashNb||M.dashSize||M.gapSize||M.useVertexAlpha||M.material)&&n.e.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),s.updateMeshPositions(C,!1),s}const Q=new b(C,x,null,void 0,void 0,void 0,M.useVertexAlpha,M.material);return X(M).Ca(Q,M.updatable),Q._creationDataStorage=new T.h,Q._creationDataStorage.dashSize=m,Q._creationDataStorage.gapSize=S,Q}z.b.CreateLineSystem=I,z.b.CreateDashedLines=X,T.d.mb=function(C,M){return B(C,{points:M,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},T.d.CreateDashedLines=function(C,M,x,f,T){return F(C,{points:M,dashSize:x,gapSize:f,dashNb:T,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},11821:(C,M,x)=>{"use strict";x.d(M,{d:()=>S,e:()=>m});var f=x(11712),T=x(11739),z=x(1178);function s(C){const M=[],x=[],f=[],s=[],S=C.width||C.size||1,m=C.height||C.size||1,Q=0===C.sideOrientation?0:C.sideOrientation||T.b.DEFAULTSIDE,V=S/2,y=m/2;x.push(-V,-y,0),f.push(0,0,-1),s.push(0,z.c?1:0),x.push(V,-y,0),f.push(0,0,-1),s.push(1,z.c?1:0),x.push(V,y,0),f.push(0,0,-1),s.push(1,z.c?0:1),x.push(-V,y,0),f.push(0,0,-1),s.push(0,z.c?0:1),M.push(0),M.push(1),M.push(2),M.push(0),M.push(2),M.push(3),T.b._ComputeSides(Q,x,M,f,s,C.frontUVs,C.backUVs);const U=new T.b;return U.indices=M,U.xa=x,U.ya=f,U.Aa=s,U}function S(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const T=new f.d(C,x);M.sideOrientation=f.d._GetDefaultSideOrientation(M.sideOrientation),T._originalBuilderSideOrientation=M.sideOrientation;return s(M).Ca(T,M.updatable),M.sourcePlane&&(T.translate(M.sourcePlane.Nd,-M.sourcePlane.d),T.setDirection(M.sourcePlane.Nd.scale(-1))),T}const m={Pg:S};T.b.Pg=s,f.d.Pg=(C,M,x,f,T)=>S(C,{size:M,width:M,height:M,sideOrientation:T,updatable:f},x)},11873:(C,M,x)=>{"use strict";x.d(M,{d:()=>m});var f=x(978),T=x(11712),z=x(11739),s=x(1178);function S(C){const M=0|(C.segments||32),x=C.diameterX||C.diameter||1,T=C.diameterY||C.diameter||1,S=C.diameterZ||C.diameter||1,m=C.arc&&(C.arc<=0||C.arc>1)?1:C.arc||1,Q=C.slice&&C.slice<=0?1:C.slice||1,V=0===C.sideOrientation?0:C.sideOrientation||z.b.DEFAULTSIDE,y=!!C.dedupTopBottomIndices,U=new f.m(x/2,T/2,S/2),O=2+M,d=2*O,D=[],o=[],L=[],t=[];for(let z=0;z<=O;z++){const C=z/O,M=C*Math.PI*Q;for(let x=0;x<=d;x++){const T=x/d,z=T*Math.PI*2*m,S=f.d.RotationZ(-M),Q=f.d.RotationY(z),V=f.m.TransformCoordinates(f.m.Up(),S),y=f.m.TransformCoordinates(V,Q),O=y.multiply(U),D=y.divide(U).normalize();o.push(O.x,O.y,O.z),L.push(D.x,D.y,D.z),t.push(T,s.c?1-C:C)}if(z>0){const C=o.length/3;for(let M=C-2*(d+1);M+d+2<C;M++)y?(z>1&&(D.push(M),D.push(M+1),D.push(M+d+1)),(z<O||Q<1)&&(D.push(M+d+1),D.push(M+1),D.push(M+d+2))):(D.push(M),D.push(M+1),D.push(M+d+1),D.push(M+d+1),D.push(M+1),D.push(M+d+2))}}z.b._ComputeSides(V,o,D,L,t,C.frontUVs,C.backUVs);const A=new z.b;return A.indices=D,A.xa=o,A.ya=L,A.Aa=t,A}function m(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const f=new T.d(C,x);M.sideOrientation=T.d._GetDefaultSideOrientation(M.sideOrientation),f._originalBuilderSideOrientation=M.sideOrientation;return S(M).Ca(f,M.updatable),f}z.b.CreateSphere=S,T.d.CreateSphere=(C,M,x,f,T,z)=>m(C,{segments:M,diameterX:x,diameterY:x,diameterZ:x,sideOrientation:z,updatable:T},f)},12380:(C,M,x)=>{"use strict";x.d(M,{c:()=>y});var f=x(1192),T=x(10697),z=x(11748),s=x(1224),S=x(11739),m=x(1078);function Q(C,M,x,f,T){let z=null,s=null,S=null;try{let m;z=new C.Decoder,s=new C.DecoderBuffer,s.Init(M,M.byteLength);const Q=z.GetEncodedGeometryType(s);switch(Q){case C.TRIANGULAR_MESH:{const M=new C.Mesh;if(m=z.DecodeBufferToMesh(s,M),!m.ok()||0===M.ptr)throw new Error(m.error_msg());const x=3*M.num_faces(),T=4*x,Q=C._malloc(T);try{z.GetTrianglesUInt32Array(M,T,Q);const s=new Uint32Array(x);s.set(new Uint32Array(C.HEAPF32.buffer,Q,x)),f(s)}finally{C._free(Q)}S=M;break}case C.POINT_CLOUD:{const M=new C.PointCloud;if(m=z.DecodeBufferToPointCloud(s,M),!m.ok()||!M.ptr)throw new Error(m.error_msg());S=M;break}default:throw new Error(`Invalid geometry type ${Q}`)}const V=S.num_points(),y=(M,x,f,z)=>{const s=z.data_type(),S=z.num_components(),m=z.normalized(),Q=z.byte_stride(),y=z.byte_offset(),U={[C.DT_FLOAT32]:{typedArrayConstructor:Float32Array,heap:C.HEAPF32},[C.DT_INT8]:{typedArrayConstructor:Int8Array,heap:C.HEAP8},[C.DT_INT16]:{typedArrayConstructor:Int16Array,heap:C.HEAP16},[C.DT_INT32]:{typedArrayConstructor:Int32Array,heap:C.HEAP32},[C.DT_UINT8]:{typedArrayConstructor:Uint8Array,heap:C.HEAPU8},[C.DT_UINT16]:{typedArrayConstructor:Uint16Array,heap:C.HEAPU16},[C.DT_UINT32]:{typedArrayConstructor:Uint32Array,heap:C.HEAPU32}}[s];if(!U)throw new Error(`Invalid data type ${s}`);const O=V*S,d=O*U.typedArrayConstructor.BYTES_PER_ELEMENT,D=C._malloc(d);try{M.GetAttributeDataArrayForAllPoints(x,z,s,d,D);const C=new U.typedArrayConstructor(U.heap.buffer,D,O);T(f,C.slice(),S,y,Q,m)}finally{C._free(D)}};if(x)for(const C in x){const M=x[C],f=z.GetAttributeByUniqueId(S,M);y(z,S,C,f)}else{const M={position:C.POSITION,Nd:C.NORMAL,color:C.COLOR,uv:C.TEX_COORD};for(const C in M){const x=z.GetAttributeId(S,M[C]);if(-1!==x){const M=z.GetAttribute(S,x);y(z,S,C,M)}}}return V}finally{S&&C.destroy(S),s&&C.destroy(s),z&&C.destroy(z)}}function V(){let C;onmessage=M=>{const x=M.data;switch(x.id){case"init":{const M=x.decoder;M.url&&importScripts(M.url);const f=M.wasmBinary?{wasmBinary:M.wasmBinary}:{};C=DracoDecoderModule(f),postMessage({id:"initDone"});break}case"decodeMesh":if(!C)throw new Error("Draco decoder module is not available");C.then((C=>{const M=Q(C,x.dataView,x.attributes,(C=>{postMessage({id:"indices",data:C},[C.buffer])}),((C,M,x,f,T,z)=>{postMessage({id:"attribute",kind:C,data:M,size:x,byteOffset:f,byteStride:T,normalized:z},[M.buffer])}));postMessage({id:"decodeMeshDone",totalVertices:M})}))}}}class y{static get DecoderAvailable(){const C=y.Configuration.decoder;return!!(C.wasmUrl&&C.wasmBinaryUrl&&"object"===typeof WebAssembly||C.fallbackUrl)}static GetDefaultNumWorkers(){return"object"===typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1}static get Default(){return y._Default||(y._Default=new y),y._Default}static ResetDefault(C){y._Default&&(C||y._Default.dispose(),y._Default=null)}constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:y.DefaultNumWorkers;const M=y.Configuration.decoder;if(M.workerPool||"object"===typeof C&&C.workerPool)this._workerPoolPromise=Promise.resolve(M.workerPool||C.workerPool);else{const x=M.wasmBinary||"object"===typeof C&&C.wasmBinary,z="number"===typeof C?C:C.numWorkers,s=z&&"function"===typeof Worker&&"function"===typeof URL,S=s||!s&&!M.jsModule,m=M.wasmUrl&&M.wasmBinaryUrl&&"object"===typeof WebAssembly?{url:S?f.i.GetBabylonScriptURL(M.wasmUrl,!0):"",wasmBinaryPromise:x?Promise.resolve(x):f.i.LoadFileAsync(f.i.GetBabylonScriptURL(M.wasmBinaryUrl,!0))}:{url:S?f.i.GetBabylonScriptURL(M.fallbackUrl):"",wasmBinaryPromise:Promise.resolve(void 0)};s?this._workerPoolPromise=m.wasmBinaryPromise.then((C=>{const M=`${Q}(${V})()`,x=URL.createObjectURL(new Blob([M],{type:"application/javascript"}));return new T.d(z,(()=>function(C,M,x){return new Promise(((f,T)=>{const z=M=>{C.removeEventListener("error",z),C.removeEventListener("message",s),T(M)},s=M=>{"initDone"===M.data.id&&(C.removeEventListener("error",z),C.removeEventListener("message",s),f(C))};if(C.addEventListener("error",z),C.addEventListener("message",s),M){const f=M.slice(0);C.postMessage({id:"init",decoder:{url:x,wasmBinary:f}},[f])}else C.postMessage({id:"init",decoder:{url:x}})}))}(new Worker(x),C,m.url)))})):this._decoderModulePromise=m.wasmBinaryPromise.then((async C=>{if("undefined"===typeof DracoDecoderModule&&!M.jsModule){if(!m.url)throw new Error("Draco decoder module is not available");await f.i.LoadBabylonScriptAsync(m.url)}return await(x=C,T=M.jsModule,new Promise((C=>{(T||DracoDecoderModule)({wasmBinary:x}).then((M=>{C({module:M})}))})));var x,T}))}}dispose(){this._workerPoolPromise&&this._workerPoolPromise.then((C=>{C.dispose()})),delete this._workerPoolPromise,delete this._decoderModulePromise}async whenReadyAsync(){this._workerPoolPromise?await this._workerPoolPromise:this._decoderModulePromise&&await this._decoderModulePromise}decodeMeshToMeshDataAsync(C,M,x){const f=C instanceof ArrayBuffer?new Int8Array(C):new Int8Array(C.buffer,C.byteOffset,C.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((C=>new Promise(((T,z)=>{C.push(((C,s)=>{let S=null;const Q=[],V=M=>{C.removeEventListener("error",V),C.removeEventListener("message",y),z(M),s()},y=M=>{const f=M.data;switch(f.id){case"decodeMeshDone":C.removeEventListener("error",V),C.removeEventListener("message",y),T({indices:S,attributes:Q,totalVertices:f.totalVertices}),s();break;case"indices":S=f.data;break;case"attribute":Q.push({kind:f.kind,data:f.data,size:f.size,byteOffset:f.byteOffset,byteStride:f.byteStride,normalized:(z=f.kind,U=f.normalized,x&&void 0!==x[z]?(U!==x[z]&&m.e.Warn(`Normalized flag from Draco data (${U}) does not match normalized flag from glTF accessor (${x[z]}). Using flag from glTF accessor.`),x[z]):U)})}var z,U};C.addEventListener("error",V),C.addEventListener("message",y);const U=f.slice();C.postMessage({id:"decodeMesh",dataView:U,attributes:M},[U.buffer])}))}))));if(this._decoderModulePromise)return this._decoderModulePromise.then((C=>{let x=null;const T=[],z=Q(C.module,f,M,(C=>{x=C}),((C,M,x,f,z,s)=>{T.push({kind:C,data:M,size:x,byteOffset:f,byteStride:z,normalized:s})}));return{indices:x,attributes:T,totalVertices:z}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(C,M,x,f){const T=await this.decodeMeshToMeshDataAsync(x,f),S=new z.b(C,M);T.indices&&S.setIndices(T.indices);for(const z of T.attributes)S.setVerticesBuffer(new s.h(M.getEngine(),z.data,z.kind,!1,void 0,z.byteStride,void 0,z.byteOffset,z.size,void 0,z.normalized,!0),T.totalVertices);return S}async _decodeMeshToGeometryForGltfAsync(C,M,x,f,T){const S=await this.decodeMeshToMeshDataAsync(x,f,T),m=new z.b(C,M);S.indices&&m.setIndices(S.indices);for(const z of S.attributes)m.setVerticesBuffer(new s.h(M.getEngine(),z.data,z.kind,!1,void 0,z.byteStride,void 0,z.byteOffset,z.size,void 0,z.normalized,!0),S.totalVertices);return m}async decodeMeshAsync(C,M){const x=await this.decodeMeshToMeshDataAsync(C,M),f=new S.b;x.indices&&(f.indices=x.indices);for(const T of x.attributes){const C=s.h.GetFloatData(T.data,T.size,s.h.GetDataType(T.data),T.byteOffset,T.byteStride,T.normalized,x.totalVertices);f.set(C,T.kind)}return f}}y.Configuration={decoder:{wasmUrl:`${f.i._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${f.i._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${f.i._DefaultCdnUrl}/draco_decoder_gltf.js`}},y.DefaultNumWorkers=y.GetDefaultNumWorkers(),y._Default=null},11763:(C,M,x)=>{"use strict";x.d(M,{b:()=>R});var f=x(951),T=x(971),z=x(978),s=x(1224),S=x(11739),m=x(11765),Q=x(1217),V=x(1300),y=x(1215);class U{constructor(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new z.m(0,0,0),this._diffPositionForCollisions=new z.m(0,0,0),this._collisionResponse=!0}}var O=x(1067),d=x(1317),D=x(1162),o=x(986),L=x(1447),t=x(997),A=x(959),H=x(1086);class j{constructor(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=z.m.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1}}class b{constructor(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new j,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=null,this._currentLODIsUpToDate=!1,this._collisionRetryCount=3,this._morphTargetManager=null,this._renderingGroupId=0,this._bakedVertexAnimationManager=null,this._material=null,this._positions=null,this._pointerOverDisableMeshTesting=!1,this._meshCollisionData=new U,this._enableDistantPicking=!1,this._rawBoundingInfo=null,this._sideOrientationHint=!1,this._inheritVisibility=!1}}class R extends m.e{static get BILLBOARDMODE_NONE(){return m.e.BILLBOARDMODE_NONE}static get BILLBOARDMODE_X(){return m.e.BILLBOARDMODE_X}static get BILLBOARDMODE_Y(){return m.e.BILLBOARDMODE_Y}static get BILLBOARDMODE_Z(){return m.e.BILLBOARDMODE_Z}static get BILLBOARDMODE_ALL(){return m.e.BILLBOARDMODE_ALL}static get BILLBOARDMODE_USE_POSITION(){return m.e.BILLBOARDMODE_USE_POSITION}get facetNb(){return this._internalAbstractMeshDataInfo._facetData.facetNb}get partitioningSubdivisions(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions}set partitioningSubdivisions(C){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=C}get partitioningBBoxRatio(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio}set partitioningBBoxRatio(C){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=C}get mustDepthSortFacets(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort}set mustDepthSortFacets(C){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=C}get facetDepthSortFrom(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom}set facetDepthSortFrom(C){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=C}get collisionRetryCount(){return this._internalAbstractMeshDataInfo._collisionRetryCount}set collisionRetryCount(C){this._internalAbstractMeshDataInfo._collisionRetryCount=C}get isFacetDataEnabled(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled}get morphTargetManager(){return this._internalAbstractMeshDataInfo._morphTargetManager}set morphTargetManager(C){this._internalAbstractMeshDataInfo._morphTargetManager!==C&&(this._internalAbstractMeshDataInfo._morphTargetManager=C,this._syncGeometryWithMorphTargetManager())}get bakedVertexAnimationManager(){return this._internalAbstractMeshDataInfo._bakedVertexAnimationManager}set bakedVertexAnimationManager(C){this._internalAbstractMeshDataInfo._bakedVertexAnimationManager!==C&&(this._internalAbstractMeshDataInfo._bakedVertexAnimationManager=C,this._markSubMeshesAsAttributesDirty())}_syncGeometryWithMorphTargetManager(){}_updateNonUniformScalingState(C){return!!super._updateNonUniformScalingState(C)&&(this._markSubMeshesAsMiscDirty(),!0)}get rawBoundingInfo(){return this._internalAbstractMeshDataInfo._rawBoundingInfo}set rawBoundingInfo(C){this._internalAbstractMeshDataInfo._rawBoundingInfo=C}set Pk(C){this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver=this.onCollideObservable.add(C)}set onCollisionPositionChange(C){this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(C)}get visibility(){return this._internalAbstractMeshDataInfo._visibility}set visibility(C){if(this._internalAbstractMeshDataInfo._visibility===C)return;const M=this._internalAbstractMeshDataInfo._visibility;this._internalAbstractMeshDataInfo._visibility=C,(1===M&&1!==C||1!==M&&1===C)&&this._markSubMeshesAsDirty((C=>{C.markAsMiscDirty(),C.markAsPrePassDirty()}))}get inheritVisibility(){return this._internalAbstractMeshDataInfo._inheritVisibility}set inheritVisibility(C){this._internalAbstractMeshDataInfo._inheritVisibility=C}get isVisible(){if(!this._isVisible||!this.inheritVisibility||!this._parentNode)return this._isVisible;if(this._isVisible){let C=this._parentNode;for(;C;){const M=C.isVisible;if("undefined"!==typeof M)return M;C=C.parent}}return this._isVisible}set isVisible(C){this._isVisible=C}get pointerOverDisableMeshTesting(){return this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting}set pointerOverDisableMeshTesting(C){this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting=C}get renderingGroupId(){return this._internalAbstractMeshDataInfo._renderingGroupId}set renderingGroupId(C){this._internalAbstractMeshDataInfo._renderingGroupId=C}get material(){return this._internalAbstractMeshDataInfo._material}set material(C){this._setMaterial(C)}_setMaterial(C){this._internalAbstractMeshDataInfo._material!==C&&(this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._material=C,C&&C.meshMap&&(C.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.we&&(this.resetDrawCache(),this._unBindEffect()))}getMaterialForRenderPass(C){var M;return null===(M=this._internalAbstractMeshDataInfo._materialForRenderPass)||void 0===M?void 0:M[C]}setMaterialForRenderPass(C,M){this.resetDrawCache(C),this._internalAbstractMeshDataInfo._materialForRenderPass||(this._internalAbstractMeshDataInfo._materialForRenderPass=[]),this._internalAbstractMeshDataInfo._materialForRenderPass[C]=M}get receiveShadows(){return this._internalAbstractMeshDataInfo._receiveShadows}set receiveShadows(C){this._internalAbstractMeshDataInfo._receiveShadows!==C&&(this._internalAbstractMeshDataInfo._receiveShadows=C,this._markSubMeshesAsLightDirty())}get hasVertexAlpha(){return this._internalAbstractMeshDataInfo._hasVertexAlpha}set hasVertexAlpha(C){this._internalAbstractMeshDataInfo._hasVertexAlpha!==C&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=C,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())}get useVertexColors(){return this._internalAbstractMeshDataInfo._useVertexColors}set useVertexColors(C){this._internalAbstractMeshDataInfo._useVertexColors!==C&&(this._internalAbstractMeshDataInfo._useVertexColors=C,this._markSubMeshesAsAttributesDirty())}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(C){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==C&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=C,this._markSubMeshesAsAttributesDirty())}get numBoneInfluencers(){return this._internalAbstractMeshDataInfo._numBoneInfluencers}set numBoneInfluencers(C){this._internalAbstractMeshDataInfo._numBoneInfluencers!==C&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=C,this._markSubMeshesAsAttributesDirty())}get applyFog(){return this._internalAbstractMeshDataInfo._applyFog}set applyFog(C){this._internalAbstractMeshDataInfo._applyFog!==C&&(this._internalAbstractMeshDataInfo._applyFog=C,this._markSubMeshesAsMiscDirty())}get enableDistantPicking(){return this._internalAbstractMeshDataInfo._enableDistantPicking}set enableDistantPicking(C){this._internalAbstractMeshDataInfo._enableDistantPicking=C}get layerMask(){return this._internalAbstractMeshDataInfo._layerMask}set layerMask(C){C!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=C,this._resyncLightSources())}get collisionMask(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask}set collisionMask(C){this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask=isNaN(C)?-1:C}get collisionResponse(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse}set collisionResponse(C){this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse=C}get collisionGroup(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup}set collisionGroup(C){this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup=isNaN(C)?-1:C}get surroundingMeshes(){return this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes}set surroundingMeshes(C){this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes=C}get lightSources(){return this._lightSources}set skeleton(C){const M=this._internalAbstractMeshDataInfo._skeleton;M&&M.needInitialSkinMatrix&&M._unregisterMeshWithPoseMatrix(this),C&&C.needInitialSkinMatrix&&C._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=C,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()}get skeleton(){return this._internalAbstractMeshDataInfo._skeleton}constructor(C){var M;let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;switch(super(C,x,!1),M=this,this._internalAbstractMeshDataInfo=new b,this._waitingMaterialId=null,this._waitingMorphTargetManagerId=null,this.Re=R.Yi,this.onCollideObservable=new T.c,this.onCollisionPositionChangeObservable=new T.c,this.onMaterialChangedObservable=new T.c,this.definedFacingForward=!0,this._occlusionQuery=null,this._renderingGroup=null,this.alphaIndex=Number.MAX_VALUE,this._isVisible=!0,this.ge=!0,this.isNearPickable=!1,this.isNearGrabbable=!1,this.showSubMeshesBoundingBox=!1,this.isBlocker=!1,this.enablePointerMoveEvents=!1,this.outlineColor=D.d.Red(),this.outlineWidth=.02,this.overlayColor=D.d.Red(),this.overlayAlpha=.5,this.useOctreeForRenderingSelection=!0,this.useOctreeForPicking=!0,this.useOctreeForCollisions=!0,this.Ce=!1,this.Da=!1,this.actionManager=null,this.ellipsoid=new z.m(.5,1,.5),this.ellipsoidOffset=new z.m(0,0,0),this.edgesWidth=1,this.edgesColor=new D.e(1,0,0,1),this._edgesRenderer=null,this._masterMesh=null,this._boundingInfo=null,this._boundingInfoIsDirty=!0,this._renderId=0,this._intersectionsInProgress=new Array,this._unIndexed=!1,this._lightSources=new Array,this._waitingData={lods:null,actions:null,ki:null},this._bonesTransformMatrices=null,this._transformMatrixTexture=null,this.onRebuildObservable=new T.c,this._onCollisionPositionChange=function(C,x){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;x.subtractToRef(M._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,M._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),M._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions.length()>H.e.CollisionsEpsilon&&M.position.addInPlace(M._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),f&&M.onCollideObservable.notifyObservers(f),M.onCollisionPositionChangeObservable.notifyObservers(M.position)},x=this.va(),x.ye(this),this._resyncLightSources(),this._uniformBuffer=new y.b(this.va().getEngine(),void 0,void 0,C,!this.va().getEngine().isWebGPU),this._buildUniformLayout(),x.performancePriority){case 2:this.Da=!0;case 1:this.Ce=!0,this.ge=!1}}_buildUniformLayout(){this._uniformBuffer.addUniform("world",16),this._uniformBuffer.addUniform("visibility",1),this._uniformBuffer.create()}transferToEffect(C){const M=this._uniformBuffer;M.ee("world",C),M.updateFloat("visibility",this._internalAbstractMeshDataInfo._visibility),M.update()}getMeshUniformBuffer(){return this._uniformBuffer}getClassName(){return"AbstractMesh"}toString(C){let M="Name: "+this.name+", isInstance: "+("InstancedMesh"!==this.getClassName()?"YES":"NO");M+=", # of submeshes: "+(this.we?this.we.length:0);const x=this._internalAbstractMeshDataInfo._skeleton;return x&&(M+=", skeleton: "+x.name),C&&(M+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],M+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.ki?"YES":"NO")),M}_getEffectiveParent(){return this._masterMesh&&this.billboardMode!==m.e.BILLBOARDMODE_NONE?this._masterMesh:super._getEffectiveParent()}_getActionManagerForTrigger(C){let M=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.actionManager&&(M||this.actionManager.isRecursive)){if(!C)return this.actionManager;if(this.actionManager.hasSpecificTrigger(C))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(C,!1):null}_rebuild(){if(this.onRebuildObservable.notifyObservers(this),null!==this._occlusionQuery&&(this._occlusionQuery=null),this.we){for(const C of this.we)C._rebuild();this.resetDrawCache()}}_resyncLightSources(){this._lightSources.length=0;for(const C of this.va().lights)C.isEnabled()&&C.canAffectMesh(this)&&this._lightSources.push(C);this._markSubMeshesAsLightDirty()}_resyncLightSource(C){const M=C.isEnabled()&&C.canAffectMesh(this),x=this._lightSources.indexOf(C);let f=!1;if(-1===x){if(!M)return;this._lightSources.push(C)}else{if(M)return;f=!0,this._lightSources.splice(x,1)}this._markSubMeshesAsLightDirty(f)}_unBindEffect(){for(const C of this.we)C.setEffect(null)}_removeLightSource(C,M){const x=this._lightSources.indexOf(C);-1!==x&&(this._lightSources.splice(x,1),this._markSubMeshesAsLightDirty(M))}_markSubMeshesAsDirty(C){if(this.we)for(const M of this.we)for(let x=0;x<M._drawWrappers.length;++x){const f=M._drawWrappers[x];f&&f.defines&&f.defines.markAllAsDirty&&C(f.defines)}}_markSubMeshesAsLightDirty(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._markSubMeshesAsDirty((M=>M.markAsLightDirty(C)))}_markSubMeshesAsAttributesDirty(){this._markSubMeshesAsDirty((C=>C.markAsAttributesDirty()))}_markSubMeshesAsMiscDirty(){this._markSubMeshesAsDirty((C=>C.markAsMiscDirty()))}Fe(C){return this._currentRenderId=Number.MAX_VALUE,super.Fe(C),this._isDirty=!0,this}resetDrawCache(C){if(this.we)for(const M of this.we)M.resetDrawCache(C)}get isBlocked(){return!1}getLOD(C){return this}getTotalVertices(){return 0}getTotalIndices(){return 0}Ge(){return null}getVerticesData(C){return null}Ga(C,M,x,f){return this}updateVerticesData(C,M,x,f){return this}setIndices(C,M){return this}isVerticesDataPresent(C){return!1}getBoundingInfo(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfoIsDirty&&(this._boundingInfoIsDirty=!1,this.Ea()),this._boundingInfo)}getRawBoundingInfo(){return this.rawBoundingInfo??this.getBoundingInfo()}setBoundingInfo(C){return this._boundingInfo=C,this}get hasBoundingInfo(){return null!==this._boundingInfo}buildBoundingInfo(C,M,x){return this._boundingInfo=new V.b(C,M,x),this._boundingInfo}normalizeToUnitCube(){let C=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],M=arguments.length>1&&void 0!==arguments[1]&&arguments[1],x=arguments.length>2?arguments[2]:void 0;return super.normalizeToUnitCube(C,M,x)}get useBones(){return this.skeleton&&this.va().skeletonsEnabled&&this.isVerticesDataPresent(s.h.MatricesIndicesKind)&&this.isVerticesDataPresent(s.h.MatricesWeightsKind)}_preActivate(){}_preActivateForIntermediateRendering(C){}_activate(C,M){return this._renderId=C,!0}_postActivate(){}_freeze(){}_unFreeze(){}getWorldMatrix(){return this._masterMesh&&this.billboardMode===m.e.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():super.getWorldMatrix()}_getWorldMatrixDeterminant(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():super._getWorldMatrixDeterminant()}get isAnInstance(){return!1}get hasInstances(){return!1}get hasThinInstances(){return!1}movePOV(C,M,x){return this.position.addInPlace(this.calcMovePOV(C,M,x)),this}calcMovePOV(C,M,x){const f=new z.d;(this.rotationQuaternion?this.rotationQuaternion:z.h.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(f);const T=z.m.Zero(),s=this.definedFacingForward?-1:1;return z.m.TransformCoordinatesFromFloatsToRef(C*s,M,x*s,f,T),T}rotatePOV(C,M,x){return this.rotation.addInPlace(this.calcRotatePOV(C,M,x)),this}calcRotatePOV(C,M,x){const f=this.definedFacingForward?1:-1;return new z.m(C*f,M,x*f)}Fa(C,M){if(C){const x=(0,d.e)(C,0,this.getTotalVertices(),M);this._boundingInfo?this._boundingInfo.reConstruct(x.minimum,x.maximum):this._boundingInfo=new V.b(x.minimum,x.maximum)}if(this.we)for(let x=0;x<this.we.length;x++)this.we[x].refreshBoundingInfo(C);this.Ea()}_refreshBoundingInfoDirect(C){if(this._boundingInfo?this._boundingInfo.reConstruct(C.minimum,C.maximum):this._boundingInfo=new V.b(C.minimum,C.maximum),this.we)for(let M=0;M<this.we.length;M++)this.we[M].refreshBoundingInfo(null);this.Ea()}static _ApplySkeleton(C,M,x,f,T,S,m){!function(C,M,x,f,T,S,m){const Q=z.i.Md[0],V=z.i.Matrix[0],y=z.i.Matrix[1],U=M===s.h.NormalKind?z.m.TransformNormalFromFloatsToRef:z.m.TransformCoordinatesFromFloatsToRef;for(let s=0,O=0;s<C.length;s+=3,O+=4){let M,d;for(V.reset(),M=0;M<4;M++)d=T[O+M],d>0&&(z.d.FromFloat32ArrayToRefScaled(x,Math.floor(16*f[O+M]),d,y),V.addToSelf(y));if(S&&m)for(M=0;M<4;M++)d=m[O+M],d>0&&(z.d.FromFloat32ArrayToRefScaled(x,Math.floor(16*S[O+M]),d,y),V.addToSelf(y));U(C[s],C[s+1],C[s+2],V,Q),Q.toArray(C,s)}}(C,M,x,f,T,S,m)}_getData(C,M){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:s.h.PositionKind;const f=C.cache,T=C=>{if(f){const M=f._vertexData||(f._vertexData={});return M[C]||this.copyVerticesData(C,M),M[C]}return this.getVerticesData(C)};if(M||(M=T(x)),!M)return null;if(f?(f._outputData?f._outputData.set(M):f._outputData=new Float32Array(M),M=f._outputData):(C.applyMorph&&this.morphTargetManager||C.applySkeleton&&this.skeleton)&&(M=M.slice()),C.applyMorph&&this.morphTargetManager&&function(C,M,x){let f=null;switch(M){case s.h.PositionKind:f=C=>C.getPositions();break;case s.h.NormalKind:f=C=>C.getNormals();break;case s.h.TangentKind:f=C=>C.getTangents();break;case s.h.UVKind:f=C=>C.getUVs();break;default:return}for(let T=0;T<C.length;T++){let M=C[T];for(let z=0;z<x.numTargets;z++){const s=x.getTarget(z),S=s.influence;if(0!==S){const x=f(s);x&&(M+=(x[T]-C[T])*S)}}C[T]=M}}(M,x,this.morphTargetManager),C.applySkeleton&&this.skeleton){const C=T(s.h.MatricesIndicesKind),f=T(s.h.MatricesWeightsKind);if(f&&C){const z=this.numBoneInfluencers>4,S=z?T(s.h.MatricesIndicesExtraKind):null,m=z?T(s.h.MatricesWeightsExtraKind):null,Q=this.skeleton.getTransformMatrices(this);R._ApplySkeleton(M,x,Q,C,f,S,m)}}if(!1!==C.updatePositionsArray&&x===s.h.PositionKind){const C=this._internalAbstractMeshDataInfo._positions||[],x=C.length;if(C.length=M.length/3,x<C.length)for(let M=x;M<C.length;M++)C[M]=new z.m;for(let f=0,T=0;f<C.length;f++,T+=3)C[f].Hd(M[T],M[T+1],M[T+2]);this._internalAbstractMeshDataInfo._positions=C}return M}getNormalsData(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0],M=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getData({applySkeleton:C,applyMorph:M,updatePositionsArray:!1},null,s.h.NormalKind)}cg(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0],M=arguments.length>1&&void 0!==arguments[1]&&arguments[1],x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this._getData({applySkeleton:C,applyMorph:M,updatePositionsArray:!1},x,s.h.PositionKind)}Ea(){return this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=new V.b(z.m.Zero(),z.m.Zero(),this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}_updateSubMeshesBoundingInfo(C){if(!this.we)return this;const M=this.we.length;for(let x=0;x<M;x++){const f=this.we[x];(M>1||!f.IsGlobal)&&f.updateBoundingInfo(C)}return this}_afterComputeWorldMatrix(){this.Da||(this._boundingInfoIsDirty=!0)}isInFrustum(C){return this.getBoundingInfo().isInFrustum(C,this.Re)}isCompletelyInFrustum(C){return this.getBoundingInfo().isCompletelyInFrustum(C)}intersectsMesh(C){let M=arguments.length>1&&void 0!==arguments[1]&&arguments[1],x=arguments.length>2?arguments[2]:void 0;const f=this.getBoundingInfo(),T=C.getBoundingInfo();if(f.intersects(T,M))return!0;if(x)for(const z of this.getChildMeshes())if(z.intersectsMesh(C,M,!0))return!0;return!1}intersectsPoint(C){return this.getBoundingInfo().intersectsPoint(C)}get checkCollisions(){return this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions}set checkCollisions(C){this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions=C}get collider(){return this._internalAbstractMeshDataInfo._meshCollisionData._collider}moveWithCollisions(C){this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions);const M=this.va().collisionCoordinator;return this._internalAbstractMeshDataInfo._meshCollisionData._collider||(this._internalAbstractMeshDataInfo._meshCollisionData._collider=M.createCollider()),this._internalAbstractMeshDataInfo._meshCollisionData._collider._radius=this.ellipsoid,M.getNewPosition(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,C,this._internalAbstractMeshDataInfo._meshCollisionData._collider,this.collisionRetryCount,this,this._onCollisionPositionChange,this.uniqueId),this}_collideForSubMesh(C,M,x){var f;if(this._generatePointsArray(),!this._positions)return this;if(!C._lastColliderWorldVertices||!C._lastColliderTransformMatrix.equals(M)){C._lastColliderTransformMatrix=M.clone(),C._lastColliderWorldVertices=[],C._trianglePlanes=[];const x=C.verticesStart,f=C.verticesStart+C.verticesCount;for(let T=x;T<f;T++)C._lastColliderWorldVertices.push(z.m.TransformCoordinates(this._positions[T],M))}return x._collide(C._trianglePlanes,C._lastColliderWorldVertices,this.Ge(),C.indexStart,C.indexStart+C.indexCount,C.verticesStart,!!C.Ha(),this,this._shouldConvertRHS(),7===(null===(f=C.Ha())||void 0===f?void 0:f.fillMode)),this}_processCollisionsForSubMeshes(C,M){const x=this._scene.getCollidingSubMeshCandidates(this,C),f=x.length;for(let T=0;T<f;T++){const z=x.data[T];f>1&&!z._checkCollision(C)||this._collideForSubMesh(z,M,C)}return this}_shouldConvertRHS(){return!1}_checkCollision(C){if(!this.getBoundingInfo()._checkCollision(C))return this;const M=z.i.Matrix[0],x=z.i.Matrix[1];return z.d.ScalingToRef(1/C._radius.x,1/C._radius.y,1/C._radius.z,M),this.worldMatrixFromCache.multiplyToRef(M,x),this._processCollisionsForSubMeshes(C,x),this}_generatePointsArray(){return!1}intersects(C,M,x){let f=arguments.length>3&&void 0!==arguments[3]&&arguments[3],T=arguments.length>4?arguments[4]:void 0,s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const S=new Q.c,m=this.getClassName(),V="InstancedLinesMesh"===m||"LinesMesh"===m||"GreasedLineMesh"===m?this.intersectionThreshold:0,y=this.getBoundingInfo();if(!this.we)return S;if(!s&&(!C.intersectsSphere(y.boundingSphere,V)||!C.intersectsBox(y.boundingBox,V)))return S;if(f)return S.hit=!s,S.pickedMesh=s?null:this,S.distance=s?0:z.m.Distance(C.origin,y.boundingSphere.center),S.subMeshId=0,S;if(!this._generatePointsArray())return S;let U=null;const O=this._scene.getIntersectingSubMeshCandidates(this,C),d=O.length;let D=!1;for(let z=0;z<d;z++){const C=O.data[z].Ha();if(C&&(7==C.fillMode||0==C.fillMode||1==C.fillMode||2==C.fillMode||4==C.fillMode)){D=!0;break}}if(!D)return S.hit=!0,S.pickedMesh=this,S.distance=z.m.Distance(C.origin,y.boundingSphere.center),S.subMeshId=-1,S;for(let z=0;z<d;z++){const f=O.data[z];if(d>1&&!s&&!f.canIntersects(C))continue;const T=f.intersects(C,this._positions,this.Ge(),M,x);if(T&&(M||!U||T.distance<U.distance)&&(U=T,U.subMeshId=z,M))break}if(U){const M=T??this.getWorldMatrix(),x=z.i.Md[0],f=z.i.Md[1];z.m.TransformCoordinatesToRef(C.origin,M,x),C.direction.scaleToRef(U.distance,f);const s=z.m.TransformNormal(f,M).addInPlace(x);return S.hit=!0,S.distance=z.m.Distance(x,s),S.pickedPoint=s,S.pickedMesh=this,S.bu=U.bu||0,S.bv=U.bv||0,S.subMeshFaceId=U.faceId,S.faceId=U.faceId+O.data[U.subMeshId].indexStart/(-1!==this.getClassName().indexOf("LinesMesh")?2:3),S.subMeshId=U.subMeshId,S}return S}clone(C,M,x){return null}releaseSubMeshes(){if(this.we)for(;this.we.length;)this.we[0].dispose();else this.we=[];return this}dispose(C){let M,x=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const f=this.va();for(this._scene.useMaterialMeshMap&&this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),f.freeActiveMeshes(),f.freeRenderingGroups(),f.renderingManager.maintainStateBetweenFrames&&f.renderingManager.restoreDispachedFlags(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.disposeWhenUnowned&&!this._scene.meshes.some((C=>C!==this&&C.actionManager===this.actionManager))&&this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),M=0;M<this._intersectionsInProgress.length;M++){const C=this._intersectionsInProgress[M],x=C._intersectionsInProgress.indexOf(this);C._intersectionsInProgress.splice(x,1)}this._intersectionsInProgress.length=0;f.lights.forEach((C=>{let M=C.includedOnlyMeshes.indexOf(this);-1!==M&&C.includedOnlyMeshes.splice(M,1),M=C.excludedMeshes.indexOf(this),-1!==M&&C.excludedMeshes.splice(M,1);const x=C.getShadowGenerators();if(x){const C=x.values();for(let x=C.next();!0!==x.done;x=C.next()){const C=x.value.getShadowMap();C&&C.renderList&&(M=C.renderList.indexOf(this),-1!==M&&C.renderList.splice(M,1))}}})),"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes();const T=f.getEngine();if(null!==this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,T.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),T.wipeCaches(),f.Ae(this),this._parentContainer){const C=this._parentContainer.meshes.indexOf(this);C>-1&&this._parentContainer.meshes.splice(C,1),this._parentContainer=null}if(x&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!C)for(M=0;M<f.te.length;M++)f.te[M].k===this&&(f.te[M].dispose(),M--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this._uniformBuffer.dispose(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),super.dispose(C,x)}_initFacetData(){const C=this._internalAbstractMeshDataInfo._facetData;C.facetNormals||(C.facetNormals=[]),C.facetPositions||(C.facetPositions=[]),C.facetPartitioning||(C.facetPartitioning=new Array),C.facetNb=this.Ge().length/3|0,C.partitioningSubdivisions=C.partitioningSubdivisions?C.partitioningSubdivisions:10,C.partitioningBBoxRatio=C.partitioningBBoxRatio?C.partitioningBBoxRatio:1.01;for(let M=0;M<C.facetNb;M++)C.facetNormals[M]=z.m.Zero(),C.facetPositions[M]=z.m.Zero();return C.facetDataEnabled=!0,this}updateFacetData(){const C=this._internalAbstractMeshDataInfo._facetData;C.facetDataEnabled||this._initFacetData();const M=this.getVerticesData(s.h.PositionKind),x=this.Ge(),f=this.getVerticesData(s.h.NormalKind),T=this.getBoundingInfo();if(C.facetDepthSort&&!C.facetDepthSortEnabled){if(C.facetDepthSortEnabled=!0,x instanceof Uint16Array)C.depthSortedIndices=new Uint16Array(x);else if(x instanceof Uint32Array)C.depthSortedIndices=new Uint32Array(x);else{let M=!1;for(let C=0;C<x.length;C++)if(x[C]>65535){M=!0;break}C.depthSortedIndices=M?new Uint32Array(x):new Uint16Array(x)}if(C.facetDepthSortFunction=function(C,M){return M.sqDistance-C.sqDistance},!C.facetDepthSortFrom){const M=this.va().activeCamera;C.facetDepthSortFrom=M?M.position:z.m.Zero()}C.depthSortedFacets=[];for(let M=0;M<C.facetNb;M++){const x={ind:3*M,sqDistance:0};C.depthSortedFacets.push(x)}C.invertedMatrix=z.d.Identity(),C.facetDepthSortOrigin=z.m.Zero()}C.bbSize.x=T.maximum.x-T.minimum.x>o.c?T.maximum.x-T.minimum.x:o.c,C.bbSize.y=T.maximum.y-T.minimum.y>o.c?T.maximum.y-T.minimum.y:o.c,C.bbSize.z=T.maximum.z-T.minimum.z>o.c?T.maximum.z-T.minimum.z:o.c;let m=C.bbSize.x>C.bbSize.y?C.bbSize.x:C.bbSize.y;if(m=m>C.bbSize.z?m:C.bbSize.z,C.subDiv.max=C.partitioningSubdivisions,C.subDiv.X=Math.floor(C.subDiv.max*C.bbSize.x/m),C.subDiv.Y=Math.floor(C.subDiv.max*C.bbSize.y/m),C.subDiv.Z=Math.floor(C.subDiv.max*C.bbSize.z/m),C.subDiv.X=C.subDiv.X<1?1:C.subDiv.X,C.subDiv.Y=C.subDiv.Y<1?1:C.subDiv.Y,C.subDiv.Z=C.subDiv.Z<1?1:C.subDiv.Z,C.facetParameters.facetNormals=this.getFacetLocalNormals(),C.facetParameters.facetPositions=this.getFacetLocalPositions(),C.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),C.facetParameters.bInfo=T,C.facetParameters.bbSize=C.bbSize,C.facetParameters.subDiv=C.subDiv,C.facetParameters.ratio=this.partitioningBBoxRatio,C.facetParameters.depthSort=C.facetDepthSort,C.facetDepthSort&&C.facetDepthSortEnabled&&(this.Be(!0),this._worldMatrix.invertToRef(C.invertedMatrix),z.m.TransformCoordinatesToRef(C.facetDepthSortFrom,C.invertedMatrix,C.facetDepthSortOrigin),C.facetParameters.distanceTo=C.facetDepthSortOrigin),C.facetParameters.depthSortedFacets=C.depthSortedFacets,f&&S.b.ComputeNormals(M,x,f,C.facetParameters),C.facetDepthSort&&C.facetDepthSortEnabled){C.depthSortedFacets.sort(C.facetDepthSortFunction);const M=C.depthSortedIndices.length/3|0;for(let f=0;f<M;f++){const M=C.depthSortedFacets[f].ind;C.depthSortedIndices[3*f]=x[M],C.depthSortedIndices[3*f+1]=x[M+1],C.depthSortedIndices[3*f+2]=x[M+2]}this.updateIndices(C.depthSortedIndices,void 0,!0)}return this}getFacetLocalNormals(){const C=this._internalAbstractMeshDataInfo._facetData;return C.facetNormals||this.updateFacetData(),C.facetNormals}getFacetLocalPositions(){const C=this._internalAbstractMeshDataInfo._facetData;return C.facetPositions||this.updateFacetData(),C.facetPositions}getFacetLocalPartitioning(){const C=this._internalAbstractMeshDataInfo._facetData;return C.facetPartitioning||this.updateFacetData(),C.facetPartitioning}getFacetPosition(C){const M=z.m.Zero();return this.getFacetPositionToRef(C,M),M}getFacetPositionToRef(C,M){const x=this.getFacetLocalPositions()[C],f=this.getWorldMatrix();return z.m.TransformCoordinatesToRef(x,f,M),this}getFacetNormal(C){const M=z.m.Zero();return this.getFacetNormalToRef(C,M),M}getFacetNormalToRef(C,M){const x=this.getFacetLocalNormals()[C];return z.m.TransformNormalToRef(x,this.getWorldMatrix(),M),this}getFacetsAtLocalCoordinates(C,M,x){const f=this.getBoundingInfo(),T=this._internalAbstractMeshDataInfo._facetData,z=Math.floor((C-f.minimum.x*T.partitioningBBoxRatio)*T.subDiv.X*T.partitioningBBoxRatio/T.bbSize.x),s=Math.floor((M-f.minimum.y*T.partitioningBBoxRatio)*T.subDiv.Y*T.partitioningBBoxRatio/T.bbSize.y),S=Math.floor((x-f.minimum.z*T.partitioningBBoxRatio)*T.subDiv.Z*T.partitioningBBoxRatio/T.bbSize.z);return z<0||z>T.subDiv.max||s<0||s>T.subDiv.max||S<0||S>T.subDiv.max?null:T.facetPartitioning[z+T.subDiv.max*s+T.subDiv.max*T.subDiv.max*S]}getClosestFacetAtCoordinates(C,M,x,f){let T=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const S=this.getWorldMatrix(),m=z.i.Matrix[5];S.invertToRef(m);const Q=z.i.Md[8];z.m.TransformCoordinatesFromFloatsToRef(C,M,x,m,Q);const V=this.getClosestFacetAtLocalCoordinates(Q.x,Q.y,Q.z,f,T,s);return f&&z.m.TransformCoordinatesFromFloatsToRef(f.x,f.y,f.z,S,f),V}getClosestFacetAtLocalCoordinates(C,M,x,f){let T=arguments.length>4&&void 0!==arguments[4]&&arguments[4],z=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s=null,S=0,m=0,Q=0,V=0,y=0,U=0,O=0,d=0;const D=this.getFacetLocalPositions(),o=this.getFacetLocalNormals(),L=this.getFacetsAtLocalCoordinates(C,M,x);if(!L)return null;let t,A,H,j=Number.MAX_VALUE,b=j;for(let R=0;R<L.length;R++)t=L[R],A=o[t],H=D[t],V=(C-H.x)*A.x+(M-H.y)*A.y+(x-H.z)*A.z,(!T||T&&z&&V>=0||T&&!z&&V<=0)&&(V=A.x*H.x+A.y*H.y+A.z*H.z,y=-(A.x*C+A.y*M+A.z*x-V)/(A.x*A.x+A.y*A.y+A.z*A.z),U=C+A.x*y,O=M+A.y*y,d=x+A.z*y,S=U-C,m=O-M,Q=d-x,b=S*S+m*m+Q*Q,b<j&&(j=b,s=t,f&&(f.x=U,f.y=O,f.z=d)));return s}getFacetDataParameters(){return this._internalAbstractMeshDataInfo._facetData.facetParameters}disableFacetData(){const C=this._internalAbstractMeshDataInfo._facetData;return C.facetDataEnabled&&(C.facetDataEnabled=!1,C.facetPositions=[],C.facetNormals=[],C.facetPartitioning=new Array,C.facetParameters=null,C.depthSortedIndices=new Uint32Array(0)),this}updateIndices(C,M){return this}createNormals(C){const M=this.getVerticesData(s.h.PositionKind),x=this.Ge();let f;return f=this.isVerticesDataPresent(s.h.NormalKind)?this.getVerticesData(s.h.NormalKind):[],S.b.ComputeNormals(M,x,f,{useRightHandedSystem:this.va().useRightHandedSystem}),this.Ga(s.h.NormalKind,f,C),this}alignWithNormal(C,M){M||(M=L.d.Y);const x=z.i.Md[0],f=z.i.Md[1];return z.m.CrossToRef(M,C,f),z.m.CrossToRef(C,f,x),this.rotationQuaternion?z.h.RotationQuaternionFromAxisToRef(x,C,f,this.rotationQuaternion):z.m.RotationFromAxisToRef(x,C,f,this.rotation),this}_checkOcclusionQuery(){return!1}disableEdgesRendering(){throw(0,O.d)("EdgesRenderer")}enableEdgesRendering(C,M,x){throw(0,O.d)("EdgesRenderer")}Aj(){return this._scene.te.filter((C=>C.k===this))}}R.OCCLUSION_TYPE_NONE=0,R.OCCLUSION_TYPE_OPTIMISTIC=1,R.OCCLUSION_TYPE_STRICT=2,R.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,R.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,R.CULLINGSTRATEGY_STANDARD=0,R.Yi=1,R.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,R.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,(0,f.e)([A.i.filter((function(){for(var C=arguments.length,M=new Array(C),x=0;x<C;x++)M[x]=arguments[x];let[f,T,z,s,S]=M;return!Array.isArray(f)&&!Array.isArray(T)&&!Array.isArray(z)&&!Array.isArray(s)&&!Array.isArray(S)}))],R,"_ApplySkeleton",null),(0,t.f)("BABYLON.AbstractMesh",R)},11748:(C,M,x)=>{"use strict";x.d(M,{b:()=>o});var f=x(978),T=x(1162),z=x(11739),s=x(1224),S=x(1294),m=x(11756),Q=x(1300),V=x(1192),y=x(1154),U=x(1317),O=x(1008),d=x(1178),D=x(1078);class o{get boundingBias(){return this._boundingBias}set boundingBias(C){this._boundingBias?this._boundingBias.p(C):this._boundingBias=C.clone(),this.Ea(!0,null)}static CreateGeometryForMesh(C){const M=new o(o.RandomId(),C.va());return M.Ca(C),M}get meshes(){return this._meshes}constructor(C,M,x){let f=arguments.length>3&&void 0!==arguments[3]&&arguments[3],T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this._positionsCache=[],this._parentContainer=null,this.useBoundingInfoFromGeometry=!1,this._scene=M||O.c.LastCreatedScene,this._scene&&(this.id=C,this.uniqueId=this._scene.getUniqueId(),this._engine=this._scene.getEngine(),this._meshes=[],this._vertexBuffers={},this._indices=[],this._updatable=f,x?this.setAllVerticesData(x,f):this._totalVertices=0,this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),T&&(this.Ca(T),T.Be(!0)))}get extend(){return this._extend}va(){return this._scene}getEngine(){return this._engine}isReady(){return 1===this.delayLoadState||0===this.delayLoadState}get doNotSerialize(){for(let C=0;C<this._meshes.length;C++)if(!this._meshes[C].doNotSerialize)return!1;return!0}_rebuild(){this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer"));const C=new Set;for(const M in this._vertexBuffers)C.add(this._vertexBuffers[M].getWrapperBuffer());C.forEach((C=>{C._rebuild()}))}setAllVerticesData(C,M){C.applyToGeometry(this,M),this._notifyUpdate()}Ga(C,M){let x=arguments.length>2&&void 0!==arguments[2]&&arguments[2],f=arguments.length>3?arguments[3]:void 0;x&&Array.isArray(M)&&(M=new Float32Array(M));const T=new s.h(this._engine,M,C,{updatable:x,postponeInternalCreation:0===this._meshes.length,stride:f,label:"Geometry_"+this.id+"_"+C});this.setVerticesBuffer(T)}removeVerticesData(C){this._vertexBuffers[C]&&(this._vertexBuffers[C].dispose(),delete this._vertexBuffers[C]),this._vertexArrayObjects&&this._disposeVertexArrayObjects()}setVerticesBuffer(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,x=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const T=C.getKind();this._vertexBuffers[T]&&x&&this._vertexBuffers[T].dispose(),C._buffer&&C._buffer._increaseReferences(),this._vertexBuffers[T]=C;const z=this._meshes,S=z.length;if(T===s.h.PositionKind){this._totalVertices=M??C._maxVerticesCount,this._updateExtend(C.getFloatData(this._totalVertices)),this._resetPointsArrayCache();const x=this._extend&&this._extend.minimum||new f.m(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),T=this._extend&&this._extend.maximum||new f.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);for(let C=0;C<S;C++){const M=z[C];M.buildBoundingInfo(x,T),M._createGlobalSubMesh(M.isUnIndexed),M.Be(!0),M.synchronizeInstances()}}this._notifyUpdate(T)}updateVerticesDataDirectly(C,M,x){let f=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const T=this.getVertexBuffer(C);T&&(T.updateDirectly(M,x,f),this._notifyUpdate(C))}updateVerticesData(C,M){let x=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const f=this.getVertexBuffer(C);f&&(f.update(M),C===s.h.PositionKind&&this.Ea(x,M),this._notifyUpdate(C))}Ea(C,M){if(C&&this._updateExtend(M),this._resetPointsArrayCache(),C){const C=this._meshes;for(const M of C){M.hasBoundingInfo?M.getBoundingInfo().reConstruct(this._extend.minimum,this._extend.maximum):M.buildBoundingInfo(this._extend.minimum,this._extend.maximum);const C=M.we;for(const M of C)M.refreshBoundingInfo()}}}_bind(C,M,x,f){if(!C)return;void 0===M&&(M=this._indexBuffer);const T=this.getVertexBuffers();if(!T)return;if(M!=this._indexBuffer||!this._vertexArrayObjects&&!f)return void this._engine.bindBuffers(T,M,C,x);const z=f||this._vertexArrayObjects,s=this._engine;z[C.key]||(z[C.key]=s.recordVertexArrayObject(T,M,C,x)),s.bindVertexArrayObject(z[C.key],M)}getTotalVertices(){return this.isReady()?this._totalVertices:0}getVerticesData(C,M,x){const f=this.getVertexBuffer(C);return f?f.getFloatData(this._totalVertices,x||M&&1!==this._meshes.length):null}copyVerticesData(C,M){const x=this.getVertexBuffer(C);if(!x)return;M[C]||(M[C]=new Float32Array(this._totalVertices*x.getSize()));const f=x.getData();f&&function(C,M,x,f,T,z,S,m){const Q=M*s.h.GetTypeByteLength(x),V=S*M;if(m.length!==V)throw new Error("Output length is not valid");if(x===s.h.FLOAT&&T===Q)if(C instanceof Array){const M=f/4;m.set(C,M)}else if(C instanceof ArrayBuffer){const M=new Float32Array(C,f,V);m.set(M)}else{const M=C.byteOffset+f;if(M%4)return D.e.Warn("CopyFloatData: copied misaligned data."),void m.set(new Float32Array(C.buffer.slice(M,M+4*V)));const x=new Float32Array(C.buffer,M,V);m.set(x)}else s.h.ForEach(C,f,T,M,x,V,z,((C,M)=>m[M]=C))}(f,x.getSize(),x.type,x.byteOffset,x.byteStride,x.normalized,this._totalVertices,M[C])}isVertexBufferUpdatable(C){const M=this._vertexBuffers[C];return!!M&&M.isUpdatable()}getVertexBuffer(C){return this.isReady()?this._vertexBuffers[C]:null}getVertexBuffers(){return this.isReady()?this._vertexBuffers:null}isVerticesDataPresent(C){return this._vertexBuffers?void 0!==this._vertexBuffers[C]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(C)}getVerticesDataKinds(){const C=[];let M;if(!this._vertexBuffers&&this._delayInfo)for(M in this._delayInfo)C.push(M);else for(M in this._vertexBuffers)C.push(M);return C}updateIndices(C,M){let x=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._indexBuffer)if(this._indexBufferIsUpdatable){const f=C.length!==this._indices.length;if(x||(this._indices=C.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,C,M),f)for(const C of this._meshes)C._createGlobalSubMesh(!0)}else this.setIndices(C,null,!0)}setIndexBuffer(C,M,x){this._indices=[],this._indexBufferIsUpdatable=!1,this._indexBuffer=C,this._totalVertices=M,this._totalIndices=x,C.is32Bits||(C.is32Bits=this._totalIndices>65535);for(const f of this._meshes)f._createGlobalSubMesh(!0),f.synchronizeInstances();this._notifyUpdate()}setIndices(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,x=arguments.length>2&&void 0!==arguments[2]&&arguments[2],f=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=C,this._indexBufferIsUpdatable=x,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,x,"Geometry_"+this.id+"_IndexBuffer")),void 0!=M&&(this._totalVertices=M);for(const T of this._meshes)T._createGlobalSubMesh(!f),T.synchronizeInstances();this._notifyUpdate()}getTotalIndices(){return this.isReady()?void 0!==this._totalIndices?this._totalIndices:this._indices.length:0}Ge(C,M){if(!this.isReady())return null;const x=this._indices;return M||C&&1!==this._meshes.length?x.slice():x}getIndexBuffer(){return this.isReady()?this._indexBuffer:null}_releaseVertexArrayObject(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;C&&this._vertexArrayObjects&&this._vertexArrayObjects[C.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[C.key]),delete this._vertexArrayObjects[C.key])}releaseForMesh(C,M){const x=this._meshes,f=x.indexOf(C);-1!==f&&(x.splice(f,1),this._vertexArrayObjects&&C._invalidateInstanceVertexArrayObject(),C._geometry=null,0===x.length&&M&&this.dispose())}Ca(C){if(C._geometry===this)return;const M=C._geometry;M&&M.releaseForMesh(C),this._vertexArrayObjects&&C._invalidateInstanceVertexArrayObject();const x=this._meshes;C._geometry=this,C._internalAbstractMeshDataInfo._positions=null,this._scene.pushGeometry(this),x.push(C),this.isReady()?this._applyToMesh(C):this._boundingInfo&&C.setBoundingInfo(this._boundingInfo)}_updateExtend(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.useBoundingInfoFromGeometry&&this._boundingInfo)this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()};else{if(!C&&(C=this.getVerticesData(s.h.PositionKind),!C))return;this._extend=(0,U.e)(C,0,this._totalVertices,this.boundingBias,3)}}_applyToMesh(C){const M=this._meshes.length;for(const x in this._vertexBuffers)1===M&&this._vertexBuffers[x].create(),x===s.h.PositionKind&&(this._extend||this._updateExtend(),C.buildBoundingInfo(this._extend.minimum,this._extend.maximum),C._createGlobalSubMesh(C.isUnIndexed),C.Ea());1===M&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer")),C._syncGeometryWithMorphTargetManager(),C.synchronizeInstances()}_notifyUpdate(C){this.onGeometryUpdated&&this.onGeometryUpdated(this,C),this._vertexArrayObjects&&this._disposeVertexArrayObjects();for(const M of this._meshes)M._markSubMeshesAsAttributesDirty()}load(C,M){2!==this.delayLoadState&&(this.isReady()?M&&M():(this.delayLoadState=2,this._queueLoad(C,M)))}_queueLoad(C,M){this.delayLoadingFile&&(C.addPendingData(this),C._loadFile(this.delayLoadingFile,(x=>{if(!this._delayLoadingFunction)return;this._delayLoadingFunction(JSON.parse(x),this),this.delayLoadState=1,this._delayInfo=[],C.removePendingData(this);const f=this._meshes,T=f.length;for(let C=0;C<T;C++)this._applyToMesh(f[C]);M&&M()}),void 0,!0))}toLeftHanded(){const C=this.Ge(!1);if(null!=C&&C.length>0){for(let M=0;M<C.length;M+=3){const x=C[M+0];C[M+0]=C[M+2],C[M+2]=x}this.setIndices(C)}const M=this.getVerticesData(s.h.PositionKind,!1);if(null!=M&&M.length>0){for(let C=0;C<M.length;C+=3)M[C+2]=-M[C+2];this.Ga(s.h.PositionKind,M,!1)}const x=this.getVerticesData(s.h.NormalKind,!1);if(null!=x&&x.length>0){for(let C=0;C<x.length;C+=3)x[C+2]=-x[C+2];this.Ga(s.h.NormalKind,x,!1)}}_resetPointsArrayCache(){this._positions=null}_generatePointsArray(){if(this._positions)return!0;const C=this.getVerticesData(s.h.PositionKind);if(!C||0===C.length)return!1;for(let M=3*this._positionsCache.length,x=this._positionsCache.length;M<C.length;M+=3,++x)this._positionsCache[x]=f.m.Dd(C,M);for(let M=0,x=0;M<C.length;M+=3,++x)this._positionsCache[x].set(C[0+M],C[1+M],C[2+M]);return this._positionsCache.length=C.length/3,this._positions=this._positionsCache,!0}u(){return this._isDisposed}_disposeVertexArrayObjects(){if(this._vertexArrayObjects){for(const x in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[x]);this._vertexArrayObjects={};const C=this._meshes,M=C.length;for(let x=0;x<M;x++)C[x]._invalidateInstanceVertexArrayObject()}}dispose(){const C=this._meshes,M=C.length;let x;for(x=0;x<M;x++)this.releaseForMesh(C[x]);this._meshes.length=0,this._disposeVertexArrayObjects();for(const f in this._vertexBuffers)this._vertexBuffers[f].dispose();if(this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._parentContainer){const C=this._parentContainer.geometries.indexOf(this);C>-1&&this._parentContainer.geometries.splice(C,1),this._parentContainer=null}this._isDisposed=!0}j(C){const M=new z.b;M.indices=[];const x=this.Ge();if(x)for(let z=0;z<x.length;z++)M.indices.push(x[z]);let f,T=!1,s=!1;for(f in this._vertexBuffers){const C=this.getVerticesData(f);if(C&&(C instanceof Float32Array?M.set(new Float32Array(C),f):M.set(C.slice(0),f),!s)){const C=this.getVertexBuffer(f);C&&(T=C.isUpdatable(),s=!T)}}const S=new o(C,this._scene,M,T);for(f in S.delayLoadState=this.delayLoadState,S.delayLoadingFile=this.delayLoadingFile,S._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)S._delayInfo=S._delayInfo||[],S._delayInfo.push(f);return S._boundingInfo=new Q.b(this._extend.minimum,this._extend.maximum),S}serialize(){const C={};return C.id=this.id,C.uniqueId=this.uniqueId,C.updatable=this._updatable,y.d&&y.d.HasTags(this)&&(C.tags=y.d.GetTags(this)),C}_toNumberArray(C){return Array.isArray(C)?C:Array.prototype.slice.call(C)}clearCachedData(){this._indices=[],this._resetPointsArrayCache();for(const C in this._vertexBuffers)Object.prototype.hasOwnProperty.call(this._vertexBuffers,C)&&(this._vertexBuffers[C]._buffer._data=null)}serializeVerticeData(){const C=this.serialize();return this.isVerticesDataPresent(s.h.PositionKind)&&(C.xa=this._toNumberArray(this.getVerticesData(s.h.PositionKind)),this.isVertexBufferUpdatable(s.h.PositionKind)&&(C.xa._updatable=!0)),this.isVerticesDataPresent(s.h.NormalKind)&&(C.ya=this._toNumberArray(this.getVerticesData(s.h.NormalKind)),this.isVertexBufferUpdatable(s.h.NormalKind)&&(C.ya._updatable=!0)),this.isVerticesDataPresent(s.h.TangentKind)&&(C.tangents=this._toNumberArray(this.getVerticesData(s.h.TangentKind)),this.isVertexBufferUpdatable(s.h.TangentKind)&&(C.tangents._updatable=!0)),this.isVerticesDataPresent(s.h.UVKind)&&(C.Aa=this._toNumberArray(this.getVerticesData(s.h.UVKind)),this.isVertexBufferUpdatable(s.h.UVKind)&&(C.Aa._updatable=!0)),this.isVerticesDataPresent(s.h.UV2Kind)&&(C.uvs2=this._toNumberArray(this.getVerticesData(s.h.UV2Kind)),this.isVertexBufferUpdatable(s.h.UV2Kind)&&(C.uvs2._updatable=!0)),this.isVerticesDataPresent(s.h.UV3Kind)&&(C.uvs3=this._toNumberArray(this.getVerticesData(s.h.UV3Kind)),this.isVertexBufferUpdatable(s.h.UV3Kind)&&(C.uvs3._updatable=!0)),this.isVerticesDataPresent(s.h.UV4Kind)&&(C.uvs4=this._toNumberArray(this.getVerticesData(s.h.UV4Kind)),this.isVertexBufferUpdatable(s.h.UV4Kind)&&(C.uvs4._updatable=!0)),this.isVerticesDataPresent(s.h.UV5Kind)&&(C.uvs5=this._toNumberArray(this.getVerticesData(s.h.UV5Kind)),this.isVertexBufferUpdatable(s.h.UV5Kind)&&(C.uvs5._updatable=!0)),this.isVerticesDataPresent(s.h.UV6Kind)&&(C.uvs6=this._toNumberArray(this.getVerticesData(s.h.UV6Kind)),this.isVertexBufferUpdatable(s.h.UV6Kind)&&(C.uvs6._updatable=!0)),this.isVerticesDataPresent(s.h.ColorKind)&&(C.za=this._toNumberArray(this.getVerticesData(s.h.ColorKind)),this.isVertexBufferUpdatable(s.h.ColorKind)&&(C.za._updatable=!0)),this.isVerticesDataPresent(s.h.MatricesIndicesKind)&&(C.matricesIndices=this._toNumberArray(this.getVerticesData(s.h.MatricesIndicesKind)),C.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(s.h.MatricesIndicesKind)&&(C.matricesIndices._updatable=!0)),this.isVerticesDataPresent(s.h.MatricesWeightsKind)&&(C.matricesWeights=this._toNumberArray(this.getVerticesData(s.h.MatricesWeightsKind)),this.isVertexBufferUpdatable(s.h.MatricesWeightsKind)&&(C.matricesWeights._updatable=!0)),C.indices=this._toNumberArray(this.Ge()),C}static ExtractFromMesh(C,M){const x=C._geometry;return x?x.j(M):null}static RandomId(){return V.i.RandomId()}static _GetGeometryByLoadedUniqueId(C,M){for(let x=0;x<M.geometries.length;x++)if(M.geometries[x]._loadedUniqueId===C)return M.geometries[x];return null}static _ImportGeometry(C,M){const x=M.va(),f=C.geometryUniqueId,z=C.geometryId;if(f||z){const C=f?this._GetGeometryByLoadedUniqueId(f,x):x.getGeometryById(z);C&&C.Ca(M)}else if(C instanceof ArrayBuffer){const x=M._binaryInfo;if(x.positionsAttrDesc&&x.positionsAttrDesc.count>0){const f=new Float32Array(C,x.positionsAttrDesc.offset,x.positionsAttrDesc.count);M.Ga(s.h.PositionKind,f,!1)}if(x.normalsAttrDesc&&x.normalsAttrDesc.count>0){const f=new Float32Array(C,x.normalsAttrDesc.offset,x.normalsAttrDesc.count);M.Ga(s.h.NormalKind,f,!1)}if(x.tangetsAttrDesc&&x.tangetsAttrDesc.count>0){const f=new Float32Array(C,x.tangetsAttrDesc.offset,x.tangetsAttrDesc.count);M.Ga(s.h.TangentKind,f,!1)}if(x.uvsAttrDesc&&x.uvsAttrDesc.count>0){const f=new Float32Array(C,x.uvsAttrDesc.offset,x.uvsAttrDesc.count);if(d.c)for(let C=1;C<f.length;C+=2)f[C]=1-f[C];M.Ga(s.h.UVKind,f,!1)}if(x.uvs2AttrDesc&&x.uvs2AttrDesc.count>0){const f=new Float32Array(C,x.uvs2AttrDesc.offset,x.uvs2AttrDesc.count);if(d.c)for(let C=1;C<f.length;C+=2)f[C]=1-f[C];M.Ga(s.h.UV2Kind,f,!1)}if(x.uvs3AttrDesc&&x.uvs3AttrDesc.count>0){const f=new Float32Array(C,x.uvs3AttrDesc.offset,x.uvs3AttrDesc.count);if(d.c)for(let C=1;C<f.length;C+=2)f[C]=1-f[C];M.Ga(s.h.UV3Kind,f,!1)}if(x.uvs4AttrDesc&&x.uvs4AttrDesc.count>0){const f=new Float32Array(C,x.uvs4AttrDesc.offset,x.uvs4AttrDesc.count);if(d.c)for(let C=1;C<f.length;C+=2)f[C]=1-f[C];M.Ga(s.h.UV4Kind,f,!1)}if(x.uvs5AttrDesc&&x.uvs5AttrDesc.count>0){const f=new Float32Array(C,x.uvs5AttrDesc.offset,x.uvs5AttrDesc.count);if(d.c)for(let C=1;C<f.length;C+=2)f[C]=1-f[C];M.Ga(s.h.UV5Kind,f,!1)}if(x.uvs6AttrDesc&&x.uvs6AttrDesc.count>0){const f=new Float32Array(C,x.uvs6AttrDesc.offset,x.uvs6AttrDesc.count);if(d.c)for(let C=1;C<f.length;C+=2)f[C]=1-f[C];M.Ga(s.h.UV6Kind,f,!1)}if(x.colorsAttrDesc&&x.colorsAttrDesc.count>0){const f=new Float32Array(C,x.colorsAttrDesc.offset,x.colorsAttrDesc.count);M.Ga(s.h.ColorKind,f,!1,x.colorsAttrDesc.stride)}if(x.matricesIndicesAttrDesc&&x.matricesIndicesAttrDesc.count>0){const f=new Int32Array(C,x.matricesIndicesAttrDesc.offset,x.matricesIndicesAttrDesc.count),T=[];for(let C=0;C<f.length;C++){const M=f[C];T.push(255&M),T.push((65280&M)>>8),T.push((16711680&M)>>16),T.push(M>>24&255)}M.Ga(s.h.MatricesIndicesKind,T,!1)}if(x.matricesIndicesExtraAttrDesc&&x.matricesIndicesExtraAttrDesc.count>0){const f=new Int32Array(C,x.matricesIndicesExtraAttrDesc.offset,x.matricesIndicesExtraAttrDesc.count),T=[];for(let C=0;C<f.length;C++){const M=f[C];T.push(255&M),T.push((65280&M)>>8),T.push((16711680&M)>>16),T.push(M>>24&255)}M.Ga(s.h.MatricesIndicesExtraKind,T,!1)}if(x.matricesWeightsAttrDesc&&x.matricesWeightsAttrDesc.count>0){const f=new Float32Array(C,x.matricesWeightsAttrDesc.offset,x.matricesWeightsAttrDesc.count);M.Ga(s.h.MatricesWeightsKind,f,!1)}if(x.indicesAttrDesc&&x.indicesAttrDesc.count>0){const f=new Int32Array(C,x.indicesAttrDesc.offset,x.indicesAttrDesc.count);M.setIndices(f,null)}if(x.subMeshesAttrDesc&&x.subMeshesAttrDesc.count>0){const f=new Int32Array(C,x.subMeshesAttrDesc.offset,5*x.subMeshesAttrDesc.count);M.we=[];for(let C=0;C<x.subMeshesAttrDesc.count;C++){const x=f[5*C+0],T=f[5*C+1],z=f[5*C+2],s=f[5*C+3],m=f[5*C+4];S.e.AddToMesh(x,T,z,s,m,M)}}}else if(C.xa&&C.ya&&C.indices){if(M.Ga(s.h.PositionKind,C.xa,C.xa._updatable),M.Ga(s.h.NormalKind,C.ya,C.ya._updatable),C.tangents&&M.Ga(s.h.TangentKind,C.tangents,C.tangents._updatable),C.Aa&&M.Ga(s.h.UVKind,C.Aa,C.Aa._updatable),C.uvs2&&M.Ga(s.h.UV2Kind,C.uvs2,C.uvs2._updatable),C.uvs3&&M.Ga(s.h.UV3Kind,C.uvs3,C.uvs3._updatable),C.uvs4&&M.Ga(s.h.UV4Kind,C.uvs4,C.uvs4._updatable),C.uvs5&&M.Ga(s.h.UV5Kind,C.uvs5,C.uvs5._updatable),C.uvs6&&M.Ga(s.h.UV6Kind,C.uvs6,C.uvs6._updatable),C.za&&M.Ga(s.h.ColorKind,T.e.CheckColors4(C.za,C.xa.length/3),C.za._updatable),C.matricesIndices)if(C.matricesIndices._isExpanded)delete C.matricesIndices._isExpanded,M.Ga(s.h.MatricesIndicesKind,C.matricesIndices,C.matricesIndices._updatable);else{const x=[];for(let M=0;M<C.matricesIndices.length;M++){const f=C.matricesIndices[M];x.push(255&f),x.push((65280&f)>>8),x.push((16711680&f)>>16),x.push(f>>24&255)}M.Ga(s.h.MatricesIndicesKind,x,C.matricesIndices._updatable)}if(C.matricesIndicesExtra)if(C.matricesIndicesExtra._isExpanded)delete C.matricesIndices._isExpanded,M.Ga(s.h.MatricesIndicesExtraKind,C.matricesIndicesExtra,C.matricesIndicesExtra._updatable);else{const x=[];for(let M=0;M<C.matricesIndicesExtra.length;M++){const f=C.matricesIndicesExtra[M];x.push(255&f),x.push((65280&f)>>8),x.push((16711680&f)>>16),x.push(f>>24&255)}M.Ga(s.h.MatricesIndicesExtraKind,x,C.matricesIndicesExtra._updatable)}C.matricesWeights&&(o._CleanMatricesWeights(C,M),M.Ga(s.h.MatricesWeightsKind,C.matricesWeights,C.matricesWeights._updatable)),C.matricesWeightsExtra&&M.Ga(s.h.MatricesWeightsExtraKind,C.matricesWeightsExtra,C.matricesWeights._updatable),M.setIndices(C.indices,null)}if(C.we){M.we=[];for(let x=0;x<C.we.length;x++){const f=C.we[x];S.e.AddToMesh(f.materialIndex,f.verticesStart,f.verticesCount,f.indexStart,f.indexCount,M)}}M._shouldGenerateFlatShading&&(M.convertToFlatShadedMesh(),M._shouldGenerateFlatShading=!1),M.Be(!0),x.onMeshImportedObservable.notifyObservers(M)}static _CleanMatricesWeights(C,M){const x=.001;if(!m.c.CleanBoneMatrixWeights)return;let f=0;if(!(C.skeletonId>-1))return;{const x=M.va().getLastSkeletonById(C.skeletonId);if(!x)return;f=x.bones.length}const T=M.getVerticesData(s.h.MatricesIndicesKind),z=M.getVerticesData(s.h.MatricesIndicesExtraKind),S=C.matricesWeights,Q=C.matricesWeightsExtra,V=C.numBoneInfluencer,y=S.length;for(let s=0;s<y;s+=4){let C=0,M=-1;for(let f=0;f<4;f++){const T=S[s+f];C+=T,T<x&&M<0&&(M=f)}if(Q)for(let f=0;f<4;f++){const T=Q[s+f];C+=T,T<x&&M<0&&(M=f+4)}if((M<0||M>V-1)&&(M=V-1),C>x){const M=1/C;for(let C=0;C<4;C++)S[s+C]*=M;if(Q)for(let C=0;C<4;C++)Q[s+C]*=M}else M>=4?(Q[s+M-4]=1-C,z[s+M-4]=f):(S[s+M]=1-C,T[s+M]=f)}M.Ga(s.h.MatricesIndicesKind,T),C.matricesWeightsExtra&&M.Ga(s.h.MatricesIndicesExtraKind,z)}static Parse(C,M,x){const T=new o(C.id,M,void 0,C.updatable);return T._loadedUniqueId=C.uniqueId,y.d&&y.d.AddTagsTo(T,C.tags),C.delayLoadingFile?(T.delayLoadState=4,T.delayLoadingFile=x+C.delayLoadingFile,T._boundingInfo=new Q.b(f.m.Dd(C.boundingBoxMinimum),f.m.Dd(C.boundingBoxMaximum)),T._delayInfo=[],C.hasUVs&&T._delayInfo.push(s.h.UVKind),C.hasUVs2&&T._delayInfo.push(s.h.UV2Kind),C.hasUVs3&&T._delayInfo.push(s.h.UV3Kind),C.hasUVs4&&T._delayInfo.push(s.h.UV4Kind),C.hasUVs5&&T._delayInfo.push(s.h.UV5Kind),C.hasUVs6&&T._delayInfo.push(s.h.UV6Kind),C.hasColors&&T._delayInfo.push(s.h.ColorKind),C.hasMatricesIndices&&T._delayInfo.push(s.h.MatricesIndicesKind),C.hasMatricesWeights&&T._delayInfo.push(s.h.MatricesWeightsKind),T._delayLoadingFunction=z.b.ImportVertexData):z.b.ImportVertexData(C,T),M.pushGeometry(T,!0),T}}},12357:(C,M,x)=>{"use strict";x.d(M,{d:()=>U});var f=x(978),T=x(1078),z=x(11763),s=x(11712),S=x(1196),m=x(11765),Q=x(1224),V=x(1192),y=x(997);s.d._instancedMeshFactory=(C,M)=>{const x=new U(C,M);if(M.instancedBuffers){x.instancedBuffers={};for(const C in M.instancedBuffers)x.instancedBuffers[C]=M.instancedBuffers[C]}return x};class U extends z.b{constructor(C,M){super(C,M.va()),this._indexInSourceMeshInstanceArray=-1,this._distanceToCamera=0,M.Oj(this),this._sourceMesh=M,this._unIndexed=M._unIndexed,this.position.p(M.position),this.rotation.p(M.rotation),this.Qd.p(M.Qd),M.rotationQuaternion&&(this.rotationQuaternion=M.rotationQuaternion.clone()),this.animations=M.animations.slice();for(const x of M.getAnimationRanges())null!=x&&this.createAnimationRange(x.name,x.from,x.to);this.infiniteDistance=M.infiniteDistance,this.setPivotMatrix(M.getPivotMatrix()),this.refreshBoundingInfo(!0,!0),this._syncSubMeshes()}getClassName(){return"InstancedMesh"}get lightSources(){return this._sourceMesh._lightSources}_resyncLightSources(){}_resyncLightSource(){}_removeLightSource(){}get receiveShadows(){return this._sourceMesh.receiveShadows}set receiveShadows(C){var M;(null===(M=this._sourceMesh)||void 0===M?void 0:M.receiveShadows)!==C&&V.i.Warn("Setting receiveShadows on an instanced mesh has no effect")}get material(){return this._sourceMesh.material}set material(C){var M;(null===(M=this._sourceMesh)||void 0===M?void 0:M.material)!==C&&V.i.Warn("Setting material on an instanced mesh has no effect")}get visibility(){return this._sourceMesh.visibility}set visibility(C){var M;(null===(M=this._sourceMesh)||void 0===M?void 0:M.visibility)!==C&&V.i.Warn("Setting visibility on an instanced mesh has no effect")}get skeleton(){return this._sourceMesh.skeleton}set skeleton(C){var M;(null===(M=this._sourceMesh)||void 0===M?void 0:M.skeleton)!==C&&V.i.Warn("Setting skeleton on an instanced mesh has no effect")}get renderingGroupId(){return this._sourceMesh.renderingGroupId}set renderingGroupId(C){this._sourceMesh&&C!==this._sourceMesh.renderingGroupId&&T.e.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")}getTotalVertices(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0}getTotalIndices(){return this._sourceMesh.getTotalIndices()}get sourceMesh(){return this._sourceMesh}Bb(C){return this._sourceMesh.Bb(C)}isReady(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._sourceMesh.isReady(C,!0)}getVerticesData(C,M,x){return this._sourceMesh.getVerticesData(C,M,x)}copyVerticesData(C,M){this._sourceMesh.copyVerticesData(C,M)}Ga(C,M,x,f){return this.sourceMesh&&this.sourceMesh.Ga(C,M,x,f),this.sourceMesh}updateVerticesData(C,M,x,f){return this.sourceMesh&&this.sourceMesh.updateVerticesData(C,M,x,f),this.sourceMesh}setIndices(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.sourceMesh&&this.sourceMesh.setIndices(C,M),this.sourceMesh}isVerticesDataPresent(C){return this._sourceMesh.isVerticesDataPresent(C)}Ge(){return this._sourceMesh.Ge()}get _positions(){return this._sourceMesh._positions}refreshBoundingInfo(){let C,M=arguments.length>0&&void 0!==arguments[0]&&arguments[0],x=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;C="object"===typeof M?M:{applySkeleton:M,applyMorph:x};const f=this._sourceMesh.Ee?this._sourceMesh.Ee.boundingBias:null;return this.Fa(this._sourceMesh._getData(C,null,Q.h.PositionKind),f),this}_preActivate(){return this._currentLOD&&this._currentLOD._preActivate(),this}_activate(C,M){if(super._activate(C,M),this._sourceMesh.we||T.e.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!==this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,C),M){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1}_postActivate(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)}getWorldMatrix(){if(this._currentLOD&&this._currentLOD.billboardMode!==m.e.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new f.d);const C=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,f.i.Md[7].p(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.p(this._currentLOD.Be(!0)),this._currentLOD.position.p(f.i.Md[7]),this._currentLOD._masterMesh=C,this._billboardWorldMatrix}return super.getWorldMatrix()}get isAnInstance(){return!0}getLOD(C){if(!C)return this;const M=this.sourceMesh.getLODLevels();if(M&&0!==M.length){const M=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(C,M.boundingSphere)}else this._currentLOD=this.sourceMesh;return this._currentLOD}_preActivateForIntermediateRendering(C){return this.sourceMesh._preActivateForIntermediateRendering(C)}_syncSubMeshes(){if(this.releaseSubMeshes(),this._sourceMesh.we)for(let C=0;C<this._sourceMesh.we.length;C++)this._sourceMesh.we[C].clone(this,this._sourceMesh);return this}_generatePointsArray(){return this._sourceMesh._generatePointsArray()}Ea(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}clone(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,x=arguments.length>2?arguments[2]:void 0;const f=((arguments.length>3?arguments[3]:void 0)||this._sourceMesh).Bb(C);if(S.d.DeepCopy(this,f,["name","we","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","zj","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo"],[]),this.refreshBoundingInfo(),M&&(f.parent=M),!x)for(let T=0;T<this.va().meshes.length;T++){const C=this.va().meshes[T];C.parent===this&&C.clone(C.name,f)}return f.Be(!0),this.onClonedObservable.notifyObservers(f),f}dispose(C){let M=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._sourceMesh.Nj(this),super.dispose(C,M)}_serializeAsParent(C){super._serializeAsParent(C),C.parentId=this._sourceMesh.uniqueId,C.parentInstanceIndex=this._indexInSourceMeshInstanceArray}instantiateHierarchy(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,M=arguments.length>1?arguments[1]:void 0,x=arguments.length>2?arguments[2]:void 0;const f=this.clone("Clone of "+(this.name||this.id),C||this.parent,!0,M&&M.newSourcedMesh);f&&x&&x(this,f);for(const T of this.getChildTransformNodes(!0))T.instantiateHierarchy(f,M,x);return f}}s.d.prototype.registerInstancedBuffer=function(C,M){var x,f;if(null===(x=this._userInstancedBuffersStorage)||void 0===x||null===(f=x.vertexBuffers[C])||void 0===f||f.dispose(),!this.instancedBuffers){this.instancedBuffers={};for(const C of this.instances)C.instancedBuffers={}}this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this.instancedBuffers[C]=null,this._userInstancedBuffersStorage.strides[C]=M,this._userInstancedBuffersStorage.sizes[C]=32*M,this._userInstancedBuffersStorage.data[C]=new Float32Array(this._userInstancedBuffersStorage.sizes[C]),this._userInstancedBuffersStorage.vertexBuffers[C]=new Q.h(this.getEngine(),this._userInstancedBuffersStorage.data[C],C,!0,!1,M,!0);for(const T of this.instances)T.instancedBuffers[C]=null;this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()},s.d.prototype._processInstancedBuffers=function(C,M){const x=C?C.length:0;for(const f in this.instancedBuffers){let T=this._userInstancedBuffersStorage.sizes[f];const z=this._userInstancedBuffersStorage.strides[f],s=(x+1)*z;for(;T<s;)T*=2;this._userInstancedBuffersStorage.data[f].length!=T&&(this._userInstancedBuffersStorage.data[f]=new Float32Array(T),this._userInstancedBuffersStorage.sizes[f]=T,this._userInstancedBuffersStorage.vertexBuffers[f]&&(this._userInstancedBuffersStorage.vertexBuffers[f].dispose(),this._userInstancedBuffersStorage.vertexBuffers[f]=null));const S=this._userInstancedBuffersStorage.data[f];let m=0;if(M){const C=this.instancedBuffers[f];C.toArray?C.toArray(S,m):C.copyToArray?C.copyToArray(S,m):S[m]=C,m+=z}for(let M=0;M<x;M++){const x=C[M].instancedBuffers[f];x.toArray?x.toArray(S,m):x.copyToArray?x.copyToArray(S,m):S[m]=x,m+=z}this._userInstancedBuffersStorage.vertexBuffers[f]?this._userInstancedBuffersStorage.vertexBuffers[f].updateDirectly(S,0):(this._userInstancedBuffersStorage.vertexBuffers[f]=new Q.h(this.getEngine(),this._userInstancedBuffersStorage.data[f],f,!0,!1,z,!0),this._invalidateInstanceVertexArrayObject())}},s.d.prototype._invalidateInstanceVertexArrayObject=function(){if(this._userInstancedBuffersStorage&&void 0!==this._userInstancedBuffersStorage.vertexArrayObjects){for(const C in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[C]);this._userInstancedBuffersStorage.vertexArrayObjects={}}},s.d.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(const C in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[C]&&this._userInstancedBuffersStorage.vertexBuffers[C].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}},(0,y.f)("BABYLON.InstancedMesh",U)},11712:(C,M,x)=>{"use strict";x.d(M,{d:()=>h,h:()=>X});var f=x(971),T=x(1192),z=x(1196),s=x(1154),S=x(11718),m=x(11726),Q=x(978),V=x(1162),y=x(11734),U=x(1224),O=x(11739),d=x(11748),D=x(11763),o=x(1294),L=x(1289),t=x(11768),A=x(11756),H=x(1145),j=x(1078),b=x(997),R=x(1067),n=x(1239);class I{constructor(C,M){this.distanceOrScreenCoverage=C,this.mesh=M}}class X{}class g{constructor(){this.visibleInstances={},this.batchCache=new B,this.batchCacheReplacementModeInFrozenMode=new B,this.instancesBufferSize=2048}}class B{constructor(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=[],this.hardwareInstancedRendering=[]}}class F{constructor(){this.instancesCount=0,this.matrixBuffer=null,this.previousMatrixBuffer=null,this.matrixBufferSize=512,this.matrixData=null,this.boundingVectors=[],this.worldMatrices=null}}class P{constructor(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._useLODScreenCoverage=!1,this._effectiveMaterial=null,this._forcedInstanceCount=0,this._overrideRenderingFillMode=null}}class h extends D.b{static _GetDefaultSideOrientation(C){return C||h.FRONTSIDE}get useLODScreenCoverage(){return this._internalMeshDataInfo._useLODScreenCoverage}set useLODScreenCoverage(C){this._internalMeshDataInfo._useLODScreenCoverage=C,this._sortLODLevels()}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(C){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==C&&(C&&this._internalMeshDataInfo._sourcePositions&&(this.Ga(U.h.PositionKind,this._internalMeshDataInfo._sourcePositions,!0),this._internalMeshDataInfo._sourceNormals&&this.Ga(U.h.NormalKind,this._internalMeshDataInfo._sourceNormals,!0),this._internalMeshDataInfo._sourcePositions=null,this._internalMeshDataInfo._sourceNormals=null),this._internalAbstractMeshDataInfo._computeBonesUsingShaders=C,this._markSubMeshesAsAttributesDirty())}get onBeforeRenderObservable(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new f.c),this._internalMeshDataInfo._onBeforeRenderObservable}get onBeforeBindObservable(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new f.c),this._internalMeshDataInfo._onBeforeBindObservable}get onAfterRenderObservable(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new f.c),this._internalMeshDataInfo._onAfterRenderObservable}get onBetweenPassObservable(){return this._internalMeshDataInfo._onBetweenPassObservable||(this._internalMeshDataInfo._onBetweenPassObservable=new f.c),this._internalMeshDataInfo._onBetweenPassObservable}get onBeforeDrawObservable(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new f.c),this._internalMeshDataInfo._onBeforeDrawObservable}set onBeforeDraw(C){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(C)}get hasInstances(){return this.instances.length>0}get hasThinInstances(){return(this.forcedInstanceCount||this._thinInstanceDataStorage.instancesCount||0)>0}get forcedInstanceCount(){return this._internalMeshDataInfo._forcedInstanceCount}set forcedInstanceCount(C){this._internalMeshDataInfo._forcedInstanceCount=C}get sideOrientation(){return this._internalMeshDataInfo._sideOrientation}set sideOrientation(C){this._internalMeshDataInfo._sideOrientation=C,this._internalAbstractMeshDataInfo._sideOrientationHint=this._scene.useRightHandedSystem&&1===C||!this._scene.useRightHandedSystem&&0===C}get overrideMaterialSideOrientation(){return this.sideOrientation}set overrideMaterialSideOrientation(C){this.sideOrientation=C,this.material&&(this.material.sideOrientation=null)}get overrideRenderingFillMode(){return this._internalMeshDataInfo._overrideRenderingFillMode}set overrideRenderingFillMode(C){this._internalMeshDataInfo._overrideRenderingFillMode=C}get material(){return this._internalAbstractMeshDataInfo._material}set material(C){C&&(this.material&&null===this.material.sideOrientation||this._internalAbstractMeshDataInfo._sideOrientationHint)&&(C.sideOrientation=null),this._setMaterial(C)}get source(){return this._internalMeshDataInfo._source}get cloneMeshMap(){return this._internalMeshDataInfo.meshMap}get isUnIndexed(){return this._unIndexed}set isUnIndexed(C){this._unIndexed!==C&&(this._unIndexed=C,this._markSubMeshesAsAttributesDirty())}get worldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesData}get previousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesPreviousData}get manualUpdateOfWorldMatrixInstancedBuffer(){return this._instanceDataStorage.manualUpdate}set manualUpdateOfWorldMatrixInstancedBuffer(C){this._instanceDataStorage.manualUpdate=C}get manualUpdateOfPreviousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.previousManualUpdate}set manualUpdateOfPreviousWorldMatrixInstancedBuffer(C){this._instanceDataStorage.previousManualUpdate=C}get forceWorldMatrixInstancedBufferUpdate(){return this._instanceDataStorage.forceMatrixUpdates}set forceWorldMatrixInstancedBufferUpdate(C){this._instanceDataStorage.forceMatrixUpdates=C}_copySource(C,M){let x=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const f=this.va();if(C._geometry&&C._geometry.Ca(this),z.d.DeepCopy(C,this,["name","material","skeleton","instances","parent","uniqueId","source","metadata","morphTargetManager","hasInstances","worldMatrixInstancedBuffer","previousWorldMatrixInstancedBuffer","hasLODLevels","Ee","isBlocked","areNormalsFrozen","facetNb","isFacetDataEnabled","lightSources","useBones","isAnInstance","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","zj","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","cloneMeshMap","hasBoundingInfo","physicsBody","physicsImpostor"],["_poseMatrix"]),this._internalMeshDataInfo._source=C,f.useClonedMeshMap&&(C._internalMeshDataInfo.meshMap||(C._internalMeshDataInfo.meshMap={}),C._internalMeshDataInfo.meshMap[this.uniqueId]=this),this._originalBuilderSideOrientation=C._originalBuilderSideOrientation,this._creationDataStorage=C._creationDataStorage,C._ranges){const M=C._ranges;for(const C in M)Object.prototype.hasOwnProperty.call(M,C)&&M[C]&&this.createAnimationRange(C,M[C].from,M[C].to)}if(C.metadata&&C.metadata.clone?this.metadata=C.metadata.clone():this.metadata=C.metadata,this._internalMetadata=C._internalMetadata,s.d&&s.d.HasTags(C)&&s.d.AddTagsTo(this,s.d.GetTags(C,!0)),this.Og(C.isEnabled(!1)),this.parent=C.parent,this.setPivotMatrix(C.getPivotMatrix(),this._postMultiplyPivotMatrix),this.id=this.name+"."+C.id,this.material=C.material,!M){const M=C.getDescendants(!0);for(let C=0;C<M.length;C++){const x=M[C];x.clone&&x.clone(this.name+"."+x.name,this)}}if(C.morphTargetManager&&(this.morphTargetManager=C.morphTargetManager),f.getPhysicsEngine){const M=f.getPhysicsEngine();if(x&&M)if(1===M.getPluginVersion()){const x=M.getImpostorForPhysicsObject(C);x&&(this.physicsImpostor=x.clone(this))}else 2===M.getPluginVersion()&&C.physicsBody&&C.physicsBody.clone(this)}for(let T=0;T<f.te.length;T++){const M=f.te[T];M.k===C&&M.clone(M.name,this)}this.skeleton=C.skeleton,this.refreshBoundingInfo(!0,!0),this.Be(!0)}constructor(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,z=arguments.length>4?arguments[4]:void 0,s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];super(C,M),this._internalMeshDataInfo=new P,this.delayLoadState=0,this.instances=[],this._creationDataStorage=null,this._geometry=null,this._instanceDataStorage=new g,this._thinInstanceDataStorage=new F,this._shouldGenerateFlatShading=!1,this._originalBuilderSideOrientation=h.DEFAULTSIDE,this.ignoreCameraMaxZ=!1,M=this.va(),this._scene.useRightHandedSystem?this.sideOrientation=0:this.sideOrientation=1,this._onBeforeDraw=(C,M,x)=>{C&&x&&(this._uniformBuffer?this.transferToEffect(M):x.bindOnlyWorldMatrix(M))},T&&this._copySource(T,z,s),null!==x&&(this.parent=x),this._instanceDataStorage.hardwareInstancedRendering=this.getEngine().getCaps().instancedArrays,this._internalMeshDataInfo._onMeshReadyObserverAdded=C=>{C.unregisterOnNextCall=!0,this.isReady(!0)?this.onMeshReadyObservable.notifyObservers(this):this._internalMeshDataInfo._checkReadinessObserver||(this._internalMeshDataInfo._checkReadinessObserver=this._scene.onBeforeRenderObservable.add((()=>{this.isReady(!0)&&(this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),this._internalMeshDataInfo._checkReadinessObserver=null,this.onMeshReadyObservable.notifyObservers(this))})))},this.onMeshReadyObservable=new f.c(this._internalMeshDataInfo._onMeshReadyObserverAdded),T&&T.onClonedObservable.notifyObservers(this)}instantiateHierarchy(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,M=arguments.length>1?arguments[1]:void 0,x=arguments.length>2?arguments[2]:void 0;const f=0===this.getTotalVertices()||M&&M.doNotInstantiate&&(!0===M.doNotInstantiate||M.doNotInstantiate(this))?this.clone("Clone of "+(this.name||this.id),C||this.parent,!0):this.Bb("instance of "+(this.name||this.id));f.parent=C||this.parent,f.position=this.position.clone(),f.Qd=this.Qd.clone(),this.rotationQuaternion?f.rotationQuaternion=this.rotationQuaternion.clone():f.rotation=this.rotation.clone(),x&&x(this,f);for(const T of this.getChildTransformNodes(!0))"InstancedMesh"===T.getClassName()&&"Mesh"===f.getClassName()&&T.sourceMesh===this?T.instantiateHierarchy(f,{doNotInstantiate:M&&M.doNotInstantiate||!1,newSourcedMesh:f},x):T.instantiateHierarchy(f,M,x);return f}getClassName(){return"Mesh"}get _isMesh(){return!0}toString(C){let M=super.toString(C);if(M+=", n vertices: "+this.getTotalVertices(),M+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(let x=0;x<this.animations.length;x++)M+=", animation[0]: "+this.animations[x].toString(C);if(C)if(this._geometry){const C=this.Ge(),x=this.getVerticesData(U.h.PositionKind);x&&C&&(M+=", flat shading: "+(x.length/3===C.length?"YES":"NO"))}else M+=", flat shading: UNKNOWN";return M}_unBindEffect(){super._unBindEffect();for(const C of this.instances)C._unBindEffect()}get hasLODLevels(){return this._internalMeshDataInfo._LODLevels.length>0}getLODLevels(){return this._internalMeshDataInfo._LODLevels}_sortLODLevels(){const C=this._internalMeshDataInfo._useLODScreenCoverage?-1:1;this._internalMeshDataInfo._LODLevels.sort(((M,x)=>M.distanceOrScreenCoverage<x.distanceOrScreenCoverage?C:M.distanceOrScreenCoverage>x.distanceOrScreenCoverage?-C:0))}addLODLevel(C,M){if(M&&M._masterMesh)return j.e.Warn("You cannot use a mesh as LOD level twice"),this;const x=new I(C,M);return this._internalMeshDataInfo._LODLevels.push(x),M&&(M._masterMesh=this),this._sortLODLevels(),this}getLODLevelAtDistance(C){const M=this._internalMeshDataInfo;for(let x=0;x<M._LODLevels.length;x++){const f=M._LODLevels[x];if(f.distanceOrScreenCoverage===C)return f.mesh}return null}removeLODLevel(C){const M=this._internalMeshDataInfo;for(let x=0;x<M._LODLevels.length;x++)M._LODLevels[x].mesh===C&&(M._LODLevels.splice(x,1),C&&(C._masterMesh=null));return this._sortLODLevels(),this}getLOD(C,M){const x=this._internalMeshDataInfo;if(!x._LODLevels||0===x._LODLevels.length)return this;const f=M||this.getBoundingInfo().boundingSphere,T=C.mode===m.c.ORTHOGRAPHIC_CAMERA?C.lj:f.centerWorld.rc(C.globalPosition).length();let z=T,s=1;if(x._useLODScreenCoverage){const M=C.screenArea;let x=f.radiusWorld*C.lj/T;x=x*x*Math.PI,z=x/M,s=-1}if(s*x._LODLevels[x._LODLevels.length-1].distanceOrScreenCoverage>s*z)return this.onLODLevelSelection&&this.onLODLevelSelection(z,this,this),this;for(let S=0;S<x._LODLevels.length;S++){const C=x._LODLevels[S];if(s*C.distanceOrScreenCoverage<s*z){if(C.mesh){if(4===C.mesh.delayLoadState)return C.mesh._checkDelayState(),this;if(2===C.mesh.delayLoadState)return this;C.mesh._preActivate(),C.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)}return this.onLODLevelSelection&&this.onLODLevelSelection(z,this,C.mesh),C.mesh}}return this.onLODLevelSelection&&this.onLODLevelSelection(z,this,this),this}get Ee(){return this._geometry}getTotalVertices(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()}getVerticesData(C,M,x,f){var T,z;if(!this._geometry)return null;let s=f||null===(T=this._userInstancedBuffersStorage)||void 0===T||null===(z=T.vertexBuffers[C])||void 0===z?void 0:z.getFloatData(this.instances.length+1,x||M&&1!==this._geometry.meshes.length);return s||(s=this._geometry.getVerticesData(C,M,x)),s}copyVerticesData(C,M){this._geometry&&this._geometry.copyVerticesData(C,M)}getVertexBuffer(C,M){var x;return this._geometry?(M||null===(x=this._userInstancedBuffersStorage)||void 0===x?void 0:x.vertexBuffers[C])??this._geometry.getVertexBuffer(C):null}isVerticesDataPresent(C,M){var x;return this._geometry?!M&&void 0!==(null===(x=this._userInstancedBuffersStorage)||void 0===x?void 0:x.vertexBuffers[C])||this._geometry.isVerticesDataPresent(C):!!this._delayInfo&&-1!==this._delayInfo.indexOf(C)}isVertexBufferUpdatable(C,M){if(!this._geometry)return!!this._delayInfo&&-1!==this._delayInfo.indexOf(C);if(!M){var x;const M=null===(x=this._userInstancedBuffersStorage)||void 0===x?void 0:x.vertexBuffers[C];if(M)return M.isUpdatable()}return this._geometry.isVertexBufferUpdatable(C)}getVerticesDataKinds(C){if(!this._geometry){const C=[];return this._delayInfo&&this._delayInfo.forEach((function(M){C.push(M)})),C}const M=this._geometry.getVerticesDataKinds();if(!C&&this._userInstancedBuffersStorage)for(const x in this._userInstancedBuffersStorage.vertexBuffers)-1===M.indexOf(x)&&M.push(x);return M}getTotalIndices(){return this._geometry?this._geometry.getTotalIndices():0}Ge(C,M){return this._geometry?this._geometry.Ge(C,M):[]}get isBlocked(){return null!==this._masterMesh&&void 0!==this._masterMesh}isReady(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0],M=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(2===this.delayLoadState)return!1;if(!super.isReady(C))return!1;if(!this.we||0===this.we.length)return!0;if(!C)return!0;const x=this.getEngine(),f=this.va(),T=M||x.getCaps().instancedArrays&&(this.instances.length>0||this.hasThinInstances);this.Be();const z=this.material||f.defaultMaterial;if(z)if(z._storeEffectOnSubMeshes)for(const U of this.we){const C=U.Ha();if(C)if(C._storeEffectOnSubMeshes){if(!C.isReadyForSubMesh(this,U,T))return!1}else if(!C.isReady(this,T))return!1}else if(!z.isReady(this,T))return!1;const s=x.currentRenderPassId;for(const U of this.lightSources){const C=U.getShadowGenerators();if(!C)continue;const M=C.values();for(let f=M.next();!0!==f.done;f=M.next()){var S,m,Q,V;const C=f.value;if(C&&(null===(S=C.getShadowMap())||void 0===S||!S.renderList||null!==(m=C.getShadowMap())&&void 0!==m&&m.renderList&&-1!==(null===(Q=C.getShadowMap())||void 0===Q||null===(V=Q.renderList)||void 0===V?void 0:V.indexOf(this)))){const M=C.getShadowMap().renderPassIds??[x.currentRenderPassId];for(let f=0;f<M.length;++f){x.currentRenderPassId=M[f];for(const M of this.we){var y;if(!C.isReady(M,T,(null===(y=M.Ha())||void 0===y?void 0:y.needAlphaBlendingForMesh(this))??!1))return x.currentRenderPassId=s,!1}}x.currentRenderPassId=s}}}for(const U of this._internalMeshDataInfo._LODLevels)if(U.mesh&&!U.mesh.isReady(T))return!1;return!0}get areNormalsFrozen(){return this._internalMeshDataInfo._areNormalsFrozen}ii(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this}unfreezeNormals(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this}set overridenInstanceCount(C){this._instanceDataStorage.overridenInstanceCount=C}_preActivate(){const C=this._internalMeshDataInfo,M=this.va().getRenderId();return C._preActivateId===M||(C._preActivateId=M,this._instanceDataStorage.visibleInstances=null),this}_preActivateForIntermediateRendering(C){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=C),this}_registerInstanceForRenderId(C,M){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:M,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[M]||(void 0!==this._instanceDataStorage.previousRenderId&&this._instanceDataStorage.isFrozen&&(this._instanceDataStorage.visibleInstances[this._instanceDataStorage.previousRenderId]=null),this._instanceDataStorage.previousRenderId=M,this._instanceDataStorage.visibleInstances[M]=new Array),this._instanceDataStorage.visibleInstances[M].push(C),this}_afterComputeWorldMatrix(){super._afterComputeWorldMatrix(),this.hasThinInstances&&(this.Da||this.thinInstanceRefreshBoundingInfo(!1))}_postActivate(){this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup&&(this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer),this.edgesRenderer.customInstances.push(this.getWorldMatrix()))}refreshBoundingInfo(){let C,M=arguments.length>0&&void 0!==arguments[0]&&arguments[0],x=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;C="object"===typeof M?M:{applySkeleton:M,applyMorph:x};const f=this.Ee?this.Ee.boundingBias:null;return this.Fa(this._getData(C,null,U.h.PositionKind),f),this}_createGlobalSubMesh(C){const M=this.getTotalVertices();if(!M||!this.Ge())return null;if(this.we&&this.we.length>0){const x=this.Ge();if(!x)return null;const f=x.length;let T=!1;if(C)T=!0;else for(const C of this.we){if(C.indexStart+C.indexCount>f){T=!0;break}if(C.verticesStart+C.verticesCount>M){T=!0;break}}if(!T)return this.we[0]}return this.releaseSubMeshes(),new o.e(0,0,M,0,this.getTotalIndices(),this)}subdivide(C){if(C<1)return;const M=this.getTotalIndices();let x=M/C|0,f=0;for(;x%3!==0;)x++;this.releaseSubMeshes();for(let T=0;T<C&&!(f>=M);T++)o.e.CreateFromIndices(0,f,T===C-1?M-f:x,this,void 0,!1),f+=x;this.refreshBoundingInfo(),this.synchronizeInstances()}Ga(C,M){let x=arguments.length>2&&void 0!==arguments[2]&&arguments[2],f=arguments.length>3?arguments[3]:void 0;if(this._geometry)this._geometry.Ga(C,M,x,f);else{const f=new O.b;f.set(M,C);const T=this.va();new d.b(d.b.RandomId(),T,f,x,this)}return this}removeVerticesData(C){this._geometry&&this._geometry.removeVerticesData(C)}markVerticesDataAsUpdatable(C){let M=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const x=this.getVertexBuffer(C);x&&x.isUpdatable()!==M&&this.Ga(C,this.getVerticesData(C),M)}setVerticesBuffer(C){let M=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._geometry||(this._geometry=d.b.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(C,null,M),this}updateVerticesData(C,M,x,f){return this._geometry?(f?(this.makeGeometryUnique(),this.updateVerticesData(C,M,x,!1)):this._geometry.updateVerticesData(C,M,x),this):this}updateMeshPositions(C){let M=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const x=this.getVerticesData(U.h.PositionKind);if(!x)return this;if(C(x),this.updateVerticesData(U.h.PositionKind,x,!1,!1),M){const C=this.Ge(),M=this.getVerticesData(U.h.NormalKind);if(!M)return this;O.b.ComputeNormals(x,C,M),this.updateVerticesData(U.h.NormalKind,M,!1,!1)}return this}makeGeometryUnique(){if(!this._geometry)return this;if(1===this._geometry.meshes.length)return this;const C=this._geometry,M=this._geometry.j(d.b.RandomId());return C.releaseForMesh(this,!0),M.Ca(this),this}setIndexBuffer(C,M,x){let f=this._geometry;f||(f=new d.b(d.b.RandomId(),this.va(),void 0,void 0,this)),f.setIndexBuffer(C,M,x)}setIndices(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,x=arguments.length>2&&void 0!==arguments[2]&&arguments[2],f=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this._geometry)this._geometry.setIndices(C,M,x,f);else{const M=new O.b;M.indices=C;const f=this.va();new d.b(d.b.RandomId(),f,M,x,this)}return this}updateIndices(C,M){let x=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this._geometry?(this._geometry.updateIndices(C,M,x),this):this}toLeftHanded(){return this._geometry?(this._geometry.toLeftHanded(),this):this}_bind(C,M,x){let f=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!this._geometry)return this;const T=this.va().getEngine();let z;if(this._unIndexed)if(this._getRenderingFillMode(x)===L.c.WireFrameFillMode)z=C._getLinesIndexBuffer(this.Ge(),T);else z=null;else switch(this._getRenderingFillMode(x)){case L.c.PointFillMode:z=null;break;case L.c.WireFrameFillMode:z=C._getLinesIndexBuffer(this.Ge(),T);break;default:case L.c.TriangleFillMode:z=this._geometry.getIndexBuffer()}return this._bindDirect(M,z,f)}_bindDirect(C,M){let x=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this._geometry?(this.morphTargetManager&&this.morphTargetManager.isUsingTextureForTargets&&this.morphTargetManager._bind(C),x&&this._userInstancedBuffersStorage&&!this.hasThinInstances?this._geometry._bind(C,M,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects):this._geometry._bind(C,M),this):this}_draw(C,M,x){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);const f=this.va().getEngine();return this._unIndexed&&M!==L.c.WireFrameFillMode||M==L.c.PointFillMode?f.drawArraysType(M,C.verticesStart,C.verticesCount,this.forcedInstanceCount||x):M==L.c.WireFrameFillMode?f.drawElementsType(M,0,C._linesIndexCount,this.forcedInstanceCount||x):f.drawElementsType(M,C.indexStart,C.indexCount,this.forcedInstanceCount||x),this}registerBeforeRender(C){return this.onBeforeRenderObservable.add(C),this}unregisterBeforeRender(C){return this.onBeforeRenderObservable.removeCallback(C),this}registerAfterRender(C){return this.onAfterRenderObservable.add(C),this}unregisterAfterRender(C){return this.onAfterRenderObservable.removeCallback(C),this}_getInstancesRenderList(C){let M=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._instanceDataStorage.isFrozen){if(M)return this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.hardwareInstancedRendering[C]=!1,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.renderSelf[C]=!0,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode;if(this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch}const x=this.va(),f=x._isInIntermediateRendering(),T=f?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,z=this._instanceDataStorage.batchCache;if(z.mustReturn=!1,z.renderSelf[C]=M||!T&&this.isEnabled()&&this.isVisible,z.visibleInstances[C]=null,this._instanceDataStorage.visibleInstances&&!M){const M=this._instanceDataStorage.visibleInstances,T=x.getRenderId(),s=f?M.intermediateDefaultRenderId:M.defaultRenderId;z.visibleInstances[C]=M[T],!z.visibleInstances[C]&&s&&(z.visibleInstances[C]=M[s])}return z.hardwareInstancedRendering[C]=!M&&this._instanceDataStorage.hardwareInstancedRendering&&null!==z.visibleInstances[C]&&void 0!==z.visibleInstances[C],this._instanceDataStorage.previousBatch=z,z}_renderWithInstances(C,M,x,f,T){const z=x.visibleInstances[C._id],s=z?z.length:0,S=this._instanceDataStorage,m=S.instancesBufferSize;let V=S.instancesBuffer,y=S.instancesPreviousBuffer;const O=16*(s+1)*4;for(;S.instancesBufferSize<O;)S.instancesBufferSize*=2;S.instancesData&&m==S.instancesBufferSize||(S.instancesData=new Float32Array(S.instancesBufferSize/4)),(this._scene.needsPreviousWorldMatrices&&!S.instancesPreviousData||m!=S.instancesBufferSize)&&(S.instancesPreviousData=new Float32Array(S.instancesBufferSize/4));let d=0,D=0;const o=x.renderSelf[C._id],L=!V||m!==S.instancesBufferSize||this._scene.needsPreviousWorldMatrices&&!S.instancesPreviousBuffer;if(this._instanceDataStorage.manualUpdate||S.isFrozen&&!L)D=(o?1:0)+s;else{const M=this.getWorldMatrix();if(o&&(this._scene.needsPreviousWorldMatrices&&(S.masterMeshPreviousWorldMatrix?(S.masterMeshPreviousWorldMatrix.copyToArray(S.instancesPreviousData,d),S.masterMeshPreviousWorldMatrix.p(M)):(S.masterMeshPreviousWorldMatrix=M.clone(),S.masterMeshPreviousWorldMatrix.copyToArray(S.instancesPreviousData,d))),M.copyToArray(S.instancesData,d),d+=16,D++),z){var t;if(h.INSTANCEDMESH_SORT_TRANSPARENT&&this._scene.activeCamera&&null!==(t=C.Ha())&&void 0!==t&&t.needAlphaBlendingForMesh(C.getRenderingMesh())){const C=this._scene.activeCamera.globalPosition;for(let M=0;M<z.length;M++){const x=z[M];x._distanceToCamera=Q.m.Distance(x.getBoundingInfo().boundingSphere.centerWorld,C)}z.sort(((C,M)=>C._distanceToCamera>M._distanceToCamera?-1:C._distanceToCamera<M._distanceToCamera?1:0))}for(let C=0;C<z.length;C++){const M=z[C],x=M.getWorldMatrix();x.copyToArray(S.instancesData,d),this._scene.needsPreviousWorldMatrices&&(M._previousWorldMatrix?(M._previousWorldMatrix.copyToArray(S.instancesPreviousData,d),M._previousWorldMatrix.p(x)):(M._previousWorldMatrix=x.clone(),M._previousWorldMatrix.copyToArray(S.instancesPreviousData,d))),d+=16,D++}}}return L?(V&&V.dispose(),y&&y.dispose(),V=new U.e(T,S.instancesData,!0,16,!1,!0),S.instancesBuffer=V,this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this._userInstancedBuffersStorage.vertexBuffers.world0=V.createVertexBuffer("world0",0,4),this._userInstancedBuffersStorage.vertexBuffers.world1=V.createVertexBuffer("world1",4,4),this._userInstancedBuffersStorage.vertexBuffers.world2=V.createVertexBuffer("world2",8,4),this._userInstancedBuffersStorage.vertexBuffers.world3=V.createVertexBuffer("world3",12,4),this._scene.needsPreviousWorldMatrices&&(y=new U.e(T,S.instancesPreviousData,!0,16,!1,!0),S.instancesPreviousBuffer=y,this._userInstancedBuffersStorage.vertexBuffers.previousWorld0=y.createVertexBuffer("previousWorld0",0,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld1=y.createVertexBuffer("previousWorld1",4,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld2=y.createVertexBuffer("previousWorld2",8,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld3=y.createVertexBuffer("previousWorld3",12,4)),this._invalidateInstanceVertexArrayObject()):this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||(V.updateDirectly(S.instancesData,0,D),!this._scene.needsPreviousWorldMatrices||this._instanceDataStorage.manualUpdate&&!this._instanceDataStorage.previousManualUpdate||y.updateDirectly(S.instancesPreviousData,0,D)),this._processInstancedBuffers(z,o),this.va()._activeIndices.addCount(C.indexCount*D,!1),T._currentDrawContext&&(T._currentDrawContext.useInstancing=!0),this._bind(C,f,M),this._draw(C,M,D),!this._scene.needsPreviousWorldMatrices||L||!this._instanceDataStorage.manualUpdate||this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||this._instanceDataStorage.previousManualUpdate||y.updateDirectly(S.instancesData,0,D),T.unbindInstanceAttributes(),this}_renderWithThinInstances(C,M,x,f){var T;const z=(null===(T=this._thinInstanceDataStorage)||void 0===T?void 0:T.instancesCount)??0;this.va()._activeIndices.addCount(C.indexCount*z,!1),f._currentDrawContext&&(f._currentDrawContext.useInstancing=!0),this._bind(C,x,M),this._draw(C,M,z),this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&this._thinInstanceDataStorage.matrixData&&(this._thinInstanceDataStorage.previousMatrixBuffer?this._thinInstanceDataStorage.previousMatrixBuffer.updateDirectly(this._thinInstanceDataStorage.matrixData,0,z):this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.matrixData,!1)),f.unbindInstanceAttributes()}_processInstancedBuffers(C,M){}_processRendering(C,M,x,f,T,z,s,S){const m=this.va(),Q=m.getEngine();if(f=this._getRenderingFillMode(f),z&&M.getRenderingMesh().hasThinInstances)return this._renderWithThinInstances(M,f,x,Q),this;if(z)this._renderWithInstances(M,f,T,x,Q);else{Q._currentDrawContext&&(Q._currentDrawContext.useInstancing=!1);let x=0;T.renderSelf[M._id]&&(s&&s(!1,C.getWorldMatrix(),S),x++,this._draw(M,f,this._instanceDataStorage.overridenInstanceCount));const z=T.visibleInstances[M._id];if(z){const C=z.length;x+=C;for(let x=0;x<C;x++){const C=z[x].getWorldMatrix();s&&s(!0,C,S),this._draw(M,f)}}m._activeIndices.addCount(M.indexCount*x,!1)}return this}_rebuild(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._instanceDataStorage.instancesBuffer&&(C&&this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),this._userInstancedBuffersStorage){for(const M in this._userInstancedBuffersStorage.vertexBuffers){const x=this._userInstancedBuffersStorage.vertexBuffers[M];x&&(C&&x.dispose(),this._userInstancedBuffersStorage.vertexBuffers[M]=null)}this._userInstancedBuffersStorage.vertexArrayObjects&&(this._userInstancedBuffersStorage.vertexArrayObjects={})}this._internalMeshDataInfo._effectiveMaterial=null,super._rebuild(C)}_freeze(){if(this.we){for(let C=0;C<this.we.length;C++)this._getInstancesRenderList(C);this._internalMeshDataInfo._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}}_unFreeze(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null}renderWithRenderPassId(C,M,x,f){let T=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const z=this._scene.getEngine(),s=z.currentRenderPassId;if(void 0!==C&&(z.currentRenderPassId=C),f)(!T||T&&f.isInFrustum(this._scene._frustumPlanes))&&this.render(f,!!M,x);else for(let S=0;S<this.we.length;S++){const C=this.we[S];(!T||T&&C.isInFrustum(this._scene._frustumPlanes))&&this.render(C,!!M,x)}return void 0!==C&&(z.currentRenderPassId=s),this}directRender(){if(!this.we)return this;for(const C of this.we)this.render(C,!1);return this}render(C,M,x){var f,T,z;const s=this.va();this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1;const S=(null===(f=s.activeCameras)||void 0===f?void 0:f.length)??0;if((S>1&&s.activeCamera===s.activeCameras[0]||S<=1)&&this._checkOcclusionQuery()&&!this._occlusionDataStorage.forceRenderingWhenOccluded)return this;const m=this._getInstancesRenderList(C._id,!!x);if(m.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const Q=s.getEngine();let V=0,y=null;this.ignoreCameraMaxZ&&s.activeCamera&&!s._isInIntermediateRendering()&&(V=s.activeCamera.maxZ,y=s.activeCamera,s.activeCamera.maxZ=0,s.updateTransformMatrix(!0)),this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);const U=C.getRenderingMesh(),O=m.hardwareInstancedRendering[C._id]||U.hasThinInstances||!!this._userInstancedBuffersStorage&&!C.getMesh()._internalAbstractMeshDataInfo._actAsRegularMesh,d=this._instanceDataStorage,D=C.Ha();if(!D)return y&&(y.maxZ=V,s.updateTransformMatrix(!0)),this;if(d.isFrozen&&this._internalMeshDataInfo._effectiveMaterial&&this._internalMeshDataInfo._effectiveMaterial===D){if(D._storeEffectOnSubMeshes&&(null===(T=C._drawWrapper)||void 0===T||!T._wasPreviouslyReady)||!D._storeEffectOnSubMeshes&&!D._getDrawWrapper()._wasPreviouslyReady)return y&&(y.maxZ=V,s.updateTransformMatrix(!0)),this}else{if(D._storeEffectOnSubMeshes){if(!D.isReadyForSubMesh(this,C,O))return y&&(y.maxZ=V,s.updateTransformMatrix(!0)),this}else if(!D.isReady(this,O))return y&&(y.maxZ=V,s.updateTransformMatrix(!0)),this;this._internalMeshDataInfo._effectiveMaterial=D}let o;M&&Q.setAlphaMode(this._internalMeshDataInfo._effectiveMaterial.alphaMode),o=this._internalMeshDataInfo._effectiveMaterial._storeEffectOnSubMeshes?C._drawWrapper:this._internalMeshDataInfo._effectiveMaterial._getDrawWrapper();const t=(null===(z=o)||void 0===z?void 0:z.effect)??null;for(const L of s._beforeRenderingMeshStage)L.action(this,C,m,t);if(!o||!t)return y&&(y.maxZ=V,s.updateTransformMatrix(!0)),this;const A=x||this;let H;if(d.isFrozen||!this._internalMeshDataInfo._effectiveMaterial.Me&&null===this._internalMeshDataInfo._effectiveMaterial.sideOrientation&&!this._internalMeshDataInfo._effectiveMaterial.twoSidedLighting)H=d.sideOrientation;else{const C=A._getWorldMatrixDeterminant();H=this._internalMeshDataInfo._effectiveMaterial._getEffectiveOrientation(this),C<0&&(H=H===L.c.ClockWiseSideOrientation?L.c.CounterClockWiseSideOrientation:L.c.ClockWiseSideOrientation),d.sideOrientation=H}const j=this._internalMeshDataInfo._effectiveMaterial._preBind(o,H);this._internalMeshDataInfo._effectiveMaterial.forceDepthWrite&&Q.setDepthWrite(!0);const b=this._internalMeshDataInfo._effectiveMaterial,R=b.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),O||this._bind(C,t,R,!1);const n=A.getWorldMatrix();b._storeEffectOnSubMeshes?b.bindForSubMesh(n,this,C):b.bind(n,this),!b.Me&&b.separateCullingPass&&(Q.setState(!0,b.zOffset,!1,!j,b.cullBackFaces,b.stencil,b.zOffsetUnits),this._processRendering(this,C,t,R,m,O,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),Q.setState(!0,b.zOffset,!1,j,b.cullBackFaces,b.stencil,b.zOffsetUnits),this._internalMeshDataInfo._onBetweenPassObservable&&this._internalMeshDataInfo._onBetweenPassObservable.notifyObservers(C)),this._processRendering(this,C,t,R,m,O,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),this._internalMeshDataInfo._effectiveMaterial.unbind();for(const L of s._afterRenderingMeshStage)L.action(this,C,m,t);return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),y&&(y.maxZ=V,s.updateTransformMatrix(!0)),2!==s.performancePriority||d.isFrozen||this._freeze(),this}cleanMatrixWeights(){this.isVerticesDataPresent(U.h.MatricesWeightsKind)&&(this.isVerticesDataPresent(U.h.MatricesWeightsExtraKind)?this._normalizeSkinWeightsAndExtra():this._normalizeSkinFourWeights())}_normalizeSkinFourWeights(){const C=this.getVerticesData(U.h.MatricesWeightsKind),M=C.length;for(let x=0;x<M;x+=4){const M=C[x]+C[x+1]+C[x+2]+C[x+3];if(0===M)C[x]=1;else{const f=1/M;C[x]*=f,C[x+1]*=f,C[x+2]*=f,C[x+3]*=f}}this.Ga(U.h.MatricesWeightsKind,C)}_normalizeSkinWeightsAndExtra(){const C=this.getVerticesData(U.h.MatricesWeightsExtraKind),M=this.getVerticesData(U.h.MatricesWeightsKind),x=M.length;for(let f=0;f<x;f+=4){let x=M[f]+M[f+1]+M[f+2]+M[f+3];if(x+=C[f]+C[f+1]+C[f+2]+C[f+3],0===x)M[f]=1;else{const T=1/x;M[f]*=T,M[f+1]*=T,M[f+2]*=T,M[f+3]*=T,C[f]*=T,C[f+1]*=T,C[f+2]*=T,C[f+3]*=T}}this.Ga(U.h.MatricesWeightsKind,M),this.Ga(U.h.MatricesWeightsKind,C)}validateSkinning(){const C=this.getVerticesData(U.h.MatricesWeightsExtraKind),M=this.getVerticesData(U.h.MatricesWeightsKind);if(null===M||null==this.skeleton)return{skinned:!1,valid:!0,Td:"not skinned"};const x=M.length;let f=0,T=0,z=0,s=0;const S=null===C?4:8,m=[];for(let U=0;U<=S;U++)m[U]=0;for(let U=0;U<x;U+=4){let x=M[U],Q=x,V=0===Q?0:1;for(let T=1;T<S;T++){const z=T<4?M[U+T]:C[U+T-4];z>x&&f++,0!==z&&V++,Q+=z,x=z}if(m[V]++,V>z&&(z=V),0===Q)T++;else{const x=1/Q;let f=0;for(let T=0;T<S;T++)f+=T<4?Math.abs(M[U+T]-M[U+T]*x):Math.abs(C[U+T-4]-C[U+T-4]*x);f>.001&&s++}}const Q=this.skeleton.bones.length,V=this.getVerticesData(U.h.MatricesIndicesKind),y=this.getVerticesData(U.h.MatricesIndicesExtraKind);let O=0;for(let U=0;U<x;U+=4)for(let C=0;C<S;C++){const M=C<4?V[U+C]:y[U+C-4];(M>=Q||M<0)&&O++}return{skinned:!0,valid:0===T&&0===s&&0===O,Td:"Number of Weights = "+x/4+"\nMaximum influences = "+z+"\nMissing Weights = "+T+"\nNot Sorted = "+f+"\nNot Normalized = "+s+"\nWeightCounts = ["+m+"]\nNumber of bones = "+Q+"\nBad Bone Indices = "+O}}_checkDelayState(){const C=this.va();return this._geometry?this._geometry.load(C):4===this.delayLoadState&&(this.delayLoadState=2,this._queueLoad(C)),this}_queueLoad(C){C.addPendingData(this);const M=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return T.i.LoadFile(this.delayLoadingFile,(M=>{M instanceof ArrayBuffer?this._delayLoadingFunction(M,this):this._delayLoadingFunction(JSON.parse(M),this),this.instances.forEach((C=>{C.refreshBoundingInfo(),C._syncSubMeshes()})),this.delayLoadState=1,C.removePendingData(this)}),(()=>{}),C.offlineProvider,M),this}isInFrustum(C){return 2!==this.delayLoadState&&(!!super.isInFrustum(C)&&(this._checkDelayState(),!0))}setMaterialById(C){const M=this.va().materials;let x;for(x=M.length-1;x>-1;x--)if(M[x].id===C)return this.material=M[x],this;const f=this.va().multiMaterials;for(x=f.length-1;x>-1;x--)if(f[x].id===C)return this.material=f[x],this;return this}getAnimatables(){const C=[];return this.material&&C.push(this.material),this.skeleton&&C.push(this.skeleton),C}bakeTransformIntoVertices(C){if(!this.isVerticesDataPresent(U.h.PositionKind))return this;const M=this.we.splice(0);this._resetPointsArrayCache();let x=this.getVerticesData(U.h.PositionKind);const f=Q.m.Zero();let T;for(T=0;T<x.length;T+=3)Q.m.TransformCoordinatesFromFloatsToRef(x[T],x[T+1],x[T+2],C,f).toArray(x,T);if(this.Ga(U.h.PositionKind,x,this.getVertexBuffer(U.h.PositionKind).isUpdatable()),this.isVerticesDataPresent(U.h.NormalKind)){for(x=this.getVerticesData(U.h.NormalKind),T=0;T<x.length;T+=3)Q.m.TransformNormalFromFloatsToRef(x[T],x[T+1],x[T+2],C,f).normalize().toArray(x,T);this.Ga(U.h.NormalKind,x,this.getVertexBuffer(U.h.NormalKind).isUpdatable())}if(this.isVerticesDataPresent(U.h.TangentKind)){for(x=this.getVerticesData(U.h.TangentKind),T=0;T<x.length;T+=4)Q.m.TransformNormalFromFloatsToRef(x[T],x[T+1],x[T+2],C,f).normalize().toArray(x,T);this.Ga(U.h.TangentKind,x,this.getVertexBuffer(U.h.TangentKind).isUpdatable())}return C.determinant()<0&&this.flipFaces(),this.releaseSubMeshes(),this.we=M,this}bakeCurrentTransformIntoVertices(){let C=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.bakeTransformIntoVertices(this.Be(!0)),this.resetLocalMatrix(C),this}get _positions(){return this._internalAbstractMeshDataInfo._positions||this._geometry&&this._geometry._positions||null}_resetPointsArrayCache(){return this._geometry&&this._geometry._resetPointsArrayCache(),this}_generatePointsArray(){return!!this._geometry&&this._geometry._generatePointsArray()}clone(){let C=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,M=arguments.length>2?arguments[2]:void 0,x=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return new h(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",this.va(),C,this,M,x)}dispose(C){let M=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);const x=this._internalMeshDataInfo;if(x._onBeforeDrawObservable&&x._onBeforeDrawObservable.clear(),x._onBeforeBindObservable&&x._onBeforeBindObservable.clear(),x._onBeforeRenderObservable&&x._onBeforeRenderObservable.clear(),x._onAfterRenderObservable&&x._onAfterRenderObservable.clear(),x._onBetweenPassObservable&&x._onBetweenPassObservable.clear(),this._scene.useClonedMeshMap){if(x.meshMap)for(const C in x.meshMap){const M=x.meshMap[C];M&&(M._internalMeshDataInfo._source=null,x.meshMap[C]=void 0)}x._source&&x._source._internalMeshDataInfo.meshMap&&(x._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else{const C=this.va().meshes;for(const M of C){const C=M;C._internalMeshDataInfo&&C._internalMeshDataInfo._source&&C._internalMeshDataInfo._source===this&&(C._internalMeshDataInfo._source=null)}}x._source=null,this._instanceDataStorage.visibleInstances={},this._disposeInstanceSpecificData(),this._disposeThinInstanceSpecificData(),this._internalMeshDataInfo._checkReadinessObserver&&this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),super.dispose(C,M)}_disposeInstanceSpecificData(){}_disposeThinInstanceSpecificData(){}_invalidateInstanceVertexArrayObject(){}applyDisplacementMap(C,M,x,f,z,s){let S=arguments.length>6&&void 0!==arguments[6]&&arguments[6],m=arguments.length>7?arguments[7]:void 0;const Q=this.va();return T.i.LoadImage(C,(C=>{const T=C.width,m=C.height,Q=this.getEngine().createCanvas(T,m).getContext("2d");Q.drawImage(C,0,0);const V=Q.getImageData(0,0,T,m).data;this.applyDisplacementMapFromBuffer(V,T,m,M,x,z,s,S),f&&f(this)}),m||(()=>{}),Q.offlineProvider),this}applyDisplacementMapFromBuffer(C,M,x,f,T,z,s){let S=arguments.length>7&&void 0!==arguments[7]&&arguments[7];if(!this.isVerticesDataPresent(U.h.PositionKind)||!this.isVerticesDataPresent(U.h.NormalKind)||!this.isVerticesDataPresent(U.h.UVKind))return j.e.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;const m=this.getVerticesData(U.h.PositionKind,!0,!0),V=this.getVerticesData(U.h.NormalKind),y=this.getVerticesData(U.h.UVKind);let d=Q.m.Zero();const D=Q.m.Zero(),o=Q.j.Zero();z=z||Q.j.Zero(),s=s||new Q.j(1,1);for(let U=0;U<m.length;U+=3){Q.m.FromArrayToRef(m,U,d),Q.m.FromArrayToRef(V,U,D),Q.j.FromArrayToRef(y,U/3*2,o);const S=4*((Math.abs(o.x*s.x+z.x%1)*(M-1)%M|0)+(Math.abs(o.y*s.y+z.y%1)*(x-1)%x|0)*M),O=.3*(C[S]/255)+.59*(C[S+1]/255)+.11*(C[S+2]/255);D.normalize(),D.scaleInPlace(f+(T-f)*O),d=d.add(D),d.toArray(m,U)}return O.b.ComputeNormals(m,this.Ge(),V),S?(this.Ga(U.h.PositionKind,m),this.Ga(U.h.NormalKind,V),this.Ga(U.h.UVKind,y)):(this.updateVerticesData(U.h.PositionKind,m),this.updateVerticesData(U.h.NormalKind,V)),this}_getFlattenedNormals(C,M){const x=new Float32Array(3*C.length);let f=0;const T=this.sideOrientation===(this._scene.useRightHandedSystem?1:0);for(let z=0;z<C.length;z+=3){const s=Q.m.Dd(M,3*C[z]),S=Q.m.Dd(M,3*C[z+1]),m=Q.m.Dd(M,3*C[z+2]),V=s.rc(S),y=m.rc(S),U=Q.m.Normalize(Q.m.Cross(V,y));T&&U.scaleInPlace(-1);for(let C=0;C<3;C++)x[f++]=U.x,x[f++]=U.y,x[f++]=U.z}return x}_convertToUnIndexedMesh(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const M=this.getVerticesDataKinds().filter((C=>{var M;return!(null!==(M=this.getVertexBuffer(C))&&void 0!==M&&M.getIsInstanced())})),x=this.Ge(),f={},T=(C,M)=>{const f=new Float32Array(x.length*M);let T=0;for(let z=0;z<x.length;z++)for(let s=0;s<M;s++)f[T++]=C[x[z]*M+s];return f},z=this.getBoundingInfo(),s=this.Ee?this.we.slice(0):[];for(const S of M)f[S]=this.getVerticesData(S);for(const S of M){const M=this.getVertexBuffer(S),z=M.getSize();if(C&&S===U.h.NormalKind){const C=this._getFlattenedNormals(x,f[U.h.PositionKind]);this.Ga(U.h.NormalKind,C,M.isUpdatable(),z)}else this.Ga(S,T(f[S],z),M.isUpdatable(),z)}if(this.morphTargetManager){for(let M=0;M<this.morphTargetManager.numTargets;M++){const f=this.morphTargetManager.getTarget(M),z=f.getPositions();f.setPositions(T(z,3));const s=f.getNormals();s&&f.setNormals(C?this._getFlattenedNormals(x,z):T(s,3));const S=f.getTangents();S&&f.setTangents(T(S,3));const m=f.getUVs();m&&f.setUVs(T(m,2))}this.morphTargetManager.synchronize()}for(let S=0;S<x.length;S++)x[S]=S;this.setIndices(x),this._unIndexed=!0,this.releaseSubMeshes();for(const S of s){const C=S.getBoundingInfo();o.e.AddToMesh(S.materialIndex,S.indexStart,S.indexCount,S.indexStart,S.indexCount,this).setBoundingInfo(C)}return this.setBoundingInfo(z),this.synchronizeInstances(),this}convertToFlatShadedMesh(){return this._convertToUnIndexedMesh(!0)}convertToUnIndexedMesh(){return this._convertToUnIndexedMesh()}flipFaces(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const M=O.b.ExtractFromMesh(this);let x;if(C&&this.isVerticesDataPresent(U.h.NormalKind)&&M.ya){for(x=0;x<M.ya.length;x++)M.ya[x]*=-1;this.Ga(U.h.NormalKind,M.ya,this.isVertexBufferUpdatable(U.h.NormalKind))}if(M.indices){let C;for(x=0;x<M.indices.length;x+=3)C=M.indices[x+1],M.indices[x+1]=M.indices[x+2],M.indices[x+2]=C;this.setIndices(M.indices,null,this.isVertexBufferUpdatable(U.h.PositionKind),!0)}return this}increaseVertices(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const M=O.b.ExtractFromMesh(this),x=M.indices&&!Array.isArray(M.indices)&&Array.from?Array.from(M.indices):M.indices,f=M.xa&&!Array.isArray(M.xa)&&Array.from?Array.from(M.xa):M.xa,T=M.Aa&&!Array.isArray(M.Aa)&&Array.from?Array.from(M.Aa):M.Aa,z=M.ya&&!Array.isArray(M.ya)&&Array.from?Array.from(M.ya):M.ya;if(x&&f){M.indices=x,M.xa=f,T&&(M.Aa=T),z&&(M.ya=z);const s=C+1,S=new Array;for(let C=0;C<s+1;C++)S[C]=new Array;let m,V;const y=new Q.m(0,0,0),O=new Q.m(0,0,0),d=new Q.j(0,0),D=new Array,o=new Array,L=new Array;let t,A,H,j=f.length;T&&(A=T.length),z&&(H=z.length);for(let C=0;C<x.length;C+=3){o[0]=x[C],o[1]=x[C+1],o[2]=x[C+2];for(let C=0;C<3;C++)if(m=o[C],V=o[(C+1)%3],void 0===L[m]&&void 0===L[V]?(L[m]=new Array,L[V]=new Array):(void 0===L[m]&&(L[m]=new Array),void 0===L[V]&&(L[V]=new Array)),void 0===L[m][V]&&void 0===L[V][m]){L[m][V]=[],y.x=(f[3*V]-f[3*m])/s,y.y=(f[3*V+1]-f[3*m+1])/s,y.z=(f[3*V+2]-f[3*m+2])/s,z&&(O.x=(z[3*V]-z[3*m])/s,O.y=(z[3*V+1]-z[3*m+1])/s,O.z=(z[3*V+2]-z[3*m+2])/s),T&&(d.x=(T[2*V]-T[2*m])/s,d.y=(T[2*V+1]-T[2*m+1])/s),L[m][V].push(m);for(let C=1;C<s;C++)L[m][V].push(f.length/3),f[j++]=f[3*m]+C*y.x,f[j++]=f[3*m+1]+C*y.y,f[j++]=f[3*m+2]+C*y.z,z&&(z[H++]=z[3*m]+C*O.x,z[H++]=z[3*m+1]+C*O.y,z[H++]=z[3*m+2]+C*O.z),T&&(T[A++]=T[2*m]+C*d.x,T[A++]=T[2*m+1]+C*d.y);L[m][V].push(V),L[V][m]=new Array,t=L[m][V].length;for(let C=0;C<t;C++)L[V][m][C]=L[m][V][t-1-C]}S[0][0]=x[C],S[1][0]=L[x[C]][x[C+1]][1],S[1][1]=L[x[C]][x[C+2]][1];for(let M=2;M<s;M++){S[M][0]=L[x[C]][x[C+1]][M],S[M][M]=L[x[C]][x[C+2]][M],y.x=(f[3*S[M][M]]-f[3*S[M][0]])/M,y.y=(f[3*S[M][M]+1]-f[3*S[M][0]+1])/M,y.z=(f[3*S[M][M]+2]-f[3*S[M][0]+2])/M,z&&(O.x=(z[3*S[M][M]]-z[3*S[M][0]])/M,O.y=(z[3*S[M][M]+1]-z[3*S[M][0]+1])/M,O.z=(z[3*S[M][M]+2]-z[3*S[M][0]+2])/M),T&&(d.x=(T[2*S[M][M]]-T[2*S[M][0]])/M,d.y=(T[2*S[M][M]+1]-T[2*S[M][0]+1])/M);for(let C=1;C<M;C++)S[M][C]=f.length/3,f[j++]=f[3*S[M][0]]+C*y.x,f[j++]=f[3*S[M][0]+1]+C*y.y,f[j++]=f[3*S[M][0]+2]+C*y.z,z&&(z[H++]=z[3*S[M][0]]+C*O.x,z[H++]=z[3*S[M][0]+1]+C*O.y,z[H++]=z[3*S[M][0]+2]+C*O.z),T&&(T[A++]=T[2*S[M][0]]+C*d.x,T[A++]=T[2*S[M][0]+1]+C*d.y)}S[s]=L[x[C+1]][x[C+2]],D.push(S[0][0],S[1][0],S[1][1]);for(let C=1;C<s;C++){let M;for(M=0;M<C;M++)D.push(S[C][M],S[C+1][M],S[C+1][M+1]),D.push(S[C][M],S[C+1][M+1],S[C][M+1]);D.push(S[C][M],S[C+1][M],S[C+1][M+1])}}M.indices=D,M.Ca(this,this.isVertexBufferUpdatable(U.h.PositionKind))}else j.e.Warn("Couldn't increase number of vertices : VertexData must contain at least indices and positions")}forceSharedVertices(){const C=O.b.ExtractFromMesh(this),M=C.Aa,x=C.indices,f=C.xa,T=C.za,z=C.matricesIndices,s=C.matricesWeights,S=C.matricesIndicesExtra,m=C.matricesWeightsExtra;if(void 0===x||void 0===f||null===x||null===f)j.e.Warn("VertexData contains empty entries");else{const Q=new Array,V=new Array,y=new Array,d=new Array,D=new Array,o=new Array,L=new Array,t=new Array;let A=new Array,H=0;const j={};let b,R;for(let C=0;C<x.length;C+=3){R=[x[C],x[C+1],x[C+2]],A=[];for(let C=0;C<3;C++){A[C]="";for(let M=0;M<3;M++)Math.abs(f[3*R[C]+M])<1e-8&&(f[3*R[C]+M]=0),A[C]+=f[3*R[C]+M]+"|"}if(A[0]!=A[1]&&A[0]!=A[2]&&A[1]!=A[2])for(let C=0;C<3;C++){if(b=j[A[C]],void 0===b){j[A[C]]=H,b=H++;for(let M=0;M<3;M++)Q.push(f[3*R[C]+M]);if(null!==T&&void 0!==T)for(let M=0;M<4;M++)d.push(T[4*R[C]+M]);if(null!==M&&void 0!==M)for(let x=0;x<2;x++)y.push(M[2*R[C]+x]);if(null!==z&&void 0!==z)for(let M=0;M<4;M++)D.push(z[4*R[C]+M]);if(null!==s&&void 0!==s)for(let M=0;M<4;M++)o.push(s[4*R[C]+M]);if(null!==S&&void 0!==S)for(let M=0;M<4;M++)L.push(S[4*R[C]+M]);if(null!==m&&void 0!==m)for(let M=0;M<4;M++)t.push(m[4*R[C]+M])}V.push(b)}}const n=new Array;O.b.ComputeNormals(Q,V,n),C.xa=Q,C.indices=V,C.ya=n,null!==M&&void 0!==M&&(C.Aa=y),null!==T&&void 0!==T&&(C.za=d),null!==z&&void 0!==z&&(C.matricesIndices=D),null!==s&&void 0!==s&&(C.matricesWeights=o),null!==S&&void 0!==S&&(C.matricesIndicesExtra=L),null!==s&&void 0!==s&&(C.matricesWeightsExtra=t),C.Ca(this,this.isVertexBufferUpdatable(U.h.PositionKind))}}static _instancedMeshFactory(C,M){throw(0,R.d)("InstancedMesh")}static _PhysicsImpostorParser(C,M,x){throw(0,R.d)("PhysicsImpostor")}Bb(C){const M=h._instancedMeshFactory(C,this);return M.parent=this.parent,M}synchronizeInstances(){for(let C=0;C<this.instances.length;C++){this.instances[C]._syncSubMeshes()}return this}optimizeIndices(C){const M=this.Ge(),x=this.getVerticesData(U.h.PositionKind);if(!x||!M)return this;const f=[];for(let T=0;T<x.length;T+=3)f.push(Q.m.Dd(x,T));const z=[];return T.e.SyncAsyncForLoop(f.length,40,(C=>{const M=f.length-1-C,x=f[M];for(let T=0;T<M;++T){const C=f[T];if(x.equals(C)){z[M]=T;break}}}),(()=>{for(let C=0;C<M.length;++C)M[C]=z[M[C]]||M[C];const x=this.we.slice(0);this.setIndices(M),this.we=x,C&&C(this)})),this}serialize(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};C.name=this.name,C.id=this.id,C.uniqueId=this.uniqueId,C.type=this.getClassName(),s.d&&s.d.HasTags(this)&&(C.tags=s.d.GetTags(this)),C.position=this.position.Gd(),this.rotationQuaternion?C.rotationQuaternion=this.rotationQuaternion.Gd():this.rotation&&(C.rotation=this.rotation.Gd()),C.Qd=this.Qd.Gd(),this._postMultiplyPivotMatrix?C.pivotMatrix=this.getPivotMatrix().Gd():C.localMatrix=this.getPivotMatrix().Gd(),C.isEnabled=this.isEnabled(!1),C.isVisible=this.isVisible,C.infiniteDistance=this.infiniteDistance,C.pickable=this.ge,C.receiveShadows=this.receiveShadows,C.billboardMode=this.billboardMode,C.visibility=this.visibility,C.Ce=this.Ce,C.checkCollisions=this.checkCollisions,C.ellipsoid=this.ellipsoid.Gd(),C.ellipsoidOffset=this.ellipsoidOffset.Gd(),C.Da=this.Da,C.isBlocker=this.isBlocker,C.sideOrientation=this.sideOrientation,this.parent&&this.parent._serializeAsParent(C),C.isUnIndexed=this.isUnIndexed;const M=this._geometry;if(M&&this.we){C.geometryUniqueId=M.uniqueId,C.geometryId=M.id,C.we=[];for(let M=0;M<this.we.length;M++){const x=this.we[M];C.we.push({materialIndex:x.materialIndex,verticesStart:x.verticesStart,verticesCount:x.verticesCount,indexStart:x.indexStart,indexCount:x.indexCount})}}if(this.material?this.material.doNotSerialize||(C.materialUniqueId=this.material.uniqueId,C.materialId=this.material.id):(this.material=null,C.materialUniqueId=this._scene.defaultMaterial.uniqueId,C.materialId=this._scene.defaultMaterial.id),this.morphTargetManager&&(C.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(C.skeletonId=this.skeleton.id,C.numBoneInfluencers=this.numBoneInfluencers),this.va()._getComponent(n.d.NAME_PHYSICSENGINE)){const M=this.getPhysicsImpostor();M&&(C.physicsMass=M.getParam("mass"),C.physicsFriction=M.getParam("friction"),C.physicsRestitution=M.getParam("mass"),C.physicsImpostor=M.type)}this.metadata&&(C.metadata=this.metadata),C.instances=[];for(let x=0;x<this.instances.length;x++){const M=this.instances[x];if(M.doNotSerialize)continue;const f={name:M.name,id:M.id,isEnabled:M.isEnabled(!1),isVisible:M.isVisible,ge:M.ge,checkCollisions:M.checkCollisions,position:M.position.Gd(),Qd:M.Qd.Gd()};if(M.parent&&M.parent._serializeAsParent(f),M.rotationQuaternion?f.rotationQuaternion=M.rotationQuaternion.Gd():M.rotation&&(f.rotation=M.rotation.Gd()),this.va()._getComponent(n.d.NAME_PHYSICSENGINE)){const C=M.getPhysicsImpostor();C&&(f.physicsMass=C.getParam("mass"),f.physicsFriction=C.getParam("friction"),f.physicsRestitution=C.getParam("mass"),f.physicsImpostor=C.type)}M.metadata&&(f.metadata=M.metadata),M.actionManager&&(f.actions=M.actionManager.serialize(M.name)),C.instances.push(f),H.e.AppendSerializedAnimations(M,f),f.ranges=M.serializeAnimationRanges()}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData&&(C.thinInstances={instancesCount:this._thinInstanceDataStorage.instancesCount,matrixData:Array.from(this._thinInstanceDataStorage.matrixData),matrixBufferSize:this._thinInstanceDataStorage.matrixBufferSize,enablePicking:this.thinInstanceEnablePicking},this._userThinInstanceBuffersStorage)){const M={data:{},sizes:{},strides:{}};for(const C in this._userThinInstanceBuffersStorage.data)M.data[C]=Array.from(this._userThinInstanceBuffersStorage.data[C]),M.sizes[C]=this._userThinInstanceBuffersStorage.sizes[C],M.strides[C]=this._userThinInstanceBuffersStorage.strides[C];C.thinInstances.userThinInstance=M}return H.e.AppendSerializedAnimations(this,C),C.ranges=this.serializeAnimationRanges(),C.layerMask=this.layerMask,C.alphaIndex=this.alphaIndex,C.hasVertexAlpha=this.hasVertexAlpha,C.overlayAlpha=this.overlayAlpha,C.overlayColor=this.overlayColor.Gd(),C.renderOverlay=this.renderOverlay,C.applyFog=this.applyFog,this.actionManager&&(C.actions=this.actionManager.serialize(this.name)),C}_syncGeometryWithMorphTargetManager(){if(!this.Ee)return;this._markSubMeshesAsAttributesDirty();const C=this._internalAbstractMeshDataInfo._morphTargetManager;if(C&&C.vertexCount){if(C.vertexCount!==this.getTotalVertices())return j.e.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);if(C.isUsingTextureForTargets)return;for(let M=0;M<C.numInfluencers;M++){const x=C.getActiveTarget(M),f=x.getPositions();if(!f)return void j.e.Error("Invalid morph target. Target must have positions.");this.Ee.Ga(U.h.PositionKind+M,f,!1,3);const T=x.getNormals();T&&this.Ee.Ga(U.h.NormalKind+M,T,!1,3);const z=x.getTangents();z&&this.Ee.Ga(U.h.TangentKind+M,z,!1,3);const s=x.getUVs();s&&this.Ee.Ga(U.h.UVKind+"_"+M,s,!1,2)}}else{let C=0;for(;this.Ee.isVerticesDataPresent(U.h.PositionKind+C);)this.Ee.removeVerticesData(U.h.PositionKind+C),this.Ee.isVerticesDataPresent(U.h.NormalKind+C)&&this.Ee.removeVerticesData(U.h.NormalKind+C),this.Ee.isVerticesDataPresent(U.h.TangentKind+C)&&this.Ee.removeVerticesData(U.h.TangentKind+C),this.Ee.isVerticesDataPresent(U.h.UVKind+C)&&this.Ee.removeVerticesData(U.h.UVKind+"_"+C),C++}}static Parse(C,M,x){let f;if(f=C.type&&"LinesMesh"===C.type?h._LinesMeshParser(C,M):C.type&&"GroundMesh"===C.type?h._GroundMeshParser(C,M):C.type&&"GoldbergMesh"===C.type?h._GoldbergMeshParser(C,M):C.type&&"GreasedLineMesh"===C.type?h._GreasedLineMeshParser(C,M):C.type&&"TrailMesh"===C.type?h._TrailMeshParser(C,M):new h(C.name,M),f.id=C.id,f._waitingParsedUniqueId=C.uniqueId,s.d&&s.d.AddTagsTo(f,C.tags),f.position=Q.m.Dd(C.position),void 0!==C.metadata&&(f.metadata=C.metadata),C.rotationQuaternion?f.rotationQuaternion=Q.h.Dd(C.rotationQuaternion):C.rotation&&(f.rotation=Q.m.Dd(C.rotation)),f.Qd=Q.m.Dd(C.Qd),C.localMatrix?f.setPreTransformMatrix(Q.d.Dd(C.localMatrix)):C.pivotMatrix&&f.setPivotMatrix(Q.d.Dd(C.pivotMatrix)),f.Og(C.isEnabled),f.isVisible=C.isVisible,f.infiniteDistance=C.infiniteDistance,f.Ce=!!C.Ce,f.showBoundingBox=C.showBoundingBox,f.showSubMeshesBoundingBox=C.showSubMeshesBoundingBox,void 0!==C.applyFog&&(f.applyFog=C.applyFog),void 0!==C.pickable&&(f.ge=C.pickable),void 0!==C.alphaIndex&&(f.alphaIndex=C.alphaIndex),f.receiveShadows=C.receiveShadows,void 0!==C.billboardMode&&(f.billboardMode=C.billboardMode),void 0!==C.visibility&&(f.visibility=C.visibility),f.checkCollisions=C.checkCollisions,f.Da=!!C.Da,C.ellipsoid&&(f.ellipsoid=Q.m.Dd(C.ellipsoid)),C.ellipsoidOffset&&(f.ellipsoidOffset=Q.m.Dd(C.ellipsoidOffset)),null!=C.overrideMaterialSideOrientation&&(f.sideOrientation=C.overrideMaterialSideOrientation),void 0!==C.sideOrientation&&(f.sideOrientation=C.sideOrientation),void 0!==C.isBlocker&&(f.isBlocker=C.isBlocker),f._shouldGenerateFlatShading=C.useFlatShading,C.ki&&(f._waitingData.ki=C.ki),void 0!==C.parentId&&(f._waitingParentId=C.parentId),void 0!==C.parentInstanceIndex&&(f._waitingParentInstanceIndex=C.parentInstanceIndex),void 0!==C.actions&&(f._waitingData.actions=C.actions),void 0!==C.overlayAlpha&&(f.overlayAlpha=C.overlayAlpha),void 0!==C.overlayColor&&(f.overlayColor=V.d.Dd(C.overlayColor)),void 0!==C.renderOverlay&&(f.renderOverlay=C.renderOverlay),f.isUnIndexed=!!C.isUnIndexed,f.hasVertexAlpha=C.hasVertexAlpha,C.delayLoadingFile?(f.delayLoadState=4,f.delayLoadingFile=x+C.delayLoadingFile,f.buildBoundingInfo(Q.m.Dd(C.boundingBoxMinimum),Q.m.Dd(C.boundingBoxMaximum)),C._binaryInfo&&(f._binaryInfo=C._binaryInfo),f._delayInfo=[],C.hasUVs&&f._delayInfo.push(U.h.UVKind),C.hasUVs2&&f._delayInfo.push(U.h.UV2Kind),C.hasUVs3&&f._delayInfo.push(U.h.UV3Kind),C.hasUVs4&&f._delayInfo.push(U.h.UV4Kind),C.hasUVs5&&f._delayInfo.push(U.h.UV5Kind),C.hasUVs6&&f._delayInfo.push(U.h.UV6Kind),C.hasColors&&f._delayInfo.push(U.h.ColorKind),C.hasMatricesIndices&&f._delayInfo.push(U.h.MatricesIndicesKind),C.hasMatricesWeights&&f._delayInfo.push(U.h.MatricesWeightsKind),f._delayLoadingFunction=d.b._ImportGeometry,A.c.ForceFullSceneLoadingForIncremental&&f._checkDelayState()):d.b._ImportGeometry(C,f),C.materialUniqueId?f._waitingMaterialId=C.materialUniqueId:C.materialId&&(f._waitingMaterialId=C.materialId),C.morphTargetManagerId>-1&&(f._waitingMorphTargetManagerId=C.morphTargetManagerId),void 0!==C.skeletonId&&null!==C.skeletonId&&(f.skeleton=M.getLastSkeletonById(C.skeletonId),C.numBoneInfluencers&&(f.numBoneInfluencers=C.numBoneInfluencers)),C.animations){for(let M=0;M<C.animations.length;M++){const x=C.animations[M],T=(0,b.c)("BABYLON.Animation");T&&f.animations.push(T.Parse(x))}y.e.ParseAnimationRanges(f,C,M)}if(C.autoAnimate&&M.beginAnimation(f,C.autoAnimateFrom,C.autoAnimateTo,C.autoAnimateLoop,C.autoAnimateSpeed||1),C.layerMask&&!isNaN(C.layerMask)?f.layerMask=Math.abs(parseInt(C.layerMask)):f.layerMask=268435455,C.physicsImpostor&&(f.physicsImpostor=h._PhysicsImpostorParser(M,f,C)),C.lodMeshIds&&(f._waitingData.lods={ids:C.lodMeshIds,distances:C.lodDistances?C.lodDistances:null,coverages:C.lodCoverages?C.lodCoverages:null}),C.instances)for(let T=0;T<C.instances.length;T++){const x=C.instances[T],z=f.Bb(x.name);if(x.id&&(z.id=x.id),s.d&&(x.tags?s.d.AddTagsTo(z,x.tags):s.d.AddTagsTo(z,C.tags)),z.position=Q.m.Dd(x.position),void 0!==x.metadata&&(z.metadata=x.metadata),void 0!==x.parentId&&(z._waitingParentId=x.parentId),void 0!==x.parentInstanceIndex&&(z._waitingParentInstanceIndex=x.parentInstanceIndex),void 0!==x.isEnabled&&null!==x.isEnabled&&z.Og(x.isEnabled),void 0!==x.isVisible&&null!==x.isVisible&&(z.isVisible=x.isVisible),void 0!==x.ge&&null!==x.ge&&(z.ge=x.ge),x.rotationQuaternion?z.rotationQuaternion=Q.h.Dd(x.rotationQuaternion):x.rotation&&(z.rotation=Q.m.Dd(x.rotation)),z.Qd=Q.m.Dd(x.Qd),void 0!=x.checkCollisions&&null!=x.checkCollisions&&(z.checkCollisions=x.checkCollisions),void 0!=x.pickable&&null!=x.pickable&&(z.ge=x.pickable),void 0!=x.showBoundingBox&&null!=x.showBoundingBox&&(z.showBoundingBox=x.showBoundingBox),void 0!=x.showSubMeshesBoundingBox&&null!=x.showSubMeshesBoundingBox&&(z.showSubMeshesBoundingBox=x.showSubMeshesBoundingBox),void 0!=x.alphaIndex&&null!=x.showSubMeshesBoundingBox&&(z.alphaIndex=x.alphaIndex),x.physicsImpostor&&(z.physicsImpostor=h._PhysicsImpostorParser(M,z,x)),void 0!==x.actions&&(z._waitingData.actions=x.actions),x.animations){for(let C=0;C<x.animations.length;C++){const M=x.animations[C],f=(0,b.c)("BABYLON.Animation");f&&z.animations.push(f.Parse(M))}y.e.ParseAnimationRanges(z,x,M),x.autoAnimate&&M.beginAnimation(z,x.autoAnimateFrom,x.autoAnimateTo,x.autoAnimateLoop,x.autoAnimateSpeed||1)}}if(C.thinInstances){const M=C.thinInstances;if(f.thinInstanceEnablePicking=!!M.enablePicking,M.matrixData?(f.Yj("matrix",new Float32Array(M.matrixData),16,!1),f._thinInstanceDataStorage.matrixBufferSize=M.matrixBufferSize,f._thinInstanceDataStorage.instancesCount=M.instancesCount):f._thinInstanceDataStorage.matrixBufferSize=M.matrixBufferSize,C.thinInstances.userThinInstance){const M=C.thinInstances.userThinInstance;for(const C in M.data)f.Yj(C,new Float32Array(M.data[C]),M.strides[C],!1),f._userThinInstanceBuffersStorage.sizes[C]=M.sizes[C]}}return f}setPositionsForCPUSkinning(){const C=this._internalMeshDataInfo;if(!C._sourcePositions){const M=this.getVerticesData(U.h.PositionKind);if(!M)return C._sourcePositions;C._sourcePositions=new Float32Array(M),this.isVertexBufferUpdatable(U.h.PositionKind)||this.Ga(U.h.PositionKind,M,!0)}return C._sourcePositions}setNormalsForCPUSkinning(){const C=this._internalMeshDataInfo;if(!C._sourceNormals){const M=this.getVerticesData(U.h.NormalKind);if(!M)return C._sourceNormals;C._sourceNormals=new Float32Array(M),this.isVertexBufferUpdatable(U.h.NormalKind)||this.Ga(U.h.NormalKind,M,!0)}return C._sourceNormals}applySkeleton(C){if(!this.Ee)return this;if(this.Ee._softwareSkinningFrameId==this.va().getFrameId())return this;if(this.Ee._softwareSkinningFrameId=this.va().getFrameId(),!this.isVerticesDataPresent(U.h.PositionKind))return this;if(!this.isVerticesDataPresent(U.h.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(U.h.MatricesWeightsKind))return this;const M=this.isVerticesDataPresent(U.h.NormalKind),x=this._internalMeshDataInfo;if(!x._sourcePositions){const C=this.we.slice();this.setPositionsForCPUSkinning(),this.we=C}M&&!x._sourceNormals&&this.setNormalsForCPUSkinning();let f=this.getVerticesData(U.h.PositionKind);if(!f)return this;f instanceof Float32Array||(f=new Float32Array(f));let T=this.getVerticesData(U.h.NormalKind);if(M){if(!T)return this;T instanceof Float32Array||(T=new Float32Array(T))}const z=this.getVerticesData(U.h.MatricesIndicesKind),s=this.getVerticesData(U.h.MatricesWeightsKind);if(!s||!z)return this;const S=this.numBoneInfluencers>4,m=S?this.getVerticesData(U.h.MatricesIndicesExtraKind):null,V=S?this.getVerticesData(U.h.MatricesWeightsExtraKind):null,y=C.getTransformMatrices(this),O=Q.m.Zero(),d=new Q.d,D=new Q.d;let o,L=0;for(let U=0;U<f.length;U+=3,L+=4){let C;for(o=0;o<4;o++)C=s[L+o],C>0&&(Q.d.FromFloat32ArrayToRefScaled(y,Math.floor(16*z[L+o]),C,D),d.addToSelf(D));if(S)for(o=0;o<4;o++)C=V[L+o],C>0&&(Q.d.FromFloat32ArrayToRefScaled(y,Math.floor(16*m[L+o]),C,D),d.addToSelf(D));Q.m.TransformCoordinatesFromFloatsToRef(x._sourcePositions[U],x._sourcePositions[U+1],x._sourcePositions[U+2],d,O),O.toArray(f,U),M&&(Q.m.TransformNormalFromFloatsToRef(x._sourceNormals[U],x._sourceNormals[U+1],x._sourceNormals[U+2],d,O),O.toArray(T,U)),d.reset()}return this.updateVerticesData(U.h.PositionKind,f),M&&this.updateVerticesData(U.h.NormalKind,T),this}static MinMax(C){let M=null,x=null;return C.forEach((function(C){const f=C.getBoundingInfo().boundingBox;M&&x?(M.minimizeInPlace(f.minimumWorld),x.maximizeInPlace(f.maximumWorld)):(M=f.minimumWorld,x=f.maximumWorld)})),M&&x?{min:M,max:x}:{min:Q.m.Zero(),max:Q.m.Zero()}}static Center(C){const M=C instanceof Array?h.MinMax(C):C;return Q.m.Center(M.min,M.max)}static MergeMeshes(C){let M=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],x=arguments.length>2?arguments[2]:void 0,f=arguments.length>3?arguments[3]:void 0,T=arguments.length>4?arguments[4]:void 0,z=arguments.length>5?arguments[5]:void 0;return(0,S.i)(h._MergeMeshesCoroutine(C,M,x,f,T,z,!1))}static MergeMeshesAsync(C){let M=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],x=arguments.length>2?arguments[2]:void 0,f=arguments.length>3?arguments[3]:void 0,T=arguments.length>4?arguments[4]:void 0,z=arguments.length>5?arguments[5]:void 0;return(0,S.f)(h._MergeMeshesCoroutine(C,M,x,f,T,z,!0),(0,S.c)())}static*_MergeMeshesCoroutine(C){let M,x=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],f=arguments.length>2?arguments[2]:void 0,T=arguments.length>3?arguments[3]:void 0,z=arguments.length>4?arguments[4]:void 0,s=arguments.length>5?arguments[5]:void 0,S=arguments.length>6?arguments[6]:void 0;if(0===(C=C.filter(Boolean)).length)return null;if(!f){let x=0;for(M=0;M<C.length;M++)if(x+=C[M].getTotalVertices(),x>=65536)return j.e.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}s&&(z=!1);const m=new Array,Q=new Array,V=new Array,y=C[0].sideOrientation;for(M=0;M<C.length;M++){const x=C[M];if(x.isAnInstance)return j.e.Warn("Cannot merge instance meshes."),null;if(y!==x.sideOrientation)return j.e.Warn("Cannot merge meshes with different sideOrientation values."),null;if(z&&V.push(x.getTotalIndices()),s)if(x.material){const C=x.material;if(C instanceof t.b){for(let M=0;M<C.Mg.length;M++)m.indexOf(C.Mg[M])<0&&m.push(C.Mg[M]);for(let M=0;M<x.we.length;M++)Q.push(m.indexOf(C.Mg[x.we[M].materialIndex])),V.push(x.we[M].indexCount)}else{m.indexOf(C)<0&&m.push(C);for(let M=0;M<x.we.length;M++)Q.push(m.indexOf(C)),V.push(x.we[M].indexCount)}}else for(let C=0;C<x.we.length;C++)Q.push(0),V.push(x.we[C].indexCount)}const U=C[0],d=C=>{const M=C.Be(!0);return{vertexData:O.b.ExtractFromMesh(C,!1,!1),transform:M}},{vertexData:D,transform:L}=d(U);S&&(yield);const A=new Array(C.length-1);for(let O=1;O<C.length;O++)A[O-1]=d(C[O]),S&&(yield);const H=D._mergeCoroutine(L,A,f,S,!x);let b=H.next();for(;!b.done;)S&&(yield),b=H.next();const R=b.value;T||(T=new h(U.name+"_merged",U.va()));const n=R._applyToCoroutine(T,void 0,S);let I=n.next();for(;!I.done;)S&&(yield),I=n.next();if(T.checkCollisions=U.checkCollisions,T.sideOrientation=U.sideOrientation,x)for(M=0;M<C.length;M++)C[M].dispose();if(z||s){T.releaseSubMeshes(),M=0;let C=0;for(;M<V.length;)o.e.CreateFromIndices(0,C,V[M],T,void 0,!1),C+=V[M],M++;for(const M of T.we)M.refreshBoundingInfo();T.Be(!0)}if(s){const C=new t.b(U.name+"_merged",U.va());C.Mg=m;for(let M=0;M<T.we.length;M++)T.we[M].materialIndex=Q[M];T.material=C}else T.material=U.material;return T}Oj(C){C._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(C)}Nj(C){const M=C._indexInSourceMeshInstanceArray;if(-1!=M){if(M!==this.instances.length-1){const C=this.instances[this.instances.length-1];this.instances[M]=C,C._indexInSourceMeshInstanceArray=M}C._indexInSourceMeshInstanceArray=-1,this.instances.pop()}}_shouldConvertRHS(){return this._scene.useRightHandedSystem&&this.sideOrientation===L.c.CounterClockWiseSideOrientation}_getRenderingFillMode(C){const M=this.va();return M.forcePointsCloud?L.c.PointFillMode:M.forceWireframe?L.c.WireFrameFillMode:this.overrideRenderingFillMode??C}setMaterialByID(C){return this.setMaterialById(C)}static CreateRibbon(C,M,x,f,T,z,s,S,m){throw new Error("Import MeshBuilder to populate this function")}static lb(C,M,x,f,T,z){throw new Error("Import MeshBuilder to populate this function")}static CreateBox(C,M,x,f,T){throw new Error("Import MeshBuilder to populate this function")}static CreateSphere(C,M,x,f,T,z){throw new Error("Import MeshBuilder to populate this function")}static CreateHemisphere(C,M,x,f){throw new Error("Import MeshBuilder to populate this function")}static CreateCylinder(C,M,x,f,T,z,s,S,m){throw new Error("Import MeshBuilder to populate this function")}static CreateTorus(C,M,x,f,T,z,s){throw new Error("Import MeshBuilder to populate this function")}static CreateTorusKnot(C,M,x,f,T,z,s,S,m,Q){throw new Error("Import MeshBuilder to populate this function")}static mb(C,M,x,f,T){throw new Error("Import MeshBuilder to populate this function")}static CreateDashedLines(C,M,x,f,T,z,s,S){throw new Error("Import MeshBuilder to populate this function")}static CreatePolygon(C,M,x,f,T,z,s){throw new Error("Import MeshBuilder to populate this function")}static ExtrudePolygon(C,M,x,f,T,z,s,S){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShape(C,M,x,f,T,z,s,S,m,Q){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShapeCustom(C,M,x,f,T,z,s,S,m,Q,V,y){throw new Error("Import MeshBuilder to populate this function")}static CreateLathe(C,M,x,f,T,z,s){throw new Error("Import MeshBuilder to populate this function")}static Pg(C,M,x,f,T){throw new Error("Import MeshBuilder to populate this function")}static CreateGround(C,M,x,f,T,z){throw new Error("Import MeshBuilder to populate this function")}static CreateTiledGround(C,M,x,f,T,z,s,S,m){throw new Error("Import MeshBuilder to populate this function")}static CreateGroundFromHeightMap(C,M,x,f,T,z,s,S,m,Q,V){throw new Error("Import MeshBuilder to populate this function")}static CreateTube(C,M,x,f,T,z,s,S,m,Q){throw new Error("Import MeshBuilder to populate this function")}static CreatePolyhedron(C,M,x){throw new Error("Import MeshBuilder to populate this function")}static CreateIcoSphere(C,M,x){throw new Error("Import MeshBuilder to populate this function")}static CreateDecal(C,M,x,f,T,z){throw new Error("Import MeshBuilder to populate this function")}static CreateCapsule(C,M,x){throw new Error("Import MeshBuilder to populate this function")}static ExtendToGoldberg(C){throw new Error("Import MeshBuilder to populate this function")}}h.FRONTSIDE=O.b.FRONTSIDE,h.BACKSIDE=O.b.BACKSIDE,h.DOUBLESIDE=O.b.DOUBLESIDE,h.DEFAULTSIDE=O.b.DEFAULTSIDE,h.NO_CAP=0,h.CAP_START=1,h.CAP_END=2,h.CAP_ALL=3,h.NO_FLIP=0,h.FLIP_TILE=1,h.ROTATE_TILE=2,h.FLIP_ROW=3,h.ROTATE_ROW=4,h.FLIP_N_ROTATE_TILE=5,h.FLIP_N_ROTATE_ROW=6,h.CENTER=0,h.LEFT=1,h.RIGHT=2,h.TOP=3,h.BOTTOM=4,h.INSTANCEDMESH_SORT_TRANSPARENT=!1,h._GroundMeshParser=(C,M)=>{throw(0,R.d)("GroundMesh")},h._GoldbergMeshParser=(C,M)=>{throw(0,R.d)("GoldbergMesh")},h._LinesMeshParser=(C,M)=>{throw(0,R.d)("LinesMesh")},h._GreasedLineMeshParser=(C,M)=>{throw(0,R.d)("GreasedLineMesh")},h._GreasedLineRibbonMeshParser=(C,M)=>{throw(0,R.d)("GreasedLineRibbonMesh")},h._TrailMeshParser=(C,M)=>{throw(0,R.d)("TrailMesh")},(0,b.f)("BABYLON.Mesh",h)},11739:(C,M,x)=>{"use strict";x.d(M,{b:()=>d});var f=x(951),T=x(978),z=x(1224),s=x(1067),S=x(1162),m=x(1078),Q=x(959),V=x(11718),y=x(1052),U=x(1294);class O{}class d{constructor(){this.uniqueId=0,this.metadata={},this._applyTo=(0,V.e)(this._applyToCoroutine.bind(this)),this.uniqueId=d._UniqueIDGenerator,d._UniqueIDGenerator++}set(C,M){switch(C.length||m.e.Warn(`Setting vertex data kind '${M}' with an empty array`),M){case z.h.PositionKind:this.xa=C;break;case z.h.NormalKind:this.ya=C;break;case z.h.TangentKind:this.tangents=C;break;case z.h.UVKind:this.Aa=C;break;case z.h.UV2Kind:this.uvs2=C;break;case z.h.UV3Kind:this.uvs3=C;break;case z.h.UV4Kind:this.uvs4=C;break;case z.h.UV5Kind:this.uvs5=C;break;case z.h.UV6Kind:this.uvs6=C;break;case z.h.ColorKind:this.za=C;break;case z.h.MatricesIndicesKind:this.matricesIndices=C;break;case z.h.MatricesWeightsKind:this.matricesWeights=C;break;case z.h.MatricesIndicesExtraKind:this.matricesIndicesExtra=C;break;case z.h.MatricesWeightsExtraKind:this.matricesWeightsExtra=C}}Ca(C,M){return this._applyTo(C,M,!1),this}applyToGeometry(C,M){return this._applyTo(C,M,!1),this}updateMesh(C){return this._update(C),this}updateGeometry(C){return this._update(C),this}*_applyToCoroutine(C){let M=arguments.length>1&&void 0!==arguments[1]&&arguments[1],x=arguments.length>2?arguments[2]:void 0;if(this.xa&&(C.Ga(z.h.PositionKind,this.xa,M),x&&(yield)),this.ya&&(C.Ga(z.h.NormalKind,this.ya,M),x&&(yield)),this.tangents&&(C.Ga(z.h.TangentKind,this.tangents,M),x&&(yield)),this.Aa&&(C.Ga(z.h.UVKind,this.Aa,M),x&&(yield)),this.uvs2&&(C.Ga(z.h.UV2Kind,this.uvs2,M),x&&(yield)),this.uvs3&&(C.Ga(z.h.UV3Kind,this.uvs3,M),x&&(yield)),this.uvs4&&(C.Ga(z.h.UV4Kind,this.uvs4,M),x&&(yield)),this.uvs5&&(C.Ga(z.h.UV5Kind,this.uvs5,M),x&&(yield)),this.uvs6&&(C.Ga(z.h.UV6Kind,this.uvs6,M),x&&(yield)),this.za&&(C.Ga(z.h.ColorKind,this.za,M),this.hasVertexAlpha&&void 0!==C.hasVertexAlpha&&(C.hasVertexAlpha=!0),x&&(yield)),this.matricesIndices&&(C.Ga(z.h.MatricesIndicesKind,this.matricesIndices,M),x&&(yield)),this.matricesWeights&&(C.Ga(z.h.MatricesWeightsKind,this.matricesWeights,M),x&&(yield)),this.matricesIndicesExtra&&(C.Ga(z.h.MatricesIndicesExtraKind,this.matricesIndicesExtra,M),x&&(yield)),this.matricesWeightsExtra&&(C.Ga(z.h.MatricesWeightsExtraKind,this.matricesWeightsExtra,M),x&&(yield)),this.indices?(C.setIndices(this.indices,null,M),x&&(yield)):C.setIndices([],null),C.we&&this.materialInfos&&this.materialInfos.length>1){const M=C;M.we=[];for(const C of this.materialInfos)new U.e(C.materialIndex,C.verticesStart,C.verticesCount,C.indexStart,C.indexCount,M)}return this}_update(C,M,x){return this.xa&&C.updateVerticesData(z.h.PositionKind,this.xa,M,x),this.ya&&C.updateVerticesData(z.h.NormalKind,this.ya,M,x),this.tangents&&C.updateVerticesData(z.h.TangentKind,this.tangents,M,x),this.Aa&&C.updateVerticesData(z.h.UVKind,this.Aa,M,x),this.uvs2&&C.updateVerticesData(z.h.UV2Kind,this.uvs2,M,x),this.uvs3&&C.updateVerticesData(z.h.UV3Kind,this.uvs3,M,x),this.uvs4&&C.updateVerticesData(z.h.UV4Kind,this.uvs4,M,x),this.uvs5&&C.updateVerticesData(z.h.UV5Kind,this.uvs5,M,x),this.uvs6&&C.updateVerticesData(z.h.UV6Kind,this.uvs6,M,x),this.za&&C.updateVerticesData(z.h.ColorKind,this.za,M,x),this.matricesIndices&&C.updateVerticesData(z.h.MatricesIndicesKind,this.matricesIndices,M,x),this.matricesWeights&&C.updateVerticesData(z.h.MatricesWeightsKind,this.matricesWeights,M,x),this.matricesIndicesExtra&&C.updateVerticesData(z.h.MatricesIndicesExtraKind,this.matricesIndicesExtra,M,x),this.matricesWeightsExtra&&C.updateVerticesData(z.h.MatricesWeightsExtraKind,this.matricesWeightsExtra,M,x),this.indices&&C.setIndices(this.indices,null),this}static _TransformVector3Coordinates(C,M){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:C.length;const z=T.i.Md[0],s=T.i.Md[1];for(let S=x;S<x+f;S+=3)T.m.FromArrayToRef(C,S,z),T.m.TransformCoordinatesToRef(z,M,s),C[S]=s.x,C[S+1]=s.y,C[S+2]=s.z}static _TransformVector3Normals(C,M){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:C.length;const z=T.i.Md[0],s=T.i.Md[1];for(let S=x;S<x+f;S+=3)T.m.FromArrayToRef(C,S,z),T.m.TransformNormalToRef(z,M,s),C[S]=s.x,C[S+1]=s.y,C[S+2]=s.z}static _TransformVector4Normals(C,M){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:C.length;const z=T.i.Vector4[0],s=T.i.Vector4[1];for(let S=x;S<x+f;S+=4)T.q.FromArrayToRef(C,S,z),T.q.TransformNormalToRef(z,M,s),C[S]=s.x,C[S+1]=s.y,C[S+2]=s.z,C[S+3]=s.w}static _FlipFaces(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:C.length;for(let f=M;f<M+x;f+=3){const M=C[f+1];C[f+1]=C[f+2],C[f+2]=M}}transform(C){const M=C.determinant()<0;return this.xa&&d._TransformVector3Coordinates(this.xa,C),this.ya&&d._TransformVector3Normals(this.ya,C),this.tangents&&d._TransformVector4Normals(this.tangents,C),M&&this.indices&&d._FlipFaces(this.indices),this}splitBasedOnMaterialID(){if(!this.materialInfos||this.materialInfos.length<2)return[this];const C=[];for(const M of this.materialInfos){const x=new d;if(this.xa&&(x.xa=this.xa.slice(3*M.verticesStart,3*(M.verticesCount+M.verticesStart))),this.ya&&(x.ya=this.ya.slice(3*M.verticesStart,3*(M.verticesCount+M.verticesStart))),this.tangents&&(x.tangents=this.tangents.slice(4*M.verticesStart,4*(M.verticesCount+M.verticesStart))),this.za&&(x.za=this.za.slice(4*M.verticesStart,4*(M.verticesCount+M.verticesStart))),this.Aa&&(x.Aa=this.Aa.slice(2*M.verticesStart,2*(M.verticesCount+M.verticesStart))),this.uvs2&&(x.uvs2=this.uvs2.slice(2*M.verticesStart,2*(M.verticesCount+M.verticesStart))),this.uvs3&&(x.uvs3=this.uvs3.slice(2*M.verticesStart,2*(M.verticesCount+M.verticesStart))),this.uvs4&&(x.uvs4=this.uvs4.slice(2*M.verticesStart,2*(M.verticesCount+M.verticesStart))),this.uvs5&&(x.uvs5=this.uvs5.slice(2*M.verticesStart,2*(M.verticesCount+M.verticesStart))),this.uvs6&&(x.uvs6=this.uvs6.slice(2*M.verticesStart,2*(M.verticesCount+M.verticesStart))),this.matricesIndices&&(x.matricesIndices=this.matricesIndices.slice(4*M.verticesStart,4*(M.verticesCount+M.verticesStart))),this.matricesIndicesExtra&&(x.matricesIndicesExtra=this.matricesIndicesExtra.slice(4*M.verticesStart,4*(M.verticesCount+M.verticesStart))),this.matricesWeights&&(x.matricesWeights=this.matricesWeights.slice(4*M.verticesStart,4*(M.verticesCount+M.verticesStart))),this.matricesWeightsExtra&&(x.matricesWeightsExtra=this.matricesWeightsExtra.slice(4*M.verticesStart,4*(M.verticesCount+M.verticesStart))),this.indices){x.indices=[];for(let C=M.indexStart;C<M.indexStart+M.indexCount;C++)x.indices.push(this.indices[C]-M.verticesStart)}const f=new O;f.indexStart=0,f.indexCount=x.indices?x.indices.length:0,f.materialIndex=M.materialIndex,f.verticesStart=0,f.verticesCount=(x.xa?x.xa.length:0)/3,x.materialInfos=[f],C.push(x)}return C}merge(C){let M=arguments.length>1&&void 0!==arguments[1]&&arguments[1],x=arguments.length>2&&void 0!==arguments[2]&&arguments[2],f=arguments.length>3&&void 0!==arguments[3]&&arguments[3],T=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const z=Array.isArray(C)?C.map((C=>({vertexData:C}))):[{vertexData:C}];return(0,V.i)(this._mergeCoroutine(void 0,z,M,!1,x,f,T))}*_mergeCoroutine(C,M){var x,f;let T=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3?arguments[3]:void 0,S=arguments.length>4?arguments[4]:void 0,m=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Q=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this._validate();let V=M.map((C=>C.vertexData)),y=this;if(Q)for(const z of V)z&&(z._validate(),!this.ya&&z.ya&&(this.ya=new Float32Array(this.xa.length)),!this.tangents&&z.tangents&&(this.tangents=new Float32Array(this.xa.length/3*4)),!this.Aa&&z.Aa&&(this.Aa=new Float32Array(this.xa.length/3*2)),!this.uvs2&&z.uvs2&&(this.uvs2=new Float32Array(this.xa.length/3*2)),!this.uvs3&&z.uvs3&&(this.uvs3=new Float32Array(this.xa.length/3*2)),!this.uvs4&&z.uvs4&&(this.uvs4=new Float32Array(this.xa.length/3*2)),!this.uvs5&&z.uvs5&&(this.uvs5=new Float32Array(this.xa.length/3*2)),!this.uvs6&&z.uvs6&&(this.uvs6=new Float32Array(this.xa.length/3*2)),!this.za&&z.za&&(this.za=new Float32Array(this.xa.length/3*4),this.za.fill(1)),!this.matricesIndices&&z.matricesIndices&&(this.matricesIndices=new Float32Array(this.xa.length/3*4)),!this.matricesWeights&&z.matricesWeights&&(this.matricesWeights=new Float32Array(this.xa.length/3*4)),!this.matricesIndicesExtra&&z.matricesIndicesExtra&&(this.matricesIndicesExtra=new Float32Array(this.xa.length/3*4)),!this.matricesWeightsExtra&&z.matricesWeightsExtra&&(this.matricesWeightsExtra=new Float32Array(this.xa.length/3*4)));for(const z of V)if(z)if(Q)this.ya&&!z.ya&&(z.ya=new Float32Array(z.xa.length)),this.tangents&&!z.tangents&&(z.tangents=new Float32Array(z.xa.length/3*4)),this.Aa&&!z.Aa&&(z.Aa=new Float32Array(z.xa.length/3*2)),this.uvs2&&!z.uvs2&&(z.uvs2=new Float32Array(z.xa.length/3*2)),this.uvs3&&!z.uvs3&&(z.uvs3=new Float32Array(z.xa.length/3*2)),this.uvs4&&!z.uvs4&&(z.uvs4=new Float32Array(z.xa.length/3*2)),this.uvs5&&!z.uvs5&&(z.uvs5=new Float32Array(z.xa.length/3*2)),this.uvs6&&!z.uvs6&&(z.uvs6=new Float32Array(z.xa.length/3*2)),this.za&&!z.za&&(z.za=new Float32Array(z.xa.length/3*4),z.za.fill(1)),this.matricesIndices&&!z.matricesIndices&&(z.matricesIndices=new Float32Array(z.xa.length/3*4)),this.matricesWeights&&!z.matricesWeights&&(z.matricesWeights=new Float32Array(z.xa.length/3*4)),this.matricesIndicesExtra&&!z.matricesIndicesExtra&&(z.matricesIndicesExtra=new Float32Array(z.xa.length/3*4)),this.matricesWeightsExtra&&!z.matricesWeightsExtra&&(z.matricesWeightsExtra=new Float32Array(z.xa.length/3*4));else if(z._validate(),!this.ya!==!z.ya||!this.tangents!==!z.tangents||!this.Aa!==!z.Aa||!this.uvs2!==!z.uvs2||!this.uvs3!==!z.uvs3||!this.uvs4!==!z.uvs4||!this.uvs5!==!z.uvs5||!this.uvs6!==!z.uvs6||!this.za!==!z.za||!this.matricesIndices!==!z.matricesIndices||!this.matricesWeights!==!z.matricesWeights||!this.matricesIndicesExtra!==!z.matricesIndicesExtra||!this.matricesWeightsExtra!==!z.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(m){let x=0,f=0,T=0;const z=[];let s=null;const S=[];for(const M of this.splitBasedOnMaterialID())S.push({vertexData:M,transform:C});for(const C of M)if(C.vertexData)for(const M of C.vertexData.splitBasedOnMaterialID())S.push({vertexData:M,transform:C.transform});S.sort(((C,M)=>{const x=C.vertexData.materialInfos?C.vertexData.materialInfos[0].materialIndex:0,f=M.vertexData.materialInfos?M.vertexData.materialInfos[0].materialIndex:0;return x>f?1:x===f?0:-1}));for(const C of S){const M=C.vertexData;if(x=M.materialInfos?M.materialInfos[0].materialIndex:0,s&&s.materialIndex===x)s.indexCount+=M.indices.length,s.verticesCount+=M.xa.length/3;else{const C=new O;C.materialIndex=x,C.indexStart=f,C.indexCount=M.indices.length,C.verticesStart=T,C.verticesCount=M.xa.length/3,z.push(C),s=C}f+=M.indices.length,T+=M.xa.length/3}const m=S.splice(0,1)[0];y=m.vertexData,C=m.transform,V=S.map((C=>C.vertexData)),M=S,this.materialInfos=z}const U=V.reduce(((C,M)=>{var x;return C+((null===(x=M.indices)||void 0===x?void 0:x.length)??0)}),(null===(x=y.indices)||void 0===x?void 0:x.length)??0);let D=S||V.some((C=>C.indices===y.indices))?null===(f=y.indices)||void 0===f?void 0:f.slice():y.indices;if(U>0){var o;let x=(null===(o=D)||void 0===o?void 0:o.length)??0;if(D||(D=new Array(U)),D.length!==U){if(Array.isArray(D))D.length=U;else{const C=T||D instanceof Uint32Array?new Uint32Array(U):new Uint16Array(U);C.set(D),D=C}C&&C.determinant()<0&&d._FlipFaces(D,0,x)}let f=y.xa?y.xa.length/3:0;for(const{vertexData:C,transform:T}of M)if(C.indices){for(let M=0;M<C.indices.length;M++)D[x+M]=C.indices[M]+f;T&&T.determinant()<0&&d._FlipFaces(D,x,C.indices.length),f+=C.xa.length/3,x+=C.indices.length,s&&(yield)}}return this.indices=D,this.xa=d._MergeElement(z.h.PositionKind,y.xa,C,M.map((C=>[C.vertexData.xa,C.transform]))),s&&(yield),y.ya&&(this.ya=d._MergeElement(z.h.NormalKind,y.ya,C,M.map((C=>[C.vertexData.ya,C.transform]))),s&&(yield)),y.tangents&&(this.tangents=d._MergeElement(z.h.TangentKind,y.tangents,C,M.map((C=>[C.vertexData.tangents,C.transform]))),s&&(yield)),y.Aa&&(this.Aa=d._MergeElement(z.h.UVKind,y.Aa,C,M.map((C=>[C.vertexData.Aa,C.transform]))),s&&(yield)),y.uvs2&&(this.uvs2=d._MergeElement(z.h.UV2Kind,y.uvs2,C,M.map((C=>[C.vertexData.uvs2,C.transform]))),s&&(yield)),y.uvs3&&(this.uvs3=d._MergeElement(z.h.UV3Kind,y.uvs3,C,M.map((C=>[C.vertexData.uvs3,C.transform]))),s&&(yield)),y.uvs4&&(this.uvs4=d._MergeElement(z.h.UV4Kind,y.uvs4,C,M.map((C=>[C.vertexData.uvs4,C.transform]))),s&&(yield)),y.uvs5&&(this.uvs5=d._MergeElement(z.h.UV5Kind,y.uvs5,C,M.map((C=>[C.vertexData.uvs5,C.transform]))),s&&(yield)),y.uvs6&&(this.uvs6=d._MergeElement(z.h.UV6Kind,y.uvs6,C,M.map((C=>[C.vertexData.uvs6,C.transform]))),s&&(yield)),y.za&&(this.za=d._MergeElement(z.h.ColorKind,y.za,C,M.map((C=>[C.vertexData.za,C.transform]))),(void 0!==y.hasVertexAlpha||M.some((C=>void 0!==C.vertexData.hasVertexAlpha)))&&(this.hasVertexAlpha=y.hasVertexAlpha||M.some((C=>C.vertexData.hasVertexAlpha))),s&&(yield)),y.matricesIndices&&(this.matricesIndices=d._MergeElement(z.h.MatricesIndicesKind,y.matricesIndices,C,M.map((C=>[C.vertexData.matricesIndices,C.transform]))),s&&(yield)),y.matricesWeights&&(this.matricesWeights=d._MergeElement(z.h.MatricesWeightsKind,y.matricesWeights,C,M.map((C=>[C.vertexData.matricesWeights,C.transform]))),s&&(yield)),y.matricesIndicesExtra&&(this.matricesIndicesExtra=d._MergeElement(z.h.MatricesIndicesExtraKind,y.matricesIndicesExtra,C,M.map((C=>[C.vertexData.matricesIndicesExtra,C.transform]))),s&&(yield)),y.matricesWeightsExtra&&(this.matricesWeightsExtra=d._MergeElement(z.h.MatricesWeightsExtraKind,y.matricesWeightsExtra,C,M.map((C=>[C.vertexData.matricesWeightsExtra,C.transform])))),this}static _MergeElement(C,M,x,f){const T=f.filter((C=>null!==C[0]&&void 0!==C[0]));if(!M&&0==T.length)return M;if(!M)return this._MergeElement(C,T[0][0],T[0][1],T.slice(1));const s=T.reduce(((C,M)=>C+M[0].length),M.length),S=C===z.h.PositionKind?d._TransformVector3Coordinates:C===z.h.NormalKind?d._TransformVector3Normals:C===z.h.TangentKind?d._TransformVector4Normals:()=>{};if(M instanceof Float32Array){const C=new Float32Array(s);C.set(M),x&&S(C,x,0,M.length);let f=M.length;for(const[M,x]of T)C.set(M,f),x&&S(C,x,f,M.length),f+=M.length;return C}{const C=new Array(s);for(let x=0;x<M.length;x++)C[x]=M[x];x&&S(C,x,0,M.length);let f=M.length;for(const[M,x]of T){for(let x=0;x<M.length;x++)C[f+x]=M[x];x&&S(C,x,f,M.length),f+=M.length}return C}}_validate(){if(!this.xa)throw new y.g("Positions are required",y.f.MeshInvalidPositionsError);const C=(C,M)=>{const x=z.h.DeduceStride(C);if(M.length%x!==0)throw new Error("The "+C+"s array count must be a multiple of "+x);return M.length/x},M=C(z.h.PositionKind,this.xa),x=(x,f)=>{const T=C(x,f);if(T!==M)throw new Error("The "+x+"s element count ("+T+") does not match the positions count ("+M+")")};this.ya&&x(z.h.NormalKind,this.ya),this.tangents&&x(z.h.TangentKind,this.tangents),this.Aa&&x(z.h.UVKind,this.Aa),this.uvs2&&x(z.h.UV2Kind,this.uvs2),this.uvs3&&x(z.h.UV3Kind,this.uvs3),this.uvs4&&x(z.h.UV4Kind,this.uvs4),this.uvs5&&x(z.h.UV5Kind,this.uvs5),this.uvs6&&x(z.h.UV6Kind,this.uvs6),this.za&&x(z.h.ColorKind,this.za),this.matricesIndices&&x(z.h.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&x(z.h.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&x(z.h.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&x(z.h.MatricesWeightsExtraKind,this.matricesWeightsExtra)}clone(){const C=this.serialize();return d.Parse(C)}serialize(){const C={};if(this.xa&&(C.xa=Array.from(this.xa)),this.ya&&(C.ya=Array.from(this.ya)),this.tangents&&(C.tangents=Array.from(this.tangents)),this.Aa&&(C.Aa=Array.from(this.Aa)),this.uvs2&&(C.uvs2=Array.from(this.uvs2)),this.uvs3&&(C.uvs3=Array.from(this.uvs3)),this.uvs4&&(C.uvs4=Array.from(this.uvs4)),this.uvs5&&(C.uvs5=Array.from(this.uvs5)),this.uvs6&&(C.uvs6=Array.from(this.uvs6)),this.za&&(C.za=Array.from(this.za),C.hasVertexAlpha=this.hasVertexAlpha),this.matricesIndices&&(C.matricesIndices=Array.from(this.matricesIndices),C.matricesIndices._isExpanded=!0),this.matricesWeights&&(C.matricesWeights=Array.from(this.matricesWeights)),this.matricesIndicesExtra&&(C.matricesIndicesExtra=Array.from(this.matricesIndicesExtra),C.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(C.matricesWeightsExtra=Array.from(this.matricesWeightsExtra)),C.indices=Array.from(this.indices),this.materialInfos){C.materialInfos=[];for(const M of this.materialInfos){const x={indexStart:M.indexStart,indexCount:M.indexCount,materialIndex:M.materialIndex,verticesStart:M.verticesStart,verticesCount:M.verticesCount};C.materialInfos.push(x)}}return C}static ExtractFromMesh(C,M,x){return d._ExtractFrom(C,M,x)}static ExtractFromGeometry(C,M,x){return d._ExtractFrom(C,M,x)}static _ExtractFrom(C,M,x){const f=new d;if(C.isVerticesDataPresent(z.h.PositionKind)&&(f.xa=C.getVerticesData(z.h.PositionKind,M,x)),C.isVerticesDataPresent(z.h.NormalKind)&&(f.ya=C.getVerticesData(z.h.NormalKind,M,x)),C.isVerticesDataPresent(z.h.TangentKind)&&(f.tangents=C.getVerticesData(z.h.TangentKind,M,x)),C.isVerticesDataPresent(z.h.UVKind)&&(f.Aa=C.getVerticesData(z.h.UVKind,M,x)),C.isVerticesDataPresent(z.h.UV2Kind)&&(f.uvs2=C.getVerticesData(z.h.UV2Kind,M,x)),C.isVerticesDataPresent(z.h.UV3Kind)&&(f.uvs3=C.getVerticesData(z.h.UV3Kind,M,x)),C.isVerticesDataPresent(z.h.UV4Kind)&&(f.uvs4=C.getVerticesData(z.h.UV4Kind,M,x)),C.isVerticesDataPresent(z.h.UV5Kind)&&(f.uvs5=C.getVerticesData(z.h.UV5Kind,M,x)),C.isVerticesDataPresent(z.h.UV6Kind)&&(f.uvs6=C.getVerticesData(z.h.UV6Kind,M,x)),C.isVerticesDataPresent(z.h.ColorKind)){const T=C.Ee||C,s=T.getVertexBuffer(z.h.ColorKind),S=T.getVerticesData(z.h.ColorKind,M,x);if(3===s.getSize()){const C=new Float32Array(4*S.length/3);for(let M=0,x=0;M<S.length;M+=3,x+=4)C[x]=S[M],C[x+1]=S[M+1],C[x+2]=S[M+2],C[x+3]=1;f.za=C}else{if(4!==s.getSize())throw new Error(`Unexpected number of color components: ${s.getSize()}`);f.za=S}}return C.isVerticesDataPresent(z.h.MatricesIndicesKind)&&(f.matricesIndices=C.getVerticesData(z.h.MatricesIndicesKind,M,x)),C.isVerticesDataPresent(z.h.MatricesWeightsKind)&&(f.matricesWeights=C.getVerticesData(z.h.MatricesWeightsKind,M,x)),C.isVerticesDataPresent(z.h.MatricesIndicesExtraKind)&&(f.matricesIndicesExtra=C.getVerticesData(z.h.MatricesIndicesExtraKind,M,x)),C.isVerticesDataPresent(z.h.MatricesWeightsExtraKind)&&(f.matricesWeightsExtra=C.getVerticesData(z.h.MatricesWeightsExtraKind,M,x)),f.indices=C.Ge(M,x),f}static CreateRibbon(C){throw(0,s.d)("ribbonBuilder")}static CreateBox(C){throw(0,s.d)("boxBuilder")}static CreateTiledBox(C){throw(0,s.d)("tiledBoxBuilder")}static CreateTiledPlane(C){throw(0,s.d)("tiledPlaneBuilder")}static CreateSphere(C){throw(0,s.d)("sphereBuilder")}static CreateCylinder(C){throw(0,s.d)("cylinderBuilder")}static CreateTorus(C){throw(0,s.d)("torusBuilder")}static CreateLineSystem(C){throw(0,s.d)("linesBuilder")}static CreateDashedLines(C){throw(0,s.d)("linesBuilder")}static CreateGround(C){throw(0,s.d)("groundBuilder")}static CreateTiledGround(C){throw(0,s.d)("groundBuilder")}static CreateGroundFromHeightMap(C){throw(0,s.d)("groundBuilder")}static Pg(C){throw(0,s.d)("planeBuilder")}static lb(C){throw(0,s.d)("discBuilder")}static CreatePolygon(C,M,x,f,T,z,S){throw(0,s.d)("polygonBuilder")}static CreateIcoSphere(C){throw(0,s.d)("icoSphereBuilder")}static CreatePolyhedron(C){throw(0,s.d)("polyhedronBuilder")}static CreateCapsule(){arguments.length>0&&void 0!==arguments[0]||T.m.Up();throw(0,s.d)("capsuleBuilder")}static CreateTorusKnot(C){throw(0,s.d)("torusKnotBuilder")}static ComputeNormals(C,M,x,f){let z=0,s=0,S=0,m=0,Q=0,V=0,y=0,U=0,O=0,d=0,D=0,o=0,L=0,t=0,A=0,H=0,j=0,b=0,R=0,n=0,I=!1,X=!1,g=!1,B=!1,F=1,P=0,h=null;f&&(I=!!f.facetNormals,X=!!f.facetPositions,g=!!f.facetPartitioning,F=!0===f.useRightHandedSystem?-1:1,P=f.ratio||0,B=!!f.depthSort,h=f.distanceTo,B&&void 0===h&&(h=T.m.Zero()));let c=0,q=0,i=0,Z=0;for(g&&f&&f.bbSize&&(c=f.subDiv.X*P/f.bbSize.x,q=f.subDiv.Y*P/f.bbSize.y,i=f.subDiv.Z*P/f.bbSize.z,Z=f.subDiv.max*f.subDiv.max,f.facetPartitioning.length=0),z=0;z<C.length;z++)x[z]=0;const E=M.length/3|0;for(z=0;z<E;z++){if(o=3*M[3*z],L=o+1,t=o+2,A=3*M[3*z+1],H=A+1,j=A+2,b=3*M[3*z+2],R=b+1,n=b+2,s=C[o]-C[A],S=C[L]-C[H],m=C[t]-C[j],Q=C[b]-C[A],V=C[R]-C[H],y=C[n]-C[j],U=F*(S*y-m*V),O=F*(m*Q-s*y),d=F*(s*V-S*Q),D=Math.sqrt(U*U+O*O+d*d),D=0===D?1:D,U/=D,O/=D,d/=D,I&&f&&(f.facetNormals[z].x=U,f.facetNormals[z].y=O,f.facetNormals[z].z=d),X&&f&&(f.facetPositions[z].x=(C[o]+C[A]+C[b])/3,f.facetPositions[z].y=(C[L]+C[H]+C[R])/3,f.facetPositions[z].z=(C[t]+C[j]+C[n])/3),g&&f){const M=Math.floor((f.facetPositions[z].x-f.bInfo.minimum.x*P)*c),x=Math.floor((f.facetPositions[z].y-f.bInfo.minimum.y*P)*q),T=Math.floor((f.facetPositions[z].z-f.bInfo.minimum.z*P)*i),s=Math.floor((C[o]-f.bInfo.minimum.x*P)*c),S=Math.floor((C[L]-f.bInfo.minimum.y*P)*q),m=Math.floor((C[t]-f.bInfo.minimum.z*P)*i),Q=Math.floor((C[A]-f.bInfo.minimum.x*P)*c),V=Math.floor((C[H]-f.bInfo.minimum.y*P)*q),y=Math.floor((C[j]-f.bInfo.minimum.z*P)*i),U=Math.floor((C[b]-f.bInfo.minimum.x*P)*c),O=Math.floor((C[R]-f.bInfo.minimum.y*P)*q),d=Math.floor((C[n]-f.bInfo.minimum.z*P)*i),D=s+f.subDiv.max*S+Z*m,I=Q+f.subDiv.max*V+Z*y,X=U+f.subDiv.max*O+Z*d,g=M+f.subDiv.max*x+Z*T;f.facetPartitioning[g]=f.facetPartitioning[g]?f.facetPartitioning[g]:new Array,f.facetPartitioning[D]=f.facetPartitioning[D]?f.facetPartitioning[D]:new Array,f.facetPartitioning[I]=f.facetPartitioning[I]?f.facetPartitioning[I]:new Array,f.facetPartitioning[X]=f.facetPartitioning[X]?f.facetPartitioning[X]:new Array,f.facetPartitioning[D].push(z),I!=D&&f.facetPartitioning[I].push(z),X!=I&&X!=D&&f.facetPartitioning[X].push(z),g!=D&&g!=I&&g!=X&&f.facetPartitioning[g].push(z)}if(B&&f&&f.facetPositions){const C=f.depthSortedFacets[z];C.ind=3*z,C.sqDistance=T.m.DistanceSquared(f.facetPositions[z],h)}x[o]+=U,x[L]+=O,x[t]+=d,x[A]+=U,x[H]+=O,x[j]+=d,x[b]+=U,x[R]+=O,x[n]+=d}for(z=0;z<x.length/3;z++)U=x[3*z],O=x[3*z+1],d=x[3*z+2],D=Math.sqrt(U*U+O*O+d*d),D=0===D?1:D,U/=D,O/=D,d/=D,x[3*z]=U,x[3*z+1]=O,x[3*z+2]=d}static _ComputeSides(C,M,x,f,z,s,S){const m=x.length,Q=f.length;let V,y;switch(C=C||d.DEFAULTSIDE){case d.FRONTSIDE:break;case d.BACKSIDE:for(V=0;V<m;V+=3){const C=x[V];x[V]=x[V+2],x[V+2]=C}for(y=0;y<Q;y++)f[y]=-f[y];break;case d.DOUBLESIDE:{const C=M.length,U=C/3;for(let x=0;x<C;x++)M[C+x]=M[x];for(V=0;V<m;V+=3)x[V+m]=x[V+2]+U,x[V+1+m]=x[V+1]+U,x[V+2+m]=x[V]+U;for(y=0;y<Q;y++)f[Q+y]=-f[y];const O=z.length;let d=0;for(d=0;d<O;d++)z[d+O]=z[d];for(s=s||new T.q(0,0,1,1),S=S||new T.q(0,0,1,1),d=0,V=0;V<O/2;V++)z[d]=s.x+(s.z-s.x)*z[d],z[d+1]=s.y+(s.w-s.y)*z[d+1],z[d+O]=S.x+(S.z-S.x)*z[d+O],z[d+O+1]=S.y+(S.w-S.y)*z[d+O+1],d+=2;break}}}static Parse(C){const M=new d,x=C.xa;x&&M.set(x,z.h.PositionKind);const f=C.ya;f&&M.set(f,z.h.NormalKind);const T=C.tangents;T&&M.set(T,z.h.TangentKind);const s=C.Aa;s&&M.set(s,z.h.UVKind);const m=C.uvs2;m&&M.set(m,z.h.UV2Kind);const Q=C.uvs3;Q&&M.set(Q,z.h.UV3Kind);const V=C.uvs4;V&&M.set(V,z.h.UV4Kind);const y=C.uvs5;y&&M.set(y,z.h.UV5Kind);const U=C.uvs6;U&&M.set(U,z.h.UV6Kind);const D=C.za;D&&(M.set(S.e.CheckColors4(D,x.length/3),z.h.ColorKind),void 0!==C.hasVertexAlpha&&(M.hasVertexAlpha=C.hasVertexAlpha));const o=C.matricesIndices;o&&M.set(o,z.h.MatricesIndicesKind);const L=C.matricesWeights;L&&M.set(L,z.h.MatricesWeightsKind);const t=C.indices;t&&(M.indices=t);const A=C.materialInfos;if(A){M.materialInfos=[];for(const C of A){const x=new O;x.indexCount=C.indexCount,x.indexStart=C.indexStart,x.verticesCount=C.verticesCount,x.verticesStart=C.verticesStart,x.materialIndex=C.materialIndex,M.materialInfos.push(x)}}return M}static ImportVertexData(C,M){const x=d.Parse(C);M.setAllVerticesData(x,C.updatable)}}d.FRONTSIDE=0,d.BACKSIDE=1,d.DOUBLESIDE=2,d.DEFAULTSIDE=0,d._UniqueIDGenerator=0,(0,f.e)([Q.i.filter((function(){for(var C=arguments.length,M=new Array(C),x=0;x<C;x++)M[x]=arguments[x];let[f]=M;return!Array.isArray(f)}))],d,"_TransformVector3Coordinates",null),(0,f.e)([Q.i.filter((function(){for(var C=arguments.length,M=new Array(C),x=0;x<C;x++)M[x]=arguments[x];let[f]=M;return!Array.isArray(f)}))],d,"_TransformVector3Normals",null),(0,f.e)([Q.i.filter((function(){for(var C=arguments.length,M=new Array(C),x=0;x<C;x++)M[x]=arguments[x];let[f]=M;return!Array.isArray(f)}))],d,"_TransformVector4Normals",null),(0,f.e)([Q.i.filter((function(){for(var C=arguments.length,M=new Array(C),x=0;x<C;x++)M[x]=arguments[x];let[f]=M;return!Array.isArray(f)}))],d,"_FlipFaces",null)},12709:(C,M,x)=>{"use strict";x.d(M,{c:()=>DC});var f=x(978),T=x(11712),z=x(1224),s=x(11739),S=x(1178);function m(C){let M=C.pathArray;const x=C.closeArray||!1,f=C.closePath||!1,T=C.invertUV||!1,m=Math.floor(M[0].length/2);let Q=C.offset||m;Q=Q>m?m:Math.floor(Q);const V=0===C.sideOrientation?0:C.sideOrientation||s.b.DEFAULTSIDE,y=C.Aa,U=C.za,O=[],d=[],D=[],o=[],L=[],t=[],A=[],H=[];let j;const b=[],R=[];let n,I,X;if(M.length<2){const C=[],x=[];for(I=0;I<M[0].length-Q;I++)C.push(M[0][I]),x.push(M[0][I+Q]);M=[C,x]}let g=0;const B=f?1:0,F=x?1:0;let P,h,c,q,i,Z;for(j=M[0].length,n=0;n<M.length+F;n++){for(A[n]=0,L[n]=[0],P=n===M.length?M[0]:M[n],h=P.length,j=j<h?j:h,X=0;X<h;)O.push(P[X].x,P[X].y,P[X].z),X>0&&(c=P[X].rc(P[X-1]).length(),q=c+A[n],L[n].push(q),A[n]=q),X++;f&&(X--,O.push(P[0].x,P[0].y,P[0].z),c=P[X].rc(P[0]).length(),q=c+A[n],L[n].push(q),A[n]=q),b[n]=h+B,R[n]=g,g+=h+B}let E,K,G=null,a=null;for(I=0;I<j+B;I++)for(H[I]=0,t[I]=[0],n=0;n<M.length-1+F;n++)i=M[n],Z=n===M.length-1?M[0]:M[n+1],I===j?(G=i[0],a=Z[0]):(G=i[I],a=Z[I]),c=a.rc(G).length(),q=c+H[I],t[I].push(q),H[I]=q;if(y)for(n=0;n<y.length;n++)o.push(y[n].x,S.c?1-y[n].y:y[n].y);else for(n=0;n<M.length+F;n++)for(I=0;I<j+B;I++)E=0!=A[n]?L[n][I]/A[n]:0,K=0!=H[I]?t[I][n]/H[I]:0,T?o.push(K,E):o.push(E,S.c?1-K:K);n=0;let J=0,N=b[n]-1,k=b[n+1]-1,v=N<k?N:k,p=R[1]-R[0];const u=b.length-1;for(;J<=v&&n<u;)d.push(J,J+p,J+1),d.push(J+p+1,J+1,J+p),J+=1,J===v&&(n++,p=R[n+1]-R[n],N=b[n]-1,k=b[n+1]-1,J=R[n],v=N<k?N+J:k+J);if(s.b.ComputeNormals(O,d,D),f){let C=0,x=0;for(n=0;n<M.length;n++){C=3*R[n],x=n+1<M.length?3*(R[n+1]-1):D.length-3,D[C]=.5*(D[C]+D[x]),D[C+1]=.5*(D[C+1]+D[x+1]),D[C+2]=.5*(D[C+2]+D[x+2]);const f=Math.sqrt(D[C]*D[C]+D[C+1]*D[C+1]+D[C+2]*D[C+2]);D[C]/=f,D[C+1]/=f,D[C+2]/=f,D[x]=D[C],D[x+1]=D[C+1],D[x+2]=D[C+2]}}if(x){let C=3*R[0],x=3*R[M.length];for(I=0;I<j+B;I++){D[C]=.5*(D[C]+D[x]),D[C+1]=.5*(D[C+1]+D[x+1]),D[C+2]=.5*(D[C+2]+D[x+2]);const M=Math.sqrt(D[C]*D[C]+D[C+1]*D[C+1]+D[C+2]*D[C+2]);D[C]/=M,D[C+1]/=M,D[C+2]/=M,D[x]=D[C],D[x+1]=D[C+1],D[x+2]=D[C+2],C+=3,x+=3}}s.b._ComputeSides(V,O,d,D,o,C.frontUVs,C.backUVs);let Y=null;if(U){Y=new Float32Array(4*U.length);for(let C=0;C<U.length;C++)Y[4*C]=U[C].r,Y[4*C+1]=U[C].g,Y[4*C+2]=U[C].b,Y[4*C+3]=U[C].a}const W=new s.b,e=new Float32Array(O),r=new Float32Array(D),w=new Float32Array(o);return W.indices=d,W.xa=e,W.ya=r,W.Aa=w,Y&&W.set(Y,z.h.ColorKind),f&&(W._idx=R),W}function Q(C,M){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=M.pathArray,V=M.closeArray,y=M.closePath,U=T.d._GetDefaultSideOrientation(M.sideOrientation),O=M.instance,d=M.updatable;if(O){const C=f.i.Md[0].Kd(Number.MAX_VALUE),x=f.i.Md[1].Kd(-Number.MAX_VALUE),m=M=>{let f=Q[0].length;const z=O;let s=0;const S=z._originalBuilderSideOrientation===T.d.DOUBLESIDE?2:1;for(let T=1;T<=S;++T)for(let S=0;S<Q.length;++S){const T=Q[S],m=T.length;f=f<m?f:m;for(let z=0;z<f;++z){const f=T[z];M[s]=f.x,M[s+1]=f.y,M[s+2]=f.z,C.minimizeInPlaceFromFloats(f.x,f.y,f.z),x.maximizeInPlaceFromFloats(f.x,f.y,f.z),s+=3}if(z._creationDataStorage&&z._creationDataStorage.closePath){const C=T[0];M[s]=C.x,M[s+1]=C.y,M[s+2]=C.z,s+=3}}},V=O.getVerticesData(z.h.PositionKind);if(m(V),O.hasBoundingInfo?O.getBoundingInfo().reConstruct(C,x,O._worldMatrix):O.buildBoundingInfo(C,x,O._worldMatrix),O.updateVerticesData(z.h.PositionKind,V,!1,!1),M.za){const C=O.getVerticesData(z.h.ColorKind);for(let x=0,f=0;x<M.za.length;x++,f+=4){const T=M.za[x];C[f]=T.r,C[f+1]=T.g,C[f+2]=T.b,C[f+3]=T.a}O.updateVerticesData(z.h.ColorKind,C,!1,!1)}if(M.Aa){const C=O.getVerticesData(z.h.UVKind);for(let x=0;x<M.Aa.length;x++)C[2*x]=M.Aa[x].x,C[2*x+1]=S.c?1-M.Aa[x].y:M.Aa[x].y;O.updateVerticesData(z.h.UVKind,C,!1,!1)}if(!O.areNormalsFrozen||O.isFacetDataEnabled){const C=O.Ge(),M=O.getVerticesData(z.h.NormalKind),x=O.isFacetDataEnabled?O.getFacetDataParameters():null;if(s.b.ComputeNormals(V,C,M,x),O._creationDataStorage&&O._creationDataStorage.closePath){let C=0,x=0;for(let f=0;f<Q.length;f++)C=3*O._creationDataStorage.idx[f],x=f+1<Q.length?3*(O._creationDataStorage.idx[f+1]-1):M.length-3,M[C]=.5*(M[C]+M[x]),M[C+1]=.5*(M[C+1]+M[x+1]),M[C+2]=.5*(M[C+2]+M[x+2]),M[x]=M[C],M[x+1]=M[C+1],M[x+2]=M[C+2]}O.areNormalsFrozen||O.updateVerticesData(z.h.NormalKind,M,!1,!1)}return O}{const f=new T.d(C,x);f._originalBuilderSideOrientation=U,f._creationDataStorage=new T.h;const z=m(M);return y&&(f._creationDataStorage.idx=z._idx),f._creationDataStorage.closePath=y,f._creationDataStorage.closeArray=V,z.Ca(f,d),f}}s.b.CreateRibbon=m,T.d.CreateRibbon=function(C,M){return Q(C,{pathArray:M,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var V=x(11883),y=x(11770),U=x(1162);function O(C){const M=C.pattern||T.d.NO_FLIP,x=C.tileWidth||C.tileSize||1,f=C.tileHeight||C.tileSize||1,z=C.alignHorizontal||0,S=C.alignVertical||0,m=C.width||C.size||1,Q=Math.floor(m/x);let V=m-Q*x;const y=C.height||C.size||1,U=Math.floor(y/f);let O=y-U*f;const d=x*Q/2,D=f*U/2;let o=0,L=0,t=0,A=0,H=0,j=0;if(V>0||O>0){switch(t=-d,A=-D,H=d,j=D,z){case T.d.CENTER:V/=2,t-=V,H+=V;break;case T.d.LEFT:H+=V,o=-V/2;break;case T.d.RIGHT:t-=V,o=V/2}switch(S){case T.d.CENTER:O/=2,A-=O,j+=O;break;case T.d.BOTTOM:j+=O,L=-O/2;break;case T.d.TOP:A-=O,L=O/2}}const b=[],R=[],n=[];n[0]=[0,0,1,0,1,1,0,1],n[1]=[0,0,1,0,1,1,0,1],M!==T.d.ROTATE_TILE&&M!==T.d.ROTATE_ROW||(n[1]=[1,1,0,1,0,0,1,0]),M!==T.d.FLIP_TILE&&M!==T.d.FLIP_ROW||(n[1]=[1,0,0,0,0,1,1,1]),M!==T.d.FLIP_N_ROTATE_TILE&&M!==T.d.FLIP_N_ROTATE_ROW||(n[1]=[0,1,1,1,1,0,0,0]);let I=[];const X=[],g=[];let B=0;for(let s=0;s<U;s++)for(let C=0;C<Q;C++)b.push(C*x-d+o,s*f-D+L,0),b.push((C+1)*x-d+o,s*f-D+L,0),b.push((C+1)*x-d+o,(s+1)*f-D+L,0),b.push(C*x-d+o,(s+1)*f-D+L,0),g.push(B,B+1,B+3,B+1,B+2,B+3),I=M===T.d.FLIP_TILE||M===T.d.ROTATE_TILE||M===T.d.FLIP_N_ROTATE_TILE?I.concat(n[(C%2+s%2)%2]):M===T.d.FLIP_ROW||M===T.d.ROTATE_ROW||M===T.d.FLIP_N_ROTATE_ROW?I.concat(n[s%2]):I.concat(n[0]),X.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),R.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),B+=4;if(V>0||O>0){const C=O>0&&(S===T.d.CENTER||S===T.d.TOP),s=O>0&&(S===T.d.CENTER||S===T.d.BOTTOM),m=V>0&&(z===T.d.CENTER||z===T.d.RIGHT),y=V>0&&(z===T.d.CENTER||z===T.d.LEFT);let n,F,P,h,c=[];if(C&&m&&(b.push(t+o,A+L,0),b.push(-d+o,A+L,0),b.push(-d+o,A+O+L,0),b.push(t+o,A+O+L,0),g.push(B,B+1,B+3,B+1,B+2,B+3),B+=4,n=1-V/x,F=1-O/f,P=1,h=1,c=[n,F,P,F,P,h,n,h],M===T.d.ROTATE_ROW&&(c=[1-n,1-F,1-P,1-F,1-P,1-h,1-n,1-h]),M===T.d.FLIP_ROW&&(c=[1-n,F,1-P,F,1-P,h,1-n,h]),M===T.d.FLIP_N_ROTATE_ROW&&(c=[n,1-F,P,1-F,P,1-h,n,1-h]),I=I.concat(c),X.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),R.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),C&&y&&(b.push(d+o,A+L,0),b.push(H+o,A+L,0),b.push(H+o,A+O+L,0),b.push(d+o,A+O+L,0),g.push(B,B+1,B+3,B+1,B+2,B+3),B+=4,n=0,F=1-O/f,P=V/x,h=1,c=[n,F,P,F,P,h,n,h],(M===T.d.ROTATE_ROW||M===T.d.ROTATE_TILE&&Q%2===0)&&(c=[1-n,1-F,1-P,1-F,1-P,1-h,1-n,1-h]),(M===T.d.FLIP_ROW||M===T.d.FLIP_TILE&&Q%2===0)&&(c=[1-n,F,1-P,F,1-P,h,1-n,h]),(M===T.d.FLIP_N_ROTATE_ROW||M===T.d.FLIP_N_ROTATE_TILE&&Q%2===0)&&(c=[n,1-F,P,1-F,P,1-h,n,1-h]),I=I.concat(c),X.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),R.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),s&&m&&(b.push(t+o,D+L,0),b.push(-d+o,D+L,0),b.push(-d+o,j+L,0),b.push(t+o,j+L,0),g.push(B,B+1,B+3,B+1,B+2,B+3),B+=4,n=1-V/x,F=0,P=1,h=O/f,c=[n,F,P,F,P,h,n,h],(M===T.d.ROTATE_ROW&&U%2===1||M===T.d.ROTATE_TILE&&U%1===0)&&(c=[1-n,1-F,1-P,1-F,1-P,1-h,1-n,1-h]),(M===T.d.FLIP_ROW&&U%2===1||M===T.d.FLIP_TILE&&U%2===0)&&(c=[1-n,F,1-P,F,1-P,h,1-n,h]),(M===T.d.FLIP_N_ROTATE_ROW&&U%2===1||M===T.d.FLIP_N_ROTATE_TILE&&U%2===0)&&(c=[n,1-F,P,1-F,P,1-h,n,1-h]),I=I.concat(c),X.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),R.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),s&&y&&(b.push(d+o,D+L,0),b.push(H+o,D+L,0),b.push(H+o,j+L,0),b.push(d+o,j+L,0),g.push(B,B+1,B+3,B+1,B+2,B+3),B+=4,n=0,F=0,P=V/x,h=O/f,c=[n,F,P,F,P,h,n,h],(M===T.d.ROTATE_ROW&&U%2===1||M===T.d.ROTATE_TILE&&(U+Q)%2===1)&&(c=[1-n,1-F,1-P,1-F,1-P,1-h,1-n,1-h]),(M===T.d.FLIP_ROW&&U%2===1||M===T.d.FLIP_TILE&&(U+Q)%2===1)&&(c=[1-n,F,1-P,F,1-P,h,1-n,h]),(M===T.d.FLIP_N_ROTATE_ROW&&U%2===1||M===T.d.FLIP_N_ROTATE_TILE&&(U+Q)%2===1)&&(c=[n,1-F,P,1-F,P,1-h,n,1-h]),I=I.concat(c),X.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),R.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),C){const C=[];n=0,F=1-O/f,P=1,h=1,C[0]=[n,F,P,F,P,h,n,h],C[1]=[n,F,P,F,P,h,n,h],M!==T.d.ROTATE_TILE&&M!==T.d.ROTATE_ROW||(C[1]=[1-n,1-F,1-P,1-F,1-P,1-h,1-n,1-h]),M!==T.d.FLIP_TILE&&M!==T.d.FLIP_ROW||(C[1]=[1-n,F,1-P,F,1-P,h,1-n,h]),M!==T.d.FLIP_N_ROTATE_TILE&&M!==T.d.FLIP_N_ROTATE_ROW||(C[1]=[n,1-F,P,1-F,P,1-h,n,1-h]);for(let f=0;f<Q;f++)b.push(f*x-d+o,A+L,0),b.push((f+1)*x-d+o,A+L,0),b.push((f+1)*x-d+o,A+O+L,0),b.push(f*x-d+o,A+O+L,0),g.push(B,B+1,B+3,B+1,B+2,B+3),B+=4,I=M===T.d.FLIP_TILE||M===T.d.ROTATE_TILE||M===T.d.FLIP_N_ROTATE_TILE?I.concat(C[(f+1)%2]):M===T.d.FLIP_ROW||M===T.d.ROTATE_ROW||M===T.d.FLIP_N_ROTATE_ROW?I.concat(C[1]):I.concat(C[0]),X.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),R.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(s){const C=[];n=0,F=0,P=1,h=O/f,C[0]=[n,F,P,F,P,h,n,h],C[1]=[n,F,P,F,P,h,n,h],M!==T.d.ROTATE_TILE&&M!==T.d.ROTATE_ROW||(C[1]=[1-n,1-F,1-P,1-F,1-P,1-h,1-n,1-h]),M!==T.d.FLIP_TILE&&M!==T.d.FLIP_ROW||(C[1]=[1-n,F,1-P,F,1-P,h,1-n,h]),M!==T.d.FLIP_N_ROTATE_TILE&&M!==T.d.FLIP_N_ROTATE_ROW||(C[1]=[n,1-F,P,1-F,P,1-h,n,1-h]);for(let f=0;f<Q;f++)b.push(f*x-d+o,j-O+L,0),b.push((f+1)*x-d+o,j-O+L,0),b.push((f+1)*x-d+o,j+L,0),b.push(f*x-d+o,j+L,0),g.push(B,B+1,B+3,B+1,B+2,B+3),B+=4,I=M===T.d.FLIP_TILE||M===T.d.ROTATE_TILE||M===T.d.FLIP_N_ROTATE_TILE?I.concat(C[(f+U)%2]):M===T.d.FLIP_ROW||M===T.d.ROTATE_ROW||M===T.d.FLIP_N_ROTATE_ROW?I.concat(C[U%2]):I.concat(C[0]),X.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),R.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(m){const C=[];n=1-V/x,F=0,P=1,h=1,C[0]=[n,F,P,F,P,h,n,h],C[1]=[n,F,P,F,P,h,n,h],M!==T.d.ROTATE_TILE&&M!==T.d.ROTATE_ROW||(C[1]=[1-n,1-F,1-P,1-F,1-P,1-h,1-n,1-h]),M!==T.d.FLIP_TILE&&M!==T.d.FLIP_ROW||(C[1]=[1-n,F,1-P,F,1-P,h,1-n,h]),M!==T.d.FLIP_N_ROTATE_TILE&&M!==T.d.FLIP_N_ROTATE_ROW||(C[1]=[n,1-F,P,1-F,P,1-h,n,1-h]);for(let x=0;x<U;x++)b.push(t+o,x*f-D+L,0),b.push(t+V+o,x*f-D+L,0),b.push(t+V+o,(x+1)*f-D+L,0),b.push(t+o,(x+1)*f-D+L,0),g.push(B,B+1,B+3,B+1,B+2,B+3),B+=4,I=M===T.d.FLIP_TILE||M===T.d.ROTATE_TILE||M===T.d.FLIP_N_ROTATE_TILE?I.concat(C[(x+1)%2]):M===T.d.FLIP_ROW||M===T.d.ROTATE_ROW||M===T.d.FLIP_N_ROTATE_ROW?I.concat(C[x%2]):I.concat(C[0]),X.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),R.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(y){const C=[];n=0,F=0,P=V/f,h=1,C[0]=[n,F,P,F,P,h,n,h],C[1]=[n,F,P,F,P,h,n,h],M!==T.d.ROTATE_TILE&&M!==T.d.ROTATE_ROW||(C[1]=[1-n,1-F,1-P,1-F,1-P,1-h,1-n,1-h]),M!==T.d.FLIP_TILE&&M!==T.d.FLIP_ROW||(C[1]=[1-n,F,1-P,F,1-P,h,1-n,h]),M!==T.d.FLIP_N_ROTATE_TILE&&M!==T.d.FLIP_N_ROTATE_ROW||(C[1]=[n,1-F,P,1-F,P,1-h,n,1-h]);for(let x=0;x<U;x++)b.push(H-V+o,x*f-D+L,0),b.push(H+o,x*f-D+L,0),b.push(H+o,(x+1)*f-D+L,0),b.push(H-V+o,(x+1)*f-D+L,0),g.push(B,B+1,B+3,B+1,B+2,B+3),B+=4,I=M===T.d.FLIP_TILE||M===T.d.ROTATE_TILE||M===T.d.FLIP_N_ROTATE_TILE?I.concat(C[(x+Q)%2]):M===T.d.FLIP_ROW||M===T.d.ROTATE_ROW||M===T.d.FLIP_N_ROTATE_ROW?I.concat(C[x%2]):I.concat(C[0]),X.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),R.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const F=0===C.sideOrientation?0:C.sideOrientation||s.b.DEFAULTSIDE;s.b._ComputeSides(F,b,g,R,I,C.frontUVs,C.backUVs);const P=new s.b;P.indices=g,P.xa=b,P.ya=R,P.Aa=I;const h=F===s.b.DOUBLESIDE?X.concat(X):X;return P.za=h,P}function d(C,M){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const f=new T.d(C,x);M.sideOrientation=T.d._GetDefaultSideOrientation(M.sideOrientation),f._originalBuilderSideOrientation=M.sideOrientation;return O(M).Ca(f,M.updatable),f}function D(C){const M=C.faceUV||new Array(6),x=C.faceColors,z=C.pattern||T.d.NO_FLIP,m=C.width||C.size||1,Q=C.height||C.size||1,V=C.depth||C.size||1,y=C.tileWidth||C.tileSize||1,d=C.tileHeight||C.tileSize||1,D=C.alignHorizontal||0,o=C.alignVertical||0,L=0===C.sideOrientation?0:C.sideOrientation||s.b.DEFAULTSIDE;for(let T=0;T<6;T++)void 0===M[T]&&(M[T]=new f.q(0,0,1,1)),x&&void 0===x[T]&&(x[T]=new U.e(1,1,1,1));const t=m/2,A=Q/2,H=V/2,j=[];for(let f=0;f<2;f++)j[f]=O({pattern:z,tileWidth:y,tileHeight:d,width:m,height:Q,alignVertical:o,alignHorizontal:D,sideOrientation:L});for(let f=2;f<4;f++)j[f]=O({pattern:z,tileWidth:y,tileHeight:d,width:V,height:Q,alignVertical:o,alignHorizontal:D,sideOrientation:L});let b=o;o===T.d.BOTTOM?b=T.d.TOP:o===T.d.TOP&&(b=T.d.BOTTOM);for(let f=4;f<6;f++)j[f]=O({pattern:z,tileWidth:y,tileHeight:d,width:m,height:V,alignVertical:b,alignHorizontal:D,sideOrientation:L});let R=[],n=[],I=[],X=[];const g=[],B=[],F=[],P=[];let h=0,c=0;for(let T=0;T<6;T++){const C=j[T].xa.length;B[T]=[],F[T]=[];for(let M=0;M<C/3;M++)B[T].push(new f.m(j[T].xa[3*M],j[T].xa[3*M+1],j[T].xa[3*M+2])),F[T].push(new f.m(j[T].ya[3*M],j[T].ya[3*M+1],j[T].ya[3*M+2]));h=j[T].Aa.length,P[T]=[];for(let x=0;x<h;x+=2)P[T][x]=M[T].x+(M[T].z-M[T].x)*j[T].Aa[x],P[T][x+1]=M[T].y+(M[T].w-M[T].y)*j[T].Aa[x+1],S.c&&(P[T][x+1]=1-P[T][x+1]);if(I=I.concat(P[T]),X=X.concat(j[T].indices.map((C=>C+c))),c+=B[T].length,x)for(let M=0;M<4;M++)g.push(x[T].r,x[T].g,x[T].b,x[T].a)}const q=new f.m(0,0,H),i=f.d.RotationY(Math.PI);R=B[0].map((C=>f.m.TransformNormal(C,i).add(q))).map((C=>[C.x,C.y,C.z])).reduce(((C,M)=>C.concat(M)),[]),n=F[0].map((C=>f.m.TransformNormal(C,i))).map((C=>[C.x,C.y,C.z])).reduce(((C,M)=>C.concat(M)),[]),R=R.concat(B[1].map((C=>C.rc(q))).map((C=>[C.x,C.y,C.z])).reduce(((C,M)=>C.concat(M)),[])),n=n.concat(F[1].map((C=>[C.x,C.y,C.z])).reduce(((C,M)=>C.concat(M)),[]));const Z=new f.m(t,0,0),E=f.d.RotationY(-Math.PI/2);R=R.concat(B[2].map((C=>f.m.TransformNormal(C,E).add(Z))).map((C=>[C.x,C.y,C.z])).reduce(((C,M)=>C.concat(M)),[])),n=n.concat(F[2].map((C=>f.m.TransformNormal(C,E))).map((C=>[C.x,C.y,C.z])).reduce(((C,M)=>C.concat(M)),[]));const K=f.d.RotationY(Math.PI/2);R=R.concat(B[3].map((C=>f.m.TransformNormal(C,K).rc(Z))).map((C=>[C.x,C.y,C.z])).reduce(((C,M)=>C.concat(M)),[])),n=n.concat(F[3].map((C=>f.m.TransformNormal(C,K))).map((C=>[C.x,C.y,C.z])).reduce(((C,M)=>C.concat(M)),[]));const G=new f.m(0,A,0),a=f.d.RotationX(Math.PI/2);R=R.concat(B[4].map((C=>f.m.TransformNormal(C,a).add(G))).map((C=>[C.x,C.y,C.z])).reduce(((C,M)=>C.concat(M)),[])),n=n.concat(F[4].map((C=>f.m.TransformNormal(C,a))).map((C=>[C.x,C.y,C.z])).reduce(((C,M)=>C.concat(M)),[]));const J=f.d.RotationX(-Math.PI/2);R=R.concat(B[5].map((C=>f.m.TransformNormal(C,J).rc(G))).map((C=>[C.x,C.y,C.z])).reduce(((C,M)=>C.concat(M)),[])),n=n.concat(F[5].map((C=>f.m.TransformNormal(C,J))).map((C=>[C.x,C.y,C.z])).reduce(((C,M)=>C.concat(M)),[])),s.b._ComputeSides(L,R,X,n,I);const N=new s.b;if(N.indices=X,N.xa=R,N.ya=n,N.Aa=I,x){const C=L===s.b.DOUBLESIDE?g.concat(g):g;N.za=C}return N}function o(C,M){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const f=new T.d(C,x);M.sideOrientation=T.d._GetDefaultSideOrientation(M.sideOrientation),f._originalBuilderSideOrientation=M.sideOrientation;return D(M).Ca(f,M.updatable),f}s.b.CreateTiledPlane=O;s.b.CreateTiledBox=D;var L=x(11873),t=x(1190),A=x(1447);function H(C){const M=C.height||2;let x=0===C.diameterTop?0:C.diameterTop||C.diameter||1,z=0===C.diameterBottom?0:C.diameterBottom||C.diameter||1;x=x||1e-5,z=z||1e-5;const m=0|(C.$k||24),Q=0|(C.subdivisions||1),V=!!C.hasRings,y=!!C.enclose,O=0===C.cap?0:C.cap||T.d.CAP_ALL,d=C.arc&&(C.arc<=0||C.arc>1)?1:C.arc||1,D=0===C.sideOrientation?0:C.sideOrientation||s.b.DEFAULTSIDE,o=C.faceUV||new Array(3),L=C.faceColors,t=2+(1+(1!==d&&y?2:0))*(V?Q:1);let H;for(H=0;H<t;H++)L&&void 0===L[H]&&(L[H]=new U.e(1,1,1,1));for(H=0;H<t;H++)o&&void 0===o[H]&&(o[H]=new f.q(0,0,1,1));const j=[],b=[],R=[],n=[],I=[],X=2*Math.PI*d/m;let g,B,F;const P=(z-x)/2/M,h=f.m.Zero(),c=f.m.Zero(),q=f.m.Zero(),i=f.m.Zero(),Z=f.m.Zero(),E=A.d.Y;let K,G,a,J=1,N=1,k=0,v=0;for(K=0;K<=Q;K++)for(B=K/Q,F=(B*(x-z)+z)/2,J=V&&0!==K&&K!==Q?2:1,a=0;a<J;a++){for(V&&(N+=a),y&&(N+=2*a),G=0;G<=m;G++)g=G*X,h.x=Math.cos(-g)*F,h.y=-M/2+B*M,h.z=Math.sin(-g)*F,0===x&&K===Q?(c.x=R[R.length-3*(m+1)],c.y=R[R.length-3*(m+1)+1],c.z=R[R.length-3*(m+1)+2]):(c.x=h.x,c.z=h.z,c.y=Math.sqrt(c.x*c.x+c.z*c.z)*P,c.normalize()),0===G&&(q.p(h),i.p(c)),b.push(h.x,h.y,h.z),R.push(c.x,c.y,c.z),v=V?k!==N?o[N].y:o[N].w:o[N].y+(o[N].w-o[N].y)*B,n.push(o[N].x+(o[N].z-o[N].x)*G/m,S.c?1-v:v),L&&I.push(L[N].r,L[N].g,L[N].b,L[N].a);1!==d&&y&&(b.push(h.x,h.y,h.z),b.push(0,h.y,0),b.push(0,h.y,0),b.push(q.x,q.y,q.z),f.m.CrossToRef(E,c,Z),Z.normalize(),R.push(Z.x,Z.y,Z.z,Z.x,Z.y,Z.z),f.m.CrossToRef(i,E,Z),Z.normalize(),R.push(Z.x,Z.y,Z.z,Z.x,Z.y,Z.z),v=V?k!==N?o[N+1].y:o[N+1].w:o[N+1].y+(o[N+1].w-o[N+1].y)*B,n.push(o[N+1].x,S.c?1-v:v),n.push(o[N+1].z,S.c?1-v:v),v=V?k!==N?o[N+2].y:o[N+2].w:o[N+2].y+(o[N+2].w-o[N+2].y)*B,n.push(o[N+2].x,S.c?1-v:v),n.push(o[N+2].z,S.c?1-v:v),L&&(I.push(L[N+1].r,L[N+1].g,L[N+1].b,L[N+1].a),I.push(L[N+1].r,L[N+1].g,L[N+1].b,L[N+1].a),I.push(L[N+2].r,L[N+2].g,L[N+2].b,L[N+2].a),I.push(L[N+2].r,L[N+2].g,L[N+2].b,L[N+2].a))),k!==N&&(k=N)}const p=1!==d&&y?m+4:m;for(K=0,N=0;N<Q;N++){let C=0,M=0,x=0,f=0;for(G=0;G<m;G++)C=K*(p+1)+G,M=(K+1)*(p+1)+G,x=K*(p+1)+(G+1),f=(K+1)*(p+1)+(G+1),j.push(C,M,x),j.push(f,x,M);1!==d&&y&&(j.push(C+2,M+2,x+2),j.push(f+2,x+2,M+2),j.push(C+4,M+4,x+4),j.push(f+4,x+4,M+4)),K=V?K+2:K+1}const u=C=>{const T=C?x/2:z/2;if(0===T)return;let s,Q,V;const y=C?o[t-1]:o[0];let U=null;L&&(U=C?L[t-1]:L[0]);const O=b.length/3,D=C?M/2:-M/2,A=new f.m(0,D,0);b.push(A.x,A.y,A.z),R.push(0,C?1:-1,0);const H=y.y+.5*(y.w-y.y);n.push(y.x+.5*(y.z-y.x),S.c?1-H:H),U&&I.push(U.r,U.g,U.b,U.a);const X=new f.j(.5,.5);for(V=0;V<=m;V++){s=2*Math.PI*V*d/m;const M=Math.cos(-s),x=Math.sin(-s);Q=new f.m(M*T,D,x*T);const z=new f.j(M*X.x+.5,x*X.y+.5);b.push(Q.x,Q.y,Q.z),R.push(0,C?1:-1,0);const O=y.y+(y.w-y.y)*z.y;n.push(y.x+(y.z-y.x)*z.x,S.c?1-O:O),U&&I.push(U.r,U.g,U.b,U.a)}for(V=0;V<m;V++)C?(j.push(O),j.push(O+(V+2)),j.push(O+(V+1))):(j.push(O),j.push(O+(V+1)),j.push(O+(V+2)))};O!==T.d.CAP_START&&O!==T.d.CAP_ALL||u(!1),O!==T.d.CAP_END&&O!==T.d.CAP_ALL||u(!0),s.b._ComputeSides(D,b,j,R,n,C.frontUVs,C.backUVs);const Y=new s.b;return Y.indices=j,Y.xa=b,Y.ya=R,Y.Aa=n,L&&(Y.za=I),Y}function j(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},x=arguments.length>2?arguments[2]:void 0;const f=new T.d(C,x);M.sideOrientation=T.d._GetDefaultSideOrientation(M.sideOrientation),f._originalBuilderSideOrientation=M.sideOrientation;return H(M).Ca(f,M.updatable),f}function b(C){const M=[],x=[],T=[],z=[],m=C.diameter||1,Q=C.thickness||.5,V=0|(C.$k||16),y=0===C.sideOrientation?0:C.sideOrientation||s.b.DEFAULTSIDE,U=V+1;for(let s=0;s<=V;s++){const C=s/V,y=s*Math.PI*2/V-Math.PI/2,O=f.d.Translation(m/2,0,0).multiply(f.d.RotationY(y));for(let m=0;m<=V;m++){const y=1-m/V,d=m*Math.PI*2/V+Math.PI,D=Math.cos(d),o=Math.sin(d);let L=new f.m(D,o,0),t=L.scale(Q/2);const A=new f.j(C,y);t=f.m.TransformCoordinates(t,O),L=f.m.TransformNormal(L,O),x.push(t.x,t.y,t.z),T.push(L.x,L.y,L.z),z.push(A.x,S.c?1-A.y:A.y);const H=(s+1)%U,j=(m+1)%U;M.push(s*U+m),M.push(s*U+j),M.push(H*U+m),M.push(s*U+j),M.push(H*U+j),M.push(H*U+m)}}s.b._ComputeSides(y,x,M,T,z,C.frontUVs,C.backUVs);const O=new s.b;return O.indices=M,O.xa=x,O.ya=T,O.Aa=z,O}function R(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},x=arguments.length>2?arguments[2]:void 0;const f=new T.d(C,x);M.sideOrientation=T.d._GetDefaultSideOrientation(M.sideOrientation),f._originalBuilderSideOrientation=M.sideOrientation;return b(M).Ca(f,M.updatable),f}s.b.CreateCylinder=H,T.d.CreateCylinder=(C,M,x,f,z,s,S,m,Q)=>{void 0!==S&&S instanceof t.e||(void 0!==S&&(Q=m||T.d.DEFAULTSIDE,m=S),S=s,s=1);return j(C,{height:M,diameterTop:x,diameterBottom:f,$k:z,subdivisions:s,sideOrientation:Q,updatable:m},S)};function n(C){const M=[],x=[],T=[],z=[],m=C.i||2,Q=C.tube||.5,V=C.radialSegments||32,y=C.tubularSegments||32,U=C.p||2,O=C.q||3,d=0===C.sideOrientation?0:C.sideOrientation||s.b.DEFAULTSIDE,D=C=>{const M=Math.cos(C),x=Math.sin(C),T=O/U*C,z=Math.cos(T),s=m*(2+z)*.5*M,S=m*(2+z)*x*.5,Q=m*Math.sin(T)*.5;return new f.m(s,S,Q)};let o,L;for(o=0;o<=V;o++){const C=o%V/V*2*U*Math.PI,M=D(C),T=D(C+.01),s=T.rc(M);let m=T.add(M);const O=f.m.Cross(s,m);for(m=f.m.Cross(O,s),O.normalize(),m.normalize(),L=0;L<y;L++){const C=L%y/y*2*Math.PI,f=-Q*Math.cos(C),T=Q*Math.sin(C);x.push(M.x+f*m.x+T*O.x),x.push(M.y+f*m.y+T*O.y),x.push(M.z+f*m.z+T*O.z),z.push(o/V),z.push(S.c?1-L/y:L/y)}}for(o=0;o<V;o++)for(L=0;L<y;L++){const C=(L+1)%y,x=o*y+L,f=(o+1)*y+L,T=(o+1)*y+C,z=o*y+C;M.push(z),M.push(f),M.push(x),M.push(z),M.push(T),M.push(f)}s.b.ComputeNormals(x,M,T),s.b._ComputeSides(d,x,M,T,z,C.frontUVs,C.backUVs);const t=new s.b;return t.indices=M,t.xa=x,t.ya=T,t.Aa=z,t}function I(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},x=arguments.length>2?arguments[2]:void 0;const f=new T.d(C,x);M.sideOrientation=T.d._GetDefaultSideOrientation(M.sideOrientation),f._originalBuilderSideOrientation=M.sideOrientation;return n(M).Ca(f,M.updatable),f}s.b.CreateTorus=b,T.d.CreateTorus=(C,M,x,f,T,z,s)=>R(C,{diameter:M,thickness:x,$k:f,sideOrientation:s,updatable:z},T);s.b.CreateTorusKnot=n,T.d.CreateTorusKnot=(C,M,x,f,T,z,s,S,m,Q)=>I(C,{i:M,tube:x,radialSegments:f,tubularSegments:T,p:z,q:s,sideOrientation:Q,updatable:m},S);var X=x(12717),g=x(1078),B=x(1456),F=x(986),P=x(1008);class h extends f.j{constructor(C,M){super(C.x,C.y),this.index=M}}class c{constructor(){this.elements=[]}add(C){const M=[];return C.forEach((C=>{const x=new h(C,this.elements.length);M.push(x),this.elements.push(x)})),M}computeBounds(){const C=new f.j(this.elements[0].x,this.elements[0].y),M=new f.j(this.elements[0].x,this.elements[0].y);return this.elements.forEach((x=>{x.x<C.x?C.x=x.x:x.x>M.x&&(M.x=x.x),x.y<C.y?C.y=x.y:x.y>M.y&&(M.y=x.y)})),{min:C,max:M,width:M.x-C.x,height:M.y-C.y}}}class q{_addToepoint(C){for(const M of C)this._epoints.push(M.x,M.y)}constructor(C,M,x){let f,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;this._points=new c,this._outlinepoints=new c,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=T,this._name=C,this._scene=x||P.c.LastCreatedScene,f=M instanceof B.d?M.getPoints():M,this._addToepoint(f),this._points.add(f),this._outlinepoints.add(f),"undefined"===typeof this.bjsEarcut&&g.e.Warn("Earcut was not found, the polygon will not be built.")}addHole(C){this._points.add(C);const M=new c;return M.add(C),this._holes.push(M),this._eholes.push(this._epoints.length/2),this._addToepoint(C),this}build(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0],M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const f=new T.d(this._name,this._scene),s=this.buildVertexData(M,x);return f.Ga(z.h.PositionKind,s.xa,C),f.Ga(z.h.NormalKind,s.ya,C),f.Ga(z.h.UVKind,s.Aa,C),f.setIndices(s.indices),f}buildVertexData(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const x=new s.b,f=[],T=[],z=[],S=this._points.computeBounds();this._points.elements.forEach((C=>{f.push(0,1,0),T.push(C.x,0,C.y),z.push((C.x-S.min.x)/S.width,(C.y-S.min.y)/S.height)}));const m=[],Q=this.bjsEarcut(this._epoints,this._eholes,2);for(let s=0;s<Q.length;s++)m.push(Q[s]);if(C>0){const x=T.length/3;this._points.elements.forEach((M=>{f.push(0,-1,0),T.push(M.x,-C,M.y),z.push(1-(M.x-S.min.x)/S.width,1-(M.y-S.min.y)/S.height)}));const s=m.length;for(let C=0;C<s;C+=3){const M=m[C+0],f=m[C+1],T=m[C+2];m.push(T+x),m.push(f+x),m.push(M+x)}this._addSide(T,f,z,m,S,this._outlinepoints,C,!1,M),this._holes.forEach((x=>{this._addSide(T,f,z,m,S,x,C,!0,M)}))}return x.indices=m,x.xa=T,x.ya=f,x.Aa=z,x}_addSide(C,M,x,T,z,s,S,m,Q){let V=C.length/3,y=0;for(let U=0;U<s.elements.length;U++){const O=s.elements[U],d=s.elements[(U+1)%s.elements.length];C.push(O.x,0,O.y),C.push(O.x,-S,O.y),C.push(d.x,0,d.y),C.push(d.x,-S,d.y);const D=s.elements[(U+s.elements.length-1)%s.elements.length],o=s.elements[(U+2)%s.elements.length];let L=new f.m(-(d.y-O.y),0,d.x-O.x),t=new f.m(-(O.y-D.y),0,O.x-D.x),A=new f.m(-(o.y-d.y),0,o.x-d.x);m||(L=L.scale(-1),t=t.scale(-1),A=A.scale(-1));const H=L.normalizeToNew();let j=t.normalizeToNew(),b=A.normalizeToNew();const R=f.m.Dot(j,H);j=R>Q?R<F.c-1?new f.m(O.x,0,O.y).rc(new f.m(d.x,0,d.y)).normalize():t.add(L).normalize():H;const n=f.m.Dot(A,L);b=n>Q?n<F.c-1?new f.m(d.x,0,d.y).rc(new f.m(O.x,0,O.y)).normalize():A.add(L).normalize():H,x.push(y/z.width,0),x.push(y/z.width,1),y+=L.length(),x.push(y/z.width,0),x.push(y/z.width,1),M.push(j.x,j.y,j.z),M.push(j.x,j.y,j.z),M.push(b.x,b.y,b.z),M.push(b.x,b.y,b.z),m?(T.push(V),T.push(V+2),T.push(V+1),T.push(V+1),T.push(V+2),T.push(V+3)):(T.push(V),T.push(V+1),T.push(V+2),T.push(V+1),T.push(V+3),T.push(V+2)),V+=4}}}function i(C,M,x,T,m,Q,V){const y=x||new Array(3),O=T,d=[],D=V||!1;for(let z=0;z<3;z++)void 0===y[z]&&(y[z]=new f.q(0,0,1,1)),O&&void 0===O[z]&&(O[z]=new U.e(1,1,1,1));const o=C.getVerticesData(z.h.PositionKind),L=C.getVerticesData(z.h.NormalKind),t=C.getVerticesData(z.h.UVKind),A=C.Ge(),H=o.length/9;let j=0,b=0,R=0,n=0,I=0;const X=[0];if(D)for(let f=H;f<o.length/3;f+=4)b=o[3*(f+2)]-o[3*f],R=o[3*(f+2)+2]-o[3*f+2],n=Math.sqrt(b*b+R*R),I+=n,X.push(I);let g=0,B=0;for(let f=0;f<L.length;f+=3)Math.abs(L[f+1])<.001&&(B=1),Math.abs(L[f+1]-1)<.001&&(B=0),Math.abs(L[f+1]+1)<.001&&(B=2),g=f/3,1===B?(j=g-H,t[2*g]=j%4<1.5?D?y[B].x+(y[B].z-y[B].x)*X[Math.floor(j/4)]/I:y[B].x:D?y[B].x+(y[B].z-y[B].x)*X[Math.floor(j/4)+1]/I:y[B].z,t[2*g+1]=j%2===0?S.c?1-y[B].w:y[B].w:S.c?1-y[B].y:y[B].y):(t[2*g]=(1-t[2*g])*y[B].x+t[2*g]*y[B].z,t[2*g+1]=(1-t[2*g+1])*y[B].y+t[2*g+1]*y[B].w,S.c&&(t[2*g+1]=1-t[2*g+1])),O&&d.push(O[B].r,O[B].g,O[B].b,O[B].a);s.b._ComputeSides(M,o,A,L,t,m,Q);const F=new s.b;if(F.indices=A,F.xa=o,F.ya=L,F.Aa=t,O){const C=M===s.b.DOUBLESIDE?d.concat(d):d;F.za=C}return F}function Z(C,M){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;M.sideOrientation=T.d._GetDefaultSideOrientation(M.sideOrientation);const s=M.shape,S=M.holes||[],m=M.depth||0,Q=M.smoothingThreshold||2,V=[];let y=[];for(let T=0;T<s.length;T++)V[T]=new f.j(s[T].x,s[T].z);V[0].equalsWithEpsilon(V[V.length-1],1e-8)&&V.pop();const U=new q(C,V,x||P.c.LastCreatedScene,z);for(let T=0;T<S.length;T++){y=[];for(let C=0;C<S[T].length;C++)y.push(new f.j(S[T][C].x,S[T][C].z));U.addHole(y)}const O=U.build(!1,m,Q);O._originalBuilderSideOrientation=M.sideOrientation;return i(O,M.sideOrientation,M.faceUV,M.faceColors,M.frontUVs,M.backUVs,M.wrap).Ca(O,M.updatable),O}function E(C,M){return Z(C,M,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut)}function K(C,M){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const f=M.path,z=M.shape,s=M.scale||1,S=M.rotation||0,m=0===M.cap?0:M.cap||T.d.NO_CAP,Q=M.updatable,V=T.d._GetDefaultSideOrientation(M.sideOrientation),y=M.instance||null,U=M.invertUV||!1,O=M.closeShape||!1;return a(C,z,f,s,S,null,null,M.closePath||!1,O,m,!1,x,!!Q,V,y,U,M.frontUVs||null,M.backUVs||null,M.firstNormal||null,!!M.adjustFrame)}function G(C,M){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const f=M.path,z=M.shape,s=M.scaleFunction||(()=>1),S=M.rotationFunction||(()=>0),m=M.closePath||M.ribbonCloseArray||!1,Q=M.closeShape||M.ribbonClosePath||!1,V=0===M.cap?0:M.cap||T.d.NO_CAP,y=M.updatable,U=M.firstNormal||null,O=M.adjustFrame||!1;return a(C,z,f,null,null,s,S,m,Q,V,!0,x,!!y,T.d._GetDefaultSideOrientation(M.sideOrientation),M.instance||null,M.invertUV||!1,M.frontUVs||null,M.backUVs||null,U,O)}function a(C,M,x,z,s,S,m,V,y,U,O,d,D,o,L,t,A,H,j,b){const R=(C,M,x,z,s,S,m,Q,V,y,U)=>{const O=x.getTangents(),d=x.getNormals(),D=x.getBinormals(),o=x.getDistances();if(U)for(let T=0;T<O.length;T++)if(0==O[T].x&&0==O[T].y&&0==O[T].z&&O[T].p(O[T-1]),0==d[T].x&&0==d[T].y&&0==d[T].z&&d[T].p(d[T-1]),0==D[T].x&&0==D[T].y&&0==D[T].z&&D[T].p(D[T-1]),T>0){let C=O[T-1];f.m.Dot(C,O[T])<0&&O[T].scaleInPlace(-1),C=d[T-1],f.m.Dot(C,d[T])<0&&d[T].scaleInPlace(-1),C=D[T-1],f.m.Dot(C,D[T])<0&&D[T].scaleInPlace(-1)}let L=0;const t=y&&Q?Q:()=>null!==S?S:0,A=y&&m?m:()=>null!==s?s:1;let H=V===T.d.NO_CAP||V===T.d.CAP_END?0:2;const j=f.i.Matrix[0];for(let T=0;T<M.length;T++){const x=[],s=t(T,o[T]),S=A(T,o[T]);f.d.RotationAxisToRef(O[T],L,j);for(let z=0;z<C.length;z++){const s=O[T].scale(C[z].z).add(d[T].scale(C[z].x)).add(D[T].scale(C[z].y)),m=f.m.Zero();f.m.TransformCoordinatesToRef(s,j,m),m.scaleInPlace(S).addInPlace(M[T]),x[z]=m}z[H]=x,L+=s,H++}const b=C=>{const M=Array(),x=f.m.Zero();let T;for(T=0;T<C.length;T++)x.addInPlace(C[T]);for(x.scaleInPlace(1/C.length),T=0;T<C.length;T++)M.push(x);return M};switch(V){case T.d.NO_CAP:break;case T.d.CAP_START:z[0]=b(z[2]),z[1]=z[2];break;case T.d.CAP_END:z[H]=z[H-1],z[H+1]=b(z[H-1]);break;case T.d.CAP_ALL:z[0]=b(z[2]),z[1]=z[2],z[H]=z[H-1],z[H+1]=b(z[H-1])}return z};let n,I;if(L){const C=L._creationDataStorage;return n=j?C.path3D.update(x,j):C.path3D.update(x),I=R(M,x,C.path3D,C.pathArray,z,s,S,m,C.cap,O,b),L=Q("",{pathArray:I,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:L},d||void 0)}n=j?new B.h(x,j):new B.h(x);I=R(M,x,n,new Array,z,s,S,m,U=U<0||U>3?0:U,O,b);const X=Q(C,{pathArray:I,closeArray:V,closePath:y,updatable:D,sideOrientation:o,invertUV:t,frontUVs:A||void 0,backUVs:H||void 0},d);return X._creationDataStorage.pathArray=I,X._creationDataStorage.path3D=n,X._creationDataStorage.cap=U,X}s.b.CreatePolygon=i,T.d.CreatePolygon=function(C,M,x,f,T,z){return Z(C,{shape:M,holes:f,updatable:T,sideOrientation:z},x,arguments.length>6&&void 0!==arguments[6]?arguments[6]:earcut)},T.d.ExtrudePolygon=function(C,M,x,f,T,z,s){return E(C,{shape:M,holes:T,depth:x,updatable:z,sideOrientation:s},f,arguments.length>7&&void 0!==arguments[7]?arguments[7]:earcut)};function J(C,M){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=M.arc?M.arc<=0||M.arc>1?1:M.arc:1,s=void 0===M.closed||M.closed,S=M.shape,m=M.i||1,V=M.$k||64,y=M.clip||0,U=M.updatable,O=T.d._GetDefaultSideOrientation(M.sideOrientation),d=M.cap||T.d.NO_CAP,D=2*Math.PI,o=[],L=M.invertUV||!1;let t=0,A=0;const H=D/V*z;let j,b;for(t=0;t<=V-y;t++){for(b=[],d!=T.d.CAP_START&&d!=T.d.CAP_ALL||(b.push(new f.m(0,S[0].y,0)),b.push(new f.m(Math.cos(t*H)*S[0].x*m,S[0].y,Math.sin(t*H)*S[0].x*m))),A=0;A<S.length;A++)j=new f.m(Math.cos(t*H)*S[A].x*m,S[A].y,Math.sin(t*H)*S[A].x*m),b.push(j);d!=T.d.CAP_END&&d!=T.d.CAP_ALL||(b.push(new f.m(Math.cos(t*H)*S[S.length-1].x*m,S[S.length-1].y,Math.sin(t*H)*S[S.length-1].x*m)),b.push(new f.m(0,S[S.length-1].y,0))),o.push(b)}return Q(C,{pathArray:o,closeArray:s,sideOrientation:O,updatable:U,invertUV:L,frontUVs:M.frontUVs,backUVs:M.backUVs},x)}T.d.ExtrudeShape=function(C,M,x,f,z,s){let S=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,m=arguments.length>7?arguments[7]:void 0,Q=arguments.length>8?arguments[8]:void 0,V=arguments.length>9?arguments[9]:void 0;return K(C,{shape:M,path:x,scale:f,rotation:z,cap:0===s?0:s||T.d.NO_CAP,sideOrientation:Q,instance:V,updatable:m},S)},T.d.ExtrudeShapeCustom=(C,M,x,f,z,s,S,m,Q,V,y,U)=>G(C,{shape:M,path:x,scaleFunction:f,rotationFunction:z,ribbonCloseArray:s,ribbonClosePath:S,cap:0===m?0:m||T.d.NO_CAP,sideOrientation:y,instance:U,updatable:V},Q);T.d.CreateLathe=(C,M,x,f,T,z,s)=>J(C,{shape:M,i:x,$k:f,sideOrientation:s,updatable:z},T);var N=x(11821),k=x(11773);function v(C,M){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=M.path;let s=M.instance,S=1;void 0!==M.i?S=M.i:s&&(S=s._creationDataStorage.i);const m=M.$k||64,V=M.radiusFunction||null;let y=M.cap||T.d.NO_CAP;const U=M.invertUV||!1,O=M.updatable,d=T.d._GetDefaultSideOrientation(M.sideOrientation);M.arc=M.arc&&(M.arc<=0||M.arc>1)?1:M.arc||1;const D=(C,M,x,z,s,S,m,Q)=>{const V=M.getTangents(),y=M.getNormals(),U=M.getDistances(),O=2*Math.PI/s*Q,d=S||(()=>z);let D,o,L,t;const A=f.i.Matrix[0];let H=m===T.d.NO_CAP||m===T.d.CAP_END?0:2;for(let T=0;T<C.length;T++){o=d(T,U[T]),D=Array(),L=y[T];for(let M=0;M<s;M++)f.d.RotationAxisToRef(V[T],O*M,A),t=D[M]?D[M]:f.m.Zero(),f.m.TransformCoordinatesToRef(L,A,t),t.scaleInPlace(o).addInPlace(C[T]),D[M]=t;x[H]=D,H++}const j=(M,x)=>{const f=Array();for(let T=0;T<M;T++)f.push(C[x]);return f};switch(m){case T.d.NO_CAP:break;case T.d.CAP_START:x[0]=j(s,0),x[1]=x[2].slice(0);break;case T.d.CAP_END:x[H]=x[H-1].slice(0),x[H+1]=j(s,C.length-1);break;case T.d.CAP_ALL:x[0]=j(s,0),x[1]=x[2].slice(0),x[H]=x[H-1].slice(0),x[H+1]=j(s,C.length-1)}return x};let o,L;if(s){const C=s._creationDataStorage,x=M.arc||C.arc;return o=C.path3D.update(z),L=D(z,o,C.pathArray,S,C.$k,V,C.cap,x),s=Q("",{pathArray:L,instance:s}),C.path3D=o,C.pathArray=L,C.arc=x,C.i=S,s}o=new B.h(z);y=y<0||y>3?0:y,L=D(z,o,new Array,S,m,V,y,M.arc);const t=Q(C,{pathArray:L,closePath:!0,closeArray:!1,updatable:O,sideOrientation:d,invertUV:U,frontUVs:M.frontUVs,backUVs:M.backUVs},x);return t._creationDataStorage.pathArray=L,t._creationDataStorage.path3D=o,t._creationDataStorage.$k=m,t._creationDataStorage.cap=y,t._creationDataStorage.arc=M.arc,t._creationDataStorage.i=S,t}function p(C){const M=[];M[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},M[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},M[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},M[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},M[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},M[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},M[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},M[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},M[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},M[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},M[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},M[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},M[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},M[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},M[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const x=C.type&&(C.type<0||C.type>=M.length)?0:C.type||0,T=C.size,z=C.sizeX||T||1,m=C.sizeY||T||1,Q=C.sizeZ||T||1,V=C.custom||M[x],y=V.face.length,O=C.faceUV||new Array(y),d=C.faceColors,D=void 0===C.flat||C.flat,o=0===C.sideOrientation?0:C.sideOrientation||s.b.DEFAULTSIDE,L=[],t=[],A=[],H=[],j=[];let b=0,R=0;const n=[];let I,X,g,B,F,P,h=0,c=0;if(D)for(c=0;c<y;c++)d&&void 0===d[c]&&(d[c]=new U.e(1,1,1,1)),O&&void 0===O[c]&&(O[c]=new f.q(0,0,1,1));if(D)for(c=0;c<y;c++){const C=V.face[c].length;for(g=2*Math.PI/C,B=.5*Math.tan(g/2),F=.5,h=0;h<C;h++)L.push(V.vertex[V.face[c][h]][0]*z,V.vertex[V.face[c][h]][1]*m,V.vertex[V.face[c][h]][2]*Q),n.push(b),b++,I=O[c].x+(O[c].z-O[c].x)*(.5+B),X=O[c].y+(O[c].w-O[c].y)*(F-.5),H.push(I,S.c?1-X:X),P=B*Math.cos(g)-F*Math.sin(g),F=B*Math.sin(g)+F*Math.cos(g),B=P,d&&j.push(d[c].r,d[c].g,d[c].b,d[c].a);for(h=0;h<C-2;h++)t.push(n[0+R],n[h+2+R],n[h+1+R]);R+=C}else{for(h=0;h<V.vertex.length;h++)L.push(V.vertex[h][0]*z,V.vertex[h][1]*m,V.vertex[h][2]*Q),H.push(0,S.c?1:0);for(c=0;c<y;c++)for(h=0;h<V.face[c].length-2;h++)t.push(V.face[c][0],V.face[c][h+2],V.face[c][h+1])}s.b.ComputeNormals(L,t,A),s.b._ComputeSides(o,L,t,A,H,C.frontUVs,C.backUVs);const q=new s.b;return q.xa=L,q.indices=t,q.ya=A,q.Aa=H,d&&D&&(q.za=j),q}function u(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const f=new T.d(C,x);M.sideOrientation=T.d._GetDefaultSideOrientation(M.sideOrientation),f._originalBuilderSideOrientation=M.sideOrientation;return p(M).Ca(f,M.updatable),f}T.d.CreateTube=(C,M,x,f,T,z,s,S,m,Q)=>v(C,{path:M,i:x,$k:f,radiusFunction:T,arc:1,cap:z,updatable:S,sideOrientation:m,instance:Q},s);function Y(C){const M=C.sideOrientation||s.b.DEFAULTSIDE,x=C.i||1,T=void 0===C.flat||C.flat,z=0|(C.subdivisions||4),m=C.radiusX||x,Q=C.radiusY||x,V=C.radiusZ||x,y=(1+Math.sqrt(5))/2,U=[-1,y,-0,1,y,0,-1,-y,0,1,-y,0,0,-1,-y,0,1,-y,0,-1,y,0,1,y,y,0,1,y,0,-1,-y,0,1,-y,0,-1],O=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],d=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],D=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],o=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],L=[],t=[],A=[],H=[];let j=0;const b=new Array(3),R=new Array(3);let n;for(n=0;n<3;n++)b[n]=f.m.Zero(),R[n]=f.j.Zero();for(let s=0;s<20;s++){for(n=0;n<3;n++){const C=O[3*s+n];b[n].Hd(U[3*d[C]],U[3*d[C]+1],U[3*d[C]+2]),b[n].normalize(),R[n].Hd(.134765625*D[2*C]+.05859375+-.0390625*o[s],.2333984375*D[2*C+1]+.025390625+.01953125*o[s])}const C=(C,M,x,s)=>{const y=f.m.Lerp(b[0],b[2],M/z),U=f.m.Lerp(b[1],b[2],M/z),O=z===M?b[2]:f.m.Lerp(y,U,C/(z-M));let d;if(O.normalize(),T){const C=f.m.Lerp(b[0],b[2],s/z),M=f.m.Lerp(b[1],b[2],s/z);d=f.m.Lerp(C,M,x/(z-s))}else d=new f.m(O.x,O.y,O.z);d.x/=m,d.y/=Q,d.z/=V,d.normalize();const D=f.j.Lerp(R[0],R[2],M/z),o=f.j.Lerp(R[1],R[2],M/z),n=z===M?R[2]:f.j.Lerp(D,o,C/(z-M));t.push(O.x*m,O.y*Q,O.z*V),A.push(d.x,d.y,d.z),H.push(n.x,S.c?1-n.y:n.y),L.push(j),j++};for(let M=0;M<z;M++)for(let x=0;x+M<z;x++)C(x,M,x+1/3,M+1/3),C(x+1,M,x+1/3,M+1/3),C(x,M+1,x+1/3,M+1/3),x+M+1<z&&(C(x+1,M,x+2/3,M+2/3),C(x+1,M+1,x+2/3,M+2/3),C(x,M+1,x+2/3,M+2/3))}s.b._ComputeSides(M,t,L,A,H,C.frontUVs,C.backUVs);const I=new s.b;return I.indices=L,I.xa=t,I.ya=A,I.Aa=H,I}function W(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const f=new T.d(C,x);M.sideOrientation=T.d._GetDefaultSideOrientation(M.sideOrientation),f._originalBuilderSideOrientation=M.sideOrientation;return Y(M).Ca(f,M.updatable),f}s.b.CreatePolyhedron=p,T.d.CreatePolyhedron=(C,M,x)=>u(C,M,x);s.b.CreateIcoSphere=Y,T.d.CreateIcoSphere=(C,M,x)=>W(C,M,x);var e=x(1015);const r=new f.m(1,0,0),w=new f.m(-1,0,0),l=new f.m(0,1,0),CC=new f.m(0,-1,0),MC=new f.m(0,0,1),xC=new f.m(0,0,-1);class fC{constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f.m.Zero(),M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f.m.Up(),x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:f.j.Zero(),T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,S=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,m=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,Q=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=C,this.Nd=M,this.uv=x,this.vertexIdx=T,this.vertexIdxForBones=z,this.localPositionOverride=s,this.localNormalOverride=S,this.matrixIndicesOverride=m,this.matrixWeightsOverride=Q}clone(){var C,M,x,f;return new fC(this.position.clone(),this.Nd.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(C=this.localPositionOverride)||void 0===C?void 0:C.slice(),null===(M=this.localNormalOverride)||void 0===M?void 0:M.slice(),null===(x=this.matrixIndicesOverride)||void 0===x?void 0:x.slice(),null===(f=this.matrixWeightsOverride)||void 0===f?void 0:f.slice())}}function TC(C,M,x){var m,Q,V,y;const U=!!M.skeleton,O=x.localMode||U,d=M.Ge(),D=U?M.cg(!0,!0):M.getVerticesData(z.h.PositionKind),o=U?M.getNormalsData(!0,!0):M.getVerticesData(z.h.NormalKind),L=O?U?M.getVerticesData(z.h.PositionKind):D:null,t=O?U?M.getVerticesData(z.h.NormalKind):o:null,A=M.getVerticesData(z.h.UVKind),H=U?M.getVerticesData(z.h.MatricesIndicesKind):null,j=U?M.getVerticesData(z.h.MatricesWeightsKind):null,b=U?M.getVerticesData(z.h.MatricesIndicesExtraKind):null,R=U?M.getVerticesData(z.h.MatricesWeightsExtraKind):null,n=x.position||f.m.Zero();let I=x.Nd||f.m.Up();const X=x.size||f.m.One(),g=x.angle||0;if(!I){const C=new f.m(0,0,1),x=M.va().activeCamera,T=f.m.TransformCoordinates(C,x.getWorldMatrix());I=x.globalPosition.rc(T)}const B=-Math.atan2(I.z,I.x)-Math.PI/2,F=Math.sqrt(I.x*I.x+I.z*I.z),P=Math.atan2(I.y,F),h=new s.b;h.indices=[],h.xa=[],h.ya=[],h.Aa=[],h.matricesIndices=U?[]:null,h.matricesWeights=U?[]:null,h.matricesIndicesExtra=b?[]:null,h.matricesWeightsExtra=R?[]:null;let c=0;const q=(C,M)=>{const T=new fC;if(!d||!D||!o)return T;const z=d[C];if(T.vertexIdx=3*z,T.vertexIdxForBones=4*z,T.position=new f.m(D[3*z],D[3*z+1],D[3*z+2]),f.m.TransformCoordinatesToRef(T.position,M,T.position),T.Nd=new f.m(o[3*z],o[3*z+1],o[3*z+2]),f.m.TransformNormalToRef(T.Nd,M,T.Nd),x.captureUVS&&A){const C=A[2*z+1];T.uv=new f.j(A[2*z],S.c?1-C:C)}return T},i=[0,0,0,0],Z=(C,M)=>{if(0===C.length)return C;const x=.5*Math.abs(f.m.Dot(X,M)),T=(C,M,x,f)=>{for(let T=0;T<f;++T)if(C[x+T]===M)return x+T;return-1},z=(C,z)=>{const s=f.m.GetClipFactor(C.position,z.position,M,x);let S=i,m=i;if(H&&j){const M=C.matrixIndicesOverride?0:C.vertexIdxForBones,x=C.matrixIndicesOverride??H,f=C.matrixWeightsOverride??j,Q=z.matrixIndicesOverride?0:z.vertexIdxForBones,V=z.matrixIndicesOverride??H,y=z.matrixWeightsOverride??j;S=[0,0,0,0],m=[0,0,0,0];let U=0;for(let C=0;C<4;++C)if(f[M+C]>0){const z=T(V,x[M+C],Q,4);S[U]=x[M+C],m[U]=(0,e.q)(f[M+C],z>=0?y[z]:0,s),U++}for(let C=0;C<4&&U<4;++C){const f=V[Q+C];-1===T(x,f,M,4)&&(S[U]=f,m[U]=(0,e.q)(0,y[Q+C],s),U++)}const O=m[0]+m[1]+m[2]+m[3];m[0]/=O,m[1]/=O,m[2]/=O,m[3]/=O}const Q=C.localPositionOverride?C.localPositionOverride[0]:(null===L||void 0===L?void 0:L[C.vertexIdx])??0,V=C.localPositionOverride?C.localPositionOverride[1]:(null===L||void 0===L?void 0:L[C.vertexIdx+1])??0,y=C.localPositionOverride?C.localPositionOverride[2]:(null===L||void 0===L?void 0:L[C.vertexIdx+2])??0,U=z.localPositionOverride?z.localPositionOverride[0]:(null===L||void 0===L?void 0:L[z.vertexIdx])??0,O=z.localPositionOverride?z.localPositionOverride[1]:(null===L||void 0===L?void 0:L[z.vertexIdx+1])??0,d=z.localPositionOverride?z.localPositionOverride[2]:(null===L||void 0===L?void 0:L[z.vertexIdx+2])??0,D=C.localNormalOverride?C.localNormalOverride[0]:(null===t||void 0===t?void 0:t[C.vertexIdx])??0,o=C.localNormalOverride?C.localNormalOverride[1]:(null===t||void 0===t?void 0:t[C.vertexIdx+1])??0,A=C.localNormalOverride?C.localNormalOverride[2]:(null===t||void 0===t?void 0:t[C.vertexIdx+2])??0,b=D+((z.localNormalOverride?z.localNormalOverride[0]:(null===t||void 0===t?void 0:t[z.vertexIdx])??0)-D)*s,R=o+((z.localNormalOverride?z.localNormalOverride[1]:(null===t||void 0===t?void 0:t[z.vertexIdx+1])??0)-o)*s,n=A+((z.localNormalOverride?z.localNormalOverride[2]:(null===t||void 0===t?void 0:t[z.vertexIdx+2])??0)-A)*s,I=Math.sqrt(b*b+R*R+n*n);return new fC(f.m.Lerp(C.position,z.position,s),f.m.Lerp(C.Nd,z.Nd,s).normalize(),f.j.Lerp(C.uv,z.uv,s),-1,-1,L?[Q+(U-Q)*s,V+(O-V)*s,y+(d-y)*s]:null,t?[b/I,R/I,n/I]:null,S,m)};let s=null;C.length>3&&(s=[]);for(let S=0;S<C.length;S+=3){let T=0,m=null,Q=null,V=null,y=null;const U=f.m.Dot(C[S].position,M)-x>0,O=f.m.Dot(C[S+1].position,M)-x>0,d=f.m.Dot(C[S+2].position,M)-x>0;switch(T=(U?1:0)+(O?1:0)+(d?1:0),T){case 0:C.length>3?(s.push(C[S]),s.push(C[S+1]),s.push(C[S+2])):s=C;break;case 1:if(s=s??new Array,U&&(m=C[S+1],Q=C[S+2],V=z(C[S],m),y=z(C[S],Q)),O){m=C[S],Q=C[S+2],V=z(C[S+1],m),y=z(C[S+1],Q),s.push(V),s.push(Q.clone()),s.push(m.clone()),s.push(Q.clone()),s.push(V.clone()),s.push(y);break}d&&(m=C[S],Q=C[S+1],V=z(C[S+2],m),y=z(C[S+2],Q)),m&&Q&&V&&y&&(s.push(m.clone()),s.push(Q.clone()),s.push(V),s.push(y),s.push(V.clone()),s.push(Q.clone()));break;case 2:s=s??new Array,U||(m=C[S].clone(),Q=z(m,C[S+1]),V=z(m,C[S+2]),s.push(m),s.push(Q),s.push(V)),O||(m=C[S+1].clone(),Q=z(m,C[S+2]),V=z(m,C[S]),s.push(m),s.push(Q),s.push(V)),d||(m=C[S+2].clone(),Q=z(m,C[S]),V=z(m,C[S+1]),s.push(m),s.push(Q),s.push(V))}}return s},E=M instanceof T.d?M:null,K=null===E||void 0===E?void 0:E._thinInstanceDataStorage.matrixData,G=(null===E||void 0===E?void 0:E.Uj)||1,a=f.i.Matrix[0];a.p(f.d.IdentityReadOnly);for(let T=0;T<G;++T){if(null!==E&&void 0!==E&&E.hasThinInstances&&K){const C=16*T;a.setRowFromFloats(0,K[C+0],K[C+1],K[C+2],K[C+3]),a.setRowFromFloats(1,K[C+4],K[C+5],K[C+6],K[C+7]),a.setRowFromFloats(2,K[C+8],K[C+9],K[C+10],K[C+11]),a.setRowFromFloats(3,K[C+12],K[C+13],K[C+14],K[C+15])}const C=f.d.RotationYawPitchRoll(B,P,g).multiply(f.d.Translation(n.x,n.y,n.z)),z=f.d.Invert(C),s=M.getWorldMatrix(),m=a.multiply(s).multiply(z),Q=new Array(3);for(let M=0;M<d.length;M+=3){let C=Q;if(C[0]=q(M,m),C[1]=q(M+1,m),C[2]=q(M+2,m),!(x.cullBackFaces&&-C[0].Nd.z<=0&&-C[1].Nd.z<=0&&-C[2].Nd.z<=0)&&(C=Z(C,r),C&&(C=Z(C,w),C&&(C=Z(C,l),C&&(C=Z(C,CC),C&&(C=Z(C,MC),C&&(C=Z(C,xC),C)))))))for(let M=0;M<C.length;M++){const f=C[M];if(h.indices.push(c),O?(f.localPositionOverride?(h.xa[3*c]=f.localPositionOverride[0],h.xa[3*c+1]=f.localPositionOverride[1],h.xa[3*c+2]=f.localPositionOverride[2]):L&&(h.xa[3*c]=L[f.vertexIdx],h.xa[3*c+1]=L[f.vertexIdx+1],h.xa[3*c+2]=L[f.vertexIdx+2]),f.localNormalOverride?(h.ya[3*c]=f.localNormalOverride[0],h.ya[3*c+1]=f.localNormalOverride[1],h.ya[3*c+2]=f.localNormalOverride[2]):t&&(h.ya[3*c]=t[f.vertexIdx],h.ya[3*c+1]=t[f.vertexIdx+1],h.ya[3*c+2]=t[f.vertexIdx+2])):(f.position.toArray(h.xa,3*c),f.Nd.toArray(h.ya,3*c)),h.matricesIndices&&h.matricesWeights&&(f.matrixIndicesOverride?(h.matricesIndices[4*c]=f.matrixIndicesOverride[0],h.matricesIndices[4*c+1]=f.matrixIndicesOverride[1],h.matricesIndices[4*c+2]=f.matrixIndicesOverride[2],h.matricesIndices[4*c+3]=f.matrixIndicesOverride[3]):(H&&(h.matricesIndices[4*c]=H[f.vertexIdxForBones],h.matricesIndices[4*c+1]=H[f.vertexIdxForBones+1],h.matricesIndices[4*c+2]=H[f.vertexIdxForBones+2],h.matricesIndices[4*c+3]=H[f.vertexIdxForBones+3]),b&&h.matricesIndicesExtra&&(h.matricesIndicesExtra[4*c]=b[f.vertexIdxForBones],h.matricesIndicesExtra[4*c+1]=b[f.vertexIdxForBones+1],h.matricesIndicesExtra[4*c+2]=b[f.vertexIdxForBones+2],h.matricesIndicesExtra[4*c+3]=b[f.vertexIdxForBones+3])),f.matrixWeightsOverride?(h.matricesWeights[4*c]=f.matrixWeightsOverride[0],h.matricesWeights[4*c+1]=f.matrixWeightsOverride[1],h.matricesWeights[4*c+2]=f.matrixWeightsOverride[2],h.matricesWeights[4*c+3]=f.matrixWeightsOverride[3]):(j&&(h.matricesWeights[4*c]=j[f.vertexIdxForBones],h.matricesWeights[4*c+1]=j[f.vertexIdxForBones+1],h.matricesWeights[4*c+2]=j[f.vertexIdxForBones+2],h.matricesWeights[4*c+3]=j[f.vertexIdxForBones+3]),R&&h.matricesWeightsExtra&&(h.matricesWeightsExtra[4*c]=R[f.vertexIdxForBones],h.matricesWeightsExtra[4*c+1]=R[f.vertexIdxForBones+1],h.matricesWeightsExtra[4*c+2]=R[f.vertexIdxForBones+2],h.matricesWeightsExtra[4*c+3]=R[f.vertexIdxForBones+3]))),x.captureUVS)f.uv.toArray(h.Aa,2*c);else{h.Aa.push(.5+f.position.x/X.x);const C=.5+f.position.y/X.y;h.Aa.push(S.c?1-C:C)}c++}}}0===h.indices.length&&(h.indices=null),0===h.xa.length&&(h.xa=null),0===h.ya.length&&(h.ya=null),0===h.Aa.length&&(h.Aa=null),0===(null===(m=h.matricesIndices)||void 0===m?void 0:m.length)&&(h.matricesIndices=null),0===(null===(Q=h.matricesWeights)||void 0===Q?void 0:Q.length)&&(h.matricesWeights=null),0===(null===(V=h.matricesIndicesExtra)||void 0===V?void 0:V.length)&&(h.matricesIndicesExtra=null),0===(null===(y=h.matricesWeightsExtra)||void 0===y?void 0:y.length)&&(h.matricesWeightsExtra=null);const J=new T.d(C,M.va());return h.Ca(J),O?(J.skeleton=M.skeleton,J.parent=M):(J.position=n.clone(),J.rotation=new f.m(P,B,g)),J.Be(!0),J.refreshBoundingInfo(!0,!0),J}function zC(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,$k:16,height:1,i:.25,capSubdivisions:6};const M=0|Math.max(C.subdivisions?C.subdivisions:2,1),x=0|Math.max(C.$k?C.$k:16,3),T=Math.max(C.height?C.height:1,0),z=Math.max(C.i?C.i:.25,0),m=0|Math.max(C.capSubdivisions?C.capSubdivisions:6,1),Q=x,V=M,y=Math.max(C.radiusTop?C.radiusTop:z,0),U=Math.max(C.radiusBottom?C.radiusBottom:z,0),O=T-(y+U),d=2*Math.PI,D=Math.max(C.topCapSubdivisions?C.topCapSubdivisions:m,1),o=Math.max(C.bottomCapSubdivisions?C.bottomCapSubdivisions:m,1),L=Math.acos((U-y)/T);let t=[];const A=[],H=[],j=[];let b=0;const R=[],n=.5*O,I=.5*Math.PI;let X,g;const B=f.m.Zero(),F=f.m.Zero(),P=Math.cos(L),h=Math.sin(L),c=new f.j(y*h,n+y*P).rc(new f.j(U*h,U*P-n)).length(),q=y*L+c+U*(I-L);let i=0;for(g=0;g<=D;g++){const C=[],M=I-L*(g/D);i+=y*L/D;const x=Math.cos(M),f=Math.sin(M),T=x*y;for(X=0;X<=Q;X++){const M=X/Q,z=M*d+0,s=Math.sin(z),m=Math.cos(z);F.x=T*s,F.y=n+f*y,F.z=T*m,A.push(F.x,F.y,F.z),B.set(x*s,f,x*m),H.push(B.x,B.y,B.z),j.push(M,S.c?i/q:1-i/q),C.push(b),b++}R.push(C)}const Z=T-y-U+P*y-P*U,E=h*(U-y)/Z;for(g=1;g<=V;g++){const C=[];i+=c/V;const M=h*(g*(U-y)/V+y);for(X=0;X<=Q;X++){const x=X/Q,f=x*d+0,T=Math.sin(f),z=Math.cos(f);F.x=M*T,F.y=n+P*y-g*Z/V,F.z=M*z,A.push(F.x,F.y,F.z),B.set(T,E,z).normalize(),H.push(B.x,B.y,B.z),j.push(x,S.c?i/q:1-i/q),C.push(b),b++}R.push(C)}for(g=1;g<=o;g++){const C=[],M=I-L-(Math.PI-L)*(g/o);i+=U*L/o;const x=Math.cos(M),f=Math.sin(M),T=x*U;for(X=0;X<=Q;X++){const M=X/Q,z=M*d+0,s=Math.sin(z),m=Math.cos(z);F.x=T*s,F.y=f*U-n,F.z=T*m,A.push(F.x,F.y,F.z),B.set(x*s,f,x*m),H.push(B.x,B.y,B.z),j.push(M,S.c?i/q:1-i/q),C.push(b),b++}R.push(C)}for(X=0;X<Q;X++)for(g=0;g<D+V+o;g++){const C=R[g][X],M=R[g+1][X],x=R[g+1][X+1],f=R[g][X+1];t.push(C),t.push(M),t.push(f),t.push(M),t.push(x),t.push(f)}if(t=t.reverse(),C.orientation&&!C.orientation.equals(f.m.Up())){const M=new f.d;C.orientation.clone().scale(.5*Math.PI).cross(f.m.Up()).toQuaternion().toRotationMatrix(M);const x=f.m.Zero();for(let C=0;C<A.length;C+=3)x.set(A[C],A[C+1],A[C+2]),f.m.TransformCoordinatesToRef(x.clone(),M,x),A[C]=x.x,A[C+1]=x.y,A[C+2]=x.z}const K=new s.b;return K.xa=A,K.ya=H,K.Aa=j,K.indices=t,K}function sC(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:f.m.Up(),subdivisions:2,$k:16,height:1,i:.25,capSubdivisions:6,updatable:!1},x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=new T.d(C,x);return zC(M).Ca(z,M.updatable),z}T.d.CreateDecal=(C,M,x,f,T,z)=>TC(C,M,{position:x,Nd:f,size:T,angle:z});T.d.CreateCapsule=(C,M,x)=>sC(C,M,x),s.b.CreateCapsule=zC;class SC{constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=C,this.y=M,C!==Math.floor(C)&&(C=Math.floor(C),g.e.Warn("x is not an integer, floor(x) used")),M!==Math.floor(M)&&(M=Math.floor(M),g.e.Warn("y is not an integer, floor(y) used"))}clone(){return new SC(this.x,this.y)}rotate60About(C){const M=this.x;return this.x=C.x+C.y-this.y,this.y=M+this.y-C.x,this}rotateNeg60About(C){const M=this.x;return this.x=M+this.y-C.y,this.y=C.x+C.y-M,this}rotate120(C,M){C!==Math.floor(C)&&(C=Math.floor(C),g.e.Warn("m not an integer only floor(m) used")),M!==Math.floor(M)&&(M=Math.floor(M),g.e.Warn("n not an integer only floor(n) used"));const x=this.x;return this.x=C-x-this.y,this.y=M+x,this}rotateNeg120(C,M){C!==Math.floor(C)&&(C=Math.floor(C),g.e.Warn("m is not an integer, floor(m) used")),M!==Math.floor(M)&&(M=Math.floor(M),g.e.Warn("n is not an integer,   floor(n) used"));const x=this.x;return this.x=this.y-M,this.y=C+M-x-this.y,this}toCartesianOrigin(C,M){const x=f.m.Zero();return x.x=C.x+2*this.x*M+this.y*M,x.y=C.y+Math.sqrt(3)*this.y*M,x}static Zero(){return new SC(0,0)}}class mC{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new QC("icosahedron","Regular",[[0,F.d,-1],[-F.d,1,0],[-1,0,-F.d],[1,0,-F.d],[F.d,1,0],[0,F.d,1],[-1,0,F.d],[-F.d,-1,0],[0,-F.d,-1],[F.d,-1,0],[1,0,F.d],[0,-F.d,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let C=12;const M={},x=this.m,f=this.n;let T,z,s,S,m,Q=x,V=1,y=0;0!==f&&(Q=(0,e.i)(x,f)),V=x/Q,y=f/Q;const U=SC.Zero(),O=new SC(x,f),d=new SC(-f,x+f),D=SC.Zero(),o=SC.Zero(),L=SC.Zero();let t,A,H,j,b=[];const R=[],n=this.vertByDist,I=(x,f,T,z)=>{t=x+"|"+T,A=f+"|"+z,t in M||A in M?t in M&&!(A in M)?M[A]=M[t]:A in M&&!(t in M)&&(M[t]=M[A]):(M[t]=C,M[A]=C,C++),n[T][0]>2?R[M[t]]=[-n[T][0],n[T][1],M[t]]:R[M[t]]=[b[n[T][0]],n[T][1],M[t]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let X=0;X<20;X++){if(b=this.IDATA.face[X],s=b[2],S=b[1],m=b[0],H=U.x+"|"+U.y,t=X+"|"+H,t in M||(M[t]=s,R[s]=[b[n[H][0]],n[H][1]]),H=O.x+"|"+O.y,t=X+"|"+H,t in M||(M[t]=S,R[S]=[b[n[H][0]],n[H][1]]),H=d.x+"|"+d.y,t=X+"|"+H,t in M||(M[t]=m,R[m]=[b[n[H][0]],n[H][1]]),T=this.IDATA.edgematch[X][0],z=this.IDATA.edgematch[X][1],"B"===z)for(let C=1;C<Q;C++)o.x=x-C*(V+y),o.y=f+C*V,L.x=-C*y,L.y=C*(V+y),H=o.x+"|"+o.y,j=L.x+"|"+L.y,I(X,T,H,j);if("O"===z)for(let C=1;C<Q;C++)L.x=-C*y,L.y=C*(V+y),D.x=C*V,D.y=C*y,H=L.x+"|"+L.y,j=D.x+"|"+D.y,I(X,T,H,j);if(T=this.IDATA.edgematch[X][2],z=this.IDATA.edgematch[X][3],z&&"A"===z)for(let C=1;C<Q;C++)D.x=C*V,D.y=C*y,o.x=x-(Q-C)*(V+y),o.y=f+(Q-C)*V,H=D.x+"|"+D.y,j=o.x+"|"+o.y,I(X,T,H,j);for(let x=0;x<this.vertices.length;x++)H=this.vertices[x].x+"|"+this.vertices[x].y,t=X+"|"+H,t in M||(M[t]=C++,n[H][0]>2?R[M[t]]=[-n[H][0],n[H][1],M[t]]:R[M[t]]=[b[n[H][0]],n[H][1],M[t]])}this.closestTo=R,this.vecToidx=M}calcCoeffs(){const C=this.m,M=this.n,x=Math.sqrt(3)/3,f=C*C+M*M+C*M;this.coau=(C+M)/f,this.cobu=-M/f,this.coav=-x*(C-M)/f,this.cobv=x*(2*C+M)/f}createInnerFacets(){const C=this.m,M=this.n;for(let x=0;x<M+C+1;x++)for(let C=this.min[x];C<this.max[x]+1;C++)C<this.max[x]&&C<this.max[x+1]+1&&this.innerFacets.push(["|"+C+"|"+x,"|"+C+"|"+(x+1),"|"+(C+1)+"|"+x]),x>0&&C<this.max[x-1]&&C+1<this.max[x]+1&&this.innerFacets.push(["|"+C+"|"+x,"|"+(C+1)+"|"+x,"|"+(C+1)+"|"+(x-1)])}edgeVecsABOB(){const C=this.m,M=this.n,x=new SC(-M,C+M);for(let f=1;f<C+M;f++){const C=new SC(this.min[f],f),M=new SC(this.min[f-1],f-1),T=new SC(this.min[f+1],f+1),z=C.clone(),s=M.clone(),S=T.clone();z.rotate60About(x),s.rotate60About(x),S.rotate60About(x);const m=new SC(this.max[z.y],z.y),Q=new SC(this.max[z.y-1],z.y-1),V=new SC(this.max[z.y-1]-1,z.y-1);z.x===m.x&&z.y===m.y||(z.x!==Q.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([C,Q,V]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([C,V,m])):z.y===S.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([C,M,Q]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([C,Q,T])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([C,M,Q]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([C,Q,m])))}}mapABOBtoOBOA(){const C=new SC(0,0);for(let M=0;M<this.isoVecsABOB.length;M++){const x=[];for(let f=0;f<3;f++)C.x=this.isoVecsABOB[M][f].x,C.y=this.isoVecsABOB[M][f].y,0===this.vertexTypes[M][f]&&C.rotateNeg120(this.m,this.n),x.push(C.clone());this.isoVecsOBOA.push(x)}}mapABOBtoBAOA(){const C=new SC(0,0);for(let M=0;M<this.isoVecsABOB.length;M++){const x=[];for(let f=0;f<3;f++)C.x=this.isoVecsABOB[M][f].x,C.y=this.isoVecsABOB[M][f].y,1===this.vertexTypes[M][f]&&C.rotate120(this.m,this.n),x.push(C.clone());this.isoVecsBAOA.push(x)}}MapToFace(C,M){const x=this.IDATA.face[C],T=x[2],z=x[1],s=x[0],S=f.m.Dd(this.IDATA.vertex[T]),m=f.m.Dd(this.IDATA.vertex[z]),Q=f.m.Dd(this.IDATA.vertex[s]),V=m.rc(S),y=Q.rc(S),U=V.scale(this.coau).add(y.scale(this.cobu)),O=V.scale(this.coav).add(y.scale(this.cobv)),d=[];let D,o=f.i.Md[0];for(let f=0;f<this.cartesian.length;f++)o=U.scale(this.cartesian[f].x).add(O.scale(this.cartesian[f].y)).add(S),d[f]=[o.x,o.y,o.z],D=C+"|"+this.vertices[f].x+"|"+this.vertices[f].y,M.vertex[this.vecToidx[D]]=[o.x,o.y,o.z]}build(C,M){const x=[],f=SC.Zero(),T=new SC(C,M),z=new SC(-M,C+M);x.push(f,T,z);for(let H=M;H<C+1;H++)for(let M=0;M<C+1-H;M++)x.push(new SC(M,H));if(M>0){const f=(0,e.i)(C,M),T=C/f,z=M/f;for(let S=1;S<f;S++)x.push(new SC(S*T,S*z)),x.push(new SC(-S*z,S*(T+z))),x.push(new SC(C-S*(T+z),M+S*T));const s=C/M;for(let S=1;S<M;S++)for(let f=0;f<S*s;f++)x.push(new SC(f,S)),x.push(new SC(f,S).rotate120(C,M)),x.push(new SC(f,S).rotateNeg120(C,M))}x.sort(((C,M)=>C.x-M.x)),x.sort(((C,M)=>C.y-M.y));const s=new Array(C+M+1),S=new Array(C+M+1);for(let H=0;H<s.length;H++)s[H]=1/0,S[H]=-1/0;let m=0,Q=0;const V=x.length;for(let H=0;H<V;H++)Q=x[H].x,m=x[H].y,s[m]=Math.min(Q,s[m]),S[m]=Math.max(Q,S[m]);const y=(x,f)=>{const T=x.clone();return"A"===f&&T.rotateNeg120(C,M),"B"===f&&T.rotate120(C,M),T.x<0?T.y:T.x+T.y},U=[],O=[],d=[],D=[],o={},L=[];let t=-1,A=-1;for(let H=0;H<V;H++)U[H]=x[H].toCartesianOrigin(new SC(0,0),.5),O[H]=y(x[H],"O"),d[H]=y(x[H],"A"),D[H]=y(x[H],"B"),O[H]===d[H]&&d[H]===D[H]?(t=3,A=O[H]):O[H]===d[H]?(t=4,A=O[H]):d[H]===D[H]?(t=5,A=d[H]):D[H]===O[H]&&(t=6,A=O[H]),O[H]<d[H]&&O[H]<D[H]&&(t=2,A=O[H]),d[H]<O[H]&&d[H]<D[H]&&(t=1,A=d[H]),D[H]<d[H]&&D[H]<O[H]&&(t=0,A=D[H]),L.push([t,A,x[H].x,x[H].y]);L.sort(((C,M)=>C[2]-M[2])),L.sort(((C,M)=>C[3]-M[3])),L.sort(((C,M)=>C[1]-M[1])),L.sort(((C,M)=>C[0]-M[0]));for(let H=0;H<L.length;H++)o[L[H][2]+"|"+L[H][3]]=[L[H][0],L[H][1],H];return this.m=C,this.n=M,this.vertices=x,this.vertByDist=o,this.cartesian=U,this.min=s,this.max=S,this}}class QC{constructor(C,M,x,f){this.name=C,this.category=M,this.vertex=x,this.face=f}}class VC extends QC{innerToData(C,M){for(let x=0;x<M.innerFacets.length;x++)this.face.push(M.innerFacets[x].map((x=>M.vecToidx[C+x])))}mapABOBtoDATA(C,M){const x=M.IDATA.edgematch[C][0];for(let f=0;f<M.isoVecsABOB.length;f++){const T=[];for(let z=0;z<3;z++)0===M.vertexTypes[f][z]?T.push(C+"|"+M.isoVecsABOB[f][z].x+"|"+M.isoVecsABOB[f][z].y):T.push(x+"|"+M.isoVecsABOB[f][z].x+"|"+M.isoVecsABOB[f][z].y);this.face.push([M.vecToidx[T[0]],M.vecToidx[T[1]],M.vecToidx[T[2]]])}}mapOBOAtoDATA(C,M){const x=M.IDATA.edgematch[C][0];for(let f=0;f<M.isoVecsOBOA.length;f++){const T=[];for(let z=0;z<3;z++)1===M.vertexTypes[f][z]?T.push(C+"|"+M.isoVecsOBOA[f][z].x+"|"+M.isoVecsOBOA[f][z].y):T.push(x+"|"+M.isoVecsOBOA[f][z].x+"|"+M.isoVecsOBOA[f][z].y);this.face.push([M.vecToidx[T[0]],M.vecToidx[T[1]],M.vecToidx[T[2]]])}}mapBAOAtoDATA(C,M){const x=M.IDATA.edgematch[C][2];for(let f=0;f<M.isoVecsBAOA.length;f++){const T=[];for(let z=0;z<3;z++)1===M.vertexTypes[f][z]?T.push(C+"|"+M.isoVecsBAOA[f][z].x+"|"+M.isoVecsBAOA[f][z].y):T.push(x+"|"+M.isoVecsBAOA[f][z].x+"|"+M.isoVecsBAOA[f][z].y);this.face.push([M.vecToidx[T[0]],M.vecToidx[T[1]],M.vecToidx[T[2]]])}}orderData(C){const M=[];for(let z=0;z<13;z++)M[z]=[];const x=C.closestTo;for(let z=0;z<x.length;z++)x[z][0]>-1?x[z][1]>0&&M[x[z][0]].push([z,x[z][1]]):M[12].push([z,x[z][0]]);const f=[];for(let z=0;z<12;z++)f[z]=z;let T=12;for(let z=0;z<12;z++){M[z].sort(((C,M)=>C[1]-M[1]));for(let C=0;C<M[z].length;C++)f[M[z][C][0]]=T++}for(let z=0;z<M[12].length;z++)f[M[12][z][0]]=T++;for(let z=0;z<this.vertex.length;z++)this.vertex[z].push(f[z]);this.vertex.sort(((C,M)=>C[3]-M[3]));for(let z=0;z<this.vertex.length;z++)this.vertex[z].pop();for(let z=0;z<this.face.length;z++)for(let C=0;C<this.face[z].length;C++)this.face[z][C]=f[this.face[z][C]];this.sharedNodes=M[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(C,M){const x=[],f=[];let T=M.pop();f.push(T);let z=this.face[T].indexOf(C);z=(z+2)%3;let s=this.face[T][z];x.push(s);let S=0;for(;M.length>0;)T=M[S],this.face[T].indexOf(s)>-1?(z=(this.face[T].indexOf(s)+1)%3,s=this.face[T][z],x.push(s),f.push(T),M.splice(S,1),S=0):S++;return this.adjacentFaces.push(x),f}toGoldbergPolyhedronData(){const C=new QC("GeoDual","Goldberg",[],[]);C.name="GD dual";const M=this.vertex.length,x=new Array(M);for(let m=0;m<M;m++)x[m]=[];for(let m=0;m<this.face.length;m++)for(let C=0;C<3;C++)x[this.face[m][C]].push(m);let f=0,T=0,z=0,s=[],S=[];this.adjacentFaces=[];for(let m=0;m<x.length;m++)C.face[m]=this.setOrder(m,x[m].concat([])),x[m].forEach((M=>{f=0,T=0,z=0,s=this.face[M];for(let C=0;C<3;C++)S=this.vertex[s[C]],f+=S[0],T+=S[1],z+=S[2];C.vertex[M]=[f/3,T/3,z/3]}));return C}static BuildGeodesicData(C){const M=new VC("Geodesic-m-n","Geodesic",[[0,F.d,-1],[-F.d,1,0],[-1,0,-F.d],[1,0,-F.d],[F.d,1,0],[0,F.d,1],[-1,0,F.d],[-F.d,-1,0],[0,-F.d,-1],[F.d,-1,0],[1,0,F.d],[0,-F.d,1]],[]);C.setIndices(),C.calcCoeffs(),C.createInnerFacets(),C.edgeVecsABOB(),C.mapABOBtoOBOA(),C.mapABOBtoBAOA();for(let x=0;x<C.IDATA.face.length;x++)C.MapToFace(x,M),M.innerToData(x,C),"B"===C.IDATA.edgematch[x][1]&&M.mapABOBtoDATA(x,C),"O"===C.IDATA.edgematch[x][1]&&M.mapOBOAtoDATA(x,C),"A"===C.IDATA.edgematch[x][3]&&M.mapBAOAtoDATA(x,C);M.orderData(C);return M.vertex=M.vertex.map((function(C){const M=C[0],x=C[1],f=C[2],T=Math.sqrt(M*M+x*x+f*f);return C[0]*=1/T,C[1]*=1/T,C[2]*=1/T,C})),M}}T.d._GoldbergMeshParser=(C,M)=>yC.Parse(C,M);class yC extends T.d{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(C,M){return void 0===M?(C>this.goldbergData.nbUnsharedFaces-1&&(g.e.Warn("Maximum number of unshared faces used"),C=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+C):(C>11&&(g.e.Warn("Last pole used"),C=11),M>this.goldbergData.nbFacesAtPole-1&&(g.e.Warn("Maximum number of faces at a pole used"),M=this.goldbergData.nbFacesAtPole-1),12+C*this.goldbergData.nbFacesAtPole+M)}_changeGoldbergFaceColors(C){for(let x=0;x<C.length;x++){const M=C[x][0],f=C[x][1],T=C[x][2];for(let C=M;C<f+1;C++)this.goldbergData.faceColors[C]=T}const M=[];for(let x=0;x<12;x++)for(let C=0;C<5;C++)M.push(this.goldbergData.faceColors[x].r,this.goldbergData.faceColors[x].g,this.goldbergData.faceColors[x].b,this.goldbergData.faceColors[x].a);for(let x=12;x<this.goldbergData.faceColors.length;x++)for(let C=0;C<6;C++)M.push(this.goldbergData.faceColors[x].r,this.goldbergData.faceColors[x].g,this.goldbergData.faceColors[x].b,this.goldbergData.faceColors[x].a);return M}setGoldbergFaceColors(C){const M=this._changeGoldbergFaceColors(C);this.Ga(z.h.ColorKind,M)}updateGoldbergFaceColors(C){const M=this._changeGoldbergFaceColors(C);this.updateVerticesData(z.h.ColorKind,M)}_changeGoldbergFaceUVs(C){const M=this.getVerticesData(z.h.UVKind);for(let x=0;x<C.length;x++){const f=C[x][0],T=C[x][1],z=C[x][2],s=C[x][3],S=C[x][4],m=[],Q=[];let V,y;for(let C=0;C<5;C++)V=z.x+s*Math.cos(S+C*Math.PI/2.5),y=z.y+s*Math.sin(S+C*Math.PI/2.5),V<0&&(V=0),V>1&&(V=1),m.push(V,y);for(let C=0;C<6;C++)V=z.x+s*Math.cos(S+C*Math.PI/3),y=z.y+s*Math.sin(S+C*Math.PI/3),V<0&&(V=0),V>1&&(V=1),Q.push(V,y);for(let C=f;C<Math.min(12,T+1);C++)for(let x=0;x<5;x++)M[10*C+2*x]=m[2*x],M[10*C+2*x+1]=m[2*x+1];for(let C=Math.max(12,f);C<T+1;C++)for(let x=0;x<6;x++)M[12*C-24+2*x]=Q[2*x],M[12*C-23+2*x]=Q[2*x+1]}return M}setGoldbergFaceUVs(C){const M=this._changeGoldbergFaceUVs(C);this.Ga(z.h.UVKind,M)}updateGoldbergFaceUVs(C){const M=this._changeGoldbergFaceUVs(C);this.updateVerticesData(z.h.UVKind,M)}placeOnGoldbergFaceAt(C,M,x){const T=f.m.RotationFromAxis(this.goldbergData.faceXaxis[M],this.goldbergData.faceYaxis[M],this.goldbergData.faceZaxis[M]);C.rotation=T,C.position=this.goldbergData.faceCenters[M].add(this.goldbergData.faceXaxis[M].scale(x.x)).add(this.goldbergData.faceYaxis[M].scale(x.y)).add(this.goldbergData.faceZaxis[M].scale(x.z))}serialize(C){super.serialize(C),C.type="GoldbergMesh";const M={};if(M.adjacentFaces=this.goldbergData.adjacentFaces,M.nbSharedFaces=this.goldbergData.nbSharedFaces,M.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,M.nbFaces=this.goldbergData.nbFaces,M.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){M.faceColors=[];for(const C of this.goldbergData.faceColors)M.faceColors.push(C.Gd())}if(this.goldbergData.faceCenters){M.faceCenters=[];for(const C of this.goldbergData.faceCenters)M.faceCenters.push(C.Gd())}if(this.goldbergData.faceZaxis){M.faceZaxis=[];for(const C of this.goldbergData.faceZaxis)M.faceZaxis.push(C.Gd())}if(this.goldbergData.faceYaxis){M.faceYaxis=[];for(const C of this.goldbergData.faceYaxis)M.faceYaxis.push(C.Gd())}if(this.goldbergData.faceXaxis){M.faceXaxis=[];for(const C of this.goldbergData.faceXaxis)M.faceXaxis.push(C.Gd())}C.goldbergData=M}static Parse(C,M){const x=C.goldbergData;x.faceColors=x.faceColors.map((C=>U.e.Dd(C))),x.faceCenters=x.faceCenters.map((C=>f.m.Dd(C))),x.faceZaxis=x.faceZaxis.map((C=>f.m.Dd(C))),x.faceXaxis=x.faceXaxis.map((C=>f.m.Dd(C))),x.faceYaxis=x.faceYaxis.map((C=>f.m.Dd(C)));const T=new yC(C.name,M);return T.goldbergData=x,T}}var UC=x(11765);class OC{constructor(C){this._paths=[],this._tempPaths=[],this._holes=[],this._resolution=C}moveTo(C,M){this._currentPath=new B.d(C,M),this._tempPaths.push(this._currentPath)}lineTo(C,M){this._currentPath.addLineTo(C,M)}quadraticCurveTo(C,M,x,f){this._currentPath.addQuadraticCurveTo(C,M,x,f,this._resolution)}bezierCurveTo(C,M,x,f,T,z){this._currentPath.addBezierCurveTo(C,M,x,f,T,z,this._resolution)}extractHoles(){for(const C of this._tempPaths)C.area()>0?this._holes.push(C):this._paths.push(C);if(!this._paths.length&&this._holes.length){const C=this._holes;this._holes=this._paths,this._paths=C}this._tempPaths.length=0}get paths(){return this._paths}get holes(){return this._holes}}function dC(C,M,x,f,T,z){const s=z.glyphs[C]||z.glyphs["?"];if(!s)return null;const S=new OC(T);if(s.o){const C=s.o.split(" ");for(let T=0,z=C.length;T<z;){switch(C[T++]){case"m":{const z=parseInt(C[T++])*M+x,s=parseInt(C[T++])*M+f;S.moveTo(z,s);break}case"l":{const z=parseInt(C[T++])*M+x,s=parseInt(C[T++])*M+f;S.lineTo(z,s);break}case"q":{const z=parseInt(C[T++])*M+x,s=parseInt(C[T++])*M+f,m=parseInt(C[T++])*M+x,Q=parseInt(C[T++])*M+f;S.quadraticCurveTo(m,Q,z,s);break}case"b":{const z=parseInt(C[T++])*M+x,s=parseInt(C[T++])*M+f,m=parseInt(C[T++])*M+x,Q=parseInt(C[T++])*M+f,V=parseInt(C[T++])*M+x,y=parseInt(C[T++])*M+f;S.bezierCurveTo(m,Q,V,y,z,s);break}}}}return S.extractHoles(),{offsetX:s.ha*M,shapePath:S}}const DC={CreateBox:y.i,CreateTiledBox:o,CreateSphere:L.d,lb:V.d,CreateIcoSphere:W,CreateRibbon:Q,CreateCylinder:j,CreateTorus:R,CreateTorusKnot:I,CreateLineSystem:X.h,mb:X.k,CreateDashedLines:X.e,ExtrudeShape:K,ExtrudeShapeCustom:G,CreateLathe:J,CreateTiledPlane:d,Pg:N.d,CreateGround:k.e,CreateTiledGround:k.i,CreateGroundFromHeightMap:k.b,CreatePolygon:Z,ExtrudePolygon:E,CreateTube:v,CreatePolyhedron:u,CreateGeodesic:function(C,M){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,f=M.m||1;f!==Math.floor(f)&&(f=Math.floor(f),g.e.Warn("m not an integer only floor(m) used"));let T=M.n||0;if(T!==Math.floor(T)&&(T=Math.floor(T),g.e.Warn("n not an integer only floor(n) used")),T>f){const C=T;T=f,f=C,g.e.Warn("n > m therefore m and n swapped")}const z=new mC;return z.build(f,T),u(C,{custom:VC.BuildGeodesicData(z),size:M.size,sizeX:M.sizeX,sizeY:M.sizeY,sizeZ:M.sizeZ,faceUV:M.faceUV,faceColors:M.faceColors,flat:M.flat,updatable:M.updatable,sideOrientation:M.sideOrientation,frontUVs:M.frontUVs,backUVs:M.backUVs},x)},CreateGoldberg:function(C,M){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=M.size,m=M.sizeX||z||1,Q=M.sizeY||z||1,V=M.sizeZ||z||1;let y=M.m||1;y!==Math.floor(y)&&(y=Math.floor(y),g.e.Warn("m not an integer only floor(m) used"));let O=M.n||0;if(O!==Math.floor(O)&&(O=Math.floor(O),g.e.Warn("n not an integer only floor(n) used")),O>y){const C=O;O=y,y=C,g.e.Warn("n > m therefore m and n swapped")}const d=new mC;d.build(y,O);const D=VC.BuildGeodesicData(d),o=D.toGoldbergPolyhedronData(),L=new yC(C,x);M.sideOrientation=T.d._GetDefaultSideOrientation(M.sideOrientation),L._originalBuilderSideOrientation=M.sideOrientation;(function(C,M){const x=C.size,T=C.sizeX||x||1,z=C.sizeY||x||1,m=C.sizeZ||x||1,Q=0===C.sideOrientation?0:C.sideOrientation||s.b.DEFAULTSIDE,V=[],y=[],U=[],O=[];let d=1/0,D=-1/0,o=1/0,L=-1/0;for(let f=0;f<M.vertex.length;f++)d=Math.min(d,M.vertex[f][0]*T),D=Math.max(D,M.vertex[f][0]*T),o=Math.min(o,M.vertex[f][1]*z),L=Math.max(L,M.vertex[f][1]*z);let t=0;for(let s=0;s<M.face.length;s++){const C=M.face[s],x=f.m.Dd(M.vertex[C[0]]),Q=f.m.Dd(M.vertex[C[2]]),A=f.m.Dd(M.vertex[C[1]]),H=Q.rc(x),j=A.rc(x),b=f.m.Cross(j,H).normalize();for(let f=0;f<C.length;f++){U.push(b.x,b.y,b.z);const x=M.vertex[C[f]];V.push(x[0]*T,x[1]*z,x[2]*m);const s=(x[1]*z-o)/(L-o);O.push((x[0]*T-d)/(D-d),S.c?1-s:s)}for(let M=0;M<C.length-2;M++)y.push(t,t+M+2,t+M+1);t+=C.length}s.b._ComputeSides(Q,V,y,U,O);const A=new s.b;return A.xa=V,A.indices=y,A.ya=U,A.Aa=O,A})(M,o).Ca(L,M.updatable),L.goldbergData.nbSharedFaces=D.sharedNodes,L.goldbergData.nbUnsharedFaces=D.poleNodes,L.goldbergData.adjacentFaces=D.adjacentFaces,L.goldbergData.nbFaces=L.goldbergData.nbSharedFaces+L.goldbergData.nbUnsharedFaces,L.goldbergData.nbFacesAtPole=(L.goldbergData.nbUnsharedFaces-12)/12;for(let T=0;T<D.vertex.length;T++)L.goldbergData.faceCenters.push(f.m.Dd(D.vertex[T])),L.goldbergData.faceCenters[T].x*=m,L.goldbergData.faceCenters[T].y*=Q,L.goldbergData.faceCenters[T].z*=V,L.goldbergData.faceColors.push(new U.e(1,1,1,1));for(let T=0;T<o.face.length;T++){const C=o.face[T],M=f.m.Dd(o.vertex[C[0]]),x=f.m.Dd(o.vertex[C[2]]),z=f.m.Dd(o.vertex[C[1]]),s=x.rc(M),S=z.rc(M),m=f.m.Cross(S,s).normalize(),Q=f.m.Cross(S,m).normalize();L.goldbergData.faceXaxis.push(S.normalize()),L.goldbergData.faceYaxis.push(m),L.goldbergData.faceZaxis.push(Q)}return L},CreateDecal:TC,CreateCapsule:sC,CreateText:function(C,M,x){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{size:50,resolution:8,depth:1},s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:earcut;const m=function(C,M,x,f){const T=Array.from(C),z=M/f.resolution,s=(f.boundingBox.yMax-f.boundingBox.yMin+f.underlineThickness)*z,S=[];let m=0,Q=0;for(let V=0;V<T.length;V++){const C=T[V];if("\n"===C)m=0,Q-=s;else{const M=dC(C,z,m,Q,x,f);M&&(m+=M.offsetX,S.push(M.shapePath))}}return S}(M,z.size||50,z.resolution||8,x),Q=[];let V=0;for(const d of m){if(!d.paths.length)continue;const M=d.holes.slice();for(const x of d.paths){var y,U;const m=[],O=[],d=x.getPoints();for(const C of d)O.push(new f.m(C.x,0,C.y));const D=M.slice();for(const C of D){const T=C.getPoints();let z=!1;for(const C of T)if(x.isPointInside(C)){z=!0;break}if(!z)continue;const s=[];for(const C of T)s.push(new f.m(C.x,0,C.y));m.push(s),M.splice(M.indexOf(C),1)}if(!m.length&&M.length)for(const C of M){const M=C.getPoints(),x=[];for(const C of M)x.push(new f.m(C.x,0,C.y));m.push(x)}const o=E(C,{shape:O,holes:m.length?m:void 0,depth:z.depth||1,faceUV:z.faceUV||(null===(y=z.perLetterFaceUV)||void 0===y?void 0:y.call(z,V)),faceColors:z.faceColors||(null===(U=z.perLetterFaceColors)||void 0===U?void 0:U.call(z,V)),sideOrientation:T.d._GetDefaultSideOrientation(z.sideOrientation||T.d.DOUBLESIDE)},s,S);Q.push(o),V++}}const O=T.d.MergeMeshes(Q,!0,!0);if(O){const M=O.getBoundingInfo().boundingBox;O.position.x+=-(M.minimumWorld.x+M.maximumWorld.x)/2,O.position.y+=-(M.minimumWorld.y+M.maximumWorld.y)/2,O.position.z+=-(M.minimumWorld.z+M.maximumWorld.z)/2+M.extendSize.z,O.name=C;const x=new UC.e("pivot",s);x.rotation.x=-Math.PI/2,O.parent=x,O.bakeCurrentTransformIntoVertices(),O.parent=null,x.dispose()}return O}}},12376:(C,M,x)=>{"use strict";var f=x(11712),T=x(1224),z=x(978),s=x(1078),S=x(1300);f.d.prototype.thinInstanceAdd=function(C){let M=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.va().getEngine().getCaps().instancedArrays)return s.e.Error("Thin Instances are not supported on this device as Instanced Array extension not supported"),-1;this._thinInstanceUpdateBufferSize("matrix",Array.isArray(C)?C.length:1);const x=this._thinInstanceDataStorage.instancesCount;if(Array.isArray(C))for(let f=0;f<C.length;++f)this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,C[f],f===C.length-1&&M);else this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,C,M);return x},f.d.prototype.thinInstanceAddSelf=function(){let C=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.thinInstanceAdd(z.d.IdentityReadOnly,C)},f.d.prototype.thinInstanceRegisterAttribute=function(C,M){C===T.h.ColorKind&&(C=T.h.ColorInstanceKind),this.removeVerticesData(C),this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.strides[C]=M,this._userThinInstanceBuffersStorage.sizes[C]=M*Math.max(32,this._thinInstanceDataStorage.instancesCount),this._userThinInstanceBuffersStorage.data[C]=new Float32Array(this._userThinInstanceBuffersStorage.sizes[C]),this._userThinInstanceBuffersStorage.vertexBuffers[C]=new T.h(this.getEngine(),this._userThinInstanceBuffersStorage.data[C],C,!0,!1,M,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[C])},f.d.prototype.thinInstanceSetMatrixAt=function(C,M){let x=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!this._thinInstanceDataStorage.matrixData||C>=this._thinInstanceDataStorage.instancesCount)return!1;const f=this._thinInstanceDataStorage.matrixData;return M.copyToArray(f,16*C),this._thinInstanceDataStorage.worldMatrices&&(this._thinInstanceDataStorage.worldMatrices[C]=M),x&&(this.Xj("matrix"),this.Da||this.thinInstanceRefreshBoundingInfo(!1)),!0},f.d.prototype.thinInstanceSetAttributeAt=function(C,M,x){let f=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return C===T.h.ColorKind&&(C=T.h.ColorInstanceKind),!(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.data[C]||M>=this._thinInstanceDataStorage.instancesCount)&&(this._thinInstanceUpdateBufferSize(C,0),this._userThinInstanceBuffersStorage.data[C].set(x,M*this._userThinInstanceBuffersStorage.strides[C]),f&&this.Xj(C),!0)},Object.defineProperty(f.d.prototype,"Uj",{get:function(){return this._thinInstanceDataStorage.instancesCount},set:function(C){var M;const x=this._thinInstanceDataStorage.matrixData??(null===(M=this.source)||void 0===M?void 0:M._thinInstanceDataStorage.matrixData);C<=(x?x.length/16:0)&&(this._thinInstanceDataStorage.instancesCount=C)},enumerable:!0,configurable:!0}),f.d.prototype._thinInstanceCreateMatrixBuffer=function(C,M){let x=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const f=new T.e(this.getEngine(),M,!x,16,!1,!0);for(let T=0;T<4;T++)this.setVerticesBuffer(f.createVertexBuffer(C+T,4*T,4));return f},f.d.prototype.Yj=function(C,M){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,f=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];var z;if(x=x||16,"matrix"===C)null===(z=this._thinInstanceDataStorage.matrixBuffer)||void 0===z||z.dispose(),this._thinInstanceDataStorage.matrixBuffer=null,this._thinInstanceDataStorage.matrixBufferSize=M?M.length:32*x,this._thinInstanceDataStorage.matrixData=M,this._thinInstanceDataStorage.worldMatrices=null,null!==M?(this._thinInstanceDataStorage.instancesCount=M.length/x,this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",M,f),this.Da||this.thinInstanceRefreshBoundingInfo(!1)):(this._thinInstanceDataStorage.instancesCount=0,this.Da||this.refreshBoundingInfo());else if("previousMatrix"===C){var s;null===(s=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===s||s.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=null,this._thinInstanceDataStorage.previousMatrixData=M,null!==M&&(this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",M,f))}else{var S;if(C===T.h.ColorKind&&(C=T.h.ColorInstanceKind),null===M)null!==(S=this._userThinInstanceBuffersStorage)&&void 0!==S&&S.data[C]&&(this.removeVerticesData(C),delete this._userThinInstanceBuffersStorage.data[C],delete this._userThinInstanceBuffersStorage.strides[C],delete this._userThinInstanceBuffersStorage.sizes[C],delete this._userThinInstanceBuffersStorage.vertexBuffers[C]);else this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.data[C]=M,this._userThinInstanceBuffersStorage.strides[C]=x,this._userThinInstanceBuffersStorage.sizes[C]=M.length,this._userThinInstanceBuffersStorage.vertexBuffers[C]=new T.h(this.getEngine(),M,C,!f,!1,x,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[C])}},f.d.prototype.Xj=function(C){var M;if("matrix"===C)this.Tj&&this._thinInstanceDataStorage.matrixBuffer&&!this._thinInstanceDataStorage.matrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(C),null===(M=this._thinInstanceDataStorage.matrixBuffer)||void 0===M||M.updateDirectly(this._thinInstanceDataStorage.matrixData,0,this._thinInstanceDataStorage.instancesCount);else if("previousMatrix"===C){var x;this.Tj&&this._thinInstanceDataStorage.previousMatrixBuffer&&!this._thinInstanceDataStorage.previousMatrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(C),null===(x=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===x||x.updateDirectly(this._thinInstanceDataStorage.previousMatrixData,0,this._thinInstanceDataStorage.instancesCount)}else{var f;C===T.h.ColorKind&&(C=T.h.ColorInstanceKind),null!==(f=this._userThinInstanceBuffersStorage)&&void 0!==f&&f.vertexBuffers[C]&&(this.Tj&&!this._userThinInstanceBuffersStorage.vertexBuffers[C].isUpdatable()&&this._thinInstanceRecreateBuffer(C),this._userThinInstanceBuffersStorage.vertexBuffers[C].updateDirectly(this._userThinInstanceBuffersStorage.data[C],0))}},f.d.prototype.thinInstancePartialBufferUpdate=function(C,M,x){var f;"matrix"===C?this._thinInstanceDataStorage.matrixBuffer&&this._thinInstanceDataStorage.matrixBuffer.updateDirectly(M,x):(C===T.h.ColorKind&&(C=T.h.ColorInstanceKind),null!==(f=this._userThinInstanceBuffersStorage)&&void 0!==f&&f.vertexBuffers[C]&&this._userThinInstanceBuffersStorage.vertexBuffers[C].updateDirectly(M,x))},f.d.prototype.thinInstanceGetWorldMatrices=function(){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return[];const C=this._thinInstanceDataStorage.matrixData;if(!this._thinInstanceDataStorage.worldMatrices){this._thinInstanceDataStorage.worldMatrices=[];for(let M=0;M<this._thinInstanceDataStorage.instancesCount;++M)this._thinInstanceDataStorage.worldMatrices[M]=z.d.Dd(C,16*M)}return this._thinInstanceDataStorage.worldMatrices},f.d.prototype.thinInstanceRefreshBoundingInfo=function(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0],M=arguments.length>1&&void 0!==arguments[1]&&arguments[1],x=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return;const f=this._thinInstanceDataStorage.boundingVectors;if(C||!this.rawBoundingInfo){f.length=0,this.refreshBoundingInfo(M,x);const C=this.getBoundingInfo();this.rawBoundingInfo=new S.b(C.minimum,C.maximum)}const T=this.getBoundingInfo(),s=this._thinInstanceDataStorage.matrixData;if(0===f.length)for(let z=0;z<T.boundingBox.vectors.length;++z)f.push(T.boundingBox.vectors[z].clone());z.i.Md[0].Kd(Number.POSITIVE_INFINITY),z.i.Md[1].Kd(Number.NEGATIVE_INFINITY);for(let S=0;S<this._thinInstanceDataStorage.instancesCount;++S){z.d.FromArrayToRef(s,16*S,z.i.Matrix[0]);for(let C=0;C<f.length;++C)z.m.TransformCoordinatesToRef(f[C],z.i.Matrix[0],z.i.Md[2]),z.i.Md[0].minimizeInPlace(z.i.Md[2]),z.i.Md[1].maximizeInPlace(z.i.Md[2])}T.reConstruct(z.i.Md[0],z.i.Md[1]),this.Ea()},f.d.prototype._thinInstanceRecreateBuffer=function(C){let M=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var x;if("matrix"===C)null===(x=this._thinInstanceDataStorage.matrixBuffer)||void 0===x||x.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",this._thinInstanceDataStorage.matrixData,M);else if("previousMatrix"===C){var f;if(this._scene.needsPreviousWorldMatrices)null===(f=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===f||f.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.previousMatrixData??this._thinInstanceDataStorage.matrixData,M)}else{var z;C===T.h.ColorKind&&(C=T.h.ColorInstanceKind),null===(z=this._userThinInstanceBuffersStorage.vertexBuffers[C])||void 0===z||z.dispose(),this._userThinInstanceBuffersStorage.vertexBuffers[C]=new T.h(this.getEngine(),this._userThinInstanceBuffersStorage.data[C],C,!M,!1,this._userThinInstanceBuffersStorage.strides[C],!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[C])}},f.d.prototype._thinInstanceUpdateBufferSize=function(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;C===T.h.ColorKind&&(C=T.h.ColorInstanceKind);const x="matrix"===C;if(!x&&(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.strides[C]))return;const f=x?16:this._userThinInstanceBuffersStorage.strides[C],z=x?this._thinInstanceDataStorage.matrixBufferSize:this._userThinInstanceBuffersStorage.sizes[C];let s=x?this._thinInstanceDataStorage.matrixData:this._userThinInstanceBuffersStorage.data[C];const S=(this._thinInstanceDataStorage.instancesCount+M)*f;let m=z;for(;m<S;)m*=2;if(!s||z!=m){if(s){const C=new Float32Array(m);C.set(s,0),s=C}else s=new Float32Array(m);var Q,V,y;if(x){if(null===(Q=this._thinInstanceDataStorage.matrixBuffer)||void 0===Q||Q.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",s,!1),this._thinInstanceDataStorage.matrixData=s,this._thinInstanceDataStorage.matrixBufferSize=m,this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData)null===(V=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===V||V.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",s,!1)}else null===(y=this._userThinInstanceBuffersStorage.vertexBuffers[C])||void 0===y||y.dispose(),this._userThinInstanceBuffersStorage.data[C]=s,this._userThinInstanceBuffersStorage.sizes[C]=m,this._userThinInstanceBuffersStorage.vertexBuffers[C]=new T.h(this.getEngine(),s,C,!0,!1,f,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[C])}},f.d.prototype._thinInstanceInitializeUserStorage=function(){this._userThinInstanceBuffersStorage||(this._userThinInstanceBuffersStorage={data:{},sizes:{},vertexBuffers:{},strides:{}})},f.d.prototype._disposeThinInstanceSpecificData=function(){var C;null!==(C=this._thinInstanceDataStorage)&&void 0!==C&&C.matrixBuffer&&(this._thinInstanceDataStorage.matrixBuffer.dispose(),this._thinInstanceDataStorage.matrixBuffer=null)}},11765:(C,M,x)=>{"use strict";x.d(M,{e:()=>y});var f=x(951),T=x(959),z=x(1145),s=x(971),S=x(978),m=x(11734),Q=x(997);const V=S.d.Compose(S.m.One(),S.h.FromEulerAngles(0,Math.PI,0),S.m.Zero());class y extends m.e{get billboardMode(){return this._billboardMode}set billboardMode(C){this._billboardMode!==C&&(this._billboardMode=C,this._cache.useBillboardPosition=0!==(this._billboardMode&y.BILLBOARDMODE_USE_POSITION),this._computeUseBillboardPath())}get preserveParentRotationForBillboard(){return this._preserveParentRotationForBillboard}set preserveParentRotationForBillboard(C){C!==this._preserveParentRotationForBillboard&&(this._preserveParentRotationForBillboard=C,this._computeUseBillboardPath())}_computeUseBillboardPath(){this._cache.useBillboardPath=this._billboardMode!==y.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}get infiniteDistance(){return this._infiniteDistance}set infiniteDistance(C){this._infiniteDistance!==C&&(this._infiniteDistance=C)}constructor(C){let M=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(C,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,!1),this._forward=new S.m(0,0,1),this._up=new S.m(0,1,0),this._right=new S.m(1,0,0),this._position=S.m.Zero(),this._rotation=S.m.Zero(),this._rotationQuaternion=null,this._scaling=S.m.One(),this._transformToBoneReferal=null,this._isAbsoluteSynced=!1,this._billboardMode=y.BILLBOARDMODE_NONE,this._preserveParentRotationForBillboard=!1,this.scalingDeterminant=1,this._infiniteDistance=!1,this.ignoreNonUniformScaling=!1,this.reIntegrateRotationIntoRotationQuaternion=!1,this._poseMatrix=null,this.Wj=S.d.Zero(),this._usePivotMatrix=!1,this._absolutePosition=S.m.Zero(),this._absoluteScaling=S.m.Zero(),this._absoluteRotationQuaternion=S.h.Identity(),this._pivotMatrix=S.d.Identity(),this._postMultiplyPivotMatrix=!1,this._isWorldMatrixFrozen=!1,this._indexInSceneTransformNodesArray=-1,this.onAfterWorldMatrixUpdateObservable=new s.c,this._nonUniformScaling=!1,M&&this.va().addTransformNode(this)}getClassName(){return"nb"}get position(){return this._position}set position(C){this._position=C,this._markAsDirtyInternal()}isUsingPivotMatrix(){return this._usePivotMatrix}isUsingPostMultiplyPivotMatrix(){return this._postMultiplyPivotMatrix}get rotation(){return this._rotation}set rotation(C){this._rotation=C,this._rotationQuaternion=null,this._markAsDirtyInternal()}get Qd(){return this._scaling}set Qd(C){this._scaling=C,this._markAsDirtyInternal()}get rotationQuaternion(){return this._rotationQuaternion}set rotationQuaternion(C){this._rotationQuaternion=C,C&&this._rotation.Kd(0),this._markAsDirtyInternal()}_markAsDirtyInternal(){this._isDirty||(this._isDirty=!0,this.customMarkAsDirty&&this.customMarkAsDirty())}get forward(){return S.m.TransformNormalFromFloatsToRef(0,0,this.va().useRightHandedSystem?-1:1,this.getWorldMatrix(),this._forward),this._forward.normalize()}get up(){return S.m.TransformNormalFromFloatsToRef(0,1,0,this.getWorldMatrix(),this._up),this._up.normalize()}get right(){return S.m.TransformNormalFromFloatsToRef(this.va().useRightHandedSystem?-1:1,0,0,this.getWorldMatrix(),this._right),this._right.normalize()}updatePoseMatrix(C){return this._poseMatrix?(this._poseMatrix.p(C),this):(this._poseMatrix=C.clone(),this)}getPoseMatrix(){return this._poseMatrix||(this._poseMatrix=S.d.Identity()),this._poseMatrix}_isSynchronized(){const C=this._cache;return this._billboardMode===C.billboardMode&&this._billboardMode===y.BILLBOARDMODE_NONE&&(!C.pivotMatrixUpdated&&(!this._infiniteDistance&&(!this._position._isDirty&&(!this._scaling._isDirty&&!(this._rotationQuaternion&&this._rotationQuaternion._isDirty||this._rotation._isDirty)))))}_initCache(){super._initCache();const C=this._cache;C.localMatrixUpdated=!1,C.billboardMode=-1,C.infiniteDistance=!1,C.useBillboardPosition=!1,C.useBillboardPath=!1}get absolutePosition(){return this.getAbsolutePosition()}get absoluteScaling(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling}get absoluteRotationQuaternion(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion}setPreTransformMatrix(C){return this.setPivotMatrix(C,!1)}setPivotMatrix(C){let M=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._pivotMatrix.p(C),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=M,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=S.d.Invert(this._pivotMatrix)),this}getPivotMatrix(){return this._pivotMatrix}instantiateHierarchy(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,M=arguments.length>1?arguments[1]:void 0,x=arguments.length>2?arguments[2]:void 0;const f=this.clone("Clone of "+(this.name||this.id),C||this.parent,!0);f&&x&&x(this,f);for(const T of this.getChildTransformNodes(!0))T.instantiateHierarchy(f,M,x);return f}ki(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return C?arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(this._rotation.Kd(0),this._rotationQuaternion=this._rotationQuaternion||S.h.Identity(),C.decompose(this._scaling,this._rotationQuaternion,this._position),this.Be(!0)):(this._worldMatrix=C,this._absolutePosition.Hd(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._afterComputeWorldMatrix()):(this._isWorldMatrixFrozen=!1,this.Be(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this}unfreezeWorldMatrix(){return this._isWorldMatrixFrozen=!1,this.Be(!0),this}get zj(){return this._isWorldMatrixFrozen}getAbsolutePosition(){return this.Be(),this._absolutePosition}setAbsolutePosition(C){if(!C)return this;let M,x,f;if(void 0===C.x){if(arguments.length<3)return this;M=arguments[0],x=arguments[1],f=arguments[2]}else M=C.x,x=C.y,f=C.z;if(this.parent){const C=S.i.Matrix[0];this.parent.getWorldMatrix().invertToRef(C),S.m.TransformCoordinatesFromFloatsToRef(M,x,f,C,this.position)}else this.position.x=M,this.position.y=x,this.position.z=f;return this._absolutePosition.p(C),this}setPositionWithLocalVector(C){return this.Be(),this.position=S.m.TransformNormal(C,this.Wj),this}getPositionExpressedInLocalSpace(){this.Be();const C=S.i.Matrix[0];return this.Wj.invertToRef(C),S.m.TransformNormal(this.position,C)}locallyTranslate(C){return this.Be(!0),this.position=S.m.TransformCoordinates(C,this.Wj),this}lookAt(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const z=y._LookAtVectorCache,s=0===T?this.position:this.getAbsolutePosition();if(C.subtractToRef(s,z),this.setDirection(z,M,x,f),1===T&&this.parent)if(this.rotationQuaternion){const C=S.i.Matrix[0];this.rotationQuaternion.toRotationMatrix(C);const M=S.i.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(M),M.invert(),C.multiplyToRef(M,C),this.rotationQuaternion.fromRotationMatrix(C)}else{const C=S.i.Quaternion[0];S.h.FromEulerVectorToRef(this.rotation,C);const M=S.i.Matrix[0];C.toRotationMatrix(M);const x=S.i.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(x),x.invert(),M.multiplyToRef(x,M),C.fromRotationMatrix(M),C.toEulerAnglesToRef(this.rotation)}return this}Af(C){const M=S.m.Zero();return this.getDirectionToRef(C,M),M}getDirectionToRef(C,M){return S.m.TransformNormalToRef(C,this.getWorldMatrix(),M),this}setDirection(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const T=-Math.atan2(C.z,C.x)+Math.PI/2,z=Math.sqrt(C.x*C.x+C.z*C.z),s=-Math.atan2(C.y,z);return this.rotationQuaternion?S.h.RotationYawPitchRollToRef(T+M,s+x,f,this.rotationQuaternion):(this.rotation.x=s+x,this.rotation.y=T+M,this.rotation.z=f),this}setPivotPoint(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;0==this.va().getRenderId()&&this.Be(!0);const x=this.getWorldMatrix();if(1==M){const M=S.i.Matrix[0];x.invertToRef(M),C=S.m.TransformCoordinates(C,M)}return this.setPivotMatrix(S.d.Translation(-C.x,-C.y,-C.z),!0)}getPivotPoint(){const C=S.m.Zero();return this.getPivotPointToRef(C),C}getPivotPointToRef(C){return C.x=-this._pivotMatrix.m[12],C.y=-this._pivotMatrix.m[13],C.z=-this._pivotMatrix.m[14],this}getAbsolutePivotPoint(){const C=S.m.Zero();return this.getAbsolutePivotPointToRef(C),C}getAbsolutePivotPointToRef(C){return this.getPivotPointToRef(C),S.m.TransformCoordinatesToRef(C,this.getWorldMatrix(),C),this}Fe(C){if(this._isDirty)return this;if(this._children)for(const M of this._children)M.Fe(C);return super.Fe(C)}setParent(C){let M=arguments.length>1&&void 0!==arguments[1]&&arguments[1],x=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!C&&!this.parent)return this;const f=S.i.Quaternion[0],T=S.i.Md[0],z=S.i.Md[1],s=S.i.Matrix[1];S.d.IdentityToRef(s);const m=S.i.Matrix[0];this.Be(!0);let Q=this.rotationQuaternion;return Q||(Q=y._TmpRotation,S.h.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,Q)),S.d.ComposeToRef(this.Qd,Q,this.position,m),this.parent&&m.multiplyToRef(this.parent.Be(!0),m),C&&(C.Be(!0).invertToRef(s),m.multiplyToRef(s,m)),m.decompose(z,f,T,M?this:void 0),this.rotationQuaternion?this.rotationQuaternion.p(f):f.toEulerAnglesToRef(this.rotation),this.Qd.p(z),this.position.p(T),this.parent=C,x&&this.setPivotMatrix(S.d.Identity()),this}addChild(C){let M=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return C.setParent(this,M),this}removeChild(C){let M=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return C.setParent(null,M),this}get nonUniformScaling(){return this._nonUniformScaling}_updateNonUniformScalingState(C){return this._nonUniformScaling!==C&&(this._nonUniformScaling=C,!0)}attachToBone(C,M){return this._currentParentWhenAttachingToBone=this.parent,this._transformToBoneReferal=M,this.parent=C,C.getSkeleton().prepare(!0),C.getFinalMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this}detachFromBone(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=C?this._currentParentWhenAttachingToBone:null,this):(C&&(this.parent=this._currentParentWhenAttachingToBone),this)}rotate(C,M,x){let f;if(C.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.Kd(0)),x&&0!==x){if(this.parent){const x=this.parent.getWorldMatrix(),f=S.i.Matrix[0];x.invertToRef(f),C=S.m.TransformNormal(C,f),x.determinant()<0&&(M*=-1)}f=S.h.RotationAxisToRef(C,M,y._RotationAxisCache),f.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else f=S.h.RotationAxisToRef(C,M,y._RotationAxisCache),this.rotationQuaternion.multiplyToRef(f,this.rotationQuaternion);return this}rotateAround(C,M,x){M.normalize(),this.rotationQuaternion||(this.rotationQuaternion=S.h.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.Kd(0));const f=S.i.Md[0],T=S.i.Md[1],z=S.i.Md[2],s=S.i.Quaternion[0],m=S.i.Matrix[0],Q=S.i.Matrix[1],V=S.i.Matrix[2],y=S.i.Matrix[3];return C.subtractToRef(this.position,f),S.d.TranslationToRef(f.x,f.y,f.z,m),S.d.TranslationToRef(-f.x,-f.y,-f.z,Q),S.d.RotationAxisToRef(M,x,V),Q.multiplyToRef(V,y),y.multiplyToRef(m,y),y.decompose(T,s,z),this.position.addInPlace(z),s.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this}translate(C,M,x){const f=C.scale(M);if(x&&0!==x)this.setAbsolutePosition(this.getAbsolutePosition().add(f));else{const C=this.getPositionExpressedInLocalSpace().add(f);this.setPositionWithLocalVector(C)}return this}addRotation(C,M,x){let f;this.rotationQuaternion?f=this.rotationQuaternion:(f=S.i.Quaternion[1],S.h.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,f));const T=S.i.Quaternion[0];return S.h.RotationYawPitchRollToRef(M,C,x,T),f.multiplyInPlace(T),this.rotationQuaternion||f.toEulerAnglesToRef(this.rotation),this}_getEffectiveParent(){return this.parent}isWorldMatrixCameraDependent(){return this._infiniteDistance&&!this.parent||this._billboardMode!==y.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}Be(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0],M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;const x=this.va().getRenderId();if(!this._isDirty&&!C&&(this._currentRenderId===x||this.isSynchronized()))return this._currentRenderId=x,this._worldMatrix;M=M||this.va().activeCamera,this._updateCache();const f=this._cache;f.pivotMatrixUpdated=!1,f.billboardMode=this.billboardMode,f.infiniteDistance=this.infiniteDistance,f.parent=this._parentNode,this._currentRenderId=x,this._childUpdateId+=1,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;const T=this._getEffectiveParent(),z=y._TmpScaling;let s,m=this._position;if(this._infiniteDistance&&!this.parent&&M){const C=M.getWorldMatrix(),x=new S.m(C.m[12],C.m[13],C.m[14]);m=y._TmpTranslation,m.Hd(this._position.x+x.x,this._position.y+x.y,this._position.z+x.z)}if(z.Hd(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant),this._rotationQuaternion){if(this._rotationQuaternion._isDirty=!1,s=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion){this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(S.h.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.Hd(0,0,0))}}else s=y._TmpRotation,S.h.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,s);if(this._usePivotMatrix){const C=S.i.Matrix[1];S.d.ScalingToRef(z.x,z.y,z.z,C);const M=S.i.Matrix[0];s.toRotationMatrix(M),this._pivotMatrix.multiplyToRef(C,S.i.Matrix[4]),S.i.Matrix[4].multiplyToRef(M,this.Wj),this._postMultiplyPivotMatrix&&this.Wj.multiplyToRef(this._pivotMatrixInverse,this.Wj),this.Wj.addTranslationFromFloats(m.x,m.y,m.z)}else S.d.ComposeToRef(z,s,m,this.Wj);if(T&&T.getWorldMatrix){if(C&&T.Be(C),f.useBillboardPath){if(this._transformToBoneReferal){const C=this.parent;C.getSkeleton().prepare(),C.getFinalMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),S.i.Matrix[7])}else S.i.Matrix[7].p(T.getWorldMatrix());const C=S.i.Md[5],M=S.i.Md[6],x=S.i.Quaternion[0];S.i.Matrix[7].decompose(M,x,C),S.d.ScalingToRef(M.x,M.y,M.z,S.i.Matrix[7]),S.i.Matrix[7].setTranslation(C),y.BillboardUseParentOrientation&&(this._position.applyRotationQuaternionToRef(x,C),this.Wj.setTranslation(C)),this.Wj.multiplyToRef(S.i.Matrix[7],this._worldMatrix)}else if(this._transformToBoneReferal){const C=this.parent;C.getSkeleton().prepare(),this.Wj.multiplyToRef(C.getFinalMatrix(),S.i.Matrix[6]),S.i.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)}else this.Wj.multiplyToRef(T.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.p(this.Wj);if(f.useBillboardPath&&M&&this.billboardMode&&!f.useBillboardPosition){const C=S.i.Md[0];if(this._worldMatrix.getTranslationToRef(C),S.i.Matrix[1].p(M.getViewMatrix()),this._scene.useRightHandedSystem&&S.i.Matrix[1].multiplyToRef(V,S.i.Matrix[1]),S.i.Matrix[1].setTranslationFromFloats(0,0,0),S.i.Matrix[1].invertToRef(S.i.Matrix[0]),(this.billboardMode&y.BILLBOARDMODE_ALL)!==y.BILLBOARDMODE_ALL){S.i.Matrix[0].decompose(void 0,S.i.Quaternion[0],void 0);const C=S.i.Md[1];S.i.Quaternion[0].toEulerAnglesToRef(C),(this.billboardMode&y.BILLBOARDMODE_X)!==y.BILLBOARDMODE_X&&(C.x=0),(this.billboardMode&y.BILLBOARDMODE_Y)!==y.BILLBOARDMODE_Y&&(C.y=0),(this.billboardMode&y.BILLBOARDMODE_Z)!==y.BILLBOARDMODE_Z&&(C.z=0),S.d.RotationYawPitchRollToRef(C.y,C.x,C.z,S.i.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(S.i.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(S.i.Md[0])}else if(f.useBillboardPath&&M&&f.useBillboardPosition){const C=S.i.Md[0];this._worldMatrix.getTranslationToRef(C);const x=M.globalPosition;this._worldMatrix.invertToRef(S.i.Matrix[1]);const f=S.i.Md[1];S.m.TransformCoordinatesToRef(x,S.i.Matrix[1],f),f.normalize();const T=-Math.atan2(f.z,f.x)+Math.PI/2,z=Math.sqrt(f.x*f.x+f.z*f.z),s=-Math.atan2(f.y,z);if(S.h.RotationYawPitchRollToRef(T,s,0,S.i.Quaternion[0]),(this.billboardMode&y.BILLBOARDMODE_ALL)!==y.BILLBOARDMODE_ALL){const C=S.i.Md[1];S.i.Quaternion[0].toEulerAnglesToRef(C),(this.billboardMode&y.BILLBOARDMODE_X)!==y.BILLBOARDMODE_X&&(C.x=0),(this.billboardMode&y.BILLBOARDMODE_Y)!==y.BILLBOARDMODE_Y&&(C.y=0),(this.billboardMode&y.BILLBOARDMODE_Z)!==y.BILLBOARDMODE_Z&&(C.z=0),S.d.RotationYawPitchRollToRef(C.y,C.x,C.z,S.i.Matrix[0])}else S.d.FromQuaternionToRef(S.i.Quaternion[0],S.i.Matrix[0]);this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(S.i.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(S.i.Md[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):T&&T._nonUniformScaling?this._updateNonUniformScalingState(T._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.Hd(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=S.d.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix}resetLocalMatrix(){let C=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.Be(),C){const C=this.getChildren();for(let M=0;M<C.length;++M){const x=C[M];if(x){x.Be();const C=S.i.Matrix[0];x.Wj.multiplyToRef(this.Wj,C);const M=S.i.Quaternion[0];C.decompose(x.Qd,M,x.position),x.rotationQuaternion?x.rotationQuaternion.p(M):M.toEulerAnglesToRef(x.rotation)}}}this.Qd.Hd(1,1,1),this.position.Hd(0,0,0),this.rotation.Hd(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=S.h.Identity()),this._worldMatrix=S.d.Identity()}_afterComputeWorldMatrix(){}registerAfterWorldMatrixUpdate(C){return this.onAfterWorldMatrixUpdateObservable.add(C),this}unregisterAfterWorldMatrixUpdate(C){return this.onAfterWorldMatrixUpdateObservable.removeCallback(C),this}getPositionInCameraSpace(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return C||(C=this.va().activeCamera),S.m.TransformCoordinates(this.getAbsolutePosition(),C.getViewMatrix())}getDistanceToCamera(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return C||(C=this.va().activeCamera),this.getAbsolutePosition().rc(C.globalPosition).length()}clone(C,M,x){const f=z.e.Clone((()=>new y(C,this.va())),this);if(f.name=C,f.id=C,M&&(f.parent=M),!x){const M=this.getDescendants(!0);for(let x=0;x<M.length;x++){const T=M[x];T.clone&&T.clone(C+"."+T.name,f)}}return f}serialize(C){const M=z.e.Serialize(this,C);return M.type=this.getClassName(),M.uniqueId=this.uniqueId,this.parent&&this.parent._serializeAsParent(M),M.localMatrix=this.getPivotMatrix().Gd(),M.isEnabled=this.isEnabled(),z.e.AppendSerializedAnimations(this,M),M.ranges=this.serializeAnimationRanges(),M}static Parse(C,M,x){const f=z.e.Parse((()=>new y(C.name,M)),C,M,x);if(C.localMatrix?f.setPreTransformMatrix(S.d.Dd(C.localMatrix)):C.pivotMatrix&&f.setPivotMatrix(S.d.Dd(C.pivotMatrix)),f.Og(C.isEnabled),f._waitingParsedUniqueId=C.uniqueId,void 0!==C.parentId&&(f._waitingParentId=C.parentId),void 0!==C.parentInstanceIndex&&(f._waitingParentInstanceIndex=C.parentInstanceIndex),C.animations){for(let M=0;M<C.animations.length;M++){const x=C.animations[M],T=(0,Q.c)("BABYLON.Animation");T&&f.animations.push(T.Parse(x))}m.e.ParseAnimationRanges(f,C,M)}return C.autoAnimate&&M.beginAnimation(f,C.autoAnimateFrom,C.autoAnimateTo,C.autoAnimateLoop,C.autoAnimateSpeed||1),f}getChildTransformNodes(C,M){const x=[];return this._getDescendants(x,C,(C=>(!M||M(C))&&C instanceof y)),x}dispose(C){let M=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.va().stopAnimation(this),this.va().removeTransformNode(this),this._parentContainer){const C=this._parentContainer.transformNodes.indexOf(this);C>-1&&this._parentContainer.transformNodes.splice(C,1),this._parentContainer=null}if(this.onAfterWorldMatrixUpdateObservable.clear(),C){const C=this.getChildTransformNodes(!0);for(const M of C)M.parent=null,M.Be(!0)}super.dispose(C,M)}normalizeToUnitCube(){let C=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],M=arguments.length>1&&void 0!==arguments[1]&&arguments[1],x=arguments.length>2?arguments[2]:void 0,f=null,T=null;M&&(this.rotationQuaternion?(T=this.rotationQuaternion.clone(),this.rotationQuaternion.Hd(0,0,0,1)):this.rotation&&(f=this.rotation.clone(),this.rotation.Hd(0,0,0)));const z=this.getHierarchyBoundingVectors(C,x),s=z.max.rc(z.min),S=Math.max(s.x,s.y,s.z);if(0===S)return this;const m=1/S;return this.Qd.scaleInPlace(m),M&&(this.rotationQuaternion&&T?this.rotationQuaternion.p(T):this.rotation&&f&&this.rotation.p(f)),this}_syncAbsoluteScalingAndRotation(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)}}y.BILLBOARDMODE_NONE=0,y.BILLBOARDMODE_X=1,y.BILLBOARDMODE_Y=2,y.BILLBOARDMODE_Z=4,y.BILLBOARDMODE_ALL=7,y.BILLBOARDMODE_USE_POSITION=128,y.BillboardUseParentOrientation=!1,y._TmpRotation=S.h.Zero(),y._TmpScaling=S.m.Zero(),y._TmpTranslation=S.m.Zero(),y._LookAtVectorCache=new S.m(0,0,0),y._RotationAxisCache=new S.h,(0,f.e)([(0,T.H)("position")],y.prototype,"_position",void 0),(0,f.e)([(0,T.H)("rotation")],y.prototype,"_rotation",void 0),(0,f.e)([(0,T.w)("rotationQuaternion")],y.prototype,"_rotationQuaternion",void 0),(0,f.e)([(0,T.H)("Qd")],y.prototype,"_scaling",void 0),(0,f.e)([(0,T.J)("billboardMode")],y.prototype,"_billboardMode",void 0),(0,f.e)([(0,T.J)()],y.prototype,"scalingDeterminant",void 0),(0,f.e)([(0,T.J)("infiniteDistance")],y.prototype,"_infiniteDistance",void 0),(0,f.e)([(0,T.J)()],y.prototype,"ignoreNonUniformScaling",void 0),(0,f.e)([(0,T.J)()],y.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0)},12342:(C,M,x)=>{"use strict";x.d(M,{c:()=>s});var f=x(945),T=x(10669);let z=0;const s=C=>{if(!C.environmentBRDFTexture){const M=C.useDelayedTextureLoading;C.useDelayedTextureLoading=!1;const x=C._blockEntityCollection;C._blockEntityCollection=!1;const s=f.b.CreateFromBase64String("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR42u29yY5tWXIlZnbuiSaTbZFUkZRKrCKhElASQA0EoQABgn6hJvoXzfUP+gP9hWb6Bg00IgRoQJaKqUxmZmTEe8/v0uB2u7Fm2T7HIyIrnz88uPvt3f2a2WrMbOvf/u3PvvzP/sUf/N6//i8vf/lv/3v5H//d//Sb//Uq/5u8yf8hV/m/5Cp/L1f5hVzlG7nKJ7mKyJuIXN/hPwqXI/g++zq6rPI5u8z+WqfLre+zy7PrVv9L8brsMiGvk8XLmM/sdfHXal4e3ad6GXPdyu2ij8u/+uv/5cuf/OSLfdtEfvUr+dnf/d0X//t3H/7bf/hP//N/928h/0Yg/4VA/kogfyGQP5Wr/IFAvhbIlwK5CGQTPP+9z5uPeePJSW+yo2+s/GtN30Rnv1E+f5zxof9R/lSXv/nr//mrr3+i+5dfyX7ZZQP07Tffys//8R/l/9TtX7790T/7r/8G8pdy+/8XAvnnAvkzgfwzgfyxQP5AIL8vkJ8K5KsmMVzu1U7p5PA5AXxOAJ8TwPf7sX/51ZeXfcemqnp9w/W77/S7X/6T/vzf/7383RWCX3/z05/9i3/13/0PX//eX/2FyP8tIv+PiPy9iPy/IvIzEfm5iPxCRH4lIt/c/393//9BRD6KyKf7f488fP74/PH544dJAF9cLl98IZfLBZtuqterXr/7Dt9982v95S9+Lv+gF/3i7Spv/8lf/vnf/vGf/dF/JfKnIvLnIvLvReQ/NEngn0TklyLy6/v/34jIt00iGJOBlxAsdvv54/PH5493SQCXy9t2ueh2ueimKorrFbjq9eNH+fDtb+TXv/ol/vHyhX4Fxfbx7euPf/Lnf/PfiPyeiPyhiPxxkwB+fk8AvxzQgJcIrGTwFsiAEXH4/PH54/PHUgLY7whgu2C7bLqpQgHB2xvePn6SDx8+6G9+84384vKF/IPu8iVU9Y/+7C/+jWxffiHytYj8VER+X0T+oEEBvxqQwCMJeIngo5EI3goIwVMIPn98/vj8ESaAbbtu2ybbvl8u2ybbdtluSECA65u8ffqIDx8+6G++/VZ/efkV/sO261dQXP7wT/7kX8vl8qXIFyLylbySwe/dE0CLAr65B/9vGn0gQwRMMqgmhM/J4fPH548eAezbZd/lsm3YtssNAYiqiogAAkCvb5/k46cP8u2HD/rrb7+R/2/b9Wu9yJe//8d/9Ney6S5yEZFdRL68/38khG/uKOCnAwoYkcCoEXwkEgGDDq7CeQfyOTl8/vhd1QCum26ybZtu2yabbrKpQvXue1yvuF6v+vbpTT5+/CDffviAX1++1V9sO77WXb/66R/+4V/dgkbllQi+aBLBV/dE8LWRALwkYCWCNyMZXElkwLTMeMkga/P4/PH547ccAVwuctkvdxSw6bbdtYDbTfSZBN7e8PHTR/3u4wf55vKd/nL7DX6mu3791U9//5+/gkNFZGuSgZUQvnKowKgLWLTAQgRtEniTuEfwaELw0MJvf3LQzynud+53uG+X6y3gN9kul+2y6XVT1U27JCDAFVc8ksAn/e7jR/nN5YP+avtWfq6Xy9f7Vz/9w1dgRYngiyYhfNkkgzYBWHTg44AEMmqQUYQKOmDaiCIa8TmsfmzB+DnZDQjgcpGLbti2y3bZHjRAdRMVvb/dcYU8kcDbPQlsH/CrbddfbF98+RPZfvLFnAQeieCRDC5DMvju/vmD4JkEvjRQgKULeGggowdHkAHTYxihg89vu88I5UeGAPSOAFTlrgPopiqbKPSmCKreUoAAkCcSePukHz590m8vH+WbD9/JP335k6/+tA86KxFchv8jMvhiogE4JQm8XhfKqOAqx5qRPyeGzx8/cgSwbXcUoLJtim27C4Oi93+4v6VxQwKAvl2v+Hj9pB8+fZJvt4/yzfbF9lPdv/wJnsE2BogmyeCRED40tGFvksIXiSbgiYSRRpDNDZ6BDI6ghM+J4fPHeyKAO+zX7cb9t4tedMMNAQju5V+f1uAtBSiu1zsduMrHy5t8ePsk3376KN98sX/xE5FPAnm7/782o0DiUINXMkCXCB7/P94/e87AWUmARQWVvgMuKej9t1RLBp+Tw+ePgwngsutFFdu26WXbbl+rSvdfbnqAiuA23QcBgCugV1zl7e1NPm5v+LC96XfbJ/1W9y++fgXjA3bDYXV+MuhRwSPwL3JLMFYC+HS/LU8HYrGwIhwyNOF12SvgM4SgztdifP85MXz+KGsA2C6X7aJ6bXSAOwrY5OYIqGy3d5uq4P5GhABXuV6veLvRAf10fZMPb2/y3b7vX7+g+9v98/WOBq7GG7RNAlYy+Dgkhhb+Xxp0sE8IAC4SGAP/TbgVJK/PoJPBnAiwPKxsXfbbnRg+i3s/JAK4Q/4b9NfLtomBAqCickMBjy7BuywAUVyv8na94tMjCVzf9KNcLl/0SeA6oAEYb1i9g+FtSALb/bKL8/+t+wxXFMyswqiHoK4ToIgKqslgpg1qUC0QoYbvJZg/B/q5v4szHmPX7YEAsD0CX25OwEUVm9xag1+agKg+nxQArnKjAtDr9U0+Xd/k4/UqH7bL5YsewrcBBiMJZPRAp6TwQgWfjM9vgRbgUYGL8AvLWH2gqhesCokeUmCSwPsnhs8fP2YNYMO2XeSmAWxy2VQaXeDmDIhApf33rD4PTUCuV+DtCn27XuXT5ir8VmCJ2G5BpBM8/r/dEcJb8/0lEQMtJHA5TAlqNuLRhJChhEpSqFabH3di+G1AGj+W1/dyAR4IYJNNnuLf6+tWC9CHHiAtFhAIFLjK2/Uqn65X+SS67aK+3QeTDoy/IG2ogQ7fb/dAtz5vBgrYGqrwNtCHsVfgIvwK07OTQBURVNCBFpKCOjqCHn5L/67TgTN+fpySAC56nwSUi256kXsSuFGAVyLoUIDo8/Pz7fdoErr/v17lk162HbgHvFpIYDfoAJJfW4sGPjkU4VNAF8ZEcLmLhdc7kljdY1y1Dq9yLiI4IiRqcLujb138KIPn80ejATwRwIbtBvn1cqv+2J78/5EI5N4cJA8qIPcmwRsKAHDF9WYP6mV7VmrgLuTpxYTcMEW0LAmoQxFsuvAI8tv/a/C5fV2ZMMiKg++FCM7RDPRu8ebWY7VG6VJi+Bzk35MI2LsAckMAgwvQ0gC5DQjd3ABg2HQLAPpEAlZ1Bu7VV7MGHDFRAbo3VKsTbAY9sPWC/uvx86gBbDK3D1eEQS8pbAeSgSwmhepnJb6uBv/o/PzHLzxWA/X7TH77De5j6AGQi6o0CUGfCOD2X7cXAlCFQABtEsGLDtxuOyQB2UTQBKZe5GUPXgkUYCUAbZJRhBDeuq8xBf+bgwbehDm+BFQi2IJksOocvA8ysIMfxluVcRsY/eB3JzH8GFDAXQO48X/dcIf9jyDHptIigDsFkEe066tBSETQUYF7ElDdYEBytN4+rk9UcBPfrKaZqFHWcw3i4J8/X4ev2//bSXqAhwTay6OEIPLD2Ipt8OtAGzxkwLw9WVFRjTc/qC6H3+YK/b1oAA0KuOizHfieCLaHHiAb5NYTIC9EMEbZrVEQt1xwhVy1UfBh8PUOquMizwaap3tQXfY5B//tea/NZdfhsvbz+PURQTDSGWB87VX/7WSd4KxjUqrIgE0IUkoKGnhIvwvawpGf6eECXJ7tv4qbA7DJgwpsKthEmmYgfaAAffYF3HLxo0vwNjJ0SwRWMG4db4eh1gPNm18vQ+us/0eGmxDemu/fnM/X4evq/8342ksGHgLY5LyT/zg0wM8lcMjgGFXwqIOVFJBQw99eCvF9oZL9Mfl3QwAvIXDsBRC9R+fz8x0FPBLB0xJEpwUobrfAkARgIAF41h3wQgP6QAmX5E/7eI43IxGwwf/moIkRyWRJQIPgt9CA9b39nzt4bYUWjAlCjWDPgv8IEjgLJfzuaAsrv9VdVG4OwOXW/fdoA35qAdL0BDwvf6AAUVHd8LIEu94A3K+Q+2YxaB84MOH62P//qoo38fCRDERE2zf0JfmDa+MieElAjcDPKz+mRKCOtdgGtXaBjgNJ4H2owSpNeAW/rRH4CaHSpMwnBYYycjgSJwfie9CR6mPu20Uv8kABF206AvXlBMiIBPSlB9wjBW1fwEuSb94296VCqgMaGCt/G1BbExi3IG+r3a3J6P48Gv/J0YmEYoiGY7V/SxwFCwGoE/xa0AJ0CEiV9QPCJb1OJ5F1VTjEY2/MO9AEJvj1BJTQpqLfTlGwjABuzT962e4IoKnyrdh3+/6mzDVJ4PHOxj0JqGKoy20+wBMN6D1gLWi9NQHfVP5MEEPzjGYy8BMAOnTAJgEr8HUIejRo5xrA5xkR5AngmiSHs+zDDAmMgWzTg55GSJEmHE8IvWPAoYTfhWak/Wn/bQ0CGLSAjv83SUEfKp5q24LXuQICpzrjrgWoza8xVE00CQCORdhMJuTUT/rjuls0gO4Iby8BIEgK6gS7BsGuTtDrScH/fR68biUHNVGBnxjeNyHEvQe/ve3LZQqgG3rof6cEclsNflG9J4KtaQ8WHcVBHS1BtHE4QP9OBMS98mpbKTeDW7dJwRsnHpMBTFJpV4I+b0kY/NqInVFSyBLANbnMSgBM8F+Fqfxq/h657/Up+GaBnwV9hRqc9bZ/vA6vu+T9E8KPJWns94UfTeCj2QXwCHS9dNL8Xf3Ho/rfewSeFODGDV69AU0y6NFAE1DP3qK++rdB7/1HRxf86gT376zOr99T/h/ioBiXWQkgQgVeIrCC/WomhDmQK+hASI2ARQZKooHMLdCJwGEBBXC3+uERwg+VOHZ9ioAt9H80AI06wGgJ3nQA3BoCut6AhxYwgcPOFnxuFnrphk+NIKIGrWPQtgz3b0i7Y6D5rs1GKqTop0nQX52vmQC4BkjA+r4a7Kx9WLENGeegkhSETBCrNXIMdi/444Rw1n6E96ry7OPuj8UfLxtQ78NA2iSBbg7gIiIbdDLsb5agPhLC3RkYKv8NDbS2YGsatNRAG2oQwf9ZIOydgy1MAzBkAw8UwEEIDzSAqdPQ6za0PkeJAMH3Z0wXniUSZoHvBXU2mcjQgv56TedIKglCpIoQfgwCIjOytd8WgN0bfxoR8Fn9Gx0Aj5Zgq0lIZbsH/ibSJoFnS+C98g9ooHEELI3gliy25yONIiE6pb0NfBlyNEYyENoodkKwgl6I6s8kARgJ4ZoEfuYWHLEJa0LhSBXm7kImGeSfVdoJ1DO2G7WXsehAptupSOoyrCSF904k+6vt98X/ZcM98Hsd4JYIXhQAIg3/f9AAUYhsLQKAtkHVBnzjCKhOoYl2ym+iBtvzDzQ2DLXJ4PUmbJHAVnBQX4jkxfvHhNDqAdHXGQJgv0aSDGItgOseHIU+K9hXnIJzkoGlEKzNHagTdJ6VWEUH4iCKH4fd2AwDPaYBm4Wgng4gQ9V/CoGiuNmD04AQtNGMGzSAAQ2I2pzfogY9LRh7BrbOh4+D30sAencljFu2CUFrwY8UAWRfWwGvVOVfbx2uIILM0pwDv082dUTw8hYs8L+uIWiHGpWgClnAa1lMPJogovvvbePPs/q3Xr++kgCsfgB5oQF9WYKPJqEn6G+OE3i5AqouF59FQOmahQC8rlPLj38kg1c2f30vw+XaoIX24/pMGIgSBoZqoH3wo0sIIGlA9PWcCPrAtpPB8eBf6x1o6cHra+2+tpIFP4PgBfxZtZUJfo4qxELT948D9ucK8Mt9+ccjIQw6QJcEbrD/1g340ATuDgDkFfx6twSf1f9xvuBECYxq/7ythQQGm+5JDx6Brw4CkMGT3wgscCUoQ4sU2t6DR2ciBjTgtcpenQoZVX9NuL4Owc+dVaDursYVkVALX+shjSBKBuvCYDUZjE5BdNkxdHAUBexyHwB6NP7Iyw7sxUDViwge1t+mz8B/LAvVx/c3PeBBCToB8IUGOgqA3iV4yUg6UAOxaUFHDx6CYS8SorMOue0CCJGAf5YfRhoAI+A1CvwxqNkAY5yAIx2EQmkFfeWOXi+nEdSQQA0ZHMEItiagJArQxDXIrj8nCfQi4HZPAttrIahso9oPQ/2/JwV5JQU8zw+7I4D7/sBn4EO6rjw0FR+i3Z9fHtahzsFvJgM0X+tmVH5vaYiNDGAigewAz+gyNLThnjCURQFR1b9d3lZvnVqmj9mEPDKIUIC4KCCjBXywS4N+otp/Hk3QVthOkwEKlV9PQwXjT7s/zwF4Qf9toAAzFdjuaEB6S7D1//U5FIQu2MevO0rQQH8ZmoXE6B/IkgE60XCjVoq8gt2iCG0S8L5GdxkM1cGsfsCMArSCAnrr7dzAZxCEEpepvB8tqHJ/q+bmJGGts/AcAXFOMMeTwC7Pw0B6CtCtA2vWgonqBQJFSwH0JQK29OB2kvgj2HHXAoyeAIsCQO0kMNECAhFMqCBf8mElAkyBbX1tJQP2RJ/ha0gpAfS9l+/5n00CkrQpq0MZbOdAuxmMvHswog62jZj7BnYQe19b14kxNq2D/ehX/p68HEcF+x3yP7z/V/A/q/5DA3i5A/dzA5pdgbKp3v3/wQF4Bb70WkCTHGRAA6+KL0bFl6FJaFw0ImZwm6igSwbbwPn9RMBWf3sN2JgA/BVh/Rg0kQBgePf6HglAHLFQwqQQOwDjbdVxNZjR4iM6Qa3WxwvNxh0JFb3g/WzFQQS8b/ttKcDWoABtUMAd8j9hf0MB2uDXhzX4CHj03L9DBU3Qjz0C0l4mLSLQPicOOwZoVCB6P6dA7nDbGkVuxcNr8PU2JQO4wX5trEqmccZaHU4q8oCDFOpzAnOwqyMIMktNNNAHouDGxO37DgArQZzlmp/14W1QlqHTMaIIx7SCx0+5yza7AKJ3IXBrNAHVDcMZAU/BT/vgv/ULPOA+XiLggAREDF2g0ci6xNDRglegd7P7TWWH5oJfayliEg7bScQRBVgI4Ookg/F6rvpLWP29swREqA3CaG8/FpKqS8DTAV4TiBqIqtxfzaQRLys5I0XEFIFrPbZRQb+16Fgi2LvJv8EFUPW1gGfQv1T/F/d/HBnccP7rAwnIIyHI4ArgWeGbU4eHy6Tx/EeTZIb5bo/BsMBjmjBE08f/RB0PHYBd9eVRAGY7cHRwiBf8WeCPHY1bgBTa9xKTELzEkQX9CPtl0gJiqsAmCT7I8xbjivh3JGFI+D2nBcSJQJ8agDX+O9iBL7UfG4bzAkcaICrbtYHz1ycSmGmAjJfL3CMgT3tQpmrfB7gxSzC1DnvdhQMieG47u75+kTouKNkM8c/+vq/Q7ZYjO/hhVvRq8F/9gGfhP8aqE9EIdR6LTwJ1h0BItyDqB8iFwuNqASscRnYioxOg9ApvnYA35f8e9Ohbfe8J4rknoFkO0lmA2gmAG0YK0DkB4ieEjiLoMD8wBzom27ANZkzIoU8EMHk/uo1mzeVoEoRWKn8L/62EYAX/lsB7D/LXg74uAMr9oGivJ0CNJCGD6i9DhZdQF+gtOp4S+NODRzsDVbhdgv4BqTMNyIL9SCKwL9/FGPp5oQKxIf8A/UX6r231H7YIqLML0Ae2GtrADOvRQH5b/MPE9dt9BGLNG8jVTAQvIaK5TtvvvWQgDvyXIClUA78S9Nfg7VtIBlO7cbsEYkQDMot+ygQ7QwmOawTHnAM2XUSnJvPIYRYMmYPS+sv3J+cfP3d04JYIXsF/EwMbBKB9Q9AY+BiSwFj9mzrSXmcJhFPVHySTbgHJCPvRQ/z7G/SVUETsg0ZF+i3CRoCjhf7y1A9mOiDD7TwdwEoEXjLwAv+avLE2B7Jnb+OqDpBoAchoQJskxKnss0vu7Q2YhcDv4ySeLOg9GsCKiUIihP7yfW7zbTsBh0TQfN0iAWn9f72Z56/Ax9P7j5OAH/Qvv3/QxKfk0DgDuP+R3USg3bzBC7bO/QT9Eeh9QvDPG7glBQzJwK740lAFFgFk8P88CqDGAa223YckWYhr+c0BPdwetl2ocnsfzePAWcVnnAIp6gDVhDLyfV4nqFEDPxHsbWD3k4BDkN+pARqKMLYBPzYEvxp9xmCHQQdgWH/9EtH2TIFpu3AH/cdGydv1j0TQbRrq+D/mLcX3ZACZ15bF378CG0My6Kq/zoGOQwhASDFwFbxyNGBuSxbCEhQ/uEPe/6gAERWQObCVVfjPpQX+rexxYhYFxIkgpgX7Y/vPs+Pvxf9vwt8kAs7i32t3QCP+3SPaTwIytQXP38u0PESm+YER+o9B3vr8mETAUfDrEkPI80ck0FZ0dXh9U+HRbhey0cAc2H7A4y4egoD6y8JfkBiigLdFP8v2W00E8deT2IeAKujZ/QAVKpAtKI20gLWksHedfgPcb+0+NEHefd9vB9rayi8h7J91gBbaw20MsnWAF5xHkyDUCOoXp+yrOwwxcKj0aL6fFppaaKDv6OpHR5sgx5BAlK/+fYhuP1D196o8e7lFBaKqv5YIMnFQpd0FGVR35RJCnCDaABaXBtgbiSwtICMtalKC+1JQ6bx/PLcDPQL91QFodQNKpwOgF/9eqcBxBBqRcKAAVk+ArQOMx1RYGgB6naDhlK+uQQwJYx4meQbxtNnYQwMjt/d4f3M9ZE4UOld1LAh99fbfzOxiEkKFCkTJIUIMUeVnJ/9sDt8/e1NEJOi9oVHDGYhgnSLss9DX2IAqw1zALUncKcDr0FB5NP+0cBQNrEezDiyiADPkt9qGpwoPdL0AGPx/NOKeyf3b9WJNdfcFv6bKd2cLMJVfJ6Y3B6wB9WFUfWWEwKMfGiQL+3bz9XGQz2EHKhF41GCtZyDi/gUCsNhYoAr3UNJ58YidHKqnMb/6AB5J4N73/4L+t7mAkeeP3P+1LNSB/l0SkMEd8DcEuUlguEw6t2AU/PCE/q++Akw6QFf1u6SBrj1ZnnhG50AfkoGIdf7gJv1KcSfgzWWkQ9U33Z3tHXYASKJ9e/YhU90rvD+q9Ej69/wxYJVs506Eg/r3DkMDzEdDBRGgcZay49XihLA30P+l8N+hf1f57/0AoxbQbwYaan/rBMirE9Dk+sBzTkC8JNDEUlv5McB8PP19Y01Gayep+hC/2zvQ/2HGLAurowsNGlA1cnqGGzeH5weiYLZm7h3QQC4O2tXdhvMMk1ZS5ebpgI8eMrPvPGkwaxayk8Yc6PMOBPEdC1XZ+2UfbfOPtxLMQQAG9BcZFoF0gp/RKjxe7+oAw9T7ZPWhgedodgz0gf5KBtrtIZhQAZpAV1Bi36w6t98qVfH7hqGI318lLCjLCUFlxRHwqYEH9a2qb4XjWvDT7kBwfbZA5P0+PNuRuW1yf4yNQH3zzwv6b70QOJ0G9OT/dhoYRUGT15uQH/71MjQLtQlxfDuiCXrtM+SkA+icQdH6sU/xz7Ze7FlubV4TpoTQ2osdpaEjtqADmEU7OkBEFoLeC3IWFFeswJXKXzkboNL+wzcFHU8hTGKIboO7CLi1/P+5F+gydQhuvRbwEgxvtACmANikhLTbj0gCYk8KdlYgmj+4Ymaod7TwahwadICuX0Cm2fE5iNHPK0x/CDV66Kyg1MnqjNFBnhBoLQCgUULfaVe5nq/6EQWY67bXCszUb+7232fVPz51iGB12owK9peyP1T4raMFF/OEYJP792mgXYfZ04GHMAhBkCSmSj+dKqRPgVFGHbpLEGMiGFeQWfSgrY52VxaeDUPSNJI0P7NoisG729HHl78z6hxfs9rV3m4JjgM/lsui2qmThjCfDFSb+I9vwUqG5wwL55U7C+6ot8B+7N2o6r3q37T9trfpjgmTvv7PSQATLLeRAOZhIJHBQfDQQJPBdUwEbVW3+L08EcEE/9G4ANrCeWcnPKRHDupbNynMx5AA9IRYLmrc/YLSiD5EaEBS/s/TgnU9ILcH19n+CpHwegLejx7Mn/d25fdN+e9U/1vgb7bqf08MOtf8EXxaoh+GY8L6gDfhvs4i6HQ7seYI2sv1GchdMsBIG3xlvxcCRzdgCPTn+6q/TW00VE8Q9FaFv+R2VlOM1vm/hhjhDCdgNflVKME5B47I9xT8z0YgPAJ8myb/LqHy36j/Mwqw9AALxuO1JVjiuQAYLcFzIhiEPe05fk8tRjGw7yWQbsfuLAT2VqOId1osnr0F49VM8INACPHDoBz4B5mqqSnUgyh3ArjXxfQH5BbgUS8gP7aU+w0zHD9GGD0CGHf+P1p/DeivlhU4BbxR9a2kYFR58YaDZCUR2P0DMmgED2eg77puegy6PgDphEB0CwlG/i9d+/Hs34pBEQrBn0W51mqGnJAk3ACCHeiqkQ1XFQA5AlKH7Lk8yJKWY3/nym14h2C3JvxeMwD9ZVMz0BPMi1n1RbKl1cYhIVblF3G0ATsRiCMUvoK9//OgcwYMoe+ZKOLlC6/Xk50br9NFz9fanqA8UIYSpCwlBO4kHc4WLLBfBHVaKwKgLQjmP4Un61Vq+3s7Bsyi0WztmLjJwJwFeE0I2vD/1Q6MVwefxfUf32skCPbCnxQqf+QMPEUDHZ7vGeyj020JgkPXXwsldA7SYR1RE3h94NvNtugswcgxXEkIcBPCGZ1rmrgDC0A4K88nm2fn/eTnpQtWyZfybRoK8Dro4zYDIMGsf7saTBzvX0SMbkAD6o9CYbsfMK38cJKD9l2FJt9/VGs0h5Gib33pxMKWNsigFUh3G2un+/N1WUglI/EEx8fq27vUNnwsiOoKecL7kQS8VnWAGCFUgn6dBtQhv40CmIYggwK0uwDHRGAuBXVdfwzHUjZzATLMAoyJ4FmBhzaWBlrHld9CCWpPHRqofBqMReMGTJ78q9rDes1Tv7/0m0v0AFHXNR6P6g30SHivin7V1BOhh3iWPwvps/yE836L2XiwnUT8x2iHgfqhnwn667QHEE8oLQjEvtEW7GYBZDrDVkwNIO4G5GiBDf9fGoFM6n+vbEtzXwP6u9AduaWnGYSLAlVdl/AU+ikrSeEIKgwdaZ4AACAASURBVKj4/wtgHcHtdO2nWKcBkPfxcvnNQvsj2Me9f02r76T8q0IBn9OLKfz1HX8yVXQYGoAB/2UeBQ5/5kCL6+H/OGGoRnLSwdd3oH8r7KkGTbgIxEwVWvnF8KOpHnyzfF9Jod5Px+IF1h8owyitDw/XEgRb5bPqbt1uvn7qBIQ16vtS/u+DP3cR7CH0WWJgd5mTJKYgNzoGjQrfvu99NDBC+bnyW1x/qhTatv2OaMKgJWPvv5kwnMgxHYGFRtJW8VMl3uP+MgoqSZyWFKr7+KIDw1d6+IiOgZI4+d5iYL3imzbgyO+tph9t2oSBxOM3ugHtPoFZ1LM0hF4kXNEBssvVgPdjdXZWK7uKvyS3q1Xb1WQwtVDqSUggq+Vw3t56JA2cz7PXOwGNW1ecwxPhfe3QEUsDsFaAz8jg0nf+iZMAHNg/XSazDuC18Iq1HBRrOsAQ8NLB+16g614jmuSgs3bROxE55D+WDDQNA4ivdMJ9M1b309UqknaDU8ObV9/PwmMPATvTMAxpABLBzugUtV9bLdhNDQA+7B9tQJ06/7QNDHGSwtgZOCIA47InIoDdROQGtt0U1HI3GaoUnCnC/rzBMQJteN17+VaAzYNA7e+PFqHQUyXPUYB7iQYa5ZFjq1Zqpx8Uqu/XT7+6BWC1Xaj0GlBIwMoHu7UzcI/6/Acb8KIq+hzmGWmAYnADrIpvKP7TZeLaf0LAeQkGgebbq9FToI44p654F47tekKkI0L5PQNZPsDwPBpy/ni+wKMN76Vav4+2cFZFf8+JwAraMt0DFB7beA/u4Zz/a+RXx0M/ct4/jwaNAS8G17eSwmta0Fhx0VRxJkHMivso+onMXr+YwdWKbgioy1jp4x4AzIKg5lEA7wvHEYCRmdx11TAuT6lDLVl4KvXkAET9P4RT8H2u+lg9EPQIpw+/NpJ7RwE8HaDv/Mu4f3OdNkq/EfAiEiOANjEALvcWL9gfFV4NZbgbQc6qPky4Pm35QZxtH1f4j+P/jXuaYPcWwIEH/fmEPBoAO4m4LGxV3txOQqDU+dXgey+UwSzuqP++uImO/u/6ogCb7wTc1n61sL+vZi87rxnrNas+giTg6QLzaUCjIp6JfhwtGI7AjBBB9JjDY4ePYVR6ZPgN4owVv6Q2N5hhVHwNeYrM+w6dN6K1sMHZm/Ce7bHe3dzKr1xw1w4JrSQMZtgnoQHlr18fzunAszD4qurNUg/TDqzx/lfCaO6t4tACMUQ6P6htWjDPC1hCoZ8kpODzJ70MUR9AODcgwyqyPhmE+wfHYB/hvSqt6qeXUShhXH+d9SR8DzrDaZZdpSp/HxqLMQuATgDU/qDPRgOIeT8cvz/h/XC6BtE7ACLOWPE0KIS4UUjmZaJ2grBphiWgT41BUVWZfP3AnEIT6OrfoF122l2rMycBoU5i/OXoUZ4/aglsXwLzHNU++FVF3qikOj5HXm2PBitT1WuvJRAB+6O//W0/PY8vQH5IrAsMs/WuVmAdHBrQgrbOxJShXwRSsu08h8JMBpo0+aDTALwV4tbswgzHrftG/dJKIAQb5h9KCssWIMeto+GYqG12/HWGjx8kzqNJaa0noMWOr2KwW01AMwJoNvhMQda2/RKQP/3ecABM3g9uD6BY68Ntz9+nDOMb5iV+hIE+dP/Zs/wwJhJ9mgBnohBuStABUXjugF3hkXF9ZZJAjefKdHZCc389LoStKvIl7QIEb1d9RyciQgFDI9Cjyccc/23Aam7/PZJBhgDgin5CtQvbCzX8ip9YgIFtOAt+w0owp/hOiCWgEGbVHuYjRigPGR/YOnEoqPDoV5z5YqB3mRq2ox5ICmSSgAP1Ne+XV2NE+/vuFbCTRADxtS70VRBCjgBk2OyDUQiUgfl77b7DwaHm2rAZ7osRSOOUoHgKfNBSLI767+oDYrfwZvqChSpGfj3pFwZFsCJg2jeIQQBUiyI4WgD68ww4qO8khuWkkIuDrxWv2nv+UTBpJYiPd0KemTA8qqFiuUF1jWS3BoG6pADJq751JqBI0wvAVPyMQvjcX1zbELltKK+zBiXRFiRxG+b7q3M9xuLdzR8g0gCGNzSM5gNYfqGO9CBT8OHct6oB3KsSDBisUnwsFuISQaRHxDSv0vptt2oeLHMERfRn/FG/Cx01EpgIQG8LP+/i37PKw53xn6sYCM4/JwSRrCnIeB1ZkLsawDhaPKv/njU3wnZ/dBdGE8+YTHSG8+ofGgIjsC19YnwdM/KAnTSsqj6ig7uGgIPw3nYFzhhIIvriAxFP9CQd4HSlnzgxONIdrE7A8ZDPx9fjib8ifgegNIliRgdx95+E1T7+3nQVNNhEzDgGA3T2rEDLduwtPpuuouPcs8swwXFjdTaMKt+jA5gUAQPcf95KJQxYU0cYxEDvsBSmYuukp7AwnqniC9Afa5z8vboI68ImT0t26CvwBzSggkj447r9IojvCn7U92J/Hw0QSdwZKNNjxPCfSxRqnATkdwpOwh88oc4J8KTSm/wdbZjrc+4iFP8YO0/5JJDCfaijK5xVXevqfg6zGRrQf83chvX4aRfAE//6vv5+6490U4ADdO7QgM/5bcHP/n4OtCQhBEFeDWSvos8DPq8/IwzLzjpa8/U6MMSkBklDm8e0mn3QIY7XG1Om8wzN48y7HwhOK3P0/ZwUQHHv4psbdoVeb9VlAjChBCdtDDpOKTh9ZfcagOYq31RFjN4/gwBYzp8lAwYNwBELhZoxECeZxMlAzWGdCRV0fQWGHo8+8Kx+AAxnCIzowAxy9KvNepWfsfp4RR9kUrD88CPVTuXRybhqqTHcnxEGndsgub1Gdug8yz9fHt3Hpl57x/mfCOC29FOSQ7/noAZR5W3Ob24UMpuPYAYiQrQgk1gnFoUIKr4vKFpV15pHUJO3Y5rfH3UFHU4bGkU+NKJ9f2hJyOMxDBDpjAgwiYqvk5TqNl9EH2Arb6fA3yaA4cBtPWewhkEcIQJBlGzYp6zRmr1v+e3Fv27xpzvyI44NGDkCIi7CGNV9Dw0M8NtHC2vUwHINumCGNG8erxOwtQINsW88Tlwdoc+F85nI559ngEDpt2F/Uu3hiXYrkN/pBFS26hYDAkFgErMK67y9mGBA3L5ore5izf8b3n805MOq/t7XU4WHv1DUF/5gugCSOAIW/59uMwl6CHWAib8bvfxWl9/rBGEMTTwDfG+ezEYG4yk6FvRPuPwE+wvc39IRjENWM+/cm5b0W4Pf4WuKUnw/vD6eDbB1ETs5vl77Dhnm/51g6wPWwQAqxnivgQaeS3gy/u/1H4hpTPrIgHAN0mSgXUX13YP5PMIuQAfBr/f70cdeE+QoCX3i8nFMLcAjInBoAIYqt1LhC1WdtvmSab28AYffaeivCB+ohdYQgfUa/WS4ToMsNLHLc9nnvPZLwn1/EefPVf+U/xvnCVSEQEkEQEnEQJO7S7RvYDxNeNYKrG7DKMhtsQ8cMmhgPKKKj+F7CiHYFR5KIIPxOmg5IVAtu3ACQSPh7CzUQOgAej5CWEkIe3vgxz0ROGO//qYfz/dnLT+ZxDr4QW0eNCJBorCFOVC312Ec2TiY5Bk0cAaQmiA1VH1MOwDHQ0kHdEDDf+2UTWhS4Z8diQMicLx8MLBfverLcP/jQzF0P8EJj5+NGK9RCz755S6F/f1+X/gxeP+Wsedv+vF8/54aSPJYFjIQd624MDz/UDLQnr8HU3ztKHRf8Qeno1vyAQJBaLcMtTV3cvgP56COCqd/QP9xLgBkH4BxO13n4hNUDtACC6G1S3zqooZ6Ba4lp/zcAFb7iERKQwQcF39IFJjdXECGADw0IE4gg674pYAnk4HoHPx54tD5daO5vxrugSkMjgiiqc7TVKAT6AT8R4ckbHEQCYR/IZBxJgA+XZjsR7vaoRpIxWqeqfXuGC2CxwudicwePEB1kNkaZCuwyF0DuKv/4sz9mzP/Qxdg3BDkBTMC8Q+loD6UGBzx0Kz6eAX/KArOQTlPHFoI4vVtf4rNuLrca9edRn4xBP7k8w+9AgZCgBfEUZWfEs8iFNZ3UO7TqmkjCO/rWdgco/yIqHcQWaC2EGTzgz5y/iXQAvyx3riyxxV/JeBriaGB9OrTA5g9/eokM+37GszqfA/UZk9iW5UnCtBqBl3XoNN6Ag/+zy6A5evPAp+TIFDn15gQw9rjrOzFX0s2JBVAxa/nP1a6AsNWYGjPNGPLTQgBsNUFvOA3Ht9o/rGDN0tWOCcxJGp+f7++kkP7PxcGv1+GjkaLt/fawpwwerQxBJNW4b+PJsYEgiAYYdEAGIlDNaAbRkIgK3ut0jKByp+8yz23X6GttmBmjwDvChgiYLP5V/zhH6/110sGcKo5CkggCngxnIPoPja0j2B+1BRkiYJiviaLJqghDI63G2nAgAxMCuDdnoD0wIQm+urMB3VuAwbBrFGgGgnhAFqg9+ujKsLxB3qGCQNEEtPinIQlAj4WgIw7/iXc9V/x/yUWFs2KH504bAh4aYWf4TrTLGTy9YbftyLeVOWNfYNyt/ji29mQnqMAltU3ioTtbX343yv/1u0YPUBz6zB702tQucnX0gWaFh6DgPdmhXaapGotw0SFz1qDiTMdd8h45HfcqCPRUhA3+NmKz1l9teCPaMd4urGaewRitNBDdahR5c3AfQmDCFT9vmtQEwqAYXX4XI2n23Z9B/Yb1FL+LWox6wHGbZSo6FR1LzyG+3hriSZvWT6jfXhl2cmQZJDrAbuYAqAHo1GA/EOgD8eGcU7A8eDvH4fQBuAhBL/Zp/vamPTrRENDGLTV/7E1WEPLDlP/PwzU4YhusIMUgfIPAr6Dhv5R4y2r8ldFwiFoYHnmr8TAHbhRQSZOctH598ZYhqt6wP7q/ouqe77RJxvzFYaji/z4vna4v5cUMDXqDAJ5ytktqtBDckyjvJg04hl16LB0xFfyMfD77PZjErGQRRjYIfSvoAXntks0ok8MsUC4KARWnYPlJBeIgLeFrUgDOHYCag0/XNAbWgRwQuLAsaQwIhC1g7+jCNKuT38JfnYSyTi+QQEwwHeT4/dWHYxJPxfOj5oAnRQqgU3YgGZSOaDyK3n/qkDYBKptzR3oD6B4fyRKjp2AzSl80YR/3P+/1vBjX18Jbu+YsrMRgbqPP8zrDLTAaupphfeZtyPs9BPztpLSBZjowF3woYRwBwOWaqbev15b7X4RWsiqYiY6ZkFEIoUwUA2OrkeEQE8HYNyD/rl3m88jCGgO/nPW3xy8x4Q/HBcM1dYg5q8N+B/SBSYhtD0EY1PRGLDoKIBHF3yLz4H/gSYQJRETgqeB2d4vC8L2NVnQn4PoVJJAcP0inahAfdXVI8CFszjRagCTtRdV7Sr895NBpRKXIT64RMFw/iw5eChhEvmmyUIH+k+Qu3cLzOAN6ILlFvgWnx3YWFDz0f38ze9GlfP6UQ3ojEY0gtqRIEbA5/WgQFhsEuIeL75uTzvqHktAWfj/OD6sQXssROcGiRgFn0QVkld7OznMDT7CJKzhMIqxW9B+LCOQdH4uyxIcE49VTSeLj0wKjzcp2oDXQA8YoDEGBLMW0BJw+eAxXejPV/IXd59/tp5rVyYXDw5BlRetSpQAcvgfOwVM8ObzBq/AQ2wX4lwkQV3vNhYFfn2LFgaoDU1ogqsfqGkJYmrj9Tr22KQwBLzbLuzDeA9yzyJjVRfwegWq0H+FThDPA6ZhZwX2M2Kh4waovCzAWJTzD/qY00c+6PM8coz08VNqglzx54LfHuTJK7z2rwX35ABLg1DzsZ7Qv7l/f2yXDlbf4C/irg0MJ0aCuD0wP74MrxfdFlX7tq+vtRdCpvt599EG9Yz3V+P+Oj/n4zLruZHcJ7oMt/MNp9eD6HEeFb6/TMfbWo85Pb79HJo8t3371/PuIAZqMvjPC34nVV6ZB4hEuA7AzA5cfU0y2n6ux89D/35/n2/vWY5Bf0qwf3tPLISO1Tap9qzFB6eap/beqI94NCCbGwgqOItY3CGl446CaQ8i2Q9g0AvmgJOnBoAA0gu17tsKtKS7D4udgCYERy2QIceCX/P7mBW+g/7D9S6Mn50CS0eAoQPDcBjopIA5+EcxEjLweRjXq0UbLIjcBxsGx2IZvlf0ATjz/6qypAmY7bhrk4ahsIis6ccXKHdueAfUgk+RWPCLh42c6zEeKyJpRTdRAOqBbl/Wq/uT+q+Fx3FoTIuCzc6+hN8j4veGjuAnhSE5gKnco3A3XwYlq2sq+lmP4yEOpqEoG0M+mGDYuYT0pKCFHgLHKt3T7T9p8GcWH+n1UwGa8X6kQt2x4CeqPexegT6o/Z4Cr313PHdgrsS2ZReLfpKIf+IMFnmVmwxQ9AhithYT73+p2s+JIVfrjwiHnpAZrSsr9CMstQXP1+1+510N/q8E/YoekMN9OMFvi5LvkRDsy9rgFCOoPdpgaQIWBZjf5KCSQszZJ1ivTvLokpen6tsJAVND0NFqb6GUGg2Im4Dyx9Pn7/0dm4pADAslJzTv+dKNrAPQ0wyySm7bj1RQgbAXsRa4R+mBJzpaQmHLmy0BLoL+Nh2ZRca8uUc6P37k97n451fvTieAE8BdZ2ItqFEK6oOJIYPsiU4woo140Oh+H/UC++gatHYcOFT+2y3AYvD1rM/fpxdUcsAi70c0OxAEP45X/hymE9XeoC0zfYhbcqfbhs09HpwnKMDR6g0mmYyKth/UcLl9ITGQ8N1S6s+gA1HvQCc2pluPvN2Br8SyZyfyxPP/VhCi1L1HWX2CQCuAE8TIq/sBYdANZmTIwqq0sb0HIzhhugBeUpBZLFyA8y+EErsBUYDZHYN9QAAooQwOws+uQlhdESSSqk5Qsh8LSYI6LDS1AbmOvLlRBqQIeITvM36+TP63VfE5hFClCTr9zEyVFwS3STQBy66DMHB+PJWIrfgGnYBx2dTboPa2X49GaBVlePA7CFx4iaGi4ns0aLVjMGvtPTDtmO4XEE8E5Kb/8qYai+NHl60LgAICcUCoJPVeiYG6Pxw/X9VFNVbFn9FNPzXoIRDTyzcpREYB5Fm1EQQn3KRi9wKApR8Tz48SwxnV3qM0q7ZhpdKvr0zfY+gO4oQf+EGPFYW/Xf5hwWsUgxiBbShGoGIx+D2eH1h2EeR3UQMH4zMaUKr4033nzkSkfQADelFbLOQCalxdxvN8mInhPas9bxtGJw29Fx3Y8429MAS0fL33Oeo7qFZeiToCC3B/VSNYuU0fgDnkhxGgMFdxiYEY7MYel+OHPH30IMeVFK1C79l+QdXVpFqHlMAXEf3EYDyfkkGdNvJ8f3RAXU0jpgM7jMNA5yCrtfzOicKG/M9bgEkEjqqPPDEcDfqVwGZv6zcO9avDfOhf4OmLFd9OLBHHdxp51HvOBlnAoQksYjASA1xnIhPsapTCPjbsGB2YevpPpgM73EYeSYIftgPgte6CWesVBB9QEgfnWYMgoeC8ql69bWoRIqYHvSIv/u26bj/jdqZ9KSGk74JRo6QS9PuTiSHm6Z62kLUGH0UO4rwWrhtRETkR4iKRdI8giJ2D2nUCMjsA0TXiVDb98NAf/rCMlajA9wesWHZrAe1dlwRyVI2jx4KkyUHSx7YDe6YD4tOC6XW01puEdAJwaEJzf1uATHi6ZlSCpBQscsh6C1xRcWEG4bCFeKcAVhVlDu54JQIkTT21hptIT/Afk0kMcS9BKfjBJozcDXCrtgbWXxbMAw3INQIxtQJPAGwXmYaBbYh4SCsuKwLOAQ5awKskCMmRg8P3xwlBfbosQaDqyZqBkyQe1CLQACoTgN4qbyHsPwkTiF2pYaj6MAXBmUosQHnUEYCsBL3MW39SNKMJ5PfoBsT33DVJCEbFnBCMOkHfvj6Xq8uw+dgRIhGgAiUqf5QgKDFyhe8nnYrlqn9sG1GoAfirubygX4H+8IM1CmQrMFAJ5ExzKIp54nPoVU2Auh6eBShDlTV4u5c4HE/fVvjFrsII0Ik6QX+Iq68jB19ziLoKC27FYe0gC+j1RSS+BgB7AvAM3m8HLdy5fV60C8RMVuhD1ieQB32MCCq0QPJuvuw5IHF/geMKwOPdpmsxBwVEfGEOgeincJqNmuSFIPhPq/xM81CWIIi+gCFBqDX3QPYd2OcCRo6GZBoA3AM+00aesAOQ7/2Pe/vBCXoguD4OBD1WfPwClzcui12AuH+gC0gEwW72KfjBCQRBr05D0IQc7N8PzOCMehPWK384MPVDJQim7yDdoiRTItzzFV/ZOX9sYFetP0fsQzb6O7wOoFjxk89YoQXv+BmSN+yYHYO+BsDRAXHhuJXsEFbdIEGZQWUkNVNzGA9NZUVBIQL7jASR0AclE4Pb7JN3BO72mG92+o8UG3nybj+mASh0FsLKn9GPxDrEcS2Au35BzHO1BksriIJdpqWjKR1wlpR4fN977rZqI+XbYjYDgVDpcYQalOYKMiuQbB3G6Pu/HlMbi9a0EMkksXtjvvXTfgMKAEZRN/i/O7yD8Da2S2Bdh3ICWfp8yuMkYl5a4df4vVWt4UF0yyqEnaT6swYyWB8/j111Y1ERS9oB0SLMtBGDEBD1PEHwtdjUEAHnqmoHU4wCDAoAS+lHwtu9eQLUAgmxVvAuMB9cELMV3m8EUtcBYYI9nkNIEEJYrQeUHfnzzRyC39j8CgSkir/E0P2odnAmAqDnDIhqrtV9BDNS2POjv/0pwKr6z1h/PMz3uf9ykFYq9TtoAXSwpz0HljdvBCVAPY6t7osv6gFhMpkX13rcfXQMIpuTsfTibkfOPRAC2meLRipI4mDPwMD5x+v3+Ey+qEfACwoUEkKQSMZxYJDz9R68PyP43yvo2aYf881rNQbZgRU/jp80QnW/hdXqJxMvCFxXQSNHpE8QiF4XI+wFfQcw7VL2Md7RRajsKgh2D+6SLAKPF356+/7yXYBTUgFy/38StUjFHweD+iiHh8/LV/i/TSvGk4L5x7F6AsIKbgb4C0YjgdGRIToGUx7cgS3JKP8pRcgak95BJGQbjaJdBYQ1qHYnYHL8F45QgHx2gLMQ2cDxBD/4SeR0LSDi5XzPQNjM4ySE/HGG6g+ugltLNSARn281BPtNO72eJLjdX4ITSEgpQvJYFEUg24f1qAYQNQdxx6Q/RcB85j9f+03zf2QV33IDPHegNgPABTfqFR8cZK9TA7/ll0EQbUUHW8Gr1d+MSadia+LRHwhunv87yWoJ3h/pRDwJAbDNQQFd2P2mH4kP/wDT/ZeN3CK3+ZjvgVpw4r20AMafb58j4N1UMknuj6iCx883PU9g2VHVH5JX2eEcPghSgRBCKPzK0Q3fknwPN0Hk0CyC0zBkz//7duEetgFjVtypASDI4CsknYJgYDhqsBxxy29+eyxrAZX75EEf8f+CkOcijMDDHx4ASYGGu8WHgPwpHJc0qOG8FgFTuVk0cRZVePFwHEIUEu8xSHoL5qWg4I7/HgOKXe2dcnu2SSdCGIDTA+AcxY1zYL6Q6AAFu+/1GvjKPSeEoJV3NiM4Dz9C6oWkEav+NWjPWXNOIkKgNTi2I8LeBgaZHJxqrC4oNXoB9pzzMws/OW3ghSyQJgjbygOVEDhoj4nHLld8HPD6UUMFVLIgKrTL7cFoBRLQgEdXIseZ2/HhFPKbk4d5tYWwwR0nIFQSD2P5gQhs6meVfB+Bkyz2fOIvX/zxqsSODuAGIOLtPNnmIPCrv6Kqvgz3q4tCwNl9lWYfnsdHj2HTgQw5IBHwULmfSu1jEV3gDFSxTBmqSEVqiYK2IkWcRiAkwV/cyW9YhqHXDw9dkNQAcO6HFNJT7oChfrPUYc3KY17zAd+evAwF2w5SCKLV4EuCEKsKfjBVWHu9Q9Arh4CoBqEMWYBsNX7YgKP/69uC3M7/mOOz232QT+ox4iCyJGEFP4oBHd+GVvXBwX35nqp7qeIbV6L6tdZub3ueJ+gBIKgC6S5gOQFxDoGr+Bv2nzqbknd7ph/EmXzO0o+kZdc/wqvQkAOUffVMzKtYgx5Vob1/+HAfCdzHSiXHenX35/2JTr3KZ9Ruj2lYiMhLIFoNyMq9hFroeYMTE0bSLbhb4l3YlFPa6hMd2jk8dmrDgdQCnC4/+ANFlYTB6ATlx2GDGXP1rvL+SnWHw+cJes5/rRWt4H2pw9GklD4uSMpwasIQiaYR92gIyFX5S8dtRZt/nCAH48VXW3hRE/HKOsGquj8EM85Q9cfeAV4XwNGAlmIFIwPYrfLKuxV476RRetzcdeAsRSZhiHizCKEIOHn3EMOWy5X4uIJnXX6sFiBFLaBm/THOQAkVJK9j6TKwiSDTBWpwHkSPQJX7U959uAkoaTUuug6oQCBz1Zlxm0OJSIoIw04M+7zCGuYiznCfHww9AN6Ir+HXA7lfn2oBSJ2FOOh8SzINfmcAyITq8JX/sOMPx6A9LeYtVfwgCBZhdu25OB9/XmWWNPUEPD5dUuJ68wd1AqD2+w1PI9KxE9BW5t3z/igdYGWiL7L+wPv9jgVY8f0ZcbCKCuLAHN+c5wa69Zpr0J9t2KnpAGzyiAIPiFalJ8/xXrrA6Y+/8NoDnWCPNwFJzf5DpVkHte8hx76P+HU1+HEytEeSEIzAsu5r6wPJGu6oLz8VrKofXLce+ywIHhNa/Dmw8LrptWXZ4NKZm4pr/QQ7Qk8ehMrPtAF7PQCD309QgRgRZMKgAbFREAfBBXNalbHA9cEHMo4IgIUuPjjBWEUFEQpYTkhVO43eRiynJw9Jjj8TOUIlJExK+0wA4gWgQvcFBHAc7P4/u78/Ff4CC5ATB3P3oUwFClYgcALcxzp/B9Ez4DUV8RjBbsCBrMH4dLNwIDaCGhA6o3pXksdBvYBsktrXDgNJKAFy1Z+ZGIy5NXgXoBT8a3ZgVSPIUAMV6DjLxhsV8wX4n4ibbONObHNyCr8Z4FinNFjg8ziiF5zSV8A99u7Zdf5OisvVaAAAG3VJREFU/kIPAJLWX3hUIFD6o7MD4WkHIMXBk4IftSrPNBJVk0OoC7ice8HGS8XBKDoz/YFBLaQi392lGpCMJfhD9xVkx5Xbj73P9V4m1j0v73x9FjDDPlYvATkgFAVWcdNvJBamliOjAwRV0EpeRymAe717kMYRyy/j5FwFBX0fP7Dyx8gq8wn2ZXi8GfGYR+lFcGJSxa3Y84WgzBHetlU4cvKY44Ps4iP9fsgsPGEhQTAcHqwwGCj61SoPexKwasXFqtxq8qhD9SixoBBYcJEDNzmIoi3J7QkoJActVHocTVpPBCDhElAvMDK1PT/Sq3DwB/ygmyB9GNhYDH4so4Foy48kkPtZfZEv1PQTxYpyX0EI3Bu+/5krcN8fgwVdwWu2JNVNWAk+PcOOPMNdGFyAZ5Aj6gicgzNfwuHZg0HrLxBWfjSRl88fVCo/apX/IBrIvf65ZxtEoK9Bec4KZIPLe76osQns46NwW0pUPCPAyMc4A/KXOwZzFLGbAqD5xhhbgBcWfoJBAlarcCSQgdQJ+Movnih4gjZQTw51rz588y/ZgxVUEAQ8soCfX8OR26JwujCLGFAMsOjnwGrlPuQw9D/PPv8BYVR7pG/eeFtQpsLzR2KFI8SwKj9KlX++HeLOPuSBKrKeHBi7L4b+Kx184+ptAp4Trcscv69oARVYzWgaK01H1X0K3zNSmARKtxXYHvwJuT+8gLGGWgpHcWOmBeljFB2Ckg6wiAYOqfxEK3GMCAj6kIiTWdCBCXhkjUKMgJcLk271N9uLSbtvvK0S69OXAvoA5z94VsFubbmZvx4QAnXgBnJxENyQjy38wef81uPhxMpPJIQzr5ckuUTKe0wZyN57iFTWga8GvCwlh5UqvYgmaNV9XSxEVWs40kkosFwA70RgNOu8mLZfR6wDiwRa35y7j08NksqPQhcfkRBK/J8R75Iz+9C8gJpqzwiIeZII3QnYOkJWbVEI5jNuA+o2BwK82ifwnpSgHwaC+GNAdmW2VXfC+vPu6wR6lBj84C9WfvivZyUhZMJlJhjSukDlFJ3g4AvGJfC1iEpQJ/CaEd7G9wds7p71+odruKrHip/C7RdsxeVjzIxhoNkFGOW/+sk/YVAGtltfzZAIfzix8gcHhZCXpcGN2u69qWqD9OlRFAy7x2fQBhHUiETB+DocqvArYt98f+AEAXApsEmEcNLC0t2uPHCqPQIXwHYDfI4/9+8LMpchqr5HK39MJSrBXwnutNqjovjHFdq+fcHLp7YLR4mGgduW5hFpAXUoL4cTTuW5HJSkB5PC0S7A+8c+837DyoM1J9iv/po/o3BunlDqPjOSO/YbLFd+FGy9sxKFeT8b+nLNPrkAyD53FtT27yUS32yqUaEGTMBiASGcZ0FmK8nWxbvjC1q6WQC4VdWdAcBY8eFoAzIrC0b7Wt8wlPcIdE1FhUWeKU1Igv8Q/0dl4k/NnYSxdlDon8diUDeuQB4c8XVzcahRgyyZmNC+LAgeCfSVALde8/t1DCYawNoePGT83wlOpFUdOZKwxn89OsMEf0X8CxJCBN/dwKbFwkSMgx0ACJJDJD4iC1JEYh6XcEqVHpx4+J4I4UiAl26r5x64sttvSlAn3LBuQCz6edU8C+J5epBrC4YP52EFDgHrCw1B0eU9bOaTgh3wmYvQV3Oqqcf53XnVNXUBELX1xtSgFrirlII5d3HFulxBCNEfZx0h7K2f34XwdHpuYQcguN189Ow/nPXclaUcqMH5leCXjKOjbv3F0a7i2ZaRHmBe5zwnhA9S736ZC8AH8LHkg/T5znYgmES1dtuzGo92qwHIquiWX+4KgVLd8utv9Ml1BQNhEJW/FOgweiTguCUoQHkEwYhjfQIgm8eAzPKzHqAG5xGiiPyxeGRRaYetUpDVpHVC1T9bHGyaknb/TQTnuG7rDYwYCUT7/cMjtILzA+Go/FPw581F/mWeTkDuBsBCAK8ki+A29nMzPn4Rzjv6QV7xWW4fzQFUxb9jQQ1qc28kMi4mDl1NBr4usIsz5ltZqNm7AeJXfuTHd7nioLEyPBISU+8/tP1AC4Il/n+YGmjg2NiBRdl6yCw//zG5ph7bqaBuz8B4VMU/TqSsNPbwCeZA1cdxyG9SgKzRZPL+GXFOiH1/SFZ9wX8M3zUgvH8a4rMBjZj/h1W9MrwTiN6MlsCKiI4gycBzgV/xUaQGjGDHwHiYi0VIzeEAasCpNuL76AC7BIEl7i4AIxnAfoMxk35eJbZ68wWEUChs8IPz/EEE9BkUoNA4RCWSLJkY1h0Y/dG9bVCtUVPe7QRhtStXG4nOECDfUxc4Uw/Ik8JkA9o9+a83IrfHH11EdFUWc4phNgVFWkPsIHBnCvCCYBSgqEN9qtoXuwHhByYoJJA7BxIkkRwpDGgAHo+vQ3ZGOwCFJCJKUAx4MBpFZWvReeLgtBBkDDQu2OJxXa7SE/P4ZiUPHABjY1DsFIhPAaygWewiXK72hHjow/k8gCL6gKES8qcDZ7A+EhYlWCPGCX1wXIwzkQEKt8cP6iqkC0FEhFj/ZYtvXCtwuBLcDT5wXN+9H6ZEIkTwV/x/s78fXFX3siWHEKrC3tw7EFZ31Ll7ttknQyEMGgAqCaVe1bGk8r8nFWCQQR0h7CY0dsU/mIeIuA1AGCo02Q0YVXxub36sG1Qgfo0CBBUXxap+ECFEycQVyViBEBFPt14TK9rZHB9EwMG7DPXOv0OVHkdtx7OSCXfb3av4CFZGTwQBwT7/hKPHE4PzpJ4L4+FM9r1n8B+B+9R9I4Fu9brYUZgCunZWNxdQgIs8mASBQ4F8hJpEiaf4GPihk8FdAxin/kybjZjTj+mAQy6ihZ9whDvHAWB6BKrBXQr+5SBfqPaINwiz12UIwoTmbPACZY/fshBBBKNlW8ZCHwH/cVKSOZMm4Mxk4OwE9JeB+EFkn1IzcPQoiSB4vGgNeJSoik1A7m0TCmE/HrggB+/1M12C1Z18ACGoIeH1pH2IhAqFWgBq+kDFEWAvA3X8tpW0cnSD5WAOriOHhnYraF1eLTkS8P/QsHUBdtMPnOrMaANJE9AZiaKWII5Ue/8PTHn/UcCSTgIF2xN4zdmAQYIAKeBFl6FiO0aKfq5jcImHfPwTxcEdRmD3LcFoAva1Hdjm9UgGggI9YOoPkOBYLsT8HlG3nucMDGkOOJ8CkNOELdSO7D5qqAeJYBb2GpABgRi2gxLITgrOQ9C937HgB+0i7MeRx3gfPWCXLtgbLJAu/gCFBPzRX8eADJqCvA3FViC/BlOQC4LZyrBq8BdQAOUKoKjqR7v7EFfVFMojPgEoSlJesNIePyLHwW9NRgq7E6HvUN8A0yj0wyWDHRZ3J2A1jHdMyu3hCGwSDwdRir7h9VP7AKLgPoMCgKziOFLtrUm8aIFHlgxYfz8WBYUU55iAXauo+evJaIK/NTgRJM9sUcZRzcCnMdNKMJc7usnAyrpxHYkTRHK+n1HxS01LheAHqRWwKIDqLvQC0+PupHZgBawfVGsiniTVHwZHRqbUI/D4Cd+ftgyLAR1ehkIiqaKFw7MJEwUIuK5zsu4svoFYCFKgBJZACBuppOId2RDkPZas8H9kULcA9a0KTCQDGtpnzT+RMJiOGseHl4BQ1C29AWUXIIf/OIwwqoNEK3SCuA7FRiBrE9B4/PcrGJ1OQNj83F4Xbol/TgVHfMiIZLAdcaVkgh8sLrd+liNQH/FqsNTfj15m1J0X+ffZuq/gTY7QnvIfJz6UzBJLs83ItQpt3RfZz5iuGfNPajpngUm0R8DoA5jDlzsOTAwZjzsC3Jjxg7H914PjlcskGdghgx9HG4OOQH34uwQyzz61/0qiYNQjXxECuWYbGM/DrjtPH/Mw/K+gBLLSA+cEfPr4MroArzcDuybbr8Zc72i2UnzeHnTgzD4Ug78SzIvCoARVOQxaFFR3TzWnkkHUVFShEuqKxZnKz4p4YYcf8ZhYhuu8wFgSHcuuwCJagI4bgchJQK/qe9c/RT6nGcg6KGREJpb+MI0EY/b0jcsni3AJBeCQNsBOFVYoApcM2Aom4VFgIRdHpeIG8D3YaxBD+qCiQ+rBOSVnci8hzkAG1t/pgHA4uwDzmu8xFKkkkIqCfkIRs204r/hiDgutoAAcowBMZ9+KS0CcXVBOHCvJw2jMQSJyeoeExF2DuTuRcuWAo9sefyUQ6/oBaIjPtiRH1KvQKvygAHb171d+vc4GRMDPoxN/kL5pwlVh1mBQ1quQJAJ5j0TgOAis+h8d3mnC8xTKE34+8sDNjyVXE6nFMN+H39TQDmocHScENvN74LoGScGU4f7g6IG3n3C3qnG6JBS+Z5tHOOzRYQx+u7MZmAl0OSsRLAS/VIKfRAWU92+12aaVPksGDBWQuCMvgNy2M2Mt8EwqbjosZAec5xLEAmXmcFTHiOWARWglpNpjdEtBQRxJJU5VL5/7F1X86XntXgUK4q+KggsUoIIK8oA+kgy4+zLaACqQGTVOX6MBWdehL6BxHn+tlyBMDGAqufd7WOX5WTJwKYDfXJJP2GXDPk7Tj5Ed7BOG7DMFaBRAJgI/+H2Ngeb2SKb0zkoGlQBHkefDr7xMA5HZeJPtKIzyApI9gmnPgf1c3mulfhe0gFekDCdNFnrOwi4Gs6eTACNjB+Uegcgojog4V25P8bctRYY6RL8AJklE9ACFAGZdBEahd4d4CmghFhbzcwaXYH5qTlS6DY+KfNH5Avzjo2JJ0poDkSCMxLn73H/eB+ifvgvyIFCWAji7BWC8hd0qj0FziMdrS70BlVbgamIgcmotGZDNPwm0L9l5iHv7WRoAFx57ScFS2r2iwot8oKu8l+TOCOg2mZ2nFdjTgOFQENzKkJ8OjEnsE8f6AzyXwT6MNF3RDRnuj0Lwo6wTlBMDIyqaz6G+RiLJMg/KUrQV/rh9uH0tWduwoxmky0kSMQ+rnXxZsGadgnxfgk1pCnsIsGYltvfdzTOBIclIsN8MLAGcz5gBwj94AE8DuC9Molip/JGwB57nRyJiyD3pyk6q5ij+3TzRLohcqyqCEQBTepF15+WVmW8SEr5jMUUkx3oMIsrH3ndwAQganKzyMpOJNxMQooGBYwcByw7axIhgPRGEr6GSGJhkAELoQ1YRg+dPeD5IIRDIqq5PA2Jh0Rq0YcS8XBi0ghGRFpCtWTdum5+yLOsQf2EuYY8AfnbQZDgCjHxBSKwTGpt8QCIDVH3/4H5OwEvldhliINwAFLsEyyIfGKV+vm3eEehVqKTdNxtDiPoLHCRiuwTJxCECxMDqDjTvZ63KaPKvRgV2i/F3ohm88V8LN8hgJcXD5pVGIPPNn9EBqSQC0I4AMxBUcQNCkarkFgSn/oCs9GCVep4eUG5BRAOcQOCWlGSc3If0IFqRfURQGRrKewPKEJ9sLnIowKCcw+f48N6UHjqYtgInaCCkBbPSj8VEkCr2g8U43wY1xX/BNkwreQrzg+oaJghOCGTU8RBxuIp6VFOGoEXgEsBLIgV6gBgxoLSI5CgiYNT+GBHsU01GthrceiMUtv9KgAYktgVNeGrBbtiOQVi9x8WjiAW7UNUnm4Vet7WtsFgDCDYEwQ/EVL1PnQf/xCDLTowTh4c4HPRDoQaiwhKIAae4B7xgCBydI/CDPOrevK0FR4p6w3VfoXgQiB3T1N8Y1PCD0X19JqcHGfzB5WkQE4p/kdeXBcEVUXEIFqSij82lMyrWq/7c+LFHA7z5/dwOHHg8s/Y8C2CmhbmALtare+4UWLfb25BmXABKABTniC8gRAP2yvDAiUAsElnrxFzITQa/sAFecAOY7zPV/8jMQHSbWAiUPGkQNABhw85xrSCv+mMSzFR8+7mjw01A8f4F8S/td4jnDHYxpT8/OEyV3gz2+GTfdAeAszswfJNGlQhEIjB0Bls0BKn4Iw7WKu9f1gmSagmvqleEwJwnZwjO7npz1HdCJ1hS/mlBcRXyF3i/M7NxqJFoeH27z7nnJaBmpUZKHsTbGUc1ALEoIGsGYl9ixS50gjAT/VhB8IzvGTrBVfWEz1MzAkRFTtecW731VdjNQPukVdhdn0Y8d/a7WYH6i/TBPBzUFwAlHwtGHOQISrgb1AMUgDETTA3+THAdeRJhg59V/Ektofa9I8wxVICkC7QQSAd2O3cftzPzdMK6aA4iZI4ILfYRbb9RgqICt2AxVnYZ4kkBvHOBxT/zN9ybHx/f5Ql2fkGCX6ANm6F8WCfqAS+Eq5AGcHJd2IFHagTMHAAj+mWBnDXuc81CjhsAi5dL2K8QCYI1aJ/PJtSSxEFXASv7C2I3ZB9/a0j/7nDn/j1pHsz9Jr8fNpxPBUAUUYD4wz5GBlmyAiORjtAIGDFwzSUwqiNZ1d1tPiB7/Q9VeI9KeJU16/knkEeQJEALjY4rkp74fCZiMDSA/PgvT/aT2gYgp5E/P29AKBQAo6TRth5T4VesQFb0i4K7RA2MZpgyFXCEQHCOixuYMPgy2L7+45ezSSKt2oUkURlpXkEMOLSiXPuDQZjk63N5bmzOSxQdLHX7AhwUEA0BAeQPJIQzkAuFlOK/GtyLdiGDKEBdllQ7YouxV2Xdwza9So4Kp5Z0yAgUhTlJgFzSFrznIHYIwKcCu2/L3LsCg6UI1b1/CA+ApIV5/32HqOIjdQusE4azip5Wc1b0q/QGIAlaWEJbXP3r/L+AEipw/+BtkQVY9fIM2i/ZhgVEgJO6DZ1ksVtlYdoQAPhVO0oKmYBmnAYco4DRCRB3TwCziptaE0auER9/VzRqKNOEYINOQg2m1l9GpGNQAhh1v6UmxNQh2M4+LmlUzll0OTjYQOaGlZAEMCrdhmBphaMBwBADrSQQc3//He8KgFETT7p6BHnjj2X9EXsDjrgBS6ihoAmcSQVYmE4JgYWFpp1waAQRoqDzxDhU+HxSnZHz/9JEY6Y5MJA+cwoWrt99+U3Mc/9g/NQTFaigAEtwB1yBzwzucZSX7RZEILhR1d5GDCsBLVUdIQvsldZfEJt5i/MHx2hGJZFkVVyK242iFeh58oBUFqIQbkfp2DV2X0CkAYgv1sU+P+I/HmBu8nErugdRnUWhfp+A/ddlbEH3uQlBsNobUEMHasK1HOYn8BEEvCUaiuigXRIKj+sGOPA4KAWz9/s7WxcgB4+a6/fI2osEwv4yOENAiPf+wQhbc/5f0gGisWuQaRFmGoIqguARWsBQgTTocDLMT5OJUQnhqdCEig+/EShKSEgTVV0MBMnz04BcshPnLk/+OaV0/dwKzB4QUt1NB6uTDfGOP+cNm9mEsBAFiM7AQh9AKVEU75vy68jeOxrUC4mDEuYO0oLqoSdHaEF2eXYYSm0V+oEOwpLmYFOF3Z4CmAeBTIGueiIw2xoKPzDBJVBXQ5g5O8/twwA+QguIjJt3+g0NQEcDfUXgO5gsqlTBLkQLdl86K3CWneitQ8sg/5oWAUJP2C3V3RoEyji5n4b9lB4t9pz2CA+cAFn1Z9I/uzYsU/ELtEBOCHYQQqGcFejV+yeuRJX31zsKV5IGjway9z6PLDxKwNEPsBuOEiqw57jGgOtZ1Y++T50AuMFl7hPIbhskiOwsATtRoc7rS7dXrpcgrMCGJca6ELJo+Y0be0BW5ZKGcFz4y8W9BduwcDnK9iO5fagsKpp9ANnvDPxeP8THNyIVFo1AMas8Qk5v2Ytm0LCCYAXqn+wQsPTBh/5Bcnne14Os3uCQt28vsK1WUESJFviBgAW//3u9PLxusXchcCR2WsNzv/ImvgZzzkUByDUAIrjTvmSHAowpJBQE4SUlxMxnARlQbIqkArVAJ6pBBvELCCKlkyCDAP45BYfEPfcUpfMch3Vn4bheYK4E66BxAxHSVd5INgEPgU/NBCDfNQ8Ho1CoINAPQAW/QT8OCIZlNFCB84XhoDChFByHGjx35v9BLgyhmojqHYb5QYXnuAecvua0hZe6BV9f7v4ibvgvamrmAc1TmaEir0LQ9h97eYAYVoM/nWA60i8Q3Ifezha9BqaaL3zvqd6IAuwwLSCCuCLuJWch4h30giPtyiAphKEBcCu9BV5wwzkMxID8rhMwdwMhcSFgrBT3RUTQboAUg3+p+Qe1IGarOioVnazmefV3lHpwA0AcLWCahUiXwePHWJsP+GH1gnp/we5KfOhJAbsj0H/BIEb04TbrTPsAyb2LLu93KwfCvn5PLAwrOXAa72eEQRo1CNdw5IprsAZ3hApy9zlcITG2vpCihsRSYxNS+J4vdBZ6B52eqRcQ/QXmSjAWSfa/5GA5qEg4iJFtm624AqXLrSA2gx8p1Mdqcghv41S0lSp/xAYs9gakQc4Ie2RTUYwYgt748mV+FU1Xgp14eW3XYZ6cdqGTNHwHICTwEeTPl0jEZwIgP9gDEaogeg5IHWCF+1eoAhvEKPB/EAeTRsM/pSAP5wjWEUMM1/NJRhwJbpJSgK7S7zF3EOsI5jBQBK9DV80Z8Y0COzvmWzJXgDl40KEC6cqvqgi4OB5cpgLFYK/1CvDiItXqC6/S87wfAUfPtxqfGNzlYaOjlf1IsHPPvffHgDAoEeEST4ZLZUd/RSo91/BjXY5ggWgQ4In3fyj4mUqPrInHOCLKO3wUwRsfyXpt1nEIRLrqcWeTuk7bigsbid1zD4iDRQtnIdQsyIXnFCn1I9D7ADgxEhOvR5AJosoUbu1FkJyYCi9OhQERoIx+4AX/YqUXQhtYEwKN4Cy1HntLMmtaAQpqfrT/UCoLSxeswjA5UWPPi0mjajUWxMTdVusNvt/ChMdmILK5IRMFu90BMEzFYHdg2GAgeYVHMMJIBTA7EFTx/5fpgTFXz9w/en0ZjD8kCDoKPNGwlB01BmoWQbh+AxR689mBponGJOr9OwmMu3dtJ/ylW1Tik4ElUPmR9RqII+pVhD9ychABMQ51gOIZg+/G+5mGIzLB1JJC5WhzYjhJ7IWmLDpA8jzsAafUPkB2WnFBF4iSxkq1ty7f25rv/+EQLOxs2oUdTSA9HIR9swdBlCcFe9owPC3XWDDC0ISVzsEVbSCF/sWdA5Fu4HJqankp2SeQCYYrImNalfmhpVxYrGkUS4LeSUjg8dD7+D7w/ybIfy7vlB9/HJ978zr7/45Qgajzj+4EjIK/ULHPRAOlKr/aG0AFcqCyu0GcW45Igh6JMJmhA49/U+cEssHNJhtXDC1MOya3j/sAiAGcrEtqtgjBD6wEzSDc7D8o6C8rIqAZyPk+NQoNLAZ1hR64Yl1FBY648smUYKnSg1Xwk/0DyRyArByMUobyByhCcPnOaPyoegREFS4jNfYAw+IHCjdC1J2WDZBke/OyN85J24WiXwDYPoJyYuCD238ulvuzwt6KgHf0shWKsqCFFGjB/w8HU8eeTED9wAAAAABJRU5ErkJggg==","EnvironmentBRDFTexture"+z++,C,!0,!1,f.b.BILINEAR_SAMPLINGMODE);C._blockEntityCollection=x;const S=C.getEngine().getLoadedTexturesCache(),m=S.indexOf(s.getInternalTexture());-1!==m&&S.splice(m,1),s.isRGBD=!0,s.wrapU=f.b.CLAMP_ADDRESSMODE,s.wrapV=f.b.CLAMP_ADDRESSMODE,C.environmentBRDFTexture=s,C.useDelayedTextureLoading=M,T.b.ExpandRGBDTexture(s);const Q=C.getEngine().onContextRestoredObservable.add((()=>{s.isRGBD=!0;const M=C.onBeforeRenderObservable.add((()=>{s.isReady()&&(C.onBeforeRenderObservable.remove(M),T.b.ExpandRGBDTexture(s))}))}));C.Sd.add((()=>{C.getEngine().onContextRestoredObservable.remove(Q)}))}return C.environmentBRDFTexture}},11718:(C,M,x)=>{"use strict";function f(C,M,x){try{const f=C.next();f.done?M(f):f.value?f.value.then((()=>{f.value=void 0,M(f)}),x):M(f)}catch(f){x(f)}}function T(){let C,M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:25;return(x,T,z)=>{const s=performance.now();void 0===C||s-C>M?(C=s,setTimeout((()=>{f(x,T,z)}),0)):f(x,T,z)}}function z(C,M,x,f,T){const z=()=>{let s;const S=C=>{C.done?x(C.value):void 0===s?s=!0:z()};do{s=void 0,T&&T.aborted?f(new Error("Aborted")):M(C,S,f),void 0===s&&(s=!1)}while(s)};z()}function s(C,M){let x;return z(C,f,(C=>x=C),(C=>{throw C}),M),x}function S(C,M,x){return new Promise(((f,T)=>{z(C,M,f,T,x)}))}function m(C,M){return function(){return s(C(...arguments),M)}}x.d(M,{c:()=>T,e:()=>m,f:()=>S,i:()=>s})},10697:(C,M,x)=>{"use strict";x.d(M,{d:()=>T});class f{constructor(C){this._pendingActions=new Array,this._workerInfos=C.map((C=>({workerPromise:Promise.resolve(C),idle:!0})))}dispose(){for(const C of this._workerInfos)C.workerPromise.then((C=>{C.terminate()}));this._workerInfos.length=0,this._pendingActions.length=0}push(C){this._executeOnIdleWorker(C)||this._pendingActions.push(C)}_executeOnIdleWorker(C){for(const M of this._workerInfos)if(M.idle)return this._execute(M,C),!0;return!1}_execute(C,M){C.idle=!1,C.workerPromise.then((x=>{M(x,(()=>{const M=this._pendingActions.shift();M?this._execute(C,M):C.idle=!0}))}))}}class T extends f{constructor(C,M){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:T.DefaultOptions;super([]),this._maxWorkers=C,this._createWorkerAsync=M,this._options=x}push(C){if(!this._executeOnIdleWorker(C))if(this._workerInfos.length<this._maxWorkers){const M={workerPromise:this._createWorkerAsync(),idle:!1};this._workerInfos.push(M),this._execute(M,C)}else this._pendingActions.push(C)}_execute(C,M){C.timeoutId&&(clearTimeout(C.timeoutId),delete C.timeoutId),super._execute(C,((x,f)=>{M(x,(()=>{f(),C.idle&&(C.timeoutId=setTimeout((()=>{C.workerPromise.then((C=>{C.terminate()}));const M=this._workerInfos.indexOf(C);-1!==M&&this._workerInfos.splice(M,1)}),this._options.idleTimeElapsedBeforeRelease))}))}))}}T.DefaultOptions={idleTimeElapsedBeforeRelease:1e3}},11862:(C,M,x)=>{"use strict";x.d(M,{e:()=>LC});var f=x(978),T=x(1343);class z extends T.d{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var s=x(1162),S=(x(1413),x(997));class m{get noiseTexture(){return this._noiseTexture}set noiseTexture(C){this._noiseTexture!==C&&(this._noiseTexture=C,this._reset())}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(C){this._isAnimationSheetEnabled!=C&&(this._isAnimationSheetEnabled=C,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(C){this._useLogarithmicDepth=C&&this.va().getEngine().getCaps().fragmentDepthSupported}va(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:f.m.Zero()}set direction1(C){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=C)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:f.m.Zero()}set direction2(C){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=C)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:f.m.Zero()}set minEmitBox(C){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=C)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:f.m.Zero()}set maxEmitBox(C){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=C)}get billboardMode(){return this._billboardMode}set billboardMode(C){this._billboardMode!==C&&(this._billboardMode=C,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(C){this._isBillboardBased!==C&&(this._isBillboardBased=C,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(C){this._attachImageProcessingConfiguration(C)}_attachImageProcessingConfiguration(C){C!==this._imageProcessingConfiguration&&(!C&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=C)}_reset(){}_removeGradientAndTexture(C,M,x){if(!M)return this;let f=0;for(const T of M){if(T.gradient===C){M.splice(f,1);break}f++}return x&&x.dispose(),this}constructor(C){this.animations=[],this.renderingGroupId=0,this.k=f.m.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this.targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new f.m(10,10,10),this.onAnimationEnd=null,this.blendMode=m.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new f.j(0,0),this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.Gg=new f.m(0,0,0),this._useLogarithmicDepth=!1,this.gravity=f.m.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new s.e(1,1,1,1),this.color2=new s.e(1,1,1,1),this.colorDead=new s.e(0,0,0,1),this.textureMask=new s.e(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new z,this.id=C,this.name=C}createPointEmitter(C,M){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new f.m(0,1,0),arguments.length>2&&void 0!==arguments[2]||new f.m(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new f.m(0,1,0),arguments.length>4&&void 0!==arguments[4]||new f.m(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new f.m(0,1,0),arguments.length>3&&void 0!==arguments[3]||new f.m(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(C,M,x,f){throw new Error("Method not implemented.")}}m.BLENDMODE_ONEONE=0,m.BLENDMODE_STANDARD=1,m.BLENDMODE_ADD=2,m.BLENDMODE_MULTIPLY=3,m.BLENDMODE_MULTIPLYADD=4,(0,S.f)("BABYLON.BaseParticleSystem",m);var Q=x(1015),V=x(1196);class y{constructor(){this.direction1=new f.m(0,1,0),this.direction2=new f.m(0,1,0),this.minEmitBox=new f.m(-.5,-.5,-.5),this.maxEmitBox=new f.m(.5,.5,.5)}startDirectionFunction(C,M,x,T){const z=(0,Q.v)(this.direction1.x,this.direction2.x),s=(0,Q.v)(this.direction1.y,this.direction2.y),S=(0,Q.v)(this.direction1.z,this.direction2.z);if(T)return M.x=z,M.y=s,void(M.z=S);f.m.TransformNormalFromFloatsToRef(z,s,S,C,M)}startPositionFunction(C,M,x,T){const z=(0,Q.v)(this.minEmitBox.x,this.maxEmitBox.x),s=(0,Q.v)(this.minEmitBox.y,this.maxEmitBox.y),S=(0,Q.v)(this.minEmitBox.z,this.maxEmitBox.z);if(T)return M.x=z,M.y=s,void(M.z=S);f.m.TransformCoordinatesFromFloatsToRef(z,s,S,C,M)}clone(){const C=new y;return V.d.DeepCopy(this,C),C}applyToShader(C){C.setVector3("direction1",this.direction1),C.setVector3("direction2",this.direction2),C.setVector3("minEmitBox",this.minEmitBox),C.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(C){C.addUniform("direction1",3),C.addUniform("direction2",3),C.addUniform("minEmitBox",3),C.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const C={};return C.type=this.getClassName(),C.direction1=this.direction1.Gd(),C.direction2=this.direction2.Gd(),C.minEmitBox=this.minEmitBox.Gd(),C.maxEmitBox=this.maxEmitBox.Gd(),C}parse(C){f.m.FromArrayToRef(C.direction1,0,this.direction1),f.m.FromArrayToRef(C.direction2,0,this.direction2),f.m.FromArrayToRef(C.minEmitBox,0,this.minEmitBox),f.m.FromArrayToRef(C.maxEmitBox,0,this.maxEmitBox)}}class U{get i(){return this._radius}set i(C){this._radius=C,this._buildHeight()}get angle(){return this._angle}set angle(C){this._angle=C,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=x,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=M,this.i=C}startDirectionFunction(C,M,x,T){T?f.i.Md[0].p(x.Jg).normalize():x.position.subtractToRef(C.getTranslation(),f.i.Md[0]).normalize();const z=(0,Q.v)(0,this.directionRandomizer),s=(0,Q.v)(0,this.directionRandomizer),S=(0,Q.v)(0,this.directionRandomizer);M.x=f.i.Md[0].x+z,M.y=f.i.Md[0].y+s,M.z=f.i.Md[0].z+S,M.normalize()}startPositionFunction(C,M,x,T){const z=(0,Q.v)(0,2*Math.PI);let s;this.emitFromSpawnPointOnly?s=1e-4:(s=(0,Q.v)(0,this.heightRange),s=1-s*s);let S=this._radius-(0,Q.v)(0,this._radius*this.radiusRange);S*=s;const m=S*Math.sin(z),V=S*Math.cos(z),y=s*this._height;if(T)return M.x=m,M.y=y,void(M.z=V);f.m.TransformCoordinatesFromFloatsToRef(m,y,V,C,M)}clone(){const C=new U(this._radius,this._angle,this.directionRandomizer);return V.d.DeepCopy(this,C),C}applyToShader(C){C.setFloat2("i",this._radius,this.radiusRange),C.setFloat("coneAngle",this._angle),C.setFloat2("height",this._height,this.heightRange),C.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(C){C.addUniform("i",2),C.addUniform("coneAngle",1),C.addUniform("height",2),C.addUniform("directionRandomizer",1)}getEffectDefines(){let C="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(C+="\n#define CONEEMITTERSPAWNPOINT"),C}getClassName(){return"ConeParticleEmitter"}serialize(){const C={};return C.type=this.getClassName(),C.i=this._radius,C.angle=this._angle,C.directionRandomizer=this.directionRandomizer,C.radiusRange=this.radiusRange,C.heightRange=this.heightRange,C.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,C}parse(C){this.i=C.i,this.angle=C.angle,this.directionRandomizer=C.directionRandomizer,this.radiusRange=void 0!==C.radiusRange?C.radiusRange:1,this.heightRange=void 0!==C.radiusRange?C.heightRange:1,this.emitFromSpawnPointOnly=void 0!==C.emitFromSpawnPointOnly&&C.emitFromSpawnPointOnly}}class O extends U{constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new f.m(0,1,0),T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new f.m(0,1,0);super(C,M),this.direction1=x,this.direction2=T}startDirectionFunction(C,M){const x=(0,Q.v)(this.direction1.x,this.direction2.x),T=(0,Q.v)(this.direction1.y,this.direction2.y),z=(0,Q.v)(this.direction1.z,this.direction2.z);f.m.TransformNormalFromFloatsToRef(x,T,z,C,M)}clone(){const C=new O(this.i,this.angle,this.direction1,this.direction2);return V.d.DeepCopy(this,C),C}applyToShader(C){C.setFloat("i",this.i),C.setFloat("radiusRange",this.radiusRange),C.setVector3("direction1",this.direction1),C.setVector3("direction2",this.direction2)}buildUniformLayout(C){C.addUniform("i",1),C.addUniform("radiusRange",1),C.addUniform("direction1",3),C.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const C=super.serialize();return C.direction1=this.direction1.Gd(),C.direction2=this.direction2.Gd(),C}parse(C){super.parse(C),this.direction1.p(C.direction1),this.direction2.p(C.direction2)}}class d{constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.i=C,this.height=M,this.radiusRange=x,this.directionRandomizer=T,this._tempVector=f.m.Zero()}startDirectionFunction(C,M,x,T,z){x.position.subtractToRef(C.getTranslation(),this._tempVector),this._tempVector.normalize(),f.m.TransformNormalToRef(this._tempVector,z,this._tempVector);const s=(0,Q.v)(-this.directionRandomizer/2,this.directionRandomizer/2);let S=Math.atan2(this._tempVector.x,this._tempVector.z);S+=(0,Q.v)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=s,this._tempVector.x=Math.sin(S),this._tempVector.z=Math.cos(S),this._tempVector.normalize(),T?M.p(this._tempVector):f.m.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,C,M)}startPositionFunction(C,M,x,T){const z=(0,Q.v)(-this.height/2,this.height/2),s=(0,Q.v)(0,2*Math.PI),S=(0,Q.v)((1-this.radiusRange)*(1-this.radiusRange),1),m=Math.sqrt(S)*this.i,V=m*Math.cos(s),y=m*Math.sin(s);T?M.Hd(V,z,y):f.m.TransformCoordinatesFromFloatsToRef(V,z,y,C,M)}clone(){const C=new d(this.i,this.directionRandomizer);return V.d.DeepCopy(this,C),C}applyToShader(C){C.setFloat("i",this.i),C.setFloat("height",this.height),C.setFloat("radiusRange",this.radiusRange),C.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(C){C.addUniform("i",1),C.addUniform("height",1),C.addUniform("radiusRange",1),C.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const C={};return C.type=this.getClassName(),C.i=this.i,C.height=this.height,C.radiusRange=this.radiusRange,C.directionRandomizer=this.directionRandomizer,C}parse(C){this.i=C.i,this.height=C.height,this.radiusRange=C.radiusRange,this.directionRandomizer=C.directionRandomizer}}class D extends d{constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new f.m(0,1,0),z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new f.m(0,1,0);super(C,M,x),this.direction1=T,this.direction2=z}startDirectionFunction(C,M,x,T){const z=(0,Q.v)(this.direction1.x,this.direction2.x),s=(0,Q.v)(this.direction1.y,this.direction2.y),S=(0,Q.v)(this.direction1.z,this.direction2.z);T?M.Hd(z,s,S):f.m.TransformNormalFromFloatsToRef(z,s,S,C,M)}clone(){const C=new D(this.i,this.height,this.radiusRange,this.direction1,this.direction2);return V.d.DeepCopy(this,C),C}applyToShader(C){C.setFloat("i",this.i),C.setFloat("height",this.height),C.setFloat("radiusRange",this.radiusRange),C.setVector3("direction1",this.direction1),C.setVector3("direction2",this.direction2)}buildUniformLayout(C){C.addUniform("i",1),C.addUniform("height",1),C.addUniform("radiusRange",1),C.addUniform("direction1",3),C.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const C=super.serialize();return C.direction1=this.direction1.Gd(),C.direction2=this.direction2.Gd(),C}parse(C){super.parse(C),f.m.FromArrayToRef(C.direction1,0,this.direction1),f.m.FromArrayToRef(C.direction2,0,this.direction2)}}class o{constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.i=C,this.radiusRange=M,this.directionRandomizer=x}startDirectionFunction(C,M,x,T){const z=x.position.rc(C.getTranslation()).normalize(),s=(0,Q.v)(0,this.directionRandomizer),S=(0,Q.v)(0,this.directionRandomizer),m=(0,Q.v)(0,this.directionRandomizer);z.x+=s,z.y+=S,z.z+=m,z.normalize(),T?M.p(z):f.m.TransformNormalFromFloatsToRef(z.x,z.y,z.z,C,M)}startPositionFunction(C,M,x,T){const z=this.i-(0,Q.v)(0,this.i*this.radiusRange),s=(0,Q.v)(0,1),S=(0,Q.v)(0,2*Math.PI),m=Math.acos(2*s-1),V=z*Math.cos(S)*Math.sin(m),y=z*Math.cos(m),U=z*Math.sin(S)*Math.sin(m);T?M.Hd(V,Math.abs(y),U):f.m.TransformCoordinatesFromFloatsToRef(V,Math.abs(y),U,C,M)}clone(){const C=new o(this.i,this.directionRandomizer);return V.d.DeepCopy(this,C),C}applyToShader(C){C.setFloat("i",this.i),C.setFloat("radiusRange",this.radiusRange),C.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(C){C.addUniform("i",1),C.addUniform("radiusRange",1),C.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const C={};return C.type=this.getClassName(),C.i=this.i,C.radiusRange=this.radiusRange,C.directionRandomizer=this.directionRandomizer,C}parse(C){this.i=C.i,this.radiusRange=C.radiusRange,this.directionRandomizer=C.directionRandomizer}}class L{constructor(){this.direction1=new f.m(0,1,0),this.direction2=new f.m(0,1,0)}startDirectionFunction(C,M,x,T){const z=(0,Q.v)(this.direction1.x,this.direction2.x),s=(0,Q.v)(this.direction1.y,this.direction2.y),S=(0,Q.v)(this.direction1.z,this.direction2.z);T?M.Hd(z,s,S):f.m.TransformNormalFromFloatsToRef(z,s,S,C,M)}startPositionFunction(C,M,x,T){T?M.Hd(0,0,0):f.m.TransformCoordinatesFromFloatsToRef(0,0,0,C,M)}clone(){const C=new L;return V.d.DeepCopy(this,C),C}applyToShader(C){C.setVector3("direction1",this.direction1),C.setVector3("direction2",this.direction2)}buildUniformLayout(C){C.addUniform("direction1",3),C.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const C={};return C.type=this.getClassName(),C.direction1=this.direction1.Gd(),C.direction2=this.direction2.Gd(),C}parse(C){f.m.FromArrayToRef(C.direction1,0,this.direction1),f.m.FromArrayToRef(C.direction2,0,this.direction2)}}class t{constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.i=C,this.radiusRange=M,this.directionRandomizer=x}startDirectionFunction(C,M,x,T){const z=x.position.rc(C.getTranslation()).normalize(),s=(0,Q.v)(0,this.directionRandomizer),S=(0,Q.v)(0,this.directionRandomizer),m=(0,Q.v)(0,this.directionRandomizer);z.x+=s,z.y+=S,z.z+=m,z.normalize(),T?M.p(z):f.m.TransformNormalFromFloatsToRef(z.x,z.y,z.z,C,M)}startPositionFunction(C,M,x,T){const z=this.i-(0,Q.v)(0,this.i*this.radiusRange),s=(0,Q.v)(0,1),S=(0,Q.v)(0,2*Math.PI),m=Math.acos(2*s-1),V=z*Math.cos(S)*Math.sin(m),y=z*Math.cos(m),U=z*Math.sin(S)*Math.sin(m);T?M.Hd(V,y,U):f.m.TransformCoordinatesFromFloatsToRef(V,y,U,C,M)}clone(){const C=new t(this.i,this.directionRandomizer);return V.d.DeepCopy(this,C),C}applyToShader(C){C.setFloat("i",this.i),C.setFloat("radiusRange",this.radiusRange),C.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(C){C.addUniform("i",1),C.addUniform("radiusRange",1),C.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const C={};return C.type=this.getClassName(),C.i=this.i,C.radiusRange=this.radiusRange,C.directionRandomizer=this.directionRandomizer,C}parse(C){this.i=C.i,this.radiusRange=C.radiusRange,this.directionRandomizer=C.directionRandomizer}}class A extends t{constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new f.m(0,1,0),x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new f.m(0,1,0);super(C),this.direction1=M,this.direction2=x}startDirectionFunction(C,M){const x=(0,Q.v)(this.direction1.x,this.direction2.x),T=(0,Q.v)(this.direction1.y,this.direction2.y),z=(0,Q.v)(this.direction1.z,this.direction2.z);f.m.TransformNormalFromFloatsToRef(x,T,z,C,M)}clone(){const C=new A(this.i,this.direction1,this.direction2);return V.d.DeepCopy(this,C),C}applyToShader(C){C.setFloat("i",this.i),C.setFloat("radiusRange",this.radiusRange),C.setVector3("direction1",this.direction1),C.setVector3("direction2",this.direction2)}buildUniformLayout(C){C.addUniform("i",1),C.addUniform("radiusRange",1),C.addUniform("direction1",3),C.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const C=super.serialize();return C.direction1=this.direction1.Gd(),C.direction2=this.direction2.Gd(),C}parse(C){super.parse(C),this.direction1.p(C.direction1),this.direction2.p(C.direction2)}}class H{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{}}startDirectionFunction(C,M,x,T){const z=f.i.Md[0];if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,x,z);const C=f.i.Md[1];z.subtractToRef(x.position,C),C.scaleToRef(1/x.lifeTime,z)}else z.set(0,0,0);T?M.p(z):f.m.TransformNormalToRef(z,C,M)}startPositionFunction(C,M,x,T){const z=f.i.Md[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,x,z):z.set(0,0,0),T?M.p(z):f.m.TransformCoordinatesToRef(z,C,M)}clone(){const C=new H;return V.d.DeepCopy(this,C),C}applyToShader(C){}buildUniformLayout(C){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const C={};return C.type=this.getClassName(),C.particlePositionGenerator=this.particlePositionGenerator,C.particleDestinationGenerator=this.particleDestinationGenerator,C}parse(C){C.particlePositionGenerator&&(this.particlePositionGenerator=C.particlePositionGenerator),C.particleDestinationGenerator&&(this.particleDestinationGenerator=C.particleDestinationGenerator)}}var j=x(1224);class b{get mesh(){return this.Pe}set mesh(C){this.Pe!==C&&(this.Pe=C,C?(this._indices=C.Ge(),this._positions=C.getVerticesData(j.h.PositionKind),this._normals=C.getVerticesData(j.h.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=f.m.Zero(),this.Pe=null,this.direction1=new f.m(0,1,0),this.direction2=new f.m(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=C}startDirectionFunction(C,M,x,T){if(this.useMeshNormalsForDirection&&this._normals)return void f.m.TransformNormalToRef(this._storedNormal,C,M);const z=(0,Q.v)(this.direction1.x,this.direction2.x),s=(0,Q.v)(this.direction1.y,this.direction2.y),S=(0,Q.v)(this.direction1.z,this.direction2.z);T?M.Hd(z,s,S):f.m.TransformNormalFromFloatsToRef(z,s,S,C,M)}startPositionFunction(C,M,x,T){if(!this._indices||!this._positions)return;const z=3*Math.random()*(this._indices.length/3)|0,s=Math.random(),S=Math.random()*(1-s),m=1-s-S,Q=this._indices[z],V=this._indices[z+1],y=this._indices[z+2],U=f.i.Md[0],O=f.i.Md[1],d=f.i.Md[2],D=f.i.Md[3];f.m.FromArrayToRef(this._positions,3*Q,U),f.m.FromArrayToRef(this._positions,3*V,O),f.m.FromArrayToRef(this._positions,3*y,d),D.x=s*U.x+S*O.x+m*d.x,D.y=s*U.y+S*O.y+m*d.y,D.z=s*U.z+S*O.z+m*d.z,T?M.Hd(D.x,D.y,D.z):f.m.TransformCoordinatesFromFloatsToRef(D.x,D.y,D.z,C,M),this.useMeshNormalsForDirection&&this._normals&&(f.m.FromArrayToRef(this._normals,3*Q,U),f.m.FromArrayToRef(this._normals,3*V,O),f.m.FromArrayToRef(this._normals,3*y,d),this._storedNormal.x=s*U.x+S*O.x+m*d.x,this._storedNormal.y=s*U.y+S*O.y+m*d.y,this._storedNormal.z=s*U.z+S*O.z+m*d.z)}clone(){const C=new b(this.mesh);return V.d.DeepCopy(this,C),C}applyToShader(C){C.setVector3("direction1",this.direction1),C.setVector3("direction2",this.direction2)}buildUniformLayout(C){C.addUniform("direction1",3),C.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var C;const M={};return M.type=this.getClassName(),M.direction1=this.direction1.Gd(),M.direction2=this.direction2.Gd(),M.meshId=null===(C=this.mesh)||void 0===C?void 0:C.id,M.useMeshNormalsForDirection=this.useMeshNormalsForDirection,M}parse(C,M){f.m.FromArrayToRef(C.direction1,0,this.direction1),f.m.FromArrayToRef(C.direction2,0,this.direction2),C.meshId&&M&&(this.mesh=M.getLastMeshById(C.meshId)),this.useMeshNormalsForDirection=C.useMeshNormalsForDirection}}var R=x(1090);class n{_isUbo(C){return void 0!==C.addUniform}constructor(C){this._isUbo(C)?(this.setMatrix3x3=C.updateMatrix3x3.bind(C),this.setMatrix2x2=C.updateMatrix2x2.bind(C),this.setFloat=C.updateFloat.bind(C),this.setFloat2=C.updateFloat2.bind(C),this.setFloat3=C.updateFloat3.bind(C),this.setFloat4=C.updateFloat4.bind(C),this.setFloatArray=C.updateFloatArray.bind(C),this.setArray=C.updateArray.bind(C),this.setIntArray=C.updateIntArray.bind(C),this.setMatrix=C.ee.bind(C),this.setMatrices=C.updateMatrices.bind(C),this.setVector3=C.updateVector3.bind(C),this.setVector4=C.updateVector4.bind(C),this.setColor3=C.updateColor3.bind(C),this.setColor4=C.updateColor4.bind(C),this.setDirectColor4=C.updateDirectColor4.bind(C),this.setInt=C.updateInt.bind(C),this.setInt2=C.updateInt2.bind(C),this.setInt3=C.updateInt3.bind(C),this.setInt4=C.updateInt4.bind(C)):(this.setMatrix3x3=C.setMatrix3x3.bind(C),this.setMatrix2x2=C.setMatrix2x2.bind(C),this.setFloat=C.setFloat.bind(C),this.setFloat2=C.setFloat2.bind(C),this.setFloat3=C.setFloat3.bind(C),this.setFloat4=C.setFloat4.bind(C),this.setFloatArray=C.setFloatArray.bind(C),this.setArray=C.setArray.bind(C),this.setIntArray=C.setIntArray.bind(C),this.setMatrix=C.setMatrix.bind(C),this.setMatrices=C.setMatrices.bind(C),this.setVector3=C.setVector3.bind(C),this.setVector4=C.setVector4.bind(C),this.setColor3=C.setColor3.bind(C),this.setColor4=C.setColor4.bind(C),this.setDirectColor4=C.setDirectColor4.bind(C),this.setInt=C.setInt.bind(C),this.setInt2=C.setInt2.bind(C),this.setInt3=C.setInt3.bind(C),this.setInt4=C.setInt4.bind(C))}}var I=x(1098);const X="gpuUpdateParticlesPixelShader",g="#version 300 es\nvoid main() {discard;}\n";I.d.ShadersStore[X]=g;const B="gpuUpdateParticlesVertexShader",F="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";I.d.ShadersStore[B]=F;(0,S.f)("BABYLON.WebGL2ParticleSystem",class{constructor(C,M){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=C,this._engine=M,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","i","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var C;return(null===(C=this._updateEffect)||void 0===C?void 0:C.isReady())??!1}createUpdateBuffer(C){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof H&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=C,this._updateEffect=new R.e("gpuUpdateParticles",this._updateEffectOptions,this._engine),new n(this._updateEffect)}createVertexBuffers(C,M){this._updateVAO.push(this._createUpdateVAO(C)),this._renderVAO.push(this._engine.recordVertexArrayObject(M,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=M}createParticleBuffer(C){return C}bindDrawBuffers(C,M,x){x?this._engine.bindBuffers(this._renderVertexBuffers,x,M):this._engine.bindVertexArrayObject(this._renderVAO[C],null)}preUpdateParticleBuffer(){const C=this._engine;if(this._engine.enableEffect(this._updateEffect),!C.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(C,M,x){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[C],null);const f=this._engine;f.bindTransformFeedbackBuffer(M.getBuffer()),f.setRasterizerState(!1),f.beginTransformFeedback(!0),f.drawArraysType(3,0,x),f.endTransformFeedback(),f.setRasterizerState(!0),f.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let C=0;C<this._updateVAO.length;C++)this._engine.releaseVertexArrayObject(this._updateVAO[C]);this._updateVAO.length=0;for(let C=0;C<this._renderVAO.length;C++)this._engine.releaseVertexArrayObject(this._renderVAO[C]);this._renderVAO.length=0}_createUpdateVAO(C){const M={};M.position=C.createVertexBuffer("position",0,3);let x=3;M.age=C.createVertexBuffer("age",x,1),x+=1,M.size=C.createVertexBuffer("size",x,3),x+=3,M.life=C.createVertexBuffer("life",x,1),x+=1,M.seed=C.createVertexBuffer("seed",x,4),x+=4,M.direction=C.createVertexBuffer("direction",x,3),x+=3,this._parent.particleEmitterType instanceof H&&(M.initialPosition=C.createVertexBuffer("initialPosition",x,3),x+=3),this._parent._colorGradientsTexture||(M.color=C.createVertexBuffer("color",x,4),x+=4),this._parent._isBillboardBased||(M.initialDirection=C.createVertexBuffer("initialDirection",x,3),x+=3),this._parent.noiseTexture&&(M.noiseCoordinates1=C.createVertexBuffer("noiseCoordinates1",x,3),x+=3,M.noiseCoordinates2=C.createVertexBuffer("noiseCoordinates2",x,3),x+=3),this._parent._angularSpeedGradientsTexture?(M.angle=C.createVertexBuffer("angle",x,1),x+=1):(M.angle=C.createVertexBuffer("angle",x,2),x+=2),this._parent._isAnimationSheetEnabled&&(M.cellIndex=C.createVertexBuffer("cellIndex",x,1),x+=1,this._parent.spriteRandomStartCell&&(M.cellStartOffset=C.createVertexBuffer("cellStartOffset",x,1),x+=1));const f=this._engine.recordVertexArrayObject(M,null,this._updateEffect);return this._engine.bindArrayBuffer(null),f}});class P{constructor(C,M){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,f=arguments.length>3?arguments[3]:void 0;this._engine=C,this._label=f,this._engine._storageBuffers.push(this),this._create(M,x)}_create(C,M){this._bufferSize=C,this._creationFlags=M,this._buffer=this._engine.createStorageBuffer(C,M,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(C,M,x){this._buffer&&this._engine.updateStorageBuffer(this._buffer,C,M,x)}read(C,M,x,f){return this._engine.readFromStorageBuffer(this._buffer,C,M,x,f)}dispose(){const C=this._engine._storageBuffers,M=C.indexOf(this);-1!==M&&(C[M]=C[C.length-1],C.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var h=x(951),c=x(959),q=x(1145),i=x(945),Z=x(1278),E=x(1078),K=x(1130),G=x(1269);class a{constructor(){this._gpuTimeInFrameId=-1,this.counter=new G.c}_addDuration(C,M){C<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==C?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(M,!1),this._gpuTimeInFrameId=C):this.counter.addCount(M,!1))}}class J{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(C,M,x){let f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=C,this._engine=M,this.uniqueId=Z.e.UniqueId,M.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new a),this._engine.getCaps().supportComputeShaders?f.bindingsMapping?(this._context=M.createComputeContext(),this._shaderPath=x,this._options={bindingsMapping:{},defines:[],...f}):E.e.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):E.e.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(C,M){let x=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const f=this._bindings[C];this._bindings[C]={type:x?0:4,object:M,indexInGroupEntries:null===f||void 0===f?void 0:f.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!f||f.object!==M||f.type!==this._bindings[C].type)}setStorageTexture(C,M){const x=this._bindings[C];this._contextIsDirty||(this._contextIsDirty=!x||x.object!==M),this._bindings[C]={type:1,object:M,indexInGroupEntries:null===x||void 0===x?void 0:x.indexInGroupEntries}}setExternalTexture(C,M){const x=this._bindings[C];this._contextIsDirty||(this._contextIsDirty=!x||x.object!==M),this._bindings[C]={type:6,object:M,indexInGroupEntries:null===x||void 0===x?void 0:x.indexInGroupEntries}}setVideoTexture(C,M){return!!M.externalTexture&&(this.setExternalTexture(C,M.externalTexture),!0)}setUniformBuffer(C,M){const x=this._bindings[C];this._contextIsDirty||(this._contextIsDirty=!x||x.object!==M),this._bindings[C]={type:J._BufferIsDataBuffer(M)?7:2,object:M,indexInGroupEntries:null===x||void 0===x?void 0:x.indexInGroupEntries}}setStorageBuffer(C,M){const x=this._bindings[C];this._contextIsDirty||(this._contextIsDirty=!x||x.object!==M),this._bindings[C]={type:J._BufferIsDataBuffer(M)?7:3,object:M,indexInGroupEntries:null===x||void 0===x?void 0:x.indexInGroupEntries}}setTextureSampler(C,M){const x=this._bindings[C];this._contextIsDirty||(this._contextIsDirty=!x||!M.compareSampler(x.object)),this._bindings[C]={type:5,object:M,indexInGroupEntries:null===x||void 0===x?void 0:x.indexInGroupEntries}}isReady(){let C=this._effect;for(const T in this._bindings){const C=this._bindings[T],M=C.type,x=C.object;switch(M){case 0:case 4:case 1:if(!x.isReady())return!1;break;case 6:if(!x.isReady())return!1;break}}const M=[],x=this._shaderPath;if(this._options.defines)for(let T=0;T<this._options.defines.length;T++)M.push(this._options.defines[T]);const f=M.join("\n");return this._cachedDefines!==f&&(this._cachedDefines=f,C=this._engine.createComputeEffect(x,{defines:f,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=C),!!C.isReady()}dispatch(C,M,x){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,C,M,x,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const x=J._BufferIsDataBuffer(C)?C:C.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,x,M,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const M in this._bindings){const x=this._bindings[M];if(!this._options.bindingsMapping[M])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+M+"'");switch(x.type){case 0:{const f=this._samplers[M],T=x.object;var C;if(!f||!T._texture||!f.compareSampler(T._texture))this._samplers[M]=(new K.c).setParameters(T.wrapU,T.wrapV,T.wrapR,T.anisotropicFilteringLevel,T._texture.samplingMode,null===(C=T._texture)||void 0===C?void 0:C._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const C=x.object;C.getBuffer()!==x.buffer&&(x.buffer=C.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}dispatchWhenReady(C,M,x){let f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return new Promise((T=>{const z=()=>{this.dispatch(C,M,x)?T():setTimeout(z,f)};z()}))}serialize(){const C=q.e.Serialize(this);C.options=this._options,C.shaderPath=this._shaderPath,C.Gj={},C.textures={};for(const M in this._bindings){const x=this._bindings[M],f=x.object;switch(x.type){case 0:case 4:case 1:{const T=f.serialize();T&&(C.textures[M]=T,C.Gj[M]={type:x.type});break}}}return C}static Parse(C,M,x){const f=q.e.Parse((()=>new J(C.name,M.getEngine(),C.shaderPath,C.options)),C,M,x);for(const T in C.textures){const z=C.Gj[T],s=i.b.Parse(C.textures[T],M,x);0===z.type?f.setTexture(T,s):4===z.type?f.setTexture(T,s,!1):f.setStorageTexture(T,s)}return f}static _BufferIsDataBuffer(C){return void 0!==C.underlyingResource}}(0,h.e)([(0,c.J)()],J.prototype,"name",void 0),(0,h.e)([(0,c.J)()],J.prototype,"fastMode",void 0),(0,S.f)("BABYLON.ComputeShader",J);var N=x(1215);const k="gpuUpdateParticlesComputeShader",v="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";I.d.ShadersStoreWGSL[k]=v;(0,S.f)("BABYLON.ComputeShaderParticleSystem",class{constructor(C,M){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=C,this._engine=M}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var C;return(null===(C=this._updateComputeShader)||void 0===C?void 0:C.isReady())??!1}createUpdateBuffer(C){var M;const x={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(x.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(x.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(x.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(x.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(x.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(x.noiseTexture={group:1,binding:11}),this._updateComputeShader=new J("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:x,defines:C.split("\n")}),null===(M=this._simParamsComputeShader)||void 0===M||M.dispose(),this._simParamsComputeShader=new N.b(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new n(this._simParamsComputeShader)}createVertexBuffers(C,M){this._renderVertexBuffers.push(M)}createParticleBuffer(C){const M=new P(this._engine,4*C.length,11,"ComputeShaderParticleSystemBuffer");return M.update(C),this._bufferComputeShader.push(M),M.getBuffer()}bindDrawBuffers(C,M,x){this._engine.bindBuffers(this._renderVertexBuffers[C],x,M)}preUpdateParticleBuffer(){}updateParticleBuffer(C,M,x){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[C]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^C]),this._updateComputeShader.dispatch(Math.ceil(x/64))}releaseBuffers(){var C;for(let M=0;M<this._bufferComputeShader.length;++M)this._bufferComputeShader[M].dispose();this._bufferComputeShader.length=0,null===(C=this._simParamsComputeShader)||void 0===C||C.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class p{constructor(C,M,x){this.gradient=C,this.color1=M,this.color2=x}getColorToRef(C){this.color2?s.e.LerpToRef(this.color1,this.color2,Math.random(),C):C.p(this.color1)}}class u{constructor(C,M){this.gradient=C,this.color=M}}class Y{constructor(C,M,x){this.gradient=C,this.factor1=M,this.factor2=x}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class W{static GetCurrentGradient(C,M,x){if(M[0].gradient>C)return void x(M[0],M[0],1);for(let T=0;T<M.length-1;T++){const f=M[T],z=M[T+1];if(C>=f.gradient&&C<=z.gradient){return void x(f,z,(C-f.gradient)/(z.gradient-f.gradient))}}const f=M.length-1;x(M[f],M[f],1)}}var e=x(971),r=x(11867),w=x(1008);class l{constructor(C){this.particleSystem=C,this.position=f.m.Zero(),this.direction=f.m.Zero(),this.color=new s.e(0,0,0,0),this.colorStep=new s.e(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new f.j(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new s.e(0,0,0,0),this._currentColor2=new s.e(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=l._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let C=this.age,M=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===M?(M=1,C=this._randomCellOffset):C+=this._randomCellOffset);const x=this._initialEndSpriteCellID-this._initialStartSpriteCellID+1;let f;f=this._initialSpriteCellLoop?(0,Q.d)(C*M%this.lifeTime/this.lifeTime):(0,Q.d)(C*M/this.lifeTime),this.cellIndex=this._initialStartSpriteCellID+f*x|0}_inheritParticleInfoToSubEmitter(C){if(C.particleSystem.k.position){const M=C.particleSystem.k;if(M.position.p(this.position),C.inheritDirection){const C=f.i.Md[0];this.direction.normalizeToRef(C),M.setDirection(C,0,Math.PI/2)}}else{C.particleSystem.k.p(this.position)}this.direction.scaleToRef(C.inheritedVelocityAmount/2,f.i.Md[0]),C.particleSystem._inheritedVelocityOffset.p(f.i.Md[0])}_inheritParticleInfoToSubEmitters(){this._attachedSubEmitters&&this._attachedSubEmitters.length>0&&this._attachedSubEmitters.forEach((C=>{this._inheritParticleInfoToSubEmitter(C)}))}_reset(){this.age=0,this.id=l._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(C){C.position.p(this.position),this._initialDirection?C._initialDirection?C._initialDirection.p(this._initialDirection):C._initialDirection=this._initialDirection.clone():C._initialDirection=null,C.direction.p(this.direction),this.Jg&&(C.Jg?C.Jg.p(this.Jg):C.Jg=this.Jg.clone()),C.color.p(this.color),C.colorStep.p(this.colorStep),C.lifeTime=this.lifeTime,C.age=this.age,C._randomCellOffset=this._randomCellOffset,C.size=this.size,C.scale.p(this.scale),C.angle=this.angle,C.angularSpeed=this.angularSpeed,C.particleSystem=this.particleSystem,C.cellIndex=this.cellIndex,C.id=this.id,C._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(C._currentColorGradient=this._currentColorGradient,C._currentColor1.p(this._currentColor1),C._currentColor2.p(this._currentColor2)),this._currentSizeGradient&&(C._currentSizeGradient=this._currentSizeGradient,C._currentSize1=this._currentSize1,C._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(C._currentAngularSpeedGradient=this._currentAngularSpeedGradient,C._currentAngularSpeed1=this._currentAngularSpeed1,C._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(C._currentVelocityGradient=this._currentVelocityGradient,C._currentVelocity1=this._currentVelocity1,C._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(C._currentLimitVelocityGradient=this._currentLimitVelocityGradient,C._currentLimitVelocity1=this._currentLimitVelocity1,C._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(C._currentDragGradient=this._currentDragGradient,C._currentDrag1=this._currentDrag1,C._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(C._initialStartSpriteCellID=this._initialStartSpriteCellID,C._initialEndSpriteCellID=this._initialEndSpriteCellID,C._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(C.remapData&&this.remapData?C.remapData.p(this.remapData):C.remapData=new f.q(0,0,0,0)),this._randomNoiseCoordinates1&&(C._randomNoiseCoordinates1?(C._randomNoiseCoordinates1.p(this._randomNoiseCoordinates1),C._randomNoiseCoordinates2.p(this._randomNoiseCoordinates2)):(C._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),C._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}l._Count=0;var CC=x(1321),MC=(x(1411),x(1335)),xC=x(1329),fC=x(1208);class TC extends m{set onDispose(C){this._onDisposeObserver&&this.Sd.remove(this._onDisposeObserver),this._onDisposeObserver=this.Sd.add(C)}get useRampGradients(){return this._useRampGradients}set useRampGradients(C){this._useRampGradients!==C&&(this._useRampGradients=C,this._resetEffect())}get particles(){return this.Bj}get shaderLanguage(){return this._shaderLanguage}getActiveCount(){return this.Bj.length}getClassName(){return"Je"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var C;let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(C=this._customWrappers[M])||void 0===C?void 0:C.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[C]??this._customWrappers[0]}setCustomEffect(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[M]=new CC.d(this._engine),this._customWrappers[M].effect=C,this._customWrappers[M].drawContext&&(this._customWrappers[M].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new e.c),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}constructor(C,M,x){let T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,z=arguments.length>4&&void 0!==arguments[4]&&arguments[4],S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01;super(C),this._emitterInverseWorldMatrix=f.d.Identity(),this._inheritedVelocityOffset=new f.m,this.Sd=new e.c,this.onStoppedObservable=new e.c,this.Bj=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new s.e(0,0,0,0),this._colorDiff=new s.e(0,0,0,0),this._scaledDirection=f.m.Zero(),this._scaledGravity=f.m.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this.isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=C=>{},this.recycleParticle=C=>{const M=this.Bj.pop();M!==C&&M.copyTo(C),this._stockParticles.push(M)},this._createParticle=()=>{let C;return 0!==this._stockParticles.length?(C=this._stockParticles.pop(),C._reset()):C=new l(this),this._prepareParticle(C),C},this._shadersLoaded=!1,this._capacity=M,this._epsilon=S,this._isAnimationSheetEnabled=z,x&&"Scene"!==x.getClassName()?(this._engine=x,this.defaultProjectionMatrix=f.d.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=x||w.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.te.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._attachImageProcessingConfiguration(null),this._customWrappers={0:new CC.d(this._engine)},this._customWrappers[0].effect=T,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new y;let m=null;this.updateFunction=C=>{let M=null;var x;this.noiseTexture&&(M=this.noiseTexture.getSize(),null===(x=this.noiseTexture.getContent())||void 0===x||x.then((C=>{m=C})));const T=C===this.Bj;for(let z=0;z<C.length;z++){const x=C[z];let S=this._scaledUpdateSpeed;const V=x.age;if(x.age+=S,x.age>x.lifeTime){const C=x.age-V;S=(x.lifeTime-V)*S/C,x.age=x.lifeTime}const y=x.age/x.lifeTime;this._colorGradients&&this._colorGradients.length>0?W.GetCurrentGradient(y,this._colorGradients,((C,M,f)=>{C!==x._currentColorGradient&&(x._currentColor1.p(x._currentColor2),M.getColorToRef(x._currentColor2),x._currentColorGradient=C),s.e.LerpToRef(x._currentColor1,x._currentColor2,f,x.color)})):(x.colorStep.scaleToRef(S,this._scaledColorStep),x.color.addInPlace(this._scaledColorStep),x.color.a<0&&(x.color.a=0)),this._angularSpeedGradients&&this._angularSpeedGradients.length>0&&W.GetCurrentGradient(y,this._angularSpeedGradients,((C,M,f)=>{C!==x._currentAngularSpeedGradient&&(x._currentAngularSpeed1=x._currentAngularSpeed2,x._currentAngularSpeed2=M.getFactor(),x._currentAngularSpeedGradient=C),x.angularSpeed=(0,Q.q)(x._currentAngularSpeed1,x._currentAngularSpeed2,f)})),x.angle+=x.angularSpeed*S;let U=S;if(this._velocityGradients&&this._velocityGradients.length>0&&W.GetCurrentGradient(y,this._velocityGradients,((C,M,f)=>{C!==x._currentVelocityGradient&&(x._currentVelocity1=x._currentVelocity2,x._currentVelocity2=M.getFactor(),x._currentVelocityGradient=C),U*=(0,Q.q)(x._currentVelocity1,x._currentVelocity2,f)})),x.direction.scaleToRef(U,this._scaledDirection),this._limitVelocityGradients&&this._limitVelocityGradients.length>0&&W.GetCurrentGradient(y,this._limitVelocityGradients,((C,M,f)=>{C!==x._currentLimitVelocityGradient&&(x._currentLimitVelocity1=x._currentLimitVelocity2,x._currentLimitVelocity2=M.getFactor(),x._currentLimitVelocityGradient=C);const T=(0,Q.q)(x._currentLimitVelocity1,x._currentLimitVelocity2,f);x.direction.length()>T&&x.direction.scaleInPlace(this.limitVelocityDamping)})),this._dragGradients&&this._dragGradients.length>0&&W.GetCurrentGradient(y,this._dragGradients,((C,M,f)=>{C!==x._currentDragGradient&&(x._currentDrag1=x._currentDrag2,x._currentDrag2=M.getFactor(),x._currentDragGradient=C);const T=(0,Q.q)(x._currentDrag1,x._currentDrag2,f);this._scaledDirection.scaleInPlace(1-T)})),this.isLocal&&x.Jg?(x.Jg.addInPlace(this._scaledDirection),f.m.TransformCoordinatesToRef(x.Jg,this._emitterWorldMatrix,x.position)):x.position.addInPlace(this._scaledDirection),m&&M&&x._randomNoiseCoordinates1){const C=this._fetchR(x._randomNoiseCoordinates1.x,x._randomNoiseCoordinates1.y,M.width,M.height,m),T=this._fetchR(x._randomNoiseCoordinates1.z,x._randomNoiseCoordinates2.x,M.width,M.height,m),z=this._fetchR(x._randomNoiseCoordinates2.y,x._randomNoiseCoordinates2.z,M.width,M.height,m),s=f.i.Md[0],Q=f.i.Md[1];s.Hd((2*C-1)*this.noiseStrength.x,(2*T-1)*this.noiseStrength.y,(2*z-1)*this.noiseStrength.z),s.scaleToRef(S,Q),x.direction.addInPlace(Q)}this.gravity.scaleToRef(S,this._scaledGravity),x.direction.addInPlace(this._scaledGravity),this._sizeGradients&&this._sizeGradients.length>0&&W.GetCurrentGradient(y,this._sizeGradients,((C,M,f)=>{C!==x._currentSizeGradient&&(x._currentSize1=x._currentSize2,x._currentSize2=M.getFactor(),x._currentSizeGradient=C),x.size=(0,Q.q)(x._currentSize1,x._currentSize2,f)})),this._useRampGradients&&(this._colorRemapGradients&&this._colorRemapGradients.length>0&&W.GetCurrentGradient(y,this._colorRemapGradients,((C,M,f)=>{const T=(0,Q.q)(C.factor1,M.factor1,f),z=(0,Q.q)(C.factor2,M.factor2,f);x.remapData.x=T,x.remapData.y=z-T})),this._alphaRemapGradients&&this._alphaRemapGradients.length>0&&W.GetCurrentGradient(y,this._alphaRemapGradients,((C,M,f)=>{const T=(0,Q.q)(C.factor1,M.factor1,f),z=(0,Q.q)(C.factor2,M.factor2,f);x.remapData.z=T,x.remapData.w=z-T}))),this._isAnimationSheetEnabled&&x.updateCellIndex(),x._inheritParticleInfoToSubEmitters(),x.age>=x.lifeTime&&(this._emitFromParticle(x),x._attachedSubEmitters&&(x._attachedSubEmitters.forEach((C=>{C.particleSystem.disposeOnStop=!0,C.particleSystem.stop()})),x._attachedSubEmitters=null),this.recycleParticle(x),T&&z--)}}}serialize(C){throw new Error("Method not implemented.")}clone(C,M){throw new Error("Method not implemented.")}_addFactorGradient(C,M,x,f){const T=new Y(M,x,f);C.push(T),C.sort(((C,M)=>C.gradient<M.gradient?-1:C.gradient>M.gradient?1:0))}_removeFactorGradient(C,M){if(!C)return;let x=0;for(const f of C){if(f.gradient===M){C.splice(x,1);break}x++}}addLifeTimeGradient(C,M,x){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,C,M,x),this}removeLifeTimeGradient(C){return this._removeFactorGradient(this._lifeTimeGradients,C),this}addSizeGradient(C,M,x){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,C,M,x),this}removeSizeGradient(C){return this._removeFactorGradient(this._sizeGradients,C),this}addColorRemapGradient(C,M,x){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,C,M,x),this}removeColorRemapGradient(C){return this._removeFactorGradient(this._colorRemapGradients,C),this}addAlphaRemapGradient(C,M,x){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,C,M,x),this}removeAlphaRemapGradient(C){return this._removeFactorGradient(this._alphaRemapGradients,C),this}addAngularSpeedGradient(C,M,x){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,C,M,x),this}removeAngularSpeedGradient(C){return this._removeFactorGradient(this._angularSpeedGradients,C),this}addVelocityGradient(C,M,x){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,C,M,x),this}removeVelocityGradient(C){return this._removeFactorGradient(this._velocityGradients,C),this}addLimitVelocityGradient(C,M,x){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,C,M,x),this}removeLimitVelocityGradient(C){return this._removeFactorGradient(this._limitVelocityGradients,C),this}addDragGradient(C,M,x){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,C,M,x),this}removeDragGradient(C){return this._removeFactorGradient(this._dragGradients,C),this}addEmitRateGradient(C,M,x){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,C,M,x),this}removeEmitRateGradient(C){return this._removeFactorGradient(this._emitRateGradients,C),this}addStartSizeGradient(C,M,x){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,C,M,x),this}removeStartSizeGradient(C){return this._removeFactorGradient(this._startSizeGradients,C),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const C=new Uint8Array(4*this._rawTextureWidth),M=s.f._d[0];for(let x=0;x<this._rawTextureWidth;x++){const f=x/this._rawTextureWidth;W.GetCurrentGradient(f,this._rampGradients,((f,T,z)=>{s.d.LerpToRef(f.color,T.color,z,M),C[4*x]=255*M.r,C[4*x+1]=255*M.g,C[4*x+2]=255*M.b,C[4*x+3]=255}))}this._rampGradientsTexture=r.e.CreateRGBATexture(C,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((C,M)=>C.gradient<M.gradient?-1:C.gradient>M.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(C,M){this._rampGradients||(this._rampGradients=[]);const x=new u(C,M);return this._rampGradients.push(x),this._syncRampGradientTexture(),this}removeRampGradient(C){return this._removeGradientAndTexture(C,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(C,M,x){this._colorGradients||(this._colorGradients=[]);const f=new p(C,M,x);return this._colorGradients.push(f),this._colorGradients.sort(((C,M)=>C.gradient<M.gradient?-1:C.gradient>M.gradient?1:0)),this}removeColorGradient(C){if(!this._colorGradients)return this;let M=0;for(const x of this._colorGradients){if(x.gradient===C){this._colorGradients.splice(M,1);break}M++}return this}resetDrawCache(){for(const C of this._drawWrappers)if(C)for(const M of C)null===M||void 0===M||M.dispose();this._drawWrappers=[]}_fetchR(C,M,x,f,T){return T[4*(((C=.5*Math.abs(C)+.5)*x%x|0)+((M=.5*Math.abs(M)+.5)*f%f|0)*x)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const C=this._engine,M=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*M),this._vertexBuffer=new j.e(C,this._vertexData,!0,M);let x=0;const f=this._vertexBuffer.createVertexBuffer(j.h.PositionKind,x,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[j.h.PositionKind]=f,x+=3;const T=this._vertexBuffer.createVertexBuffer(j.h.ColorKind,x,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[j.h.ColorKind]=T,x+=4;const z=this._vertexBuffer.createVertexBuffer("angle",x,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=z,x+=1;const s=this._vertexBuffer.createVertexBuffer("size",x,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=s,x+=2,this._isAnimationSheetEnabled){const C=this._vertexBuffer.createVertexBuffer("cellIndex",x,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=C,x+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const C=this._vertexBuffer.createVertexBuffer("direction",x,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=C,x+=3}if(this._useRampGradients){const C=this._vertexBuffer.createVertexBuffer("remapData",x,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=C,x+=4}let S;if(this._useInstancing){const M=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new j.e(C,M,!1,2),S=this._spriteBuffer.createVertexBuffer("offset",0,2)}else S=this._vertexBuffer.createVertexBuffer("offset",x,2,this._vertexBufferSize,this._useInstancing),x+=2;this._vertexBuffers.offset=S,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const C=[],M=[];let x=0;for(let f=0;f<this._capacity;f++)C.push(x),C.push(x+1),C.push(x+2),C.push(x),C.push(x+2),C.push(x+3),M.push(x,x+1,x+1,x+2,x+2,x+3,x+3,x,x,x+3),x+=4;this._indexBuffer=this._engine.createIndexBuffer(C),this._linesIndexBuffer=this._engine.createIndexBuffer(M)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(C)setTimeout((()=>{this.start(0)}),C);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var M;-1!==(null===(M=this.k)||void 0===M?void 0:M.getClassName().indexOf("Mesh"))&&this.k.Be(!0);const C=this.noiseTexture;if(C&&C.onGeneratedObservable)C.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let M=0;M<this.preWarmCycles;M++)this.animate(!0),C.render()}))}));else for(let M=0;M<this.preWarmCycles;M++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop)}}stop(){let C=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(C))}_postStop(C){}reset(){this._stockParticles.length=0,this.Bj.length=0}_appendParticleVertex(C,M,x,T){let z=C*this._vertexBufferSize;if(this._vertexData[z++]=M.position.x+this.Gg.x,this._vertexData[z++]=M.position.y+this.Gg.y,this._vertexData[z++]=M.position.z+this.Gg.z,this._vertexData[z++]=M.color.r,this._vertexData[z++]=M.color.g,this._vertexData[z++]=M.color.b,this._vertexData[z++]=M.color.a,this._vertexData[z++]=M.angle,this._vertexData[z++]=M.scale.x*M.size,this._vertexData[z++]=M.scale.y*M.size,this._isAnimationSheetEnabled&&(this._vertexData[z++]=M.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[z++]=M.direction.x,this._vertexData[z++]=M.direction.y,this._vertexData[z++]=M.direction.z);else if(M._initialDirection){let C=M._initialDirection;this.isLocal&&(f.m.TransformNormalToRef(C,this._emitterWorldMatrix,f.i.Md[0]),C=f.i.Md[0]),0===C.x&&0===C.z&&(C.x=.001),this._vertexData[z++]=C.x,this._vertexData[z++]=C.y,this._vertexData[z++]=C.z}else{let C=M.direction;this.isLocal&&(f.m.TransformNormalToRef(C,this._emitterWorldMatrix,f.i.Md[0]),C=f.i.Md[0]),0===C.x&&0===C.z&&(C.x=.001),this._vertexData[z++]=C.x,this._vertexData[z++]=C.y,this._vertexData[z++]=C.z}this._useRampGradients&&M.remapData&&(this._vertexData[z++]=M.remapData.x,this._vertexData[z++]=M.remapData.y,this._vertexData[z++]=M.remapData.z,this._vertexData[z++]=M.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===x?x=this._epsilon:1===x&&(x=1-this._epsilon),0===T?T=this._epsilon:1===T&&(T=1-this._epsilon)),this._vertexData[z++]=x,this._vertexData[z++]=T)}_prepareParticle(C){}_update(C){if(this._alive=this.Bj.length>0,this.k.position){const C=this.k;this._emitterWorldMatrix=C.getWorldMatrix()}else{const C=this.k;this._emitterWorldMatrix=f.d.Translation(C.x,C.y,C.z)}let M;this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.Bj);for(let x=0;x<C&&this.Bj.length!==this._capacity;x++){if(M=this._createParticle(),this.Bj.push(M),this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0){const C=(0,Q.d)(this._actualFrame/this.targetStopDuration);W.GetCurrentGradient(C,this._lifeTimeGradients,((x,f)=>{const T=x,z=f,s=T.getFactor(),S=z.getFactor(),m=(C-T.gradient)/(z.gradient-T.gradient);M.lifeTime=(0,Q.q)(s,S,m)}))}else M.lifeTime=(0,Q.v)(this.minLifeTime,this.maxLifeTime);const C=(0,Q.v)(this.minEmitPower,this.maxEmitPower);if(this.startPositionFunction?this.startPositionFunction(this._emitterWorldMatrix,M.position,M,this.isLocal):this.particleEmitterType.startPositionFunction(this._emitterWorldMatrix,M.position,M,this.isLocal),this.isLocal&&(M.Jg?M.Jg.p(M.position):M.Jg=M.position.clone(),f.m.TransformCoordinatesToRef(M.Jg,this._emitterWorldMatrix,M.position)),this.startDirectionFunction?this.startDirectionFunction(this._emitterWorldMatrix,M.direction,M,this.isLocal):this.particleEmitterType.startDirectionFunction(this._emitterWorldMatrix,M.direction,M,this.isLocal,this._emitterInverseWorldMatrix),0===C?M._initialDirection?M._initialDirection.p(M.direction):M._initialDirection=M.direction.clone():M._initialDirection=null,M.direction.scaleInPlace(C),this._sizeGradients&&0!==this._sizeGradients.length?(M._currentSizeGradient=this._sizeGradients[0],M._currentSize1=M._currentSizeGradient.getFactor(),M.size=M._currentSize1,this._sizeGradients.length>1?M._currentSize2=this._sizeGradients[1].getFactor():M._currentSize2=M._currentSize1):M.size=(0,Q.v)(this.minSize,this.maxSize),M.scale.Hd((0,Q.v)(this.minScaleX,this.maxScaleX),(0,Q.v)(this.minScaleY,this.maxScaleY)),this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration){const C=this._actualFrame/this.targetStopDuration;W.GetCurrentGradient(C,this._startSizeGradients,((C,x,f)=>{C!==this._currentStartSizeGradient&&(this._currentStartSize1=this._currentStartSize2,this._currentStartSize2=x.getFactor(),this._currentStartSizeGradient=C);const T=(0,Q.q)(this._currentStartSize1,this._currentStartSize2,f);M.scale.scaleInPlace(T)}))}if(this._angularSpeedGradients&&0!==this._angularSpeedGradients.length?(M._currentAngularSpeedGradient=this._angularSpeedGradients[0],M.angularSpeed=M._currentAngularSpeedGradient.getFactor(),M._currentAngularSpeed1=M.angularSpeed,this._angularSpeedGradients.length>1?M._currentAngularSpeed2=this._angularSpeedGradients[1].getFactor():M._currentAngularSpeed2=M._currentAngularSpeed1):M.angularSpeed=(0,Q.v)(this.minAngularSpeed,this.maxAngularSpeed),M.angle=(0,Q.v)(this.minInitialRotation,this.maxInitialRotation),this._velocityGradients&&this._velocityGradients.length>0&&(M._currentVelocityGradient=this._velocityGradients[0],M._currentVelocity1=M._currentVelocityGradient.getFactor(),this._velocityGradients.length>1?M._currentVelocity2=this._velocityGradients[1].getFactor():M._currentVelocity2=M._currentVelocity1),this._limitVelocityGradients&&this._limitVelocityGradients.length>0&&(M._currentLimitVelocityGradient=this._limitVelocityGradients[0],M._currentLimitVelocity1=M._currentLimitVelocityGradient.getFactor(),this._limitVelocityGradients.length>1?M._currentLimitVelocity2=this._limitVelocityGradients[1].getFactor():M._currentLimitVelocity2=M._currentLimitVelocity1),this._dragGradients&&this._dragGradients.length>0&&(M._currentDragGradient=this._dragGradients[0],M._currentDrag1=M._currentDragGradient.getFactor(),this._dragGradients.length>1?M._currentDrag2=this._dragGradients[1].getFactor():M._currentDrag2=M._currentDrag1),this._colorGradients&&0!==this._colorGradients.length)M._currentColorGradient=this._colorGradients[0],M._currentColorGradient.getColorToRef(M.color),M._currentColor1.p(M.color),this._colorGradients.length>1?this._colorGradients[1].getColorToRef(M._currentColor2):M._currentColor2.p(M.color);else{const C=(0,Q.v)(0,1);s.e.LerpToRef(this.color1,this.color2,C,M.color),this.colorDead.subtractToRef(M.color,this._colorDiff),this._colorDiff.scaleToRef(1/M.lifeTime,M.colorStep)}this._isAnimationSheetEnabled&&(M._initialStartSpriteCellID=this.startSpriteCellID,M._initialEndSpriteCellID=this.endSpriteCellID,M._initialSpriteCellLoop=this.spriteCellLoop),M.direction.addInPlace(this._inheritedVelocityOffset),this._useRampGradients&&(M.remapData=new f.q(0,1,0,1)),this.noiseTexture&&(M._randomNoiseCoordinates1?(M._randomNoiseCoordinates1.Hd(Math.random(),Math.random(),Math.random()),M._randomNoiseCoordinates2.Hd(Math.random(),Math.random(),Math.random())):(M._randomNoiseCoordinates1=new f.m(Math.random(),Math.random(),Math.random()),M._randomNoiseCoordinates2=new f.m(Math.random(),Math.random(),Math.random()))),M._inheritParticleInfoToSubEmitters()}}static _GetAttributeNamesOrOptions(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0],M=arguments.length>1&&void 0!==arguments[1]&&arguments[1],x=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const f=[j.h.PositionKind,j.h.ColorKind,"angle","offset","size"];return C&&f.push("cellIndex"),M||f.push("direction"),x&&f.push("remapData"),f}static _GetEffectCreationOptions(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0],M=arguments.length>1&&void 0!==arguments[1]&&arguments[1],x=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const f=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,MC.b)(f),C&&f.push("particlesInfos"),M&&f.push("logarithmicDepthConstant"),x&&(f.push("vFogInfos"),f.push("vFogColor")),f}fillDefines(C,M){let x=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,MC.k)(this,this._scene,C),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&C.push("#define FOG")),this._isAnimationSheetEnabled&&C.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&C.push("#define LOGARITHMICDEPTH"),M===m.BLENDMODE_MULTIPLY&&C.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&C.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(C.push("#define BILLBOARD"),this.billboardMode){case 2:C.push("#define BILLBOARDY");break;case 8:case 9:C.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&C.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:C.push("#define BILLBOARDMODE_ALL")}x&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),C.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(C,M,x){M.push(...TC._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),C.push(...TC._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),x.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,fC.d)(C,this._imageProcessingConfigurationDefines),(0,fC.c)(x,this._imageProcessingConfigurationDefines))}_getWrapper(C){const M=this._getCustomDrawWrapper(C);if(null!==M&&void 0!==M&&M.effect)return M;const x=[];this.fillDefines(x,C);const f=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let T=this._drawWrappers[f];T||(T=this._drawWrappers[f]=[]);let z=T[C];z||(z=new CC.d(this._engine),z.drawContext&&(z.drawContext.useInstancing=this._useInstancing),T[C]=z);const s=x.join("\n");if(z.defines!==s){const C=[],M=[],x=[];this.fillUniformsAttributesAndSamplerNames(M,C,x),z.setEffect(this._engine.createEffect("particles",C,M,x,s,void 0,void 0,void 0,void 0,this._shaderLanguage),s)}return z}animate(){var C;let M,x=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started){if(!x&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(x?this.preWarmStepOffset:(null===(C=this._scene)||void 0===C?void 0:C.getAnimationRatio())||1),this.manualEmitCount>-1)M=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let C=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const M=this._actualFrame/this.targetStopDuration;W.GetCurrentGradient(M,this._emitRateGradients,((M,x,f)=>{M!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=x.getFactor(),this._currentEmitRateGradient=M),C=(0,Q.q)(this._currentEmitRate1,this._currentEmitRate2,f)}))}M=C*this._scaledUpdateSpeed|0,this._newPartsExcess+=C*this._scaledUpdateSpeed-M}if(this._newPartsExcess>1&&(M+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?M=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(M),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!x){let C=0;for(let M=0;M<this.Bj.length;M++){const x=this.Bj[M];this._appendParticleVertices(C,x),C+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.Bj.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(C,M){this._appendParticleVertex(C++,M,0,0),this._useInstancing||(this._appendParticleVertex(C++,M,1,0),this._appendParticleVertex(C++,M,1,1),this._appendParticleVertex(C++,M,0,1))}rebuild(){var C;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(C=this._spriteBuffer)||void 0===C||C._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!TC.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(x.bind(x,11903)),Promise.resolve().then(x.bind(x,11900))])):await Promise.all([Promise.resolve().then(x.bind(x,11896)),Promise.resolve().then(x.bind(x,11893))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.k||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==m.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(m.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(m.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(C){const M=this._getWrapper(C),x=M.effect,T=this._engine;T.enableEffect(M);const z=this.defaultViewMatrix??this._scene.getViewMatrix();if(x.setTexture("diffuseSampler",this.particleTexture),x.setMatrix("view",z),x.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const C=this.particleTexture.getBaseSize();x.setFloat3("particlesInfos",this.spriteCellWidth/C.width,this.spriteCellHeight/C.height,this.spriteCellWidth/C.width)}if(x.setVector2("translationPivot",this.translationPivot),x.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const C=this._scene.activeCamera;x.setVector3("eyePosition",C.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),x.setTexture("rampSampler",this._rampGradientsTexture));const s=x.defines;var S,Q,V,y,U,O;(this._scene&&((0,MC.f)(x,this,this._scene),this.applyFog&&(0,xC.f)(this._scene,void 0,x)),s.indexOf("#define BILLBOARDMODE_ALL")>=0&&(z.invertToRef(f.i.Matrix[0]),x.setMatrix("invView",f.i.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(S=this._scene)&&void 0!==S&&S.forceWireframe?T.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,x):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,x)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(Q=this._scene)&&void 0!==Q&&Q.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?T.bindBuffers(this._vertexBuffers,null!==(V=this._scene)&&void 0!==V&&V.forceWireframe?this._linesIndexBuffer:this._indexBuffer,x):T.bindBuffers(this._vertexBuffers,null!==(y=this._scene)&&void 0!==y&&y.forceWireframe?this._linesIndexBufferUseInstancing:null,x);switch(this.useLogarithmicDepth&&this._scene&&(0,xC.j)(s,x,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(x),C){case m.BLENDMODE_ADD:T.setAlphaMode(1);break;case m.BLENDMODE_ONEONE:T.setAlphaMode(6);break;case m.BLENDMODE_STANDARD:T.setAlphaMode(2);break;case m.BLENDMODE_MULTIPLY:T.setAlphaMode(4)}(this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(x),this._useInstancing)?null!==(U=this._scene)&&void 0!==U&&U.forceWireframe?T.drawElementsType(6,0,10,this.Bj.length):T.drawArraysType(7,0,4,this.Bj.length):null!==(O=this._scene)&&void 0!==O&&O.forceWireframe?T.drawElementsType(1,0,10*this.Bj.length):T.drawElementsType(0,0,6*this.Bj.length);return this.Bj.length}render(){if(!this.isReady()||!this.Bj.length)return 0;const C=this._engine;C.setState&&(C.setState(!1),this.forceDepthWrite&&C.setDepthWrite(!0));let M=0;return M=this.blendMode===m.BLENDMODE_MULTIPLYADD?this._render(m.BLENDMODE_MULTIPLY)+this._render(m.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),M}_onDispose(){}dispose(){let C=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],M=arguments.length>1&&void 0!==arguments[1]&&arguments[1],x=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),C&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),C&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(M,x),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const C=this._scene.te.indexOf(this);C>-1&&this._scene.te.splice(C,1),this._scene._activeParticleSystems.dispose()}this.Sd.notifyObservers(this),this.Sd.clear(),this.onStoppedObservable.clear(),this.reset()}}TC.ForceGLSL=!1;var zC,sC=x(1067);!function(C){C[C.ATTACHED=0]="ATTACHED",C[C.END=1]="END"}(zC||(zC={}));class SC{constructor(C){if(this.particleSystem=C,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!C.k||!C.k.dispose){const M=(0,S.c)("BABYLON.AbstractMesh");C.k=new M("SubemitterSystemEmitter",C.va()),C._disposeEmitterOnDispose=!0}}clone(){let C=this.particleSystem.k;if(C){if(C instanceof f.m)C=C.clone();else if(-1!==C.getClassName().indexOf("Mesh")){C=new((0,S.c)("BABYLON.Mesh"))("",C.va()),C.isVisible=!1}}else C=new f.m;const M=new SC(this.particleSystem.clone(this.particleSystem.name,C));return M.particleSystem.name+="Clone",M.type=this.type,M.inheritDirection=this.inheritDirection,M.inheritedVelocityAmount=this.inheritedVelocityAmount,M.particleSystem._disposeEmitterOnDispose=!0,M.particleSystem.disposeOnStop=!0,M}serialize(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const M={};return M.type=this.type,M.inheritDirection=this.inheritDirection,M.inheritedVelocityAmount=this.inheritedVelocityAmount,M.particleSystem=this.particleSystem.serialize(C),M}static _ParseParticleSystem(C,M,x){throw(0,sC.d)("ParseParticle")}static Parse(C,M,x){const f=C.particleSystem,T=new SC(SC._ParseParticleSystem(f,M,x,!0));return T.type=C.type,T.inheritDirection=C.inheritDirection,T.inheritedVelocityAmount=C.inheritedVelocityAmount,T.particleSystem._isSubEmitter=!0,T}dispose(){this.particleSystem.dispose()}}var mC=x(1086);function QC(C,M){const x=new L;return x.direction1=C,x.direction2=M,x}function VC(){return new o(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function yC(){return new t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function UC(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new f.m(0,1,0),x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new f.m(0,1,0);return new A(C,M,x)}function OC(){return new d(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function dC(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new f.m(0,1,0),z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new f.m(0,1,0);return new D(C,M,x,T,z)}function DC(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new U(C,M)}function oC(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new f.m(0,1,0),T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new f.m(0,1,0);return new O(C,M,x,T)}class LC extends TC{constructor(){super(...arguments),this._disposeEmitterOnDispose=!1,this._emitFromParticle=C=>{if(!this._subEmitters||0===this._subEmitters.length)return;const M=Math.floor(Math.random()*this._subEmitters.length);this._subEmitters[M].forEach((M=>{if(1===M.type){const x=M.clone();C._inheritParticleInfoToSubEmitter(x),x.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(x.particleSystem),x.particleSystem.start()}}))}}createPointEmitter(C,M){const x=QC(C,M);return this.particleEmitterType=x,x}createHemisphericEmitter(){const C=VC(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=C,C}createSphereEmitter(){const C=yC(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=C,C}createDirectedSphereEmitter(){const C=UC(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new f.m(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new f.m(0,1,0));return this.particleEmitterType=C,C}createCylinderEmitter(){const C=OC(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=C,C}createDirectedCylinderEmitter(){const C=dC(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new f.m(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new f.m(0,1,0));return this.particleEmitterType=C,C}createConeEmitter(){const C=DC(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=C,C}createDirectedConeEmitter(){const C=oC(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new f.m(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new f.m(0,1,0));return this.particleEmitterType=C,C}createBoxEmitter(C,M,x,f){const T=new y;return this.particleEmitterType=T,this.direction1=C,this.direction2=M,this.minEmitBox=x,this.maxEmitBox=f,T}_prepareSubEmitterInternalArray(){this._subEmitters=new Array,this.subEmitters&&this.subEmitters.forEach((C=>{C instanceof LC?this._subEmitters.push([new SC(C)]):C instanceof SC?this._subEmitters.push([C]):C instanceof Array&&this._subEmitters.push(C)}))}_stopSubEmitters(){this.activeSubSystems&&(this.activeSubSystems.forEach((C=>{C.stop(!0)})),this.activeSubSystems=[])}_removeFromRoot(){if(!this._rootParticleSystem)return;const C=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==C&&this._rootParticleSystem.activeSubSystems.splice(C,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(C){C&&this._stopSubEmitters()}_prepareParticle(C){if(this._subEmitters&&this._subEmitters.length>0){const M=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];C._attachedSubEmitters=[],M.forEach((M=>{if(0===M.type){const x=M.clone();C._attachedSubEmitters.push(x),x.particleSystem.start()}}))}}_onDispose(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0],M=arguments.length>1&&void 0!==arguments[1]&&arguments[1];var x;(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),C)&&(null===(x=this.particles)||void 0===x||x.forEach((C=>{if(C._attachedSubEmitters)for(let M=C._attachedSubEmitters.length-1;M>=0;M-=1)C._attachedSubEmitters[M].dispose()})));if(M&&this.activeSubSystems)for(let f=this.activeSubSystems.length-1;f>=0;f-=1)this.activeSubSystems[f].dispose();if(this._subEmitters&&this._subEmitters.length){for(let C=0;C<this._subEmitters.length;C++)for(const M of this._subEmitters[C])M.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.k&&this.k.dispose&&this.k.dispose(!0)}static _Parse(C,M,x,T){let z;z=x instanceof mC.e?null:x;const m=(0,S.c)("BABYLON.Texture");if(m&&z&&(C.texture?M.particleTexture=m.Parse(C.texture,z,T):C.textureName&&(M.particleTexture=new m(T+C.textureName,z,!1,void 0===C.invertY||C.invertY),M.particleTexture.name=C.textureName)),C.emitterId||0===C.emitterId||void 0!==C.k?C.emitterId&&z?M.k=z.getLastMeshById(C.emitterId):M.k=f.m.Dd(C.k):M.k=f.m.Zero(),M.isLocal=!!C.isLocal,void 0!==C.renderingGroupId&&(M.renderingGroupId=C.renderingGroupId),void 0!==C.isBillboardBased&&(M.isBillboardBased=C.isBillboardBased),void 0!==C.billboardMode&&(M.billboardMode=C.billboardMode),void 0!==C.useLogarithmicDepth&&(M.useLogarithmicDepth=C.useLogarithmicDepth),C.animations){for(let x=0;x<C.animations.length;x++){const f=C.animations[x],T=(0,S.c)("BABYLON.Animation");T&&M.animations.push(T.Parse(f))}M.beginAnimationOnStart=C.beginAnimationOnStart,M.beginAnimationFrom=C.beginAnimationFrom,M.beginAnimationTo=C.beginAnimationTo,M.beginAnimationLoop=C.beginAnimationLoop}if(C.autoAnimate&&z&&z.beginAnimation(M,C.autoAnimateFrom,C.autoAnimateTo,C.autoAnimateLoop,C.autoAnimateSpeed||1),M.startDelay=0|C.startDelay,M.minAngularSpeed=C.minAngularSpeed,M.maxAngularSpeed=C.maxAngularSpeed,M.minSize=C.minSize,M.maxSize=C.maxSize,C.minScaleX&&(M.minScaleX=C.minScaleX,M.maxScaleX=C.maxScaleX,M.minScaleY=C.minScaleY,M.maxScaleY=C.maxScaleY),void 0!==C.preWarmCycles&&(M.preWarmCycles=C.preWarmCycles,M.preWarmStepOffset=C.preWarmStepOffset),void 0!==C.minInitialRotation&&(M.minInitialRotation=C.minInitialRotation,M.maxInitialRotation=C.maxInitialRotation),M.minLifeTime=C.minLifeTime,M.maxLifeTime=C.maxLifeTime,M.minEmitPower=C.minEmitPower,M.maxEmitPower=C.maxEmitPower,M.emitRate=C.emitRate,M.gravity=f.m.Dd(C.gravity),C.noiseStrength&&(M.noiseStrength=f.m.Dd(C.noiseStrength)),M.color1=s.e.Dd(C.color1),M.color2=s.e.Dd(C.color2),M.colorDead=s.e.Dd(C.colorDead),M.updateSpeed=C.updateSpeed,M.targetStopDuration=C.targetStopDuration,M.blendMode=C.blendMode,C.colorGradients)for(const f of C.colorGradients)M.addColorGradient(f.gradient,s.e.Dd(f.color1),f.color2?s.e.Dd(f.color2):void 0);if(C.rampGradients){for(const x of C.rampGradients)M.addRampGradient(x.gradient,s.d.Dd(x.color));M.useRampGradients=C.useRampGradients}if(C.colorRemapGradients)for(const f of C.colorRemapGradients)M.addColorRemapGradient(f.gradient,void 0!==f.factor1?f.factor1:f.factor,f.factor2);if(C.alphaRemapGradients)for(const f of C.alphaRemapGradients)M.addAlphaRemapGradient(f.gradient,void 0!==f.factor1?f.factor1:f.factor,f.factor2);if(C.sizeGradients)for(const f of C.sizeGradients)M.addSizeGradient(f.gradient,void 0!==f.factor1?f.factor1:f.factor,f.factor2);if(C.angularSpeedGradients)for(const f of C.angularSpeedGradients)M.addAngularSpeedGradient(f.gradient,void 0!==f.factor1?f.factor1:f.factor,f.factor2);if(C.velocityGradients)for(const f of C.velocityGradients)M.addVelocityGradient(f.gradient,void 0!==f.factor1?f.factor1:f.factor,f.factor2);if(C.dragGradients)for(const f of C.dragGradients)M.addDragGradient(f.gradient,void 0!==f.factor1?f.factor1:f.factor,f.factor2);if(C.emitRateGradients)for(const f of C.emitRateGradients)M.addEmitRateGradient(f.gradient,void 0!==f.factor1?f.factor1:f.factor,f.factor2);if(C.startSizeGradients)for(const f of C.startSizeGradients)M.addStartSizeGradient(f.gradient,void 0!==f.factor1?f.factor1:f.factor,f.factor2);if(C.lifeTimeGradients)for(const f of C.lifeTimeGradients)M.addLifeTimeGradient(f.gradient,void 0!==f.factor1?f.factor1:f.factor,f.factor2);if(C.limitVelocityGradients){for(const x of C.limitVelocityGradients)M.addLimitVelocityGradient(x.gradient,void 0!==x.factor1?x.factor1:x.factor,x.factor2);M.limitVelocityDamping=C.limitVelocityDamping}if(C.noiseTexture&&z){const x=(0,S.c)("BABYLON.ProceduralTexture");M.noiseTexture=x.Parse(C.noiseTexture,z,T)}let Q;if(C.particleEmitterType){switch(C.particleEmitterType.type){case"SphereParticleEmitter":Q=new t;break;case"SphereDirectedParticleEmitter":Q=new A;break;case"ConeEmitter":case"ConeParticleEmitter":Q=new U;break;case"ConeDirectedParticleEmitter":Q=new O;break;case"CylinderParticleEmitter":Q=new d;break;case"CylinderDirectedParticleEmitter":Q=new D;break;case"HemisphericParticleEmitter":Q=new o;break;case"PointParticleEmitter":Q=new L;break;case"MeshParticleEmitter":Q=new b;break;case"CustomParticleEmitter":Q=new H;break;default:Q=new y}Q.parse(C.particleEmitterType,z)}else Q=new y,Q.parse(C,z);M.particleEmitterType=Q,M.startSpriteCellID=C.startSpriteCellID,M.endSpriteCellID=C.endSpriteCellID,M.spriteCellLoop=C.spriteCellLoop??!0,M.spriteCellWidth=C.spriteCellWidth,M.spriteCellHeight=C.spriteCellHeight,M.spriteCellChangeSpeed=C.spriteCellChangeSpeed,M.spriteRandomStartCell=C.spriteRandomStartCell,M.disposeOnStop=C.disposeOnStop??!1,M.manualEmitCount=C.manualEmitCount??-1}static Parse(C,M,x){let T=arguments.length>3&&void 0!==arguments[3]&&arguments[3],z=arguments.length>4?arguments[4]:void 0;const S=C.name;let m,Q,V=null,y=null;if(M instanceof mC.e?m=M:(Q=M,m=Q.getEngine()),C.customShader&&m.createEffectForParticles){y=C.customShader;const M=y.shaderOptions.defines.length>0?y.shaderOptions.defines.join("\n"):"";V=m.createEffectForParticles(y.shaderPath.fragmentElement,y.shaderOptions.uniforms,y.shaderOptions.samplers,M)}const U=new LC(S,z||C.Ie,M,V,C.isAnimationSheetEnabled);if(U.customShader=y,U._rootUrl=x,C.id&&(U.id=C.id),C.subEmitters){U.subEmitters=[];for(const f of C.subEmitters){const C=[];for(const T of f)C.push(SC.Parse(T,M,x));U.subEmitters.push(C)}}return LC._Parse(C,U,M,x),C.textureMask&&(U.textureMask=s.e.Dd(C.textureMask)),C.Gg&&(U.Gg=f.m.Dd(C.Gg)),C.preventAutoStart&&(U.preventAutoStart=C.preventAutoStart),T||U.preventAutoStart||U.start(),U}serialize(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const M={};if(LC._Serialize(M,this,C),M.textureMask=this.textureMask.Gd(),M.customShader=this.customShader,M.preventAutoStart=this.preventAutoStart,M.Gg=this.Gg.Gd(),this.subEmitters){M.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const x of this._subEmitters){const f=[];for(const M of x)f.push(M.serialize(C));M.subEmitters.push(f)}}return M}static _Serialize(C,M,x){if(C.name=M.name,C.id=M.id,C.Ie=M.getCapacity(),C.disposeOnStop=M.disposeOnStop,C.manualEmitCount=M.manualEmitCount,M.k.position){const x=M.k;C.emitterId=x.id}else{const x=M.k;C.k=x.Gd()}M.particleEmitterType&&(C.particleEmitterType=M.particleEmitterType.serialize()),M.particleTexture&&(x?C.texture=M.particleTexture.serialize():(C.textureName=M.particleTexture.name,C.invertY=!!M.particleTexture._invertY)),C.isLocal=M.isLocal,q.e.AppendSerializedAnimations(M,C),C.beginAnimationOnStart=M.beginAnimationOnStart,C.beginAnimationFrom=M.beginAnimationFrom,C.beginAnimationTo=M.beginAnimationTo,C.beginAnimationLoop=M.beginAnimationLoop,C.startDelay=M.startDelay,C.renderingGroupId=M.renderingGroupId,C.isBillboardBased=M.isBillboardBased,C.billboardMode=M.billboardMode,C.minAngularSpeed=M.minAngularSpeed,C.maxAngularSpeed=M.maxAngularSpeed,C.minSize=M.minSize,C.maxSize=M.maxSize,C.minScaleX=M.minScaleX,C.maxScaleX=M.maxScaleX,C.minScaleY=M.minScaleY,C.maxScaleY=M.maxScaleY,C.minEmitPower=M.minEmitPower,C.maxEmitPower=M.maxEmitPower,C.minLifeTime=M.minLifeTime,C.maxLifeTime=M.maxLifeTime,C.emitRate=M.emitRate,C.gravity=M.gravity.Gd(),C.noiseStrength=M.noiseStrength.Gd(),C.color1=M.color1.Gd(),C.color2=M.color2.Gd(),C.colorDead=M.colorDead.Gd(),C.updateSpeed=M.updateSpeed,C.targetStopDuration=M.targetStopDuration,C.blendMode=M.blendMode,C.preWarmCycles=M.preWarmCycles,C.preWarmStepOffset=M.preWarmStepOffset,C.minInitialRotation=M.minInitialRotation,C.maxInitialRotation=M.maxInitialRotation,C.startSpriteCellID=M.startSpriteCellID,C.spriteCellLoop=M.spriteCellLoop,C.endSpriteCellID=M.endSpriteCellID,C.spriteCellChangeSpeed=M.spriteCellChangeSpeed,C.spriteCellWidth=M.spriteCellWidth,C.spriteCellHeight=M.spriteCellHeight,C.spriteRandomStartCell=M.spriteRandomStartCell,C.isAnimationSheetEnabled=M.isAnimationSheetEnabled,C.useLogarithmicDepth=M.useLogarithmicDepth;const f=M.getColorGradients();if(f){C.colorGradients=[];for(const M of f){const x={gradient:M.gradient,color1:M.color1.Gd()};M.color2?x.color2=M.color2.Gd():x.color2=M.color1.Gd(),C.colorGradients.push(x)}}const T=M.getRampGradients();if(T){C.rampGradients=[];for(const M of T){const x={gradient:M.gradient,color:M.color.Gd()};C.rampGradients.push(x)}C.useRampGradients=M.useRampGradients}const z=M.getColorRemapGradients();if(z){C.colorRemapGradients=[];for(const M of z){const x={gradient:M.gradient,factor1:M.factor1};void 0!==M.factor2?x.factor2=M.factor2:x.factor2=M.factor1,C.colorRemapGradients.push(x)}}const s=M.getAlphaRemapGradients();if(s){C.alphaRemapGradients=[];for(const M of s){const x={gradient:M.gradient,factor1:M.factor1};void 0!==M.factor2?x.factor2=M.factor2:x.factor2=M.factor1,C.alphaRemapGradients.push(x)}}const S=M.getSizeGradients();if(S){C.sizeGradients=[];for(const M of S){const x={gradient:M.gradient,factor1:M.factor1};void 0!==M.factor2?x.factor2=M.factor2:x.factor2=M.factor1,C.sizeGradients.push(x)}}const m=M.getAngularSpeedGradients();if(m){C.angularSpeedGradients=[];for(const M of m){const x={gradient:M.gradient,factor1:M.factor1};void 0!==M.factor2?x.factor2=M.factor2:x.factor2=M.factor1,C.angularSpeedGradients.push(x)}}const Q=M.getVelocityGradients();if(Q){C.velocityGradients=[];for(const M of Q){const x={gradient:M.gradient,factor1:M.factor1};void 0!==M.factor2?x.factor2=M.factor2:x.factor2=M.factor1,C.velocityGradients.push(x)}}const V=M.getDragGradients();if(V){C.dragGradients=[];for(const M of V){const x={gradient:M.gradient,factor1:M.factor1};void 0!==M.factor2?x.factor2=M.factor2:x.factor2=M.factor1,C.dragGradients.push(x)}}const y=M.getEmitRateGradients();if(y){C.emitRateGradients=[];for(const M of y){const x={gradient:M.gradient,factor1:M.factor1};void 0!==M.factor2?x.factor2=M.factor2:x.factor2=M.factor1,C.emitRateGradients.push(x)}}const U=M.getStartSizeGradients();if(U){C.startSizeGradients=[];for(const M of U){const x={gradient:M.gradient,factor1:M.factor1};void 0!==M.factor2?x.factor2=M.factor2:x.factor2=M.factor1,C.startSizeGradients.push(x)}}const O=M.getLifeTimeGradients();if(O){C.lifeTimeGradients=[];for(const M of O){const x={gradient:M.gradient,factor1:M.factor1};void 0!==M.factor2?x.factor2=M.factor2:x.factor2=M.factor1,C.lifeTimeGradients.push(x)}}const d=M.getLimitVelocityGradients();if(d){C.limitVelocityGradients=[];for(const M of d){const x={gradient:M.gradient,factor1:M.factor1};void 0!==M.factor2?x.factor2=M.factor2:x.factor2=M.factor1,C.limitVelocityGradients.push(x)}C.limitVelocityDamping=M.limitVelocityDamping}M.noiseTexture&&(C.noiseTexture=M.noiseTexture.serialize())}clone(C,M){let x=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const f={...this._customWrappers};let T=null;const z=this._engine;if(z.createEffectForParticles&&null!=this.customShader){T=this.customShader;const C=T.shaderOptions.defines.length>0?T.shaderOptions.defines.join("\n"):"",M=z.createEffectForParticles(T.shaderPath.fragmentElement,T.shaderOptions.uniforms,T.shaderOptions.samplers,C);f[0]?f[0].effect=M:this.setCustomEffect(M,0)}const s=this.serialize(x),S=LC.Parse(s,this._scene||this._engine,this._rootUrl);return S.name=C,S.customShader=T,S._customWrappers=f,void 0===M&&(M=this.k),this.noiseTexture&&(S.noiseTexture=this.noiseTexture.clone()),S.k=M,this.preventAutoStart||S.start(),S}}LC.BILLBOARDMODE_Y=2,LC.BILLBOARDMODE_ALL=7,LC.BILLBOARDMODE_STRETCHED=8,LC.BILLBOARDMODE_STRETCHED_LOCAL=9,SC._ParseParticleSystem=LC.Parse;var tC=x(1201),AC=x(1190),HC=x(1383);HC.d.prototype.createTransformFeedback=function(){const C=this._gl.createTransformFeedback();if(!C)throw new Error("Unable to create Transform Feedback");return C},HC.d.prototype.deleteTransformFeedback=function(C){this._gl.deleteTransformFeedback(C)},HC.d.prototype.bindTransformFeedback=function(C){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,C)},HC.d.prototype.beginTransformFeedback=function(){let C=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(C?this._gl.POINTS:this._gl.TRIANGLES)},HC.d.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},HC.d.prototype.setTranformFeedbackVaryings=function(C,M){this._gl.transformFeedbackVaryings(C,M,this._gl.INTERLEAVED_ATTRIBS)},HC.d.prototype.bindTransformFeedbackBuffer=function(C){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,C?C.underlyingResource:null)},HC.d.prototype.readTransformFeedbackBuffer=function(C){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,C)};const jC="clipPlaneFragmentDeclaration2",bC="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";I.d.IncludesShadersStore[jC]=bC;x(11249),x(11131),x(11053),x(11254),x(11274),x(11281),x(11310),x(11314);const RC="gpuRenderParticlesPixelShader",nC="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";I.d.ShadersStore[RC]=nC;const IC="clipPlaneVertexDeclaration2",XC="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";I.d.IncludesShadersStore[IC]=XC;x(11103),x(11184),x(11186),x(11207);const gC="gpuRenderParticlesVertexShader",BC="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";I.d.ShadersStore[gC]=BC;class FC extends m{static get IsSupported(){if(!w.c.LastCreatedEngine)return!1;const C=w.c.LastCreatedEngine.getCaps();return C.supportTransformFeedbacks||C.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(C){this._maxActiveParticleCount=Math.min(C,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(C){this.maxActiveParticleCount=C}createPointEmitter(C,M){const x=QC(C,M);return this.particleEmitterType=x,x}createHemisphericEmitter(){const C=VC(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=C,C}createSphereEmitter(){const C=yC(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=C,C}createDirectedSphereEmitter(){const C=UC(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new f.m(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new f.m(0,1,0));return this.particleEmitterType=C,C}createCylinderEmitter(){const C=OC(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=C,C}createDirectedCylinderEmitter(){const C=dC(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new f.m(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new f.m(0,1,0));return this.particleEmitterType=C,C}createConeEmitter(){const C=DC(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=C,C}createDirectedConeEmitter(){const C=oC(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new f.m(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new f.m(0,1,0));return this.particleEmitterType=C,C}createBoxEmitter(C,M,x,f){const T=new y;return this.particleEmitterType=T,this.direction1=C,this.direction2=M,this.minEmitBox=x,this.maxEmitBox=f,T}isReady(){if(!this.k||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==LC.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(LC.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(LC.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";C?setTimeout((()=>{this.start(0)}),C):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var C;let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(C=this._customWrappers[M])||void 0===C?void 0:C.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[C]??this._customWrappers[0]}setCustomEffect(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[M]=new CC.d(this._engine),this._customWrappers[M].effect=C}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new e.c),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(C,M,x){return super._removeGradientAndTexture(C,M,x),this._releaseBuffers(),this}addColorGradient(C,M){this._colorGradients||(this._colorGradients=[]);const x=new p(C,M);return this._colorGradients.push(x),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(C&&this._colorGradients.sort(((C,M)=>C.gradient<M.gradient?-1:C.gradient>M.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(C){return this._removeGradientAndTexture(C,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const M in this._drawWrappers){var C;null===(C=this._drawWrappers[M].drawContext)||void 0===C||C.reset()}}_addFactorGradient(C,M,x){const f=new Y(M,x);C.push(f),this._releaseBuffers()}addSizeGradient(C,M){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,C,M),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(C){return this._removeGradientAndTexture(C,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(C,M){if(!C)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&C.sort(((C,M)=>C.gradient<M.gradient?-1:C.gradient>M.gradient?1:0));const x=this;x[M]&&(x[M].dispose(),x[M]=null)}addAngularSpeedGradient(C,M){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,C,M),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(C){return this._removeGradientAndTexture(C,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(C,M){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,C,M),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(C){return this._removeGradientAndTexture(C,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(C,M){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,C,M),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(C){return this._removeGradientAndTexture(C,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(C,M){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,C,M),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(C){return this._removeGradientAndTexture(C,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(C){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(C,M,x){let T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,z=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(C),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.Sd=new e.c,this.onStoppedObservable=new e.c,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._onBeforeDrawParticlesObservable=null,x&&"Scene"!==x.getClassName()?(this._engine=x,this.defaultProjectionMatrix=f.d.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=x||w.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.te.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,S.c)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,S.c)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,S.c)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,S.c)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new CC.d(this._engine)},this._customWrappers[0].effect=T,this._drawWrappers={0:new CC.d(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(M=M??{}).randomTextureSize||delete M.randomTextureSize;const s={Ie:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...M},m=M;isFinite(m)&&(s.Ie=m),this._capacity=s.Ie,this._maxActiveParticleCount=s.Ie,this._currentActiveCount=0,this._isAnimationSheetEnabled=z,this.particleEmitterType=new y;const Q=Math.min(this._engine.getCaps().maxTextureSize,s.randomTextureSize);let V=[];for(let f=0;f<Q;++f)V.push(Math.random()),V.push(Math.random()),V.push(Math.random()),V.push(Math.random());this._randomTexture=new r.e(new Float32Array(V),Q,1,5,x,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,V=[];for(let f=0;f<Q;++f)V.push(Math.random()),V.push(Math.random()),V.push(Math.random()),V.push(Math.random());this._randomTexture2=new r.e(new Float32Array(V),Q,1,5,x,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=Q}_reset(){this._releaseBuffers()}_createVertexBuffers(C,M,x){const f={};f.position=M.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let T=3;f.age=M.createVertexBuffer("age",T,1,this._attributesStrideSize,!0),T+=1,f.size=M.createVertexBuffer("size",T,3,this._attributesStrideSize,!0),T+=3,f.life=M.createVertexBuffer("life",T,1,this._attributesStrideSize,!0),T+=1,T+=4,this.billboardMode===LC.BILLBOARDMODE_STRETCHED&&(f.direction=M.createVertexBuffer("direction",T,3,this._attributesStrideSize,!0)),T+=3,this._platform.alignDataInBuffer&&(T+=1),this.particleEmitterType instanceof H&&(T+=3,this._platform.alignDataInBuffer&&(T+=1)),this._colorGradientsTexture||(f.color=M.createVertexBuffer("color",T,4,this._attributesStrideSize,!0),T+=4),this._isBillboardBased||(f.initialDirection=M.createVertexBuffer("initialDirection",T,3,this._attributesStrideSize,!0),T+=3,this._platform.alignDataInBuffer&&(T+=1)),this.noiseTexture&&(f.noiseCoordinates1=M.createVertexBuffer("noiseCoordinates1",T,3,this._attributesStrideSize,!0),T+=3,this._platform.alignDataInBuffer&&(T+=1),f.noiseCoordinates2=M.createVertexBuffer("noiseCoordinates2",T,3,this._attributesStrideSize,!0),T+=3,this._platform.alignDataInBuffer&&(T+=1)),f.angle=M.createVertexBuffer("angle",T,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?T++:T+=2,this._isAnimationSheetEnabled&&(f.cellIndex=M.createVertexBuffer("cellIndex",T,1,this._attributesStrideSize,!0),T+=1,this.spriteRandomStartCell&&(f.cellStartOffset=M.createVertexBuffer("cellStartOffset",T,1,this._attributesStrideSize,!0),T+=1)),f.offset=x.createVertexBuffer("offset",0,2),f.uv=x.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(f),this._platform.createVertexBuffers(C,f),this.resetDrawCache()}_initialize(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!C)return;const M=this._engine,x=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof H&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const T=this.particleEmitterType instanceof H,z=f.i.Md[0];let s=0;for(let f=0;f<this._capacity;f++)if(x.push(0),x.push(0),x.push(0),x.push(0),x.push(0),x.push(0),x.push(0),x.push(0),x.push(Math.random()),x.push(Math.random()),x.push(Math.random()),x.push(Math.random()),T?(this.particleEmitterType.particleDestinationGenerator(f,null,z),x.push(z.x),x.push(z.y),x.push(z.z)):(x.push(0),x.push(0),x.push(0)),this._platform.alignDataInBuffer&&x.push(0),s+=16,T&&(this.particleEmitterType.particlePositionGenerator(f,null,z),x.push(z.x),x.push(z.y),x.push(z.z),this._platform.alignDataInBuffer&&x.push(0),s+=4),this._colorGradientsTexture||(x.push(0),x.push(0),x.push(0),x.push(0),s+=4),this.isBillboardBased||(x.push(0),x.push(0),x.push(0),this._platform.alignDataInBuffer&&x.push(0),s+=4),this.noiseTexture&&(x.push(Math.random()),x.push(Math.random()),x.push(Math.random()),this._platform.alignDataInBuffer&&x.push(0),x.push(Math.random()),x.push(Math.random()),x.push(Math.random()),this._platform.alignDataInBuffer&&x.push(0),s+=8),x.push(0),s+=1,this._angularSpeedGradientsTexture||(x.push(0),s+=1),this._isAnimationSheetEnabled&&(x.push(0),s+=1,this.spriteRandomStartCell&&(x.push(0),s+=1)),this._platform.alignDataInBuffer){let C=3-(s+3&3);for(s+=C;C-- >0;)x.push(0)}const S=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),m=this._platform.createParticleBuffer(x),Q=this._platform.createParticleBuffer(x);this._buffer0=new j.e(M,m,!1,this._attributesStrideSize),this._buffer1=new j.e(M,Q,!1,this._attributesStrideSize),this._spriteBuffer=new j.e(M,S,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let C=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(C+="\n#define BILLBOARD"),this._colorGradientsTexture&&(C+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(C+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(C+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(C+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(C+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(C+="\n#define DRAGGRADIENTS"),this.isAnimationSheetEnabled&&(C+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(C+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(C+="\n#define NOISE"),this.isLocal&&(C+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===C||(this._cachedUpdateDefines=C,this._updateBuffer=this._platform.createUpdateBuffer(C)),this._platform.isUpdateBufferReady()}_getWrapper(C){const M=this._getCustomDrawWrapper(C);if(null!==M&&void 0!==M&&M.effect)return M;const x=[];this.fillDefines(x,C);let f=this._drawWrappers[C];f||(f=new CC.d(this._engine),f.drawContext&&(f.drawContext.useInstancing=!0),this._drawWrappers[C]=f);const T=x.join("\n");if(f.defines!==T){const C=[],M=[],x=[];this.fillUniformsAttributesAndSamplerNames(M,C,x),f.setEffect(this._engine.createEffect("gpuRenderParticles",C,M,x,T),T)}return f}static _GetAttributeNamesOrOptions(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0],M=arguments.length>1&&void 0!==arguments[1]&&arguments[1],x=arguments.length>2&&void 0!==arguments[2]&&arguments[2],f=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const T=[j.h.PositionKind,"age","life","size","angle"];return C||T.push(j.h.ColorKind),M&&T.push("cellIndex"),x||T.push("initialDirection"),f&&T.push("direction"),T.push("offset",j.h.UVKind),T}static _GetEffectCreationOptions(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0],M=arguments.length>1&&void 0!==arguments[1]&&arguments[1],x=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const f=["emitterWM","Gg","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,MC.b)(f),C&&f.push("sheetInfos"),M&&f.push("logarithmicDepthConstant"),x&&(f.push("vFogInfos"),f.push("vFogColor")),f}fillDefines(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,x=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,MC.k)(this,this._scene,C),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==AC.e.FOGMODE_NONE&&C.push("#define FOG")),M===LC.BLENDMODE_MULTIPLY&&C.push("#define BLENDMULTIPLYMODE"),this.isLocal&&C.push("#define LOCAL"),this.useLogarithmicDepth&&C.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(C.push("#define BILLBOARD"),this.billboardMode){case LC.BILLBOARDMODE_Y:C.push("#define BILLBOARDY");break;case LC.BILLBOARDMODE_STRETCHED:C.push("#define BILLBOARDSTRETCHED");break;case LC.BILLBOARDMODE_ALL:C.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&C.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&C.push("#define ANIMATESHEET"),x&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),C.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(C,M,x){M.push(...FC._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===LC.BILLBOARDMODE_STRETCHED)),C.push(...FC._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),x.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(tC.c.PrepareUniforms(C,this._imageProcessingConfigurationDefines),tC.c.PrepareSamplers(x,this._imageProcessingConfigurationDefines))}animate(){var C;let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(M?this.preWarmStepOffset:(null===(C=this._scene)||void 0===C?void 0:C.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(C,M){const x=this[M];if(!C||!C.length||x)return;const f=new Float32Array(this._rawTextureWidth);for(let T=0;T<this._rawTextureWidth;T++){const M=T/this._rawTextureWidth;W.GetCurrentGradient(M,C,((C,M,x)=>{f[T]=(0,Q.q)(C.factor1,M.factor1,x)}))}this[M]=r.e.CreateRTexture(f,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[M].name=M.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const C=new Uint8Array(4*this._rawTextureWidth),M=s.f.ae[0];for(let x=0;x<this._rawTextureWidth;x++){const f=x/this._rawTextureWidth;W.GetCurrentGradient(f,this._colorGradients,((f,T,z)=>{s.e.LerpToRef(f.color1,T.color1,z,M),C[4*x]=255*M.r,C[4*x+1]=255*M.g,C[4*x+2]=255*M.b,C[4*x+3]=255*M.a}))}this._colorGradientsTexture=r.e.CreateRGBATexture(C,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(C,M){var x,T,z,s;const S=this._getWrapper(C),m=S.effect;this._engine.enableEffect(S);const Q=(null===(x=this._scene)||void 0===x?void 0:x.getViewMatrix())||f.d.IdentityReadOnly;if(m.setMatrix("view",Q),m.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),m.setTexture("diffuseSampler",this.particleTexture),m.setVector2("translationPivot",this.translationPivot),m.setVector3("Gg",this.Gg),this.isLocal&&m.setMatrix("emitterWM",M),this._colorGradientsTexture?m.setTexture("colorGradientSampler",this._colorGradientsTexture):m.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const C=this.particleTexture.getBaseSize();m.setFloat3("sheetInfos",this.spriteCellWidth/C.width,this.spriteCellHeight/C.height,C.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const C=this._scene.activeCamera;m.setVector3("eyePosition",C.globalPosition)}const V=m.defines;if(this._scene&&((0,MC.f)(m,this,this._scene),this.applyFog&&(0,xC.f)(this._scene,void 0,m)),V.indexOf("#define BILLBOARDMODE_ALL")>=0){const C=Q.clone();C.invert(),m.setMatrix("invView",C)}switch(this.useLogarithmicDepth&&this._scene&&(0,xC.j)(V,m,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(m),C){case LC.BLENDMODE_ADD:this._engine.setAlphaMode(1);break;case LC.BLENDMODE_ONEONE:this._engine.setAlphaMode(6);break;case LC.BLENDMODE_STANDARD:this._engine.setAlphaMode(2);break;case LC.BLENDMODE_MULTIPLY:this._engine.setAlphaMode(4)}return this._platform.bindDrawBuffers(this._targetIndex,m,null!==(T=this._scene)&&void 0!==T&&T.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(m),null!==(z=this._scene)&&void 0!==z&&z.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(s=this._scene)&&void 0!==s&&s.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(C){if(!this.k||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!C)if(this.k.position){C=this.k.getWorldMatrix()}else{const M=this.k;C=f.i.Matrix[0],f.d.TranslationToRef(M.x,M.y,M.z,C)}this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this.isLocal||this._updateBuffer.setMatrix("emitterWM",C),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const M=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=M}render(){let C,M=arguments.length>0&&void 0!==arguments[0]&&arguments[0],x=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!M&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let C=0;C<this.preWarmCycles;C++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>1){const C=0|this._accumulatedCount;this._accumulatedCount-=C,this._currentActiveCount+=C}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.k.position){C=this.k.getWorldMatrix()}else{const M=this.k;C=f.i.Matrix[0],f.d.TranslationToRef(M.x,M.y,M.z,C)}const T=this._engine;this.updateInAnimate||this._update(C);let z=0;return M||x||(T.setState(!1),this.forceDepthWrite&&T.setDepthWrite(!0),z=this.blendMode===LC.BLENDMODE_MULTIPLYADD?this._render(LC.BLENDMODE_MULTIPLY,C)+this._render(LC.BLENDMODE_ADD,C):this._render(this.blendMode,C),this._engine.setAlphaMode(0)),z}rebuild(){const C=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(C,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,C()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let C=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const M in this._drawWrappers){this._drawWrappers[M].dispose()}if(this._drawWrappers={},this._scene){const C=this._scene.te.indexOf(this);C>-1&&this._scene.te.splice(C,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let M=0;M<this._renderVertexBuffers.length;++M){const C=this._renderVertexBuffers[M];for(const M in C)C[M].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),C&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),C&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.Sd.notifyObservers(this),this.Sd.clear()}clone(C,M){let x=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const f={...this._customWrappers};let T=null;const z=this._engine;if(z.createEffectForParticles&&null!=this.customShader){T=this.customShader;const C=T.shaderOptions.defines.length>0?T.shaderOptions.defines.join("\n"):"";f[0]=z.createEffectForParticles(T.shaderPath.fragmentElement,T.shaderOptions.uniforms,T.shaderOptions.samplers,C,void 0,void 0,void 0,this)}const s=this.serialize(x),S=FC.Parse(s,this._scene||this._engine,this._rootUrl);return S.name=C,S.customShader=T,S._customWrappers=f,void 0===M&&(M=this.k),this.noiseTexture&&(S.noiseTexture=this.noiseTexture.clone()),S.k=M,S}serialize(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const M={};return LC._Serialize(M,this,C),M.activeParticleCount=this.activeParticleCount,M.randomTextureSize=this._randomTextureSize,M.customShader=this.customShader,M}static Parse(C,M,x){let f=arguments.length>3&&void 0!==arguments[3]&&arguments[3],T=arguments.length>4?arguments[4]:void 0;const z=C.name;let s,S;M instanceof mC.e?s=M:(S=M,s=S.getEngine());const m=new FC(z,{Ie:T||C.Ie,randomTextureSize:C.randomTextureSize},M,null,C.isAnimationSheetEnabled);if(m._rootUrl=x,C.customShader&&s.createEffectForParticles){const M=C.customShader,x=M.shaderOptions.defines.length>0?M.shaderOptions.defines.join("\n"):"",f=s.createEffectForParticles(M.shaderPath.fragmentElement,M.shaderOptions.uniforms,M.shaderOptions.samplers,x,void 0,void 0,void 0,m);m.setCustomEffect(f,0),m.customShader=M}return C.id&&(m.id=C.id),C.activeParticleCount&&(m.activeParticleCount=C.activeParticleCount),LC._Parse(C,m,M,x),C.preventAutoStart&&(m.preventAutoStart=C.preventAutoStart),f||m.preventAutoStart||m.start(),m}}var PC=x(1192),hC=x(11873),cC=x(1180);class qC{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(C){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const M of this.systems)M.k=C;this._emitterNode=C}setEmitterAsSphere(C,M,x){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:C,renderingGroupId:M};const f=(0,hC.d)("emitterSphere",{diameter:C.diameter,segments:C.segments},x);f.renderingGroupId=M;const T=new cC.b("emitterSphereMaterial",x);T.emissiveColor=C.color,f.material=T;for(const z of this.systems)z.k=f;this._emitterNode=f}start(C){for(const M of this.systems)C&&(M.k=C),M.start()}dispose(){for(const C of this.systems)C.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const M={systems:[]};for(const x of this.systems)M.systems.push(x.serialize(C));return this._emitterNode&&(M.k=this._emitterCreationOptions),M}static Parse(C,M){let x=arguments.length>2&&void 0!==arguments[2]&&arguments[2],f=arguments.length>3?arguments[3]:void 0;const T=new qC,z=this.BaseAssetsUrl+"/textures/";M=M||w.c.LastCreatedScene;for(const s of C.systems)T.systems.push(x?FC.Parse(s,M,z,!0,f):LC.Parse(s,M,z,!0,f));if(C.k){const x=C.k.options;if("Sphere"===C.k.kind)T.setEmitterAsSphere({diameter:x.diameter,segments:x.segments,color:s.d.Dd(x.color)},C.k.renderingGroupId,M)}return T}}qC.BaseAssetsUrl="https://assets.babylonjs.com/particles";var iC=x(1042);class ZC{static CreateDefault(C){let M,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,f=arguments.length>2?arguments[2]:void 0;return M=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new FC("default system",{Ie:x},f):new LC("default system",x,f),M.k=C,M.particleTexture=new i.b("https://assets.babylonjs.com/textures/flare.png",M.va()),M.createConeEmitter(.1,Math.PI/4),M.color1=new s.e(1,1,1,1),M.color2=new s.e(1,1,1,1),M.colorDead=new s.e(1,1,1,0),M.minSize=.1,M.maxSize=.1,M.minEmitPower=2,M.maxEmitPower=2,M.updateSpeed=1/60,M.emitRate=30,M}static CreateAsync(C,M){let x=arguments.length>2&&void 0!==arguments[2]&&arguments[2],f=arguments.length>3?arguments[3]:void 0;M||(M=w.c.LastCreatedScene);const T={};return M.addPendingData(T),new Promise(((z,s)=>{if(x&&!FC.IsSupported)return M.removePendingData(T),s("Particle system with GPU is not supported.");PC.i.LoadFile(`${ZC.BaseAssetsUrl}/systems/${C}.json`,(C=>{M.removePendingData(T);const s=JSON.parse(C.toString());return z(qC.Parse(s,M,x,f))}),void 0,void 0,void 0,(()=>(M.removePendingData(T),s(`An error occurred with the creation of your particle system. Check if your type '${C}' exists.`))))}))}static ExportSet(C){const M=new qC;for(const x of C)M.systems.push(x);return M}static ParseFromFileAsync(C,M,x){let f=arguments.length>3&&void 0!==arguments[3]&&arguments[3],T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",z=arguments.length>5?arguments[5]:void 0;return new Promise(((s,S)=>{const m=new iC.d;m.addEventListener("readystatechange",(()=>{if(4==m.readyState)if(200==m.status){const M=JSON.parse(m.responseText);let S;S=f?FC.Parse(M,x,T,!1,z):LC.Parse(M,x,T,!1,z),C&&(S.name=C),s(S)}else S("Unable to load the particle system")})),m.open("GET",M),m.send()}))}static ParseFromSnippetAsync(C,M){let x=arguments.length>2&&void 0!==arguments[2]&&arguments[2],f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",T=arguments.length>4?arguments[4]:void 0;if("_BLANK"===C){const C=this.CreateDefault(null);return C.start(),Promise.resolve(C)}return new Promise(((z,s)=>{const S=new iC.d;S.addEventListener("readystatechange",(()=>{if(4==S.readyState)if(200==S.status){const s=JSON.parse(JSON.parse(S.responseText).jsonPayload),m=JSON.parse(s.particleSystem);let Q;Q=x?FC.Parse(m,M,f,!1,T):LC.Parse(m,M,f,!1,T),Q.snippetId=C,z(Q)}else s("Unable to load the snippet "+C)})),S.open("GET",this.SnippetUrl+"/"+C.replace(/#/g,"/")),S.send()}))}}ZC.BaseAssetsUrl=qC.BaseAssetsUrl,ZC.SnippetUrl="https://snippet.babylonjs.com",ZC.CreateFromSnippetAsync=ZC.ParseFromSnippetAsync;var EC=x(11712),KC=x(1239),GC=x(11879);(0,GC.e)(KC.d.NAME_PARTICLESYSTEM,((C,M,x,f)=>{const T=(0,GC.f)(KC.d.NAME_PARTICLESYSTEM);if(T&&void 0!==C.te&&null!==C.te)for(let z=0,s=C.te.length;z<s;z++){const s=C.te[z];x.te.push(T(s,M,f))}})),(0,GC.b)(KC.d.NAME_PARTICLESYSTEM,((C,M,x)=>{if(C.activeParticleCount){return FC.Parse(C,M,x)}return LC.Parse(C,M,x)})),mC.e.prototype.createEffectForParticles=function(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",z=arguments.length>4?arguments[4]:void 0,s=arguments.length>5?arguments[5]:void 0,S=arguments.length>6?arguments[6]:void 0,m=arguments.length>7?arguments[7]:void 0,Q=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,V=[],y=[];const U=[];return m?m.fillUniformsAttributesAndSamplerNames(y,V,U):(V=LC._GetAttributeNamesOrOptions(),y=LC._GetEffectCreationOptions()),-1===T.indexOf(" BILLBOARD")&&(T+="\n#define BILLBOARD\n"),null!==m&&void 0!==m&&m.isAnimationSheetEnabled&&-1===T.indexOf(" ANIMATESHEET")&&(T+="\n#define ANIMATESHEET\n"),-1===f.indexOf("diffuseSampler")&&f.push("diffuseSampler"),this.createEffect({vertex:(null===m||void 0===m?void 0:m.vertexShaderName)??"particles",fragmentElement:C},V,y.concat(M),U.concat(f),T,z,s,S,void 0,Q,(async()=>{0===Q?await Promise.resolve().then(x.bind(x,11896)):await Promise.resolve().then(x.bind(x,11903))}))},EC.d.prototype.getEmittedParticleSystems=function(){const C=[];for(let M=0;M<this.va().te.length;M++){const x=this.va().te[M];x.k===this&&C.push(x)}return C},EC.d.prototype.getHierarchyEmittedParticleSystems=function(){const C=[],M=this.getDescendants();M.push(this);for(let x=0;x<this.va().te.length;x++){const f=this.va().te[x],T=f.k;T.position&&-1!==M.indexOf(T)&&C.push(f)}return C};x(1300),x(1309),x(11763);x(11739),x(11883),x(1447),x(1294),x(11768);x(1443);var aC;x(11891),x(1019);!function(C){C[C.Color=2]="Color",C[C.UV=1]="UV",C[C.Random=0]="Random",C[C.Stated=3]="Stated"}(aC||(aC={}));x(11893),x(11896),x(11900),x(11903)},10969:(C,M,x)=>{"use strict";const f="clipPlaneFragment",T="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";x(1098).d.IncludesShadersStoreWGSL[f]=T},10955:(C,M,x)=>{"use strict";const f="clipPlaneFragmentDeclaration",T="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";x(1098).d.IncludesShadersStoreWGSL[f]=T},10865:(C,M,x)=>{"use strict";const f="clipPlaneVertex",T="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";x(1098).d.IncludesShadersStoreWGSL[f]=T},10789:(C,M,x)=>{"use strict";const f="clipPlaneVertexDeclaration",T="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";x(1098).d.IncludesShadersStoreWGSL[f]=T},11004:(C,M,x)=>{"use strict";const f="fogFragment",T="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";x(1098).d.IncludesShadersStoreWGSL[f]=T},10960:(C,M,x)=>{"use strict";const f="fogFragmentDeclaration",T="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";x(1098).d.IncludesShadersStoreWGSL[f]=T},10868:(C,M,x)=>{"use strict";const f="fogVertex",T="#ifdef FOG\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#endif\n";x(1098).d.IncludesShadersStoreWGSL[f]=T},10797:(C,M,x)=>{"use strict";const f="fogVertexDeclaration",T="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";x(1098).d.IncludesShadersStoreWGSL[f]=T},10740:(C,M,x)=>{"use strict";const f="helperFunctions",T="const PI: f32=3.1415926535897932384626433832795;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3<f32>=vec3<f32> (0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(0.0),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);} \nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3<f32>=inMatrix[0];let i1: vec3<f32>=inMatrix[1];let i2: vec3<f32>=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3<f32>)->vec3<f32>\n{let nearZeroSection: vec3<f32>=0.0773993808*color;let remainingSection: vec3<f32>=pow(0.947867299*(color+vec3<f32>(0.055)),vec3<f32>(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3<f32>(0.04045)));}\nfn toGammaSpaceExact(color: vec3<f32>)->vec3<f32>\n{let nearZeroSection: vec3<f32>=12.92*color;let remainingSection: vec3<f32>=1.055*pow(color,vec3<f32>(0.41666))-vec3<f32>(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3<f32>(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3<f32>)->vec3<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3<f32>(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3<f32>(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3<f32>)->vec3<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3<f32>(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3<f32>)->vec3<f32>\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3<f32>)->f32\n{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3<f32>)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3<f32> =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(clamp(rgb,vec3<f32>(0.,0.,0.),vec3<f32>(1.,1.,1.)),D); }\nfn fromRGBD(rgbd: vec4<f32>)->vec3<f32> {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3<f32>,origVec: vec3<f32>,cubeSize: vec3<f32>,cubePos: vec3<f32>)->vec3<f32> {let invOrigVec: vec3<f32>=vec3<f32>(1.0,1.0,1.0)/origVec;let halfSize: vec3<f32>=cubeSize*0.5;let intersecAtMaxPlane: vec3<f32>=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3<f32>=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3<f32>=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3<f32>=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\n";x(1098).d.IncludesShadersStoreWGSL[f]=T},10932:(C,M,x)=>{"use strict";const f="imageProcessingDeclaration",T="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";x(1098).d.IncludesShadersStoreWGSL[f]=T},10941:(C,M,x)=>{"use strict";const f="imageProcessingFunctions",T="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";x(1098).d.IncludesShadersStoreWGSL[f]=T},10811:(C,M,x)=>{"use strict";const f="logDepthDeclaration",T="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";x(1098).d.IncludesShadersStoreWGSL[f]=T},11e3:(C,M,x)=>{"use strict";const f="logDepthFragment",T="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";x(1098).d.IncludesShadersStoreWGSL[f]=T},10884:(C,M,x)=>{"use strict";const f="logDepthVertex",T="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";x(1098).d.IncludesShadersStoreWGSL[f]=T},11900:(C,M,x)=>{"use strict";x.r(M),x.d(M,{particlesPixelShaderWGSL:()=>s});var f=x(1098);x(10955),x(10932),x(10811),x(10740),x(10941),x(10960),x(10969),x(11e3),x(11004);const T="particlesPixelShader",z="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";f.d.ShadersStoreWGSL[T]=z;const s={name:T,shader:z}},11903:(C,M,x)=>{"use strict";x.r(M),x.d(M,{particlesVertexShaderWGSL:()=>s});var f=x(1098);x(10789),x(10797),x(10811),x(10865),x(10868),x(10884);const T="particlesVertexShader",z="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return input.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";f.d.ShadersStoreWGSL[T]=z;const s={name:T,shader:z}},11281:(C,M,x)=>{"use strict";const f="clipPlaneFragment",T="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";x(1098).d.IncludesShadersStore[f]=T},11267:(C,M,x)=>{"use strict";const f="clipPlaneFragmentDeclaration",T="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";x(1098).d.IncludesShadersStore[f]=T},11184:(C,M,x)=>{"use strict";const f="clipPlaneVertex",T="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";x(1098).d.IncludesShadersStore[f]=T},11094:(C,M,x)=>{"use strict";const f="clipPlaneVertexDeclaration",T="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";x(1098).d.IncludesShadersStore[f]=T},11314:(C,M,x)=>{"use strict";const f="fogFragment",T="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";x(1098).d.IncludesShadersStore[f]=T},11274:(C,M,x)=>{"use strict";const f="fogFragmentDeclaration",T="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";x(1098).d.IncludesShadersStore[f]=T},11186:(C,M,x)=>{"use strict";const f="fogVertex",T="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";x(1098).d.IncludesShadersStore[f]=T},11103:(C,M,x)=>{"use strict";const f="fogVertexDeclaration",T="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";x(1098).d.IncludesShadersStore[f]=T},11053:(C,M,x)=>{"use strict";const f="helperFunctions",T="const float PI=3.1415926535897932384626433832795;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.0;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(clamp(rgb,0.,1.),D); }\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.0,1.0,1.0)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\n";x(1098).d.IncludesShadersStore[f]=T},11249:(C,M,x)=>{"use strict";const f="imageProcessingDeclaration",T="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";x(1098).d.IncludesShadersStore[f]=T},11254:(C,M,x)=>{"use strict";const f="imageProcessingFunctions",T="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";x(1098).d.IncludesShadersStore[f]=T},11131:(C,M,x)=>{"use strict";const f="logDepthDeclaration",T="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";x(1098).d.IncludesShadersStore[f]=T},11310:(C,M,x)=>{"use strict";const f="logDepthFragment",T="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";x(1098).d.IncludesShadersStore[f]=T},11207:(C,M,x)=>{"use strict";const f="logDepthVertex",T="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";x(1098).d.IncludesShadersStore[f]=T},11893:(C,M,x)=>{"use strict";x.r(M),x.d(M,{particlesPixelShader:()=>s});var f=x(1098);x(11267),x(11249),x(11131),x(11053),x(11254),x(11274),x(11281),x(11310),x(11314);const T="particlesPixelShader",z="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";f.d.ShadersStore[T]=z;const s={name:T,shader:z}},11896:(C,M,x)=>{"use strict";x.r(M),x.d(M,{particlesVertexShader:()=>s});var f=x(1098);x(11094),x(11103),x(11131),x(11184),x(11186),x(11207);const T="particlesVertexShader",z="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";f.d.ShadersStore[T]=z;const s={name:T,shader:z}},11734:(C,M,x)=>{"use strict";x.d(M,{e:()=>y});var f=x(951),T=x(978),z=x(959),s=x(971),S=x(1008),m=x(1067),Q=x(1145);class V{constructor(){this._doNotSerialize=!1,this._isDisposed=!1,this._sceneRootNodesIndex=-1,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._onEnabledStateChangedObservable=new s.c,this._onClonedObservable=new s.c}}class y{static AddNodeConstructor(C,M){this._NodeConstructors[C]=M}static Construct(C,M,x,f){const T=this._NodeConstructors[C];return T?T(M,x,f):null}set accessibilityTag(C){this._accessibilityTag=C,this.onAccessibilityTagChangedObservable.notifyObservers(C)}get accessibilityTag(){return this._accessibilityTag}get doNotSerialize(){return!!this._nodeDataStorage._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize}set doNotSerialize(C){this._nodeDataStorage._doNotSerialize=C}u(){return this._nodeDataStorage._isDisposed}set parent(C){if(this._parentNode===C)return;const M=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){const M=this._parentNode._children.indexOf(this);-1!==M&&this._parentNode._children.splice(M,1),C||this._nodeDataStorage._isDisposed||this._addToSceneRootNodes()}this._parentNode=C,this._isDirty=!0,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),M||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}get parent(){return this._parentNode}_serializeAsParent(C){C.parentId=this.uniqueId}_addToSceneRootNodes(){-1===this._nodeDataStorage._sceneRootNodesIndex&&(this._nodeDataStorage._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))}_removeFromSceneRootNodes(){if(-1!==this._nodeDataStorage._sceneRootNodesIndex){const C=this._scene.rootNodes,M=C.length-1;C[this._nodeDataStorage._sceneRootNodesIndex]=C[M],C[this._nodeDataStorage._sceneRootNodesIndex]._nodeDataStorage._sceneRootNodesIndex=this._nodeDataStorage._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._nodeDataStorage._sceneRootNodesIndex=-1}}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(C){this._animationPropertiesOverride=C}getClassName(){return"Node"}set onDispose(C){this._onDisposeObserver&&this.Sd.remove(this._onDisposeObserver),this._onDisposeObserver=this.Sd.add(C)}get onEnabledStateChangedObservable(){return this._nodeDataStorage._onEnabledStateChangedObservable}get onClonedObservable(){return this._nodeDataStorage._onClonedObservable}constructor(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,x=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._isDirty=!1,this._nodeDataStorage=new V,this.state="",this.metadata=null,this.reservedDataStore=null,this._accessibilityTag=null,this.onAccessibilityTagChangedObservable=new s.c,this._parentContainer=null,this.animations=[],this._ranges={},this.onReady=null,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._waitingParentInstanceIndex=null,this._waitingParsedUniqueId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=T.d.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._animationPropertiesOverride=null,this._isNode=!0,this.Sd=new s.c,this._onDisposeObserver=null,this._behaviors=new Array,this.name=C,this.id=C,this._scene=M||S.c.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache(),x&&this._addToSceneRootNodes()}va(){return this._scene}getEngine(){return this._scene.getEngine()}addBehavior(C){let M=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return-1!==this._behaviors.indexOf(C)||(C.init(),this._scene.isLoading&&!M?this._scene.onDataLoadedObservable.addOnce((()=>{C.attach(this)})):C.attach(this),this._behaviors.push(C)),this}removeBehavior(C){const M=this._behaviors.indexOf(C);return-1===M||(this._behaviors[M].detach(),this._behaviors.splice(M,1)),this}get behaviors(){return this._behaviors}getBehaviorByName(C){for(const M of this._behaviors)if(M.name===C)return M;return null}getWorldMatrix(){return this._currentRenderId!==this._scene.getRenderId()&&this.Be(),this._worldMatrix}_getWorldMatrixDeterminant(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant}get worldMatrixFromCache(){return this._worldMatrix}_initCache(){this._cache={}}updateCache(C){!C&&this.isSynchronized()||this._updateCache()}_getActionManagerForTrigger(C){return this.parent?this.parent._getActionManagerForTrigger(C,!1):null}_updateCache(C){}_isSynchronized(){return!0}_markSyncedWithParent(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)}isSynchronizedWithParent(){return!this._parentNode||!this._parentNode._isDirty&&this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()}isSynchronized(){return!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()}isReady(){return this._nodeDataStorage._isReady}Fe(C){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}isEnabled(){return!1===(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])?this._nodeDataStorage._isEnabled:!!this._nodeDataStorage._isEnabled&&this._nodeDataStorage._isParentEnabled}_syncParentEnabledState(){this._nodeDataStorage._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children&&this._children.forEach((C=>{C._syncParentEnabledState()}))}Og(C){this._nodeDataStorage._isEnabled!==C&&(this._nodeDataStorage._isEnabled=C,this._syncParentEnabledState(),this._nodeDataStorage._onEnabledStateChangedObservable.notifyObservers(C))}isDescendantOf(C){return!!this.parent&&(this.parent===C||this.parent.isDescendantOf(C))}_getDescendants(C){let M=arguments.length>1&&void 0!==arguments[1]&&arguments[1],x=arguments.length>2?arguments[2]:void 0;if(this._children)for(let f=0;f<this._children.length;f++){const T=this._children[f];x&&!x(T)||C.push(T),M||T._getDescendants(C,!1,x)}}getDescendants(C,M){const x=[];return this._getDescendants(x,C,M),x}getChildMeshes(C,M){const x=[];return this._getDescendants(x,C,(C=>(!M||M(C))&&void 0!==C.Re)),x}getChildren(C){let M=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.getDescendants(M,C)}_setReady(C){C!==this._nodeDataStorage._isReady&&(C?(this.onReady&&this.onReady(this),this._nodeDataStorage._isReady=!0):this._nodeDataStorage._isReady=!1)}getAnimationByName(C){for(let M=0;M<this.animations.length;M++){const x=this.animations[M];if(x.name===C)return x}return null}createAnimationRange(C,M,x){if(!this._ranges[C]){this._ranges[C]=y._AnimationRangeFactory(C,M,x);for(let f=0,T=this.animations.length;f<T;f++)this.animations[f]&&this.animations[f].createRange(C,M,x)}}deleteAnimationRange(C){let M=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let x=0,f=this.animations.length;x<f;x++)this.animations[x]&&this.animations[x].deleteRange(C,M);this._ranges[C]=null}getAnimationRange(C){return this._ranges[C]||null}clone(C,M,x){const f=Q.e.Clone((()=>new y(C,this.va())),this);if(M&&(f.parent=M),!x){const M=this.getDescendants(!0);for(let x=0;x<M.length;x++){const T=M[x];T.clone(C+"."+T.name,f)}}return f}getAnimationRanges(){const C=[];let M;for(M in this._ranges)C.push(this._ranges[M]);return C}beginAnimation(C,M,x,f){const T=this.getAnimationRange(C);return T?this._scene.beginAnimation(this,T.from,T.to,M,x,f):null}serializeAnimationRanges(){const C=[];for(const M in this._ranges){const x=this._ranges[M];if(!x)continue;const f={};f.name=M,f.from=x.from,f.to=x.to,C.push(f)}return C}Be(C){return this._worldMatrix||(this._worldMatrix=T.d.Identity()),this._worldMatrix}dispose(C){let M=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._nodeDataStorage._isDisposed=!0,!C){const x=this.getDescendants(!0);for(const f of x)f.dispose(C,M)}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.Sd.notifyObservers(this),this.Sd.clear(),this.onEnabledStateChangedObservable.clear(),this.onClonedObservable.clear();for(const x of this._behaviors)x.detach();this._behaviors.length=0,this.metadata=null}static ParseAnimationRanges(C,M,x){if(M.ranges)for(let f=0;f<M.ranges.length;f++){const x=M.ranges[f];C.createAnimationRange(x.name,x.from,x.to)}}getHierarchyBoundingVectors(){let C,M,x=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.va().incrementRenderId(),this.Be(!0);const z=this;if(z.getBoundingInfo&&z.we){const x=z.getBoundingInfo();C=x.boundingBox.minimumWorld.clone(),M=x.boundingBox.maximumWorld.clone()}else C=new T.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),M=new T.m(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(x){const x=this.getDescendants(!1);for(const z of x){const x=z;if(x.Be(!0),f&&!f(x))continue;if(!x.getBoundingInfo||0===x.getTotalVertices())continue;const s=x.getBoundingInfo().boundingBox,S=s.minimumWorld,m=s.maximumWorld;T.m.CheckExtends(S,C,M),T.m.CheckExtends(m,C,M)}}return{min:C,max:M}}}y._AnimationRangeFactory=(C,M,x)=>{throw(0,m.d)("AnimationRange")},y._NodeConstructors={},(0,f.e)([(0,z.J)()],y.prototype,"name",void 0),(0,f.e)([(0,z.J)()],y.prototype,"id",void 0),(0,f.e)([(0,z.J)()],y.prototype,"uniqueId",void 0),(0,f.e)([(0,z.J)()],y.prototype,"state",void 0),(0,f.e)([(0,z.J)()],y.prototype,"metadata",void 0)},12302:(C,M,x)=>{"use strict";class f{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((C,M)=>{this._resolve=C,this._reject=M}))}}var T=x(978),z=x(1162),s=x(1192),S=x(11726),m=x(12307),Q=x(12324),V=x(971),y=x(11867),U=x(12330),O=x(12339),d=x(1008),D=x(1078),o=x(1196);class L{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(C){this._useTextureToStoreBoneMatrices=C,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(C){this._animationPropertiesOverride=C}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(C,M,x){this.name=C,this.id=M,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=T.d.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new V.c,this.bones=[],this._scene=x||d.c.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const f=this._scene.getEngine().getCaps();this._canUseTextureForBones=f.textureFloat&&f.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((C=>!C.getParent()))}getTransformMatrices(C){if(this.needInitialSkinMatrix){if(!C)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return C._bonesTransformMatrices||this.prepare(!0),C._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(C){return this.needInitialSkinMatrix&&C._transformMatrixTexture?C._transformMatrixTexture:this._transformMatrixTexture}va(){return this._scene}toString(C){let M=`Name: ${this.name}, nBones: ${this.bones.length}`;if(M+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,C){M+=", Ranges: {";let C=!0;for(const x in this._ranges)C&&(M+=", ",C=!1),M+=x;M+="}"}return M}getBoneIndexByName(C){for(let M=0,x=this.bones.length;M<x;M++)if(this.bones[M].name===C)return M;return-1}createAnimationRange(C,M,x){if(!this._ranges[C]){this._ranges[C]=new O.c(C,M,x);for(let f=0,T=this.bones.length;f<T;f++)this.bones[f].animations[0]&&this.bones[f].animations[0].createRange(C,M,x)}}deleteAnimationRange(C){let M=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let x=0,f=this.bones.length;x<f;x++)this.bones[x].animations[0]&&this.bones[x].animations[0].deleteRange(C,M);this._ranges[C]=null}getAnimationRange(C){return this._ranges[C]||null}getAnimationRanges(){const C=[];let M;for(M in this._ranges)C.push(this._ranges[M]);return C}copyAnimationRange(C,M){let x=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[M]||!C.getAnimationRange(M))return!1;let f=!0;const T=this._getHighestAnimationFrame()+1,z={},s=C.bones;let S,m;for(m=0,S=s.length;m<S;m++)z[s[m].name]=s[m];this.bones.length!==s.length&&(D.e.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${s.length}`),f=!1);const Q=x&&this.dimensionsAtRest&&C.dimensionsAtRest?this.dimensionsAtRest.divide(C.dimensionsAtRest):null;for(m=0,S=this.bones.length;m<S;m++){const C=this.bones[m].name,s=z[C];s?f=f&&this.bones[m].copyAnimationRange(s,M,T,x,Q):(D.e.Warn("copyAnimationRange: not same rig, missing source bone "+C),f=!1)}const V=C.getAnimationRange(M);return V&&(this._ranges[M]=new O.c(M,V.from+T,V.to+T)),f}returnToRest(){for(const C of this.bones)-1!==C._index&&C.returnToRest()}_getHighestAnimationFrame(){let C=0;for(let M=0,x=this.bones.length;M<x;M++)if(this.bones[M].animations[0]){const x=this.bones[M].animations[0].getHighestFrame();C<x&&(C=x)}return C}beginAnimation(C,M,x,f){const T=this.getAnimationRange(C);return T?this._scene.beginAnimation(this,T.from,T.to,M,x,f):null}static MakeAnimationAdditive(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,x=arguments.length>2?arguments[2]:void 0;const f=C.getAnimationRange(x);if(!f)return null;const T=C._scene.getAllAnimatablesByTarget(C);let z=null;for(let S=0;S<T.length;S++){const C=T[S];if(C.fromFrame===(null===f||void 0===f?void 0:f.from)&&C.toFrame===(null===f||void 0===f?void 0:f.to)){z=C;break}}const s=C.getAnimatables();for(let S=0;S<s.length;S++){const C=s[S].animations;if(C)for(let f=0;f<C.length;f++)U.b.MakeAnimationAdditive(C[f],M,x)}return z&&(z.isAdditive=!0),C}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(C){this._meshesWithPoseMatrix.push(C)}_unregisterMeshWithPoseMatrix(C){const M=this._meshesWithPoseMatrix.indexOf(C);M>-1&&this._meshesWithPoseMatrix.splice(M,1)}_computeTransformMatrices(C,M){this.onBeforeComputeObservable.notifyObservers(this);for(let x=0;x<this.bones.length;x++){const f=this.bones[x];f._childUpdateId++;const T=f.getParent();if(T?f.getLocalMatrix().multiplyToRef(T.getFinalMatrix(),f.getFinalMatrix()):M?f.getLocalMatrix().multiplyToRef(M,f.getFinalMatrix()):f.getFinalMatrix().p(f.getLocalMatrix()),-1!==f._index){const M=null===f._index?x:f._index;f.getAbsoluteInverseBindMatrix().multiplyToArray(f.getFinalMatrix(),C,16*M)}}this._identity.copyToArray(C,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const C=this.va().getRenderId();if(this._currentRenderId===C)return;this._currentRenderId=C}if(this._numBonesWithLinkedTransformNode>0)for(const C of this.bones)if(C._linkedTransformNode){const M=C._linkedTransformNode;C.position=M.position,M.rotationQuaternion?C.rotationQuaternion=M.rotationQuaternion:C.rotation=M.rotation,C.Qd=M.Qd}if(this.needInitialSkinMatrix)for(const C of this._meshesWithPoseMatrix){const M=C.getPoseMatrix();let x=this._isDirty;if(C._bonesTransformMatrices&&C._bonesTransformMatrices.length===16*(this.bones.length+1)||(C._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),x=!0),x){if(this._synchronizedWithMesh!==C){this._synchronizedWithMesh=C;for(const C of this.bones)if(!C.getParent()){C.getBindMatrix().multiplyToRef(M,T.i.Matrix[1]),C._updateAbsoluteBindMatrices(T.i.Matrix[1])}if(this.isUsingTextureForMatrices){const M=4*(this.bones.length+1);C._transformMatrixTexture&&C._transformMatrixTexture.getSize().width===M||(C._transformMatrixTexture&&C._transformMatrixTexture.dispose(),C._transformMatrixTexture=y.e.CreateRGBATexture(C._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(C._bonesTransformMatrices,M),this.isUsingTextureForMatrices&&C._transformMatrixTexture&&C._transformMatrixTexture.update(C._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=y.e.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let C=0;C<this.bones.length;C++)this._animatables.push(this.bones[C])}return this._animatables}clone(C,M){const x=new L(C,M||C,this._scene);x.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let f=0;f<this.bones.length;f++){const C=this.bones[f];let M=null;const T=C.getParent();if(T){const C=this.bones.indexOf(T);M=x.bones[C]}const z=new Q.c(C.name,x,M,C.getBindMatrix().clone(),C.getRestMatrix().clone());z._index=C._index,C._linkedTransformNode&&z.linkTransformNode(C._linkedTransformNode),o.d.DeepCopy(C.animations,z.animations)}if(this._ranges){x._ranges={};for(const C in this._ranges){const M=this._ranges[C];M&&(x._ranges[C]=M.clone())}}return this._isDirty=!0,x.prepare(!0),x}enableBlending(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;this.bones.forEach((M=>{M.animations.forEach((M=>{M.enableBlending=!0,M.blendingSpeed=C}))}))}dispose(){if(this._meshesWithPoseMatrix.length=0,this.va().stopAnimation(this),this.va().removeSkeleton(this),this._parentContainer){const C=this._parentContainer.skeletons.indexOf(this);C>-1&&this._parentContainer.skeletons.splice(C,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const C={};C.name=this.name,C.id=this.id,this.dimensionsAtRest&&(C.dimensionsAtRest=this.dimensionsAtRest.Gd()),C.bones=[],C.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let x=0;x<this.bones.length;x++){var M;const f=this.bones[x],T=f.getParent(),z={parentBoneIndex:T?this.bones.indexOf(T):-1,index:f.getIndex(),name:f.name,id:f.id,matrix:f.getBindMatrix().Gd(),rest:f.getRestMatrix().Gd(),linkedTransformNodeId:null===(M=f.getTransformNode())||void 0===M?void 0:M.id};C.bones.push(z),f.length&&(z.length=f.length),f.metadata&&(z.metadata=f.metadata),f.animations&&f.animations.length>0&&(z.animation=f.animations[0].serialize()),C.ranges=[];for(const M in this._ranges){const x=this._ranges[M];if(!x)continue;const f={};f.name=M,f.from=x.from,f.to=x.to,C.ranges.push(f)}}return C}static Parse(C,M){const x=new L(C.name,C.id,M);let f;for(C.dimensionsAtRest&&(x.dimensionsAtRest=T.m.Dd(C.dimensionsAtRest)),x.needInitialSkinMatrix=C.needInitialSkinMatrix,f=0;f<C.bones.length;f++){const M=C.bones[f],z=C.bones[f].index;let s=null;M.parentBoneIndex>-1&&(s=x.bones[M.parentBoneIndex]);const S=M.rest?T.d.Dd(M.rest):null,m=new Q.c(M.name,x,s,T.d.Dd(M.matrix),S,null,z);void 0!==M.id&&null!==M.id&&(m.id=M.id),M.length&&(m.length=M.length),M.metadata&&(m.metadata=M.metadata),M.animation&&m.animations.push(U.b.Parse(M.animation)),void 0!==M.linkedTransformNodeId&&null!==M.linkedTransformNodeId&&(x._hasWaitingData=!0,m._waitingTransformNodeId=M.linkedTransformNodeId)}if(C.ranges)for(f=0;f<C.ranges.length;f++){const M=C.ranges[f];x.createAnimationRange(M.name,M.from,M.to)}return x}computeAbsoluteMatrices(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||C)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(C)}getPoseMatrix(){let C=null;return this._meshesWithPoseMatrix.length>0&&(C=this._meshesWithPoseMatrix[0].getPoseMatrix()),C}sortBones(){const C=[],M=new Array(this.bones.length);for(let x=0;x<this.bones.length;x++)this._sortBones(x,C,M);this.bones=C}_sortBones(C,M,x){if(x[C])return;x[C]=!0;const f=this.bones[C];if(!f)return;void 0===f._index&&(f._index=C);const T=f.getParent();T&&this._sortBones(this.bones.indexOf(T),M,x),M.push(f)}setCurrentPoseAsRest(){this.bones.forEach((C=>{C.setCurrentPoseAsRest()}))}}var t=x(1289),A=x(951),H=x(959),j=x(12342),b=x(12350),R=x(997),n=x(1145);class I extends b.d{get refractionTexture(){return this.subSurface.refractionTexture}set refractionTexture(C){this.subSurface.refractionTexture=C,C?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)}get indexOfRefraction(){return this.subSurface.indexOfRefraction}set indexOfRefraction(C){this.subSurface.indexOfRefraction=C}get invertRefractionY(){return this.subSurface.invertRefractionY}set invertRefractionY(C){this.subSurface.invertRefractionY=C}get linkRefractionWithTransparency(){return this.subSurface.linkRefractionWithTransparency}set linkRefractionWithTransparency(C){this.subSurface.linkRefractionWithTransparency=C,C&&(this.subSurface.isRefractionEnabled=!0)}get usePhysicalLightFalloff(){return this._lightFalloff===b.d.LIGHTFALLOFF_PHYSICAL}set usePhysicalLightFalloff(C){C!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=C?b.d.LIGHTFALLOFF_PHYSICAL:b.d.LIGHTFALLOFF_STANDARD)}get useGLTFLightFalloff(){return this._lightFalloff===b.d.LIGHTFALLOFF_GLTF}set useGLTFLightFalloff(C){C!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=C?b.d.LIGHTFALLOFF_GLTF:b.d.LIGHTFALLOFF_STANDARD)}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(C){this._attachImageProcessingConfiguration(C),this._markAllSubMeshesAsTexturesDirty()}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(C){this.imageProcessingConfiguration.colorCurvesEnabled=C}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(C){this.imageProcessingConfiguration.colorGradingEnabled=C}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(C){this._imageProcessingConfiguration.toneMappingEnabled=C}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(C){this._imageProcessingConfiguration.exposure=C}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(C){this._imageProcessingConfiguration.contrast=C}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(C){this._imageProcessingConfiguration.colorGradingTexture=C}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(C){this._imageProcessingConfiguration.colorCurves=C}constructor(C,M){super(C,M,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.directIntensity=1,this.emissiveIntensity=1,this.environmentIntensity=1,this.specularIntensity=1,this.disableBumpMap=!1,this.ambientTextureStrength=1,this.ambientTextureImpactOnAnalyticalLights=I.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this.metallicF0Factor=1,this.metallicReflectanceColor=z.d.White(),this.useOnlyMetallicFromMetallicReflectanceTexture=!1,this.ambientColor=new z.d(0,0,0),this.albedoColor=new z.d(1,1,1),this.reflectivityColor=new z.d(1,1,1),this.reflectionColor=new z.d(1,1,1),this.emissiveColor=new z.d(0,0,0),this.microSurface=1,this.useLightmapAsShadowmap=!1,this.useAlphaFromAlbedoTexture=!1,this.forceAlphaTest=!1,this.alphaCutOff=.4,this.useSpecularOverAlpha=!0,this.useMicroSurfaceFromReflectivityMapAlpha=!1,this.useRoughnessFromMetallicTextureAlpha=!0,this.useRoughnessFromMetallicTextureGreen=!1,this.useMetallnessFromMetallicTextureBlue=!1,this.useAmbientOcclusionFromMetallicTextureRed=!1,this.useAmbientInGrayScale=!1,this.useAutoMicroSurfaceFromReflectivityMap=!1,this.useRadianceOverAlpha=!0,this.useObjectSpaceNormalMap=!1,this.useParallax=!1,this.useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this.disableLighting=!1,this.forceIrradianceInFragment=!1,this.maxSimultaneousLights=4,this.invertNormalMapX=!1,this.invertNormalMapY=!1,this.twoSidedLighting=!1,this.useAlphaFresnel=!1,this.useLinearAlphaFresnel=!1,this.environmentBRDFTexture=null,this.forceNormalForward=!1,this.enableSpecularAntiAliasing=!1,this.useHorizonOcclusion=!0,this.useRadianceOcclusion=!0,this.unlit=!1,this.applyDecalMapAfterDetailMap=!1,this._environmentBRDFTexture=(0,j.c)(this.va())}getClassName(){return"PBRMaterial"}clone(C){let M=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const f=n.e.Clone((()=>new I(C,this.va())),this,{cloneTexturesOnlyOnce:M});return f.id=C,f.name=C,this.stencil.copyTo(f.stencil),this._clonePlugins(f,x),f}serialize(){const C=super.serialize();return C.customType="BABYLON.PBRMaterial",C}static Parse(C,M,x){const f=n.e.Parse((()=>new I(C.name,M)),C,M,x);return C.stencil&&f.stencil.parse(C.stencil,M,x),t.c._ParsePlugins(C,f,M,x),C.clearCoat&&f.clearCoat.parse(C.clearCoat,M,x),C.anisotropy&&f.anisotropy.parse(C.anisotropy,M,x),C.brdf&&f.brdf.parse(C.brdf,M,x),C.sheen&&f.sheen.parse(C.sheen,M,x),C.subSurface&&f.subSurface.parse(C.subSurface,M,x),C.iridescence&&f.iridescence.parse(C.iridescence,M,x),f}}I.PBRMATERIAL_OPAQUE=b.d.PBRMATERIAL_OPAQUE,I.PBRMATERIAL_ALPHATEST=b.d.PBRMATERIAL_ALPHATEST,I.PBRMATERIAL_ALPHABLEND=b.d.PBRMATERIAL_ALPHABLEND,I.PBRMATERIAL_ALPHATESTANDBLEND=b.d.PBRMATERIAL_ALPHATESTANDBLEND,I.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=b.d.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,(0,A.e)([(0,H.J)(),(0,H.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"directIntensity",void 0),(0,A.e)([(0,H.J)(),(0,H.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"emissiveIntensity",void 0),(0,A.e)([(0,H.J)(),(0,H.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"environmentIntensity",void 0),(0,A.e)([(0,H.J)(),(0,H.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"specularIntensity",void 0),(0,A.e)([(0,H.J)(),(0,H.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"disableBumpMap",void 0),(0,A.e)([(0,H.A)(),(0,H.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"albedoTexture",void 0),(0,A.e)([(0,H.A)(),(0,H.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"ambientTexture",void 0),(0,A.e)([(0,H.J)(),(0,H.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"ambientTextureStrength",void 0),(0,A.e)([(0,H.J)(),(0,H.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),(0,A.e)([(0,H.A)(),(0,H.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],I.prototype,"opacityTexture",void 0),(0,A.e)([(0,H.A)(),(0,H.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"reflectionTexture",void 0),(0,A.e)([(0,H.A)(),(0,H.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"emissiveTexture",void 0),(0,A.e)([(0,H.A)(),(0,H.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"reflectivityTexture",void 0),(0,A.e)([(0,H.A)(),(0,H.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"metallicTexture",void 0),(0,A.e)([(0,H.J)(),(0,H.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"metallic",void 0),(0,A.e)([(0,H.J)(),(0,H.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"roughness",void 0),(0,A.e)([(0,H.J)(),(0,H.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"metallicF0Factor",void 0),(0,A.e)([(0,H.l)(),(0,H.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"metallicReflectanceColor",void 0),(0,A.e)([(0,H.J)(),(0,H.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"useOnlyMetallicFromMetallicReflectanceTexture",void 0),(0,A.e)([(0,H.A)(),(0,H.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"metallicReflectanceTexture",void 0),(0,A.e)([(0,H.A)(),(0,H.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"reflectanceTexture",void 0),(0,A.e)([(0,H.A)(),(0,H.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"microSurfaceTexture",void 0),(0,A.e)([(0,H.A)(),(0,H.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"bumpTexture",void 0),(0,A.e)([(0,H.A)(),(0,H.e)("_markAllSubMeshesAsTexturesDirty",null)],I.prototype,"lightmapTexture",void 0),(0,A.e)([(0,H.l)("ambient"),(0,H.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"ambientColor",void 0),(0,A.e)([(0,H.l)("albedo"),(0,H.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"albedoColor",void 0),(0,A.e)([(0,H.l)("reflectivity"),(0,H.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"reflectivityColor",void 0),(0,A.e)([(0,H.l)("reflection"),(0,H.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"reflectionColor",void 0),(0,A.e)([(0,H.l)("emissive"),(0,H.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"emissiveColor",void 0),(0,A.e)([(0,H.J)(),(0,H.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"microSurface",void 0),(0,A.e)([(0,H.J)(),(0,H.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"useLightmapAsShadowmap",void 0),(0,A.e)([(0,H.J)(),(0,H.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],I.prototype,"useAlphaFromAlbedoTexture",void 0),(0,A.e)([(0,H.J)(),(0,H.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],I.prototype,"forceAlphaTest",void 0),(0,A.e)([(0,H.J)(),(0,H.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],I.prototype,"alphaCutOff",void 0),(0,A.e)([(0,H.J)(),(0,H.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"useSpecularOverAlpha",void 0),(0,A.e)([(0,H.J)(),(0,H.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),(0,A.e)([(0,H.J)(),(0,H.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),(0,A.e)([(0,H.J)(),(0,H.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"useRoughnessFromMetallicTextureGreen",void 0),(0,A.e)([(0,H.J)(),(0,H.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"useMetallnessFromMetallicTextureBlue",void 0),(0,A.e)([(0,H.J)(),(0,H.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),(0,A.e)([(0,H.J)(),(0,H.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"useAmbientInGrayScale",void 0),(0,A.e)([(0,H.J)(),(0,H.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),(0,A.e)([(0,H.J)()],I.prototype,"usePhysicalLightFalloff",null),(0,A.e)([(0,H.J)()],I.prototype,"useGLTFLightFalloff",null),(0,A.e)([(0,H.J)(),(0,H.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"useRadianceOverAlpha",void 0),(0,A.e)([(0,H.J)(),(0,H.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"useObjectSpaceNormalMap",void 0),(0,A.e)([(0,H.J)(),(0,H.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"useParallax",void 0),(0,A.e)([(0,H.J)(),(0,H.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"useParallaxOcclusion",void 0),(0,A.e)([(0,H.J)(),(0,H.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"parallaxScaleBias",void 0),(0,A.e)([(0,H.J)(),(0,H.e)("_markAllSubMeshesAsLightsDirty")],I.prototype,"disableLighting",void 0),(0,A.e)([(0,H.J)(),(0,H.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"forceIrradianceInFragment",void 0),(0,A.e)([(0,H.J)(),(0,H.e)("_markAllSubMeshesAsLightsDirty")],I.prototype,"maxSimultaneousLights",void 0),(0,A.e)([(0,H.J)(),(0,H.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"invertNormalMapX",void 0),(0,A.e)([(0,H.J)(),(0,H.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"invertNormalMapY",void 0),(0,A.e)([(0,H.J)(),(0,H.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"twoSidedLighting",void 0),(0,A.e)([(0,H.J)(),(0,H.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"useAlphaFresnel",void 0),(0,A.e)([(0,H.J)(),(0,H.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"useLinearAlphaFresnel",void 0),(0,A.e)([(0,H.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"environmentBRDFTexture",void 0),(0,A.e)([(0,H.J)(),(0,H.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"forceNormalForward",void 0),(0,A.e)([(0,H.J)(),(0,H.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"enableSpecularAntiAliasing",void 0),(0,A.e)([(0,H.J)(),(0,H.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"useHorizonOcclusion",void 0),(0,A.e)([(0,H.J)(),(0,H.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"useRadianceOcclusion",void 0),(0,A.e)([(0,H.J)(),(0,H.e)("_markAllSubMeshesAsMiscDirty")],I.prototype,"unlit",void 0),(0,A.e)([(0,H.J)(),(0,H.e)("_markAllSubMeshesAsMiscDirty")],I.prototype,"applyDecalMapAfterDetailMap",void 0),(0,R.f)("BABYLON.PBRMaterial",I);var X=x(945),g=x(11765),B=x(1224),F=x(11748),P=x(11763),h=x(11712);class c{get influence(){return this._influence}set influence(C){if(this._influence===C)return;const M=this._influence;this._influence=C,this.onInfluenceChanged.hasObservers()&&this.onInfluenceChanged.notifyObservers(0===M||0===C)}get animationPropertiesOverride(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride}set animationPropertiesOverride(C){this._animationPropertiesOverride=C}constructor(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.name=C,this.animations=[],this._positions=null,this._normals=null,this._tangents=null,this._uvs=null,this._uniqueId=0,this.onInfluenceChanged=new V.c,this._onDataLayoutChanged=new V.c,this._animationPropertiesOverride=null,this.id=C,this._scene=x||d.c.LastCreatedScene,this.influence=M,this._scene&&(this._uniqueId=this._scene.getUniqueId())}get uniqueId(){return this._uniqueId}get hasPositions(){return!!this._positions}get hasNormals(){return!!this._normals}get hasTangents(){return!!this._tangents}get hasUVs(){return!!this._uvs}setPositions(C){const M=this.hasPositions;this._positions=C,M!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)}getPositions(){return this._positions}setNormals(C){const M=this.hasNormals;this._normals=C,M!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)}getNormals(){return this._normals}setTangents(C){const M=this.hasTangents;this._tangents=C,M!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)}getTangents(){return this._tangents}setUVs(C){const M=this.hasUVs;this._uvs=C,M!==this.hasUVs&&this._onDataLayoutChanged.notifyObservers(void 0)}getUVs(){return this._uvs}clone(){const C=n.e.Clone((()=>new c(this.name,this.influence,this._scene)),this);return C._positions=this._positions,C._normals=this._normals,C._tangents=this._tangents,C._uvs=this._uvs,C}serialize(){const C={};return C.name=this.name,C.influence=this.influence,C.xa=Array.prototype.slice.call(this.getPositions()),null!=this.id&&(C.id=this.id),this.hasNormals&&(C.ya=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(C.tangents=Array.prototype.slice.call(this.getTangents())),this.hasUVs&&(C.Aa=Array.prototype.slice.call(this.getUVs())),n.e.AppendSerializedAnimations(this,C),C}getClassName(){return"MorphTarget"}static Parse(C,M){const x=new c(C.name,C.influence);if(x.setPositions(C.xa),null!=C.id&&(x.id=C.id),C.ya&&x.setNormals(C.ya),C.tangents&&x.setTangents(C.tangents),C.Aa&&x.setUVs(C.Aa),C.animations){for(let M=0;M<C.animations.length;M++){const f=C.animations[M],T=(0,R.c)("BABYLON.Animation");T&&x.animations.push(T.Parse(f))}C.autoAnimate&&M&&M.beginAnimation(x,C.autoAnimateFrom,C.autoAnimateTo,C.autoAnimateLoop,C.autoAnimateSpeed||1)}return x}static FromMesh(C,M,x){M||(M=C.name);const f=new c(M,x,C.va());return f.setPositions(C.getVerticesData(B.h.PositionKind)),C.isVerticesDataPresent(B.h.NormalKind)&&f.setNormals(C.getVerticesData(B.h.NormalKind)),C.isVerticesDataPresent(B.h.TangentKind)&&f.setTangents(C.getVerticesData(B.h.TangentKind)),C.isVerticesDataPresent(B.h.UVKind)&&f.setUVs(C.getVerticesData(B.h.UVKind)),f}}(0,A.e)([(0,H.J)()],c.prototype,"id",void 0);var q=x(1188),i=x(1502);class Z{set areUpdatesFrozen(C){C?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(!0)))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new q.e(16),this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,C||(C=d.c.LastCreatedScene),this._scene=C,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const C=this._scene.getEngine().getCaps();this._canUseTextureForTargets=C.canUseGLVertexID&&C.textureFloat&&C.maxVertexTextureImageUnits>0&&C.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return this._numMaxInfluencers}set numMaxInfluencers(C){this._numMaxInfluencers!==C&&(this._numMaxInfluencers=C,this._syncActiveTargets(!0))}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(C){this._useTextureToStoreTargets=C}get isUsingTextureForTargets(){var C;return Z.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(C=this._scene)&&void 0!==C&&C.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(C){return this._activeTargets.data[C]}getTarget(C){return this._targets[C]}getTargetByName(C){for(const M of this._targets)if(M.name===C)return M;return null}addTarget(C){this._targets.push(C),this._targetInfluenceChangedObservers.push(C.onInfluenceChanged.add((C=>{this._syncActiveTargets(C)}))),this._targetDataLayoutChangedObservers.push(C._onDataLayoutChanged.add((()=>{this._syncActiveTargets(!0)}))),this._syncActiveTargets(!0)}removeTarget(C){const M=this._targets.indexOf(C);M>=0&&(this._targets.splice(M,1),C.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(M,1)[0]),C._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(M,1)[0]),this._syncActiveTargets(!0)),this._scene&&this._scene.stopAnimation(C)}_bind(C){C.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),C.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),C.setTexture("morphTargets",this._targetStoreTexture),C.setInt("morphTargetCount",this.numInfluencers)}clone(){const C=new Z(this._scene);for(const M of this._targets)C.addTarget(M.clone());return C.enableNormalMorphing=this.enableNormalMorphing,C.enableTangentMorphing=this.enableTangentMorphing,C.enableUVMorphing=this.enableUVMorphing,C}serialize(){const C={};C.id=this.uniqueId,C.targets=[];for(const M of this._targets)C.targets.push(M.serialize());return C}_syncActiveTargets(C){if(this.areUpdatesFrozen)return;let M=0;this._activeTargets.reset(),this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._vertexCount=0,this._scene&&this._targets.length>this._scene.getEngine().getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let x=-1;for(const f of this._targets){if(x++,0===f.influence&&this.optimizeInfluencers)continue;if(this._activeTargets.length>=Z.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(f),this._morphTargetTextureIndices[M]=x,this._tempInfluences[M++]=f.influence,this._supportsNormals=this._supportsNormals&&f.hasNormals,this._supportsTangents=this._supportsTangents&&f.hasTangents,this._supportsUVs=this._supportsUVs&&f.hasUVs;const C=f.getPositions();if(C){const M=C.length/3;if(0===this._vertexCount)this._vertexCount=M;else if(this._vertexCount!==M)return void D.e.Error("Incompatible target. Targets must all have the same vertices count.")}}this._morphTargetTextureIndices.length!==M&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,M)),this._influences&&this._influences.length===M||(this._influences=new Float32Array(M));for(let f=0;f<M;f++)this._influences[f]=this._tempInfluences[f];C&&this.synchronize()}synchronize(){if(this._scene&&!this.areUpdatesFrozen){if(this.isUsingTextureForTargets&&(this._vertexCount||this.numMaxInfluencers>0)){this._textureVertexStride=1,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const C=this._scene.getEngine().getCaps().maxTextureSize;this._textureWidth>C&&(this._textureHeight=Math.ceil(this._textureWidth/C),this._textureWidth=C);let M=!0;if(this._targetStoreTexture){const C=this._targetStoreTexture.getSize();C.width===this._textureWidth&&C.height===this._textureHeight&&this._targetStoreTexture.depth===this._targets.length&&(M=!1)}if(M){this._targetStoreTexture&&this._targetStoreTexture.dispose();const C=this._targets.length,M=new Float32Array(C*this._textureWidth*this._textureHeight*4);let x=0;for(let f=0;f<C;f++){const C=this._targets[f],T=C.getPositions(),z=C.getNormals(),s=C.getUVs(),S=C.getTangents();if(!T)return void(0===f&&D.e.Error("Invalid morph target. Target must have positions."));x=f*this._textureWidth*this._textureHeight*4;for(let f=0;f<this._vertexCount;f++)M[x]=T[3*f],M[x+1]=T[3*f+1],M[x+2]=T[3*f+2],x+=4,this._supportsNormals&&z&&(M[x]=z[3*f],M[x+1]=z[3*f+1],M[x+2]=z[3*f+2],x+=4),this._supportsUVs&&s&&(M[x]=s[2*f],M[x+1]=s[2*f+1],x+=4),this._supportsTangents&&S&&(M[x]=S[3*f],M[x+1]=S[3*f+1],M[x+2]=S[3*f+2],x+=4)}this._targetStoreTexture=i.e.CreateRGBATexture(M,this._textureWidth,this._textureHeight,C,this._scene,!1,!1,1,1)}}for(const C of this._scene.meshes)C.morphTargetManager===this&&C._syncGeometryWithMorphTargetManager()}}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const C=this._parentContainer.morphTargetManagers.indexOf(this);C>-1&&this._parentContainer.morphTargetManagers.splice(C,1),this._parentContainer=null}for(const C of this._targets)this._scene.stopAnimation(C)}}static Parse(C,M){const x=new Z(M);for(const f of C.targets)x.addTarget(c.Parse(f,M));return x}}Z.EnableTextureStorage=!0,Z.MaxActiveMorphTargetsInVertexAttributeMode=8;var E=x(12353),K=x(1035),G=x(1300);function a(C,M,x,f){return T.m.Dd(M,x).scaleInPlace(f)}class J{constructor(C,M,x,f){this.type=C,this.name=M,this.getValue=x,this.getStride=f}_buildAnimation(C,M,x){const f=new U.b(C,this.name,M,this.type);return f.setKeys(x),f}}class N extends J{buildAnimations(C,M,x,f,T){T(C._babylonTransformNode,this._buildAnimation(M,x,f))}}const k={translation:[new N(U.b.ANIMATIONTYPE_VECTOR3,"position",a,(()=>3))],rotation:[new N(U.b.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",(function(C,M,x,f){return T.h.Dd(M,x).scaleInPlace(f)}),(()=>4))],scale:[new N(U.b.ANIMATIONTYPE_VECTOR3,"Qd",a,(()=>3))],weights:[new class extends J{buildAnimations(C,M,x,f,T){if(C._numMorphTargets)for(let z=0;z<C._numMorphTargets;z++){const s=new U.b(`${M}_${z}`,this.name,x,this.type);if(s.setKeys(f.map((C=>({frame:C.frame,inTangent:C.inTangent?C.inTangent[z]:void 0,value:C.value[z],outTangent:C.outTangent?C.outTangent[z]:void 0,interpolation:C.interpolation})))),C._primitiveBabylonMeshes)for(const M of C._primitiveBabylonMeshes)if(M.morphTargetManager){const C=M.morphTargetManager.getTarget(z),x=s.clone();C.animations.push(x),T(C,x)}}}}(U.b.ANIMATIONTYPE_FLOAT,"influence",(function(C,M,x,f){const T=new Array(C._numMorphTargets);for(let z=0;z<T.length;z++)T[z]=M[x++]*f;return T}),(C=>C._numMorphTargets))]},v=new Map,p=v;function u(C,M,x){Y(C)&&D.e.Warn(`Extension with the name '${C}' already exists`),v.set(C,{isGLTFExtension:M,factory:x})}function Y(C){return v.delete(C)}function W(){const C=C=>C&&"object"===typeof C;for(var M=arguments.length,x=new Array(M),f=0;f<M;f++)x[f]=arguments[f];return x.reduce(((M,x)=>(Object.keys(x).forEach((f=>{const T=M[f],z=x[f];Array.isArray(T)&&Array.isArray(z)?M[f]=T.concat(...z):C(T)&&C(z)?M[f]=W(T,z):M[f]=z})),M)),{})}class e{static Get(C,M,x){if(!M||void 0==x||!M[x])throw new Error(`${C}: Failed to find index (${x})`);return M[x]}static TryGet(C,M){return C&&void 0!=M&&C[M]?C[M]:null}static Assign(C){if(C)for(let M=0;M<C.length;M++)C[M].index=M}}class r{static RegisterExtension(C,M){u(C,!1,M)}static UnregisterExtension(C){return Y(C)}get gj(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(C){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=C}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((C=>C.dispose&&C.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}importMeshAsync(C,M,x,f,T,z){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return Promise.resolve().then((()=>{this._babylonScene=M,this._assetContainer=x,this._loadData(f);let z=null;if(C){const M={};if(this._gltf.nodes)for(const C of this._gltf.nodes)C.name&&(M[C.name]=C.index);z=(C instanceof Array?C:[C]).map((C=>{const x=M[C];if(void 0===x)throw new Error(`Failed to find node '${C}'`);return x}))}return this._loadAsync(T,s,z,(()=>({meshes:this._getMeshes(),te:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}loadAsync(C,M,x,f){let T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return Promise.resolve().then((()=>(this._babylonScene=C,this._loadData(M),this._loadAsync(x,T,null,(()=>{})))))}_loadAsync(C,M,x,f){return Promise.resolve().then((async()=>{this._rootUrl=C,this._uniqueRootUrl=!C.startsWith("file:")&&M?C:`${C}${Date.now()}/`,this._fileName=M,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const T=`${E.k[E.k.LOADING]} => ${E.k[E.k.READY]}`,z=`${E.k[E.k.LOADING]} => ${E.k[E.k.COMPLETE]}`;this._parent._startPerformanceCounter(T),this._parent._startPerformanceCounter(z),this._parent._setState(E.k.LOADING),this._extensionsOnLoading();const S=new Array;if(!this.parent.loadOnlyMaterials)if(x)S.push(this.loadSceneAsync("/nodes",{nodes:x,index:-1}));else if(void 0!=this._gltf.xe||this._gltf.scenes&&this._gltf.scenes[0]){const C=e.Get("/scene",this._gltf.scenes,this._gltf.xe||0);S.push(this.loadSceneAsync(`/scenes/${C.index}`,C))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let C=0;C<this._gltf.materials.length;++C){const M=this._gltf.materials[C],x="/materials/"+C,f=t.c.TriangleFillMode;S.push(this._loadMaterialAsync(x,M,null,f,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&S.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&S.push(this._compileShadowGeneratorsAsync());return Promise.all(S).then((()=>(this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.Og(!0),this._extensionsOnReady(),this._parent._setState(E.k.READY),this._startAnimations(),f()))).then((C=>(this._parent._endPerformanceCounter(T),s.i.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(z),this._parent._setState(E.k.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(C=>{this._parent.onErrorObservable.notifyObservers(C),this._parent.onErrorObservable.clear(),this.dispose()}))})),C)))})).catch((C=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(C),this._parent.onErrorObservable.clear(),this.dispose()),C}))}_loadData(C){if(this._gltf=C.json,this._setupData(),C.bin){const M=this._gltf.buffers;if(M&&M[0]&&!M[0].uri){const x=M[0];(x.byteLength<C.bin.byteLength-3||x.byteLength>C.bin.byteLength)&&D.e.Warn(`Binary buffer length (${x.byteLength}) from JSON does not match chunk length (${C.bin.byteLength})`),this._bin=C.bin}else D.e.Warn("Unexpected BIN chunk")}}_setupData(){if(e.Assign(this._gltf.accessors),e.Assign(this._gltf.animations),e.Assign(this._gltf.buffers),e.Assign(this._gltf.bufferViews),e.Assign(this._gltf.cameras),e.Assign(this._gltf.images),e.Assign(this._gltf.materials),e.Assign(this._gltf.meshes),e.Assign(this._gltf.nodes),e.Assign(this._gltf.samplers),e.Assign(this._gltf.scenes),e.Assign(this._gltf.skins),e.Assign(this._gltf.textures),this._gltf.nodes){const C={};for(const x of this._gltf.nodes)if(x.children)for(const M of x.children)C[M]=x.index;const M=this._createRootNode();for(const x of this._gltf.nodes){const f=C[x.index];x.parent=void 0===f?M:this._gltf.nodes[f]}}}async _loadExtensionsAsync(){const C=[];if(p.forEach(((M,x)=>{var f;!1===(null===(f=this.parent.extensionOptions[x])||void 0===f?void 0:f.enabled)?M.isGLTFExtension&&this.isExtensionUsed(x)&&D.e.Warn(`Extension ${x} is used but has been explicitly disabled.`):M.isGLTFExtension&&!this.isExtensionUsed(x)||C.push((async()=>{const C=await M.factory(this);return C.name!==x&&D.e.Warn(`The name of the glTF loader extension instance does not match the registered name: ${C.name} !== ${x}`),this._parent.onExtensionLoadedObservable.notifyObservers(C),C})())})),this._extensions.push(...await Promise.all(C)),this._extensions.sort(((C,M)=>(C.order||Number.MAX_VALUE)-(M.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const x of this._gltf.extensionsRequired){if(!this._extensions.some((C=>C.name===x&&C.enabled))){var M;if(!1===(null===(M=this.parent.extensionOptions[x])||void 0===M?void 0:M.enabled))throw new Error(`Required extension ${x} is disabled`);throw new Error(`Required extension ${x} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const C=new h.d("__root__",this._babylonScene);this._rootBabylonMesh=C,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.Og(!1);const M={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case E.j.AUTO:this._babylonScene.useRightHandedSystem||(M.rotation=[0,1,0,0],M.scale=[1,1,-1],r._LoadTransform(M,this._rootBabylonMesh));break;case E.j.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(C),M}loadSceneAsync(C,M){const x=this._extensionsLoadSceneAsync(C,M);if(x)return x;const f=new Array;if(this.logOpen(`${C} ${M.name||""}`),M.nodes)for(const T of M.nodes){const M=e.Get(`${C}/nodes/${T}`,this._gltf.nodes,T);f.push(this.loadNodeAsync(`/nodes/${M.index}`,M,(C=>{C.parent=this._rootBabylonMesh})))}for(const T of this._postSceneLoadActions)T();return f.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(f).then((()=>{}))}_forEachPrimitive(C,M){if(C._primitiveBabylonMeshes)for(const x of C._primitiveBabylonMeshes)M(x)}_getGeometries(){const C=[],M=this._gltf.nodes;if(M)for(const x of M)this._forEachPrimitive(x,(M=>{const x=M.Ee;x&&-1===C.indexOf(x)&&C.push(x)}));return C}_getMeshes(){const C=[];this._rootBabylonMesh instanceof P.b&&C.push(this._rootBabylonMesh);const M=this._gltf.nodes;if(M)for(const x of M)this._forEachPrimitive(x,(M=>{C.push(M)}));return C}_getTransformNodes(){const C=[],M=this._gltf.nodes;if(M)for(const x of M)x._babylonTransformNode&&"nb"===x._babylonTransformNode.getClassName()&&C.push(x._babylonTransformNode),x._babylonTransformNodeForSkin&&C.push(x._babylonTransformNodeForSkin);return C}_getSkeletons(){const C=[],M=this._gltf.skins;if(M)for(const x of M)x._data&&C.push(x._data.babylonSkeleton);return C}_getAnimationGroups(){const C=[],M=this._gltf.animations;if(M)for(const x of M)x._babylonAnimationGroup&&C.push(x._babylonAnimationGroup);return C}_startAnimations(){switch(this._parent.animationStartMode){case E.h.NONE:break;case E.h.FIRST:{const C=this._getAnimationGroups();0!==C.length&&C[0].start(!0);break}case E.h.ALL:{const C=this._getAnimationGroups();for(const M of C)M.start(!0);break}default:return void D.e.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(C,M){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const f=this._extensionsLoadNodeAsync(C,M,x);if(f)return f;if(M._babylonTransformNode)throw new Error(`${C}: Invalid recursive node hierarchy`);const T=new Array;this.logOpen(`${C} ${M.name||""}`);const z=f=>{if(r.AddPointerMetadata(f,C),r._LoadTransform(M,f),void 0!=M.camera){const x=e.Get(`${C}/camera`,this._gltf.cameras,M.camera);T.push(this.loadCameraAsync(`/cameras/${x.index}`,x,(C=>{C.parent=f})))}if(M.children)for(const x of M.children){const M=e.Get(`${C}/children/${x}`,this._gltf.nodes,x);T.push(this.loadNodeAsync(`/nodes/${M.index}`,M,(C=>{C.parent=f})))}x(f)},s=void 0!=M.mesh,S=this._parent.loadSkins&&void 0!=M.skin;if(!s||S){const C=M.name||`node${M.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const x=new g.e(C,this._babylonScene);x._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==M.mesh?M._babylonTransformNode=x:M._babylonTransformNodeForSkin=x,z(x)}if(s)if(S){const x=e.Get(`${C}/mesh`,this._gltf.meshes,M.mesh);T.push(this._loadMeshAsync(`/meshes/${x.index}`,M,x,(x=>{const f=M._babylonTransformNodeForSkin;x.metadata=W(f.metadata,x.metadata||{});const z=e.Get(`${C}/skin`,this._gltf.skins,M.skin);T.push(this._loadSkinAsync(`/skins/${z.index}`,M,z,(C=>{this._forEachPrimitive(M,(M=>{M.skeleton=C})),this._postSceneLoadActions.push((()=>{if(void 0!=z.skeleton){const C=e.Get(`/skins/${z.index}/skeleton`,this._gltf.nodes,z.skeleton).parent;M.index===C.index?x.parent=f.parent:x.parent=C._babylonTransformNode}else x.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:f,skinnedNode:x})}))})))})))}else{const x=e.Get(`${C}/mesh`,this._gltf.meshes,M.mesh);T.push(this._loadMeshAsync(`/meshes/${x.index}`,M,x,z))}return this.logClose(),Promise.all(T).then((()=>(this._forEachPrimitive(M,(C=>{C.Ee&&C.Ee.useBoundingInfoFromGeometry?C.Ea():C.refreshBoundingInfo(!0,!0)})),M._babylonTransformNode)))}_loadMeshAsync(C,M,x,f){const T=x.primitives;if(!T||!T.length)throw new Error(`${C}: Primitives are missing`);void 0==T[0].index&&e.Assign(T);const z=new Array;this.logOpen(`${C} ${x.name||""}`);const s=M.name||`node${M.index}`;if(1===T.length){const f=x.primitives[0];z.push(this._loadMeshPrimitiveAsync(`${C}/primitives/${f.index}`,s,M,x,f,(C=>{M._babylonTransformNode=C,M._primitiveBabylonMeshes=[C]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,M._babylonTransformNode=new g.e(s,this._babylonScene),M._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,M._primitiveBabylonMeshes=[];for(const f of T)z.push(this._loadMeshPrimitiveAsync(`${C}/primitives/${f.index}`,`${s}_primitive${f.index}`,M,x,f,(C=>{C.parent=M._babylonTransformNode,M._primitiveBabylonMeshes.push(C)})))}return f(M._babylonTransformNode),this.logClose(),Promise.all(z).then((()=>M._babylonTransformNode))}_loadMeshPrimitiveAsync(C,M,x,f,T,z){const s=this._extensionsLoadMeshPrimitiveAsync(C,M,x,f,T,z);if(s)return s;this.logOpen(`${C}`);const S=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==x.skin&&!f.primitives[0].targets;let m,Q;if(S&&T._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,m=T._instanceData.babylonSourceMesh.Bb(M),m._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,Q=T._instanceData.promise;else{const z=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const s=new h.d(M,this._babylonScene);s._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,s.sideOrientation=this._babylonScene.useRightHandedSystem?t.c.CounterClockWiseSideOrientation:t.c.ClockWiseSideOrientation,this._createMorphTargets(C,x,f,T,s),z.push(this._loadVertexDataAsync(C,T,s).then((M=>this._loadMorphTargetsAsync(C,T,s,M).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,M.Ca(s),M._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const V=r._GetDrawMode(C,T.mode);if(void 0==T.material){let C=this._defaultBabylonMaterialData[V];C||(C=this._createDefaultMaterial("__GLTFLoader._default",V),this._parent.onMaterialLoadedObservable.notifyObservers(C),this._defaultBabylonMaterialData[V]=C),s.material=C}else if(!this.parent.skipMaterials){const M=e.Get(`${C}/material`,this._gltf.materials,T.material);z.push(this._loadMaterialAsync(`/materials/${M.index}`,M,s,V,(C=>{s.material=C})))}Q=Promise.all(z),S&&(T._instanceData={babylonSourceMesh:s,promise:Q}),m=s}return r.AddPointerMetadata(m,C),this._parent.onMeshLoadedObservable.notifyObservers(m),z(m),this.logClose(),Q.then((()=>m))}_loadVertexDataAsync(C,M,x){const f=this._extensionsLoadVertexDataAsync(C,M,x);if(f)return f;const z=M.attributes;if(!z)throw new Error(`${C}: Attributes are missing`);const s=new Array,S=new F.b(x.name,this._babylonScene);if(void 0==M.indices)x.isUnIndexed=!0;else{const x=e.Get(`${C}/indices`,this._gltf.accessors,M.indices);s.push(this._loadIndicesAccessorAsync(`/accessors/${x.index}`,x).then((C=>{S.setIndices(C)})))}const m=(M,f,m)=>{if(void 0==z[M])return;x._delayInfo=x._delayInfo||[],-1===x._delayInfo.indexOf(f)&&x._delayInfo.push(f);const Q=e.Get(`${C}/attributes/${M}`,this._gltf.accessors,z[M]);s.push(this._loadVertexAccessorAsync(`/accessors/${Q.index}`,Q,f).then((C=>{if(C.getKind()===B.h.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!x.skeleton&&Q.min&&Q.max){const C=T.i.Md[0].Hd(...Q.min),M=T.i.Md[1].Hd(...Q.max);if(Q.normalized&&5126!==Q.componentType){let x=1;switch(Q.componentType){case 5120:x=127;break;case 5121:x=255;break;case 5122:x=32767;break;case 5123:x=65535}const f=1/x;C.scaleInPlace(f),M.scaleInPlace(f)}S._boundingInfo=new G.b(C,M),S.useBoundingInfoFromGeometry=!0}S.setVerticesBuffer(C,Q.count)}))),f==B.h.MatricesIndicesExtraKind&&(x.numBoneInfluencers=8),m&&m(Q)};return m("POSITION",B.h.PositionKind),m("NORMAL",B.h.NormalKind),m("TANGENT",B.h.TangentKind),m("TEXCOORD_0",B.h.UVKind),m("TEXCOORD_1",B.h.UV2Kind),m("TEXCOORD_2",B.h.UV3Kind),m("TEXCOORD_3",B.h.UV4Kind),m("TEXCOORD_4",B.h.UV5Kind),m("TEXCOORD_5",B.h.UV6Kind),m("JOINTS_0",B.h.MatricesIndicesKind),m("WEIGHTS_0",B.h.MatricesWeightsKind),m("JOINTS_1",B.h.MatricesIndicesExtraKind),m("WEIGHTS_1",B.h.MatricesWeightsExtraKind),m("COLOR_0",B.h.ColorKind,(C=>{"VEC4"===C.type&&(x.hasVertexAlpha=!0)})),Promise.all(s).then((()=>S))}_createMorphTargets(C,M,x,f,T){if(!f.targets||!this._parent.loadMorphTargets)return;if(void 0==M._numMorphTargets)M._numMorphTargets=f.targets.length;else if(f.targets.length!==M._numMorphTargets)throw new Error(`${C}: Primitives do not have the same number of targets`);const z=x.extras?x.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,T.morphTargetManager=new Z(this._babylonScene),T.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,T.morphTargetManager.areUpdatesFrozen=!0;for(let s=0;s<f.targets.length;s++){const C=M.weights?M.weights[s]:x.weights?x.weights[s]:0,f=z?z[s]:`morphTarget${s}`;T.morphTargetManager.addTarget(new c(f,C,T.va()))}}_loadMorphTargetsAsync(C,M,x,f){if(!M.targets||!this._parent.loadMorphTargets)return Promise.resolve();const T=new Array,z=x.morphTargetManager;for(let s=0;s<z.numTargets;s++){const x=z.getTarget(s);T.push(this._loadMorphTargetVertexDataAsync(`${C}/targets/${s}`,f,M.targets[s],x))}return Promise.all(T).then((()=>{z.areUpdatesFrozen=!1}))}_loadMorphTargetVertexDataAsync(C,M,x,f){const T=new Array,z=(f,z,s)=>{if(void 0==x[f])return;const S=M.getVertexBuffer(z);if(!S)return;const m=e.Get(`${C}/${f}`,this._gltf.accessors,x[f]);T.push(this._loadFloatAccessorAsync(`/accessors/${m.index}`,m).then((C=>{s(S,C)})))};return z("POSITION",B.h.PositionKind,((C,M)=>{const x=new Float32Array(M.length);C.forEach(M.length,((C,f)=>{x[f]=M[f]+C})),f.setPositions(x)})),z("NORMAL",B.h.NormalKind,((C,M)=>{const x=new Float32Array(M.length);C.forEach(x.length,((C,f)=>{x[f]=M[f]+C})),f.setNormals(x)})),z("TANGENT",B.h.TangentKind,((C,M)=>{const x=new Float32Array(M.length/3*4);let T=0;C.forEach(M.length/3*4,((C,f)=>{(f+1)%4!==0&&(x[T]=M[T]+C,T++)})),f.setTangents(x)})),Promise.all(T).then((()=>{}))}static _LoadTransform(C,M){if(void 0!=C.skin)return;let x=T.m.Zero(),f=T.h.Identity(),z=T.m.One();if(C.matrix){T.d.Dd(C.matrix).decompose(z,f,x)}else C.translation&&(x=T.m.Dd(C.translation)),C.rotation&&(f=T.h.Dd(C.rotation)),C.scale&&(z=T.m.Dd(C.scale));M.position=x,M.rotationQuaternion=f,M.Qd=z}_loadSkinAsync(C,M,x,f){if(!this._parent.loadSkins)return Promise.resolve();const T=this._extensionsLoadSkinAsync(C,M,x);if(T)return T;if(x._data)return f(x._data.babylonSkeleton),x._data.promise;const z=`skeleton${x.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const s=new L(x.name||z,z,this._babylonScene);s._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(C,x,s);const S=this._loadSkinInverseBindMatricesDataAsync(C,x).then((C=>{this._updateBoneMatrices(s,C)}));return x._data={babylonSkeleton:s,promise:S},f(s),S}_loadBones(C,M,x){if(void 0==M.skeleton||this._parent.alwaysComputeSkeletonRootNode){const x=this._findSkeletonRootNode(`${C}/joints`,M.joints);if(x)if(void 0===M.skeleton)M.skeleton=x.index;else{const f=(C,M)=>{for(;M.parent;M=M.parent)if(M.parent===C)return!0;return!1},T=e.Get(`${C}/skeleton`,this._gltf.nodes,M.skeleton);T===x||f(T,x)||(D.e.Warn(`${C}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),M.skeleton=x.index)}else D.e.Warn(`${C}: Failed to find common root`)}const f={};for(const T of M.joints){const z=e.Get(`${C}/joints/${T}`,this._gltf.nodes,T);this._loadBone(z,M,x,f)}}_findSkeletonRootNode(C,M){if(0===M.length)return null;const x={};for(const T of M){const M=[];let f=e.Get(`${C}/${T}`,this._gltf.nodes,T);for(;-1!==f.index;)M.unshift(f),f=f.parent;x[T]=M}let f=null;for(let T=0;;++T){let C=x[M[0]];if(T>=C.length)return f;const z=C[T];for(let s=1;s<M.length;++s)if(C=x[M[s]],T>=C.length||z!==C[T])return f;f=z}}_loadBone(C,M,x,f){C._isJoint=!0;let T=f[C.index];if(T)return T;let z=null;C.index!==M.skeleton&&(C.parent&&-1!==C.parent.index?z=this._loadBone(C.parent,M,x,f):void 0!==M.skeleton&&D.e.Warn(`/skins/${M.index}/skeleton: Skeleton node is not a common root`));const s=M.joints.indexOf(C.index);return T=new Q.c(C.name||`joint${C.index}`,x,z,this._getNodeMatrix(C),null,null,s),f[C.index]=T,this._postSceneLoadActions.push((()=>{T.linkTransformNode(C._babylonTransformNode)})),T}_loadSkinInverseBindMatricesDataAsync(C,M){if(void 0==M.inverseBindMatrices)return Promise.resolve(null);const x=e.Get(`${C}/inverseBindMatrices`,this._gltf.accessors,M.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${x.index}`,x)}_updateBoneMatrices(C,M){for(const x of C.bones){const C=T.d.Identity(),f=x._index;M&&-1!==f&&(T.d.FromArrayToRef(M,16*f,C),C.invertToRef(C));const z=x.getParent();z&&C.multiplyToRef(z.getAbsoluteInverseBindMatrix(),C),x.ee(C,!1,!1),x._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(C){return C.matrix?T.d.Dd(C.matrix):T.d.Compose(C.scale?T.m.Dd(C.scale):T.m.One(),C.rotation?T.h.Dd(C.rotation):T.h.Identity(),C.translation?T.m.Dd(C.translation):T.m.Zero())}loadCameraAsync(C,M){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const f=this._extensionsLoadCameraAsync(C,M,x);if(f)return f;const z=new Array;this.logOpen(`${C} ${M.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const s=new m.e(M.name||`camera${M.index}`,T.m.Zero(),this._babylonScene,!1);switch(s._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,s.ignoreParentScaling=!0,M._babylonCamera=s,s.rotation.set(0,Math.PI,0),M.type){case"perspective":{const x=M.perspective;if(!x)throw new Error(`${C}: Camera perspective properties are missing`);s.fov=x.yfov,s.lj=x.znear,s.maxZ=x.zfar||0;break}case"orthographic":if(!M.orthographic)throw new Error(`${C}: Camera orthographic properties are missing`);s.mode=S.c.ORTHOGRAPHIC_CAMERA,s.orthoLeft=-M.orthographic.xmag,s.orthoRight=M.orthographic.xmag,s.orthoBottom=-M.orthographic.ymag,s.orthoTop=M.orthographic.ymag,s.lj=M.orthographic.znear,s.maxZ=M.orthographic.zfar;break;default:throw new Error(`${C}: Invalid camera type (${M.type})`)}return r.AddPointerMetadata(s,C),this._parent.onCameraLoadedObservable.notifyObservers(s),x(s),this.logClose(),Promise.all(z).then((()=>s))}_loadAnimationsAsync(){const C=this._gltf.animations;if(!C)return Promise.resolve();const M=new Array;for(let x=0;x<C.length;x++){const f=C[x];M.push(this.loadAnimationAsync(`/animations/${f.index}`,f).then((C=>{0===C.targetedAnimations.length&&C.dispose()})))}return Promise.all(M).then((()=>{}))}loadAnimationAsync(C,M){const f=this._extensionsLoadAnimationAsync(C,M);return f||x.e(43).then(x.bind(x,13008)).then((x=>{let{AnimationGroup:f}=x;this._babylonScene._blockEntityCollection=!!this._assetContainer;const T=new f(M.name||`animation${M.index}`,this._babylonScene);T._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,M._babylonAnimationGroup=T;const z=new Array;e.Assign(M.channels),e.Assign(M.samplers);for(const s of M.channels)z.push(this._loadAnimationChannelAsync(`${C}/channels/${s.index}`,C,M,s,((C,M)=>{C.animations=C.animations||[],C.animations.push(M),T.addTargetedAnimation(M,C)})));return Promise.all(z).then((()=>(T.normalize(0),T)))}))}_loadAnimationChannelAsync(C,M,x,f,T){const z=this._extensionsLoadAnimationChannelAsync(C,M,x,f,T);if(z)return z;if(void 0==f.target.node)return Promise.resolve();const s=e.Get(`${C}/target/node`,this._gltf.nodes,f.target.node),S=f.target.path,m="weights"===S;if(m&&!s._numMorphTargets||!m&&!s._babylonTransformNode)return Promise.resolve();if(!this._parent.loadNodeAnimations&&!m&&!s._isJoint)return Promise.resolve();let Q;switch(S){case"translation":Q=k.translation;break;case"rotation":Q=k.rotation;break;case"scale":Q=k.scale;break;case"weights":Q=k.weights;break;default:throw new Error(`${C}/target/path: Invalid value (${f.target.path})`)}const V={object:s,info:Q};return this._loadAnimationChannelFromTargetInfoAsync(C,M,x,f,V,T)}_loadAnimationChannelFromTargetInfoAsync(C,M,x,f,T,z){const s=this.parent.targetFps,S=1/s,m=e.Get(`${C}/sampler`,x.samplers,f.sampler);return this._loadAnimationSamplerAsync(`${M}/samplers/${f.sampler}`,m).then((C=>{let M=0;const m=T.object,Q=T.info;for(const T of Q){const Q=T.getStride(m),V=C.input,y=C.output,U=new Array(V.length);let O=0;switch(C.interpolation){case"STEP":for(let C=0;C<V.length;C++){const M=T.getValue(m,y,O,1);O+=Q,U[C]={frame:V[C]*s,value:M,interpolation:1}}break;case"CUBICSPLINE":for(let C=0;C<V.length;C++){const M=T.getValue(m,y,O,S);O+=Q;const x=T.getValue(m,y,O,1);O+=Q;const f=T.getValue(m,y,O,S);O+=Q,U[C]={frame:V[C]*s,inTangent:M,value:x,outTangent:f}}break;case"LINEAR":for(let C=0;C<V.length;C++){const M=T.getValue(m,y,O,1);O+=Q,U[C]={frame:V[C]*s,value:M}}}if(O>0){const C=`${x.name||`animation${x.index}`}_channel${f.index}_${M}`;T.buildAnimations(m,C,s,U,((C,x)=>{++M,z(C,x)}))}}}))}_loadAnimationSamplerAsync(C,M){if(M._data)return M._data;const x=M.interpolation||"LINEAR";switch(x){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${C}/interpolation: Invalid value (${M.interpolation})`)}const f=e.Get(`${C}/input`,this._gltf.accessors,M.input),T=e.Get(`${C}/output`,this._gltf.accessors,M.output);return M._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${f.index}`,f),this._loadFloatAccessorAsync(`/accessors/${T.index}`,T)]).then((C=>{let[M,f]=C;return{input:M,interpolation:x,output:f}})),M._data}loadBufferAsync(C,M,x,f){const T=this._extensionsLoadBufferAsync(C,M,x,f);if(T)return T;if(!M._data)if(M.uri)M._data=this.loadUriAsync(`${C}/uri`,M,M.uri);else{if(!this._bin)throw new Error(`${C}: Uri is missing or the binary glTF is missing its binary chunk`);M._data=this._bin.readAsync(0,M.byteLength)}return M._data.then((M=>{try{return new Uint8Array(M.buffer,M.byteOffset+x,f)}catch(T){throw new Error(`${C}: ${T.message}`)}}))}loadBufferViewAsync(C,M){const x=this._extensionsLoadBufferViewAsync(C,M);if(x)return x;if(M._data)return M._data;const f=e.Get(`${C}/buffer`,this._gltf.buffers,M.buffer);return M._data=this.loadBufferAsync(`/buffers/${f.index}`,f,M.byteOffset||0,M.byteLength),M._data}_loadAccessorAsync(C,M,x){if(M._data)return M._data;const f=r._GetNumComponents(C,M.type),T=f*B.h.GetTypeByteLength(M.componentType),z=f*M.count;if(void 0==M.bufferView)M._data=Promise.resolve(new x(z));else{const s=e.Get(`${C}/bufferView`,this._gltf.bufferViews,M.bufferView);M._data=this.loadBufferViewAsync(`/bufferViews/${s.index}`,s).then((S=>{if(5126!==M.componentType||M.normalized||s.byteStride&&s.byteStride!==T){const C=new x(z);return B.h.ForEach(S,M.byteOffset||0,s.byteStride||T,f,M.componentType,C.length,M.normalized||!1,((M,x)=>{C[x]=M})),C}return r._GetTypedArray(C,M.componentType,S,M.byteOffset,z)}))}if(M.sparse){const z=M.sparse;M._data=M._data.then((s=>{const S=s,m=e.Get(`${C}/sparse/indices/bufferView`,this._gltf.bufferViews,z.indices.bufferView),Q=e.Get(`${C}/sparse/values/bufferView`,this._gltf.bufferViews,z.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${m.index}`,m),this.loadBufferViewAsync(`/bufferViews/${Q.index}`,Q)]).then((s=>{let[m,Q]=s;const V=r._GetTypedArray(`${C}/sparse/indices`,z.indices.componentType,m,z.indices.byteOffset,z.count),y=f*z.count;let U;if(5126!==M.componentType||M.normalized){const s=r._GetTypedArray(`${C}/sparse/values`,M.componentType,Q,z.values.byteOffset,y);U=new x(y),B.h.ForEach(s,0,T,f,M.componentType,U.length,M.normalized||!1,((C,M)=>{U[M]=C}))}else U=r._GetTypedArray(`${C}/sparse/values`,M.componentType,Q,z.values.byteOffset,y);let O=0;for(let C=0;C<V.length;C++){let M=V[C]*f;for(let C=0;C<f;C++)S[M++]=U[O++]}return S}))}))}return M._data}_loadFloatAccessorAsync(C,M){return this._loadAccessorAsync(C,M,Float32Array)}_loadIndicesAccessorAsync(C,M){if("SCALAR"!==M.type)throw new Error(`${C}/type: Invalid value ${M.type}`);if(5121!==M.componentType&&5123!==M.componentType&&5125!==M.componentType)throw new Error(`${C}/componentType: Invalid value ${M.componentType}`);if(M._data)return M._data;if(M.sparse){const x=r._GetTypedArrayConstructor(`${C}/componentType`,M.componentType);M._data=this._loadAccessorAsync(C,M,x)}else{const x=e.Get(`${C}/bufferView`,this._gltf.bufferViews,M.bufferView);M._data=this.loadBufferViewAsync(`/bufferViews/${x.index}`,x).then((x=>r._GetTypedArray(C,M.componentType,x,M.byteOffset,M.count)))}return M._data}_loadVertexBufferViewAsync(C){if(C._babylonBuffer)return C._babylonBuffer;const M=this._babylonScene.getEngine();return C._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${C.index}`,C).then((C=>new B.e(M,C,!1))),C._babylonBuffer}_loadVertexAccessorAsync(C,M,x){var f;if(null!==(f=M._babylonVertexBuffer)&&void 0!==f&&f[x])return M._babylonVertexBuffer[x];M._babylonVertexBuffer||(M._babylonVertexBuffer={});const T=this._babylonScene.getEngine();if(M.sparse||void 0==M.bufferView)M._babylonVertexBuffer[x]=this._loadFloatAccessorAsync(C,M).then((C=>new B.h(T,C,x,!1)));else{const f=e.Get(`${C}/bufferView`,this._gltf.bufferViews,M.bufferView);M._babylonVertexBuffer[x]=this._loadVertexBufferViewAsync(f).then((z=>{const s=r._GetNumComponents(C,M.type);return new B.h(T,z,x,!1,void 0,f.byteStride,void 0,M.byteOffset,s,M.componentType,M.normalized,!0,void 0,!0)}))}return M._babylonVertexBuffer[x]}_loadMaterialMetallicRoughnessPropertiesAsync(C,M,x){if(!(x instanceof I))throw new Error(`${C}: Material type not supported`);const f=new Array;return M&&(M.baseColorFactor?(x.albedoColor=z.d.Dd(M.baseColorFactor),x.alpha=M.baseColorFactor[3]):x.albedoColor=z.d.White(),x.metallic=void 0==M.metallicFactor?1:M.metallicFactor,x.roughness=void 0==M.roughnessFactor?1:M.roughnessFactor,M.baseColorTexture&&f.push(this.loadTextureInfoAsync(`${C}/baseColorTexture`,M.baseColorTexture,(C=>{C.name=`${x.name} (Base Color)`,x.albedoTexture=C}))),M.metallicRoughnessTexture&&(M.metallicRoughnessTexture.nonColorData=!0,f.push(this.loadTextureInfoAsync(`${C}/metallicRoughnessTexture`,M.metallicRoughnessTexture,(C=>{C.name=`${x.name} (Metallic Roughness)`,x.metallicTexture=C}))),x.useMetallnessFromMetallicTextureBlue=!0,x.useRoughnessFromMetallicTextureGreen=!0,x.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(f).then((()=>{}))}_loadMaterialAsync(C,M,x,f){let T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const z=this._extensionsLoadMaterialAsync(C,M,x,f,T);if(z)return z;M._data=M._data||{};let s=M._data[f];if(!s){this.logOpen(`${C} ${M.name||""}`);const x=this.createMaterial(C,M,f);s={babylonMaterial:x,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(C,M,x)},M._data[f]=s,r.AddPointerMetadata(x,C),this._parent.onMaterialLoadedObservable.notifyObservers(x),this.logClose()}return x&&(s.babylonMeshes.push(x),x.Sd.addOnce((()=>{const C=s.babylonMeshes.indexOf(x);-1!==C&&s.babylonMeshes.splice(C,1)}))),T(s.babylonMaterial),s.promise.then((()=>s.babylonMaterial))}_createDefaultMaterial(C,M){this._babylonScene._blockEntityCollection=!!this._assetContainer;const x=new I(C,this._babylonScene);return x._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,x.fillMode=M,x.enableSpecularAntiAliasing=!0,x.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,x.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,x.transparencyMode=I.PBRMATERIAL_OPAQUE,x.metallic=1,x.roughness=1,x}createMaterial(C,M,x){const f=this._extensionsCreateMaterial(C,M,x);if(f)return f;const T=M.name||`material${M.index}`;return this._createDefaultMaterial(T,x)}loadMaterialPropertiesAsync(C,M,x){const f=this._extensionsLoadMaterialPropertiesAsync(C,M,x);if(f)return f;const T=new Array;return T.push(this.loadMaterialBasePropertiesAsync(C,M,x)),M.pbrMetallicRoughness&&T.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${C}/pbrMetallicRoughness`,M.pbrMetallicRoughness,x)),this.loadMaterialAlphaProperties(C,M,x),Promise.all(T).then((()=>{}))}loadMaterialBasePropertiesAsync(C,M,x){if(!(x instanceof I))throw new Error(`${C}: Material type not supported`);const f=new Array;return x.emissiveColor=M.emissiveFactor?z.d.Dd(M.emissiveFactor):new z.d(0,0,0),M.doubleSided&&(x.Me=!1,x.twoSidedLighting=!0),M.normalTexture&&(M.normalTexture.nonColorData=!0,f.push(this.loadTextureInfoAsync(`${C}/normalTexture`,M.normalTexture,(C=>{C.name=`${x.name} (Normal)`,x.bumpTexture=C}))),x.invertNormalMapX=!this._babylonScene.useRightHandedSystem,x.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=M.normalTexture.scale&&x.bumpTexture&&(x.bumpTexture.level=M.normalTexture.scale),x.forceIrradianceInFragment=!0),M.occlusionTexture&&(M.occlusionTexture.nonColorData=!0,f.push(this.loadTextureInfoAsync(`${C}/occlusionTexture`,M.occlusionTexture,(C=>{C.name=`${x.name} (Occlusion)`,x.ambientTexture=C}))),x.useAmbientInGrayScale=!0,void 0!=M.occlusionTexture.strength&&(x.ambientTextureStrength=M.occlusionTexture.strength)),M.emissiveTexture&&f.push(this.loadTextureInfoAsync(`${C}/emissiveTexture`,M.emissiveTexture,(C=>{C.name=`${x.name} (Emissive)`,x.emissiveTexture=C}))),Promise.all(f).then((()=>{}))}loadMaterialAlphaProperties(C,M,x){if(!(x instanceof I))throw new Error(`${C}: Material type not supported`);switch(M.alphaMode||"OPAQUE"){case"OPAQUE":x.transparencyMode=I.PBRMATERIAL_OPAQUE,x.alpha=1;break;case"MASK":x.transparencyMode=I.PBRMATERIAL_ALPHATEST,x.alphaCutOff=void 0==M.alphaCutoff?.5:M.alphaCutoff,x.albedoTexture&&(x.albedoTexture.rd=!0);break;case"BLEND":x.transparencyMode=I.PBRMATERIAL_ALPHABLEND,x.albedoTexture&&(x.albedoTexture.rd=!0,x.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${C}/alphaMode: Invalid value (${M.alphaMode})`)}}loadTextureInfoAsync(C,M){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const f=this._extensionsLoadTextureInfoAsync(C,M,x);if(f)return f;if(this.logOpen(`${C}`),M.texCoord>=6)throw new Error(`${C}/texCoord: Invalid value (${M.texCoord})`);const T=e.Get(`${C}/index`,this._gltf.textures,M.index);T._textureInfo=M;const z=this._loadTextureAsync(`/textures/${M.index}`,T,(f=>{f.coordinatesIndex=M.texCoord||0,r.AddPointerMetadata(f,C),this._parent.onTextureLoadedObservable.notifyObservers(f),x(f)}));return this.logClose(),z}_loadTextureAsync(C,M){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const f=this._extensionsLoadTextureAsync(C,M,x);if(f)return f;this.logOpen(`${C} ${M.name||""}`);const T=void 0==M.sampler?r.DefaultSampler:e.Get(`${C}/sampler`,this._gltf.samplers,M.sampler),z=e.Get(`${C}/source`,this._gltf.images,M.source),s=this._createTextureAsync(C,T,z,x,void 0,!M._textureInfo.nonColorData);return this.logClose(),s}_createTextureAsync(C,M,x){let T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},z=arguments.length>4?arguments[4]:void 0,s=arguments.length>5?arguments[5]:void 0;const S=this._loadSampler(`/samplers/${M.index}`,M),m=new Array,Q=new f;this._babylonScene._blockEntityCollection=!!this._assetContainer;const V={noMipmap:S.noMipMaps,invertY:!1,samplingMode:S.samplingMode,X:()=>{this._disposed||Q.resolve()},onError:(M,x)=>{this._disposed||Q.reject(new Error(`${C}: ${x&&x.message?x.message:M||"Failed to load texture"}`))},mimeType:x.mimeType,loaderOptions:z,useSRGBBuffer:!!s&&this._parent.useSRGBBuffers},y=new X.b(null,this._babylonScene,V);return y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,m.push(Q.promise),m.push(this.loadImageAsync(`/images/${x.index}`,x).then((C=>{const M=x.uri||`${this._fileName}#image${x.index}`,f=`data:${this._uniqueRootUrl}${M}`;y.updateURL(f,C);const T=y.getInternalTexture();T&&(T.label=x.name)}))),y.wrapU=S.wrapU,y.wrapV=S.wrapV,T(y),this._parent.useGltfTextureNames&&(y.name=x.name||x.uri||`image${x.index}`),Promise.all(m).then((()=>y))}_loadSampler(C,M){return M._data||(M._data={noMipMaps:9728===M.minFilter||9729===M.minFilter,samplingMode:r._GetTextureSamplingMode(C,M),wrapU:r._GetTextureWrapMode(`${C}/wrapS`,M.wrapS),wrapV:r._GetTextureWrapMode(`${C}/wrapT`,M.wrapT)}),M._data}loadImageAsync(C,M){if(!M._data){if(this.logOpen(`${C} ${M.name||""}`),M.uri)M._data=this.loadUriAsync(`${C}/uri`,M,M.uri);else{const x=e.Get(`${C}/bufferView`,this._gltf.bufferViews,M.bufferView);M._data=this.loadBufferViewAsync(`/bufferViews/${x.index}`,x)}this.logClose()}return M._data}loadUriAsync(C,M,x){const f=this._extensionsLoadUriAsync(C,M,x);if(f)return f;if(!r._ValidateUri(x))throw new Error(`${C}: '${x}' is invalid`);if((0,K.f)(x)){const M=new Uint8Array((0,K.b)(x));return this.log(`${C}: Decoded ${x.substring(0,64)}... (${M.length} bytes)`),Promise.resolve(M)}return this.log(`${C}: Loading ${x}`),this._parent.preprocessUrlAsync(this._rootUrl+x).then((M=>new Promise(((f,T)=>{this._parent._loadFile(this._babylonScene,M,(M=>{this._disposed||(this.log(`${C}: Loaded ${x} (${M.byteLength} bytes)`),f(new Uint8Array(M)))}),!0,(M=>{T(new K.g(`${C}: Failed to load '${x}'${M?": "+M.status+" "+M.statusText:""}`,M))}))}))))}static AddPointerMetadata(C,M){C.metadata=C.metadata||{};const x=C._internalMetadata=C._internalMetadata||{},f=x.gj=x.gj||{};(f.pointers=f.pointers||[]).push(M)}static _GetTextureWrapMode(C,M){switch(M=void 0==M?10497:M){case 33071:return X.b.CLAMP_ADDRESSMODE;case 33648:return X.b.MIRROR_ADDRESSMODE;case 10497:return X.b.WRAP_ADDRESSMODE;default:return D.e.Warn(`${C}: Invalid value (${M})`),X.b.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(C,M){const x=void 0==M.magFilter?9729:M.magFilter,f=void 0==M.minFilter?9987:M.minFilter;if(9729===x)switch(f){case 9728:return X.b.LINEAR_NEAREST;case 9729:return X.b.LINEAR_LINEAR;case 9984:return X.b.LINEAR_NEAREST_MIPNEAREST;case 9985:return X.b.LINEAR_LINEAR_MIPNEAREST;case 9986:return X.b.LINEAR_NEAREST_MIPLINEAR;case 9987:return X.b.LINEAR_LINEAR_MIPLINEAR;default:return D.e.Warn(`${C}/minFilter: Invalid value (${f})`),X.b.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==x&&D.e.Warn(`${C}/magFilter: Invalid value (${x})`),f){case 9728:return X.b.NEAREST_NEAREST;case 9729:return X.b.NEAREST_LINEAR;case 9984:return X.b.NEAREST_NEAREST_MIPNEAREST;case 9985:return X.b.NEAREST_LINEAR_MIPNEAREST;case 9986:return X.b.NEAREST_NEAREST_MIPLINEAR;case 9987:return X.b.NEAREST_LINEAR_MIPLINEAR;default:return D.e.Warn(`${C}/minFilter: Invalid value (${f})`),X.b.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(C,M){switch(M){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`${C}: Invalid component type ${M}`)}}static _GetTypedArray(C,M,x,f,T){const z=x.buffer;f=x.byteOffset+(f||0);const s=r._GetTypedArrayConstructor(`${C}/componentType`,M),S=B.h.GetTypeByteLength(M);return f%S!==0?(D.e.Warn(`${C}: Copying buffer as byte offset (${f}) is not a multiple of component type byte length (${S})`),new s(z.slice(f,f+T*S),0)):new s(z,f,T)}static _GetNumComponents(C,M){switch(M){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${C}: Invalid type (${M})`)}static _ValidateUri(C){return s.i.IsBase64(C)||-1===C.indexOf("..")}static _GetDrawMode(C,M){switch(void 0==M&&(M=4),M){case 0:return t.c.PointListDrawMode;case 1:return t.c.LineListDrawMode;case 2:return t.c.LineLoopDrawMode;case 3:return t.c.LineStripDrawMode;case 4:return t.c.TriangleFillMode;case 5:return t.c.TriangleStripDrawMode;case 6:return t.c.TriangleFanDrawMode}throw new Error(`${C}: Invalid mesh primitive mode (${M})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const C=new Array;if(this._gltf.materials)for(const M of this._gltf.materials)if(M._data)for(const x in M._data){const f=M._data[x];for(const M of f.babylonMeshes){M.Be(!0);const x=f.babylonMaterial;C.push(x.forceCompilationAsync(M)),C.push(x.forceCompilationAsync(M,{useInstances:!0})),this._parent.useClipPlane&&(C.push(x.forceCompilationAsync(M,{clipPlane:!0})),C.push(x.forceCompilationAsync(M,{clipPlane:!0,useInstances:!0})))}}return Promise.all(C).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const C=new Array,M=this._babylonScene.lights;for(const x of M){const M=x.getShadowGenerator();M&&C.push(M.forceCompilationAsync())}return Promise.all(C).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(C){for(const M of this._extensions)M.enabled&&C(M)}_applyExtensions(C,M,x){for(const f of this._extensions)if(f.enabled){const T=`${f.name}.${M}`,z=C;z._activeLoaderExtensionFunctions=z._activeLoaderExtensionFunctions||{};const s=z._activeLoaderExtensionFunctions;if(!s[T]){s[T]=!0;try{const C=x(f);if(C)return C}finally{delete s[T]}}}return null}_extensionsOnLoading(){this._forEachExtensions((C=>C.onLoading&&C.onLoading()))}_extensionsOnReady(){this._forEachExtensions((C=>C.onReady&&C.onReady()))}_extensionsLoadSceneAsync(C,M){return this._applyExtensions(M,"loadScene",(x=>x.loadSceneAsync&&x.loadSceneAsync(C,M)))}_extensionsLoadNodeAsync(C,M,x){return this._applyExtensions(M,"loadNode",(f=>f.loadNodeAsync&&f.loadNodeAsync(C,M,x)))}_extensionsLoadCameraAsync(C,M,x){return this._applyExtensions(M,"loadCamera",(f=>f.loadCameraAsync&&f.loadCameraAsync(C,M,x)))}_extensionsLoadVertexDataAsync(C,M,x){return this._applyExtensions(M,"loadVertexData",(f=>f._loadVertexDataAsync&&f._loadVertexDataAsync(C,M,x)))}_extensionsLoadMeshPrimitiveAsync(C,M,x,f,T,z){return this._applyExtensions(T,"loadMeshPrimitive",(s=>s._loadMeshPrimitiveAsync&&s._loadMeshPrimitiveAsync(C,M,x,f,T,z)))}_extensionsLoadMaterialAsync(C,M,x,f,T){return this._applyExtensions(M,"loadMaterial",(z=>z._loadMaterialAsync&&z._loadMaterialAsync(C,M,x,f,T)))}_extensionsCreateMaterial(C,M,x){return this._applyExtensions(M,"createMaterial",(f=>f.createMaterial&&f.createMaterial(C,M,x)))}_extensionsLoadMaterialPropertiesAsync(C,M,x){return this._applyExtensions(M,"loadMaterialProperties",(f=>f.loadMaterialPropertiesAsync&&f.loadMaterialPropertiesAsync(C,M,x)))}_extensionsLoadTextureInfoAsync(C,M,x){return this._applyExtensions(M,"loadTextureInfo",(f=>f.loadTextureInfoAsync&&f.loadTextureInfoAsync(C,M,x)))}_extensionsLoadTextureAsync(C,M,x){return this._applyExtensions(M,"loadTexture",(f=>f._loadTextureAsync&&f._loadTextureAsync(C,M,x)))}_extensionsLoadAnimationAsync(C,M){return this._applyExtensions(M,"loadAnimation",(x=>x.loadAnimationAsync&&x.loadAnimationAsync(C,M)))}_extensionsLoadAnimationChannelAsync(C,M,x,f,T){return this._applyExtensions(x,"loadAnimationChannel",(z=>z._loadAnimationChannelAsync&&z._loadAnimationChannelAsync(C,M,x,f,T)))}_extensionsLoadSkinAsync(C,M,x){return this._applyExtensions(x,"loadSkin",(f=>f._loadSkinAsync&&f._loadSkinAsync(C,M,x)))}_extensionsLoadUriAsync(C,M,x){return this._applyExtensions(M,"loadUri",(f=>f._loadUriAsync&&f._loadUriAsync(C,M,x)))}_extensionsLoadBufferViewAsync(C,M){return this._applyExtensions(M,"loadBufferView",(x=>x.loadBufferViewAsync&&x.loadBufferViewAsync(C,M)))}_extensionsLoadBufferAsync(C,M,x,f){return this._applyExtensions(M,"loadBuffer",(T=>T.loadBufferAsync&&T.loadBufferAsync(C,M,x,f)))}static LoadExtensionAsync(C,M,x,f){if(!M.extensions)return null;const T=M.extensions[x];return T?f(`${C}/extensions/${x}`,T):null}static LoadExtraAsync(C,M,x,f){if(!M.extras)return null;const T=M.extras[x];return T?f(`${C}/extras/${x}`,T):null}isExtensionUsed(C){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(C)}logOpen(C){this._parent._logOpen(C)}logClose(){this._parent._logClose()}log(C){this._parent._log(C)}startPerformanceCounter(C){this._parent._startPerformanceCounter(C)}endPerformanceCounter(C){this._parent._endPerformanceCounter(C)}}r.DefaultSampler={index:-1},E.d._CreateGLTF2Loader=C=>new r(C);var w=x(1434),l=x(10662),CC=x(12368);class MC extends CC.d{constructor(C,M,x){let f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,z=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,m=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",C),this._texture=C.getEngine().createRawCubeTexture(M,x,f,T,z,s,S,m)}update(C,M,x,f){let T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,C,M,x,f,T)}updateRGBDAsync(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,l.m)(this._texture,C,M,x,f).then((()=>{}))}clone(){return n.e.Clone((()=>{const C=this.va(),M=this._texture,x=new MC(C,M._bufferViewArray,M.width,M.format,M.type,M.generateMipMaps,M.invertY,M.samplingMode,M._compression);return 13===M.source&&x.updateRGBDAsync(M._bufferViewArrayArray,M._sphericalPolynomial,M._lodGenerationScale,M._lodGenerationOffset),x}),this)}}const xC="EXT_lights_image_based";class fC{constructor(C){this.name=xC,this._loader=C,this.enabled=this._loader.isExtensionUsed(xC)}dispose(){this._loader=null,delete this._lights}onLoading(){const C=this._loader.gj.extensions;if(C&&C[this.name]){const M=C[this.name];this._lights=M.lights}}loadSceneAsync(C,M){return r.LoadExtensionAsync(C,M,this.name,((x,f)=>{this._loader._allMaterialsDirtyRequired=!0;const T=new Array;T.push(this._loader.loadSceneAsync(C,M)),this._loader.logOpen(`${x}`);const z=e.Get(`${x}/light`,this._lights,f.eb);return T.push(this._loadLightAsync(`/extensions/${this.name}/lights/${f.eb}`,z).then((C=>{this._loader.babylonScene.environmentTexture=C}))),this._loader.logClose(),Promise.all(T).then((()=>{}))}))}_loadLightAsync(C,M){if(!M._loaded){const x=new Array;this._loader.logOpen(`${C}`);const f=new Array(M.specularImages.length);for(let T=0;T<M.specularImages.length;T++){const z=M.specularImages[T];f[T]=new Array(z.length);for(let M=0;M<z.length;M++){const s=`${C}/specularImages/${T}/${M}`;this._loader.logOpen(`${s}`);const S=z[M],m=e.Get(s,this._loader.gj.images,S);x.push(this._loader.loadImageAsync(`/images/${S}`,m).then((C=>{f[T][M]=C}))),this._loader.logClose()}}this._loader.logClose(),M._loaded=Promise.all(x).then((()=>{const x=new MC(this._loader.babylonScene,null,M.specularImageSize);if(x.name=M.name||"environment",M._babylonTexture=x,void 0!=M.pj&&(x.level=M.pj),M.rotation){let C=T.h.Dd(M.rotation);this._loader.babylonScene.useRightHandedSystem||(C=T.h.Inverse(C)),T.d.FromQuaternionToRef(C,x.getReflectionTextureMatrix())}if(!M.irradianceCoefficients)throw new Error(`${C}: Irradiance coefficients are missing`);const z=w.d.Dd(M.irradianceCoefficients);z.scaleInPlace(M.pj),z.convertIrradianceToLambertianRadiance();const s=w.e.FromHarmonics(z),S=(f.length-1)/Math.log2(M.specularImageSize);return x.updateRGBDAsync(f,s,S)}))}return M._loaded.then((()=>M._babylonTexture))}}Y(xC),u(xC,!0,(C=>new fC(C)));x(12376);const TC="EXT_mesh_gpu_instancing";class zC{constructor(C){this.name=TC,this._loader=C,this.enabled=this._loader.isExtensionUsed(TC)}dispose(){this._loader=null}loadNodeAsync(C,M,x){return r.LoadExtensionAsync(C,M,this.name,((C,f)=>{this._loader._disableInstancedMesh++;const z=this._loader.loadNodeAsync(`/nodes/${M.index}`,M,x);if(this._loader._disableInstancedMesh--,!M._primitiveBabylonMeshes)return z;const s=new Array;let S=0;const m=M=>{if(void 0==f.attributes[M])return void s.push(Promise.resolve(null));const x=e.Get(`${C}/attributes/${M}`,this._loader.gj.accessors,f.attributes[M]);if(s.push(this._loader._loadFloatAccessorAsync(`/accessors/${x.bufferView}`,x)),0===S)S=x.count;else if(S!==x.count)throw new Error(`${C}/attributes: Instance buffer accessors do not have the same count.`)};return m("TRANSLATION"),m("ROTATION"),m("SCALE"),z.then((C=>Promise.all(s).then((x=>{let[f,z,s]=x;const m=new Float32Array(16*S);T.i.Md[0].Hd(0,0,0),T.i.Quaternion[0].Hd(0,0,0,1),T.i.Md[1].Hd(1,1,1);for(let C=0;C<S;++C)f&&T.m.FromArrayToRef(f,3*C,T.i.Md[0]),z&&T.h.FromArrayToRef(z,4*C,T.i.Quaternion[0]),s&&T.m.FromArrayToRef(s,3*C,T.i.Md[1]),T.d.ComposeToRef(T.i.Md[1],T.i.Quaternion[0],T.i.Md[0],T.i.Matrix[0]),T.i.Matrix[0].copyToArray(m,16*C);for(const C of M._primitiveBabylonMeshes)C.Yj("matrix",m,16,!0);return C}))))}))}}Y(TC),u(TC,!0,(C=>new zC(C)));class sC{static get Default(){return sC._Default||(sC._Default=new sC),sC._Default}constructor(){const C=sC.Configuration.decoder;this._decoderModulePromise=s.i.LoadBabylonScriptAsync(C.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}decodeGltfBufferAsync(C,M,x,f,T){return this._decoderModulePromise.then((async()=>{MeshoptDecoder.useWorkers(1);const z=await MeshoptDecoder.decodeGltfBufferAsync(M,x,C,f,T);return MeshoptDecoder.useWorkers(0),z}))}}sC.Configuration={decoder:{url:`${s.i._DefaultCdnUrl}/meshopt_decoder.js`}},sC._Default=null;const SC="EXT_meshopt_compression";class mC{constructor(C){this.name=SC,this.enabled=C.isExtensionUsed(SC),this._loader=C}dispose(){this._loader=null}loadBufferViewAsync(C,M){return r.LoadExtensionAsync(C,M,this.name,((x,f)=>{const T=M;if(T._meshOptData)return T._meshOptData;const z=e.Get(`${C}/buffer`,this._loader.gj.buffers,f.buffer);return T._meshOptData=this._loader.loadBufferAsync(`/buffers/${z.index}`,z,f.byteOffset||0,f.byteLength).then((C=>sC.Default.decodeGltfBufferAsync(C,f.count,f.byteStride,f.mode,f.filter))),T._meshOptData}))}}Y(SC),u(SC,!0,(C=>new mC(C)));const QC="EXT_texture_webp";class VC{constructor(C){this.name=QC,this._loader=C,this.enabled=C.isExtensionUsed(QC)}dispose(){this._loader=null}_loadTextureAsync(C,M,x){return r.LoadExtensionAsync(C,M,this.name,((f,T)=>{const z=void 0==M.sampler?r.DefaultSampler:e.Get(`${C}/sampler`,this._loader.gj.samplers,M.sampler),s=e.Get(`${f}/source`,this._loader.gj.images,T.source);return this._loader._createTextureAsync(C,z,s,(C=>{x(C)}),void 0,!M._textureInfo.nonColorData)}))}}Y(QC),u(QC,!0,(C=>new VC(C)));const yC="EXT_texture_avif";class UC{constructor(C){this.name=yC,this._loader=C,this.enabled=C.isExtensionUsed(yC)}dispose(){this._loader=null}_loadTextureAsync(C,M,x){return r.LoadExtensionAsync(C,M,this.name,((f,T)=>{const z=void 0==M.sampler?r.DefaultSampler:e.Get(`${C}/sampler`,this._loader.gj.samplers,M.sampler),s=e.Get(`${f}/source`,this._loader.gj.images,T.source);return this._loader._createTextureAsync(C,z,s,(C=>{x(C)}),void 0,!M._textureInfo.nonColorData)}))}}Y(yC),u(yC,!0,(C=>new UC(C)));var OC=x(12380);const dC="KHR_draco_mesh_compression";class DC{constructor(C){this.name=dC,this.useNormalizedFlagFromAccessor=!0,this._loader=C,this.enabled=OC.c.DecoderAvailable&&this._loader.isExtensionUsed(dC)}dispose(){delete this.dracoCompression,this._loader=null}_loadVertexDataAsync(C,M,x){return r.LoadExtensionAsync(C,M,this.name,((f,T)=>{if(void 0!=M.mode&&4!==M.mode&&5!==M.mode)throw new Error(`${C}: Unsupported mode ${M.mode}`);const z={},s={},S=(C,f)=>{const S=T.attributes[C];if(void 0!=S&&(x._delayInfo=x._delayInfo||[],-1===x._delayInfo.indexOf(f)&&x._delayInfo.push(f),z[f]=S,this.useNormalizedFlagFromAccessor)){const x=e.TryGet(this._loader.gj.accessors,M.attributes[C]);x&&(s[f]=x.normalized||!1)}};S("POSITION",B.h.PositionKind),S("NORMAL",B.h.NormalKind),S("TANGENT",B.h.TangentKind),S("TEXCOORD_0",B.h.UVKind),S("TEXCOORD_1",B.h.UV2Kind),S("TEXCOORD_2",B.h.UV3Kind),S("TEXCOORD_3",B.h.UV4Kind),S("TEXCOORD_4",B.h.UV5Kind),S("TEXCOORD_5",B.h.UV6Kind),S("JOINTS_0",B.h.MatricesIndicesKind),S("WEIGHTS_0",B.h.MatricesWeightsKind),S("COLOR_0",B.h.ColorKind);const m=e.Get(f,this._loader.gj.bufferViews,T.bufferView);return m._dracoBabylonGeometry||(m._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${m.index}`,m).then((M=>(this.dracoCompression||OC.c.Default)._decodeMeshToGeometryForGltfAsync(x.name,this._loader.babylonScene,M,z,s).catch((M=>{throw new Error(`${C}: ${M.message}`)}))))),m._dracoBabylonGeometry}))}}Y(dC),u(dC,!0,(C=>new DC(C)));var oC=x(12384),LC=x(11734),tC=x(12359),AC=x(12390);LC.e.AddNodeConstructor("Light_Type_0",((C,M)=>()=>new HC(C,T.m.Zero(),M)));class HC extends AC.e{get shadowAngle(){return this._shadowAngle}set shadowAngle(C){this._shadowAngle=C,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(C){const M=this.needCube();if(this._direction=C,this.needCube()!==M&&this._shadowGenerators){const C=this._shadowGenerators.values();for(let M=C.next();!0!==M.done;M=C.next()){M.value.recreateShadowMap()}}}constructor(C,M,x){super(C,x),this._shadowAngle=Math.PI/2,this.position=M}getClassName(){return"PointLight"}getTypeID(){return tC.c.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(C){if(this.direction)return super.getShadowDirection(C);switch(C){case 0:return new T.m(1,0,0);case 1:return new T.m(-1,0,0);case 2:return new T.m(0,-1,0);case 3:return new T.m(0,1,0);case 4:return new T.m(0,0,1);case 5:return new T.m(0,0,-1)}return T.m.Zero()}_setDefaultShadowProjectionMatrix(C,M,x){const f=this.va().activeCamera;if(!f)return;const z=void 0!==this.shadowMinZ?this.shadowMinZ:f.lj,s=void 0!==this.shadowMaxZ?this.shadowMaxZ:f.maxZ,S=this.va().getEngine().useReverseDepthBuffer;T.d.PerspectiveFovLHToRef(this.shadowAngle,1,S?s:z,S?z:s,C,!0,this._scene.getEngine().isNDCHalfZRange,void 0,S)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(C,M){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,M):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,M),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,M),this}transferToNodeMaterialEffect(C,M){return this.computeTransformedInformation()?C.setFloat3(M,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):C.setFloat3(M,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(C,M){C["POINTLIGHT"+M]=!0}}(0,A.e)([(0,H.J)()],HC.prototype,"shadowAngle",null),(0,R.f)("BABYLON.PointLight",HC),LC.e.AddNodeConstructor("Light_Type_2",((C,M)=>()=>new jC(C,T.m.Zero(),T.m.Zero(),0,0,M)));class jC extends AC.e{get angle(){return this._angle}set angle(C){this._angle=C,this._cosHalfAngle=Math.cos(.5*C),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(C){this._innerAngle=C,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(C){this._shadowAngleScale=C,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(C){this._projectionTextureLightNear=C,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(C){this._projectionTextureLightFar=C,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(C){this._projectionTextureUpDirection=C,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(C){this._projectionTexture!==C&&(this._projectionTexture=C,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(jC._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):jC._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(C){return void 0!==C.onGeneratedObservable}static _IsTexture(C){return void 0!==C.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(C){this._projectionTextureProjectionLightMatrix=C,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(C,M,x,f,z,s){super(C,s),this._innerAngle=0,this._projectionTextureMatrix=T.d.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=T.m.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=T.m.Zero(),this._projectionTextureViewLightMatrix=T.d.Zero(),this._projectionTextureProjectionLightMatrix=T.d.Zero(),this._projectionTextureScalingMatrix=T.d.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=M,this.direction=x,this.angle=f,this.exponent=z}getClassName(){return"SpotLight"}getTypeID(){return tC.c.LIGHTTYPEID_SPOTLIGHT}_setDirection(C){super._setDirection(C),this._projectionTextureViewLightDirty=!0}_setPosition(C){super._setPosition(C),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(C,M,x){const f=this.va().activeCamera;if(!f)return;this._shadowAngleScale=this._shadowAngleScale||1;const z=this._shadowAngleScale*this._angle,s=void 0!==this.shadowMinZ?this.shadowMinZ:f.lj,S=void 0!==this.shadowMaxZ?this.shadowMaxZ:f.maxZ,m=this.va().getEngine().useReverseDepthBuffer;T.d.PerspectiveFovLHToRef(z,1,m?S:s,m?s:S,C,!0,this._scene.getEngine().isNDCHalfZRange,void 0,m)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),T.d.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const C=this.projectionTextureLightFar,M=this.projectionTextureLightNear,x=C/(C-M),f=-x*M,z=1/Math.tan(this._angle/2);T.d.FromValuesToRef(z/1,0,0,0,0,z,0,0,0,0,x,1,0,0,f,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof X.b){const C=this._projectionTexture.uScale/2,M=this._projectionTexture.vScale/2;T.d.FromValuesToRef(C,0,0,0,0,M,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(C,M){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),C.setMatrix("textureProjectionMatrix"+M,this._projectionTextureMatrix),C.setTexture("projectionLightTexture"+M,this.projectionTexture)),this}transferToEffect(C,M){let x;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,M),x=T.m.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,M),x=T.m.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",x.x,x.y,x.z,this._cosHalfAngle,M),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,M),this}transferToNodeMaterialEffect(C,M){let x;return x=this.computeTransformedInformation()?T.m.Normalize(this.transformedDirection):T.m.Normalize(this.direction),this.va().useRightHandedSystem?C.setFloat3(M,-x.x,-x.y,-x.z):C.setFloat3(M,x.x,x.y,x.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose()}getDepthMinZ(C){const M=this._scene.getEngine(),x=void 0!==this.shadowMinZ?this.shadowMinZ:C.lj;return M.useReverseDepthBuffer&&M.isNDCHalfZRange?x:this._scene.getEngine().isNDCHalfZRange?0:x}getDepthMaxZ(C){const M=this._scene.getEngine(),x=void 0!==this.shadowMaxZ?this.shadowMaxZ:C.maxZ;return M.useReverseDepthBuffer&&M.isNDCHalfZRange?0:x}prepareLightSpecificDefines(C,M){C["SPOTLIGHT"+M]=!0,C["PROJECTEDLIGHTTEXTURE"+M]=!(!this.projectionTexture||!this.projectionTexture.isReady())}}(0,A.e)([(0,H.J)()],jC.prototype,"angle",null),(0,A.e)([(0,H.J)()],jC.prototype,"innerAngle",null),(0,A.e)([(0,H.J)()],jC.prototype,"shadowAngleScale",null),(0,A.e)([(0,H.J)()],jC.prototype,"exponent",void 0),(0,A.e)([(0,H.J)()],jC.prototype,"projectionTextureLightNear",null),(0,A.e)([(0,H.J)()],jC.prototype,"projectionTextureLightFar",null),(0,A.e)([(0,H.J)()],jC.prototype,"projectionTextureUpDirection",null),(0,A.e)([(0,H.A)("projectedLightTexture")],jC.prototype,"_projectionTexture",void 0),(0,R.f)("BABYLON.SpotLight",jC);const bC="KHR_lights_punctual";class RC{constructor(C){this.name=bC,this._loader=C,this.enabled=this._loader.isExtensionUsed(bC)}dispose(){this._loader=null,delete this._lights}onLoading(){const C=this._loader.gj.extensions;if(C&&C[this.name]){const M=C[this.name];this._lights=M.lights,e.Assign(this._lights)}}loadNodeAsync(C,M,x){return r.LoadExtensionAsync(C,M,this.name,((f,s)=>(this._loader._allMaterialsDirtyRequired=!0,this._loader.loadNodeAsync(C,M,(C=>{let M;const S=e.Get(f,this._lights,s.eb),m=S.name||C.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,S.type){case"directional":{const C=new oC.b(m,T.m.Backward(),this._loader.babylonScene);C.position.Kd(0),M=C;break}case"point":M=new HC(m,T.m.Zero(),this._loader.babylonScene);break;case"spot":{const C=new jC(m,T.m.Zero(),T.m.Backward(),0,1,this._loader.babylonScene);C.angle=2*(S.spot&&S.spot.outerConeAngle||Math.PI/4),C.innerAngle=2*(S.spot&&S.spot.innerConeAngle||0),M=C;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${f}: Invalid light type (${S.type})`)}M._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,S._babylonLight=M,M.falloffType=tC.c.FALLOFF_GLTF,M.Zh=S.color?z.d.Dd(S.color):z.d.White(),M.pj=void 0==S.pj?1:S.pj,M.range=void 0==S.range?Number.MAX_VALUE:S.range,M.parent=C,this._loader._babylonLights.push(M),r.AddPointerMetadata(M,f),x(C)})))))}}Y(bC),u(bC,!0,(C=>new RC(C)));const nC="KHR_materials_pbrSpecularGlossiness";class IC{constructor(C){this.name=nC,this.order=200,this._loader=C,this.enabled=this._loader.isExtensionUsed(nC)}dispose(){this._loader=null}loadMaterialPropertiesAsync(C,M,x){return r.LoadExtensionAsync(C,M,this.name,((f,T)=>{const z=new Array;return z.push(this._loader.loadMaterialBasePropertiesAsync(C,M,x)),z.push(this._loadSpecularGlossinessPropertiesAsync(f,T,x)),this._loader.loadMaterialAlphaProperties(C,M,x),Promise.all(z).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(C,M,x){if(!(x instanceof I))throw new Error(`${C}: Material type not supported`);const f=new Array;return x.metallic=null,x.roughness=null,M.diffuseFactor?(x.albedoColor=z.d.Dd(M.diffuseFactor),x.alpha=M.diffuseFactor[3]):x.albedoColor=z.d.White(),x.reflectivityColor=M.specularFactor?z.d.Dd(M.specularFactor):z.d.White(),x.microSurface=void 0==M.glossinessFactor?1:M.glossinessFactor,M.diffuseTexture&&f.push(this._loader.loadTextureInfoAsync(`${C}/diffuseTexture`,M.diffuseTexture,(C=>{C.name=`${x.name} (Diffuse)`,x.albedoTexture=C}))),M.specularGlossinessTexture&&(f.push(this._loader.loadTextureInfoAsync(`${C}/specularGlossinessTexture`,M.specularGlossinessTexture,(C=>{C.name=`${x.name} (Specular Glossiness)`,x.reflectivityTexture=C,x.reflectivityTexture.rd=!0}))),x.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(f).then((()=>{}))}}Y(nC),u(nC,!0,(C=>new IC(C)));const XC="KHR_materials_unlit";class gC{constructor(C){this.name=XC,this.order=210,this._loader=C,this.enabled=this._loader.isExtensionUsed(XC)}dispose(){this._loader=null}loadMaterialPropertiesAsync(C,M,x){return r.LoadExtensionAsync(C,M,this.name,(()=>this._loadUnlitPropertiesAsync(C,M,x)))}_loadUnlitPropertiesAsync(C,M,x){if(!(x instanceof I))throw new Error(`${C}: Material type not supported`);const f=new Array;x.unlit=!0;const T=M.pbrMetallicRoughness;return T&&(T.baseColorFactor?(x.albedoColor=z.d.Dd(T.baseColorFactor),x.alpha=T.baseColorFactor[3]):x.albedoColor=z.d.White(),T.baseColorTexture&&f.push(this._loader.loadTextureInfoAsync(`${C}/baseColorTexture`,T.baseColorTexture,(C=>{C.name=`${x.name} (Base Color)`,x.albedoTexture=C})))),M.doubleSided&&(x.Me=!1,x.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(C,M,x),Promise.all(f).then((()=>{}))}}Y(XC),u(XC,!0,(C=>new gC(C)));const BC="KHR_materials_clearcoat";class FC{constructor(C){this.name=BC,this.order=190,this._loader=C,this.enabled=this._loader.isExtensionUsed(BC)}dispose(){this._loader=null}loadMaterialPropertiesAsync(C,M,x){return r.LoadExtensionAsync(C,M,this.name,((f,T)=>{const z=new Array;return z.push(this._loader.loadMaterialPropertiesAsync(C,M,x)),z.push(this._loadClearCoatPropertiesAsync(f,T,x)),Promise.all(z).then((()=>{}))}))}_loadClearCoatPropertiesAsync(C,M,x){if(!(x instanceof I))throw new Error(`${C}: Material type not supported`);const f=new Array;return x.clearCoat.isEnabled=!0,x.clearCoat.useRoughnessFromMainTexture=!1,x.clearCoat.remapF0OnInterfaceChange=!1,void 0!=M.clearcoatFactor?x.clearCoat.pj=M.clearcoatFactor:x.clearCoat.pj=0,M.clearcoatTexture&&f.push(this._loader.loadTextureInfoAsync(`${C}/clearcoatTexture`,M.clearcoatTexture,(C=>{C.name=`${x.name} (ClearCoat)`,x.clearCoat.texture=C}))),void 0!=M.clearcoatRoughnessFactor?x.clearCoat.roughness=M.clearcoatRoughnessFactor:x.clearCoat.roughness=0,M.clearcoatRoughnessTexture&&(M.clearcoatRoughnessTexture.nonColorData=!0,f.push(this._loader.loadTextureInfoAsync(`${C}/clearcoatRoughnessTexture`,M.clearcoatRoughnessTexture,(C=>{C.name=`${x.name} (ClearCoat Roughness)`,x.clearCoat.textureRoughness=C})))),M.clearcoatNormalTexture&&(M.clearcoatNormalTexture.nonColorData=!0,f.push(this._loader.loadTextureInfoAsync(`${C}/clearcoatNormalTexture`,M.clearcoatNormalTexture,(C=>{C.name=`${x.name} (ClearCoat Normal)`,x.clearCoat.bumpTexture=C}))),x.invertNormalMapX=!x.va().useRightHandedSystem,x.invertNormalMapY=x.va().useRightHandedSystem,void 0!=M.clearcoatNormalTexture.scale&&(x.clearCoat.bumpTexture.level=M.clearcoatNormalTexture.scale)),Promise.all(f).then((()=>{}))}}Y(BC),u(BC,!0,(C=>new FC(C)));const PC="KHR_materials_iridescence";class hC{constructor(C){this.name=PC,this.order=195,this._loader=C,this.enabled=this._loader.isExtensionUsed(PC)}dispose(){this._loader=null}loadMaterialPropertiesAsync(C,M,x){return r.LoadExtensionAsync(C,M,this.name,((f,T)=>{const z=new Array;return z.push(this._loader.loadMaterialPropertiesAsync(C,M,x)),z.push(this._loadIridescencePropertiesAsync(f,T,x)),Promise.all(z).then((()=>{}))}))}_loadIridescencePropertiesAsync(C,M,x){if(!(x instanceof I))throw new Error(`${C}: Material type not supported`);const f=new Array;return x.iridescence.isEnabled=!0,x.iridescence.pj=M.iridescenceFactor??0,x.iridescence.indexOfRefraction=M.iridescenceIor??M.iridescenceIOR??1.3,x.iridescence.minimumThickness=M.iridescenceThicknessMinimum??100,x.iridescence.maximumThickness=M.iridescenceThicknessMaximum??400,M.iridescenceTexture&&f.push(this._loader.loadTextureInfoAsync(`${C}/iridescenceTexture`,M.iridescenceTexture,(C=>{C.name=`${x.name} (Iridescence)`,x.iridescence.texture=C}))),M.iridescenceThicknessTexture&&f.push(this._loader.loadTextureInfoAsync(`${C}/iridescenceThicknessTexture`,M.iridescenceThicknessTexture,(C=>{C.name=`${x.name} (Iridescence Thickness)`,x.iridescence.thicknessTexture=C}))),Promise.all(f).then((()=>{}))}}Y(PC),u(PC,!0,(C=>new hC(C)));const cC="KHR_materials_anisotropy";class qC{constructor(C){this.name=cC,this.order=195,this._loader=C,this.enabled=this._loader.isExtensionUsed(cC)}dispose(){this._loader=null}loadMaterialPropertiesAsync(C,M,x){return r.LoadExtensionAsync(C,M,this.name,((f,T)=>{const z=new Array;return z.push(this._loader.loadMaterialPropertiesAsync(C,M,x)),z.push(this._loadIridescencePropertiesAsync(f,T,x)),Promise.all(z).then((()=>{}))}))}_loadIridescencePropertiesAsync(C,M,x){if(!(x instanceof I))throw new Error(`${C}: Material type not supported`);const f=new Array;return x.anisotropy.isEnabled=!0,x.anisotropy.pj=M.anisotropyStrength??0,x.anisotropy.angle=M.anisotropyRotation??0,M.anisotropyTexture&&(M.anisotropyTexture.nonColorData=!0,f.push(this._loader.loadTextureInfoAsync(`${C}/anisotropyTexture`,M.anisotropyTexture,(C=>{C.name=`${x.name} (Anisotropy Intensity)`,x.anisotropy.texture=C})))),Promise.all(f).then((()=>{}))}}Y(cC),u(cC,!0,(C=>new qC(C)));const iC="KHR_materials_emissive_strength";class ZC{constructor(C){this.name=iC,this.order=170,this._loader=C,this.enabled=this._loader.isExtensionUsed(iC)}dispose(){this._loader=null}loadMaterialPropertiesAsync(C,M,x){return r.LoadExtensionAsync(C,M,this.name,((f,T)=>this._loader.loadMaterialPropertiesAsync(C,M,x).then((()=>{this._loadEmissiveProperties(f,T,x)}))))}_loadEmissiveProperties(C,M,x){if(!(x instanceof I))throw new Error(`${C}: Material type not supported`);void 0!==M.emissiveStrength&&(x.emissiveIntensity=M.emissiveStrength)}}Y(iC),u(iC,!0,(C=>new ZC(C)));const EC="KHR_materials_sheen";class KC{constructor(C){this.name=EC,this.order=190,this._loader=C,this.enabled=this._loader.isExtensionUsed(EC)}dispose(){this._loader=null}loadMaterialPropertiesAsync(C,M,x){return r.LoadExtensionAsync(C,M,this.name,((f,T)=>{const z=new Array;return z.push(this._loader.loadMaterialPropertiesAsync(C,M,x)),z.push(this._loadSheenPropertiesAsync(f,T,x)),Promise.all(z).then((()=>{}))}))}_loadSheenPropertiesAsync(C,M,x){if(!(x instanceof I))throw new Error(`${C}: Material type not supported`);const f=new Array;return x.sheen.isEnabled=!0,x.sheen.pj=1,void 0!=M.sheenColorFactor?x.sheen.color=z.d.Dd(M.sheenColorFactor):x.sheen.color=z.d.Black(),M.sheenColorTexture&&f.push(this._loader.loadTextureInfoAsync(`${C}/sheenColorTexture`,M.sheenColorTexture,(C=>{C.name=`${x.name} (Sheen Color)`,x.sheen.texture=C}))),void 0!==M.sheenRoughnessFactor?x.sheen.roughness=M.sheenRoughnessFactor:x.sheen.roughness=0,M.sheenRoughnessTexture&&(M.sheenRoughnessTexture.nonColorData=!0,f.push(this._loader.loadTextureInfoAsync(`${C}/sheenRoughnessTexture`,M.sheenRoughnessTexture,(C=>{C.name=`${x.name} (Sheen Roughness)`,x.sheen.textureRoughness=C})))),x.sheen.albedoScaling=!0,x.sheen.useRoughnessFromMainTexture=!1,Promise.all(f).then((()=>{}))}}Y(EC),u(EC,!0,(C=>new KC(C)));const GC="KHR_materials_specular";class aC{constructor(C){this.name=GC,this.order=190,this._loader=C,this.enabled=this._loader.isExtensionUsed(GC)}dispose(){this._loader=null}loadMaterialPropertiesAsync(C,M,x){return r.LoadExtensionAsync(C,M,this.name,((f,T)=>{const z=new Array;return z.push(this._loader.loadMaterialPropertiesAsync(C,M,x)),z.push(this._loadSpecularPropertiesAsync(f,T,x)),Promise.all(z).then((()=>{}))}))}_loadSpecularPropertiesAsync(C,M,x){if(!(x instanceof I))throw new Error(`${C}: Material type not supported`);const f=new Array;return void 0!==M.specularFactor&&(x.metallicF0Factor=M.specularFactor),void 0!==M.specularColorFactor&&(x.metallicReflectanceColor=z.d.Dd(M.specularColorFactor)),M.specularTexture&&(M.specularTexture.nonColorData=!0,f.push(this._loader.loadTextureInfoAsync(`${C}/specularTexture`,M.specularTexture,(C=>{C.name=`${x.name} (Specular)`,x.metallicReflectanceTexture=C,x.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),M.specularColorTexture&&f.push(this._loader.loadTextureInfoAsync(`${C}/specularColorTexture`,M.specularColorTexture,(C=>{C.name=`${x.name} (Specular Color)`,x.reflectanceTexture=C}))),Promise.all(f).then((()=>{}))}}Y(GC),u(GC,!0,(C=>new aC(C)));const JC="KHR_materials_ior";class NC{constructor(C){this.name=JC,this.order=180,this._loader=C,this.enabled=this._loader.isExtensionUsed(JC)}dispose(){this._loader=null}loadMaterialPropertiesAsync(C,M,x){return r.LoadExtensionAsync(C,M,this.name,((f,T)=>{const z=new Array;return z.push(this._loader.loadMaterialPropertiesAsync(C,M,x)),z.push(this._loadIorPropertiesAsync(f,T,x)),Promise.all(z).then((()=>{}))}))}_loadIorPropertiesAsync(C,M,x){if(!(x instanceof I))throw new Error(`${C}: Material type not supported`);return void 0!==M.ior?x.indexOfRefraction=M.ior:x.indexOfRefraction=NC._DEFAULT_IOR,Promise.resolve()}}NC._DEFAULT_IOR=1.5,Y(JC),u(JC,!0,(C=>new NC(C)));const kC="KHR_materials_variants";class vC{constructor(C){this.name=kC,this._loader=C,this.enabled=this._loader.isExtensionUsed(kC)}dispose(){this._loader=null}static GetAvailableVariants(C){const M=this._GetExtensionMetadata(C);return M?Object.keys(M.variants):[]}getAvailableVariants(C){return vC.GetAvailableVariants(C)}static SelectVariant(C,M){const x=this._GetExtensionMetadata(C);if(!x)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${kC} extension`);const f=C=>{const M=x.variants[C];if(M)for(const x of M)x.mesh.material=x.material};if(M instanceof Array)for(const T of M)f(T);else f(M);x.lastSelected=M}selectVariant(C,M){vC.SelectVariant(C,M)}static Reset(C){const M=this._GetExtensionMetadata(C);if(!M)throw new Error(`Cannot reset on a glTF mesh that does not have the ${kC} extension`);for(const x of M.original)x.mesh.material=x.material;M.lastSelected=null}reset(C){vC.Reset(C)}static GetLastSelectedVariant(C){const M=this._GetExtensionMetadata(C);if(!M)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${kC} extension`);return M.lastSelected}getLastSelectedVariant(C){return vC.GetLastSelectedVariant(C)}static _GetExtensionMetadata(C){var M,x;return(null===C||void 0===C||null===(M=C._internalMetadata)||void 0===M||null===(x=M.gj)||void 0===x?void 0:x[kC])||null}onLoading(){const C=this._loader.gj.extensions;if(C&&C[this.name]){const M=C[this.name];this._variants=M.variants}}_loadMeshPrimitiveAsync(C,M,x,f,T,z){return r.LoadExtensionAsync(C,T,this.name,((s,S)=>{const m=new Array;return m.push(this._loader._loadMeshPrimitiveAsync(C,M,x,f,T,(M=>{if(z(M),M instanceof h.d){const x=r._GetDrawMode(C,T.mode),f=this._loader.rootBabylonMesh,z=f?f._internalMetadata=f._internalMetadata||{}:{},Q=z.gj=z.gj||{},V=Q[kC]=Q[kC]||{lastSelected:null,original:[],variants:{}};V.original.push({mesh:M,material:M.material});for(let C=0;C<S.mappings.length;++C){const T=S.mappings[C],z=e.Get(`${s}/mappings/${C}/material`,this._loader.gj.materials,T.material);m.push(this._loader._loadMaterialAsync(`#/materials/${T.material}`,z,M,x,(C=>{for(let x=0;x<T.variants.length;++x){const z=T.variants[x],s=e.Get(`/extensions/${kC}/variants/${z}`,this._variants,z);V.variants[s.name]=V.variants[s.name]||[],V.variants[s.name].push({mesh:M,material:C}),M.onClonedObservable.add((C=>{const x=C;let T=null,z=x;do{if(z=z.parent,!z)return;T=vC._GetExtensionMetadata(z)}while(null===T);if(f&&T===vC._GetExtensionMetadata(f)){z._internalMetadata={};for(const C in f._internalMetadata)z._internalMetadata[C]=f._internalMetadata[C];z._internalMetadata.gj=[];for(const C in f._internalMetadata.gj)z._internalMetadata.gj[C]=f._internalMetadata.gj[C];z._internalMetadata.gj[kC]={lastSelected:null,original:[],variants:{}};for(const C of T.original)z._internalMetadata.gj[kC].original.push({mesh:C.mesh,material:C.material});for(const C in T.variants)if(Object.prototype.hasOwnProperty.call(T.variants,C)){z._internalMetadata.gj[kC].variants[C]=[];for(const M of T.variants[C])z._internalMetadata.gj[kC].variants[C].push({mesh:M.mesh,material:M.material})}T=z._internalMetadata.gj[kC]}for(const f of T.original)f.mesh===M&&(f.mesh=x);for(const f of T.variants[s.name])f.mesh===M&&(f.mesh=x)}))}})))}}}))),Promise.all(m).then((C=>{let[M]=C;return M}))}))}}Y(kC),u(kC,!0,(C=>new vC(C)));var pC=x(1477);class uC{}uC.AUTOSAMPLERSUFFIX="Sampler",uC.DISABLEUA="#define DISABLE_UNIFORMITY_ANALYSIS",uC.ALPHA_DISABLE=0,uC.ALPHA_ADD=1,uC.ALPHA_COMBINE=2,uC.ALPHA_SUBTRACT=3,uC.ALPHA_MULTIPLY=4,uC.ALPHA_MAXIMIZED=5,uC.ALPHA_ONEONE=6,uC.ALPHA_PREMULTIPLIED=7,uC.ALPHA_PREMULTIPLIED_PORTERDUFF=8,uC.ALPHA_INTERPOLATE=9,uC.ALPHA_SCREENMODE=10,uC.ALPHA_ONEONE_ONEONE=11,uC.ALPHA_ALPHATOCOLOR=12,uC.ALPHA_REVERSEONEMINUS=13,uC.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,uC.ALPHA_ONEONE_ONEZERO=15,uC.ALPHA_EXCLUSION=16,uC.ALPHA_LAYER_ACCUMULATE=17,uC.ALPHA_EQUATION_ADD=0,uC.ALPHA_EQUATION_SUBSTRACT=1,uC.ALPHA_EQUATION_REVERSE_SUBTRACT=2,uC.ALPHA_EQUATION_MAX=3,uC.ALPHA_EQUATION_MIN=4,uC.ALPHA_EQUATION_DARKEN=5,uC.DELAYLOADSTATE_NONE=0,uC.DELAYLOADSTATE_LOADED=1,uC.DELAYLOADSTATE_LOADING=2,uC.DELAYLOADSTATE_NOTLOADED=4,uC.NEVER=512,uC.ALWAYS=519,uC.LESS=513,uC.EQUAL=514,uC.LEQUAL=515,uC.GREATER=516,uC.GEQUAL=518,uC.NOTEQUAL=517,uC.KEEP=7680,uC.ZERO=0,uC.REPLACE=7681,uC.INCR=7682,uC.DECR=7683,uC.INVERT=5386,uC.INCR_WRAP=34055,uC.DECR_WRAP=34056,uC.TEXTURE_CLAMP_ADDRESSMODE=0,uC.TEXTURE_WRAP_ADDRESSMODE=1,uC.TEXTURE_MIRROR_ADDRESSMODE=2,uC.TEXTURE_CREATIONFLAG_STORAGE=1,uC.TEXTUREFORMAT_ALPHA=0,uC.TEXTUREFORMAT_LUMINANCE=1,uC.TEXTUREFORMAT_LUMINANCE_ALPHA=2,uC.TEXTUREFORMAT_RGB=4,uC.TEXTUREFORMAT_RGBA=5,uC.TEXTUREFORMAT_RED=6,uC.TEXTUREFORMAT_R=6,uC.TEXTUREFORMAT_RG=7,uC.TEXTUREFORMAT_RED_INTEGER=8,uC.TEXTUREFORMAT_R_INTEGER=8,uC.TEXTUREFORMAT_RG_INTEGER=9,uC.TEXTUREFORMAT_RGB_INTEGER=10,uC.TEXTUREFORMAT_RGBA_INTEGER=11,uC.TEXTUREFORMAT_BGRA=12,uC.TEXTUREFORMAT_DEPTH24_STENCIL8=13,uC.TEXTUREFORMAT_DEPTH32_FLOAT=14,uC.TEXTUREFORMAT_DEPTH16=15,uC.TEXTUREFORMAT_DEPTH24=16,uC.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17,uC.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18,uC.TEXTUREFORMAT_STENCIL8=19,uC.TEXTUREFORMAT_UNDEFINED=4294967295,uC.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492,uC.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493,uC.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495,uC.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494,uC.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779,uC.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919,uC.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778,uC.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918,uC.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777,uC.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776,uC.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917,uC.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916,uC.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808,uC.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840,uC.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196,uC.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492,uC.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493,uC.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494,uC.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495,uC.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496,uC.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497,uC.TEXTURETYPE_UNSIGNED_BYTE=0,uC.TEXTURETYPE_UNSIGNED_INT=0,uC.TEXTURETYPE_FLOAT=1,uC.TEXTURETYPE_HALF_FLOAT=2,uC.TEXTURETYPE_BYTE=3,uC.TEXTURETYPE_SHORT=4,uC.TEXTURETYPE_UNSIGNED_SHORT=5,uC.TEXTURETYPE_INT=6,uC.TEXTURETYPE_UNSIGNED_INTEGER=7,uC.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,uC.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,uC.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,uC.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,uC.TEXTURETYPE_UNSIGNED_INT_24_8=12,uC.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,uC.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,uC.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,uC.TEXTURETYPE_UNDEFINED=16,uC.TEXTURE_2D=3553,uC.TEXTURE_2D_ARRAY=35866,uC.TEXTURE_CUBE_MAP=34067,uC.TEXTURE_CUBE_MAP_ARRAY=3735928559,uC.TEXTURE_3D=32879,uC.TEXTURE_NEAREST_SAMPLINGMODE=1,uC.TEXTURE_NEAREST_NEAREST=1,uC.TEXTURE_BILINEAR_SAMPLINGMODE=2,uC.TEXTURE_LINEAR_LINEAR=2,uC.TEXTURE_TRILINEAR_SAMPLINGMODE=3,uC.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,uC.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,uC.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,uC.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,uC.TEXTURE_NEAREST_LINEAR=7,uC.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,uC.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,uC.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,uC.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,uC.TEXTURE_LINEAR_NEAREST=12,uC.TEXTURE_EXPLICIT_MODE=0,uC.TEXTURE_SPHERICAL_MODE=1,uC.TEXTURE_PLANAR_MODE=2,uC.TEXTURE_CUBIC_MODE=3,uC.TEXTURE_PROJECTION_MODE=4,uC.TEXTURE_SKYBOX_MODE=5,uC.TEXTURE_INVCUBIC_MODE=6,uC.TEXTURE_EQUIRECTANGULAR_MODE=7,uC.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,uC.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,uC.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,uC.TEXTURE_FILTERING_QUALITY_HIGH=64,uC.TEXTURE_FILTERING_QUALITY_MEDIUM=16,uC.TEXTURE_FILTERING_QUALITY_LOW=8,uC.SCALEMODE_FLOOR=1,uC.SCALEMODE_NEAREST=2,uC.SCALEMODE_CEILING=3,uC.MATERIAL_TextureDirtyFlag=1,uC.MATERIAL_LightDirtyFlag=2,uC.MATERIAL_FresnelDirtyFlag=4,uC.MATERIAL_AttributesDirtyFlag=8,uC.MATERIAL_MiscDirtyFlag=16,uC.MATERIAL_PrePassDirtyFlag=32,uC.MATERIAL_AllDirtyFlag=63,uC.MATERIAL_TriangleFillMode=0,uC.MATERIAL_WireFrameFillMode=1,uC.MATERIAL_PointFillMode=2,uC.MATERIAL_PointListDrawMode=3,uC.MATERIAL_LineListDrawMode=4,uC.MATERIAL_LineLoopDrawMode=5,uC.MATERIAL_LineStripDrawMode=6,uC.MATERIAL_TriangleStripDrawMode=7,uC.MATERIAL_TriangleFanDrawMode=8,uC.MATERIAL_ClockWiseSideOrientation=0,uC.MATERIAL_CounterClockWiseSideOrientation=1,uC.ACTION_NothingTrigger=0,uC.ACTION_OnPickTrigger=1,uC.ACTION_OnLeftPickTrigger=2,uC.ACTION_OnRightPickTrigger=3,uC.ACTION_OnCenterPickTrigger=4,uC.ACTION_OnPickDownTrigger=5,uC.ACTION_OnDoublePickTrigger=6,uC.ACTION_OnPickUpTrigger=7,uC.ACTION_OnPickOutTrigger=16,uC.ACTION_OnLongPressTrigger=8,uC.ACTION_OnPointerOverTrigger=9,uC.ACTION_OnPointerOutTrigger=10,uC.ACTION_OnEveryFrameTrigger=11,uC.ACTION_OnIntersectionEnterTrigger=12,uC.ACTION_OnIntersectionExitTrigger=13,uC.ACTION_OnKeyDownTrigger=14,uC.ACTION_OnKeyUpTrigger=15,uC.PARTICLES_BILLBOARDMODE_Y=2,uC.PARTICLES_BILLBOARDMODE_ALL=7,uC.PARTICLES_BILLBOARDMODE_STRETCHED=8,uC.PARTICLES_BILLBOARDMODE_STRETCHED_LOCAL=9,uC.MESHES_CULLINGSTRATEGY_STANDARD=0,uC.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,uC.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,uC.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,uC.SCENELOADER_NO_LOGGING=0,uC.SCENELOADER_MINIMAL_LOGGING=1,uC.SCENELOADER_SUMMARY_LOGGING=2,uC.SCENELOADER_DETAILED_LOGGING=3,uC.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,uC.PREPASS_POSITION_TEXTURE_TYPE=1,uC.PREPASS_VELOCITY_TEXTURE_TYPE=2,uC.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,uC.PREPASS_COLOR_TEXTURE_TYPE=4,uC.PREPASS_DEPTH_TEXTURE_TYPE=5,uC.PREPASS_NORMAL_TEXTURE_TYPE=6,uC.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7,uC.PREPASS_WORLD_NORMAL_TEXTURE_TYPE=8,uC.PREPASS_LOCAL_POSITION_TEXTURE_TYPE=9,uC.PREPASS_SCREENSPACE_DEPTH_TEXTURE_TYPE=10,uC.PREPASS_VELOCITY_LINEAR_TEXTURE_TYPE=11,uC.PREPASS_ALBEDO_TEXTURE_TYPE=12,uC.BUFFER_CREATIONFLAG_READ=1,uC.BUFFER_CREATIONFLAG_WRITE=2,uC.BUFFER_CREATIONFLAG_READWRITE=3,uC.BUFFER_CREATIONFLAG_UNIFORM=4,uC.BUFFER_CREATIONFLAG_VERTEX=8,uC.BUFFER_CREATIONFLAG_INDEX=16,uC.BUFFER_CREATIONFLAG_STORAGE=32,uC.BUFFER_CREATIONFLAG_INDIRECT=64,uC.RENDERPASS_MAIN=0,uC.INPUT_ALT_KEY=18,uC.INPUT_CTRL_KEY=17,uC.INPUT_META_KEY1=91,uC.INPUT_META_KEY2=92,uC.INPUT_META_KEY3=93,uC.INPUT_SHIFT_KEY=16,uC.SNAPSHOTRENDERING_STANDARD=0,uC.SNAPSHOTRENDERING_FAST=1,uC.PERSPECTIVE_CAMERA=0,uC.ORTHOGRAPHIC_CAMERA=1,uC.FOVMODE_VERTICAL_FIXED=0,uC.FOVMODE_HORIZONTAL_FIXED=1,uC.RIG_MODE_NONE=0,uC.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,uC.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,uC.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,uC.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,uC.RIG_MODE_STEREOSCOPIC_INTERLACED=14,uC.RIG_MODE_VR=20,uC.RIG_MODE_CUSTOM=22,uC.MAX_SUPPORTED_UV_SETS=6,uC.GL_ALPHA_EQUATION_ADD=32774,uC.GL_ALPHA_EQUATION_MIN=32775,uC.GL_ALPHA_EQUATION_MAX=32776,uC.GL_ALPHA_EQUATION_SUBTRACT=32778,uC.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779,uC.GL_ALPHA_FUNCTION_SRC=768,uC.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769,uC.GL_ALPHA_FUNCTION_SRC_ALPHA=770,uC.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771,uC.GL_ALPHA_FUNCTION_DST_ALPHA=772,uC.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773,uC.GL_ALPHA_FUNCTION_DST_COLOR=774,uC.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775,uC.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776,uC.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769,uC.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770,uC.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771,uC.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772,uC.GL_ALPHA_FUNCTION_SRC1_COLOR=35065,uC.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_COLOR=35066,uC.GL_ALPHA_FUNCTION_SRC1_ALPHA=34185,uC.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_ALPHA=35067,uC.SnippetUrl="https://snippet.babylonjs.com",uC.FOGMODE_NONE=0,uC.FOGMODE_EXP=1,uC.FOGMODE_EXP2=2,uC.FOGMODE_LINEAR=3,uC.BYTE=5120,uC.UNSIGNED_BYTE=5121,uC.SHORT=5122,uC.UNSIGNED_SHORT=5123,uC.INT=5124,uC.UNSIGNED_INT=5125,uC.FLOAT=5126,uC.PositionKind="position",uC.NormalKind="Nd",uC.TangentKind="tangent",uC.UVKind="uv",uC.UV2Kind="uv2",uC.UV3Kind="uv3",uC.UV4Kind="uv4",uC.UV5Kind="uv5",uC.UV6Kind="uv6",uC.ColorKind="color",uC.ColorInstanceKind="instanceColor",uC.MatricesIndicesKind="matricesIndices",uC.MatricesWeightsKind="matricesWeights",uC.MatricesIndicesExtraKind="matricesIndicesExtra",uC.MatricesWeightsExtraKind="matricesWeightsExtra";class YC{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:uC.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(C,M){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...YC._GetDefaultOptions(),...C},this._scene=M,this._scene._transmissionHelper=this,this.onErrorObservable=new V.c,this._scene.Sd.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(C){if(!Object.keys(C).filter((M=>this._options[M]!==C[M])).length)return;const M={...this._options,...C},x=this._options;this._options=M,M.renderSize===x.renderSize&&M.renderTargetTextureType===x.renderTargetTextureType&&M.generateMipmaps===x.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=M.samples,this._opaqueRenderTarget.lodGenerationScale=M.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=M.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(C){return!!C&&!!(C instanceof I&&C.subSurface.isRefractionEnabled)}_addMesh(C){this._materialObservers[C.uniqueId]=C.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),s.i.SetImmediate((()=>{this._shouldRenderAsTransmission(C.material)?(C.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(C)&&this._transparentMeshesCache.push(C)):-1===this._opaqueMeshesCache.indexOf(C)&&this._opaqueMeshesCache.push(C)}))}_removeMesh(C){C.onMaterialChangedObservable.remove(this._materialObservers[C.uniqueId]),delete this._materialObservers[C.uniqueId];let M=this._transparentMeshesCache.indexOf(C);-1!==M&&this._transparentMeshesCache.splice(M,1),M=this._opaqueMeshesCache.indexOf(C),-1!==M&&this._opaqueMeshesCache.splice(M,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(C){const M=this._transparentMeshesCache.indexOf(C),x=this._opaqueMeshesCache.indexOf(C);this._shouldRenderAsTransmission(C.material)?(C.material instanceof I&&(C.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==x?(this._opaqueMeshesCache.splice(x,1),this._transparentMeshesCache.push(C)):-1===M&&this._transparentMeshesCache.push(C)):-1!==M?(this._transparentMeshesCache.splice(M,1),this._opaqueMeshesCache.push(C)):-1===x&&this._opaqueMeshesCache.push(C)}_isRenderTargetValid(){var C;return null!==(null===(C=this._opaqueRenderTarget)||void 0===C?void 0:C.getInternalTexture())}_setupRenderTargets(){var C;let M,x;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new pC.d("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(C=this._options.clearColor)||void 0===C?void 0:C.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((C=>{x=this._scene.environmentIntensity,this._scene.environmentIntensity=1,M=this._scene.imageProcessingConfiguration.applyByPostProcess,this._options.clearColor?C.clearColor.p(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(C.clearColor,this._scene.getEngine().useExactSrgbConversions),this._scene.imageProcessingConfiguration._applyByPostProcess=!0})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=x,this._scene.imageProcessingConfiguration._applyByPostProcess=M})),this._transparentMeshesCache.forEach((C=>{this._shouldRenderAsTransmission(C.material)&&(C.material.refractionTexture=this._opaqueRenderTarget)}))}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const WC="KHR_materials_transmission";class eC{constructor(C){this.name=WC,this.order=175,this._loader=C,this.enabled=this._loader.isExtensionUsed(WC),this.enabled&&(C.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(C,M,x){return r.LoadExtensionAsync(C,M,this.name,((f,T)=>{const z=new Array;return z.push(this._loader.loadMaterialPropertiesAsync(C,M,x)),z.push(this._loadTransparentPropertiesAsync(f,M,x,T)),Promise.all(z).then((()=>{}))}))}_loadTransparentPropertiesAsync(C,M,x,f){if(!(x instanceof I))throw new Error(`${C}: Material type not supported`);const T=x;if(T.subSurface.isRefractionEnabled=!0,T.subSurface.volumeIndexOfRefraction=1,T.subSurface.useAlbedoToTintRefraction=!0,void 0===f.transmissionFactor)return T.subSurface.refractionIntensity=0,T.subSurface.isRefractionEnabled=!1,Promise.resolve();{var z;T.subSurface.refractionIntensity=f.transmissionFactor;const C=T.va();if(T.subSurface.refractionIntensity&&!C._transmissionHelper)new YC({},T.va());else if(T.subSurface.refractionIntensity&&(null===(z=C._transmissionHelper)||void 0===z||!z._isRenderTargetValid())){var s;null===(s=C._transmissionHelper)||void 0===s||s._setupRenderTargets()}}return T.subSurface.minimumThickness=0,T.subSurface.maximumThickness=0,f.transmissionTexture?(f.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${C}/transmissionTexture`,f.transmissionTexture,void 0).then((C=>{C.name=`${x.name} (Transmission)`,T.subSurface.refractionIntensityTexture=C,T.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}Y(WC),u(WC,!0,(C=>new eC(C)));const rC="KHR_materials_diffuse_transmission";class wC{constructor(C){this.name=rC,this.order=174,this._loader=C,this.enabled=this._loader.isExtensionUsed(rC),this.enabled&&(C.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(C,M,x){return r.LoadExtensionAsync(C,M,this.name,((f,T)=>{const z=new Array;return z.push(this._loader.loadMaterialPropertiesAsync(C,M,x)),z.push(this._loadTranslucentPropertiesAsync(f,M,x,T)),Promise.all(z).then((()=>{}))}))}_loadTranslucentPropertiesAsync(C,M,x,f){if(!(x instanceof I))throw new Error(`${C}: Material type not supported`);const T=x;if(T.subSurface.isTranslucencyEnabled=!0,T.subSurface.volumeIndexOfRefraction=1,T.subSurface.minimumThickness=0,T.subSurface.maximumThickness=0,T.subSurface.useAlbedoToTintTranslucency=!1,void 0===f.diffuseTransmissionFactor)return T.subSurface.translucencyIntensity=0,T.subSurface.isTranslucencyEnabled=!1,Promise.resolve();T.subSurface.translucencyIntensity=f.diffuseTransmissionFactor;const s=new Array;return T.subSurface.useGltfStyleTextures=!0,f.diffuseTransmissionTexture&&(f.diffuseTransmissionTexture.nonColorData=!0,s.push(this._loader.loadTextureInfoAsync(`${C}/diffuseTransmissionTexture`,f.diffuseTransmissionTexture).then((C=>{C.name=`${x.name} (Diffuse Transmission)`,T.subSurface.translucencyIntensityTexture=C})))),void 0!==f.diffuseTransmissionColorFactor?T.subSurface.translucencyColor=z.d.Dd(f.diffuseTransmissionColorFactor):T.subSurface.translucencyColor=z.d.White(),f.diffuseTransmissionColorTexture&&s.push(this._loader.loadTextureInfoAsync(`${C}/diffuseTransmissionColorTexture`,f.diffuseTransmissionColorTexture).then((C=>{C.name=`${x.name} (Diffuse Transmission Color)`,T.subSurface.translucencyColorTexture=C}))),Promise.all(s).then((()=>{}))}}Y(rC),u(rC,!0,(C=>new wC(C)));const lC="KHR_materials_volume";class CM{constructor(C){this.name=lC,this.order=173,this._loader=C,this.enabled=this._loader.isExtensionUsed(lC),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(C,M,x){return r.LoadExtensionAsync(C,M,this.name,((f,T)=>{const z=new Array;return z.push(this._loader.loadMaterialPropertiesAsync(C,M,x)),z.push(this._loadVolumePropertiesAsync(f,M,x,T)),Promise.all(z).then((()=>{}))}))}_loadVolumePropertiesAsync(C,M,x,f){if(!(x instanceof I))throw new Error(`${C}: Material type not supported`);if(!x.subSurface.isRefractionEnabled&&!x.subSurface.isTranslucencyEnabled||!f.thicknessFactor)return Promise.resolve();x.subSurface.volumeIndexOfRefraction=x.indexOfRefraction;const T=void 0!==f.attenuationDistance?f.attenuationDistance:Number.MAX_VALUE;return x.subSurface.tintColorAtDistance=T,void 0!==f.attenuationColor&&3==f.attenuationColor.length&&x.subSurface.tintColor.Hd(f.attenuationColor[0],f.attenuationColor[1],f.attenuationColor[2]),x.subSurface.minimumThickness=0,x.subSurface.maximumThickness=f.thicknessFactor,x.subSurface.useThicknessAsDepth=!0,f.thicknessTexture?(f.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${C}/thicknessTexture`,f.thicknessTexture).then((C=>{C.name=`${x.name} (Thickness)`,x.subSurface.thicknessTexture=C,x.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}Y(lC),u(lC,!0,(C=>new CM(C)));const MM="KHR_materials_dispersion";class xM{constructor(C){this.name=MM,this.order=174,this._loader=C,this.enabled=this._loader.isExtensionUsed(MM)}dispose(){this._loader=null}loadMaterialPropertiesAsync(C,M,x){return r.LoadExtensionAsync(C,M,this.name,((f,T)=>{const z=new Array;return z.push(this._loader.loadMaterialPropertiesAsync(C,M,x)),z.push(this._loadDispersionPropertiesAsync(f,M,x,T)),Promise.all(z).then((()=>{}))}))}_loadDispersionPropertiesAsync(C,M,x,f){if(!(x instanceof I))throw new Error(`${C}: Material type not supported`);return x.subSurface.isRefractionEnabled&&f.dispersion?(x.subSurface.isDispersionEnabled=!0,x.subSurface.dispersion=f.dispersion,Promise.resolve()):Promise.resolve()}}Y(MM),u(MM,!0,(C=>new xM(C)));const fM="KHR_mesh_quantization";class TM{constructor(C){this.name=fM,this.enabled=C.isExtensionUsed(fM)}dispose(){}}Y(fM),u(fM,!0,(C=>new TM(C)));const zM="KHR_texture_basisu";class sM{constructor(C){this.name=zM,this._loader=C,this.enabled=C.isExtensionUsed(zM)}dispose(){this._loader=null}_loadTextureAsync(C,M,x){return r.LoadExtensionAsync(C,M,this.name,((f,T)=>{const z=void 0==M.sampler?r.DefaultSampler:e.Get(`${C}/sampler`,this._loader.gj.samplers,M.sampler),s=e.Get(`${f}/source`,this._loader.gj.images,T.source);return this._loader._createTextureAsync(C,z,s,(C=>{x(C)}),M._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!M._textureInfo.nonColorData)}))}}Y(zM),u(zM,!0,(C=>new sM(C)));const SM="KHR_texture_transform";class mM{constructor(C){this.name=SM,this._loader=C,this.enabled=this._loader.isExtensionUsed(SM)}dispose(){this._loader=null}loadTextureInfoAsync(C,M,x){return r.LoadExtensionAsync(C,M,this.name,((f,T)=>this._loader.loadTextureInfoAsync(C,M,(C=>{if(!(C instanceof X.b))throw new Error(`${f}: Texture type not supported`);T.offset&&(C.uOffset=T.offset[0],C.vOffset=T.offset[1]),C.uRotationCenter=0,C.vRotationCenter=0,T.rotation&&(C.wAng=-T.rotation),T.scale&&(C.uScale=T.scale[0],C.vScale=T.scale[1]),void 0!=T.texCoord&&(C.coordinatesIndex=T.texCoord),x(C)}))))}}Y(SM),u(SM,!0,(C=>new mM(C)));const QM="KHR_xmp_json_ld";class VM{constructor(C){this.name=QM,this.order=100,this._loader=C,this.enabled=this._loader.isExtensionUsed(QM)}dispose(){this._loader=null}onLoading(){var C,M,x;if(null===this._loader.rootBabylonMesh)return;const f=null===(C=this._loader.gj.extensions)||void 0===C?void 0:C.KHR_xmp_json_ld,T=null===(M=this._loader.gj.asset)||void 0===M||null===(x=M.extensions)||void 0===x?void 0:x.KHR_xmp_json_ld;if(f&&T){const C=+T.packet;f.packets&&C<f.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=f.packets[C])}}}function yM(C,M,x,f){return z.d.Dd(M,x).scale(f)}function UM(C,M,x,f){return M[x]*f}function OM(C,M,x,f){return-M[x]*f}function dM(C,M,x,f){return M[x+1]*f}function DM(C,M,x,f){return M[x]*f*2}function oM(C){return{scale:[new tM(U.b.ANIMATIONTYPE_FLOAT,`${C}.uScale`,UM,(()=>2)),new tM(U.b.ANIMATIONTYPE_FLOAT,`${C}.vScale`,dM,(()=>2))],offset:[new tM(U.b.ANIMATIONTYPE_FLOAT,`${C}.uOffset`,UM,(()=>2)),new tM(U.b.ANIMATIONTYPE_FLOAT,`${C}.vOffset`,dM,(()=>2))],rotation:[new tM(U.b.ANIMATIONTYPE_FLOAT,`${C}.wAng`,OM,(()=>1))]}}Y(QM),u(QM,!0,(C=>new VM(C)));class LM extends J{buildAnimations(C,M,x,f,T){T(C._babylonCamera,this._buildAnimation(M,x,f))}}class tM extends J{buildAnimations(C,M,x,f,T){for(const z in C._data)T(C._data[z].babylonMaterial,this._buildAnimation(M,x,f))}}class AM extends J{buildAnimations(C,M,x,f,T){T(C._babylonLight,this._buildAnimation(M,x,f))}}const HM={__array__:{__target__:!0,...k}},jM={__array__:{__target__:!0,orthographic:{xmag:[new LM(U.b.ANIMATIONTYPE_FLOAT,"orthoLeft",OM,(()=>1)),new LM(U.b.ANIMATIONTYPE_FLOAT,"orthoRight",dM,(()=>1))],ymag:[new LM(U.b.ANIMATIONTYPE_FLOAT,"orthoBottom",OM,(()=>1)),new LM(U.b.ANIMATIONTYPE_FLOAT,"orthoTop",dM,(()=>1))],zfar:[new LM(U.b.ANIMATIONTYPE_FLOAT,"maxZ",UM,(()=>1))],znear:[new LM(U.b.ANIMATIONTYPE_FLOAT,"lj",UM,(()=>1))]},perspective:{yfov:[new LM(U.b.ANIMATIONTYPE_FLOAT,"fov",UM,(()=>1))],zfar:[new LM(U.b.ANIMATIONTYPE_FLOAT,"maxZ",UM,(()=>1))],znear:[new LM(U.b.ANIMATIONTYPE_FLOAT,"lj",UM,(()=>1))]}}},bM={nodes:HM,materials:{__array__:{__target__:!0,pbrMetallicRoughness:{baseColorFactor:[new tM(U.b.ANIMATIONTYPE_COLOR3,"albedoColor",yM,(()=>4)),new tM(U.b.ANIMATIONTYPE_FLOAT,"alpha",(function(C,M,x,f){return M[x+3]*f}),(()=>4))],metallicFactor:[new tM(U.b.ANIMATIONTYPE_FLOAT,"metallic",UM,(()=>1))],roughnessFactor:[new tM(U.b.ANIMATIONTYPE_FLOAT,"roughness",UM,(()=>1))],baseColorTexture:{extensions:{KHR_texture_transform:oM("albedoTexture")}},metallicRoughnessTexture:{extensions:{KHR_texture_transform:oM("metallicTexture")}}},emissiveFactor:[new tM(U.b.ANIMATIONTYPE_COLOR3,"emissiveColor",yM,(()=>3))],normalTexture:{scale:[new tM(U.b.ANIMATIONTYPE_FLOAT,"bumpTexture.level",UM,(()=>1))],extensions:{KHR_texture_transform:oM("bumpTexture")}},occlusionTexture:{strength:[new tM(U.b.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",UM,(()=>1))],extensions:{KHR_texture_transform:oM("ambientTexture")}},emissiveTexture:{extensions:{KHR_texture_transform:oM("emissiveTexture")}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:[new tM(U.b.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",UM,(()=>1))],anisotropyRotation:[new tM(U.b.ANIMATIONTYPE_FLOAT,"anisotropy.angle",UM,(()=>1))],anisotropyTexture:{extensions:{KHR_texture_transform:oM("anisotropy.texture")}}},KHR_materials_clearcoat:{clearcoatFactor:[new tM(U.b.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",UM,(()=>1))],clearcoatRoughnessFactor:[new tM(U.b.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",UM,(()=>1))],clearcoatTexture:{extensions:{KHR_texture_transform:oM("clearCoat.texture")}},clearcoatNormalTexture:{scale:[new tM(U.b.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",UM,(()=>1))],extensions:{KHR_texture_transform:oM("clearCoat.bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:oM("clearCoat.textureRoughness")}}},KHR_materials_dispersion:{dispersion:[new tM(U.b.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",UM,(()=>1))]},KHR_materials_emissive_strength:{emissiveStrength:[new tM(U.b.ANIMATIONTYPE_FLOAT,"emissiveIntensity",UM,(()=>1))]},KHR_materials_ior:{ior:[new tM(U.b.ANIMATIONTYPE_FLOAT,"indexOfRefraction",UM,(()=>1))]},KHR_materials_iridescence:{iridescenceFactor:[new tM(U.b.ANIMATIONTYPE_FLOAT,"iridescence.intensity",UM,(()=>1))],iridescenceIor:[new tM(U.b.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",UM,(()=>1))],iridescenceThicknessMinimum:[new tM(U.b.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",UM,(()=>1))],iridescenceThicknessMaximum:[new tM(U.b.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",UM,(()=>1))],iridescenceTexture:{extensions:{KHR_texture_transform:oM("iridescence.texture")}},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:oM("iridescence.thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:[new tM(U.b.ANIMATIONTYPE_COLOR3,"sheen.color",yM,(()=>3))],sheenRoughnessFactor:[new tM(U.b.ANIMATIONTYPE_FLOAT,"sheen.roughness",UM,(()=>1))],sheenColorTexture:{extensions:{KHR_texture_transform:oM("sheen.texture")}},sheenRoughnessTexture:{extensions:{KHR_texture_transform:oM("sheen.textureRoughness")}}},KHR_materials_specular:{specularFactor:[new tM(U.b.ANIMATIONTYPE_FLOAT,"metallicF0Factor",UM,(()=>1))],specularColorFactor:[new tM(U.b.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",yM,(()=>3))],specularTexture:{extensions:{KHR_texture_transform:oM("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:oM("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:[new tM(U.b.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",UM,(()=>1))],transmissionTexture:{extensions:{KHR_texture_transform:oM("subSurface.refractionIntensityTexture")}}},KHR_materials_volume:{attenuationColor:[new tM(U.b.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",yM,(()=>3))],attenuationDistance:[new tM(U.b.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",UM,(()=>1))],thicknessFactor:[new tM(U.b.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",UM,(()=>1))],thicknessTexture:{extensions:{KHR_texture_transform:oM("subSurface.thicknessTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:[new tM(U.b.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",UM,(()=>1))],diffuseTransmissionTexture:{extensions:{KHR_texture_transform:oM("subSurface.translucencyIntensityTexture")}},diffuseTransmissionColorFactor:[new tM(U.b.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",yM,(()=>3))],diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:oM("subSurface.translucencyColorTexture")}}}}}},cameras:jM,extensions:{KHR_lights_punctual:{lights:{__array__:{__target__:!0,color:[new AM(U.b.ANIMATIONTYPE_COLOR3,"diffuse",yM,(()=>3))],pj:[new AM(U.b.ANIMATIONTYPE_FLOAT,"intensity",UM,(()=>1))],range:[new AM(U.b.ANIMATIONTYPE_FLOAT,"range",UM,(()=>1))],spot:{innerConeAngle:[new AM(U.b.ANIMATIONTYPE_FLOAT,"innerAngle",DM,(()=>1))],outerConeAngle:[new AM(U.b.ANIMATIONTYPE_FLOAT,"angle",DM,(()=>1))]}}}}}};class RM{constructor(C,M){this._gltf=C,this._infoTree=M}convert(C){let M,x=this._gltf,f=this._infoTree;if(!C.startsWith("/"))throw new Error("Path must start with a /");const T=C.split("/");T.shift();for(const z of T){if(f.__array__)f=f.__array__;else if(f=f[z],!f)throw new Error(`Path ${C} is invalid`);if(void 0===x)throw new Error(`Path ${C} is invalid`);x=x[z],f.__target__&&(M=x)}return{object:M,info:f}}}const nM="KHR_animation_pointer";class IM extends RM{constructor(C){super(C,bM)}}class XM{constructor(C){this.name=nM,this._loader=C,this._pathToObjectConverter=new IM(this._loader.gj)}get enabled(){return this._loader.isExtensionUsed(nM)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(C,M,x,f,T){var z;const s=null===(z=f.target.extensions)||void 0===z?void 0:z.KHR_animation_pointer;if(!s||!this._pathToObjectConverter)return null;"pointer"!==f.target.path&&D.e.Warn(`${C}/target/path: Value (${f.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=f.target.node&&D.e.Warn(`${C}/target/node: Value (${f.target.node}) must not be present when using the ${this.name} extension`);const S=`${C}/extensions/${this.name}`,m=s.pointer;if(!m)throw new Error(`${S}: Pointer is missing`);try{const z=this._pathToObjectConverter.convert(m);return this._loader._loadAnimationChannelFromTargetInfoAsync(C,M,x,f,z,T)}catch(Q){return D.e.Warn(`${S}/pointer: Invalid pointer (${m}) skipped`),null}}}Y(nM),u(nM,!0,(C=>new XM(C)));class gM{constructor(C,M,x){this.frame=C,this.action=M,this.onlyOnce=x,this.isDone=!1}_clone(){return new gM(this.frame,this.action,this.onlyOnce)}}var BM=x(1067),FM=x(1086);class PM{get loop(){return this._loop}set loop(C){C!==this._loop&&(this._loop=C,this.updateOptions({loop:C}))}get currentTime(){var C;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(C=FM.e.audioEngine)&&void 0!==C&&C.audioContext&&(this.isPlaying||this.isPaused)){const C=this.isPaused?0:FM.e.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+C}return 0}get spatialSound(){return this._spatialSound}set spatialSound(C){if(C==this._spatialSound)return;const M=this.isPlaying;this.pause(),C?(this._spatialSound=C,this._updateSpatialParameters()):this._disableSpatialSound(),M&&this.play()}constructor(C,M,x){var f;let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,S=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new V.c,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=T.m.Zero(),this._localDirection=new T.m(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=C,x=x||d.c.LastCreatedScene)if(this._scene=x,PM._SceneComponentInitialization(x),this._readyToPlayCallback=z,this._customAttenuationFunction=(C,M,x,f,T)=>M<x?C*(1-M/x):0,S&&(this.autoplay=S.autoplay||!1,this._loop=S.loop||!1,void 0!==S.volume&&(this._volume=S.volume),this._spatialSound=S.spatialSound??!1,this.maxDistance=S.maxDistance??100,this.useCustomAttenuation=S.useCustomAttenuation??!1,this.rolloffFactor=S.rolloffFactor||1,this.refDistance=S.refDistance||1,this.distanceModel=S.distanceModel||"linear",this._playbackRate=S.playbackRate||1,this._streaming=S.streaming??!1,this._length=S.length,this._offset=S.offset),null!==(f=FM.e.audioEngine)&&void 0!==f&&f.canUseWebAudio&&FM.e.audioEngine.audioContext){this._soundGain=FM.e.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let C=!0;if(M)try{"string"===typeof M?(this._urlType="String",this._url=M):M instanceof ArrayBuffer?this._urlType="ArrayBuffer":M instanceof HTMLMediaElement?this._urlType="MediaElement":M instanceof MediaStream?this._urlType="MediaStream":M instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(M)&&(this._urlType="Array");let x=[],f=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=FM.e.audioEngine.audioContext.createMediaElementSource(M),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=FM.e.audioEngine.audioContext.createMediaStreamSource(M),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":M.byteLength>0&&(f=!0,this._soundLoaded(M));break;case"AudioBuffer":this._audioBufferLoaded(M);break;case"String":x.push(M);case"Array":0===x.length&&(x=M);for(let C=0;C<x.length;C++){const M=x[C];if(f=S&&S.skipCodecCheck||-1!==M.indexOf(".mp3",M.length-4)&&FM.e.audioEngine.isMP3supported||-1!==M.indexOf(".ogg",M.length-4)&&FM.e.audioEngine.isOGGsupported||-1!==M.indexOf(".wav",M.length-4)||-1!==M.indexOf(".m4a",M.length-4)||-1!==M.indexOf(".mp4",M.length-4)||-1!==M.indexOf("blob:"),f){this._streaming?(this._htmlAudioElement=new Audio(M),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,s.i.SetCorsBehavior(M,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(M,(C=>{this._soundLoaded(C)}),void 0,!0,!0,(C=>{C&&D.e.Error("XHR "+C.status+" error on: "+M+"."),D.e.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:C=!1}C?f||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):D.e.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(m){D.e.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),FM.e.audioEngine&&!FM.e.audioEngine.WarnedWebAudioUnsupported&&(D.e.Error("Web Audio is not supported by your browser."),FM.e.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var C;null!==(C=FM.e.audioEngine)&&void 0!==C&&C.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(C){var M;null!==(M=FM.e.audioEngine)&&void 0!==M&&M.audioContext&&(this._audioBuffer=C,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(C){var M;null!==(M=FM.e.audioEngine)&&void 0!==M&&M.audioContext&&FM.e.audioEngine.audioContext.decodeAudioData(C,(C=>{this._audioBufferLoaded(C)}),(C=>{D.e.Error("Error while decoding audio data for: "+this.name+" / Error: "+C)}))}setAudioBuffer(C){var M;null!==(M=FM.e.audioEngine)&&void 0!==M&&M.canUseWebAudio&&(this._audioBuffer=C,this._isReadyToPlay=!0)}updateOptions(C){C&&(this.loop=C.loop??this.loop,this.maxDistance=C.maxDistance??this.maxDistance,this.useCustomAttenuation=C.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=C.rolloffFactor??this.rolloffFactor,this.refDistance=C.refDistance??this.refDistance,this.distanceModel=C.distanceModel??this.distanceModel,this._playbackRate=C.playbackRate??this._playbackRate,this._length=C.length??void 0,this.spatialSound=C.spatialSound??this._spatialSound,this._setOffset(C.offset??void 0),this.setVolume(C.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var C;null!==(C=FM.e.audioEngine)&&void 0!==C&&C.canUseWebAudio&&FM.e.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??FM.e.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var C;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(C=this._soundPanner)||void 0===C||C.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var C;null!==(C=FM.e.audioEngine)&&void 0!==C&&C.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(C){var M;null!==(M=FM.e.audioEngine)&&void 0!==M&&M.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(C),this._isOutputConnected=!0)}setDirectionalCone(C,M,x){M<C?D.e.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=C,this._coneOuterAngle=M,this._coneOuterGain=x,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(C){if(C!=this._coneInnerAngle){var M;if(this._coneOuterAngle<C)return void D.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=C,null!==(M=FM.e.audioEngine)&&void 0!==M&&M.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(C){if(C!=this._coneOuterAngle){var M;if(C<this._coneInnerAngle)return void D.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=C,null!==(M=FM.e.audioEngine)&&void 0!==M&&M.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(C){var M;C.equals(this._position)||(this._position.p(C),null!==(M=FM.e.audioEngine)&&void 0!==M&&M.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(C){var M;this._localDirection=C,null!==(M=FM.e.audioEngine)&&void 0!==M&&M.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const C=this._connectedTransformNode.getWorldMatrix(),M=T.m.TransformNormal(this._localDirection,C);M.normalize(),this._soundPanner.orientationX.value=M.x,this._soundPanner.orientationY.value=M.y,this._soundPanner.orientationZ.value=M.z}updateDistanceFromListener(){var C;if(null!==(C=FM.e.audioEngine)&&void 0!==C&&C.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const C=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.rc(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,C,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(C){this._customAttenuationFunction=C}play(C,M,x){var f;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(f=FM.e.audioEngine)&&void 0!==f&&f.audioContext)try{var T,z;this._clearTimeoutsAndObservers();let f=C?(null===(T=FM.e.audioEngine)||void 0===T?void 0:T.audioContext.currentTime)+C:null===(z=FM.e.audioEngine)||void 0===z?void 0:z.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=FM.e.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const C=()=>{var x;if(null!==(x=FM.e.audioEngine)&&void 0!==x&&x.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=M??0;const x=this._htmlAudioElement.play();void 0!==x&&x.catch((()=>{var M,x;(null===(M=FM.e.audioEngine)||void 0===M||M.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(x=FM.e.audioEngine)||void 0===x?void 0:x.onAudioUnlockedObservable.addOnce((()=>{C()})))}))}else{var f;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(f=FM.e.audioEngine)||void 0===f?void 0:f.onAudioUnlockedObservable.addOnce((()=>{C()}))}};C()}}else{var s;const T=()=>{var T;if(null!==(T=FM.e.audioEngine)&&void 0!==T&&T.audioContext){var z;if(x=x||this._length,void 0!==M&&this._setOffset(M),this._soundSource){const C=this._soundSource;C.onended=()=>{C.disconnect()}}if(this._soundSource=null===(z=FM.e.audioEngine)||void 0===z?void 0:z.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var s;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==M&&(this._soundSource.loopStart=M),void 0!==x&&(this._soundSource.loopEnd=(0|M)+x),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},f=C?(null===(s=FM.e.audioEngine)||void 0===s?void 0:s.audioContext.currentTime)+C:FM.e.audioEngine.audioContext.currentTime;const T=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(f,T,this.loop?void 0:x)}}};"suspended"===(null===(s=FM.e.audioEngine)||void 0===s?void 0:s.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var C;"suspended"===(null===(C=FM.e.audioEngine)||void 0===C?void 0:C.audioContext.state)?(FM.e.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=FM.e.audioEngine.onAudioUnlockedObservable.addOnce((()=>{T()})))):T()}),500):T()}this._startTime=f,this.isPlaying=!0,this.isPaused=!1}catch(S){D.e.Error("Error while trying to play audio: "+this.name+", "+S.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(C){var M;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var x;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(x=this._streamingSource)||void 0===x||x.disconnect();this.isPlaying=!1}else if(null!==(M=FM.e.audioEngine)&&void 0!==M&&M.audioContext&&this._soundSource){const M=C?FM.e.audioEngine.audioContext.currentTime+C:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(M)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var C;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var M;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(M=this._streamingSource)||void 0===M||M.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(C=FM.e.audioEngine)&&void 0!==C&&C.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=FM.e.audioEngine.audioContext.currentTime-this._startTime)}setVolume(C,M){var x;null!==(x=FM.e.audioEngine)&&void 0!==x&&x.canUseWebAudio&&this._soundGain&&(M&&FM.e.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(FM.e.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,FM.e.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(C,FM.e.audioEngine.audioContext.currentTime+M)):this._soundGain.gain.value=C),this._volume=C}setPlaybackRate(C){this._playbackRate=C,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(C){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=C,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=C=>this._onRegisterAfterWorldMatrixUpdate(C),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(C){var M;if(C.getBoundingInfo){const M=C.getBoundingInfo();this.setPosition(M.boundingSphere.centerWorld)}else this.setPosition(C.absolutePosition);null!==(M=FM.e.audioEngine)&&void 0!==M&&M.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const C=()=>{this._isReadyToPlay?(x._audioBuffer=this.getAudioBuffer(),x._isReadyToPlay=!0,x.autoplay&&x.play(0,this._offset,this._length)):setTimeout(C,300)},M={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},x=new PM(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,M);return this.useCustomAttenuation&&x.setAttenuationFunction(this._customAttenuationFunction),x.setPosition(this._position),x.setPlaybackRate(this._playbackRate),C(),x}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const C={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(C.connectedMeshId=this._connectedTransformNode.id),C.position=this._position.Gd(),C.refDistance=this.refDistance,C.distanceModel=this.distanceModel,C.isDirectional=this._isDirectional,C.localDirectionToMesh=this._localDirection.Gd(),C.coneInnerAngle=this._coneInnerAngle,C.coneOuterAngle=this._coneOuterAngle,C.coneOuterGain=this._coneOuterGain),C}static Parse(C,M,x,f){const z=C.name;let s;s=C.url?x+C.url:x+z;const S={autoplay:C.autoplay,loop:C.loop,volume:C.volume,spatialSound:C.spatialSound,maxDistance:C.maxDistance,rolloffFactor:C.rolloffFactor,refDistance:C.refDistance,distanceModel:C.distanceModel,playbackRate:C.playbackRate};let m;if(f){const C=()=>{f._isReadyToPlay?(m._audioBuffer=f.getAudioBuffer(),m._isReadyToPlay=!0,m.autoplay&&m.play(0,m._offset,m._length)):setTimeout(C,300)};m=new PM(z,new ArrayBuffer(0),M,null,S),C()}else m=new PM(z,s,M,(()=>{M.removePendingData(m)}),S),M.addPendingData(m);if(C.position){const M=T.m.Dd(C.position);m.setPosition(M)}if(C.isDirectional&&(m.setDirectionalCone(C.coneInnerAngle||360,C.coneOuterAngle||360,C.coneOuterGain||0),C.localDirectionToMesh)){const M=T.m.Dd(C.localDirectionToMesh);m.setLocalDirectionToMesh(M)}if(C.connectedMeshId){const x=M.getMeshById(C.connectedMeshId);x&&m.attachToMesh(x)}return C.metadata&&(m.metadata=C.metadata),m}_setOffset(C){this._offset!==C&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=C)}_clearTimeoutsAndObservers(){var C;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(C=FM.e.audioEngine)||void 0===C||C.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}PM._SceneComponentInitialization=C=>{throw(0,BM.d)("AudioSceneComponent")},(0,R.f)("BABYLON.Sound",PM);class hM{constructor(C,M,x){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],M.length!==x.length)throw new Error("Sounds length does not equal weights length");this.loop=C,this._weights=x;let f=0;for(const z of x)f+=z;const T=f>0?1/f:0;for(let z=0;z<this._weights.length;z++)this._weights[z]*=T;this._sounds=M;for(const z of this._sounds)z.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(C){if(C!==this._coneInnerAngle){if(this._coneOuterAngle<C)return void D.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=C;for(const M of this._sounds)M.directionalConeInnerAngle=C}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(C){if(C!==this._coneOuterAngle){if(C<this._coneInnerAngle)return void D.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=C;for(const M of this._sounds)M.directionalConeOuterAngle=C}}get volume(){return this._volume}set volume(C){if(C!==this._volume)for(const M of this._sounds)M.setVolume(C)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(C){if(!this.isPaused){this.stop();const C=Math.random();let M=0;for(let x=0;x<this._weights.length;x++)if(M+=this._weights[x],C<=M){this._currentIndex=x;break}}const M=this._sounds[this._currentIndex??0];M.isReady()?M.play(0,this.isPaused?void 0:C):M.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class cM{constructor(C){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(C=C||d.c.LastCreatedScene)&&(this._scene=C,this.soundCollection=[],this._options=M,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var C;null!==(C=FM.e.audioEngine)&&void 0!==C&&C.canUseWebAudio&&FM.e.audioEngine.audioContext&&(this._outputAudioNode=FM.e.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(FM.e.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(FM.e.audioEngine&&FM.e.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(C){var M;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(M=FM.e.audioEngine)&&void 0!==M&&M.canUseWebAudio&&this._outputAudioNode&&C.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==C.soundTrackId&&(-1===C.soundTrackId?this._scene.mainSoundTrack.removeSound(C):this._scene.soundTracks&&this._scene.soundTracks[C.soundTrackId].removeSound(C)),this.soundCollection.push(C),C.soundTrackId=this.id}removeSound(C){const M=this.soundCollection.indexOf(C);-1!==M&&this.soundCollection.splice(M,1)}setVolume(C){var M;null!==(M=FM.e.audioEngine)&&void 0!==M&&M.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=C)}switchPanningModelToHRTF(){var C;if(null!==(C=FM.e.audioEngine)&&void 0!==C&&C.canUseWebAudio)for(let M=0;M<this.soundCollection.length;M++)this.soundCollection[M].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var C;if(null!==(C=FM.e.audioEngine)&&void 0!==C&&C.canUseWebAudio)for(let M=0;M<this.soundCollection.length;M++)this.soundCollection[M].switchPanningModelToEqualPower()}connectToAnalyser(C){var M;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=C,null!==(M=FM.e.audioEngine)&&void 0!==M&&M.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,FM.e.audioEngine.masterGain))}}var qM=x(1239),iM=x(1190),ZM=(x(1500),x(1118));(0,x(11879).e)(qM.d.NAME_AUDIO,((C,M,x,f)=>{let T,z=[];if(x.ue=x.ue||[],void 0!==C.ue&&null!==C.ue)for(let S=0,m=C.ue.length;S<m;S++){var s;const m=C.ue[S];null!==(s=FM.e.audioEngine)&&void 0!==s&&s.canUseWebAudio?(m.url||(m.url=m.name),z[m.url]?x.ue.push(PM.Parse(m,M,f,z[m.url])):(T=PM.Parse(m,M,f),z[m.url]=T,x.ue.push(T))):x.ue.push(new PM(m.name,null,M))}z=[]})),Object.defineProperty(iM.e.prototype,"mainSoundTrack",{get:function(){let C=this._getComponent(qM.d.NAME_AUDIO);return C||(C=new EM(this),this.re(C)),this._mainSoundTrack||(this._mainSoundTrack=new cM(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),iM.e.prototype.getSoundByName=function(C){let M;for(M=0;M<this.mainSoundTrack.soundCollection.length;M++)if(this.mainSoundTrack.soundCollection[M].name===C)return this.mainSoundTrack.soundCollection[M];if(this.soundTracks)for(let x=0;x<this.soundTracks.length;x++)for(M=0;M<this.soundTracks[x].soundCollection.length;M++)if(this.soundTracks[x].soundCollection[M].name===C)return this.soundTracks[x].soundCollection[M];return null},Object.defineProperty(iM.e.prototype,"audioEnabled",{get:function(){let C=this._getComponent(qM.d.NAME_AUDIO);return C||(C=new EM(this),this.re(C)),C.audioEnabled},set:function(C){let M=this._getComponent(qM.d.NAME_AUDIO);M||(M=new EM(this),this.re(M)),C?M.enableAudio():M.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(iM.e.prototype,"headphone",{get:function(){let C=this._getComponent(qM.d.NAME_AUDIO);return C||(C=new EM(this),this.re(C)),C.headphone},set:function(C){let M=this._getComponent(qM.d.NAME_AUDIO);M||(M=new EM(this),this.re(M)),C?M.switchAudioModeForHeadphones():M.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(iM.e.prototype,"audioListenerPositionProvider",{get:function(){let C=this._getComponent(qM.d.NAME_AUDIO);return C||(C=new EM(this),this.re(C)),C.audioListenerPositionProvider},set:function(C){let M=this._getComponent(qM.d.NAME_AUDIO);if(M||(M=new EM(this),this.re(M)),C&&"function"!==typeof C)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");M.audioListenerPositionProvider=C},enumerable:!0,configurable:!0}),Object.defineProperty(iM.e.prototype,"audioListenerRotationProvider",{get:function(){let C=this._getComponent(qM.d.NAME_AUDIO);return C||(C=new EM(this),this.re(C)),C.audioListenerRotationProvider},set:function(C){let M=this._getComponent(qM.d.NAME_AUDIO);if(M||(M=new EM(this),this.re(M)),C&&"function"!==typeof C)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");M.audioListenerRotationProvider=C},enumerable:!0,configurable:!0}),Object.defineProperty(iM.e.prototype,"audioPositioningRefreshRate",{get:function(){let C=this._getComponent(qM.d.NAME_AUDIO);return C||(C=new EM(this),this.re(C)),C.audioPositioningRefreshRate},set:function(C){let M=this._getComponent(qM.d.NAME_AUDIO);M||(M=new EM(this),this.re(M)),M.audioPositioningRefreshRate=C},enumerable:!0,configurable:!0});class EM{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(C){this.name=qM.d.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new T.m,this._cachedCameraPosition=new T.m,this._lastCheck=0,this._invertMatrixTemp=new T.d,this._cameraDirectionTemp=new T.m,(C=C||d.c.LastCreatedScene)&&(this.xe=C,C.soundTracks=[],C.ue=[])}register(){this.xe._afterRenderStage.registerStep(qM.d.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(C){if(C.ue=[],this.xe.soundTracks)for(let M=0;M<this.xe.soundTracks.length;M++){const x=this.xe.soundTracks[M];for(let M=0;M<x.soundCollection.length;M++)C.ue.push(x.soundCollection[M].serialize())}}addFromContainer(C){C.ue&&C.ue.forEach((C=>{C.play(),C.autoplay=!0,this.xe.mainSoundTrack.addSound(C)}))}removeFromContainer(C){let M=arguments.length>1&&void 0!==arguments[1]&&arguments[1];C.ue&&C.ue.forEach((C=>{C.stop(),C.autoplay=!1,this.xe.mainSoundTrack.removeSound(C),M&&C.dispose()}))}dispose(){const C=this.xe;if(C._mainSoundTrack&&C.mainSoundTrack.dispose(),C.soundTracks)for(let M=0;M<C.soundTracks.length;M++)C.soundTracks[M].dispose()}disableAudio(){const C=this.xe;let M;for(this._audioEnabled=!1,FM.e.audioEngine&&FM.e.audioEngine.audioContext&&FM.e.audioEngine.audioContext.suspend(),M=0;M<C.mainSoundTrack.soundCollection.length;M++)C.mainSoundTrack.soundCollection[M].pause();if(C.soundTracks)for(M=0;M<C.soundTracks.length;M++)for(let x=0;x<C.soundTracks[M].soundCollection.length;x++)C.soundTracks[M].soundCollection[x].pause()}enableAudio(){const C=this.xe;let M;for(this._audioEnabled=!0,FM.e.audioEngine&&FM.e.audioEngine.audioContext&&FM.e.audioEngine.audioContext.resume(),M=0;M<C.mainSoundTrack.soundCollection.length;M++)C.mainSoundTrack.soundCollection[M].isPaused&&C.mainSoundTrack.soundCollection[M].play();if(C.soundTracks)for(M=0;M<C.soundTracks.length;M++)for(let x=0;x<C.soundTracks[M].soundCollection.length;x++)C.soundTracks[M].soundCollection[x].isPaused&&C.soundTracks[M].soundCollection[x].play()}switchAudioModeForHeadphones(){const C=this.xe;if(this._headphone=!0,C.mainSoundTrack.switchPanningModelToHRTF(),C.soundTracks)for(let M=0;M<C.soundTracks.length;M++)C.soundTracks[M].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const C=this.xe;if(this._headphone=!1,C.mainSoundTrack.switchPanningModelToEqualPower(),C.soundTracks)for(let M=0;M<C.soundTracks.length;M++)C.soundTracks[M].switchPanningModelToEqualPower()}_afterRender(){const C=ZM.e.Now;if(this._lastCheck&&C-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=C;const M=this.xe;if(!this._audioEnabled||!M._mainSoundTrack||!M.soundTracks||0===M._mainSoundTrack.soundCollection.length&&1===M.soundTracks.length)return;const x=FM.e.audioEngine;if(x&&x.audioContext){let C,f=M.activeCamera;if(M.activeCameras&&M.activeCameras.length>0&&(f=M.activeCameras[0]),this.audioListenerPositionProvider){const C=this.audioListenerPositionProvider();x.audioContext.listener.setPosition(C.x||0,C.y||0,C.z||0)}else f?this._cachedCameraPosition.equals(f.globalPosition)||(this._cachedCameraPosition.p(f.globalPosition),x.audioContext.listener.setPosition(f.globalPosition.x,f.globalPosition.y,f.globalPosition.z)):x.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const C=this.audioListenerRotationProvider();x.audioContext.listener.setOrientation(C.x||0,C.y||0,C.z||0,0,1,0)}else f?(f.rigCameras&&f.rigCameras.length>0&&(f=f.rigCameras[0]),f.getViewMatrix().invertToRef(this._invertMatrixTemp),T.m.TransformNormalToRef(EM._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.p(this._cameraDirectionTemp),x.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):x.audioContext.listener.setOrientation(0,0,0,0,1,0);for(C=0;C<M.mainSoundTrack.soundCollection.length;C++){const x=M.mainSoundTrack.soundCollection[C];x.useCustomAttenuation&&x.updateDistanceFromListener()}if(M.soundTracks)for(C=0;C<M.soundTracks.length;C++)for(let x=0;x<M.soundTracks[C].soundCollection.length;x++){const f=M.soundTracks[C].soundCollection[x];f.useCustomAttenuation&&f.updateDistanceFromListener()}}}}EM._CameraDirection=new T.m(0,0,-1),PM._SceneComponentInitialization=C=>{let M=C._getComponent(qM.d.NAME_AUDIO);M||(M=new EM(C),C.re(M))};const KM="MSFT_audio_emitter";class GM{constructor(C){this.name=KM,this._loader=C,this.enabled=this._loader.isExtensionUsed(KM)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const C=this._loader.gj.extensions;if(C&&C[this.name]){const M=C[this.name];this._clips=M.clips,this._emitters=M.emitters,e.Assign(this._clips),e.Assign(this._emitters)}}loadSceneAsync(C,M){return r.LoadExtensionAsync(C,M,this.name,((x,f)=>{const T=new Array;T.push(this._loader.loadSceneAsync(C,M));for(const C of f.emitters){const M=e.Get(`${x}/emitters`,this._emitters,C);if(void 0!=M.refDistance||void 0!=M.maxDistance||void 0!=M.rolloffFactor||void 0!=M.distanceModel||void 0!=M.innerAngle||void 0!=M.outerAngle)throw new Error(`${x}: Direction or Distance properties are not allowed on emitters attached to a scene`);T.push(this._loadEmitterAsync(`${x}/emitters/${M.index}`,M))}return Promise.all(T).then((()=>{}))}))}loadNodeAsync(C,M,x){return r.LoadExtensionAsync(C,M,this.name,((C,f)=>{const z=new Array;return this._loader.loadNodeAsync(C,M,(M=>{for(const x of f.emitters){const f=e.Get(`${C}/emitters`,this._emitters,x);z.push(this._loadEmitterAsync(`${C}/emitters/${f.index}`,f).then((()=>{for(const C of f._babylonSounds)C.attachToMesh(M),void 0==f.innerAngle&&void 0==f.outerAngle||(C.setLocalDirectionToMesh(T.m.Forward()),C.setDirectionalCone(2*s.i.ToDegrees(void 0==f.innerAngle?Math.PI:f.innerAngle),2*s.i.ToDegrees(void 0==f.outerAngle?Math.PI:f.outerAngle),0))})))}x(M)})).then((C=>Promise.all(z).then((()=>C))))}))}loadAnimationAsync(C,M){return r.LoadExtensionAsync(C,M,this.name,((x,f)=>this._loader.loadAnimationAsync(C,M).then((T=>{const z=new Array;e.Assign(f.events);for(const s of f.events)z.push(this._loadAnimationEventAsync(`${x}/events/${s.index}`,C,M,s,T));return Promise.all(z).then((()=>T))}))))}_loadClipAsync(C,M){if(M._objectURL)return M._objectURL;let x;if(M.uri)x=this._loader.loadUriAsync(C,M,M.uri);else{const f=e.Get(`${C}/bufferView`,this._loader.gj.bufferViews,M.bufferView);x=this._loader.loadBufferViewAsync(`/bufferViews/${f.index}`,f)}return M._objectURL=x.then((C=>URL.createObjectURL(new Blob([C],{type:M.mimeType})))),M._objectURL}_loadEmitterAsync(C,M){if(M._babylonSounds=M._babylonSounds||[],!M._babylonData){const C=new Array,x=M.name||`emitter${M.index}`,f={loop:!1,autoplay:!1,volume:void 0==M.volume?1:M.volume};for(let z=0;z<M.clips.length;z++){const T=`/extensions/${this.name}/clips`,s=e.Get(T,this._clips,M.clips[z].clip);C.push(this._loadClipAsync(`${T}/${M.clips[z].clip}`,s).then((C=>{const T=M._babylonSounds[z]=new PM(x,C,this._loader.babylonScene,null,f);T.refDistance=M.refDistance||1,T.maxDistance=M.maxDistance||256,T.rolloffFactor=M.rolloffFactor||1,T.distanceModel=M.distanceModel||"exponential"})))}const T=Promise.all(C).then((()=>{const C=M.clips.map((C=>C.weight||1)),x=new hM(M.loop||!1,M._babylonSounds,C);M.innerAngle&&(x.directionalConeInnerAngle=2*s.i.ToDegrees(M.innerAngle)),M.outerAngle&&(x.directionalConeOuterAngle=2*s.i.ToDegrees(M.outerAngle)),M.volume&&(x.volume=M.volume),M._babylonData.sound=x}));M._babylonData={loaded:T}}return M._babylonData.loaded}_getEventAction(C,M,x,f,T){switch(x){case"play":return C=>{const x=(T||0)+(C-f);M.play(x)};case"stop":return()=>{M.stop()};case"pause":return()=>{M.pause()};default:throw new Error(`${C}: Unsupported action ${x}`)}}_loadAnimationEventAsync(C,M,x,f,T){if(0==T.targetedAnimations.length)return Promise.resolve();const z=T.targetedAnimations[0],s=f.k,S=e.Get(`/extensions/${this.name}/emitters`,this._emitters,s);return this._loadEmitterAsync(C,S).then((()=>{const M=S._babylonData.sound;if(M){const x=new gM(f.time,this._getEventAction(C,M,f.action,f.time,f.startOffset));z.animation.addEvent(x),T.onAnimationGroupEndObservable.add((()=>{M.stop()})),T.onAnimationGroupPauseObservable.add((()=>{M.pause()}))}}))}}Y(KM),u(KM,!0,(C=>new GM(C)));const aM="MSFT_lod";class JM{constructor(C){var M;this.name=aM,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new V.c,this.onMaterialLODsLoadedObservable=new V.c,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=C,this.maxLODsToLoad=(null===(M=this._loader.parent.extensionOptions[aM])||void 0===M?void 0:M.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(aM)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let C=0;C<this._nodePromiseLODs.length;C++){const M=Promise.all(this._nodePromiseLODs[C]).then((()=>{0!==C&&(this._loader.endPerformanceCounter(`Node LOD ${C}`),this._loader.log(`Loaded node LOD ${C}`)),this.onNodeLODsLoadedObservable.notifyObservers(C),C!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${C+1}`),this._loadBufferLOD(this._nodeBufferLODs,C+1),this._nodeSignalLODs[C]&&this._nodeSignalLODs[C].resolve())}));this._loader._completePromises.push(M)}for(let C=0;C<this._materialPromiseLODs.length;C++){const M=Promise.all(this._materialPromiseLODs[C]).then((()=>{0!==C&&(this._loader.endPerformanceCounter(`Material LOD ${C}`),this._loader.log(`Loaded material LOD ${C}`)),this.onMaterialLODsLoadedObservable.notifyObservers(C),C!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${C+1}`),this._loadBufferLOD(this._materialBufferLODs,C+1),this._materialSignalLODs[C]&&this._materialSignalLODs[C].resolve())}));this._loader._completePromises.push(M)}}loadSceneAsync(C,M){const x=this._loader.loadSceneAsync(C,M);return this._loadBufferLOD(this._bufferLODs,0),x}loadNodeAsync(C,M,x){return r.LoadExtensionAsync(C,M,this.name,((C,T)=>{let z;const s=this._getLODs(C,M,this._loader.gj.nodes,T.ids);this._loader.logOpen(`${C}`);for(let M=0;M<s.length;M++){const C=s[M];0!==M&&(this._nodeIndexLOD=M,this._nodeSignalLODs[M]=this._nodeSignalLODs[M]||new f);const T=C=>{x(C),C.Og(!1)},S=this._loader.loadNodeAsync(`/nodes/${C.index}`,C,T).then((C=>{if(0!==M){const C=s[M-1];C._babylonTransformNode&&(this._disposeTransformNode(C._babylonTransformNode),delete C._babylonTransformNode)}return C.Og(!0),C}));this._nodePromiseLODs[M]=this._nodePromiseLODs[M]||[],0===M?z=S:(this._nodeIndexLOD=null,this._nodePromiseLODs[M].push(S))}return this._loader.logClose(),z}))}_loadMaterialAsync(C,M,x,f,T){return this._nodeIndexLOD?null:r.LoadExtensionAsync(C,M,this.name,((C,z)=>{let s;const S=this._getLODs(C,M,this._loader.gj.materials,z.ids);this._loader.logOpen(`${C}`);for(let M=0;M<S.length;M++){const C=S[M];0!==M&&(this._materialIndexLOD=M);const z=this._loader._loadMaterialAsync(`/materials/${C.index}`,C,x,f,(C=>{0===M&&T(C)})).then((C=>{if(0!==M){T(C);const x=S[M-1]._data;x[f]&&(this._disposeMaterials([x[f].babylonMaterial]),delete x[f])}return C}));this._materialPromiseLODs[M]=this._materialPromiseLODs[M]||[],0===M?s=z:(this._materialIndexLOD=null,this._materialPromiseLODs[M].push(z))}return this._loader.logClose(),s}))}_loadUriAsync(C,M,x){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const T=this._nodeIndexLOD-1;return this._nodeSignalLODs[T]=this._nodeSignalLODs[T]||new f,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((()=>this._loader.loadUriAsync(C,M,x)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const T=this._materialIndexLOD-1;return this._materialSignalLODs[T]=this._materialSignalLODs[T]||new f,this._materialSignalLODs[T].promise.then((()=>this._loader.loadUriAsync(C,M,x)))}return null}loadBufferAsync(C,M,x,T){if(this._loader.parent.useRangeRequests&&!M.uri){if(!this._loader.bin)throw new Error(`${C}: Uri is missing or the binary glTF is missing its binary chunk`);const M=(C,M)=>{const z=x,s=z+T-1;let S=C[M];return S?(S.start=Math.min(S.start,z),S.end=Math.max(S.end,s)):(S={start:z,end:s,loaded:new f},C[M]=S),S.loaded.promise.then((C=>new Uint8Array(C.buffer,C.byteOffset+x-S.start,T)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?M(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?M(this._materialBufferLODs,this._materialIndexLOD):M(this._bufferLODs,0)}return null}_loadBufferLOD(C,M){const x=C[M];x&&(this._loader.log(`Loading buffer range [${x.start}-${x.end}]`),this._loader.bin.readAsync(x.start,x.end-x.start+1).then((C=>{x.loaded.resolve(C)}),(C=>{x.loaded.reject(C)})))}_getLODs(C,M,x,f){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const T=[];for(let z=f.length-1;z>=0;z--)if(T.push(e.Get(`${C}/ids/${f[z]}`,x,f[z])),T.length===this.maxLODsToLoad)return T;return T.push(M),T}_disposeTransformNode(C){const M=[],x=C.material;x&&M.push(x);for(const T of C.getChildMeshes())T.material&&M.push(T.material);C.dispose();const f=M.filter((C=>this._loader.babylonScene.meshes.every((M=>M.material!=C))));this._disposeMaterials(f)}_disposeMaterials(C){const M={};for(const x of C){for(const C of x.getActiveTextures())M[C.uniqueId]=C;x.dispose()}for(const x in M)for(const C of this._loader.babylonScene.materials)C.hasTexture(M[x])&&delete M[x];for(const x in M)M[x].dispose()}}Y(aM),u(aM,!0,(C=>new JM(C)));const NM="MSFT_minecraftMesh";class kM{constructor(C){this.name=NM,this._loader=C,this.enabled=this._loader.isExtensionUsed(NM)}dispose(){this._loader=null}loadMaterialPropertiesAsync(C,M,x){return r.LoadExtraAsync(C,M,this.name,((f,T)=>{if(T){if(!(x instanceof I))throw new Error(`${f}: Material type not supported`);const T=this._loader.loadMaterialPropertiesAsync(C,M,x);return x.needAlphaBlending()&&(x.forceDepthWrite=!0,x.separateCullingPass=!0),x.Me=x.forceDepthWrite,x.twoSidedLighting=!0,T}return null}))}}Y(NM),u(NM,!0,(C=>new kM(C)));const vM="MSFT_sRGBFactors";class pM{constructor(C){this.name=vM,this._loader=C,this.enabled=this._loader.isExtensionUsed(vM)}dispose(){this._loader=null}loadMaterialPropertiesAsync(C,M,x){return r.LoadExtraAsync(C,M,this.name,((f,T)=>{if(T){if(!(x instanceof I))throw new Error(`${f}: Material type not supported`);const T=this._loader.loadMaterialPropertiesAsync(C,M,x),z=x.va().getEngine().useExactSrgbConversions;return x.albedoTexture||x.albedoColor.toLinearSpaceToRef(x.albedoColor,z),x.reflectivityTexture||x.reflectivityColor.toLinearSpaceToRef(x.reflectivityColor,z),T}return null}))}}Y(vM),u(vM,!0,(C=>new pM(C)));var uM,YM=x(1028);!function(C){C[C.Input=0]="Input",C[C.Output=1]="Output"}(uM||(uM={}));class WM{constructor(C,M,x){this._ownerBlock=x,this._connectedPoint=[],this.uniqueId=(0,YM.c)(),this.connectedPointIds=[],this.name=C,this._connectionType=M}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(C){if(this._connectionType===C._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||C._isSingularConnection()&&C._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(C),C._connectedPoint.push(this)}serialize(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};C.uniqueId=this.uniqueId,C.name=this.name,C._connectionType=this._connectionType,C.connectedPointIds=[],C.className=this.getClassName();for(const M of this._connectedPoint)C.connectedPointIds.push(M.uniqueId)}getClassName(){return"FGConnection"}deserialize(C){this.uniqueId=C.uniqueId,this.name=C.name,this._connectionType=C._connectionType,this.connectedPointIds=C.connectedPointIds}static Parse(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},M=arguments.length>1?arguments[1]:void 0;const x=new(s.i.Instantiate(C.className))(C.name,C._connectionType,M);return x.deserialize(C),x}}class eM{constructor(C){this.value=this._toInt(C)}_toInt(C){return 0|C}add(C){return new eM(this.value+C.value)}rc(C){return new eM(this.value-C.value)}multiply(C){return new eM(Math.imul(this.value,C.value))}divide(C){return new eM(this.value/C.value)}getClassName(){return eM.ClassName}equals(C){return this.value===C.value}static Parse(C){return new eM(C.value)}}eM.ClassName="FlowGraphInteger",(0,R.f)("FlowGraphInteger",eM);class rM{constructor(C,M){this.typeName=C,this.defaultValue=M}serialize(C){C.typeName=this.typeName,C.defaultValue=this.defaultValue}static Parse(C){return new rM(C.typeName,C.defaultValue)}}const wM=new rM("any",void 0),lM=(new rM("string",""),new rM("number",0)),Cx=new rM("boolean",!1),Mx=new rM("Vector2",T.j.Zero()),xx=new rM("Md",T.m.Zero()),fx=(new rM("Vector4",T.q.Zero()),new rM("Matrix",T.d.Identity())),Tx=(new rM("_d",z.d.Black()),new rM("ae",new z.e(0,0,0,0)),new rM("Quaternion",T.h.Identity()),new rM("FlowGraphInteger",new eM(0)));class zx extends WM{constructor(C,M,x,f){super(C,M,x),this.richType=f}_isSingularConnection(){return 0===this.connectionType}setValue(C,M){M._setConnectionValue(this,C)}connectTo(C){super.connectTo(C)}_getValueOrDefault(C){return C._hasConnectionValue(this)?C._getConnectionValue(this):this.richType.defaultValue}getValue(C){return 1===this.connectionType?(C._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(C),this._getValueOrDefault(C)):this.isConnected()?this._connectedPoint[0].getValue(C):this._getValueOrDefault(C)}getClassName(){return"FGDataConnection"}serialize(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(C),C.richType={},this.richType.serialize(C.richType)}static Parse(C,M){const x=WM.Parse(C,M);return x.richType=rM.Parse(C.richType),x}}function sx(C){return"Mesh"===C||"AbstractMesh"===C||"GroundMesh"===C||"InstanceMesh"===C||"LinesMesh"===C||"GoldbergMesh"===C||"GreasedLineMesh"===C||"TrailMesh"===C}function Sx(C){return"Vector2"===C||"Md"===C||"Vector4"===C||"Quaternion"===C||"_d"===C||"ae"===C}function mx(C,M,x){var f;const T=(null===M||void 0===M||null===(f=M.getClassName)||void 0===f?void 0:f.call(M))??"";sx(T)?x[C]={name:M.name,className:T}:Sx(T)?x[C]={value:M.Gd(),className:T}:x[C]=M}function Qx(C,M,x){const f=M[C];let s;const S=null===f||void 0===f?void 0:f.className;return s=sx(S)?x.getMeshByName(f.name):Sx(S)?function(C,M){if("Vector2"===C)return T.j.Dd(M);if("Md"===C)return T.m.Dd(M);if("Vector4"===C)return T.q.Dd(M);if("Quaternion"===C)return T.h.Dd(M);if("_d"===C)return new z.d(M[0],M[1],M[2]);if("ae"===C)return new z.e(M[0],M[1],M[2],M[3]);throw new Error(`Unknown vector class name ${C}`)}(S,f.value):"Matrix"===S?T.d.Dd(f.value):S===eM.ClassName?eM.Parse(f):f&&void 0!==f.value?f.value:f,s}(0,R.f)("FGDataConnection",zx);class Vx{constructor(C){var M;this.config=C,this.uniqueId=(0,YM.c)(),this.name=(null===(M=this.config)||void 0===M?void 0:M.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(C){}registerDataInput(C,M){const x=new zx(C,0,this,M);return this.dataInputs.push(x),x}registerDataOutput(C,M){const x=new zx(C,1,this,M);return this.dataOutputs.push(x),x}getDataInput(C){return this.dataInputs.find((M=>M.name===C))}getDataOutput(C){return this.dataOutputs.find((M=>M.name===C))}serialize(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};C.uniqueId=this.uniqueId,C.config={},this.config&&(C.config.name=this.config.name),C.dataInputs=[],C.dataOutputs=[],C.className=this.getClassName();for(const M of this.dataInputs){const x={};M.serialize(x),C.dataInputs.push(x)}for(const M of this.dataOutputs){const x={};M.serialize(x),C.dataOutputs.push(x)}}getClassName(){return"FGBlock"}static Parse(C,M){const x=s.i.Instantiate(C.className),f={},T=M.valueParseFunction??Qx;if(C.config)for(const s in C.config)f[s]=T(s,C.config,M.xe);var z;("FGSetPropertyBlock"===(z=C.className)||"FGGetPropertyBlock"===z||"FGPlayAnimationBlock"===z||"FGMeshPickEventBlock"===z)&&(f.pathConverter=M.pathConverter);const S=new x(f);S.uniqueId=C.uniqueId;for(let s=0;s<C.dataInputs.length;s++){const M=S.getDataInput(C.dataInputs[s].name);if(!M)throw new Error("Could not find data input with name "+C.dataInputs[s].name+" in block "+C.className);M.deserialize(C.dataInputs[s])}for(let s=0;s<C.dataOutputs.length;s++){const M=S.getDataOutput(C.dataOutputs[s].name);if(!M)throw new Error("Could not find data output with name "+C.dataOutputs[s].name+" in block "+C.className);M.deserialize(C.dataOutputs[s])}return S.metadata=C.metadata,S.deserialize&&S.deserialize(C),S}}class yx extends WM{_isSingularConnection(){return 1===this.connectionType}_activateSignal(C){var M;0===this.connectionType?(C._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(C,this),C._increaseExecutionId()):null===(M=this._connectedPoint[0])||void 0===M||M._activateSignal(C)}}(0,R.f)("FlowGraphSignalConnection",yx);class Ux extends Vx{constructor(C){super(C),this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in")}_registerSignalInput(C){const M=new yx(C,0,this);return this.signalInputs.push(M),M}_registerSignalOutput(C){const M=new yx(C,1,this);return this.signalOutputs.push(M),M}getSignalInput(C){return this.signalInputs.find((M=>M.name===C))}getSignalOutput(C){return this.signalOutputs.find((M=>M.name===C))}serialize(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(C),C.signalInputs=[],C.signalOutputs=[];for(const M of this.signalInputs){const x={};M.serialize(x),C.signalInputs.push(x)}for(const M of this.signalOutputs){const x={};M.serialize(x),C.signalOutputs.push(x)}}deserialize(C){for(let M=0;M<C.signalInputs.length;M++){const x=this.getSignalInput(C.signalInputs[M].name);if(!x)throw new Error("Could not find signal input with name "+C.signalInputs[M].name+" in block "+C.className);x.deserialize(C.signalInputs[M])}for(let M=0;M<C.signalOutputs.length;M++){const x=this.getSignalOutput(C.signalOutputs[M].name);if(!x)throw new Error("Could not find signal output with name "+C.signalOutputs[M].name+" in block "+C.className);x.deserialize(C.signalOutputs[M])}}getClassName(){return"FGExecutionBlock"}}class Ox extends Ux{constructor(C){super(C),this.out=this._registerSignalOutput("out"),this.done=this._registerSignalOutput("done")}_startPendingTasks(C){this._preparePendingTasks(C),C._addPendingBlock(this)}}class dx extends Ox{_execute(C){C._notifyExecuteNode(this),this.out._activateSignal(C)}}class Dx{constructor(C){this.uniqueId=(0,YM.c)(),this._userVariables={},this._executionVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new V.c,this._configuration=C}hasVariable(C){return C in this._userVariables}setVariable(C,M){this._userVariables[C]=M}getVariable(C){return this._userVariables[C]}get userVariables(){return this._userVariables}_getUniqueIdPrefixedName(C,M){return`${C.uniqueId}_${M}`}_setExecutionVariable(C,M,x){this._executionVariables[this._getUniqueIdPrefixedName(C,M)]=x}_getExecutionVariable(C,M,x){return this._hasExecutionVariable(C,M)?this._executionVariables[this._getUniqueIdPrefixedName(C,M)]:x}_deleteExecutionVariable(C,M){delete this._executionVariables[this._getUniqueIdPrefixedName(C,M)]}_hasExecutionVariable(C,M){return this._getUniqueIdPrefixedName(C,M)in this._executionVariables}_hasConnectionValue(C){return C.uniqueId in this._connectionValues}_setConnectionValue(C,M){this._connectionValues[C.uniqueId]=M}_getConnectionValue(C){return this._connectionValues[C.uniqueId]}get configuration(){return this._configuration}_addPendingBlock(C){this._pendingBlocks.push(C)}_removePendingBlock(C){const M=this._pendingBlocks.indexOf(C);-1!==M&&this._pendingBlocks.splice(M,1)}_clearPendingBlocks(){for(const C of this._pendingBlocks)C._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(C){this.onNodeExecutedObservable.notifyObservers(C)}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:mx;C.uniqueId=this.uniqueId,C._userVariables={};for(const x in this._userVariables)M(x,this._userVariables[x],C._userVariables);C._connectionValues={};for(const x in this._connectionValues)M(x,this._connectionValues[x],C._connectionValues)}getClassName(){return"FGContext"}static Parse(C,M){const x=M.graph.createContext(),f=M.valueParseFunction??Qx;x.uniqueId=C.uniqueId;for(const T in C._userVariables){const M=f(T,C._userVariables,x._configuration.xe);x._userVariables[T]=M}for(const T in C._connectionValues){const M=f(T,C._connectionValues,x._configuration.xe);x._connectionValues[T]=M}return x}}(0,A.e)([(0,H.J)()],Dx.prototype,"uniqueId",void 0);var ox,Lx,tx=x(1243);function Ax(C,M){return!(!C.parent||C.parent!==M&&!Ax(C.parent,M))}class Hx extends dx{constructor(C){super(C),this.config=C}_getReferencedMesh(){const C=this.config.pathConverter.convert(this.config.path),M=C.info.getObject(C.object);if(!M||!(M instanceof P.b))throw new Error("Mesh pick event block requires a valid mesh");return M}_preparePendingTasks(C){let M=C._getExecutionVariable(this,"meshPickObserver");if(!M){const x=this._getReferencedMesh();C._setExecutionVariable(this,"mesh",x),M=x.va().onPointerObservable.add((M=>{var f,T,z;M.type===tx.c.POINTERPICK&&null!==(f=M.pickInfo)&&void 0!==f&&f.pickedMesh&&((null===(T=M.pickInfo)||void 0===T?void 0:T.pickedMesh)===x||Ax(null===(z=M.pickInfo)||void 0===z?void 0:z.pickedMesh,x))&&this._execute(C)}));const f=x.Sd.add((()=>this._onDispose));C._setExecutionVariable(this,"meshPickObserver",M),C._setExecutionVariable(this,"meshDisposeObserver",f)}}_onDispose(C){this._cancelPendingTasks(C),C._removePendingBlock(this)}_cancelPendingTasks(C){const M=C._getExecutionVariable(this,"mesh"),x=C._getExecutionVariable(this,"meshPickObserver"),f=C._getExecutionVariable(this,"meshDisposeObserver");M.va().onPointerObservable.remove(x),M.Sd.remove(f),C._deleteExecutionVariable(this,"mesh"),C._deleteExecutionVariable(this,"meshPickObserver"),C._deleteExecutionVariable(this,"meshDisposeObserver")}getClassName(){return Hx.ClassName}serialize(C){super.serialize(C),C.config.path=this.config.path}}Hx.ClassName="FGMeshPickEventBlock",(0,R.f)(Hx.ClassName,Hx),function(C){C[C.Stopped=0]="Stopped",C[C.Started=1]="Started"}(ox||(ox={}));class jx{constructor(C){this._eventBlocks=[],this._executionContexts=[],this.state=0,this._scene=C.xe,this._coordinator=C.coordinator,this._sceneDisposeObserver=this._scene.Sd.add((()=>this.dispose()))}createContext(){const C=new Dx({xe:this._scene,coordinator:this._coordinator});return this._executionContexts.push(C),C}getContext(C){return this._executionContexts[C]}addEventBlock(C){this._eventBlocks.push(C)}start(){if(1!==this.state){this.state=1,0===this._executionContexts.length&&this.createContext();for(const C of this._executionContexts){const M=this._getContextualOrder();for(const x of M)x._startPendingTasks(C)}}}_getContextualOrder(){const C=[];for(const M of this._eventBlocks)if(M.getClassName()===Hx.ClassName){const x=M._getReferencedMesh();let f=0;for(;f<C.length;f++){const M=C[f]._getReferencedMesh();if(x&&M&&Ax(x,M))break}C.splice(f,0,M)}else C.push(M);return C}dispose(){if(0!==this.state){this.state=0;for(const C of this._executionContexts)C._clearPendingBlocks();this._executionContexts.length=0,this._eventBlocks.length=0,this._scene.Sd.remove(this._sceneDisposeObserver),this._sceneDisposeObserver=null}}visitAllBlocks(C){const M=[],x=new Set;for(const f of this._eventBlocks)M.push(f),x.add(f.uniqueId);for(;M.length>0;){const f=M.pop();C(f);for(const C of f.dataInputs)for(const f of C._connectedPoint)x.has(f._ownerBlock.uniqueId)||(M.push(f._ownerBlock),x.add(f._ownerBlock.uniqueId));if(f instanceof Ux)for(const C of f.signalOutputs)for(const f of C._connectedPoint)x.has(f._ownerBlock.uniqueId)||(M.push(f._ownerBlock),x.add(f._ownerBlock.uniqueId))}}serialize(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},M=arguments.length>1?arguments[1]:void 0;C.allBlocks=[],this.visitAllBlocks((M=>{const x={};M.serialize(x),C.allBlocks.push(x)})),C.executionContexts=[];for(const x of this._executionContexts){const f={};x.serialize(f,M),C.executionContexts.push(f)}}static GetDataOutConnectionByUniqueId(C,M){for(const x of C)for(const C of x.dataOutputs)if(C.uniqueId===M)return C;throw new Error("Could not find data out connection with unique id "+M)}static GetSignalInConnectionByUniqueId(C,M){for(const x of C)if(x instanceof Ux)for(const C of x.signalInputs)if(C.uniqueId===M)return C;throw new Error("Could not find signal in connection with unique id "+M)}static Parse(C,M){const x=M.coordinator.createGraph(),f=[],T=M.valueParseFunction??Qx;for(const z of C.allBlocks){const C=Vx.Parse(z,{xe:M.coordinator.config.xe,pathConverter:M.pathConverter,valueParseFunction:T});f.push(C),C instanceof dx&&x.addEventBlock(C)}for(const z of f){for(const C of z.dataInputs)for(const M of C.connectedPointIds){const x=jx.GetDataOutConnectionByUniqueId(f,M);C.connectTo(x)}if(z instanceof Ux)for(const C of z.signalOutputs)for(const M of C.connectedPointIds){const x=jx.GetSignalInConnectionByUniqueId(f,M);C.connectTo(x)}}for(const z of C.executionContexts)Dx.Parse(z,{graph:x,valueParseFunction:T});return x}}class bx{constructor(C){this.config=C,this._flowGraphs=[],this._customEventsMap=new Map,this.config.xe.Sd.add((()=>{this.dispose()}));(bx.SceneCoordinators.get(this.config.xe)??[]).push(this)}createGraph(){const C=new jx({xe:this.config.xe,coordinator:this});return this._flowGraphs.push(C),C}removeGraph(C){const M=this._flowGraphs.indexOf(C);-1!==M&&(C.dispose(),this._flowGraphs.splice(M,1))}start(){this._flowGraphs.forEach((C=>C.start()))}dispose(){this._flowGraphs.forEach((C=>C.dispose())),this._flowGraphs.length=0;const C=bx.SceneCoordinators.get(this.config.xe)??[],M=C.indexOf(this);-1!==M&&C.splice(M,1)}serialize(C,M){C._flowGraphs=[],this._flowGraphs.forEach((x=>{const f={};x.serialize(f,M),C._flowGraphs.push(f)}))}static Parse(C,M){var x;const f=M.valueParseFunction??Qx,T=new bx({xe:M.xe});return null===(x=C._flowGraphs)||void 0===x||x.forEach((C=>{jx.Parse(C,{coordinator:T,valueParseFunction:f,pathConverter:M.pathConverter})})),T}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(C){let M=this._customEventsMap.get(C);return M||(M=new V.c,this._customEventsMap.set(C,M)),M}notifyCustomEvent(C,M){const x=this._customEventsMap.get(C);x&&x.notifyObservers(M)}}bx.SceneCoordinators=new Map;class Rx extends dx{_preparePendingTasks(C){if(!C._getExecutionVariable(this,"sceneReadyObserver")){const M=C.configuration.xe.onReadyObservable.add((()=>{this._execute(C)}));C._setExecutionVariable(this,"sceneReadyObserver",M)}}_cancelPendingTasks(C){const M=C._getExecutionVariable(this,"sceneReadyObserver");C.configuration.xe.onReadyObservable.remove(M),C._deleteExecutionVariable(this,"sceneReadyObserver")}getClassName(){return Rx.ClassName}}Rx.ClassName="FGSceneReadyEventBlock",(0,R.f)("FGSceneReadyEventBlock",Rx);class nx extends dx{_preparePendingTasks(C){if(!C._getExecutionVariable(this,"sceneBeforeRender")){const M=C.configuration.xe.onBeforeRenderObservable.add((()=>{this._execute(C)}));C._setExecutionVariable(this,"sceneBeforeRender",M)}}_cancelPendingTasks(C){const M=C._getExecutionVariable(this,"sceneBeforeRender");C.configuration.xe.onBeforeRenderObservable.remove(M),C._deleteExecutionVariable(this,"sceneBeforeRender")}getClassName(){return nx.ClassName}}nx.ClassName="FGSceneTickEventBlock",(0,R.f)(nx.ClassName,nx);class Ix extends Ux{constructor(C){super(C),this.out=this._registerSignalOutput("out")}}class Xx extends Ix{constructor(C){super(C),this.message=this.registerDataInput("message",wM)}_execute(C){const M=this.message.getValue(C);D.e.Log(M),this.out._activateSignal(C)}getClassName(){return Xx.ClassName}}Xx.ClassName="FGConsoleLogBlock",(0,R.f)(Xx.ClassName,Xx),function(C){C[C.INIT=0]="INIT",C[C.STARTED=1]="STARTED",C[C.ENDED=2]="ENDED"}(Lx||(Lx={}));class gx{constructor(C){this.onEachCountObservable=new V.c,this.onTimerAbortedObservable=new V.c,this.onTimerEndedObservable=new V.c,this.onStateChangedObservable=new V.c,this._observer=null,this._breakOnNextTick=!1,this._tick=C=>{const M=Date.now();this._timer=M-this._startTime;const x={startTime:this._startTime,currentTime:M,deltaTime:this._timer,completeRate:this._timer/this._timeToEnd,payload:C},f=this._breakOnNextTick||this._breakCondition(x);f||this._timer>=this._timeToEnd?this._stop(x,f):this.onEachCountObservable.notifyObservers(x)},this._setState(0),this._contextObservable=C.contextObservable,this._observableParameters=C.observableParameters??{},this._breakCondition=C.breakCondition??(()=>!1),this._timeToEnd=C.timeout,C.onEnded&&this.onTimerEndedObservable.add(C.onEnded),C.Ai&&this.onEachCountObservable.add(C.Ai),C.onAborted&&this.onTimerAbortedObservable.add(C.onAborted)}set breakCondition(C){this._breakCondition=C}clearObservables(){this.onEachCountObservable.clear(),this.onTimerAbortedObservable.clear(),this.onTimerEndedObservable.clear(),this.onStateChangedObservable.clear()}start(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._timeToEnd;if(1===this._state)throw new Error("Timer already started. Please stop it before starting again");this._timeToEnd=C,this._startTime=Date.now(),this._timer=0,this._observer=this._contextObservable.add(this._tick,this._observableParameters.mask,this._observableParameters.insertFirst,this._observableParameters.scope),this._setState(1)}stop(){1===this._state&&(this._breakOnNextTick=!0)}dispose(){this._observer&&this._contextObservable.remove(this._observer),this.clearObservables()}_setState(C){this._state=C,this.onStateChangedObservable.notifyObservers(this._state)}_stop(C){let M=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._contextObservable.remove(this._observer),this._setState(2),M?this.onTimerAbortedObservable.notifyObservers(C):this.onTimerEndedObservable.notifyObservers(C)}}class Bx extends Ox{constructor(C){super(C),this.timeout=this.registerDataInput("timeout",lM)}_preparePendingTasks(C){const M=this.timeout.getValue(C);if(void 0!==M&&M>=0){const x=C._getExecutionVariable(this,"runningTimers")||[],f=C.configuration.xe,T=new gx({timeout:M,contextObservable:f.onBeforeRenderObservable,onEnded:()=>this._onEnded(T,C)});T.start(),x.push(T),C._setExecutionVariable(this,"runningTimers",x)}}_execute(C){this._startPendingTasks(C),this.out._activateSignal(C)}_onEnded(C,M){const x=M._getExecutionVariable(this,"runningTimers")||[],f=x.indexOf(C);-1!==f?x.splice(f,1):s.i.Warn("FlowGraphTimerBlock: Timer ended but was not found in the running timers list"),M._removePendingBlock(this),this.done._activateSignal(M)}_cancelPendingTasks(C){const M=C._getExecutionVariable(this,"runningTimers")||[];for(const x of M)x.dispose();C._deleteExecutionVariable(this,"runningTimers")}getClassName(){return Bx.ClassName}}Bx.ClassName="FGTimerBlock",(0,R.f)("FGTimerBlock",Bx);class Fx extends Ix{constructor(C){super(C),this.config=C;for(let M=0;M<this.config.eventData.length;M++){const C=this.config.eventData[M];this.registerDataInput(C,wM)}}_execute(C){const M=this.config.eventId,x=this.dataInputs.map((M=>M.getValue(C)));C.configuration.coordinator.notifyCustomEvent(M,x),this.out._activateSignal(C)}getClassName(){return Fx.ClassName}}Fx.ClassName="FGSendCustomEventBlock",(0,R.f)("FGSendCustomEventBlock",Fx);class Px extends dx{constructor(C){super(C),this.config=C;for(let M=0;M<this.config.eventData.length;M++){const C=this.config.eventData[M];this.registerDataOutput(C,wM)}}_preparePendingTasks(C){const M=C.configuration.coordinator.getCustomEventObservable(this.config.eventId);this._eventObserver=M.add((M=>{for(let x=0;x<M.length;x++)this.dataOutputs[x].setValue(M[x],C);this._execute(C)}))}_cancelPendingTasks(C){const M=C.configuration.coordinator.getCustomEventObservable(this.config.eventId);M?M.remove(this._eventObserver):s.i.Warn(`FlowGraphReceiveCustomEventBlock: Missing observable for event ${this.config.eventId}`)}getClassName(){return Px.ClassName}serialize(C){super.serialize(C),C.eventId=this.config.eventId,C.eventData=this.config.eventData}}Px.ClassName="FGReceiveCustomEventBlock",(0,R.f)(Px.ClassName,Px);class hx extends Ux{constructor(C){super(C),this.config=C,this.outFlows=[];for(let M=0;M<this.config.numberOutputFlows;M++)this.outFlows.push(this._registerSignalOutput(`${M}`))}_execute(C){for(let M=0;M<this.config.numberOutputFlows;M++)this.outFlows[M]._activateSignal(C)}getClassName(){return hx.ClassName}}hx.ClassName="FGSequenceBlock",(0,R.f)(hx.ClassName,hx);const cx=new RegExp(/\{(\w+)\}/g);class qx{constructor(C,M){this.path=C,this.ownerBlock=M,this.templatedInputs=[];let x=cx.exec(C);for(;x;){const[,f]=x;this.templatedInputs.push(M.registerDataInput(f,Tx)),x=cx.exec(C)}}getAccessor(C,M){let x=this.path;for(const f of this.templatedInputs){const C=f.getValue(M).value;x=x.replace(`{${f.name}}`,C.toString())}return C.convert(x)}}class ix extends Vx{constructor(C){super(C),this.config=C,this.value=this.registerDataOutput("value",wM),this.templateComponent=new qx(C.path,this)}_updateOutputs(C){const M=this.templateComponent.getAccessor(this.config.pathConverter,C),x=M.info.get(M.object);this.value.setValue(x,C)}getClassName(){return ix.ClassName}serialize(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(C),C.config.path=this.config.path}}ix.ClassName="FGGetPropertyBlock",(0,R.f)(ix.ClassName,ix);class Zx extends Ix{constructor(C){super(C),this.config=C,this.a=this.registerDataInput("a",wM),this.templateComponent=new qx(C.path,this)}_execute(C){const M=this.a.getValue(C),x=this.templateComponent.getAccessor(this.config.pathConverter,C);x.info.set(M,x.object),this.out._activateSignal(C)}serialize(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(C),C.config.path=this.config.path}getClassName(){return Zx.ClassName}}Zx.ClassName="FGSetPropertyBlock",(0,R.f)("FGSetPropertyBlock",Zx);const Ex="cachedOperationValue",Kx="cachedExecutionId";class Gx extends Vx{constructor(C,M){super(M),this.value=this.registerDataOutput("value",C)}_updateOutputs(C){const M=C._getExecutionVariable(this,Kx),x=C._getExecutionVariable(this,Ex);if(void 0!==x&&M===C.executionId)this.value.setValue(x,C);else{const M=this._doOperation(C);C._setExecutionVariable(this,Ex,M),C._setExecutionVariable(this,Kx,C.executionId),this.value.setValue(M,C)}}}class ax extends Gx{constructor(C,M,x,f,T,z){super(x,z),this._operation=f,this._className=T,this.a=this.registerDataInput("a",C),this.b=this.registerDataInput("b",M)}_doOperation(C){return this._operation(this.a.getValue(C),this.b.getValue(C))}getClassName(){return this._className}}class Jx extends Gx{constructor(C,M,x,f){super(C,f),this._operation=M,this._className=x}_doOperation(C){return this._operation()}getClassName(){return this._className}}class Nx extends Gx{constructor(C,M,x,f,T){super(M,T),this._operation=x,this._className=f,this.a=this.registerDataInput("a",C)}_doOperation(C){return this._operation(this.a.getValue(C))}getClassName(){return this._className}}class kx extends Gx{constructor(C,M,x,f,T,z,s){super(f,s),this._operation=T,this._className=z,this.a=this.registerDataInput("a",C),this.b=this.registerDataInput("b",M),this.c=this.registerDataInput("c",x)}_doOperation(C){return this._operation(this.a.getValue(C),this.b.getValue(C),this.c.getValue(C))}getClassName(){return this._className}}function vx(C){return C.getClassName?C.getClassName():""}function px(C,M){return"Vector2"===C&&"Vector2"===M||"Md"===C&&"Md"===M||"Vector4"===C&&"Vector4"===M}function ux(C,M){return"Matrix"===C&&"Matrix"===M}function Yx(C,M){return"FlowGraphInteger"===C&&"FlowGraphInteger"===M}class Wx extends ax{constructor(C){super(wM,wM,wM,((C,M)=>this._polymorphicAdd(C,M)),Wx.ClassName,C)}_polymorphicAdd(C,M){const x=vx(C),f=vx(M);return px(x,f)||ux(x,f)||Yx(x,f)?C.add(M):C+M}}Wx.ClassName="FGAddBlock",(0,R.f)(Wx.ClassName,Wx);class ex extends ax{constructor(C){super(wM,wM,wM,((C,M)=>this._polymorphicAdd(C,M)),ex.ClassName,C)}_polymorphicAdd(C,M){const x=vx(C),f=vx(M);return px(x,f)||Yx(x,f)?C.rc(M):ux(x,f)?C.add(M.scale(-1)):C-M}}ex.ClassName="FGSubBlock",(0,R.f)(ex.ClassName,ex);class rx extends ax{constructor(C){super(wM,wM,wM,((C,M)=>this._polymorphicMultiply(C,M)),rx.ClassName,C)}_polymorphicMultiply(C,M){const x=vx(C),f=vx(M);return px(x,f)||Yx(x,f)?C.multiply(M):ux(x,f)?T.d.FromValues(C.m[0]*M.m[0],C.m[4]*M.m[4],C.m[8]*M.m[8],C.m[12]*M.m[12],C.m[1]*M.m[1],C.m[5]*M.m[5],C.m[9]*M.m[9],C.m[13]*M.m[13],C.m[2]*M.m[2],C.m[6]*M.m[6],C.m[10]*M.m[10],C.m[14]*M.m[14],C.m[3]*M.m[3],C.m[7]*M.m[7],C.m[11]*M.m[11],C.m[15]*M.m[15]):C*M}}rx.ClassName="FGMultiplyBlock",(0,R.f)(rx.ClassName,rx);class wx extends ax{constructor(C){super(wM,wM,wM,((C,M)=>this._polymorphicDivide(C,M)),wx.ClassName,C)}_polymorphicDivide(C,M){const x=vx(C),f=vx(M);return px(x,f)||Yx(x,f)?C.divide(M):ux(x,f)?T.d.FromValues(C.m[0]/M.m[0],C.m[4]/M.m[4],C.m[8]/M.m[8],C.m[12]/M.m[12],C.m[1]/M.m[1],C.m[5]/M.m[5],C.m[9]/M.m[9],C.m[13]/M.m[13],C.m[2]/M.m[2],C.m[6]/M.m[6],C.m[10]/M.m[10],C.m[14]/M.m[14],C.m[3]/M.m[3],C.m[7]/M.m[7],C.m[11]/M.m[11],C.m[15]/M.m[15]):C/M}}wx.ClassName="FGDivideBlock",(0,R.f)(wx.ClassName,wx);class lx extends Jx{constructor(C){super(lM,(()=>Math.random()),lx.ClassName,C)}}lx.ClassName="FGRandomBlock",(0,R.f)(lx.ClassName,lx);class Cf extends ax{constructor(C){super(wM,wM,lM,((C,M)=>this._polymorphicDot(C,M)),Cf.ClassName,C)}_polymorphicDot(C,M){switch(vx(C)){case"Vector2":return T.j.Dot(C,M);case"Md":return T.m.Dot(C,M);case"Vector4":return T.q.Dot(C,M);default:throw new Error(`Cannot get dot product of ${C} and ${M}`)}}}Cf.ClassName="FGDotBlock",(0,R.f)(Cf.ClassName,Cf);class Mf extends Jx{constructor(C){super(lM,(()=>Math.E),Mf.ClassName,C)}}Mf.ClassName="FGEBlock",(0,R.f)(Mf.ClassName,Mf);class xf extends Jx{constructor(C){super(lM,(()=>Math.PI),xf.ClassName,C)}}xf.ClassName="FGPIBlock",(0,R.f)(xf.ClassName,xf);class ff extends Jx{constructor(C){super(lM,(()=>Number.POSITIVE_INFINITY),ff.ClassName,C)}}ff.ClassName="FGInfBlock",(0,R.f)(ff.ClassName,ff);class Tf extends Jx{constructor(C){super(lM,(()=>Number.NaN),Tf.ClassName,C)}}function zf(C,M){switch(vx(C)){case"FlowGraphInteger":return new eM(M(C.value));case"Vector2":return new T.j(M(C.x),M(C.y));case"Md":return new T.m(M(C.x),M(C.y),M(C.z));case"Vector4":return new T.q(M(C.x),M(C.y),M(C.z),M(C.w));case"Matrix":return T.d.FromValues(M(C.m[0]),M(C.m[4]),M(C.m[8]),M(C.m[12]),M(C.m[1]),M(C.m[5]),M(C.m[9]),M(C.m[13]),M(C.m[2]),M(C.m[6]),M(C.m[10]),M(C.m[14]),M(C.m[3]),M(C.m[7]),M(C.m[11]),M(C.m[15]));default:return M(C)}}Tf.ClassName="FGNaNBlock",(0,R.f)(Tf.ClassName,Tf);class sf extends Nx{constructor(C){super(wM,wM,(C=>this._polymorphicAbs(C)),sf.ClassName,C)}_polymorphicAbs(C){return zf(C,Math.abs)}}sf.ClassName="FGAbsBlock",(0,R.f)(sf.ClassName,sf);class Sf extends Nx{constructor(C){super(wM,wM,(C=>this._polymorphicSign(C)),Sf.ClassName,C)}_polymorphicSign(C){return zf(C,Math.sign)}}Sf.ClassName="FGSignBlock",(0,R.f)(Sf.ClassName,Sf);class mf extends Nx{constructor(C){super(wM,wM,(C=>this._polymorphicTrunc(C)),mf.ClassName,C)}_polymorphicTrunc(C){return zf(C,Math.trunc)}}mf.ClassName="FGTruncBlock",(0,R.f)(mf.ClassName,mf);class Qf extends Nx{constructor(C){super(wM,wM,(C=>this._polymorphicFloor(C)),Qf.ClassName,C)}_polymorphicFloor(C){return zf(C,Math.floor)}}Qf.ClassName="FGFloorBlock",(0,R.f)(Qf.ClassName,Qf);class Vf extends Nx{constructor(C){super(wM,wM,(C=>this._polymorphicCeiling(C)),Vf.ClassName,C)}_polymorphicCeiling(C){return zf(C,Math.ceil)}}Vf.ClassName="FGCeilBlock",(0,R.f)(Vf.ClassName,Vf);class yf extends Nx{constructor(C){super(wM,wM,(C=>this._polymorphicFract(C)),yf.ClassName,C)}_polymorphicFract(C){return zf(C,(C=>C-Math.floor(C)))}}yf.ClassName="FGFractBlock",(0,R.f)(yf.ClassName,yf);class Uf extends Nx{constructor(C){super(wM,wM,(C=>this._polymorphicNeg(C)),Uf.ClassName,C)}_polymorphicNeg(C){return zf(C,(C=>-C))}}function Of(C,M,x){switch(vx(C)){case"FlowGraphInteger":return new eM(x(C.value,M.value));case"Vector2":return new T.j(x(C.x,M.x),x(C.y,M.y));case"Md":return new T.m(x(C.x,M.x),x(C.y,M.y),x(C.z,M.z));case"Vector4":return new T.q(x(C.x,M.x),x(C.y,M.y),x(C.z,M.z),x(C.w,M.w));case"Matrix":return T.d.FromValues(x(C.m[0],M.m[0]),x(C.m[4],M.m[4]),x(C.m[8],M.m[8]),x(C.m[12],M.m[12]),x(C.m[1],M.m[1]),x(C.m[5],M.m[5]),x(C.m[9],M.m[9]),x(C.m[13],M.m[13]),x(C.m[2],M.m[2]),x(C.m[6],M.m[6]),x(C.m[10],M.m[10]),x(C.m[14],M.m[14]),x(C.m[3],M.m[3]),x(C.m[7],M.m[7]),x(C.m[11],M.m[11]),x(C.m[15],M.m[15]));default:return x(C,M)}}Uf.ClassName="FGNegBlock",(0,R.f)(Uf.ClassName,Uf);class df extends ax{constructor(C){super(wM,wM,wM,((C,M)=>this._polymorphicRemainder(C,M)),df.ClassName,C)}_polymorphicRemainder(C,M){return Of(C,M,((C,M)=>C%M))}}df.ClassName="FGRemainderBlock",(0,R.f)(df.ClassName,df);class Df extends ax{constructor(C){super(wM,wM,wM,((C,M)=>this._polymorphicMin(C,M)),Df.ClassName,C)}_polymorphicMin(C,M){return Of(C,M,Math.min)}}Df.ClassName="FGMinBlock",(0,R.f)(Df.ClassName,Df);class of extends ax{constructor(C){super(wM,wM,wM,((C,M)=>this._polymorphicMax(C,M)),of.ClassName,C)}_polymorphicMax(C,M){return Of(C,M,Math.max)}}function Lf(C,M,x){return Math.min(Math.max(C,Math.min(M,x)),Math.max(M,x))}function tf(C,M,x,f){switch(vx(C)){case"FlowGraphInteger":return new eM(f(C.value,M.value,x.value));case"Vector2":return new T.j(f(C.x,M.x,x.x),f(C.y,M.y,x.y));case"Md":return new T.m(f(C.x,M.x,x.x),f(C.y,M.y,x.y),f(C.z,M.z,x.z));case"Vector4":return new T.q(f(C.x,M.x,x.x),f(C.y,M.y,x.y),f(C.z,M.z,x.z),f(C.w,M.w,x.w));case"Matrix":return T.d.FromValues(f(C.m[0],M.m[0],x.m[0]),f(C.m[4],M.m[4],x.m[4]),f(C.m[8],M.m[8],x.m[8]),f(C.m[12],M.m[12],x.m[12]),f(C.m[1],M.m[1],x.m[1]),f(C.m[5],M.m[5],x.m[5]),f(C.m[9],M.m[9],x.m[9]),f(C.m[13],M.m[13],x.m[13]),f(C.m[2],M.m[2],x.m[2]),f(C.m[6],M.m[6],x.m[6]),f(C.m[10],M.m[10],x.m[10]),f(C.m[14],M.m[14],x.m[14]),f(C.m[3],M.m[3],x.m[3]),f(C.m[7],M.m[7],x.m[7]),f(C.m[11],M.m[11],x.m[11]),f(C.m[15],M.m[15],x.m[15]));default:return f(C,M,x)}}of.ClassName="FGMaxBlock",(0,R.f)(of.ClassName,of);class Af extends kx{constructor(C){super(wM,wM,wM,wM,((C,M,x)=>this._polymorphicClamp(C,M,x)),Af.ClassName,C)}_polymorphicClamp(C,M,x){return tf(C,M,x,Lf)}}function Hf(C){return Math.min(Math.max(C,0),1)}Af.ClassName="FGClampBlock",(0,R.f)(Af.ClassName,Af);class jf extends Nx{constructor(C){super(wM,wM,(C=>this._polymorphicSaturate(C)),jf.ClassName,C)}_polymorphicSaturate(C){return zf(C,Hf)}}jf.ClassName="FGSaturateBlock",(0,R.f)(jf.ClassName,jf);class bf extends kx{constructor(C){super(wM,wM,wM,wM,((C,M,x)=>this._polymorphicInterpolate(C,M,x)),bf.ClassName,C)}_interpolate(C,M,x){return(1-x)*C+x*M}_polymorphicInterpolate(C,M,x){return tf(C,M,x,this._interpolate)}}bf.ClassName="FGInterpolateBlock",(0,R.f)(bf.ClassName,bf);class Rf extends ax{constructor(C){super(wM,wM,Cx,((C,M)=>this._polymorphicEq(C,M)),Rf.ClassName,C)}_polymorphicEq(C,M){const x=vx(C),f=vx(M);return px(x,f)||ux(x,f)||Yx(x,f)?C.equals(M):C===M}}function nf(C,M,x){const f=vx(C);if(f===vx(M)){if(""===f)return x(C,M);if("FlowGraphInteger"===f)return x(C.value,M.value);throw new Error(`Cannot compare ${C} and ${M}`)}throw new Error(`${C} and ${M} are of different types.`)}Rf.ClassName="FGEqBlock",(0,R.f)(Rf.ClassName,Rf);class If extends ax{constructor(C){super(wM,wM,Cx,((C,M)=>this._polymorphicLessThan(C,M)),If.ClassName,C)}_polymorphicLessThan(C,M){return nf(C,M,((C,M)=>C<M))}}If.ClassName="FGLessThanBlock",(0,R.f)(If.ClassName,If);class Xf extends ax{constructor(C){super(wM,wM,Cx,((C,M)=>this._polymorphicLessThanOrEqual(C,M)),Xf.ClassName,C)}_polymorphicLessThanOrEqual(C,M){return nf(C,M,((C,M)=>C<=M))}}Xf.ClassName="FGLessThanOrEqualBlock";class gf extends ax{constructor(C){super(wM,wM,Cx,((C,M)=>this._polymorphicGreaterThan(C,M)),gf.ClassName,C)}_polymorphicGreaterThan(C,M){return nf(C,M,((C,M)=>C>M))}}gf.ClassName="FGGreaterThanBlock",(0,R.f)(gf.ClassName,gf);class Bf extends ax{constructor(C){super(wM,wM,Cx,((C,M)=>this._polymorphicGreaterThanOrEqual(C,M)),Bf.ClassName,C)}_polymorphicGreaterThanOrEqual(C,M){return nf(C,M,((C,M)=>C>=M))}}Bf.ClassName="FGGreaterThanOrEqualBlock",(0,R.f)(Bf.ClassName,Bf);class Ff extends Nx{constructor(C){super(wM,Cx,(C=>this._polymorphicIsNan(C)),Ff.ClassName,C)}_polymorphicIsNan(C){const M=vx(C);if(""===M)return isNaN(C);if("FlowGraphInteger"===M)return isNaN(C.value);throw new Error(`Cannot get NaN of ${C}`)}}Ff.ClassName="FGIsNanBlock",(0,R.f)(Ff.ClassName,Ff);class Pf extends Nx{constructor(C){super(wM,Cx,(C=>this._polymorphicIsInf(C)),Pf.ClassName,C)}_polymorphicIsInf(C){const M=vx(C);if(""===M)return!isFinite(C);if("FlowGraphInteger"===M)return!isFinite(C.value);throw new Error(`Cannot get isInf of ${C}`)}}Pf.ClassName="FGIsInfBlock";class hf extends Nx{constructor(C){super(wM,wM,(C=>this._polymorphicDegToRad(C)),hf.ClassName,C)}_degToRad(C){return C*Math.PI/180}_polymorphicDegToRad(C){return zf(C,this._degToRad)}}hf.ClassName="FGDegToRadBlock",(0,R.f)(hf.ClassName,hf);class cf extends Nx{constructor(C){super(wM,wM,(C=>this._polymorphicRadToDeg(C)),cf.ClassName,C)}_radToDeg(C){return 180*C/Math.PI}_polymorphicRadToDeg(C){return zf(C,this._radToDeg)}}cf.ClassName="FGRadToDegBlock",(0,R.f)(cf.ClassName,cf);class qf extends Nx{constructor(C){super(wM,wM,(C=>this._polymorphicSin(C)),qf.ClassName,C)}_polymorphicSin(C){return zf(C,Math.sin)}}qf.ClassName="FGSinBlock",(0,R.f)(qf.ClassName,qf);class Zf extends Nx{constructor(C){super(wM,wM,(C=>this._polymorphicCos(C)),Zf.ClassName,C)}_polymorphicCos(C){return zf(C,Math.cos)}}Zf.ClassName="FGCosBlock",(0,R.f)(Zf.ClassName,Zf);class Ef extends Nx{constructor(C){super(wM,wM,(C=>this._polymorphicTan(C)),Ef.ClassName,C)}_polymorphicTan(C){return zf(C,Math.tan)}}Ef.ClassName="FGTanBlock",(0,R.f)(Ef.ClassName,Ef);class Kf extends Nx{constructor(C){super(wM,wM,(C=>this._polymorphicAsin(C)),Kf.ClassName,C)}_polymorphicAsin(C){return zf(C,Math.asin)}}Kf.ClassName="FGAsinBlock",(0,R.f)(Kf.ClassName,Kf);class Gf extends Nx{constructor(C){super(wM,wM,(C=>this._polymorphicAcos(C)),Gf.ClassName,C)}_polymorphicAcos(C){return zf(C,Math.acos)}}Gf.ClassName="FGAcosBlock",(0,R.f)(Gf.ClassName,Gf);class af extends Nx{constructor(C){super(wM,wM,(C=>this._polymorphicAtan(C)),af.ClassName,C)}_polymorphicAtan(C){return zf(C,Math.atan)}}af.ClassName="FGAtanBlock",(0,R.f)(af.ClassName,af);class Jf extends ax{constructor(C){super(wM,wM,wM,((C,M)=>this._polymorphicAtan2(C,M)),Jf.ClassName,C)}_polymorphicAtan2(C,M){return Of(C,M,Math.atan2)}}Jf.ClassName="FGAtan2Block",(0,R.f)(Jf.ClassName,Jf);class Nf extends Nx{constructor(C){super(wM,wM,(C=>this._polymorphicSinh(C)),Nf.ClassName,C)}_polymorphicSinh(C){return zf(C,Math.sinh)}}Nf.ClassName="FGSinhBlock",(0,R.f)(Nf.ClassName,Nf);class kf extends Nx{constructor(C){super(wM,wM,(C=>this._polymorphicCosh(C)),kf.ClassName,C)}_polymorphicCosh(C){return zf(C,Math.cosh)}}kf.ClassName="FGCoshBlock",(0,R.f)(kf.ClassName,kf);class vf extends Nx{constructor(C){super(wM,wM,(C=>this._polymorphicTanh(C)),vf.ClassName,C)}_polymorphicTanh(C){return zf(C,Math.tanh)}}vf.ClassName="FGTanhBlock",(0,R.f)(vf.ClassName,vf);class pf extends Nx{constructor(C){super(wM,lM,(C=>this._polymorphicAsinh(C)),pf.ClassName,C)}_polymorphicAsinh(C){return zf(C,Math.asinh)}}pf.ClassName="FGAsinhBlock",(0,R.f)(pf.ClassName,pf);class uf extends Nx{constructor(C){super(wM,lM,(C=>this._polymorphicAcosh(C)),uf.ClassName,C)}_polymorphicAcosh(C){return zf(C,Math.acosh)}}uf.ClassName="FGAcoshBlock",(0,R.f)(uf.ClassName,uf);class Yf extends Nx{constructor(C){super(wM,lM,(C=>this._polymorphicAtanh(C)),Yf.ClassName,C)}_polymorphicAtanh(C){return zf(C,Math.atanh)}}Yf.ClassName="FGAtanhBlock",(0,R.f)(Yf.ClassName,Yf);class Wf extends Nx{constructor(C){super(wM,lM,(C=>this._polymorphicExp(C)),Wf.ClassName,C)}_polymorphicExp(C){return zf(C,Math.exp)}}Wf.ClassName="FGExpBlock",(0,R.f)(Wf.ClassName,Wf);class ef extends Nx{constructor(C){super(wM,lM,(C=>this._polymorphicLog(C)),ef.ClassName,C)}_polymorphicLog(C){return zf(C,Math.log)}}ef.ClassName="FGLogBlock",(0,R.f)(ef.ClassName,ef);class rf extends Nx{constructor(C){super(wM,lM,(C=>this._polymorphicLog2(C)),rf.ClassName,C)}_polymorphicLog2(C){return zf(C,Math.log2)}}rf.ClassName="FGLog2Block",(0,R.f)(rf.ClassName,rf);class wf extends Nx{constructor(C){super(wM,lM,(C=>this._polymorphicLog10(C)),wf.ClassName,C)}_polymorphicLog10(C){return zf(C,Math.log10)}}wf.ClassName="FGLog10Block",(0,R.f)(wf.ClassName,wf);class lf extends Nx{constructor(C){super(wM,lM,(C=>this._polymorphicSqrt(C)),lf.ClassName,C)}_polymorphicSqrt(C){return zf(C,Math.sqrt)}}lf.ClassName="FGSqrtBlock",(0,R.f)(lf.ClassName,lf);class CT extends Nx{constructor(C){super(wM,lM,(C=>this._polymorphicCubeRoot(C)),CT.ClassName,C)}_polymorphicCubeRoot(C){return zf(C,Math.cbrt)}}CT.ClassName="FGCubeRootBlock",(0,R.f)(CT.ClassName,CT);class MT extends ax{constructor(C){super(wM,lM,lM,((C,M)=>this._polymorphicPow(C,M)),MT.ClassName,C)}_polymorphicPow(C,M){return Of(C,M,Math.pow)}}MT.ClassName="FGPowBlock",(0,R.f)(MT.ClassName,MT);class xT extends Nx{constructor(C){super(wM,lM,(C=>this._polymorphicLength(C)),xT.ClassName,C)}_polymorphicLength(C){switch(vx(C)){case"Vector2":case"Md":case"Vector4":return C.length();default:throw new Error(`Cannot compute length of value ${C}`)}}}xT.ClassName="FGLengthBlock",(0,R.f)(xT.ClassName,xT);class fT extends Nx{constructor(C){super(wM,wM,(C=>this._polymorphicNormalize(C)),fT.ClassName,C)}_polymorphicNormalize(C){switch(vx(C)){case"Vector2":case"Md":case"Vector4":return C.normalize();default:throw new Error(`Cannot normalize value ${C}`)}}}fT.ClassName="FGNormalizeBlock",(0,R.f)(fT.ClassName,fT);class TT extends ax{constructor(C){super(xx,xx,xx,((C,M)=>T.m.Cross(C,M)),TT.ClassName,C)}}TT.ClassName="FGCrossBlock",(0,R.f)(TT.ClassName,TT);class zT extends ax{constructor(C){super(Mx,lM,Mx,((C,M)=>T.j.Transform(C,T.d.RotationZ(M))),zT.ClassName,C)}}zT.ClassName="FGRotate2DBlock",(0,R.f)(zT.ClassName,zT);class sT extends kx{constructor(C){super(xx,xx,lM,xx,((C,M,x)=>T.m.TransformCoordinates(C,T.d.RotationAxis(M,x))),sT.ClassName,C)}}sT.ClassName="FGRotate3DBlock",(0,R.f)(sT.ClassName,sT);class ST extends Nx{constructor(C){super(fx,fx,(C=>T.d.Transpose(C)),ST.ClassName,C)}}ST.ClassName="FGTransposeBlock",(0,R.f)(ST.ClassName,ST);class mT extends Nx{constructor(C){super(fx,lM,(C=>C.determinant()),mT.ClassName,C)}}mT.ClassName="FGDeterminantBlock",(0,R.f)(mT.ClassName,mT);class QT extends Nx{constructor(C){super(fx,fx,(C=>T.d.Invert(C)),QT.ClassName,C)}}QT.ClassName="FGInvertMatrixBlock",(0,R.f)(QT.ClassName,QT);class VT extends ax{constructor(C){super(fx,fx,fx,((C,M)=>M.multiply(C)),VT.ClassName,C)}}VT.ClassName="FGMatMulBlock",(0,R.f)(VT.ClassName,VT);class yT extends Nx{constructor(C){super(Tx,Tx,(C=>new eM(~C.value)),yT.ClassName,C)}}yT.ClassName="FGBitwiseNotBlock",(0,R.f)(yT.ClassName,yT);class UT extends ax{constructor(C){super(Tx,Tx,Tx,((C,M)=>new eM(C.value&M.value)),UT.ClassName,C)}}UT.ClassName="FGBitwiseAndBlock",(0,R.f)(UT.ClassName,UT);class OT extends ax{constructor(C){super(Tx,Tx,Tx,((C,M)=>new eM(C.value|M.value)),OT.ClassName,C)}}OT.ClassName="FGBitwiseOrBlock",(0,R.f)(OT.ClassName,OT);class dT extends ax{constructor(C){super(Tx,Tx,Tx,((C,M)=>new eM(C.value^M.value)),dT.ClassName,C)}}dT.ClassName="FGBitwiseXorBlock",(0,R.f)(dT.ClassName,dT);class DT extends ax{constructor(C){super(Tx,Tx,Tx,((C,M)=>new eM(C.value<<M.value)),DT.ClassName,C)}}DT.ClassName="FGBitwiseLeftShiftBlock",(0,R.f)(DT.ClassName,DT);class oT extends ax{constructor(C){super(Tx,Tx,Tx,((C,M)=>new eM(C.value>>M.value)),oT.ClassName,C)}}oT.ClassName="FGBitwiseRightShiftBlock",(0,R.f)(oT.ClassName,oT);class LT extends Nx{constructor(C){super(Tx,Tx,(C=>new eM(Math.clz32(C.value))),LT.ClassName,C)}}LT.ClassName="FGCountLeadingZerosBlock",(0,R.f)(LT.ClassName,LT);class tT extends Nx{constructor(C){super(Tx,Tx,(C=>new eM(C.value?31-Math.clz32(C.value&-C.value):32)),tT.ClassName,C)}}tT.ClassName="FGCountTrailingZerosBlock",(0,R.f)(tT.ClassName,tT);class AT extends Nx{constructor(C){super(Tx,Tx,(C=>new eM(function(C){let M=0;for(;C;)M+=1&C,C>>=1;return M}(C.value))),AT.ClassName,C)}}AT.ClassName="FGCountOneBitsBlock",(0,R.f)(AT.ClassName,AT);class HT extends Ix{constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{startIndex:new eM(0)};super(C),this.config=C,this.reset=this._registerSignalInput("reset"),this.n=this.registerDataInput("n",Tx),this.value=this.registerDataOutput("value",Tx)}_execute(C,M){if(M===this.reset)this.value.setValue(this.config.startIndex,C);else{const M=this.value.getValue(C);M.value<this.n.getValue(C).value&&(this.value.setValue(new eM(M.value+1),C),this.out._activateSignal(C))}}getClassName(){return HT.ClassName}}HT.ClassName="FGDoNBlock",(0,R.f)(HT.ClassName,HT);class jT extends Vx{constructor(C){super(C),this.config=C,this.output=this.registerDataOutput(C.variableName,wM)}_updateOutputs(C){const M=this.config.variableName;C.hasVariable(M)&&this.output.setValue(C.getVariable(M),C)}getClassName(){return jT.ClassName}serialize(C){super.serialize(C),C.config.variableName=this.config.variableName}}jT.ClassName="FGGetVariableBlock",(0,R.f)(jT.ClassName,jT);class bT extends Ix{constructor(C){super(C),this.config=C,this.input=this.registerDataInput(C.variableName,wM)}_execute(C){const M=this.config.variableName,x=this.input.getValue(C);C.setVariable(M,x),this.out._activateSignal(C)}getClassName(){return bT.ClassName}}bT.ClassName="FGSetVariableBlock",(0,R.f)(bT.ClassName,bT);class RT extends Ix{constructor(C){super(C),this.config=C,this.condition=this.registerDataInput("condition",Cx),this.loopBody=this._registerSignalOutput("loopBody")}_execute(C,M){var x;let f=this.condition.getValue(C);for(null!==(x=this.config)&&void 0!==x&&x.isDo&&!f&&this.loopBody._activateSignal(C);f;)this.loopBody._activateSignal(C),f=this.condition.getValue(C);this.out._activateSignal(C)}getClassName(){return RT.ClassName}serialize(C){var M;super.serialize(C),C.isDo=null===(M=this.config)||void 0===M?void 0:M.isDo}}RT.ClassName="FGWhileLoopBlock",(0,R.f)(RT.ClassName,RT);const nT={"lifecycle/onStart":Rx.ClassName,"lifecycle/onTick":nx.ClassName,log:Xx.ClassName,"flow/delay":Bx.ClassName,"customEvent/send":Fx.ClassName,"customEvent/receive":Px.ClassName,"flow/sequence":hx.ClassName,"world/get":ix.ClassName,"world/set":Zx.ClassName,"flow/doN":HT.ClassName,"variable/get":jT.ClassName,"variable/set":bT.ClassName,"flow/whileLoop":RT.ClassName,"math/random":lx.ClassName,"math/e":Mf.ClassName,"math/pi":xf.ClassName,"math/inf":ff.ClassName,"math/nan":Tf.ClassName,"math/abs":sf.ClassName,"math/sign":Sf.ClassName,"math/trunc":mf.ClassName,"math/floor":Qf.ClassName,"math/ceil":Vf.ClassName,"math/fract":yf.ClassName,"math/neg":Uf.ClassName,"math/add":Wx.ClassName,"math/sub":ex.ClassName,"math/mul":rx.ClassName,"math/div":wx.ClassName,"math/rem":df.ClassName,"math/min":Df.ClassName,"math/max":of.ClassName,"math/clamp":Af.ClassName,"math/saturate":jf.ClassName,"math/mix":bf.ClassName,"math/eq":Rf.ClassName,"math/lt":If.ClassName,"math/le":Xf.ClassName,"math/gt":gf.ClassName,"math/ge":Bf.ClassName,"math/isnan":Ff.ClassName,"math/isinf":Pf.ClassName,"math/rad":hf.ClassName,"math/deg":cf.ClassName,"math/sin":qf.ClassName,"math/cos":Zf.ClassName,"math/tan":Ef.ClassName,"math/asin":Kf.ClassName,"math/acos":Gf.ClassName,"math/atan":af.ClassName,"math/atan2":Jf.ClassName,"math/sinh":Nf.ClassName,"math/cosh":kf.ClassName,"math/tanh":vf.ClassName,"math/asinh":pf.ClassName,"math/acosh":uf.ClassName,"math/atanh":Yf.ClassName,"math/exp":Wf.ClassName,"math/log":ef.ClassName,"math/log2":rf.ClassName,"math/log10":wf.ClassName,"math/sqrt":lf.ClassName,"math/cbrt":CT.ClassName,"math/pow":MT.ClassName,"math/length":xT.ClassName,"math/normalize":fT.ClassName,"math/dot":Cf.ClassName,"math/cross":TT.ClassName,"math/rotate2d":zT.ClassName,"math/rotate3d":sT.ClassName,"math/transpose":ST.ClassName,"math/determinant":mT.ClassName,"math/inverse":QT.ClassName,"math/matmul":VT.ClassName,"math/not":yT.ClassName,"math/and":UT.ClassName,"math/or":OT.ClassName,"math/xor":dT.ClassName,"math/asr":oT.ClassName,"math/lsl":DT.ClassName,"math/clz":LT.ClassName,"math/ctz":tT.ClassName,"math/popcnt":AT.ClassName},IT={float2:"Vector2",float3:"Md",float4:"Vector4",float4x4:"Matrix",int:"FlowGraphInteger"};function XT(C,M,x){if(void 0!==C.type){const f=M.types&&M.types[C.type];if(!f)throw new Error(`${x}: Unknown type: ${C.type}`);const T=f.signature;if(!T)throw new Error(`${x}: Type ${C.type} has no signature`);const z=IT[T];return{value:C.value,className:z}}return C.value}function gT(C,M,x){const f=nT[M.type];if(!f)throw new Error(`/extensions/KHR_interactivity/nodes/${C}: Unknown block type: ${M.type}`);const T=C.toString(),z=function(C,M,x){const f={},T=C.configuration??[];for(const z of T)if("customEvent"===z.id){const C=M.customEvents&&M.customEvents[z.value];if(!C)throw new Error(`/extensions/KHR_interactivity/nodes/${x}: Unknown custom event: ${z.value}`);f.eventId=C.id,f.eventData=C.values.map((C=>C.id))}else if("variable"===z.id){const C=M.variables&&M.variables[z.value];if(!C)throw new Error(`/extensions/KHR_interactivity/nodes/${x}: Unknown variable: ${z.value}`);f.variableName=C.id}else if("path"===z.id){const C=z.value;f.path=C}else f[z.id]=XT(z,M,`/extensions/KHR_interactivity/nodes/${x}`);return f}(M,x,T);return{className:f,config:z,uniqueId:T,metadata:M.metadata,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[]}}class BT extends RM{constructor(C){super(C,PT)}}const FT={__array__:{__target__:!0,translation:{type:"Md",get:C=>C._babylonTransformNode.position,set:(C,M)=>{M._babylonTransformNode.position=C},getObject:C=>C._babylonTransformNode}}},PT={nodes:FT},hT="KHR_interactivity";class cT{constructor(C){this._loader=C,this.name=hT,this.enabled=this._loader.isExtensionUsed(hT),this._pathConverter=new BT(this._loader.gj)}dispose(){this._loader=null,delete this._pathConverter}onReady(){var C;if(!this._loader.babylonScene||!this._pathConverter)return;const M=this._loader.babylonScene,x=function(C){const M={uniqueId:(0,YM.c)(),_userVariables:{},_connectionValues:{}},x=[M],f=[];for(let z=0;z<C.nodes.length;z++){const M=gT(z,C.nodes[z],C);f.push(M)}for(let z=0;z<C.nodes.length;z++){const x=C.nodes[z],T=f[z],s=x.flows??[];for(const C of s){const M=C.id,x={uniqueId:(0,YM.c)(),name:M,_connectionType:1,connectedPointIds:[]};T.signalOutputs.push(x);const s=C.node,S=C.socket,m=f[s];if(!m)throw new Error(`/extensions/KHR_interactivity/nodes/${z}: Could not find node with id ${s} that connects its input with with node ${z}'s output ${M}`);let Q=m.signalInputs.find((C=>C.name===S));Q||(Q={uniqueId:(0,YM.c)(),name:S,_connectionType:0,connectedPointIds:[]},m.signalInputs.push(Q)),Q.connectedPointIds.push(x.uniqueId),x.connectedPointIds.push(Q.uniqueId)}const S=x.values??[];for(const m of S){const x=m.id,s={uniqueId:(0,YM.c)(),name:x,_connectionType:0,connectedPointIds:[]};if(T.dataInputs.push(s),void 0!==m.value){const x=XT(m,C,`/extensions/KHR_interactivity/nodes/${z}`);M._connectionValues[s.uniqueId]=x}else{if(void 0===m.node||void 0===m.socket)throw new Error(`/extensions/KHR_interactivity/nodes/${z}: Invalid socket ${x} in node ${z}`);{const C=m.node,M=m.socket,T=f[C];if(!T)throw new Error(`/extensions/KHR_interactivity/nodes/${z}: Could not find node with id ${C} that connects its output with node${z}'s input ${x}`);let S=T.dataOutputs.find((C=>C.name===M));S||(S={uniqueId:(0,YM.c)(),name:M,_connectionType:1,connectedPointIds:[]},T.dataOutputs.push(S)),s.connectedPointIds.push(S.uniqueId),S.connectedPointIds.push(s.uniqueId)}}}}const T=C.variables??[];for(let z=0;z<T.length;z++){const x=T[z],f=x.id;M._userVariables[f]=XT(x,C,`/extensions/KHR_interactivity/variables/${z}`)}return{allBlocks:f,executionContexts:x}}(null===(C=this._loader.gj.extensions)||void 0===C?void 0:C.KHR_interactivity),f=new bx({xe:M});jx.Parse(x,{coordinator:f,pathConverter:this._pathConverter}),f.start()}}Y(hT),u(hT,!0,(C=>new cT(C)));const qT="KHR_node_visibility";class iT{constructor(C){this.name=qT,this._loader=C,this.enabled=C.isExtensionUsed(qT)}async onReady(){var C;null===(C=this._loader.gj.nodes)||void 0===C||C.forEach((C=>{var M,x,f,T;(null===(M=C._primitiveBabylonMeshes)||void 0===M||M.forEach((C=>{C.inheritVisibility=!0})),null!==(x=C.extensions)&&void 0!==x&&x.KHR_node_visibility)&&(!1===(null===(f=C.extensions)||void 0===f?void 0:f.KHR_node_visibility.visible)&&(C._babylonTransformNode&&(C._babylonTransformNode.isVisible=!1),null===(T=C._primitiveBabylonMeshes)||void 0===T||T.forEach((C=>{C.isVisible=!1}))))}))}dispose(){this._loader=null}}Y(qT),u(qT,!0,(C=>new iT(C)));const ZT="ExtrasAsMetadata";class ET{_assignExtras(C,M){if(M.extras&&Object.keys(M.extras).length>0){const x=C.metadata=C.metadata||{};(x.gj=x.gj||{}).extras=M.extras}}constructor(C){this.name=ZT,this.enabled=!0,this._loader=C}dispose(){this._loader=null}loadNodeAsync(C,M,x){return this._loader.loadNodeAsync(C,M,(C=>{this._assignExtras(C,M),x(C)}))}loadCameraAsync(C,M,x){return this._loader.loadCameraAsync(C,M,(C=>{this._assignExtras(C,M),x(C)}))}createMaterial(C,M,x){const f=this._loader.createMaterial(C,M,x);return this._assignExtras(f,M),f}}Y(ZT),u(ZT,!1,(C=>new ET(C)))},12353:(C,M,x)=>{"use strict";x.d(M,{d:()=>P,h:()=>n,j:()=>R,k:()=>I});var f=x(971),T=x(1192),z=x(11812),s=x(11712),S=x(11765),m=x(11763),Q=x(1078),V=x(1008),y=x(12357),U=x(12359),O=x(11726);class d{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.te=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.ue=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(C){this._environmentTexture=C}getNodes(){let C=[];return C=C.concat(this.meshes),C=C.concat(this.lights),C=C.concat(this.cameras),C=C.concat(this.transformNodes),this.skeletons.forEach((M=>C=C.concat(M.bones))),C}}class D extends d{}class o{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){this.rootNodes.slice(0).forEach((C=>{C.dispose()})),this.rootNodes.length=0,this.skeletons.slice(0).forEach((C=>{C.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((C=>{C.dispose()})),this.animationGroups.length=0}}class L extends d{constructor(C){super(),this._wasAddedToScene=!1,(C=C||V.c.LastCreatedScene)&&(this.xe=C,this.proceduralTextures=[],C.Sd.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=C.getEngine().onContextRestoredObservable.add((()=>{for(const C of this.geometries)C._rebuild();for(const C of this.meshes)C._rebuild();for(const C of this.te)C.rebuild();for(const C of this.textures)C._rebuild()})))}_topologicalSort(C){const M=new Map;for(const s of C)M.set(s.uniqueId,s);const x={dependsOn:new Map,dependedBy:new Map};for(const s of C){const C=s.uniqueId;x.dependsOn.set(C,new Set),x.dependedBy.set(C,new Set)}for(const s of C){const C=s.uniqueId,f=x.dependsOn.get(C);if(s instanceof y.d){const T=s.sourceMesh;M.has(T.uniqueId)&&(f.add(T.uniqueId),x.dependedBy.get(T.uniqueId).add(C))}const T=x.dependedBy.get(C);for(const z of s.getDescendants()){const f=z.uniqueId;if(M.has(f)){T.add(f);x.dependsOn.get(f).add(C)}}}const f=[],T=[];for(const s of C){const C=s.uniqueId;0===x.dependsOn.get(C).size&&(T.push(s),M.delete(C))}const z=T;for(;z.length>0;){const C=z.shift();f.push(C);const T=x.dependedBy.get(C.uniqueId);for(const f of Array.from(T.values())){const T=x.dependsOn.get(f);T.delete(C.uniqueId),0===T.size&&M.get(f)&&(z.push(M.get(f)),M.delete(f))}}return M.size>0&&(Q.e.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),M.forEach((C=>Q.e.Error(C.name)))),f}_addNodeAndDescendantsToList(C,M,x,f){if(x&&(!f||f(x))&&!M.has(x.uniqueId)){C.push(x),M.add(x.uniqueId);for(const T of x.getDescendants(!0))this._addNodeAndDescendantsToList(C,M,T,f)}}_isNodeInContainer(C){return C instanceof m.b&&-1!==this.meshes.indexOf(C)||(C instanceof S.e&&-1!==this.transformNodes.indexOf(C)||(C instanceof U.c&&-1!==this.lights.indexOf(C)||C instanceof O.c&&-1!==this.cameras.indexOf(C)))}_isValidHierarchy(){for(const C of this.meshes)if(C.parent&&!this._isNodeInContainer(C.parent))return Q.e.Warn(`Node ${C.name} has a parent that is not in the container.`),!1;for(const C of this.transformNodes)if(C.parent&&!this._isNodeInContainer(C.parent))return Q.e.Warn(`Node ${C.name} has a parent that is not in the container.`),!1;for(const C of this.lights)if(C.parent&&!this._isNodeInContainer(C.parent))return Q.e.Warn(`Node ${C.name} has a parent that is not in the container.`),!1;for(const C of this.cameras)if(C.parent&&!this._isNodeInContainer(C.parent))return Q.e.Warn(`Node ${C.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(C){let M=arguments.length>1&&void 0!==arguments[1]&&arguments[1],x=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||T.i.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const f={},z={},S=new o,m=[],Q=[],V={doNotInstantiate:!0,...x},y=[],U=new Set;for(const T of this.transformNodes)null===T.parent&&this._addNodeAndDescendantsToList(y,U,T,V.predicate);for(const T of this.meshes)null===T.parent&&this._addNodeAndDescendantsToList(y,U,T,V.predicate);const O=this._topologicalSort(y),d=(x,T)=>{if(((M,x)=>{if(f[M.uniqueId]=x.uniqueId,z[x.uniqueId]=x,C&&(x.name=C(M.name)),x instanceof s.d){const C=x;if(C.morphTargetManager){const x=M.morphTargetManager;C.morphTargetManager=x.clone();for(let M=0;M<x.numTargets;M++){const T=x.getTarget(M),s=C.morphTargetManager.getTarget(M);f[T.uniqueId]=s.uniqueId,z[s.uniqueId]=s}}}})(x,T),x.parent){const C=f[x.parent.uniqueId],M=z[C];T.parent=M||x.parent}if(T.position&&x.position&&T.position.p(x.position),T.rotationQuaternion&&x.rotationQuaternion&&T.rotationQuaternion.p(x.rotationQuaternion),T.rotation&&x.rotation&&T.rotation.p(x.rotation),T.Qd&&x.Qd&&T.Qd.p(x.Qd),T.material){const s=T;if(s.material)if(M){const M=x.material;if(-1===Q.indexOf(M)){let x=M.clone(C?C(M.name):"Clone of "+M.name);if(Q.push(M),f[M.uniqueId]=x.uniqueId,z[x.uniqueId]=x,"MultiMaterial"===M.getClassName()){const T=M;for(const M of T.Mg)M&&(x=M.clone(C?C(M.name):"Clone of "+M.name),Q.push(M),f[M.uniqueId]=x.uniqueId,z[x.uniqueId]=x);T.Mg=T.Mg.map((C=>C&&z[f[C.uniqueId]]))}}"InstancedMesh"!==s.getClassName()&&(s.material=z[f[M.uniqueId]])}else"MultiMaterial"===s.material.getClassName()?-1===this.xe.multiMaterials.indexOf(s.material)&&this.xe.addMultiMaterial(s.material):-1===this.xe.materials.indexOf(s.material)&&this.xe.addMaterial(s.material)}null===T.parent&&S.rootNodes.push(T)};return O.forEach((C=>{if("InstancedMesh"===C.getClassName()){const M=C,x=M.sourceMesh,T=f[x.uniqueId],s=("number"===typeof T?z[T]:x).Bb(M.name);d(M,s)}else{let M=!0;"nb"===C.getClassName()||"Node"===C.getClassName()||C.skeleton||!C.getTotalVertices||0===C.getTotalVertices()?M=!1:V.doNotInstantiate&&(M="function"===typeof V.doNotInstantiate?!V.doNotInstantiate(C):!V.doNotInstantiate);const x=M?C.Bb(`instance of ${C.name}`):C.clone(`Clone of ${C.name}`,null,!0);if(!x)throw new Error(`Could not clone or instantiate node on Asset Container ${C.name}`);d(C,x)}})),this.skeletons.forEach((M=>{if(V.predicate&&!V.predicate(M))return;const x=M.clone(C?C(M.name):"Clone of "+M.name);for(const C of this.meshes)if(C.skeleton===M&&!C.isAnInstance){const M=z[f[C.uniqueId]];if(!M||M.isAnInstance)continue;if(M.skeleton=x,-1!==m.indexOf(x))continue;m.push(x);for(const C of x.bones)C._linkedTransformNode&&(C._linkedTransformNode=z[f[C._linkedTransformNode.uniqueId]])}S.skeletons.push(x)})),this.animationGroups.forEach((M=>{if(V.predicate&&!V.predicate(M))return;const x=M.clone(C?C(M.name):"Clone of "+M.name,(C=>z[f[C.uniqueId]]||C));S.animationGroups.push(x)})),S}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||T.i.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.xe.environmentTexture=this.environmentTexture);for(const C of this.xe._serializableComponents)C.addFromContainer(this);this.xe.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const M=[];this.cameras.forEach((x=>{C&&!C(x)||(this.xe.addCamera(x),M.push(x))})),this.lights.forEach((x=>{C&&!C(x)||(this.xe.addLight(x),M.push(x))})),this.meshes.forEach((x=>{C&&!C(x)||(this.xe.ye(x),M.push(x))})),this.skeletons.forEach((M=>{C&&!C(M)||this.xe.addSkeleton(M)})),this.animations.forEach((M=>{C&&!C(M)||this.xe.addAnimation(M)})),this.animationGroups.forEach((M=>{C&&!C(M)||this.xe.addAnimationGroup(M)})),this.multiMaterials.forEach((M=>{C&&!C(M)||this.xe.addMultiMaterial(M)})),this.materials.forEach((M=>{C&&!C(M)||this.xe.addMaterial(M)})),this.morphTargetManagers.forEach((M=>{C&&!C(M)||this.xe.addMorphTargetManager(M)})),this.geometries.forEach((M=>{C&&!C(M)||this.xe.addGeometry(M)})),this.transformNodes.forEach((x=>{C&&!C(x)||(this.xe.addTransformNode(x),M.push(x))})),this.actionManagers.forEach((M=>{C&&!C(M)||this.xe.addActionManager(M)})),this.textures.forEach((M=>{C&&!C(M)||this.xe.addTexture(M)})),this.reflectionProbes.forEach((M=>{C&&!C(M)||this.xe.addReflectionProbe(M)}));for(const x of M)x.parent&&-1===this.xe.getNodes().indexOf(x.parent)&&(x.setParent?x.setParent(null):x.parent=null)}removeAllFromScene(){this._isValidHierarchy()||T.i.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.xe.environmentTexture&&(this.xe.environmentTexture=null);for(const C of this.xe._serializableComponents)C.removeFromContainer(this)}removeFromScene(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.cameras.forEach((M=>{C&&!C(M)||this.xe.removeCamera(M)})),this.lights.forEach((M=>{C&&!C(M)||this.xe.removeLight(M)})),this.meshes.forEach((M=>{C&&!C(M)||this.xe.Ae(M,!0)})),this.skeletons.forEach((M=>{C&&!C(M)||this.xe.removeSkeleton(M)})),this.animations.forEach((M=>{C&&!C(M)||this.xe.removeAnimation(M)})),this.animationGroups.forEach((M=>{C&&!C(M)||this.xe.removeAnimationGroup(M)})),this.multiMaterials.forEach((M=>{C&&!C(M)||this.xe.removeMultiMaterial(M)})),this.materials.forEach((M=>{C&&!C(M)||this.xe.removeMaterial(M)})),this.morphTargetManagers.forEach((M=>{C&&!C(M)||this.xe.removeMorphTargetManager(M)})),this.geometries.forEach((M=>{C&&!C(M)||this.xe.removeGeometry(M)})),this.transformNodes.forEach((M=>{C&&!C(M)||this.xe.removeTransformNode(M)})),this.actionManagers.forEach((M=>{C&&!C(M)||this.xe.removeActionManager(M)})),this.textures.forEach((M=>{C&&!C(M)||this.xe.removeTexture(M)})),this.reflectionProbes.forEach((M=>{C&&!C(M)||this.xe.removeReflectionProbe(M)}))}dispose(){this.cameras.slice(0).forEach((C=>{C.dispose()})),this.cameras.length=0,this.lights.slice(0).forEach((C=>{C.dispose()})),this.lights.length=0,this.meshes.slice(0).forEach((C=>{C.dispose()})),this.meshes.length=0,this.skeletons.slice(0).forEach((C=>{C.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((C=>{C.dispose()})),this.animationGroups.length=0,this.multiMaterials.slice(0).forEach((C=>{C.dispose()})),this.multiMaterials.length=0,this.materials.slice(0).forEach((C=>{C.dispose()})),this.materials.length=0,this.geometries.slice(0).forEach((C=>{C.dispose()})),this.geometries.length=0,this.transformNodes.slice(0).forEach((C=>{C.dispose()})),this.transformNodes.length=0,this.actionManagers.slice(0).forEach((C=>{C.dispose()})),this.actionManagers.length=0,this.textures.slice(0).forEach((C=>{C.dispose()})),this.textures.length=0,this.reflectionProbes.slice(0).forEach((C=>{C.dispose()})),this.reflectionProbes.length=0,this.morphTargetManagers.slice(0).forEach((C=>{C.dispose()})),this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const C of this.xe._serializableComponents)C.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.xe.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(C,M,x){if(C&&M)for(const f of C){let C=!0;if(x)for(const M of x)if(f===M){C=!1;break}C&&(M.push(f),f._parentContainer=this)}}moveAllFromScene(C){this._wasAddedToScene=!1,void 0===C&&(C=new D);for(const M in this)Object.prototype.hasOwnProperty.call(this,M)&&(this[M]=this[M]||("_environmentTexture"===M?null:[]),this._moveAssets(this.xe[M],this[M],C[M]));this.environmentTexture=this.xe.environmentTexture,this.removeAllFromScene()}createRootMesh(){const C=new s.d("assetContainerRootMesh",this.xe);return this.meshes.forEach((M=>{M.parent||C.addChild(M)})),this.meshes.unshift(C),C}mergeAnimationsTo(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:V.c.LastCreatedScene,M=arguments.length>1?arguments[1]:void 0,x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!C)return Q.e.Error("No scene available to merge animations to"),[];const f=x||(M=>{let x=null;const f=M.animations.length?M.animations[0].targetProperty:"",T=M.name.split(".").join("").split("_primitive")[0];switch(f){case"position":case"rotationQuaternion":x=C.getTransformNodeByName(M.name)||C.getTransformNodeByName(T);break;case"influence":x=C.getMorphTargetByName(M.name)||C.getMorphTargetByName(T);break;default:x=C.getNodeByName(M.name)||C.getNodeByName(T)}return x});this.getNodes().forEach((C=>{const M=f(C);if(null!==M){for(const x of C.animations){const C=M.animations.filter((C=>C.targetProperty===x.targetProperty));for(const x of C){const C=M.animations.indexOf(x,0);C>-1&&M.animations.splice(C,1)}}M.animations=M.animations.concat(C.animations)}}));const T=[];return this.animationGroups.slice().forEach((C=>{T.push(C.clone(C.name,f)),C.animatables.forEach((C=>{C.stop()}))})),M.forEach((M=>{const x=f(M.target);x&&(C.beginAnimation(x,M.fromFrame,M.toFrame,M.loopAnimation,M.speedRatio,M.onAnimationEnd?M.onAnimationEnd:void 0,void 0,!0,void 0,M.onAnimationLoop?M.onAnimationLoop:void 0),C.stopAnimation(M.target))})),T}populateRootNodes(){this.rootNodes.length=0,this.meshes.forEach((C=>{C.parent||-1!==this.rootNodes.indexOf(C)||this.rootNodes.push(C)})),this.transformNodes.forEach((C=>{C.parent||-1!==this.rootNodes.indexOf(C)||this.rootNodes.push(C)})),this.lights.forEach((C=>{C.parent||-1!==this.rootNodes.indexOf(C)||this.rootNodes.push(C)})),this.cameras.forEach((C=>{C.parent||-1!==this.rootNodes.indexOf(C)||this.rootNodes.push(C)}))}addAllAssetsToContainer(C){if(!C)return;const M=[],x=new Set;for(M.push(C);M.length>0;){const C=M.pop();if(C instanceof s.d?(C.Ee&&-1===this.geometries.indexOf(C.Ee)&&this.geometries.push(C.Ee),this.meshes.push(C)):C instanceof S.e?this.transformNodes.push(C):C instanceof U.c?this.lights.push(C):C instanceof O.c&&this.cameras.push(C),C instanceof m.b){if(C.material&&-1===this.materials.indexOf(C.material)){this.materials.push(C.material);for(const M of C.material.getActiveTextures())-1===this.textures.indexOf(M)&&this.textures.push(M)}C.skeleton&&-1===this.skeletons.indexOf(C.skeleton)&&this.skeletons.push(C.skeleton),C.morphTargetManager&&-1===this.morphTargetManagers.indexOf(C.morphTargetManager)&&this.morphTargetManagers.push(C.morphTargetManager)}for(const f of C.getChildren())x.has(f)||M.push(f);x.add(C)}this.populateRootNodes()}}var t=x(1056);class A{constructor(C){this.byteOffset=0,this.buffer=C}loadAsync(C){return this.buffer.readAsync(this.byteOffset,C).then((C=>{this._dataView=new DataView(C.buffer,C.byteOffset,C.byteLength),this._dataByteOffset=0}))}readUint32(){const C=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,C}readUint8Array(C){const M=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,C);return this._dataByteOffset+=C,this.byteOffset+=C,M}readString(C){return(0,t.i)(this.readUint8Array(C))}skipBytes(C){this._dataByteOffset+=C,this.byteOffset+=C}}var H=x(12364);const j="Z2xURg",b={name:"gj",extensions:{".gltf":{isBinary:!1},".glb":{isBinary:!0}},canDirectLoad:C=>-1!==C.indexOf("asset")&&-1!==C.indexOf("version")||C.startsWith("data:base64,"+j)||C.startsWith("data:;base64,"+j)||C.startsWith("data:application/octet-stream;base64,"+j)||C.startsWith("data:model/gltf-binary;base64,"+j)};var R,n,I,X=x(1035),g=x(1052);function B(C,M,x){try{return Promise.resolve(new Uint8Array(C,M,x))}catch(f){return Promise.reject(f)}}!function(C){C[C.AUTO=0]="AUTO",C[C.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(R||(R={})),function(C){C[C.NONE=0]="NONE",C[C.FIRST=1]="FIRST",C[C.ALL=2]="ALL"}(n||(n={})),function(C){C[C.LOADING=0]="LOADING",C[C.READY=1]="READY",C[C.COMPLETE=2]="COMPLETE"}(I||(I={}));class F{constructor(){this.coordinateSystemMode=R.AUTO,this.animationStartMode=n.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=C=>Promise.resolve(C),this.extensionOptions={}}p(C){C&&(this.onParsed=C.onParsed,this.coordinateSystemMode=C.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=C.animationStartMode??this.animationStartMode,this.loadNodeAnimations=C.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=C.loadSkins??this.loadSkins,this.loadMorphTargets=C.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=C.compileMaterials??this.compileMaterials,this.useClipPlane=C.useClipPlane??this.useClipPlane,this.compileShadowGenerators=C.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=C.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=C.useRangeRequests??this.useRangeRequests,this.createInstances=C.createInstances??this.createInstances,this.alwaysComputeBoundingBox=C.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=C.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=C.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=C.skipMaterials??this.skipMaterials,this.useSRGBBuffers=C.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=C.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=C.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=C.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=C.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=C.customRootNode,this.onMeshLoaded=C.onMeshLoaded,this.onSkinLoaded=C.onSkinLoaded,this.onTextureLoaded=C.onTextureLoaded,this.onMaterialLoaded=C.onMaterialLoaded,this.onCameraLoaded=C.onCameraLoaded,this.extensionOptions=C.extensionOptions??this.extensionOptions)}}class P extends F{constructor(C){super(),this.onParsedObservable=new f.c,this.onMeshLoadedObservable=new f.c,this.onSkinLoadedObservable=new f.c,this.onTextureLoadedObservable=new f.c,this.onMaterialLoadedObservable=new f.c,this.onCameraLoadedObservable=new f.c,this.onCompleteObservable=new f.c,this.onErrorObservable=new f.c,this.Sd=new f.c,this.onExtensionLoadedObservable=new f.c,this.validate=!1,this.onValidatedObservable=new f.c,this._loader=null,this._state=null,this._requests=new Array,this.name=b.name,this.extensions=b.extensions,this.onLoaderStateChangedObservable=new f.c,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.p(C)}set onParsed(C){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),C&&(this._onParsedObserver=this.onParsedObservable.add(C))}set onMeshLoaded(C){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),C&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(C))}set onSkinLoaded(C){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),C&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((M=>C(M.node,M.skinnedNode))))}set onTextureLoaded(C){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),C&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(C))}set onMaterialLoaded(C){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),C&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(C))}set onCameraLoaded(C){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),C&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(C))}set onComplete(C){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(C)}set onError(C){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(C)}set onDispose(C){this._onDisposeObserver&&this.Sd.remove(this._onDisposeObserver),this._onDisposeObserver=this.Sd.add(C)}set onExtensionLoaded(C){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(C)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(C){this._loggingEnabled!==C&&(this._loggingEnabled=C,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(C){this._capturePerformanceCounters!==C&&(this._capturePerformanceCounters=C,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(C){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(C)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const C of this._requests)C.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=C=>Promise.resolve(C),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.Sd.notifyObservers(void 0),this.Sd.clear()}loadFile(C,M,x,z,s,S,m,V){if(ArrayBuffer.isView(M))return this._loadBinary(C,M,x,z,m,V),null;this._progressCallback=s;const y=M.name||T.i.GetFilename(M);if(S){if(this.useRangeRequests){this.validate&&Q.e.Warn("glTF validation is not supported when range requests are enabled");const x={abort:()=>{},onCompleteObservable:new f.c},T={readAsync:(x,f)=>new Promise(((T,z)=>{this._loadFile(C,M,(C=>{T(new Uint8Array(C))}),!0,(C=>{z(C)}),(C=>{C.setRequestHeader("Range",`bytes=${x}-${x+f-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new A(T)).then((C=>{x.onCompleteObservable.notifyObservers(x),z(C)}),m?C=>m(void 0,C):void 0),x}return this._loadFile(C,M,(M=>{this._validate(C,new Uint8Array(M,0,M.byteLength),x,y),this._unpackBinaryAsync(new A({readAsync:(C,x)=>B(M,C,x),byteLength:M.byteLength})).then((C=>{z(C)}),m?C=>m(void 0,C):void 0)}),!0,m)}return this._loadFile(C,M,(M=>{try{this._validate(C,M,x,y),z({json:this._parseJson(M)})}catch{m&&m()}}),!1,m)}_loadBinary(C,M,x,f,T,z){this._validate(C,new Uint8Array(M.buffer,M.byteOffset,M.byteLength),x,z),this._unpackBinaryAsync(new A({readAsync:(C,x)=>function(C,M,x){try{if(M<0||M>=C.byteLength)throw new RangeError("Offset is out of range.");if(M+x>C.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(C.buffer,C.byteOffset+M,x))}catch(f){return Promise.reject(f)}}(M,C,x),byteLength:M.byteLength})).then((C=>{f(C)}),T?C=>T(void 0,C):void 0)}importMeshAsync(C,M,x,f,T,z){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(x),this.onParsedObservable.clear(),this._log(`Loading ${z||""}`),this._loader=this._getLoader(x),this._loader.importMeshAsync(C,M,null,x,f,T,z))))}loadAsync(C,M,x,f,T){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(M),this.onParsedObservable.clear(),this._log(`Loading ${T||""}`),this._loader=this._getLoader(M),this._loader.loadAsync(C,M,x,f,T))))}loadAssetContainerAsync(C,M,x,f,T){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(M),this.onParsedObservable.clear(),this._log(`Loading ${T||""}`),this._loader=this._getLoader(M);const z=new L(C),s=[];this.onMaterialLoadedObservable.add((C=>{s.push(C)}));const S=[];this.onTextureLoadedObservable.add((C=>{S.push(C)}));const m=[];this.onCameraLoadedObservable.add((C=>{m.push(C)}));const Q=[];return this.onMeshLoadedObservable.add((C=>{C.morphTargetManager&&Q.push(C.morphTargetManager)})),this._loader.importMeshAsync(null,C,z,M,x,f,T).then((C=>(Array.prototype.push.apply(z.geometries,C.geometries),Array.prototype.push.apply(z.meshes,C.meshes),Array.prototype.push.apply(z.te,C.te),Array.prototype.push.apply(z.skeletons,C.skeletons),Array.prototype.push.apply(z.animationGroups,C.animationGroups),Array.prototype.push.apply(z.materials,s),Array.prototype.push.apply(z.textures,S),Array.prototype.push.apply(z.lights,C.lights),Array.prototype.push.apply(z.transformNodes,C.transformNodes),Array.prototype.push.apply(z.cameras,m),Array.prototype.push.apply(z.morphTargetManagers,Q),z)))}))}canDirectLoad(C){return b.canDirectLoad(C)}directLoad(C,M){if(M.startsWith("base64,"+j)||M.startsWith(";base64,"+j)||M.startsWith("application/octet-stream;base64,"+j)||M.startsWith("model/gltf-binary;base64,"+j)){const x=(0,X.b)(M);return this._validate(C,new Uint8Array(x,0,x.byteLength)),this._unpackBinaryAsync(new A({readAsync:(C,M)=>B(x,C,M),byteLength:x.byteLength}))}return this._validate(C,M),Promise.resolve({json:this._parseJson(M)})}createPlugin(C){return new P(C[b.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((C,M)=>{this.onCompleteObservable.addOnce((()=>{C()})),this.onErrorObservable.addOnce((C=>{M(C)}))}))}_setState(C){this._state!==C&&(this._state=C,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(I[this._state]))}_loadFile(C,M,x,f,T,z){const s=C._loadFile(M,x,(C=>{this._onProgress(C,s)}),!0,f,T,z);return s.onCompleteObservable.add((()=>{s._lengthComputable=!0,s._total=s._loaded})),this._requests.push(s),s}_onProgress(C,M){if(!this._progressCallback)return;M._lengthComputable=C.lengthComputable,M._loaded=C.loaded,M._total=C.total;let x=!0,f=0,T=0;for(const z of this._requests){if(void 0===z._lengthComputable||void 0===z._loaded||void 0===z._total)return;x=x&&z._lengthComputable,f+=z._loaded,T+=z._total}this._progressCallback({lengthComputable:x,loaded:f,total:x?T:0})}_validate(C,M){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),H.e.ValidateAsync(M,x,f,(M=>this.preprocessUrlAsync(x+M).then((M=>C._loadFileAsync(M,void 0,!0,!0).then((C=>new Uint8Array(C,0,C.byteLength))))))).then((C=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(C),this.onValidatedObservable.clear()}),(C=>{this._endPerformanceCounter("Validate JSON"),T.i.Warn(`Failed to validate: ${C.message}`),this.onValidatedObservable.clear()})))}_getLoader(C){const M=C.json.asset||{};this._log(`Asset version: ${M.version}`),M.minVersion&&this._log(`Asset minimum version: ${M.minVersion}`),M.generator&&this._log(`Asset generator: ${M.generator}`);const x=P._parseVersion(M.version);if(!x)throw new Error("Invalid version: "+M.version);if(void 0!==M.minVersion){const C=P._parseVersion(M.minVersion);if(!C)throw new Error("Invalid minimum version: "+M.minVersion);if(P._compareVersion(C,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+M.minVersion)}const f={1:P._CreateGLTF1Loader,2:P._CreateGLTF2Loader}[x.major];if(!f)throw new Error("Unsupported version: "+M.version);return f(this)}_parseJson(C){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${C.length}`);const M=JSON.parse(C);return this._endPerformanceCounter("Parse JSON"),M}_unpackBinaryAsync(C){return this._startPerformanceCounter("Unpack Binary"),C.loadAsync(20).then((()=>{const M=C.readUint32();if(1179937895!==M)throw new g.g("Unexpected magic: "+M,g.f.GLTFLoaderUnexpectedMagicError);const x=C.readUint32();this.loggingEnabled&&this._log(`Binary version: ${x}`);const f=C.readUint32();let T;switch(this.useRangeRequests||f===C.buffer.byteLength||Q.e.Warn(`Length in header does not match actual data length: ${f} != ${C.buffer.byteLength}`),x){case 1:T=this._unpackBinaryV1Async(C,f);break;case 2:T=this._unpackBinaryV2Async(C,f);break;default:throw new Error("Unsupported version: "+x)}return this._endPerformanceCounter("Unpack Binary"),T}))}_unpackBinaryV1Async(C,M){const x=C.readUint32(),f=C.readUint32();if(0!==f)throw new Error(`Unexpected content format: ${f}`);const T=M-C.byteOffset,z={json:this._parseJson(C.readString(x)),bin:null};if(0!==T){const M=C.byteOffset;z.bin={readAsync:(x,f)=>C.buffer.readAsync(M+x,f),byteLength:T}}return Promise.resolve(z)}_unpackBinaryV2Async(C,M){const x=1313821514,f=5130562,T=C.readUint32();if(C.readUint32()!==x)throw new Error("First chunk format is not JSON");return C.byteOffset+T===M?C.loadAsync(T).then((()=>({json:this._parseJson(C.readString(T)),bin:null}))):C.loadAsync(T+8).then((()=>{const z={json:this._parseJson(C.readString(T)),bin:null},s=()=>{const T=C.readUint32();switch(C.readUint32()){case x:throw new Error("Unexpected JSON chunk");case f:{const M=C.byteOffset;z.bin={readAsync:(x,f)=>C.buffer.readAsync(M+x,f),byteLength:T},C.skipBytes(T);break}default:C.skipBytes(T)}return C.byteOffset!==M?C.loadAsync(8).then(s):Promise.resolve(z)};return s()}))}static _parseVersion(C){if("1.0"===C||"1.0.1"===C)return{major:1,minor:0};const M=(C+"").match(/^(\d+)\.(\d+)/);return M?{major:parseInt(M[1]),minor:parseInt(M[2])}:null}static _compareVersion(C,M){return C.major>M.major?1:C.major<M.major?-1:C.minor>M.minor?1:C.minor<M.minor?-1:0}_logOpen(C){this._log(C),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(C){const M=P._logSpaces.substring(0,2*this._logIndentLevel);Q.e.Log(`${M}${C}`)}_logDisabled(C){}_startPerformanceCounterEnabled(C){T.i.StartPerformanceCounter(C)}_startPerformanceCounterDisabled(C){}_endPerformanceCounterEnabled(C){T.i.EndPerformanceCounter(C)}_endPerformanceCounterDisabled(C){}}P.IncrementalLoading=!0,P.HomogeneousCoordinates=!1,P._logSpaces="                                ",(0,z.g)(new P)},12364:(C,M,x)=>{"use strict";x.d(M,{e:()=>s});var f=x(1192);function T(C,M,x,f){const T={externalResourceFunction:f};return x&&(T.uri="file:"===M?x:M+x),ArrayBuffer.isView(C)?GLTFValidator.validateBytes(C,T):GLTFValidator.validateString(C,T)}function z(){const C=[];onmessage=M=>{const x=M.data;switch(x.id){case"init":importScripts(x.url);break;case"validate":T(x.data,x.rootUrl,x.fileName,(M=>new Promise(((x,f)=>{const T=C.length;C.push({resolve:x,reject:f}),postMessage({id:"getExternalResource",index:T,uri:M})})))).then((C=>{postMessage({id:"validate.resolve",value:C})}),(C=>{postMessage({id:"validate.reject",reason:C})}));break;case"getExternalResource.resolve":C[x.index].resolve(x.value);break;case"getExternalResource.reject":C[x.index].reject(x.reason)}}}class s{static ValidateAsync(C,M,x,s){return"function"===typeof Worker?new Promise(((S,m)=>{const Q=`${T}(${z})()`,V=URL.createObjectURL(new Blob([Q],{type:"application/javascript"})),y=new Worker(V),U=C=>{y.removeEventListener("error",U),y.removeEventListener("message",O),m(C)},O=C=>{const M=C.data;switch(M.id){case"getExternalResource":s(M.uri).then((C=>{y.postMessage({id:"getExternalResource.resolve",index:M.index,value:C},[C.buffer])}),(C=>{y.postMessage({id:"getExternalResource.reject",index:M.index,reason:C})}));break;case"validate.resolve":y.removeEventListener("error",U),y.removeEventListener("message",O),S(M.value),y.terminate();break;case"validate.reject":y.removeEventListener("error",U),y.removeEventListener("message",O),m(M.reason),y.terminate()}};if(y.addEventListener("error",U),y.addEventListener("message",O),y.postMessage({id:"init",url:f.i.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(C)){const f=C.slice();y.postMessage({id:"validate",data:f,rootUrl:M,fileName:x},[f.buffer])}else y.postMessage({id:"validate",data:C,rootUrl:M,fileName:x})})):(this._LoadScriptPromise||(this._LoadScriptPromise=f.i.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>T(C,M,x,s))))}}s.Configuration={url:`${f.i._DefaultCdnUrl}/gltf_validator.js`}},12730:(C,M,x)=>{"use strict";x.d(M,{e:()=>R});var f=x(951),T=x(959),z=x(1145),s=x(978),S=x(1343),m=x(1350),Q=x(1224),V=x(1190),y=x(997),U=x(1098);x(11267),x(11131),x(11274),x(11053),x(11281),x(11310),x(11314);const O="imageProcessingCompatibility",d="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";U.d.IncludesShadersStore[O]=d;const D="skyPixelShader",o="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";U.d.ShadersStore[D]=o;x(11094),x(11103),x(11184),x(11207),x(11186);const L="skyVertexShader",t="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";U.d.ShadersStore[L]=t;var A=x(1358),H=x(1335),j=x(1329);class b extends S.d{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class R extends m.e{constructor(C,M){super(C,M),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new s.m(0,100,0),this.useSunPosition=!1,this.cameraOffset=s.m.Zero(),this.up=s.m.Up(),this.dithering=!1,this._cameraPosition=s.m.Zero(),this._skyOrientation=new s.h}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(C,M){const x=M._drawWrapper;if(this.isFrozen&&x.effect&&x._wasPreviouslyReady)return!0;M.materialDefines||(M.materialDefines=new b);const f=M.materialDefines,T=this.va();if(this._isReadyForSubMesh(M))return!0;if((0,j.G)(C,T,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,f),(0,j.z)(C,f,!0,!1),f.IMAGEPROCESSINGPOSTPROCESS!==T.imageProcessingConfiguration.applyByPostProcess&&f.markAsMiscDirty(),f.DITHER!==this.dithering&&f.markAsMiscDirty(),f.isDirty){f.markAsProcessed(),T.resetCachedMaterial();const C=new A.e;f.FOG&&C.addFallback(1,"FOG"),f.IMAGEPROCESSINGPOSTPROCESS=T.imageProcessingConfiguration.applyByPostProcess,f.DITHER=this.dithering;const x=[Q.h.PositionKind];f.VERTEXCOLOR&&x.push(Q.h.ColorKind);const z="sky",s=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,H.b)(s);const S=f.toString();M.setEffect(T.getEngine().createEffect(z,x,s,[],S,C,this.onCompiled,this.onError),f,this._materialContext)}return!(!M.effect||!M.effect.isReady())&&(f._renderId=T.getRenderId(),x._wasPreviouslyReady=!0,!0)}bindForSubMesh(C,M,x){const f=this.va(),T=x.materialDefines;if(!T)return;const z=x.effect;if(!z)return;this._activeEffect=z,this.bindOnlyWorldMatrix(C),this._activeEffect.setMatrix("viewProjection",f.getTransformMatrix()),this._mustRebind(f,z,x)&&((0,H.f)(z,this,f),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,j.j)(T,z,f)),f.fogEnabled&&M.applyFog&&f.fogMode!==V.e.FOGMODE_NONE&&this._activeEffect.setMatrix("view",f.getViewMatrix()),(0,j.f)(f,M,this._activeEffect);const S=f.activeCamera;if(S){const C=S.getWorldMatrix();this._cameraPosition.x=C.m[12],this._cameraPosition.y=C.m[13],this._cameraPosition.z=C.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const C=Math.PI*(this.inclination-.5),M=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(M)*Math.cos(C),this.sunPosition.y=this.distance*Math.sin(-C),this.sunPosition.z=this.distance*Math.sin(M)*Math.cos(C),s.h.FromUnitVectorsToRef(s.m.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(M,this._activeEffect,x)}getAnimatables(){return[]}dispose(C){super.dispose(C)}clone(C){return z.e.Clone((()=>new R(C,this.va())),this)}serialize(){const C=super.serialize();return C.customType="BABYLON.SkyMaterial",C}getClassName(){return"SkyMaterial"}static Parse(C,M,x){return z.e.Parse((()=>new R(C.name,M)),C,M,x)}}(0,f.e)([(0,T.J)()],R.prototype,"luminance",void 0),(0,f.e)([(0,T.J)()],R.prototype,"turbidity",void 0),(0,f.e)([(0,T.J)()],R.prototype,"rayleigh",void 0),(0,f.e)([(0,T.J)()],R.prototype,"mieCoefficient",void 0),(0,f.e)([(0,T.J)()],R.prototype,"mieDirectionalG",void 0),(0,f.e)([(0,T.J)()],R.prototype,"distance",void 0),(0,f.e)([(0,T.J)()],R.prototype,"inclination",void 0),(0,f.e)([(0,T.J)()],R.prototype,"azimuth",void 0),(0,f.e)([(0,T.H)()],R.prototype,"sunPosition",void 0),(0,f.e)([(0,T.J)()],R.prototype,"useSunPosition",void 0),(0,f.e)([(0,T.H)()],R.prototype,"cameraOffset",void 0),(0,f.e)([(0,T.H)()],R.prototype,"up",void 0),(0,f.e)([(0,T.J)()],R.prototype,"dithering",void 0),(0,y.f)("BABYLON.SkyMaterial",R)},11444:(C,M,x)=>{"use strict";function f(C,M){M.headers=C.headers||{},M.statusMessage=C.statusText,M.statusCode=C.status,M.data=C.response}function T(C,M,x){return new Promise((function(T,z){x=x||{};var s,S,m,Q=new XMLHttpRequest,V=x.body,y=x.headers||{};for(s in x.timeout&&(Q.timeout=x.timeout),Q.ontimeout=Q.onerror=function(C){C.timeout="timeout"==C.type,z(C)},Q.open(C,M.href||M),Q.onload=function(){for(m=Q.getAllResponseHeaders().trim().split(/[\r\n]+/),f(Q,Q);S=m.shift();)S=S.split(": "),Q.headers[S.shift().toLowerCase()]=S.join(": ");if((S=Q.headers["content-type"])&&~S.indexOf("application/json"))try{Q.data=JSON.parse(Q.data,x.reviver)}catch(C){return f(Q,C),z(C)}(Q.status>=400?z:T)(Q)},typeof FormData<"u"&&V instanceof FormData||V&&"object"==typeof V&&(y["content-type"]="application/json",V=JSON.stringify(V)),Q.withCredentials=!!x.withCredentials,y)Q.setRequestHeader(s,y[s]);Q.send(V)}))}x.r(M),x.d(M,{del:()=>m,get:()=>z,patch:()=>S,post:()=>s,put:()=>Q,send:()=>T});var z=T.bind(T,"GET"),s=T.bind(T,"POST"),S=T.bind(T,"PATCH"),m=T.bind(T,"DELETE"),Q=T.bind(T,"PUT")},12838:(C,M,x)=>{"use strict";x.d(M,{b:()=>y});const f=.5*(Math.sqrt(3)-1),T=(3-Math.sqrt(3))/6,z=1/3,s=1/6,S=(Math.sqrt(5)-1)/4,m=(5-Math.sqrt(5))/20,Q=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),V=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const y=class{constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const M="function"==typeof C?C:function(C){let M=0,x=0,f=0,T=1;const z=function(){let C=4022871197;return function(M){M=M.toString();for(let x=0;x<M.length;x++){C+=M.charCodeAt(x);let f=.02519603282416938*C;C=f>>>0,f-=C,f*=C,C=f>>>0,f-=C,C+=4294967296*f}return 2.3283064365386963e-10*(C>>>0)}}();M=z(" "),x=z(" "),f=z(" "),M-=z(C),M<0&&(M+=1);x-=z(C),x<0&&(x+=1);f-=z(C),f<0&&(f+=1);return function(){const C=2091639*M+2.3283064365386963e-10*T;return M=x,x=f,f=C-(T=0|C)}}(C);this.p=function(C){const M=new Uint8Array(256);for(let x=0;x<256;x++)M[x]=x;for(let x=0;x<255;x++){const f=x+~~(C()*(256-x)),T=M[x];M[x]=M[f],M[f]=T}return M}(M),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let x=0;x<512;x++)this.perm[x]=this.p[255&x],this.permMod12[x]=this.perm[x]%12}noise2D(C,M){const x=this.permMod12,z=this.perm;let s=0,S=0,m=0;const V=(C+M)*f,y=Math.floor(C+V),U=Math.floor(M+V),O=(y+U)*T,d=C-(y-O),D=M-(U-O);let o,L;d>D?(o=1,L=0):(o=0,L=1);const t=d-o+T,A=D-L+T,H=d-1+2*T,j=D-1+2*T,b=255&y,R=255&U;let n=.5-d*d-D*D;if(n>=0){const C=3*x[b+z[R]];n*=n,s=n*n*(Q[C]*d+Q[C+1]*D)}let I=.5-t*t-A*A;if(I>=0){const C=3*x[b+o+z[R+L]];I*=I,S=I*I*(Q[C]*t+Q[C+1]*A)}let X=.5-H*H-j*j;if(X>=0){const C=3*x[b+1+z[R+1]];X*=X,m=X*X*(Q[C]*H+Q[C+1]*j)}return 70*(s+S+m)}noise3D(C,M,x){const f=this.permMod12,T=this.perm;let S,m,V,y;const U=(C+M+x)*z,O=Math.floor(C+U),d=Math.floor(M+U),D=Math.floor(x+U),o=(O+d+D)*s,L=C-(O-o),t=M-(d-o),A=x-(D-o);let H,j,b,R,n,I;L>=t?t>=A?(H=1,j=0,b=0,R=1,n=1,I=0):L>=A?(H=1,j=0,b=0,R=1,n=0,I=1):(H=0,j=0,b=1,R=1,n=0,I=1):t<A?(H=0,j=0,b=1,R=0,n=1,I=1):L<A?(H=0,j=1,b=0,R=0,n=1,I=1):(H=0,j=1,b=0,R=1,n=1,I=0);const X=L-H+s,g=t-j+s,B=A-b+s,F=L-R+2*s,P=t-n+2*s,h=A-I+2*s,c=L-1+.5,q=t-1+.5,i=A-1+.5,Z=255&O,E=255&d,K=255&D;let G=.6-L*L-t*t-A*A;if(G<0)S=0;else{const C=3*f[Z+T[E+T[K]]];G*=G,S=G*G*(Q[C]*L+Q[C+1]*t+Q[C+2]*A)}let a=.6-X*X-g*g-B*B;if(a<0)m=0;else{const C=3*f[Z+H+T[E+j+T[K+b]]];a*=a,m=a*a*(Q[C]*X+Q[C+1]*g+Q[C+2]*B)}let J=.6-F*F-P*P-h*h;if(J<0)V=0;else{const C=3*f[Z+R+T[E+n+T[K+I]]];J*=J,V=J*J*(Q[C]*F+Q[C+1]*P+Q[C+2]*h)}let N=.6-c*c-q*q-i*i;if(N<0)y=0;else{const C=3*f[Z+1+T[E+1+T[K+1]]];N*=N,y=N*N*(Q[C]*c+Q[C+1]*q+Q[C+2]*i)}return 32*(S+m+V+y)}noise4D(C,M,x,f){const T=this.perm;let z,s,Q,y,U;const O=(C+M+x+f)*S,d=Math.floor(C+O),D=Math.floor(M+O),o=Math.floor(x+O),L=Math.floor(f+O),t=(d+D+o+L)*m,A=C-(d-t),H=M-(D-t),j=x-(o-t),b=f-(L-t);let R=0,n=0,I=0,X=0;A>H?R++:n++,A>j?R++:I++,A>b?R++:X++,H>j?n++:I++,H>b?n++:X++,j>b?I++:X++;const g=R>=3?1:0,B=n>=3?1:0,F=I>=3?1:0,P=X>=3?1:0,h=R>=2?1:0,c=n>=2?1:0,q=I>=2?1:0,i=X>=2?1:0,Z=R>=1?1:0,E=n>=1?1:0,K=I>=1?1:0,G=X>=1?1:0,a=A-g+m,J=H-B+m,N=j-F+m,k=b-P+m,v=A-h+2*m,p=H-c+2*m,u=j-q+2*m,Y=b-i+2*m,W=A-Z+3*m,e=H-E+3*m,r=j-K+3*m,w=b-G+3*m,l=A-1+4*m,CC=H-1+4*m,MC=j-1+4*m,xC=b-1+4*m,fC=255&d,TC=255&D,zC=255&o,sC=255&L;let SC=.6-A*A-H*H-j*j-b*b;if(SC<0)z=0;else{const C=T[fC+T[TC+T[zC+T[sC]]]]%32*4;SC*=SC,z=SC*SC*(V[C]*A+V[C+1]*H+V[C+2]*j+V[C+3]*b)}let mC=.6-a*a-J*J-N*N-k*k;if(mC<0)s=0;else{const C=T[fC+g+T[TC+B+T[zC+F+T[sC+P]]]]%32*4;mC*=mC,s=mC*mC*(V[C]*a+V[C+1]*J+V[C+2]*N+V[C+3]*k)}let QC=.6-v*v-p*p-u*u-Y*Y;if(QC<0)Q=0;else{const C=T[fC+h+T[TC+c+T[zC+q+T[sC+i]]]]%32*4;QC*=QC,Q=QC*QC*(V[C]*v+V[C+1]*p+V[C+2]*u+V[C+3]*Y)}let VC=.6-W*W-e*e-r*r-w*w;if(VC<0)y=0;else{const C=T[fC+Z+T[TC+E+T[zC+K+T[sC+G]]]]%32*4;VC*=VC,y=VC*VC*(V[C]*W+V[C+1]*e+V[C+2]*r+V[C+3]*w)}let yC=.6-l*l-CC*CC-MC*MC-xC*xC;if(yC<0)U=0;else{const C=T[fC+1+T[TC+1+T[zC+1+T[sC+1]]]]%32*4;yC*=yC,U=yC*yC*(V[C]*l+V[C+1]*CC+V[C+2]*MC+V[C+3]*xC)}return 27*(z+s+Q+y+U)}}}}]);