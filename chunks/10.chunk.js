/*! For license information please see hs4cjh.10.0af49f54.chunk.js.LICENSE.txt */
(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[10],{12499:(t,b,Y)=>{"use strict";var o=Y(12505),x=Y(12508),F=Y(12516);Y.g.__TYPEDARRAY_POOL||(Y.g.__TYPEDARRAY_POOL={UINT8:x([32,0]),UINT16:x([32,0]),UINT32:x([32,0]),INT8:x([32,0]),INT16:x([32,0]),INT32:x([32,0]),FLOAT:x([32,0]),DOUBLE:x([32,0]),DATA:x([32,0]),UINT8C:x([32,0]),BUFFER:x([32,0])});var r="undefined"!==typeof Uint8ClampedArray,R=Y.g.__TYPEDARRAY_POOL;R.UINT8C||(R.UINT8C=x([32,0])),R.BUFFER||(R.BUFFER=x([32,0]));var d=R.DATA,E=R.BUFFER;function U(t){if(t){var b=t.length||t.byteLength,Y=o.log2(b);d[Y].push(t)}}function C(t){t=o.nextPow2(t);var b=o.log2(t),Y=d[b];return Y.length>0?Y.pop():new ArrayBuffer(t)}function p(t){return new Uint8Array(C(t),0,t)}function W(t){return new Uint16Array(C(2*t),0,t)}function T(t){return new Uint32Array(C(4*t),0,t)}function y(t){return new Int8Array(C(t),0,t)}function v(t){return new Int16Array(C(2*t),0,t)}function B(t){return new Int32Array(C(4*t),0,t)}function J(t){return new Float32Array(C(4*t),0,t)}function m(t){return new Float64Array(C(8*t),0,t)}function K(t){return r?new Uint8ClampedArray(C(t),0,t):p(t)}function L(t){return new DataView(C(t),0,t)}b.free=function(t){if(F(t))E[o.log2(t.length)].push(t);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(t)&&(t=t.buffer),!t)return;var b=t.length||t.byteLength,Y=0|o.log2(b);d[Y].push(t)}},b.freeUint8=b.freeUint16=b.freeUint32=b.freeInt8=b.freeInt16=b.freeInt32=b.freeFloat32=b.freeFloat=b.freeFloat64=b.freeDouble=b.freeUint8Clamped=b.freeDataView=function(t){U(t.buffer)},b.freeArrayBuffer=U,b.freeBuffer=function(t){E[o.log2(t.length)].push(t)},b.malloc=function(t,b){if(void 0===b||"arraybuffer"===b)return C(t);switch(b){case"uint8":return p(t);case"uint16":return W(t);case"uint32":return T(t);case"int8":return y(t);case"int16":return v(t);case"int32":return B(t);case"float":case"float32":return J(t);case"double":case"float64":return m(t);case"uint8_clamped":return K(t);case"buffer":throw"Buffer not supported";case"data":case"dataview":return L(t);default:return null}return null},b.mallocArrayBuffer=C,b.mallocUint8=p,b.mallocUint16=W,b.mallocUint32=T,b.mallocInt8=y,b.mallocInt16=v,b.mallocInt32=B,b.mallocFloat32=b.mallocFloat=J,b.mallocFloat64=b.mallocDouble=m,b.mallocUint8Clamped=K,b.mallocDataView=L,b.clearCache=function(){for(var t=0;t<32;++t)R.UINT8[t].length=0,R.UINT16[t].length=0,R.UINT32[t].length=0,R.INT8[t].length=0,R.INT16[t].length=0,R.INT32[t].length=0,R.FLOAT[t].length=0,R.DOUBLE[t].length=0,R.UINT8C[t].length=0,d[t].length=0,E[t].length=0}},12598:(t,b,Y)=>{t.exports=x;var o=Y(12048);function x(t,b){if(!(this instanceof x))return new x(t,b);var Y=o.create();o.add(Y,t,b),this.Xd=o.min(o.create(),t,Y),this.Bh=o.clone(b),this.max=o.max(o.create(),t,Y),this.mag=o.length(this.Bh)}var F=x.prototype;F.width=function(){return this.Bh[0]},F.height=function(){return this.Bh[1]},F.depth=function(){return this.Bh[2]},F.x0=function(){return this.Xd[0]},F.y0=function(){return this.Xd[1]},F.z0=function(){return this.Xd[2]},F.x1=function(){return this.max[0]},F.y1=function(){return this.max[1]},F.z1=function(){return this.max[2]},F.translate=function(t){return o.add(this.max,this.max,t),o.add(this.Xd,this.Xd,t),this},F.setPosition=function(t){return o.add(this.max,t,this.Bh),o.j(this.Xd,t),this},F.expand=function(t){var b=o.create(),Y=o.create();return o.max(b,t.max,this.max),o.min(Y,t.Xd,this.Xd),o.fd(b,b,Y),new x(Y,b)},F.intersects=function(t){return!(t.Xd[0]>this.max[0])&&(!(t.Xd[1]>this.max[1])&&(!(t.Xd[2]>this.max[2])&&(!(t.max[0]<this.Xd[0])&&(!(t.max[1]<this.Xd[1])&&!(t.max[2]<this.Xd[2])))))},F.touches=function(t){var b=this.union(t);return null!==b&&(0==b.width()||0==b.height()||0==b.depth())},F.union=function(t){if(!this.intersects(t))return null;var b=Math.max(t.Xd[0],this.Xd[0]),Y=Math.max(t.Xd[1],this.Xd[1]),o=Math.max(t.Xd[2],this.Xd[2]);return new x([b,Y,o],[Math.min(t.max[0],this.max[0])-b,Math.min(t.max[1],this.max[1])-Y,Math.min(t.max[2],this.max[2])-o])}},12505:(t,b)=>{"use strict";function Y(t){var b=32;return(t&=-t)&&b--,65535&t&&(b-=16),16711935&t&&(b-=8),252645135&t&&(b-=4),858993459&t&&(b-=2),1431655765&t&&(b-=1),b}b.INT_BITS=32,b.INT_MAX=2147483647,b.INT_MIN=-1<<31,b.sign=function(t){return(t>0)-(t<0)},b.abs=function(t){var b=t>>31;return(t^b)-b},b.min=function(t,b){return b^(t^b)&-(t<b)},b.max=function(t,b){return t^(t^b)&-(t<b)},b.isPow2=function(t){return!(t&t-1)&&!!t},b.log2=function(t){var b,Y;return b=(t>65535)<<4,b|=Y=((t>>>=b)>255)<<3,b|=Y=((t>>>=Y)>15)<<2,(b|=Y=((t>>>=Y)>3)<<1)|(t>>>=Y)>>1},b.log10=function(t){return t>=1e9?9:t>=1e8?8:t>=1e7?7:t>=1e6?6:t>=1e5?5:t>=1e4?4:t>=1e3?3:t>=100?2:t>=10?1:0},b.popCount=function(t){return 16843009*((t=(858993459&(t-=t>>>1&1431655765))+(t>>>2&858993459))+(t>>>4)&252645135)>>>24},b.countTrailingZeros=Y,b.nextPow2=function(t){return t+=0===t,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)+1},b.prevPow2=function(t){return t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)-(t>>>1)},b.parity=function(t){return t^=t>>>16,t^=t>>>8,t^=t>>>4,27030>>>(t&=15)&1};var o=new Array(256);!function(t){for(var b=0;b<256;++b){var Y=b,o=b,x=7;for(Y>>>=1;Y;Y>>>=1)o<<=1,o|=1&Y,--x;t[b]=o<<x&255}}(o),b.reverse=function(t){return o[255&t]<<24|o[t>>>8&255]<<16|o[t>>>16&255]<<8|o[t>>>24&255]},b.interleave2=function(t,b){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t&=65535)|t<<8))|t<<4))|t<<2))|t<<1))|(b=1431655765&((b=858993459&((b=252645135&((b=16711935&((b&=65535)|b<<8))|b<<4))|b<<2))|b<<1))<<1},b.deinterleave2=function(t,b){return(t=65535&((t=16711935&((t=252645135&((t=858993459&((t=t>>>b&1431655765)|t>>>1))|t>>>2))|t>>>4))|t>>>16))<<16>>16},b.interleave3=function(t,b,Y){return t=1227133513&((t=3272356035&((t=251719695&((t=4278190335&((t&=1023)|t<<16))|t<<8))|t<<4))|t<<2),(t|=(b=1227133513&((b=3272356035&((b=251719695&((b=4278190335&((b&=1023)|b<<16))|b<<8))|b<<4))|b<<2))<<1)|(Y=1227133513&((Y=3272356035&((Y=251719695&((Y=4278190335&((Y&=1023)|Y<<16))|Y<<8))|Y<<4))|Y<<2))<<2},b.deinterleave3=function(t,b){return(t=1023&((t=4278190335&((t=251719695&((t=3272356035&((t=t>>>b&1227133513)|t>>>2))|t>>>4))|t>>>8))|t>>>16))<<22>>22},b.nextCombination=function(t){var b=t|t-1;return b+1|(~b&-~b)-1>>>Y(t)+1}},12494:(t,b,Y)=>{"use strict";t.exports=function(t,b,Y){switch(arguments.length){case 1:return o=[],E(x=t,x,U,!0),o;case 2:return"function"===typeof b?E(t,t,b,!0):function(t,b){return o=[],E(t,b,U,!1),o}(t,b);case 3:return E(t,b,Y,!1);default:throw new Error("box-intersect: Invalid arguments")}var x};var o,x=Y(12499),F=Y(12522),r=Y(12533);function R(t,b){for(var Y=0;Y<t;++Y)if(!(b[Y]<=b[Y+t]))return!0;return!1}function d(t,b,Y,o){for(var x=0,F=0,r=0,d=t.length;r<d;++r){var E=t[r];if(!R(b,E)){for(var U=0;U<2*b;++U)Y[x++]=E[U];o[F++]=r}}return F}function E(t,b,Y,o){var R=t.length,E=b.length;if(!(R<=0||E<=0)){var U=t[0].length>>>1;if(!(U<=0)){var C,p=x.mallocDouble(2*U*R),W=x.mallocInt32(R);if((R=d(t,U,p,W))>0){if(1===U&&o)F.init(R),C=F.sweepComplete(U,Y,0,R,p,W,0,R,p,W);else{var T=x.mallocDouble(2*U*E),y=x.mallocInt32(E);(E=d(b,U,T,y))>0&&(F.init(R+E),C=1===U?F.sweepBipartite(U,Y,0,R,p,W,0,E,T,y):r(U,Y,o,R,p,W,E,T,y),x.free(T),x.free(y))}x.free(p),x.free(W)}return C}}}function U(t,b){o.push([t,b])}},12538:(t,b)=>{"use strict";var Y="d",o="ax",x="fp",F="es",r="rs",R="re",d="rb",E="bs",U="be",C="bb",p=[Y,o,"vv",r,R,d,"ri",E,U,C,"bi"];function W(t){var b="bruteForce"+(t?"Full":"Partial"),o=[],r=p.slice();t||r.splice(3,0,x);var R=["function "+b+"("+r.join()+"){"];function d(b,x){var r=function(t,b,o){var x="bruteForce"+(t?"Red":"Blue")+(b?"Flip":"")+(o?"Full":""),r=["function ",x,"(",p.join(),"){","var ",F,"=2*",Y,";"],R="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",d="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(o?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return t?r.push(R,"Q",":",d):r.push(d,"Q",":",R),o?r.push("if(y1<x0||x1<y0)continue;"):b?r.push("if(y0<=x0||x1<y0)continue;"):r.push("if(y0<x0||x1<y0)continue;"),r.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),b?r.push("yi,xi"):r.push("xi,yi"),r.push(");if(rv!==void 0)return rv;}}}"),{name:x,code:r.join("")}}(b,x,t);o.push(r.code),R.push("return "+r.name+"("+p.join()+");")}R.push("if(re-rs>be-bs){"),t?(d(!0,!1),R.push("}else{"),d(!1,!1)):(R.push("if(fp){"),d(!0,!0),R.push("}else{"),d(!0,!1),R.push("}}else{if(fp){"),d(!1,!0),R.push("}else{"),d(!1,!1),R.push("}")),R.push("}}return "+b);var E=o.join("")+R.join("");return new Function(E)()}b.partial=W(!1),b.full=W(!0)},12533:(t,b,Y)=>{"use strict";t.exports=function(t,b,Y,F,U,H,f,n,X){!function(t,b){var Y=8*x.log2(b+1)*(t+1)|0,F=x.nextPow2(K*Y);z.length<F&&(o.free(z),z=o.mallocInt32(F));var r=x.nextPow2(L*Y);S.length<r&&(o.free(S),S=o.mallocDouble(r))}(t,F+f);var Q,N=0,u=2*t;e(N++,0,0,F,0,f,Y?16:0,-1/0,1/0),Y||e(N++,0,0,f,0,F,1,-1/0,1/0);for(;N>0;){var Z=(N-=1)*K,a=z[Z],A=z[Z+1],M=z[Z+2],w=z[Z+3],c=z[Z+4],I=z[Z+5],s=N*L,l=S[s],i=S[s+1],V=1&I,P=!!(16&I),k=U,q=H,O=n,j=X;if(V&&(k=n,q=X,O=U,j=H),!(2&I&&A>=(M=v(t,a,A,M,k,q,i)))&&!(4&I&&(A=B(t,a,A,M,k,q,l))>=M)){var G=M-A,h=c-w;if(P){if(t*G*(G+h)<W){if(void 0!==(Q=d.scanComplete(t,a,b,A,M,k,q,w,c,O,j)))return Q;continue}}else{if(t*Math.min(G,h)<C){if(void 0!==(Q=r(t,a,b,V,A,M,k,q,w,c,O,j)))return Q;continue}if(t*G*h<p){if(void 0!==(Q=d.scanBipartite(t,a,b,V,A,M,k,q,w,c,O,j)))return Q;continue}}var tt=T(t,a,A,M,k,q,l,i);if(A<tt)if(t*(tt-A)<C){if(void 0!==(Q=R(t,a+1,b,A,tt,k,q,w,c,O,j)))return Q}else if(a===t-2){if(void 0!==(Q=V?d.sweepBipartite(t,b,w,c,O,j,A,tt,k,q):d.sweepBipartite(t,b,A,tt,k,q,w,c,O,j)))return Q}else e(N++,a+1,A,tt,w,c,V,-1/0,1/0),e(N++,a+1,w,c,A,tt,1^V,-1/0,1/0);if(tt<M){var bt=E(t,a,w,c,O,j),Yt=O[u*bt+a],ot=y(t,a,bt,c,O,j,Yt);if(ot<c&&e(N++,a,tt,M,ot,c,(4|V)+(P?16:0),Yt,i),w<bt&&e(N++,a,tt,M,w,bt,(2|V)+(P?16:0),l,Yt),bt+1===ot){if(void 0!==(Q=P?D(t,a,b,tt,M,k,q,bt,O,j[bt]):g(t,a,b,V,tt,M,k,q,bt,O,j[bt])))return Q}else if(bt<ot){var xt;if(P){if(tt<(xt=J(t,a,tt,M,k,q,Yt))){var Ft=y(t,a,tt,xt,k,q,Yt);if(a===t-2){if(tt<Ft&&void 0!==(Q=d.sweepComplete(t,b,tt,Ft,k,q,bt,ot,O,j)))return Q;if(Ft<xt&&void 0!==(Q=d.sweepBipartite(t,b,Ft,xt,k,q,bt,ot,O,j)))return Q}else tt<Ft&&e(N++,a+1,tt,Ft,bt,ot,16,-1/0,1/0),Ft<xt&&(e(N++,a+1,Ft,xt,bt,ot,0,-1/0,1/0),e(N++,a+1,bt,ot,Ft,xt,1,-1/0,1/0))}}else tt<(xt=V?m(t,a,tt,M,k,q,Yt):J(t,a,tt,M,k,q,Yt))&&(a===t-2?Q=V?d.sweepBipartite(t,b,bt,ot,O,j,tt,xt,k,q):d.sweepBipartite(t,b,tt,xt,k,q,bt,ot,O,j):(e(N++,a+1,tt,xt,bt,ot,V,-1/0,1/0),e(N++,a+1,bt,ot,tt,xt,1^V,-1/0,1/0)))}}}}};var o=Y(12499),x=Y(12505),F=Y(12538),r=F.partial,R=F.full,d=Y(12522),E=Y(12547),U=Y(12552),C=128,p=1<<22,W=1<<22,T=U("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),y=U("lo===p0",["p0"]),v=U("lo<p0",["p0"]),B=U("hi<=p0",["p0"]),J=U("lo<=p0&&p0<=hi",["p0"]),m=U("lo<p0&&p0<=hi",["p0"]),K=6,L=2,z=o.mallocInt32(1024),S=o.mallocDouble(1024);function e(t,b,Y,o,x,F,r,R,d){var E=K*t;z[E]=b,z[E+1]=Y,z[E+2]=o,z[E+3]=x,z[E+4]=F,z[E+5]=r;var U=L*t;S[U]=R,S[U+1]=d}function g(t,b,Y,o,x,F,r,R,d,E,U){var C=2*t,p=d*C,W=E[p+b];t:for(var T=x,y=x*C;T<F;++T,y+=C){var v=r[y+b],B=r[y+b+t];if(!(W<v||B<W)&&(!o||W!==v)){for(var J,m=R[T],K=b+1;K<t;++K){v=r[y+K],B=r[y+K+t];var L=E[p+K],z=E[p+K+t];if(B<L||z<v)continue t}if(void 0!==(J=o?Y(U,m):Y(m,U)))return J}}}function D(t,b,Y,o,x,F,r,R,d,E){var U=2*t,C=R*U,p=d[C+b];t:for(var W=o,T=o*U;W<x;++W,T+=U){var y=r[W];if(y!==E){var v=F[T+b],B=F[T+b+t];if(!(p<v||B<p)){for(var J=b+1;J<t;++J){v=F[T+J],B=F[T+J+t];var m=d[C+J],K=d[C+J+t];if(B<m||K<v)continue t}var L=Y(y,E);if(void 0!==L)return L}}}}},12547:(t,b,Y)=>{"use strict";t.exports=function(t,b,Y,r,R,d){if(r<=Y+1)return Y;var E=Y,U=r,C=r+Y>>>1,p=2*t,W=C,T=R[p*C+b];for(;E<U;){if(U-E<x){F(t,b,E,U,R,d),T=R[p*C+b];break}var y=U-E,v=Math.random()*y+E|0,B=R[p*v+b],J=Math.random()*y+E|0,m=R[p*J+b],K=Math.random()*y+E|0,L=R[p*K+b];B<=m?L>=m?(W=J,T=m):B>=L?(W=v,T=B):(W=K,T=L):m>=L?(W=J,T=m):L>=B?(W=v,T=B):(W=K,T=L);for(var z=p*(U-1),S=p*W,e=0;e<p;++e,++z,++S){var g=R[z];R[z]=R[S],R[S]=g}var D=d[U-1];d[U-1]=d[W],d[W]=D;for(z=p*(U-1),S=p*(W=o(t,b,E,U-1,R,d,T)),e=0;e<p;++e,++z,++S){g=R[z];R[z]=R[S],R[S]=g}D=d[U-1];if(d[U-1]=d[W],d[W]=D,C<W){for(U=W-1;E<U&&R[p*(U-1)+b]===T;)U-=1;U+=1}else{if(!(W<C))break;for(E=W+1;E<U&&R[p*E+b]===T;)E+=1}}return o(t,b,Y,C,R,d,R[p*C+b])};var o=Y(12552)("lo<p0",["p0"]),x=8;function F(t,b,Y,o,x,F){for(var r=2*t,R=r*(Y+1)+b,d=Y+1;d<o;++d,R+=r)for(var E=x[R],U=d,C=r*(d-1);U>Y&&x[C+b]>E;--U,C-=r){for(var p=C,W=C+r,T=0;T<r;++T,++p,++W){var y=x[p];x[p]=x[W],x[W]=y}var v=F[U];F[U]=F[U-1],F[U-1]=v}}},12552:t=>{"use strict";t.exports=function(t,Y){var o="abcdef".split("").concat(Y),x=[];t.indexOf("lo")>=0&&x.push("lo=e[k+n]");t.indexOf("hi")>=0&&x.push("hi=e[k+o]");return o.push(b.replace("_",x.join()).replace("$",t)),Function.apply(void 0,o)};var b="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},12524:t=>{"use strict";t.exports=function(t,o){o<=4*b?Y(0,o-1,t):E(0,o-1,t)};var b=32;function Y(t,b,Y){for(var o=2*(t+1),x=t+1;x<=b;++x){for(var F=Y[o++],r=Y[o++],R=x,d=o-2;R-- >t;){var E=Y[d-2],U=Y[d-1];if(E<F)break;if(E===F&&U<r)break;Y[d]=E,Y[d+1]=U,d-=2}Y[d]=F,Y[d+1]=r}}function o(t,b,Y){b*=2;var o=Y[t*=2],x=Y[t+1];Y[t]=Y[b],Y[t+1]=Y[b+1],Y[b]=o,Y[b+1]=x}function x(t,b,Y){b*=2,Y[t*=2]=Y[b],Y[t+1]=Y[b+1]}function F(t,b,Y,o){b*=2,Y*=2;var x=o[t*=2],F=o[t+1];o[t]=o[b],o[t+1]=o[b+1],o[b]=o[Y],o[b+1]=o[Y+1],o[Y]=x,o[Y+1]=F}function r(t,b,Y,o,x){b*=2,x[t*=2]=x[b],x[b]=Y,x[t+1]=x[b+1],x[b+1]=o}function R(t,b,Y){b*=2;var o=Y[t*=2],x=Y[b];return!(o<x)&&(o!==x||Y[t+1]>Y[b+1])}function d(t,b,Y,o){var x=o[t*=2];return x<b||x===b&&o[t+1]<Y}function E(t,U,C){var p=(U-t+1)/6|0,W=t+p,T=U-p,y=t+U>>1,v=y-p,B=y+p,J=W,m=v,K=y,L=B,z=T,S=t+1,e=U-1,g=0;R(J,m,C)&&(g=J,J=m,m=g),R(L,z,C)&&(g=L,L=z,z=g),R(J,K,C)&&(g=J,J=K,K=g),R(m,K,C)&&(g=m,m=K,K=g),R(J,L,C)&&(g=J,J=L,L=g),R(K,L,C)&&(g=K,K=L,L=g),R(m,z,C)&&(g=m,m=z,z=g),R(m,K,C)&&(g=m,m=K,K=g),R(L,z,C)&&(g=L,L=z,z=g);for(var D=C[2*m],H=C[2*m+1],f=C[2*L],n=C[2*L+1],X=2*J,Q=2*K,N=2*z,u=2*W,Z=2*y,a=2*T,A=0;A<2;++A){var M=C[X+A],w=C[Q+A],c=C[N+A];C[u+A]=M,C[Z+A]=w,C[a+A]=c}x(v,t,C),x(B,U,C);for(var I=S;I<=e;++I)if(d(I,D,H,C))I!==S&&o(I,S,C),++S;else if(!d(I,f,n,C))for(;;){if(d(e,f,n,C)){d(e,D,H,C)?(F(I,S,e,C),++S,--e):(o(I,e,C),--e);break}if(--e<I)break}r(t,S-1,D,H,C),r(U,e+1,f,n,C),S-2-t<=b?Y(t,S-2,C):E(t,S-2,C),U-(e+2)<=b?Y(e+2,U,C):E(e+2,U,C),e-S<=b?Y(S,e,C):E(S,e,C)}},12522:(t,b,Y)=>{"use strict";t.exports={init:function(t){var b=x.nextPow2(t);d.length<b&&(o.free(d),d=o.mallocInt32(b));E.length<b&&(o.free(E),E=o.mallocInt32(b));U.length<b&&(o.free(U),U=o.mallocInt32(b));C.length<b&&(o.free(C),C=o.mallocInt32(b));p.length<b&&(o.free(p),p=o.mallocInt32(b));W.length<b&&(o.free(W),W=o.mallocInt32(b));var Y=8*b;T.length<Y&&(o.free(T),T=o.mallocDouble(Y))},sweepBipartite:function(t,b,Y,o,x,R,p,W,B,J){for(var m=0,K=2*t,L=t-1,z=K-1,S=Y;S<o;++S){var e=R[S],g=K*S;T[m++]=x[g+L],T[m++]=-(e+1),T[m++]=x[g+z],T[m++]=e}for(S=p;S<W;++S){e=J[S]+r;var D=K*S;T[m++]=B[D+L],T[m++]=-e,T[m++]=B[D+z],T[m++]=e}var H=m>>>1;F(T,H);var f=0,n=0;for(S=0;S<H;++S){var X=0|T[2*S+1];if(X>=r)y(U,C,n--,X=X-r|0);else if(X>=0)y(d,E,f--,X);else if(X<=-r){X=-X-r|0;for(var Q=0;Q<f;++Q){if(void 0!==(N=b(d[Q],X)))return N}v(U,C,n++,X)}else{X=-X-1|0;for(Q=0;Q<n;++Q){var N;if(void 0!==(N=b(X,U[Q])))return N}v(d,E,f++,X)}}},sweepComplete:function(t,b,Y,o,x,r,R,B,J,m){for(var K=0,L=2*t,z=t-1,S=L-1,e=Y;e<o;++e){var g=r[e]+1<<1,D=L*e;T[K++]=x[D+z],T[K++]=-g,T[K++]=x[D+S],T[K++]=g}for(e=R;e<B;++e){g=m[e]+1<<1;var H=L*e;T[K++]=J[H+z],T[K++]=1|-g,T[K++]=J[H+S],T[K++]=1|g}var f=K>>>1;F(T,f);var n=0,X=0,Q=0;for(e=0;e<f;++e){var N=0|T[2*e+1],u=1&N;if(e<f-1&&N>>1===T[2*e+3]>>1&&(u=2,e+=1),N<0){for(var Z=-(N>>1)-1,a=0;a<Q;++a){if(void 0!==(A=b(p[a],Z)))return A}if(0!==u)for(a=0;a<n;++a){if(void 0!==(A=b(d[a],Z)))return A}if(1!==u)for(a=0;a<X;++a){var A;if(void 0!==(A=b(U[a],Z)))return A}0===u?v(d,E,n++,Z):1===u?v(U,C,X++,Z):2===u&&v(p,W,Q++,Z)}else{Z=(N>>1)-1;0===u?y(d,E,n--,Z):1===u?y(U,C,X--,Z):2===u&&y(p,W,Q--,Z)}}},scanBipartite:function(t,b,Y,o,x,R,U,C,p,W,B,J){var m=0,K=2*t,L=b,z=b+t,S=1,e=1;o?e=r:S=r;for(var g=x;g<R;++g){var D=g+S,H=K*g;T[m++]=U[H+L],T[m++]=-D,T[m++]=U[H+z],T[m++]=D}for(g=p;g<W;++g){D=g+e;var f=K*g;T[m++]=B[f+L],T[m++]=-D}var n=m>>>1;F(T,n);var X=0;for(g=0;g<n;++g){var Q=0|T[2*g+1];if(Q<0){var N=!1;if((D=-Q)>=r?(N=!o,D-=r):(N=!!o,D-=1),N)v(d,E,X++,D);else{var u=J[D],Z=K*D,a=B[Z+b+1],A=B[Z+b+1+t];t:for(var M=0;M<X;++M){var w=d[M],c=K*w;if(!(A<U[c+b+1]||U[c+b+1+t]<a)){for(var I=b+2;I<t;++I)if(B[Z+I+t]<U[c+I]||U[c+I+t]<B[Z+I])continue t;var s,l=C[w];if(void 0!==(s=o?Y(u,l):Y(l,u)))return s}}}}else y(d,E,X--,Q-S)}},scanComplete:function(t,b,Y,o,x,R,E,U,C,p,W){for(var y=0,v=2*t,B=b,J=b+t,m=o;m<x;++m){var K=m+r,L=v*m;T[y++]=R[L+B],T[y++]=-K,T[y++]=R[L+J],T[y++]=K}for(m=U;m<C;++m){K=m+1;var z=v*m;T[y++]=p[z+B],T[y++]=-K}var S=y>>>1;F(T,S);var e=0;for(m=0;m<S;++m){var g=0|T[2*m+1];if(g<0){if((K=-g)>=r)d[e++]=K-r;else{var D=W[K-=1],H=v*K,f=p[H+b+1],n=p[H+b+1+t];t:for(var X=0;X<e;++X){var Q=d[X],N=E[Q];if(N===D)break;var u=v*Q;if(!(n<R[u+b+1]||R[u+b+1+t]<f)){for(var Z=b+2;Z<t;++Z)if(p[H+Z+t]<R[u+Z]||R[u+Z+t]<p[H+Z])continue t;var a=Y(N,D);if(void 0!==a)return a}}}}else{for(K=g-r,X=e-1;X>=0;--X)if(d[X]===K){for(Z=X+1;Z<e;++Z)d[Z-1]=d[Z];break}--e}}}};var o=Y(12499),x=Y(12505),F=Y(12524),r=1<<28,R=1024,d=o.mallocInt32(R),E=o.mallocInt32(R),U=o.mallocInt32(R),C=o.mallocInt32(R),p=o.mallocInt32(R),W=o.mallocInt32(R),T=o.mallocDouble(8192);function y(t,b,Y,o){var x=b[o],F=t[Y-1];t[x]=F,b[F]=x}function v(t,b,Y,o){t[Y]=o,b[o]=Y}},12508:t=>{"use strict";function b(t,Y,o){var x=0|t[o];if(x<=0)return[];var F,r=new Array(x);if(o===t.length-1)for(F=0;F<x;++F)r[F]=Y;else for(F=0;F<x;++F)r[F]=b(t,Y,o+1);return r}t.exports=function(t,Y){switch("undefined"===typeof Y&&(Y=0),typeof t){case"number":if(t>0)return function(t,b){var Y,o;for(Y=new Array(t),o=0;o<t;++o)Y[o]=b;return Y}(0|t,Y);break;case"object":if("number"===typeof t.length)return b(t,Y,0)}return[]}},12478:(t,b,Y)=>{t.exports=function(){var t=this;this.components={},this.comps=this.components;var b=this.components,Y=1,x={},F=[],r=[],R={timeout:!1,removals:[],multiComps:[]};function d(t,Y){var o=b[Y],F=x[Y],r=F.hash[t];r&&(F.remove(t),o.ab&&(o.multi?(r.forEach((b=>{b&&o.ab(t,b)})),r.length=0):o.ab(t,r)),R.removals.push(F),E())}function E(){R.timeout||(R.timeout=!0,setTimeout(U,1))}function U(){R.timeout=!1,C()}function C(){R.multiComps.length&&function(t){for(var b=0;b<t.length;b++){var{entID:Y,data:o}=t[b],x=o.hash[Y];if(x){for(var F=0;F<x.length;F++)x[F]||(x.splice(F,1),F--);0===x.length&&(o.remove(Y),R.removals.push(o))}}t.length=0}(R.multiComps),R.removals.length&&function(t){for(var b=0;b<t.length;b++){t[b].flush()}t.length=0}(R.removals)}this.Li=x,this._systems=F,this._renderSystems=r,this.Eh=function(b){var o=Y++;return Array.isArray(b)&&b.forEach((b=>t.zf(o,b))),o},this.deleteEntity=function(b){return Object.keys(x).forEach((t=>{x[t].hash[b]&&d(b,t)})),t},this.Rh=function(t){if(!t)throw new Error("Missing component definition");var Y=t.name;if(!Y)throw new Error("Component definition must have a name property.");if("string"!==typeof Y)throw new Error("Component name must be a string.");if(""===Y)throw new Error("Component name must be a non-empty string.");if(x[Y])throw new Error(`Component ${Y} already exists.`);var R={};return R.name=Y,R.multi=!!t.multi,R.order=isNaN(t.order)?99:t.order,R.stateConstructor=t.stateConstructor||null,R.state=t.state||{},R.Kf=t.Kf||null,R.ab=t.ab||null,R.system=t.system||null,R.Xg=t.Xg||null,b[Y]=R,x[Y]=new o,x[Y]._pendingMultiCleanup=!1,x[Y]._multiCleanupIDs=R.multi?[]:null,R.system&&(F.push(Y),F.sort(((t,Y)=>b[t].order-b[Y].order))),R.Xg&&(r.push(Y),r.sort(((t,Y)=>b[t].order-b[Y].order))),Y},this.overwriteComponent=function(t,Y){var o=b[t];if(!o)throw new Error(`Unknown component: ${t}`);if(!Y)throw new Error("Missing component definition");if(o.name!==Y.name)throw new Error("Overwriting component must use the same name property.");var R={};R.name=t,R.multi=!!Y.multi,R.order=isNaN(Y.order)?99:Y.order,R.state=Y.state||{},R.Kf=Y.Kf||null,R.ab=Y.ab||null,R.system=Y.system||null,R.Xg=Y.Xg||null,b[t]=R,x[t]._pendingMultiCleanup=!1,x[t]._multiCleanupIDs=R.multi?[]:null;var d=F.indexOf(t);R.system&&d<0&&F.push(t),!R.system&&d>=0&&F.splice(d,1),F.sort(((t,Y)=>b[t].order-b[Y].order));var E=r.indexOf(t);R.Xg&&E<0&&r.push(t),!R.Xg&&E>=0&&r.splice(E,1),r.sort(((t,Y)=>b[t].order-b[Y].order));var U=R.state;return this.ah(t).forEach((t=>{for(var b in U)b in t||(t[b]=U[b]);R.Kf&&R.Kf(t.Wg,t)})),t},this.deleteComponent=function(Y){var o=x[Y];if(!o)throw new Error(`Unknown component: ${Y}`);o.flush(),o.list.forEach((t=>{t&&d(t.Wg||t[0].Wg,Y)}));var R=F.indexOf(Y),E=r.indexOf(Y);return R>-1&&F.splice(R,1),E>-1&&r.splice(E,1),x[Y].dispose(),delete x[Y],delete b[Y],t},this.zf=function(t,Y,o){var F,r=b[Y],R=x[Y];if(!R)throw new Error(`Unknown component: ${Y}.`);if(R.hash[t]&&!r.multi)throw new Error(`Entity ${t} already has component: ${Y}.`);if(r.stateConstructor){if(!(F=new r.stateConstructor).hasOwnProperty("Wg"))throw new Error(`Component ${r.name} stateConstructor type does not have property __id`)}else F=Object.assign({},{Wg:t},r.state,o);if(F.Wg=t,r.multi){var d=R.hash[t];d||(d=[],R.add(t,d)),d.push(F)}else R.add(t,F);return r.Kf&&r.Kf(t,F),this},this.Rf=function(t,b){var Y=x[b];if(!Y)throw new Error(`Unknown component: ${b}.`);return!!Y.hash[t]},this.Ff=function(b,Y){if(!x[Y])throw new Error(`Unknown component: ${Y}.`);return d(b,Y),t},this.getState=function(t,b){var Y=x[b];if(!Y)throw new Error(`Unknown component: ${b}.`);return Y.hash[t]},this.ah=function(t){var b=x[t];if(!b)throw new Error(`Unknown component: ${t}.`);return C(),b.list},this.sk=function(t){if(!x[t])throw new Error(`Unknown component: ${t}.`);var b=x[t].hash;return t=>b[t]},this.vk=function(t){if(!x[t])throw new Error(`Unknown component: ${t}.`);var b=x[t].hash;return t=>!!b[t]},this.mf=function(Y){C();for(var o=0;o<F.length;o++){var r=F[o],R=b[r],d=x[r];R.system(Y,d.list),C()}return t},this.render=function(Y){C();for(var o=0;o<r.length;o++){var F=r[o],R=b[F],d=x[F];R.Xg(Y,d.list),C()}return t},this.removeMultiComponent=function(Y,o,F){var r=b[o],d=x[o];if(!d)throw new Error(`Unknown component: ${o}.`);if(!r.multi)throw new Error("removeMultiComponent called on non-multi component");return function(t,b,Y,o){var x=Y.hash[t];if(x){var F=x[o];F&&(x[o]=null,b.ab&&b.ab(t,F),R.multiComps.push({entID:t,data:Y}),E())}}(Y,r,d,F),t}};var o=Y(12481)},12481:t=>{function b(t,b){var Y=t._map[b];if(delete t.hash[b],delete t._map[b],Y===t.list.length-1)t.list.pop();else{var o=t.list.pop();if(t.list[Y]=o,null===o||null===o[0]){var x=t.list.length;for(var F in t._map)if(t._map[F]===x)return void(t._map[F]=Y)}else{var r=o.Wg||o[0].Wg;t._map[r]=Y}}}t.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(t,b){if("number"===typeof this._map[t]){var Y=this._map[t];this.hash[t]=b,this.list[Y]=b}else this._map[t]=this.list.length,this.hash[t]=b,this.list.push(b)}remove(t){var b=this._map[t];this.hash[t]=null,this.list[b]=null,this._pendingRemovals.push(t)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var t=0;t<this._pendingRemovals.length;t++){var Y=this._pendingRemovals[t];null===this.hash[Y]&&b(this,Y)}this._pendingRemovals.length=0}}},12444:t=>{"use strict";var b,Y="object"===typeof Reflect?Reflect:null,o=function(t,b,Y){return Function.prototype.apply.call(t,b,Y)};b=Y&&"function"===typeof Y.ownKeys?Y.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var x=Number.isNaN||function(t){return t!==t};function F(){F.init.call(this)}t.exports=F,t.exports.once=function(t,b){return new Promise((function(Y,o){function x(Y){t.removeListener(b,F),o(Y)}function F(){"function"===typeof t.removeListener&&t.removeListener("error",x),Y([].slice.call(arguments))}y(t,b,F,{once:!0}),"error"!==b&&function(t,b,Y){"function"===typeof t.on&&y(t,"error",b,Y)}(t,x,{once:!0})}))},F.EventEmitter=F,F.prototype._events=void 0,F.prototype._eventsCount=0,F.prototype._maxListeners=void 0;var r=10;function R(t){if("function"!==typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function d(t){return void 0===t._maxListeners?F.defaultMaxListeners:t._maxListeners}function E(t,b,Y,o){var x,F,r,E;if(R(Y),void 0===(F=t._events)?(F=t._events=Object.create(null),t._eventsCount=0):(void 0!==F.newListener&&(t.emit("newListener",b,Y.listener?Y.listener:Y),F=t._events),r=F[b]),void 0===r)r=F[b]=Y,++t._eventsCount;else if("function"===typeof r?r=F[b]=o?[Y,r]:[r,Y]:o?r.unshift(Y):r.push(Y),(x=d(t))>0&&r.length>x&&!r.warned){r.warned=!0;var U=new Error("Possible EventEmitter memory leak detected. "+r.length+" "+String(b)+" listeners added. Use emitter.setMaxListeners() to increase limit");U.name="MaxListenersExceededWarning",U.k=t,U.type=b,U.count=r.length,E=U,console&&console.warn&&console.warn(E)}return t}function U(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function C(t,b,Y){var o={fired:!1,wrapFn:void 0,target:t,type:b,listener:Y},x=U.bind(o);return x.listener=Y,o.wrapFn=x,x}function p(t,b,Y){var o=t._events;if(void 0===o)return[];var x=o[b];return void 0===x?[]:"function"===typeof x?Y?[x.listener||x]:[x]:Y?function(t){for(var b=new Array(t.length),Y=0;Y<b.length;++Y)b[Y]=t[Y].listener||t[Y];return b}(x):T(x,x.length)}function W(t){var b=this._events;if(void 0!==b){var Y=b[t];if("function"===typeof Y)return 1;if(void 0!==Y)return Y.length}return 0}function T(t,b){for(var Y=new Array(b),o=0;o<b;++o)Y[o]=t[o];return Y}function y(t,b,Y,o){if("function"===typeof t.on)o.once?t.once(b,Y):t.on(b,Y);else{if("function"!==typeof t.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t);t.addEventListener(b,(function x(F){o.once&&t.removeEventListener(b,x),Y(F)}))}}Object.defineProperty(F,"defaultMaxListeners",{enumerable:!0,get:function(){return r},set:function(t){if("number"!==typeof t||t<0||x(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");r=t}}),F.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},F.prototype.setMaxListeners=function(t){if("number"!==typeof t||t<0||x(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},F.prototype.getMaxListeners=function(){return d(this)},F.prototype.emit=function(t){for(var b=[],Y=1;Y<arguments.length;Y++)b.push(arguments[Y]);var x="error"===t,F=this._events;if(void 0!==F)x=x&&void 0===F.error;else if(!x)return!1;if(x){var r;if(b.length>0&&(r=b[0]),r instanceof Error)throw r;var R=new Error("Unhandled error."+(r?" ("+r.message+")":""));throw R.context=r,R}var d=F[t];if(void 0===d)return!1;if("function"===typeof d)o(d,this,b);else{var E=d.length,U=T(d,E);for(Y=0;Y<E;++Y)o(U[Y],this,b)}return!0},F.prototype.addListener=function(t,b){return E(this,t,b,!1)},F.prototype.on=F.prototype.addListener,F.prototype.prependListener=function(t,b){return E(this,t,b,!0)},F.prototype.once=function(t,b){return R(b),this.on(t,C(this,t,b)),this},F.prototype.prependOnceListener=function(t,b){return R(b),this.prependListener(t,C(this,t,b)),this},F.prototype.removeListener=function(t,b){var Y,o,x,F,r;if(R(b),void 0===(o=this._events))return this;if(void 0===(Y=o[t]))return this;if(Y===b||Y.listener===b)0===--this._eventsCount?this._events=Object.create(null):(delete o[t],o.removeListener&&this.emit("removeListener",t,Y.listener||b));else if("function"!==typeof Y){for(x=-1,F=Y.length-1;F>=0;F--)if(Y[F]===b||Y[F].listener===b){r=Y[F].listener,x=F;break}if(x<0)return this;0===x?Y.shift():function(t,b){for(;b+1<t.length;b++)t[b]=t[b+1];t.pop()}(Y,x),1===Y.length&&(o[t]=Y[0]),void 0!==o.removeListener&&this.emit("removeListener",t,r||b)}return this},F.prototype.off=F.prototype.removeListener,F.prototype.removeAllListeners=function(t){var b,Y,o;if(void 0===(Y=this._events))return this;if(void 0===Y.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==Y[t]&&(0===--this._eventsCount?this._events=Object.create(null):delete Y[t]),this;if(0===arguments.length){var x,F=Object.keys(Y);for(o=0;o<F.length;++o)"removeListener"!==(x=F[o])&&this.removeAllListeners(x);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(b=Y[t]))this.removeListener(t,b);else if(void 0!==b)for(o=b.length-1;o>=0;o--)this.removeListener(t,b[o]);return this},F.prototype.listeners=function(t){return p(this,t,!0)},F.prototype.rawListeners=function(t){return p(this,t,!1)},F.listenerCount=function(t,b){return"function"===typeof t.listenerCount?t.listenerCount(b):W.call(t,b)},F.prototype.listenerCount=W,F.prototype.eventNames=function(){return this._eventsCount>0?b(this._events):[]}},12725:t=>{"use strict";t.exports=function(t,b,Y,o,x,F){var r=+b[0],R=+b[1],d=+b[2],E=+Y[0],U=+Y[1],C=+Y[2],p=Math.sqrt(E*E+U*U+C*C);if(0===p)throw new Error("Can't raycast along a zero vector");return function(t,b,Y,o,x,F,r,R,d,E){for(var U=0,C=Math.floor,p=0|C(b),W=0|C(Y),T=0|C(o),y=x>0?1:-1,v=F>0?1:-1,B=r>0?1:-1,J=Math.abs(1/x),m=Math.abs(1/F),K=Math.abs(1/r),L=J<1/0?J*(y>0?p+1-b:b-p):1/0,z=m<1/0?m*(v>0?W+1-Y:Y-W):1/0,S=K<1/0?K*(B>0?T+1-o:o-T):1/0,e=-1;U<=R;){var g=t(p,W,T);if(g)return d&&(d[0]=b+U*x,d[1]=Y+U*F,d[2]=o+U*r),E&&(E[0]=E[1]=E[2]=0,0===e&&(E[0]=-y),1===e&&(E[1]=-v),2===e&&(E[2]=-B)),g;L<z?L<S?(p+=y,U=L,L+=J,e=0):(T+=B,U=S,S+=K,e=2):z<S?(W+=v,U=z,z+=m,e=1):(T+=B,U=S,S+=K,e=2)}return d&&(d[0]=b+U*x,d[1]=Y+U*F,d[2]=o+U*r),E&&(E[0]=E[1]=E[2]=0),0}(t,r,R,d,E/=p,U/=p,C/=p,o="undefined"===typeof o?64:+o,x,F)}},12753:(t,b,Y)=>{"use strict";Y.d(b,{d:()=>F});var o=Y(12444);function x(){this.sj=!1,this.stopPropagation=!1,this.tj=!1,this.disabled=!1}class F{constructor(t,b){this.version="0.7.0";var Y=Object.assign({},new x,b||{});this.element=t||document,this.sj=!!Y.sj,this.stopPropagation=!!Y.stopPropagation,this.tj=!!Y.tj,this.disabled=!!Y.disabled,this.filterEvents=(t,b)=>!0,this.down=new o.EventEmitter,this.up=new o.EventEmitter,this.state={},this.Og={dx:0,dy:0,ik:0,Ng:0,jk:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?R(this):document.addEventListener("DOMContentLoaded",(t=>{R(this)}),{once:!0})}bind(t){for(var b=arguments.length,Y=new Array(b>1?b-1:0),o=1;o<b;o++)Y[o-1]=arguments[o];Y.forEach((b=>{var Y=this._keyBindmap[b]||[];Y.includes(t)||(Y.push(t),this._keyBindmap[b]=Y)})),this.state[t]=!!this.state[t],this.pressCount[t]=this.pressCount[t]||0,this.releaseCount[t]=this.releaseCount[t]||0}unbind(t){for(var b in this._keyBindmap){var Y=this._keyBindmap[b],o=Y.indexOf(t);o>-1&&Y.splice(o,1)}}getBindings(){var t={};for(var b in this._keyBindmap){this._keyBindmap[b].forEach((Y=>{t[Y]=t[Y]||[],t[Y].push(b)}))}return t}mf(){r(this.Og),r(this.pressCount),r(this.releaseCount)}}function r(t){for(var b in t)t[b]=0}function R(t){window.addEventListener("keydown",T.bind(null,t,!0),!1),window.addEventListener("keyup",T.bind(null,t,!1),!1);var b={passive:!0};t.element.addEventListener("touchstart",C.bind(void 0,t),{passive:!1}),t.element.addEventListener("touchend",W.bind(void 0,t),b),t.element.addEventListener("mousedown",y.bind(null,t,!0),b),window.document.addEventListener("mouseup",y.bind(null,t,!1),b),t.element.addEventListener("touchmove",v.bind(null,t),b),t.element.addEventListener("mousemove",v.bind(null,t),b),window.PointerEvent,t.element.addEventListener("wheel",B.bind(null,t),b),t.element.addEventListener("contextmenu",J.bind(null,t),!1),window.addEventListener("blur",m.bind(null,t),!1)}var d=0,E=0,U=null;function C(t,b){b.preventDefault(),p(b)}function p(t){let b=!1;for(let Y=0;Y<t.touches.length;++Y)if(t.touches[Y].identifier===U){b=!0;break}if(!b){const b=t.changedTouches[0];d=b.clientX,E=b.clientY,U=b.identifier}}function W(t,b){for(var Y=b.changedTouches,o=0;o<Y.length;++o)Y[o].identifier===U&&(U=null)}function T(t,b,Y){K(Y.code,b,t,Y)}function y(t,b,Y){if("pointerId"in Y)if(b){if(null!==t._touches.currID)return;t._touches.currID=Y.pointerId}else{if(t._touches.currID!==Y.pointerId)return;t._touches.currID=null}return K("Mouse"+("button"in Y?Y.button+1:1),b,t,Y),!1}function v(t,b){var Y=b.movementX||b.mozMovementX||0,o=b.movementY||b.mozMovementY||0;if(b.touches&&0===(Y|o)){var x=function(t){p(t);for(let b=0;b<t.changedTouches.length;++b)if(t.changedTouches[b].identifier==U){const Y=t.changedTouches[b],o=[Y.clientX-d,Y.clientY-E];return d=Y.clientX,E=Y.clientY,o}return console.error(`Did not find touch id ${U}`),[0,0]}(b);Y=x[0],o=x[1]}t.Og.dx+=Y,t.Og.dy+=o}function B(t,b){var Y=1;switch(b.deltaMode){case 0:Y=1;break;case 1:Y=12;break;case 2:Y=t.element.clientHeight||window.innerHeight}t.Og.ik+=(b.deltaX||0)*Y,t.Og.Ng+=(b.deltaY||0)*Y,t.Og.jk+=(b.deltaZ||0)*Y}function J(t,b){if(!t.tj)return b.preventDefault(),!1}function m(t){for(var b in t._keyStates)t._keyStates[b]&&(/^Mouse\d/.test(b)||K(b,!1,t,{code:b,note:"This is a mocked KeyboardEvent made by the 'game-inputs' module",preventDefault:()=>{},stopPropagation:()=>{}}))}function K(t,b,Y,o){var x=Y._keyBindmap[t];x&&(L(Y._keyStates[t],b)&&(Y._keyStates[t]=b,x.forEach((t=>{(!Y.filterEvents||Y.filterEvents(o,t))&&function(t,b,Y,o){var x=b?Y.pressCount:Y.releaseCount;x[t]=(x[t]||0)+1;var F=Y._bindPressCount[t]||0;(F+=b?1:-1)<0&&(F=0);Y._bindPressCount[t]=F;var r=Y.state[t];if(L(r,F)){Y.state[t]=F>0;var R=b?Y.down:Y.up;Y.disabled||R.emit(t,o)}}(t,b,Y,o)}))),"button"in o||(Y.sj&&!o.defaultPrevented&&o.preventDefault(),Y.stopPropagation&&o.stopPropagation()))}function L(t,b){return t?!b:b}},12104:t=>{t.exports=function(t,b,Y){return t[0]=b[0]+Y[0],t[1]=b[1]+Y[1],t[2]=b[2]+Y[2],t}},12063:(t,b,Y)=>{t.exports=function(t,b){var Y=o(t[0],t[1],t[2]),r=o(b[0],b[1],b[2]);x(Y,Y),x(r,r);var R=F(Y,r);return R>1?0:Math.acos(R)};var o=Y(12068),x=Y(12071),F=Y(12075)},12146:t=>{t.exports=function(t,b){return t[0]=Math.ceil(b[0]),t[1]=Math.ceil(b[1]),t[2]=Math.ceil(b[2]),t}},12061:t=>{t.exports=function(t){var b=new Float32Array(3);return b[0]=t[0],b[1]=t[1],b[2]=t[2],b}},12080:t=>{t.exports=function(t,b){return t[0]=b[0],t[1]=b[1],t[2]=b[2],t}},12054:t=>{t.exports=function(){var t=new Float32Array(3);return t[0]=0,t[1]=0,t[2]=0,t}},12222:t=>{t.exports=function(t,b,Y){var o=b[0],x=b[1],F=b[2],r=Y[0],R=Y[1],d=Y[2];return t[0]=x*d-F*R,t[1]=F*r-o*d,t[2]=o*R-x*r,t}},12176:(t,b,Y)=>{t.exports=Y(12168)},12168:t=>{t.exports=function(t,b){var Y=b[0]-t[0],o=b[1]-t[1],x=b[2]-t[2];return Math.sqrt(Y*Y+o*o+x*x)}},12129:(t,b,Y)=>{t.exports=Y(12125)},12125:t=>{t.exports=function(t,b,Y){return t[0]=b[0]/Y[0],t[1]=b[1]/Y[1],t[2]=b[2]/Y[2],t}},12075:t=>{t.exports=function(t,b){return t[0]*b[0]+t[1]*b[1]+t[2]*b[2]}},12050:t=>{t.exports=1e-6},12090:(t,b,Y)=>{t.exports=function(t,b){var Y=t[0],x=t[1],F=t[2],r=b[0],R=b[1],d=b[2];return Math.abs(Y-r)<=o*Math.max(1,Math.abs(Y),Math.abs(r))&&Math.abs(x-R)<=o*Math.max(1,Math.abs(x),Math.abs(R))&&Math.abs(F-d)<=o*Math.max(1,Math.abs(F),Math.abs(d))};var o=Y(12050)},12099:t=>{t.exports=function(t,b){return t[0]===b[0]&&t[1]===b[1]&&t[2]===b[2]}},12142:t=>{t.exports=function(t,b){return t[0]=Math.floor(b[0]),t[1]=Math.floor(b[1]),t[2]=Math.floor(b[2]),t}},12281:(t,b,Y)=>{t.exports=function(t,b,Y,x,F,r){var R,d;b||(b=3);Y||(Y=0);d=x?Math.min(x*b+Y,t.length):t.length;for(R=Y;R<d;R+=b)o[0]=t[R],o[1]=t[R+1],o[2]=t[R+2],F(o,o,r),t[R]=o[0],t[R+1]=o[1],t[R+2]=o[2];return t};var o=Y(12054)()},12068:t=>{t.exports=function(t,b,Y){var o=new Float32Array(3);return o[0]=t,o[1]=b,o[2]=Y,o}},12048:(t,b,Y)=>{t.exports={EPSILON:Y(12050),create:Y(12054),clone:Y(12061),angle:Y(12063),Jd:Y(12068),j:Y(12080),set:Y(12087),equals:Y(12090),exactEquals:Y(12099),add:Y(12104),fd:Y(12106),sub:Y(12112),multiply:Y(12114),mul:Y(12118),divide:Y(12125),div:Y(12129),min:Y(12137),max:Y(12140),floor:Y(12142),ceil:Y(12146),round:Y(12148),scale:Y(12150),Nd:Y(12159),distance:Y(12168),dist:Y(12176),Od:Y(12178),sqrDist:Y(12182),length:Y(12188),len:Y(12193),squaredLength:Y(12201),Qd:Y(12208),negate:Y(12213),inverse:Y(12215),normalize:Y(12071),dot:Y(12075),cross:Y(12222),Ad:Y(12229),random:Y(12237),transformMat4:Y(12244),transformMat3:Y(12250),transformQuat:Y(12258),Rd:Y(12267),Sd:Y(12273),Ud:Y(12279),forEach:Y(12281)}},12215:t=>{t.exports=function(t,b){return t[0]=1/b[0],t[1]=1/b[1],t[2]=1/b[2],t}},12193:(t,b,Y)=>{t.exports=Y(12188)},12188:t=>{t.exports=function(t){var b=t[0],Y=t[1],o=t[2];return Math.sqrt(b*b+Y*Y+o*o)}},12229:t=>{t.exports=function(t,b,Y,o){var x=b[0],F=b[1],r=b[2];return t[0]=x+o*(Y[0]-x),t[1]=F+o*(Y[1]-F),t[2]=r+o*(Y[2]-r),t}},12140:t=>{t.exports=function(t,b,Y){return t[0]=Math.max(b[0],Y[0]),t[1]=Math.max(b[1],Y[1]),t[2]=Math.max(b[2],Y[2]),t}},12137:t=>{t.exports=function(t,b,Y){return t[0]=Math.min(b[0],Y[0]),t[1]=Math.min(b[1],Y[1]),t[2]=Math.min(b[2],Y[2]),t}},12118:(t,b,Y)=>{t.exports=Y(12114)},12114:t=>{t.exports=function(t,b,Y){return t[0]=b[0]*Y[0],t[1]=b[1]*Y[1],t[2]=b[2]*Y[2],t}},12213:t=>{t.exports=function(t,b){return t[0]=-b[0],t[1]=-b[1],t[2]=-b[2],t}},12071:t=>{t.exports=function(t,b){var Y=b[0],o=b[1],x=b[2],F=Y*Y+o*o+x*x;F>0&&(F=1/Math.sqrt(F),t[0]=b[0]*F,t[1]=b[1]*F,t[2]=b[2]*F);return t}},12237:t=>{t.exports=function(t,b){b=b||1;var Y=2*Math.random()*Math.PI,o=2*Math.random()-1,x=Math.sqrt(1-o*o)*b;return t[0]=Math.cos(Y)*x,t[1]=Math.sin(Y)*x,t[2]=o*b,t}},12267:t=>{t.exports=function(t,b,Y,o){var x=Y[1],F=Y[2],r=b[1]-x,R=b[2]-F,d=Math.sin(o),E=Math.cos(o);return t[0]=b[0],t[1]=x+r*E-R*d,t[2]=F+r*d+R*E,t}},12273:t=>{t.exports=function(t,b,Y,o){var x=Y[0],F=Y[2],r=b[0]-x,R=b[2]-F,d=Math.sin(o),E=Math.cos(o);return t[0]=x+R*d+r*E,t[1]=b[1],t[2]=F+R*E-r*d,t}},12279:t=>{t.exports=function(t,b,Y,o){var x=Y[0],F=Y[1],r=b[0]-x,R=b[1]-F,d=Math.sin(o),E=Math.cos(o);return t[0]=x+r*E-R*d,t[1]=F+r*d+R*E,t[2]=b[2],t}},12148:t=>{t.exports=function(t,b){return t[0]=Math.round(b[0]),t[1]=Math.round(b[1]),t[2]=Math.round(b[2]),t}},12150:t=>{t.exports=function(t,b,Y){return t[0]=b[0]*Y,t[1]=b[1]*Y,t[2]=b[2]*Y,t}},12159:t=>{t.exports=function(t,b,Y,o){return t[0]=b[0]+Y[0]*o,t[1]=b[1]+Y[1]*o,t[2]=b[2]+Y[2]*o,t}},12087:t=>{t.exports=function(t,b,Y,o){return t[0]=b,t[1]=Y,t[2]=o,t}},12182:(t,b,Y)=>{t.exports=Y(12178)},12208:(t,b,Y)=>{t.exports=Y(12201)},12178:t=>{t.exports=function(t,b){var Y=b[0]-t[0],o=b[1]-t[1],x=b[2]-t[2];return Y*Y+o*o+x*x}},12201:t=>{t.exports=function(t){var b=t[0],Y=t[1],o=t[2];return b*b+Y*Y+o*o}},12112:(t,b,Y)=>{t.exports=Y(12106)},12106:t=>{t.exports=function(t,b,Y){return t[0]=b[0]-Y[0],t[1]=b[1]-Y[1],t[2]=b[2]-Y[2],t}},12250:t=>{t.exports=function(t,b,Y){var o=b[0],x=b[1],F=b[2];return t[0]=o*Y[0]+x*Y[3]+F*Y[6],t[1]=o*Y[1]+x*Y[4]+F*Y[7],t[2]=o*Y[2]+x*Y[5]+F*Y[8],t}},12244:t=>{t.exports=function(t,b,Y){var o=b[0],x=b[1],F=b[2],r=Y[3]*o+Y[7]*x+Y[11]*F+Y[15];return r=r||1,t[0]=(Y[0]*o+Y[4]*x+Y[8]*F+Y[12])/r,t[1]=(Y[1]*o+Y[5]*x+Y[9]*F+Y[13])/r,t[2]=(Y[2]*o+Y[6]*x+Y[10]*F+Y[14])/r,t}},12258:t=>{t.exports=function(t,b,Y){var o=b[0],x=b[1],F=b[2],r=Y[0],R=Y[1],d=Y[2],E=Y[3],U=E*o+R*F-d*x,C=E*x+d*o-r*F,p=E*F+r*x-R*o,W=-r*o-R*x-d*F;return t[0]=U*E+W*-r+C*-d-p*-R,t[1]=C*E+W*-R+p*-r-U*-d,t[2]=p*E+W*-d+U*-R-C*-r,t}},12463:t=>{"use strict";t.exports=function(t){for(var b=new Array(t),Y=0;Y<t;++Y)b[Y]=Y;return b}},12516:t=>{t.exports=function(t){return null!=t&&null!=t.constructor&&"function"===typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}},12732:(t,b,Y)=>{"use strict";Y.d(b,{e:()=>o});class o{constructor(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.ki=!1,this.li=!1,this.ii=30,this.ji=0,this.ti=!1,this.fullscreen=!1,this.ni=function(t){},this.oi=function(){},this.ri=function(){},this.bb=function(){},this.pi=function(t){},this.onFullscreenChanged=function(t){},E((()=>{!function(t,b){t._nowObject=performance||Date,t._lastTick=0,t._renderAccum=0,t._rt=0,t._frameCB=R.bind(null,t),requestAnimationFrame(t._frameCB),b>0&&(t._intervalCB=r.bind(null,t),t._interval=setInterval(t._intervalCB,Math.max(b,1e3/t.ii/2)))}(this,b),function(t,b){if(!b)return;var Y=!1,o=!1;document.addEventListener("pointerlockchange",(o=>{Y=document.pointerLockElement===b,t.pi(Y)})),document.addEventListener("fullscreenchange",(Y=>{o=document.fullscreenElement===b,t.onFullscreenChanged(o)})),Object.defineProperty(t,"ti",{get:()=>Y,set:t=>{t&&!Y?d(b):Y&&!t&&function(t){t.exitPointerLock&&t.exitPointerLock()}(document)}}),Object.defineProperty(t,"fullscreen",{get:()=>o,set:t=>{t&&!o?b.requestFullscreen():o&&!t&&document.exitFullscreen()}}),b.addEventListener("click",(x=>{t.ki&&!Y&&d(b),t.li&&!o&&b.requestFullscreen()}));var x=()=>t.bb();if(window.ResizeObserver){new ResizeObserver(x).observe(b)}else window.addEventListener("resize",x)}(this,t),this.ri()}))}}var x=3,F=20;function r(t){for(var b=1e3/t.ii,Y=t._nowObject.now()+F,o=0;t._nowObject.now()>=t._lastTick+b&&t._nowObject.now()<Y&&++o<=x;)t.ni(b),t._lastTick+=b;var r=5*(b+5),R=t._nowObject.now();if(R-t._lastTick>r)for(;R>=t._lastTick+b;)t._lastTick+=b}function R(t){requestAnimationFrame(t._frameCB),r(t);var b=t._nowObject.now(),Y=b-t._rt;if(t._rt=b,t.ji>0){t._renderAccum+=Y;var o=1e3/t.ji;if(t._renderAccum<o)return;t._renderAccum=Math.min(t._renderAccum-o,o)}var x=1e3/t.ii,F=(b-t._lastTick)/x;t.oi(Y,F,x)}function d(t){t.requestPointerLock&&t.requestPointerLock()}var E=t=>{if("loading"===document.readyState){var b=()=>{document.removeEventListener("readystatechange",b),t()};document.addEventListener("readystatechange",b)}else setTimeout(t,1)}},12457:(t,b,Y)=>{var o=Y(12463),x=Y(12466),F="undefined"!==typeof Float64Array;function r(t,b){return t[0]-b[0]}function R(){var t,b=this.stride,Y=new Array(b.length);for(t=0;t<Y.length;++t)Y[t]=[Math.abs(b[t]),t];Y.sort(r);var o=new Array(Y.length);for(t=0;t<o.length;++t)o[t]=Y[t][1];return o}function d(t,b){var Y=["View",b,"d",t].join("");b<0&&(Y="View_Nil"+t);var x="generic"===t;if(-1===b){var F="function "+Y+"(a){this.data=a;};var proto="+Y+".prototype;proto.dtype='"+t+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+Y+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+Y+"(a){return new "+Y+"(a);}";return new Function(F)()}if(0===b){F="function "+Y+"(a,d) {this.data = a;this.offset = d};var proto="+Y+".prototype;proto.dtype='"+t+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+Y+"_copy() {return new "+Y+"(this.data,this.offset)};proto.pick=function "+Y+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+Y+"_get(){return "+(x?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+Y+"_set(v){return "+(x?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+Y+"(a,b,c,d){return new "+Y+"(a,d)}";return new Function("TrivialArray",F)(E[t][0])}F=["'use strict'"];var r=o(b),d=r.map((function(t){return"i"+t})),U="this.offset+"+r.map((function(t){return"this.stride["+t+"]*i"+t})).join("+"),C=r.map((function(t){return"b"+t})).join(","),p=r.map((function(t){return"c"+t})).join(",");F.push("function "+Y+"(a,"+C+","+p+",d){this.data=a","this.shape=["+C+"]","this.stride=["+p+"]","this.offset=d|0}","var proto="+Y+".prototype","proto.dtype='"+t+"'","proto.dimension="+b),F.push("Object.defineProperty(proto,'size',{get:function "+Y+"_size(){return "+r.map((function(t){return"this.shape["+t+"]"})).join("*"),"}})"),1===b?F.push("proto.order=[0]"):(F.push("Object.defineProperty(proto,'order',{get:"),b<4?(F.push("function "+Y+"_order(){"),2===b?F.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===b&&F.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):F.push("ORDER})")),F.push("proto.set=function "+Y+"_set("+d.join(",")+",v){"),x?F.push("return this.data.set("+U+",v)}"):F.push("return this.data["+U+"]=v}"),F.push("proto.get=function "+Y+"_get("+d.join(",")+"){"),x?F.push("return this.data.get("+U+")}"):F.push("return this.data["+U+"]}"),F.push("proto.index=function "+Y+"_index(",d.join(),"){return "+U+"}"),F.push("proto.hi=function "+Y+"_hi("+d.join(",")+"){return new "+Y+"(this.data,"+r.map((function(t){return["(typeof i",t,"!=='number'||i",t,"<0)?this.shape[",t,"]:i",t,"|0"].join("")})).join(",")+","+r.map((function(t){return"this.stride["+t+"]"})).join(",")+",this.offset)}");var W=r.map((function(t){return"a"+t+"=this.shape["+t+"]"})),T=r.map((function(t){return"c"+t+"=this.stride["+t+"]"}));F.push("proto.lo=function "+Y+"_lo("+d.join(",")+"){var b=this.offset,d=0,"+W.join(",")+","+T.join(","));for(var y=0;y<b;++y)F.push("if(typeof i"+y+"==='number'&&i"+y+">=0){d=i"+y+"|0;b+=c"+y+"*d;a"+y+"-=d}");F.push("return new "+Y+"(this.data,"+r.map((function(t){return"a"+t})).join(",")+","+r.map((function(t){return"c"+t})).join(",")+",b)}"),F.push("proto.step=function "+Y+"_step("+d.join(",")+"){var "+r.map((function(t){return"a"+t+"=this.shape["+t+"]"})).join(",")+","+r.map((function(t){return"b"+t+"=this.stride["+t+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(y=0;y<b;++y)F.push("if(typeof i"+y+"==='number'){d=i"+y+"|0;if(d<0){c+=b"+y+"*(a"+y+"-1);a"+y+"=ceil(-a"+y+"/d)}else{a"+y+"=ceil(a"+y+"/d)}b"+y+"*=d}");F.push("return new "+Y+"(this.data,"+r.map((function(t){return"a"+t})).join(",")+","+r.map((function(t){return"b"+t})).join(",")+",c)}");var v=new Array(b),B=new Array(b);for(y=0;y<b;++y)v[y]="a[i"+y+"]",B[y]="b[i"+y+"]";F.push("proto.transpose=function "+Y+"_transpose("+d+"){"+d.map((function(t,b){return t+"=("+t+"===undefined?"+b+":"+t+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+Y+"(this.data,"+v.join(",")+","+B.join(",")+",this.offset)}"),F.push("proto.pick=function "+Y+"_pick("+d+"){var a=[],b=[],c=this.offset");for(y=0;y<b;++y)F.push("if(typeof i"+y+"==='number'&&i"+y+">=0){c=(c+this.stride["+y+"]*i"+y+")|0}else{a.push(this.shape["+y+"]);b.push(this.stride["+y+"])}");return F.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),F.push("return function construct_"+Y+"(data,shape,stride,offset){return new "+Y+"(data,"+r.map((function(t){return"shape["+t+"]"})).join(",")+","+r.map((function(t){return"stride["+t+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",F.join("\n"))(E[t],R)}var E={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};t.exports=function(t,b,Y,o){if(void 0===t)return(0,E.array[0])([]);"number"===typeof t&&(t=[t]),void 0===b&&(b=[t.length]);var r=b.length;if(void 0===Y){Y=new Array(r);for(var R=r-1,U=1;R>=0;--R)Y[R]=U,U*=b[R]}if(void 0===o){o=0;for(R=0;R<r;++R)Y[R]<0&&(o-=(b[R]-1)*Y[R])}for(var C=function(t){if(x(t))return"buffer";if(F)switch(Object.prototype.toString.call(t)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(t)?"array":"generic"}(t),p=E[C];p.length<=r+1;)p.push(d(C,p.length-1));return(0,p[r+1])(t,b,Y,o)}},12466:t=>{function b(t){return!!t.constructor&&"function"===typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}t.exports=function(t){return null!=t&&(b(t)||function(t){return"function"===typeof t.readFloatLE&&"function"===typeof t.slice&&b(t.slice(0,0))}(t)||!!t._isBuffer)}},12605:t=>{"use strict";var b=[],Y=[],o=[],x=[],F=[],r=[],R=[],d=[],E=[],U=[],C=[],p=[];t.exports=function(t,W,T,y,v,B){for(var J=R,m=E,K=U,L=p,z=0;z<3;z++)J[z]=+T[z],K[z]=+W.max[z],m[z]=+W.Xd[z];B||(B=1e-10);var S=function(t,R,E,U,p,W){var T=b,y=Y,v=o,B=x,J=F,m=r,K=d,L=Math.floor,z=0,S=0,e=0,g=0,D=0;if(H(),0===e)return 0;for(g=X();S<=e;){if(f(g)&&n())return z;g=X()}for(z+=e,D=0;D<3;D++)U[D]+=E[D],p[D]+=E[D];return z;function H(){if(S=0,0!==(e=Math.sqrt(E[0]*E[0]+E[1]*E[1]+E[2]*E[2])))for(var t=0;t<3;t++){var b=E[t]>=0;B[t]=b?1:-1;var Y=b?p[t]:U[t];T[t]=b?U[t]:p[t],y[t]=Q(Y,B[t]),v[t]=N(T[t],B[t]),K[t]=E[t]/e,J[t]=Math.abs(1/K[t]);var o=b?y[t]+1-Y:Y-y[t];m[t]=J[t]<1/0?J[t]*o:1/0}}function f(b){for(var Y=B[0],o=0===b?y[0]:v[0],x=y[0]+Y,F=B[1],r=1===b?y[1]:v[1],R=y[1]+F,d=B[2],E=2===b?y[2]:v[2],U=y[2]+d,C=o;C!=x;C+=Y)for(var p=r;p!=R;p+=F)for(var W=E;W!=U;W+=d)if(t(C,p,W))return!0;return!1}function n(){z+=S;var t=B[g],b=S/e,Y=C;for(D=0;D<3;D++){var o=E[D]*b;U[D]+=o,p[D]+=o,Y[D]=E[D]-o}if(t>0?p[g]=Math.round(p[g]):U[g]=Math.round(U[g]),R(z,g,t,Y))return!0;for(D=0;D<3;D++)E[D]=Y[D];return H(),0===e}function X(){var t=m[0]<m[1]?m[0]<m[2]?0:2:m[1]<m[2]?1:2,b=m[t]-S;for(S=m[t],y[t]+=B[t],m[t]+=J[t],D=0;D<3;D++)T[D]+=b*K[D],v[D]=N(T[D],B[D]);return t}function Q(t,b){return L(t-b*W)}function N(t,b){return L(t+b*W)}}(t,y,J,m,K,B);if(!v){for(z=0;z<3;z++)L[z]=T[z]>0?K[z]-W.max[z]:m[z]-W.Xd[z];W.translate(L)}return S}},12761:(t,b,Y)=>{"use strict";Y.d(b,{d:()=>C});var o=Y(12598),x=Y(12048);class F{constructor(t,b,Y,F,r,R,d){this._g=new o(t.Xd,t.Bh),this.mass=b,this.friction=Y,this.restitution=F,this.jd=r,this.Dk=R,this.md=!!d,this.Ah=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.pl=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.lg=x.create(),this.Vg=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=x.create(),this._impulses=x.create(),this._sleepFrameCount=10}loadFromCopy(t){x.j(this._g.Xd,t._g.Xd),x.j(this._g.Bh,t._g.Bh),x.j(this._g.max,t._g.max),this._g.mag=t._g.mag,this.mass=t.mass,this.friction=t.friction,this.restitution=t.restitution,this.jd=t.jd,this.Dk=t.Dk,this.md=t.md,this.Ah=t.Ah,this.fluidDrag=t.fluidDrag,this.pl=t.pl,this.preventFallOffEdge=t.preventFallOffEdge,this.rolledBackLastTick=t.rolledBackLastTick,x.j(this.lg,t.lg),x.j(this.Vg,t.Vg),this.inFluid=t.inFluid,this._ratioInFluid=t._ratioInFluid,x.j(this._forces,t._forces),x.j(this._impulses,t._impulses),this._sleepFrameCount=t._sleepFrameCount}setPosition(t){r(t),x.fd(t,t,this._g.Xd),this._g.translate(t),this.og()}cb(){return x.clone(this._g.Xd)}applyForce(t){r(t),x.add(this._forces,this._forces,t),this.og()}applyImpulse(t){r(t),x.add(this._impulses,this._impulses,t),this.og()}og(){this._sleepFrameCount=10}atRestX(){return this.Vg[0]}atRestY(){return this.Vg[1]}atRestZ(){return this.Vg[2]}}var r=t=>{};var R=Y(12598),d=Y(12048),E=Y(12605);function U(){this.Ah=.1,this.fluidDrag=.4,this.wd=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function C(t,b,Y){t=Object.assign(new U,t),this.gravity=t.gravity||[0,-10,0],this.Ah=t.Ah||.1,this.wd=t.wd||2,this.fluidDrag=t.fluidDrag||.4,this.minBounceImpulse=t.minBounceImpulse,this.bodies=[],this.$j=t.$j,this.testSolid=b,this.testFluid=Y}C.prototype.Kk=function(t,b,Y,o,x,r){t=t||new R([0,0,0],[1,1,1]),"undefined"==typeof b&&(b=1),"undefined"==typeof Y&&(Y=1),"undefined"==typeof o&&(o=0),"undefined"==typeof x&&(x=1);var d=new F(t,b,Y,o,x,r);return this.bodies.push(d),d},C.prototype.Lk=function(t){var b=this.bodies.indexOf(t);b<0||(this.bodies.splice(b,1),t._g=t.Dk=null)};var p=d.create(),W=d.create(),T=d.create(),y=d.create(),v=d.create(),B=d.create(),J=d.create(),m=new R([0,0,0],[1,1,1]),K=new F(m,1,1,0,1,(()=>{}),!1);function L(t,b,Y){return b=Y,b*=1-(1-t.ratioInFluid)**2}C.prototype.mf=function(t){t/=1e3;var b=M(0,d.squaredLength(this.gravity));this.bodies.forEach((Y=>function(t,b,Y,o){d.j(v,b.Vg),t.$j&&K.loadFromCopy(b);if(b.mass<=0)return d.set(b.lg,0,0,0),d.set(b._forces,0,0,0),void d.set(b._impulses,0,0,0);var x=o||0===b.jd;if(function(t,b,Y,o){if(b._sleepFrameCount>0)return!1;if(o)return!0;var x=!1,F=.5*Y*Y*b.jd;return d.scale(A,t.gravity,F),E(t.testSolid,b._g,A,(function(){return x=!0,!0}),!0),x}(t,b,Y,x))return;b._sleepFrameCount--,function(t,b){var Y=b._g,o=Math.floor(Y.Xd[0]),x=Math.floor(Y.Xd[2]),F=Math.floor(Y.Xd[1]),r=Math.floor(Y.max[1]);if(!t.testFluid(o,F,x))return b.inFluid=!1,void(b.ratioInFluid=0);var R=1,E=F+1;for(;E<=r&&t.testFluid(o,E,x);)R++,E++;var U=(F+R-Y.Xd[1])/Y.Bh[1];U>1&&(U=1);var C=Y.Bh[0]*Y.Bh[1]*Y.Bh[2]*U,p=S;d.scale(p,t.gravity,-t.wd*C*b.jd),b.applyForce(p),b.inFluid=!0,b.ratioInFluid=U}(t,b),c(b._forces),c(b._impulses),c(b.lg),c(b.Vg),d.scale(p,b._forces,1/b.mass),d.Nd(p,p,t.gravity,b.jd),d.scale(W,b._impulses,1/b.mass),d.Nd(W,W,p,Y),d.add(b.lg,b.lg,W),b.friction&&(e(t,0,b,W,Y),e(t,1,b,W,Y),e(t,2,b,W,Y));var F=b.fluidDrag>=0?b.fluidDrag:t.fluidDrag,r=b.Ah>=0?b.Ah:t.Ah,R=r,U=r;b.inFluid&&(R=L(b,R,b.fluidDragHoriz>=0?b.fluidDragHoriz:F),U=L(b,U,b.fluidDragVert>=0?b.fluidDragVert:F));R=Math.max(1-R*Y/b.mass,0),U=Math.max(1-U*Y/b.mass,0),d.set(z,R,U,R),d.multiply(b.lg,b.lg,z),d.scale(T,b.lg,Y),d.set(b._forces,0,0,0),d.set(b._impulses,0,0,0),b.md&&w(H,b._g);d.j(B,T),d.set(J,0,0,0),b.preventFallOffEdge&&function(t,b,Y,o){if(!b.Vg[1]||Y[1]>0)return;var x=u;w(x,b._g);for(var F=0;F<3;F+=2){d.set(N,0,0,0),N[F]=Y[F];var r=!0;(r=(r=(r=(r=r&&!a(t,x.Xd[0]+N[0]+1e-5,x.Xd[1],x.Xd[2]+N[2]+1e-5))&&!a(t,x.max[0]+N[0]-1e-5,x.Xd[1],x.Xd[2]+N[2]+1e-5))&&!a(t,x.Xd[0]+N[0]+1e-5,x.Xd[1],x.max[2]+N[2]-1e-5))&&!a(t,x.max[0]+N[0]-1e-5,x.Xd[1],x.max[2]+N[2]-1e-5))?(o[F]=Y[F]>0?1:-1,Y[F]=0):0===F&&(d.set(Z,Y[0],0,0),D(t,x,Z,o,b.slideOnCollision))}}(t,b,T,J);D(t,b._g,T,b.Vg,b.slideOnCollision),b.md&&function(t,b,Y,o){if(b.Vg[1]>=0&&!b.inFluid)return;var x=0!==b.Vg[0],F=0!==b.Vg[2];if(!x&&!F)return;var r=Math.abs(o[0]/o[2]),R=4;if(!x&&r>R)return;if(!F&&r<1/R)return;d.add(n,Y.Xd,o);var U=t.testSolid;E(U,Y,o,(function(t,b,Y,o){if(1!==b)return!0;o[b]=0}));var C=Y.Xd[1],p=b.inFluid?1.951:1.001,W=Math.floor(C+p)-C;d.set(X,0,W,0);var T=!1;if(E(U,Y,X,(function(t,b,Y,o){return T=!0,!0})),T)return;d.fd(Q,n,Y.Xd),Q[1]=0,D(t,Y,Q,f,!0);var y=M(Y.Xd[0],n[0]),v=M(Y.Xd[2],n[2]);if(x&&!y&&(!v||!F))return;if(F&&(!y||!x)&&!v)return;var B=!0;if(B=B&&!a(t,Y.Xd[0]+1e-5,Y.Xd[1],Y.Xd[2]+1e-5),B=B&&!a(t,Y.max[0]-1e-5,Y.Xd[1],Y.Xd[2]+1e-5),B=B&&!a(t,Y.Xd[0]+1e-5,Y.Xd[1],Y.max[2]-1e-5),B=B&&!a(t,Y.max[0]-1e-5,Y.Xd[1],Y.max[2]-1e-5),B)return;w(b._g,Y),b.Vg[0]=f[0],b.Vg[2]=f[2],b.pl&&b.pl()}(t,b,H,B);for(var C=0;C<3;++C)b.Vg[C]=b.Vg[C]||J[C],y[C]=0,b.Vg[C]&&(v[C]||(y[C]=-b.lg[C]),b.lg[C]=0);var m=d.length(y);m>.001&&(d.scale(y,y,b.mass),b.Dk&&b.Dk(y),b.restitution>0&&m>t.minBounceImpulse&&(d.scale(y,y,b.restitution),b.applyImpulse(y)));var g=d.squaredLength(b.lg);g>1e-5&&b.og();t.$j&&t.$j(b)?(b.loadFromCopy(K),b.rolledBackLastTick=!0):b.rolledBackLastTick=!1}(this,Y,t,b)))};var z=d.create([0,0,0]);var S=d.create();function e(t,b,Y,o,x){var F=Y.Vg[b],r=o[b];if(!Y.alwaysApplyHorizFriction||1!==b){if(0===F)return;if(F*r<=0)return}d.j(g,Y.lg),g[b]=0;var R=d.length(g);if(!M(R,0)){var E=Math.abs(Y.friction*t.gravity[b]*x),U=R>E?(R-E)/R:0;Y.lg[(b+1)%3]*=U,Y.lg[(b+2)%3]*=U}}var g=d.create();function D(t,b,Y,o,x){return d.set(o,0,0,0),E(t.testSolid,b,Y,(function(t,b,Y,F){o[b]=Y,F[b]=0,x||(F[0]=0,F[1]=0,F[2]=0)}))}var H=new R([],[]),f=d.create(),n=d.create(),X=d.create(),Q=d.create();var N=d.create(),u=new R([],[]),Z=d.create();function a(t,b,Y,o){return t.testSolid(Math.floor(b),Math.floor(Y-1),Math.floor(o))}var A=d.create();function M(t,b){return Math.abs(t-b)<1e-5}function w(t,b){for(var Y=0;Y<3;Y++)t.Xd[Y]=b.Xd[Y],t.max[Y]=b.max[Y],t.Bh[Y]=b.Bh[Y]}var c=function(t){}},11536:function(t,b){!function(t){"use strict";var b=function(t,Y){return b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,b){t.__proto__=b}||function(t,b){for(var Y in b)Object.prototype.hasOwnProperty.call(b,Y)&&(t[Y]=b[Y])},b(t,Y)};function Y(t,Y){if("function"!==typeof Y&&null!==Y)throw new TypeError("Class extends value "+String(Y)+" is not a constructor or null");function o(){this.constructor=t}b(t,Y),t.prototype=null===Y?Object.create(Y):(o.prototype=Y.prototype,new o)}function o(t,b,Y,o){var x,F=arguments.length,r=F<3?b:null===o?o=Object.getOwnPropertyDescriptor(b,Y):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)r=Reflect.decorate(t,b,Y,o);else for(var R=t.length-1;R>=0;R--)(x=t[R])&&(r=(F<3?x(r):F>3?x(b,Y,r):x(b,Y))||r);return F>3&&r&&Object.defineProperty(b,Y,r),r}function x(t,b,Y){if(Y||2===arguments.length)for(var o,x=0,F=b.length;x<F;x++)!o&&x in b||(o||(o=Array.prototype.slice.call(b,0,x)),o[x]=b[x]);return t.concat(o||Array.prototype.slice.call(b))}var F,r=255,R=213;t.OPERATION=void 0,(F=t.OPERATION||(t.OPERATION={}))[F.ADD=128]="ADD",F[F.REPLACE=0]="REPLACE",F[F.DELETE=64]="DELETE",F[F.DELETE_AND_ADD=192]="DELETE_AND_ADD",F[F.TOUCH=1]="TOUCH",F[F.CLEAR=10]="CLEAR";var d=function(){function b(t,b,Y){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=t,this.setParent(b,Y)}return b.prototype.setParent=function(t,b,Y){var o=this;if(this.indexes||(this.indexes=this.ref instanceof Qt?this.ref._definition.indexes:{}),this.parent=t,this.parentIndex=Y,b)if(this.root=b,this.ref instanceof Qt){var x=this.ref._definition;for(var F in x.schema){var r=this.ref[F];if(r&&r.$changes){var R=x.indexes[F];r.$changes.setParent(this.ref,b,R)}}}else"object"===typeof this.ref&&this.ref.forEach((function(t,b){if(t instanceof Qt){var Y=t.$changes,x=o.ref.$changes.indexes[b];Y.setParent(o.ref,o.root,x)}}))},b.prototype.operation=function(t){this.changes.set(--this.currentCustomOperation,t)},b.prototype.change=function(b,Y){void 0===Y&&(Y=t.OPERATION.ADD);var o="number"===typeof b?b:this.indexes[b];this.assertValidIndex(o,b);var x=this.changes.get(o);x&&x.op!==t.OPERATION.DELETE&&x.op!==t.OPERATION.TOUCH||this.changes.set(o,{op:x&&x.op===t.OPERATION.DELETE?t.OPERATION.DELETE_AND_ADD:Y,index:o}),this.allChanges.add(o),this.changed=!0,this.touchParents()},b.prototype.touch=function(b){var Y="number"===typeof b?b:this.indexes[b];this.assertValidIndex(Y,b),this.changes.has(Y)||this.changes.set(Y,{op:t.OPERATION.TOUCH,index:Y}),this.allChanges.add(Y),this.touchParents()},b.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},b.prototype.getType=function(t){if(this.ref._definition)return(b=this.ref._definition).schema[b.fieldsByIndex[t]];var b,Y=(b=this.parent._definition).schema[b.fieldsByIndex[this.parentIndex]];return Object.values(Y)[0]},b.prototype.getChildrenFilter=function(){var t=this.parent._definition.childFilters;return t&&t[this.parentIndex]},b.prototype.getValue=function(t){return this.ref.getByIndex(t)},b.prototype.delete=function(b){var Y="number"===typeof b?b:this.indexes[b];if(void 0!==Y){var o=this.getValue(Y);this.changes.set(Y,{op:t.OPERATION.DELETE,index:Y}),this.allChanges.delete(Y),delete this.caches[Y],o&&o.$changes&&(o.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(b," (").concat(Y,")"))},b.prototype.discard=function(b,Y){var o=this;void 0===b&&(b=!1),void 0===Y&&(Y=!1),this.ref instanceof Qt||this.changes.forEach((function(b){if(b.op===t.OPERATION.DELETE){var Y=o.ref.getIndex(b.index);delete o.indexes[Y]}})),this.changes.clear(),this.changed=b,Y&&this.allChanges.clear(),this.currentCustomOperation=0},b.prototype.discardAll=function(){var t=this;this.changes.forEach((function(b){var Y=t.getValue(b.index);Y&&Y.$changes&&Y.$changes.discardAll()})),this.discard()},b.prototype.cache=function(t,b){this.caches[t]=b},b.prototype.clone=function(){return new b(this.ref,this.parent,this.root)},b.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},b.prototype.assertValidIndex=function(t,b){if(void 0===t)throw new Error('ChangeTree: missing index for field "'.concat(b,'"'))},b}();function E(t,b,Y,o){return t[b]||(t[b]=[]),t[b].push(Y),null===o||void 0===o||o.forEach((function(t,b){return Y(t,b)})),function(){return C(t[b],t[b].indexOf(Y))}}function U(b){var Y=this,o="string"!==typeof this.$changes.getType();this.$items.forEach((function(x,F){b.push({refId:Y.$changes.refId,op:t.OPERATION.DELETE,field:F,value:void 0,previousValue:x}),o&&Y.$changes.root.removeRef(x.$changes.refId)}))}function C(t,b){if(-1===b||b>=t.length)return!1;for(var Y=t.length-1,o=b;o<Y;o++)t[o]=t[o+1];return t.length=Y,!0}var p=function(t,b){var Y=t.toString(),o=b.toString();return Y<o?-1:Y>o?1:0};function W(t){return t.$proxy=!0,t=new Proxy(t,{get:function(t,b){return"symbol"===typeof b||isNaN(b)?t[b]:t.at(b)},set:function(t,b,Y){if("symbol"===typeof b||isNaN(b))t[b]=Y;else{var o=Array.from(t.$items.keys()),x=parseInt(o[b]||b);void 0===Y||null===Y?t.deleteAt(x):t.setAt(x,Y)}return!0},deleteProperty:function(t,b){return"number"===typeof b?t.deleteAt(b):delete t[b],!0}})}var T=function(){function b(){for(var t=[],b=0;b<arguments.length;b++)t[b]=arguments[b];this.$changes=new d(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,t)}return b.prototype.Kf=function(b,Y){return void 0===Y&&(Y=!0),E(this.$callbacks||(this.$callbacks=[]),t.OPERATION.ADD,b,Y?this.$items:void 0)},b.prototype.ab=function(b){return E(this.$callbacks||(this.$callbacks=[]),t.OPERATION.DELETE,b)},b.prototype.onChange=function(b){return E(this.$callbacks||(this.$callbacks=[]),t.OPERATION.REPLACE,b)},b.is=function(t){return Array.isArray(t)||void 0!==t.array},Object.defineProperty(b.prototype,"length",{get:function(){return this.$items.size},set:function(t){0===t?this.clear():this.splice(t,this.length-t)},enumerable:!1,configurable:!0}),b.prototype.push=function(){for(var t,b=this,Y=[],o=0;o<arguments.length;o++)Y[o]=arguments[o];return Y.forEach((function(Y){t=b.$refId++,b.setAt(t,Y)})),t},b.prototype.pop=function(){var t=Array.from(this.$indexes.values()).pop();if(void 0!==t){this.$changes.delete(t),this.$indexes.delete(t);var b=this.$items.get(t);return this.$items.delete(t),b}},b.prototype.at=function(t){var b=Array.from(this.$items.keys())[t];return this.$items.get(b)},b.prototype.setAt=function(b,Y){var o,x;if(void 0!==Y&&null!==Y){if(this.$items.get(b)!==Y){void 0!==Y.$changes&&Y.$changes.setParent(this,this.$changes.root,b);var F=null!==(x=null===(o=this.$changes.indexes[b])||void 0===o?void 0:o.op)&&void 0!==x?x:t.OPERATION.ADD;this.$changes.indexes[b]=b,this.$indexes.set(b,b),this.$items.set(b,Y),this.$changes.change(b,F)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},b.prototype.deleteAt=function(t){var b=Array.from(this.$items.keys())[t];return void 0!==b&&this.$deleteAt(b)},b.prototype.$deleteAt=function(t){return this.$changes.delete(t),this.$indexes.delete(t),this.$items.delete(t)},b.prototype.clear=function(b){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),b&&U.call(this,b),this.$items.clear(),this.$changes.operation({index:0,op:t.OPERATION.CLEAR}),this.$changes.touchParents()},b.prototype.concat=function(){for(var t,Y=[],o=0;o<arguments.length;o++)Y[o]=arguments[o];return new(b.bind.apply(b,x([void 0],(t=Array.from(this.$items.values())).concat.apply(t,Y),!1)))},b.prototype.join=function(t){return Array.from(this.$items.values()).join(t)},b.prototype.reverse=function(){var t=this,b=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(Y,o){t.setAt(b[o],Y)})),this},b.prototype.shift=function(){var t=Array.from(this.$items.keys()).shift();if(void 0!==t){var b=this.$items.get(t);return this.$deleteAt(t),b}},b.prototype.slice=function(t,Y){var o=new b;return o.push.apply(o,Array.from(this.$items.values()).slice(t,Y)),o},b.prototype.sort=function(t){var b=this;void 0===t&&(t=p);var Y=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(t).forEach((function(t,o){b.setAt(Y[o],t)})),this},b.prototype.splice=function(t,b){void 0===b&&(b=this.length-t);for(var Y=Array.from(this.$items.keys()),o=[],x=t;x<t+b;x++)o.push(this.$items.get(Y[x])),this.$deleteAt(Y[x]);return o},b.prototype.unshift=function(){for(var t=this,b=[],Y=0;Y<arguments.length;Y++)b[Y]=arguments[Y];var o=this.length,x=b.length,F=Array.from(this.$items.values());return b.forEach((function(b,Y){t.setAt(Y,b)})),F.forEach((function(b,Y){t.setAt(x+Y,b)})),o+x},b.prototype.indexOf=function(t,b){return Array.from(this.$items.values()).indexOf(t,b)},b.prototype.lastIndexOf=function(t,b){return void 0===b&&(b=this.length-1),Array.from(this.$items.values()).lastIndexOf(t,b)},b.prototype.every=function(t,b){return Array.from(this.$items.values()).every(t,b)},b.prototype.some=function(t,b){return Array.from(this.$items.values()).some(t,b)},b.prototype.forEach=function(t,b){Array.from(this.$items.values()).forEach(t,b)},b.prototype.map=function(t,b){return Array.from(this.$items.values()).map(t,b)},b.prototype.filter=function(t,b){return Array.from(this.$items.values()).filter(t,b)},b.prototype.reduce=function(t,b){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},b.prototype.reduceRight=function(t,b){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},b.prototype.find=function(t,b){return Array.from(this.$items.values()).find(t,b)},b.prototype.findIndex=function(t,b){return Array.from(this.$items.values()).findIndex(t,b)},b.prototype.fill=function(t,b,Y){throw new Error("ArraySchema#fill() not implemented")},b.prototype.copyWithin=function(t,b,Y){throw new Error("ArraySchema#copyWithin() not implemented")},b.prototype.toString=function(){return this.$items.toString()},b.prototype.toLocaleString=function(){return this.$items.toLocaleString()},b.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(b,Symbol.species,{get:function(){return b},enumerable:!1,configurable:!0}),b.prototype.entries=function(){return this.$items.entries()},b.prototype.keys=function(){return this.$items.keys()},b.prototype.values=function(){return this.$items.values()},b.prototype.includes=function(t,b){return Array.from(this.$items.values()).includes(t,b)},b.prototype.flatMap=function(t,b){throw new Error("ArraySchema#flatMap() is not supported.")},b.prototype.flat=function(t){throw new Error("ArraySchema#flat() is not supported.")},b.prototype.findLast=function(){var t=Array.from(this.$items.values());return t.findLast.apply(t,arguments)},b.prototype.findLastIndex=function(){var t=Array.from(this.$items.values());return t.findLastIndex.apply(t,arguments)},b.prototype.setIndex=function(t,b){this.$indexes.set(t,b)},b.prototype.getIndex=function(t){return this.$indexes.get(t)},b.prototype.getByIndex=function(t){return this.$items.get(this.$indexes.get(t))},b.prototype.deleteByIndex=function(t){var b=this.$indexes.get(t);this.$items.delete(b),this.$indexes.delete(t)},b.prototype.toArray=function(){return Array.from(this.$items.values())},b.prototype.toJSON=function(){return this.toArray().map((function(t){return"function"===typeof t.toJSON?t.toJSON():t}))},b.prototype.clone=function(t){return t?new(b.bind.apply(b,x([void 0],Array.from(this.$items.values()),!1))):new(b.bind.apply(b,x([void 0],this.map((function(t){return t.$changes?t.clone():t})),!1)))},b}();function y(t){return t.$proxy=!0,t=new Proxy(t,{get:function(t,b){return"symbol"!==typeof b&&"undefined"===typeof t[b]?t.get(b):t[b]},set:function(t,b,Y){return"symbol"!==typeof b&&-1===b.indexOf("$")&&"Kf"!==b&&"ab"!==b&&"onChange"!==b?t.set(b,Y):t[b]=Y,!0},deleteProperty:function(t,b){return t.delete(b),!0}})}var v=function(){function b(t){var Y=this;if(this.$changes=new d(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,t)if(t instanceof Map||t instanceof b)t.forEach((function(t,b){return Y.set(b,t)}));else for(var o in t)this.set(o,t[o])}return b.prototype.Kf=function(b,Y){return void 0===Y&&(Y=!0),E(this.$callbacks||(this.$callbacks=[]),t.OPERATION.ADD,b,Y?this.$items:void 0)},b.prototype.ab=function(b){return E(this.$callbacks||(this.$callbacks=[]),t.OPERATION.DELETE,b)},b.prototype.onChange=function(b){return E(this.$callbacks||(this.$callbacks=[]),t.OPERATION.REPLACE,b)},b.is=function(t){return void 0!==t.map},b.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(b.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(b,Symbol.species,{get:function(){return b},enumerable:!1,configurable:!0}),b.prototype.set=function(b,Y){if(void 0===Y||null===Y)throw new Error("MapSchema#set('".concat(b,"', ").concat(Y,"): trying to set ").concat(Y," value on '").concat(b,"'."));b=b.toString();var o="undefined"!==typeof this.$changes.indexes[b],x=o?this.$changes.indexes[b]:this.$refId++,F=o?t.OPERATION.REPLACE:t.OPERATION.ADD,r=void 0!==Y.$changes;if(r&&Y.$changes.setParent(this,this.$changes.root,x),o){if(!r&&this.$items.get(b)===Y)return;r&&this.$items.get(b)!==Y&&(F=t.OPERATION.ADD)}else this.$changes.indexes[b]=x,this.$indexes.set(x,b);return this.$items.set(b,Y),this.$changes.change(b,F),this},b.prototype.get=function(t){return this.$items.get(t)},b.prototype.delete=function(t){return this.$changes.delete(t),this.$items.delete(t)},b.prototype.clear=function(b){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),b&&U.call(this,b),this.$items.clear(),this.$changes.operation({index:0,op:t.OPERATION.CLEAR}),this.$changes.touchParents()},b.prototype.has=function(t){return this.$items.has(t)},b.prototype.forEach=function(t){this.$items.forEach(t)},b.prototype.entries=function(){return this.$items.entries()},b.prototype.keys=function(){return this.$items.keys()},b.prototype.values=function(){return this.$items.values()},Object.defineProperty(b.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),b.prototype.setIndex=function(t,b){this.$indexes.set(t,b)},b.prototype.getIndex=function(t){return this.$indexes.get(t)},b.prototype.getByIndex=function(t){return this.$items.get(this.$indexes.get(t))},b.prototype.deleteByIndex=function(t){var b=this.$indexes.get(t);this.$items.delete(b),this.$indexes.delete(t)},b.prototype.toJSON=function(){var t={};return this.forEach((function(b,Y){t[Y]="function"===typeof b.toJSON?b.toJSON():b})),t},b.prototype.clone=function(t){var Y;return t?Y=Object.assign(new b,this):(Y=new b,this.forEach((function(t,b){t.$changes?Y.set(b,t.clone()):Y.set(b,t)}))),Y},b}(),B={};function J(t,b){B[t]=b}function m(t){return B[t]}var K=function(){function t(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return t.create=function(b){var Y=new t;return Y.schema=Object.assign({},b&&b.schema||{}),Y.indexes=Object.assign({},b&&b.indexes||{}),Y.fieldsByIndex=Object.assign({},b&&b.fieldsByIndex||{}),Y.descriptors=Object.assign({},b&&b.descriptors||{}),Y.deprecated=Object.assign({},b&&b.deprecated||{}),Y},t.prototype.addField=function(t,b){var Y=this.getNextFieldIndex();this.fieldsByIndex[Y]=t,this.indexes[t]=Y,this.schema[t]=Array.isArray(b)?{array:b[0]}:b},t.prototype.hasField=function(t){return void 0!==this.indexes[t]},t.prototype.addFilter=function(t,b){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[t]]=b,this.indexesWithFilters.push(this.indexes[t]),!0},t.prototype.addChildrenFilter=function(t,b){var Y=this.indexes[t],o=this.schema[t];if(m(Object.keys(o)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[Y]=b,!0;console.warn("@filterChildren: field '".concat(t,"' can't have children. Ignoring filter."))},t.prototype.getChildrenFilter=function(t){return this.childFilters&&this.childFilters[this.indexes[t]]},t.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},t}();function L(t){return t._context&&t._context.useFilters}var z=function(){function t(){this.types={},this.schemas=new Map,this.useFilters=!1}return t.prototype.has=function(t){return this.schemas.has(t)},t.prototype.get=function(t){return this.types[t]},t.prototype.add=function(t,b){void 0===b&&(b=this.schemas.size),t._definition=K.create(t._definition),t._typeid=b,this.types[b]=t,this.schemas.set(t,b)},t.create=function(b){return void 0===b&&(b={}),function(Y){return b.context||(b.context=new t),e(Y,b)}},t}(),S=new z;function e(t,b){return void 0===b&&(b={}),function(Y,o){var F=b.context||S,r=Y.constructor;if(r._context=F,!t)throw new Error("".concat(r.name,': @type() reference provided for "').concat(o,"\" is undefined. Make sure you don't have any circular dependencies."));F.has(r)||F.add(r);var R=r._definition;if(R.addField(o,t),R.descriptors[o]){if(R.deprecated[o])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(o,"' definition on '").concat(r.name,"'.\nCheck @type() annotation"))}catch(B){var d=B.stack.split("\n")[4].trim();throw new Error("".concat(B.message," ").concat(d))}}var E=T.is(t),U=!E&&v.is(t);if("string"!==typeof t&&!Qt.is(t)){var C=Object.values(t)[0];"string"===typeof C||F.has(C)||F.add(C)}if(b.manual)R.descriptors[o]={enumerable:!0,configurable:!0,writable:!0};else{var p="_".concat(o);R.descriptors[p]={enumerable:!1,configurable:!1,writable:!0},R.descriptors[o]={get:function(){return this[p]},set:function(t){t!==this[p]&&(void 0!==t&&null!==t?(!E||t instanceof T||(t=new(T.bind.apply(T,x([void 0],t,!1)))),!U||t instanceof v||(t=new v(t)),void 0===t.$proxy&&(U?t=y(t):E&&(t=W(t))),this.$changes.change(o),t.$changes&&t.$changes.setParent(this,this.$changes.root,this._definition.indexes[o])):this[p]&&this.$changes.delete(o),this[p]=t)},enumerable:!0,configurable:!0}}}}function g(t){return function(b,Y){var o=b.constructor;o._definition.addFilter(Y,t)&&(o._context.useFilters=!0)}}function D(t){return function(b,Y){var o=b.constructor;o._definition.addChildrenFilter(Y,t)&&(o._context.useFilters=!0)}}function H(t){return void 0===t&&(t=!0),function(b,Y){var o=b.constructor._definition;o.deprecated[Y]=!0,t&&(o.descriptors[Y]={get:function(){throw new Error("".concat(Y," is deprecated."))},set:function(t){},enumerable:!1,configurable:!0})}}function f(t,b,Y){for(var o in void 0===Y&&(Y={}),Y.context||(Y.context=t._context||Y.context||S),b)e(b[o],Y)(t.prototype,o);return t}function n(t){for(var b=0,Y=0,o=0,x=t.length;o<x;o++)(b=t.charCodeAt(o))<128?Y+=1:b<2048?Y+=2:b<55296||b>=57344?Y+=3:(o++,Y+=4);return Y}function X(t,b,Y){for(var o=0,x=0,F=Y.length;x<F;x++)(o=Y.charCodeAt(x))<128?t[b++]=o:o<2048?(t[b++]=192|o>>6,t[b++]=128|63&o):o<55296||o>=57344?(t[b++]=224|o>>12,t[b++]=128|o>>6&63,t[b++]=128|63&o):(x++,o=65536+((1023&o)<<10|1023&Y.charCodeAt(x)),t[b++]=240|o>>18,t[b++]=128|o>>12&63,t[b++]=128|o>>6&63,t[b++]=128|63&o)}function Q(t,b){t.push(255&b)}function N(t,b){t.push(255&b)}function u(t,b){t.push(255&b),t.push(b>>8&255)}function Z(t,b){t.push(255&b),t.push(b>>8&255)}function a(t,b){t.push(255&b),t.push(b>>8&255),t.push(b>>16&255),t.push(b>>24&255)}function A(t,b){var Y=b>>24,o=b>>16,x=b>>8,F=b;t.push(255&F),t.push(255&x),t.push(255&o),t.push(255&Y)}function M(t,b){var Y=Math.floor(b/Math.pow(2,32));A(t,b>>>0),A(t,Y)}function w(t,b){var Y=b/Math.pow(2,32)|0;A(t,b>>>0),A(t,Y)}function c(t,b){V(t,b)}function I(t,b){P(t,b)}var s=new Int32Array(2),l=new Float32Array(s.buffer),i=new Float64Array(s.buffer);function V(t,b){l[0]=b,a(t,s[0])}function P(t,b){i[0]=b,a(t,s[0]),a(t,s[1])}function k(t,b){return N(t,b?1:0)}function q(t,b){b||(b="");var Y=n(b),o=0;if(Y<32)t.push(160|Y),o=1;else if(Y<256)t.push(217),N(t,Y),o=2;else if(Y<65536)t.push(218),Z(t,Y),o=3;else{if(!(Y<4294967296))throw new Error("String too long");t.push(219),A(t,Y),o=5}return X(t,t.length,b),o+Y}function O(t,b){return isNaN(b)?O(t,0):isFinite(b)?b!==(0|b)?(t.push(203),P(t,b),9):b>=0?b<128?(N(t,b),1):b<256?(t.push(204),N(t,b),2):b<65536?(t.push(205),Z(t,b),3):b<4294967296?(t.push(206),A(t,b),5):(t.push(207),w(t,b),9):b>=-32?(t.push(224|b+32),1):b>=-128?(t.push(208),Q(t,b),2):b>=-32768?(t.push(209),u(t,b),3):b>=-2147483648?(t.push(210),a(t,b),5):(t.push(211),M(t,b),9):O(t,b>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var j=Object.freeze({__proto__:null,utf8Write:X,int8:Q,uint8:N,int16:u,uint16:Z,int32:a,uint32:A,int64:M,uint64:w,float32:c,float64:I,writeFloat32:V,writeFloat64:P,boolean:k,string:q,number:O});function G(t,b,Y){for(var o="",x=0,F=b,r=b+Y;F<r;F++){var R=t[F];0!==(128&R)?192!==(224&R)?224!==(240&R)?240!==(248&R)?console.error("Invalid byte "+R.toString(16)):(x=(7&R)<<18|(63&t[++F])<<12|(63&t[++F])<<6|63&t[++F])>=65536?(x-=65536,o+=String.fromCharCode(55296+(x>>>10),56320+(1023&x))):o+=String.fromCharCode(x):o+=String.fromCharCode((15&R)<<12|(63&t[++F])<<6|63&t[++F]):o+=String.fromCharCode((31&R)<<6|63&t[++F]):o+=String.fromCharCode(R)}return o}function h(t,b){return tt(t,b)<<24>>24}function tt(t,b){return t[b.offset++]}function bt(t,b){return Yt(t,b)<<16>>16}function Yt(t,b){return t[b.offset++]|t[b.offset++]<<8}function ot(t,b){return t[b.offset++]|t[b.offset++]<<8|t[b.offset++]<<16|t[b.offset++]<<24}function xt(t,b){return ot(t,b)>>>0}function Ft(t,b){return pt(t,b)}function rt(t,b){return Wt(t,b)}function Rt(t,b){var Y=xt(t,b);return ot(t,b)*Math.pow(2,32)+Y}function dt(t,b){var Y=xt(t,b);return xt(t,b)*Math.pow(2,32)+Y}var Et=new Int32Array(2),Ut=new Float32Array(Et.buffer),Ct=new Float64Array(Et.buffer);function pt(t,b){return Et[0]=ot(t,b),Ut[0]}function Wt(t,b){return Et[0]=ot(t,b),Et[1]=ot(t,b),Ct[0]}function Tt(t,b){return tt(t,b)>0}function yt(t,b){var Y,o=t[b.offset++];o<192?Y=31&o:217===o?Y=tt(t,b):218===o?Y=Yt(t,b):219===o&&(Y=xt(t,b));var x=G(t,b.offset,Y);return b.offset+=Y,x}function vt(t,b){var Y=t[b.offset];return Y<192&&Y>160||217===Y||218===Y||219===Y}function Bt(t,b){var Y=t[b.offset++];return Y<128?Y:202===Y?pt(t,b):203===Y?Wt(t,b):204===Y?tt(t,b):205===Y?Yt(t,b):206===Y?xt(t,b):207===Y?dt(t,b):208===Y?h(t,b):209===Y?bt(t,b):210===Y?ot(t,b):211===Y?Rt(t,b):Y>223?-1*(255-Y+1):void 0}function Jt(t,b){var Y=t[b.offset];return Y<128||Y>=202&&Y<=211}function mt(t,b){return t[b.offset]<160}function Kt(t,b){return t[b.offset-1]===r&&(t[b.offset]<128||t[b.offset]>=202&&t[b.offset]<=211)}var Lt=Object.freeze({__proto__:null,int8:h,uint8:tt,int16:bt,uint16:Yt,int32:ot,uint32:xt,float32:Ft,float64:rt,int64:Rt,uint64:dt,readFloat32:pt,readFloat64:Wt,boolean:Tt,string:yt,stringCheck:vt,number:Bt,numberCheck:Jt,arrayCheck:mt,switchStructureCheck:Kt}),zt=function(){function b(t){var b=this;this.$changes=new d(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,t&&t.forEach((function(t){return b.add(t)}))}return b.prototype.Kf=function(b,Y){return void 0===Y&&(Y=!0),E(this.$callbacks||(this.$callbacks=[]),t.OPERATION.ADD,b,Y?this.$items:void 0)},b.prototype.ab=function(b){return E(this.$callbacks||(this.$callbacks=[]),t.OPERATION.DELETE,b)},b.prototype.onChange=function(b){return E(this.$callbacks||(this.$callbacks=[]),t.OPERATION.REPLACE,b)},b.is=function(t){return void 0!==t.collection},b.prototype.add=function(t){var b=this.$refId++;return void 0!==t.$changes&&t.$changes.setParent(this,this.$changes.root,b),this.$changes.indexes[b]=b,this.$indexes.set(b,b),this.$items.set(b,t),this.$changes.change(b),b},b.prototype.at=function(t){var b=Array.from(this.$items.keys())[t];return this.$items.get(b)},b.prototype.entries=function(){return this.$items.entries()},b.prototype.delete=function(t){for(var b,Y,o=this.$items.entries();(Y=o.next())&&!Y.done;)if(t===Y.value[1]){b=Y.value[0];break}return void 0!==b&&(this.$changes.delete(b),this.$indexes.delete(b),this.$items.delete(b))},b.prototype.clear=function(b){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),b&&U.call(this,b),this.$items.clear(),this.$changes.operation({index:0,op:t.OPERATION.CLEAR}),this.$changes.touchParents()},b.prototype.has=function(t){return Array.from(this.$items.values()).some((function(b){return b===t}))},b.prototype.forEach=function(t){var b=this;this.$items.forEach((function(Y,o,x){return t(Y,o,b)}))},b.prototype.values=function(){return this.$items.values()},Object.defineProperty(b.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),b.prototype.setIndex=function(t,b){this.$indexes.set(t,b)},b.prototype.getIndex=function(t){return this.$indexes.get(t)},b.prototype.getByIndex=function(t){return this.$items.get(this.$indexes.get(t))},b.prototype.deleteByIndex=function(t){var b=this.$indexes.get(t);this.$items.delete(b),this.$indexes.delete(t)},b.prototype.toArray=function(){return Array.from(this.$items.values())},b.prototype.toJSON=function(){var t=[];return this.forEach((function(b,Y){t.push("function"===typeof b.toJSON?b.toJSON():b)})),t},b.prototype.clone=function(t){var Y;return t?Y=Object.assign(new b,this):(Y=new b,this.forEach((function(t){t.$changes?Y.add(t.clone()):Y.add(t)}))),Y},b}(),St=function(){function b(t){var b=this;this.$changes=new d(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,t&&t.forEach((function(t){return b.add(t)}))}return b.prototype.Kf=function(b,Y){return void 0===Y&&(Y=!0),E(this.$callbacks||(this.$callbacks=[]),t.OPERATION.ADD,b,Y?this.$items:void 0)},b.prototype.ab=function(b){return E(this.$callbacks||(this.$callbacks=[]),t.OPERATION.DELETE,b)},b.prototype.onChange=function(b){return E(this.$callbacks||(this.$callbacks=[]),t.OPERATION.REPLACE,b)},b.is=function(t){return void 0!==t.set},b.prototype.add=function(b){var Y,o;if(this.has(b))return!1;var x=this.$refId++;void 0!==b.$changes&&b.$changes.setParent(this,this.$changes.root,x);var F=null!==(o=null===(Y=this.$changes.indexes[x])||void 0===Y?void 0:Y.op)&&void 0!==o?o:t.OPERATION.ADD;return this.$changes.indexes[x]=x,this.$indexes.set(x,x),this.$items.set(x,b),this.$changes.change(x,F),x},b.prototype.entries=function(){return this.$items.entries()},b.prototype.delete=function(t){for(var b,Y,o=this.$items.entries();(Y=o.next())&&!Y.done;)if(t===Y.value[1]){b=Y.value[0];break}return void 0!==b&&(this.$changes.delete(b),this.$indexes.delete(b),this.$items.delete(b))},b.prototype.clear=function(b){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),b&&U.call(this,b),this.$items.clear(),this.$changes.operation({index:0,op:t.OPERATION.CLEAR}),this.$changes.touchParents()},b.prototype.has=function(t){for(var b,Y=this.$items.values(),o=!1;(b=Y.next())&&!b.done;)if(t===b.value){o=!0;break}return o},b.prototype.forEach=function(t){var b=this;this.$items.forEach((function(Y,o,x){return t(Y,o,b)}))},b.prototype.values=function(){return this.$items.values()},Object.defineProperty(b.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),b.prototype.setIndex=function(t,b){this.$indexes.set(t,b)},b.prototype.getIndex=function(t){return this.$indexes.get(t)},b.prototype.getByIndex=function(t){return this.$items.get(this.$indexes.get(t))},b.prototype.deleteByIndex=function(t){var b=this.$indexes.get(t);this.$items.delete(b),this.$indexes.delete(t)},b.prototype.toArray=function(){return Array.from(this.$items.values())},b.prototype.toJSON=function(){var t=[];return this.forEach((function(b,Y){t.push("function"===typeof b.toJSON?b.toJSON():b)})),t},b.prototype.clone=function(t){var Y;return t?Y=Object.assign(new b,this):(Y=new b,this.forEach((function(t){t.$changes?Y.add(t.clone()):Y.add(t)}))),Y},b}(),et=function(){function t(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return t.prototype.addRefId=function(t){this.refIds.has(t)||(this.refIds.add(t),this.containerIndexes.set(t,new Set))},t.get=function(b){return void 0===b.$filterState&&(b.$filterState=new t),b.$filterState},t}(),gt=function(){function t(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return t.prototype.getNextUniqueId=function(){return this.nextUniqueId++},t.prototype.addRef=function(t,b,Y){void 0===Y&&(Y=!0),this.refs.set(t,b),Y&&(this.refCounts[t]=(this.refCounts[t]||0)+1)},t.prototype.removeRef=function(t){this.refCounts[t]=this.refCounts[t]-1,this.deletedRefs.add(t)},t.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},t.prototype.garbageCollectDeletedRefs=function(){var t=this;this.deletedRefs.forEach((function(b){if(!(t.refCounts[b]>0)){var Y=t.refs.get(b);if(Y instanceof Qt)for(var o in Y._definition.schema)"string"!==typeof Y._definition.schema[o]&&Y[o]&&Y[o].$changes&&t.removeRef(Y[o].$changes.refId);else{var x=Y.$changes.parent._definition,F=x.schema[x.fieldsByIndex[Y.$changes.parentIndex]];"function"===typeof Object.values(F)[0]&&Array.from(Y.values()).forEach((function(b){return t.removeRef(b.$changes.refId)}))}t.refs.delete(b),delete t.refCounts[b]}})),this.deletedRefs.clear()},t}(),Dt=function(t){function b(){return null!==t&&t.apply(this,arguments)||this}return Y(b,t),b}(Error);function Ht(t,b,Y,o){var x,F=!1;switch(b){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":x="number",isNaN(t)&&console.log('trying to encode "NaN" in '.concat(Y.constructor.name,"#").concat(o));break;case"string":x="string",F=!0;break;case"boolean":return}if(typeof t!==x&&(!F||F&&null!==t)){var r="'".concat(JSON.stringify(t),"'").concat(t&&t.constructor&&" (".concat(t.constructor.name,")")||"");throw new Dt("a '".concat(x,"' was expected, but ").concat(r," was provided in ").concat(Y.constructor.name,"#").concat(o))}}function ft(t,b,Y,o){if(!(t instanceof b))throw new Dt("a '".concat(b.name,"' was expected, but '").concat(t.constructor.name,"' was provided in ").concat(Y.constructor.name,"#").concat(o))}function nt(t,b,Y,o,x){Ht(Y,t,o,x);var F=j[t];if(!F)throw new Dt("a '".concat(t,"' was expected, but ").concat(Y," was provided in ").concat(o.constructor.name,"#").concat(x));F(b,Y)}function Xt(t,b,Y){return Lt[t](b,Y)}var Qt=function(){function b(){for(var t=[],b=0;b<arguments.length;b++)t[b]=arguments[b];Object.defineProperties(this,{$changes:{value:new d(this,void 0,new gt),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var Y=this._definition.descriptors;Y&&Object.defineProperties(this,Y),t[0]&&this.assign(t[0])}return b.onError=function(t){console.error(t)},b.is=function(t){return t._definition&&void 0!==t._definition.schema},b.prototype.onChange=function(b){return E(this.$callbacks||(this.$callbacks=[]),t.OPERATION.REPLACE,b)},b.prototype.ab=function(b){return E(this.$callbacks||(this.$callbacks=[]),t.OPERATION.DELETE,b)},b.prototype.assign=function(t){return Object.assign(this,t),this},Object.defineProperty(b.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),b.prototype.setDirty=function(t,b){this.$changes.change(t,b)},b.prototype.listen=function(t,b,Y){var o=this;return void 0===Y&&(Y=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[t]||(this.$callbacks[t]=[]),this.$callbacks[t].push(b),Y&&void 0!==this[t]&&b(this[t],void 0),function(){return C(o.$callbacks[t],o.$callbacks[t].indexOf(b))}},b.prototype.decode=function(Y,o,x){var F;void 0===o&&(o={offset:0}),void 0===x&&(x=this);var R=[],d=this.$changes.root,E=Y.length,U=0;for(d.refs.set(U,this);o.offset<E;){var C=Y[o.offset++];if(C!=r){var p=x.$changes,W=void 0!==x._definition,y=W?C>>6<<6:C;if(y!==t.OPERATION.CLEAR){var B=W?C%(y||255):Bt(Y,o),J=W?x._definition.fieldsByIndex[B]:"",K=p.getType(B),L=void 0,z=void 0,S=void 0;if(W?z=x["_".concat(J)]:(z=x.getByIndex(B),(y&t.OPERATION.ADD)===t.OPERATION.ADD?(S=x instanceof v?yt(Y,o):B,x.setIndex(B,S)):S=x.getIndex(B)),(y&t.OPERATION.DELETE)===t.OPERATION.DELETE&&(y!==t.OPERATION.DELETE_AND_ADD&&x.deleteByIndex(B),z&&z.$changes&&d.removeRef(z.$changes.refId),L=null),void 0!==J){if(y===t.OPERATION.DELETE);else if(b.is(K)){var e=Bt(Y,o);if(L=d.refs.get(e),y!==t.OPERATION.REPLACE){var g=this.getSchemaType(Y,o,K);L||((L=this.createTypeInstance(g)).$changes.refId=e,z&&(L.$callbacks=z.$callbacks,z.$changes.refId&&e!==z.$changes.refId&&d.removeRef(z.$changes.refId))),d.addRef(e,L,L!==z)}}else if("string"===typeof K)L=Xt(K,Y,o);else{var D=m(Object.keys(K)[0]),H=Bt(Y,o),f=d.refs.has(H)?z||d.refs.get(H):new D.constructor;if((L=f.clone(!0)).$changes.refId=H,z&&(L.$callbacks=z.$callbacks,z.$changes.refId&&H!==z.$changes.refId)){d.removeRef(z.$changes.refId);for(var n=z.entries(),X=void 0;(X=n.next())&&!X.done;){var Q=(F=X.value)[0],N=F[1];R.push({refId:H,op:t.OPERATION.DELETE,field:Q,value:void 0,previousValue:N})}}d.addRef(H,L,f!==z)}if(null!==L&&void 0!==L)if(L.$changes&&L.$changes.setParent(p.ref,p.root,B),x instanceof b)x[J]=L;else if(x instanceof v)Q=S,x.$items.set(Q,L),x.$changes.allChanges.add(B);else if(x instanceof T)x.setAt(B,L);else if(x instanceof zt){var u=x.add(L);x.setIndex(B,u)}else x instanceof St&&!1!==(u=x.add(L))&&x.setIndex(B,u);z!==L&&R.push({refId:U,op:y,field:J,dynamicIndex:S,value:L,previousValue:z})}else{console.warn("@colyseus/schema: definition mismatch");for(var Z={offset:o.offset};o.offset<E&&(!Kt(Y,o)||(Z.offset=o.offset+1,!d.refs.has(Bt(Y,Z))));)o.offset++}}else x.clear(R)}else{U=Bt(Y,o);var a=d.refs.get(U);if(!a)throw new Error('"refId" not found: '.concat(U));x=a}}return this._triggerChanges(R),d.garbageCollectDeletedRefs(),R},b.prototype.encode=function(Y,o,x){void 0===Y&&(Y=!1),void 0===o&&(o=[]),void 0===x&&(x=!1);for(var F=this.$changes,R=new WeakSet,d=[F],E=1,U=0;U<E;U++){var C=d[U],p=C.ref,W=p instanceof b;C.ensureRefId(),R.add(C),C!==F&&(C.changed||Y)&&(N(o,r),O(o,C.refId));for(var T=Y?Array.from(C.allChanges):Array.from(C.changes.values()),y=0,B=T.length;y<B;y++){var J=Y?{op:t.OPERATION.ADD,index:T[y]}:T[y],K=J.index,L=W?p._definition.fieldsByIndex&&p._definition.fieldsByIndex[K]:K,z=o.length;if(J.op!==t.OPERATION.TOUCH)if(W)N(o,K|J.op);else{if(N(o,J.op),J.op===t.OPERATION.CLEAR)continue;O(o,K)}if(W||(J.op&t.OPERATION.ADD)!=t.OPERATION.ADD||p instanceof v&&q(o,C.ref.$indexes.get(K)),J.op!==t.OPERATION.DELETE){var S=C.getType(K),e=C.getValue(K);if(e&&e.$changes&&!R.has(e.$changes)&&(d.push(e.$changes),e.$changes.ensureRefId(),E++),J.op!==t.OPERATION.TOUCH){if(b.is(S))ft(e,S,p,L),O(o,e.$changes.refId),(J.op&t.OPERATION.ADD)===t.OPERATION.ADD&&this.tryEncodeTypeId(o,S,e.constructor);else if("string"===typeof S)nt(S,o,e,p,L);else{var g=m(Object.keys(S)[0]);ft(p["_".concat(L)],g.constructor,p,L),O(o,e.$changes.refId)}x&&C.cache(K,o.slice(z))}}}Y||x||C.discard()}return o},b.prototype.encodeAll=function(t){return this.encode(!0,[],t)},b.prototype.applyFilters=function(Y,o){var x,F;void 0===o&&(o=!1);for(var R=this,d=new Set,E=et.get(Y),U=[this.$changes],C=1,p=[],W=function(W){var T=U[W];if(d.has(T.refId))return"continue";var y=T.ref,B=y instanceof b;N(p,r),O(p,T.refId);var J=E.refIds.has(T),m=o||!J;E.addRefId(T);var K=E.containerIndexes.get(T),L=m?Array.from(T.allChanges):Array.from(T.changes.values());!o&&B&&y._definition.indexesWithFilters&&y._definition.indexesWithFilters.forEach((function(b){!K.has(b)&&T.allChanges.has(b)&&(m?L.push(b):L.push({op:t.OPERATION.ADD,index:b}))}));for(var z=0,S=L.length;z<S;z++){var e=m?{op:t.OPERATION.ADD,index:L[z]}:L[z];if(e.op!==t.OPERATION.CLEAR){var g=e.index;if(e.op!==t.OPERATION.DELETE){var D=T.getValue(g),H=T.getType(g);if(B){if((f=y._definition.filters&&y._definition.filters[g])&&!f.call(y,Y,D,R)){D&&D.$changes&&d.add(D.$changes.refId);continue}}else{var f,n=T.parent;if((f=T.getChildrenFilter())&&!f.call(n,Y,y.$indexes.get(g),D,R)){D&&D.$changes&&d.add(D.$changes.refId);continue}}if(D.$changes&&(U.push(D.$changes),C++),e.op!==t.OPERATION.TOUCH)if(e.op===t.OPERATION.ADD||B)p.push.apply(p,null!==(x=T.caches[g])&&void 0!==x?x:[]),K.add(g);else if(K.has(g))p.push.apply(p,null!==(F=T.caches[g])&&void 0!==F?F:[]);else{if(K.add(g),N(p,t.OPERATION.ADD),O(p,g),y instanceof v){var X=T.ref.$indexes.get(g);q(p,X)}D.$changes?O(p,D.$changes.refId):j[H](p,D)}else D.$changes&&!B&&(N(p,t.OPERATION.ADD),O(p,g),y instanceof v&&(X=T.ref.$indexes.get(g),q(p,X)),O(p,D.$changes.refId))}else B?N(p,e.op|g):(N(p,e.op),O(p,g))}else N(p,e.op)}},T=0;T<C;T++)W(T);return p},b.prototype.clone=function(){var t,b=new this.constructor,Y=this._definition.schema;for(var o in Y)"object"===typeof this[o]&&"function"===typeof(null===(t=this[o])||void 0===t?void 0:t.clone)?b[o]=this[o].clone():b[o]=this[o];return b},b.prototype.toJSON=function(){var t=this._definition.schema,b=this._definition.deprecated,Y={};for(var o in t)b[o]||null===this[o]||"undefined"===typeof this[o]||(Y[o]="function"===typeof this[o].toJSON?this[o].toJSON():this["_".concat(o)]);return Y},b.prototype.discardAllChanges=function(){this.$changes.discardAll()},b.prototype.getByIndex=function(t){return this[this._definition.fieldsByIndex[t]]},b.prototype.deleteByIndex=function(t){this[this._definition.fieldsByIndex[t]]=void 0},b.prototype.tryEncodeTypeId=function(t,b,Y){b._typeid!==Y._typeid&&(N(t,R),O(t,Y._typeid))},b.prototype.getSchemaType=function(t,b,Y){var o;return t[b.offset]===R&&(b.offset++,o=this.constructor._context.get(Bt(t,b))),o||Y},b.prototype.createTypeInstance=function(t){var b=new t;return b.$changes.root=this.$changes.root,b},b.prototype._triggerChanges=function(Y){for(var o,x,F,r,R,d,E,U,C,p=new Set,W=this.$changes.root.refs,T=function(T){var y=Y[T],v=y.refId,B=W.get(v),J=B.$callbacks;if((y.op&t.OPERATION.DELETE)===t.OPERATION.DELETE&&y.previousValue instanceof b&&(null===(x=null===(o=y.previousValue.$callbacks)||void 0===o?void 0:o[t.OPERATION.DELETE])||void 0===x||x.forEach((function(t){return t()}))),!J)return"continue";if(B instanceof b){if(!p.has(v))try{null===(F=null===J||void 0===J?void 0:J[t.OPERATION.REPLACE])||void 0===F||F.forEach((function(t){return t()}))}catch(m){b.onError(m)}try{J.hasOwnProperty(y.field)&&(null===(r=J[y.field])||void 0===r||r.forEach((function(t){return t(y.value,y.previousValue)})))}catch(m){b.onError(m)}}else y.op===t.OPERATION.ADD&&void 0===y.previousValue?null===(R=J[t.OPERATION.ADD])||void 0===R||R.forEach((function(t){var b;return t(y.value,null!==(b=y.dynamicIndex)&&void 0!==b?b:y.field)})):y.op===t.OPERATION.DELETE?void 0!==y.previousValue&&(null===(d=J[t.OPERATION.DELETE])||void 0===d||d.forEach((function(t){var b;return t(y.previousValue,null!==(b=y.dynamicIndex)&&void 0!==b?b:y.field)}))):y.op===t.OPERATION.DELETE_AND_ADD&&(void 0!==y.previousValue&&(null===(E=J[t.OPERATION.DELETE])||void 0===E||E.forEach((function(t){var b;return t(y.previousValue,null!==(b=y.dynamicIndex)&&void 0!==b?b:y.field)}))),null===(U=J[t.OPERATION.ADD])||void 0===U||U.forEach((function(t){var b;return t(y.value,null!==(b=y.dynamicIndex)&&void 0!==b?b:y.field)}))),y.value!==y.previousValue&&(null===(C=J[t.OPERATION.REPLACE])||void 0===C||C.forEach((function(t){var b;return t(y.value,null!==(b=y.dynamicIndex)&&void 0!==b?b:y.field)})));p.add(v)},y=0;y<Y.length;y++)T(y)},b._definition=K.create(),b}();function Nt(t){for(var b=[t.$changes],Y=1,o={},x=o,F=function(t){var Y=b[t];Y.changes.forEach((function(t){var b=Y.ref,o=t.index,F=b._definition?b._definition.fieldsByIndex[o]:b.$indexes.get(o);x[F]=Y.getValue(o)}))},r=0;r<Y;r++)F(r);return o}var ut={context:new z},Zt=function(t){function b(){return null!==t&&t.apply(this,arguments)||this}return Y(b,t),o([e("string",ut)],b.prototype,"name",void 0),o([e("string",ut)],b.prototype,"type",void 0),o([e("number",ut)],b.prototype,"referencedType",void 0),b}(Qt),at=function(t){function b(){var b=null!==t&&t.apply(this,arguments)||this;return b.fields=new T,b}return Y(b,t),o([e("number",ut)],b.prototype,"id",void 0),o([e([Zt],ut)],b.prototype,"fields",void 0),b}(Qt),At=function(t){function b(){var b=null!==t&&t.apply(this,arguments)||this;return b.types=new T,b}return Y(b,t),b.encode=function(t){var Y=t.constructor,o=new b;o.rootType=Y._typeid;var x=function(t,b){for(var Y in b){var x=new Zt;x.name=Y;var F=void 0;if("string"===typeof b[Y])F=b[Y];else{var r=b[Y],R=void 0;Qt.is(r)?(F="ref",R=b[Y]):"string"===typeof r[F=Object.keys(r)[0]]?F+=":"+r[F]:R=r[F],x.referencedType=R?R._typeid:-1}x.type=F,t.fields.push(x)}o.types.push(t)},F=Y._context.types;for(var r in F){var R=new at;R.id=Number(r),x(R,F[r]._definition.schema)}return o.encodeAll()},b.decode=function(t,o){var x=new z,F=new b;F.decode(t,o);var r=F.types.reduce((function(t,b){var o=function(t){function b(){return null!==t&&t.apply(this,arguments)||this}return Y(b,t),b}(Qt),F=b.id;return t[F]=o,x.add(o,F),t}),{});F.types.forEach((function(t){var b=r[t.id];t.fields.forEach((function(t){var Y;if(void 0!==t.referencedType){var o=t.type,F=r[t.referencedType];if(!F){var R=t.type.split(":");o=R[0],F=R[1]}"ref"===o?e(F,{context:x})(b.prototype,t.name):e(((Y={})[o]=F,Y),{context:x})(b.prototype,t.name)}else e(t.type,{context:x})(b.prototype,t.name)}))}));var R=r[F.rootType],d=new R;for(var E in R._definition.schema){var U=R._definition.schema[E];"string"!==typeof U&&(d[E]="function"===typeof U?new U:new(m(Object.keys(U)[0]).constructor))}return d},o([e([at],ut)],b.prototype,"types",void 0),o([e("number",ut)],b.prototype,"rootType",void 0),b}(Qt);J("map",{constructor:v}),J("array",{constructor:T}),J("set",{constructor:St}),J("collection",{constructor:zt}),t.ArraySchema=T,t.CollectionSchema=zt,t.Context=z,t.MapSchema=v,t.Reflection=At,t.ReflectionField=Zt,t.ReflectionType=at,t.Schema=Qt,t.SchemaDefinition=K,t.SetSchema=St,t.decode=Lt,t.defineTypes=f,t.deprecated=H,t.dumpChanges=Nt,t.encode=j,t.filter=g,t.filterChildren=D,t.hasFilter=L,t.registerType=J,t.type=e,Object.defineProperty(t,"__esModule",{value:!0})}(b)},12649:t=>{"use strict";t.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12640:(t,b,Y)=>{var o=Y(12649),x=Y(12656),F=Object.hasOwnProperty,r=Object.create(null);for(var R in o)F.call(o,R)&&(r[o[R]]=R);var d=t.exports={to:{},get:{}};function E(t,b,Y){return Math.min(Math.max(b,t),Y)}function U(t){var b=Math.round(t).toString(16).toUpperCase();return b.length<2?"0"+b:b}d.get=function(t){var b,Y;switch(t.substring(0,3).toLowerCase()){case"hsl":b=d.get.hsl(t),Y="hsl";break;case"hwb":b=d.get.hwb(t),Y="hwb";break;default:b=d.get.rgb(t),Y="rgb"}return b?{model:Y,value:b}:null},d.get.rgb=function(t){if(!t)return null;var b,Y,x,r=[0,0,0,1];if(b=t.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(x=b[2],b=b[1],Y=0;Y<3;Y++){var R=2*Y;r[Y]=parseInt(b.slice(R,R+2),16)}x&&(r[3]=parseInt(x,16)/255)}else if(b=t.match(/^#([a-f0-9]{3,4})$/i)){for(x=(b=b[1])[3],Y=0;Y<3;Y++)r[Y]=parseInt(b[Y]+b[Y],16);x&&(r[3]=parseInt(x+x,16)/255)}else if(b=t.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(Y=0;Y<3;Y++)r[Y]=parseInt(b[Y+1],0);b[4]&&(b[5]?r[3]=.01*parseFloat(b[4]):r[3]=parseFloat(b[4]))}else{if(!(b=t.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(b=t.match(/^(\w+)$/))?"transparent"===b[1]?[0,0,0,0]:F.call(o,b[1])?((r=o[b[1]])[3]=1,r):null:null;for(Y=0;Y<3;Y++)r[Y]=Math.round(2.55*parseFloat(b[Y+1]));b[4]&&(b[5]?r[3]=.01*parseFloat(b[4]):r[3]=parseFloat(b[4]))}for(Y=0;Y<3;Y++)r[Y]=E(r[Y],0,255);return r[3]=E(r[3],0,1),r},d.get.hsl=function(t){if(!t)return null;var b=t.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(b){var Y=parseFloat(b[4]);return[(parseFloat(b[1])%360+360)%360,E(parseFloat(b[2]),0,100),E(parseFloat(b[3]),0,100),E(isNaN(Y)?1:Y,0,1)]}return null},d.get.hwb=function(t){if(!t)return null;var b=t.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(b){var Y=parseFloat(b[4]);return[(parseFloat(b[1])%360+360)%360,E(parseFloat(b[2]),0,100),E(parseFloat(b[3]),0,100),E(isNaN(Y)?1:Y,0,1)]}return null},d.to.hex=function(){var t=x(arguments);return"#"+U(t[0])+U(t[1])+U(t[2])+(t[3]<1?U(Math.round(255*t[3])):"")},d.to.rgb=function(){var t=x(arguments);return t.length<4||1===t[3]?"rgb("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+")":"rgba("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+", "+t[3]+")"},d.to.rgb.percent=function(){var t=x(arguments),b=Math.round(t[0]/255*100),Y=Math.round(t[1]/255*100),o=Math.round(t[2]/255*100);return t.length<4||1===t[3]?"rgb("+b+"%, "+Y+"%, "+o+"%)":"rgba("+b+"%, "+Y+"%, "+o+"%, "+t[3]+")"},d.to.hsl=function(){var t=x(arguments);return t.length<4||1===t[3]?"hsl("+t[0]+", "+t[1]+"%, "+t[2]+"%)":"hsla("+t[0]+", "+t[1]+"%, "+t[2]+"%, "+t[3]+")"},d.to.hwb=function(){var t=x(arguments),b="";return t.length>=4&&1!==t[3]&&(b=", "+t[3]),"hwb("+t[0]+", "+t[1]+"%, "+t[2]+"%"+b+")"},d.to.keyword=function(t){return r[t.slice(0,3)]}},12632:(t,b,Y)=>{const o=Y(12640),x=Y(12664),F=["keyword","gray","hex"],r={};for(const W of Object.keys(x))r[[...x[W].labels].sort().join("")]=W;const R={};function d(t,b){if(!(this instanceof d))return new d(t,b);if(b&&b in F&&(b=null),b&&!(b in x))throw new Error("Unknown model: "+b);let Y,E;if(null==t)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(t instanceof d)this.model=t.model,this.color=[...t.color],this.valpha=t.valpha;else if("string"===typeof t){const b=o.get(t);if(null===b)throw new Error("Unable to parse color from string: "+t);this.model=b.model,E=x[this.model].channels,this.color=b.value.slice(0,E),this.valpha="number"===typeof b.value[E]?b.value[E]:1}else if(t.length>0){this.model=b||"rgb",E=x[this.model].channels;const Y=Array.prototype.slice.call(t,0,E);this.color=p(Y,E),this.valpha="number"===typeof t[E]?t[E]:1}else if("number"===typeof t)this.model="rgb",this.color=[t>>16&255,t>>8&255,255&t],this.valpha=1;else{this.valpha=1;const b=Object.keys(t);"alpha"in t&&(b.splice(b.indexOf("alpha"),1),this.valpha="number"===typeof t.alpha?t.alpha:0);const o=b.sort().join("");if(!(o in r))throw new Error("Unable to parse color from object: "+JSON.stringify(t));this.model=r[o];const{labels:F}=x[this.model],R=[];for(Y=0;Y<F.length;Y++)R.push(t[F[Y]]);this.color=p(R)}if(R[this.model])for(E=x[this.model].channels,Y=0;Y<E;Y++){const t=R[this.model][Y];t&&(this.color[Y]=t(this.color[Y]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}d.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(t){let b=this.model in o.to?this:this.rgb();b=b.round("number"===typeof t?t:1);const Y=1===b.valpha?b.color:[...b.color,this.valpha];return o.to[b.model](Y)},percentString(t){const b=this.rgb().round("number"===typeof t?t:1),Y=1===b.valpha?b.color:[...b.color,this.valpha];return o.to.rgb.percent(Y)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const t={},{channels:b}=x[this.model],{labels:Y}=x[this.model];for(let o=0;o<b;o++)t[Y[o]]=this.color[o];return 1!==this.valpha&&(t.alpha=this.valpha),t},unitArray(){const t=this.rgb().color;return t[0]/=255,t[1]/=255,t[2]/=255,1!==this.valpha&&t.push(this.valpha),t},unitObject(){const t=this.rgb().object();return t.r/=255,t.g/=255,t.b/=255,1!==this.valpha&&(t.alpha=this.valpha),t},round(t){return t=Math.max(t||0,0),new d([...this.color.map(E(t)),this.valpha],this.model)},alpha(t){return void 0!==t?new d([...this.color,Math.max(0,Math.min(1,t))],this.model):this.valpha},red:U("rgb",0,C(255)),green:U("rgb",1,C(255)),blue:U("rgb",2,C(255)),hue:U(["hsl","hsv","hsl","hwb","hcg"],0,(t=>(t%360+360)%360)),saturationl:U("hsl",1,C(100)),lightness:U("hsl",2,C(100)),saturationv:U("hsv",1,C(100)),value:U("hsv",2,C(100)),chroma:U("hcg",1,C(100)),gray:U("hcg",2,C(100)),white:U("hwb",1,C(100)),wblack:U("hwb",2,C(100)),cyan:U("cmyk",0,C(100)),magenta:U("cmyk",1,C(100)),yellow:U("cmyk",2,C(100)),black:U("cmyk",3,C(100)),x:U("xyz",0,C(95.047)),y:U("xyz",1,C(100)),z:U("xyz",2,C(108.833)),l:U("lab",0,C(100)),a:U("lab",1),b:U("lab",2),keyword(t){return void 0!==t?new d(t):x[this.model].keyword(this.color)},hex(t){return void 0!==t?new d(t):o.to.hex(this.rgb().round().color)},hexa(t){if(void 0!==t)return new d(t);const b=this.rgb().round().color;let Y=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===Y.length&&(Y="0"+Y),o.to.hex(b)+Y},rgbNumber(){const t=this.rgb().color;return(255&t[0])<<16|(255&t[1])<<8|255&t[2]},luminosity(){const t=this.rgb().color,b=[];for(const[Y,o]of t.entries()){const t=o/255;b[Y]=t<=.04045?t/12.92:((t+.055)/1.055)**2.4}return.2126*b[0]+.7152*b[1]+.0722*b[2]},contrast(t){const b=this.luminosity(),Y=t.luminosity();return b>Y?(b+.05)/(Y+.05):(Y+.05)/(b+.05)},level(t){const b=this.contrast(t);return b>=7?"AAA":b>=4.5?"AA":""},isDark(){const t=this.rgb().color;return(2126*t[0]+7152*t[1]+722*t[2])/1e4<128},isLight(){return!this.isDark()},negate(){const t=this.rgb();for(let b=0;b<3;b++)t.color[b]=255-t.color[b];return t},lighten(t){const b=this.hsl();return b.color[2]+=b.color[2]*t,b},darken(t){const b=this.hsl();return b.color[2]-=b.color[2]*t,b},saturate(t){const b=this.hsl();return b.color[1]+=b.color[1]*t,b},desaturate(t){const b=this.hsl();return b.color[1]-=b.color[1]*t,b},whiten(t){const b=this.hwb();return b.color[1]+=b.color[1]*t,b},blacken(t){const b=this.hwb();return b.color[2]+=b.color[2]*t,b},grayscale(){const t=this.rgb().color,b=.3*t[0]+.59*t[1]+.11*t[2];return d.rgb(b,b,b)},fade(t){return this.alpha(this.valpha-this.valpha*t)},opaquer(t){return this.alpha(this.valpha+this.valpha*t)},rotate(t){const b=this.hsl();let Y=b.color[0];return Y=(Y+t)%360,Y=Y<0?360+Y:Y,b.color[0]=Y,b},mix(t,b){if(!t||!t.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof t);const Y=t.rgb(),o=this.rgb(),x=void 0===b?.5:b,F=2*x-1,r=Y.alpha()-o.alpha(),R=((F*r===-1?F:(F+r)/(1+F*r))+1)/2,E=1-R;return d.rgb(R*Y.red()+E*o.red(),R*Y.green()+E*o.green(),R*Y.blue()+E*o.blue(),Y.alpha()*x+o.alpha()*(1-x))}};for(const W of Object.keys(x)){if(F.includes(W))continue;const{channels:t}=x[W];d.prototype[W]=function(){if(this.model===W)return new d(this);for(var t=arguments.length,b=new Array(t),Y=0;Y<t;Y++)b[Y]=arguments[Y];return b.length>0?new d(b,W):new d([...(o=x[this.model][W].raw(this.color),Array.isArray(o)?o:[o]),this.valpha],W);var o},d[W]=function(){for(var b=arguments.length,Y=new Array(b),o=0;o<b;o++)Y[o]=arguments[o];let x=Y[0];return"number"===typeof x&&(x=p(Y,t)),new d(x,W)}}function E(t){return function(b){return function(t,b){return Number(t.toFixed(b))}(b,t)}}function U(t,b,Y){t=Array.isArray(t)?t:[t];for(const o of t)(R[o]||(R[o]=[]))[b]=Y;return t=t[0],function(o){let x;return void 0!==o?(Y&&(o=Y(o)),x=this[t](),x.color[b]=o,x):(x=this[t]().color[b],Y&&(x=Y(x)),x)}}function C(t){return function(b){return Math.max(0,Math.min(t,b))}}function p(t,b){for(let Y=0;Y<b;Y++)"number"!==typeof t[Y]&&(t[Y]=0);return t}t.exports=d},12669:(t,b,Y)=>{const o=Y(12672),x={};for(const r of Object.keys(o))x[o[r]]=r;const F={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};t.exports=F;for(const r of Object.keys(F)){if(!("channels"in F[r]))throw new Error("missing channels property: "+r);if(!("labels"in F[r]))throw new Error("missing channel labels property: "+r);if(F[r].labels.length!==F[r].channels)throw new Error("channel and label counts mismatch: "+r);const{channels:t,labels:b}=F[r];delete F[r].channels,delete F[r].labels,Object.defineProperty(F[r],"channels",{value:t}),Object.defineProperty(F[r],"labels",{value:b})}F.rgb.hsl=function(t){const b=t[0]/255,Y=t[1]/255,o=t[2]/255,x=Math.min(b,Y,o),F=Math.max(b,Y,o),r=F-x;let R,d;F===x?R=0:b===F?R=(Y-o)/r:Y===F?R=2+(o-b)/r:o===F&&(R=4+(b-Y)/r),R=Math.min(60*R,360),R<0&&(R+=360);const E=(x+F)/2;return d=F===x?0:E<=.5?r/(F+x):r/(2-F-x),[R,100*d,100*E]},F.rgb.hsv=function(t){let b,Y,o,x,F;const r=t[0]/255,R=t[1]/255,d=t[2]/255,E=Math.max(r,R,d),U=E-Math.min(r,R,d),C=function(t){return(E-t)/6/U+.5};return 0===U?(x=0,F=0):(F=U/E,b=C(r),Y=C(R),o=C(d),r===E?x=o-Y:R===E?x=1/3+b-o:d===E&&(x=2/3+Y-b),x<0?x+=1:x>1&&(x-=1)),[360*x,100*F,100*E]},F.rgb.hwb=function(t){const b=t[0],Y=t[1];let o=t[2];const x=F.rgb.hsl(t)[0],r=1/255*Math.min(b,Math.min(Y,o));return o=1-1/255*Math.max(b,Math.max(Y,o)),[x,100*r,100*o]},F.rgb.cmyk=function(t){const b=t[0]/255,Y=t[1]/255,o=t[2]/255,x=Math.min(1-b,1-Y,1-o);return[100*((1-b-x)/(1-x)||0),100*((1-Y-x)/(1-x)||0),100*((1-o-x)/(1-x)||0),100*x]},F.rgb.keyword=function(t){const b=x[t];if(b)return b;let Y,F=1/0;for(const x of Object.keys(o)){const b=o[x],d=(R=b,((r=t)[0]-R[0])**2+(r[1]-R[1])**2+(r[2]-R[2])**2);d<F&&(F=d,Y=x)}var r,R;return Y},F.keyword.rgb=function(t){return o[t]},F.rgb.xyz=function(t){let b=t[0]/255,Y=t[1]/255,o=t[2]/255;b=b>.04045?((b+.055)/1.055)**2.4:b/12.92,Y=Y>.04045?((Y+.055)/1.055)**2.4:Y/12.92,o=o>.04045?((o+.055)/1.055)**2.4:o/12.92;return[100*(.4124*b+.3576*Y+.1805*o),100*(.2126*b+.7152*Y+.0722*o),100*(.0193*b+.1192*Y+.9505*o)]},F.rgb.lab=function(t){const b=F.rgb.xyz(t);let Y=b[0],o=b[1],x=b[2];Y/=95.047,o/=100,x/=108.883,Y=Y>.008856?Y**(1/3):7.787*Y+16/116,o=o>.008856?o**(1/3):7.787*o+16/116,x=x>.008856?x**(1/3):7.787*x+16/116;return[116*o-16,500*(Y-o),200*(o-x)]},F.hsl.rgb=function(t){const b=t[0]/360,Y=t[1]/100,o=t[2]/100;let x,F,r;if(0===Y)return r=255*o,[r,r,r];x=o<.5?o*(1+Y):o+Y-o*Y;const R=2*o-x,d=[0,0,0];for(let E=0;E<3;E++)F=b+1/3*-(E-1),F<0&&F++,F>1&&F--,r=6*F<1?R+6*(x-R)*F:2*F<1?x:3*F<2?R+(x-R)*(2/3-F)*6:R,d[E]=255*r;return d},F.hsl.hsv=function(t){const b=t[0];let Y=t[1]/100,o=t[2]/100,x=Y;const F=Math.max(o,.01);o*=2,Y*=o<=1?o:2-o,x*=F<=1?F:2-F;return[b,100*(0===o?2*x/(F+x):2*Y/(o+Y)),100*((o+Y)/2)]},F.hsv.rgb=function(t){const b=t[0]/60,Y=t[1]/100;let o=t[2]/100;const x=Math.floor(b)%6,F=b-Math.floor(b),r=255*o*(1-Y),R=255*o*(1-Y*F),d=255*o*(1-Y*(1-F));switch(o*=255,x){case 0:return[o,d,r];case 1:return[R,o,r];case 2:return[r,o,d];case 3:return[r,R,o];case 4:return[d,r,o];case 5:return[o,r,R]}},F.hsv.hsl=function(t){const b=t[0],Y=t[1]/100,o=t[2]/100,x=Math.max(o,.01);let F,r;r=(2-Y)*o;const R=(2-Y)*x;return F=Y*x,F/=R<=1?R:2-R,F=F||0,r/=2,[b,100*F,100*r]},F.hwb.rgb=function(t){const b=t[0]/360;let Y=t[1]/100,o=t[2]/100;const x=Y+o;let F;x>1&&(Y/=x,o/=x);const r=Math.floor(6*b),R=1-o;F=6*b-r,0!==(1&r)&&(F=1-F);const d=Y+F*(R-Y);let E,U,C;switch(r){default:case 6:case 0:E=R,U=d,C=Y;break;case 1:E=d,U=R,C=Y;break;case 2:E=Y,U=R,C=d;break;case 3:E=Y,U=d,C=R;break;case 4:E=d,U=Y,C=R;break;case 5:E=R,U=Y,C=d}return[255*E,255*U,255*C]},F.cmyk.rgb=function(t){const b=t[0]/100,Y=t[1]/100,o=t[2]/100,x=t[3]/100;return[255*(1-Math.min(1,b*(1-x)+x)),255*(1-Math.min(1,Y*(1-x)+x)),255*(1-Math.min(1,o*(1-x)+x))]},F.xyz.rgb=function(t){const b=t[0]/100,Y=t[1]/100,o=t[2]/100;let x,F,r;return x=3.2406*b+-1.5372*Y+-.4986*o,F=-.9689*b+1.8758*Y+.0415*o,r=.0557*b+-.204*Y+1.057*o,x=x>.0031308?1.055*x**(1/2.4)-.055:12.92*x,F=F>.0031308?1.055*F**(1/2.4)-.055:12.92*F,r=r>.0031308?1.055*r**(1/2.4)-.055:12.92*r,x=Math.min(Math.max(0,x),1),F=Math.min(Math.max(0,F),1),r=Math.min(Math.max(0,r),1),[255*x,255*F,255*r]},F.xyz.lab=function(t){let b=t[0],Y=t[1],o=t[2];b/=95.047,Y/=100,o/=108.883,b=b>.008856?b**(1/3):7.787*b+16/116,Y=Y>.008856?Y**(1/3):7.787*Y+16/116,o=o>.008856?o**(1/3):7.787*o+16/116;return[116*Y-16,500*(b-Y),200*(Y-o)]},F.lab.xyz=function(t){let b,Y,o;Y=(t[0]+16)/116,b=t[1]/500+Y,o=Y-t[2]/200;const x=Y**3,F=b**3,r=o**3;return Y=x>.008856?x:(Y-16/116)/7.787,b=F>.008856?F:(b-16/116)/7.787,o=r>.008856?r:(o-16/116)/7.787,b*=95.047,Y*=100,o*=108.883,[b,Y,o]},F.lab.lch=function(t){const b=t[0],Y=t[1],o=t[2];let x;x=360*Math.atan2(o,Y)/2/Math.PI,x<0&&(x+=360);return[b,Math.sqrt(Y*Y+o*o),x]},F.lch.lab=function(t){const b=t[0],Y=t[1],o=t[2]/360*2*Math.PI;return[b,Y*Math.cos(o),Y*Math.sin(o)]},F.rgb.ansi16=function(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[Y,o,x]=t;let r=null===b?F.rgb.hsv(t)[2]:b;if(r=Math.round(r/50),0===r)return 30;let R=30+(Math.round(x/255)<<2|Math.round(o/255)<<1|Math.round(Y/255));return 2===r&&(R+=60),R},F.hsv.ansi16=function(t){return F.rgb.ansi16(F.hsv.rgb(t),t[2])},F.rgb.ansi256=function(t){const b=t[0],Y=t[1],o=t[2];if(b===Y&&Y===o)return b<8?16:b>248?231:Math.round((b-8)/247*24)+232;return 16+36*Math.round(b/255*5)+6*Math.round(Y/255*5)+Math.round(o/255*5)},F.ansi16.rgb=function(t){let b=t%10;if(0===b||7===b)return t>50&&(b+=3.5),b=b/10.5*255,[b,b,b];const Y=.5*(1+~~(t>50));return[(1&b)*Y*255,(b>>1&1)*Y*255,(b>>2&1)*Y*255]},F.ansi256.rgb=function(t){if(t>=232){const b=10*(t-232)+8;return[b,b,b]}let b;t-=16;return[Math.floor(t/36)/5*255,Math.floor((b=t%36)/6)/5*255,b%6/5*255]},F.rgb.hex=function(t){const b=(((255&Math.round(t[0]))<<16)+((255&Math.round(t[1]))<<8)+(255&Math.round(t[2]))).toString(16).toUpperCase();return"000000".substring(b.length)+b},F.hex.rgb=function(t){const b=t.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!b)return[0,0,0];let Y=b[0];3===b[0].length&&(Y=Y.split("").map((t=>t+t)).join(""));const o=parseInt(Y,16);return[o>>16&255,o>>8&255,255&o]},F.rgb.hcg=function(t){const b=t[0]/255,Y=t[1]/255,o=t[2]/255,x=Math.max(Math.max(b,Y),o),F=Math.min(Math.min(b,Y),o),r=x-F;let R,d;return R=r<1?F/(1-r):0,d=r<=0?0:x===b?(Y-o)/r%6:x===Y?2+(o-b)/r:4+(b-Y)/r,d/=6,d%=1,[360*d,100*r,100*R]},F.hsl.hcg=function(t){const b=t[1]/100,Y=t[2]/100,o=Y<.5?2*b*Y:2*b*(1-Y);let x=0;return o<1&&(x=(Y-.5*o)/(1-o)),[t[0],100*o,100*x]},F.hsv.hcg=function(t){const b=t[1]/100,Y=t[2]/100,o=b*Y;let x=0;return o<1&&(x=(Y-o)/(1-o)),[t[0],100*o,100*x]},F.hcg.rgb=function(t){const b=t[0]/360,Y=t[1]/100,o=t[2]/100;if(0===Y)return[255*o,255*o,255*o];const x=[0,0,0],F=b%1*6,r=F%1,R=1-r;let d=0;switch(Math.floor(F)){case 0:x[0]=1,x[1]=r,x[2]=0;break;case 1:x[0]=R,x[1]=1,x[2]=0;break;case 2:x[0]=0,x[1]=1,x[2]=r;break;case 3:x[0]=0,x[1]=R,x[2]=1;break;case 4:x[0]=r,x[1]=0,x[2]=1;break;default:x[0]=1,x[1]=0,x[2]=R}return d=(1-Y)*o,[255*(Y*x[0]+d),255*(Y*x[1]+d),255*(Y*x[2]+d)]},F.hcg.hsv=function(t){const b=t[1]/100,Y=b+t[2]/100*(1-b);let o=0;return Y>0&&(o=b/Y),[t[0],100*o,100*Y]},F.hcg.hsl=function(t){const b=t[1]/100,Y=t[2]/100*(1-b)+.5*b;let o=0;return Y>0&&Y<.5?o=b/(2*Y):Y>=.5&&Y<1&&(o=b/(2*(1-Y))),[t[0],100*o,100*Y]},F.hcg.hwb=function(t){const b=t[1]/100,Y=b+t[2]/100*(1-b);return[t[0],100*(Y-b),100*(1-Y)]},F.hwb.hcg=function(t){const b=t[1]/100,Y=1-t[2]/100,o=Y-b;let x=0;return o<1&&(x=(Y-o)/(1-o)),[t[0],100*o,100*x]},F.apple.rgb=function(t){return[t[0]/65535*255,t[1]/65535*255,t[2]/65535*255]},F.rgb.apple=function(t){return[t[0]/255*65535,t[1]/255*65535,t[2]/255*65535]},F.gray.rgb=function(t){return[t[0]/100*255,t[0]/100*255,t[0]/100*255]},F.gray.hsl=function(t){return[0,0,t[0]]},F.gray.hsv=F.gray.hsl,F.gray.hwb=function(t){return[0,100,t[0]]},F.gray.cmyk=function(t){return[0,0,0,t[0]]},F.gray.lab=function(t){return[t[0],0,0]},F.gray.hex=function(t){const b=255&Math.round(t[0]/100*255),Y=((b<<16)+(b<<8)+b).toString(16).toUpperCase();return"000000".substring(Y.length)+Y},F.rgb.gray=function(t){return[(t[0]+t[1]+t[2])/3/255*100]}},12664:(t,b,Y)=>{const o=Y(12669),x=Y(12676),F={};Object.keys(o).forEach((t=>{F[t]={},Object.defineProperty(F[t],"channels",{value:o[t].channels}),Object.defineProperty(F[t],"labels",{value:o[t].labels});const b=x(t);Object.keys(b).forEach((Y=>{const o=b[Y];F[t][Y]=function(t){const b=function(){for(var b=arguments.length,Y=new Array(b),o=0;o<b;o++)Y[o]=arguments[o];const x=Y[0];if(void 0===x||null===x)return x;x.length>1&&(Y=x);const F=t(Y);if("object"===typeof F)for(let t=F.length,r=0;r<t;r++)F[r]=Math.round(F[r]);return F};return"conversion"in t&&(b.conversion=t.conversion),b}(o),F[t][Y].raw=function(t){const b=function(){for(var b=arguments.length,Y=new Array(b),o=0;o<b;o++)Y[o]=arguments[o];const x=Y[0];return void 0===x||null===x?x:(x.length>1&&(Y=x),t(Y))};return"conversion"in t&&(b.conversion=t.conversion),b}(o)}))})),t.exports=F},12676:(t,b,Y)=>{const o=Y(12669);function x(t){const b=function(){const t={},b=Object.keys(o);for(let Y=b.length,o=0;o<Y;o++)t[b[o]]={distance:-1,parent:null};return t}(),Y=[t];for(b[t].distance=0;Y.length;){const t=Y.pop(),x=Object.keys(o[t]);for(let o=x.length,F=0;F<o;F++){const o=x[F],r=b[o];-1===r.distance&&(r.distance=b[t].distance+1,r.parent=t,Y.unshift(o))}}return b}function F(t,b){return function(Y){return b(t(Y))}}function r(t,b){const Y=[b[t].parent,t];let x=o[b[t].parent][t],r=b[t].parent;for(;b[r].parent;)Y.unshift(b[r].parent),x=F(o[b[r].parent][r],x),r=b[r].parent;return x.conversion=Y,x}t.exports=function(t){const b=x(t),Y={},o=Object.keys(b);for(let x=o.length,F=0;F<x;F++){const t=o[F];null!==b[t].parent&&(Y[t]=r(t,b))}return Y}},12672:t=>{"use strict";t.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},11538:function(t,b,Y){"use strict";var o=this&&this.__createBinding||(Object.create?function(t,b,Y,o){void 0===o&&(o=Y);var x=Object.getOwnPropertyDescriptor(b,Y);x&&!("get"in x?!b.__esModule:x.writable||x.configurable)||(x={enumerable:!0,get:function(){return b[Y]}}),Object.defineProperty(t,o,x)}:function(t,b,Y,o){void 0===o&&(o=Y),t[o]=b[Y]}),x=this&&this.__setModuleDefault||(Object.create?function(t,b){Object.defineProperty(t,"default",{enumerable:!0,value:b})}:function(t,b){t.default=b}),F=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var b={};if(null!=t)for(var Y in t)"default"!==Y&&Object.prototype.hasOwnProperty.call(t,Y)&&o(b,t,Y);return x(b,t),b},r=this&&this.__awaiter||function(t,b,Y,o){return new(Y||(Y=Promise))((function(x,F){function r(t){try{d(o.next(t))}catch(b){F(b)}}function R(t){try{d(o.throw(t))}catch(b){F(b)}}function d(t){var b;t.done?x(t.value):(b=t.value,b instanceof Y?b:new Y((function(t){t(b)}))).then(r,R)}d((o=o.apply(t,b||[])).next())}))};Object.defineProperty(b,"__esModule",{value:!0}),b.Auth=b.Platform=void 0;const R=F(Y(11466)),d=Y(11541),E="colyseus-auth-token";!function(t){t.ios="ios",t.android="android"}(b.Platform||(b.Platform={}));b.Auth=class{constructor(t){this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=t.replace("ws","http"),(0,d.getItem)(E,(t=>this.token=t))}get hasToken(){return!!this.token}login(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r(this,void 0,void 0,(function*(){const b=Object.assign({},t);this.hasToken&&(b.token=this.token);const Y=yield this.request("post","/auth",b);this.token=Y.token,(0,d.setItem)(E,this.token);for(let t in Y)this.hasOwnProperty(t)&&(this[t]=Y[t]);return this.registerPingService(),this}))}save(){return r(this,void 0,void 0,(function*(){return yield this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone}),this}))}getFriends(){return r(this,void 0,void 0,(function*(){return yield this.request("get","/friends/all")}))}getOnlineFriends(){return r(this,void 0,void 0,(function*(){return yield this.request("get","/friends/online")}))}getFriendRequests(){return r(this,void 0,void 0,(function*(){return yield this.request("get","/friends/requests")}))}sendFriendRequest(t){return r(this,void 0,void 0,(function*(){return yield this.request("post","/friends/requests",{userId:t})}))}acceptFriendRequest(t){return r(this,void 0,void 0,(function*(){return yield this.request("put","/friends/requests",{userId:t})}))}declineFriendRequest(t){return r(this,void 0,void 0,(function*(){return yield this.request("del","/friends/requests",{userId:t})}))}blockUser(t){return r(this,void 0,void 0,(function*(){return yield this.request("post","/friends/block",{userId:t})}))}unblockUser(t){return r(this,void 0,void 0,(function*(){return yield this.request("put","/friends/block",{userId:t})}))}request(t,b){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3?arguments[3]:void 0,x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return r(this,void 0,void 0,(function*(){x.Accept="application/json",this.hasToken&&(x.Authorization="Bearer "+this.token);const F=[];for(const t in Y)F.push(`${t}=${Y[t]}`);const r=F.length>0?`?${F.join("&")}`:"",d={headers:x};return o&&(d.body=o),(yield R[t](`${this.endpoint}${b}${r}`,d)).data}))}logout(){this.token=void 0,(0,d.removeItem)(E),this.unregisterPingService()}registerPingService(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;this.unregisterPingService(),this.keepOnlineInterval=setInterval((()=>this.request("get","/auth")),t)}unregisterPingService(){clearInterval(this.keepOnlineInterval)}}},11464:function(t,b,Y){"use strict";var o,x=this&&this.__awaiter||function(t,b,Y,o){return new(Y||(Y=Promise))((function(x,F){function r(t){try{d(o.next(t))}catch(b){F(b)}}function R(t){try{d(o.throw(t))}catch(b){F(b)}}function d(t){var b;t.done?x(t.value):(b=t.value,b instanceof Y?b:new Y((function(t){t(b)}))).then(r,R)}d((o=o.apply(t,b||[])).next())}))};Object.defineProperty(b,"__esModule",{value:!0}),b.Client=b.MatchMakeError=void 0;const F=Y(11466),r=Y(11474),R=Y(11480);class d extends Error{constructor(t,b){super(t),this.code=b,Object.setPrototypeOf(this,d.prototype)}}b.MatchMakeError=d;const E="undefined"!==typeof window&&"undefined"!==typeof(null===(o=null===window||void 0===window?void 0:window.location)||void 0===o?void 0:o.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";b.Client=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:E;if("string"===typeof t){const b=new URL(t),Y="https:"===b.protocol||"wss:"===b.protocol,o=Number(b.port||(Y?443:80));this.settings={hostname:b.hostname,pathname:"/"!==b.pathname?b.pathname:"",port:o,secure:Y}}else void 0===t.port&&(t.port=t.secure?443:80),void 0===t.pathname&&(t.pathname=""),this.settings=t}joinOrCreate(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Y=arguments.length>2?arguments[2]:void 0;return x(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",t,b,Y)}))}create(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Y=arguments.length>2?arguments[2]:void 0;return x(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",t,b,Y)}))}join(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Y=arguments.length>2?arguments[2]:void 0;return x(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",t,b,Y)}))}joinById(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Y=arguments.length>2?arguments[2]:void 0;return x(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",t,b,Y)}))}reconnect(t,b){return x(this,void 0,void 0,(function*(){if("string"===typeof t&&"string"===typeof b)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[Y,o]=t.split(":");return yield this.createMatchMakeRequest("reconnect",Y,{reconnectionToken:o},b)}))}getAvailableRooms(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return x(this,void 0,void 0,(function*(){return(yield(0,F.get)(this.getHttpEndpoint(`${t}`),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(t,b,Y){return x(this,void 0,void 0,(function*(){const o=this.createRoom(t.room.name,b);o.roomId=t.room.roomId,o.sessionId=t.sessionId;const F={sessionId:o.sessionId};t.reconnectionToken&&(F.reconnectionToken=t.reconnectionToken);const R=Y||o;return o.connect(this.buildEndpoint(t.room,F),t.devMode&&(()=>x(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${o.roomId}'...`);let Y=0;const F=()=>x(this,void 0,void 0,(function*(){Y++;try{yield this.consumeSeatReservation(t,b,R),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${o.roomId}'`)}catch(x){Y<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${Y} out of 8)`),setTimeout(F,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(F,2e3)}))),R),new Promise(((t,b)=>{const Y=(t,Y)=>b(new r.ServerError(t,Y));R.onError.once(Y),R.onJoin.once((()=>{R.onError.remove(Y),t(R)}))}))}))}createMatchMakeRequest(t,b){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0;return x(this,void 0,void 0,(function*(){const x=(yield(0,F.post)(this.getHttpEndpoint(`${t}/${b}`),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(Y)})).data;if(x.error)throw new d(x.error,x.code);return"reconnect"===t&&(x.reconnectionToken=Y.reconnectionToken),yield this.consumeSeatReservation(x,o,r)}))}createRoom(t,b){return new R.Room(t,b)}buildEndpoint(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const Y=[];for(const x in b)b.hasOwnProperty(x)&&Y.push(`${x}=${b[x]}`);let o=this.settings.secure?"wss://":"ws://";return t.publicAddress?o+=`${t.publicAddress}`:o+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`,`${o}/${t.processId}/${t.roomId}?${Y.join("&")}`}getHttpEndpoint(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}/matchmake/${t}`}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},11496:(t,b,Y)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.Connection=void 0;const o=Y(11501);b.Connection=class{constructor(){this.events={},this.transport=new o.WebSocketTransport(this.events)}send(t){this.transport.send(t)}connect(t){this.transport.connect(t)}close(t,b){this.transport.close(t,b)}get isOpen(){return this.transport.isOpen}}},11512:(t,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.utf8Length=b.utf8Read=b.ErrorCode=b.Protocol=void 0,function(t){t[t.HANDSHAKE=9]="HANDSHAKE",t[t.JOIN_ROOM=10]="JOIN_ROOM",t[t.ERROR=11]="ERROR",t[t.LEAVE_ROOM=12]="LEAVE_ROOM",t[t.ROOM_DATA=13]="ROOM_DATA",t[t.ROOM_STATE=14]="ROOM_STATE",t[t.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",t[t.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",t[t.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(b.Protocol||(b.Protocol={})),function(t){t[t.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",t[t.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",t[t.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",t[t.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",t[t.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",t[t.AUTH_FAILED=4215]="AUTH_FAILED",t[t.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(b.ErrorCode||(b.ErrorCode={})),b.utf8Read=function(t,b){const Y=t[b++];for(var o="",x=0,F=b,r=b+Y;F<r;F++){var R=t[F];if(0!==(128&R))if(192!==(224&R))if(224!==(240&R)){if(240!==(248&R))throw new Error("Invalid byte "+R.toString(16));(x=(7&R)<<18|(63&t[++F])<<12|(63&t[++F])<<6|63&t[++F])>=65536?(x-=65536,o+=String.fromCharCode(55296+(x>>>10),56320+(1023&x))):o+=String.fromCharCode(x)}else o+=String.fromCharCode((15&R)<<12|(63&t[++F])<<6|63&t[++F]);else o+=String.fromCharCode((31&R)<<6|63&t[++F]);else o+=String.fromCharCode(R)}return o},b.utf8Length=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",b=0,Y=0;for(let o=0,x=t.length;o<x;o++)b=t.charCodeAt(o),b<128?Y+=1:b<2048?Y+=2:b<55296||b>=57344?Y+=3:(o++,Y+=4);return Y+1}},11480:function(t,b,Y){"use strict";var o=this&&this.__createBinding||(Object.create?function(t,b,Y,o){void 0===o&&(o=Y);var x=Object.getOwnPropertyDescriptor(b,Y);x&&!("get"in x?!b.__esModule:x.writable||x.configurable)||(x={enumerable:!0,get:function(){return b[Y]}}),Object.defineProperty(t,o,x)}:function(t,b,Y,o){void 0===o&&(o=Y),t[o]=b[Y]}),x=this&&this.__setModuleDefault||(Object.create?function(t,b){Object.defineProperty(t,"default",{enumerable:!0,value:b})}:function(t,b){t.default=b}),F=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var b={};if(null!=t)for(var Y in t)"default"!==Y&&Object.prototype.hasOwnProperty.call(t,Y)&&o(b,t,Y);return x(b,t),b};Object.defineProperty(b,"__esModule",{value:!0}),b.Room=void 0;const r=F(Y(11488)),R=Y(11496),d=Y(11512),E=Y(11518),U=Y(11524),C=Y(11527),p=Y(11536),W=Y(11474);class T{constructor(t,b){this.onStateChange=(0,C.createSignal)(),this.onError=(0,C.createSignal)(),this.onLeave=(0,C.createSignal)(),this.onJoin=(0,C.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,U.createNanoEvents)(),this.roomId=null,this.name=t,b&&(this.serializer=new((0,E.getSerializer)("schema")),this.rootSchema=b,this.serializer.state=new b),this.onError(((t,b)=>{var Y;return null===(Y=console.warn)||void 0===Y?void 0:Y.call(console,`colyseus.js - onError => (${t}) ${b}`)})),this.onLeave((()=>this.removeAllListeners()))}get id(){return this.roomId}connect(t,b){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;const o=new R.Connection;Y.connection=o,o.events.onmessage=T.prototype.onMessageCallback.bind(Y),o.events.onclose=function(t){var o;if(!Y.hasJoined)return null===(o=console.warn)||void 0===o||o.call(console,`Room connection was closed unexpectedly (${t.code}): ${t.reason}`),void Y.onError.invoke(t.code,t.reason);t.code===W.CloseCode.DEVMODE_RESTART&&b?b():(Y.onLeave.invoke(t.code),Y.destroy())},o.events.onerror=function(t){var b;null===(b=console.warn)||void 0===b||b.call(console,`Room, onError (${t.code}): ${t.reason}`),Y.onError.invoke(t.code,t.reason)},o.connect(t)}leave(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((b=>{this.onLeave((t=>b(t))),this.connection?t?this.connection.send([d.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(W.CloseCode.CONSENTED)}))}onMessage(t,b){return this.onMessageHandlers.on(this.getMessageHandlerKey(t),b)}send(t,b){const Y=[d.Protocol.ROOM_DATA];let o;if("string"===typeof t?p.encode.string(Y,t):p.encode.number(Y,t),void 0!==b){const t=r.encode(b);o=new Uint8Array(Y.length+t.byteLength),o.set(new Uint8Array(Y),0),o.set(new Uint8Array(t),Y.length)}else o=new Uint8Array(Y);this.connection.send(o.buffer)}sendBytes(t,b){const Y=[d.Protocol.ROOM_DATA_BYTES];let o;"string"===typeof t?p.encode.string(Y,t):p.encode.number(Y,t),o=new Uint8Array(Y.length+(b.byteLength||b.length)),o.set(new Uint8Array(Y),0),o.set(new Uint8Array(b),Y.length),this.connection.send(o.buffer)}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(t){const b=Array.from(new Uint8Array(t.data)),Y=b[0];if(Y===d.Protocol.JOIN_ROOM){let t=1;const Y=(0,d.utf8Read)(b,t);if(t+=(0,d.utf8Length)(Y),this.serializerId=(0,d.utf8Read)(b,t),t+=(0,d.utf8Length)(this.serializerId),!this.serializer){const t=(0,E.getSerializer)(this.serializerId);this.serializer=new t}b.length>t&&this.serializer.handshake&&this.serializer.handshake(b,{offset:t}),this.reconnectionToken=`${this.roomId}:${Y}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([d.Protocol.JOIN_ROOM])}else if(Y===d.Protocol.ERROR){const t={offset:1},Y=p.decode.number(b,t),o=p.decode.string(b,t);this.onError.invoke(Y,o)}else if(Y===d.Protocol.LEAVE_ROOM)this.leave();else if(Y===d.Protocol.ROOM_DATA_SCHEMA){const t={offset:1},Y=this.serializer.getState().constructor._context.get(p.decode.number(b,t)),o=new Y;o.decode(b,t),this.dispatchMessage(Y,o)}else if(Y===d.Protocol.ROOM_STATE)b.shift(),this.setState(b);else if(Y===d.Protocol.ROOM_STATE_PATCH)b.shift(),this.patch(b);else if(Y===d.Protocol.ROOM_DATA){const Y={offset:1},o=p.decode.stringCheck(b,Y)?p.decode.string(b,Y):p.decode.number(b,Y),x=b.length>Y.offset?r.decode(t.data,Y.offset):void 0;this.dispatchMessage(o,x)}else if(Y===d.Protocol.ROOM_DATA_BYTES){const t={offset:1},Y=p.decode.stringCheck(b,t)?p.decode.string(b,t):p.decode.number(b,t);this.dispatchMessage(Y,new Uint8Array(b.slice(t.offset)))}}setState(t){this.serializer.setState(t),this.onStateChange.invoke(this.serializer.getState())}patch(t){this.serializer.patch(t),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(t,b){var Y;const o=this.getMessageHandlerKey(t);this.onMessageHandlers.events[o]?this.onMessageHandlers.emit(o,b):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",t,b):null===(Y=console.warn)||void 0===Y||Y.call(console,`colyseus.js: onMessage() not registered for type '${t}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(t){switch(typeof t){case"function":return`$${t._typeid}`;case"string":return t;case"number":return`i${t}`;default:throw new Error("invalid message type.")}}}b.Room=T},11541:(t,b)=>{"use strict";let Y;function o(){return Y||(Y="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!==typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(t,b){this.cache[t]=b},getItem:function(t){this.cache[t]},removeItem:function(t){delete this.cache[t]}}),Y}Object.defineProperty(b,"__esModule",{value:!0}),b.getItem=b.removeItem=b.setItem=void 0,b.setItem=function(t,b){o().setItem(t,b)},b.removeItem=function(t){o().removeItem(t)},b.getItem=function(t,b){const Y=o().getItem(t);"undefined"!==typeof Promise&&Y instanceof Promise?Y.then((t=>b(t))):b(Y)}},11524:(t,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.createNanoEvents=void 0;b.createNanoEvents=()=>({emit(t){let b=this.events[t]||[];for(var Y=arguments.length,o=new Array(Y>1?Y-1:0),x=1;x<Y;x++)o[x-1]=arguments[x];for(let F=0,r=b.length;F<r;F++)b[F](...o)},events:{},on(t,b){var Y;return(null===(Y=this.events[t])||void 0===Y?void 0:Y.push(b))||(this.events[t]=[b]),()=>{var Y;this.events[t]=null===(Y=this.events[t])||void 0===Y?void 0:Y.filter((t=>b!==t))}}})},11527:(t,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.createSignal=b.EventEmitter=void 0;class Y{constructor(){this.handlers=[]}register(t){return this.handlers.push(t),this}invoke(){for(var t=arguments.length,b=new Array(t),Y=0;Y<t;Y++)b[Y]=arguments[Y];this.handlers.forEach((t=>t.apply(this,b)))}invokeAsync(){for(var t=arguments.length,b=new Array(t),Y=0;Y<t;Y++)b[Y]=arguments[Y];return Promise.all(this.handlers.map((t=>t.apply(this,b))))}remove(t){const b=this.handlers.indexOf(t);this.handlers[b]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}b.EventEmitter=Y,b.createSignal=function(){const t=new Y;function b(b){return t.register(b,null===this)}return b.once=b=>{const Y=function(){for(var o=arguments.length,x=new Array(o),F=0;F<o;F++)x[F]=arguments[F];b.apply(this,x),t.remove(Y)};t.register(Y)},b.remove=b=>t.remove(b),b.invoke=function(){return t.invoke(...arguments)},b.invokeAsync=function(){return t.invokeAsync(...arguments)},b.clear=()=>t.clear(),b}},11474:(t,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.ServerError=b.CloseCode=void 0,function(t){t[t.CONSENTED=4e3]="CONSENTED",t[t.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(b.CloseCode||(b.CloseCode={}));class Y extends Error{constructor(t,b){super(b),this.name="ServerError",this.code=t}}b.ServerError=Y},11456:(t,b,Y)=>{"use strict";b.c=void 0,Y(11460);var o=Y(11464);Object.defineProperty(b,"c",{enumerable:!0,get:function(){return o.Client}});var x=Y(11512);var F=Y(11480);var r=Y(11538);const R=Y(11550);const d=Y(11555),E=Y(11518);(0,E.registerSerializer)("schema",R.SchemaSerializer),(0,E.registerSerializer)("none",d.NoneSerializer)},11460:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=t=>null!==t&&"object"===typeof t&&t.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},11488:(t,b)=>{"use strict";function Y(t,b){if(this._offset=b,t instanceof ArrayBuffer)this._buffer=t,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(t))throw new Error("Invalid argument");this._buffer=t.buffer,this._view=new DataView(this._buffer,t.byteOffset,t.byteLength)}}Object.defineProperty(b,"__esModule",{value:!0}),b.decode=b.encode=void 0,Y.prototype._array=function(t){for(var b=new Array(t),Y=0;Y<t;Y++)b[Y]=this._parse();return b},Y.prototype._map=function(t){for(var b={},Y=0;Y<t;Y++)b[this._parse()]=this._parse();return b},Y.prototype._str=function(t){var b=function(t,b,Y){for(var o="",x=0,F=b,r=b+Y;F<r;F++){var R=t.getUint8(F);if(0!==(128&R))if(192!==(224&R))if(224!==(240&R)){if(240!==(248&R))throw new Error("Invalid byte "+R.toString(16));(x=(7&R)<<18|(63&t.getUint8(++F))<<12|(63&t.getUint8(++F))<<6|63&t.getUint8(++F))>=65536?(x-=65536,o+=String.fromCharCode(55296+(x>>>10),56320+(1023&x))):o+=String.fromCharCode(x)}else o+=String.fromCharCode((15&R)<<12|(63&t.getUint8(++F))<<6|63&t.getUint8(++F));else o+=String.fromCharCode((31&R)<<6|63&t.getUint8(++F));else o+=String.fromCharCode(R)}return o}(this._view,this._offset,t);return this._offset+=t,b},Y.prototype._bin=function(t){var b=this._buffer.slice(this._offset,this._offset+t);return this._offset+=t,b},Y.prototype._parse=function(){var t,b=this._view.getUint8(this._offset++),Y=0,o=0,x=0,F=0;if(b<192)return b<128?b:b<144?this._map(15&b):b<160?this._array(15&b):this._str(31&b);if(b>223)return-1*(255-b+1);switch(b){case 192:return null;case 194:return!1;case 195:return!0;case 196:return Y=this._view.getUint8(this._offset),this._offset+=1,this._bin(Y);case 197:return Y=this._view.getUint16(this._offset),this._offset+=2,this._bin(Y);case 198:return Y=this._view.getUint32(this._offset),this._offset+=4,this._bin(Y);case 199:if(Y=this._view.getUint8(this._offset),o=this._view.getInt8(this._offset+1),this._offset+=2,-1===o){var r=this._view.getUint32(this._offset);return x=this._view.getInt32(this._offset+4),F=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*x+F)+r/1e6)}return[o,this._bin(Y)];case 200:return Y=this._view.getUint16(this._offset),o=this._view.getInt8(this._offset+2),this._offset+=3,[o,this._bin(Y)];case 201:return Y=this._view.getUint32(this._offset),o=this._view.getInt8(this._offset+4),this._offset+=5,[o,this._bin(Y)];case 202:return t=this._view.getFloat32(this._offset),this._offset+=4,t;case 203:return t=this._view.getFloat64(this._offset),this._offset+=8,t;case 204:return t=this._view.getUint8(this._offset),this._offset+=1,t;case 205:return t=this._view.getUint16(this._offset),this._offset+=2,t;case 206:return t=this._view.getUint32(this._offset),this._offset+=4,t;case 207:return x=this._view.getUint32(this._offset)*Math.pow(2,32),F=this._view.getUint32(this._offset+4),this._offset+=8,x+F;case 208:return t=this._view.getInt8(this._offset),this._offset+=1,t;case 209:return t=this._view.getInt16(this._offset),this._offset+=2,t;case 210:return t=this._view.getInt32(this._offset),this._offset+=4,t;case 211:return x=this._view.getInt32(this._offset)*Math.pow(2,32),F=this._view.getUint32(this._offset+4),this._offset+=8,x+F;case 212:return o=this._view.getInt8(this._offset),this._offset+=1,0===o?void(this._offset+=1):[o,this._bin(1)];case 213:return o=this._view.getInt8(this._offset),this._offset+=1,[o,this._bin(2)];case 214:return o=this._view.getInt8(this._offset),this._offset+=1,-1===o?(t=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*t)):[o,this._bin(4)];case 215:return o=this._view.getInt8(this._offset),this._offset+=1,0===o?(x=this._view.getInt32(this._offset)*Math.pow(2,32),F=this._view.getUint32(this._offset+4),this._offset+=8,new Date(x+F)):-1===o?(x=this._view.getUint32(this._offset),F=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&x)+F)+(x>>>2)/1e6)):[o,this._bin(8)];case 216:return o=this._view.getInt8(this._offset),this._offset+=1,[o,this._bin(16)];case 217:return Y=this._view.getUint8(this._offset),this._offset+=1,this._str(Y);case 218:return Y=this._view.getUint16(this._offset),this._offset+=2,this._str(Y);case 219:return Y=this._view.getUint32(this._offset),this._offset+=4,this._str(Y);case 220:return Y=this._view.getUint16(this._offset),this._offset+=2,this._array(Y);case 221:return Y=this._view.getUint32(this._offset),this._offset+=4,this._array(Y);case 222:return Y=this._view.getUint16(this._offset),this._offset+=2,this._map(Y);case 223:return Y=this._view.getUint32(this._offset),this._offset+=4,this._map(Y)}throw new Error("Could not parse")},b.decode=function(t){var b=new Y(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),o=b._parse();if(b._offset!==t.byteLength)throw new Error(t.byteLength-b._offset+" trailing bytes");return o};function o(t,b,Y){for(var o=0,x=0,F=Y.length;x<F;x++)(o=Y.charCodeAt(x))<128?t.setUint8(b++,o):o<2048?(t.setUint8(b++,192|o>>6),t.setUint8(b++,128|63&o)):o<55296||o>=57344?(t.setUint8(b++,224|o>>12),t.setUint8(b++,128|o>>6&63),t.setUint8(b++,128|63&o)):(x++,o=65536+((1023&o)<<10|1023&Y.charCodeAt(x)),t.setUint8(b++,240|o>>18),t.setUint8(b++,128|o>>12&63),t.setUint8(b++,128|o>>6&63),t.setUint8(b++,128|63&o))}function x(t,b,Y){var o=typeof Y,F=0,r=0,R=0,d=0,E=0,U=0;if("string"===o){if(E=function(t){for(var b=0,Y=0,o=0,x=t.length;o<x;o++)(b=t.charCodeAt(o))<128?Y+=1:b<2048?Y+=2:b<55296||b>=57344?Y+=3:(o++,Y+=4);return Y}(Y),E<32)t.push(160|E),U=1;else if(E<256)t.push(217,E),U=2;else if(E<65536)t.push(218,E>>8,E),U=3;else{if(!(E<4294967296))throw new Error("String too long");t.push(219,E>>24,E>>16,E>>8,E),U=5}return b.push({_str:Y,_length:E,_offset:t.length}),U+E}if("number"===o)return Math.floor(Y)===Y&&isFinite(Y)?Y>=0?Y<128?(t.push(Y),1):Y<256?(t.push(204,Y),2):Y<65536?(t.push(205,Y>>8,Y),3):Y<4294967296?(t.push(206,Y>>24,Y>>16,Y>>8,Y),5):(R=Y/Math.pow(2,32)|0,d=Y>>>0,t.push(207,R>>24,R>>16,R>>8,R,d>>24,d>>16,d>>8,d),9):Y>=-32?(t.push(Y),1):Y>=-128?(t.push(208,Y),2):Y>=-32768?(t.push(209,Y>>8,Y),3):Y>=-2147483648?(t.push(210,Y>>24,Y>>16,Y>>8,Y),5):(R=Math.floor(Y/Math.pow(2,32)),d=Y>>>0,t.push(211,R>>24,R>>16,R>>8,R,d>>24,d>>16,d>>8,d),9):(t.push(203),b.push({_float:Y,_length:8,_offset:t.length}),9);if("object"===o){if(null===Y)return t.push(192),1;if(Array.isArray(Y)){if((E=Y.length)<16)t.push(144|E),U=1;else if(E<65536)t.push(220,E>>8,E),U=3;else{if(!(E<4294967296))throw new Error("Array too large");t.push(221,E>>24,E>>16,E>>8,E),U=5}for(F=0;F<E;F++)U+=x(t,b,Y[F]);return U}if(Y instanceof Date){var C=Y.getTime(),p=Math.floor(C/1e3),W=1e6*(C-1e3*p);return p>=0&&W>=0&&p<=17179869183?0===W&&p<=4294967295?(t.push(214,255,p>>24,p>>16,p>>8,p),6):(R=p/4294967296,d=4294967295&p,t.push(215,255,W>>22,W>>14,W>>6,R,d>>24,d>>16,d>>8,d),10):(R=Math.floor(p/4294967296),d=p>>>0,t.push(199,12,255,W>>24,W>>16,W>>8,W,R>>24,R>>16,R>>8,R,d>>24,d>>16,d>>8,d),15)}if(Y instanceof ArrayBuffer){if((E=Y.byteLength)<256)t.push(196,E),U=2;else if(E<65536)t.push(197,E>>8,E),U=3;else{if(!(E<4294967296))throw new Error("Buffer too large");t.push(198,E>>24,E>>16,E>>8,E),U=5}return b.push({_bin:Y,_length:E,_offset:t.length}),U+E}if("function"===typeof Y.toJSON)return x(t,b,Y.toJSON());var T=[],y="",v=Object.keys(Y);for(F=0,r=v.length;F<r;F++)void 0!==Y[y=v[F]]&&"function"!==typeof Y[y]&&T.push(y);if((E=T.length)<16)t.push(128|E),U=1;else if(E<65536)t.push(222,E>>8,E),U=3;else{if(!(E<4294967296))throw new Error("Object too large");t.push(223,E>>24,E>>16,E>>8,E),U=5}for(F=0;F<E;F++)U+=x(t,b,y=T[F]),U+=x(t,b,Y[y]);return U}if("boolean"===o)return t.push(Y?195:194),1;if("undefined"===o)return t.push(192),1;if("function"===typeof Y.toJSON)return x(t,b,Y.toJSON());throw new Error("Could not encode")}b.encode=function(t){var b=[],Y=[],F=x(b,Y,t),r=new ArrayBuffer(F),R=new DataView(r),d=0,E=0,U=-1;Y.length>0&&(U=Y[0]._offset);for(var C,p=0,W=0,T=0,y=b.length;T<y;T++)if(R.setUint8(E+T,b[T]),T+1===U){if(p=(C=Y[d])._length,W=E+U,C._bin)for(var v=new Uint8Array(C._bin),B=0;B<p;B++)R.setUint8(W+B,v[B]);else C._str?o(R,W,C._str):void 0!==C._float&&R.setFloat64(W,C._float);E+=p,Y[++d]&&(U=Y[d]._offset)}return r}},11555:(t,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.NoneSerializer=void 0;b.NoneSerializer=class{setState(t){}getState(){return null}patch(t){}teardown(){}handshake(t){}}},11550:(t,b,Y)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.SchemaSerializer=void 0;const o=Y(11536);b.SchemaSerializer=class{setState(t){return this.state.decode(t)}getState(){return this.state}patch(t){return this.state.decode(t)}teardown(){var t,b;null===(b=null===(t=this.state)||void 0===t?void 0:t.$changes)||void 0===b||b.root.clearRefs()}handshake(t,b){if(this.state){(new o.Reflection).decode(t,b)}else this.state=o.Reflection.decode(t,b)}}},11518:(t,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.getSerializer=b.registerSerializer=void 0;const Y={};b.registerSerializer=function(t,b){Y[t]=b},b.getSerializer=function(t){const b=Y[t];if(!b)throw new Error("missing serializer: "+t);return b}},11501:function(t,b,Y){"use strict";var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(b,"__esModule",{value:!0}),b.WebSocketTransport=void 0;const x=o(Y(11505)),F=globalThis.WebSocket||x.default;b.WebSocketTransport=class{constructor(t){this.events=t}send(t){t instanceof ArrayBuffer?this.ws.send(t):Array.isArray(t)&&this.ws.send(new Uint8Array(t).buffer)}connect(t){this.ws=new F(t,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(t,b){this.ws.close(t,b)}get isOpen(){return this.ws.readyState===F.OPEN}}},11505:t=>{"use strict";t.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},11602:t=>{"use strict";t.exports=function(t){for(var b=new Array(t),Y=0;Y<t;++Y)b[Y]=Y;return b}},11611:t=>{function b(t){return!!t.constructor&&"function"===typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}t.exports=function(t){return null!=t&&(b(t)||function(t){return"function"===typeof t.readFloatLE&&"function"===typeof t.slice&&b(t.slice(0,0))}(t)||!!t._isBuffer)}},11594:(t,b,Y)=>{var o=Y(11602),x=Y(11611),F="undefined"!==typeof Float64Array;function r(t,b){return t[0]-b[0]}function R(){var t,b=this.stride,Y=new Array(b.length);for(t=0;t<Y.length;++t)Y[t]=[Math.abs(b[t]),t];Y.sort(r);var o=new Array(Y.length);for(t=0;t<o.length;++t)o[t]=Y[t][1];return o}function d(t,b){var Y=["View",b,"d",t].join("");b<0&&(Y="View_Nil"+t);var x="generic"===t;if(-1===b){var F="function "+Y+"(a){this.data=a;};var proto="+Y+".prototype;proto.dtype='"+t+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+Y+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+Y+"(a){return new "+Y+"(a);}";return new Function(F)()}if(0===b){F="function "+Y+"(a,d) {this.data = a;this.offset = d};var proto="+Y+".prototype;proto.dtype='"+t+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+Y+"_copy() {return new "+Y+"(this.data,this.offset)};proto.pick=function "+Y+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+Y+"_get(){return "+(x?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+Y+"_set(v){return "+(x?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+Y+"(a,b,c,d){return new "+Y+"(a,d)}";return new Function("TrivialArray",F)(E[t][0])}F=["'use strict'"];var r=o(b),d=r.map((function(t){return"i"+t})),U="this.offset+"+r.map((function(t){return"this.stride["+t+"]*i"+t})).join("+"),C=r.map((function(t){return"b"+t})).join(","),p=r.map((function(t){return"c"+t})).join(",");F.push("function "+Y+"(a,"+C+","+p+",d){this.data=a","this.shape=["+C+"]","this.stride=["+p+"]","this.offset=d|0}","var proto="+Y+".prototype","proto.dtype='"+t+"'","proto.dimension="+b),F.push("Object.defineProperty(proto,'size',{get:function "+Y+"_size(){return "+r.map((function(t){return"this.shape["+t+"]"})).join("*"),"}})"),1===b?F.push("proto.order=[0]"):(F.push("Object.defineProperty(proto,'order',{get:"),b<4?(F.push("function "+Y+"_order(){"),2===b?F.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===b&&F.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):F.push("ORDER})")),F.push("proto.set=function "+Y+"_set("+d.join(",")+",v){"),x?F.push("return this.data.set("+U+",v)}"):F.push("return this.data["+U+"]=v}"),F.push("proto.get=function "+Y+"_get("+d.join(",")+"){"),x?F.push("return this.data.get("+U+")}"):F.push("return this.data["+U+"]}"),F.push("proto.index=function "+Y+"_index(",d.join(),"){return "+U+"}"),F.push("proto.hi=function "+Y+"_hi("+d.join(",")+"){return new "+Y+"(this.data,"+r.map((function(t){return["(typeof i",t,"!=='number'||i",t,"<0)?this.shape[",t,"]:i",t,"|0"].join("")})).join(",")+","+r.map((function(t){return"this.stride["+t+"]"})).join(",")+",this.offset)}");var W=r.map((function(t){return"a"+t+"=this.shape["+t+"]"})),T=r.map((function(t){return"c"+t+"=this.stride["+t+"]"}));F.push("proto.lo=function "+Y+"_lo("+d.join(",")+"){var b=this.offset,d=0,"+W.join(",")+","+T.join(","));for(var y=0;y<b;++y)F.push("if(typeof i"+y+"==='number'&&i"+y+">=0){d=i"+y+"|0;b+=c"+y+"*d;a"+y+"-=d}");F.push("return new "+Y+"(this.data,"+r.map((function(t){return"a"+t})).join(",")+","+r.map((function(t){return"c"+t})).join(",")+",b)}"),F.push("proto.step=function "+Y+"_step("+d.join(",")+"){var "+r.map((function(t){return"a"+t+"=this.shape["+t+"]"})).join(",")+","+r.map((function(t){return"b"+t+"=this.stride["+t+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(y=0;y<b;++y)F.push("if(typeof i"+y+"==='number'){d=i"+y+"|0;if(d<0){c+=b"+y+"*(a"+y+"-1);a"+y+"=ceil(-a"+y+"/d)}else{a"+y+"=ceil(a"+y+"/d)}b"+y+"*=d}");F.push("return new "+Y+"(this.data,"+r.map((function(t){return"a"+t})).join(",")+","+r.map((function(t){return"b"+t})).join(",")+",c)}");var v=new Array(b),B=new Array(b);for(y=0;y<b;++y)v[y]="a[i"+y+"]",B[y]="b[i"+y+"]";F.push("proto.transpose=function "+Y+"_transpose("+d+"){"+d.map((function(t,b){return t+"=("+t+"===undefined?"+b+":"+t+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+Y+"(this.data,"+v.join(",")+","+B.join(",")+",this.offset)}"),F.push("proto.pick=function "+Y+"_pick("+d+"){var a=[],b=[],c=this.offset");for(y=0;y<b;++y)F.push("if(typeof i"+y+"==='number'&&i"+y+">=0){c=(c+this.stride["+y+"]*i"+y+")|0}else{a.push(this.shape["+y+"]);b.push(this.stride["+y+"])}");return F.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),F.push("return function construct_"+Y+"(data,shape,stride,offset){return new "+Y+"(data,"+r.map((function(t){return"shape["+t+"]"})).join(",")+","+r.map((function(t){return"stride["+t+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",F.join("\n"))(E[t],R)}var E={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};t.exports=function(t,b,Y,o){if(void 0===t)return(0,E.array[0])([]);"number"===typeof t&&(t=[t]),void 0===b&&(b=[t.length]);var r=b.length;if(void 0===Y){Y=new Array(r);for(var R=r-1,U=1;R>=0;--R)Y[R]=U,U*=b[R]}if(void 0===o){o=0;for(R=0;R<r;++R)Y[R]<0&&(o-=(b[R]-1)*Y[R])}for(var C=function(t){if(x(t))return"buffer";if(F)switch(Object.prototype.toString.call(t)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(t)?"array":"generic"}(t),p=E[C];p.length<=r+1;)p.push(d(C,p.length-1));return(0,p[r+1])(t,b,Y,o)}},11566:t=>{var b;self,b=()=>(()=>{"use strict";var t={d:(b,Y)=>{for(var o in Y)t.o(Y,o)&&!t.o(b,o)&&Object.defineProperty(b,o,{enumerable:!0,get:Y[o]})},o:(t,b)=>Object.prototype.hasOwnProperty.call(t,b)},b={};t.d(b,{default:()=>N});var Y,o=function(t,b){var Y=b.x-t.x,o=b.y-t.y;return Math.sqrt(Y*Y+o*o)},x=function(t){return t*(Math.PI/180)},F=new Map,r=function(t){F.has(t)&&clearTimeout(F.get(t)),F.set(t,setTimeout(t,100))},R=function(t,b,Y){for(var o,x=b.split(/[ ,]+/g),F=0;F<x.length;F+=1)o=x[F],t.addEventListener?t.addEventListener(o,Y,!1):t.attachEvent&&t.attachEvent(o,Y)},d=function(t,b,Y){for(var o,x=b.split(/[ ,]+/g),F=0;F<x.length;F+=1)o=x[F],t.removeEventListener?t.removeEventListener(o,Y):t.detachEvent&&t.detachEvent(o,Y)},E=function(t){return t.preventDefault(),t.type.match(/^touch/)?t.changedTouches:t},U=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},C=function(t,b){b.top||b.right||b.bottom||b.left?(t.style.top=b.top,t.style.right=b.right,t.style.bottom=b.bottom,t.style.left=b.left):(t.style.left=b.x+"px",t.style.top=b.y+"px")},p=function(t,b,Y){var o=W(t);for(var x in o)if(o.hasOwnProperty(x))if("string"==typeof b)o[x]=b+" "+Y;else{for(var F="",r=0,R=b.length;r<R;r+=1)F+=b[r]+" "+Y+", ";o[x]=F.slice(0,-2)}return o},W=function(t){var b={};return b[t]="",["webkit","Moz","o"].forEach((function(Y){b[Y+t.charAt(0).toUpperCase()+t.slice(1)]=""})),b},T=function(t,b){for(var Y in b)b.hasOwnProperty(Y)&&(t[Y]=b[Y]);return t},y=function(t,b){if(t.length)for(var Y=0,o=t.length;Y<o;Y+=1)b(t[Y]);else b(t)},v="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,B=window.matchMedia("(any-hover: none)").matches,J=!!("ontouchstart"in window),m=!!window.PointerEvent,K=!!window.MSPointerEvent,L={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},z={start:"mousedown",move:"mousemove",end:"mouseup"},S={};function e(){}v&&!B?Y=L:m?Y={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:K?Y={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:J?(Y=L,S=z):Y=z,e.prototype.on=function(t,b){var Y,o=this,x=t.split(/[ ,]+/g);o._handlers_=o._handlers_||{};for(var F=0;F<x.length;F+=1)Y=x[F],o._handlers_[Y]=o._handlers_[Y]||[],o._handlers_[Y].push(b);return o},e.prototype.off=function(t,b){var Y=this;return Y._handlers_=Y._handlers_||{},void 0===t?Y._handlers_={}:void 0===b?Y._handlers_[t]=null:Y._handlers_[t]&&Y._handlers_[t].indexOf(b)>=0&&Y._handlers_[t].splice(Y._handlers_[t].indexOf(b),1),Y},e.prototype.trigger=function(t,b){var Y,o=this,x=t.split(/[ ,]+/g);o._handlers_=o._handlers_||{};for(var F=0;F<x.length;F+=1)Y=x[F],o._handlers_[Y]&&o._handlers_[Y].length&&o._handlers_[Y].forEach((function(t){t.call(o,{type:Y,target:o},b)}))},e.prototype.config=function(t){var b=this;b.options=b.defaults||{},t&&(b.options=function(t,b){var Y={};for(var o in t)t.hasOwnProperty(o)&&b.hasOwnProperty(o)?Y[o]=b[o]:t.hasOwnProperty(o)&&(Y[o]=t[o]);return Y}(b.options,t))},e.prototype.bindEvt=function(t,b){var o=this;return o._domHandlers_=o._domHandlers_||{},o._domHandlers_[b]=function(){"function"==typeof o["on"+b]?o["on"+b].apply(o,arguments):console.warn('[WARNING] : Missing "on'+b+'" handler.')},R(t,Y[b],o._domHandlers_[b]),S[b]&&R(t,S[b],o._domHandlers_[b]),o},e.prototype.unbindEvt=function(t,b){var o=this;return o._domHandlers_=o._domHandlers_||{},d(t,Y[b],o._domHandlers_[b]),S[b]&&d(t,S[b],o._domHandlers_[b]),delete o._domHandlers_[b],this};const g=e;function D(t,b){return this.identifier=b.identifier,this.position=b.position,this.frontPosition=b.frontPosition,this.collection=t,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(b),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=D.id,D.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}D.prototype=new g,D.constructor=D,D.id=0,D.prototype.buildEl=function(t){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},D.prototype.stylize=function(){if(this.options.dataOnly)return this;var t=this.options.fadeTime+"ms",b=function(){var t=W("borderRadius");for(var b in t)t.hasOwnProperty(b)&&(t[b]="50%");return t}(),Y=p("transition","opacity",t),o={};return o.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},o.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},o.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},T(o.el,Y),"circle"===this.options.shape&&T(o.back,b),T(o.front,b),this.applyStyles(o),this},D.prototype.applyStyles=function(t){for(var b in this.ui)if(this.ui.hasOwnProperty(b))for(var Y in t[b])this.ui[b].style[Y]=t[b][Y];return this},D.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},D.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},D.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},D.prototype.show=function(t){var b=this;return b.options.dataOnly||(clearTimeout(b.removeTimeout),clearTimeout(b.showTimeout),clearTimeout(b.restTimeout),b.addToDom(),b.restCallback(),setTimeout((function(){b.ui.el.style.opacity=1}),0),b.showTimeout=setTimeout((function(){b.trigger("shown",b.instance),"function"==typeof t&&t.call(this)}),b.options.fadeTime)),b},D.prototype.hide=function(t){var b=this;if(b.options.dataOnly)return b;if(b.ui.el.style.opacity=b.options.restOpacity,clearTimeout(b.removeTimeout),clearTimeout(b.showTimeout),clearTimeout(b.restTimeout),b.removeTimeout=setTimeout((function(){var Y="dynamic"===b.options.mode?"none":"block";b.ui.el.style.display=Y,"function"==typeof t&&t.call(b),b.trigger("hidden",b.instance)}),b.options.fadeTime),b.options.restJoystick){var Y=b.options.restJoystick,o={};o.x=!0===Y||!1!==Y.x?0:b.instance.frontPosition.x,o.y=!0===Y||!1!==Y.y?0:b.instance.frontPosition.y,b.setPosition(t,o)}return b},D.prototype.setPosition=function(t,b){var Y=this;Y.frontPosition={x:b.x,y:b.y};var o=Y.options.fadeTime+"ms",x={};x.front=p("transition",["transform"],o);var F={front:{}};F.front={transform:"translate("+Y.frontPosition.x+"px,"+Y.frontPosition.y+"px)"},Y.applyStyles(x),Y.applyStyles(F),Y.restTimeout=setTimeout((function(){"function"==typeof t&&t.call(Y),Y.restCallback()}),Y.options.fadeTime)},D.prototype.restCallback=function(){var t=this,b={};b.front=p("transition","none",""),t.applyStyles(b),t.trigger("rested",t.instance)},D.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},D.prototype.computeDirection=function(t){var b,Y,o,x=t.angle.radian,F=Math.PI/4,r=Math.PI/2;if(x>F&&x<3*F&&!t.lockX?b="up":x>-F&&x<=F&&!t.lockY?b="left":x>3*-F&&x<=-F&&!t.lockX?b="down":t.lockY||(b="right"),t.lockY||(Y=x>-r&&x<r?"left":"right"),t.lockX||(o=x>0?"up":"down"),t.force>this.options.threshold){var R,d={};for(R in this.direction)this.direction.hasOwnProperty(R)&&(d[R]=this.direction[R]);var E={};for(R in this.direction={x:Y,y:o,angle:b},t.direction=this.direction,d)d[R]===this.direction[R]&&(E[R]=!0);if(E.x&&E.y&&E.angle)return t;E.x&&E.y||this.trigger("plain",t),E.x||this.trigger("plain:"+Y,t),E.y||this.trigger("plain:"+o,t),E.angle||this.trigger("dir dir:"+b,t)}else this.resetDirection();return t};const H=D;function f(t,b){var Y=this;Y.nipples=[],Y.idles=[],Y.actives=[],Y.ids=[],Y.pressureIntervals={},Y.manager=t,Y.id=f.id,f.id+=1,Y.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},Y.config(b),"static"!==Y.options.mode&&"semi"!==Y.options.mode||(Y.options.multitouch=!1),Y.options.multitouch||(Y.options.maxNumberOfNipples=1);var o=getComputedStyle(Y.options.zone.parentElement);return o&&"flex"===o.display&&(Y.parentIsFlex=!0),Y.updateBox(),Y.prepareNipples(),Y.uj(),Y.begin(),Y.nipples}f.prototype=new g,f.constructor=f,f.id=0,f.prototype.prepareNipples=function(){var t=this,b=t.nipples;b.on=t.on.bind(t),b.off=t.off.bind(t),b.options=t.options,b.destroy=t.destroy.bind(t),b.ids=t.ids,b.id=t.id,b.processOnMove=t.processOnMove.bind(t),b.processOnEnd=t.processOnEnd.bind(t),b.get=function(t){if(void 0===t)return b[0];for(var Y=0,o=b.length;Y<o;Y+=1)if(b[Y].identifier===t)return b[Y];return!1}},f.prototype.uj=function(){var t=this;t.bindEvt(t.options.zone,"start"),t.options.zone.style.touchAction="none",t.options.zone.style.msTouchAction="none"},f.prototype.begin=function(){var t=this,b=t.options;if("static"===b.mode){var Y=t.createNipple(b.position,t.manager.getIdentifier());Y.add(),t.idles.push(Y)}},f.prototype.createNipple=function(t,b){var Y=this,o=Y.manager.scroll,x={},F=Y.options,r=Y.parentIsFlex?o.x:o.x+Y.box.left,R=Y.parentIsFlex?o.y:o.y+Y.box.top;if(t.x&&t.y)x={x:t.x-r,y:t.y-R};else if(t.top||t.right||t.bottom||t.left){var d=document.createElement("DIV");d.style.display="hidden",d.style.top=t.top,d.style.right=t.right,d.style.bottom=t.bottom,d.style.left=t.left,d.style.position="absolute",F.zone.appendChild(d);var E=d.getBoundingClientRect();F.zone.removeChild(d),x=t,t={x:E.left+o.x,y:E.top+o.y}}var U=new H(Y,{color:F.color,size:F.size,threshold:F.threshold,fadeTime:F.fadeTime,dataOnly:F.dataOnly,restJoystick:F.restJoystick,restOpacity:F.restOpacity,mode:F.mode,identifier:b,position:t,zone:F.zone,frontPosition:{x:0,y:0},shape:F.shape});return F.dataOnly||(C(U.ui.el,x),C(U.ui.front,U.frontPosition)),Y.nipples.push(U),Y.trigger("added "+U.identifier+":added",U),Y.manager.trigger("added "+U.identifier+":added",U),Y.bindNipple(U),U},f.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},f.prototype.bindNipple=function(t){var b,Y=this,o=function(t,o){b=t.type+" "+o.id+":"+t.type,Y.trigger(b,o)};t.on("destroyed",Y.onDestroyed.bind(Y)),t.on("shown hidden rested dir plain",o),t.on("dir:up dir:right dir:down dir:left",o),t.on("plain:up plain:right plain:down plain:left",o)},f.prototype.pressureFn=function(t,b,Y){var o=this,x=0;clearInterval(o.pressureIntervals[Y]),o.pressureIntervals[Y]=setInterval(function(){var Y=t.force||t.pressure||t.webkitForce||0;Y!==x&&(b.trigger("pressure",Y),o.trigger("pressure "+b.identifier+":pressure",Y),x=Y)}.bind(o),100)},f.prototype.onstart=function(t){var b=this,Y=b.options,o=t;return t=E(t),b.updateBox(),y(t,(function(x){b.actives.length<Y.maxNumberOfNipples?b.processOnStart(x):o.type.match(/^touch/)&&(Object.keys(b.manager.ids).forEach((function(Y){if(Object.values(o.touches).findIndex((function(t){return t.identifier===Y}))<0){var x=[t[0]];x.identifier=Y,b.processOnEnd(x)}})),b.actives.length<Y.maxNumberOfNipples&&b.processOnStart(x))})),b.manager.bindDocument(),!1},f.prototype.processOnStart=function(t){var b,Y=this,x=Y.options,F=Y.manager.getIdentifier(t),r=t.force||t.pressure||t.webkitForce||0,R={x:t.pageX,y:t.pageY},d=Y.getOrCreate(F,R);d.identifier!==F&&Y.manager.removeIdentifier(d.identifier),d.identifier=F;var E=function(b){b.trigger("start",b),Y.trigger("start "+b.id+":start",b),b.show(),r>0&&Y.pressureFn(t,b,b.identifier),Y.processOnMove(t)};if((b=Y.idles.indexOf(d))>=0&&Y.idles.splice(b,1),Y.actives.push(d),Y.ids.push(d.identifier),"semi"!==x.mode)E(d);else{if(!(o(R,d.position)<=x.catchDistance))return d.destroy(),void Y.processOnStart(t);E(d)}return d},f.prototype.getOrCreate=function(t,b){var Y,o=this,x=o.options;return/(semi|static)/.test(x.mode)?(Y=o.idles[0])?(o.idles.splice(0,1),Y):"semi"===x.mode?o.createNipple(b,t):(console.warn("Coudln't find the needed nipple."),!1):Y=o.createNipple(b,t)},f.prototype.processOnMove=function(t){var b=this,Y=b.options,F=b.manager.getIdentifier(t),r=b.nipples.get(F),R=b.manager.scroll;if(function(t){return isNaN(t.buttons)?0!==t.pressure:0!==t.buttons}(t)){if(!r)return console.error("Found zombie joystick with ID "+F),void b.manager.removeIdentifier(F);if(Y.dynamicPage){var d=r.el.getBoundingClientRect();r.position={x:R.x+d.left,y:R.y+d.top}}r.identifier=F;var E=r.options.size/2,U={x:t.pageX,y:t.pageY};Y.lockX&&(U.y=r.position.y),Y.lockY&&(U.x=r.position.x);var C,p,W,T,y,v,B,J,m,K,L=o(U,r.position),z=(C=U,W=(p=r.position).x-C.x,T=p.y-C.y,function(t){return t*(180/Math.PI)}(Math.atan2(T,W))),S=x(z),e=L/E,g={distance:L,position:U};if("circle"===r.options.shape?(y=Math.min(L,E),B=r.position,J=y,K={x:0,y:0},m=x(m=z),K.x=B.x-J*Math.cos(m),K.y=B.y-J*Math.sin(m),v=K):(v=function(t,b,Y){return{x:Math.min(Math.max(t.x,b.x-Y),b.x+Y),y:Math.min(Math.max(t.y,b.y-Y),b.y+Y)}}(U,r.position,E),y=o(v,r.position)),Y.follow){if(L>E){var D=U.x-v.x,H=U.y-v.y;r.position.x+=D,r.position.y+=H,r.el.style.top=r.position.y-(b.box.top+R.y)+"px",r.el.style.left=r.position.x-(b.box.left+R.x)+"px",L=o(U,r.position)}}else U=v,L=y;var f=U.x-r.position.x,n=U.y-r.position.y;r.frontPosition={x:f,y:n},Y.dataOnly||(r.ui.front.style.transform="translate("+f+"px,"+n+"px)");var X={identifier:r.identifier,position:U,force:e,pressure:t.force||t.pressure||t.webkitForce||0,distance:L,angle:{radian:S,degree:z},vector:{x:f/E,y:-n/E},raw:g,instance:r,lockX:Y.lockX,lockY:Y.lockY};(X=r.computeDirection(X)).angle={radian:x(180-z),degree:180-z},r.trigger("move",X),b.trigger("move "+r.id+":move",X)}else this.processOnEnd(t)},f.prototype.processOnEnd=function(t){var b=this,Y=b.options,o=b.manager.getIdentifier(t),x=b.nipples.get(o),F=b.manager.removeIdentifier(x.identifier);x&&(Y.dataOnly||x.hide((function(){"dynamic"===Y.mode&&(x.trigger("removed",x),b.trigger("removed "+x.id+":removed",x),b.manager.trigger("removed "+x.id+":removed",x),x.destroy())})),clearInterval(b.pressureIntervals[x.identifier]),x.resetDirection(),x.trigger("end",x),b.trigger("end "+x.id+":end",x),b.ids.indexOf(x.identifier)>=0&&b.ids.splice(b.ids.indexOf(x.identifier),1),b.actives.indexOf(x)>=0&&b.actives.splice(b.actives.indexOf(x),1),/(semi|static)/.test(Y.mode)?b.idles.push(x):b.nipples.indexOf(x)>=0&&b.nipples.splice(b.nipples.indexOf(x),1),b.manager.unbindDocument(),/(semi|static)/.test(Y.mode)&&(b.manager.ids[F.id]=F.identifier))},f.prototype.onDestroyed=function(t,b){var Y=this;Y.nipples.indexOf(b)>=0&&Y.nipples.splice(Y.nipples.indexOf(b),1),Y.actives.indexOf(b)>=0&&Y.actives.splice(Y.actives.indexOf(b),1),Y.idles.indexOf(b)>=0&&Y.idles.splice(Y.idles.indexOf(b),1),Y.ids.indexOf(b.identifier)>=0&&Y.ids.splice(Y.ids.indexOf(b.identifier),1),Y.manager.removeIdentifier(b.identifier),Y.manager.unbindDocument()},f.prototype.destroy=function(){var t=this;for(var b in t.unbindEvt(t.options.zone,"start"),t.nipples.forEach((function(t){t.destroy()})),t.pressureIntervals)t.pressureIntervals.hasOwnProperty(b)&&clearInterval(t.pressureIntervals[b]);t.trigger("destroyed",t.nipples),t.manager.unbindDocument(),t.off()};const n=f;function X(t){var b=this;b.ids={},b.index=0,b.collections=[],b.scroll=U(),b.config(t),b.prepareCollections();var Y=function(){var t;b.collections.forEach((function(Y){Y.forEach((function(Y){t=Y.el.getBoundingClientRect(),Y.position={x:b.scroll.x+t.left,y:b.scroll.y+t.top}}))}))};R(window,"resize",(function(){r(Y)}));var o=function(){b.scroll=U()};return R(window,"scroll",(function(){r(o)})),b.collections}X.prototype=new g,X.constructor=X,X.prototype.prepareCollections=function(){var t=this;t.collections.create=t.create.bind(t),t.collections.on=t.on.bind(t),t.collections.off=t.off.bind(t),t.collections.destroy=t.destroy.bind(t),t.collections.get=function(b){var Y;return t.collections.every((function(t){return!(Y=t.get(b))})),Y}},X.prototype.create=function(t){return this.createCollection(t)},X.prototype.createCollection=function(t){var b=this,Y=new n(b,t);return b.bindCollection(Y),b.collections.push(Y),Y},X.prototype.bindCollection=function(t){var b,Y=this,o=function(t,o){b=t.type+" "+o.id+":"+t.type,Y.trigger(b,o)};t.on("destroyed",Y.onDestroyed.bind(Y)),t.on("shown hidden rested dir plain",o),t.on("dir:up dir:right dir:down dir:left",o),t.on("plain:up plain:right plain:down plain:left",o)},X.prototype.bindDocument=function(){var t=this;t.binded||(t.bindEvt(document,"move").bindEvt(document,"end"),t.binded=!0)},X.prototype.unbindDocument=function(t){var b=this;Object.keys(b.ids).length&&!0!==t||(b.unbindEvt(document,"move").unbindEvt(document,"end"),b.binded=!1)},X.prototype.getIdentifier=function(t){var b;return t?void 0===(b=void 0===t.identifier?t.pointerId:t.identifier)&&(b=this.latest||0):b=this.index,void 0===this.ids[b]&&(this.ids[b]=this.index,this.index+=1),this.latest=b,this.ids[b]},X.prototype.removeIdentifier=function(t){var b={};for(var Y in this.ids)if(this.ids[Y]===t){b.id=Y,b.identifier=this.ids[Y],delete this.ids[Y];break}return b},X.prototype.onmove=function(t){return this.onAny("move",t),!1},X.prototype.onend=function(t){return this.onAny("end",t),!1},X.prototype.oncancel=function(t){return this.onAny("end",t),!1},X.prototype.onAny=function(t,b){var Y,o=this,x="processOn"+t.charAt(0).toUpperCase()+t.slice(1);b=E(b);var F=function(t,b,Y){Y.ids.indexOf(b)>=0&&(Y[x](t),t._found_=!0)};return y(b,(function(t){Y=o.getIdentifier(t),y(o.collections,F.bind(null,t,Y)),t._found_||o.removeIdentifier(Y)})),!1},X.prototype.destroy=function(){var t=this;t.unbindDocument(!0),t.ids={},t.index=0,t.collections.forEach((function(t){t.destroy()})),t.off()},X.prototype.onDestroyed=function(t,b){var Y=this;if(Y.collections.indexOf(b)<0)return!1;Y.collections.splice(Y.collections.indexOf(b),1)};var Q=new X;const N={create:function(t){return Q.create(t)},factory:Q};return b.default})(),t.exports=b()},11628:(t,b,Y)=>{"use strict";const{Deflate:o,deflate:x,deflateRaw:F,gzip:r}=Y(11633),{Inflate:R,inflate:d,inflateRaw:E,ungzip:U}=Y(11683),C=Y(11662);t.exports.Deflate=o,t.exports.deflate=x,t.exports.deflateRaw=F,t.exports.gzip=r,t.exports.Inflate=R,t.exports.inflate=d,t.exports.inflateRaw=E,t.exports.ungzip=U,t.exports.constants=C},11633:(t,b,Y)=>{"use strict";const o=Y(11638),x=Y(11666),F=Y(11669),r=Y(11659),R=Y(11675),d=Object.prototype.toString,{Z_NO_FLUSH:E,Z_SYNC_FLUSH:U,Z_FULL_FLUSH:C,Z_FINISH:p,Z_OK:W,Z_STREAM_END:T,Z_DEFAULT_COMPRESSION:y,Z_DEFAULT_STRATEGY:v,Z_DEFLATED:B}=Y(11662);function J(t){this.options=x.assign({level:y,method:B,Ja:16384,windowBits:15,memLevel:8,strategy:v},t||{});let b=this.options;b.raw&&b.windowBits>0?b.windowBits=-b.windowBits:b.gzip&&b.windowBits>0&&b.windowBits<16&&(b.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new R,this.strm.avail_out=0;let Y=o.deflateInit2(this.strm,b.level,b.method,b.windowBits,b.memLevel,b.strategy);if(Y!==W)throw new Error(r[Y]);if(b.header&&o.deflateSetHeader(this.strm,b.header),b.dictionary){let t;if(t="string"===typeof b.dictionary?F.string2buf(b.dictionary):"[object ArrayBuffer]"===d.call(b.dictionary)?new Uint8Array(b.dictionary):b.dictionary,Y=o.deflateSetDictionary(this.strm,t),Y!==W)throw new Error(r[Y]);this._dict_set=!0}}function m(t,b){const Y=new J(b);if(Y.push(t,!0),Y.err)throw Y.msg||r[Y.err];return Y.result}J.prototype.push=function(t,b){const Y=this.strm,x=this.options.Ja;let r,R;if(this.ended)return!1;for(R=b===~~b?b:!0===b?p:E,"string"===typeof t?Y.input=F.string2buf(t):"[object ArrayBuffer]"===d.call(t)?Y.input=new Uint8Array(t):Y.input=t,Y.next_in=0,Y.avail_in=Y.input.length;;)if(0===Y.avail_out&&(Y.output=new Uint8Array(x),Y.next_out=0,Y.avail_out=x),(R===U||R===C)&&Y.avail_out<=6)this.onData(Y.output.subarray(0,Y.next_out)),Y.avail_out=0;else{if(r=o.deflate(Y,R),r===T)return Y.next_out>0&&this.onData(Y.output.subarray(0,Y.next_out)),r=o.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===W;if(0!==Y.avail_out){if(R>0&&Y.next_out>0)this.onData(Y.output.subarray(0,Y.next_out)),Y.avail_out=0;else if(0===Y.avail_in)break}else this.onData(Y.output)}return!0},J.prototype.onData=function(t){this.chunks.push(t)},J.prototype.onEnd=function(t){t===W&&(this.result=x.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},t.exports.Deflate=J,t.exports.deflate=m,t.exports.deflateRaw=function(t,b){return(b=b||{}).raw=!0,m(t,b)},t.exports.gzip=function(t,b){return(b=b||{}).gzip=!0,m(t,b)},t.exports.constants=Y(11662)},11683:(t,b,Y)=>{"use strict";const o=Y(11686),x=Y(11666),F=Y(11669),r=Y(11659),R=Y(11675),d=Y(11700),E=Object.prototype.toString,{Z_NO_FLUSH:U,Z_FINISH:C,Z_OK:p,Z_STREAM_END:W,Z_NEED_DICT:T,Z_STREAM_ERROR:y,Z_DATA_ERROR:v,Z_MEM_ERROR:B}=Y(11662);function J(t){this.options=x.assign({Ja:65536,windowBits:15,to:""},t||{});const b=this.options;b.raw&&b.windowBits>=0&&b.windowBits<16&&(b.windowBits=-b.windowBits,0===b.windowBits&&(b.windowBits=-15)),!(b.windowBits>=0&&b.windowBits<16)||t&&t.windowBits||(b.windowBits+=32),b.windowBits>15&&b.windowBits<48&&0===(15&b.windowBits)&&(b.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new R,this.strm.avail_out=0;let Y=o.inflateInit2(this.strm,b.windowBits);if(Y!==p)throw new Error(r[Y]);if(this.header=new d,o.inflateGetHeader(this.strm,this.header),b.dictionary&&("string"===typeof b.dictionary?b.dictionary=F.string2buf(b.dictionary):"[object ArrayBuffer]"===E.call(b.dictionary)&&(b.dictionary=new Uint8Array(b.dictionary)),b.raw&&(Y=o.inflateSetDictionary(this.strm,b.dictionary),Y!==p)))throw new Error(r[Y])}function m(t,b){const Y=new J(b);if(Y.push(t),Y.err)throw Y.msg||r[Y.err];return Y.result}J.prototype.push=function(t,b){const Y=this.strm,x=this.options.Ja,r=this.options.dictionary;let R,d,J;if(this.ended)return!1;for(d=b===~~b?b:!0===b?C:U,"[object ArrayBuffer]"===E.call(t)?Y.input=new Uint8Array(t):Y.input=t,Y.next_in=0,Y.avail_in=Y.input.length;;){for(0===Y.avail_out&&(Y.output=new Uint8Array(x),Y.next_out=0,Y.avail_out=x),R=o.inflate(Y,d),R===T&&r&&(R=o.inflateSetDictionary(Y,r),R===p?R=o.inflate(Y,d):R===v&&(R=T));Y.avail_in>0&&R===W&&Y.state.wrap>0&&0!==t[Y.next_in];)o.inflateReset(Y),R=o.inflate(Y,d);switch(R){case y:case v:case T:case B:return this.onEnd(R),this.ended=!0,!1}if(J=Y.avail_out,Y.next_out&&(0===Y.avail_out||R===W))if("string"===this.options.to){let t=F.utf8border(Y.output,Y.next_out),b=Y.next_out-t,o=F.buf2string(Y.output,t);Y.next_out=b,Y.avail_out=x-b,b&&Y.output.set(Y.output.subarray(t,t+b),0),this.onData(o)}else this.onData(Y.output.length===Y.next_out?Y.output:Y.output.subarray(0,Y.next_out));if(R!==p||0!==J){if(R===W)return R=o.inflateEnd(this.strm),this.onEnd(R),this.ended=!0,!0;if(0===Y.avail_in)break}}return!0},J.prototype.onData=function(t){this.chunks.push(t)},J.prototype.onEnd=function(t){t===p&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=x.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},t.exports.Inflate=J,t.exports.inflate=m,t.exports.inflateRaw=function(t,b){return(b=b||{}).raw=!0,m(t,b)},t.exports.ungzip=m,t.exports.constants=Y(11662)},11666:t=>{"use strict";const b=(t,b)=>Object.prototype.hasOwnProperty.call(t,b);t.exports.assign=function(t){const Y=Array.prototype.slice.call(arguments,1);for(;Y.length;){const o=Y.shift();if(o){if("object"!==typeof o)throw new TypeError(o+"must be non-object");for(const Y in o)b(o,Y)&&(t[Y]=o[Y])}}return t},t.exports.flattenChunks=t=>{let b=0;for(let o=0,x=t.length;o<x;o++)b+=t[o].length;const Y=new Uint8Array(b);for(let o=0,x=0,F=t.length;o<F;o++){let b=t[o];Y.set(b,x),x+=b.length}return Y}},11669:t=>{"use strict";let b=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(o){b=!1}const Y=new Uint8Array(256);for(let x=0;x<256;x++)Y[x]=x>=252?6:x>=248?5:x>=240?4:x>=224?3:x>=192?2:1;Y[254]=Y[254]=1,t.exports.string2buf=t=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(t);let b,Y,o,x,F,r=t.length,R=0;for(x=0;x<r;x++)Y=t.charCodeAt(x),55296===(64512&Y)&&x+1<r&&(o=t.charCodeAt(x+1),56320===(64512&o)&&(Y=65536+(Y-55296<<10)+(o-56320),x++)),R+=Y<128?1:Y<2048?2:Y<65536?3:4;for(b=new Uint8Array(R),F=0,x=0;F<R;x++)Y=t.charCodeAt(x),55296===(64512&Y)&&x+1<r&&(o=t.charCodeAt(x+1),56320===(64512&o)&&(Y=65536+(Y-55296<<10)+(o-56320),x++)),Y<128?b[F++]=Y:Y<2048?(b[F++]=192|Y>>>6,b[F++]=128|63&Y):Y<65536?(b[F++]=224|Y>>>12,b[F++]=128|Y>>>6&63,b[F++]=128|63&Y):(b[F++]=240|Y>>>18,b[F++]=128|Y>>>12&63,b[F++]=128|Y>>>6&63,b[F++]=128|63&Y);return b};t.exports.buf2string=(t,o)=>{const x=o||t.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(t.subarray(0,o));let F,r;const R=new Array(2*x);for(r=0,F=0;F<x;){let b=t[F++];if(b<128){R[r++]=b;continue}let o=Y[b];if(o>4)R[r++]=65533,F+=o-1;else{for(b&=2===o?31:3===o?15:7;o>1&&F<x;)b=b<<6|63&t[F++],o--;o>1?R[r++]=65533:b<65536?R[r++]=b:(b-=65536,R[r++]=55296|b>>10&1023,R[r++]=56320|1023&b)}}return((t,Y)=>{if(Y<65534&&t.subarray&&b)return String.fromCharCode.apply(null,t.length===Y?t:t.subarray(0,Y));let o="";for(let b=0;b<Y;b++)o+=String.fromCharCode(t[b]);return o})(R,r)},t.exports.utf8border=(t,b)=>{(b=b||t.length)>t.length&&(b=t.length);let o=b-1;for(;o>=0&&128===(192&t[o]);)o--;return o<0||0===o?b:o+Y[t[o]]>b?o:b}},11645:t=>{"use strict";t.exports=(t,b,Y,o)=>{let x=65535&t,F=t>>>16&65535,r=0;for(;0!==Y;){r=Y>2e3?2e3:Y,Y-=r;do{x=x+b[o++]|0,F=F+x|0}while(--r);x%=65521,F%=65521}return x|F<<16}},11662:t=>{"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},11652:t=>{"use strict";const b=new Uint32Array((()=>{let t,b=[];for(var Y=0;Y<256;Y++){t=Y;for(var o=0;o<8;o++)t=1&t?3988292384^t>>>1:t>>>1;b[Y]=t}return b})());t.exports=(t,Y,o,x)=>{const F=b,r=x+o;t^=-1;for(let b=x;b<r;b++)t=t>>>8^F[255&(t^Y[b])];return~t}},11638:(t,b,Y)=>{"use strict";const{_tr_init:o,_tr_stored_block:x,_tr_flush_block:F,_tr_tally:r,_tr_align:R}=Y(11642),d=Y(11645),E=Y(11652),U=Y(11659),{Z_NO_FLUSH:C,Z_PARTIAL_FLUSH:p,Z_FULL_FLUSH:W,Z_FINISH:T,Z_BLOCK:y,Z_OK:v,Z_STREAM_END:B,Z_STREAM_ERROR:J,Z_DATA_ERROR:m,Z_BUF_ERROR:K,Z_DEFAULT_COMPRESSION:L,Z_FILTERED:z,Z_HUFFMAN_ONLY:S,Z_RLE:e,Z_FIXED:g,Z_DEFAULT_STRATEGY:D,Z_UNKNOWN:H,Z_DEFLATED:f}=Y(11662),n=258,X=262,Q=103,N=113,u=666,Z=(t,b)=>(t.msg=U[b],b),a=t=>(t<<1)-(t>4?9:0),A=t=>{let b=t.length;for(;--b>=0;)t[b]=0};let M=(t,b,Y)=>(b<<t.hash_shift^Y)&t.hash_mask;const w=t=>{const b=t.state;let Y=b.pending;Y>t.avail_out&&(Y=t.avail_out),0!==Y&&(t.output.set(b.pending_buf.subarray(b.pending_out,b.pending_out+Y),t.next_out),t.next_out+=Y,b.pending_out+=Y,t.total_out+=Y,t.avail_out-=Y,b.pending-=Y,0===b.pending&&(b.pending_out=0))},c=(t,b)=>{F(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,b),t.block_start=t.strstart,w(t.strm)},I=(t,b)=>{t.pending_buf[t.pending++]=b},s=(t,b)=>{t.pending_buf[t.pending++]=b>>>8&255,t.pending_buf[t.pending++]=255&b},l=(t,b,Y,o)=>{let x=t.avail_in;return x>o&&(x=o),0===x?0:(t.avail_in-=x,b.set(t.input.subarray(t.next_in,t.next_in+x),Y),1===t.state.wrap?t.adler=d(t.adler,b,x,Y):2===t.state.wrap&&(t.adler=E(t.adler,b,x,Y)),t.next_in+=x,t.total_in+=x,x)},i=(t,b)=>{let Y,o,x=t.max_chain_length,F=t.strstart,r=t.prev_length,R=t.nice_match;const d=t.strstart>t.w_size-X?t.strstart-(t.w_size-X):0,E=t.window,U=t.w_mask,C=t.prev,p=t.strstart+n;let W=E[F+r-1],T=E[F+r];t.prev_length>=t.good_match&&(x>>=2),R>t.lookahead&&(R=t.lookahead);do{if(Y=b,E[Y+r]===T&&E[Y+r-1]===W&&E[Y]===E[F]&&E[++Y]===E[F+1]){F+=2,Y++;do{}while(E[++F]===E[++Y]&&E[++F]===E[++Y]&&E[++F]===E[++Y]&&E[++F]===E[++Y]&&E[++F]===E[++Y]&&E[++F]===E[++Y]&&E[++F]===E[++Y]&&E[++F]===E[++Y]&&F<p);if(o=n-(p-F),F=p-n,o>r){if(t.match_start=b,r=o,o>=R)break;W=E[F+r-1],T=E[F+r]}}}while((b=C[b&U])>d&&0!==--x);return r<=t.lookahead?r:t.lookahead},V=t=>{const b=t.w_size;let Y,o,x,F,r;do{if(F=t.window_size-t.lookahead-t.strstart,t.strstart>=b+(b-X)){t.window.set(t.window.subarray(b,b+b),0),t.match_start-=b,t.strstart-=b,t.block_start-=b,o=t.hash_size,Y=o;do{x=t.head[--Y],t.head[Y]=x>=b?x-b:0}while(--o);o=b,Y=o;do{x=t.prev[--Y],t.prev[Y]=x>=b?x-b:0}while(--o);F+=b}if(0===t.strm.avail_in)break;if(o=l(t.strm,t.window,t.strstart+t.lookahead,F),t.lookahead+=o,t.lookahead+t.insert>=3)for(r=t.strstart-t.insert,t.ins_h=t.window[r],t.ins_h=M(t,t.ins_h,t.window[r+1]);t.insert&&(t.ins_h=M(t,t.ins_h,t.window[r+3-1]),t.prev[r&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=r,r++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<X&&0!==t.strm.avail_in)},P=(t,b)=>{let Y,o;for(;;){if(t.lookahead<X){if(V(t),t.lookahead<X&&b===C)return 1;if(0===t.lookahead)break}if(Y=0,t.lookahead>=3&&(t.ins_h=M(t,t.ins_h,t.window[t.strstart+3-1]),Y=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==Y&&t.strstart-Y<=t.w_size-X&&(t.match_length=i(t,Y)),t.match_length>=3)if(o=r(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do{t.strstart++,t.ins_h=M(t,t.ins_h,t.window[t.strstart+3-1]),Y=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!==--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=M(t,t.ins_h,t.window[t.strstart+1]);else o=r(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(o&&(c(t,!1),0===t.strm.avail_out))return 1}return t.insert=t.strstart<2?t.strstart:2,b===T?(c(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(c(t,!1),0===t.strm.avail_out)?1:2},k=(t,b)=>{let Y,o,x;for(;;){if(t.lookahead<X){if(V(t),t.lookahead<X&&b===C)return 1;if(0===t.lookahead)break}if(Y=0,t.lookahead>=3&&(t.ins_h=M(t,t.ins_h,t.window[t.strstart+3-1]),Y=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,0!==Y&&t.prev_length<t.max_lazy_match&&t.strstart-Y<=t.w_size-X&&(t.match_length=i(t,Y),t.match_length<=5&&(t.strategy===z||3===t.match_length&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){x=t.strstart+t.lookahead-3,o=r(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=x&&(t.ins_h=M(t,t.ins_h,t.window[t.strstart+3-1]),Y=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!==--t.prev_length);if(t.match_available=0,t.match_length=2,t.strstart++,o&&(c(t,!1),0===t.strm.avail_out))return 1}else if(t.match_available){if(o=r(t,0,t.window[t.strstart-1]),o&&c(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(o=r(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,b===T?(c(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(c(t,!1),0===t.strm.avail_out)?1:2};function q(t,b,Y,o,x){this.good_length=t,this.max_lazy=b,this.nice_length=Y,this.max_chain=o,this.func=x}const O=[new q(0,0,0,0,((t,b)=>{let Y=65535;for(Y>t.pending_buf_size-5&&(Y=t.pending_buf_size-5);;){if(t.lookahead<=1){if(V(t),0===t.lookahead&&b===C)return 1;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;const o=t.block_start+Y;if((0===t.strstart||t.strstart>=o)&&(t.lookahead=t.strstart-o,t.strstart=o,c(t,!1),0===t.strm.avail_out))return 1;if(t.strstart-t.block_start>=t.w_size-X&&(c(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,b===T?(c(t,!0),0===t.strm.avail_out?3:4):(t.strstart>t.block_start&&(c(t,!1),t.strm.avail_out),1)})),new q(4,4,8,4,P),new q(4,5,16,8,P),new q(4,6,32,32,P),new q(4,4,16,16,k),new q(8,16,32,32,k),new q(8,16,128,128,k),new q(8,32,128,256,k),new q(32,128,258,1024,k),new q(32,258,258,4096,k)];function j(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=f,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),A(this.dyn_ltree),A(this.dyn_dtree),A(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),A(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),A(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const G=t=>{if(!t||!t.state)return Z(t,J);t.total_in=t.total_out=0,t.data_type=H;const b=t.state;return b.pending=0,b.pending_out=0,b.wrap<0&&(b.wrap=-b.wrap),b.status=b.wrap?42:N,t.adler=2===b.wrap?0:1,b.last_flush=C,o(b),v},h=t=>{const b=G(t);var Y;return b===v&&((Y=t.state).window_size=2*Y.w_size,A(Y.head),Y.max_lazy_match=O[Y.level].max_lazy,Y.good_match=O[Y.level].good_length,Y.nice_match=O[Y.level].nice_length,Y.max_chain_length=O[Y.level].max_chain,Y.strstart=0,Y.block_start=0,Y.lookahead=0,Y.insert=0,Y.match_length=Y.prev_length=2,Y.match_available=0,Y.ins_h=0),b},tt=(t,b,Y,o,x,F)=>{if(!t)return J;let r=1;if(b===L&&(b=6),o<0?(r=0,o=-o):o>15&&(r=2,o-=16),x<1||x>9||Y!==f||o<8||o>15||b<0||b>9||F<0||F>g)return Z(t,J);8===o&&(o=9);const R=new j;return t.state=R,R.strm=t,R.wrap=r,R.gzhead=null,R.w_bits=o,R.w_size=1<<R.w_bits,R.w_mask=R.w_size-1,R.hash_bits=x+7,R.hash_size=1<<R.hash_bits,R.hash_mask=R.hash_size-1,R.hash_shift=~~((R.hash_bits+3-1)/3),R.window=new Uint8Array(2*R.w_size),R.head=new Uint16Array(R.hash_size),R.prev=new Uint16Array(R.w_size),R.lit_bufsize=1<<x+6,R.pending_buf_size=4*R.lit_bufsize,R.pending_buf=new Uint8Array(R.pending_buf_size),R.d_buf=1*R.lit_bufsize,R.l_buf=3*R.lit_bufsize,R.level=b,R.strategy=F,R.method=Y,h(t)};t.exports.deflateInit=(t,b)=>tt(t,b,f,15,8,D),t.exports.deflateInit2=tt,t.exports.deflateReset=h,t.exports.deflateResetKeep=G,t.exports.deflateSetHeader=(t,b)=>t&&t.state?2!==t.state.wrap?J:(t.state.gzhead=b,v):J,t.exports.deflate=(t,b)=>{let Y,o;if(!t||!t.state||b>y||b<0)return t?Z(t,J):J;const F=t.state;if(!t.output||!t.input&&0!==t.avail_in||F.status===u&&b!==T)return Z(t,0===t.avail_out?K:J);F.strm=t;const d=F.last_flush;if(F.last_flush=b,42===F.status)if(2===F.wrap)t.adler=0,I(F,31),I(F,139),I(F,8),F.gzhead?(I(F,(F.gzhead.text?1:0)+(F.gzhead.hcrc?2:0)+(F.gzhead.extra?4:0)+(F.gzhead.name?8:0)+(F.gzhead.comment?16:0)),I(F,255&F.gzhead.time),I(F,F.gzhead.time>>8&255),I(F,F.gzhead.time>>16&255),I(F,F.gzhead.time>>24&255),I(F,9===F.level?2:F.strategy>=S||F.level<2?4:0),I(F,255&F.gzhead.os),F.gzhead.extra&&F.gzhead.extra.length&&(I(F,255&F.gzhead.extra.length),I(F,F.gzhead.extra.length>>8&255)),F.gzhead.hcrc&&(t.adler=E(t.adler,F.pending_buf,F.pending,0)),F.gzindex=0,F.status=69):(I(F,0),I(F,0),I(F,0),I(F,0),I(F,0),I(F,9===F.level?2:F.strategy>=S||F.level<2?4:0),I(F,3),F.status=N);else{let b=f+(F.w_bits-8<<4)<<8,Y=-1;Y=F.strategy>=S||F.level<2?0:F.level<6?1:6===F.level?2:3,b|=Y<<6,0!==F.strstart&&(b|=32),b+=31-b%31,F.status=N,s(F,b),0!==F.strstart&&(s(F,t.adler>>>16),s(F,65535&t.adler)),t.adler=1}if(69===F.status)if(F.gzhead.extra){for(Y=F.pending;F.gzindex<(65535&F.gzhead.extra.length)&&(F.pending!==F.pending_buf_size||(F.gzhead.hcrc&&F.pending>Y&&(t.adler=E(t.adler,F.pending_buf,F.pending-Y,Y)),w(t),Y=F.pending,F.pending!==F.pending_buf_size));)I(F,255&F.gzhead.extra[F.gzindex]),F.gzindex++;F.gzhead.hcrc&&F.pending>Y&&(t.adler=E(t.adler,F.pending_buf,F.pending-Y,Y)),F.gzindex===F.gzhead.extra.length&&(F.gzindex=0,F.status=73)}else F.status=73;if(73===F.status)if(F.gzhead.name){Y=F.pending;do{if(F.pending===F.pending_buf_size&&(F.gzhead.hcrc&&F.pending>Y&&(t.adler=E(t.adler,F.pending_buf,F.pending-Y,Y)),w(t),Y=F.pending,F.pending===F.pending_buf_size)){o=1;break}o=F.gzindex<F.gzhead.name.length?255&F.gzhead.name.charCodeAt(F.gzindex++):0,I(F,o)}while(0!==o);F.gzhead.hcrc&&F.pending>Y&&(t.adler=E(t.adler,F.pending_buf,F.pending-Y,Y)),0===o&&(F.gzindex=0,F.status=91)}else F.status=91;if(91===F.status)if(F.gzhead.comment){Y=F.pending;do{if(F.pending===F.pending_buf_size&&(F.gzhead.hcrc&&F.pending>Y&&(t.adler=E(t.adler,F.pending_buf,F.pending-Y,Y)),w(t),Y=F.pending,F.pending===F.pending_buf_size)){o=1;break}o=F.gzindex<F.gzhead.comment.length?255&F.gzhead.comment.charCodeAt(F.gzindex++):0,I(F,o)}while(0!==o);F.gzhead.hcrc&&F.pending>Y&&(t.adler=E(t.adler,F.pending_buf,F.pending-Y,Y)),0===o&&(F.status=Q)}else F.status=Q;if(F.status===Q&&(F.gzhead.hcrc?(F.pending+2>F.pending_buf_size&&w(t),F.pending+2<=F.pending_buf_size&&(I(F,255&t.adler),I(F,t.adler>>8&255),t.adler=0,F.status=N)):F.status=N),0!==F.pending){if(w(t),0===t.avail_out)return F.last_flush=-1,v}else if(0===t.avail_in&&a(b)<=a(d)&&b!==T)return Z(t,K);if(F.status===u&&0!==t.avail_in)return Z(t,K);if(0!==t.avail_in||0!==F.lookahead||b!==C&&F.status!==u){let Y=F.strategy===S?((t,b)=>{let Y;for(;;){if(0===t.lookahead&&(V(t),0===t.lookahead)){if(b===C)return 1;break}if(t.match_length=0,Y=r(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,Y&&(c(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,b===T?(c(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(c(t,!1),0===t.strm.avail_out)?1:2})(F,b):F.strategy===e?((t,b)=>{let Y,o,x,F;const R=t.window;for(;;){if(t.lookahead<=n){if(V(t),t.lookahead<=n&&b===C)return 1;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=3&&t.strstart>0&&(x=t.strstart-1,o=R[x],o===R[++x]&&o===R[++x]&&o===R[++x])){F=t.strstart+n;do{}while(o===R[++x]&&o===R[++x]&&o===R[++x]&&o===R[++x]&&o===R[++x]&&o===R[++x]&&o===R[++x]&&o===R[++x]&&x<F);t.match_length=n-(F-x),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=3?(Y=r(t,1,t.match_length-3),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(Y=r(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),Y&&(c(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,b===T?(c(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(c(t,!1),0===t.strm.avail_out)?1:2})(F,b):O[F.level].func(F,b);if(3!==Y&&4!==Y||(F.status=u),1===Y||3===Y)return 0===t.avail_out&&(F.last_flush=-1),v;if(2===Y&&(b===p?R(F):b!==y&&(x(F,0,0,!1),b===W&&(A(F.head),0===F.lookahead&&(F.strstart=0,F.block_start=0,F.insert=0))),w(t),0===t.avail_out))return F.last_flush=-1,v}return b!==T?v:F.wrap<=0?B:(2===F.wrap?(I(F,255&t.adler),I(F,t.adler>>8&255),I(F,t.adler>>16&255),I(F,t.adler>>24&255),I(F,255&t.total_in),I(F,t.total_in>>8&255),I(F,t.total_in>>16&255),I(F,t.total_in>>24&255)):(s(F,t.adler>>>16),s(F,65535&t.adler)),w(t),F.wrap>0&&(F.wrap=-F.wrap),0!==F.pending?v:B)},t.exports.deflateEnd=t=>{if(!t||!t.state)return J;const b=t.state.status;return 42!==b&&69!==b&&73!==b&&91!==b&&b!==Q&&b!==N&&b!==u?Z(t,J):(t.state=null,b===N?Z(t,m):v)},t.exports.deflateSetDictionary=(t,b)=>{let Y=b.length;if(!t||!t.state)return J;const o=t.state,x=o.wrap;if(2===x||1===x&&42!==o.status||o.lookahead)return J;if(1===x&&(t.adler=d(t.adler,b,Y,0)),o.wrap=0,Y>=o.w_size){0===x&&(A(o.head),o.strstart=0,o.block_start=0,o.insert=0);let t=new Uint8Array(o.w_size);t.set(b.subarray(Y-o.w_size,Y),0),b=t,Y=o.w_size}const F=t.avail_in,r=t.next_in,R=t.input;for(t.avail_in=Y,t.next_in=0,t.input=b,V(o);o.lookahead>=3;){let t=o.strstart,b=o.lookahead-2;do{o.ins_h=M(o,o.ins_h,o.window[t+3-1]),o.prev[t&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=t,t++}while(--b);o.strstart=t,o.lookahead=2,V(o)}return o.strstart+=o.lookahead,o.block_start=o.strstart,o.insert=o.lookahead,o.lookahead=0,o.match_length=o.prev_length=2,o.match_available=0,t.next_in=r,t.input=R,t.avail_in=F,o.wrap=x,v},t.exports.deflateInfo="pako deflate (from Nodeca project)"},11700:t=>{"use strict";t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},11691:t=>{"use strict";t.exports=function(t,b){let Y,o,x,F,r,R,d,E,U,C,p,W,T,y,v,B,J,m,K,L,z,S,e,g;const D=t.state;Y=t.next_in,e=t.input,o=Y+(t.avail_in-5),x=t.next_out,g=t.output,F=x-(b-t.avail_out),r=x+(t.avail_out-257),R=D.dmax,d=D.wsize,E=D.whave,U=D.wnext,C=D.window,p=D.hold,W=D.bits,T=D.lencode,y=D.distcode,v=(1<<D.lenbits)-1,B=(1<<D.distbits)-1;t:do{W<15&&(p+=e[Y++]<<W,W+=8,p+=e[Y++]<<W,W+=8),J=T[p&v];b:for(;;){if(m=J>>>24,p>>>=m,W-=m,m=J>>>16&255,0===m)g[x++]=65535&J;else{if(!(16&m)){if(0===(64&m)){J=T[(65535&J)+(p&(1<<m)-1)];continue b}if(32&m){D.mode=12;break t}t.msg="invalid literal/length code",D.mode=30;break t}K=65535&J,m&=15,m&&(W<m&&(p+=e[Y++]<<W,W+=8),K+=p&(1<<m)-1,p>>>=m,W-=m),W<15&&(p+=e[Y++]<<W,W+=8,p+=e[Y++]<<W,W+=8),J=y[p&B];Y:for(;;){if(m=J>>>24,p>>>=m,W-=m,m=J>>>16&255,!(16&m)){if(0===(64&m)){J=y[(65535&J)+(p&(1<<m)-1)];continue Y}t.msg="invalid distance code",D.mode=30;break t}if(L=65535&J,m&=15,W<m&&(p+=e[Y++]<<W,W+=8,W<m&&(p+=e[Y++]<<W,W+=8)),L+=p&(1<<m)-1,L>R){t.msg="invalid distance too far back",D.mode=30;break t}if(p>>>=m,W-=m,m=x-F,L>m){if(m=L-m,m>E&&D.sane){t.msg="invalid distance too far back",D.mode=30;break t}if(z=0,S=C,0===U){if(z+=d-m,m<K){K-=m;do{g[x++]=C[z++]}while(--m);z=x-L,S=g}}else if(U<m){if(z+=d+U-m,m-=U,m<K){K-=m;do{g[x++]=C[z++]}while(--m);if(z=0,U<K){m=U,K-=m;do{g[x++]=C[z++]}while(--m);z=x-L,S=g}}}else if(z+=U-m,m<K){K-=m;do{g[x++]=C[z++]}while(--m);z=x-L,S=g}for(;K>2;)g[x++]=S[z++],g[x++]=S[z++],g[x++]=S[z++],K-=3;K&&(g[x++]=S[z++],K>1&&(g[x++]=S[z++]))}else{z=x-L;do{g[x++]=g[z++],g[x++]=g[z++],g[x++]=g[z++],K-=3}while(K>2);K&&(g[x++]=g[z++],K>1&&(g[x++]=g[z++]))}break}}break}}while(Y<o&&x<r);K=W>>3,Y-=K,W-=K<<3,p&=(1<<W)-1,t.next_in=Y,t.next_out=x,t.avail_in=Y<o?o-Y+5:5-(Y-o),t.avail_out=x<r?r-x+257:257-(x-r),D.hold=p,D.bits=W}},11686:(t,b,Y)=>{"use strict";const o=Y(11645),x=Y(11652),F=Y(11691),r=Y(11696),{Z_FINISH:R,Z_BLOCK:d,Z_TREES:E,Z_OK:U,Z_STREAM_END:C,Z_NEED_DICT:p,Z_STREAM_ERROR:W,Z_DATA_ERROR:T,Z_MEM_ERROR:y,Z_BUF_ERROR:v,Z_DEFLATED:B}=Y(11662),J=12,m=30,K=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function L(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const z=t=>{if(!t||!t.state)return W;const b=t.state;return t.total_in=t.total_out=b.total=0,t.msg="",b.wrap&&(t.adler=1&b.wrap),b.mode=1,b.last=0,b.havedict=0,b.dmax=32768,b.head=null,b.hold=0,b.bits=0,b.lencode=b.lendyn=new Int32Array(852),b.distcode=b.distdyn=new Int32Array(592),b.sane=1,b.back=-1,U},S=t=>{if(!t||!t.state)return W;const b=t.state;return b.wsize=0,b.whave=0,b.wnext=0,z(t)},e=(t,b)=>{let Y;if(!t||!t.state)return W;const o=t.state;return b<0?(Y=0,b=-b):(Y=1+(b>>4),b<48&&(b&=15)),b&&(b<8||b>15)?W:(null!==o.window&&o.wbits!==b&&(o.window=null),o.wrap=Y,o.wbits=b,S(t))},g=(t,b)=>{if(!t)return W;const Y=new L;t.state=Y,Y.window=null;const o=e(t,b);return o!==U&&(t.state=null),o};let D,H,f=!0;const n=t=>{if(f){D=new Int32Array(512),H=new Int32Array(32);let b=0;for(;b<144;)t.lens[b++]=8;for(;b<256;)t.lens[b++]=9;for(;b<280;)t.lens[b++]=7;for(;b<288;)t.lens[b++]=8;for(r(1,t.lens,0,288,D,0,t.work,{bits:9}),b=0;b<32;)t.lens[b++]=5;r(2,t.lens,0,32,H,0,t.work,{bits:5}),f=!1}t.lencode=D,t.lenbits=9,t.distcode=H,t.distbits=5},X=(t,b,Y,o)=>{let x;const F=t.state;return null===F.window&&(F.wsize=1<<F.wbits,F.wnext=0,F.whave=0,F.window=new Uint8Array(F.wsize)),o>=F.wsize?(F.window.set(b.subarray(Y-F.wsize,Y),0),F.wnext=0,F.whave=F.wsize):(x=F.wsize-F.wnext,x>o&&(x=o),F.window.set(b.subarray(Y-o,Y-o+x),F.wnext),(o-=x)?(F.window.set(b.subarray(Y-o,Y),0),F.wnext=o,F.whave=F.wsize):(F.wnext+=x,F.wnext===F.wsize&&(F.wnext=0),F.whave<F.wsize&&(F.whave+=x))),0};t.exports.inflateReset=S,t.exports.inflateReset2=e,t.exports.inflateResetKeep=z,t.exports.inflateInit=t=>g(t,15),t.exports.inflateInit2=g,t.exports.inflate=(t,b)=>{let Y,L,z,S,e,g,D,H,f,Q,N,u,Z,a,A,M,w,c,I,s,l,i,V=0;const P=new Uint8Array(4);let k,q;const O=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return W;Y=t.state,Y.mode===J&&(Y.mode=13),e=t.next_out,z=t.output,D=t.avail_out,S=t.next_in,L=t.input,g=t.avail_in,H=Y.hold,f=Y.bits,Q=g,N=D,i=U;t:for(;;)switch(Y.mode){case 1:if(0===Y.wrap){Y.mode=13;break}for(;f<16;){if(0===g)break t;g--,H+=L[S++]<<f,f+=8}if(2&Y.wrap&&35615===H){Y.check=0,P[0]=255&H,P[1]=H>>>8&255,Y.check=x(Y.check,P,2,0),H=0,f=0,Y.mode=2;break}if(Y.flags=0,Y.head&&(Y.head.done=!1),!(1&Y.wrap)||(((255&H)<<8)+(H>>8))%31){t.msg="incorrect header check",Y.mode=m;break}if((15&H)!==B){t.msg="unknown compression method",Y.mode=m;break}if(H>>>=4,f-=4,l=8+(15&H),0===Y.wbits)Y.wbits=l;else if(l>Y.wbits){t.msg="invalid window size",Y.mode=m;break}Y.dmax=1<<Y.wbits,t.adler=Y.check=1,Y.mode=512&H?10:J,H=0,f=0;break;case 2:for(;f<16;){if(0===g)break t;g--,H+=L[S++]<<f,f+=8}if(Y.flags=H,(255&Y.flags)!==B){t.msg="unknown compression method",Y.mode=m;break}if(57344&Y.flags){t.msg="unknown header flags set",Y.mode=m;break}Y.head&&(Y.head.text=H>>8&1),512&Y.flags&&(P[0]=255&H,P[1]=H>>>8&255,Y.check=x(Y.check,P,2,0)),H=0,f=0,Y.mode=3;case 3:for(;f<32;){if(0===g)break t;g--,H+=L[S++]<<f,f+=8}Y.head&&(Y.head.time=H),512&Y.flags&&(P[0]=255&H,P[1]=H>>>8&255,P[2]=H>>>16&255,P[3]=H>>>24&255,Y.check=x(Y.check,P,4,0)),H=0,f=0,Y.mode=4;case 4:for(;f<16;){if(0===g)break t;g--,H+=L[S++]<<f,f+=8}Y.head&&(Y.head.xflags=255&H,Y.head.os=H>>8),512&Y.flags&&(P[0]=255&H,P[1]=H>>>8&255,Y.check=x(Y.check,P,2,0)),H=0,f=0,Y.mode=5;case 5:if(1024&Y.flags){for(;f<16;){if(0===g)break t;g--,H+=L[S++]<<f,f+=8}Y.length=H,Y.head&&(Y.head.extra_len=H),512&Y.flags&&(P[0]=255&H,P[1]=H>>>8&255,Y.check=x(Y.check,P,2,0)),H=0,f=0}else Y.head&&(Y.head.extra=null);Y.mode=6;case 6:if(1024&Y.flags&&(u=Y.length,u>g&&(u=g),u&&(Y.head&&(l=Y.head.extra_len-Y.length,Y.head.extra||(Y.head.extra=new Uint8Array(Y.head.extra_len)),Y.head.extra.set(L.subarray(S,S+u),l)),512&Y.flags&&(Y.check=x(Y.check,L,u,S)),g-=u,S+=u,Y.length-=u),Y.length))break t;Y.length=0,Y.mode=7;case 7:if(2048&Y.flags){if(0===g)break t;u=0;do{l=L[S+u++],Y.head&&l&&Y.length<65536&&(Y.head.name+=String.fromCharCode(l))}while(l&&u<g);if(512&Y.flags&&(Y.check=x(Y.check,L,u,S)),g-=u,S+=u,l)break t}else Y.head&&(Y.head.name=null);Y.length=0,Y.mode=8;case 8:if(4096&Y.flags){if(0===g)break t;u=0;do{l=L[S+u++],Y.head&&l&&Y.length<65536&&(Y.head.comment+=String.fromCharCode(l))}while(l&&u<g);if(512&Y.flags&&(Y.check=x(Y.check,L,u,S)),g-=u,S+=u,l)break t}else Y.head&&(Y.head.comment=null);Y.mode=9;case 9:if(512&Y.flags){for(;f<16;){if(0===g)break t;g--,H+=L[S++]<<f,f+=8}if(H!==(65535&Y.check)){t.msg="header crc mismatch",Y.mode=m;break}H=0,f=0}Y.head&&(Y.head.hcrc=Y.flags>>9&1,Y.head.done=!0),t.adler=Y.check=0,Y.mode=J;break;case 10:for(;f<32;){if(0===g)break t;g--,H+=L[S++]<<f,f+=8}t.adler=Y.check=K(H),H=0,f=0,Y.mode=11;case 11:if(0===Y.havedict)return t.next_out=e,t.avail_out=D,t.next_in=S,t.avail_in=g,Y.hold=H,Y.bits=f,p;t.adler=Y.check=1,Y.mode=J;case J:if(b===d||b===E)break t;case 13:if(Y.last){H>>>=7&f,f-=7&f,Y.mode=27;break}for(;f<3;){if(0===g)break t;g--,H+=L[S++]<<f,f+=8}switch(Y.last=1&H,H>>>=1,f-=1,3&H){case 0:Y.mode=14;break;case 1:if(n(Y),Y.mode=20,b===E){H>>>=2,f-=2;break t}break;case 2:Y.mode=17;break;case 3:t.msg="invalid block type",Y.mode=m}H>>>=2,f-=2;break;case 14:for(H>>>=7&f,f-=7&f;f<32;){if(0===g)break t;g--,H+=L[S++]<<f,f+=8}if((65535&H)!==(H>>>16^65535)){t.msg="invalid stored block lengths",Y.mode=m;break}if(Y.length=65535&H,H=0,f=0,Y.mode=15,b===E)break t;case 15:Y.mode=16;case 16:if(u=Y.length,u){if(u>g&&(u=g),u>D&&(u=D),0===u)break t;z.set(L.subarray(S,S+u),e),g-=u,S+=u,D-=u,e+=u,Y.length-=u;break}Y.mode=J;break;case 17:for(;f<14;){if(0===g)break t;g--,H+=L[S++]<<f,f+=8}if(Y.nlen=257+(31&H),H>>>=5,f-=5,Y.ndist=1+(31&H),H>>>=5,f-=5,Y.ncode=4+(15&H),H>>>=4,f-=4,Y.nlen>286||Y.ndist>30){t.msg="too many length or distance symbols",Y.mode=m;break}Y.have=0,Y.mode=18;case 18:for(;Y.have<Y.ncode;){for(;f<3;){if(0===g)break t;g--,H+=L[S++]<<f,f+=8}Y.lens[O[Y.have++]]=7&H,H>>>=3,f-=3}for(;Y.have<19;)Y.lens[O[Y.have++]]=0;if(Y.lencode=Y.lendyn,Y.lenbits=7,k={bits:Y.lenbits},i=r(0,Y.lens,0,19,Y.lencode,0,Y.work,k),Y.lenbits=k.bits,i){t.msg="invalid code lengths set",Y.mode=m;break}Y.have=0,Y.mode=19;case 19:for(;Y.have<Y.nlen+Y.ndist;){for(;V=Y.lencode[H&(1<<Y.lenbits)-1],A=V>>>24,M=V>>>16&255,w=65535&V,!(A<=f);){if(0===g)break t;g--,H+=L[S++]<<f,f+=8}if(w<16)H>>>=A,f-=A,Y.lens[Y.have++]=w;else{if(16===w){for(q=A+2;f<q;){if(0===g)break t;g--,H+=L[S++]<<f,f+=8}if(H>>>=A,f-=A,0===Y.have){t.msg="invalid bit length repeat",Y.mode=m;break}l=Y.lens[Y.have-1],u=3+(3&H),H>>>=2,f-=2}else if(17===w){for(q=A+3;f<q;){if(0===g)break t;g--,H+=L[S++]<<f,f+=8}H>>>=A,f-=A,l=0,u=3+(7&H),H>>>=3,f-=3}else{for(q=A+7;f<q;){if(0===g)break t;g--,H+=L[S++]<<f,f+=8}H>>>=A,f-=A,l=0,u=11+(127&H),H>>>=7,f-=7}if(Y.have+u>Y.nlen+Y.ndist){t.msg="invalid bit length repeat",Y.mode=m;break}for(;u--;)Y.lens[Y.have++]=l}}if(Y.mode===m)break;if(0===Y.lens[256]){t.msg="invalid code -- missing end-of-block",Y.mode=m;break}if(Y.lenbits=9,k={bits:Y.lenbits},i=r(1,Y.lens,0,Y.nlen,Y.lencode,0,Y.work,k),Y.lenbits=k.bits,i){t.msg="invalid literal/lengths set",Y.mode=m;break}if(Y.distbits=6,Y.distcode=Y.distdyn,k={bits:Y.distbits},i=r(2,Y.lens,Y.nlen,Y.ndist,Y.distcode,0,Y.work,k),Y.distbits=k.bits,i){t.msg="invalid distances set",Y.mode=m;break}if(Y.mode=20,b===E)break t;case 20:Y.mode=21;case 21:if(g>=6&&D>=258){t.next_out=e,t.avail_out=D,t.next_in=S,t.avail_in=g,Y.hold=H,Y.bits=f,F(t,N),e=t.next_out,z=t.output,D=t.avail_out,S=t.next_in,L=t.input,g=t.avail_in,H=Y.hold,f=Y.bits,Y.mode===J&&(Y.back=-1);break}for(Y.back=0;V=Y.lencode[H&(1<<Y.lenbits)-1],A=V>>>24,M=V>>>16&255,w=65535&V,!(A<=f);){if(0===g)break t;g--,H+=L[S++]<<f,f+=8}if(M&&0===(240&M)){for(c=A,I=M,s=w;V=Y.lencode[s+((H&(1<<c+I)-1)>>c)],A=V>>>24,M=V>>>16&255,w=65535&V,!(c+A<=f);){if(0===g)break t;g--,H+=L[S++]<<f,f+=8}H>>>=c,f-=c,Y.back+=c}if(H>>>=A,f-=A,Y.back+=A,Y.length=w,0===M){Y.mode=26;break}if(32&M){Y.back=-1,Y.mode=J;break}if(64&M){t.msg="invalid literal/length code",Y.mode=m;break}Y.extra=15&M,Y.mode=22;case 22:if(Y.extra){for(q=Y.extra;f<q;){if(0===g)break t;g--,H+=L[S++]<<f,f+=8}Y.length+=H&(1<<Y.extra)-1,H>>>=Y.extra,f-=Y.extra,Y.back+=Y.extra}Y.was=Y.length,Y.mode=23;case 23:for(;V=Y.distcode[H&(1<<Y.distbits)-1],A=V>>>24,M=V>>>16&255,w=65535&V,!(A<=f);){if(0===g)break t;g--,H+=L[S++]<<f,f+=8}if(0===(240&M)){for(c=A,I=M,s=w;V=Y.distcode[s+((H&(1<<c+I)-1)>>c)],A=V>>>24,M=V>>>16&255,w=65535&V,!(c+A<=f);){if(0===g)break t;g--,H+=L[S++]<<f,f+=8}H>>>=c,f-=c,Y.back+=c}if(H>>>=A,f-=A,Y.back+=A,64&M){t.msg="invalid distance code",Y.mode=m;break}Y.offset=w,Y.extra=15&M,Y.mode=24;case 24:if(Y.extra){for(q=Y.extra;f<q;){if(0===g)break t;g--,H+=L[S++]<<f,f+=8}Y.offset+=H&(1<<Y.extra)-1,H>>>=Y.extra,f-=Y.extra,Y.back+=Y.extra}if(Y.offset>Y.dmax){t.msg="invalid distance too far back",Y.mode=m;break}Y.mode=25;case 25:if(0===D)break t;if(u=N-D,Y.offset>u){if(u=Y.offset-u,u>Y.whave&&Y.sane){t.msg="invalid distance too far back",Y.mode=m;break}u>Y.wnext?(u-=Y.wnext,Z=Y.wsize-u):Z=Y.wnext-u,u>Y.length&&(u=Y.length),a=Y.window}else a=z,Z=e-Y.offset,u=Y.length;u>D&&(u=D),D-=u,Y.length-=u;do{z[e++]=a[Z++]}while(--u);0===Y.length&&(Y.mode=21);break;case 26:if(0===D)break t;z[e++]=Y.length,D--,Y.mode=21;break;case 27:if(Y.wrap){for(;f<32;){if(0===g)break t;g--,H|=L[S++]<<f,f+=8}if(N-=D,t.total_out+=N,Y.total+=N,N&&(t.adler=Y.check=Y.flags?x(Y.check,z,N,e-N):o(Y.check,z,N,e-N)),N=D,(Y.flags?H:K(H))!==Y.check){t.msg="incorrect data check",Y.mode=m;break}H=0,f=0}Y.mode=28;case 28:if(Y.wrap&&Y.flags){for(;f<32;){if(0===g)break t;g--,H+=L[S++]<<f,f+=8}if(H!==(4294967295&Y.total)){t.msg="incorrect length check",Y.mode=m;break}H=0,f=0}Y.mode=29;case 29:i=C;break t;case m:i=T;break t;case 31:return y;default:return W}return t.next_out=e,t.avail_out=D,t.next_in=S,t.avail_in=g,Y.hold=H,Y.bits=f,(Y.wsize||N!==t.avail_out&&Y.mode<m&&(Y.mode<27||b!==R))&&X(t,t.output,t.next_out,N-t.avail_out)?(Y.mode=31,y):(Q-=t.avail_in,N-=t.avail_out,t.total_in+=Q,t.total_out+=N,Y.total+=N,Y.wrap&&N&&(t.adler=Y.check=Y.flags?x(Y.check,z,N,t.next_out-N):o(Y.check,z,N,t.next_out-N)),t.data_type=Y.bits+(Y.last?64:0)+(Y.mode===J?128:0)+(20===Y.mode||15===Y.mode?256:0),(0===Q&&0===N||b===R)&&i===U&&(i=v),i)},t.exports.inflateEnd=t=>{if(!t||!t.state)return W;let b=t.state;return b.window&&(b.window=null),t.state=null,U},t.exports.inflateGetHeader=(t,b)=>{if(!t||!t.state)return W;const Y=t.state;return 0===(2&Y.wrap)?W:(Y.head=b,b.done=!1,U)},t.exports.inflateSetDictionary=(t,b)=>{const Y=b.length;let x,F,r;return t&&t.state?(x=t.state,0!==x.wrap&&11!==x.mode?W:11===x.mode&&(F=1,F=o(F,b,Y,0),F!==x.check)?T:(r=X(t,b,Y,Y),r?(x.mode=31,y):(x.havedict=1,U))):W},t.exports.inflateInfo="pako inflate (from Nodeca project)"},11696:t=>{"use strict";const b=15,Y=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),o=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),x=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),F=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);t.exports=(t,r,R,d,E,U,C,p)=>{const W=p.bits;let T,y,v,B,J,m,K=0,L=0,z=0,S=0,e=0,g=0,D=0,H=0,f=0,n=0,X=null,Q=0;const N=new Uint16Array(16),u=new Uint16Array(16);let Z,a,A,M=null,w=0;for(K=0;K<=b;K++)N[K]=0;for(L=0;L<d;L++)N[r[R+L]]++;for(e=W,S=b;S>=1&&0===N[S];S--);if(e>S&&(e=S),0===S)return E[U++]=20971520,E[U++]=20971520,p.bits=1,0;for(z=1;z<S&&0===N[z];z++);for(e<z&&(e=z),H=1,K=1;K<=b;K++)if(H<<=1,H-=N[K],H<0)return-1;if(H>0&&(0===t||1!==S))return-1;for(u[1]=0,K=1;K<b;K++)u[K+1]=u[K]+N[K];for(L=0;L<d;L++)0!==r[R+L]&&(C[u[r[R+L]]++]=L);if(0===t?(X=M=C,m=19):1===t?(X=Y,Q-=257,M=o,w-=257,m=256):(X=x,M=F,m=-1),n=0,L=0,K=z,J=U,g=e,D=0,v=-1,f=1<<e,B=f-1,1===t&&f>852||2===t&&f>592)return 1;for(;;){Z=K-D,C[L]<m?(a=0,A=C[L]):C[L]>m?(a=M[w+C[L]],A=X[Q+C[L]]):(a=96,A=0),T=1<<K-D,y=1<<g,z=y;do{y-=T,E[J+(n>>D)+y]=Z<<24|a<<16|A}while(0!==y);for(T=1<<K-1;n&T;)T>>=1;if(0!==T?(n&=T-1,n+=T):n=0,L++,0===--N[K]){if(K===S)break;K=r[R+C[L]]}if(K>e&&(n&B)!==v){for(0===D&&(D=e),J+=z,g=K-D,H=1<<g;g+D<S&&(H-=N[g+D],!(H<=0));)g++,H<<=1;if(f+=1<<g,1===t&&f>852||2===t&&f>592)return 1;v=n&B,E[v]=e<<24|g<<16|J-U}}return 0!==n&&(E[J+n]=K-D<<24|64<<16),p.bits=e,0}},11659:t=>{"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},11642:t=>{"use strict";function b(t){let b=t.length;for(;--b>=0;)t[b]=0}const Y=256,o=286,x=30,F=15,r=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),R=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),d=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),E=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),U=new Array(576);b(U);const C=new Array(60);b(C);const p=new Array(512);b(p);const W=new Array(256);b(W);const T=new Array(29);b(T);const y=new Array(x);function v(t,b,Y,o,x){this.static_tree=t,this.extra_bits=b,this.extra_base=Y,this.elems=o,this.max_length=x,this.has_stree=t&&t.length}let B,J,m;function K(t,b){this.dyn_tree=t,this.max_code=0,this.stat_desc=b}b(y);const L=t=>t<256?p[t]:p[256+(t>>>7)],z=(t,b)=>{t.pending_buf[t.pending++]=255&b,t.pending_buf[t.pending++]=b>>>8&255},S=(t,b,Y)=>{t.bi_valid>16-Y?(t.bi_buf|=b<<t.bi_valid&65535,z(t,t.bi_buf),t.bi_buf=b>>16-t.bi_valid,t.bi_valid+=Y-16):(t.bi_buf|=b<<t.bi_valid&65535,t.bi_valid+=Y)},e=(t,b,Y)=>{S(t,Y[2*b],Y[2*b+1])},g=(t,b)=>{let Y=0;do{Y|=1&t,t>>>=1,Y<<=1}while(--b>0);return Y>>>1},D=(t,b,Y)=>{const o=new Array(16);let x,r,R=0;for(x=1;x<=F;x++)o[x]=R=R+Y[x-1]<<1;for(r=0;r<=b;r++){let b=t[2*r+1];0!==b&&(t[2*r]=g(o[b]++,b))}},H=t=>{let b;for(b=0;b<o;b++)t.dyn_ltree[2*b]=0;for(b=0;b<x;b++)t.dyn_dtree[2*b]=0;for(b=0;b<19;b++)t.bl_tree[2*b]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0},f=t=>{t.bi_valid>8?z(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},n=(t,b,Y,o)=>{const x=2*b,F=2*Y;return t[x]<t[F]||t[x]===t[F]&&o[b]<=o[Y]},X=(t,b,Y)=>{const o=t.heap[Y];let x=Y<<1;for(;x<=t.heap_len&&(x<t.heap_len&&n(b,t.heap[x+1],t.heap[x],t.depth)&&x++,!n(b,o,t.heap[x],t.depth));)t.heap[Y]=t.heap[x],Y=x,x<<=1;t.heap[Y]=o},Q=(t,b,o)=>{let x,F,d,E,U=0;if(0!==t.last_lit)do{x=t.pending_buf[t.d_buf+2*U]<<8|t.pending_buf[t.d_buf+2*U+1],F=t.pending_buf[t.l_buf+U],U++,0===x?e(t,F,b):(d=W[F],e(t,d+Y+1,b),E=r[d],0!==E&&(F-=T[d],S(t,F,E)),x--,d=L(x),e(t,d,o),E=R[d],0!==E&&(x-=y[d],S(t,x,E)))}while(U<t.last_lit);e(t,256,b)},N=(t,b)=>{const Y=b.dyn_tree,o=b.stat_desc.static_tree,x=b.stat_desc.has_stree,r=b.stat_desc.elems;let R,d,E,U=-1;for(t.heap_len=0,t.heap_max=573,R=0;R<r;R++)0!==Y[2*R]?(t.heap[++t.heap_len]=U=R,t.depth[R]=0):Y[2*R+1]=0;for(;t.heap_len<2;)E=t.heap[++t.heap_len]=U<2?++U:0,Y[2*E]=1,t.depth[E]=0,t.opt_len--,x&&(t.static_len-=o[2*E+1]);for(b.max_code=U,R=t.heap_len>>1;R>=1;R--)X(t,Y,R);E=r;do{R=t.heap[1],t.heap[1]=t.heap[t.heap_len--],X(t,Y,1),d=t.heap[1],t.heap[--t.heap_max]=R,t.heap[--t.heap_max]=d,Y[2*E]=Y[2*R]+Y[2*d],t.depth[E]=(t.depth[R]>=t.depth[d]?t.depth[R]:t.depth[d])+1,Y[2*R+1]=Y[2*d+1]=E,t.heap[1]=E++,X(t,Y,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((t,b)=>{const Y=b.dyn_tree,o=b.max_code,x=b.stat_desc.static_tree,r=b.stat_desc.has_stree,R=b.stat_desc.extra_bits,d=b.stat_desc.extra_base,E=b.stat_desc.max_length;let U,C,p,W,T,y,v=0;for(W=0;W<=F;W++)t.bl_count[W]=0;for(Y[2*t.heap[t.heap_max]+1]=0,U=t.heap_max+1;U<573;U++)C=t.heap[U],W=Y[2*Y[2*C+1]+1]+1,W>E&&(W=E,v++),Y[2*C+1]=W,C>o||(t.bl_count[W]++,T=0,C>=d&&(T=R[C-d]),y=Y[2*C],t.opt_len+=y*(W+T),r&&(t.static_len+=y*(x[2*C+1]+T)));if(0!==v){do{for(W=E-1;0===t.bl_count[W];)W--;t.bl_count[W]--,t.bl_count[W+1]+=2,t.bl_count[E]--,v-=2}while(v>0);for(W=E;0!==W;W--)for(C=t.bl_count[W];0!==C;)p=t.heap[--U],p>o||(Y[2*p+1]!==W&&(t.opt_len+=(W-Y[2*p+1])*Y[2*p],Y[2*p+1]=W),C--)}})(t,b),D(Y,U,t.bl_count)},u=(t,b,Y)=>{let o,x,F=-1,r=b[1],R=0,d=7,E=4;for(0===r&&(d=138,E=3),b[2*(Y+1)+1]=65535,o=0;o<=Y;o++)x=r,r=b[2*(o+1)+1],++R<d&&x===r||(R<E?t.bl_tree[2*x]+=R:0!==x?(x!==F&&t.bl_tree[2*x]++,t.bl_tree[32]++):R<=10?t.bl_tree[34]++:t.bl_tree[36]++,R=0,F=x,0===r?(d=138,E=3):x===r?(d=6,E=3):(d=7,E=4))},Z=(t,b,Y)=>{let o,x,F=-1,r=b[1],R=0,d=7,E=4;for(0===r&&(d=138,E=3),o=0;o<=Y;o++)if(x=r,r=b[2*(o+1)+1],!(++R<d&&x===r)){if(R<E)do{e(t,x,t.bl_tree)}while(0!==--R);else 0!==x?(x!==F&&(e(t,x,t.bl_tree),R--),e(t,16,t.bl_tree),S(t,R-3,2)):R<=10?(e(t,17,t.bl_tree),S(t,R-3,3)):(e(t,18,t.bl_tree),S(t,R-11,7));R=0,F=x,0===r?(d=138,E=3):x===r?(d=6,E=3):(d=7,E=4)}};let a=!1;const A=(t,b,Y,o)=>{S(t,0+(o?1:0),3),((t,b,Y,o)=>{f(t),o&&(z(t,Y),z(t,~Y)),t.pending_buf.set(t.window.subarray(b,b+Y),t.pending),t.pending+=Y})(t,b,Y,!0)};t.exports._tr_init=t=>{a||((()=>{let t,b,Y,E,K;const L=new Array(16);for(Y=0,E=0;E<28;E++)for(T[E]=Y,t=0;t<1<<r[E];t++)W[Y++]=E;for(W[Y-1]=E,K=0,E=0;E<16;E++)for(y[E]=K,t=0;t<1<<R[E];t++)p[K++]=E;for(K>>=7;E<x;E++)for(y[E]=K<<7,t=0;t<1<<R[E]-7;t++)p[256+K++]=E;for(b=0;b<=F;b++)L[b]=0;for(t=0;t<=143;)U[2*t+1]=8,t++,L[8]++;for(;t<=255;)U[2*t+1]=9,t++,L[9]++;for(;t<=279;)U[2*t+1]=7,t++,L[7]++;for(;t<=287;)U[2*t+1]=8,t++,L[8]++;for(D(U,287,L),t=0;t<x;t++)C[2*t+1]=5,C[2*t]=g(t,5);B=new v(U,r,257,o,F),J=new v(C,R,0,x,F),m=new v(new Array(0),d,0,19,7)})(),a=!0),t.l_desc=new K(t.dyn_ltree,B),t.d_desc=new K(t.dyn_dtree,J),t.bl_desc=new K(t.bl_tree,m),t.bi_buf=0,t.bi_valid=0,H(t)},t.exports._tr_stored_block=A,t.exports._tr_flush_block=(t,b,o,x)=>{let F,r,R=0;t.level>0?(2===t.strm.data_type&&(t.strm.data_type=(t=>{let b,o=4093624447;for(b=0;b<=31;b++,o>>>=1)if(1&o&&0!==t.dyn_ltree[2*b])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(b=32;b<Y;b++)if(0!==t.dyn_ltree[2*b])return 1;return 0})(t)),N(t,t.l_desc),N(t,t.d_desc),R=(t=>{let b;for(u(t,t.dyn_ltree,t.l_desc.max_code),u(t,t.dyn_dtree,t.d_desc.max_code),N(t,t.bl_desc),b=18;b>=3&&0===t.bl_tree[2*E[b]+1];b--);return t.opt_len+=3*(b+1)+5+5+4,b})(t),F=t.opt_len+3+7>>>3,r=t.static_len+3+7>>>3,r<=F&&(F=r)):F=r=o+5,o+4<=F&&-1!==b?A(t,b,o,x):4===t.strategy||r===F?(S(t,2+(x?1:0),3),Q(t,U,C)):(S(t,4+(x?1:0),3),((t,b,Y,o)=>{let x;for(S(t,b-257,5),S(t,Y-1,5),S(t,o-4,4),x=0;x<o;x++)S(t,t.bl_tree[2*E[x]+1],3);Z(t,t.dyn_ltree,b-1),Z(t,t.dyn_dtree,Y-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,R+1),Q(t,t.dyn_ltree,t.dyn_dtree)),H(t),x&&f(t)},t.exports._tr_tally=(t,b,o)=>(t.pending_buf[t.d_buf+2*t.last_lit]=b>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&b,t.pending_buf[t.l_buf+t.last_lit]=255&o,t.last_lit++,0===b?t.dyn_ltree[2*o]++:(t.matches++,b--,t.dyn_ltree[2*(W[o]+Y+1)]++,t.dyn_dtree[2*L(b)]++),t.last_lit===t.lit_bufsize-1),t.exports._tr_align=t=>{S(t,2,3),e(t,256,U),(t=>{16===t.bi_valid?(z(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(t)}},11675:t=>{"use strict";t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},12034:t=>{function b(t,b,Y){for(var o=t.length,x=-1/0,F=1/0,r=0;r<o;r++){var R=(Y[0][r]-t[r])/b[r],d=(Y[1][r]-t[r])/b[r];if(R>d){var E=R;R=d,d=E}if(d<x||R>F)return 1/0;R>x&&(x=R),d<F&&(F=d)}return x>F?1/0:x}t.exports=function(t,Y,o,x){var F=b(Y,o,x);if(F===1/0)t=null;else{t=t||[];for(var r=0;r<Y.length;r++)t[r]=Y[r]+o[r]*F}return t},t.exports.distance=b},12687:(t,b,Y)=>{"use strict";Y.d(b,{d:()=>r});var o=Y(29);const x=o.useLayoutEffect;const F=function(t){var b=(0,o.useRef)(t);return x((function(){b.current=t})),b};var r=function(t){var b=F(t);(0,o.useEffect)((function(){var t=function(t){var Y;if(null!=b.current&&(Y=b.current(t)),t.defaultPrevented&&(t.returnValue=""),"string"===typeof Y)return t.returnValue=Y,Y};return window.addEventListener("beforeunload",t),function(){window.removeEventListener("beforeunload",t)}}),[])}},12656:(t,b,Y)=>{"use strict";var o=Y(12659),x=Array.prototype.concat,F=Array.prototype.slice,r=t.exports=function(t){for(var b=[],Y=0,r=t.length;Y<r;Y++){var R=t[Y];o(R)?b=x.call(b,F.call(R)):b.push(R)}return b};r.wrap=function(t){return function(){return t(r(arguments))}}},12659:t=>{t.exports=function(t){return!(!t||"string"===typeof t)&&(t instanceof Array||Array.isArray(t)||t.length>=0&&(t.splice instanceof Function||Object.getOwnPropertyDescriptor(t,t.length-1)&&"String"!==t.constructor.name))}},11583:(t,b,Y)=>{var o=Y(11589);function x(t){for(var b,Y,x=0,F=t.length,r=0;r<t.length;){for(b=t[r],Y=0;r<F&&t[r]===b;)++r,++Y;x+=o.log2(Y)/7|0,x+=o.log2(b>>>0)/7|0,x+=2}return x}b.size=x,b.encode=function(t,b){b||(b=new Uint8Array(x(t)));for(var Y,o,F=0,r=b.length,R=0;R<t.length;){for(Y=t[R],o=0;R<t.length&&t[R]===Y;)++R,++o;for(;F<r&&o>=128;)b[F++]=128+(127&o),o>>>=7;if(F>=r)throw new Error("RLE buffer overflow");for(b[F++]=o,Y>>>=0;F<r&&Y>=128;)b[F++]=128+(127&Y),Y>>>=7;if(F>=r)throw new Error("RLE buffer overflow");b[F++]=Y}return b},b.decode=function(t,b){for(var Y,o,x,F,r=b.length,R=t.length,d=0,E=0;E<R;){for(Y=0,o=0;E<R&&t[E]>=128;)Y+=(127&t[E++])<<o,o+=7;if(Y+=t[E++]<<o,E>=R)throw new Error("RLE buffer underrun");if(d+Y>r)throw new Error("Chunk buffer overflow");for(x=0,o=0;E<R&&t[E]>=128;)x+=(127&t[E++])<<o,o+=7;if(E>=R)throw new Error("RLE buffer underrun");for(x+=t[E++]<<o,F=0;F<Y;++F)b[d++]=x}return b}},11589:(t,b)=>{"use strict";function Y(t){var b=32;return(t&=-t)&&b--,65535&t&&(b-=16),16711935&t&&(b-=8),252645135&t&&(b-=4),858993459&t&&(b-=2),1431655765&t&&(b-=1),b}b.INT_BITS=32,b.INT_MAX=2147483647,b.INT_MIN=-1<<31,b.sign=function(t){return(t>0)-(t<0)},b.abs=function(t){var b=t>>31;return(t^b)-b},b.min=function(t,b){return b^(t^b)&-(t<b)},b.max=function(t,b){return t^(t^b)&-(t<b)},b.isPow2=function(t){return!(t&t-1)&&!!t},b.log2=function(t){var b,Y;return b=(t>65535)<<4,b|=Y=((t>>>=b)>255)<<3,b|=Y=((t>>>=Y)>15)<<2,(b|=Y=((t>>>=Y)>3)<<1)|(t>>>=Y)>>1},b.log10=function(t){return t>=1e9?9:t>=1e8?8:t>=1e7?7:t>=1e6?6:t>=1e5?5:t>=1e4?4:t>=1e3?3:t>=100?2:t>=10?1:0},b.popCount=function(t){return 16843009*((t=(858993459&(t-=t>>>1&1431655765))+(t>>>2&858993459))+(t>>>4)&252645135)>>>24},b.countTrailingZeros=Y,b.nextPow2=function(t){return t+=0===t,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)+1},b.prevPow2=function(t){return t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)-(t>>>1)},b.parity=function(t){return t^=t>>>16,t^=t>>>8,t^=t>>>4,27030>>>(t&=15)&1};var o=new Array(256);!function(t){for(var b=0;b<256;++b){var Y=b,o=b,x=7;for(Y>>>=1;Y;Y>>>=1)o<<=1,o|=1&Y,--x;t[b]=o<<x&255}}(o),b.reverse=function(t){return o[255&t]<<24|o[t>>>8&255]<<16|o[t>>>16&255]<<8|o[t>>>24&255]},b.interleave2=function(t,b){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t&=65535)|t<<8))|t<<4))|t<<2))|t<<1))|(b=1431655765&((b=858993459&((b=252645135&((b=16711935&((b&=65535)|b<<8))|b<<4))|b<<2))|b<<1))<<1},b.deinterleave2=function(t,b){return(t=65535&((t=16711935&((t=252645135&((t=858993459&((t=t>>>b&1431655765)|t>>>1))|t>>>2))|t>>>4))|t>>>16))<<16>>16},b.interleave3=function(t,b,Y){return t=1227133513&((t=3272356035&((t=251719695&((t=4278190335&((t&=1023)|t<<16))|t<<8))|t<<4))|t<<2),(t|=(b=1227133513&((b=3272356035&((b=251719695&((b=4278190335&((b&=1023)|b<<16))|b<<8))|b<<4))|b<<2))<<1)|(Y=1227133513&((Y=3272356035&((Y=251719695&((Y=4278190335&((Y&=1023)|Y<<16))|Y<<8))|Y<<4))|Y<<2))<<2},b.deinterleave3=function(t,b){return(t=1023&((t=4278190335&((t=251719695&((t=3272356035&((t=t>>>b&1227133513)|t>>>2))|t>>>4))|t>>>8))|t>>>16))<<22>>22},b.nextCombination=function(t){var b=t|t-1;return b+1|(~b&-~b)-1>>>Y(t)+1}},11625:t=>{"use strict";t.exports=function(t,b,Y,o){var x=self||window;try{try{var F;try{F=new x.Blob([t])}catch(E){(F=new(x.BlobBuilder||x.WebKitBlobBuilder||x.MozBlobBuilder||x.MSBlobBuilder)).append(t),F=F.getBlob()}var r=x.URL||x.webkitURL,R=r.createObjectURL(F),d=new x[b](R,Y);return r.revokeObjectURL(R),d}catch(E){return new x[b]("data:application/javascript,".concat(encodeURIComponent(t)),Y)}}catch(E){if(!o)throw Error("Inline worker is not supported");return new x[b](o,Y)}}},12016:(t,b,Y)=>{"use strict";function o(t,b,Y,o,x){var F={};return Object.keys(o).forEach((function(t){F[t]=o[t]})),F.enumerable=!!F.enumerable,F.configurable=!!F.configurable,("value"in F||F.initializer)&&(F.writable=!0),F=Y.slice().reverse().reduce((function(Y,o){return o(t,b,Y)||Y}),F),x&&void 0!==F.initializer&&(F.value=F.initializer?F.initializer.call(x):void 0,F.initializer=void 0),void 0===F.initializer&&(Object.defineProperty(t,b,F),F=null),F}Y.d(b,{b:()=>o})},12007:(t,b,Y)=>{"use strict";function o(t,b,Y,o){Y&&Object.defineProperty(t,b,{enumerable:Y.enumerable,configurable:Y.configurable,writable:Y.writable,value:Y.initializer?Y.initializer.call(o):void 0})}Y.d(b,{e:()=>o})},12329:(t,b,Y)=>{"use strict";Y.d(b,{d:()=>m,g:()=>v,j:()=>B,k:()=>p,l:()=>y,p:()=>T,r:()=>W});var o=Y(1019),x=Y(1229),F=Y(1058),r=Y(1041),R=Y(12334),d=Y(11759),E=Y(1218),U=Y(1086),C=Y(1224);const p=Object.freeze(new o.e(0,0,0,0)),W=Object.freeze(o.l.Zero()),T=Object.freeze(o.i.Zero()),y=Object.freeze(E.c.Zero()),v=Object.freeze(x.d.Black()),B=Object.freeze(new x.h(0,0,0,0)),J={key:0,repeatCount:0,loopMode:2};class m{static _PrepareAnimation(t,b,Y,F,r,R,d,U){let C;if(!isNaN(parseFloat(r))&&isFinite(r)?C=m.ANIMATIONTYPE_FLOAT:r instanceof o.e?C=m.ANIMATIONTYPE_QUATERNION:r instanceof o.l?C=m.ANIMATIONTYPE_VECTOR3:r instanceof o.i?C=m.ANIMATIONTYPE_VECTOR2:r instanceof x.d?C=m.ANIMATIONTYPE_COLOR3:r instanceof x.h?C=m.ANIMATIONTYPE_COLOR4:r instanceof E.c&&(C=m.ANIMATIONTYPE_SIZE),void 0==C)return null;const p=new m(t,b,Y,C,d),W=[{frame:0,value:r},{frame:F,value:R}];return p.setKeys(W),void 0!==U&&p.setEasingFunction(U),p}static CreateAnimation(t,b,Y,o){const x=new m(t+"Animation",t,Y,b,m.ANIMATIONLOOPMODE_CONSTANT);return x.setEasingFunction(o),x}static CreateAndStartAnimation(t,b,Y,o,x,F,r,R,d,E,U){const C=m._PrepareAnimation(t,Y,o,x,F,r,R,d);return C?(b.va&&(U=b.va()),U?U.beginDirectAnimation(b,[C],0,x,1===C.loopMode,1,E):null):null}static CreateAndStartHierarchyAnimation(t,b,Y,o,x,F,r,R,d,E,U){const C=m._PrepareAnimation(t,o,x,F,r,R,d,E);if(!C)return null;return b.va().beginDirectHierarchyAnimation(b,Y,[C],0,F,1===C.loopMode,1,U)}static CreateMergeAndStartAnimation(t,b,Y,o,x,F,r,R,d,E){const U=m._PrepareAnimation(t,Y,o,x,F,r,R,d);return U?(b.animations.push(U),b.va().beginAnimation(b,0,x,1===U.loopMode,1,E)):null}static MakeAnimationAdditive(t,b,Y){let x;x="object"===typeof b?b:{referenceFrame:b??0,range:Y,cloneOriginalAnimation:arguments.length>3&&void 0!==arguments[3]&&arguments[3],clonedAnimationName:arguments.length>4?arguments[4]:void 0};let F=t;if(x.cloneOriginalAnimation&&(F=t.clone(),F.name=x.clonedAnimationName||F.name),!F._keys.length)return F;const r=x.referenceFrame&&x.referenceFrame>=0?x.referenceFrame:0;let R=0;const d=F._keys[0];let E=F._keys.length-1;const U=F._keys[E],C={referenceValue:d.value,referencePosition:o.f.ae[0],referenceQuaternion:o.f.Quaternion[0],referenceScaling:o.f.ae[1],keyPosition:o.f.ae[2],keyQuaternion:o.f.Quaternion[1],keyScaling:o.f.ae[3]};let p=d.frame,W=U.frame;if(x.range){const t=F.getRange(x.range);t&&(p=t.from,W=t.to)}else p=x.fromFrame??p,W=x.toFrame??W;if(p!==d.frame&&(R=F.createKeyForFrame(p)),W!==U.frame&&(E=F.createKeyForFrame(W)),1===F._keys.length){const t=F._getKeyValue(F._keys[0]);C.referenceValue=t.clone?t.clone():t}else if(r<=d.frame){const t=F._getKeyValue(d.value);C.referenceValue=t.clone?t.clone():t}else if(r>=U.frame){const t=F._getKeyValue(U.value);C.referenceValue=t.clone?t.clone():t}else{J.key=0;const t=F._interpolate(r,J);C.referenceValue=t.clone?t.clone():t}F.dataType===m.ANIMATIONTYPE_QUATERNION?C.referenceValue.normalize().conjugateInPlace():F.dataType===m.ANIMATIONTYPE_MATRIX&&(C.referenceValue.decompose(C.referenceScaling,C.referenceQuaternion,C.referencePosition),C.referenceQuaternion.normalize().conjugateInPlace());let T=Number.MAX_VALUE;const y=x.clipKeys?[]:null;for(let v=R;v<=E;v++){let t=F._keys[v];if((y||x.cloneOriginalAnimation)&&(t={frame:t.frame,value:t.value.clone?t.value.clone():t.value,inTangent:t.inTangent,outTangent:t.outTangent,interpolation:t.interpolation,lockedTangent:t.lockedTangent},y&&(T===Number.MAX_VALUE&&(T=t.frame),t.frame-=T,y.push(t))),!v||F.dataType===m.ANIMATIONTYPE_FLOAT||t.value!==d.value)switch(F.dataType){case m.ANIMATIONTYPE_MATRIX:t.value.decompose(C.keyScaling,C.keyQuaternion,C.keyPosition),C.keyPosition.fe(C.referencePosition),C.keyScaling.divideInPlace(C.referenceScaling),C.referenceQuaternion.multiplyToRef(C.keyQuaternion,C.keyQuaternion),o.c.ComposeToRef(C.keyScaling,C.keyQuaternion,C.keyPosition,t.value);break;case m.ANIMATIONTYPE_QUATERNION:C.referenceValue.multiplyToRef(t.value,t.value);break;case m.ANIMATIONTYPE_VECTOR2:case m.ANIMATIONTYPE_VECTOR3:case m.ANIMATIONTYPE_COLOR3:case m.ANIMATIONTYPE_COLOR4:t.value.subtractToRef(C.referenceValue,t.value);break;case m.ANIMATIONTYPE_SIZE:t.value.width-=C.referenceValue.width,t.value.height-=C.referenceValue.height;break;default:t.value-=C.referenceValue}}return y&&F.setKeys(y,!0),F}static TransitionTo(t,b,Y,o,x,F,r){let R=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;if(r<=0)return Y[t]=b,R&&R(),null;const d=x*(r/1e3);F.setKeys([{frame:0,value:Y[t].clone?Y[t].clone():Y[t]},{frame:d,value:b}]),Y.animations||(Y.animations=[]),Y.animations.push(F);const E=o.beginAnimation(Y,0,d,!1);return E.onAnimationEnd=R,E}get runtimeAnimations(){return this._runtimeAnimations}get hasRunningRuntimeAnimations(){for(const t of this._runtimeAnimations)if(!t.isStopped())return!0;return!1}constructor(t,b,Y,o,x,F){this.name=t,this.targetProperty=b,this.framePerSecond=Y,this.dataType=o,this.loopMode=x,this.enableBlending=F,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=b.split("."),this.dataType=o,this.loopMode=void 0===x?m.ANIMATIONLOOPMODE_CYCLE:x,this.uniqueId=m._UniqueIdGenerator++}toString(t){let b="Name: "+this.name+", property: "+this.targetProperty;if(b+=", datatype: "+["Float","ae","Quaternion","Matrix","Le","Vector2"][this.dataType],b+=", nKeys: "+(this._keys?this._keys.length:"none"),b+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),t){b+=", Ranges: {";let t=!0;for(const Y in this._ranges)t&&(b+=", ",t=!1),b+=Y;b+="}"}return b}addEvent(t){this._events.push(t),this._events.sort(((t,b)=>t.frame-b.frame))}removeEvents(t){for(let b=0;b<this._events.length;b++)this._events[b].frame===t&&(this._events.splice(b,1),b--)}getEvents(){return this._events}createRange(t,b,Y){this._ranges[t]||(this._ranges[t]=new R.b(t,b,Y))}deleteRange(t){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const Y=this._ranges[t];if(Y){if(b){const t=Y.from,b=Y.to;for(let Y=this._keys.length-1;Y>=0;Y--)this._keys[Y].frame>=t&&this._keys[Y].frame<=b&&this._keys.splice(Y,1)}this._ranges[t]=null}}getRange(t){return this._ranges[t]}getKeys(){return this._keys}getHighestFrame(){let t=0;for(let b=0,Y=this._keys.length;b<Y;b++)t<this._keys[b].frame&&(t=this._keys[b].frame);return t}getEasingFunction(){return this._easingFunction}setEasingFunction(t){this._easingFunction=t}floatInterpolateFunction(t,b,Y){return(0,F.n)(t,b,Y)}floatInterpolateFunctionWithTangents(t,b,Y,o,x){return(0,F.f)(t,b,Y,o,x)}quaternionInterpolateFunction(t,b,Y){return o.e.Slerp(t,b,Y)}quaternionInterpolateFunctionWithTangents(t,b,Y,x,F){return o.e.Hermite(t,b,Y,x,F).normalize()}vector3InterpolateFunction(t,b,Y){return o.l.Lerp(t,b,Y)}vector3InterpolateFunctionWithTangents(t,b,Y,x,F){return o.l.Hermite(t,b,Y,x,F)}vector2InterpolateFunction(t,b,Y){return o.i.Lerp(t,b,Y)}vector2InterpolateFunctionWithTangents(t,b,Y,x,F){return o.i.Hermite(t,b,Y,x,F)}sizeInterpolateFunction(t,b,Y){return E.c.Lerp(t,b,Y)}color3InterpolateFunction(t,b,Y){return x.d.Lerp(t,b,Y)}color3InterpolateFunctionWithTangents(t,b,Y,o,F){return x.d.Hermite(t,b,Y,o,F)}color4InterpolateFunction(t,b,Y){return x.h.Lerp(t,b,Y)}color4InterpolateFunctionWithTangents(t,b,Y,o,F){return x.h.Hermite(t,b,Y,o,F)}_getKeyValue(t){return"function"===typeof t?t():t}evaluate(t){return J.key=0,this._interpolate(t,J)}_interpolate(t,b){let Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(b.loopMode===m.ANIMATIONLOOPMODE_CONSTANT&&b.repeatCount>0)return b.highLimitValue.clone?b.highLimitValue.clone():b.highLimitValue;const o=this._keys,x=o.length;let F=b.key;for(;F>=0&&t<o[F].frame;)--F;for(;F+1<=x-1&&t>=o[F+1].frame;)++F;if(b.key=F,F<0)return Y?void 0:this._getKeyValue(o[0].value);if(F+1>x-1)return Y?void 0:this._getKeyValue(o[x-1].value);const r=o[F],R=o[F+1];if(Y&&(t===r.frame||t===R.frame))return;const d=this._getKeyValue(r.value),E=this._getKeyValue(R.value);if(1===r.interpolation)return R.frame>t?d:E;const U=void 0!==r.outTangent&&void 0!==R.inTangent,C=R.frame-r.frame;let J=(t-r.frame)/C;const K=r.easingFunction||this.getEasingFunction();switch(null!==K&&(J=K.ease(J)),this.dataType){case m.ANIMATIONTYPE_FLOAT:{const t=U?this.floatInterpolateFunctionWithTangents(d,r.outTangent*C,E,R.inTangent*C,J):this.floatInterpolateFunction(d,E,J);switch(b.loopMode){case m.ANIMATIONLOOPMODE_CYCLE:case m.ANIMATIONLOOPMODE_CONSTANT:case m.ANIMATIONLOOPMODE_YOYO:return t;case m.ANIMATIONLOOPMODE_RELATIVE:case m.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return(b.offsetValue??0)*b.repeatCount+t}break}case m.ANIMATIONTYPE_QUATERNION:{const t=U?this.quaternionInterpolateFunctionWithTangents(d,r.outTangent.scale(C),E,R.inTangent.scale(C),J):this.quaternionInterpolateFunction(d,E,J);switch(b.loopMode){case m.ANIMATIONLOOPMODE_CYCLE:case m.ANIMATIONLOOPMODE_CONSTANT:case m.ANIMATIONLOOPMODE_YOYO:return t;case m.ANIMATIONLOOPMODE_RELATIVE:case m.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return t.addInPlace((b.offsetValue||p).scale(b.repeatCount))}return t}case m.ANIMATIONTYPE_VECTOR3:{const t=U?this.vector3InterpolateFunctionWithTangents(d,r.outTangent.scale(C),E,R.inTangent.scale(C),J):this.vector3InterpolateFunction(d,E,J);switch(b.loopMode){case m.ANIMATIONLOOPMODE_CYCLE:case m.ANIMATIONLOOPMODE_CONSTANT:case m.ANIMATIONLOOPMODE_YOYO:return t;case m.ANIMATIONLOOPMODE_RELATIVE:case m.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return t.add((b.offsetValue||W).scale(b.repeatCount))}break}case m.ANIMATIONTYPE_VECTOR2:{const t=U?this.vector2InterpolateFunctionWithTangents(d,r.outTangent.scale(C),E,R.inTangent.scale(C),J):this.vector2InterpolateFunction(d,E,J);switch(b.loopMode){case m.ANIMATIONLOOPMODE_CYCLE:case m.ANIMATIONLOOPMODE_CONSTANT:case m.ANIMATIONLOOPMODE_YOYO:return t;case m.ANIMATIONLOOPMODE_RELATIVE:case m.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return t.add((b.offsetValue||T).scale(b.repeatCount))}break}case m.ANIMATIONTYPE_SIZE:switch(b.loopMode){case m.ANIMATIONLOOPMODE_CYCLE:case m.ANIMATIONLOOPMODE_CONSTANT:case m.ANIMATIONLOOPMODE_YOYO:return this.sizeInterpolateFunction(d,E,J);case m.ANIMATIONLOOPMODE_RELATIVE:case m.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return this.sizeInterpolateFunction(d,E,J).add((b.offsetValue||y).scale(b.repeatCount))}break;case m.ANIMATIONTYPE_COLOR3:{const t=U?this.color3InterpolateFunctionWithTangents(d,r.outTangent.scale(C),E,R.inTangent.scale(C),J):this.color3InterpolateFunction(d,E,J);switch(b.loopMode){case m.ANIMATIONLOOPMODE_CYCLE:case m.ANIMATIONLOOPMODE_CONSTANT:case m.ANIMATIONLOOPMODE_YOYO:return t;case m.ANIMATIONLOOPMODE_RELATIVE:case m.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return t.add((b.offsetValue||v).scale(b.repeatCount))}break}case m.ANIMATIONTYPE_COLOR4:{const t=U?this.color4InterpolateFunctionWithTangents(d,r.outTangent.scale(C),E,R.inTangent.scale(C),J):this.color4InterpolateFunction(d,E,J);switch(b.loopMode){case m.ANIMATIONLOOPMODE_CYCLE:case m.ANIMATIONLOOPMODE_CONSTANT:case m.ANIMATIONLOOPMODE_YOYO:return t;case m.ANIMATIONLOOPMODE_RELATIVE:case m.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return t.add((b.offsetValue||B).scale(b.repeatCount))}break}case m.ANIMATIONTYPE_MATRIX:switch(b.loopMode){case m.ANIMATIONLOOPMODE_CYCLE:case m.ANIMATIONLOOPMODE_CONSTANT:case m.ANIMATIONLOOPMODE_YOYO:return m.AllowMatricesInterpolation?this.matrixInterpolateFunction(d,E,J,b.workValue):d;case m.ANIMATIONLOOPMODE_RELATIVE:case m.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return d}}return 0}matrixInterpolateFunction(t,b,Y,x){return m.AllowMatrixDecomposeForInterpolation?x?(o.c.DecomposeLerpToRef(t,b,Y,x),x):o.c.DecomposeLerp(t,b,Y):x?(o.c.LerpToRef(t,b,Y,x),x):o.c.Lerp(t,b,Y)}clone(){const t=new m(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(t.enableBlending=this.enableBlending,t.blendingSpeed=this.blendingSpeed,this._keys&&t.setKeys(this._keys),this._ranges){t._ranges={};for(const b in this._ranges){const Y=this._ranges[b];Y&&(t._ranges[b]=Y.clone())}}return t}setKeys(t){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._keys=b?t:t.slice(0)}createKeyForFrame(t){J.key=0;const b=this._interpolate(t,J,!0);if(!b)return this._keys[J.key].frame===t?J.key:J.key+1;const Y={frame:t,value:b.clone?b.clone():b};return this._keys.splice(J.key+1,0,Y),J.key+1}serialize(){const t={};t.name=this.name,t.property=this.targetProperty,t.framePerSecond=this.framePerSecond,t.dataType=this.dataType,t.loopBehavior=this.loopMode,t.enableBlending=this.enableBlending,t.blendingSpeed=this.blendingSpeed;const b=this.dataType;t.keys=[];const Y=this.getKeys();for(let o=0;o<Y.length;o++){const x=Y[o],F={};switch(F.frame=x.frame,b){case m.ANIMATIONTYPE_FLOAT:F.values=[x.value],void 0!==x.inTangent&&F.values.push(x.inTangent),void 0!==x.outTangent&&(void 0===x.inTangent&&F.values.push(void 0),F.values.push(x.outTangent)),void 0!==x.interpolation&&(void 0===x.inTangent&&F.values.push(void 0),void 0===x.outTangent&&F.values.push(void 0),F.values.push(x.interpolation));break;case m.ANIMATIONTYPE_QUATERNION:case m.ANIMATIONTYPE_MATRIX:case m.ANIMATIONTYPE_VECTOR3:case m.ANIMATIONTYPE_COLOR3:case m.ANIMATIONTYPE_COLOR4:F.values=x.value.qe(),void 0!=x.inTangent&&F.values.push(x.inTangent.qe()),void 0!=x.outTangent&&(void 0===x.inTangent&&F.values.push(void 0),F.values.push(x.outTangent.qe())),void 0!==x.interpolation&&(void 0===x.inTangent&&F.values.push(void 0),void 0===x.outTangent&&F.values.push(void 0),F.values.push(x.interpolation))}t.keys.push(F)}t.ranges=[];for(const o in this._ranges){const b=this._ranges[o];if(!b)continue;const Y={};Y.name=o,Y.from=b.from,Y.to=b.to,t.ranges.push(Y)}return t}static _UniversalLerp(t,b,Y){const o=t.constructor;return o.Lerp?o.Lerp(t,b,Y):o.Slerp?o.Slerp(t,b,Y):t.toFixed?t*(1-Y)+Y*b:b}static Parse(t){const b=new m(t.name,t.property,t.framePerSecond,t.dataType,t.loopBehavior),Y=t.dataType,F=[];let r,R;for(t.enableBlending&&(b.enableBlending=t.enableBlending),t.blendingSpeed&&(b.blendingSpeed=t.blendingSpeed),R=0;R<t.keys.length;R++){const b=t.keys[R];let d,E,U;switch(Y){case m.ANIMATIONTYPE_FLOAT:r=b.values[0],b.values.length>=2&&(d=b.values[1]),b.values.length>=3&&(E=b.values[2]),b.values.length>=4&&(U=b.values[3]);break;case m.ANIMATIONTYPE_QUATERNION:if(r=o.e.ce(b.values),b.values.length>=8){const t=o.e.ce(b.values.slice(4,8));t.equals(o.e.Zero())||(d=t)}if(b.values.length>=12){const t=o.e.ce(b.values.slice(8,12));t.equals(o.e.Zero())||(E=t)}b.values.length>=13&&(U=b.values[12]);break;case m.ANIMATIONTYPE_MATRIX:r=o.c.ce(b.values),b.values.length>=17&&(U=b.values[16]);break;case m.ANIMATIONTYPE_COLOR3:r=x.d.ce(b.values),b.values[3]&&(d=x.d.ce(b.values[3])),b.values[4]&&(E=x.d.ce(b.values[4])),b.values[5]&&(U=b.values[5]);break;case m.ANIMATIONTYPE_COLOR4:r=x.h.ce(b.values),b.values[4]&&(d=x.h.ce(b.values[4])),b.values[5]&&(E=x.h.ce(b.values[5])),b.values[6]&&(U=x.h.ce(b.values[6]));break;case m.ANIMATIONTYPE_VECTOR3:default:r=o.l.ce(b.values),b.values[3]&&(d=o.l.ce(b.values[3])),b.values[4]&&(E=o.l.ce(b.values[4])),b.values[5]&&(U=b.values[5])}const C={};C.frame=b.frame,C.value=r,void 0!=d&&(C.inTangent=d),void 0!=E&&(C.outTangent=E),void 0!=U&&(C.interpolation=U),F.push(C)}if(b.setKeys(F),t.ranges)for(R=0;R<t.ranges.length;R++)r=t.ranges[R],b.createRange(r.name,r.from,r.to);return b}static AppendSerializedAnimations(t,b){C.d.AppendSerializedAnimations(t,b)}static ParseFromFileAsync(t,b){return new Promise(((Y,o)=>{const x=new U.e;x.addEventListener("readystatechange",(()=>{if(4==x.readyState)if(200==x.status){let b=JSON.parse(x.responseText);if(b.animations&&(b=b.animations),b.length){const t=[];for(const Y of b)t.push(this.Parse(Y));Y(t)}else{const o=this.Parse(b);t&&(o.name=t),Y(o)}}else o("Unable to load the animation")})),x.open("GET",b),x.send()}))}static ParseFromSnippetAsync(t){return new Promise(((b,Y)=>{const o=new U.e;o.addEventListener("readystatechange",(()=>{if(4==o.readyState)if(200==o.status){const Y=JSON.parse(JSON.parse(o.responseText).jsonPayload);if(Y.animations){const o=JSON.parse(Y.animations),x=[];for(const b of o.animations){const Y=this.Parse(b);Y.snippetId=t,x.push(Y)}b(x)}else{const o=JSON.parse(Y.animation),x=this.Parse(o);x.snippetId=t,b(x)}}else Y("Unable to load the snippet "+t)})),o.open("GET",this.SnippetUrl+"/"+t.replace(/#/g,"/")),o.send()}))}}m._UniqueIdGenerator=0,m.AllowMatricesInterpolation=!1,m.AllowMatrixDecomposeForInterpolation=!0,m.SnippetUrl="https://snippet.babylonjs.com",m.ANIMATIONTYPE_FLOAT=0,m.ANIMATIONTYPE_VECTOR3=1,m.ANIMATIONTYPE_QUATERNION=2,m.ANIMATIONTYPE_MATRIX=3,m.ANIMATIONTYPE_COLOR3=4,m.ANIMATIONTYPE_COLOR4=7,m.ANIMATIONTYPE_VECTOR2=5,m.ANIMATIONTYPE_SIZE=6,m.ANIMATIONLOOPMODE_RELATIVE=0,m.ANIMATIONLOOPMODE_CYCLE=1,m.ANIMATIONLOOPMODE_CONSTANT=2,m.ANIMATIONLOOPMODE_YOYO=4,m.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT=5,m.CreateFromSnippetAsync=m.ParseFromSnippetAsync,(0,r.d)("BABYLON.Animation",m),d.c._AnimationRangeFactory=(t,b,Y)=>new R.b(t,b,Y)},12334:(t,b,Y)=>{"use strict";Y.d(b,{b:()=>o});class o{constructor(t,b,Y){this.name=t,this.from=b,this.to=Y}clone(){return new o(this.name,this.from,this.to)}}},12320:(t,b,Y)=>{"use strict";Y.d(b,{d:()=>r});var o=Y(1019),x=Y(1035),F=Y(11759);class r extends F.c{get _matrix(){return this._compose(),this.Kj}set _matrix(t){(t.updateFlag!==this.Kj.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.Kj.p(t),this._markAsDirtyAndDecompose())}constructor(t,b){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,R=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(t,b.va(),!1),this.name=t,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=b,this.Kj=(null===x||void 0===x?void 0:x.clone())??o.c.Identity(),this._restMatrix=F??this.Kj.clone(),this._bindMatrix=r??this.Kj.clone(),this._index=R,this._absoluteMatrix=new o.c,this._absoluteBindMatrix=new o.c,this._absoluteInverseBindMatrix=new o.c,this._finalMatrix=new o.c,b.bones.push(this),this.setParent(Y,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(t){this.setParent(t)}setParent(t){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==t){if(this.parent){const t=this.parent.children.indexOf(this);-1!==t&&this.parent.children.splice(t,1)}this._parentNode=t,this.parent&&this.parent.children.push(this),b&&this._updateAbsoluteBindMatrices(),this.Ae()}}getLocalMatrix(){return this._compose(),this.Kj}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(t){this._restMatrix.p(t)}setRestPose(t){this.setRestMatrix(t)}getBindPose(){return this.getBindMatrix()}setBindMatrix(t){this.Ge(t)}setBindPose(t){this.setBindMatrix(t)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const t=o.f.ae[0],b=o.f.Quaternion[0],Y=o.f.ae[1];this.getRestMatrix().decompose(t,b,Y),this._linkedTransformNode.position.p(Y),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??o.e.Identity(),this._linkedTransformNode.rotationQuaternion.p(b),this._linkedTransformNode.Oe.p(t)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(t){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=t,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.vg}set position(t){this._decompose(),this.vg.p(t),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(t){this.setRotation(t)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(t){this.setRotationQuaternion(t)}get Oe(){return this.getScale()}set Oe(t){this.setScale(t)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=o.l.Zero(),this._localRotation=o.e.Zero(),this.vg=o.l.Zero()),this.Kj.decompose(this._localScaling,this._localRotation,this.vg))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,o.c.ComposeToRef(this._localScaling,this._localRotation,this.vg,this.Kj)):this._needToCompose=!1)}Ge(t){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],Y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.p(t),b&&this._updateAbsoluteBindMatrices(),Y?this._matrix=t:this.Ae()}_updateAbsoluteBindMatrices(t){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(t||(t=this._bindMatrix),this.parent?t.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.p(t),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),b)for(let Y=0;Y<this.children.length;Y++)this.children[Y]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}Ae(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.Ae(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.Ae(),this._needToDecompose=!0}_updatePosition(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Y=arguments.length>2?arguments[2]:void 0,x=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const F=this.getLocalMatrix();if(0==b)x?(F.addAtIndex(12,t.x),F.addAtIndex(13,t.y),F.addAtIndex(14,t.z)):F.setTranslationFromFloats(t.x,t.y,t.z);else{let b=null;Y&&(b=Y.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const R=r._TmpMats[0],d=r._TmpVecs[0];this.parent?Y&&b?(R.p(this.parent.getAbsoluteMatrix()),R.multiplyToRef(b,R)):R.p(this.parent.getAbsoluteMatrix()):o.c.IdentityToRef(R),x&&R.setTranslationFromFloats(0,0,0),R.invert(),o.l.TransformCoordinatesToRef(t,R,d),x?(F.addAtIndex(12,d.x),F.addAtIndex(13,d.y),F.addAtIndex(14,d.z)):F.setTranslationFromFloats(d.x,d.y,d.z)}this._markAsDirtyAndDecompose()}translate(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Y=arguments.length>2?arguments[2]:void 0;this._updatePosition(t,b,Y,!0)}setPosition(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Y=arguments.length>2?arguments[2]:void 0;this._updatePosition(t,b,Y,!1)}setAbsolutePosition(t,b){this.setPosition(t,1,b)}scale(t,b,Y){let x=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const F=this.getLocalMatrix(),R=r._TmpMats[0];o.c.ScalingToRef(t,b,Y,R),R.multiplyToRef(F,F),R.invert();for(const o of this.children){const x=o.getLocalMatrix();x.multiplyToRef(R,x),x.multiplyAtIndex(12,t),x.multiplyAtIndex(13,b),x.multiplyAtIndex(14,Y),o._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),x)for(const o of this.children)o.scale(t,b,Y,x)}setScale(t){this._decompose(),this._localScaling.p(t),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(t){this._decompose(),t.p(this._localScaling)}setYawPitchRoll(t,b,Y){let x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,F=arguments.length>4?arguments[4]:void 0;if(0===x){const R=r._TmpQuat;return o.e.RotationYawPitchRollToRef(t,b,Y,R),void this.setRotationQuaternion(R,x,F)}const R=r._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(R,F))return;const d=r._TmpMats[1];o.c.RotationYawPitchRollToRef(t,b,Y,d),R.multiplyToRef(d,d),this._rotateWithMatrix(d,x,F)}rotate(t,b){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,x=arguments.length>3?arguments[3]:void 0;const F=r._TmpMats[0];F.setTranslationFromFloats(0,0,0),o.c.RotationAxisToRef(t,b,F),this._rotateWithMatrix(F,Y,x)}setAxisAngle(t,b){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,x=arguments.length>3?arguments[3]:void 0;if(0===Y){const F=r._TmpQuat;return o.e.RotationAxisToRef(t,b,F),void this.setRotationQuaternion(F,Y,x)}const F=r._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(F,x))return;const R=r._TmpMats[1];o.c.RotationAxisToRef(t,b,R),F.multiplyToRef(R,R),this._rotateWithMatrix(R,Y,x)}setRotation(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Y=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(t.y,t.x,t.z,b,Y)}setRotationQuaternion(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Y=arguments.length>2?arguments[2]:void 0;if(0===b)return this._decompose(),this._localRotation.p(t),void this._markAsDirtyAndCompose();const x=r._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(x,Y))return;const F=r._TmpMats[1];o.c.FromQuaternionToRef(t,F),x.multiplyToRef(F,F),this._rotateWithMatrix(F,b,Y)}setRotationMatrix(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Y=arguments.length>2?arguments[2]:void 0;if(0===b){const x=r._TmpQuat;return o.e.FromRotationMatrixToRef(t,x),void this.setRotationQuaternion(x,b,Y)}const x=r._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(x,Y))return;const F=r._TmpMats[1];F.p(t),x.multiplyToRef(t,F),this._rotateWithMatrix(F,b,Y)}_rotateWithMatrix(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Y=arguments.length>2?arguments[2]:void 0;const o=this.getLocalMatrix(),x=o.m[12],F=o.m[13],R=o.m[14],d=this.getParent(),E=r._TmpMats[3],U=r._TmpMats[4];d&&1==b?(Y?(E.p(Y.getWorldMatrix()),d.getAbsoluteMatrix().multiplyToRef(E,E)):E.p(d.getAbsoluteMatrix()),U.p(E),U.invert(),o.multiplyToRef(E,o),o.multiplyToRef(t,o),o.multiplyToRef(U,o)):1==b&&Y?(E.p(Y.getWorldMatrix()),U.p(E),U.invert(),o.multiplyToRef(E,o),o.multiplyToRef(t,o),o.multiplyToRef(U,o)):o.multiplyToRef(t,o),o.setTranslationFromFloats(x,F,R),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(t,b){const Y=r._TmpMats[2];return t.p(this.getAbsoluteMatrix()),b?(t.multiplyToRef(b.getWorldMatrix(),t),o.c.ScalingToRef(b.Oe.x,b.Oe.y,b.Oe.z,Y)):o.c.IdentityToRef(Y),t.invert(),!isNaN(t.m[0])&&(Y.multiplyAtIndex(0,this._scalingDeterminant),t.multiplyToRef(Y,t),!0)}cb(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Y=o.l.Zero();return this.getPositionToRef(t,b,Y),Y}getPositionToRef(){let t=arguments.length>1?arguments[1]:void 0,b=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const t=this.getLocalMatrix();b.x=t.m[12],b.y=t.m[13],b.z=t.m[14]}else{let Y=null;t&&(Y=t.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let o=r._TmpMats[0];t&&Y?(o.p(this.getAbsoluteMatrix()),o.multiplyToRef(Y,o)):o=this.getAbsoluteMatrix(),b.x=o.m[12],b.y=o.m[13],b.z=o.m[14]}}getAbsolutePosition(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const b=o.l.Zero();return this.getPositionToRef(1,t,b),b}getAbsolutePositionToRef(t,b){this.getPositionToRef(1,t,b)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.Kj.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.p(this.Kj);const t=this._skeleton.getPoseMatrix();t&&this._absoluteMatrix.multiplyToRef(t,this._absoluteMatrix)}const t=this.children,b=t.length;for(let Y=0;Y<b;Y++)t[Y].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}pf(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Y=o.l.Zero();return this.getDirectionToRef(t,b,Y),Y}getDirectionToRef(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Y=arguments.length>2?arguments[2]:void 0,x=null;b&&(x=b.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const F=r._TmpMats[0];F.p(this.getAbsoluteMatrix()),b&&x&&F.multiplyToRef(x,F),o.l.TransformNormalToRef(t,F,Y),Y.normalize()}getRotation(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Y=o.l.Zero();return this.getRotationToRef(t,b,Y),Y}getRotationToRef(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Y=arguments.length>2?arguments[2]:void 0;const o=r._TmpQuat;this.getRotationQuaternionToRef(t,b,o),o.toEulerAnglesToRef(Y)}getRotationQuaternion(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Y=o.e.Identity();return this.getRotationQuaternionToRef(t,b,Y),Y}getRotationQuaternionToRef(){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),b.p(this._localRotation);else{const Y=r._TmpMats[0],o=this.getAbsoluteMatrix();t?o.multiplyToRef(t.getWorldMatrix(),Y):Y.p(o),Y.multiplyAtIndex(0,this._scalingDeterminant),Y.multiplyAtIndex(1,this._scalingDeterminant),Y.multiplyAtIndex(2,this._scalingDeterminant),Y.decompose(void 0,b,void 0)}}getRotationMatrix(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1?arguments[1]:void 0;const Y=o.c.Identity();return this.getRotationMatrixToRef(t,b,Y),Y}getRotationMatrixToRef(){let t=arguments.length>1?arguments[1]:void 0,b=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(b);else{const Y=r._TmpMats[0],o=this.getAbsoluteMatrix();t?o.multiplyToRef(t.getWorldMatrix(),Y):Y.p(o),Y.multiplyAtIndex(0,this._scalingDeterminant),Y.multiplyAtIndex(1,this._scalingDeterminant),Y.multiplyAtIndex(2,this._scalingDeterminant),Y.getRotationMatrixToRef(b)}}getAbsolutePositionFromLocal(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Y=o.l.Zero();return this.getAbsolutePositionFromLocalToRef(t,b,Y),Y}getAbsolutePositionFromLocalToRef(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Y=arguments.length>2?arguments[2]:void 0,x=null;b&&(x=b.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const F=r._TmpMats[0];F.p(this.getAbsoluteMatrix()),b&&x&&F.multiplyToRef(x,F),o.l.TransformCoordinatesToRef(t,F,Y)}getLocalPositionFromAbsolute(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Y=o.l.Zero();return this.getLocalPositionFromAbsoluteToRef(t,b,Y),Y}getLocalPositionFromAbsoluteToRef(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Y=arguments.length>2?arguments[2]:void 0,x=null;b&&(x=b.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const F=r._TmpMats[0];F.p(this.getAbsoluteMatrix()),b&&x&&F.multiplyToRef(x,F),F.invert(),o.l.TransformCoordinatesToRef(t,F,Y)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}}r._TmpVecs=(0,x.d)(2,o.l.Zero),r._TmpQuat=o.e.Identity(),r._TmpMats=(0,x.d)(5,o.c.Identity)},12680:(t,b,Y)=>{"use strict";Y.d(b,{e:()=>Q});var o=Y(999),x=Y(1001),F=Y(1013),r=Y(1019),R=Y(11759),d=Y(11737),E=Y(1343),U=Y(1195),C=Y(1028);class p{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(t){this._zoomStopsAnimation=t}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(t){this._idleRotationSpeed=t}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(t){this._idleRotationWaitTime=t}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(t){this._idleRotationSpinupTime=t}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(t){this._attachedCamera=t;const b=this._attachedCamera.va();this._onPrePointerObservableObserver=b.onPrePointerObservable.add((t=>{t.type!==E.b.POINTERDOWN?t.type===E.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=t.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const t=U.c.Now;let b=0;null!=this._lastFrameTime&&(b=t-this._lastFrameTime),this._lastFrameTime=t,this._applyUserInteraction();const Y=t-this._lastInteractionTime-this._idleRotationWaitTime,o=Math.max(Math.min(Y/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*o,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(b/1e3))}))}detach(){if(!this._attachedCamera)return;const t=this._attachedCamera.va();this._onPrePointerObservableObserver&&t.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(t){this._lastInteractionTime=t??U.c.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<C.e}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let t=!1;return this._lastFrameRadius===this._attachedCamera.i&&0!==this._attachedCamera.inertialRadiusOffset&&(t=!0),this._lastFrameRadius=this._attachedCamera.i,this._zoomStopsAnimation?t:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=U.c.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}Y(1566);class W{constructor(){this._easingMode=W.EASINGMODE_EASEIN}setEasingMode(t){const b=Math.min(Math.max(t,0),2);this._easingMode=b}getEasingMode(){return this._easingMode}easeInCore(t){throw new Error("You must implement this method")}ease(t){switch(this._easingMode){case W.EASINGMODE_EASEIN:return this.easeInCore(t);case W.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-t)}return t>=.5?.5*(1-this.easeInCore(2*(1-t)))+.5:.5*this.easeInCore(2*t)}}W.EASINGMODE_EASEIN=0,W.EASINGMODE_EASEOUT=1,W.EASINGMODE_EASEINOUT=2;var T=Y(12329);class y{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(t){if(this._autoTransitionRange===t)return;this._autoTransitionRange=t;const b=this._attachedCamera;b&&(t?this._onMeshTargetChangedObserver=b.onMeshTargetChangedObservable.add((t=>{if(t&&(t.ve(!0),t.getBoundingInfo)){const b=t.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*b,this.upperRadiusTransitionRange=.05*b}})):this._onMeshTargetChangedObserver&&b.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(t){this._attachedCamera=t,this._onAfterCheckInputsObserver=t.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(t){return!!this._attachedCamera&&(this._attachedCamera.i===t&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(t){if(!this._attachedCamera)return;this._radiusBounceTransition||(y.EasingFunction.setEasingMode(y.EasingMode),this._radiusBounceTransition=T.d.CreateAnimation("i",T.d.ANIMATIONTYPE_FLOAT,60,y.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const b=T.d.TransitionTo("i",this._attachedCamera.i+t,this._attachedCamera,this._attachedCamera.va(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));b&&this._animatables.push(b)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}y.EasingFunction=new class extends W{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=t}easeInCore(t){const b=Math.max(0,this.amplitude);return Math.pow(t,3)-t*b*Math.sin(3.141592653589793*t)}}(.3),y.EasingMode=W.EASINGMODE_EASEOUT;class v{constructor(){this.onTargetFramingAnimationEndObservable=new F.e,this._mode=v.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(t){this._mode=t}get mode(){return this._mode}set radiusScale(t){this._radiusScale=t}get radiusScale(){return this._radiusScale}set positionScale(t){this._positionScale=t}get positionScale(){return this._positionScale}set defaultElevation(t){this._defaultElevation=t}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(t){this._elevationReturnTime=t}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(t){this._elevationReturnWaitTime=t}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(t){this._zoomStopsAnimation=t}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(t){this._framingTime=t}get framingTime(){return this._framingTime}init(){}attach(t){this._attachedCamera=t;const b=this._attachedCamera.va();v.EasingFunction.setEasingMode(v.EasingMode),this._onPrePointerObservableObserver=b.onPrePointerObservable.add((t=>{t.type!==E.b.POINTERDOWN?t.type===E.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=t.onMeshTargetChangedObservable.add((t=>{t&&t.getBoundingInfo&&this.zoomOnMesh(t,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=t.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const t=this._attachedCamera.va();this._onPrePointerObservableObserver&&t.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(t){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;t.ve(!0);const o=t.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(o.minimumWorld,o.maximumWorld,b,Y)}zoomOnMeshHierarchy(t){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;t.ve(!0);const o=t.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(o.min,o.max,b,Y)}zoomOnMeshesHierarchy(t){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=new r.l(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),x=new r.l(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let F=0;F<t.length;F++){const b=t[F].getHierarchyBoundingVectors(!0);r.l.CheckExtends(b.min,o,x),r.l.CheckExtends(b.max,o,x)}this.zoomOnBoundingInfo(o,x,b,Y)}zoomOnBoundingInfo(t,b){let Y,o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const F=t.y,R=F+(b.y-F)*this._positionScale,d=b.fd(t).scale(.5);if(o)Y=new r.l(0,R,0);else{const b=t.add(d);Y=new r.l(b.x,R,b.z)}this._vectorTransition||(this._vectorTransition=T.d.CreateAnimation("target",T.d.ANIMATIONTYPE_VECTOR3,60,v.EasingFunction)),this._betaIsAnimating=!0;let E=T.d.TransitionTo("target",Y,this._attachedCamera,this._attachedCamera.va(),60,this._vectorTransition,this._framingTime);E&&this._animatables.push(E);let U=0;if(this._mode===v.FitFrustumSidesMode){const Y=this._calculateLowerRadiusFromModelBoundingSphere(t,b);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=d.length()+this._attachedCamera._i),U=Y}else this._mode===v.IgnoreBoundsSizeMode&&(U=this._calculateLowerRadiusFromModelBoundingSphere(t,b),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera._i));if(this.autoCorrectCameraLimitsAndSensibility){const Y=b.fd(t).length();this._attachedCamera.panningSensibility=5e3/Y,this._attachedCamera.wheelPrecision=100/U}return this._radiusTransition||(this._radiusTransition=T.d.CreateAnimation("i",T.d.ANIMATIONTYPE_FLOAT,60,v.EasingFunction)),E=T.d.TransitionTo("i",U,this._attachedCamera,this._attachedCamera.va(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),x&&x(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),E&&this._animatables.push(E),!0}_calculateLowerRadiusFromModelBoundingSphere(t,b){const Y=this._attachedCamera;if(!Y)return 0;let o=Y._calculateLowerRadiusFromModelBoundingSphere(t,b,this._radiusScale);return Y.lowerRadiusLimit&&this._mode===v.IgnoreBoundsSizeMode&&(o=o<Y.lowerRadiusLimit?Y.lowerRadiusLimit:o),Y.upperRadiusLimit&&(o=o>Y.upperRadiusLimit?Y.upperRadiusLimit:o),o}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const t=U.c.Now-this._lastInteractionTime,b=.5*Math.PI-this._defaultElevation,Y=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>Y&&t>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=T.d.CreateAnimation("beta",T.d.ANIMATIONTYPE_FLOAT,60,v.EasingFunction));const t=T.d.TransitionTo("beta",b,this._attachedCamera,this._attachedCamera.va(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));t&&this._animatables.push(t)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=U.c.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}v.EasingFunction=new class extends W{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=t}easeInCore(t){return this.exponent<=0?t:(Math.exp(this.exponent*t)-1)/(Math.exp(this.exponent)-1)}},v.EasingMode=W.EASINGMODE_EASEINOUT,v.IgnoreBoundsSizeMode=0,v.FitFrustumSidesMode=1;var B=Y(11750),J=Y(12306),m=Y(12311),K=Y(1265);class L{constructor(){this._currentActiveButton=-1,this.buttons=[0,1,2]}attachControl(t){t=K.f.BackCompatCameraNoPreventDefault(arguments);const b=this.camera.getEngine(),Y=b.getInputElement();let o=0,x=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=F=>{var r,R;const d=F.event,U="touch"===d.pointerType;if(F.type!==E.b.POINTERMOVE&&-1===this.buttons.indexOf(d.button))return;const C=d.target;if(this._altKey=d.altKey,this._ctrlKey=d.ctrlKey,this._metaKey=d.metaKey,this._shiftKey=d.shiftKey,this._buttonsPressed=d.buttons,b.isPointerLock){const t=d.movementX,b=d.movementY;this.onTouch(null,t,b),this._pointA=null,this._pointB=null}else{if(F.type!==E.b.POINTERDOWN&&F.type!==E.b.POINTERDOUBLETAP&&U&&(null===(r=this._pointA)||void 0===r?void 0:r.pointerId)!==d.pointerId&&(null===(R=this._pointB)||void 0===R?void 0:R.pointerId)!==d.pointerId)return;if(F.type!==E.b.POINTERDOWN||-1!==this._currentActiveButton&&!U)if(F.type===E.b.POINTERDOUBLETAP)this.onDoubleTap(d.pointerType);else if(F.type!==E.b.POINTERUP||this._currentActiveButton!==d.button&&!U){if(F.type===E.b.POINTERMOVE)if(t||d.preventDefault(),this._pointA&&null===this._pointB){const t=d.clientX-this._pointA.x,b=d.clientY-this._pointA.y;this._pointA.x=d.clientX,this._pointA.y=d.clientY,this.onTouch(this._pointA,t,b)}else if(this._pointA&&this._pointB){const t=this._pointA.pointerId===d.pointerId?this._pointA:this._pointB;t.x=d.clientX,t.y=d.clientY;const b=this._pointA.x-this._pointB.x,Y=this._pointA.y-this._pointB.y,r=b*b+Y*Y,R={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:d.pointerId,type:F.type};this.onMultiTouch(this._pointA,this._pointB,o,r,x,R),x=R,o=r}}else{try{null===C||void 0===C||C.releasePointerCapture(d.pointerId)}catch(p){}U||(this._pointB=null),b._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==d.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==d.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==o||x)&&(this.onMultiTouch(this._pointA,this._pointB,o,0,x,null),o=0,x=null),this._currentActiveButton=-1,this.onButtonUp(d),t||d.preventDefault()}else{try{null===C||void 0===C||C.setPointerCapture(d.pointerId)}catch(p){}if(null===this._pointA)this._pointA={x:d.clientX,y:d.clientY,pointerId:d.pointerId,type:d.pointerType};else{if(null!==this._pointB)return;this._pointB={x:d.clientX,y:d.clientY,pointerId:d.pointerId,type:d.pointerType}}-1!==this._currentActiveButton||U||(this._currentActiveButton=d.button),this.onButtonDown(d),t||(d.preventDefault(),Y&&Y.focus())}}},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,E.b.POINTERDOWN|E.b.POINTERUP|E.b.POINTERMOVE|E.b.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,o=0,x=null,this.onLostFocus()},this._contextMenuBind=t=>this.onContextMenu(t),Y&&Y.addEventListener("contextmenu",this._contextMenuBind,!1);const F=this.camera.va().getEngine().getHostWindow();F&&K.f.RegisterTopRootEvents(F,[{name:"blur",handler:this._onLostFocus}])}Xe(){if(this._onLostFocus){const t=this.camera.va().getEngine().getHostWindow();t&&K.f.UnregisterTopRootEvents(t,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const t=this.camera.va().getEngine().getInputElement();t&&t.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentActiveButton=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(t){}onTouch(t,b,Y){}onMultiTouch(t,b,Y,o,x,F){}onContextMenu(t){t.preventDefault()}onButtonDown(t){}onButtonUp(t){}onLostFocus(){}}(0,o.e)([(0,x.P)()],L.prototype,"buttons",void 0);class z extends L{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(t,b){if(0!==this.panningSensibility&&t&&b){const Y=b.x-t.x,o=b.y-t.y;this.camera.inertialPanningX+=-Y/this.panningSensibility,this.camera.inertialPanningY+=o/this.panningSensibility}}_computePinchZoom(t,b){const Y=this.camera.i||z.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.i=Y*Math.sqrt(t)/Math.sqrt(b):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(b-t)*Y*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(b-t)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(t,b,Y){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-b/this.panningSensibility,this.camera.inertialPanningY+=Y/this.panningSensibility):(this.camera.inertialAlphaOffset-=b/this.angularSensibilityX,this.camera.inertialBetaOffset-=Y/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(t,b,Y,o,x,F){0===Y&&null===x||0===o&&null===F||(this.multiTouchPanAndZoom?(this._computePinchZoom(Y,o),this._computeMultiTouchPanning(x,F)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(o)-Math.sqrt(Y))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(Y,o),this._isPinching=!0):this._computeMultiTouchPanning(x,F)):this.multiTouchPanning?this._computeMultiTouchPanning(x,F):this.pinchZoom&&this._computePinchZoom(Y,o))}onButtonDown(t){this._isPanClick=t.button===this.camera._panningMouseButton}onButtonUp(t){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}z.MinimumRadiusForPinch=.001,(0,o.e)([(0,x.P)()],z.prototype,"buttons",void 0),(0,o.e)([(0,x.P)()],z.prototype,"angularSensibilityX",void 0),(0,o.e)([(0,x.P)()],z.prototype,"angularSensibilityY",void 0),(0,o.e)([(0,x.P)()],z.prototype,"pinchPrecision",void 0),(0,o.e)([(0,x.P)()],z.prototype,"pinchDeltaPercentage",void 0),(0,o.e)([(0,x.P)()],z.prototype,"useNaturalPinchZoom",void 0),(0,o.e)([(0,x.P)()],z.prototype,"pinchZoom",void 0),(0,o.e)([(0,x.P)()],z.prototype,"panningSensibility",void 0),(0,o.e)([(0,x.P)()],z.prototype,"multiTouchPanning",void 0),(0,o.e)([(0,x.P)()],z.prototype,"multiTouchPanAndZoom",void 0),m.e.ArcRotateCameraPointersInput=z;var S=Y(1347);class e{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(t){t=K.f.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((b=>{const Y=b.event;if(!Y.metaKey)if(b.type===S.b.KEYDOWN){if(this._ctrlPressed=Y.ctrlKey,this._altPressed=Y.altKey,-1!==this.keysUp.indexOf(Y.keyCode)||-1!==this.keysDown.indexOf(Y.keyCode)||-1!==this.keysLeft.indexOf(Y.keyCode)||-1!==this.keysRight.indexOf(Y.keyCode)||-1!==this.keysReset.indexOf(Y.keyCode)){-1===this._keys.indexOf(Y.keyCode)&&this._keys.push(Y.keyCode),Y.preventDefault&&(t||Y.preventDefault())}}else if(-1!==this.keysUp.indexOf(Y.keyCode)||-1!==this.keysDown.indexOf(Y.keyCode)||-1!==this.keysLeft.indexOf(Y.keyCode)||-1!==this.keysRight.indexOf(Y.keyCode)||-1!==this.keysReset.indexOf(Y.keyCode)){const b=this._keys.indexOf(Y.keyCode);b>=0&&this._keys.splice(b,1),Y.preventDefault&&(t||Y.preventDefault())}})))}Xe(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const t=this.camera;for(let b=0;b<this._keys.length;b++){const Y=this._keys[b];-1!==this.keysLeft.indexOf(Y)?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningX-=1/this.panningSensibility:t.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(Y)?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?t.inertialRadiusOffset+=1/this.zoomingSensibility:t.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(Y)?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningX+=1/this.panningSensibility:t.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(Y)?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?t.inertialRadiusOffset-=1/this.zoomingSensibility:t.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(Y)&&t.useInputToRestoreState&&t.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,o.e)([(0,x.P)()],e.prototype,"keysUp",void 0),(0,o.e)([(0,x.P)()],e.prototype,"keysDown",void 0),(0,o.e)([(0,x.P)()],e.prototype,"keysLeft",void 0),(0,o.e)([(0,x.P)()],e.prototype,"keysRight",void 0),(0,o.e)([(0,x.P)()],e.prototype,"keysReset",void 0),(0,o.e)([(0,x.P)()],e.prototype,"panningSensibility",void 0),(0,o.e)([(0,x.P)()],e.prototype,"zoomingSensibility",void 0),(0,o.e)([(0,x.P)()],e.prototype,"useAltToZoom",void 0),(0,o.e)([(0,x.P)()],e.prototype,"angularSpeed",void 0),m.e.ArcRotateCameraKeyboardMoveInput=e;var g=Y(1236),D=Y(1353),H=Y(1058);class f{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new r.l(0,0,0),this._globalOffset=new r.l(0,0,0),this._inertialPanning=r.l.Zero()}_computeDeltaFromMouseWheelLegacyEvent(t,b){let Y=0;const o=.01*t*this.wheelDeltaPercentage*b;return Y=t>0?o/(1+this.wheelDeltaPercentage):o*(1+this.wheelDeltaPercentage),Y}attachControl(t){t=K.f.BackCompatCameraNoPreventDefault(arguments),this._wheel=b=>{if(b.type!==E.b.POINTERWHEEL)return;const Y=b.event;let o=0;const x=Y.deltaMode===D.c.DOM_DELTA_LINE?40:1,F=-Y.deltaY*x;if(this.customComputeDeltaFromMouseWheel)o=this.customComputeDeltaFromMouseWheel(F,this,Y);else if(this.wheelDeltaPercentage){if(o=this._computeDeltaFromMouseWheelLegacyEvent(F,this.camera.i),o>0){let t=this.camera.i,b=this.camera.inertialRadiusOffset+o;for(let Y=0;Y<20&&Math.abs(b)>.001;Y++)t-=b,b*=this.camera.inertia;t=(0,H.e)(t,0,Number.MAX_VALUE),o=this._computeDeltaFromMouseWheelLegacyEvent(F,t)}}else o=F/(40*this.wheelPrecision);o&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(o)):this.camera.inertialRadiusOffset+=o),Y.preventDefault&&(t||Y.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,E.b.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.ee(0)}Xe(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const t=this.camera;0+t.inertialAlphaOffset+t.inertialBetaOffset+t.inertialRadiusOffset&&(this._updateHitPlane(),t.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(t.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const t=this.camera,b=t.target.fd(t.position);this._hitPlane=g.d.FromPositionAndNormal(t.target,b)}_getPosition(){const t=this.camera,b=t.va(),Y=b.createPickingRay(b.pointerX,b.pointerY,r.c.Identity(),t,!1);0===t.targetScreenOffset.x&&0===t.targetScreenOffset.y||(this._viewOffset.set(t.targetScreenOffset.x,t.targetScreenOffset.y,0),t.getViewMatrix().invertToRef(t._cameraTransformMatrix),this._globalOffset=r.l.TransformNormal(this._viewOffset,t._cameraTransformMatrix),Y.origin.addInPlace(this._globalOffset));let o=0;return this._hitPlane&&(o=Y.intersectsPlane(this._hitPlane)??0),Y.origin.addInPlace(Y.direction.scaleInPlace(o))}_zoomToMouse(t){const b=this.camera,Y=1-b.inertia;if(b.lowerRadiusLimit){const o=b.lowerRadiusLimit??0;b.i-(b.inertialRadiusOffset+t)/Y<o&&(t=(b.i-o)*Y-b.inertialRadiusOffset)}if(b.upperRadiusLimit){const o=b.upperRadiusLimit??0;b.i-(b.inertialRadiusOffset+t)/Y>o&&(t=(b.i-o)*Y-b.inertialRadiusOffset)}const o=t/Y/b.i,x=this._getPosition(),F=r.f.ae[6];x.subtractToRef(b.target,F),F.scaleInPlace(o),F.scaleInPlace(Y),this._inertialPanning.addInPlace(F),b.inertialRadiusOffset+=t}_zeroIfClose(t){Math.abs(t.x)<C.e&&(t.x=0),Math.abs(t.y)<C.e&&(t.y=0),Math.abs(t.z)<C.e&&(t.z=0)}}(0,o.e)([(0,x.P)()],f.prototype,"wheelPrecision",void 0),(0,o.e)([(0,x.P)()],f.prototype,"zoomToMouseLocation",void 0),(0,o.e)([(0,x.P)()],f.prototype,"wheelDeltaPercentage",void 0),m.e.ArcRotateCameraMouseWheelInput=f;class n extends m.g{constructor(t){super(t)}addMouseWheel(){return this.add(new f),this}addPointers(){return this.add(new z),this}addKeyboard(){return this.add(new e),this}}var X=Y(1041);R.c.AddNodeConstructor("ArcRotateCamera",((t,b)=>()=>new Q(t,0,0,1,r.l.Zero(),b)));class Q extends J.d{get target(){return this._target}set target(t){this.setTarget(t)}get targetHost(){return this._targetHost}set targetHost(t){t&&this.setTarget(t)}getTarget(){return this.target}get position(){return this._position}set position(t){this.setPosition(t)}set upVector(t){this._upToYMatrix||(this._yToUpMatrix=new r.c,this._upToYMatrix=new r.c,this._upVector=r.l.Zero()),t.normalize(),this._upVector.p(t),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){r.c.RotationAlignToRef(r.l.UpReadOnly,this._upVector,this._yToUpMatrix),r.c.RotationAlignToRef(this._upVector,r.l.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const t=this.inputs.attached.pointers;return t?t.angularSensibilityX:0}set angularSensibilityX(t){const b=this.inputs.attached.pointers;b&&(b.angularSensibilityX=t)}get angularSensibilityY(){const t=this.inputs.attached.pointers;return t?t.angularSensibilityY:0}set angularSensibilityY(t){const b=this.inputs.attached.pointers;b&&(b.angularSensibilityY=t)}get pinchPrecision(){const t=this.inputs.attached.pointers;return t?t.pinchPrecision:0}set pinchPrecision(t){const b=this.inputs.attached.pointers;b&&(b.pinchPrecision=t)}get pinchDeltaPercentage(){const t=this.inputs.attached.pointers;return t?t.pinchDeltaPercentage:0}set pinchDeltaPercentage(t){const b=this.inputs.attached.pointers;b&&(b.pinchDeltaPercentage=t)}get useNaturalPinchZoom(){const t=this.inputs.attached.pointers;return!!t&&t.useNaturalPinchZoom}set useNaturalPinchZoom(t){const b=this.inputs.attached.pointers;b&&(b.useNaturalPinchZoom=t)}get panningSensibility(){const t=this.inputs.attached.pointers;return t?t.panningSensibility:0}set panningSensibility(t){const b=this.inputs.attached.pointers;b&&(b.panningSensibility=t)}get keysUp(){const t=this.inputs.attached.keyboard;return t?t.keysUp:[]}set keysUp(t){const b=this.inputs.attached.keyboard;b&&(b.keysUp=t)}get keysDown(){const t=this.inputs.attached.keyboard;return t?t.keysDown:[]}set keysDown(t){const b=this.inputs.attached.keyboard;b&&(b.keysDown=t)}get keysLeft(){const t=this.inputs.attached.keyboard;return t?t.keysLeft:[]}set keysLeft(t){const b=this.inputs.attached.keyboard;b&&(b.keysLeft=t)}get keysRight(){const t=this.inputs.attached.keyboard;return t?t.keysRight:[]}set keysRight(t){const b=this.inputs.attached.keyboard;b&&(b.keysRight=t)}get wheelPrecision(){const t=this.inputs.attached.mousewheel;return t?t.wheelPrecision:0}set wheelPrecision(t){const b=this.inputs.attached.mousewheel;b&&(b.wheelPrecision=t)}get zoomToMouseLocation(){const t=this.inputs.attached.mousewheel;return!!t&&t.zoomToMouseLocation}set zoomToMouseLocation(t){const b=this.inputs.attached.mousewheel;b&&(b.zoomToMouseLocation=t)}get wheelDeltaPercentage(){const t=this.inputs.attached.mousewheel;return t?t.wheelDeltaPercentage:0}set wheelDeltaPercentage(t){const b=this.inputs.attached.mousewheel;b&&(b.wheelDeltaPercentage=t)}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(t){t!==this.useBouncingBehavior&&(t?(this._bouncingBehavior=new y,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(t){t!==this.useFramingBehavior&&(t?(this._framingBehavior=new v,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(t){t!==this.useAutoRotationBehavior&&(t?(this._autoRotationBehavior=new p,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(t,b,Y,o,x,R){var d;let E=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(t,r.l.Zero(),R,E),d=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=r.l.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=r.i.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._viewMatrix=new r.c,this.panningAxis=new r.l(1,1,0),this._transformedDirection=new r.l,this.mapPanning=!1,this._progressiveRestore=!1,this.onMeshTargetChangedObservable=new F.e,this.checkCollisions=!1,this.collisionRadius=new r.l(.5,.5,.5),this._previousPosition=r.l.Zero(),this._collisionVelocity=r.l.Zero(),this._newPosition=r.l.Zero(),this._computationVector=r.l.Zero(),this._onCollisionPositionChange=function(t,b){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Y?(d.setPosition(b),d.Dk&&d.Dk(Y)):d._previousPosition.p(d._position);const o=Math.cos(d.alpha),x=Math.sin(d.alpha),F=Math.cos(d.beta);let r=Math.sin(d.beta);0===r&&(r=1e-4);const R=d._getTargetPosition();d._computationVector.be(d.i*o*r,d.i*F,d.i*x*r),R.addToRef(d._computationVector,d._newPosition),d._position.p(d._newPosition);let E=d.upVector;d.allowUpsideDown&&d.beta<0&&(E=E.clone(),E=E.negate()),d._computeViewMatrix(d._position,R,E),d._viewMatrix.addAtIndex(12,d.targetScreenOffset.x),d._viewMatrix.addAtIndex(13,d.targetScreenOffset.y),d._collisionTriggered=!1},this._target=r.l.Zero(),x&&this.setTarget(x),this.alpha=b,this.beta=Y,this.i=o,this.getViewMatrix(),this.inputs=new n(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new r.l(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.i=void 0,this._cache.targetScreenOffset=r.i.Zero()}_updateCache(t){t||super._updateCache(),this._cache._target.p(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.i=this.i,this._cache.targetScreenOffset.p(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const t=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?t.addToRef(this._targetBoundingCenter,this._target):this._target.p(t)}const t=this._getLockedTargetPosition();return t||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.i,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>C.e&&this.restoreStateInterpolationFactor<1?(this._progressiveRestore=!0,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.i=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.i===this.i&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(t,b){let Y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const x=arguments;b=K.f.BackCompatCameraNoPreventDefault(x),this._useCtrlForPanning=Y,this._panningMouseButton=o,"boolean"===typeof x[0]&&(x.length>1&&(this._useCtrlForPanning=x[1]),x.length>2&&(this._panningMouseButton=x[2])),this.inputs.attachElement(b),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}Xe(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),this._progressiveRestore){const t=this._scene.getEngine().getDeltaTime()/1e3,b=1-Math.pow(2,-t/this.restoreStateInterpolationFactor);this.setTarget(r.l.Lerp(this.getTarget(),this._storedTarget,b)),r.e.RotationAlphaBetaGammaToRef(this._storedAlpha,this._storedBeta,0,r.f.Quaternion[0]),r.e.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,r.f.Quaternion[1]),r.e.SlerpToRef(r.f.Quaternion[1],r.f.Quaternion[0],b,r.f.Quaternion[2]),r.f.Quaternion[2].normalize(),r.f.Quaternion[2].toAlphaBetaGammaToRef(r.f.ae[0]),this.alpha=r.f.ae[0].x,this.beta=r.f.ae[0].y,this.i+=(this._storedRadius-this.i)*b,r.i.LerpToRef(this.targetScreenOffset,this._storedTargetScreenOffset,b,this.targetScreenOffset),(r.l.DistanceSquared(this.getTarget(),this._storedTarget)<C.e&&r.f.Quaternion[2].equalsWithEpsilon(r.f.Quaternion[0])&&Math.pow(this._storedRadius-this.i,2)<C.e&&r.i.Distance(this.targetScreenOffset,this._storedTargetScreenOffset)<C.e||0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset||0!==this.inertialPanningX||0!==this.inertialPanningY)&&(this._progressiveRestore=!1)}if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){const t=this.invertRotation?-1:1,b=this._calculateHandednessMultiplier();let Y=this.inertialAlphaOffset*b;this.beta<0&&(Y*=-1),this.alpha+=Y*t,this.beta+=this.inertialBetaOffset*t,this.i-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<C.e&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<C.e&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*C.e&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){const t=new r.l(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),t.multiplyInPlace(this.panningAxis),r.l.TransformNormalToRef(t,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const t=this.upVector,b=r.l.CrossToRef(this._transformedDirection,t,this._transformedDirection);r.l.CrossToRef(t,b,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);r.l.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.p(this._transformedDirection)}else{if(this.parent){const t=r.f.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(t),t.transposeToRef(t),r.l.TransformCoordinatesToRef(this._transformedDirection,t,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*C.e&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*C.e&&(this.inertialPanningY=0)}this._checkLimits(),super._checkInputs()}}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.i<this.lowerRadiusLimit&&(this.i=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.i>this.upperRadiusLimit&&(this.i=this.upperRadiusLimit,this.inertialRadiusOffset=0)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||r.l.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.i=this._computationVector.length(),0===this.i&&(this.i=1e-4);const t=this.alpha;0===this._computationVector.x&&0===this._computationVector.z?this.alpha=Math.PI/2:this.alpha=Math.acos(this._computationVector.x/Math.sqrt(Math.pow(this._computationVector.x,2)+Math.pow(this._computationVector.z,2))),this._computationVector.z<0&&(this.alpha=2*Math.PI-this.alpha);const b=Math.round((t-this.alpha)/(2*Math.PI));this.alpha+=2*b*Math.PI,this.beta=Math.acos(this._computationVector.y/this.i),this._checkLimits()}setPosition(t){this._position.equals(t)||(this._position.p(t),this.rebuildAnglesAndRadius())}setTarget(t){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(o=this.overrideCloneAlphaBetaRadius??o,t.ve)b&&t.getBoundingInfo?this._targetBoundingCenter=t.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,t.ve(),this._targetHost=t,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const b=t,o=this._getTargetPosition();if(o&&!Y&&o.equals(b))return;this._targetHost=null,this._target=b,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}o||this.rebuildAnglesAndRadius()}_getViewMatrix(){const t=Math.cos(this.alpha),b=Math.sin(this.alpha),Y=Math.cos(this.beta);let o=Math.sin(this.beta);0===o&&(o=1e-4),0===this.i&&(this.i=1e-4);const x=this._getTargetPosition();if(this._computationVector.be(this.i*t*o,this.i*Y,this.i*b*o),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||r.l.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),x.addToRef(this._computationVector,this._newPosition),this.va().collisionsEnabled&&this.checkCollisions){const t=this.va().collisionCoordinator;this._collider||(this._collider=t.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,t.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.p(this._newPosition);let t=this.upVector;this.allowUpsideDown&&o<0&&(t=t.negate()),this._computeViewMatrix(this._position,x,t),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget=x,this._viewMatrix}zoomOn(t){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t=t||this.va().meshes;const Y=d.d.MinMax(t);let o=this._calculateLowerRadiusFromModelBoundingSphere(Y.min,Y.max);o=Math.max(Math.min(o,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.i=o*this.zoomOnFactor,this.focusOn({min:Y.min,max:Y.max,distance:o},b)}focusOn(t){let b,Y,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===t.min){const o=t||this.va().meshes;b=d.d.MinMax(o),Y=r.l.Distance(b.min,b.max)}else{b=t,Y=t.distance}this._target=d.d.Center(b),o||(this.maxZ=2*Y)}createRigCamera(t,b){let Y=0;switch(this.cameraRigMode){case B.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case B.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case B.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case B.b.RIG_MODE_STEREOSCOPIC_INTERLACED:case B.b.RIG_MODE_VR:Y=this._cameraRigParams.stereoHalfAngle*(0===b?1:-1);break;case B.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:Y=this._cameraRigParams.stereoHalfAngle*(0===b?-1:1)}const o=new Q(t,this.alpha+Y,this.beta,this.i,this._target,this.va());return o._cameraRigParams={},o.isRigCamera=!0,o.rigParent=this,o.upVector=this.upVector,o.mode=this.mode,o.orthoLeft=this.orthoLeft,o.orthoRight=this.orthoRight,o.orthoBottom=this.orthoBottom,o.orthoTop=this.orthoTop,o}_updateRigCameras(){const t=this._rigCameras[0],b=this._rigCameras[1];switch(t.beta=b.beta=this.beta,this.cameraRigMode){case B.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case B.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case B.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case B.b.RIG_MODE_STEREOSCOPIC_INTERLACED:case B.b.RIG_MODE_VR:t.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,b.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case B.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:t.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,b.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(t,b){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const o=r.l.Distance(t,b),x=this.va().getEngine().getAspectRatio(this),F=Math.tan(this.fov/2),R=F*x,d=.5*o*Y,E=d*Math.sqrt(1+1/(R*R)),U=d*Math.sqrt(1+1/(F*F));return Math.max(E,U)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,o.e)([(0,x.P)()],Q.prototype,"alpha",void 0),(0,o.e)([(0,x.P)()],Q.prototype,"beta",void 0),(0,o.e)([(0,x.P)()],Q.prototype,"i",void 0),(0,o.e)([(0,x.P)()],Q.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,o.e)([(0,x.L)("target")],Q.prototype,"_target",void 0),(0,o.e)([(0,x.B)("targetHost")],Q.prototype,"_targetHost",void 0),(0,o.e)([(0,x.P)()],Q.prototype,"inertialAlphaOffset",void 0),(0,o.e)([(0,x.P)()],Q.prototype,"inertialBetaOffset",void 0),(0,o.e)([(0,x.P)()],Q.prototype,"inertialRadiusOffset",void 0),(0,o.e)([(0,x.P)()],Q.prototype,"lowerAlphaLimit",void 0),(0,o.e)([(0,x.P)()],Q.prototype,"upperAlphaLimit",void 0),(0,o.e)([(0,x.P)()],Q.prototype,"lowerBetaLimit",void 0),(0,o.e)([(0,x.P)()],Q.prototype,"upperBetaLimit",void 0),(0,o.e)([(0,x.P)()],Q.prototype,"lowerRadiusLimit",void 0),(0,o.e)([(0,x.P)()],Q.prototype,"upperRadiusLimit",void 0),(0,o.e)([(0,x.P)()],Q.prototype,"inertialPanningX",void 0),(0,o.e)([(0,x.P)()],Q.prototype,"inertialPanningY",void 0),(0,o.e)([(0,x.P)()],Q.prototype,"pinchToPanMaxDistance",void 0),(0,o.e)([(0,x.P)()],Q.prototype,"panningDistanceLimit",void 0),(0,o.e)([(0,x.L)()],Q.prototype,"panningOriginTarget",void 0),(0,o.e)([(0,x.P)()],Q.prototype,"panningInertia",void 0),(0,o.e)([(0,x.P)()],Q.prototype,"zoomToMouseLocation",null),(0,o.e)([(0,x.P)()],Q.prototype,"zoomOnFactor",void 0),(0,o.e)([(0,x.K)()],Q.prototype,"targetScreenOffset",void 0),(0,o.e)([(0,x.P)()],Q.prototype,"allowUpsideDown",void 0),(0,o.e)([(0,x.P)()],Q.prototype,"useInputToRestoreState",void 0),(0,o.e)([(0,x.P)()],Q.prototype,"restoreStateInterpolationFactor",void 0),(0,X.d)("BABYLON.ArcRotateCamera",Q)},11750:(t,b,Y)=>{"use strict";Y.d(b,{b:()=>v});var o=Y(999),x=Y(1001),F=Y(1252),r=Y(1265),R=Y(1013),d=Y(1019),E=Y(11759),U=Y(1144),C=Y(1041),p=Y(1129),W=Y(1569),T=Y(1370),y=Y(1224);class v extends E.c{get position(){return this._position}set position(t){this._position=t}set upVector(t){this._upVector=t}get upVector(){return this._upVector}get screenArea(){let t=0,b=0;if(this.mode===v.PERSPECTIVE_CAMERA)this.fovMode===v.FOVMODE_VERTICAL_FIXED?(b=2*this._i*Math.tan(this.fov/2),t=this.getEngine().getAspectRatio(this)*b):(t=2*this._i*Math.tan(this.fov/2),b=t/this.getEngine().getAspectRatio(this));else{const Y=this.getEngine().getRenderWidth()/2,o=this.getEngine().getRenderHeight()/2;t=(this.orthoRight??Y)-(this.orthoLeft??-Y),b=(this.orthoTop??o)-(this.orthoBottom??-o)}return t*b}set orthoLeft(t){this._orthoLeft=t;for(const b of this._rigCameras)b.orthoLeft=t}get orthoLeft(){return this._orthoLeft}set orthoRight(t){this._orthoRight=t;for(const b of this._rigCameras)b.orthoRight=t}get orthoRight(){return this._orthoRight}set orthoBottom(t){this._orthoBottom=t;for(const b of this._rigCameras)b.orthoBottom=t}get orthoBottom(){return this._orthoBottom}set orthoTop(t){this._orthoTop=t;for(const b of this._rigCameras)b.orthoTop=t}get orthoTop(){return this._orthoTop}set mode(t){this._mode=t;for(const b of this._rigCameras)b.mode=t}get mode(){return this._mode}get hasMoved(){return this._hasMoved}constructor(t,b,Y){let o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];super(t,Y,!1),this._position=d.l.Zero(),this._upVector=d.l.Up(),this.oblique=null,this._orthoLeft=null,this._orthoRight=null,this._orthoBottom=null,this._orthoTop=null,this.fov=.8,this.projectionPlaneTilt=0,this._i=1,this.maxZ=1e4,this.inertia=.9,this._mode=v.PERSPECTIVE_CAMERA,this.isIntermediate=!1,this.viewport=new W.e(0,0,1,1),this.layerMask=268435455,this.fovMode=v.FOVMODE_VERTICAL_FIXED,this.cameraRigMode=v.RIG_MODE_NONE,this.customRenderTargets=[],this.outputRenderTarget=null,this.onViewMatrixChangedObservable=new R.e,this.onProjectionMatrixChangedObservable=new R.e,this.onAfterCheckInputsObservable=new R.e,this.onRestoreStateObservable=new R.e,this.isRigCamera=!1,this._hasMoved=!1,this._rigCameras=new Array,this._skipRendering=!1,this._projectionMatrix=new d.c,this._postProcesses=new Array,this._activeMeshes=new F.d(256),this._globalPosition=d.l.Zero(),this._computedViewMatrix=d.c.Identity(),this._doNotComputeProjectionMatrix=!1,this._transformMatrix=d.c.Zero(),this._refreshFrustumPlanes=!0,this._absoluteRotation=d.e.Identity(),this._isCamera=!0,this._isLeftCamera=!1,this._isRightCamera=!1,this.va().addCamera(this),o&&!this.va().activeCamera&&(this.va().activeCamera=this),this.position=b,this.renderPassId=this.va().getEngine().createRenderPassId(`Camera ${t}`)}storeState(){return this._stateStored=!0,this._storedFov=this.fov,this}hasStateStored(){return!!this._stateStored}_restoreStateValues(){return!!this._stateStored&&(this.fov=this._storedFov,!0)}restoreState(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)}getClassName(){return"Mh"}toString(t){let b="Name: "+this.name;if(b+=", type: "+this.getClassName(),this.animations)for(let Y=0;Y<this.animations.length;Y++)b+=", animation[0]: "+this.animations[Y].toString(t);return b}applyVerticalCorrection(){const t=this.absoluteRotation.toEulerAngles();this.projectionPlaneTilt=this._scene.useRightHandedSystem?-t.x:t.x}get globalPosition(){return this._globalPosition}getActiveMeshes(){return this._activeMeshes}isActiveMesh(t){return-1!==this._activeMeshes.indexOf(t)}isReady(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(t)for(const b of this._postProcesses)if(b&&!b.isReady())return!1;return super.isReady(t)}_initCache(){super._initCache(),this._cache.position=new d.l(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new d.l(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache._i=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.obliqueAngle=void 0,this._cache.obliqueLength=void 0,this._cache.obliqueOffset=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0}_updateCache(t){t||super._updateCache(),this._cache.position.p(this.position),this._cache.upVector.p(this.upVector)}_isSynchronized(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()}_isSynchronizedViewMatrix(){return!!super._isSynchronized()&&(this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent())}_isSynchronizedProjectionMatrix(){let t=this._cache.mode===this.mode&&this._cache._i===this._i&&this._cache.maxZ===this.maxZ;if(!t)return!1;const b=this.getEngine();return this.mode===v.PERSPECTIVE_CAMERA?t=this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===b.getAspectRatio(this)&&this._cache.projectionPlaneTilt===this.projectionPlaneTilt:(t=this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===b.getRenderWidth()&&this._cache.renderHeight===b.getRenderHeight(),this.oblique&&(t=t&&this._cache.obliqueAngle===this.oblique.angle&&this._cache.obliqueLength===this.oblique.length&&this._cache.obliqueOffset===this.oblique.offset)),t}attachControl(t,b){}Xe(t){}update(){this._hasMoved=!1,this._checkInputs(),this.cameraRigMode!==v.RIG_MODE_NONE&&this._updateRigCameras(),this.getViewMatrix(),this.getProjectionMatrix()}_checkInputs(){this.onAfterCheckInputsObservable.notifyObservers(this)}get rigCameras(){return this._rigCameras}get rigPostProcess(){return this._rigPostProcess}_getFirstPostProcess(){for(let t=0;t<this._postProcesses.length;t++)if(null!==this._postProcesses[t])return this._postProcesses[t];return null}_cascadePostProcessesToRigCams(){const t=this._getFirstPostProcess();t&&t.markTextureDirty();for(let b=0,Y=this._rigCameras.length;b<Y;b++){const t=this._rigCameras[b],Y=t._rigPostProcess;if(Y){"pass"===Y.getEffectName()&&(t.isIntermediate=0===this._postProcesses.length),t._postProcesses=this._postProcesses.slice(0).concat(Y),Y.markTextureDirty()}else t._postProcesses=this._postProcesses.slice(0)}}attachPostProcess(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return!t.isReusable()&&this._postProcesses.indexOf(t)>-1?(U.b.Error("You're trying to reuse a post process not defined as reusable."),0):(null==b||b<0?this._postProcesses.push(t):null===this._postProcesses[b]?this._postProcesses[b]=t:this._postProcesses.splice(b,0,t),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.Ae(),this._postProcesses.indexOf(t))}detachPostProcess(t){const b=this._postProcesses.indexOf(t);-1!==b&&(this._postProcesses[b]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.Ae(),this._cascadePostProcessesToRigCams()}getWorldMatrix(){return this._isSynchronizedViewMatrix()||this.getViewMatrix(),this._worldMatrix}_getViewMatrix(){return d.c.Identity()}getViewMatrix(t){return!t&&this._isSynchronizedViewMatrix()||(this._hasMoved=!0,this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.va().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix)),this._computedViewMatrix}freezeProjectionMatrix(t){this._doNotComputeProjectionMatrix=!0,void 0!==t&&(this._projectionMatrix=t)}unfreezeProjectionMatrix(){this._doNotComputeProjectionMatrix=!1}getProjectionMatrix(t){if(this._doNotComputeProjectionMatrix||!t&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache._i=this._i,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;const b=this.getEngine(),Y=this.va(),o=b.useReverseDepthBuffer;if(this.mode===v.PERSPECTIVE_CAMERA){let t;this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=b.getAspectRatio(this),this._cache.projectionPlaneTilt=this.projectionPlaneTilt,this._i<=0&&(this._i=.1),t=Y.useRightHandedSystem?d.c.PerspectiveFovRHToRef:d.c.PerspectiveFovLHToRef,t(this.fov,b.getAspectRatio(this),o?this.maxZ:this._i,o?this._i:this.maxZ,this._projectionMatrix,this.fovMode===v.FOVMODE_VERTICAL_FIXED,b.isNDCHalfZRange,this.projectionPlaneTilt,o)}else{var x,F,r;const t=b.getRenderWidth()/2,R=b.getRenderHeight()/2;Y.useRightHandedSystem?this.oblique?d.c.ObliqueOffCenterRHToRef(this.orthoLeft??-t,this.orthoRight??t,this.orthoBottom??-R,this.orthoTop??R,o?this.maxZ:this._i,o?this._i:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,b.isNDCHalfZRange):d.c.OrthoOffCenterRHToRef(this.orthoLeft??-t,this.orthoRight??t,this.orthoBottom??-R,this.orthoTop??R,o?this.maxZ:this._i,o?this._i:this.maxZ,this._projectionMatrix,b.isNDCHalfZRange):this.oblique?d.c.ObliqueOffCenterLHToRef(this.orthoLeft??-t,this.orthoRight??t,this.orthoBottom??-R,this.orthoTop??R,o?this.maxZ:this._i,o?this._i:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,b.isNDCHalfZRange):d.c.OrthoOffCenterLHToRef(this.orthoLeft??-t,this.orthoRight??t,this.orthoBottom??-R,this.orthoTop??R,o?this.maxZ:this._i,o?this._i:this.maxZ,this._projectionMatrix,b.isNDCHalfZRange),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.obliqueAngle=null===(x=this.oblique)||void 0===x?void 0:x.angle,this._cache.obliqueLength=null===(F=this.oblique)||void 0===F?void 0:F.length,this._cache.obliqueOffset=null===(r=this.oblique)||void 0===r?void 0:r.offset,this._cache.renderWidth=b.getRenderWidth(),this._cache.renderHeight=b.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix}getTransformationMatrix(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix}_computeObliqueDistance(t){return(this.i||(this.target?d.l.Distance(this.position,this.target):this.position.length()))+t}_updateFrustumPlanes(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?T.d.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=T.d.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)}isInFrustum(t){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._updateFrustumPlanes(),b&&this.rigCameras.length>0){let b=!1;return this.rigCameras.forEach((Y=>{Y._updateFrustumPlanes(),b=b||t.isInFrustum(Y._frustumPlanes)})),b}return t.isInFrustum(this._frustumPlanes)}isCompletelyInFrustum(t){return this._updateFrustumPlanes(),t.isCompletelyInFrustum(this._frustumPlanes)}getForwardRay(){throw(0,p.c)("Ray")}getForwardRayToRef(t){throw(0,p.c)("Ray")}dispose(t){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.va().stopAnimation(this),this.va().removeCamera(this);this._rigCameras.length>0;){const t=this._rigCameras.pop();t&&t.dispose()}if(this._parentContainer){const t=this._parentContainer.cameras.indexOf(this);t>-1&&this._parentContainer.cameras.splice(t,1),this._parentContainer=null}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses.length=0;else if(this.cameraRigMode!==v.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses.length=0;else{let t=this._postProcesses.length;for(;--t>=0;){const b=this._postProcesses[t];b&&b.dispose(this)}}let Y=this.customRenderTargets.length;for(;--Y>=0;)this.customRenderTargets[Y].dispose();this.customRenderTargets.length=0,this._activeMeshes.dispose(),this.va().getEngine().releaseRenderPassId(this.renderPassId),super.dispose(t,b)}get isLeftCamera(){return this._isLeftCamera}get isRightCamera(){return this._isRightCamera}get leftCamera(){return this._rigCameras.length<1?null:this._rigCameras[0]}get rightCamera(){return this._rigCameras.length<2?null:this._rigCameras[1]}getLeftTarget(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()}getRightTarget(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()}setCameraRigMode(t,b){if(this.cameraRigMode!==t){for(;this._rigCameras.length>0;){const t=this._rigCameras.pop();t&&t.dispose()}if(this.cameraRigMode=t,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=b.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=r.f.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==v.RIG_MODE_NONE){const t=this.createRigCamera(this.name+"_L",0);t&&(t._isLeftCamera=!0);const b=this.createRigCamera(this.name+"_R",1);b&&(b._isRightCamera=!0),t&&b&&(this._rigCameras.push(t),this._rigCameras.push(b))}this._setRigMode(b),this._cascadePostProcessesToRigCams(),this.update()}}_setRigMode(t){}_getVRProjectionMatrix(){return d.c.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this._i,this.maxZ,this._cameraRigParams.vrWorkMatrix,!0,this.getEngine().isNDCHalfZRange),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix}setCameraRigParameter(t,b){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[t]=b,"interaxialDistance"===t&&(this._cameraRigParams.stereoHalfAngle=r.f.ToRadians(b/.0637))}createRigCamera(t,b){return null}_updateRigCameras(){for(let t=0;t<this._rigCameras.length;t++)this._rigCameras[t]._i=this._i,this._rigCameras[t].maxZ=this.maxZ,this._rigCameras[t].fov=this.fov,this._rigCameras[t].upVector.p(this.upVector);this.cameraRigMode===v.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)}_setupInputs(){}serialize(){const t=y.d.Serialize(this);return t.uniqueId=this.uniqueId,t.type=this.getClassName(),this.parent&&this.parent._serializeAsParent(t),this.inputs&&this.inputs.serialize(t),y.d.AppendSerializedAnimations(this,t),t.ranges=this.serializeAnimationRanges(),t.isEnabled=this.isEnabled(),t}clone(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Y=y.d.Clone(v.GetConstructorFromName(this.getClassName(),t,this.va(),this.interaxialDistance,this.isStereoscopicSideBySide),this);return Y.name=t,Y.parent=b,this.onClonedObservable.notifyObservers(Y),Y}pf(t){const b=d.l.Zero();return this.getDirectionToRef(t,b),b}get absoluteRotation(){return this.getWorldMatrix().decompose(void 0,this._absoluteRotation),this._absoluteRotation}getDirectionToRef(t,b){d.l.TransformNormalToRef(t,this.getWorldMatrix(),b)}static GetConstructorFromName(t,b,Y){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,x=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const F=E.c.Construct(t,b,Y,{interaxial_distance:o,isStereoscopicSideBySide:x});return F||(()=>v._CreateDefaultParsedCamera(b,Y))}ve(){return this.getWorldMatrix()}static Parse(t,b){const Y=t.type,o=v.GetConstructorFromName(Y,t.name,b,t.interaxial_distance,t.isStereoscopicSideBySide),x=y.d.Parse(o,t,b);if(void 0!==t.parentId&&(x._waitingParentId=t.parentId),void 0!==t.parentInstanceIndex&&(x._waitingParentInstanceIndex=t.parentInstanceIndex),x.inputs&&(x.inputs.parse(t),x._setupInputs()),t.upVector&&(x.upVector=d.l.ce(t.upVector)),x.setPosition&&(x.position.be(0,0,0),x.setPosition(d.l.ce(t.position))),t.target&&x.setTarget&&x.setTarget(d.l.ce(t.target)),t.cameraRigMode){const b=t.interaxial_distance?{interaxialDistance:t.interaxial_distance}:{};x.setCameraRigMode(t.cameraRigMode,b)}if(t.animations){for(let b=0;b<t.animations.length;b++){const Y=t.animations[b],o=(0,C.b)("BABYLON.Animation");o&&x.animations.push(o.Parse(Y))}E.c.ParseAnimationRanges(x,t,b)}return t.autoAnimate&&b.beginAnimation(x,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,t.autoAnimateSpeed||1),void 0!==t.isEnabled&&x.zg(t.isEnabled),x}_calculateHandednessMultiplier(){let t=this.va().useRightHandedSystem?-1:1;return this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(t*=-1),t}}v._CreateDefaultParsedCamera=(t,b)=>{throw(0,p.c)("UniversalCamera")},v.PERSPECTIVE_CAMERA=0,v.ORTHOGRAPHIC_CAMERA=1,v.FOVMODE_VERTICAL_FIXED=0,v.FOVMODE_HORIZONTAL_FIXED=1,v.RIG_MODE_NONE=0,v.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,v.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,v.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,v.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,v.RIG_MODE_STEREOSCOPIC_INTERLACED=14,v.RIG_MODE_VR=20,v.RIG_MODE_CUSTOM=22,v.ForceAttachControlToAlwaysPreventDefault=!1,(0,o.e)([(0,x.L)("position")],v.prototype,"_position",void 0),(0,o.e)([(0,x.L)("upVector")],v.prototype,"_upVector",void 0),(0,o.e)([(0,x.P)()],v.prototype,"orthoLeft",null),(0,o.e)([(0,x.P)()],v.prototype,"orthoRight",null),(0,o.e)([(0,x.P)()],v.prototype,"orthoBottom",null),(0,o.e)([(0,x.P)()],v.prototype,"orthoTop",null),(0,o.e)([(0,x.P)()],v.prototype,"fov",void 0),(0,o.e)([(0,x.P)()],v.prototype,"projectionPlaneTilt",void 0),(0,o.e)([(0,x.P)()],v.prototype,"_i",void 0),(0,o.e)([(0,x.P)()],v.prototype,"maxZ",void 0),(0,o.e)([(0,x.P)()],v.prototype,"inertia",void 0),(0,o.e)([(0,x.P)()],v.prototype,"mode",null),(0,o.e)([(0,x.P)()],v.prototype,"layerMask",void 0),(0,o.e)([(0,x.P)()],v.prototype,"fovMode",void 0),(0,o.e)([(0,x.P)()],v.prototype,"cameraRigMode",void 0),(0,o.e)([(0,x.P)()],v.prototype,"interaxialDistance",void 0),(0,o.e)([(0,x.P)()],v.prototype,"isStereoscopicSideBySide",void 0)},12311:(t,b,Y)=>{"use strict";Y.d(b,{e:()=>r,g:()=>R});var o=Y(1144),x=Y(1224),F=Y(11750),r={};class R{constructor(t){this.attachedToElement=!1,this.attached={},this.camera=t,this.checkInputs=()=>{}}add(t){const b=t.getSimpleName();this.attached[b]?o.b.Warn("camera input of type "+b+" already exists on camera"):(this.attached[b]=t,t.camera=this.camera,t.checkInputs&&(this.checkInputs=this._addCheckInputs(t.checkInputs.bind(t))),this.attachedToElement&&t.attachControl(this.noPreventDefault))}remove(t){for(const b in this.attached){const Y=this.attached[b];if(Y===t)return Y.Xe(),Y.camera=null,delete this.attached[b],void this.rebuildInputCheck()}}removeByType(t){for(const b in this.attached){const Y=this.attached[b];Y.getClassName()===t&&(Y.Xe(),Y.camera=null,delete this.attached[b],this.rebuildInputCheck())}}_addCheckInputs(t){const b=this.checkInputs;return()=>{b(),t()}}attachInput(t){this.attachedToElement&&t.attachControl(this.noPreventDefault)}attachElement(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){t=!F.b.ForceAttachControlToAlwaysPreventDefault&&t,this.attachedToElement=!0,this.noPreventDefault=t;for(const b in this.attached)this.attached[b].attachControl(t)}}detachElement(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const b in this.attached)this.attached[b].Xe(),t&&(this.attached[b].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const t in this.attached){const b=this.attached[t];b.checkInputs&&(this.checkInputs=this._addCheckInputs(b.checkInputs.bind(b)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(t){const b={};for(const Y in this.attached){const t=this.attached[Y],o=x.d.Serialize(t);b[t.getClassName()]=o}t.inputsmgr=b}parse(t){const b=t.inputsmgr;if(b){this.clear();for(const t in b){const Y=r[t];if(Y){const o=b[t],F=x.d.Parse((()=>new Y),o,null);this.add(F)}}}else for(const Y in this.attached){const b=r[this.attached[Y].getClassName()];if(b){const o=x.d.Parse((()=>new b),t,null);this.remove(this.attached[Y]),this.add(o)}}}}},12298:(t,b,Y)=>{"use strict";Y.d(b,{c:()=>z});var o=Y(999),x=Y(1001),F=Y(1019),r=Y(12306),R=Y(12311),d=Y(1347),E=Y(1265);class U{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(t){t=E.f.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((b=>{const Y=b.event;if(!Y.metaKey)if(b.type===d.b.KEYDOWN){if(-1!==this.keysUp.indexOf(Y.keyCode)||-1!==this.keysDown.indexOf(Y.keyCode)||-1!==this.keysLeft.indexOf(Y.keyCode)||-1!==this.keysRight.indexOf(Y.keyCode)||-1!==this.keysUpward.indexOf(Y.keyCode)||-1!==this.keysDownward.indexOf(Y.keyCode)||-1!==this.keysRotateLeft.indexOf(Y.keyCode)||-1!==this.keysRotateRight.indexOf(Y.keyCode)||-1!==this.keysRotateUp.indexOf(Y.keyCode)||-1!==this.keysRotateDown.indexOf(Y.keyCode)){-1===this._keys.indexOf(Y.keyCode)&&this._keys.push(Y.keyCode),t||Y.preventDefault()}}else if(-1!==this.keysUp.indexOf(Y.keyCode)||-1!==this.keysDown.indexOf(Y.keyCode)||-1!==this.keysLeft.indexOf(Y.keyCode)||-1!==this.keysRight.indexOf(Y.keyCode)||-1!==this.keysUpward.indexOf(Y.keyCode)||-1!==this.keysDownward.indexOf(Y.keyCode)||-1!==this.keysRotateLeft.indexOf(Y.keyCode)||-1!==this.keysRotateRight.indexOf(Y.keyCode)||-1!==this.keysRotateUp.indexOf(Y.keyCode)||-1!==this.keysRotateDown.indexOf(Y.keyCode)){const b=this._keys.indexOf(Y.keyCode);b>=0&&this._keys.splice(b,1),t||Y.preventDefault()}})))}Xe(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const t=this.camera;for(let b=0;b<this._keys.length;b++){const Y=this._keys[b],o=t._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(Y)?t._localDirection.be(-o,0,0):-1!==this.keysUp.indexOf(Y)?t._localDirection.be(0,0,o):-1!==this.keysRight.indexOf(Y)?t._localDirection.be(o,0,0):-1!==this.keysDown.indexOf(Y)?t._localDirection.be(0,0,-o):-1!==this.keysUpward.indexOf(Y)?t._localDirection.be(0,o,0):-1!==this.keysDownward.indexOf(Y)?t._localDirection.be(0,-o,0):-1!==this.keysRotateLeft.indexOf(Y)?(t._localDirection.be(0,0,0),t.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(Y)?(t._localDirection.be(0,0,0),t.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(Y)?(t._localDirection.be(0,0,0),t.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(Y)&&(t._localDirection.be(0,0,0),t.cameraRotation.x+=this._getLocalRotation()),t.va().useRightHandedSystem&&(t._localDirection.z*=-1),t.getViewMatrix().invertToRef(t._cameraTransformMatrix),F.l.TransformNormalToRef(t._localDirection,t._cameraTransformMatrix,t._transformedDirection),t.cameraDirection.addInPlace(t._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const t=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*t}}(0,o.e)([(0,x.P)()],U.prototype,"keysUp",void 0),(0,o.e)([(0,x.P)()],U.prototype,"keysUpward",void 0),(0,o.e)([(0,x.P)()],U.prototype,"keysDown",void 0),(0,o.e)([(0,x.P)()],U.prototype,"keysDownward",void 0),(0,o.e)([(0,x.P)()],U.prototype,"keysLeft",void 0),(0,o.e)([(0,x.P)()],U.prototype,"keysRight",void 0),(0,o.e)([(0,x.P)()],U.prototype,"rotationSpeed",void 0),(0,o.e)([(0,x.P)()],U.prototype,"keysRotateLeft",void 0),(0,o.e)([(0,x.P)()],U.prototype,"keysRotateRight",void 0),(0,o.e)([(0,x.P)()],U.prototype,"keysRotateUp",void 0),(0,o.e)([(0,x.P)()],U.prototype,"keysRotateDown",void 0),R.e.FreeCameraKeyboardMoveInput=U;var C=Y(1013),p=Y(1343);class W{constructor(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=t,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new C.e,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(t){t=E.f.BackCompatCameraNoPreventDefault(arguments);const b=this.camera.getEngine(),Y=b.getInputElement();this._pointerInput||(this._pointerInput=o=>{const x=o.event,F="touch"===x.pointerType;if(!this.touchEnabled&&F)return;if(o.type!==p.b.POINTERMOVE&&-1===this.buttons.indexOf(x.button))return;const r=x.target;if(o.type===p.b.POINTERDOWN){if(F&&-1!==this._activePointerId||!F&&-1!==this._currentActiveButton)return;this._activePointerId=x.pointerId;try{null===r||void 0===r||r.setPointerCapture(x.pointerId)}catch(R){}-1===this._currentActiveButton&&(this._currentActiveButton=x.button),this._previousPosition={x:x.clientX,y:x.clientY},t||(x.preventDefault(),Y&&Y.focus()),b.isPointerLock&&this._onMouseMove&&this._onMouseMove(o.event)}else if(o.type===p.b.POINTERUP){if(F&&this._activePointerId!==x.pointerId||!F&&this._currentActiveButton!==x.button)return;try{null===r||void 0===r||r.releasePointerCapture(x.pointerId)}catch(R){}this._currentActiveButton=-1,this._previousPosition=null,t||x.preventDefault(),this._activePointerId=-1}else if(o.type===p.b.POINTERMOVE&&(this._activePointerId===x.pointerId||!F))if(b.isPointerLock&&this._onMouseMove)this._onMouseMove(o.event);else if(this._previousPosition){const b=this.camera._calculateHandednessMultiplier(),Y=(x.clientX-this._previousPosition.x)*b,o=x.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=Y/this.angularSensibility,this.camera.cameraRotation.x+=o/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:Y,offsetY:o}),this._previousPosition={x:x.clientX,y:x.clientY},t||x.preventDefault()}}),this._onMouseMove=Y=>{if(!b.isPointerLock)return;const o=this.camera._calculateHandednessMultiplier(),x=Y.movementX*o;this.camera.cameraRotation.y+=x/this.angularSensibility;const F=Y.movementY;this.camera.cameraRotation.x+=F/this.angularSensibility,this._previousPosition=null,t||Y.preventDefault()},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,p.b.POINTERDOWN|p.b.POINTERUP|p.b.POINTERMOVE),Y&&(this._contextMenuBind=t=>this.onContextMenu(t),Y.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(t){t.preventDefault()}Xe(){if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const t=this.camera.getEngine().getInputElement();t&&t.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,o.e)([(0,x.P)()],W.prototype,"buttons",void 0),(0,o.e)([(0,x.P)()],W.prototype,"angularSensibility",void 0),R.e.FreeCameraMouseInput=W;var T,y=Y(1353);class v{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new C.e,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(t){t=E.f.BackCompatCameraNoPreventDefault(arguments),this._wheel=b=>{if(b.type!==p.b.POINTERWHEEL)return;const Y=b.event,o=Y.deltaMode===y.c.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*o*Y.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*o*Y.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*o*Y.deltaZ/this._normalize,Y.preventDefault&&(t||Y.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,p.b.POINTERWHEEL)}Xe(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,o.e)([(0,x.P)()],v.prototype,"wheelPrecisionX",void 0),(0,o.e)([(0,x.P)()],v.prototype,"wheelPrecisionY",void 0),(0,o.e)([(0,x.P)()],v.prototype,"wheelPrecisionZ",void 0),function(t){t[t.MoveRelative=0]="MoveRelative",t[t.RotateRelative=1]="RotateRelative",t[t.MoveScene=2]="MoveScene"}(T||(T={}));class B extends v{constructor(){super(...arguments),this._moveRelative=F.l.Zero(),this._rotateRelative=F.l.Zero(),this._moveScene=F.l.Zero(),this._wheelXAction=T.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=T.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(t){null===t&&this._wheelXAction!==T.MoveRelative||(this._wheelXAction=T.MoveRelative,this._wheelXActionCoordinate=t)}get wheelXMoveRelative(){return this._wheelXAction!==T.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(t){null===t&&this._wheelYAction!==T.MoveRelative||(this._wheelYAction=T.MoveRelative,this._wheelYActionCoordinate=t)}get wheelYMoveRelative(){return this._wheelYAction!==T.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(t){null===t&&this._wheelZAction!==T.MoveRelative||(this._wheelZAction=T.MoveRelative,this._wheelZActionCoordinate=t)}get wheelZMoveRelative(){return this._wheelZAction!==T.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(t){null===t&&this._wheelXAction!==T.RotateRelative||(this._wheelXAction=T.RotateRelative,this._wheelXActionCoordinate=t)}get wheelXRotateRelative(){return this._wheelXAction!==T.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(t){null===t&&this._wheelYAction!==T.RotateRelative||(this._wheelYAction=T.RotateRelative,this._wheelYActionCoordinate=t)}get wheelYRotateRelative(){return this._wheelYAction!==T.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(t){null===t&&this._wheelZAction!==T.RotateRelative||(this._wheelZAction=T.RotateRelative,this._wheelZActionCoordinate=t)}get wheelZRotateRelative(){return this._wheelZAction!==T.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(t){null===t&&this._wheelXAction!==T.MoveScene||(this._wheelXAction=T.MoveScene,this._wheelXActionCoordinate=t)}get wheelXMoveScene(){return this._wheelXAction!==T.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(t){null===t&&this._wheelYAction!==T.MoveScene||(this._wheelYAction=T.MoveScene,this._wheelYActionCoordinate=t)}get wheelYMoveScene(){return this._wheelYAction!==T.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(t){null===t&&this._wheelZAction!==T.MoveScene||(this._wheelZAction=T.MoveScene,this._wheelZActionCoordinate=t)}get wheelZMoveScene(){return this._wheelZAction!==T.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.ee(0),this._rotateRelative.ee(0),this._moveScene.ee(0),this._updateCamera(),this.camera.va().useRightHandedSystem&&(this._moveRelative.z*=-1);const t=F.c.Zero();this.camera.getViewMatrix().invertToRef(t);const b=F.l.Zero();F.l.TransformNormalToRef(this._moveRelative,t,b),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(b),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(t,b,Y){if(0===t)return;if(null===b||null===Y)return;let o=null;switch(b){case T.MoveRelative:o=this._moveRelative;break;case T.RotateRelative:o=this._rotateRelative;break;case T.MoveScene:o=this._moveScene}switch(Y){case 0:o.set(t,0,0);break;case 1:o.set(0,t,0);break;case 2:o.set(0,0,t)}}}(0,o.e)([(0,x.P)()],B.prototype,"wheelXMoveRelative",null),(0,o.e)([(0,x.P)()],B.prototype,"wheelYMoveRelative",null),(0,o.e)([(0,x.P)()],B.prototype,"wheelZMoveRelative",null),(0,o.e)([(0,x.P)()],B.prototype,"wheelXRotateRelative",null),(0,o.e)([(0,x.P)()],B.prototype,"wheelYRotateRelative",null),(0,o.e)([(0,x.P)()],B.prototype,"wheelZRotateRelative",null),(0,o.e)([(0,x.P)()],B.prototype,"wheelXMoveScene",null),(0,o.e)([(0,x.P)()],B.prototype,"wheelYMoveScene",null),(0,o.e)([(0,x.P)()],B.prototype,"wheelZMoveScene",null),R.e.FreeCameraMouseWheelInput=B;class J{constructor(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=t,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=E.f.IsSafari()}attachControl(t){t=E.f.BackCompatCameraNoPreventDefault(arguments);let b=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=Y=>{const o=Y.event,x="mouse"===o.pointerType||this._isSafari&&"undefined"===typeof o.pointerType;if(this.allowMouse||!x)if(Y.type===p.b.POINTERDOWN){if(t||o.preventDefault(),this._pointerPressed.push(o.pointerId),1!==this._pointerPressed.length)return;b={x:o.clientX,y:o.clientY}}else if(Y.type===p.b.POINTERUP){t||o.preventDefault();const Y=this._pointerPressed.indexOf(o.pointerId);if(-1===Y)return;if(this._pointerPressed.splice(Y,1),0!=Y)return;b=null,this._offsetX=null,this._offsetY=null}else if(Y.type===p.b.POINTERMOVE){if(t||o.preventDefault(),!b)return;if(0!=this._pointerPressed.indexOf(o.pointerId))return;this._offsetX=o.clientX-b.x,this._offsetY=-(o.clientY-b.y)}}),this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,p.b.POINTERDOWN|p.b.POINTERUP|p.b.POINTERMOVE),this._onLostFocus){const t=this.camera.getEngine().getInputElement();t&&t.addEventListener("blur",this._onLostFocus)}}Xe(){if(this._pointerInput){if(this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const t=this.camera.getEngine().getInputElement();t&&t.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const t=this.camera,b=t._calculateHandednessMultiplier();t.cameraRotation.y=b*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)t.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const b=t._computeLocalCameraSpeed(),Y=new F.l(0,0,0!==this.touchMoveSensibility?b*this._offsetY/this.touchMoveSensibility:0);F.c.RotationYawPitchRollToRef(t.rotation.y,t.rotation.x,0,t._cameraRotationMatrix),t.cameraDirection.addInPlace(F.l.TransformCoordinates(Y,t._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,o.e)([(0,x.P)()],J.prototype,"touchAngularSensibility",void 0),(0,o.e)([(0,x.P)()],J.prototype,"touchMoveSensibility",void 0),R.e.FreeCameraTouchInput=J;class m extends R.g{constructor(t){super(t),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new U),this}addMouse(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new W(t),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new B,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new J),this}clear(){super.clear(),this._mouseInput=null}}var K=Y(1041),L=Y(1160);class z extends r.d{get angularSensibility(){const t=this.inputs.attached.mouse;return t?t.angularSensibility:0}set angularSensibility(t){const b=this.inputs.attached.mouse;b&&(b.angularSensibility=t)}get keysUp(){const t=this.inputs.attached.keyboard;return t?t.keysUp:[]}set keysUp(t){const b=this.inputs.attached.keyboard;b&&(b.keysUp=t)}get keysUpward(){const t=this.inputs.attached.keyboard;return t?t.keysUpward:[]}set keysUpward(t){const b=this.inputs.attached.keyboard;b&&(b.keysUpward=t)}get keysDown(){const t=this.inputs.attached.keyboard;return t?t.keysDown:[]}set keysDown(t){const b=this.inputs.attached.keyboard;b&&(b.keysDown=t)}get keysDownward(){const t=this.inputs.attached.keyboard;return t?t.keysDownward:[]}set keysDownward(t){const b=this.inputs.attached.keyboard;b&&(b.keysDownward=t)}get keysLeft(){const t=this.inputs.attached.keyboard;return t?t.keysLeft:[]}set keysLeft(t){const b=this.inputs.attached.keyboard;b&&(b.keysLeft=t)}get keysRight(){const t=this.inputs.attached.keyboard;return t?t.keysRight:[]}set keysRight(t){const b=this.inputs.attached.keyboard;b&&(b.keysRight=t)}get keysRotateLeft(){const t=this.inputs.attached.keyboard;return t?t.keysRotateLeft:[]}set keysRotateLeft(t){const b=this.inputs.attached.keyboard;b&&(b.keysRotateLeft=t)}get keysRotateRight(){const t=this.inputs.attached.keyboard;return t?t.keysRotateRight:[]}set keysRotateRight(t){const b=this.inputs.attached.keyboard;b&&(b.keysRotateRight=t)}get keysRotateUp(){const t=this.inputs.attached.keyboard;return t?t.keysRotateUp:[]}set keysRotateUp(t){const b=this.inputs.attached.keyboard;b&&(b.keysRotateUp=t)}get keysRotateDown(){const t=this.inputs.attached.keyboard;return t?t.keysRotateDown:[]}set keysRotateDown(t){const b=this.inputs.attached.keyboard;b&&(b.keysRotateDown=t)}constructor(t,b,Y){var o;super(t,b,Y,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),o=this,this.ellipsoid=new F.l(.5,1,.5),this.ellipsoidOffset=new F.l(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=F.l.Zero(),this._diffPosition=F.l.Zero(),this._newPosition=F.l.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(t,b){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;o._newPosition.p(b),o._newPosition.subtractToRef(o._oldPosition,o._diffPosition),o._diffPosition.length()>L.c.CollisionsEpsilon&&(o.position.addToRef(o._diffPosition,o._deferredPositionUpdate),o._deferOnly?o._deferredUpdated=!0:o.position.p(o._deferredPositionUpdate),o.Dk&&Y&&o.Dk(Y))},this.inputs=new m(this),this.inputs.addKeyboard().addMouse()}attachControl(t,b){b=E.f.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(b)}Xe(){this.inputs.detachElement(),this.cameraDirection=new F.l(0,0,0),this.cameraRotation=new F.i(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(t){this._collisionMask=isNaN(t)?-1:t}_collideWithWorld(t){let b;b=this.parent?F.l.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,b.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const Y=this.va().collisionCoordinator;this._collider||(this._collider=Y.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let o=t;this.applyGravity&&(o=t.add(this.va().gravity)),Y.getNewPosition(this._oldPosition,o,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=F.l.Zero(),this._transformedDirection=F.l.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(t){this._needMoveForGravity=t}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.va().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"fb"}}(0,o.e)([(0,x.L)()],z.prototype,"ellipsoid",void 0),(0,o.e)([(0,x.L)()],z.prototype,"ellipsoidOffset",void 0),(0,o.e)([(0,x.P)()],z.prototype,"checkCollisions",void 0),(0,o.e)([(0,x.P)()],z.prototype,"applyGravity",void 0),(0,K.d)("BABYLON.FreeCamera",z)},12306:(t,b,Y)=>{"use strict";Y.d(b,{d:()=>E});var o=Y(999),x=Y(1001),F=Y(11750),r=Y(1019),R=Y(1028),d=Y(1564);Y(11759).c.AddNodeConstructor("TargetCamera",((t,b)=>()=>new E(t,r.l.Zero(),b)));class E extends F.b{constructor(t,b,Y){super(t,b,Y,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),this._tmpUpVector=r.l.Zero(),this._tmpTargetVector=r.l.Zero(),this.cameraDirection=new r.l(0,0,0),this.cameraRotation=new r.i(0,0),this.ignoreParentScaling=!1,this.updateUpVectorFromRotation=!1,this._tmpQuaternion=new r.e,this.rotation=new r.l(0,0,0),this.speed=2,this.noRotationConstraint=!1,this.invertRotation=!1,this.inverseRotationSpeed=.2,this.lockedTarget=null,this._currentTarget=r.l.Zero(),this._initialFocalDistance=1,this._viewMatrix=r.c.Zero(),this._camMatrix=r.c.Zero(),this._cameraTransformMatrix=r.c.Zero(),this._cameraRotationMatrix=r.c.Zero(),this._referencePoint=new r.l(0,0,1),this._transformedReferencePoint=r.l.Zero(),this._deferredPositionUpdate=new r.l,this._deferredRotationQuaternionUpdate=new r.e,this._deferredRotationUpdate=new r.l,this._deferredUpdated=!1,this._deferOnly=!1,this._defaultUp=r.l.Up(),this._cachedRotationZ=0,this._cachedQuaternionRotationZ=0}getFrontPosition(t){this.getWorldMatrix();const b=this.getTarget().fd(this.position);return b.normalize(),b.scaleInPlace(t),this.globalPosition.add(b)}_getLockedTargetPosition(){if(!this.lockedTarget)return null;if(this.lockedTarget.absolutePosition){const t=this.lockedTarget;t.ve().getTranslationToRef(t.absolutePosition)}return this.lockedTarget.absolutePosition||this.lockedTarget}storeState(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),super.storeState()}_restoreStateValues(){return!!super._restoreStateValues()&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.be(0,0,0),this.cameraRotation.be(0,0),!0)}_initCache(){super._initCache(),this._cache.lockedTarget=new r.l(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new r.l(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new r.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}_updateCache(t){t||super._updateCache();const b=this._getLockedTargetPosition();b?this._cache.lockedTarget?this._cache.lockedTarget.p(b):this._cache.lockedTarget=b.clone():this._cache.lockedTarget=null,this._cache.rotation.p(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.p(this.rotationQuaternion)}_isSynchronizedViewMatrix(){if(!super._isSynchronizedViewMatrix())return!1;const t=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(t):!t)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))}_computeLocalCameraSpeed(){const t=this.getEngine();return this.speed*Math.sqrt(t.getDeltaTime()/(100*t.getFps()))}setTarget(t){this.upVector.normalize(),this._initialFocalDistance=t.fd(this.position).length(),this.position.z===t.z&&(this.position.z+=R.e),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),r.c.LookAtLHToRef(this.position,t,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);const b=t.fd(this.position);b.x>=0?this.rotation.y=-Math.atan(b.z/b.x)+Math.PI/2:this.rotation.y=-Math.atan(b.z/b.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&r.e.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)}get target(){return this.getTarget()}set target(t){this.setTarget(t)}getTarget(){return this._currentTarget}_decideIfNeedsToMove(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(r.f.Matrix[0]),r.l.TransformNormalToRef(this.cameraDirection,r.f.Matrix[0],r.f.ae[0]),this._deferredPositionUpdate.addInPlace(r.f.ae[0]),void(this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate));this._deferredPositionUpdate.addInPlace(this.cameraDirection),this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate)}_checkInputs(){const t=this.invertRotation?-this.inverseRotationSpeed:1,b=this._decideIfNeedsToMove(),Y=this.cameraRotation.x||this.cameraRotation.y;if(this._deferredUpdated=!1,this._deferredRotationUpdate.p(this.rotation),this._deferredPositionUpdate.p(this.position),this.rotationQuaternion&&this._deferredRotationQuaternionUpdate.p(this.rotationQuaternion),b&&this._updatePosition(),Y){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this._deferredRotationUpdate),this._deferredRotationUpdate.x+=this.cameraRotation.x*t,this._deferredRotationUpdate.y+=this.cameraRotation.y*t,!this.noRotationConstraint){const t=1.570796;this._deferredRotationUpdate.x>t&&(this._deferredRotationUpdate.x=t),this._deferredRotationUpdate.x<-t&&(this._deferredRotationUpdate.x=-t)}if(this._deferOnly?this._deferredUpdated=!0:this.rotation.p(this._deferredRotationUpdate),this.rotationQuaternion){this._deferredRotationUpdate.lengthSquared()&&(r.e.RotationYawPitchRollToRef(this._deferredRotationUpdate.y,this._deferredRotationUpdate.x,this._deferredRotationUpdate.z,this._deferredRotationQuaternionUpdate),this._deferOnly?this._deferredUpdated=!0:this.rotationQuaternion.p(this._deferredRotationQuaternionUpdate))}}b&&(Math.abs(this.cameraDirection.x)<this.speed*R.e&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*R.e&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*R.e&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),Y&&(Math.abs(this.cameraRotation.x)<this.speed*R.e&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*R.e&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),super._checkInputs()}_updateCameraRotationMatrix(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):r.c.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)}_rotateUpVectorWithCameraRotationMatrix(){return r.l.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this}_getViewMatrix(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),r.l.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?d.b.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(r.e.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),d.b.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix}_computeViewMatrix(t,b,Y){if(this.ignoreParentScaling){if(this.parent){const o=this.parent.getWorldMatrix();r.l.TransformCoordinatesToRef(t,o,this._globalPosition),r.l.TransformCoordinatesToRef(b,o,this._tmpTargetVector),r.l.TransformNormalToRef(Y,o,this._tmpUpVector),this._markSyncedWithParent()}else this._globalPosition.p(t),this._tmpTargetVector.p(b),this._tmpUpVector.p(Y);this.va().useRightHandedSystem?r.c.LookAtRHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix):r.c.LookAtLHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix)}else if(this.va().useRightHandedSystem?r.c.LookAtRHToRef(t,b,Y,this._viewMatrix):r.c.LookAtLHToRef(t,b,Y,this._viewMatrix),this.parent){const t=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(t,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.p(t)}createRigCamera(t,b){if(this.cameraRigMode!==F.b.RIG_MODE_NONE){const b=new E(t,this.position.clone(),this.va());return b.isRigCamera=!0,b.rigParent=this,this.cameraRigMode===F.b.RIG_MODE_VR&&(this.rotationQuaternion||(this.rotationQuaternion=new r.e),b._cameraRigParams={},b.rotationQuaternion=new r.e),b.mode=this.mode,b.orthoLeft=this.orthoLeft,b.orthoRight=this.orthoRight,b.orthoTop=this.orthoTop,b.orthoBottom=this.orthoBottom,b}return null}_updateRigCameras(){const t=this._rigCameras[0],b=this._rigCameras[1];switch(this.ve(),this.cameraRigMode){case F.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case F.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case F.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case F.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case F.b.RIG_MODE_STEREOSCOPIC_INTERLACED:{const Y=this.cameraRigMode===F.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,o=this.cameraRigMode===F.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*Y,t),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*o,b);break}case F.b.RIG_MODE_VR:t.rotationQuaternion?(t.rotationQuaternion.p(this.rotationQuaternion),b.rotationQuaternion.p(this.rotationQuaternion)):(t.rotation.p(this.rotation),b.rotation.p(this.rotation)),t.position.p(this.position),b.position.p(this.position)}super._updateRigCameras()}_getRigCamPositionAndTarget(t,b){this.getTarget().subtractToRef(this.position,E._TargetFocalPoint),E._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);const Y=E._TargetFocalPoint.addInPlace(this.position);r.c.TranslationToRef(-Y.x,-Y.y,-Y.z,E._TargetTransformMatrix),E._TargetTransformMatrix.multiplyToRef(r.c.RotationAxis(b.upVector,t),E._RigCamTransformMatrix),r.c.TranslationToRef(Y.x,Y.y,Y.z,E._TargetTransformMatrix),E._RigCamTransformMatrix.multiplyToRef(E._TargetTransformMatrix,E._RigCamTransformMatrix),r.l.TransformCoordinatesToRef(this.position,E._RigCamTransformMatrix,b.position),b.setTarget(Y)}getClassName(){return"TargetCamera"}}E._RigCamTransformMatrix=new r.c,E._TargetTransformMatrix=new r.c,E._TargetFocalPoint=new r.l,(0,o.e)([(0,x.L)()],E.prototype,"rotation",void 0),(0,o.e)([(0,x.P)()],E.prototype,"speed",void 0),(0,o.e)([(0,x.B)("lockedTargetId")],E.prototype,"lockedTarget",void 0)},12739:(t,b,Y)=>{"use strict";Y.d(b,{d:()=>F});var o=Y(1252),x=Y(12742);class F{constructor(t,b){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=Y,this.xi=[],this._maxBlockCapacity=b||64,this._selectionContent=new o.c(1024),this._creationFunc=t}update(t,b,Y){x.c._CreateBlocks(t,b,Y,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}df(t){for(let b=0;b<this.Qh.length;b++){this.Qh[b].addEntry(t)}}gf(t){for(let b=0;b<this.Qh.length;b++){this.Qh[b].removeEntry(t)}}select(t,b){this._selectionContent.reset();for(let Y=0;Y<this.Qh.length;Y++){this.Qh[Y].select(t,this._selectionContent,b)}return b?this._selectionContent.concat(this.xi):this._selectionContent.concatWithNoDuplicate(this.xi),this._selectionContent}intersects(t,b,Y){this._selectionContent.reset();for(let o=0;o<this.Qh.length;o++){this.Qh[o].intersects(t,b,this._selectionContent,Y)}return Y?this._selectionContent.concat(this.xi):this._selectionContent.concatWithNoDuplicate(this.xi),this._selectionContent}intersectsRay(t){this._selectionContent.reset();for(let b=0;b<this.Qh.length;b++){this.Qh[b].intersectsRay(t,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.xi),this._selectionContent}}F.CreationFuncForMeshes=(t,b)=>{const Y=t.getBoundingInfo();!t.isBlocked&&Y.boundingBox.intersectsMinMax(b.Bi,b.Ci)&&b.entries.push(t)},F.CreationFuncForSubMeshes=(t,b)=>{t.getBoundingInfo().boundingBox.intersectsMinMax(b.Bi,b.Ci)&&b.entries.push(t)}},12742:(t,b,Y)=>{"use strict";Y.d(b,{c:()=>F});var o=Y(1019),x=Y(1422);class F{constructor(t,b,Y,o,x,F){this.entries=[],this.Di=new Array,this._capacity=Y,this._depth=o,this._maxDepth=x,this._creationFunc=F,this._minPoint=t,this._maxPoint=b,this.Di.push(t.clone()),this.Di.push(b.clone()),this.Di.push(t.clone()),this.Di[2].x=b.x,this.Di.push(t.clone()),this.Di[3].y=b.y,this.Di.push(t.clone()),this.Di[4].z=b.z,this.Di.push(b.clone()),this.Di[5].z=t.z,this.Di.push(b.clone()),this.Di[6].x=t.x,this.Di.push(b.clone()),this.Di[7].y=t.y}get Xc(){return this._capacity}get Bi(){return this._minPoint}get Ci(){return this._maxPoint}addEntry(t){if(this.Qh)for(let b=0;b<this.Qh.length;b++){this.Qh[b].addEntry(t)}else this._creationFunc(t,this),this.entries.length>this.Xc&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(t){if(this.Qh){for(let b=0;b<this.Qh.length;b++){this.Qh[b].removeEntry(t)}return}const b=this.entries.indexOf(t);b>-1&&this.entries.splice(b,1)}addEntries(t){for(let b=0;b<t.length;b++){const Y=t[b];this.addEntry(Y)}}select(t,b,Y){if(x.b.IsInFrustum(this.Di,t)){if(this.Qh){for(let o=0;o<this.Qh.length;o++){this.Qh[o].select(t,b,Y)}return}Y?b.concat(this.entries):b.concatWithNoDuplicate(this.entries)}}intersects(t,b,Y,o){if(x.b.IntersectsSphere(this._minPoint,this._maxPoint,t,b)){if(this.Qh){for(let x=0;x<this.Qh.length;x++){this.Qh[x].intersects(t,b,Y,o)}return}o?Y.concat(this.entries):Y.concatWithNoDuplicate(this.entries)}}intersectsRay(t,b){if(t.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.Qh){for(let Y=0;Y<this.Qh.length;Y++){this.Qh[Y].intersectsRay(t,b)}return}b.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){F._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(t,b,Y,x,r,R,d,E){d.Qh=new Array;const U=new o.l((b.x-t.x)/2,(b.y-t.y)/2,(b.z-t.z)/2);for(let o=0;o<2;o++)for(let b=0;b<2;b++)for(let C=0;C<2;C++){const p=t.add(U.multiplyByFloats(o,b,C)),W=t.add(U.multiplyByFloats(o+1,b+1,C+1)),T=new F(p,W,x,r+1,R,E);T.addEntries(Y),d.Qh.push(T)}}}},12748:(t,b,Y)=>{"use strict";Y.d(b,{c:()=>U});var o=Y(1260),x=Y(1019),F=Y(11781),r=Y(11894),R=Y(1336),d=Y(12739),E=Y(1051);o.e.prototype.createOrUpdateSelectionOctree=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,Y=this._getComponent(R.b.NAME_OCTREE);Y||(Y=new U(this),this.af(Y)),this.ui||(this.ui=new d.d(d.d.CreationFuncForMeshes,t,b));const o=this.getWorldExtends();return this.ui.update(o.min,o.max,this.meshes),this.ui},Object.defineProperty(o.e.prototype,"selectionOctree",{get:function(){return this.ui},enumerable:!0,configurable:!0}),F.b.prototype.createOrUpdateSubmeshesOctree=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const Y=this.va();let o=Y._getComponent(R.b.NAME_OCTREE);o||(o=new U(Y),Y.af(o)),this._submeshesOctree||(this._submeshesOctree=new d.d(d.d.CreationFuncForSubMeshes,t,b)),this.ve(!0);const x=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(x.minimumWorld,x.maximumWorld,this.ne),this._submeshesOctree};class U{constructor(t){this.name=R.b.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new r.e(x.l.Zero(),new x.l(1,1,1)),(t=t||E.d.LastCreatedScene)&&(this.Se=t,this.Se.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.Se.getActiveSubMeshCandidates=t=>this.getActiveSubMeshCandidates(t),this.Se.getCollidingSubMeshCandidates=(t,b)=>this.getCollidingSubMeshCandidates(t,b),this.Se.getIntersectingSubMeshCandidates=(t,b)=>this.getIntersectingSubMeshCandidates(t,b))}register(){this.Se.onMeshRemovedObservable.add((t=>{const b=this.Se.selectionOctree;if(void 0!==b&&null!==b){const Y=b.xi.indexOf(t);-1!==Y&&b.xi.splice(Y,1)}})),this.Se.onMeshImportedObservable.add((t=>{const b=this.Se.selectionOctree;void 0!==b&&null!==b&&b.df(t)}))}getActiveMeshCandidates(){var t;return(null===(t=this.Se.ui)||void 0===t?void 0:t.select(this.Se.frustumPlanes))||this.Se._getDefaultMeshCandidates()}getActiveSubMeshCandidates(t){if(t._submeshesOctree&&t.useOctreeForRenderingSelection){return t._submeshesOctree.select(this.Se.frustumPlanes)}return this.Se._getDefaultSubMeshCandidates(t)}getIntersectingSubMeshCandidates(t,b){if(t._submeshesOctree&&t.useOctreeForPicking){r.e.TransformToRef(b,t.getWorldMatrix(),this._tempRay);return t._submeshesOctree.intersectsRay(this._tempRay)}return this.Se._getDefaultSubMeshCandidates(t)}getCollidingSubMeshCandidates(t,b){if(t._submeshesOctree&&t.useOctreeForCollisions){const Y=b._velocityWorldLength+Math.max(b._radius.x,b._radius.y,b._radius.z);return t._submeshesOctree.intersects(b._basePointWorld,Y)}return this.Se._getDefaultSubMeshCandidates(t)}rebuild(){}dispose(){}}},11894:(t,b,Y)=>{"use strict";Y.d(b,{e:()=>W});var o=Y(1260),x=Y(11750),F=Y(1028),r=Y(1019),R=Y(1035),d=Y(1409),E=Y(1298),U=Y(1051),C=Y(1361);const p={internalPickerForMesh:void 0};class W{constructor(t,b){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:F.e;this.origin=t,this.direction=b,this.length=Y,this.epsilon=o}clone(){return new W(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(t,b){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const o=W._TmpVector3[0].be(t.x-Y,t.y-Y,t.z-Y),x=W._TmpVector3[1].be(b.x+Y,b.y+Y,b.z+Y);let F,r,R,d,E=0,U=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<o.x||this.origin.x>x.x)return!1}else if(F=1/this.direction.x,r=(o.x-this.origin.x)*F,R=(x.x-this.origin.x)*F,R===-1/0&&(R=1/0),r>R&&(d=r,r=R,R=d),E=Math.max(r,E),U=Math.min(R,U),E>U)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<o.y||this.origin.y>x.y)return!1}else if(F=1/this.direction.y,r=(o.y-this.origin.y)*F,R=(x.y-this.origin.y)*F,R===-1/0&&(R=1/0),r>R&&(d=r,r=R,R=d),E=Math.max(r,E),U=Math.min(R,U),E>U)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<o.z||this.origin.z>x.z)return!1}else if(F=1/this.direction.z,r=(o.z-this.origin.z)*F,R=(x.z-this.origin.z)*F,R===-1/0&&(R=1/0),r>R&&(d=r,r=R,R=d),E=Math.max(r,E),U=Math.min(R,U),E>U)return!1;return!0}intersectsBox(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(t.minimum,t.maximum,b)}intersectsSphere(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const Y=t.center.x-this.origin.x,o=t.center.y-this.origin.y,x=t.center.z-this.origin.z,F=Y*Y+o*o+x*x,r=t.i+b,R=r*r;if(F<=R)return!0;const d=Y*this.direction.x+o*this.direction.y+x*this.direction.z;if(d<0)return!1;return F-d*d<=R}intersectsTriangle(t,b,Y){const o=W._TmpVector3[0],x=W._TmpVector3[1],F=W._TmpVector3[2],R=W._TmpVector3[3],E=W._TmpVector3[4];b.subtractToRef(t,o),Y.subtractToRef(t,x),r.l.CrossToRef(this.direction,x,F);const U=r.l.Dot(o,F);if(0===U)return null;const C=1/U;this.origin.subtractToRef(t,R);const p=r.l.Dot(R,F)*C;if(p<-this.epsilon||p>1+this.epsilon)return null;r.l.CrossToRef(R,o,E);const T=r.l.Dot(this.direction,E)*C;if(T<-this.epsilon||p+T>1+this.epsilon)return null;const y=r.l.Dot(x,E)*C;return y>this.length?null:new d.e(1-p-T,p,y)}intersectsPlane(t){let b;const Y=r.l.Dot(t.xe,this.direction);if(Math.abs(Y)<9.99999997475243e-7)return null;{const o=r.l.Dot(t.xe,this.origin);return b=(-t.d-o)/Y,b<0?b<-9.99999997475243e-7?null:0:b}}intersectsAxis(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(t){case"y":{const t=(this.origin.y-b)/this.direction.y;return t>0?null:new r.l(this.origin.x+this.direction.x*-t,b,this.origin.z+this.direction.z*-t)}case"x":{const t=(this.origin.x-b)/this.direction.x;return t>0?null:new r.l(b,this.origin.y+this.direction.y*-t,this.origin.z+this.direction.z*-t)}case"z":{const t=(this.origin.z-b)/this.direction.z;return t>0?null:new r.l(this.origin.x+this.direction.x*-t,this.origin.y+this.direction.y*-t,b)}default:return null}}intersectsMesh(t,b,Y){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],x=arguments.length>4?arguments[4]:void 0,F=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const R=r.f.Matrix[0];return t.getWorldMatrix().invertToRef(R),this._tmpRay?W.TransformToRef(this,R,this._tmpRay):this._tmpRay=W.Transform(this,R),t.intersects(this._tmpRay,b,Y,o,x,F)}intersectsMeshes(t,b,Y){Y?Y.length=0:Y=[];for(let o=0;o<t.length;o++){const x=this.intersectsMesh(t[o],b);x.hit&&Y.push(x)}return Y.sort(this._comparePickingInfo),Y}_comparePickingInfo(t,b){return t.distance<b.distance?-1:t.distance>b.distance?1:0}intersectionSegment(t,b,Y){const o=this.origin,x=r.f.ae[0],F=r.f.ae[1],R=r.f.ae[2],d=r.f.ae[3];b.subtractToRef(t,x),this.direction.scaleToRef(W._Rayl,R),o.addToRef(R,F),t.subtractToRef(o,d);const E=r.l.Dot(x,x),U=r.l.Dot(x,R),C=r.l.Dot(R,R),p=r.l.Dot(x,d),T=r.l.Dot(R,d),y=E*C-U*U;let v,B,J=y,m=y;y<W._Smallnum?(v=0,J=1,B=T,m=C):(v=U*T-C*p,B=E*T-U*p,v<0?(v=0,B=T,m=C):v>J&&(v=J,B=T+U,m=C)),B<0?(B=0,-p<0?v=0:-p>E?v=J:(v=-p,J=E)):B>m&&(B=m,-p+U<0?v=0:-p+U>E?v=J:(v=-p+U,J=E));const K=Math.abs(v)<W._Smallnum?0:v/J,L=Math.abs(B)<W._Smallnum?0:B/m,z=r.f.ae[4];R.scaleToRef(L,z);const S=r.f.ae[5];x.scaleToRef(K,S),S.addInPlace(d);const e=r.f.ae[6];S.subtractToRef(z,e);return L>0&&L<=this.length&&e.lengthSquared()<Y*Y?S.length():-1}update(t,b,Y,o,x,F,R){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){W._RayDistant||(W._RayDistant=W.Zero()),W._RayDistant.unprojectRayToRef(t,b,Y,o,r.c.IdentityReadOnly,F,R);const d=r.f.Matrix[0];x.invertToRef(d),W.TransformToRef(W._RayDistant,d,this)}else this.unprojectRayToRef(t,b,Y,o,x,F,R);return this}static Zero(){return new W(r.l.Zero(),r.l.Zero())}static CreateNew(t,b,Y,o,x,F,r){return W.Zero().update(t,b,Y,o,x,F,r)}static CreateNewFromTo(t,b){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r.c.IdentityReadOnly;const o=new W(new r.l(0,0,0),new r.l(0,0,0));return W.CreateFromToToRef(t,b,o,Y)}static CreateFromToToRef(t,b,Y){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r.c.IdentityReadOnly;Y.origin.p(t);const x=b.subtractToRef(t,Y.direction),F=Math.sqrt(x.x*x.x+x.y*x.y+x.z*x.z);return Y.length=F,Y.direction.normalize(),W.TransformToRef(Y,o,Y)}static Transform(t,b){const Y=new W(new r.l(0,0,0),new r.l(0,0,0));return W.TransformToRef(t,b,Y),Y}static TransformToRef(t,b,Y){r.l.TransformCoordinatesToRef(t.origin,b,Y.origin),r.l.TransformNormalToRef(t.direction,b,Y.direction),Y.length=t.length,Y.epsilon=t.epsilon;const o=Y.direction,x=o.length();if(0!==x&&1!==x){const t=1/x;o.x*=t,o.y*=t,o.z*=t,Y.length*=x}return Y}unprojectRayToRef(t,b,Y,o,x,F,R){const d=r.f.Matrix[0];x.multiplyToRef(F,d),d.multiplyToRef(R,d),d.invert();const E=U.d.LastCreatedEngine,C=r.f.ae[0];C.x=t/Y*2-1,C.y=-(b/o*2-1),C.z=null!==E&&void 0!==E&&E.useReverseDepthBuffer?1:null!==E&&void 0!==E&&E.isNDCHalfZRange?0:-1;const p=r.f.ae[1].be(C.x,C.y,1-1e-8),W=r.f.ae[2],T=r.f.ae[3];r.l._UnprojectFromInvertedMatrixToRef(C,d,W),r.l._UnprojectFromInvertedMatrixToRef(p,d,T),this.origin.p(W),T.subtractToRef(W,this.direction),this.direction.normalize()}}function T(t,b,Y,o,x){let F=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const r=W.Zero();return y(t,b,Y,o,r,x,F),r}function y(t,b,Y,o,x,F){let R=arguments.length>6&&void 0!==arguments[6]&&arguments[6],d=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const E=t.getEngine();if(!F&&!(F=t.activeCamera))return t;const U=F.viewport,C=E.getRenderHeight(),{x:p,y:W,width:T,height:y}=U.toGlobal(E.getRenderWidth(),C),v=1/E.getHardwareScalingLevel();return b=b*v-p,Y=Y*v-(C-W-y),x.update(b,Y,T,y,o||r.c.IdentityReadOnly,R?r.c.IdentityReadOnly:F.getViewMatrix(),F.getProjectionMatrix(),d),t}function v(t,b,Y,o,x){if(!E.c)return t;const F=t.getEngine();if(!x&&!(x=t.activeCamera))throw new Error("Active camera not set");const R=x.viewport,d=F.getRenderHeight(),{x:U,y:C,width:p,height:W}=R.toGlobal(F.getRenderWidth(),d),T=r.c.Identity(),y=1/F.getHardwareScalingLevel();return b=b*y-U,Y=Y*y-(d-C-W),o.update(b,Y,p,W,T,T,x.getProjectionMatrix()),t}function B(t,b,Y,o,x,F,r,R){const d=b(o,Y.enableDistantPicking),E=Y.intersects(d,x,r,F,o,R);return E&&E.hit?!x&&null!=t&&E.distance>=t.distance?null:E:null}function J(t,b,Y,o,x,F){let R=null;const d=!!(t.activeCameras&&t.activeCameras.length>1&&t.cameraToUseForPointers!==t.activeCamera),U=t.cameraToUseForPointers||t.activeCamera,C=p.internalPickerForMesh||B;for(let E=0;E<t.meshes.length;E++){const p=t.meshes[E];if(Y){if(!Y(p,-1))continue}else if(!p.isEnabled()||!p.isVisible||!p.Ve)continue;const W=d&&p.isWorldMatrixCameraDependent(),T=p.ve(W,U);if(p.hasThinInstances&&p.thinInstanceEnablePicking){const t=C(R,b,p,T,!0,!0,F);if(t){if(x)return t;const d=r.f.Matrix[1],E=p.thinInstanceGetWorldMatrices();for(let t=0;t<E.length;t++){if(Y&&!Y(p,t))continue;E[t].multiplyToRef(T,d);const r=C(R,b,p,d,o,x,F,!0);if(r&&(R=r,R.thinInstanceIndex=t,o))return R}}}else{const t=C(R,b,p,T,o,x,F);if(t&&(R=t,o))return R}}return R||new E.c}function m(t,b,Y,o){if(!E.c)return null;const x=[],F=!!(t.activeCameras&&t.activeCameras.length>1&&t.cameraToUseForPointers!==t.activeCamera),R=t.cameraToUseForPointers||t.activeCamera,d=p.internalPickerForMesh||B;for(let E=0;E<t.meshes.length;E++){const U=t.meshes[E];if(Y){if(!Y(U,-1))continue}else if(!U.isEnabled()||!U.isVisible||!U.Ve)continue;const C=F&&U.isWorldMatrixCameraDependent(),p=U.ve(C,R);if(U.hasThinInstances&&U.thinInstanceEnablePicking){if(d(null,b,U,p,!0,!0,o)){const t=r.f.Matrix[1],F=U.thinInstanceGetWorldMatrices();for(let r=0;r<F.length;r++){if(Y&&!Y(U,r))continue;F[r].multiplyToRef(p,t);const R=d(null,b,U,t,!1,!1,o,!0);R&&(R.thinInstanceIndex=r,x.push(R))}}}else{const t=d(null,b,U,p,!1,!1,o);t&&x.push(t)}}return x}function K(t,b){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,o=arguments.length>3?arguments[3]:void 0,x=arguments.length>4?arguments[4]:void 0;o||(o=t.getWorldMatrix()),b.length=Y,x?b.origin.p(x):b.origin.p(t.position);const F=r.f.ae[2];F.set(0,0,t._scene.useRightHandedSystem?-1:1);const R=r.f.ae[3];return r.l.TransformNormalToRef(F,o,R),r.l.NormalizeToRef(R,b.direction),b}var L,z;W._TmpVector3=(0,R.d)(6,r.l.Zero),W._RayDistant=W.Zero(),W._Smallnum=1e-8,W._Rayl=1e9,L=o.e,(z=x.b)&&(z.prototype.getForwardRay=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,b=arguments.length>1?arguments[1]:void 0,Y=arguments.length>2?arguments[2]:void 0;return K(this,new W(r.l.Zero(),r.l.Zero(),t),t,b,Y)},z.prototype.getForwardRayToRef=function(t){return K(this,t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),L&&(C.b._IsPickingAvailable=!0,L.prototype.createPickingRay=function(t,b,Y,o){return T(this,t,b,Y,o,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),o.e.prototype.createPickingRayToRef=function(t,b,Y,o,x){return y(this,t,b,Y,o,x,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},o.e.prototype.createPickingRayInCameraSpace=function(t,b,Y){return function(t,b,Y,o){const x=W.Zero();return v(t,b,Y,x,o),x}(this,t,b,Y)},o.e.prototype.createPickingRayInCameraSpaceToRef=function(t,b,Y,o){return v(this,t,b,Y,o)},o.e.prototype.pickWithBoundingInfo=function(t,b,Y,o,x){return function(t,b,Y,o,x,F){if(!E.c)return null;const R=J(t,(o=>(t._tempPickingRay||(t._tempPickingRay=W.Zero()),y(t,b,Y,o,t._tempPickingRay,F||null),t._tempPickingRay)),o,x,!0);return R&&(R.ray=T(t,b,Y,r.c.Identity(),F||null)),R}(this,t,b,Y,o,x)},o.e.prototype.ed=function(t,b,Y,o,x,F){return function(t,b,Y,o,x,F,R){const d=J(t,((o,x)=>(t._tempPickingRay||(t._tempPickingRay=W.Zero()),y(t,b,Y,o,t._tempPickingRay,F||null,!1,x),t._tempPickingRay)),o,x,!1,R);return d&&(d.ray=T(t,b,Y,r.c.Identity(),F||null)),d}(this,t,b,Y,o,x,F)},o.e.prototype.pickWithRay=function(t,b,Y,o){return function(t,b,Y,o,x){const F=J(t,(Y=>(t._pickWithRayInverseMatrix||(t._pickWithRayInverseMatrix=r.c.Identity()),Y.invertToRef(t._pickWithRayInverseMatrix),t._cachedRayForTransform||(t._cachedRayForTransform=W.Zero()),W.TransformToRef(b,t._pickWithRayInverseMatrix,t._cachedRayForTransform),t._cachedRayForTransform)),Y,o,!1,x);return F&&(F.ray=b),F}(this,t,b,Y,o)},o.e.prototype.multiPick=function(t,b,Y,o,x){return function(t,b,Y,o,x,F){return m(t,(o=>T(t,b,Y,o,x||null)),o,F)}(this,t,b,Y,o,x)},o.e.prototype.multiPickWithRay=function(t,b,Y){return function(t,b,Y,o){return m(t,(Y=>(t._pickWithRayInverseMatrix||(t._pickWithRayInverseMatrix=r.c.Identity()),Y.invertToRef(t._pickWithRayInverseMatrix),t._cachedRayForTransform||(t._cachedRayForTransform=W.Zero()),W.TransformToRef(b,t._pickWithRayInverseMatrix,t._cachedRayForTransform),t._cachedRayForTransform)),Y,o)}(this,t,b,Y)}},12751:(t,b,Y)=>{"use strict";Y(1144);var o=Y(1497);Y(1199),Y(1315),Y(1045),Y(1549),Y(1511);o.e},11616:(t,b,Y)=>{"use strict";Y.r(b),Y.d(b,{SceneInstrumentation:()=>F});var o=Y(1265),x=Y(1366);class F{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(t){t!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=t,t?(this._onBeforeActiveMeshesEvaluationObserver=this.Se.onBeforeActiveMeshesEvaluationObservable.add((()=>{o.f.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.Se.onAfterActiveMeshesEvaluationObservable.add((()=>{o.f.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.Se.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Se.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(t){t!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=t,t?(this._onBeforeRenderTargetsRenderObserver=this.Se.onBeforeRenderTargetsRenderObservable.add((()=>{o.f.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.Se.onAfterRenderTargetsRenderObservable.add((()=>{o.f.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.Se.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Se.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(t){t!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=t,t?(this._onBeforeParticlesRenderingObserver=this.Se.onBeforeParticlesRenderingObservable.add((()=>{o.f.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.Se.onAfterParticlesRenderingObservable.add((()=>{o.f.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.Se.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Se.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(t){t!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=t,this.Se.spriteManagers&&(t?(this._onBeforeSpritesRenderingObserver=this.Se.onBeforeSpritesRenderingObservable.add((()=>{o.f.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.Se.onAfterSpritesRenderingObservable.add((()=>{o.f.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.Se.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.Se.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(t){t!==this._capturePhysicsTime&&this.Se.onBeforePhysicsObservable&&(this._capturePhysicsTime=t,t?(this._onBeforePhysicsObserver=this.Se.onBeforePhysicsObservable.add((()=>{o.f.StartPerformanceCounter("gb"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.Se.onAfterPhysicsObservable.add((()=>{o.f.EndPerformanceCounter("gb"),this._physicsTime.endMonitoring()}))):(this.Se.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.Se.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(t){t!==this._captureAnimationsTime&&(this._captureAnimationsTime=t,t?this._onAfterAnimationsObserver=this.Se.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.Se.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(t){this._captureFrameTime=t}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(t){this._captureInterFrameTime=t}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(t){t!==this._captureRenderTime&&(this._captureRenderTime=t,t?(this._onBeforeDrawPhaseObserver=this.Se.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),o.f.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.Se.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),o.f.EndPerformanceCounter("Main render")}))):(this.Se.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Se.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(t){t!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=t,t?(this._onBeforeCameraRenderObserver=this.Se.onBeforeCameraRenderObservable.add((t=>{this._cameraRenderTime.beginMonitoring(),o.f.StartPerformanceCounter(`Rendering camera ${t.name}`)})),this._onAfterCameraRenderObserver=this.Se.onAfterCameraRenderObservable.add((t=>{this._cameraRenderTime.endMonitoring(!1),o.f.EndPerformanceCounter(`Rendering camera ${t.name}`)}))):(this.Se.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Se.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.Se.getEngine()._drawCalls}constructor(t){this.Se=t,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new x.d,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new x.d,this._captureFrameTime=!1,this._frameTime=new x.d,this._captureRenderTime=!1,this._renderTime=new x.d,this._captureInterFrameTime=!1,this._interFrameTime=new x.d,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new x.d,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new x.d,this._capturePhysicsTime=!1,this._physicsTime=new x.d,this._captureAnimationsTime=!1,this._animationsTime=new x.d,this._captureCameraRenderTime=!1,this._cameraRenderTime=new x.d,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._onBeforeAnimationsObserver=t.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(o.f.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.Se.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=t.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(o.f.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.ke(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.ke(),this._captureParticlesRenderTime&&this._particlesRenderTime.ke(),this._captureSpritesRenderTime&&this._spritesRenderTime.ke(),this._captureRenderTime&&this._renderTime.ke(),this._captureCameraRenderTime&&this._cameraRenderTime.ke()}))}dispose(){this.Se.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.Se.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Se.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.Se.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Se.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.Se.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.Se.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Se.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.Se.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.Se.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.Se.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Se.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.Se.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.Se.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.Se.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.Se.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Se.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.Se=null}}},12396:(t,b,Y)=>{"use strict";Y.d(b,{e:()=>U});var o=Y(999),x=Y(1001),F=Y(1019),r=Y(11759),R=Y(12365),d=Y(12405),E=Y(1041);r.c.AddNodeConstructor("Light_Type_1",((t,b)=>()=>new U(t,F.l.Zero(),b)));class U extends d.c{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(t){this._shadowFrustumSize=t,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(t){this._shadowOrthoScale=t,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(t){this._orthoLeft=t}get orthoRight(){return this._orthoRight}set orthoRight(t){this._orthoRight=t}get orthoTop(){return this._orthoTop}set orthoTop(t){this._orthoTop=t}get orthoBottom(){return this._orthoBottom}set orthoBottom(t){this._orthoBottom=t}constructor(t,b,Y){super(t,Y),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=b.scale(-1),this.direction=b}getClassName(){return"hb"}getTypeID(){return R.c.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(t,b,Y){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(t):this._setDefaultAutoExtendShadowProjectionMatrix(t,b,Y)}_setDefaultFixedFrustumShadowProjectionMatrix(t){const b=this.va().activeCamera;b&&F.c.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:b._i,void 0!==this.shadowMaxZ?this.shadowMaxZ:b.maxZ,t,this.va().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(t,b,Y){const o=this.va().activeCamera;if(!o)return;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const t=F.l.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let o=Number.MAX_VALUE,x=-Number.MAX_VALUE;for(let r=0;r<Y.length;r++){const R=Y[r];if(!R)continue;const d=R.getBoundingInfo().boundingBox;for(let Y=0;Y<d.vectorsWorld.length;Y++)F.l.TransformCoordinatesToRef(d.vectorsWorld[Y],b,t),t.x<this._orthoLeft&&(this._orthoLeft=t.x),t.y<this._orthoBottom&&(this._orthoBottom=t.y),t.x>this._orthoRight&&(this._orthoRight=t.x),t.y>this._orthoTop&&(this._orthoTop=t.y),this.autoCalcShadowZBounds&&(t.z<o&&(o=t.z),t.z>x&&(x=t.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=o,this._shadowMaxZ=x)}const x=this._orthoRight-this._orthoLeft,r=this._orthoTop-this._orthoBottom,R=void 0!==this.shadowMinZ?this.shadowMinZ:o._i,d=void 0!==this.shadowMaxZ?this.shadowMaxZ:o.maxZ,E=this.va().getEngine().useReverseDepthBuffer;F.c.OrthoOffCenterLHToRef(this._orthoLeft-x*this.shadowOrthoScale,this._orthoRight+x*this.shadowOrthoScale,this._orthoBottom-r*this.shadowOrthoScale,this._orthoTop+r*this.shadowOrthoScale,E?d:R,E?R:d,t,this.va().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(t,b){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,b),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,b),this)}transferToNodeMaterialEffect(t,b){return this.computeTransformedInformation()?(t.setFloat3(b,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(t.setFloat3(b,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(t){const b=this._scene.getEngine();return!b.useReverseDepthBuffer&&b.isNDCHalfZRange?0:1}getDepthMaxZ(t){const b=this._scene.getEngine();return b.useReverseDepthBuffer&&b.isNDCHalfZRange?0:1}prepareLightSpecificDefines(t,b){t["DIRLIGHT"+b]=!0}}(0,o.e)([(0,x.P)()],U.prototype,"shadowFrustumSize",null),(0,o.e)([(0,x.P)()],U.prototype,"shadowOrthoScale",null),(0,o.e)([(0,x.P)()],U.prototype,"autoUpdateExtends",void 0),(0,o.e)([(0,x.P)()],U.prototype,"autoCalcShadowZBounds",void 0),(0,o.e)([(0,x.P)("orthoLeft")],U.prototype,"_orthoLeft",void 0),(0,o.e)([(0,x.P)("orthoRight")],U.prototype,"_orthoRight",void 0),(0,o.e)([(0,x.P)("orthoTop")],U.prototype,"_orthoTop",void 0),(0,o.e)([(0,x.P)("orthoBottom")],U.prototype,"_orthoBottom",void 0),(0,E.d)("BABYLON.DirectionalLight",U)},12685:(t,b,Y)=>{"use strict";Y.d(b,{b:()=>U});var o=Y(999),x=Y(1001),F=Y(1019),r=Y(1229),R=Y(11759),d=Y(12365),E=Y(1041);R.c.AddNodeConstructor("Light_Type_3",((t,b)=>()=>new U(t,F.l.Zero(),b)));class U extends d.c{constructor(t,b,Y){super(t,Y),this.groundColor=new r.d(0,0,0),this.direction=b||F.l.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"jb"}setDirectionToTarget(t){return this.direction=F.l.Normalize(t.fd(F.l.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(t,b){const Y=F.l.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",Y.x,Y.y,Y.z,0,b),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.dj),b),this}transferToNodeMaterialEffect(t,b){const Y=F.l.Normalize(this.direction);return t.setFloat3(b,Y.x,Y.y,Y.z),this}ve(){return this._worldMatrix||(this._worldMatrix=F.c.Identity()),this._worldMatrix}getTypeID(){return d.c.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(t,b){t["HEMILIGHT"+b]=!0}}(0,o.e)([(0,x.h)()],U.prototype,"groundColor",void 0),(0,o.e)([(0,x.L)()],U.prototype,"direction",void 0),(0,E.d)("BABYLON.HemisphericLight",U)},12365:(t,b,Y)=>{"use strict";Y.d(b,{c:()=>p});var o=Y(999),x=Y(1001),F=Y(1019),r=Y(1229),R=Y(11759),d=Y(1294),E=Y(1041),U=Y(1377),C=Y(1224);class p extends R.c{get range(){return this._range}set range(t){this._range=t,this._inverseSquaredRange=1/(this.range*this.range)}get intensityMode(){return this._intensityMode}set intensityMode(t){this._intensityMode=t,this._computePhotometricScale()}get i(){return this._radius}set i(t){this._radius=t,this._computePhotometricScale()}get shadowEnabled(){return this._shadowEnabled}set shadowEnabled(t){this._shadowEnabled!==t&&(this._shadowEnabled=t,this._markMeshesAsLightDirty())}get includedOnlyMeshes(){return this._includedOnlyMeshes}set includedOnlyMeshes(t){this._includedOnlyMeshes=t,this._hookArrayForIncludedOnly(t)}get excludedMeshes(){return this._excludedMeshes}set excludedMeshes(t){this._excludedMeshes=t,this._hookArrayForExcluded(t)}get excludeWithLayerMask(){return this._excludeWithLayerMask}set excludeWithLayerMask(t){this._excludeWithLayerMask=t,this._resyncMeshes()}get includeOnlyWithLayerMask(){return this._includeOnlyWithLayerMask}set includeOnlyWithLayerMask(t){this._includeOnlyWithLayerMask=t,this._resyncMeshes()}get lightmapMode(){return this._lightmapMode}set lightmapMode(t){this._lightmapMode!==t&&(this._lightmapMode=t,this._markMeshesAsLightDirty())}getViewMatrix(t){return null}getProjectionMatrix(t,b){return null}constructor(t,b){super(t,b,!1),this.Nh=new r.d(1,1,1),this.Ie=new r.d(1,1,1),this.falloffType=p.FALLOFF_DEFAULT,this.dj=1,this._range=Number.MAX_VALUE,this._inverseSquaredRange=0,this._photometricScale=1,this._intensityMode=p.INTENSITYMODE_AUTOMATIC,this._radius=1e-5,this.renderPriority=0,this._shadowEnabled=!0,this._excludeWithLayerMask=0,this._includeOnlyWithLayerMask=0,this._lightmapMode=0,this._shadowGenerators=null,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,this._isLight=!0,this.va().addLight(this),this._uniformBuffer=new d.e(this.va().getEngine(),void 0,void 0,t),this._buildUniformLayout(),this.includedOnlyMeshes=[],this.excludedMeshes=[],this._resyncMeshes()}transferTexturesToEffect(t,b){return this}_bindLight(t,b,Y,o){let x=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const F=t.toString();let R=!1;if(this._uniformBuffer.bindToEffect(Y,"Light"+F),this._renderId!==b.getRenderId()||this._lastUseSpecular!==o||!this._uniformBuffer.useUbo){this._renderId=b.getRenderId(),this._lastUseSpecular=o;const t=this.getScaledIntensity();this.transferToEffect(Y,F),this.Nh.scaleToRef(t,r.k.Le[0]),this._uniformBuffer.updateColor4("vLightDiffuse",r.k.Le[0],this.range,F),o&&(this.Ie.scaleToRef(t,r.k.Le[1]),this._uniformBuffer.updateColor4("vLightSpecular",r.k.Le[1],this.i,F)),R=!0}if(this.transferTexturesToEffect(Y,F),b.shadowsEnabled&&this.shadowEnabled&&x){const t=this.getShadowGenerator(b.activeCamera)??this.getShadowGenerator();t&&(t.bindShadowLight(F,Y),R=!0)}R?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()}getClassName(){return"Light"}toString(t){let b="Name: "+this.name;if(b+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(let Y=0;Y<this.animations.length;Y++)b+=", animation[0]: "+this.animations[Y].toString(t);return b}_syncParentEnabledState(){super._syncParentEnabledState(),this.u()||this._resyncMeshes()}zg(t){super.zg(t),this._resyncMeshes()}getShadowGenerator(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===this._shadowGenerators?null:this._shadowGenerators.get(t)??null}getShadowGenerators(){return this._shadowGenerators}getAbsolutePosition(){return F.l.Zero()}canAffectMesh(t){return!t||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(t))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(t))&&((0===this.includeOnlyWithLayerMask||0!==(this.includeOnlyWithLayerMask&t.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&t.layerMask)))}dispose(t){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._shadowGenerators){const t=this._shadowGenerators.values();for(let b=t.next();!0!==b.done;b=t.next()){b.value.dispose()}this._shadowGenerators=null}if(this.va().stopAnimation(this),this._parentContainer){const t=this._parentContainer.lights.indexOf(this);t>-1&&this._parentContainer.lights.splice(t,1),this._parentContainer=null}for(const Y of this.va().meshes)Y._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.va().removeLight(this),super.dispose(t,b)}getTypeID(){return 0}getScaledIntensity(){return this._photometricScale*this.dj}clone(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Y=p.GetConstructorFromName(this.getTypeID(),t,this.va());if(!Y)return null;const o=C.d.Clone(Y,this);return t&&(o.name=t),b&&(o.parent=b),o.zg(this.isEnabled()),this.onClonedObservable.notifyObservers(o),o}serialize(){const t=C.d.Serialize(this);return t.uniqueId=this.uniqueId,t.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(t),this.excludedMeshes.length>0&&(t.excludedMeshesIds=[],this.excludedMeshes.forEach((b=>{t.excludedMeshesIds.push(b.id)}))),this.includedOnlyMeshes.length>0&&(t.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach((b=>{t.includedOnlyMeshesIds.push(b.id)}))),C.d.AppendSerializedAnimations(this,t),t.ranges=this.serializeAnimationRanges(),t.isEnabled=this.isEnabled(),t}static GetConstructorFromName(t,b,Y){const o=R.c.Construct("Light_Type_"+t,b,Y);return o||null}static Parse(t,b){const Y=p.GetConstructorFromName(t.type,t.name,b);if(!Y)return null;const o=C.d.Parse(Y,t,b);if(t.excludedMeshesIds&&(o._excludedMeshesIds=t.excludedMeshesIds),t.includedOnlyMeshesIds&&(o._includedOnlyMeshesIds=t.includedOnlyMeshesIds),void 0!==t.parentId&&(o._waitingParentId=t.parentId),void 0!==t.parentInstanceIndex&&(o._waitingParentInstanceIndex=t.parentInstanceIndex),void 0!==t.falloffType&&(o.falloffType=t.falloffType),void 0!==t.lightmapMode&&(o.lightmapMode=t.lightmapMode),t.animations){for(let b=0;b<t.animations.length;b++){const Y=t.animations[b],x=(0,E.b)("BABYLON.Animation");x&&o.animations.push(x.Parse(Y))}R.c.ParseAnimationRanges(o,t,b)}return t.autoAnimate&&b.beginAnimation(o,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,t.autoAnimateSpeed||1),void 0!==t.isEnabled&&o.zg(t.isEnabled),o}_hookArrayForExcluded(t){var b=this;const Y=t.push;t.push=function(){for(var o=arguments.length,x=new Array(o),F=0;F<o;F++)x[F]=arguments[F];const r=Y.apply(t,x);for(const t of x)t._resyncLightSource(b);return r};const o=t.splice;t.splice=(b,Y)=>{const x=o.apply(t,[b,Y]);for(const t of x)t._resyncLightSource(this);return x};for(const x of t)x._resyncLightSource(this)}_hookArrayForIncludedOnly(t){var b=this;const Y=t.push;t.push=function(){for(var o=arguments.length,x=new Array(o),F=0;F<o;F++)x[F]=arguments[F];const r=Y.apply(t,x);return b._resyncMeshes(),r};const o=t.splice;t.splice=(b,Y)=>{const x=o.apply(t,[b,Y]);return this._resyncMeshes(),x},this._resyncMeshes()}_resyncMeshes(){for(const t of this.va().meshes)t._resyncLightSource(this)}_markMeshesAsLightDirty(){for(const t of this.va().meshes)-1!==t.lightSources.indexOf(this)&&t._markSubMeshesAsLightDirty()}_computePhotometricScale(){this._photometricScale=this._getPhotometricScale(),this.va().resetCachedMaterial()}_getPhotometricScale(){let t=0;const b=this.getTypeID();let Y=this.intensityMode;switch(Y===p.INTENSITYMODE_AUTOMATIC&&(Y=b===p.LIGHTTYPEID_DIRECTIONALLIGHT?p.INTENSITYMODE_ILLUMINANCE:p.INTENSITYMODE_LUMINOUSINTENSITY),b){case p.LIGHTTYPEID_POINTLIGHT:case p.LIGHTTYPEID_SPOTLIGHT:switch(Y){case p.INTENSITYMODE_LUMINOUSPOWER:t=1/(4*Math.PI);break;case p.INTENSITYMODE_LUMINOUSINTENSITY:t=1;break;case p.INTENSITYMODE_LUMINANCE:t=this.i*this.i}break;case p.LIGHTTYPEID_DIRECTIONALLIGHT:switch(Y){case p.INTENSITYMODE_ILLUMINANCE:t=1;break;case p.INTENSITYMODE_LUMINANCE:{let b=this.i;b=Math.max(b,.001);t=2*Math.PI*(1-Math.cos(b));break}}break;case p.LIGHTTYPEID_HEMISPHERICLIGHT:t=1}return t}_reorderLightsInScene(){const t=this.va();0!=this._renderPriority&&(t.requireLightSorting=!0),this.va().sortLightsByPriority()}}p.FALLOFF_DEFAULT=U.e.FALLOFF_DEFAULT,p.FALLOFF_PHYSICAL=U.e.FALLOFF_PHYSICAL,p.FALLOFF_GLTF=U.e.FALLOFF_GLTF,p.FALLOFF_STANDARD=U.e.FALLOFF_STANDARD,p.LIGHTMAP_DEFAULT=U.e.LIGHTMAP_DEFAULT,p.LIGHTMAP_SPECULAR=U.e.LIGHTMAP_SPECULAR,p.LIGHTMAP_SHADOWSONLY=U.e.LIGHTMAP_SHADOWSONLY,p.INTENSITYMODE_AUTOMATIC=U.e.INTENSITYMODE_AUTOMATIC,p.INTENSITYMODE_LUMINOUSPOWER=U.e.INTENSITYMODE_LUMINOUSPOWER,p.INTENSITYMODE_LUMINOUSINTENSITY=U.e.INTENSITYMODE_LUMINOUSINTENSITY,p.INTENSITYMODE_ILLUMINANCE=U.e.INTENSITYMODE_ILLUMINANCE,p.INTENSITYMODE_LUMINANCE=U.e.INTENSITYMODE_LUMINANCE,p.LIGHTTYPEID_POINTLIGHT=U.e.LIGHTTYPEID_POINTLIGHT,p.LIGHTTYPEID_DIRECTIONALLIGHT=U.e.LIGHTTYPEID_DIRECTIONALLIGHT,p.LIGHTTYPEID_SPOTLIGHT=U.e.LIGHTTYPEID_SPOTLIGHT,p.LIGHTTYPEID_HEMISPHERICLIGHT=U.e.LIGHTTYPEID_HEMISPHERICLIGHT,(0,o.e)([(0,x.h)()],p.prototype,"diffuse",void 0),(0,o.e)([(0,x.h)()],p.prototype,"specular",void 0),(0,o.e)([(0,x.P)()],p.prototype,"falloffType",void 0),(0,o.e)([(0,x.P)()],p.prototype,"intensity",void 0),(0,o.e)([(0,x.P)()],p.prototype,"range",null),(0,o.e)([(0,x.P)()],p.prototype,"intensityMode",null),(0,o.e)([(0,x.P)()],p.prototype,"i",null),(0,o.e)([(0,x.P)()],p.prototype,"_renderPriority",void 0),(0,o.e)([(0,x.b)("_reorderLightsInScene")],p.prototype,"renderPriority",void 0),(0,o.e)([(0,x.P)("shadowEnabled")],p.prototype,"_shadowEnabled",void 0),(0,o.e)([(0,x.P)("excludeWithLayerMask")],p.prototype,"_excludeWithLayerMask",void 0),(0,o.e)([(0,x.P)("includeOnlyWithLayerMask")],p.prototype,"_includeOnlyWithLayerMask",void 0),(0,o.e)([(0,x.P)("lightmapMode")],p.prototype,"_lightmapMode",void 0)},12405:(t,b,Y)=>{"use strict";Y.d(b,{c:()=>d});var o=Y(999),x=Y(1001),F=Y(1019),r=Y(12365),R=Y(1564);class d extends r.c{constructor(){super(...arguments),this._needProjectionMatrixCompute=!0,this._viewMatrix=F.c.Identity(),this._projectionMatrix=F.c.Identity()}_setPosition(t){this._position=t}get position(){return this._position}set position(t){this._setPosition(t)}_setDirection(t){this._direction=t}get direction(){return this._direction}set direction(t){this._setDirection(t)}get shadowMinZ(){return this._shadowMinZ}set shadowMinZ(t){this._shadowMinZ=t,this.forceProjectionMatrixCompute()}get shadowMaxZ(){return this._shadowMaxZ}set shadowMaxZ(t){this._shadowMaxZ=t,this.forceProjectionMatrixCompute()}computeTransformedInformation(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=F.l.Zero()),F.l.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=F.l.Zero()),F.l.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)}getDepthScale(){return 50}getShadowDirection(t){return this.transformedDirection?this.transformedDirection:this.direction}getAbsolutePosition(){return this.transformedPosition?this.transformedPosition:this.position}setDirectionToTarget(t){return this.direction=F.l.Normalize(t.fd(this.position)),this.direction}getRotation(){this.direction.normalize();const t=F.l.Cross(this.direction,R.b.Y),b=F.l.Cross(t,this.direction);return F.l.RotationFromAxis(t,b,this.direction)}needCube(){return!1}needProjectionMatrixCompute(){return this._needProjectionMatrixCompute}forceProjectionMatrixCompute(){this._needProjectionMatrixCompute=!0}_initCache(){super._initCache(),this._cache.position=F.l.Zero()}_isSynchronized(){return!!this._cache.position.equals(this.position)}ve(t){return!t&&this.isSynchronized()?(this._currentRenderId=this.va().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.p(this.position),this._worldMatrix||(this._worldMatrix=F.c.Identity()),F.c.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)}getDepthMinZ(t){return void 0!==this.shadowMinZ?this.shadowMinZ:t._i}getDepthMaxZ(t){return void 0!==this.shadowMaxZ?this.shadowMaxZ:t.maxZ}setShadowProjectionMatrix(t,b,Y){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(b,Y,t):this._setDefaultShadowProjectionMatrix(t,b,Y),this}_syncParentEnabledState(){super._syncParentEnabledState(),this.parent&&this.parent.getWorldMatrix||(this.transformedPosition=null,this.transformedDirection=null)}getViewMatrix(t){const b=F.f.ae[0];let Y=this.position;this.computeTransformedInformation()&&(Y=this.transformedPosition),F.l.NormalizeToRef(this.getShadowDirection(t),b),1===Math.abs(F.l.Dot(b,F.l.Up()))&&(b.z=1e-13);const o=F.f.ae[1];return Y.addToRef(b,o),F.c.LookAtLHToRef(Y,o,F.l.Up(),this._viewMatrix),this._viewMatrix}getProjectionMatrix(t,b){return this.setShadowProjectionMatrix(this._projectionMatrix,t??this._viewMatrix,b??[]),this._projectionMatrix}}(0,o.e)([(0,x.L)()],d.prototype,"position",null),(0,o.e)([(0,x.L)()],d.prototype,"direction",null),(0,o.e)([(0,x.P)()],d.prototype,"shadowMinZ",null),(0,o.e)([(0,x.P)()],d.prototype,"shadowMaxZ",null)},11883:(t,b,Y)=>{"use strict";Y.d(b,{b:()=>r,c:()=>F,f:()=>R});const o={},x={};function F(t,b){o[t]=b}function r(t,b){x[t]=b}function R(t){return x[t]?x[t]:null}},11837:(t,b,Y)=>{"use strict";Y.d(b,{c:()=>N,f:()=>z});var o,x=Y(1265),F=Y(1013),r=Y(1260),R=Y(1051),d=Y(1144),E=Y(11779),U=Y(1081),C=Y(1102),p=Y(1072),W=Y(1160);!function(t){t[t.Clean=0]="Clean",t[t.Stop=1]="Stop",t[t.Sync=2]="Sync",t[t.NoSync=3]="NoSync"}(o||(o={}));const T=new F.e,y={};let v=!1;function B(){return y[".babylon"]}function J(t){const b=y[t];return b||(d.b.Warn("Unable to find a plugin to load "+t+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),B())}function m(t,b,Y){let o="Unable to load from "+(t.rawData?"binary data":t.url);return b?o+=`: ${b}`:Y&&(o+=`: ${Y}`),o}function K(t,b,Y,o,x,F,r,R,d){var E;const C="data:"===(p=t.url).substring(0,5)?p.substring(5):null;var p;if(t.rawData&&!r)throw"When using ArrayBufferView to load data the file extension must be provided.";const v=r?J(r):C?function(t){for(const b in y){const Y=y[b].plugin;if(Y.canDirectLoad&&Y.canDirectLoad(t))return y[b]}return B()}(t.url):function(t){const b=t.indexOf("?");-1!==b&&(t=t.substring(0,b));const Y=t.lastIndexOf(".");return J(t.substring(Y,t.length).toLowerCase())}(t.url);if(!v)throw new Error(`No plugin or fallback for ${r??t.url}`);if(!1===(null===d||void 0===d||null===(E=d[v.plugin.name])||void 0===E?void 0:E.enabled))throw new Error(`The '${v.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(t.rawData&&!v.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(t=>{if(v.plugin.createPlugin){const b=v.plugin.createPlugin(d??{});return b instanceof Promise?(b.then(t).catch((t=>{x("Error instantiating plugin.",t)})),null):(t(b),b)}return t(v.plugin),v.plugin})((d=>{var E;if(!d)throw`The loader plugin corresponding to the '${r}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(T.notifyObservers(d),C&&(d.canDirectLoad&&d.canDirectLoad(t.url)||!(0,U.f)(t.url))){if(d.directLoad){const t=d.directLoad(b,C);t instanceof Promise?t.then((t=>{Y(d,t)})).catch((t=>{x("Error in directLoad of _loadData: "+t,t)})):Y(d,t)}else Y(d,C);return}const p=v.isBinary,y=(t,o)=>{b.u?x("Scene has been disposed"):Y(d,t,o)};let B=null,J=!1;null===(E=d.le)||void 0===E||E.add((()=>{J=!0,B&&(B.abort(),B=null),F()}));const m=()=>{if(J)return;const Y=(t,b)=>{x(null===t||void 0===t?void 0:t.statusText,b)};if(!d.loadFile&&t.rawData)throw"Plugin does not support loading ArrayBufferView.";B=d.loadFile?d.loadFile(b,t.rawData||t.file||t.url,t.rootUrl,y,o,p,Y,R):b._loadFile(t.file||t.url,y,o,!0,p,Y)},K=b.getEngine();let L=K.enableOfflineSupport;if(L){let Y=!1;for(const o of b.disableOfflineSupportExceptionRules)if(o.test(t.url)){Y=!0;break}L=!Y}L&&W.c.OfflineProviderFactory?b.offlineProvider=W.c.OfflineProviderFactory(t.url,m,K.disableManifestCheck):m()}))}function L(t,b){let Y,o,F=null,r=null;if(b)if(b.name)Y=`file:${b.name}`,o=b.name,F=b;else if(ArrayBuffer.isView(b))Y="",o=(0,p.c)(),r=b;else if(b.startsWith("data:"))Y=b,o="";else if(t){const F=b;if("/"===F.substring(0,1))return x.f.Error("Wrong sceneFilename parameter"),null;Y=t+F,o=F}else Y=b,o=x.f.GetFilename(b),t=x.f.GetFolderPath(b);else Y=t,o=x.f.GetFilename(t),t=x.f.GetFolderPath(t);return{url:Y,rootUrl:t,name:o,file:F,rawData:r}}function z(t){if("string"===typeof t.extensions){const b=t.extensions;y[b.toLowerCase()]={plugin:t,isBinary:!1}}else{const b=t.extensions;Object.keys(b).forEach((Y=>{y[Y.toLowerCase()]={plugin:t,isBinary:b[Y].isBinary}}))}}function S(t,b){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:R.d.LastCreatedScene,x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,F=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,E=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,U=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",p=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!o)return d.b.Error("No scene available to import mesh to"),null;const W=L(b,Y);if(!W)return null;const T={};o.addPendingData(T);const y=()=>{o.removePendingData(T)},v=(t,b)=>{const Y=m(W,t,b);r?r(o,Y,new C.k(Y,C.g.SceneLoaderError,b)):d.b.Error(Y),y()},B=F?t=>{try{F(t)}catch(b){v("Error in onProgress callback: "+b,b)}}:void 0,J=(t,b,Y,F,r,R,d,E)=>{if(o.importedMeshesFiles.push(W.url),x)try{x(t,b,Y,F,r,R,d,E)}catch(U){v("Error in onSuccess callback: "+U,U)}o.removePendingData(T)};return K(W,o,((b,Y,x)=>{if(b.rewriteRootURL&&(W.rootUrl=b.rewriteRootURL(W.rootUrl,x)),b.importMesh){const x=[],F=[],r=[];if(!b.importMesh(t,o,Y,W.rootUrl,x,F,r,v))return;o.loadingPluginName=b.name,J(x,F,r,[],[],[],[],[])}else{b.importMeshAsync(t,o,Y,W.rootUrl,B,W.name).then((t=>{o.loadingPluginName=b.name,J(t.meshes,t.ue,t.skeletons,t.animationGroups,t.transformNodes,t.geometries,t.lights,t.spriteManagers)})).catch((t=>{v(t.message,t)}))}}),B,v,y,E,U,p)}function e(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:R.d.LastCreatedEngine,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,E=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,U=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",C=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};return Y?D(t,b,new r.e(Y),o,F,d,E,U,C):(x.f.Error("No engine available"),null)}function g(t,b,Y,o,x,F,r){return new Promise(((R,d)=>{e(t,b,Y,(t=>{R(t)}),o,((t,b,Y)=>{d(Y||new Error(b))}),x,F,r)}))}function D(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:R.d.LastCreatedScene,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,F=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,U=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",p=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!Y)return d.b.Error("No scene available to append to"),null;const W=L(t,b);if(!W)return null;const T={};Y.addPendingData(T);const y=()=>{Y.removePendingData(T)};E.e.ShowLoadingScreen&&!v&&(v=!0,Y.getEngine().displayLoadingUI(),Y.executeWhenReady((()=>{Y.getEngine().hideLoadingUI(),v=!1})));const B=(t,b)=>{const o=m(W,t,b);F?F(Y,o,new C.k(o,C.g.SceneLoaderError,b)):d.b.Error(o),y()},J=x?t=>{try{x(t)}catch(b){B("Error in onProgress callback",b)}}:void 0,z=()=>{if(o)try{o(Y)}catch(t){B("Error in onSuccess callback",t)}Y.removePendingData(T)};return K(W,Y,((t,b)=>{if(t.load){if(!t.load(Y,b,W.rootUrl,B))return;Y.loadingPluginName=t.name,z()}else{t.loadAsync(Y,b,W.rootUrl,J,W.name).then((()=>{Y.loadingPluginName=t.name,z()})).catch((t=>{B(t.message,t)}))}}),J,B,y,r,U,p)}function H(t,b,Y,o,x,F,r){return new Promise(((R,d)=>{D(t,b,Y,(t=>{R(t)}),o,((t,b,Y)=>{d(Y||new Error(b))}),x,F,r)}))}function f(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:R.d.LastCreatedScene,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,F=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,E=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",U=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!Y)return d.b.Error("No scene available to load asset container to"),null;const p=L(t,b);if(!p)return null;const W={};Y.addPendingData(W);const T=()=>{Y.removePendingData(W)},y=(t,b)=>{const o=m(p,t,b);F?F(Y,o,new C.k(o,C.g.SceneLoaderError,b)):d.b.Error(o),T()},v=x?t=>{try{x(t)}catch(b){y("Error in onProgress callback",b)}}:void 0,B=t=>{if(o)try{o(t)}catch(b){y("Error in onSuccess callback",b)}Y.removePendingData(W)};return K(p,Y,((t,b)=>{if(t.loadAssetContainer){const o=t.loadAssetContainer(Y,b,p.rootUrl,y);if(!o)return;o.populateRootNodes(),Y.loadingPluginName=t.name,B(o)}else if(t.loadAssetContainerAsync){t.loadAssetContainerAsync(Y,b,p.rootUrl,v,p.name).then((b=>{b.populateRootNodes(),Y.loadingPluginName=t.name,B(b)})).catch((t=>{y(t.message,t)}))}else y("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),v,y,T,r,E,U)}function n(t,b,Y,o,x,F,r){return new Promise(((R,d)=>{f(t,b,Y,(t=>{R(t)}),o,((t,b,Y)=>{d(Y||new Error(b))}),x,F,r)}))}function X(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:R.d.LastCreatedScene,o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,F=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,E=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,U=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,C=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,p=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",W=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!Y)return void d.b.Error("No scene available to load animations to");if(o){for(const t of Y.animatables)t.reset();Y.stopAllAnimations(),Y.animationGroups.slice().forEach((t=>{t.dispose()}));Y.getNodes().forEach((t=>{t.animations&&(t.animations=[])}))}else switch(x){case 0:Y.animationGroups.slice().forEach((t=>{t.dispose()}));break;case 1:Y.animationGroups.forEach((t=>{t.stop()}));break;case 2:Y.animationGroups.forEach((t=>{t.reset(),t.restart()}));break;case 3:break;default:return void d.b.Error("Unknown animation group loading mode value '"+x+"'")}const T=Y.animatables.length;f(t,b,Y,(t=>{t.mergeAnimationsTo(Y,Y.animatables.slice(T),F),t.dispose(),Y.onAnimationFileImportedObservable.notifyObservers(Y),r&&r(Y)}),E,U,C,p,W)}function Q(t,b,Y,o,x,F,r,R,d,E){return new Promise(((U,C)=>{X(t,b,Y,o,x,F,(t=>{U(t)}),r,((t,b,Y)=>{C(Y||new Error(b))}),R,d,E)}))}class N{static get ForceFullSceneLoadingForIncremental(){return E.e.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(t){E.e.ForceFullSceneLoadingForIncremental=t}static get ShowLoadingScreen(){return E.e.ShowLoadingScreen}static set ShowLoadingScreen(t){E.e.ShowLoadingScreen=t}static get loggingLevel(){return E.e.loggingLevel}static set loggingLevel(t){E.e.loggingLevel=t}static get CleanBoneMatrixWeights(){return E.e.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(t){E.e.CleanBoneMatrixWeights=t}static GetDefaultPlugin(){return B()}static GetPluginForExtension(t){var b;return null===(b=J(t))||void 0===b?void 0:b.plugin}static IsPluginForExtensionAvailable(t){return function(t){return!!y[t]}(t)}static RegisterPlugin(t){z(t)}static ImportMesh(t,b,Y,o,x,F,r,R,d){return S(t,b,Y,o,x,F,r,R,d)}static ImportMeshAsync(t,b,Y,o,x,F,r){return function(t,b,Y,o,x,F,r,R){return new Promise(((d,E)=>{S(t,b,Y,o,((t,b,Y,o,x,F,r,R)=>{d({meshes:t,ue:b,skeletons:Y,animationGroups:o,transformNodes:x,geometries:F,lights:r,spriteManagers:R})}),x,((t,b,Y)=>{E(Y||new Error(b))}),F,r,R)}))}(t,b,Y,o,x,F,r)}static Load(t,b,Y,o,x,F,r,R){return e(t,b,Y,o,x,F,r,R)}static LoadAsync(t,b,Y,o,x,F){return g(t,b,Y,o,x,F)}static Append(t,b,Y,o,x,F,r,R){return D(t,b,Y,o,x,F,r,R)}static AppendAsync(t,b,Y,o,x,F){return H(t,b,Y,o,x,F)}static LoadAssetContainer(t,b,Y,o,x,F,r,R){return f(t,b,Y,o,x,F,r,R)}static LoadAssetContainerAsync(t,b,Y,o,x,F){return n(t,b,Y,o,x,F)}static ImportAnimations(t,b,Y,o,x,F,r,R,d,E,U){X(t,b,Y,o,x,F,r,R,d,E,U)}static ImportAnimationsAsync(t,b,Y,o,x,F,r,R,d,E,U){return Q(t,b,Y,o,x,F,R,E,U)}}N.NO_LOGGING=0,N.MINIMAL_LOGGING=1,N.SUMMARY_LOGGING=2,N.DETAILED_LOGGING=3,N.OnPluginActivatedObservable=T},11779:(t,b,Y)=>{"use strict";Y.d(b,{e:()=>o});class o{static get ForceFullSceneLoadingForIncremental(){return o._ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(t){o._ForceFullSceneLoadingForIncremental=t}static get ShowLoadingScreen(){return o._ShowLoadingScreen}static set ShowLoadingScreen(t){o._ShowLoadingScreen=t}static get loggingLevel(){return o._LoggingLevel}static set loggingLevel(t){o._LoggingLevel=t}static get CleanBoneMatrixWeights(){return o._CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(t){o._CleanBoneMatrixWeights=t}}o._ForceFullSceneLoadingForIncremental=!1,o._ShowLoadingScreen=!0,o._CleanBoneMatrixWeights=!1,o._LoggingLevel=0},12346:(t,b,Y)=>{"use strict";Y.d(b,{e:()=>c});var o=Y(999),x=Y(1001),F=Y(1144),r=Y(1252),R=Y(12340),d=Y(1260),E=Y(1019),U=Y(1307),C=Y(1452),p=Y(1481);class W extends C.b{constructor(){super(...arguments),this.BRDF_V_HEIGHT_CORRELATED=!1,this.MS_BRDF_ENERGY_CONSERVATION=!1,this.SPHERICAL_HARMONICS=!1,this.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1}}class T extends p.c{_markAllSubMeshesAsMiscDirty(){this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(t){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(t,"PBRBRDF",90,new W,b),this._useEnergyConservation=T.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=T.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=T.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=T.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=T.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=T.DEFAULT_USE_SPHERICAL_HARMONICS,this._useSpecularGlossinessInputEnergyConservation=T.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this.useSpecularGlossinessInputEnergyConservation=T.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this._internalMarkAllSubMeshesAsMiscDirty=t._dirtyCallbacks[16],this._enable(!0)}prepareDefines(t){t.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,t.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,t.SPHERICAL_HARMONICS=this._useSphericalHarmonics,t.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation}getClassName(){return"PBRBRDFConfiguration"}}T.DEFAULT_USE_ENERGY_CONSERVATION=!0,T.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,T.DEFAULT_USE_SPHERICAL_HARMONICS=!0,T.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0,(0,o.e)([(0,x.P)(),(0,x.b)("_markAllSubMeshesAsMiscDirty")],T.prototype,"useEnergyConservation",void 0),(0,o.e)([(0,x.P)(),(0,x.b)("_markAllSubMeshesAsMiscDirty")],T.prototype,"useSmithVisibilityHeightCorrelated",void 0),(0,o.e)([(0,x.P)(),(0,x.b)("_markAllSubMeshesAsMiscDirty")],T.prototype,"useSphericalHarmonics",void 0),(0,o.e)([(0,x.P)(),(0,x.b)("_markAllSubMeshesAsMiscDirty")],T.prototype,"useSpecularGlossinessInputEnergyConservation",void 0);var y=Y(1385),v=Y(1229),B=Y(1280),J=Y(1394),m=Y(1461),K=Y(990),L=Y(1463),z=(Y(10676),Y(1469)),S=Y(1438);class e extends C.b{constructor(){super(...arguments),this.CLEARCOAT=!1,this.CLEARCOAT_DEFAULTIOR=!1,this.CLEARCOAT_TEXTURE=!1,this.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this.CLEARCOAT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,this.CLEARCOAT_BUMP=!1,this.CLEARCOAT_BUMPDIRECTUV=0,this.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,this.CLEARCOAT_REMAP_F0=!1,this.CLEARCOAT_TINT=!1,this.CLEARCOAT_TINT_TEXTURE=!1,this.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TINT_GAMMATEXTURE=!1}}class g extends p.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(t){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(t,"PBRClearCoat",100,new e,b),this._isEnabled=!1,this.isEnabled=!1,this.dj=1,this.roughness=0,this._indexOfRefraction=g._DefaultIndexOfRefraction,this.indexOfRefraction=g._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._textureRoughness=null,this.textureRoughness=null,this._remapF0OnInterfaceChange=!0,this.remapF0OnInterfaceChange=!0,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=v.d.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=t._dirtyCallbacks[1]}isReadyForSubMesh(t,b,Y){if(!this._isEnabled)return!0;const o=this._material._disableBumpMap;if(t._areTexturesDirty&&b.texturesEnabled){if(this._texture&&L.e.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&L.e.ClearCoatTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1;if(Y.getCaps().standardDerivatives&&this._bumpTexture&&L.e.ClearCoatBumpTextureEnabled&&!o&&!this._bumpTexture.isReady())return!1;if(this._isTintEnabled&&this._tintTexture&&L.e.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(t,b){this._isEnabled?(t.CLEARCOAT=!0,t.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,t.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange,t._areTexturesDirty&&b.texturesEnabled&&(this._texture&&L.e.ClearCoatTextureEnabled?(0,S.P)(this._texture,t,"CLEARCOAT_TEXTURE"):t.CLEARCOAT_TEXTURE=!1,this._textureRoughness&&L.e.ClearCoatTextureEnabled?(0,S.P)(this._textureRoughness,t,"CLEARCOAT_TEXTURE_ROUGHNESS"):t.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this._bumpTexture&&L.e.ClearCoatBumpTextureEnabled?(0,S.P)(this._bumpTexture,t,"CLEARCOAT_BUMP"):t.CLEARCOAT_BUMP=!1,t.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===g._DefaultIndexOfRefraction,this._isTintEnabled?(t.CLEARCOAT_TINT=!0,this._tintTexture&&L.e.ClearCoatTintTextureEnabled?((0,S.P)(this._tintTexture,t,"CLEARCOAT_TINT_TEXTURE"),t.CLEARCOAT_TINT_GAMMATEXTURE=this._tintTexture.gammaSpace):t.CLEARCOAT_TINT_TEXTURE=!1):(t.CLEARCOAT_TINT=!1,t.CLEARCOAT_TINT_TEXTURE=!1))):(t.CLEARCOAT=!1,t.CLEARCOAT_TEXTURE=!1,t.CLEARCOAT_TEXTURE_ROUGHNESS=!1,t.CLEARCOAT_BUMP=!1,t.CLEARCOAT_TINT=!1,t.CLEARCOAT_TINT_TEXTURE=!1,t.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,t.CLEARCOAT_DEFAULTIOR=!1,t.CLEARCOAT_TEXTUREDIRECTUV=0,t.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,t.CLEARCOAT_BUMPDIRECTUV=0,t.CLEARCOAT_REMAP_F0=!1,t.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,t.CLEARCOAT_TINT_GAMMATEXTURE=!1)}bindForSubMesh(t,b,Y,o){if(!this._isEnabled)return;const x=o.materialDefines,F=this._material.isFrozen,r=this._material._disableBumpMap,R=this._material._invertNormalMapX,d=this._material._invertNormalMapY;if(!t.useUbo||!F||!t.isSync){var E,U,C,p;if((this._texture||this._textureRoughness)&&L.e.ClearCoatTextureEnabled)t.updateFloat4("vClearCoatInfos",(null===(E=this._texture)||void 0===E?void 0:E.coordinatesIndex)??0,(null===(U=this._texture)||void 0===U?void 0:U.level)??0,(null===(C=this._textureRoughness)||void 0===C?void 0:C.coordinatesIndex)??0,(null===(p=this._textureRoughness)||void 0===p?void 0:p.level)??0),this._texture&&(0,S.v)(this._texture,t,"clearCoat"),this._textureRoughness&&!x.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,S.v)(this._textureRoughness,t,"clearCoatRoughness");this._bumpTexture&&Y.getCaps().standardDerivatives&&L.e.ClearCoatTextureEnabled&&!r&&(t.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),(0,S.v)(this._bumpTexture,t,"clearCoatBump"),b._mirroredCameraPosition?t.updateFloat2("vClearCoatTangentSpaceParams",R?1:-1,d?1:-1):t.updateFloat2("vClearCoatTangentSpaceParams",R?-1:1,d?-1:1)),this._tintTexture&&L.e.ClearCoatTintTextureEnabled&&(t.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),(0,S.v)(this._tintTexture,t,"clearCoatTint")),t.updateFloat2("vClearCoatParams",this.dj,this.roughness);const o=1-this._indexOfRefraction,F=1+this._indexOfRefraction,W=Math.pow(-o/F,2),T=1/this._indexOfRefraction;t.updateFloat4("vClearCoatRefractionParams",W,T,o,F),this._isTintEnabled&&(t.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),t.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}b.texturesEnabled&&(this._texture&&L.e.ClearCoatTextureEnabled&&t.setTexture("clearCoatSampler",this._texture),this._textureRoughness&&!x.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&L.e.ClearCoatTextureEnabled&&t.setTexture("clearCoatRoughnessSampler",this._textureRoughness),this._bumpTexture&&Y.getCaps().standardDerivatives&&L.e.ClearCoatBumpTextureEnabled&&!r&&t.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&L.e.ClearCoatTintTextureEnabled&&t.setTexture("clearCoatTintSampler",this._tintTexture))}hasTexture(t){return this._texture===t||(this._textureRoughness===t||(this._bumpTexture===t||this._tintTexture===t))}getActiveTextures(t){this._texture&&t.push(this._texture),this._textureRoughness&&t.push(this._textureRoughness),this._bumpTexture&&t.push(this._bumpTexture),this._tintTexture&&t.push(this._tintTexture)}getAnimatables(t){this._texture&&this._texture.animations&&this._texture.animations.length>0&&t.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&t.push(this._textureRoughness),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&t.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&t.push(this._tintTexture)}dispose(t){var b,Y,o,x;t&&(null===(b=this._texture)||void 0===b||b.dispose(),null===(Y=this._textureRoughness)||void 0===Y||Y.dispose(),null===(o=this._bumpTexture)||void 0===o||o.dispose(),null===(x=this._tintTexture)||void 0===x||x.dispose())}getClassName(){return"PBRClearCoatConfiguration"}addFallbacks(t,b,Y){return t.CLEARCOAT_BUMP&&b.addFallback(Y++,"CLEARCOAT_BUMP"),t.CLEARCOAT_TINT&&b.addFallback(Y++,"CLEARCOAT_TINT"),t.CLEARCOAT&&b.addFallback(Y++,"CLEARCOAT"),Y}getSamplers(t){t.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler")}getUniforms(){return{ubo:[{name:"vClearCoatParams",size:2,type:"vec2"},{name:"vClearCoatRefractionParams",size:4,type:"vec4"},{name:"vClearCoatInfos",size:4,type:"vec4"},{name:"clearCoatMatrix",size:16,type:"mat4"},{name:"clearCoatRoughnessMatrix",size:16,type:"mat4"},{name:"vClearCoatBumpInfos",size:2,type:"vec2"},{name:"vClearCoatTangentSpaceParams",size:2,type:"vec2"},{name:"clearCoatBumpMatrix",size:16,type:"mat4"},{name:"vClearCoatTintParams",size:4,type:"vec4"},{name:"clearCoatColorAtDistance",size:1,type:"float"},{name:"vClearCoatTintInfos",size:2,type:"vec2"},{name:"clearCoatTintMatrix",size:16,type:"mat4"}]}}}g._DefaultIndexOfRefraction=1.5,(0,o.e)([(0,x.P)(),(0,x.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"isEnabled",void 0),(0,o.e)([(0,x.P)()],g.prototype,"intensity",void 0),(0,o.e)([(0,x.P)()],g.prototype,"roughness",void 0),(0,o.e)([(0,x.P)(),(0,x.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"indexOfRefraction",void 0),(0,o.e)([(0,x.I)(),(0,x.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"texture",void 0),(0,o.e)([(0,x.P)(),(0,x.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"useRoughnessFromMainTexture",void 0),(0,o.e)([(0,x.I)(),(0,x.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"textureRoughness",void 0),(0,o.e)([(0,x.P)(),(0,x.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"remapF0OnInterfaceChange",void 0),(0,o.e)([(0,x.I)(),(0,x.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"bumpTexture",void 0),(0,o.e)([(0,x.P)(),(0,x.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"isTintEnabled",void 0),(0,o.e)([(0,x.h)()],g.prototype,"tintColor",void 0),(0,o.e)([(0,x.P)()],g.prototype,"tintColorAtDistance",void 0),(0,o.e)([(0,x.P)()],g.prototype,"tintThickness",void 0),(0,o.e)([(0,x.I)(),(0,x.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"tintTexture",void 0);class D extends C.b{constructor(){super(...arguments),this.IRIDESCENCE=!1,this.IRIDESCENCE_TEXTURE=!1,this.IRIDESCENCE_TEXTUREDIRECTUV=0,this.IRIDESCENCE_THICKNESS_TEXTURE=!1,this.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0}}class H extends p.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(t){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(t,"PBRIridescence",110,new D,b),this._isEnabled=!1,this.isEnabled=!1,this.dj=1,this.minimumThickness=H._DefaultMinimumThickness,this.maximumThickness=H._DefaultMaximumThickness,this.indexOfRefraction=H._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._thicknessTexture=null,this.thicknessTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=t._dirtyCallbacks[1]}isReadyForSubMesh(t,b){if(!this._isEnabled)return!0;if(t._areTexturesDirty&&b.texturesEnabled){if(this._texture&&L.e.IridescenceTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._thicknessTexture&&L.e.IridescenceTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(t,b){this._isEnabled?(t.IRIDESCENCE=!0,t._areTexturesDirty&&b.texturesEnabled&&(this._texture&&L.e.IridescenceTextureEnabled?(0,S.P)(this._texture,t,"IRIDESCENCE_TEXTURE"):t.IRIDESCENCE_TEXTURE=!1,this._thicknessTexture&&L.e.IridescenceTextureEnabled?(0,S.P)(this._thicknessTexture,t,"IRIDESCENCE_THICKNESS_TEXTURE"):t.IRIDESCENCE_THICKNESS_TEXTURE=!1)):(t.IRIDESCENCE=!1,t.IRIDESCENCE_TEXTURE=!1,t.IRIDESCENCE_THICKNESS_TEXTURE=!1,t.IRIDESCENCE_TEXTUREDIRECTUV=0,t.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0)}bindForSubMesh(t,b){if(!this._isEnabled)return;const Y=this._material.isFrozen;if(!t.useUbo||!Y||!t.isSync){var o,x,F,r;if((this._texture||this._thicknessTexture)&&L.e.IridescenceTextureEnabled)t.updateFloat4("vIridescenceInfos",(null===(o=this._texture)||void 0===o?void 0:o.coordinatesIndex)??0,(null===(x=this._texture)||void 0===x?void 0:x.level)??0,(null===(F=this._thicknessTexture)||void 0===F?void 0:F.coordinatesIndex)??0,(null===(r=this._thicknessTexture)||void 0===r?void 0:r.level)??0),this._texture&&(0,S.v)(this._texture,t,"iridescence"),this._thicknessTexture&&(0,S.v)(this._thicknessTexture,t,"iridescenceThickness");t.updateFloat4("vIridescenceParams",this.dj,this.indexOfRefraction,this.minimumThickness,this.maximumThickness)}b.texturesEnabled&&(this._texture&&L.e.IridescenceTextureEnabled&&t.setTexture("iridescenceSampler",this._texture),this._thicknessTexture&&L.e.IridescenceTextureEnabled&&t.setTexture("iridescenceThicknessSampler",this._thicknessTexture))}hasTexture(t){return this._texture===t||this._thicknessTexture===t}getActiveTextures(t){this._texture&&t.push(this._texture),this._thicknessTexture&&t.push(this._thicknessTexture)}getAnimatables(t){this._texture&&this._texture.animations&&this._texture.animations.length>0&&t.push(this._texture),this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&t.push(this._thicknessTexture)}dispose(t){var b,Y;t&&(null===(b=this._texture)||void 0===b||b.dispose(),null===(Y=this._thicknessTexture)||void 0===Y||Y.dispose())}getClassName(){return"PBRIridescenceConfiguration"}addFallbacks(t,b,Y){return t.IRIDESCENCE&&b.addFallback(Y++,"IRIDESCENCE"),Y}getSamplers(t){t.push("iridescenceSampler","iridescenceThicknessSampler")}getUniforms(){return{ubo:[{name:"vIridescenceParams",size:4,type:"vec4"},{name:"vIridescenceInfos",size:4,type:"vec4"},{name:"iridescenceMatrix",size:16,type:"mat4"},{name:"iridescenceThicknessMatrix",size:16,type:"mat4"}]}}}H._DefaultMinimumThickness=100,H._DefaultMaximumThickness=400,H._DefaultIndexOfRefraction=1.3,(0,o.e)([(0,x.P)(),(0,x.b)("_markAllSubMeshesAsTexturesDirty")],H.prototype,"isEnabled",void 0),(0,o.e)([(0,x.P)()],H.prototype,"intensity",void 0),(0,o.e)([(0,x.P)()],H.prototype,"minimumThickness",void 0),(0,o.e)([(0,x.P)()],H.prototype,"maximumThickness",void 0),(0,o.e)([(0,x.P)()],H.prototype,"indexOfRefraction",void 0),(0,o.e)([(0,x.I)(),(0,x.b)("_markAllSubMeshesAsTexturesDirty")],H.prototype,"texture",void 0),(0,o.e)([(0,x.I)(),(0,x.b)("_markAllSubMeshesAsTexturesDirty")],H.prototype,"thicknessTexture",void 0);class f extends C.b{constructor(){super(...arguments),this.ANISOTROPIC=!1,this.ANISOTROPIC_TEXTURE=!1,this.ANISOTROPIC_TEXTUREDIRECTUV=0,this.ANISOTROPIC_LEGACY=!1,this.MAINUV1=!1}}class n extends p.c{set angle(t){this.direction.x=Math.cos(t),this.direction.y=Math.sin(t)}get angle(){return Math.atan2(this.direction.y,this.direction.x)}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markAllSubMeshesAsMiscDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(t){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(t,"PBRAnisotropic",110,new f,b),this._isEnabled=!1,this.isEnabled=!1,this.dj=1,this.direction=new E.i(1,0),this._texture=null,this.texture=null,this._legacy=!1,this.legacy=!1,this._internalMarkAllSubMeshesAsTexturesDirty=t._dirtyCallbacks[1],this._internalMarkAllSubMeshesAsMiscDirty=t._dirtyCallbacks[16]}isReadyForSubMesh(t,b){return!this._isEnabled||!(t._areTexturesDirty&&b.texturesEnabled&&this._texture&&L.e.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())}prepareDefinesBeforeAttributes(t,b,Y){this._isEnabled?(t.ANISOTROPIC=this._isEnabled,this._isEnabled&&!Y.isVerticesDataPresent(U.e.TangentKind)&&(t._needUVs=!0,t.MAINUV1=!0),t._areTexturesDirty&&b.texturesEnabled&&(this._texture&&L.e.AnisotropicTextureEnabled?(0,S.P)(this._texture,t,"ANISOTROPIC_TEXTURE"):t.ANISOTROPIC_TEXTURE=!1),t._areMiscDirty&&(t.ANISOTROPIC_LEGACY=this._legacy)):(t.ANISOTROPIC=!1,t.ANISOTROPIC_TEXTURE=!1,t.ANISOTROPIC_TEXTUREDIRECTUV=0,t.ANISOTROPIC_LEGACY=!1)}bindForSubMesh(t,b){if(!this._isEnabled)return;const Y=this._material.isFrozen;t.useUbo&&Y&&t.isSync||(this._texture&&L.e.AnisotropicTextureEnabled&&(t.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),(0,S.v)(this._texture,t,"anisotropy")),t.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.dj)),b.texturesEnabled&&this._texture&&L.e.AnisotropicTextureEnabled&&t.setTexture("anisotropySampler",this._texture)}hasTexture(t){return this._texture===t}getActiveTextures(t){this._texture&&t.push(this._texture)}getAnimatables(t){this._texture&&this._texture.animations&&this._texture.animations.length>0&&t.push(this._texture)}dispose(t){t&&this._texture&&this._texture.dispose()}getClassName(){return"PBRAnisotropicConfiguration"}addFallbacks(t,b,Y){return t.ANISOTROPIC&&b.addFallback(Y++,"ANISOTROPIC"),Y}getSamplers(t){t.push("anisotropySampler")}getUniforms(){return{ubo:[{name:"vAnisotropy",size:3,type:"vec3"},{name:"vAnisotropyInfos",size:2,type:"vec2"},{name:"anisotropyMatrix",size:16,type:"mat4"}]}}parse(t,b,Y){super.parse(t,b,Y),void 0===t.legacy&&(this.legacy=!0)}}(0,o.e)([(0,x.P)(),(0,x.b)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"isEnabled",void 0),(0,o.e)([(0,x.P)()],n.prototype,"intensity",void 0),(0,o.e)([(0,x.K)()],n.prototype,"direction",void 0),(0,o.e)([(0,x.I)(),(0,x.b)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"texture",void 0),(0,o.e)([(0,x.P)(),(0,x.b)("_markAllSubMeshesAsMiscDirty")],n.prototype,"legacy",void 0);class X extends C.b{constructor(){super(...arguments),this.SHEEN=!1,this.SHEEN_TEXTURE=!1,this.SHEEN_GAMMATEXTURE=!1,this.SHEEN_TEXTURE_ROUGHNESS=!1,this.SHEEN_TEXTUREDIRECTUV=0,this.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0,this.SHEEN_LINKWITHALBEDO=!1,this.SHEEN_ROUGHNESS=!1,this.SHEEN_ALBEDOSCALING=!1,this.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1}}class Q extends p.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(t){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(t,"Sheen",120,new X,b),this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.dj=1,this.color=v.d.White(),this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._roughness=null,this.roughness=null,this._textureRoughness=null,this.textureRoughness=null,this._albedoScaling=!1,this.albedoScaling=!1,this._internalMarkAllSubMeshesAsTexturesDirty=t._dirtyCallbacks[1]}isReadyForSubMesh(t,b){if(!this._isEnabled)return!0;if(t._areTexturesDirty&&b.texturesEnabled){if(this._texture&&L.e.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&L.e.SheenTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(t,b){this._isEnabled?(t.SHEEN=!0,t.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,t.SHEEN_ROUGHNESS=null!==this._roughness,t.SHEEN_ALBEDOSCALING=this._albedoScaling,t.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,t._areTexturesDirty&&b.texturesEnabled&&(this._texture&&L.e.SheenTextureEnabled?((0,S.P)(this._texture,t,"SHEEN_TEXTURE"),t.SHEEN_GAMMATEXTURE=this._texture.gammaSpace):t.SHEEN_TEXTURE=!1,this._textureRoughness&&L.e.SheenTextureEnabled?(0,S.P)(this._textureRoughness,t,"SHEEN_TEXTURE_ROUGHNESS"):t.SHEEN_TEXTURE_ROUGHNESS=!1)):(t.SHEEN=!1,t.SHEEN_TEXTURE=!1,t.SHEEN_TEXTURE_ROUGHNESS=!1,t.SHEEN_LINKWITHALBEDO=!1,t.SHEEN_ROUGHNESS=!1,t.SHEEN_ALBEDOSCALING=!1,t.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,t.SHEEN_GAMMATEXTURE=!1,t.SHEEN_TEXTUREDIRECTUV=0,t.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0)}bindForSubMesh(t,b,Y,o){if(!this._isEnabled)return;const x=o.materialDefines,F=this._material.isFrozen;if(!t.useUbo||!F||!t.isSync){var r,R,d,E;if((this._texture||this._textureRoughness)&&L.e.SheenTextureEnabled)t.updateFloat4("vSheenInfos",(null===(r=this._texture)||void 0===r?void 0:r.coordinatesIndex)??0,(null===(R=this._texture)||void 0===R?void 0:R.level)??0,(null===(d=this._textureRoughness)||void 0===d?void 0:d.coordinatesIndex)??0,(null===(E=this._textureRoughness)||void 0===E?void 0:E.level)??0),this._texture&&(0,S.v)(this._texture,t,"sheen"),this._textureRoughness&&!x.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,S.v)(this._textureRoughness,t,"sheenRoughness");t.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.dj),null!==this._roughness&&t.updateFloat("vSheenRoughness",this._roughness)}b.texturesEnabled&&(this._texture&&L.e.SheenTextureEnabled&&t.setTexture("sheenSampler",this._texture),this._textureRoughness&&!x.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&L.e.SheenTextureEnabled&&t.setTexture("sheenRoughnessSampler",this._textureRoughness))}hasTexture(t){return this._texture===t||this._textureRoughness===t}getActiveTextures(t){this._texture&&t.push(this._texture),this._textureRoughness&&t.push(this._textureRoughness)}getAnimatables(t){this._texture&&this._texture.animations&&this._texture.animations.length>0&&t.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&t.push(this._textureRoughness)}dispose(t){var b,Y;t&&(null===(b=this._texture)||void 0===b||b.dispose(),null===(Y=this._textureRoughness)||void 0===Y||Y.dispose())}getClassName(){return"PBRSheenConfiguration"}addFallbacks(t,b,Y){return t.SHEEN&&b.addFallback(Y++,"SHEEN"),Y}getSamplers(t){t.push("sheenSampler","sheenRoughnessSampler")}getUniforms(){return{ubo:[{name:"vSheenColor",size:4,type:"vec4"},{name:"vSheenRoughness",size:1,type:"float"},{name:"vSheenInfos",size:4,type:"vec4"},{name:"sheenMatrix",size:16,type:"mat4"},{name:"sheenRoughnessMatrix",size:16,type:"mat4"}]}}}(0,o.e)([(0,x.P)(),(0,x.b)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"isEnabled",void 0),(0,o.e)([(0,x.P)(),(0,x.b)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"linkSheenWithAlbedo",void 0),(0,o.e)([(0,x.P)()],Q.prototype,"intensity",void 0),(0,o.e)([(0,x.h)()],Q.prototype,"color",void 0),(0,o.e)([(0,x.I)(),(0,x.b)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"texture",void 0),(0,o.e)([(0,x.P)(),(0,x.b)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"useRoughnessFromMainTexture",void 0),(0,o.e)([(0,x.P)(),(0,x.b)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"roughness",void 0),(0,o.e)([(0,x.I)(),(0,x.b)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"textureRoughness",void 0),(0,o.e)([(0,x.P)(),(0,x.b)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"albedoScaling",void 0);class N extends C.b{constructor(){super(...arguments),this.SUBSURFACE=!1,this.SS_REFRACTION=!1,this.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_TRANSLUCENCY=!1,this.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_SCATTERING=!1,this.SS_DISPERSION=!1,this.SS_THICKNESSANDMASK_TEXTURE=!1,this.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,this.SS_HAS_THICKNESS=!1,this.SS_REFRACTIONINTENSITY_TEXTURE=!1,this.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,this.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,this.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,this.SS_REFRACTIONMAP_3D=!1,this.SS_REFRACTIONMAP_OPPOSITEZ=!1,this.SS_LODINREFRACTIONALPHA=!1,this.SS_GAMMAREFRACTION=!1,this.SS_RGBDREFRACTION=!1,this.SS_LINEARSPECULARREFRACTION=!1,this.SS_LINKREFRACTIONTOTRANSPARENCY=!1,this.SS_ALBEDOFORREFRACTIONTINT=!1,this.SS_ALBEDOFORTRANSLUCENCYTINT=!1,this.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.SS_USE_THICKNESS_AS_DEPTH=!1,this.SS_USE_GLTF_TEXTURES=!1}}class u extends p.c{get scatteringDiffusionProfile(){return this._scene.subSurfaceConfiguration?this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex]:null}set scatteringDiffusionProfile(t){this._scene.enableSubSurfaceForPrePass()&&t&&(this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(t))}get volumeIndexOfRefraction(){return this._volumeIndexOfRefraction>=1?this._volumeIndexOfRefraction:this._indexOfRefraction}set volumeIndexOfRefraction(t){this._volumeIndexOfRefraction=t>=1?t:-1}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markScenePrePassDirty(){this._internalMarkAllSubMeshesAsTexturesDirty(),this._internalMarkScenePrePassDirty()}isCompatible(){return!0}constructor(t){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(t,"PBRSubSurface",130,new N,b),this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isDispersionEnabled=!1,this.isDispersionEnabled=!1,this._isScatteringEnabled=!1,this.isScatteringEnabled=!1,this._scatteringDiffusionProfileIndex=0,this.refractionIntensity=1,this.translucencyIntensity=1,this.useAlbedoToTintRefraction=!1,this.useAlbedoToTintTranslucency=!1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1.5,this.indexOfRefraction=1.5,this._volumeIndexOfRefraction=-1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.useThicknessAsDepth=!1,this.tintColor=v.d.White(),this.tintColorAtDistance=1,this.dispersion=0,this.diffusionDistance=v.d.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._refractionIntensityTexture=null,this.refractionIntensityTexture=null,this._translucencyIntensityTexture=null,this.translucencyIntensityTexture=null,this.translucencyColor=null,this._translucencyColorTexture=null,this.translucencyColorTexture=null,this._useGltfStyleTextures=!0,this.useGltfStyleTextures=!0,this._scene=t.va(),this.registerForExtraEvents=!0,this._internalMarkAllSubMeshesAsTexturesDirty=t._dirtyCallbacks[1],this._internalMarkScenePrePassDirty=t._dirtyCallbacks[32]}isReadyForSubMesh(t,b){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return!0;if(t._areTexturesDirty&&b.texturesEnabled){if(this._thicknessTexture&&L.e.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;if(this._translucencyColorTexture&&L.e.TranslucencyColorTextureEnabled&&!this._translucencyColorTexture.isReadyOrNotBlocking())return!1;if(this._translucencyIntensityTexture&&L.e.TranslucencyIntensityTextureEnabled&&!this._translucencyIntensityTexture.isReadyOrNotBlocking())return!1;const t=this._getRefractionTexture(b);if(t&&L.e.RefractionTextureEnabled&&!t.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(t,b){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return t.SUBSURFACE=!1,t.SS_DISPERSION=!1,t.SS_TRANSLUCENCY=!1,t.SS_SCATTERING=!1,t.SS_REFRACTION=!1,t.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,t.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,t.SS_THICKNESSANDMASK_TEXTURE=!1,t.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,t.SS_HAS_THICKNESS=!1,t.SS_REFRACTIONINTENSITY_TEXTURE=!1,t.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,t.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,t.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,t.SS_REFRACTIONMAP_3D=!1,t.SS_REFRACTIONMAP_OPPOSITEZ=!1,t.SS_LODINREFRACTIONALPHA=!1,t.SS_GAMMAREFRACTION=!1,t.SS_RGBDREFRACTION=!1,t.SS_LINEARSPECULARREFRACTION=!1,t.SS_LINKREFRACTIONTOTRANSPARENCY=!1,t.SS_ALBEDOFORREFRACTIONTINT=!1,t.SS_ALBEDOFORTRANSLUCENCYTINT=!1,t.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,t.SS_USE_THICKNESS_AS_DEPTH=!1,t.SS_USE_GLTF_TEXTURES=!1,t.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,void(t.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0);if(t._areTexturesDirty){if(t.SUBSURFACE=!0,t.SS_DISPERSION=this._isDispersionEnabled,t.SS_TRANSLUCENCY=this._isTranslucencyEnabled,t.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,t.SS_SCATTERING=this._isScatteringEnabled,t.SS_THICKNESSANDMASK_TEXTURE=!1,t.SS_REFRACTIONINTENSITY_TEXTURE=!1,t.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,t.SS_HAS_THICKNESS=!1,t.SS_USE_GLTF_TEXTURES=!1,t.SS_REFRACTION=!1,t.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,t.SS_REFRACTIONMAP_3D=!1,t.SS_GAMMAREFRACTION=!1,t.SS_RGBDREFRACTION=!1,t.SS_LINEARSPECULARREFRACTION=!1,t.SS_REFRACTIONMAP_OPPOSITEZ=!1,t.SS_LODINREFRACTIONALPHA=!1,t.SS_LINKREFRACTIONTOTRANSPARENCY=!1,t.SS_ALBEDOFORREFRACTIONTINT=!1,t.SS_ALBEDOFORTRANSLUCENCYTINT=!1,t.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,t.SS_USE_THICKNESS_AS_DEPTH=!1,t.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,t._areTexturesDirty&&b.texturesEnabled&&(this._thicknessTexture&&L.e.ThicknessTextureEnabled&&(0,S.P)(this._thicknessTexture,t,"SS_THICKNESSANDMASK_TEXTURE"),this._refractionIntensityTexture&&L.e.RefractionIntensityTextureEnabled&&(0,S.P)(this._refractionIntensityTexture,t,"SS_REFRACTIONINTENSITY_TEXTURE"),this._translucencyIntensityTexture&&L.e.TranslucencyIntensityTextureEnabled&&(0,S.P)(this._translucencyIntensityTexture,t,"SS_TRANSLUCENCYINTENSITY_TEXTURE"),this._translucencyColorTexture&&L.e.TranslucencyColorTextureEnabled&&(0,S.P)(this._translucencyColorTexture,t,"SS_TRANSLUCENCYCOLOR_TEXTURE")),t.SS_HAS_THICKNESS=this.maximumThickness-this.minimumThickness!==0,t.SS_USE_GLTF_TEXTURES=this._useGltfStyleTextures,t.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._refractionIntensityTexture,t.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._translucencyIntensityTexture,this._isRefractionEnabled&&b.texturesEnabled){const Y=this._getRefractionTexture(b);Y&&L.e.RefractionTextureEnabled&&(t.SS_REFRACTION=!0,t.SS_REFRACTIONMAP_3D=Y.isCube,t.SS_GAMMAREFRACTION=Y.gammaSpace,t.SS_RGBDREFRACTION=Y.isRGBD,t.SS_LINEARSPECULARREFRACTION=Y.linearSpecularLOD,t.SS_REFRACTIONMAP_OPPOSITEZ=this._scene.useRightHandedSystem&&Y.isCube?!Y.invertZ:Y.invertZ,t.SS_LODINREFRACTIONALPHA=Y.lodLevelInAlpha,t.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency,t.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction,t.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=Y.isCube&&Y.boundingBoxSize,t.SS_USE_THICKNESS_AS_DEPTH=this.useThicknessAsDepth)}this._isTranslucencyEnabled&&(t.SS_ALBEDOFORTRANSLUCENCYTINT=this.useAlbedoToTintTranslucency)}}hardBindForSubMesh(t,b,Y,o){if(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled)if(0===this.maximumThickness&&0===this.minimumThickness)t.updateFloat2("vThicknessParam",0,0);else{o.getRenderingMesh().getWorldMatrix().decompose(E.f.ae[0]);const b=Math.max(Math.abs(E.f.ae[0].x),Math.abs(E.f.ae[0].y),Math.abs(E.f.ae[0].z));t.updateFloat2("vThicknessParam",this.minimumThickness*b,(this.maximumThickness-this.minimumThickness)*b)}}bindForSubMesh(t,b,Y,o){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return;const x=o.materialDefines,F=this._material.isFrozen,r=this._material.realTimeFiltering,R=x.LODBASEDMICROSFURACE,d=this._getRefractionTexture(b);if(!t.useUbo||!F||!t.isSync){if(this._thicknessTexture&&L.e.ThicknessTextureEnabled&&(t.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),(0,S.v)(this._thicknessTexture,t,"thickness")),this._refractionIntensityTexture&&L.e.RefractionIntensityTextureEnabled&&x.SS_REFRACTIONINTENSITY_TEXTURE&&(t.updateFloat2("vRefractionIntensityInfos",this._refractionIntensityTexture.coordinatesIndex,this._refractionIntensityTexture.level),(0,S.v)(this._refractionIntensityTexture,t,"refractionIntensity")),this._translucencyColorTexture&&L.e.TranslucencyColorTextureEnabled&&x.SS_TRANSLUCENCYCOLOR_TEXTURE&&(t.updateFloat2("vTranslucencyColorInfos",this._translucencyColorTexture.coordinatesIndex,this._translucencyColorTexture.level),(0,S.v)(this._translucencyColorTexture,t,"translucencyColor")),this._translucencyIntensityTexture&&L.e.TranslucencyIntensityTextureEnabled&&x.SS_TRANSLUCENCYINTENSITY_TEXTURE&&(t.updateFloat2("vTranslucencyIntensityInfos",this._translucencyIntensityTexture.coordinatesIndex,this._translucencyIntensityTexture.level),(0,S.v)(this._translucencyIntensityTexture,t,"translucencyIntensity")),d&&L.e.RefractionTextureEnabled){t.Ge("refractionMatrix",d.getRefractionTextureMatrix());let b=1;d.isCube||d.depth&&(b=d.depth);const Y=d.getSize().width,o=this.volumeIndexOfRefraction;if(t.updateFloat4("vRefractionInfos",d.level,1/o,b,this._invertRefractionY?-1:1),t.updateFloat4("vRefractionMicrosurfaceInfos",Y,d.lodGenerationScale,d.lodGenerationOffset,1/this.indexOfRefraction),r&&t.updateFloat2("vRefractionFilteringInfo",Y,Math.log2(Y)),d.boundingBoxSize){const b=d;t.updateVector3("vRefractionPosition",b.boundingBoxPosition),t.updateVector3("vRefractionSize",b.boundingBoxSize)}}this._isScatteringEnabled&&t.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex),t.updateColor3("vDiffusionDistance",this.diffusionDistance),t.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintColorAtDistance)),t.updateColor4("vTranslucencyColor",this.translucencyColor??this.tintColor,0),t.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0),t.updateFloat("dispersion",this.dispersion)}b.texturesEnabled&&(this._thicknessTexture&&L.e.ThicknessTextureEnabled&&t.setTexture("thicknessSampler",this._thicknessTexture),this._refractionIntensityTexture&&L.e.RefractionIntensityTextureEnabled&&x.SS_REFRACTIONINTENSITY_TEXTURE&&t.setTexture("refractionIntensitySampler",this._refractionIntensityTexture),this._translucencyIntensityTexture&&L.e.TranslucencyIntensityTextureEnabled&&x.SS_TRANSLUCENCYINTENSITY_TEXTURE&&t.setTexture("translucencyIntensitySampler",this._translucencyIntensityTexture),this._translucencyColorTexture&&L.e.TranslucencyColorTextureEnabled&&x.SS_TRANSLUCENCYCOLOR_TEXTURE&&t.setTexture("translucencyColorSampler",this._translucencyColorTexture),d&&L.e.RefractionTextureEnabled&&(R?t.setTexture("refractionSampler",d):(t.setTexture("refractionSampler",d._lodTextureMid||d),t.setTexture("refractionSamplerLow",d._lodTextureLow||d),t.setTexture("refractionSamplerHigh",d._lodTextureHigh||d))))}_getRefractionTexture(t){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?t.environmentTexture:null}get disableAlphaBlending(){return this._isRefractionEnabled&&this._linkRefractionWithTransparency}fillRenderTargetTextures(t){L.e.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&t.push(this._refractionTexture)}hasTexture(t){return this._thicknessTexture===t||(this._refractionTexture===t||(this._refractionIntensityTexture===t||(this._translucencyIntensityTexture===t||this._translucencyColorTexture===t)))}hasRenderTargetTextures(){return!!(L.e.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)}getActiveTextures(t){this._thicknessTexture&&t.push(this._thicknessTexture),this._refractionTexture&&t.push(this._refractionTexture),this._translucencyColorTexture&&t.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&t.push(this._translucencyIntensityTexture)}getAnimatables(t){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&t.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&t.push(this._refractionTexture),this._translucencyColorTexture&&this._translucencyColorTexture.animations&&this._translucencyColorTexture.animations.length>0&&t.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.animations&&this._translucencyIntensityTexture.animations.length>0&&t.push(this._translucencyIntensityTexture)}dispose(t){t&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose(),this._translucencyColorTexture&&this._translucencyColorTexture.dispose(),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.dispose())}getClassName(){return"PBRSubSurfaceConfiguration"}addFallbacks(t,b,Y){return t.SS_SCATTERING&&b.addFallback(Y++,"SS_SCATTERING"),t.SS_TRANSLUCENCY&&b.addFallback(Y++,"SS_TRANSLUCENCY"),Y}getSamplers(t){t.push("thicknessSampler","refractionIntensitySampler","translucencyIntensitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh","translucencyColorSampler")}getUniforms(){return{ubo:[{name:"vRefractionMicrosurfaceInfos",size:4,type:"vec4"},{name:"vRefractionFilteringInfo",size:2,type:"vec2"},{name:"vTranslucencyIntensityInfos",size:2,type:"vec2"},{name:"vRefractionInfos",size:4,type:"vec4"},{name:"refractionMatrix",size:16,type:"mat4"},{name:"vThicknessInfos",size:2,type:"vec2"},{name:"vRefractionIntensityInfos",size:2,type:"vec2"},{name:"thicknessMatrix",size:16,type:"mat4"},{name:"refractionIntensityMatrix",size:16,type:"mat4"},{name:"translucencyIntensityMatrix",size:16,type:"mat4"},{name:"vThicknessParam",size:2,type:"vec2"},{name:"vDiffusionDistance",size:3,type:"vec3"},{name:"vTintColor",size:4,type:"vec4"},{name:"vSubSurfaceIntensity",size:3,type:"vec3"},{name:"vRefractionPosition",size:3,type:"vec3"},{name:"vRefractionSize",size:3,type:"vec3"},{name:"scatteringDiffusionProfile",size:1,type:"float"},{name:"dispersion",size:1,type:"float"},{name:"vTranslucencyColor",size:4,type:"vec4"},{name:"vTranslucencyColorInfos",size:2,type:"vec2"},{name:"translucencyColorMatrix",size:16,type:"mat4"}]}}}(0,o.e)([(0,x.P)(),(0,x.b)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"isRefractionEnabled",void 0),(0,o.e)([(0,x.P)(),(0,x.b)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"isTranslucencyEnabled",void 0),(0,o.e)([(0,x.P)(),(0,x.b)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"isDispersionEnabled",void 0),(0,o.e)([(0,x.P)(),(0,x.b)("_markScenePrePassDirty")],u.prototype,"isScatteringEnabled",void 0),(0,o.e)([(0,x.P)()],u.prototype,"_scatteringDiffusionProfileIndex",void 0),(0,o.e)([(0,x.P)()],u.prototype,"refractionIntensity",void 0),(0,o.e)([(0,x.P)()],u.prototype,"translucencyIntensity",void 0),(0,o.e)([(0,x.P)()],u.prototype,"useAlbedoToTintRefraction",void 0),(0,o.e)([(0,x.P)()],u.prototype,"useAlbedoToTintTranslucency",void 0),(0,o.e)([(0,x.I)(),(0,x.b)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"thicknessTexture",void 0),(0,o.e)([(0,x.I)(),(0,x.b)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"refractionTexture",void 0),(0,o.e)([(0,x.P)(),(0,x.b)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"indexOfRefraction",void 0),(0,o.e)([(0,x.P)()],u.prototype,"_volumeIndexOfRefraction",void 0),(0,o.e)([(0,x.b)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"volumeIndexOfRefraction",null),(0,o.e)([(0,x.P)(),(0,x.b)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"invertRefractionY",void 0),(0,o.e)([(0,x.P)(),(0,x.b)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"linkRefractionWithTransparency",void 0),(0,o.e)([(0,x.P)()],u.prototype,"minimumThickness",void 0),(0,o.e)([(0,x.P)()],u.prototype,"maximumThickness",void 0),(0,o.e)([(0,x.P)()],u.prototype,"useThicknessAsDepth",void 0),(0,o.e)([(0,x.h)()],u.prototype,"tintColor",void 0),(0,o.e)([(0,x.P)()],u.prototype,"tintColorAtDistance",void 0),(0,o.e)([(0,x.P)()],u.prototype,"dispersion",void 0),(0,o.e)([(0,x.h)()],u.prototype,"diffusionDistance",void 0),(0,o.e)([(0,x.P)(),(0,x.b)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"useMaskFromThicknessTexture",void 0),(0,o.e)([(0,x.I)(),(0,x.b)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"refractionIntensityTexture",void 0),(0,o.e)([(0,x.I)(),(0,x.b)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"translucencyIntensityTexture",void 0),(0,o.e)([(0,x.h)()],u.prototype,"translucencyColor",void 0),(0,o.e)([(0,x.I)(),(0,x.b)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"translucencyColorTexture",void 0),(0,o.e)([(0,x.P)(),(0,x.b)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"useGltfStyleTextures",void 0);var Z=Y(1475),a=Y(1446),A=Y(1483);const M={effect:null,subMesh:null};class w extends C.b{constructor(t){super(t),this.PBR=!0,this.NUM_SAMPLES="0",this.REALTIME_FILTERING=!1,this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.ALBEDO=!1,this.GAMMAALBEDO=!1,this.ALBEDODIRECTUV=0,this.VERTEXCOLOR=!1,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.AMBIENTINGRAYSCALE=!1,this.OPACITY=!1,this.VERTEXALPHA=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHABLEND=!1,this.ALPHAFROMALBEDO=!1,this.ALPHATESTVALUE="0.5",this.SPECULAROVERALPHA=!1,this.RADIANCEOVERALPHA=!1,this.ALPHAFRESNEL=!1,this.LINEARALPHAFRESNEL=!1,this.PREMULTIPLYALPHA=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.GAMMAEMISSIVE=!1,this.REFLECTIVITY=!1,this.REFLECTIVITY_GAMMA=!1,this.REFLECTIVITYDIRECTUV=0,this.SPECULARTERM=!1,this.MICROSURFACEFROMREFLECTIVITYMAP=!1,this.MICROSURFACEAUTOMATIC=!1,this.LODBASEDMICROSFURACE=!1,this.MICROSURFACEMAP=!1,this.MICROSURFACEMAPDIRECTUV=0,this.METALLICWORKFLOW=!1,this.ROUGHNESSSTOREINMETALMAPALPHA=!1,this.ROUGHNESSSTOREINMETALMAPGREEN=!1,this.METALLNESSSTOREINMETALMAPBLUE=!1,this.AOSTOREINMETALMAPRED=!1,this.METALLIC_REFLECTANCE=!1,this.METALLIC_REFLECTANCE_GAMMA=!1,this.METALLIC_REFLECTANCEDIRECTUV=0,this.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=!1,this.REFLECTANCE=!1,this.REFLECTANCE_GAMMA=!1,this.REFLECTANCEDIRECTUV=0,this.ENVIRONMENTBRDF=!1,this.ENVIRONMENTBRDF_RGBD=!1,this.NORMAL=!1,this.TANGENT=!1,this.BUMP=!1,this.BUMPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.NORMALXYSCALE=!0,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.USELIGHTMAPASSHADOWMAP=!1,this.GAMMALIGHTMAP=!1,this.RGBDLIGHTMAP=!1,this.REFLECTION=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.INVERTCUBICMAP=!1,this.USESPHERICALFROMREFLECTIONMAP=!1,this.USEIRRADIANCEMAP=!1,this.USESPHERICALINVERTEX=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.LODINREFLECTIONALPHA=!1,this.GAMMAREFLECTION=!1,this.RGBDREFLECTION=!1,this.LINEARSPECULARREFLECTION=!1,this.RADIANCEOCCLUSION=!1,this.HORIZONOCCLUSION=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.NONUNIFORMSCALING=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.EXPOSURE=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.USEPHYSICALLIGHTFALLOFF=!1,this.USEGLTFLIGHTFALLOFF=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.LOGARITHMICDEPTH=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.FORCENORMALFORWARD=!1,this.SPECULARAA=!1,this.UNLIT=!1,this.DECAL_AFTER_DETAIL=!1,this.DEBUGMODE=0,this.rebuild()}reset(){super.reset(),this.ALPHATESTVALUE="0.5",this.PBR=!0,this.NORMALXYSCALE=!0}}class c extends m.b{get realTimeFiltering(){return this._realTimeFiltering}set realTimeFiltering(t){this._realTimeFiltering=t,this.Ae(1)}get realTimeFilteringQuality(){return this._realTimeFilteringQuality}set realTimeFilteringQuality(t){this._realTimeFilteringQuality=t,this.Ae(1)}get canRenderToMRT(){return!0}_attachImageProcessingConfiguration(t){t!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=t||this.va().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}constructor(t,b){super(t,b,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||c.ForceGLSL),this._directIntensity=1,this._emissiveIntensity=1,this._environmentIntensity=1,this._specularIntensity=1,this._lightingInfos=new E.m(this._directIntensity,this._emissiveIntensity,this._environmentIntensity,this._specularIntensity),this._disableBumpMap=!1,this._albedoTexture=null,this._ambientTexture=null,this._ambientTextureStrength=1,this._ambientTextureImpactOnAnalyticalLights=c.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._reflectivityTexture=null,this._metallicTexture=null,this._metallic=null,this._roughness=null,this._metallicF0Factor=1,this._metallicReflectanceColor=v.d.White(),this._useOnlyMetallicFromMetallicReflectanceTexture=!1,this._metallicReflectanceTexture=null,this._reflectanceTexture=null,this._microSurfaceTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._ambientColor=new v.d(0,0,0),this._albedoColor=new v.d(1,1,1),this._reflectivityColor=new v.d(1,1,1),this._reflectionColor=new v.d(1,1,1),this._emissiveColor=new v.d(0,0,0),this._microSurface=.9,this._useLightmapAsShadowmap=!1,this._useHorizonOcclusion=!0,this._useRadianceOcclusion=!0,this._useAlphaFromAlbedoTexture=!1,this._useSpecularOverAlpha=!0,this._useMicroSurfaceFromReflectivityMapAlpha=!1,this._useRoughnessFromMetallicTextureAlpha=!0,this._useRoughnessFromMetallicTextureGreen=!1,this._useMetallnessFromMetallicTextureBlue=!1,this._useAmbientOcclusionFromMetallicTextureRed=!1,this._useAmbientInGrayScale=!1,this._useAutoMicroSurfaceFromReflectivityMap=!1,this._lightFalloff=c.LIGHTFALLOFF_PHYSICAL,this._useRadianceOverAlpha=!0,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this._parallaxScaleBias=.05,this._disableLighting=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._alphaCutOff=.4,this._forceAlphaTest=!1,this._useAlphaFresnel=!1,this._useLinearAlphaFresnel=!1,this._environmentBRDFTexture=null,this._forceIrradianceInFragment=!1,this._realTimeFiltering=!1,this._realTimeFilteringQuality=8,this._forceNormalForward=!1,this._enableSpecularAntiAliasing=!1,this._imageProcessingObserver=null,this._renderTargets=new r.d(16),this._globalAmbientColor=new v.d(0,0,0),this._unlit=!1,this._applyDecalMapAfterDetailMap=!1,this._debugMode=0,this._shadersLoaded=!1,this._breakShaderLoadedCheck=!1,this.debugMode=0,this.debugLimit=-1,this.debugFactor=1,this._cacheHasRenderTargetTextures=!1,this.brdf=new T(this),this.clearCoat=new g(this),this.iridescence=new H(this),this.anisotropy=new n(this),this.sheen=new Q(this),this.subSurface=new u(this),this.detailMap=new Z.b(this),this._attachImageProcessingConfiguration(null),this.getRenderTargetTextures=()=>(this._renderTargets.reset(),L.e.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets),this._environmentBRDFTexture=(0,R.b)(this.va()),this.prePassConfiguration=new y.e}get hasRenderTargetTextures(){return!!(L.e.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures}get isPrePassCapable(){return!this.disableDepthWrite}getClassName(){return"PBRBaseMaterial"}get _disableAlphaBlending(){var t;return this._transparencyMode===c.PBRMATERIAL_OPAQUE||this._transparencyMode===c.PBRMATERIAL_ALPHATEST||(null===(t=this.subSurface)||void 0===t?void 0:t.disableAlphaBlending)}needAlphaBlending(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())}needAlphaTesting(){var t;return!!this._forceAlphaTest||(null===(t=this.subSurface)||void 0===t||!t.disableAlphaBlending)&&(this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===c.PBRMATERIAL_ALPHATEST))}_shouldUseAlphaFromAlbedoTexture(){return null!=this._albedoTexture&&this._albedoTexture.Cc&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==c.PBRMATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._albedoTexture&&this._albedoTexture.Cc||null!=this._opacityTexture}getAlphaTestTexture(){return this._albedoTexture}isReadyForSubMesh(t,b,Y){this._uniformBufferLayoutBuilt||this.buildUniformLayout();const o=b._drawWrapper;if(o.effect&&this.isFrozen&&o._wasPreviouslyReady&&o._wasPreviouslyUsingInstances===Y)return!0;b.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),b.materialDefines=new w(this._eventInfo.defineNames));const x=b.materialDefines;if(this._isReadyForSubMesh(b))return!0;const r=this.va(),R=r.getEngine();if(x._areTexturesDirty&&(this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,r.texturesEnabled)){if(this._albedoTexture&&L.e.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&L.e.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&L.e.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;const t=this._getReflectionTexture();if(t&&L.e.ReflectionTextureEnabled){if(!t.isReadyOrNotBlocking())return!1;var d;if(t.irradianceTexture){if(!t.irradianceTexture.isReadyOrNotBlocking())return!1}else if(!t.sphericalPolynomial&&null!==(d=t.getInternalTexture())&&void 0!==d&&d._sphericalPolynomialPromise)return!1}if(this._lightmapTexture&&L.e.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&L.e.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(L.e.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._metallicReflectanceTexture&&!this._metallicReflectanceTexture.isReadyOrNotBlocking())return!1;if(this._reflectanceTexture&&!this._reflectanceTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(R.getCaps().standardDerivatives&&this._bumpTexture&&L.e.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;if(this._environmentBRDFTexture&&L.e.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=x,this._eventInfo.subMesh=b,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(x._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;R.getCaps().standardDerivatives||t.isVerticesDataPresent(U.e.NormalKind)||(t.createNormals(!0),F.b.Warn("PBRMaterial: Normals have been created for the mesh: "+t.name));const E=b.effect,C=x._areLightsDisposed;let p=this._prepareEffect(t,x,this.onCompiled,this.onError,Y,null,b.getRenderingMesh().hasThinInstances),W=!1;if(p)if(this._onEffectCreatedObservable&&(M.effect=p,M.subMesh=b,this._onEffectCreatedObservable.notifyObservers(M)),this.allowShaderHotSwapping&&E&&!p.isReady()){if(p=E,x.markAsUnprocessed(),W=this.isFrozen,C)return x._areLightsDisposed=!0,!1}else r.resetCachedMaterial(),b.setEffect(p,x,this._materialContext);return!(!b.effect||!b.effect.isReady())&&(x._renderId=r.getRenderId(),o._wasPreviouslyReady=!W,o._wasPreviouslyUsingInstances=!!Y,this._checkScenePerformancePriority(),!0)}isMetallicWorkflow(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)}_prepareEffect(t,b){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,R=arguments.length>6?arguments[6]:void 0;if(this._prepareDefines(t,b,F,r,R),!b.isDirty)return null;b.markAsProcessed();const d=this.va().getEngine(),E=new z.b;let C=0;b.USESPHERICALINVERTEX&&E.addFallback(C++,"USESPHERICALINVERTEX"),b.FOG&&E.addFallback(C,"FOG"),b.SPECULARAA&&E.addFallback(C,"SPECULARAA"),b.POINTSIZE&&E.addFallback(C,"POINTSIZE"),b.LOGARITHMICDEPTH&&E.addFallback(C,"LOGARITHMICDEPTH"),b.PARALLAX&&E.addFallback(C,"PARALLAX"),b.PARALLAX_RHS&&E.addFallback(C,"PARALLAX_RHS"),b.PARALLAXOCCLUSION&&E.addFallback(C++,"PARALLAXOCCLUSION"),b.ENVIRONMENTBRDF&&E.addFallback(C++,"ENVIRONMENTBRDF"),b.TANGENT&&E.addFallback(C++,"TANGENT"),b.BUMP&&E.addFallback(C++,"BUMP"),C=(0,S.z)(b,E,this._maxSimultaneousLights,C++),b.SPECULARTERM&&E.addFallback(C++,"SPECULARTERM"),b.USESPHERICALFROMREFLECTIONMAP&&E.addFallback(C++,"USESPHERICALFROMREFLECTIONMAP"),b.USEIRRADIANCEMAP&&E.addFallback(C++,"USEIRRADIANCEMAP"),b.LIGHTMAP&&E.addFallback(C++,"LIGHTMAP"),b.NORMAL&&E.addFallback(C++,"NORMAL"),b.AMBIENT&&E.addFallback(C++,"AMBIENT"),b.EMISSIVE&&E.addFallback(C++,"EMISSIVE"),b.VERTEXCOLOR&&E.addFallback(C++,"VERTEXCOLOR"),b.MORPHTARGETS&&E.addFallback(C++,"MORPHTARGETS"),b.MULTIVIEW&&E.addFallback(0,"MULTIVIEW");const p=[U.e.PositionKind];b.NORMAL&&p.push(U.e.NormalKind),b.TANGENT&&p.push(U.e.TangentKind);for(let Y=1;Y<=6;++Y)b["UV"+Y]&&p.push(`uv${1===Y?"":Y}`);b.VERTEXCOLOR&&p.push(U.e.ColorKind),(0,S.D)(p,t,b,E),(0,S.E)(p,b),(0,S.H)(p,t,b),(0,S.A)(p,t,b);let W="pbr";const T=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vReflectionFilteringInfo","vMetallicReflectanceInfos","vReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","albedoMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","reflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vTangentSpaceParams","boneTextureWidth","vDebugMode","morphTargetTextureInfo","morphTargetTextureIndices"],v=["albedoSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler","reflectanceSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],J=["Material","Scene","Mesh"],m={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:b.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=E,this._eventInfo.fallbackRank=C,this._eventInfo.defines=b,this._eventInfo.uniforms=T,this._eventInfo.attributes=p,this._eventInfo.samplers=v,this._eventInfo.uniformBuffersNames=J,this._eventInfo.customCode=void 0,this._eventInfo.mesh=t,this._eventInfo.indexParameters=m,this._callbackPluginEventGeneric(128,this._eventInfo),A.e.AddUniformsAndSamplers(T,v),y.e.AddUniforms(T),y.e.AddSamplers(v),(0,a.b)(T),B.e&&(B.e.PrepareUniforms(T,b),B.e.PrepareSamplers(v,b)),(0,S.X)({uniformsNames:T,uniformBuffersNames:J,samplers:v,defines:b,maxSimultaneousLights:this._maxSimultaneousLights});const K={};this.customShaderNameResolve&&(W=this.customShaderNameResolve(W,T,J,v,b,p,K));const L=b.toString(),e=d.createEffect(W,{attributes:p,uniformsNames:T,uniformBuffersNames:J,samplers:v,defines:L,fallbacks:E,onCompiled:o,onError:x,indexParameters:m,processFinalCode:K.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:b.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this.shaderLanguage?await Promise.all([Promise.all([Y.e(15),Y.e(44)]).then(Y.bind(Y,12981)),Promise.all([Y.e(16),Y.e(45)]).then(Y.bind(Y,13e3))]):await Promise.all([Promise.all([Y.e(21),Y.e(46)]).then(Y.bind(Y,13006)),Promise.all([Y.e(23),Y.e(47)]).then(Y.bind(Y,13020))]),this._shadersLoaded=!0}},d);return this._eventInfo.customCode=void 0,e}_prepareDefines(t,b){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,x=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const F=this.va(),r=F.getEngine();(0,S.N)(F,t,b,!0,this._maxSimultaneousLights,this._disableLighting),b._needNormals=!0,(0,S.R)(F,b);const R=this.needAlphaBlendingForMesh(t)&&this.va().useOrderIndependentTransparency;if((0,S.W)(F,b,this.canRenderToMRT&&!R),(0,S.U)(F,b,R),A.e.PrepareDefines(r.currentRenderPassId,t,b),b.METALLICWORKFLOW=this.isMetallicWorkflow(),b._areTexturesDirty){b._needUVs=!1;for(let t=1;t<=6;++t)b["MAINUV"+t]=!1;if(F.texturesEnabled){b.ALBEDODIRECTUV=0,b.AMBIENTDIRECTUV=0,b.OPACITYDIRECTUV=0,b.EMISSIVEDIRECTUV=0,b.REFLECTIVITYDIRECTUV=0,b.MICROSURFACEMAPDIRECTUV=0,b.METALLIC_REFLECTANCEDIRECTUV=0,b.REFLECTANCEDIRECTUV=0,b.BUMPDIRECTUV=0,b.LIGHTMAPDIRECTUV=0,r.getCaps().textureLOD&&(b.LODBASEDMICROSFURACE=!0),this._albedoTexture&&L.e.DiffuseTextureEnabled?((0,S.P)(this._albedoTexture,b,"ALBEDO"),b.GAMMAALBEDO=this._albedoTexture.gammaSpace):b.ALBEDO=!1,this._ambientTexture&&L.e.AmbientTextureEnabled?((0,S.P)(this._ambientTexture,b,"AMBIENT"),b.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):b.AMBIENT=!1,this._opacityTexture&&L.e.OpacityTextureEnabled?((0,S.P)(this._opacityTexture,b,"OPACITY"),b.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):b.OPACITY=!1;const t=this._getReflectionTexture();if(t&&L.e.ReflectionTextureEnabled){switch(b.REFLECTION=!0,b.GAMMAREFLECTION=t.gammaSpace,b.RGBDREFLECTION=t.isRGBD,b.LODINREFLECTIONALPHA=t.lodLevelInAlpha,b.LINEARSPECULARREFLECTION=t.linearSpecularLOD,this.realTimeFiltering&&this.realTimeFilteringQuality>0?(b.NUM_SAMPLES=""+this.realTimeFilteringQuality,r._features.needTypeSuffixInShaderConstants&&(b.NUM_SAMPLES=b.NUM_SAMPLES+"u"),b.REALTIME_FILTERING=!0):b.REALTIME_FILTERING=!1,b.INVERTCUBICMAP=t.coordinatesMode===K.b.INVCUBIC_MODE,b.REFLECTIONMAP_3D=t.isCube,b.REFLECTIONMAP_OPPOSITEZ=b.REFLECTIONMAP_3D&&this.va().useRightHandedSystem?!t.invertZ:t.invertZ,b.REFLECTIONMAP_CUBIC=!1,b.REFLECTIONMAP_EXPLICIT=!1,b.REFLECTIONMAP_PLANAR=!1,b.REFLECTIONMAP_PROJECTION=!1,b.REFLECTIONMAP_SKYBOX=!1,b.REFLECTIONMAP_SPHERICAL=!1,b.REFLECTIONMAP_EQUIRECTANGULAR=!1,b.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,b.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,t.coordinatesMode){case K.b.EXPLICIT_MODE:b.REFLECTIONMAP_EXPLICIT=!0;break;case K.b.PLANAR_MODE:b.REFLECTIONMAP_PLANAR=!0;break;case K.b.PROJECTION_MODE:b.REFLECTIONMAP_PROJECTION=!0;break;case K.b.SKYBOX_MODE:b.REFLECTIONMAP_SKYBOX=!0;break;case K.b.SPHERICAL_MODE:b.REFLECTIONMAP_SPHERICAL=!0;break;case K.b.EQUIRECTANGULAR_MODE:b.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case K.b.FIXED_EQUIRECTANGULAR_MODE:b.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case K.b.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:b.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case K.b.CUBIC_MODE:case K.b.INVCUBIC_MODE:default:b.REFLECTIONMAP_CUBIC=!0,b.USE_LOCAL_REFLECTIONMAP_CUBIC=!!t.boundingBoxSize}t.coordinatesMode!==K.b.SKYBOX_MODE&&(t.irradianceTexture?(b.USEIRRADIANCEMAP=!0,b.USESPHERICALFROMREFLECTIONMAP=!1):t.isCube&&(b.USESPHERICALFROMREFLECTIONMAP=!0,b.USEIRRADIANCEMAP=!1,this._forceIrradianceInFragment||this.realTimeFiltering||this._twoSidedLighting||r.getCaps().maxVaryingVectors<=8?b.USESPHERICALINVERTEX=!1:b.USESPHERICALINVERTEX=!0))}else b.REFLECTION=!1,b.REFLECTIONMAP_3D=!1,b.REFLECTIONMAP_SPHERICAL=!1,b.REFLECTIONMAP_PLANAR=!1,b.REFLECTIONMAP_CUBIC=!1,b.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,b.REFLECTIONMAP_PROJECTION=!1,b.REFLECTIONMAP_SKYBOX=!1,b.REFLECTIONMAP_EXPLICIT=!1,b.REFLECTIONMAP_EQUIRECTANGULAR=!1,b.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,b.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,b.INVERTCUBICMAP=!1,b.USESPHERICALFROMREFLECTIONMAP=!1,b.USEIRRADIANCEMAP=!1,b.USESPHERICALINVERTEX=!1,b.REFLECTIONMAP_OPPOSITEZ=!1,b.LODINREFLECTIONALPHA=!1,b.GAMMAREFLECTION=!1,b.RGBDREFLECTION=!1,b.LINEARSPECULARREFLECTION=!1;this._lightmapTexture&&L.e.LightmapTextureEnabled?((0,S.P)(this._lightmapTexture,b,"LIGHTMAP"),b.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,b.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,b.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):b.LIGHTMAP=!1,this._emissiveTexture&&L.e.EmissiveTextureEnabled?((0,S.P)(this._emissiveTexture,b,"EMISSIVE"),b.GAMMAEMISSIVE=this._emissiveTexture.gammaSpace):b.EMISSIVE=!1,L.e.SpecularTextureEnabled?(this._metallicTexture?((0,S.P)(this._metallicTexture,b,"REFLECTIVITY"),b.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,b.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,b.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,b.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed,b.REFLECTIVITY_GAMMA=!1):this._reflectivityTexture?((0,S.P)(this._reflectivityTexture,b,"REFLECTIVITY"),b.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,b.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap,b.REFLECTIVITY_GAMMA=this._reflectivityTexture.gammaSpace):b.REFLECTIVITY=!1,this._metallicReflectanceTexture||this._reflectanceTexture?(b.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=this._useOnlyMetallicFromMetallicReflectanceTexture,this._metallicReflectanceTexture?((0,S.P)(this._metallicReflectanceTexture,b,"METALLIC_REFLECTANCE"),b.METALLIC_REFLECTANCE_GAMMA=this._metallicReflectanceTexture.gammaSpace):b.METALLIC_REFLECTANCE=!1,this._reflectanceTexture&&(!this._metallicReflectanceTexture||this._metallicReflectanceTexture&&this._useOnlyMetallicFromMetallicReflectanceTexture)?((0,S.P)(this._reflectanceTexture,b,"REFLECTANCE"),b.REFLECTANCE_GAMMA=this._reflectanceTexture.gammaSpace):b.REFLECTANCE=!1):(b.METALLIC_REFLECTANCE=!1,b.REFLECTANCE=!1),this._microSurfaceTexture?(0,S.P)(this._microSurfaceTexture,b,"MICROSURFACEMAP"):b.MICROSURFACEMAP=!1):(b.REFLECTIVITY=!1,b.MICROSURFACEMAP=!1),r.getCaps().standardDerivatives&&this._bumpTexture&&L.e.BumpTextureEnabled&&!this._disableBumpMap?((0,S.P)(this._bumpTexture,b,"BUMP"),this._useParallax&&this._albedoTexture&&L.e.DiffuseTextureEnabled?(b.PARALLAX=!0,b.PARALLAX_RHS=F.useRightHandedSystem,b.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):b.PARALLAX=!1,b.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):(b.BUMP=!1,b.PARALLAX=!1,b.PARALLAX_RHS=!1,b.PARALLAXOCCLUSION=!1,b.OBJECTSPACE_NORMALMAP=!1),this._environmentBRDFTexture&&L.e.ReflectionTextureEnabled?(b.ENVIRONMENTBRDF=!0,b.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(b.ENVIRONMENTBRDF=!1,b.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?b.ALPHAFROMALBEDO=!0:b.ALPHAFROMALBEDO=!1}b.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===c.LIGHTFALLOFF_STANDARD?(b.USEPHYSICALLIGHTFALLOFF=!1,b.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===c.LIGHTFALLOFF_GLTF?(b.USEPHYSICALLIGHTFALLOFF=!1,b.USEGLTFLIGHTFALLOFF=!0):(b.USEPHYSICALLIGHTFALLOFF=!0,b.USEGLTFLIGHTFALLOFF=!1),b.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.Ce&&this._twoSidedLighting?b.TWOSIDEDLIGHTING=!0:b.TWOSIDEDLIGHTING=!1,b.SPECULARAA=r.getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(b._areTexturesDirty||b._areMiscDirty)&&(b.ALPHATESTVALUE=`${this._alphaCutOff}${this._alphaCutOff%1===0?".":""}`,b.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,b.ALPHABLEND=this.needAlphaBlendingForMesh(t),b.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,b.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),b._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(b),b.FORCENORMALFORWARD=this._forceNormalForward,b.RADIANCEOCCLUSION=this._useRadianceOcclusion,b.HORIZONOCCLUSION=this._useHorizonOcclusion,b._areMiscDirty&&((0,S.Q)(t,F,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(t)||this._forceAlphaTest,b,this._applyDecalMapAfterDetailMap),b.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!t.isVerticesDataPresent(U.e.NormalKind),b.DEBUGMODE=this._debugMode),(0,S.L)(F,r,this,b,!!Y,o,x),this._eventInfo.defines=b,this._eventInfo.mesh=t,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,S.I)(t,b,!0,!0,!0,this._transparencyMode!==c.PBRMATERIAL_OPAQUE),this._callbackPluginEventPrepareDefines(this._eventInfo)}forceCompilation(t,b,Y){const o={clipPlane:!1,useInstances:!1,...Y};this._uniformBufferLayoutBuilt||this.buildUniformLayout(),this._callbackPluginEventGeneric(4,this._eventInfo);(()=>{if(this._breakShaderLoadedCheck)return;const Y=new w(this._eventInfo.defineNames),x=this._prepareEffect(t,Y,void 0,void 0,o.useInstances,o.clipPlane,t.hasThinInstances);this._onEffectCreatedObservable&&(M.effect=x,M.subMesh=null,this._onEffectCreatedObservable.notifyObservers(M)),x.isReady()?b&&b(this):x.onCompileObservable.add((()=>{b&&b(this)}))})()}buildUniformLayout(){const t=this._uniformBuffer;t.addUniform("vAlbedoInfos",2),t.addUniform("vAmbientInfos",4),t.addUniform("vOpacityInfos",2),t.addUniform("vEmissiveInfos",2),t.addUniform("vLightmapInfos",2),t.addUniform("vReflectivityInfos",3),t.addUniform("vMicroSurfaceSamplerInfos",2),t.addUniform("vReflectionInfos",2),t.addUniform("vReflectionFilteringInfo",2),t.addUniform("vReflectionPosition",3),t.addUniform("vReflectionSize",3),t.addUniform("vBumpInfos",3),t.addUniform("albedoMatrix",16),t.addUniform("ambientMatrix",16),t.addUniform("opacityMatrix",16),t.addUniform("emissiveMatrix",16),t.addUniform("lightmapMatrix",16),t.addUniform("reflectivityMatrix",16),t.addUniform("microSurfaceSamplerMatrix",16),t.addUniform("bumpMatrix",16),t.addUniform("vTangentSpaceParams",2),t.addUniform("reflectionMatrix",16),t.addUniform("vReflectionColor",3),t.addUniform("vAlbedoColor",4),t.addUniform("vLightingIntensity",4),t.addUniform("vReflectionMicrosurfaceInfos",3),t.addUniform("pointSize",1),t.addUniform("vReflectivityColor",4),t.addUniform("vEmissiveColor",3),t.addUniform("vAmbientColor",3),t.addUniform("vDebugMode",2),t.addUniform("vMetallicReflectanceFactors",4),t.addUniform("vMetallicReflectanceInfos",2),t.addUniform("metallicReflectanceMatrix",16),t.addUniform("vReflectanceInfos",2),t.addUniform("reflectanceMatrix",16),t.addUniform("vSphericalL00",3),t.addUniform("vSphericalL1_1",3),t.addUniform("vSphericalL10",3),t.addUniform("vSphericalL11",3),t.addUniform("vSphericalL2_2",3),t.addUniform("vSphericalL2_1",3),t.addUniform("vSphericalL20",3),t.addUniform("vSphericalL21",3),t.addUniform("vSphericalL22",3),t.addUniform("vSphericalX",3),t.addUniform("vSphericalY",3),t.addUniform("vSphericalZ",3),t.addUniform("vSphericalXX_ZZ",3),t.addUniform("vSphericalYY_ZZ",3),t.addUniform("vSphericalZZ",3),t.addUniform("vSphericalXY",3),t.addUniform("vSphericalYZ",3),t.addUniform("vSphericalZX",3),super.buildUniformLayout()}bindForSubMesh(t,b,Y){const o=this.va(),x=Y.materialDefines;if(!x)return;const F=Y.effect;if(!F)return;this._activeEffect=F,b.getMeshUniformBuffer().bindToEffect(F,"Mesh"),b.transferToEffect(t);const r=o.getEngine();this._uniformBuffer.bindToEffect(F,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,o,b,t,this.isFrozen),A.e.Bind(r.currentRenderPassId,this._activeEffect,b,t),this._eventInfo.subMesh=Y,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),x.OBJECTSPACE_NORMALMAP&&(t.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const R=this._mustRebind(o,F,Y,b.visibility);(0,S.d)(b,this._activeEffect,this.prePassConfiguration);let E=null;const U=this._uniformBuffer;if(R){if(this.bindViewProjection(F),E=this._getReflectionTexture(),!U.useUbo||!this.isFrozen||!U.isSync||Y._drawWrapper._forceRebindOnNextCall){var C;if(o.texturesEnabled){if(this._albedoTexture&&L.e.DiffuseTextureEnabled&&(U.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),(0,S.v)(this._albedoTexture,U,"albedo")),this._ambientTexture&&L.e.AmbientTextureEnabled&&(U.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),(0,S.v)(this._ambientTexture,U,"ambient")),this._opacityTexture&&L.e.OpacityTextureEnabled&&(U.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,S.v)(this._opacityTexture,U,"opacity")),E&&L.e.ReflectionTextureEnabled){if(U.Ge("reflectionMatrix",E.getReflectionTextureMatrix()),U.updateFloat2("vReflectionInfos",E.level,0),E.boundingBoxSize){const t=E;U.updateVector3("vReflectionPosition",t.boundingBoxPosition),U.updateVector3("vReflectionSize",t.boundingBoxSize)}if(this.realTimeFiltering){const t=E.getSize().width;U.updateFloat2("vReflectionFilteringInfo",t,Math.log2(t))}if(!x.USEIRRADIANCEMAP){const t=E.sphericalPolynomial;if(x.USESPHERICALFROMREFLECTIONMAP&&t)if(x.SPHERICAL_HARMONICS){const b=t.preScaledHarmonics;U.updateVector3("vSphericalL00",b.l00),U.updateVector3("vSphericalL1_1",b.l1_1),U.updateVector3("vSphericalL10",b.l10),U.updateVector3("vSphericalL11",b.l11),U.updateVector3("vSphericalL2_2",b.l2_2),U.updateVector3("vSphericalL2_1",b.l2_1),U.updateVector3("vSphericalL20",b.l20),U.updateVector3("vSphericalL21",b.l21),U.updateVector3("vSphericalL22",b.l22)}else U.updateFloat3("vSphericalX",t.x.x,t.x.y,t.x.z),U.updateFloat3("vSphericalY",t.y.x,t.y.y,t.y.z),U.updateFloat3("vSphericalZ",t.z.x,t.z.y,t.z.z),U.updateFloat3("vSphericalXX_ZZ",t.xx.x-t.zz.x,t.xx.y-t.zz.y,t.xx.z-t.zz.z),U.updateFloat3("vSphericalYY_ZZ",t.yy.x-t.zz.x,t.yy.y-t.zz.y,t.yy.z-t.zz.z),U.updateFloat3("vSphericalZZ",t.zz.x,t.zz.y,t.zz.z),U.updateFloat3("vSphericalXY",t.xy.x,t.xy.y,t.xy.z),U.updateFloat3("vSphericalYZ",t.yz.x,t.yz.y,t.yz.z),U.updateFloat3("vSphericalZX",t.zx.x,t.zx.y,t.zx.z)}U.updateFloat3("vReflectionMicrosurfaceInfos",E.getSize().width,E.lodGenerationScale,E.lodGenerationOffset)}this._emissiveTexture&&L.e.EmissiveTextureEnabled&&(U.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,S.v)(this._emissiveTexture,U,"emissive")),this._lightmapTexture&&L.e.LightmapTextureEnabled&&(U.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,S.v)(this._lightmapTexture,U,"lightmap")),L.e.SpecularTextureEnabled&&(this._metallicTexture?(U.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),(0,S.v)(this._metallicTexture,U,"reflectivity")):this._reflectivityTexture&&(U.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),(0,S.v)(this._reflectivityTexture,U,"reflectivity")),this._metallicReflectanceTexture&&(U.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level),(0,S.v)(this._metallicReflectanceTexture,U,"metallicReflectance")),this._reflectanceTexture&&x.REFLECTANCE&&(U.updateFloat2("vReflectanceInfos",this._reflectanceTexture.coordinatesIndex,this._reflectanceTexture.level),(0,S.v)(this._reflectanceTexture,U,"reflectance")),this._microSurfaceTexture&&(U.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),(0,S.v)(this._microSurfaceTexture,U,"microSurfaceSampler"))),this._bumpTexture&&r.getCaps().standardDerivatives&&L.e.BumpTextureEnabled&&!this._disableBumpMap&&(U.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),(0,S.v)(this._bumpTexture,U,"bump"),o._mirroredCameraPosition?U.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):U.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&U.updateFloat("pointSize",this.pointSize),x.METALLICWORKFLOW){var p;v.k.Le[0].r=void 0===this._metallic||null===this._metallic?1:this._metallic,v.k.Le[0].g=void 0===this._roughness||null===this._roughness?1:this._roughness,U.updateColor4("vReflectivityColor",v.k.Le[0],1);const t=(null===(p=this.subSurface)||void 0===p?void 0:p._indexOfRefraction)??1.5,b=1,Y=Math.pow((t-b)/(t+b),2);this._metallicReflectanceColor.scaleToRef(Y*this._metallicF0Factor,v.k.Le[0]);const o=this._metallicF0Factor;U.updateColor4("vMetallicReflectanceFactors",v.k.Le[0],o)}else U.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);U.updateColor3("vEmissiveColor",L.e.EmissiveTextureEnabled?this._emissiveColor:v.d.BlackReadOnly),U.updateColor3("vReflectionColor",this._reflectionColor),!x.SS_REFRACTION&&null!==(C=this.subSurface)&&void 0!==C&&C._linkRefractionWithTransparency?U.updateColor4("vAlbedoColor",this._albedoColor,1):U.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*o.environmentIntensity,this._lightingInfos.w=this._specularIntensity,U.updateVector4("vLightingIntensity",this._lightingInfos),o.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor),U.updateColor3("vAmbientColor",this._globalAmbientColor),U.updateFloat2("vDebugMode",this.debugLimit,this.debugFactor)}o.texturesEnabled&&(this._albedoTexture&&L.e.DiffuseTextureEnabled&&U.setTexture("albedoSampler",this._albedoTexture),this._ambientTexture&&L.e.AmbientTextureEnabled&&U.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&L.e.OpacityTextureEnabled&&U.setTexture("opacitySampler",this._opacityTexture),E&&L.e.ReflectionTextureEnabled&&(x.LODBASEDMICROSFURACE?U.setTexture("reflectionSampler",E):(U.setTexture("reflectionSampler",E._lodTextureMid||E),U.setTexture("reflectionSamplerLow",E._lodTextureLow||E),U.setTexture("reflectionSamplerHigh",E._lodTextureHigh||E)),x.USEIRRADIANCEMAP&&U.setTexture("irradianceSampler",E.irradianceTexture)),x.ENVIRONMENTBRDF&&U.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&L.e.EmissiveTextureEnabled&&U.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&L.e.LightmapTextureEnabled&&U.setTexture("lightmapSampler",this._lightmapTexture),L.e.SpecularTextureEnabled&&(this._metallicTexture?U.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&U.setTexture("reflectivitySampler",this._reflectivityTexture),this._metallicReflectanceTexture&&U.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture),this._reflectanceTexture&&x.REFLECTANCE&&U.setTexture("reflectanceSampler",this._reflectanceTexture),this._microSurfaceTexture&&U.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&r.getCaps().standardDerivatives&&L.e.BumpTextureEnabled&&!this._disableBumpMap&&U.setTexture("bumpSampler",this._bumpTexture)),this.va().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(b)&&this.va().depthPeelingRenderer.bind(F),this._eventInfo.subMesh=Y,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,a.e)(this._activeEffect,this,o),this.bindEyePosition(F)}else o.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(R||!this.isFrozen){var W;if(o.lightsEnabled&&!this._disableLighting&&(0,S.j)(o,b,this._activeEffect,x,this._maxSimultaneousLights),(o.fogEnabled&&b.applyFog&&o.fogMode!==d.e.FOGMODE_NONE||E||this.subSurface.refractionTexture||b.receiveShadows||x.PREPASS)&&this.bindView(F),(0,S.h)(o,b,this._activeEffect,!0),x.NUM_MORPH_INFLUENCERS&&(0,S.q)(b,this._activeEffect),x.BAKED_VERTEX_ANIMATION_TEXTURE)null===(W=b.bakedVertexAnimationManager)||void 0===W||W.bind(F,x.INSTANCES);this._imageProcessingConfiguration.bind(this._activeEffect),(0,S.n)(x,this._activeEffect,o)}this._afterBind(b,this._activeEffect,Y),U.update()}getAnimatables(){const t=super.getAnimatables();return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&t.push(this._albedoTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&t.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&t.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&t.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&t.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?t.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&t.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&t.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&t.push(this._lightmapTexture),this._metallicReflectanceTexture&&this._metallicReflectanceTexture.animations&&this._metallicReflectanceTexture.animations.length>0&&t.push(this._metallicReflectanceTexture),this._reflectanceTexture&&this._reflectanceTexture.animations&&this._reflectanceTexture.animations.length>0&&t.push(this._reflectanceTexture),this._microSurfaceTexture&&this._microSurfaceTexture.animations&&this._microSurfaceTexture.animations.length>0&&t.push(this._microSurfaceTexture),t}_getReflectionTexture(){return this._reflectionTexture?this._reflectionTexture:this.va().environmentTexture}getActiveTextures(){const t=super.getActiveTextures();return this._albedoTexture&&t.push(this._albedoTexture),this._ambientTexture&&t.push(this._ambientTexture),this._opacityTexture&&t.push(this._opacityTexture),this._reflectionTexture&&t.push(this._reflectionTexture),this._emissiveTexture&&t.push(this._emissiveTexture),this._reflectivityTexture&&t.push(this._reflectivityTexture),this._metallicTexture&&t.push(this._metallicTexture),this._metallicReflectanceTexture&&t.push(this._metallicReflectanceTexture),this._reflectanceTexture&&t.push(this._reflectanceTexture),this._microSurfaceTexture&&t.push(this._microSurfaceTexture),this._bumpTexture&&t.push(this._bumpTexture),this._lightmapTexture&&t.push(this._lightmapTexture),t}hasTexture(t){return!!super.hasTexture(t)||(this._albedoTexture===t||(this._ambientTexture===t||(this._opacityTexture===t||(this._reflectionTexture===t||(this._emissiveTexture===t||(this._reflectivityTexture===t||(this._metallicTexture===t||(this._metallicReflectanceTexture===t||(this._reflectanceTexture===t||(this._microSurfaceTexture===t||(this._bumpTexture===t||this._lightmapTexture===t)))))))))))}setPrePassRenderer(){var t;if(null===(t=this.subSurface)||void 0===t||!t.isScatteringEnabled)return!1;const b=this.va().enableSubSurfaceForPrePass();return b&&(b.enabled=!0),!0}dispose(t,b){var Y,o,x,F,r,R,d,E,U,C,p,W;(this._breakShaderLoadedCheck=!0,b)&&(this._environmentBRDFTexture&&this.va().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),null===(Y=this._albedoTexture)||void 0===Y||Y.dispose(),null===(o=this._ambientTexture)||void 0===o||o.dispose(),null===(x=this._opacityTexture)||void 0===x||x.dispose(),null===(F=this._reflectionTexture)||void 0===F||F.dispose(),null===(r=this._emissiveTexture)||void 0===r||r.dispose(),null===(R=this._metallicTexture)||void 0===R||R.dispose(),null===(d=this._reflectivityTexture)||void 0===d||d.dispose(),null===(E=this._bumpTexture)||void 0===E||E.dispose(),null===(U=this._lightmapTexture)||void 0===U||U.dispose(),null===(C=this._metallicReflectanceTexture)||void 0===C||C.dispose(),null===(p=this._reflectanceTexture)||void 0===p||p.dispose(),null===(W=this._microSurfaceTexture)||void 0===W||W.dispose());this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(t,b)}}c.PBRMATERIAL_OPAQUE=J.e.MATERIAL_OPAQUE,c.PBRMATERIAL_ALPHATEST=J.e.MATERIAL_ALPHATEST,c.PBRMATERIAL_ALPHABLEND=J.e.MATERIAL_ALPHABLEND,c.PBRMATERIAL_ALPHATESTANDBLEND=J.e.MATERIAL_ALPHATESTANDBLEND,c.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,c.LIGHTFALLOFF_PHYSICAL=0,c.LIGHTFALLOFF_GLTF=1,c.LIGHTFALLOFF_STANDARD=2,c.ForceGLSL=!1,(0,o.e)([(0,x.t)()],c.prototype,"_imageProcessingConfiguration",void 0),(0,o.e)([(0,x.b)("_markAllSubMeshesAsMiscDirty")],c.prototype,"debugMode",void 0)},12380:(t,b,Y)=>{"use strict";Y.d(b,{b:()=>p});var o=Y(999),x=Y(1001),F=Y(1265),r=Y(1019),R=Y(1066),d=Y(990),E=Y(1041),U=Y(1013),C=Y(1224);Y(1618);class p extends R.b{set boundingBoxSize(t){if(this._boundingBoxSize&&this._boundingBoxSize.equals(t))return;this._boundingBoxSize=t;const b=this.va();b&&b.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(t){this._rotationY=t,this.setReflectionTextureMatrix(r.c.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(t,b,Y){let o="";return t.forEach((t=>o+=t)),new p(o,b,null,Y,t)}static CreateFromPrefilteredData(t,b){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const x=b.useDelayedTextureLoading;b.useDelayedTextureLoading=!1;const F=new p(t,b,null,!1,null,null,null,void 0,!0,Y,o);return b.useDelayedTextureLoading=x,F}constructor(t,b){var Y;let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,x=arguments.length>3&&void 0!==arguments[3]&&arguments[3],F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,R=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,E=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,C=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,p=arguments.length>8&&void 0!==arguments[8]&&arguments[8],W=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,T=arguments.length>10&&void 0!==arguments[10]&&arguments[10],y=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,v=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,B=arguments.length>13?arguments[13]:void 0,J=arguments.length>14?arguments[14]:void 0;super(b),this.onLoadObservable=new U.e,this.boundingBoxPosition=r.l.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new r.c,this._buffer=null,this.name=t,this.url=t,this._noMipmap=x,this.Cc=!1,this.isCube=!0,this._textureMatrix=r.c.Identity(),this.coordinatesMode=d.b.CUBIC_MODE;let m=null,K=null;null===o||Array.isArray(o)?(this._noMipmap=x,this._format=C,this._createPolynomials=T,m=o,this._loaderOptions=B,this._useSRGBBuffer=J,this._lodScale=y,this._lodOffset=v):(m=o.extensions??null,this._noMipmap=o.noMipmap??!1,F=o.files??null,K=o.buffer??null,this._format=o.format??5,p=o.prefiltered??!1,W=o.forcedExtension??null,this._createPolynomials=o.createPolynomials??!1,this._lodScale=o.lodScale??.8,this._lodOffset=o.lodOffset??0,this._loaderOptions=o.loaderOptions,this._useSRGBBuffer=o.useSRGBBuffer,R=o.X??null,E=o.onError??null),(t||F)&&this.updateURL(t,W,R,p,E,m,null===(Y=this.va())||void 0===Y?void 0:Y.useDelayedTextureLoading,F,K)}getClassName(){return"CubeTexture"}updateURL(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,F=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,r=arguments.length>6&&void 0!==arguments[6]&&arguments[6],R=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,d=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=t),this.url=t,b&&(this._forcedExtension=b);const E=t.lastIndexOf("."),U=b||(E>-1?t.substring(E).toLowerCase():""),C=0===U.indexOf(".dds"),p=0===U.indexOf(".env"),W=0===U.indexOf(".basis");if(p?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=o,o&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),R)this._files=R;else if(W||p||C||F||(F=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,F){for(let b=0;b<F.length;b++)this._files.push(t+F[b]);this._extensions=F}this._buffer=d,r?(this.delayLoadState=4,this._delayedOnLoad=Y,this._delayedOnError=x):this._loadTexture(Y,x)}delayLoad(t){4===this.delayLoadState&&(t&&(this._forcedExtension=t),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(t){var b,Y;if(t.updateFlag===this._textureMatrix.updateFlag)return;t.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(Y=this.va())||void 0===Y||Y.markAllMaterialsAsDirty(1,(t=>-1!==t.getActiveTextures().indexOf(this))));if(this._textureMatrix=t,null===(b=this.va())||void 0===b||!b.useRightHandedSystem)return;const o=r.f.ae[0],x=r.f.Quaternion[0],F=r.f.ae[1];this._textureMatrix.decompose(o,x,F),x.z*=-1,x.w*=-1,r.c.ComposeToRef(o,x,F,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var t;return null!==(t=this.va())&&void 0!==t&&t.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Y=this.va(),o=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const x=()=>{var b;(this.onLoadObservable.notifyObservers(this),o)&&(o.dispose(),null===(b=this.va())||void 0===b||b.markAllMaterialsAsDirty(1));t&&t()},r=(t,Y)=>{this._loadingError=!0,this._errorObject={message:t,exception:Y},b&&b(t,Y),d.b.OnTextureLoadErrorObservable.notifyObservers(this)};var R;this._texture?this._texture.isReady?F.f.SetImmediate((()=>x())):this._texture.onLoadedObservable.add((()=>x())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,Y,this._lodScale,this._lodOffset,t,r,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,Y,this._files,this._noMipmap,t,r,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(R=this._texture)||void 0===R||R.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(t,b,Y){const o=C.d.Parse((()=>{let o=!1;return t.prefiltered&&(o=t.prefiltered),new p(Y+(t.url??t.name),b,t.extensions,!1,t.files||null,null,null,void 0,o,t.forcedExtension)}),t,b);if(t.boundingBoxPosition&&(o.boundingBoxPosition=r.l.ce(t.boundingBoxPosition)),t.boundingBoxSize&&(o.boundingBoxSize=r.l.ce(t.boundingBoxSize)),t.animations)for(let x=0;x<t.animations.length;x++){const b=t.animations[x],Y=(0,E.b)("BABYLON.Animation");Y&&o.animations.push(Y.Parse(b))}return o}clone(){let t=0;const b=C.d.Clone((()=>{const b=new p(this.url,this.va()||this._getEngine(),this._extensions,this._noMipmap,this._files);return t=b.uniqueId,b}),this);return b.uniqueId=t,b}}(0,o.e)([(0,x.P)()],p.prototype,"url",void 0),(0,o.e)([(0,x.L)()],p.prototype,"boundingBoxPosition",void 0),(0,o.e)([(0,x.L)()],p.prototype,"boundingBoxSize",null),(0,o.e)([(0,x.P)("rotationY")],p.prototype,"rotationY",null),(0,o.e)([(0,x.P)("files")],p.prototype,"_files",void 0),(0,o.e)([(0,x.P)("forcedExtension")],p.prototype,"_forcedExtension",void 0),(0,o.e)([(0,x.P)("extensions")],p.prototype,"_extensions",void 0),(0,o.e)([(0,x.x)("textureMatrix")],p.prototype,"_textureMatrix",void 0),(0,o.e)([(0,x.x)("textureMatrixRefraction")],p.prototype,"_textureMatrixRefraction",void 0),d.b._CubeTextureParser=p.Parse,(0,E.d)("BABYLON.CubeTexture",p)},12706:(t,b,Y)=>{"use strict";Y.d(b,{d:()=>d});var o=Y(1144),x=Y(990),F=Y(1277),r=Y(1502),R=Y(1199);r.ThinEngine.prototype.createDynamicTexture=function(t,b,Y,o){const x=new R.e(this,4);return x.baseWidth=t,x.baseHeight=b,Y&&(t=this.needPOTTextures?(0,F.g)(t,this._caps.maxTextureSize):t,b=this.needPOTTextures?(0,F.g)(b,this._caps.maxTextureSize):b),x.width=t,x.height=b,x.isReady=!1,x.generateMipMaps=Y,x.samplingMode=o,this.updateTextureSamplingMode(o,x),this._internalTexturesCache.push(x),x},r.ThinEngine.prototype.updateDynamicTexture=function(t,b,Y){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],x=arguments.length>4?arguments[4]:void 0,F=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!t)return;const r=this._gl,R=r.TEXTURE_2D,d=this._bindTextureDirectly(R,t,!0,F);this._unpackFlipY(void 0===Y?t.invertY:Y),o&&r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const E=this._getWebGLTextureType(t.type),U=this._getInternalFormat(x||t.format),C=this._getRGBABufferInternalSizedFormat(t.type,U);r.texImage2D(R,0,C,U,E,b),t.generateMipMaps&&r.generateMipmap(R),d||this._bindTextureDirectly(R,null),o&&r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),x&&(t.format=x),t._dynamicTextureSource=b,t._premulAlpha=o,t.invertY=Y||!1,t.isReady=!0};class d extends x.b{constructor(t,b,Y){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,R=arguments.length>6?arguments[6]:void 0;const d=!Y||Y._isScene;super(null,d?Y:null===Y||void 0===Y?void 0:Y.Se,d?!o:Y,R,F,void 0,void 0,void 0,void 0,r),this.name=t,this.wrapU=x.b.CLAMP_ADDRESSMODE,this.wrapV=x.b.CLAMP_ADDRESSMODE,this._generateMipMaps=o;const E=this._getEngine();if(!E)return;if(b.getContext)this._canvas=b,this._ownCanvas=!1,this._texture=E.createDynamicTexture(this._canvas.width,this._canvas.height,o,F);else{this._canvas=E.createCanvas(1,1),this._ownCanvas=!0;const t=b;t.width||0===t.width?this._texture=E.createDynamicTexture(t.width,t.height,o,F):this._texture=E.createDynamicTexture(b,b,o,F)}const U=this.getSize();this._canvas.width!==U.width&&(this._canvas.width=U.width),this._canvas.height!==U.height&&(this._canvas.height=U.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(t){this._canvas.width=t.width,this._canvas.height=t.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(t.width,t.height,this._generateMipMaps,this.samplingMode)}scale(t){const b=this.getSize();b.width*=t,b.height*=t,this._recreate(b)}scaleTo(t,b){const Y=this.getSize();Y.width=t,Y.height=b,this._recreate(Y)}getContext(){return this._context}clear(t){const b=this.getSize();t&&(this._context.fillStyle=t),this._context.clearRect(0,0,b.width,b.height)}update(t){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===t||t,b,this._format||void 0,void 0,Y)}drawText(t,b,Y,o,x,F,r){let R=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const d=this.getSize();if(F&&(this._context.fillStyle=F,this._context.fillRect(0,0,d.width,d.height)),this._context.font=o,null===b||void 0===b){const Y=this._context.measureText(t);b=(d.width-Y.width)/2}if(null===Y||void 0===Y){const t=parseInt(o.replace(/\D/g,""));Y=d.height/2+t/3.65}this._context.fillStyle=x||"",this._context.fillText(t,b,Y),R&&this.update(r)}dispose(){var t,b;(super.dispose(),this._ownCanvas)&&(null===(t=this._canvas)||void 0===t||null===(b=t.remove)||void 0===b||b.call(t));this._canvas=null,this._context=null}clone(){const t=this.va();if(!t)return this;const b=this.getSize(),Y=new d(this.name,b,t,this._generateMipMaps);return Y.Cc=this.Cc,Y.level=this.level,Y.wrapU=this.wrapU,Y.wrapV=this.wrapV,Y}serialize(){const t=this.va();t&&!t.isReady()&&o.b.Warn("The scene must be ready before serializing the dynamic texture");const b=super.serialize();return d._IsCanvasElement(this._canvas)&&(b.base64String=this._canvas.toDataURL()),b.invertY=this._invertY,b.samplingMode=this.samplingMode,b}static _IsCanvasElement(t){return void 0!==t.toDataURL}_rebuild(){this.update()}}},11875:(t,b,Y)=>{"use strict";Y.d(b,{c:()=>x});var o=Y(990);class x extends o.b{constructor(t,b,Y,x,F){let r=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],R=arguments.length>6&&void 0!==arguments[6]&&arguments[6],d=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,E=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,U=arguments.length>9?arguments[9]:void 0,C=arguments.length>10?arguments[10]:void 0;super(null,F,!r,R,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,U),this.format=x,this._engine&&(this._engine._caps.textureFloatLinearFiltering||1!==E||(d=1),this._engine._caps.textureHalfFloatLinearFiltering||2!==E||(d=1),this._texture=this._engine.createRawTexture(t,b,Y,x,r,R,d,null,E,U??0,C??!1),this.wrapU=o.b.CLAMP_ADDRESSMODE,this.wrapV=o.b.CLAMP_ADDRESSMODE)}update(t){this._getEngine().updateRawTexture(this._texture,t,this._texture.format,this._texture.invertY,null,this._texture.type,this._texture._useSRGBBuffer)}clone(){if(!this._texture)return super.clone();const t=new x(null,this.getSize().width,this.getSize().height,this.format,this.va(),this._texture.generateMipMaps,this._invertY,this.samplingMode,this._texture.type,this._texture._creationFlags,this._useSRGBBuffer);return t._texture=this._texture,this._texture.incrementReferences(),t}static CreateLuminanceTexture(t,b,Y,o){return new x(t,b,Y,1,o,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateLuminanceAlphaTexture(t,b,Y,o){return new x(t,b,Y,2,o,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateAlphaTexture(t,b,Y,o){return new x(t,b,Y,0,o,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateRGBTexture(t,b,Y,o){return new x(t,b,Y,4,o,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBATexture(t,b,Y,o){return new x(t,b,Y,5,o,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBAStorageTexture(t,b,Y,o){return new x(t,b,Y,5,o,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,1,arguments.length>8&&void 0!==arguments[8]&&arguments[8])}static CreateRTexture(t,b,Y,F){let r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],R=arguments.length>5&&void 0!==arguments[5]&&arguments[5],d=arguments.length>6&&void 0!==arguments[6]?arguments[6]:o.b.TRILINEAR_SAMPLINGMODE;return new x(t,b,Y,6,F,r,R,d,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1)}static CreateRStorageTexture(t,b,Y,F){let r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],R=arguments.length>5&&void 0!==arguments[5]&&arguments[5],d=arguments.length>6&&void 0!==arguments[6]?arguments[6]:o.b.TRILINEAR_SAMPLINGMODE;return new x(t,b,Y,6,F,r,R,d,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,1)}}},11795:(t,b,Y)=>{"use strict";Y.d(b,{d:()=>r});var o=Y(1394),x=Y(1227),F=Y(1041);class r extends o.e{get yg(){return this._subMaterials}set yg(t){this._subMaterials=t,this._hookArray(t)}getChildren(){return this.yg}constructor(t,b){super(t,b,!0),this._waitingSubMaterialsUniqueIds=[],this.va().addMultiMaterial(this),this.yg=[],this._storeEffectOnSubMeshes=!0}_hookArray(t){var b=this;const Y=t.push;t.push=function(){for(var o=arguments.length,x=new Array(o),F=0;F<o;F++)x[F]=arguments[F];const r=Y.apply(t,x);return b._markAllSubMeshesAsTexturesDirty(),r};const o=t.splice;t.splice=(b,Y)=>{const x=o.apply(t,[b,Y]);return this._markAllSubMeshesAsTexturesDirty(),x}}getSubMaterial(t){return t<0||t>=this.yg.length?this.va().defaultMaterial:this.yg[t]}getActiveTextures(){return super.getActiveTextures().concat(...this.yg.map((t=>t?t.getActiveTextures():[])))}hasTexture(t){if(super.hasTexture(t))return!0;for(let Y=0;Y<this.yg.length;Y++){var b;if(null!==(b=this.yg[Y])&&void 0!==b&&b.hasTexture(t))return!0}return!1}getClassName(){return"MultiMaterial"}isReadyForSubMesh(t,b,Y){for(let o=0;o<this.yg.length;o++){const x=this.yg[o];if(x){if(x._storeEffectOnSubMeshes){if(!x.isReadyForSubMesh(t,b,Y))return!1;continue}if(!x.isReady(t))return!1}}return!0}clone(t,b){const Y=new r(t,this.va());for(let o=0;o<this.yg.length;o++){let x=null;const F=this.yg[o];x=b&&F?F.clone(t+"-"+F.name):this.yg[o],Y.yg.push(x)}return Y}serialize(){const t={};t.name=this.name,t.id=this.id,t.uniqueId=this.uniqueId,x.b&&(t.tags=x.b.GetTags(this)),t.materialsUniqueIds=[],t.materials=[];for(let b=0;b<this.yg.length;b++){const Y=this.yg[b];Y?(t.materialsUniqueIds.push(Y.uniqueId),t.materials.push(Y.id)):(t.materialsUniqueIds.push(null),t.materials.push(null))}return t}dispose(t,b,Y){const o=this.va();if(!o)return;if(Y)for(let F=0;F<this.yg.length;F++){const Y=this.yg[F];Y&&Y.dispose(t,b)}const x=o.multiMaterials.indexOf(this);x>=0&&o.multiMaterials.splice(x,1),super.dispose(t,b)}static ParseMultiMaterial(t,b){const Y=new r(t.name,b);return Y.id=t.id,Y._loadedUniqueId=t.uniqueId,x.b&&x.b.AddTagsTo(Y,t.tags),t.materialsUniqueIds?Y._waitingSubMaterialsUniqueIds=t.materialsUniqueIds:t.materials.forEach((t=>Y.yg.push(b.getLastMaterialById(t)))),Y}}(0,F.d)("BABYLON.MultiMaterial",r)},11798:(t,b,Y)=>{"use strict";Y.d(b,{c:()=>U,d:()=>E});var o=Y(1019),x=Y(1229),F=Y(11737),r=Y(11766),R=Y(1240);Y(11800);function d(t){let b=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const Y=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],F=[];let d=[];const E=t.width||t.size||1,U=t.height||t.size||1,C=t.depth||t.size||1,p=t.wrap||!1;let W=void 0===t.topBaseAt?1:t.topBaseAt,T=void 0===t.bottomBaseAt?0:t.bottomBaseAt;W=(W+4)%4,T=(T+4)%4;let y=[2,0,3,1][W],v=[2,0,1,3][T],B=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(p){b=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],B=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let t=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],Y=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const o=[17,18,19,16],x=[22,23,20,21];for(;y>0;)t.unshift(t.pop()),o.unshift(o.pop()),y--;for(;v>0;)Y.unshift(Y.pop()),x.unshift(x.pop()),v--;t=t.flat(),Y=Y.flat(),B=B.concat(t).concat(Y),b.push(o[0],o[2],o[3],o[0],o[1],o[2]),b.push(x[0],x[2],x[3],x[0],x[1],x[2])}const J=[E/2,U/2,C/2];d=B.reduce(((t,b,Y)=>t.concat(b*J[Y%3])),[]);const m=0===t.sideOrientation?0:t.sideOrientation||r.c.DEFAULTSIDE,K=t.faceUV||new Array(6),L=t.faceColors,z=[];for(let r=0;r<6;r++)void 0===K[r]&&(K[r]=new o.m(0,0,1,1)),L&&void 0===L[r]&&(L[r]=new x.h(1,1,1,1));for(let o=0;o<6;o++)if(F.push(K[o].z,R.c?1-K[o].w:K[o].w),F.push(K[o].x,R.c?1-K[o].w:K[o].w),F.push(K[o].x,R.c?1-K[o].y:K[o].y),F.push(K[o].z,R.c?1-K[o].y:K[o].y),L)for(let t=0;t<4;t++)z.push(L[o].r,L[o].g,L[o].b,L[o].a);r.c._ComputeSides(m,d,b,Y,F,t.frontUVs,t.backUVs);const S=new r.c;if(S.indices=b,S.xa=d,S.ya=Y,S.Aa=F,L){const t=m===r.c.DOUBLESIDE?z.concat(z):z;S.za=t}return S}function E(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=new F.d(t,Y);b.sideOrientation=F.d._GetDefaultSideOrientation(b.sideOrientation),o._originalBuilderSideOrientation=b.sideOrientation;return d(b).Ca(o,b.updatable),o}const U={CreateBox:E};r.c.CreateBox=d,F.d.CreateBox=function(t,b){return E(t,{size:b,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},11891:(t,b,Y)=>{"use strict";Y.d(b,{c:()=>R});var o=Y(11737),x=Y(11766),F=Y(1240);function r(t){const b=[],Y=[],o=[],r=[],R=t.i||.5,d=t.Ok||64,E=t.arc&&(t.arc<=0||t.arc>1)?1:t.arc||1,U=0===t.sideOrientation?0:t.sideOrientation||x.c.DEFAULTSIDE;b.push(0,0,0),r.push(.5,.5);const C=2*Math.PI*E,p=1===E?C/d:C/(d-1);let W=0;for(let x=0;x<d;x++){const t=Math.cos(W),Y=Math.sin(W),o=(t+1)/2,x=(1-Y)/2;b.push(R*t,R*Y,0),r.push(o,F.c?1-x:x),W+=p}1===E&&(b.push(b[3],b[4],b[5]),r.push(r[2],F.c?1-r[3]:r[3]));const T=b.length/3;for(let x=1;x<T-1;x++)Y.push(x+1,0,x);x.c.ComputeNormals(b,Y,o),x.c._ComputeSides(U,b,Y,o,r,t.frontUVs,t.backUVs);const y=new x.c;return y.indices=Y,y.xa=b,y.ya=o,y.Aa=r,y}function R(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const x=new o.d(t,Y);b.sideOrientation=o.d._GetDefaultSideOrientation(b.sideOrientation),x._originalBuilderSideOrientation=b.sideOrientation;return r(b).Ca(x,b.updatable),x}x.c.kb=r,o.d.kb=function(t,b,Y){return R(t,{i:b,Ok:Y,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},11800:(t,b,Y)=>{"use strict";Y.d(b,{f:()=>v,c:()=>J,g:()=>B});var o=Y(1019),x=Y(1229),F=Y(11737),r=Y(11766),R=Y(1307);F.d._GroundMeshParser=(t,b)=>d.Parse(t,b);class d extends F.d{constructor(t,b){super(t,b),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=t,this._subdivisionsY=t,this.subdivide(t);const Y=this;Y.createOrUpdateSubmeshesOctree&&Y.createOrUpdateSubmeshesOctree(b)}getHeightAtCoordinates(t,b){const Y=this.getWorldMatrix(),x=o.f.Matrix[5];Y.invertToRef(x);const F=o.f.ae[8];if(o.l.TransformCoordinatesFromFloatsToRef(t,0,b,x,F),t=F.x,b=F.z,t<this._minX||t>=this._maxX||b<=this._minZ||b>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const r=this._getFacetAt(t,b),R=-(r.x*t+r.z*b+r.w)/r.y;return o.l.TransformCoordinatesFromFloatsToRef(0,R,0,Y,F),F.y}getNormalAtCoordinates(t,b){const Y=new o.l(0,1,0);return this.getNormalAtCoordinatesToRef(t,b,Y),Y}getNormalAtCoordinatesToRef(t,b,Y){const x=this.getWorldMatrix(),F=o.f.Matrix[5];x.invertToRef(F);const r=o.f.ae[8];if(o.l.TransformCoordinatesFromFloatsToRef(t,0,b,F,r),t=r.x,b=r.z,t<this._minX||t>this._maxX||b<this._minZ||b>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const R=this._getFacetAt(t,b);return o.l.TransformNormalFromFloatsToRef(R.x,R.y,R.z,x,Y),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(t,b){const Y=Math.floor((t+this._maxX)*this._subdivisionsX/this._width),o=Math.floor(-(b+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),x=this._heightQuads[o*this._subdivisionsX+Y];let F;return F=b<x.slope.x*t+x.slope.y?x.facet1:x.facet2,F}_initHeightQuads(){const t=this._subdivisionsX,b=this._subdivisionsY;this._heightQuads=new Array;for(let Y=0;Y<b;Y++)for(let b=0;b<t;b++){const x={slope:o.i.Zero(),facet1:new o.m(0,0,0,0),facet2:new o.m(0,0,0,0)};this._heightQuads[Y*t+b]=x}return this}_computeHeightQuads(){const t=this.getVerticesData(R.e.PositionKind);if(!t)return this;const b=o.f.ae[3],Y=o.f.ae[2],x=o.f.ae[1],F=o.f.ae[0],r=o.f.ae[4],d=o.f.ae[5],E=o.f.ae[6],U=o.f.ae[7],C=o.f.ae[8];let p=0,W=0,T=0,y=0,v=0,B=0,J=0;const m=this._subdivisionsX,K=this._subdivisionsY;for(let R=0;R<K;R++)for(let K=0;K<m;K++){p=3*K,W=R*(m+1)*3,T=(R+1)*(m+1)*3,b.x=t[W+p],b.y=t[W+p+1],b.z=t[W+p+2],Y.x=t[W+p+3],Y.y=t[W+p+4],Y.z=t[W+p+5],x.x=t[T+p],x.y=t[T+p+1],x.z=t[T+p+2],F.x=t[T+p+3],F.y=t[T+p+4],F.z=t[T+p+5],y=(F.z-b.z)/(F.x-b.x),v=b.z-y*b.x,Y.subtractToRef(b,r),x.subtractToRef(b,d),F.subtractToRef(b,E),o.l.CrossToRef(E,d,U),o.l.CrossToRef(r,E,C),U.normalize(),C.normalize(),B=-(U.x*b.x+U.y*b.y+U.z*b.z),J=-(C.x*Y.x+C.y*Y.y+C.z*Y.z);const L=this._heightQuads[R*m+K];L.slope.be(y,v),L.facet1.be(U.x,U.y,U.z,B),L.facet2.be(C.x,C.y,C.z,J)}return this}serialize(t){super.serialize(t),t.subdivisionsX=this._subdivisionsX,t.subdivisionsY=this._subdivisionsY,t.minX=this._minX,t.maxX=this._maxX,t._i=this._minZ,t.maxZ=this._maxZ,t.width=this._width,t.height=this._height}static Parse(t,b){const Y=new d(t.name,b);return Y._subdivisionsX=t.subdivisionsX||1,Y._subdivisionsY=t.subdivisionsY||1,Y._minX=t.minX,Y._maxX=t.maxX,Y._minZ=t._i,Y._maxZ=t.maxZ,Y._width=t.width,Y._height=t.height,Y}}var E=Y(1265),U=Y(1051),C=Y(1028),p=Y(1240);function W(t){const b=[],Y=[],x=[],F=[];let R,d;const E=t.width||t.size||1,U=t.height||t.size||1,C=0|(t.subdivisionsX||t.subdivisions||1),W=0|(t.subdivisionsY||t.subdivisions||1);for(R=0;R<=W;R++)for(d=0;d<=C;d++){const t=new o.l(d*E/C-E/2,0,(W-R)*U/W-U/2),b=new o.l(0,1,0);Y.push(t.x,t.y,t.z),x.push(b.x,b.y,b.z),F.push(d/C,p.c?R/W:1-R/W)}for(R=0;R<W;R++)for(d=0;d<C;d++)b.push(d+1+(R+1)*(C+1)),b.push(d+1+R*(C+1)),b.push(d+R*(C+1)),b.push(d+(R+1)*(C+1)),b.push(d+1+(R+1)*(C+1)),b.push(d+R*(C+1));const T=new r.c;return T.indices=b,T.xa=Y,T.ya=x,T.Aa=F,T}function T(t){const b=void 0!==t.xmin&&null!==t.xmin?t.xmin:-1,Y=void 0!==t.zmin&&null!==t.zmin?t.zmin:-1,x=void 0!==t.xmax&&null!==t.xmax?t.xmax:1,F=void 0!==t.zmax&&null!==t.zmax?t.zmax:1,R=t.subdivisions||{w:1,h:1},d=t.precision||{w:1,h:1},E=[],U=[],C=[],p=[];let W,T,y,v;R.h=R.h<1?1:R.h,R.w=R.w<1?1:R.w,d.w=d.w<1?1:d.w,d.h=d.h<1?1:d.h;const B=(x-b)/R.w,J=(F-Y)/R.h;function m(t,b,Y,x){const F=U.length/3,r=d.w+1;for(W=0;W<d.h;W++)for(T=0;T<d.w;T++){const t=[F+T+W*r,F+(T+1)+W*r,F+(T+1)+(W+1)*r,F+T+(W+1)*r];E.push(t[1]),E.push(t[2]),E.push(t[3]),E.push(t[0]),E.push(t[1]),E.push(t[3])}const R=o.l.Zero(),y=new o.l(0,1,0);for(W=0;W<=d.h;W++)for(R.z=W*(x-b)/d.h+b,T=0;T<=d.w;T++)R.x=T*(Y-t)/d.w+t,R.y=0,U.push(R.x,R.y,R.z),C.push(y.x,y.y,y.z),p.push(T/d.w,W/d.h)}for(y=0;y<R.h;y++)for(v=0;v<R.w;v++)m(b+v*B,Y+y*J,b+(v+1)*B,Y+(y+1)*J);const K=new r.c;return K.indices=E,K.xa=U,K.ya=C,K.Aa=p,K}function y(t){const b=[],Y=[],F=[],R=[];let d,E;const U=t.colorFilter||new x.d(.3,.59,.11),p=t.alphaFilter||0;let W=!1;if(t.minHeight>t.maxHeight){W=!0;const b=t.maxHeight;t.maxHeight=t.minHeight,t.minHeight=b}for(d=0;d<=t.subdivisions;d++)for(E=0;E<=t.subdivisions;E++){const b=new o.l(E*t.width/t.subdivisions-t.width/2,0,(t.subdivisions-d)*t.height/t.subdivisions-t.height/2),x=4*(((b.x+t.width/2)/t.width*(t.bufferWidth-1)|0)+((1-(b.z+t.height/2)/t.height)*(t.bufferHeight-1)|0)*t.bufferWidth);let r=t.buffer[x]/255,T=t.buffer[x+1]/255,y=t.buffer[x+2]/255;const v=t.buffer[x+3]/255;W&&(r=1-r,T=1-T,y=1-y);const B=r*U.r+T*U.g+y*U.b;b.y=v>=p?t.minHeight+(t.maxHeight-t.minHeight)*B:t.minHeight-C.e,t.heightBuffer&&(t.heightBuffer[d*(t.subdivisions+1)+E]=b.y),Y.push(b.x,b.y,b.z),F.push(0,0,0),R.push(E/t.subdivisions,1-d/t.subdivisions)}for(d=0;d<t.subdivisions;d++)for(E=0;E<t.subdivisions;E++){const o=E+1+(d+1)*(t.subdivisions+1),x=E+1+d*(t.subdivisions+1),F=E+d*(t.subdivisions+1),r=E+(d+1)*(t.subdivisions+1),R=Y[3*o+1]>=t.minHeight,U=Y[3*x+1]>=t.minHeight,C=Y[3*F+1]>=t.minHeight;R&&U&&C&&(b.push(o),b.push(x),b.push(F));Y[3*r+1]>=t.minHeight&&R&&C&&(b.push(r),b.push(o),b.push(F))}r.c.ComputeNormals(Y,b,F);const T=new r.c;return T.indices=b,T.xa=Y,T.ya=F,T.Aa=R,T}function v(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const Y=new d(t,arguments.length>2?arguments[2]:void 0);Y._setReady(!1),Y._subdivisionsX=b.subdivisionsX||b.subdivisions||1,Y._subdivisionsY=b.subdivisionsY||b.subdivisions||1,Y._width=b.width||1,Y._height=b.height||1,Y._maxX=Y._width/2,Y._maxZ=Y._height/2,Y._minX=-Y._maxX,Y._minZ=-Y._maxZ;return W(b).Ca(Y,b.updatable),Y._setReady(!0),Y}function B(t,b){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=new F.d(t,Y);return T(b).Ca(o,b.updatable),o}function J(t,b){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const F=Y.width||10,r=Y.height||10,R=Y.subdivisions||1,C=Y.minHeight||0,p=Y.maxHeight||1,W=Y.colorFilter||new x.d(.3,.59,.11),T=Y.alphaFilter||0,v=Y.updatable,B=Y.onReady;o=o||U.d.LastCreatedScene;const J=new d(t,o);let m;J._subdivisionsX=R,J._subdivisionsY=R,J._width=F,J._height=r,J._maxX=J._width/2,J._maxZ=J._height/2,J._minX=-J._maxX,J._minZ=-J._maxZ,J._setReady(!1),Y.passHeightBufferInCallback&&(m=new Float32Array((R+1)*(R+1)));const K=(t,b,Y)=>{y({width:F,height:r,subdivisions:R,minHeight:C,maxHeight:p,colorFilter:W,buffer:t,bufferWidth:b,bufferHeight:Y,alphaFilter:T,heightBuffer:m}).Ca(J,v),B&&B(J,m),J._setReady(!0)};if("string"===typeof b){const t=t=>{var b;const Y=t.width,x=t.height;if(o.u)return;const F=null===(b=o)||void 0===b?void 0:b.getEngine().resizeImageBitmap(t,Y,x);K(F,Y,x)};E.f.LoadImage(b,t,Y.onError?Y.onError:()=>{},o.offlineProvider)}else K(b.data,b.width,b.height);return J}r.c.CreateGround=W,r.c.CreateTiledGround=T,r.c.CreateGroundFromHeightMap=y,F.d.CreateGround=(t,b,Y,o,x,F)=>v(t,{width:b,height:Y,subdivisions:o,updatable:F},x),F.d.CreateTiledGround=(t,b,Y,o,x,F,r,R,d)=>B(t,{xmin:b,zmin:Y,xmax:o,zmax:x,subdivisions:F,precision:r,updatable:d},R),F.d.CreateGroundFromHeightMap=(t,b,Y,o,x,F,r,R,d,E,U)=>J(t,b,{width:Y,height:o,subdivisions:x,minHeight:F,maxHeight:r,updatable:d,onReady:E,alphaFilter:U},R)},12699:(t,b,Y)=>{"use strict";Y.d(b,{d:()=>n,e:()=>H,h:()=>f});var o=Y(1019),x=Y(11737),F=Y(11766),r=Y(1229),R=Y(1307),d=Y(12359),E=Y(1394),U=Y(1224),C=Y(1260),p=Y(990),W=Y(1041),T=Y(1469),y=Y(1086),v=Y(1461),B=Y(1051),J=Y(1446),m=Y(1438);const K={effect:null,subMesh:null};class L extends v.b{constructor(t,b,Y){let x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(t,b,!(arguments.length>4&&void 0!==arguments[4])||arguments[4]),this._textures={},this._textureArrays={},this._externalTextures={},this._floats={},this._ints={},this._uints={},this._floatsArrays={},this._colors3={},this._colors3Arrays={},this._colors4={},this._colors4Arrays={},this._vectors2={},this._vectors3={},this._vectors4={},this._quaternions={},this._quaternionsArrays={},this._matrices={},this._matrixArrays={},this._matrices3x3={},this._matrices2x2={},this._vectors2Arrays={},this._vectors3Arrays={},this._vectors4Arrays={},this._uniformBuffers={},this._textureSamplers={},this._storageBuffers={},this._cachedWorldViewMatrix=new o.c,this._cachedWorldViewProjectionMatrix=new o.c,this._multiview=!1,this._materialHelperNeedsPreviousMatrices=!1,this._shaderPath=Y,this._options={needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","xe","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],externalTextures:[],samplerObjects:[],storageBuffers:[],defines:[],useClipPlane:!1,...x}}get shaderPath(){return this._shaderPath}set shaderPath(t){this._shaderPath=t}get options(){return this._options}get isMultiview(){return this._multiview}getClassName(){return"ShaderMaterial"}needAlphaBlending(){return this.alpha<1||this._options.needAlphaBlending}needAlphaTesting(){return this._options.needAlphaTesting}_checkUniform(t){-1===this._options.uniforms.indexOf(t)&&this._options.uniforms.push(t)}setTexture(t,b){return-1===this._options.samplers.indexOf(t)&&this._options.samplers.push(t),this._textures[t]=b,this}removeTexture(t){delete this._textures[t]}setTextureArray(t,b){return-1===this._options.samplers.indexOf(t)&&this._options.samplers.push(t),this._checkUniform(t),this._textureArrays[t]=b,this}setExternalTexture(t,b){return-1===this._options.externalTextures.indexOf(t)&&this._options.externalTextures.push(t),this._externalTextures[t]=b,this}setFloat(t,b){return this._checkUniform(t),this._floats[t]=b,this}setInt(t,b){return this._checkUniform(t),this._ints[t]=b,this}setUInt(t,b){return this._checkUniform(t),this._uints[t]=b,this}setFloats(t,b){return this._checkUniform(t),this._floatsArrays[t]=b,this}setColor3(t,b){return this._checkUniform(t),this._colors3[t]=b,this}setColor3Array(t,b){return this._checkUniform(t),this._colors3Arrays[t]=b.reduce(((t,b)=>(b.toArray(t,t.length),t)),[]),this}setColor4(t,b){return this._checkUniform(t),this._colors4[t]=b,this}setColor4Array(t,b){return this._checkUniform(t),this._colors4Arrays[t]=b.reduce(((t,b)=>(b.toArray(t,t.length),t)),[]),this}setVector2(t,b){return this._checkUniform(t),this._vectors2[t]=b,this}setVector3(t,b){return this._checkUniform(t),this._vectors3[t]=b,this}setVector4(t,b){return this._checkUniform(t),this._vectors4[t]=b,this}setQuaternion(t,b){return this._checkUniform(t),this._quaternions[t]=b,this}setQuaternionArray(t,b){return this._checkUniform(t),this._quaternionsArrays[t]=b.reduce(((t,b)=>(b.toArray(t,t.length),t)),[]),this}setMatrix(t,b){return this._checkUniform(t),this._matrices[t]=b,this}setMatrices(t,b){this._checkUniform(t);const Y=new Float32Array(16*b.length);for(let o=0;o<b.length;o++){b[o].copyToArray(Y,16*o)}return this._matrixArrays[t]=Y,this}setMatrix3x3(t,b){return this._checkUniform(t),this._matrices3x3[t]=b,this}setMatrix2x2(t,b){return this._checkUniform(t),this._matrices2x2[t]=b,this}setArray2(t,b){return this._checkUniform(t),this._vectors2Arrays[t]=b,this}setArray3(t,b){return this._checkUniform(t),this._vectors3Arrays[t]=b,this}setArray4(t,b){return this._checkUniform(t),this._vectors4Arrays[t]=b,this}setUniformBuffer(t,b){return-1===this._options.uniformBuffers.indexOf(t)&&this._options.uniformBuffers.push(t),this._uniformBuffers[t]=b,this}setTextureSampler(t,b){return-1===this._options.samplerObjects.indexOf(t)&&this._options.samplerObjects.push(t),this._textureSamplers[t]=b,this}setStorageBuffer(t,b){return-1===this._options.storageBuffers.indexOf(t)&&this._options.storageBuffers.push(t),this._storageBuffers[t]=b,this}setDefine(t,b){const Y=t.trimEnd()+" ",o=this.options.defines.findIndex((b=>b===t||b.startsWith(Y)));return o>=0&&this.options.defines.splice(o,1),("boolean"!==typeof b||b)&&this.options.defines.push(Y+b),this}isReadyForSubMesh(t,b,Y){return this.isReady(t,Y,b)}isReady(t,b,Y){var o;const x=Y&&this._storeEffectOnSubMeshes;if(this.isFrozen){const t=x?Y._drawWrapper:this._drawWrapper;if(t.effect&&t._wasPreviouslyReady&&t._wasPreviouslyUsingInstances===b)return!0}const F=this.va(),r=F.getEngine(),d=[],E=[],U=new T.b;let p=this._shaderPath,W=this._options.uniforms,y=this._options.uniformBuffers,v=this._options.samplers;r.getCaps().multiview&&F.activeCamera&&F.activeCamera.outputRenderTarget&&F.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,d.push("#define MULTIVIEW"),-1!==W.indexOf("viewProjection")&&-1===W.indexOf("viewProjectionR")&&W.push("viewProjectionR"));for(let R=0;R<this._options.defines.length;R++){const t=0===this._options.defines[R].indexOf("#define")?this._options.defines[R]:`#define ${this._options.defines[R]}`;d.push(t)}for(let R=0;R<this._options.attributes.length;R++)E.push(this._options.attributes[R]);if(t&&t.isVerticesDataPresent(R.e.ColorKind)&&(-1===E.indexOf(R.e.ColorKind)&&E.push(R.e.ColorKind),d.push("#define VERTEXCOLOR")),b&&(d.push("#define INSTANCES"),(0,m.Y)(E,this._materialHelperNeedsPreviousMatrices),null!==t&&void 0!==t&&t.hasThinInstances&&(d.push("#define THIN_INSTANCES"),t&&t.isVerticesDataPresent(R.e.ColorInstanceKind)&&(E.push(R.e.ColorInstanceKind),d.push("#define INSTANCESCOLOR")))),t&&t.useBones&&t.computeBonesUsingShaders&&t.skeleton){E.push(R.e.MatricesIndicesKind),E.push(R.e.MatricesWeightsKind),t.numBoneInfluencers>4&&(E.push(R.e.MatricesIndicesExtraKind),E.push(R.e.MatricesWeightsExtraKind));const b=t.skeleton;d.push("#define NUM_BONE_INFLUENCERS "+t.numBoneInfluencers),U.addCPUSkinningFallback(0,t),b.isUsingTextureForMatrices?(d.push("#define BONETEXTURE"),-1===W.indexOf("boneTextureWidth")&&W.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(d.push("#define BonesPerMesh "+(b.bones.length+1)),-1===W.indexOf("mBones")&&W.push("mBones"))}else d.push("#define NUM_BONE_INFLUENCERS 0");let B=0;const L=t?t.morphTargetManager:null;if(L){const t=L.supportsUVs&&-1!==d.indexOf("#define UV1"),b=L.supportsTangents&&-1!==d.indexOf("#define TANGENT"),Y=L.supportsNormals&&-1!==d.indexOf("#define NORMAL");B=L.numMaxInfluencers||L.numInfluencers,t&&d.push("#define MORPHTARGETS_UV"),b&&d.push("#define MORPHTARGETS_TANGENT"),Y&&d.push("#define MORPHTARGETS_NORMAL"),B>0&&d.push("#define MORPHTARGETS"),L.isUsingTextureForTargets&&(d.push("#define MORPHTARGETS_TEXTURE"),-1===W.indexOf("morphTargetTextureIndices")&&W.push("morphTargetTextureIndices"),-1===this._options.samplers.indexOf("morphTargets")&&this._options.samplers.push("morphTargets")),d.push("#define NUM_MORPH_INFLUENCERS "+B);for(let o=0;o<B;o++)E.push(R.e.PositionKind+o),Y&&E.push(R.e.NormalKind+o),b&&E.push(R.e.TangentKind+o),t&&E.push(R.e.UVKind+"_"+o);B>0&&(W=W.slice(),W.push("morphTargetInfluences"),W.push("morphTargetCount"),W.push("morphTargetTextureInfo"),W.push("morphTargetTextureIndices"))}else d.push("#define NUM_MORPH_INFLUENCERS 0");if(t){const b=t.bakedVertexAnimationManager;b&&b.isEnabled&&(d.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),-1===W.indexOf("bakedVertexAnimationSettings")&&W.push("bakedVertexAnimationSettings"),-1===W.indexOf("bakedVertexAnimationTextureSizeInverted")&&W.push("bakedVertexAnimationTextureSizeInverted"),-1===W.indexOf("bakedVertexAnimationTime")&&W.push("bakedVertexAnimationTime"),-1===this._options.samplers.indexOf("bakedVertexAnimationTexture")&&this._options.samplers.push("bakedVertexAnimationTexture")),(0,m.A)(E,t,d)}for(const R in this._textures)if(!this._textures[R].isReady())return!1;t&&this._shouldTurnAlphaTestOn(t)&&d.push("#define ALPHATEST"),!1!==this._options.useClipPlane&&((0,J.b)(W),(0,J.k)(this,F,d)),F.fogEnabled&&null!==t&&void 0!==t&&t.applyFog&&F.fogMode!==C.e.FOGMODE_NONE&&(d.push("#define FOG"),-1===W.indexOf("view")&&W.push("view"),-1===W.indexOf("vFogInfos")&&W.push("vFogInfos"),-1===W.indexOf("vFogColor")&&W.push("vFogColor")),this._useLogarithmicDepth&&(d.push("#define LOGARITHMICDEPTH"),-1===W.indexOf("logarithmicDepthConstant")&&W.push("logarithmicDepthConstant")),this.customShaderNameResolve&&(W=W.slice(),y=y.slice(),v=v.slice(),p=this.customShaderNameResolve(this.name,W,y,v,d,E));const z=x?Y._getDrawWrapper(void 0,!0):this._drawWrapper,S=(null===z||void 0===z?void 0:z.effect)??null,e=(null===z||void 0===z?void 0:z.defines)??null,g=d.join("\n");let D=S;return e!==g&&(D=r.createEffect(p,{attributes:E,uniformsNames:W,uniformBuffersNames:y,samplers:v,defines:g,fallbacks:U,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousMorphTargets:B},shaderLanguage:this._options.shaderLanguage,extraInitializationsAsync:this._options.extraInitializationsAsync},r),x?Y.setEffect(D,g,this._materialContext):z&&z.setEffect(D,g),this._onEffectCreatedObservable&&(K.effect=D,K.subMesh=Y??(null===t||void 0===t?void 0:t.ne[0])??null,this._onEffectCreatedObservable.notifyObservers(K))),z._wasPreviouslyUsingInstances=!!b,!((null===(o=D)||void 0===o||!o.isReady())??1)&&(S!==D&&F.resetCachedMaterial(),z._wasPreviouslyReady=!0,!0)}bindOnlyWorldMatrix(t,b){const Y=this.va(),o=b??this.getEffect();o&&(-1!==this._options.uniforms.indexOf("world")&&o.setMatrix("world",t),-1!==this._options.uniforms.indexOf("worldView")&&(t.multiplyToRef(Y.getViewMatrix(),this._cachedWorldViewMatrix),o.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==this._options.uniforms.indexOf("worldViewProjection")&&(t.multiplyToRef(Y.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),o.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)),-1!==this._options.uniforms.indexOf("view")&&o.setMatrix("view",Y.getViewMatrix()))}bindForSubMesh(t,b,Y){var o;this.bind(t,b,null===(o=Y._drawWrapperOverride)||void 0===o?void 0:o.effect,Y)}bind(t,b,Y,o){const x=o&&this._storeEffectOnSubMeshes,F=Y??(x?o.effect:this.getEffect());if(!F)return;const r=this.va();this._activeEffect=F,this.bindOnlyWorldMatrix(t,Y);const R=this._options.uniformBuffers;let d=!1;if(F&&R&&R.length>0&&r.getEngine().supportsUniformBuffers)for(let C=0;C<R.length;++C){switch(R[C]){case"Mesh":b&&(b.getMeshUniformBuffer().bindToEffect(F,"Mesh"),b.transferToEffect(t));break;case"Scene":(0,m.t)(F,r.getSceneUniformBuffer()),r.finalizeSceneUbo(),d=!0}}const E=b&&x?this._mustRebind(r,F,o,b.visibility):r.getCachedMaterial()!==this;if(F&&E){let t;for(t in d||-1===this._options.uniforms.indexOf("view")||F.setMatrix("view",r.getViewMatrix()),d||-1===this._options.uniforms.indexOf("projection")||F.setMatrix("projection",r.getProjectionMatrix()),d||-1===this._options.uniforms.indexOf("viewProjection")||(F.setMatrix("viewProjection",r.getTransformMatrix()),this._multiview&&F.setMatrix("viewProjectionR",r._transformMatrixR)),r.activeCamera&&-1!==this._options.uniforms.indexOf("cameraPosition")&&F.setVector3("cameraPosition",r.activeCamera.globalPosition),(0,m.d)(b,F),(0,J.e)(F,this,r),this._useLogarithmicDepth&&(0,m.n)(x?o.materialDefines:F.defines,F,r),b&&(0,m.h)(r,b,F),this._textures)F.setTexture(t,this._textures[t]);for(t in this._textureArrays)F.setTextureArray(t,this._textureArrays[t]);for(t in this._ints)F.setInt(t,this._ints[t]);for(t in this._uints)F.setUInt(t,this._uints[t]);for(t in this._floats)F.setFloat(t,this._floats[t]);for(t in this._floatsArrays)F.setArray(t,this._floatsArrays[t]);for(t in this._colors3)F.setColor3(t,this._colors3[t]);for(t in this._colors3Arrays)F.setArray3(t,this._colors3Arrays[t]);for(t in this._colors4){const b=this._colors4[t];F.setFloat4(t,b.r,b.g,b.b,b.a)}for(t in this._colors4Arrays)F.setArray4(t,this._colors4Arrays[t]);for(t in this._vectors2)F.setVector2(t,this._vectors2[t]);for(t in this._vectors3)F.setVector3(t,this._vectors3[t]);for(t in this._vectors4)F.setVector4(t,this._vectors4[t]);for(t in this._quaternions)F.setQuaternion(t,this._quaternions[t]);for(t in this._matrices)F.setMatrix(t,this._matrices[t]);for(t in this._matrixArrays)F.setMatrices(t,this._matrixArrays[t]);for(t in this._matrices3x3)F.setMatrix3x3(t,this._matrices3x3[t]);for(t in this._matrices2x2)F.setMatrix2x2(t,this._matrices2x2[t]);for(t in this._vectors2Arrays)F.setArray2(t,this._vectors2Arrays[t]);for(t in this._vectors3Arrays)F.setArray3(t,this._vectors3Arrays[t]);for(t in this._vectors4Arrays)F.setArray4(t,this._vectors4Arrays[t]);for(t in this._quaternionsArrays)F.setArray4(t,this._quaternionsArrays[t]);for(t in this._uniformBuffers){const b=this._uniformBuffers[t].getBuffer();b&&F.bindUniformBuffer(b,t)}const Y=r.getEngine(),R=Y.setExternalTexture;if(R)for(t in this._externalTextures)R.call(Y,t,this._externalTextures[t]);const E=Y.setTextureSampler;if(E)for(t in this._textureSamplers)E.call(Y,t,this._textureSamplers[t]);const U=Y.setStorageBuffer;if(U)for(t in this._storageBuffers)U.call(Y,t,this._storageBuffers[t])}if(F&&b&&(E||!this.isFrozen)){const t=b.morphTargetManager;t&&t.numInfluencers>0&&(0,m.q)(b,F);const Y=b.bakedVertexAnimationManager;if(Y&&Y.isEnabled){var U;const t=x?o._drawWrapper:this._drawWrapper;null===(U=b.bakedVertexAnimationManager)||void 0===U||U.bind(F,!!t._wasPreviouslyUsingInstances)}}this._afterBind(b,F,o)}getActiveTextures(){const t=super.getActiveTextures();for(const b in this._textures)t.push(this._textures[b]);for(const b in this._textureArrays){const Y=this._textureArrays[b];for(let b=0;b<Y.length;b++)t.push(Y[b])}return t}hasTexture(t){if(super.hasTexture(t))return!0;for(const b in this._textures)if(this._textures[b]===t)return!0;for(const b in this._textureArrays){const Y=this._textureArrays[b];for(let b=0;b<Y.length;b++)if(Y[b]===t)return!0}return!1}clone(t){const b=U.d.Clone((()=>new L(t,this.va(),this._shaderPath,this._options,this._storeEffectOnSubMeshes)),this);b.name=t,b.id=t,"object"===typeof b._shaderPath&&(b._shaderPath={...b._shaderPath}),this._options={...this._options},Object.keys(this._options).forEach((t=>{const b=this._options[t];Array.isArray(b)&&(this._options[t]=b.slice(0))})),this.stencil.copyTo(b.stencil);for(const Y in this._textures)b.setTexture(Y,this._textures[Y]);for(const Y in this._textureArrays)b.setTextureArray(Y,this._textureArrays[Y]);for(const Y in this._externalTextures)b.setExternalTexture(Y,this._externalTextures[Y]);for(const Y in this._ints)b.setInt(Y,this._ints[Y]);for(const Y in this._uints)b.setUInt(Y,this._uints[Y]);for(const Y in this._floats)b.setFloat(Y,this._floats[Y]);for(const Y in this._floatsArrays)b.setFloats(Y,this._floatsArrays[Y]);for(const Y in this._colors3)b.setColor3(Y,this._colors3[Y]);for(const Y in this._colors3Arrays)b._colors3Arrays[Y]=this._colors3Arrays[Y];for(const Y in this._colors4)b.setColor4(Y,this._colors4[Y]);for(const Y in this._colors4Arrays)b._colors4Arrays[Y]=this._colors4Arrays[Y];for(const Y in this._vectors2)b.setVector2(Y,this._vectors2[Y]);for(const Y in this._vectors3)b.setVector3(Y,this._vectors3[Y]);for(const Y in this._vectors4)b.setVector4(Y,this._vectors4[Y]);for(const Y in this._quaternions)b.setQuaternion(Y,this._quaternions[Y]);for(const Y in this._quaternionsArrays)b._quaternionsArrays[Y]=this._quaternionsArrays[Y];for(const Y in this._matrices)b.setMatrix(Y,this._matrices[Y]);for(const Y in this._matrixArrays)b._matrixArrays[Y]=this._matrixArrays[Y].slice();for(const Y in this._matrices3x3)b.setMatrix3x3(Y,this._matrices3x3[Y]);for(const Y in this._matrices2x2)b.setMatrix2x2(Y,this._matrices2x2[Y]);for(const Y in this._vectors2Arrays)b.setArray2(Y,this._vectors2Arrays[Y]);for(const Y in this._vectors3Arrays)b.setArray3(Y,this._vectors3Arrays[Y]);for(const Y in this._vectors4Arrays)b.setArray4(Y,this._vectors4Arrays[Y]);for(const Y in this._uniformBuffers)b.setUniformBuffer(Y,this._uniformBuffers[Y]);for(const Y in this._textureSamplers)b.setTextureSampler(Y,this._textureSamplers[Y]);for(const Y in this._storageBuffers)b.setStorageBuffer(Y,this._storageBuffers[Y]);return b}dispose(t,b,Y){if(b){let t;for(t in this._textures)this._textures[t].dispose();for(t in this._textureArrays){const b=this._textureArrays[t];for(let t=0;t<b.length;t++)b[t].dispose()}}this._textures={},super.dispose(t,b,Y)}serialize(){const t=U.d.Serialize(this);let b;for(b in t.customType="BABYLON.ShaderMaterial",t.uniqueId=this.uniqueId,t.options=this._options,t.shaderPath=this._shaderPath,t.storeEffectOnSubMeshes=this._storeEffectOnSubMeshes,t.stencil=this.stencil.serialize(),t.textures={},this._textures)t.textures[b]=this._textures[b].serialize();for(b in t.textureArrays={},this._textureArrays){t.textureArrays[b]=[];const Y=this._textureArrays[b];for(let o=0;o<Y.length;o++)t.textureArrays[b].push(Y[o].serialize())}for(b in t.ints={},this._ints)t.ints[b]=this._ints[b];for(b in t.uints={},this._uints)t.uints[b]=this._uints[b];for(b in t.floats={},this._floats)t.floats[b]=this._floats[b];for(b in t.floatsArrays={},this._floatsArrays)t.floatsArrays[b]=this._floatsArrays[b];for(b in t.colors3={},this._colors3)t.colors3[b]=this._colors3[b].qe();for(b in t.colors3Arrays={},this._colors3Arrays)t.colors3Arrays[b]=this._colors3Arrays[b];for(b in t.colors4={},this._colors4)t.colors4[b]=this._colors4[b].qe();for(b in t.colors4Arrays={},this._colors4Arrays)t.colors4Arrays[b]=this._colors4Arrays[b];for(b in t.vectors2={},this._vectors2)t.vectors2[b]=this._vectors2[b].qe();for(b in t.vectors3={},this._vectors3)t.vectors3[b]=this._vectors3[b].qe();for(b in t.vectors4={},this._vectors4)t.vectors4[b]=this._vectors4[b].qe();for(b in t.quaternions={},this._quaternions)t.quaternions[b]=this._quaternions[b].qe();for(b in t.matrices={},this._matrices)t.matrices[b]=this._matrices[b].qe();for(b in t.matrixArray={},this._matrixArrays)t.matrixArray[b]=this._matrixArrays[b];for(b in t.matrices3x3={},this._matrices3x3)t.matrices3x3[b]=this._matrices3x3[b];for(b in t.matrices2x2={},this._matrices2x2)t.matrices2x2[b]=this._matrices2x2[b];for(b in t.vectors2Arrays={},this._vectors2Arrays)t.vectors2Arrays[b]=this._vectors2Arrays[b];for(b in t.vectors3Arrays={},this._vectors3Arrays)t.vectors3Arrays[b]=this._vectors3Arrays[b];for(b in t.vectors4Arrays={},this._vectors4Arrays)t.vectors4Arrays[b]=this._vectors4Arrays[b];for(b in t.quaternionsArrays={},this._quaternionsArrays)t.quaternionsArrays[b]=this._quaternionsArrays[b];return t}static Parse(t,b,Y){const x=U.d.Parse((()=>new L(t.name,b,t.shaderPath,t.options,t.storeEffectOnSubMeshes)),t,b,Y);let F;for(F in t.stencil&&x.stencil.parse(t.stencil,b,Y),t.textures)x.setTexture(F,p.b.Parse(t.textures[F],b,Y));for(F in t.textureArrays){const o=t.textureArrays[F],r=[];for(let t=0;t<o.length;t++)r.push(p.b.Parse(o[t],b,Y));x.setTextureArray(F,r)}for(F in t.ints)x.setInt(F,t.ints[F]);for(F in t.uints)x.setUInt(F,t.uints[F]);for(F in t.floats)x.setFloat(F,t.floats[F]);for(F in t.floatsArrays)x.setFloats(F,t.floatsArrays[F]);for(F in t.colors3)x.setColor3(F,r.d.ce(t.colors3[F]));for(F in t.colors3Arrays){const b=t.colors3Arrays[F].reduce(((t,b,Y)=>(Y%3===0?t.push([b]):t[t.length-1].push(b),t)),[]).map((t=>r.d.ce(t)));x.setColor3Array(F,b)}for(F in t.colors4)x.setColor4(F,r.h.ce(t.colors4[F]));for(F in t.colors4Arrays){const b=t.colors4Arrays[F].reduce(((t,b,Y)=>(Y%4===0?t.push([b]):t[t.length-1].push(b),t)),[]).map((t=>r.h.ce(t)));x.setColor4Array(F,b)}for(F in t.vectors2)x.setVector2(F,o.i.ce(t.vectors2[F]));for(F in t.vectors3)x.setVector3(F,o.l.ce(t.vectors3[F]));for(F in t.vectors4)x.setVector4(F,o.m.ce(t.vectors4[F]));for(F in t.quaternions)x.setQuaternion(F,o.e.ce(t.quaternions[F]));for(F in t.matrices)x.setMatrix(F,o.c.ce(t.matrices[F]));for(F in t.matrixArray)x._matrixArrays[F]=new Float32Array(t.matrixArray[F]);for(F in t.matrices3x3)x.setMatrix3x3(F,t.matrices3x3[F]);for(F in t.matrices2x2)x.setMatrix2x2(F,t.matrices2x2[F]);for(F in t.vectors2Arrays)x.setArray2(F,t.vectors2Arrays[F]);for(F in t.vectors3Arrays)x.setArray3(F,t.vectors3Arrays[F]);for(F in t.vectors4Arrays)x.setArray4(F,t.vectors4Arrays[F]);for(F in t.quaternionsArrays)x.setArray4(F,t.quaternionsArrays[F]);return x}static ParseFromFileAsync(t,b,Y){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return new Promise(((x,F)=>{const r=new y.e;r.addEventListener("readystatechange",(()=>{if(4==r.readyState)if(200==r.status){const b=JSON.parse(r.responseText),F=this.Parse(b,Y||B.d.LastCreatedScene,o);t&&(F.name=t),x(F)}else F("Unable to load the ShaderMaterial")})),r.open("GET",b),r.send()}))}static ParseFromSnippetAsync(t,b){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Promise(((o,x)=>{const F=new y.e;F.addEventListener("readystatechange",(()=>{if(4==F.readyState)if(200==F.status){const x=JSON.parse(JSON.parse(F.responseText).jsonPayload),r=JSON.parse(x.shaderMaterial),R=this.Parse(r,b||B.d.LastCreatedScene,Y);R.snippetId=t,o(R)}else x("Unable to load the snippet "+t)})),F.open("GET",this.SnippetUrl+"/"+t.replace(/#/g,"/")),F.send()}))}}L.SnippetUrl="https://snippet.babylonjs.com",L.CreateFromSnippetAsync=L.ParseFromSnippetAsync,(0,W.d)("BABYLON.ShaderMaterial",L),x.d._LinesMeshParser=(t,b)=>z.Parse(t,b);class z extends x.d{_isShaderMaterial(t){return"ShaderMaterial"===t.getClassName()}constructor(t){let b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>5?arguments[5]:void 0,x=arguments.length>6?arguments[6]:void 0,F=arguments.length>7?arguments[7]:void 0;super(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,b,arguments.length>4?arguments[4]:void 0),this.useVertexColor=o,this.useVertexAlpha=x,this.color=new r.d(1,1,1),this.alpha=1,this._shaderLanguage=0,b&&(this.color=b.color.clone(),this.alpha=b.alpha,this.useVertexColor=b.useVertexColor,this.useVertexAlpha=b.useVertexAlpha),this.intersectionThreshold=.1;const d={attributes:[R.e.PositionKind],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:[],useClipPlane:null,shaderLanguage:0};if(!1===x?d.needAlphaBlending=!1:d.defines.push("#define VERTEXALPHA"),o?(d.defines.push("#define VERTEXCOLOR"),d.attributes.push(R.e.ColorKind)):(d.uniforms.push("color"),this._color4=new r.h),F)this.material=F;else{this.va().getEngine().isWebGPU&&!z.ForceGLSL&&(this._shaderLanguage=1),d.shaderLanguage=this._shaderLanguage,d.extraInitializationsAsync=async()=>{1===this._shaderLanguage?await Promise.all([Y.e(19).then(Y.bind(Y,13028)),Y.e(48).then(Y.bind(Y,13030))]):await Promise.all([Y.e(26).then(Y.bind(Y,13039)),Y.e(49).then(Y.bind(Y,13043))])},this.material=new L("colorShader",this.va(),"color",d,!1),this.material.doNotSerialize=!0}}isReady(){return!!this._lineMaterial.isReady(this,!!this._userInstancedBuffersStorage||this.hasThinInstances)&&super.isReady()}getClassName(){return"LinesMesh"}get material(){return this._lineMaterial}set material(t){this._lineMaterial=t,this._lineMaterial.fillMode=E.e.LineListDrawMode}get checkCollisions(){return!1}set checkCollisions(t){}_bind(t,b){if(!this._geometry)return this;const Y=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(!this._userInstancedBuffersStorage||this.hasThinInstances?this._geometry._bind(b,Y):this._geometry._bind(b,Y,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects),!this.useVertexColor&&this._isShaderMaterial(this._lineMaterial)){const{r:t,g:b,b:Y}=this.color;this._color4.set(t,b,Y,this.alpha),this._lineMaterial.setColor4("color",this._color4)}return this}_draw(t,b,Y){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const o=this.va().getEngine();return this._unIndexed?o.drawArraysType(E.e.LineListDrawMode,t.verticesStart,t.verticesCount,Y):o.drawElementsType(E.e.LineListDrawMode,t.indexStart,t.indexCount,Y),this}dispose(t){(arguments.length>2?arguments[2]:void 0)||this._lineMaterial.dispose(!1,!1,!0),super.dispose(t)}clone(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Y=arguments.length>2?arguments[2]:void 0;return new z(t,this.va(),b,this,Y)}Dd(t){const b=new S(t,this);if(this.instancedBuffers){b.instancedBuffers={};for(const t in this.instancedBuffers)b.instancedBuffers[t]=this.instancedBuffers[t]}return b}serialize(t){super.serialize(t),t.color=this.color.qe(),t.alpha=this.alpha}static Parse(t,b){const Y=new z(t.name,b);return Y.color=r.d.ce(t.color),Y.alpha=t.alpha,Y}}z.ForceGLSL=!1;class S extends d.c{constructor(t,b){super(t,b),this.intersectionThreshold=b.intersectionThreshold}getClassName(){return"InstancedLinesMesh"}}var e=Y(1144);function g(t){const b=[],Y=[],o=t.lines,x=t.za,r=[];let R=0;for(let F=0;F<o.length;F++){const t=o[F];for(let o=0;o<t.length;o++){const{x:d,y:E,z:U}=t[o];if(Y.push(d,E,U),x){const t=x[F],{r:b,g:Y,b:R,a:d}=t[o];r.push(b,Y,R,d)}o>0&&(b.push(R-1),b.push(R)),R++}}const d=new F.c;return d.indices=b,d.xa=Y,x&&(d.za=r),d}function D(t){const b=t.dashSize||3,Y=t.gapSize||1,x=t.dashNb||200,r=t.points,R=[],d=[],E=o.l.Zero();let U=0,C=0,p=0,W=0,T=0,y=0,v=0;for(v=0;v<r.length-1;v++)r[v+1].subtractToRef(r[v],E),U+=E.length();for(p=U/x,W=b*p/(b+Y),v=0;v<r.length-1;v++){r[v+1].subtractToRef(r[v],E),C=Math.floor(E.length()/p),E.normalize();for(let t=0;t<C;t++)T=p*t,R.push(r[v].x+T*E.x,r[v].y+T*E.y,r[v].z+T*E.z),R.push(r[v].x+(T+W)*E.x,r[v].y+(T+W)*E.y,r[v].z+(T+W)*E.z),d.push(y,y+1),y+=2}const B=new F.c;return B.xa=R,B.indices=d,B}function H(t,b){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=b.instance,x=b.lines,F=b.za;if(o){const t=o.getVerticesData(R.e.PositionKind);let b,Y;F&&(b=o.getVerticesData(R.e.ColorKind));let r=0,d=0;for(let o=0;o<x.length;o++){const R=x[o];for(let x=0;x<R.length;x++)t[r]=R[x].x,t[r+1]=R[x].y,t[r+2]=R[x].z,F&&b&&(Y=F[o],b[d]=Y[x].r,b[d+1]=Y[x].g,b[d+2]=Y[x].b,b[d+3]=Y[x].a,d+=4),r+=3}return o.updateVerticesData(R.e.PositionKind,t,!1,!1),F&&b&&o.updateVerticesData(R.e.ColorKind,b,!1,!1),o.refreshBoundingInfo(),o}const r=new z(t,Y,null,void 0,void 0,!!F,b.useVertexAlpha,b.material);return g(b).Ca(r,b.updatable),r}function f(t,b){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=b.za?[b.za]:null;return H(t,{lines:[b.points],updatable:b.updatable,instance:b.instance,za:o,useVertexAlpha:b.useVertexAlpha,material:b.material},Y)}function n(t,b){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const F=b.points,r=b.instance,R=b.gapSize||1,d=b.dashSize||3;if(r){const t=t=>{const b=o.l.Zero(),Y=t.length/6;let x=0,R=0,d=0,E=0,U=0,C=0,p=0,W=0;for(p=0;p<F.length-1;p++)F[p+1].subtractToRef(F[p],b),x+=b.length();d=x/Y;const T=r._creationDataStorage.dashSize;for(E=T*d/(T+r._creationDataStorage.gapSize),p=0;p<F.length-1;p++)for(F[p+1].subtractToRef(F[p],b),R=Math.floor(b.length()/d),b.normalize(),W=0;W<R&&C<t.length;)U=d*W,t[C]=F[p].x+U*b.x,t[C+1]=F[p].y+U*b.y,t[C+2]=F[p].z+U*b.z,t[C+3]=F[p].x+(U+E)*b.x,t[C+4]=F[p].y+(U+E)*b.y,t[C+5]=F[p].z+(U+E)*b.z,C+=6,W++;for(;C<t.length;)t[C]=F[p].x,t[C+1]=F[p].y,t[C+2]=F[p].z,C+=3};return(b.dashNb||b.dashSize||b.gapSize||b.useVertexAlpha||b.material)&&e.b.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),r.updateMeshPositions(t,!1),r}const E=new z(t,Y,null,void 0,void 0,void 0,b.useVertexAlpha,b.material);return D(b).Ca(E,b.updatable),E._creationDataStorage=new x.h,E._creationDataStorage.dashSize=d,E._creationDataStorage.gapSize=R,E}F.c.CreateLineSystem=g,F.c.CreateDashedLines=D,x.d.lb=function(t,b){return f(t,{points:b,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},x.d.CreateDashedLines=function(t,b,Y,o,x){return n(t,{points:b,dashSize:Y,gapSize:o,dashNb:x,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},11839:(t,b,Y)=>{"use strict";Y.d(b,{d:()=>R,h:()=>d});var o=Y(11737),x=Y(11766),F=Y(1240);function r(t){const b=[],Y=[],o=[],r=[],R=t.width||t.size||1,d=t.height||t.size||1,E=0===t.sideOrientation?0:t.sideOrientation||x.c.DEFAULTSIDE,U=R/2,C=d/2;Y.push(-U,-C,0),o.push(0,0,-1),r.push(0,F.c?1:0),Y.push(U,-C,0),o.push(0,0,-1),r.push(1,F.c?1:0),Y.push(U,C,0),o.push(0,0,-1),r.push(1,F.c?0:1),Y.push(-U,C,0),o.push(0,0,-1),r.push(0,F.c?0:1),b.push(0),b.push(1),b.push(2),b.push(0),b.push(2),b.push(3),x.c._ComputeSides(E,Y,b,o,r,t.frontUVs,t.backUVs);const p=new x.c;return p.indices=b,p.xa=Y,p.ya=o,p.Aa=r,p}function R(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const x=new o.d(t,Y);b.sideOrientation=o.d._GetDefaultSideOrientation(b.sideOrientation),x._originalBuilderSideOrientation=b.sideOrientation;return r(b).Ca(x,b.updatable),b.sourcePlane&&(x.translate(b.sourcePlane.xe,-b.sourcePlane.d),x.setDirection(b.sourcePlane.xe.scale(-1))),x}const d={Dg:R};x.c.Dg=r,o.d.Dg=(t,b,Y,o,x)=>R(t,{size:b,width:b,height:b,sideOrientation:x,updatable:o},Y)},11881:(t,b,Y)=>{"use strict";Y.d(b,{e:()=>d});var o=Y(1019),x=Y(11737),F=Y(11766),r=Y(1240);function R(t){const b=0|(t.segments||32),Y=t.diameterX||t.diameter||1,x=t.diameterY||t.diameter||1,R=t.diameterZ||t.diameter||1,d=t.arc&&(t.arc<=0||t.arc>1)?1:t.arc||1,E=t.slice&&t.slice<=0?1:t.slice||1,U=0===t.sideOrientation?0:t.sideOrientation||F.c.DEFAULTSIDE,C=!!t.dedupTopBottomIndices,p=new o.l(Y/2,x/2,R/2),W=2+b,T=2*W,y=[],v=[],B=[],J=[];for(let F=0;F<=W;F++){const t=F/W,b=t*Math.PI*E;for(let Y=0;Y<=T;Y++){const x=Y/T,F=x*Math.PI*2*d,R=o.c.RotationZ(-b),E=o.c.RotationY(F),U=o.l.TransformCoordinates(o.l.Up(),R),C=o.l.TransformCoordinates(U,E),W=C.multiply(p),y=C.divide(p).normalize();v.push(W.x,W.y,W.z),B.push(y.x,y.y,y.z),J.push(x,r.c?1-t:t)}if(F>0){const t=v.length/3;for(let b=t-2*(T+1);b+T+2<t;b++)C?(F>1&&(y.push(b),y.push(b+1),y.push(b+T+1)),(F<W||E<1)&&(y.push(b+T+1),y.push(b+1),y.push(b+T+2))):(y.push(b),y.push(b+1),y.push(b+T+1),y.push(b+T+1),y.push(b+1),y.push(b+T+2))}}F.c._ComputeSides(U,v,y,B,J,t.frontUVs,t.backUVs);const m=new F.c;return m.indices=y,m.xa=v,m.ya=B,m.Aa=J,m}function d(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=new x.d(t,Y);b.sideOrientation=x.d._GetDefaultSideOrientation(b.sideOrientation),o._originalBuilderSideOrientation=b.sideOrientation;return R(b).Ca(o,b.updatable),o}F.c.CreateSphere=R,x.d.CreateSphere=(t,b,Y,o,x,F)=>d(t,{segments:b,diameterX:Y,diameterY:Y,diameterZ:Y,sideOrientation:F,updatable:x},o)},12389:(t,b,Y)=>{"use strict";Y.d(b,{e:()=>C});var o=Y(1265),x=Y(10704),F=Y(11773),r=Y(1307),R=Y(11766),d=Y(1144);function E(t,b,Y,o,x){let F=null,r=null,R=null;try{let d;F=new t.Decoder,r=new t.DecoderBuffer,r.Init(b,b.byteLength);const E=F.GetEncodedGeometryType(r);switch(E){case t.TRIANGULAR_MESH:{const b=new t.Mesh;if(d=F.DecodeBufferToMesh(r,b),!d.ok()||0===b.ptr)throw new Error(d.error_msg());const Y=3*b.num_faces(),x=4*Y,E=t._malloc(x);try{F.GetTrianglesUInt32Array(b,x,E);const r=new Uint32Array(Y);r.set(new Uint32Array(t.HEAPF32.buffer,E,Y)),o(r)}finally{t._free(E)}R=b;break}case t.POINT_CLOUD:{const b=new t.PointCloud;if(d=F.DecodeBufferToPointCloud(r,b),!d.ok()||!b.ptr)throw new Error(d.error_msg());R=b;break}default:throw new Error(`Invalid geometry type ${E}`)}const U=R.num_points(),C=(b,Y,o,F)=>{const r=F.data_type(),R=F.num_components(),d=F.normalized(),E=F.byte_stride(),C=F.byte_offset(),p={[t.DT_FLOAT32]:{typedArrayConstructor:Float32Array,heap:t.HEAPF32},[t.DT_INT8]:{typedArrayConstructor:Int8Array,heap:t.HEAP8},[t.DT_INT16]:{typedArrayConstructor:Int16Array,heap:t.HEAP16},[t.DT_INT32]:{typedArrayConstructor:Int32Array,heap:t.HEAP32},[t.DT_UINT8]:{typedArrayConstructor:Uint8Array,heap:t.HEAPU8},[t.DT_UINT16]:{typedArrayConstructor:Uint16Array,heap:t.HEAPU16},[t.DT_UINT32]:{typedArrayConstructor:Uint32Array,heap:t.HEAPU32}}[r];if(!p)throw new Error(`Invalid data type ${r}`);const W=U*R,T=W*p.typedArrayConstructor.BYTES_PER_ELEMENT,y=t._malloc(T);try{b.GetAttributeDataArrayForAllPoints(Y,F,r,T,y);const t=new p.typedArrayConstructor(p.heap.buffer,y,W);x(o,t.slice(),R,C,E,d)}finally{t._free(y)}};if(Y)for(const t in Y){const b=Y[t],o=F.GetAttributeByUniqueId(R,b);C(F,R,t,o)}else{const b={position:t.POSITION,xe:t.NORMAL,color:t.COLOR,uv:t.TEX_COORD};for(const t in b){const Y=F.GetAttributeId(R,b[t]);if(-1!==Y){const b=F.GetAttribute(R,Y);C(F,R,t,b)}}}return U}finally{R&&t.destroy(R),r&&t.destroy(r),F&&t.destroy(F)}}function U(){let t;onmessage=b=>{const Y=b.data;switch(Y.id){case"init":{const b=Y.decoder;b.url&&importScripts(b.url);const o=b.wasmBinary?{wasmBinary:b.wasmBinary}:{};t=DracoDecoderModule(o),postMessage({id:"initDone"});break}case"decodeMesh":if(!t)throw new Error("Draco decoder module is not available");t.then((t=>{const b=E(t,Y.dataView,Y.attributes,(t=>{postMessage({id:"indices",data:t},[t.buffer])}),((t,b,Y,o,x,F)=>{postMessage({id:"attribute",kind:t,data:b,size:Y,byteOffset:o,byteStride:x,normalized:F},[b.buffer])}));postMessage({id:"decodeMeshDone",totalVertices:b})}))}}}class C{static get DecoderAvailable(){const t=C.Configuration.decoder;return!!(t.wasmUrl&&t.wasmBinaryUrl&&"object"===typeof WebAssembly||t.fallbackUrl)}static GetDefaultNumWorkers(){return"object"===typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1}static get Default(){return C._Default||(C._Default=new C),C._Default}static ResetDefault(t){C._Default&&(t||C._Default.dispose(),C._Default=null)}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:C.DefaultNumWorkers;const b=C.Configuration.decoder;if(b.workerPool||"object"===typeof t&&t.workerPool)this._workerPoolPromise=Promise.resolve(b.workerPool||t.workerPool);else{const Y=b.wasmBinary||"object"===typeof t&&t.wasmBinary,F="number"===typeof t?t:t.numWorkers,r=F&&"function"===typeof Worker&&"function"===typeof URL,R=r||!r&&!b.jsModule,d=b.wasmUrl&&b.wasmBinaryUrl&&"object"===typeof WebAssembly?{url:R?o.f.GetBabylonScriptURL(b.wasmUrl,!0):"",wasmBinaryPromise:Y?Promise.resolve(Y):o.f.LoadFileAsync(o.f.GetBabylonScriptURL(b.wasmBinaryUrl,!0))}:{url:R?o.f.GetBabylonScriptURL(b.fallbackUrl):"",wasmBinaryPromise:Promise.resolve(void 0)};r?this._workerPoolPromise=d.wasmBinaryPromise.then((t=>{const b=`${E}(${U})()`,Y=URL.createObjectURL(new Blob([b],{type:"application/javascript"}));return new x.c(F,(()=>function(t,b,Y){return new Promise(((o,x)=>{const F=b=>{t.removeEventListener("error",F),t.removeEventListener("message",r),x(b)},r=b=>{"initDone"===b.data.id&&(t.removeEventListener("error",F),t.removeEventListener("message",r),o(t))};if(t.addEventListener("error",F),t.addEventListener("message",r),b){const o=b.slice(0);t.postMessage({id:"init",decoder:{url:Y,wasmBinary:o}},[o])}else t.postMessage({id:"init",decoder:{url:Y}})}))}(new Worker(Y),t,d.url)))})):this._decoderModulePromise=d.wasmBinaryPromise.then((async t=>{if("undefined"===typeof DracoDecoderModule&&!b.jsModule){if(!d.url)throw new Error("Draco decoder module is not available");await o.f.LoadBabylonScriptAsync(d.url)}return await(Y=t,x=b.jsModule,new Promise((t=>{(x||DracoDecoderModule)({wasmBinary:Y}).then((b=>{t({module:b})}))})));var Y,x}))}}dispose(){this._workerPoolPromise&&this._workerPoolPromise.then((t=>{t.dispose()})),delete this._workerPoolPromise,delete this._decoderModulePromise}async whenReadyAsync(){this._workerPoolPromise?await this._workerPoolPromise:this._decoderModulePromise&&await this._decoderModulePromise}decodeMeshToMeshDataAsync(t,b,Y){const o=t instanceof ArrayBuffer?new Int8Array(t):new Int8Array(t.buffer,t.byteOffset,t.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((t=>new Promise(((x,F)=>{t.push(((t,r)=>{let R=null;const E=[],U=b=>{t.removeEventListener("error",U),t.removeEventListener("message",C),F(b),r()},C=b=>{const o=b.data;switch(o.id){case"decodeMeshDone":t.removeEventListener("error",U),t.removeEventListener("message",C),x({indices:R,attributes:E,totalVertices:o.totalVertices}),r();break;case"indices":R=o.data;break;case"attribute":E.push({kind:o.kind,data:o.data,size:o.size,byteOffset:o.byteOffset,byteStride:o.byteStride,normalized:(F=o.kind,p=o.normalized,Y&&void 0!==Y[F]?(p!==Y[F]&&d.b.Warn(`Normalized flag from Draco data (${p}) does not match normalized flag from glTF accessor (${Y[F]}). Using flag from glTF accessor.`),Y[F]):p)})}var F,p};t.addEventListener("error",U),t.addEventListener("message",C);const p=o.slice();t.postMessage({id:"decodeMesh",dataView:p,attributes:b},[p.buffer])}))}))));if(this._decoderModulePromise)return this._decoderModulePromise.then((t=>{let Y=null;const x=[],F=E(t.module,o,b,(t=>{Y=t}),((t,b,Y,o,F,r)=>{x.push({kind:t,data:b,size:Y,byteOffset:o,byteStride:F,normalized:r})}));return{indices:Y,attributes:x,totalVertices:F}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(t,b,Y,o){const x=await this.decodeMeshToMeshDataAsync(Y,o),R=new F.c(t,b);x.indices&&R.setIndices(x.indices);for(const F of x.attributes)R.setVerticesBuffer(new r.e(b.getEngine(),F.data,F.kind,!1,void 0,F.byteStride,void 0,F.byteOffset,F.size,void 0,F.normalized,!0),x.totalVertices);return R}async _decodeMeshToGeometryForGltfAsync(t,b,Y,o,x){const R=await this.decodeMeshToMeshDataAsync(Y,o,x),d=new F.c(t,b);R.indices&&d.setIndices(R.indices);for(const F of R.attributes)d.setVerticesBuffer(new r.e(b.getEngine(),F.data,F.kind,!1,void 0,F.byteStride,void 0,F.byteOffset,F.size,void 0,F.normalized,!0),R.totalVertices);return d}async decodeMeshAsync(t,b){const Y=await this.decodeMeshToMeshDataAsync(t,b),o=new R.c;Y.indices&&(o.indices=Y.indices);for(const x of Y.attributes){const t=r.e.GetFloatData(x.data,x.size,r.e.GetDataType(x.data),x.byteOffset,x.byteStride,x.normalized,Y.totalVertices);o.set(t,x.kind)}return o}}C.Configuration={decoder:{wasmUrl:`${o.f._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${o.f._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${o.f._DefaultCdnUrl}/draco_decoder_gltf.js`}},C.DefaultNumWorkers=C.GetDefaultNumWorkers(),C._Default=null},11781:(t,b,Y)=>{"use strict";Y.d(b,{b:()=>S});var o=Y(999),x=Y(1013),F=Y(1019),r=Y(1307),R=Y(11766),d=Y(11790),E=Y(1298),U=Y(1415),C=Y(1294);class p{constructor(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new F.l(0,0,0),this._diffPositionForCollisions=new F.l(0,0,0),this._collisionResponse=!0}}var W=Y(1129),T=Y(1434),y=Y(1229),v=Y(1028),B=Y(1564),J=Y(1041),m=Y(1001),K=Y(1160);class L{constructor(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=F.l.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1}}class z{constructor(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new L,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=null,this._currentLODIsUpToDate=!1,this._collisionRetryCount=3,this._morphTargetManager=null,this._renderingGroupId=0,this._bakedVertexAnimationManager=null,this._material=null,this._positions=null,this._pointerOverDisableMeshTesting=!1,this._meshCollisionData=new p,this._enableDistantPicking=!1,this._rawBoundingInfo=null,this._sideOrientationHint=!1,this._inheritVisibility=!1}}class S extends d.d{static get BILLBOARDMODE_NONE(){return d.d.BILLBOARDMODE_NONE}static get BILLBOARDMODE_X(){return d.d.BILLBOARDMODE_X}static get BILLBOARDMODE_Y(){return d.d.BILLBOARDMODE_Y}static get BILLBOARDMODE_Z(){return d.d.BILLBOARDMODE_Z}static get BILLBOARDMODE_ALL(){return d.d.BILLBOARDMODE_ALL}static get BILLBOARDMODE_USE_POSITION(){return d.d.BILLBOARDMODE_USE_POSITION}get facetNb(){return this._internalAbstractMeshDataInfo._facetData.facetNb}get partitioningSubdivisions(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions}set partitioningSubdivisions(t){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=t}get partitioningBBoxRatio(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio}set partitioningBBoxRatio(t){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=t}get mustDepthSortFacets(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort}set mustDepthSortFacets(t){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=t}get facetDepthSortFrom(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom}set facetDepthSortFrom(t){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=t}get collisionRetryCount(){return this._internalAbstractMeshDataInfo._collisionRetryCount}set collisionRetryCount(t){this._internalAbstractMeshDataInfo._collisionRetryCount=t}get isFacetDataEnabled(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled}get morphTargetManager(){return this._internalAbstractMeshDataInfo._morphTargetManager}set morphTargetManager(t){this._internalAbstractMeshDataInfo._morphTargetManager!==t&&(this._internalAbstractMeshDataInfo._morphTargetManager=t,this._syncGeometryWithMorphTargetManager())}get bakedVertexAnimationManager(){return this._internalAbstractMeshDataInfo._bakedVertexAnimationManager}set bakedVertexAnimationManager(t){this._internalAbstractMeshDataInfo._bakedVertexAnimationManager!==t&&(this._internalAbstractMeshDataInfo._bakedVertexAnimationManager=t,this._markSubMeshesAsAttributesDirty())}_syncGeometryWithMorphTargetManager(){}_updateNonUniformScalingState(t){return!!super._updateNonUniformScalingState(t)&&(this._markSubMeshesAsMiscDirty(),!0)}get rawBoundingInfo(){return this._internalAbstractMeshDataInfo._rawBoundingInfo}set rawBoundingInfo(t){this._internalAbstractMeshDataInfo._rawBoundingInfo=t}set Dk(t){this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver=this.onCollideObservable.add(t)}set onCollisionPositionChange(t){this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(t)}get visibility(){return this._internalAbstractMeshDataInfo._visibility}set visibility(t){if(this._internalAbstractMeshDataInfo._visibility===t)return;const b=this._internalAbstractMeshDataInfo._visibility;this._internalAbstractMeshDataInfo._visibility=t,(1===b&&1!==t||1!==b&&1===t)&&this._markSubMeshesAsDirty((t=>{t.markAsMiscDirty(),t.markAsPrePassDirty()}))}get inheritVisibility(){return this._internalAbstractMeshDataInfo._inheritVisibility}set inheritVisibility(t){this._internalAbstractMeshDataInfo._inheritVisibility=t}get isVisible(){if(!this._isVisible||!this.inheritVisibility||!this._parentNode)return this._isVisible;if(this._isVisible){let t=this._parentNode;for(;t;){const b=t.isVisible;if("undefined"!==typeof b)return b;t=t.parent}}return this._isVisible}set isVisible(t){this._isVisible=t}get pointerOverDisableMeshTesting(){return this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting}set pointerOverDisableMeshTesting(t){this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting=t}get renderingGroupId(){return this._internalAbstractMeshDataInfo._renderingGroupId}set renderingGroupId(t){this._internalAbstractMeshDataInfo._renderingGroupId=t}get material(){return this._internalAbstractMeshDataInfo._material}set material(t){this._setMaterial(t)}_setMaterial(t){this._internalAbstractMeshDataInfo._material!==t&&(this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._material=t,t&&t.meshMap&&(t.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.ne&&(this.resetDrawCache(),this._unBindEffect()))}getMaterialForRenderPass(t){var b;return null===(b=this._internalAbstractMeshDataInfo._materialForRenderPass)||void 0===b?void 0:b[t]}setMaterialForRenderPass(t,b){this.resetDrawCache(t),this._internalAbstractMeshDataInfo._materialForRenderPass||(this._internalAbstractMeshDataInfo._materialForRenderPass=[]),this._internalAbstractMeshDataInfo._materialForRenderPass[t]=b}get receiveShadows(){return this._internalAbstractMeshDataInfo._receiveShadows}set receiveShadows(t){this._internalAbstractMeshDataInfo._receiveShadows!==t&&(this._internalAbstractMeshDataInfo._receiveShadows=t,this._markSubMeshesAsLightDirty())}get hasVertexAlpha(){return this._internalAbstractMeshDataInfo._hasVertexAlpha}set hasVertexAlpha(t){this._internalAbstractMeshDataInfo._hasVertexAlpha!==t&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=t,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())}get useVertexColors(){return this._internalAbstractMeshDataInfo._useVertexColors}set useVertexColors(t){this._internalAbstractMeshDataInfo._useVertexColors!==t&&(this._internalAbstractMeshDataInfo._useVertexColors=t,this._markSubMeshesAsAttributesDirty())}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(t){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==t&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=t,this._markSubMeshesAsAttributesDirty())}get numBoneInfluencers(){return this._internalAbstractMeshDataInfo._numBoneInfluencers}set numBoneInfluencers(t){this._internalAbstractMeshDataInfo._numBoneInfluencers!==t&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=t,this._markSubMeshesAsAttributesDirty())}get applyFog(){return this._internalAbstractMeshDataInfo._applyFog}set applyFog(t){this._internalAbstractMeshDataInfo._applyFog!==t&&(this._internalAbstractMeshDataInfo._applyFog=t,this._markSubMeshesAsMiscDirty())}get enableDistantPicking(){return this._internalAbstractMeshDataInfo._enableDistantPicking}set enableDistantPicking(t){this._internalAbstractMeshDataInfo._enableDistantPicking=t}get layerMask(){return this._internalAbstractMeshDataInfo._layerMask}set layerMask(t){t!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=t,this._resyncLightSources())}get collisionMask(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask}set collisionMask(t){this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask=isNaN(t)?-1:t}get collisionResponse(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse}set collisionResponse(t){this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse=t}get collisionGroup(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup}set collisionGroup(t){this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup=isNaN(t)?-1:t}get surroundingMeshes(){return this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes}set surroundingMeshes(t){this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes=t}get lightSources(){return this._lightSources}set skeleton(t){const b=this._internalAbstractMeshDataInfo._skeleton;b&&b.needInitialSkinMatrix&&b._unregisterMeshWithPoseMatrix(this),t&&t.needInitialSkinMatrix&&t._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=t,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()}get skeleton(){return this._internalAbstractMeshDataInfo._skeleton}constructor(t){var b;let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;switch(super(t,Y,!1),b=this,this._internalAbstractMeshDataInfo=new z,this._waitingMaterialId=null,this._waitingMorphTargetManagerId=null,this.Qe=S.Mi,this.onCollideObservable=new x.e,this.onCollisionPositionChangeObservable=new x.e,this.onMaterialChangedObservable=new x.e,this.definedFacingForward=!0,this._occlusionQuery=null,this._renderingGroup=null,this.alphaIndex=Number.MAX_VALUE,this._isVisible=!0,this.Ve=!0,this.isNearPickable=!1,this.isNearGrabbable=!1,this.showSubMeshesBoundingBox=!1,this.isBlocker=!1,this.enablePointerMoveEvents=!1,this.outlineColor=y.d.Red(),this.outlineWidth=.02,this.overlayColor=y.d.Red(),this.overlayAlpha=.5,this.useOctreeForRenderingSelection=!0,this.useOctreeForPicking=!0,this.useOctreeForCollisions=!0,this.hf=!1,this.Da=!1,this.actionManager=null,this.ellipsoid=new F.l(.5,1,.5),this.ellipsoidOffset=new F.l(0,0,0),this.edgesWidth=1,this.edgesColor=new y.h(1,0,0,1),this._edgesRenderer=null,this._masterMesh=null,this._boundingInfo=null,this._boundingInfoIsDirty=!0,this._renderId=0,this._intersectionsInProgress=new Array,this._unIndexed=!1,this._lightSources=new Array,this._waitingData={lods:null,actions:null,$h:null},this._bonesTransformMatrices=null,this._transformMatrixTexture=null,this.onRebuildObservable=new x.e,this._onCollisionPositionChange=function(t,Y){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Y.subtractToRef(b._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,b._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),b._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions.length()>K.c.CollisionsEpsilon&&b.position.addInPlace(b._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),o&&b.onCollideObservable.notifyObservers(o),b.onCollisionPositionChangeObservable.notifyObservers(b.position)},Y=this.va(),Y.df(this),this._resyncLightSources(),this._uniformBuffer=new C.e(this.va().getEngine(),void 0,void 0,t,!this.va().getEngine().isWebGPU),this._buildUniformLayout(),Y.performancePriority){case 2:this.Da=!0;case 1:this.hf=!0,this.Ve=!1}}_buildUniformLayout(){this._uniformBuffer.addUniform("world",16),this._uniformBuffer.addUniform("visibility",1),this._uniformBuffer.create()}transferToEffect(t){const b=this._uniformBuffer;b.Ge("world",t),b.updateFloat("visibility",this._internalAbstractMeshDataInfo._visibility),b.update()}getMeshUniformBuffer(){return this._uniformBuffer}getClassName(){return"AbstractMesh"}toString(t){let b="Name: "+this.name+", isInstance: "+("InstancedMesh"!==this.getClassName()?"YES":"NO");b+=", # of submeshes: "+(this.ne?this.ne.length:0);const Y=this._internalAbstractMeshDataInfo._skeleton;return Y&&(b+=", skeleton: "+Y.name),t&&(b+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],b+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.$h?"YES":"NO")),b}_getEffectiveParent(){return this._masterMesh&&this.billboardMode!==d.d.BILLBOARDMODE_NONE?this._masterMesh:super._getEffectiveParent()}_getActionManagerForTrigger(t){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.actionManager&&(b||this.actionManager.isRecursive)){if(!t)return this.actionManager;if(this.actionManager.hasSpecificTrigger(t))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(t,!1):null}_rebuild(){if(this.onRebuildObservable.notifyObservers(this),null!==this._occlusionQuery&&(this._occlusionQuery=null),this.ne){for(const t of this.ne)t._rebuild();this.resetDrawCache()}}_resyncLightSources(){this._lightSources.length=0;for(const t of this.va().lights)t.isEnabled()&&t.canAffectMesh(this)&&this._lightSources.push(t);this._markSubMeshesAsLightDirty()}_resyncLightSource(t){const b=t.isEnabled()&&t.canAffectMesh(this),Y=this._lightSources.indexOf(t);let o=!1;if(-1===Y){if(!b)return;this._lightSources.push(t)}else{if(b)return;o=!0,this._lightSources.splice(Y,1)}this._markSubMeshesAsLightDirty(o)}_unBindEffect(){for(const t of this.ne)t.setEffect(null)}_removeLightSource(t,b){const Y=this._lightSources.indexOf(t);-1!==Y&&(this._lightSources.splice(Y,1),this._markSubMeshesAsLightDirty(b))}_markSubMeshesAsDirty(t){if(this.ne)for(const b of this.ne)for(let Y=0;Y<b._drawWrappers.length;++Y){const o=b._drawWrappers[Y];o&&o.defines&&o.defines.markAllAsDirty&&t(o.defines)}}_markSubMeshesAsLightDirty(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._markSubMeshesAsDirty((b=>b.markAsLightDirty(t)))}_markSubMeshesAsAttributesDirty(){this._markSubMeshesAsDirty((t=>t.markAsAttributesDirty()))}_markSubMeshesAsMiscDirty(){this._markSubMeshesAsDirty((t=>t.markAsMiscDirty()))}Ae(t){return this._currentRenderId=Number.MAX_VALUE,super.Ae(t),this._isDirty=!0,this}resetDrawCache(t){if(this.ne)for(const b of this.ne)b.resetDrawCache(t)}get isBlocked(){return!1}getLOD(t){return this}getTotalVertices(){return 0}getTotalIndices(){return 0}_d(){return null}getVerticesData(t){return null}Ga(t,b,Y,o){return this}updateVerticesData(t,b,Y,o){return this}setIndices(t,b){return this}isVerticesDataPresent(t){return!1}getBoundingInfo(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfoIsDirty&&(this._boundingInfoIsDirty=!1,this.Ea()),this._boundingInfo)}getRawBoundingInfo(){return this.rawBoundingInfo??this.getBoundingInfo()}setBoundingInfo(t){return this._boundingInfo=t,this}get hasBoundingInfo(){return null!==this._boundingInfo}buildBoundingInfo(t,b,Y){return this._boundingInfo=new U.b(t,b,Y),this._boundingInfo}normalizeToUnitCube(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=arguments.length>2?arguments[2]:void 0;return super.normalizeToUnitCube(t,b,Y)}get useBones(){return this.skeleton&&this.va().skeletonsEnabled&&this.isVerticesDataPresent(r.e.MatricesIndicesKind)&&this.isVerticesDataPresent(r.e.MatricesWeightsKind)}_preActivate(){}_preActivateForIntermediateRendering(t){}_activate(t,b){return this._renderId=t,!0}_postActivate(){}_freeze(){}_unFreeze(){}getWorldMatrix(){return this._masterMesh&&this.billboardMode===d.d.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():super.getWorldMatrix()}_getWorldMatrixDeterminant(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():super._getWorldMatrixDeterminant()}get isAnInstance(){return!1}get hasInstances(){return!1}get hasThinInstances(){return!1}movePOV(t,b,Y){return this.position.addInPlace(this.calcMovePOV(t,b,Y)),this}calcMovePOV(t,b,Y){const o=new F.c;(this.rotationQuaternion?this.rotationQuaternion:F.e.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(o);const x=F.l.Zero(),r=this.definedFacingForward?-1:1;return F.l.TransformCoordinatesFromFloatsToRef(t*r,b,Y*r,o,x),x}rotatePOV(t,b,Y){return this.rotation.addInPlace(this.calcRotatePOV(t,b,Y)),this}calcRotatePOV(t,b,Y){const o=this.definedFacingForward?1:-1;return new F.l(t*o,b,Y*o)}Fa(t,b){if(t){const Y=(0,T.d)(t,0,this.getTotalVertices(),b);this._boundingInfo?this._boundingInfo.reConstruct(Y.minimum,Y.maximum):this._boundingInfo=new U.b(Y.minimum,Y.maximum)}if(this.ne)for(let Y=0;Y<this.ne.length;Y++)this.ne[Y].refreshBoundingInfo(t);this.Ea()}_refreshBoundingInfoDirect(t){if(this._boundingInfo?this._boundingInfo.reConstruct(t.minimum,t.maximum):this._boundingInfo=new U.b(t.minimum,t.maximum),this.ne)for(let b=0;b<this.ne.length;b++)this.ne[b].refreshBoundingInfo(null);this.Ea()}static _ApplySkeleton(t,b,Y,o,x,R,d){!function(t,b,Y,o,x,R,d){const E=F.f.ae[0],U=F.f.Matrix[0],C=F.f.Matrix[1],p=b===r.e.NormalKind?F.l.TransformNormalFromFloatsToRef:F.l.TransformCoordinatesFromFloatsToRef;for(let r=0,W=0;r<t.length;r+=3,W+=4){let b,T;for(U.reset(),b=0;b<4;b++)T=x[W+b],T>0&&(F.c.FromFloat32ArrayToRefScaled(Y,Math.floor(16*o[W+b]),T,C),U.addToSelf(C));if(R&&d)for(b=0;b<4;b++)T=d[W+b],T>0&&(F.c.FromFloat32ArrayToRefScaled(Y,Math.floor(16*R[W+b]),T,C),U.addToSelf(C));p(t[r],t[r+1],t[r+2],U,E),E.toArray(t,r)}}(t,b,Y,o,x,R,d)}_getData(t,b){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r.e.PositionKind;const o=t.cache,x=t=>{if(o){const b=o._vertexData||(o._vertexData={});return b[t]||this.copyVerticesData(t,b),b[t]}return this.getVerticesData(t)};if(b||(b=x(Y)),!b)return null;if(o?(o._outputData?o._outputData.set(b):o._outputData=new Float32Array(b),b=o._outputData):(t.applyMorph&&this.morphTargetManager||t.applySkeleton&&this.skeleton)&&(b=b.slice()),t.applyMorph&&this.morphTargetManager&&function(t,b,Y){let o=null;switch(b){case r.e.PositionKind:o=t=>t.getPositions();break;case r.e.NormalKind:o=t=>t.getNormals();break;case r.e.TangentKind:o=t=>t.getTangents();break;case r.e.UVKind:o=t=>t.getUVs();break;default:return}for(let x=0;x<t.length;x++){let b=t[x];for(let F=0;F<Y.numTargets;F++){const r=Y.getTarget(F),R=r.influence;if(0!==R){const Y=o(r);Y&&(b+=(Y[x]-t[x])*R)}}t[x]=b}}(b,Y,this.morphTargetManager),t.applySkeleton&&this.skeleton){const t=x(r.e.MatricesIndicesKind),o=x(r.e.MatricesWeightsKind);if(o&&t){const F=this.numBoneInfluencers>4,R=F?x(r.e.MatricesIndicesExtraKind):null,d=F?x(r.e.MatricesWeightsExtraKind):null,E=this.skeleton.getTransformMatrices(this);S._ApplySkeleton(b,Y,E,t,o,R,d)}}if(!1!==t.updatePositionsArray&&Y===r.e.PositionKind){const t=this._internalAbstractMeshDataInfo._positions||[],Y=t.length;if(t.length=b.length/3,Y<t.length)for(let b=Y;b<t.length;b++)t[b]=new F.l;for(let o=0,x=0;o<t.length;o++,x+=3)t[o].be(b[x],b[x+1],b[x+2]);this._internalAbstractMeshDataInfo._positions=t}return b}getNormalsData(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getData({applySkeleton:t,applyMorph:b,updatePositionsArray:!1},null,r.e.NormalKind)}Pf(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this._getData({applySkeleton:t,applyMorph:b,updatePositionsArray:!1},Y,r.e.PositionKind)}Ea(){return this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=new U.b(F.l.Zero(),F.l.Zero(),this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}_updateSubMeshesBoundingInfo(t){if(!this.ne)return this;const b=this.ne.length;for(let Y=0;Y<b;Y++){const o=this.ne[Y];(b>1||!o.IsGlobal)&&o.updateBoundingInfo(t)}return this}_afterComputeWorldMatrix(){this.Da||(this._boundingInfoIsDirty=!0)}isInFrustum(t){return this.getBoundingInfo().isInFrustum(t,this.Qe)}isCompletelyInFrustum(t){return this.getBoundingInfo().isCompletelyInFrustum(t)}intersectsMesh(t){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=arguments.length>2?arguments[2]:void 0;const o=this.getBoundingInfo(),x=t.getBoundingInfo();if(o.intersects(x,b))return!0;if(Y)for(const F of this.getChildMeshes())if(F.intersectsMesh(t,b,!0))return!0;return!1}intersectsPoint(t){return this.getBoundingInfo().intersectsPoint(t)}get checkCollisions(){return this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions}set checkCollisions(t){this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions=t}get collider(){return this._internalAbstractMeshDataInfo._meshCollisionData._collider}moveWithCollisions(t){this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions);const b=this.va().collisionCoordinator;return this._internalAbstractMeshDataInfo._meshCollisionData._collider||(this._internalAbstractMeshDataInfo._meshCollisionData._collider=b.createCollider()),this._internalAbstractMeshDataInfo._meshCollisionData._collider._radius=this.ellipsoid,b.getNewPosition(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,t,this._internalAbstractMeshDataInfo._meshCollisionData._collider,this.collisionRetryCount,this,this._onCollisionPositionChange,this.uniqueId),this}_collideForSubMesh(t,b,Y){var o;if(this._generatePointsArray(),!this._positions)return this;if(!t._lastColliderWorldVertices||!t._lastColliderTransformMatrix.equals(b)){t._lastColliderTransformMatrix=b.clone(),t._lastColliderWorldVertices=[],t._trianglePlanes=[];const Y=t.verticesStart,o=t.verticesStart+t.verticesCount;for(let x=Y;x<o;x++)t._lastColliderWorldVertices.push(F.l.TransformCoordinates(this._positions[x],b))}return Y._collide(t._trianglePlanes,t._lastColliderWorldVertices,this._d(),t.indexStart,t.indexStart+t.indexCount,t.verticesStart,!!t.Ha(),this,this._shouldConvertRHS(),7===(null===(o=t.Ha())||void 0===o?void 0:o.fillMode)),this}_processCollisionsForSubMeshes(t,b){const Y=this._scene.getCollidingSubMeshCandidates(this,t),o=Y.length;for(let x=0;x<o;x++){const F=Y.data[x];o>1&&!F._checkCollision(t)||this._collideForSubMesh(F,b,t)}return this}_shouldConvertRHS(){return!1}_checkCollision(t){if(!this.getBoundingInfo()._checkCollision(t))return this;const b=F.f.Matrix[0],Y=F.f.Matrix[1];return F.c.ScalingToRef(1/t._radius.x,1/t._radius.y,1/t._radius.z,b),this.worldMatrixFromCache.multiplyToRef(b,Y),this._processCollisionsForSubMeshes(t,Y),this}_generatePointsArray(){return!1}intersects(t,b,Y){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],x=arguments.length>4?arguments[4]:void 0,r=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const R=new E.c,d=this.getClassName(),U="InstancedLinesMesh"===d||"LinesMesh"===d||"GreasedLineMesh"===d?this.intersectionThreshold:0,C=this.getBoundingInfo();if(!this.ne)return R;if(!r&&(!t.intersectsSphere(C.boundingSphere,U)||!t.intersectsBox(C.boundingBox,U)))return R;if(o)return R.hit=!r,R.pickedMesh=r?null:this,R.distance=r?0:F.l.Distance(t.origin,C.boundingSphere.center),R.subMeshId=0,R;if(!this._generatePointsArray())return R;let p=null;const W=this._scene.getIntersectingSubMeshCandidates(this,t),T=W.length;let y=!1;for(let F=0;F<T;F++){const t=W.data[F].Ha();if(t&&(7==t.fillMode||0==t.fillMode||1==t.fillMode||2==t.fillMode||4==t.fillMode)){y=!0;break}}if(!y)return R.hit=!0,R.pickedMesh=this,R.distance=F.l.Distance(t.origin,C.boundingSphere.center),R.subMeshId=-1,R;for(let F=0;F<T;F++){const o=W.data[F];if(T>1&&!r&&!o.canIntersects(t))continue;const x=o.intersects(t,this._positions,this._d(),b,Y);if(x&&(b||!p||x.distance<p.distance)&&(p=x,p.subMeshId=F,b))break}if(p){const b=x??this.getWorldMatrix(),Y=F.f.ae[0],o=F.f.ae[1];F.l.TransformCoordinatesToRef(t.origin,b,Y),t.direction.scaleToRef(p.distance,o);const r=F.l.TransformNormal(o,b).addInPlace(Y);return R.hit=!0,R.distance=F.l.Distance(Y,r),R.pickedPoint=r,R.pickedMesh=this,R.bu=p.bu||0,R.bv=p.bv||0,R.subMeshFaceId=p.faceId,R.faceId=p.faceId+W.data[p.subMeshId].indexStart/(-1!==this.getClassName().indexOf("LinesMesh")?2:3),R.subMeshId=p.subMeshId,R}return R}clone(t,b,Y){return null}releaseSubMeshes(){if(this.ne)for(;this.ne.length;)this.ne[0].dispose();else this.ne=[];return this}dispose(t){let b,Y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const o=this.va();for(this._scene.useMaterialMeshMap&&this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),o.freeActiveMeshes(),o.freeRenderingGroups(),o.renderingManager.maintainStateBetweenFrames&&o.renderingManager.restoreDispachedFlags(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.disposeWhenUnowned&&!this._scene.meshes.some((t=>t!==this&&t.actionManager===this.actionManager))&&this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),b=0;b<this._intersectionsInProgress.length;b++){const t=this._intersectionsInProgress[b],Y=t._intersectionsInProgress.indexOf(this);t._intersectionsInProgress.splice(Y,1)}this._intersectionsInProgress.length=0;o.lights.forEach((t=>{let b=t.includedOnlyMeshes.indexOf(this);-1!==b&&t.includedOnlyMeshes.splice(b,1),b=t.excludedMeshes.indexOf(this),-1!==b&&t.excludedMeshes.splice(b,1);const Y=t.getShadowGenerators();if(Y){const t=Y.values();for(let Y=t.next();!0!==Y.done;Y=t.next()){const t=Y.value.getShadowMap();t&&t.renderList&&(b=t.renderList.indexOf(this),-1!==b&&t.renderList.splice(b,1))}}})),"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes();const x=o.getEngine();if(null!==this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,x.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),x.wipeCaches(),o.gf(this),this._parentContainer){const t=this._parentContainer.meshes.indexOf(this);t>-1&&this._parentContainer.meshes.splice(t,1),this._parentContainer=null}if(Y&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!t)for(b=0;b<o.ue.length;b++)o.ue[b].k===this&&(o.ue[b].dispose(),b--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this._uniformBuffer.dispose(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),super.dispose(t,Y)}_initFacetData(){const t=this._internalAbstractMeshDataInfo._facetData;t.facetNormals||(t.facetNormals=[]),t.facetPositions||(t.facetPositions=[]),t.facetPartitioning||(t.facetPartitioning=new Array),t.facetNb=this._d().length/3|0,t.partitioningSubdivisions=t.partitioningSubdivisions?t.partitioningSubdivisions:10,t.partitioningBBoxRatio=t.partitioningBBoxRatio?t.partitioningBBoxRatio:1.01;for(let b=0;b<t.facetNb;b++)t.facetNormals[b]=F.l.Zero(),t.facetPositions[b]=F.l.Zero();return t.facetDataEnabled=!0,this}updateFacetData(){const t=this._internalAbstractMeshDataInfo._facetData;t.facetDataEnabled||this._initFacetData();const b=this.getVerticesData(r.e.PositionKind),Y=this._d(),o=this.getVerticesData(r.e.NormalKind),x=this.getBoundingInfo();if(t.facetDepthSort&&!t.facetDepthSortEnabled){if(t.facetDepthSortEnabled=!0,Y instanceof Uint16Array)t.depthSortedIndices=new Uint16Array(Y);else if(Y instanceof Uint32Array)t.depthSortedIndices=new Uint32Array(Y);else{let b=!1;for(let t=0;t<Y.length;t++)if(Y[t]>65535){b=!0;break}t.depthSortedIndices=b?new Uint32Array(Y):new Uint16Array(Y)}if(t.facetDepthSortFunction=function(t,b){return b.sqDistance-t.sqDistance},!t.facetDepthSortFrom){const b=this.va().activeCamera;t.facetDepthSortFrom=b?b.position:F.l.Zero()}t.depthSortedFacets=[];for(let b=0;b<t.facetNb;b++){const Y={ind:3*b,sqDistance:0};t.depthSortedFacets.push(Y)}t.invertedMatrix=F.c.Identity(),t.facetDepthSortOrigin=F.l.Zero()}t.bbSize.x=x.maximum.x-x.minimum.x>v.e?x.maximum.x-x.minimum.x:v.e,t.bbSize.y=x.maximum.y-x.minimum.y>v.e?x.maximum.y-x.minimum.y:v.e,t.bbSize.z=x.maximum.z-x.minimum.z>v.e?x.maximum.z-x.minimum.z:v.e;let d=t.bbSize.x>t.bbSize.y?t.bbSize.x:t.bbSize.y;if(d=d>t.bbSize.z?d:t.bbSize.z,t.subDiv.max=t.partitioningSubdivisions,t.subDiv.X=Math.floor(t.subDiv.max*t.bbSize.x/d),t.subDiv.Y=Math.floor(t.subDiv.max*t.bbSize.y/d),t.subDiv.Z=Math.floor(t.subDiv.max*t.bbSize.z/d),t.subDiv.X=t.subDiv.X<1?1:t.subDiv.X,t.subDiv.Y=t.subDiv.Y<1?1:t.subDiv.Y,t.subDiv.Z=t.subDiv.Z<1?1:t.subDiv.Z,t.facetParameters.facetNormals=this.getFacetLocalNormals(),t.facetParameters.facetPositions=this.getFacetLocalPositions(),t.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),t.facetParameters.bInfo=x,t.facetParameters.bbSize=t.bbSize,t.facetParameters.subDiv=t.subDiv,t.facetParameters.ratio=this.partitioningBBoxRatio,t.facetParameters.depthSort=t.facetDepthSort,t.facetDepthSort&&t.facetDepthSortEnabled&&(this.ve(!0),this._worldMatrix.invertToRef(t.invertedMatrix),F.l.TransformCoordinatesToRef(t.facetDepthSortFrom,t.invertedMatrix,t.facetDepthSortOrigin),t.facetParameters.distanceTo=t.facetDepthSortOrigin),t.facetParameters.depthSortedFacets=t.depthSortedFacets,o&&R.c.ComputeNormals(b,Y,o,t.facetParameters),t.facetDepthSort&&t.facetDepthSortEnabled){t.depthSortedFacets.sort(t.facetDepthSortFunction);const b=t.depthSortedIndices.length/3|0;for(let o=0;o<b;o++){const b=t.depthSortedFacets[o].ind;t.depthSortedIndices[3*o]=Y[b],t.depthSortedIndices[3*o+1]=Y[b+1],t.depthSortedIndices[3*o+2]=Y[b+2]}this.updateIndices(t.depthSortedIndices,void 0,!0)}return this}getFacetLocalNormals(){const t=this._internalAbstractMeshDataInfo._facetData;return t.facetNormals||this.updateFacetData(),t.facetNormals}getFacetLocalPositions(){const t=this._internalAbstractMeshDataInfo._facetData;return t.facetPositions||this.updateFacetData(),t.facetPositions}getFacetLocalPartitioning(){const t=this._internalAbstractMeshDataInfo._facetData;return t.facetPartitioning||this.updateFacetData(),t.facetPartitioning}getFacetPosition(t){const b=F.l.Zero();return this.getFacetPositionToRef(t,b),b}getFacetPositionToRef(t,b){const Y=this.getFacetLocalPositions()[t],o=this.getWorldMatrix();return F.l.TransformCoordinatesToRef(Y,o,b),this}getFacetNormal(t){const b=F.l.Zero();return this.getFacetNormalToRef(t,b),b}getFacetNormalToRef(t,b){const Y=this.getFacetLocalNormals()[t];return F.l.TransformNormalToRef(Y,this.getWorldMatrix(),b),this}getFacetsAtLocalCoordinates(t,b,Y){const o=this.getBoundingInfo(),x=this._internalAbstractMeshDataInfo._facetData,F=Math.floor((t-o.minimum.x*x.partitioningBBoxRatio)*x.subDiv.X*x.partitioningBBoxRatio/x.bbSize.x),r=Math.floor((b-o.minimum.y*x.partitioningBBoxRatio)*x.subDiv.Y*x.partitioningBBoxRatio/x.bbSize.y),R=Math.floor((Y-o.minimum.z*x.partitioningBBoxRatio)*x.subDiv.Z*x.partitioningBBoxRatio/x.bbSize.z);return F<0||F>x.subDiv.max||r<0||r>x.subDiv.max||R<0||R>x.subDiv.max?null:x.facetPartitioning[F+x.subDiv.max*r+x.subDiv.max*x.subDiv.max*R]}getClosestFacetAtCoordinates(t,b,Y,o){let x=arguments.length>4&&void 0!==arguments[4]&&arguments[4],r=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const R=this.getWorldMatrix(),d=F.f.Matrix[5];R.invertToRef(d);const E=F.f.ae[8];F.l.TransformCoordinatesFromFloatsToRef(t,b,Y,d,E);const U=this.getClosestFacetAtLocalCoordinates(E.x,E.y,E.z,o,x,r);return o&&F.l.TransformCoordinatesFromFloatsToRef(o.x,o.y,o.z,R,o),U}getClosestFacetAtLocalCoordinates(t,b,Y,o){let x=arguments.length>4&&void 0!==arguments[4]&&arguments[4],F=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],r=null,R=0,d=0,E=0,U=0,C=0,p=0,W=0,T=0;const y=this.getFacetLocalPositions(),v=this.getFacetLocalNormals(),B=this.getFacetsAtLocalCoordinates(t,b,Y);if(!B)return null;let J,m,K,L=Number.MAX_VALUE,z=L;for(let S=0;S<B.length;S++)J=B[S],m=v[J],K=y[J],U=(t-K.x)*m.x+(b-K.y)*m.y+(Y-K.z)*m.z,(!x||x&&F&&U>=0||x&&!F&&U<=0)&&(U=m.x*K.x+m.y*K.y+m.z*K.z,C=-(m.x*t+m.y*b+m.z*Y-U)/(m.x*m.x+m.y*m.y+m.z*m.z),p=t+m.x*C,W=b+m.y*C,T=Y+m.z*C,R=p-t,d=W-b,E=T-Y,z=R*R+d*d+E*E,z<L&&(L=z,r=J,o&&(o.x=p,o.y=W,o.z=T)));return r}getFacetDataParameters(){return this._internalAbstractMeshDataInfo._facetData.facetParameters}disableFacetData(){const t=this._internalAbstractMeshDataInfo._facetData;return t.facetDataEnabled&&(t.facetDataEnabled=!1,t.facetPositions=[],t.facetNormals=[],t.facetPartitioning=new Array,t.facetParameters=null,t.depthSortedIndices=new Uint32Array(0)),this}updateIndices(t,b){return this}createNormals(t){const b=this.getVerticesData(r.e.PositionKind),Y=this._d();let o;return o=this.isVerticesDataPresent(r.e.NormalKind)?this.getVerticesData(r.e.NormalKind):[],R.c.ComputeNormals(b,Y,o,{useRightHandedSystem:this.va().useRightHandedSystem}),this.Ga(r.e.NormalKind,o,t),this}alignWithNormal(t,b){b||(b=B.b.Y);const Y=F.f.ae[0],o=F.f.ae[1];return F.l.CrossToRef(b,t,o),F.l.CrossToRef(t,o,Y),this.rotationQuaternion?F.e.RotationQuaternionFromAxisToRef(Y,t,o,this.rotationQuaternion):F.l.RotationFromAxisToRef(Y,t,o,this.rotation),this}_checkOcclusionQuery(){return!1}disableEdgesRendering(){throw(0,W.c)("EdgesRenderer")}enableEdgesRendering(t,b,Y){throw(0,W.c)("EdgesRenderer")}oj(){return this._scene.ue.filter((t=>t.k===this))}}S.OCCLUSION_TYPE_NONE=0,S.OCCLUSION_TYPE_OPTIMISTIC=1,S.OCCLUSION_TYPE_STRICT=2,S.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,S.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,S.CULLINGSTRATEGY_STANDARD=0,S.Mi=1,S.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,S.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,(0,o.e)([m.d.filter((function(){for(var t=arguments.length,b=new Array(t),Y=0;Y<t;Y++)b[Y]=arguments[Y];let[o,x,F,r,R]=b;return!Array.isArray(o)&&!Array.isArray(x)&&!Array.isArray(F)&&!Array.isArray(r)&&!Array.isArray(R)}))],S,"_ApplySkeleton",null),(0,J.d)("BABYLON.AbstractMesh",S)},11773:(t,b,Y)=>{"use strict";Y.d(b,{c:()=>v});var o=Y(1019),x=Y(1229),F=Y(11766),r=Y(1307),R=Y(1401),d=Y(11779),E=Y(1415),U=Y(1265),C=Y(1227),p=Y(1434),W=Y(1051),T=Y(1240),y=Y(1144);class v{get boundingBias(){return this._boundingBias}set boundingBias(t){this._boundingBias?this._boundingBias.p(t):this._boundingBias=t.clone(),this.Ea(!0,null)}static CreateGeometryForMesh(t){const b=new v(v.RandomId(),t.va());return b.Ca(t),b}get meshes(){return this._meshes}constructor(t,b,Y){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this._positionsCache=[],this._parentContainer=null,this.useBoundingInfoFromGeometry=!1,this._scene=b||W.d.LastCreatedScene,this._scene&&(this.id=t,this.uniqueId=this._scene.getUniqueId(),this._engine=this._scene.getEngine(),this._meshes=[],this._vertexBuffers={},this._indices=[],this._updatable=o,Y?this.setAllVerticesData(Y,o):this._totalVertices=0,this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),x&&(this.Ca(x),x.ve(!0)))}get extend(){return this._extend}va(){return this._scene}getEngine(){return this._engine}isReady(){return 1===this.delayLoadState||0===this.delayLoadState}get doNotSerialize(){for(let t=0;t<this._meshes.length;t++)if(!this._meshes[t].doNotSerialize)return!1;return!0}_rebuild(){this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer"));const t=new Set;for(const b in this._vertexBuffers)t.add(this._vertexBuffers[b].getWrapperBuffer());t.forEach((t=>{t._rebuild()}))}setAllVerticesData(t,b){t.applyToGeometry(this,b),this._notifyUpdate()}Ga(t,b){let Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3?arguments[3]:void 0;Y&&Array.isArray(b)&&(b=new Float32Array(b));const x=new r.e(this._engine,b,t,{updatable:Y,postponeInternalCreation:0===this._meshes.length,stride:o,label:"Geometry_"+this.id+"_"+t});this.setVerticesBuffer(x)}removeVerticesData(t){this._vertexBuffers[t]&&(this._vertexBuffers[t].dispose(),delete this._vertexBuffers[t]),this._vertexArrayObjects&&this._disposeVertexArrayObjects()}setVerticesBuffer(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const x=t.getKind();this._vertexBuffers[x]&&Y&&this._vertexBuffers[x].dispose(),t._buffer&&t._buffer._increaseReferences(),this._vertexBuffers[x]=t;const F=this._meshes,R=F.length;if(x===r.e.PositionKind){this._totalVertices=b??t._maxVerticesCount,this._updateExtend(t.getFloatData(this._totalVertices)),this._resetPointsArrayCache();const Y=this._extend&&this._extend.minimum||new o.l(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),x=this._extend&&this._extend.maximum||new o.l(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);for(let t=0;t<R;t++){const b=F[t];b.buildBoundingInfo(Y,x),b._createGlobalSubMesh(b.isUnIndexed),b.ve(!0),b.synchronizeInstances()}}this._notifyUpdate(x)}updateVerticesDataDirectly(t,b,Y){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const x=this.getVertexBuffer(t);x&&(x.updateDirectly(b,Y,o),this._notifyUpdate(t))}updateVerticesData(t,b){let Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const o=this.getVertexBuffer(t);o&&(o.update(b),t===r.e.PositionKind&&this.Ea(Y,b),this._notifyUpdate(t))}Ea(t,b){if(t&&this._updateExtend(b),this._resetPointsArrayCache(),t){const t=this._meshes;for(const b of t){b.hasBoundingInfo?b.getBoundingInfo().reConstruct(this._extend.minimum,this._extend.maximum):b.buildBoundingInfo(this._extend.minimum,this._extend.maximum);const t=b.ne;for(const b of t)b.refreshBoundingInfo()}}}_bind(t,b,Y,o){if(!t)return;void 0===b&&(b=this._indexBuffer);const x=this.getVertexBuffers();if(!x)return;if(b!=this._indexBuffer||!this._vertexArrayObjects&&!o)return void this._engine.bindBuffers(x,b,t,Y);const F=o||this._vertexArrayObjects,r=this._engine;F[t.key]||(F[t.key]=r.recordVertexArrayObject(x,b,t,Y)),r.bindVertexArrayObject(F[t.key],b)}getTotalVertices(){return this.isReady()?this._totalVertices:0}getVerticesData(t,b,Y){const o=this.getVertexBuffer(t);return o?o.getFloatData(this._totalVertices,Y||b&&1!==this._meshes.length):null}copyVerticesData(t,b){const Y=this.getVertexBuffer(t);if(!Y)return;b[t]||(b[t]=new Float32Array(this._totalVertices*Y.getSize()));const o=Y.getData();o&&function(t,b,Y,o,x,F,R,d){const E=b*r.e.GetTypeByteLength(Y),U=R*b;if(d.length!==U)throw new Error("Output length is not valid");if(Y===r.e.FLOAT&&x===E)if(t instanceof Array){const b=o/4;d.set(t,b)}else if(t instanceof ArrayBuffer){const b=new Float32Array(t,o,U);d.set(b)}else{const b=t.byteOffset+o;if(b%4)return y.b.Warn("CopyFloatData: copied misaligned data."),void d.set(new Float32Array(t.buffer.slice(b,b+4*U)));const Y=new Float32Array(t.buffer,b,U);d.set(Y)}else r.e.ForEach(t,o,x,b,Y,U,F,((t,b)=>d[b]=t))}(o,Y.getSize(),Y.type,Y.byteOffset,Y.byteStride,Y.normalized,this._totalVertices,b[t])}isVertexBufferUpdatable(t){const b=this._vertexBuffers[t];return!!b&&b.isUpdatable()}getVertexBuffer(t){return this.isReady()?this._vertexBuffers[t]:null}getVertexBuffers(){return this.isReady()?this._vertexBuffers:null}isVerticesDataPresent(t){return this._vertexBuffers?void 0!==this._vertexBuffers[t]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(t)}getVerticesDataKinds(){const t=[];let b;if(!this._vertexBuffers&&this._delayInfo)for(b in this._delayInfo)t.push(b);else for(b in this._vertexBuffers)t.push(b);return t}updateIndices(t,b){let Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._indexBuffer)if(this._indexBufferIsUpdatable){const o=t.length!==this._indices.length;if(Y||(this._indices=t.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,t,b),o)for(const t of this._meshes)t._createGlobalSubMesh(!0)}else this.setIndices(t,null,!0)}setIndexBuffer(t,b,Y){this._indices=[],this._indexBufferIsUpdatable=!1,this._indexBuffer=t,this._totalVertices=b,this._totalIndices=Y,t.is32Bits||(t.is32Bits=this._totalIndices>65535);for(const o of this._meshes)o._createGlobalSubMesh(!0),o.synchronizeInstances();this._notifyUpdate()}setIndices(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=t,this._indexBufferIsUpdatable=Y,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,Y,"Geometry_"+this.id+"_IndexBuffer")),void 0!=b&&(this._totalVertices=b);for(const x of this._meshes)x._createGlobalSubMesh(!o),x.synchronizeInstances();this._notifyUpdate()}getTotalIndices(){return this.isReady()?void 0!==this._totalIndices?this._totalIndices:this._indices.length:0}_d(t,b){if(!this.isReady())return null;const Y=this._indices;return b||t&&1!==this._meshes.length?Y.slice():Y}getIndexBuffer(){return this.isReady()?this._indexBuffer:null}_releaseVertexArrayObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;t&&this._vertexArrayObjects&&this._vertexArrayObjects[t.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[t.key]),delete this._vertexArrayObjects[t.key])}releaseForMesh(t,b){const Y=this._meshes,o=Y.indexOf(t);-1!==o&&(Y.splice(o,1),this._vertexArrayObjects&&t._invalidateInstanceVertexArrayObject(),t._geometry=null,0===Y.length&&b&&this.dispose())}Ca(t){if(t._geometry===this)return;const b=t._geometry;b&&b.releaseForMesh(t),this._vertexArrayObjects&&t._invalidateInstanceVertexArrayObject();const Y=this._meshes;t._geometry=this,t._internalAbstractMeshDataInfo._positions=null,this._scene.pushGeometry(this),Y.push(t),this.isReady()?this._applyToMesh(t):this._boundingInfo&&t.setBoundingInfo(this._boundingInfo)}_updateExtend(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.useBoundingInfoFromGeometry&&this._boundingInfo)this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()};else{if(!t&&(t=this.getVerticesData(r.e.PositionKind),!t))return;this._extend=(0,p.d)(t,0,this._totalVertices,this.boundingBias,3)}}_applyToMesh(t){const b=this._meshes.length;for(const Y in this._vertexBuffers)1===b&&this._vertexBuffers[Y].create(),Y===r.e.PositionKind&&(this._extend||this._updateExtend(),t.buildBoundingInfo(this._extend.minimum,this._extend.maximum),t._createGlobalSubMesh(t.isUnIndexed),t.Ea());1===b&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer")),t._syncGeometryWithMorphTargetManager(),t.synchronizeInstances()}_notifyUpdate(t){this.onGeometryUpdated&&this.onGeometryUpdated(this,t),this._vertexArrayObjects&&this._disposeVertexArrayObjects();for(const b of this._meshes)b._markSubMeshesAsAttributesDirty()}load(t,b){2!==this.delayLoadState&&(this.isReady()?b&&b():(this.delayLoadState=2,this._queueLoad(t,b)))}_queueLoad(t,b){this.delayLoadingFile&&(t.addPendingData(this),t._loadFile(this.delayLoadingFile,(Y=>{if(!this._delayLoadingFunction)return;this._delayLoadingFunction(JSON.parse(Y),this),this.delayLoadState=1,this._delayInfo=[],t.removePendingData(this);const o=this._meshes,x=o.length;for(let t=0;t<x;t++)this._applyToMesh(o[t]);b&&b()}),void 0,!0))}toLeftHanded(){const t=this._d(!1);if(null!=t&&t.length>0){for(let b=0;b<t.length;b+=3){const Y=t[b+0];t[b+0]=t[b+2],t[b+2]=Y}this.setIndices(t)}const b=this.getVerticesData(r.e.PositionKind,!1);if(null!=b&&b.length>0){for(let t=0;t<b.length;t+=3)b[t+2]=-b[t+2];this.Ga(r.e.PositionKind,b,!1)}const Y=this.getVerticesData(r.e.NormalKind,!1);if(null!=Y&&Y.length>0){for(let t=0;t<Y.length;t+=3)Y[t+2]=-Y[t+2];this.Ga(r.e.NormalKind,Y,!1)}}_resetPointsArrayCache(){this._positions=null}_generatePointsArray(){if(this._positions)return!0;const t=this.getVerticesData(r.e.PositionKind);if(!t||0===t.length)return!1;for(let b=3*this._positionsCache.length,Y=this._positionsCache.length;b<t.length;b+=3,++Y)this._positionsCache[Y]=o.l.ce(t,b);for(let b=0,Y=0;b<t.length;b+=3,++Y)this._positionsCache[Y].set(t[0+b],t[1+b],t[2+b]);return this._positionsCache.length=t.length/3,this._positions=this._positionsCache,!0}u(){return this._isDisposed}_disposeVertexArrayObjects(){if(this._vertexArrayObjects){for(const Y in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[Y]);this._vertexArrayObjects={};const t=this._meshes,b=t.length;for(let Y=0;Y<b;Y++)t[Y]._invalidateInstanceVertexArrayObject()}}dispose(){const t=this._meshes,b=t.length;let Y;for(Y=0;Y<b;Y++)this.releaseForMesh(t[Y]);this._meshes.length=0,this._disposeVertexArrayObjects();for(const o in this._vertexBuffers)this._vertexBuffers[o].dispose();if(this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._parentContainer){const t=this._parentContainer.geometries.indexOf(this);t>-1&&this._parentContainer.geometries.splice(t,1),this._parentContainer=null}this._isDisposed=!0}j(t){const b=new F.c;b.indices=[];const Y=this._d();if(Y)for(let F=0;F<Y.length;F++)b.indices.push(Y[F]);let o,x=!1,r=!1;for(o in this._vertexBuffers){const t=this.getVerticesData(o);if(t&&(t instanceof Float32Array?b.set(new Float32Array(t),o):b.set(t.slice(0),o),!r)){const t=this.getVertexBuffer(o);t&&(x=t.isUpdatable(),r=!x)}}const R=new v(t,this._scene,b,x);for(o in R.delayLoadState=this.delayLoadState,R.delayLoadingFile=this.delayLoadingFile,R._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)R._delayInfo=R._delayInfo||[],R._delayInfo.push(o);return R._boundingInfo=new E.b(this._extend.minimum,this._extend.maximum),R}serialize(){const t={};return t.id=this.id,t.uniqueId=this.uniqueId,t.updatable=this._updatable,C.b&&C.b.HasTags(this)&&(t.tags=C.b.GetTags(this)),t}_toNumberArray(t){return Array.isArray(t)?t:Array.prototype.slice.call(t)}clearCachedData(){this._indices=[],this._resetPointsArrayCache();for(const t in this._vertexBuffers)Object.prototype.hasOwnProperty.call(this._vertexBuffers,t)&&(this._vertexBuffers[t]._buffer._data=null)}serializeVerticeData(){const t=this.serialize();return this.isVerticesDataPresent(r.e.PositionKind)&&(t.xa=this._toNumberArray(this.getVerticesData(r.e.PositionKind)),this.isVertexBufferUpdatable(r.e.PositionKind)&&(t.xa._updatable=!0)),this.isVerticesDataPresent(r.e.NormalKind)&&(t.ya=this._toNumberArray(this.getVerticesData(r.e.NormalKind)),this.isVertexBufferUpdatable(r.e.NormalKind)&&(t.ya._updatable=!0)),this.isVerticesDataPresent(r.e.TangentKind)&&(t.tangents=this._toNumberArray(this.getVerticesData(r.e.TangentKind)),this.isVertexBufferUpdatable(r.e.TangentKind)&&(t.tangents._updatable=!0)),this.isVerticesDataPresent(r.e.UVKind)&&(t.Aa=this._toNumberArray(this.getVerticesData(r.e.UVKind)),this.isVertexBufferUpdatable(r.e.UVKind)&&(t.Aa._updatable=!0)),this.isVerticesDataPresent(r.e.UV2Kind)&&(t.uvs2=this._toNumberArray(this.getVerticesData(r.e.UV2Kind)),this.isVertexBufferUpdatable(r.e.UV2Kind)&&(t.uvs2._updatable=!0)),this.isVerticesDataPresent(r.e.UV3Kind)&&(t.uvs3=this._toNumberArray(this.getVerticesData(r.e.UV3Kind)),this.isVertexBufferUpdatable(r.e.UV3Kind)&&(t.uvs3._updatable=!0)),this.isVerticesDataPresent(r.e.UV4Kind)&&(t.uvs4=this._toNumberArray(this.getVerticesData(r.e.UV4Kind)),this.isVertexBufferUpdatable(r.e.UV4Kind)&&(t.uvs4._updatable=!0)),this.isVerticesDataPresent(r.e.UV5Kind)&&(t.uvs5=this._toNumberArray(this.getVerticesData(r.e.UV5Kind)),this.isVertexBufferUpdatable(r.e.UV5Kind)&&(t.uvs5._updatable=!0)),this.isVerticesDataPresent(r.e.UV6Kind)&&(t.uvs6=this._toNumberArray(this.getVerticesData(r.e.UV6Kind)),this.isVertexBufferUpdatable(r.e.UV6Kind)&&(t.uvs6._updatable=!0)),this.isVerticesDataPresent(r.e.ColorKind)&&(t.za=this._toNumberArray(this.getVerticesData(r.e.ColorKind)),this.isVertexBufferUpdatable(r.e.ColorKind)&&(t.za._updatable=!0)),this.isVerticesDataPresent(r.e.MatricesIndicesKind)&&(t.matricesIndices=this._toNumberArray(this.getVerticesData(r.e.MatricesIndicesKind)),t.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(r.e.MatricesIndicesKind)&&(t.matricesIndices._updatable=!0)),this.isVerticesDataPresent(r.e.MatricesWeightsKind)&&(t.matricesWeights=this._toNumberArray(this.getVerticesData(r.e.MatricesWeightsKind)),this.isVertexBufferUpdatable(r.e.MatricesWeightsKind)&&(t.matricesWeights._updatable=!0)),t.indices=this._toNumberArray(this._d()),t}static ExtractFromMesh(t,b){const Y=t._geometry;return Y?Y.j(b):null}static RandomId(){return U.f.RandomId()}static _GetGeometryByLoadedUniqueId(t,b){for(let Y=0;Y<b.geometries.length;Y++)if(b.geometries[Y]._loadedUniqueId===t)return b.geometries[Y];return null}static _ImportGeometry(t,b){const Y=b.va(),o=t.geometryUniqueId,F=t.geometryId;if(o||F){const t=o?this._GetGeometryByLoadedUniqueId(o,Y):Y.getGeometryById(F);t&&t.Ca(b)}else if(t instanceof ArrayBuffer){const Y=b._binaryInfo;if(Y.positionsAttrDesc&&Y.positionsAttrDesc.count>0){const o=new Float32Array(t,Y.positionsAttrDesc.offset,Y.positionsAttrDesc.count);b.Ga(r.e.PositionKind,o,!1)}if(Y.normalsAttrDesc&&Y.normalsAttrDesc.count>0){const o=new Float32Array(t,Y.normalsAttrDesc.offset,Y.normalsAttrDesc.count);b.Ga(r.e.NormalKind,o,!1)}if(Y.tangetsAttrDesc&&Y.tangetsAttrDesc.count>0){const o=new Float32Array(t,Y.tangetsAttrDesc.offset,Y.tangetsAttrDesc.count);b.Ga(r.e.TangentKind,o,!1)}if(Y.uvsAttrDesc&&Y.uvsAttrDesc.count>0){const o=new Float32Array(t,Y.uvsAttrDesc.offset,Y.uvsAttrDesc.count);if(T.c)for(let t=1;t<o.length;t+=2)o[t]=1-o[t];b.Ga(r.e.UVKind,o,!1)}if(Y.uvs2AttrDesc&&Y.uvs2AttrDesc.count>0){const o=new Float32Array(t,Y.uvs2AttrDesc.offset,Y.uvs2AttrDesc.count);if(T.c)for(let t=1;t<o.length;t+=2)o[t]=1-o[t];b.Ga(r.e.UV2Kind,o,!1)}if(Y.uvs3AttrDesc&&Y.uvs3AttrDesc.count>0){const o=new Float32Array(t,Y.uvs3AttrDesc.offset,Y.uvs3AttrDesc.count);if(T.c)for(let t=1;t<o.length;t+=2)o[t]=1-o[t];b.Ga(r.e.UV3Kind,o,!1)}if(Y.uvs4AttrDesc&&Y.uvs4AttrDesc.count>0){const o=new Float32Array(t,Y.uvs4AttrDesc.offset,Y.uvs4AttrDesc.count);if(T.c)for(let t=1;t<o.length;t+=2)o[t]=1-o[t];b.Ga(r.e.UV4Kind,o,!1)}if(Y.uvs5AttrDesc&&Y.uvs5AttrDesc.count>0){const o=new Float32Array(t,Y.uvs5AttrDesc.offset,Y.uvs5AttrDesc.count);if(T.c)for(let t=1;t<o.length;t+=2)o[t]=1-o[t];b.Ga(r.e.UV5Kind,o,!1)}if(Y.uvs6AttrDesc&&Y.uvs6AttrDesc.count>0){const o=new Float32Array(t,Y.uvs6AttrDesc.offset,Y.uvs6AttrDesc.count);if(T.c)for(let t=1;t<o.length;t+=2)o[t]=1-o[t];b.Ga(r.e.UV6Kind,o,!1)}if(Y.colorsAttrDesc&&Y.colorsAttrDesc.count>0){const o=new Float32Array(t,Y.colorsAttrDesc.offset,Y.colorsAttrDesc.count);b.Ga(r.e.ColorKind,o,!1,Y.colorsAttrDesc.stride)}if(Y.matricesIndicesAttrDesc&&Y.matricesIndicesAttrDesc.count>0){const o=new Int32Array(t,Y.matricesIndicesAttrDesc.offset,Y.matricesIndicesAttrDesc.count),x=[];for(let t=0;t<o.length;t++){const b=o[t];x.push(255&b),x.push((65280&b)>>8),x.push((16711680&b)>>16),x.push(b>>24&255)}b.Ga(r.e.MatricesIndicesKind,x,!1)}if(Y.matricesIndicesExtraAttrDesc&&Y.matricesIndicesExtraAttrDesc.count>0){const o=new Int32Array(t,Y.matricesIndicesExtraAttrDesc.offset,Y.matricesIndicesExtraAttrDesc.count),x=[];for(let t=0;t<o.length;t++){const b=o[t];x.push(255&b),x.push((65280&b)>>8),x.push((16711680&b)>>16),x.push(b>>24&255)}b.Ga(r.e.MatricesIndicesExtraKind,x,!1)}if(Y.matricesWeightsAttrDesc&&Y.matricesWeightsAttrDesc.count>0){const o=new Float32Array(t,Y.matricesWeightsAttrDesc.offset,Y.matricesWeightsAttrDesc.count);b.Ga(r.e.MatricesWeightsKind,o,!1)}if(Y.indicesAttrDesc&&Y.indicesAttrDesc.count>0){const o=new Int32Array(t,Y.indicesAttrDesc.offset,Y.indicesAttrDesc.count);b.setIndices(o,null)}if(Y.subMeshesAttrDesc&&Y.subMeshesAttrDesc.count>0){const o=new Int32Array(t,Y.subMeshesAttrDesc.offset,5*Y.subMeshesAttrDesc.count);b.ne=[];for(let t=0;t<Y.subMeshesAttrDesc.count;t++){const Y=o[5*t+0],x=o[5*t+1],F=o[5*t+2],r=o[5*t+3],d=o[5*t+4];R.b.AddToMesh(Y,x,F,r,d,b)}}}else if(t.xa&&t.ya&&t.indices){if(b.Ga(r.e.PositionKind,t.xa,t.xa._updatable),b.Ga(r.e.NormalKind,t.ya,t.ya._updatable),t.tangents&&b.Ga(r.e.TangentKind,t.tangents,t.tangents._updatable),t.Aa&&b.Ga(r.e.UVKind,t.Aa,t.Aa._updatable),t.uvs2&&b.Ga(r.e.UV2Kind,t.uvs2,t.uvs2._updatable),t.uvs3&&b.Ga(r.e.UV3Kind,t.uvs3,t.uvs3._updatable),t.uvs4&&b.Ga(r.e.UV4Kind,t.uvs4,t.uvs4._updatable),t.uvs5&&b.Ga(r.e.UV5Kind,t.uvs5,t.uvs5._updatable),t.uvs6&&b.Ga(r.e.UV6Kind,t.uvs6,t.uvs6._updatable),t.za&&b.Ga(r.e.ColorKind,x.h.CheckColors4(t.za,t.xa.length/3),t.za._updatable),t.matricesIndices)if(t.matricesIndices._isExpanded)delete t.matricesIndices._isExpanded,b.Ga(r.e.MatricesIndicesKind,t.matricesIndices,t.matricesIndices._updatable);else{const Y=[];for(let b=0;b<t.matricesIndices.length;b++){const o=t.matricesIndices[b];Y.push(255&o),Y.push((65280&o)>>8),Y.push((16711680&o)>>16),Y.push(o>>24&255)}b.Ga(r.e.MatricesIndicesKind,Y,t.matricesIndices._updatable)}if(t.matricesIndicesExtra)if(t.matricesIndicesExtra._isExpanded)delete t.matricesIndices._isExpanded,b.Ga(r.e.MatricesIndicesExtraKind,t.matricesIndicesExtra,t.matricesIndicesExtra._updatable);else{const Y=[];for(let b=0;b<t.matricesIndicesExtra.length;b++){const o=t.matricesIndicesExtra[b];Y.push(255&o),Y.push((65280&o)>>8),Y.push((16711680&o)>>16),Y.push(o>>24&255)}b.Ga(r.e.MatricesIndicesExtraKind,Y,t.matricesIndicesExtra._updatable)}t.matricesWeights&&(v._CleanMatricesWeights(t,b),b.Ga(r.e.MatricesWeightsKind,t.matricesWeights,t.matricesWeights._updatable)),t.matricesWeightsExtra&&b.Ga(r.e.MatricesWeightsExtraKind,t.matricesWeightsExtra,t.matricesWeights._updatable),b.setIndices(t.indices,null)}if(t.ne){b.ne=[];for(let Y=0;Y<t.ne.length;Y++){const o=t.ne[Y];R.b.AddToMesh(o.materialIndex,o.verticesStart,o.verticesCount,o.indexStart,o.indexCount,b)}}b._shouldGenerateFlatShading&&(b.convertToFlatShadedMesh(),b._shouldGenerateFlatShading=!1),b.ve(!0),Y.onMeshImportedObservable.notifyObservers(b)}static _CleanMatricesWeights(t,b){const Y=.001;if(!d.e.CleanBoneMatrixWeights)return;let o=0;if(!(t.skeletonId>-1))return;{const Y=b.va().getLastSkeletonById(t.skeletonId);if(!Y)return;o=Y.bones.length}const x=b.getVerticesData(r.e.MatricesIndicesKind),F=b.getVerticesData(r.e.MatricesIndicesExtraKind),R=t.matricesWeights,E=t.matricesWeightsExtra,U=t.numBoneInfluencer,C=R.length;for(let r=0;r<C;r+=4){let t=0,b=-1;for(let o=0;o<4;o++){const x=R[r+o];t+=x,x<Y&&b<0&&(b=o)}if(E)for(let o=0;o<4;o++){const x=E[r+o];t+=x,x<Y&&b<0&&(b=o+4)}if((b<0||b>U-1)&&(b=U-1),t>Y){const b=1/t;for(let t=0;t<4;t++)R[r+t]*=b;if(E)for(let t=0;t<4;t++)E[r+t]*=b}else b>=4?(E[r+b-4]=1-t,F[r+b-4]=o):(R[r+b]=1-t,x[r+b]=o)}b.Ga(r.e.MatricesIndicesKind,x),t.matricesWeightsExtra&&b.Ga(r.e.MatricesIndicesExtraKind,F)}static Parse(t,b,Y){const x=new v(t.id,b,void 0,t.updatable);return x._loadedUniqueId=t.uniqueId,C.b&&C.b.AddTagsTo(x,t.tags),t.delayLoadingFile?(x.delayLoadState=4,x.delayLoadingFile=Y+t.delayLoadingFile,x._boundingInfo=new E.b(o.l.ce(t.boundingBoxMinimum),o.l.ce(t.boundingBoxMaximum)),x._delayInfo=[],t.hasUVs&&x._delayInfo.push(r.e.UVKind),t.hasUVs2&&x._delayInfo.push(r.e.UV2Kind),t.hasUVs3&&x._delayInfo.push(r.e.UV3Kind),t.hasUVs4&&x._delayInfo.push(r.e.UV4Kind),t.hasUVs5&&x._delayInfo.push(r.e.UV5Kind),t.hasUVs6&&x._delayInfo.push(r.e.UV6Kind),t.hasColors&&x._delayInfo.push(r.e.ColorKind),t.hasMatricesIndices&&x._delayInfo.push(r.e.MatricesIndicesKind),t.hasMatricesWeights&&x._delayInfo.push(r.e.MatricesWeightsKind),x._delayLoadingFunction=F.c.ImportVertexData):F.c.ImportVertexData(t,x),b.pushGeometry(x,!0),x}}},12359:(t,b,Y)=>{"use strict";Y.d(b,{c:()=>p});var o=Y(1019),x=Y(1144),F=Y(11781),r=Y(11737),R=Y(1268),d=Y(11790),E=Y(1307),U=Y(1265),C=Y(1041);r.d._instancedMeshFactory=(t,b)=>{const Y=new p(t,b);if(b.instancedBuffers){Y.instancedBuffers={};for(const t in b.instancedBuffers)Y.instancedBuffers[t]=b.instancedBuffers[t]}return Y};class p extends F.b{constructor(t,b){super(t,b.va()),this._indexInSourceMeshInstanceArray=-1,this._distanceToCamera=0,b.Cj(this),this._sourceMesh=b,this._unIndexed=b._unIndexed,this.position.p(b.position),this.rotation.p(b.rotation),this.Oe.p(b.Oe),b.rotationQuaternion&&(this.rotationQuaternion=b.rotationQuaternion.clone()),this.animations=b.animations.slice();for(const Y of b.getAnimationRanges())null!=Y&&this.createAnimationRange(Y.name,Y.from,Y.to);this.infiniteDistance=b.infiniteDistance,this.setPivotMatrix(b.getPivotMatrix()),this.refreshBoundingInfo(!0,!0),this._syncSubMeshes()}getClassName(){return"InstancedMesh"}get lightSources(){return this._sourceMesh._lightSources}_resyncLightSources(){}_resyncLightSource(){}_removeLightSource(){}get receiveShadows(){return this._sourceMesh.receiveShadows}set receiveShadows(t){var b;(null===(b=this._sourceMesh)||void 0===b?void 0:b.receiveShadows)!==t&&U.f.Warn("Setting receiveShadows on an instanced mesh has no effect")}get material(){return this._sourceMesh.material}set material(t){var b;(null===(b=this._sourceMesh)||void 0===b?void 0:b.material)!==t&&U.f.Warn("Setting material on an instanced mesh has no effect")}get visibility(){return this._sourceMesh.visibility}set visibility(t){var b;(null===(b=this._sourceMesh)||void 0===b?void 0:b.visibility)!==t&&U.f.Warn("Setting visibility on an instanced mesh has no effect")}get skeleton(){return this._sourceMesh.skeleton}set skeleton(t){var b;(null===(b=this._sourceMesh)||void 0===b?void 0:b.skeleton)!==t&&U.f.Warn("Setting skeleton on an instanced mesh has no effect")}get renderingGroupId(){return this._sourceMesh.renderingGroupId}set renderingGroupId(t){this._sourceMesh&&t!==this._sourceMesh.renderingGroupId&&x.b.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")}getTotalVertices(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0}getTotalIndices(){return this._sourceMesh.getTotalIndices()}get sourceMesh(){return this._sourceMesh}Dd(t){return this._sourceMesh.Dd(t)}isReady(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._sourceMesh.isReady(t,!0)}getVerticesData(t,b,Y){return this._sourceMesh.getVerticesData(t,b,Y)}copyVerticesData(t,b){this._sourceMesh.copyVerticesData(t,b)}Ga(t,b,Y,o){return this.sourceMesh&&this.sourceMesh.Ga(t,b,Y,o),this.sourceMesh}updateVerticesData(t,b,Y,o){return this.sourceMesh&&this.sourceMesh.updateVerticesData(t,b,Y,o),this.sourceMesh}setIndices(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.sourceMesh&&this.sourceMesh.setIndices(t,b),this.sourceMesh}isVerticesDataPresent(t){return this._sourceMesh.isVerticesDataPresent(t)}_d(){return this._sourceMesh._d()}get _positions(){return this._sourceMesh._positions}refreshBoundingInfo(){let t,b=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;t="object"===typeof b?b:{applySkeleton:b,applyMorph:Y};const o=this._sourceMesh.Ee?this._sourceMesh.Ee.boundingBias:null;return this.Fa(this._sourceMesh._getData(t,null,E.e.PositionKind),o),this}_preActivate(){return this._currentLOD&&this._currentLOD._preActivate(),this}_activate(t,b){if(super._activate(t,b),this._sourceMesh.ne||x.b.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!==this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,t),b){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1}_postActivate(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)}getWorldMatrix(){if(this._currentLOD&&this._currentLOD.billboardMode!==d.d.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new o.c);const t=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,o.f.ae[7].p(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.p(this._currentLOD.ve(!0)),this._currentLOD.position.p(o.f.ae[7]),this._currentLOD._masterMesh=t,this._billboardWorldMatrix}return super.getWorldMatrix()}get isAnInstance(){return!0}getLOD(t){if(!t)return this;const b=this.sourceMesh.getLODLevels();if(b&&0!==b.length){const b=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(t,b.boundingSphere)}else this._currentLOD=this.sourceMesh;return this._currentLOD}_preActivateForIntermediateRendering(t){return this.sourceMesh._preActivateForIntermediateRendering(t)}_syncSubMeshes(){if(this.releaseSubMeshes(),this._sourceMesh.ne)for(let t=0;t<this._sourceMesh.ne.length;t++)this._sourceMesh.ne[t].clone(this,this._sourceMesh);return this}_generatePointsArray(){return this._sourceMesh._generatePointsArray()}Ea(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}clone(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Y=arguments.length>2?arguments[2]:void 0;const o=((arguments.length>3?arguments[3]:void 0)||this._sourceMesh).Dd(t);if(R.b.DeepCopy(this,o,["name","ne","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","nj","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo"],[]),this.refreshBoundingInfo(),b&&(o.parent=b),!Y)for(let x=0;x<this.va().meshes.length;x++){const t=this.va().meshes[x];t.parent===this&&t.clone(t.name,o)}return o.ve(!0),this.onClonedObservable.notifyObservers(o),o}dispose(t){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._sourceMesh.Bj(this),super.dispose(t,b)}_serializeAsParent(t){super._serializeAsParent(t),t.parentId=this._sourceMesh.uniqueId,t.parentInstanceIndex=this._indexInSourceMeshInstanceArray}instantiateHierarchy(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,b=arguments.length>1?arguments[1]:void 0,Y=arguments.length>2?arguments[2]:void 0;const o=this.clone("Clone of "+(this.name||this.id),t||this.parent,!0,b&&b.newSourcedMesh);o&&Y&&Y(this,o);for(const x of this.getChildTransformNodes(!0))x.instantiateHierarchy(o,b,Y);return o}}r.d.prototype.registerInstancedBuffer=function(t,b){var Y,o;if(null===(Y=this._userInstancedBuffersStorage)||void 0===Y||null===(o=Y.vertexBuffers[t])||void 0===o||o.dispose(),!this.instancedBuffers){this.instancedBuffers={};for(const t of this.instances)t.instancedBuffers={}}this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this.instancedBuffers[t]=null,this._userInstancedBuffersStorage.strides[t]=b,this._userInstancedBuffersStorage.sizes[t]=32*b,this._userInstancedBuffersStorage.data[t]=new Float32Array(this._userInstancedBuffersStorage.sizes[t]),this._userInstancedBuffersStorage.vertexBuffers[t]=new E.e(this.getEngine(),this._userInstancedBuffersStorage.data[t],t,!0,!1,b,!0);for(const x of this.instances)x.instancedBuffers[t]=null;this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()},r.d.prototype._processInstancedBuffers=function(t,b){const Y=t?t.length:0;for(const o in this.instancedBuffers){let x=this._userInstancedBuffersStorage.sizes[o];const F=this._userInstancedBuffersStorage.strides[o],r=(Y+1)*F;for(;x<r;)x*=2;this._userInstancedBuffersStorage.data[o].length!=x&&(this._userInstancedBuffersStorage.data[o]=new Float32Array(x),this._userInstancedBuffersStorage.sizes[o]=x,this._userInstancedBuffersStorage.vertexBuffers[o]&&(this._userInstancedBuffersStorage.vertexBuffers[o].dispose(),this._userInstancedBuffersStorage.vertexBuffers[o]=null));const R=this._userInstancedBuffersStorage.data[o];let d=0;if(b){const t=this.instancedBuffers[o];t.toArray?t.toArray(R,d):t.copyToArray?t.copyToArray(R,d):R[d]=t,d+=F}for(let b=0;b<Y;b++){const Y=t[b].instancedBuffers[o];Y.toArray?Y.toArray(R,d):Y.copyToArray?Y.copyToArray(R,d):R[d]=Y,d+=F}this._userInstancedBuffersStorage.vertexBuffers[o]?this._userInstancedBuffersStorage.vertexBuffers[o].updateDirectly(R,0):(this._userInstancedBuffersStorage.vertexBuffers[o]=new E.e(this.getEngine(),this._userInstancedBuffersStorage.data[o],o,!0,!1,F,!0),this._invalidateInstanceVertexArrayObject())}},r.d.prototype._invalidateInstanceVertexArrayObject=function(){if(this._userInstancedBuffersStorage&&void 0!==this._userInstancedBuffersStorage.vertexArrayObjects){for(const t in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[t]);this._userInstancedBuffersStorage.vertexArrayObjects={}}},r.d.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(const t in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[t]&&this._userInstancedBuffersStorage.vertexBuffers[t].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}},(0,C.d)("BABYLON.InstancedMesh",p)},11737:(t,b,Y)=>{"use strict";Y.d(b,{d:()=>Q,h:()=>D});var o=Y(1013),x=Y(1265),F=Y(1268),r=Y(1227),R=Y(11744),d=Y(11750),E=Y(1019),U=Y(1229),C=Y(11759),p=Y(1307),W=Y(11766),T=Y(11773),y=Y(11781),v=Y(1401),B=Y(1394),J=Y(11795),m=Y(11779),K=Y(1224),L=Y(1144),z=Y(1041),S=Y(1129),e=Y(1336);class g{constructor(t,b){this.distanceOrScreenCoverage=t,this.mesh=b}}class D{}class H{constructor(){this.visibleInstances={},this.batchCache=new f,this.batchCacheReplacementModeInFrozenMode=new f,this.instancesBufferSize=2048}}class f{constructor(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=[],this.hardwareInstancedRendering=[]}}class n{constructor(){this.instancesCount=0,this.matrixBuffer=null,this.previousMatrixBuffer=null,this.matrixBufferSize=512,this.matrixData=null,this.boundingVectors=[],this.worldMatrices=null}}class X{constructor(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._useLODScreenCoverage=!1,this._effectiveMaterial=null,this._forcedInstanceCount=0,this._overrideRenderingFillMode=null}}class Q extends y.b{static _GetDefaultSideOrientation(t){return t||Q.FRONTSIDE}get useLODScreenCoverage(){return this._internalMeshDataInfo._useLODScreenCoverage}set useLODScreenCoverage(t){this._internalMeshDataInfo._useLODScreenCoverage=t,this._sortLODLevels()}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(t){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==t&&(t&&this._internalMeshDataInfo._sourcePositions&&(this.Ga(p.e.PositionKind,this._internalMeshDataInfo._sourcePositions,!0),this._internalMeshDataInfo._sourceNormals&&this.Ga(p.e.NormalKind,this._internalMeshDataInfo._sourceNormals,!0),this._internalMeshDataInfo._sourcePositions=null,this._internalMeshDataInfo._sourceNormals=null),this._internalAbstractMeshDataInfo._computeBonesUsingShaders=t,this._markSubMeshesAsAttributesDirty())}get onBeforeRenderObservable(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new o.e),this._internalMeshDataInfo._onBeforeRenderObservable}get onBeforeBindObservable(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new o.e),this._internalMeshDataInfo._onBeforeBindObservable}get onAfterRenderObservable(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new o.e),this._internalMeshDataInfo._onAfterRenderObservable}get onBetweenPassObservable(){return this._internalMeshDataInfo._onBetweenPassObservable||(this._internalMeshDataInfo._onBetweenPassObservable=new o.e),this._internalMeshDataInfo._onBetweenPassObservable}get onBeforeDrawObservable(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new o.e),this._internalMeshDataInfo._onBeforeDrawObservable}set onBeforeDraw(t){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(t)}get hasInstances(){return this.instances.length>0}get hasThinInstances(){return(this.forcedInstanceCount||this._thinInstanceDataStorage.instancesCount||0)>0}get forcedInstanceCount(){return this._internalMeshDataInfo._forcedInstanceCount}set forcedInstanceCount(t){this._internalMeshDataInfo._forcedInstanceCount=t}get sideOrientation(){return this._internalMeshDataInfo._sideOrientation}set sideOrientation(t){this._internalMeshDataInfo._sideOrientation=t,this._internalAbstractMeshDataInfo._sideOrientationHint=this._scene.useRightHandedSystem&&1===t||!this._scene.useRightHandedSystem&&0===t}get overrideMaterialSideOrientation(){return this.sideOrientation}set overrideMaterialSideOrientation(t){this.sideOrientation=t,this.material&&(this.material.sideOrientation=null)}get overrideRenderingFillMode(){return this._internalMeshDataInfo._overrideRenderingFillMode}set overrideRenderingFillMode(t){this._internalMeshDataInfo._overrideRenderingFillMode=t}get material(){return this._internalAbstractMeshDataInfo._material}set material(t){t&&(this.material&&null===this.material.sideOrientation||this._internalAbstractMeshDataInfo._sideOrientationHint)&&(t.sideOrientation=null),this._setMaterial(t)}get source(){return this._internalMeshDataInfo._source}get cloneMeshMap(){return this._internalMeshDataInfo.meshMap}get isUnIndexed(){return this._unIndexed}set isUnIndexed(t){this._unIndexed!==t&&(this._unIndexed=t,this._markSubMeshesAsAttributesDirty())}get worldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesData}get previousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesPreviousData}get manualUpdateOfWorldMatrixInstancedBuffer(){return this._instanceDataStorage.manualUpdate}set manualUpdateOfWorldMatrixInstancedBuffer(t){this._instanceDataStorage.manualUpdate=t}get manualUpdateOfPreviousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.previousManualUpdate}set manualUpdateOfPreviousWorldMatrixInstancedBuffer(t){this._instanceDataStorage.previousManualUpdate=t}get forceWorldMatrixInstancedBufferUpdate(){return this._instanceDataStorage.forceMatrixUpdates}set forceWorldMatrixInstancedBufferUpdate(t){this._instanceDataStorage.forceMatrixUpdates=t}_copySource(t,b){let Y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const o=this.va();if(t._geometry&&t._geometry.Ca(this),F.b.DeepCopy(t,this,["name","material","skeleton","instances","parent","uniqueId","source","metadata","morphTargetManager","hasInstances","worldMatrixInstancedBuffer","previousWorldMatrixInstancedBuffer","hasLODLevels","Ee","isBlocked","areNormalsFrozen","facetNb","isFacetDataEnabled","lightSources","useBones","isAnInstance","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","nj","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","cloneMeshMap","hasBoundingInfo","physicsBody","physicsImpostor"],["_poseMatrix"]),this._internalMeshDataInfo._source=t,o.useClonedMeshMap&&(t._internalMeshDataInfo.meshMap||(t._internalMeshDataInfo.meshMap={}),t._internalMeshDataInfo.meshMap[this.uniqueId]=this),this._originalBuilderSideOrientation=t._originalBuilderSideOrientation,this._creationDataStorage=t._creationDataStorage,t._ranges){const b=t._ranges;for(const t in b)Object.prototype.hasOwnProperty.call(b,t)&&b[t]&&this.createAnimationRange(t,b[t].from,b[t].to)}if(t.metadata&&t.metadata.clone?this.metadata=t.metadata.clone():this.metadata=t.metadata,this._internalMetadata=t._internalMetadata,r.b&&r.b.HasTags(t)&&r.b.AddTagsTo(this,r.b.GetTags(t,!0)),this.zg(t.isEnabled(!1)),this.parent=t.parent,this.setPivotMatrix(t.getPivotMatrix(),this._postMultiplyPivotMatrix),this.id=this.name+"."+t.id,this.material=t.material,!b){const b=t.getDescendants(!0);for(let t=0;t<b.length;t++){const Y=b[t];Y.clone&&Y.clone(this.name+"."+Y.name,this)}}if(t.morphTargetManager&&(this.morphTargetManager=t.morphTargetManager),o.getPhysicsEngine){const b=o.getPhysicsEngine();if(Y&&b)if(1===b.getPluginVersion()){const Y=b.getImpostorForPhysicsObject(t);Y&&(this.physicsImpostor=Y.clone(this))}else 2===b.getPluginVersion()&&t.physicsBody&&t.physicsBody.clone(this)}for(let x=0;x<o.ue.length;x++){const b=o.ue[x];b.k===t&&b.clone(b.name,this)}this.skeleton=t.skeleton,this.refreshBoundingInfo(!0,!0),this.ve(!0)}constructor(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,F=arguments.length>4?arguments[4]:void 0,r=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];super(t,b),this._internalMeshDataInfo=new X,this.delayLoadState=0,this.instances=[],this._creationDataStorage=null,this._geometry=null,this._instanceDataStorage=new H,this._thinInstanceDataStorage=new n,this._shouldGenerateFlatShading=!1,this._originalBuilderSideOrientation=Q.DEFAULTSIDE,this.ignoreCameraMaxZ=!1,b=this.va(),this._scene.useRightHandedSystem?this.sideOrientation=0:this.sideOrientation=1,this._onBeforeDraw=(t,b,Y)=>{t&&Y&&(this._uniformBuffer?this.transferToEffect(b):Y.bindOnlyWorldMatrix(b))},x&&this._copySource(x,F,r),null!==Y&&(this.parent=Y),this._instanceDataStorage.hardwareInstancedRendering=this.getEngine().getCaps().instancedArrays,this._internalMeshDataInfo._onMeshReadyObserverAdded=t=>{t.unregisterOnNextCall=!0,this.isReady(!0)?this.onMeshReadyObservable.notifyObservers(this):this._internalMeshDataInfo._checkReadinessObserver||(this._internalMeshDataInfo._checkReadinessObserver=this._scene.onBeforeRenderObservable.add((()=>{this.isReady(!0)&&(this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),this._internalMeshDataInfo._checkReadinessObserver=null,this.onMeshReadyObservable.notifyObservers(this))})))},this.onMeshReadyObservable=new o.e(this._internalMeshDataInfo._onMeshReadyObserverAdded),x&&x.onClonedObservable.notifyObservers(this)}instantiateHierarchy(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,b=arguments.length>1?arguments[1]:void 0,Y=arguments.length>2?arguments[2]:void 0;const o=0===this.getTotalVertices()||b&&b.doNotInstantiate&&(!0===b.doNotInstantiate||b.doNotInstantiate(this))?this.clone("Clone of "+(this.name||this.id),t||this.parent,!0):this.Dd("instance of "+(this.name||this.id));o.parent=t||this.parent,o.position=this.position.clone(),o.Oe=this.Oe.clone(),this.rotationQuaternion?o.rotationQuaternion=this.rotationQuaternion.clone():o.rotation=this.rotation.clone(),Y&&Y(this,o);for(const x of this.getChildTransformNodes(!0))"InstancedMesh"===x.getClassName()&&"Mesh"===o.getClassName()&&x.sourceMesh===this?x.instantiateHierarchy(o,{doNotInstantiate:b&&b.doNotInstantiate||!1,newSourcedMesh:o},Y):x.instantiateHierarchy(o,b,Y);return o}getClassName(){return"Mesh"}get _isMesh(){return!0}toString(t){let b=super.toString(t);if(b+=", n vertices: "+this.getTotalVertices(),b+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(let Y=0;Y<this.animations.length;Y++)b+=", animation[0]: "+this.animations[Y].toString(t);if(t)if(this._geometry){const t=this._d(),Y=this.getVerticesData(p.e.PositionKind);Y&&t&&(b+=", flat shading: "+(Y.length/3===t.length?"YES":"NO"))}else b+=", flat shading: UNKNOWN";return b}_unBindEffect(){super._unBindEffect();for(const t of this.instances)t._unBindEffect()}get hasLODLevels(){return this._internalMeshDataInfo._LODLevels.length>0}getLODLevels(){return this._internalMeshDataInfo._LODLevels}_sortLODLevels(){const t=this._internalMeshDataInfo._useLODScreenCoverage?-1:1;this._internalMeshDataInfo._LODLevels.sort(((b,Y)=>b.distanceOrScreenCoverage<Y.distanceOrScreenCoverage?t:b.distanceOrScreenCoverage>Y.distanceOrScreenCoverage?-t:0))}addLODLevel(t,b){if(b&&b._masterMesh)return L.b.Warn("You cannot use a mesh as LOD level twice"),this;const Y=new g(t,b);return this._internalMeshDataInfo._LODLevels.push(Y),b&&(b._masterMesh=this),this._sortLODLevels(),this}getLODLevelAtDistance(t){const b=this._internalMeshDataInfo;for(let Y=0;Y<b._LODLevels.length;Y++){const o=b._LODLevels[Y];if(o.distanceOrScreenCoverage===t)return o.mesh}return null}removeLODLevel(t){const b=this._internalMeshDataInfo;for(let Y=0;Y<b._LODLevels.length;Y++)b._LODLevels[Y].mesh===t&&(b._LODLevels.splice(Y,1),t&&(t._masterMesh=null));return this._sortLODLevels(),this}getLOD(t,b){const Y=this._internalMeshDataInfo;if(!Y._LODLevels||0===Y._LODLevels.length)return this;const o=b||this.getBoundingInfo().boundingSphere,x=t.mode===d.b.ORTHOGRAPHIC_CAMERA?t._i:o.centerWorld.fd(t.globalPosition).length();let F=x,r=1;if(Y._useLODScreenCoverage){const b=t.screenArea;let Y=o.radiusWorld*t._i/x;Y=Y*Y*Math.PI,F=Y/b,r=-1}if(r*Y._LODLevels[Y._LODLevels.length-1].distanceOrScreenCoverage>r*F)return this.onLODLevelSelection&&this.onLODLevelSelection(F,this,this),this;for(let R=0;R<Y._LODLevels.length;R++){const t=Y._LODLevels[R];if(r*t.distanceOrScreenCoverage<r*F){if(t.mesh){if(4===t.mesh.delayLoadState)return t.mesh._checkDelayState(),this;if(2===t.mesh.delayLoadState)return this;t.mesh._preActivate(),t.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)}return this.onLODLevelSelection&&this.onLODLevelSelection(F,this,t.mesh),t.mesh}}return this.onLODLevelSelection&&this.onLODLevelSelection(F,this,this),this}get Ee(){return this._geometry}getTotalVertices(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()}getVerticesData(t,b,Y,o){var x,F;if(!this._geometry)return null;let r=o||null===(x=this._userInstancedBuffersStorage)||void 0===x||null===(F=x.vertexBuffers[t])||void 0===F?void 0:F.getFloatData(this.instances.length+1,Y||b&&1!==this._geometry.meshes.length);return r||(r=this._geometry.getVerticesData(t,b,Y)),r}copyVerticesData(t,b){this._geometry&&this._geometry.copyVerticesData(t,b)}getVertexBuffer(t,b){var Y;return this._geometry?(b||null===(Y=this._userInstancedBuffersStorage)||void 0===Y?void 0:Y.vertexBuffers[t])??this._geometry.getVertexBuffer(t):null}isVerticesDataPresent(t,b){var Y;return this._geometry?!b&&void 0!==(null===(Y=this._userInstancedBuffersStorage)||void 0===Y?void 0:Y.vertexBuffers[t])||this._geometry.isVerticesDataPresent(t):!!this._delayInfo&&-1!==this._delayInfo.indexOf(t)}isVertexBufferUpdatable(t,b){if(!this._geometry)return!!this._delayInfo&&-1!==this._delayInfo.indexOf(t);if(!b){var Y;const b=null===(Y=this._userInstancedBuffersStorage)||void 0===Y?void 0:Y.vertexBuffers[t];if(b)return b.isUpdatable()}return this._geometry.isVertexBufferUpdatable(t)}getVerticesDataKinds(t){if(!this._geometry){const t=[];return this._delayInfo&&this._delayInfo.forEach((function(b){t.push(b)})),t}const b=this._geometry.getVerticesDataKinds();if(!t&&this._userInstancedBuffersStorage)for(const Y in this._userInstancedBuffersStorage.vertexBuffers)-1===b.indexOf(Y)&&b.push(Y);return b}getTotalIndices(){return this._geometry?this._geometry.getTotalIndices():0}_d(t,b){return this._geometry?this._geometry._d(t,b):[]}get isBlocked(){return null!==this._masterMesh&&void 0!==this._masterMesh}isReady(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(2===this.delayLoadState)return!1;if(!super.isReady(t))return!1;if(!this.ne||0===this.ne.length)return!0;if(!t)return!0;const Y=this.getEngine(),o=this.va(),x=b||Y.getCaps().instancedArrays&&(this.instances.length>0||this.hasThinInstances);this.ve();const F=this.material||o.defaultMaterial;if(F)if(F._storeEffectOnSubMeshes)for(const p of this.ne){const t=p.Ha();if(t)if(t._storeEffectOnSubMeshes){if(!t.isReadyForSubMesh(this,p,x))return!1}else if(!t.isReady(this,x))return!1}else if(!F.isReady(this,x))return!1;const r=Y.currentRenderPassId;for(const p of this.lightSources){const t=p.getShadowGenerators();if(!t)continue;const b=t.values();for(let o=b.next();!0!==o.done;o=b.next()){var R,d,E,U;const t=o.value;if(t&&(null===(R=t.getShadowMap())||void 0===R||!R.renderList||null!==(d=t.getShadowMap())&&void 0!==d&&d.renderList&&-1!==(null===(E=t.getShadowMap())||void 0===E||null===(U=E.renderList)||void 0===U?void 0:U.indexOf(this)))){const b=t.getShadowMap().renderPassIds??[Y.currentRenderPassId];for(let o=0;o<b.length;++o){Y.currentRenderPassId=b[o];for(const b of this.ne){var C;if(!t.isReady(b,x,(null===(C=b.Ha())||void 0===C?void 0:C.needAlphaBlendingForMesh(this))??!1))return Y.currentRenderPassId=r,!1}}Y.currentRenderPassId=r}}}for(const p of this._internalMeshDataInfo._LODLevels)if(p.mesh&&!p.mesh.isReady(x))return!1;return!0}get areNormalsFrozen(){return this._internalMeshDataInfo._areNormalsFrozen}Yh(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this}unfreezeNormals(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this}set overridenInstanceCount(t){this._instanceDataStorage.overridenInstanceCount=t}_preActivate(){const t=this._internalMeshDataInfo,b=this.va().getRenderId();return t._preActivateId===b||(t._preActivateId=b,this._instanceDataStorage.visibleInstances=null),this}_preActivateForIntermediateRendering(t){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=t),this}_registerInstanceForRenderId(t,b){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:b,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[b]||(void 0!==this._instanceDataStorage.previousRenderId&&this._instanceDataStorage.isFrozen&&(this._instanceDataStorage.visibleInstances[this._instanceDataStorage.previousRenderId]=null),this._instanceDataStorage.previousRenderId=b,this._instanceDataStorage.visibleInstances[b]=new Array),this._instanceDataStorage.visibleInstances[b].push(t),this}_afterComputeWorldMatrix(){super._afterComputeWorldMatrix(),this.hasThinInstances&&(this.Da||this.thinInstanceRefreshBoundingInfo(!1))}_postActivate(){this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup&&(this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer),this.edgesRenderer.customInstances.push(this.getWorldMatrix()))}refreshBoundingInfo(){let t,b=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;t="object"===typeof b?b:{applySkeleton:b,applyMorph:Y};const o=this.Ee?this.Ee.boundingBias:null;return this.Fa(this._getData(t,null,p.e.PositionKind),o),this}_createGlobalSubMesh(t){const b=this.getTotalVertices();if(!b||!this._d())return null;if(this.ne&&this.ne.length>0){const Y=this._d();if(!Y)return null;const o=Y.length;let x=!1;if(t)x=!0;else for(const t of this.ne){if(t.indexStart+t.indexCount>o){x=!0;break}if(t.verticesStart+t.verticesCount>b){x=!0;break}}if(!x)return this.ne[0]}return this.releaseSubMeshes(),new v.b(0,0,b,0,this.getTotalIndices(),this)}subdivide(t){if(t<1)return;const b=this.getTotalIndices();let Y=b/t|0,o=0;for(;Y%3!==0;)Y++;this.releaseSubMeshes();for(let x=0;x<t&&!(o>=b);x++)v.b.CreateFromIndices(0,o,x===t-1?b-o:Y,this,void 0,!1),o+=Y;this.refreshBoundingInfo(),this.synchronizeInstances()}Ga(t,b){let Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3?arguments[3]:void 0;if(this._geometry)this._geometry.Ga(t,b,Y,o);else{const o=new W.c;o.set(b,t);const x=this.va();new T.c(T.c.RandomId(),x,o,Y,this)}return this}removeVerticesData(t){this._geometry&&this._geometry.removeVerticesData(t)}markVerticesDataAsUpdatable(t){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const Y=this.getVertexBuffer(t);Y&&Y.isUpdatable()!==b&&this.Ga(t,this.getVerticesData(t),b)}setVerticesBuffer(t){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._geometry||(this._geometry=T.c.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(t,null,b),this}updateVerticesData(t,b,Y,o){return this._geometry?(o?(this.makeGeometryUnique(),this.updateVerticesData(t,b,Y,!1)):this._geometry.updateVerticesData(t,b,Y),this):this}updateMeshPositions(t){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const Y=this.getVerticesData(p.e.PositionKind);if(!Y)return this;if(t(Y),this.updateVerticesData(p.e.PositionKind,Y,!1,!1),b){const t=this._d(),b=this.getVerticesData(p.e.NormalKind);if(!b)return this;W.c.ComputeNormals(Y,t,b),this.updateVerticesData(p.e.NormalKind,b,!1,!1)}return this}makeGeometryUnique(){if(!this._geometry)return this;if(1===this._geometry.meshes.length)return this;const t=this._geometry,b=this._geometry.j(T.c.RandomId());return t.releaseForMesh(this,!0),b.Ca(this),this}setIndexBuffer(t,b,Y){let o=this._geometry;o||(o=new T.c(T.c.RandomId(),this.va(),void 0,void 0,this)),o.setIndexBuffer(t,b,Y)}setIndices(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this._geometry)this._geometry.setIndices(t,b,Y,o);else{const b=new W.c;b.indices=t;const o=this.va();new T.c(T.c.RandomId(),o,b,Y,this)}return this}updateIndices(t,b){let Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this._geometry?(this._geometry.updateIndices(t,b,Y),this):this}toLeftHanded(){return this._geometry?(this._geometry.toLeftHanded(),this):this}_bind(t,b,Y){let o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!this._geometry)return this;const x=this.va().getEngine();let F;if(this._unIndexed)if(this._getRenderingFillMode(Y)===B.e.WireFrameFillMode)F=t._getLinesIndexBuffer(this._d(),x);else F=null;else switch(this._getRenderingFillMode(Y)){case B.e.PointFillMode:F=null;break;case B.e.WireFrameFillMode:F=t._getLinesIndexBuffer(this._d(),x);break;default:case B.e.TriangleFillMode:F=this._geometry.getIndexBuffer()}return this._bindDirect(b,F,o)}_bindDirect(t,b){let Y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this._geometry?(this.morphTargetManager&&this.morphTargetManager.isUsingTextureForTargets&&this.morphTargetManager._bind(t),Y&&this._userInstancedBuffersStorage&&!this.hasThinInstances?this._geometry._bind(t,b,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects):this._geometry._bind(t,b),this):this}_draw(t,b,Y){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);const o=this.va().getEngine();return this._unIndexed&&b!==B.e.WireFrameFillMode||b==B.e.PointFillMode?o.drawArraysType(b,t.verticesStart,t.verticesCount,this.forcedInstanceCount||Y):b==B.e.WireFrameFillMode?o.drawElementsType(b,0,t._linesIndexCount,this.forcedInstanceCount||Y):o.drawElementsType(b,t.indexStart,t.indexCount,this.forcedInstanceCount||Y),this}registerBeforeRender(t){return this.onBeforeRenderObservable.add(t),this}unregisterBeforeRender(t){return this.onBeforeRenderObservable.removeCallback(t),this}registerAfterRender(t){return this.onAfterRenderObservable.add(t),this}unregisterAfterRender(t){return this.onAfterRenderObservable.removeCallback(t),this}_getInstancesRenderList(t){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._instanceDataStorage.isFrozen){if(b)return this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.hardwareInstancedRendering[t]=!1,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.renderSelf[t]=!0,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode;if(this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch}const Y=this.va(),o=Y._isInIntermediateRendering(),x=o?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,F=this._instanceDataStorage.batchCache;if(F.mustReturn=!1,F.renderSelf[t]=b||!x&&this.isEnabled()&&this.isVisible,F.visibleInstances[t]=null,this._instanceDataStorage.visibleInstances&&!b){const b=this._instanceDataStorage.visibleInstances,x=Y.getRenderId(),r=o?b.intermediateDefaultRenderId:b.defaultRenderId;F.visibleInstances[t]=b[x],!F.visibleInstances[t]&&r&&(F.visibleInstances[t]=b[r])}return F.hardwareInstancedRendering[t]=!b&&this._instanceDataStorage.hardwareInstancedRendering&&null!==F.visibleInstances[t]&&void 0!==F.visibleInstances[t],this._instanceDataStorage.previousBatch=F,F}_renderWithInstances(t,b,Y,o,x){const F=Y.visibleInstances[t._id],r=F?F.length:0,R=this._instanceDataStorage,d=R.instancesBufferSize;let U=R.instancesBuffer,C=R.instancesPreviousBuffer;const W=16*(r+1)*4;for(;R.instancesBufferSize<W;)R.instancesBufferSize*=2;R.instancesData&&d==R.instancesBufferSize||(R.instancesData=new Float32Array(R.instancesBufferSize/4)),(this._scene.needsPreviousWorldMatrices&&!R.instancesPreviousData||d!=R.instancesBufferSize)&&(R.instancesPreviousData=new Float32Array(R.instancesBufferSize/4));let T=0,y=0;const v=Y.renderSelf[t._id],B=!U||d!==R.instancesBufferSize||this._scene.needsPreviousWorldMatrices&&!R.instancesPreviousBuffer;if(this._instanceDataStorage.manualUpdate||R.isFrozen&&!B)y=(v?1:0)+r;else{const b=this.getWorldMatrix();if(v&&(this._scene.needsPreviousWorldMatrices&&(R.masterMeshPreviousWorldMatrix?(R.masterMeshPreviousWorldMatrix.copyToArray(R.instancesPreviousData,T),R.masterMeshPreviousWorldMatrix.p(b)):(R.masterMeshPreviousWorldMatrix=b.clone(),R.masterMeshPreviousWorldMatrix.copyToArray(R.instancesPreviousData,T))),b.copyToArray(R.instancesData,T),T+=16,y++),F){var J;if(Q.INSTANCEDMESH_SORT_TRANSPARENT&&this._scene.activeCamera&&null!==(J=t.Ha())&&void 0!==J&&J.needAlphaBlendingForMesh(t.getRenderingMesh())){const t=this._scene.activeCamera.globalPosition;for(let b=0;b<F.length;b++){const Y=F[b];Y._distanceToCamera=E.l.Distance(Y.getBoundingInfo().boundingSphere.centerWorld,t)}F.sort(((t,b)=>t._distanceToCamera>b._distanceToCamera?-1:t._distanceToCamera<b._distanceToCamera?1:0))}for(let t=0;t<F.length;t++){const b=F[t],Y=b.getWorldMatrix();Y.copyToArray(R.instancesData,T),this._scene.needsPreviousWorldMatrices&&(b._previousWorldMatrix?(b._previousWorldMatrix.copyToArray(R.instancesPreviousData,T),b._previousWorldMatrix.p(Y)):(b._previousWorldMatrix=Y.clone(),b._previousWorldMatrix.copyToArray(R.instancesPreviousData,T))),T+=16,y++}}}return B?(U&&U.dispose(),C&&C.dispose(),U=new p.d(x,R.instancesData,!0,16,!1,!0),R.instancesBuffer=U,this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this._userInstancedBuffersStorage.vertexBuffers.world0=U.createVertexBuffer("world0",0,4),this._userInstancedBuffersStorage.vertexBuffers.world1=U.createVertexBuffer("world1",4,4),this._userInstancedBuffersStorage.vertexBuffers.world2=U.createVertexBuffer("world2",8,4),this._userInstancedBuffersStorage.vertexBuffers.world3=U.createVertexBuffer("world3",12,4),this._scene.needsPreviousWorldMatrices&&(C=new p.d(x,R.instancesPreviousData,!0,16,!1,!0),R.instancesPreviousBuffer=C,this._userInstancedBuffersStorage.vertexBuffers.previousWorld0=C.createVertexBuffer("previousWorld0",0,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld1=C.createVertexBuffer("previousWorld1",4,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld2=C.createVertexBuffer("previousWorld2",8,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld3=C.createVertexBuffer("previousWorld3",12,4)),this._invalidateInstanceVertexArrayObject()):this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||(U.updateDirectly(R.instancesData,0,y),!this._scene.needsPreviousWorldMatrices||this._instanceDataStorage.manualUpdate&&!this._instanceDataStorage.previousManualUpdate||C.updateDirectly(R.instancesPreviousData,0,y)),this._processInstancedBuffers(F,v),this.va()._activeIndices.addCount(t.indexCount*y,!1),x._currentDrawContext&&(x._currentDrawContext.useInstancing=!0),this._bind(t,o,b),this._draw(t,b,y),!this._scene.needsPreviousWorldMatrices||B||!this._instanceDataStorage.manualUpdate||this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||this._instanceDataStorage.previousManualUpdate||C.updateDirectly(R.instancesData,0,y),x.unbindInstanceAttributes(),this}_renderWithThinInstances(t,b,Y,o){var x;const F=(null===(x=this._thinInstanceDataStorage)||void 0===x?void 0:x.instancesCount)??0;this.va()._activeIndices.addCount(t.indexCount*F,!1),o._currentDrawContext&&(o._currentDrawContext.useInstancing=!0),this._bind(t,Y,b),this._draw(t,b,F),this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&this._thinInstanceDataStorage.matrixData&&(this._thinInstanceDataStorage.previousMatrixBuffer?this._thinInstanceDataStorage.previousMatrixBuffer.updateDirectly(this._thinInstanceDataStorage.matrixData,0,F):this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.matrixData,!1)),o.unbindInstanceAttributes()}_processInstancedBuffers(t,b){}_processRendering(t,b,Y,o,x,F,r,R){const d=this.va(),E=d.getEngine();if(o=this._getRenderingFillMode(o),F&&b.getRenderingMesh().hasThinInstances)return this._renderWithThinInstances(b,o,Y,E),this;if(F)this._renderWithInstances(b,o,x,Y,E);else{E._currentDrawContext&&(E._currentDrawContext.useInstancing=!1);let Y=0;x.renderSelf[b._id]&&(r&&r(!1,t.getWorldMatrix(),R),Y++,this._draw(b,o,this._instanceDataStorage.overridenInstanceCount));const F=x.visibleInstances[b._id];if(F){const t=F.length;Y+=t;for(let Y=0;Y<t;Y++){const t=F[Y].getWorldMatrix();r&&r(!0,t,R),this._draw(b,o)}}d._activeIndices.addCount(b.indexCount*Y,!1)}return this}_rebuild(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._instanceDataStorage.instancesBuffer&&(t&&this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),this._userInstancedBuffersStorage){for(const b in this._userInstancedBuffersStorage.vertexBuffers){const Y=this._userInstancedBuffersStorage.vertexBuffers[b];Y&&(t&&Y.dispose(),this._userInstancedBuffersStorage.vertexBuffers[b]=null)}this._userInstancedBuffersStorage.vertexArrayObjects&&(this._userInstancedBuffersStorage.vertexArrayObjects={})}this._internalMeshDataInfo._effectiveMaterial=null,super._rebuild(t)}_freeze(){if(this.ne){for(let t=0;t<this.ne.length;t++)this._getInstancesRenderList(t);this._internalMeshDataInfo._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}}_unFreeze(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null}renderWithRenderPassId(t,b,Y,o){let x=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const F=this._scene.getEngine(),r=F.currentRenderPassId;if(void 0!==t&&(F.currentRenderPassId=t),o)(!x||x&&o.isInFrustum(this._scene._frustumPlanes))&&this.render(o,!!b,Y);else for(let R=0;R<this.ne.length;R++){const t=this.ne[R];(!x||x&&t.isInFrustum(this._scene._frustumPlanes))&&this.render(t,!!b,Y)}return void 0!==t&&(F.currentRenderPassId=r),this}directRender(){if(!this.ne)return this;for(const t of this.ne)this.render(t,!1);return this}render(t,b,Y){var o,x,F;const r=this.va();this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1;const R=(null===(o=r.activeCameras)||void 0===o?void 0:o.length)??0;if((R>1&&r.activeCamera===r.activeCameras[0]||R<=1)&&this._checkOcclusionQuery()&&!this._occlusionDataStorage.forceRenderingWhenOccluded)return this;const d=this._getInstancesRenderList(t._id,!!Y);if(d.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const E=r.getEngine();let U=0,C=null;this.ignoreCameraMaxZ&&r.activeCamera&&!r._isInIntermediateRendering()&&(U=r.activeCamera.maxZ,C=r.activeCamera,r.activeCamera.maxZ=0,r.updateTransformMatrix(!0)),this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);const p=t.getRenderingMesh(),W=d.hardwareInstancedRendering[t._id]||p.hasThinInstances||!!this._userInstancedBuffersStorage&&!t.getMesh()._internalAbstractMeshDataInfo._actAsRegularMesh,T=this._instanceDataStorage,y=t.Ha();if(!y)return C&&(C.maxZ=U,r.updateTransformMatrix(!0)),this;if(T.isFrozen&&this._internalMeshDataInfo._effectiveMaterial&&this._internalMeshDataInfo._effectiveMaterial===y){if(y._storeEffectOnSubMeshes&&(null===(x=t._drawWrapper)||void 0===x||!x._wasPreviouslyReady)||!y._storeEffectOnSubMeshes&&!y._getDrawWrapper()._wasPreviouslyReady)return C&&(C.maxZ=U,r.updateTransformMatrix(!0)),this}else{if(y._storeEffectOnSubMeshes){if(!y.isReadyForSubMesh(this,t,W))return C&&(C.maxZ=U,r.updateTransformMatrix(!0)),this}else if(!y.isReady(this,W))return C&&(C.maxZ=U,r.updateTransformMatrix(!0)),this;this._internalMeshDataInfo._effectiveMaterial=y}let v;b&&E.setAlphaMode(this._internalMeshDataInfo._effectiveMaterial.alphaMode),v=this._internalMeshDataInfo._effectiveMaterial._storeEffectOnSubMeshes?t._drawWrapper:this._internalMeshDataInfo._effectiveMaterial._getDrawWrapper();const J=(null===(F=v)||void 0===F?void 0:F.effect)??null;for(const B of r._beforeRenderingMeshStage)B.action(this,t,d,J);if(!v||!J)return C&&(C.maxZ=U,r.updateTransformMatrix(!0)),this;const m=Y||this;let K;if(T.isFrozen||!this._internalMeshDataInfo._effectiveMaterial.Ce&&null===this._internalMeshDataInfo._effectiveMaterial.sideOrientation&&!this._internalMeshDataInfo._effectiveMaterial.twoSidedLighting)K=T.sideOrientation;else{const t=m._getWorldMatrixDeterminant();K=this._internalMeshDataInfo._effectiveMaterial._getEffectiveOrientation(this),t<0&&(K=K===B.e.ClockWiseSideOrientation?B.e.CounterClockWiseSideOrientation:B.e.ClockWiseSideOrientation),T.sideOrientation=K}const L=this._internalMeshDataInfo._effectiveMaterial._preBind(v,K);this._internalMeshDataInfo._effectiveMaterial.forceDepthWrite&&E.setDepthWrite(!0);const z=this._internalMeshDataInfo._effectiveMaterial,S=z.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),W||this._bind(t,J,S,!1);const e=m.getWorldMatrix();z._storeEffectOnSubMeshes?z.bindForSubMesh(e,this,t):z.bind(e,this),!z.Ce&&z.separateCullingPass&&(E.setState(!0,z.zOffset,!1,!L,z.cullBackFaces,z.stencil,z.zOffsetUnits),this._processRendering(this,t,J,S,d,W,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),E.setState(!0,z.zOffset,!1,L,z.cullBackFaces,z.stencil,z.zOffsetUnits),this._internalMeshDataInfo._onBetweenPassObservable&&this._internalMeshDataInfo._onBetweenPassObservable.notifyObservers(t)),this._processRendering(this,t,J,S,d,W,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),this._internalMeshDataInfo._effectiveMaterial.unbind();for(const B of r._afterRenderingMeshStage)B.action(this,t,d,J);return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),C&&(C.maxZ=U,r.updateTransformMatrix(!0)),2!==r.performancePriority||T.isFrozen||this._freeze(),this}cleanMatrixWeights(){this.isVerticesDataPresent(p.e.MatricesWeightsKind)&&(this.isVerticesDataPresent(p.e.MatricesWeightsExtraKind)?this._normalizeSkinWeightsAndExtra():this._normalizeSkinFourWeights())}_normalizeSkinFourWeights(){const t=this.getVerticesData(p.e.MatricesWeightsKind),b=t.length;for(let Y=0;Y<b;Y+=4){const b=t[Y]+t[Y+1]+t[Y+2]+t[Y+3];if(0===b)t[Y]=1;else{const o=1/b;t[Y]*=o,t[Y+1]*=o,t[Y+2]*=o,t[Y+3]*=o}}this.Ga(p.e.MatricesWeightsKind,t)}_normalizeSkinWeightsAndExtra(){const t=this.getVerticesData(p.e.MatricesWeightsExtraKind),b=this.getVerticesData(p.e.MatricesWeightsKind),Y=b.length;for(let o=0;o<Y;o+=4){let Y=b[o]+b[o+1]+b[o+2]+b[o+3];if(Y+=t[o]+t[o+1]+t[o+2]+t[o+3],0===Y)b[o]=1;else{const x=1/Y;b[o]*=x,b[o+1]*=x,b[o+2]*=x,b[o+3]*=x,t[o]*=x,t[o+1]*=x,t[o+2]*=x,t[o+3]*=x}}this.Ga(p.e.MatricesWeightsKind,b),this.Ga(p.e.MatricesWeightsKind,t)}validateSkinning(){const t=this.getVerticesData(p.e.MatricesWeightsExtraKind),b=this.getVerticesData(p.e.MatricesWeightsKind);if(null===b||null==this.skeleton)return{skinned:!1,valid:!0,Re:"not skinned"};const Y=b.length;let o=0,x=0,F=0,r=0;const R=null===t?4:8,d=[];for(let p=0;p<=R;p++)d[p]=0;for(let p=0;p<Y;p+=4){let Y=b[p],E=Y,U=0===E?0:1;for(let x=1;x<R;x++){const F=x<4?b[p+x]:t[p+x-4];F>Y&&o++,0!==F&&U++,E+=F,Y=F}if(d[U]++,U>F&&(F=U),0===E)x++;else{const Y=1/E;let o=0;for(let x=0;x<R;x++)o+=x<4?Math.abs(b[p+x]-b[p+x]*Y):Math.abs(t[p+x-4]-t[p+x-4]*Y);o>.001&&r++}}const E=this.skeleton.bones.length,U=this.getVerticesData(p.e.MatricesIndicesKind),C=this.getVerticesData(p.e.MatricesIndicesExtraKind);let W=0;for(let p=0;p<Y;p+=4)for(let t=0;t<R;t++){const b=t<4?U[p+t]:C[p+t-4];(b>=E||b<0)&&W++}return{skinned:!0,valid:0===x&&0===r&&0===W,Re:"Number of Weights = "+Y/4+"\nMaximum influences = "+F+"\nMissing Weights = "+x+"\nNot Sorted = "+o+"\nNot Normalized = "+r+"\nWeightCounts = ["+d+"]\nNumber of bones = "+E+"\nBad Bone Indices = "+W}}_checkDelayState(){const t=this.va();return this._geometry?this._geometry.load(t):4===this.delayLoadState&&(this.delayLoadState=2,this._queueLoad(t)),this}_queueLoad(t){t.addPendingData(this);const b=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return x.f.LoadFile(this.delayLoadingFile,(b=>{b instanceof ArrayBuffer?this._delayLoadingFunction(b,this):this._delayLoadingFunction(JSON.parse(b),this),this.instances.forEach((t=>{t.refreshBoundingInfo(),t._syncSubMeshes()})),this.delayLoadState=1,t.removePendingData(this)}),(()=>{}),t.offlineProvider,b),this}isInFrustum(t){return 2!==this.delayLoadState&&(!!super.isInFrustum(t)&&(this._checkDelayState(),!0))}setMaterialById(t){const b=this.va().materials;let Y;for(Y=b.length-1;Y>-1;Y--)if(b[Y].id===t)return this.material=b[Y],this;const o=this.va().multiMaterials;for(Y=o.length-1;Y>-1;Y--)if(o[Y].id===t)return this.material=o[Y],this;return this}getAnimatables(){const t=[];return this.material&&t.push(this.material),this.skeleton&&t.push(this.skeleton),t}bakeTransformIntoVertices(t){if(!this.isVerticesDataPresent(p.e.PositionKind))return this;const b=this.ne.splice(0);this._resetPointsArrayCache();let Y=this.getVerticesData(p.e.PositionKind);const o=E.l.Zero();let x;for(x=0;x<Y.length;x+=3)E.l.TransformCoordinatesFromFloatsToRef(Y[x],Y[x+1],Y[x+2],t,o).toArray(Y,x);if(this.Ga(p.e.PositionKind,Y,this.getVertexBuffer(p.e.PositionKind).isUpdatable()),this.isVerticesDataPresent(p.e.NormalKind)){for(Y=this.getVerticesData(p.e.NormalKind),x=0;x<Y.length;x+=3)E.l.TransformNormalFromFloatsToRef(Y[x],Y[x+1],Y[x+2],t,o).normalize().toArray(Y,x);this.Ga(p.e.NormalKind,Y,this.getVertexBuffer(p.e.NormalKind).isUpdatable())}if(this.isVerticesDataPresent(p.e.TangentKind)){for(Y=this.getVerticesData(p.e.TangentKind),x=0;x<Y.length;x+=4)E.l.TransformNormalFromFloatsToRef(Y[x],Y[x+1],Y[x+2],t,o).normalize().toArray(Y,x);this.Ga(p.e.TangentKind,Y,this.getVertexBuffer(p.e.TangentKind).isUpdatable())}return t.determinant()<0&&this.flipFaces(),this.releaseSubMeshes(),this.ne=b,this}bakeCurrentTransformIntoVertices(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.bakeTransformIntoVertices(this.ve(!0)),this.resetLocalMatrix(t),this}get _positions(){return this._internalAbstractMeshDataInfo._positions||this._geometry&&this._geometry._positions||null}_resetPointsArrayCache(){return this._geometry&&this._geometry._resetPointsArrayCache(),this}_generatePointsArray(){return!!this._geometry&&this._geometry._generatePointsArray()}clone(){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2?arguments[2]:void 0,Y=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return new Q(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",this.va(),t,this,b,Y)}dispose(t){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);const Y=this._internalMeshDataInfo;if(Y._onBeforeDrawObservable&&Y._onBeforeDrawObservable.clear(),Y._onBeforeBindObservable&&Y._onBeforeBindObservable.clear(),Y._onBeforeRenderObservable&&Y._onBeforeRenderObservable.clear(),Y._onAfterRenderObservable&&Y._onAfterRenderObservable.clear(),Y._onBetweenPassObservable&&Y._onBetweenPassObservable.clear(),this._scene.useClonedMeshMap){if(Y.meshMap)for(const t in Y.meshMap){const b=Y.meshMap[t];b&&(b._internalMeshDataInfo._source=null,Y.meshMap[t]=void 0)}Y._source&&Y._source._internalMeshDataInfo.meshMap&&(Y._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else{const t=this.va().meshes;for(const b of t){const t=b;t._internalMeshDataInfo&&t._internalMeshDataInfo._source&&t._internalMeshDataInfo._source===this&&(t._internalMeshDataInfo._source=null)}}Y._source=null,this._instanceDataStorage.visibleInstances={},this._disposeInstanceSpecificData(),this._disposeThinInstanceSpecificData(),this._internalMeshDataInfo._checkReadinessObserver&&this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),super.dispose(t,b)}_disposeInstanceSpecificData(){}_disposeThinInstanceSpecificData(){}_invalidateInstanceVertexArrayObject(){}applyDisplacementMap(t,b,Y,o,F,r){let R=arguments.length>6&&void 0!==arguments[6]&&arguments[6],d=arguments.length>7?arguments[7]:void 0;const E=this.va();return x.f.LoadImage(t,(t=>{const x=t.width,d=t.height,E=this.getEngine().createCanvas(x,d).getContext("2d");E.drawImage(t,0,0);const U=E.getImageData(0,0,x,d).data;this.applyDisplacementMapFromBuffer(U,x,d,b,Y,F,r,R),o&&o(this)}),d||(()=>{}),E.offlineProvider),this}applyDisplacementMapFromBuffer(t,b,Y,o,x,F,r){let R=arguments.length>7&&void 0!==arguments[7]&&arguments[7];if(!this.isVerticesDataPresent(p.e.PositionKind)||!this.isVerticesDataPresent(p.e.NormalKind)||!this.isVerticesDataPresent(p.e.UVKind))return L.b.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;const d=this.getVerticesData(p.e.PositionKind,!0,!0),U=this.getVerticesData(p.e.NormalKind),C=this.getVerticesData(p.e.UVKind);let T=E.l.Zero();const y=E.l.Zero(),v=E.i.Zero();F=F||E.i.Zero(),r=r||new E.i(1,1);for(let p=0;p<d.length;p+=3){E.l.FromArrayToRef(d,p,T),E.l.FromArrayToRef(U,p,y),E.i.FromArrayToRef(C,p/3*2,v);const R=4*((Math.abs(v.x*r.x+F.x%1)*(b-1)%b|0)+(Math.abs(v.y*r.y+F.y%1)*(Y-1)%Y|0)*b),W=.3*(t[R]/255)+.59*(t[R+1]/255)+.11*(t[R+2]/255);y.normalize(),y.scaleInPlace(o+(x-o)*W),T=T.add(y),T.toArray(d,p)}return W.c.ComputeNormals(d,this._d(),U),R?(this.Ga(p.e.PositionKind,d),this.Ga(p.e.NormalKind,U),this.Ga(p.e.UVKind,C)):(this.updateVerticesData(p.e.PositionKind,d),this.updateVerticesData(p.e.NormalKind,U)),this}_getFlattenedNormals(t,b){const Y=new Float32Array(3*t.length);let o=0;const x=this.sideOrientation===(this._scene.useRightHandedSystem?1:0);for(let F=0;F<t.length;F+=3){const r=E.l.ce(b,3*t[F]),R=E.l.ce(b,3*t[F+1]),d=E.l.ce(b,3*t[F+2]),U=r.fd(R),C=d.fd(R),p=E.l.Normalize(E.l.Cross(U,C));x&&p.scaleInPlace(-1);for(let t=0;t<3;t++)Y[o++]=p.x,Y[o++]=p.y,Y[o++]=p.z}return Y}_convertToUnIndexedMesh(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b=this.getVerticesDataKinds().filter((t=>{var b;return!(null!==(b=this.getVertexBuffer(t))&&void 0!==b&&b.getIsInstanced())})),Y=this._d(),o={},x=(t,b)=>{const o=new Float32Array(Y.length*b);let x=0;for(let F=0;F<Y.length;F++)for(let r=0;r<b;r++)o[x++]=t[Y[F]*b+r];return o},F=this.getBoundingInfo(),r=this.Ee?this.ne.slice(0):[];for(const R of b)o[R]=this.getVerticesData(R);for(const R of b){const b=this.getVertexBuffer(R),F=b.getSize();if(t&&R===p.e.NormalKind){const t=this._getFlattenedNormals(Y,o[p.e.PositionKind]);this.Ga(p.e.NormalKind,t,b.isUpdatable(),F)}else this.Ga(R,x(o[R],F),b.isUpdatable(),F)}if(this.morphTargetManager){for(let b=0;b<this.morphTargetManager.numTargets;b++){const o=this.morphTargetManager.getTarget(b),F=o.getPositions();o.setPositions(x(F,3));const r=o.getNormals();r&&o.setNormals(t?this._getFlattenedNormals(Y,F):x(r,3));const R=o.getTangents();R&&o.setTangents(x(R,3));const d=o.getUVs();d&&o.setUVs(x(d,2))}this.morphTargetManager.synchronize()}for(let R=0;R<Y.length;R++)Y[R]=R;this.setIndices(Y),this._unIndexed=!0,this.releaseSubMeshes();for(const R of r){const t=R.getBoundingInfo();v.b.AddToMesh(R.materialIndex,R.indexStart,R.indexCount,R.indexStart,R.indexCount,this).setBoundingInfo(t)}return this.setBoundingInfo(F),this.synchronizeInstances(),this}convertToFlatShadedMesh(){return this._convertToUnIndexedMesh(!0)}convertToUnIndexedMesh(){return this._convertToUnIndexedMesh()}flipFaces(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b=W.c.ExtractFromMesh(this);let Y;if(t&&this.isVerticesDataPresent(p.e.NormalKind)&&b.ya){for(Y=0;Y<b.ya.length;Y++)b.ya[Y]*=-1;this.Ga(p.e.NormalKind,b.ya,this.isVertexBufferUpdatable(p.e.NormalKind))}if(b.indices){let t;for(Y=0;Y<b.indices.length;Y+=3)t=b.indices[Y+1],b.indices[Y+1]=b.indices[Y+2],b.indices[Y+2]=t;this.setIndices(b.indices,null,this.isVertexBufferUpdatable(p.e.PositionKind),!0)}return this}increaseVertices(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const b=W.c.ExtractFromMesh(this),Y=b.indices&&!Array.isArray(b.indices)&&Array.from?Array.from(b.indices):b.indices,o=b.xa&&!Array.isArray(b.xa)&&Array.from?Array.from(b.xa):b.xa,x=b.Aa&&!Array.isArray(b.Aa)&&Array.from?Array.from(b.Aa):b.Aa,F=b.ya&&!Array.isArray(b.ya)&&Array.from?Array.from(b.ya):b.ya;if(Y&&o){b.indices=Y,b.xa=o,x&&(b.Aa=x),F&&(b.ya=F);const r=t+1,R=new Array;for(let t=0;t<r+1;t++)R[t]=new Array;let d,U;const C=new E.l(0,0,0),W=new E.l(0,0,0),T=new E.i(0,0),y=new Array,v=new Array,B=new Array;let J,m,K,L=o.length;x&&(m=x.length),F&&(K=F.length);for(let t=0;t<Y.length;t+=3){v[0]=Y[t],v[1]=Y[t+1],v[2]=Y[t+2];for(let t=0;t<3;t++)if(d=v[t],U=v[(t+1)%3],void 0===B[d]&&void 0===B[U]?(B[d]=new Array,B[U]=new Array):(void 0===B[d]&&(B[d]=new Array),void 0===B[U]&&(B[U]=new Array)),void 0===B[d][U]&&void 0===B[U][d]){B[d][U]=[],C.x=(o[3*U]-o[3*d])/r,C.y=(o[3*U+1]-o[3*d+1])/r,C.z=(o[3*U+2]-o[3*d+2])/r,F&&(W.x=(F[3*U]-F[3*d])/r,W.y=(F[3*U+1]-F[3*d+1])/r,W.z=(F[3*U+2]-F[3*d+2])/r),x&&(T.x=(x[2*U]-x[2*d])/r,T.y=(x[2*U+1]-x[2*d+1])/r),B[d][U].push(d);for(let t=1;t<r;t++)B[d][U].push(o.length/3),o[L++]=o[3*d]+t*C.x,o[L++]=o[3*d+1]+t*C.y,o[L++]=o[3*d+2]+t*C.z,F&&(F[K++]=F[3*d]+t*W.x,F[K++]=F[3*d+1]+t*W.y,F[K++]=F[3*d+2]+t*W.z),x&&(x[m++]=x[2*d]+t*T.x,x[m++]=x[2*d+1]+t*T.y);B[d][U].push(U),B[U][d]=new Array,J=B[d][U].length;for(let t=0;t<J;t++)B[U][d][t]=B[d][U][J-1-t]}R[0][0]=Y[t],R[1][0]=B[Y[t]][Y[t+1]][1],R[1][1]=B[Y[t]][Y[t+2]][1];for(let b=2;b<r;b++){R[b][0]=B[Y[t]][Y[t+1]][b],R[b][b]=B[Y[t]][Y[t+2]][b],C.x=(o[3*R[b][b]]-o[3*R[b][0]])/b,C.y=(o[3*R[b][b]+1]-o[3*R[b][0]+1])/b,C.z=(o[3*R[b][b]+2]-o[3*R[b][0]+2])/b,F&&(W.x=(F[3*R[b][b]]-F[3*R[b][0]])/b,W.y=(F[3*R[b][b]+1]-F[3*R[b][0]+1])/b,W.z=(F[3*R[b][b]+2]-F[3*R[b][0]+2])/b),x&&(T.x=(x[2*R[b][b]]-x[2*R[b][0]])/b,T.y=(x[2*R[b][b]+1]-x[2*R[b][0]+1])/b);for(let t=1;t<b;t++)R[b][t]=o.length/3,o[L++]=o[3*R[b][0]]+t*C.x,o[L++]=o[3*R[b][0]+1]+t*C.y,o[L++]=o[3*R[b][0]+2]+t*C.z,F&&(F[K++]=F[3*R[b][0]]+t*W.x,F[K++]=F[3*R[b][0]+1]+t*W.y,F[K++]=F[3*R[b][0]+2]+t*W.z),x&&(x[m++]=x[2*R[b][0]]+t*T.x,x[m++]=x[2*R[b][0]+1]+t*T.y)}R[r]=B[Y[t+1]][Y[t+2]],y.push(R[0][0],R[1][0],R[1][1]);for(let t=1;t<r;t++){let b;for(b=0;b<t;b++)y.push(R[t][b],R[t+1][b],R[t+1][b+1]),y.push(R[t][b],R[t+1][b+1],R[t][b+1]);y.push(R[t][b],R[t+1][b],R[t+1][b+1])}}b.indices=y,b.Ca(this,this.isVertexBufferUpdatable(p.e.PositionKind))}else L.b.Warn("Couldn't increase number of vertices : VertexData must contain at least indices and positions")}forceSharedVertices(){const t=W.c.ExtractFromMesh(this),b=t.Aa,Y=t.indices,o=t.xa,x=t.za,F=t.matricesIndices,r=t.matricesWeights,R=t.matricesIndicesExtra,d=t.matricesWeightsExtra;if(void 0===Y||void 0===o||null===Y||null===o)L.b.Warn("VertexData contains empty entries");else{const E=new Array,U=new Array,C=new Array,T=new Array,y=new Array,v=new Array,B=new Array,J=new Array;let m=new Array,K=0;const L={};let z,S;for(let t=0;t<Y.length;t+=3){S=[Y[t],Y[t+1],Y[t+2]],m=[];for(let t=0;t<3;t++){m[t]="";for(let b=0;b<3;b++)Math.abs(o[3*S[t]+b])<1e-8&&(o[3*S[t]+b]=0),m[t]+=o[3*S[t]+b]+"|"}if(m[0]!=m[1]&&m[0]!=m[2]&&m[1]!=m[2])for(let t=0;t<3;t++){if(z=L[m[t]],void 0===z){L[m[t]]=K,z=K++;for(let b=0;b<3;b++)E.push(o[3*S[t]+b]);if(null!==x&&void 0!==x)for(let b=0;b<4;b++)T.push(x[4*S[t]+b]);if(null!==b&&void 0!==b)for(let Y=0;Y<2;Y++)C.push(b[2*S[t]+Y]);if(null!==F&&void 0!==F)for(let b=0;b<4;b++)y.push(F[4*S[t]+b]);if(null!==r&&void 0!==r)for(let b=0;b<4;b++)v.push(r[4*S[t]+b]);if(null!==R&&void 0!==R)for(let b=0;b<4;b++)B.push(R[4*S[t]+b]);if(null!==d&&void 0!==d)for(let b=0;b<4;b++)J.push(d[4*S[t]+b])}U.push(z)}}const e=new Array;W.c.ComputeNormals(E,U,e),t.xa=E,t.indices=U,t.ya=e,null!==b&&void 0!==b&&(t.Aa=C),null!==x&&void 0!==x&&(t.za=T),null!==F&&void 0!==F&&(t.matricesIndices=y),null!==r&&void 0!==r&&(t.matricesWeights=v),null!==R&&void 0!==R&&(t.matricesIndicesExtra=B),null!==r&&void 0!==r&&(t.matricesWeightsExtra=J),t.Ca(this,this.isVertexBufferUpdatable(p.e.PositionKind))}}static _instancedMeshFactory(t,b){throw(0,S.c)("InstancedMesh")}static _PhysicsImpostorParser(t,b,Y){throw(0,S.c)("PhysicsImpostor")}Dd(t){const b=Q._instancedMeshFactory(t,this);return b.parent=this.parent,b}synchronizeInstances(){for(let t=0;t<this.instances.length;t++){this.instances[t]._syncSubMeshes()}return this}optimizeIndices(t){const b=this._d(),Y=this.getVerticesData(p.e.PositionKind);if(!Y||!b)return this;const o=[];for(let x=0;x<Y.length;x+=3)o.push(E.l.ce(Y,x));const F=[];return x.d.SyncAsyncForLoop(o.length,40,(t=>{const b=o.length-1-t,Y=o[b];for(let x=0;x<b;++x){const t=o[x];if(Y.equals(t)){F[b]=x;break}}}),(()=>{for(let t=0;t<b.length;++t)b[t]=F[b[t]]||b[t];const Y=this.ne.slice(0);this.setIndices(b),this.ne=Y,t&&t(this)})),this}serialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.name=this.name,t.id=this.id,t.uniqueId=this.uniqueId,t.type=this.getClassName(),r.b&&r.b.HasTags(this)&&(t.tags=r.b.GetTags(this)),t.position=this.position.qe(),this.rotationQuaternion?t.rotationQuaternion=this.rotationQuaternion.qe():this.rotation&&(t.rotation=this.rotation.qe()),t.Oe=this.Oe.qe(),this._postMultiplyPivotMatrix?t.pivotMatrix=this.getPivotMatrix().qe():t.localMatrix=this.getPivotMatrix().qe(),t.isEnabled=this.isEnabled(!1),t.isVisible=this.isVisible,t.infiniteDistance=this.infiniteDistance,t.pickable=this.Ve,t.receiveShadows=this.receiveShadows,t.billboardMode=this.billboardMode,t.visibility=this.visibility,t.hf=this.hf,t.checkCollisions=this.checkCollisions,t.ellipsoid=this.ellipsoid.qe(),t.ellipsoidOffset=this.ellipsoidOffset.qe(),t.Da=this.Da,t.isBlocker=this.isBlocker,t.sideOrientation=this.sideOrientation,this.parent&&this.parent._serializeAsParent(t),t.isUnIndexed=this.isUnIndexed;const b=this._geometry;if(b&&this.ne){t.geometryUniqueId=b.uniqueId,t.geometryId=b.id,t.ne=[];for(let b=0;b<this.ne.length;b++){const Y=this.ne[b];t.ne.push({materialIndex:Y.materialIndex,verticesStart:Y.verticesStart,verticesCount:Y.verticesCount,indexStart:Y.indexStart,indexCount:Y.indexCount})}}if(this.material?this.material.doNotSerialize||(t.materialUniqueId=this.material.uniqueId,t.materialId=this.material.id):(this.material=null,t.materialUniqueId=this._scene.defaultMaterial.uniqueId,t.materialId=this._scene.defaultMaterial.id),this.morphTargetManager&&(t.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(t.skeletonId=this.skeleton.id,t.numBoneInfluencers=this.numBoneInfluencers),this.va()._getComponent(e.b.NAME_PHYSICSENGINE)){const b=this.getPhysicsImpostor();b&&(t.physicsMass=b.getParam("mass"),t.physicsFriction=b.getParam("friction"),t.physicsRestitution=b.getParam("mass"),t.physicsImpostor=b.type)}this.metadata&&(t.metadata=this.metadata),t.instances=[];for(let Y=0;Y<this.instances.length;Y++){const b=this.instances[Y];if(b.doNotSerialize)continue;const o={name:b.name,id:b.id,isEnabled:b.isEnabled(!1),isVisible:b.isVisible,Ve:b.Ve,checkCollisions:b.checkCollisions,position:b.position.qe(),Oe:b.Oe.qe()};if(b.parent&&b.parent._serializeAsParent(o),b.rotationQuaternion?o.rotationQuaternion=b.rotationQuaternion.qe():b.rotation&&(o.rotation=b.rotation.qe()),this.va()._getComponent(e.b.NAME_PHYSICSENGINE)){const t=b.getPhysicsImpostor();t&&(o.physicsMass=t.getParam("mass"),o.physicsFriction=t.getParam("friction"),o.physicsRestitution=t.getParam("mass"),o.physicsImpostor=t.type)}b.metadata&&(o.metadata=b.metadata),b.actionManager&&(o.actions=b.actionManager.serialize(b.name)),t.instances.push(o),K.d.AppendSerializedAnimations(b,o),o.ranges=b.serializeAnimationRanges()}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData&&(t.thinInstances={instancesCount:this._thinInstanceDataStorage.instancesCount,matrixData:Array.from(this._thinInstanceDataStorage.matrixData),matrixBufferSize:this._thinInstanceDataStorage.matrixBufferSize,enablePicking:this.thinInstanceEnablePicking},this._userThinInstanceBuffersStorage)){const b={data:{},sizes:{},strides:{}};for(const t in this._userThinInstanceBuffersStorage.data)b.data[t]=Array.from(this._userThinInstanceBuffersStorage.data[t]),b.sizes[t]=this._userThinInstanceBuffersStorage.sizes[t],b.strides[t]=this._userThinInstanceBuffersStorage.strides[t];t.thinInstances.userThinInstance=b}return K.d.AppendSerializedAnimations(this,t),t.ranges=this.serializeAnimationRanges(),t.layerMask=this.layerMask,t.alphaIndex=this.alphaIndex,t.hasVertexAlpha=this.hasVertexAlpha,t.overlayAlpha=this.overlayAlpha,t.overlayColor=this.overlayColor.qe(),t.renderOverlay=this.renderOverlay,t.applyFog=this.applyFog,this.actionManager&&(t.actions=this.actionManager.serialize(this.name)),t}_syncGeometryWithMorphTargetManager(){if(!this.Ee)return;this._markSubMeshesAsAttributesDirty();const t=this._internalAbstractMeshDataInfo._morphTargetManager;if(t&&t.vertexCount){if(t.vertexCount!==this.getTotalVertices())return L.b.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);if(t.isUsingTextureForTargets)return;for(let b=0;b<t.numInfluencers;b++){const Y=t.getActiveTarget(b),o=Y.getPositions();if(!o)return void L.b.Error("Invalid morph target. Target must have positions.");this.Ee.Ga(p.e.PositionKind+b,o,!1,3);const x=Y.getNormals();x&&this.Ee.Ga(p.e.NormalKind+b,x,!1,3);const F=Y.getTangents();F&&this.Ee.Ga(p.e.TangentKind+b,F,!1,3);const r=Y.getUVs();r&&this.Ee.Ga(p.e.UVKind+"_"+b,r,!1,2)}}else{let t=0;for(;this.Ee.isVerticesDataPresent(p.e.PositionKind+t);)this.Ee.removeVerticesData(p.e.PositionKind+t),this.Ee.isVerticesDataPresent(p.e.NormalKind+t)&&this.Ee.removeVerticesData(p.e.NormalKind+t),this.Ee.isVerticesDataPresent(p.e.TangentKind+t)&&this.Ee.removeVerticesData(p.e.TangentKind+t),this.Ee.isVerticesDataPresent(p.e.UVKind+t)&&this.Ee.removeVerticesData(p.e.UVKind+"_"+t),t++}}static Parse(t,b,Y){let o;if(o=t.type&&"LinesMesh"===t.type?Q._LinesMeshParser(t,b):t.type&&"GroundMesh"===t.type?Q._GroundMeshParser(t,b):t.type&&"GoldbergMesh"===t.type?Q._GoldbergMeshParser(t,b):t.type&&"GreasedLineMesh"===t.type?Q._GreasedLineMeshParser(t,b):t.type&&"TrailMesh"===t.type?Q._TrailMeshParser(t,b):new Q(t.name,b),o.id=t.id,o._waitingParsedUniqueId=t.uniqueId,r.b&&r.b.AddTagsTo(o,t.tags),o.position=E.l.ce(t.position),void 0!==t.metadata&&(o.metadata=t.metadata),t.rotationQuaternion?o.rotationQuaternion=E.e.ce(t.rotationQuaternion):t.rotation&&(o.rotation=E.l.ce(t.rotation)),o.Oe=E.l.ce(t.Oe),t.localMatrix?o.setPreTransformMatrix(E.c.ce(t.localMatrix)):t.pivotMatrix&&o.setPivotMatrix(E.c.ce(t.pivotMatrix)),o.zg(t.isEnabled),o.isVisible=t.isVisible,o.infiniteDistance=t.infiniteDistance,o.hf=!!t.hf,o.showBoundingBox=t.showBoundingBox,o.showSubMeshesBoundingBox=t.showSubMeshesBoundingBox,void 0!==t.applyFog&&(o.applyFog=t.applyFog),void 0!==t.pickable&&(o.Ve=t.pickable),void 0!==t.alphaIndex&&(o.alphaIndex=t.alphaIndex),o.receiveShadows=t.receiveShadows,void 0!==t.billboardMode&&(o.billboardMode=t.billboardMode),void 0!==t.visibility&&(o.visibility=t.visibility),o.checkCollisions=t.checkCollisions,o.Da=!!t.Da,t.ellipsoid&&(o.ellipsoid=E.l.ce(t.ellipsoid)),t.ellipsoidOffset&&(o.ellipsoidOffset=E.l.ce(t.ellipsoidOffset)),null!=t.overrideMaterialSideOrientation&&(o.sideOrientation=t.overrideMaterialSideOrientation),void 0!==t.sideOrientation&&(o.sideOrientation=t.sideOrientation),void 0!==t.isBlocker&&(o.isBlocker=t.isBlocker),o._shouldGenerateFlatShading=t.useFlatShading,t.$h&&(o._waitingData.$h=t.$h),void 0!==t.parentId&&(o._waitingParentId=t.parentId),void 0!==t.parentInstanceIndex&&(o._waitingParentInstanceIndex=t.parentInstanceIndex),void 0!==t.actions&&(o._waitingData.actions=t.actions),void 0!==t.overlayAlpha&&(o.overlayAlpha=t.overlayAlpha),void 0!==t.overlayColor&&(o.overlayColor=U.d.ce(t.overlayColor)),void 0!==t.renderOverlay&&(o.renderOverlay=t.renderOverlay),o.isUnIndexed=!!t.isUnIndexed,o.hasVertexAlpha=t.hasVertexAlpha,t.delayLoadingFile?(o.delayLoadState=4,o.delayLoadingFile=Y+t.delayLoadingFile,o.buildBoundingInfo(E.l.ce(t.boundingBoxMinimum),E.l.ce(t.boundingBoxMaximum)),t._binaryInfo&&(o._binaryInfo=t._binaryInfo),o._delayInfo=[],t.hasUVs&&o._delayInfo.push(p.e.UVKind),t.hasUVs2&&o._delayInfo.push(p.e.UV2Kind),t.hasUVs3&&o._delayInfo.push(p.e.UV3Kind),t.hasUVs4&&o._delayInfo.push(p.e.UV4Kind),t.hasUVs5&&o._delayInfo.push(p.e.UV5Kind),t.hasUVs6&&o._delayInfo.push(p.e.UV6Kind),t.hasColors&&o._delayInfo.push(p.e.ColorKind),t.hasMatricesIndices&&o._delayInfo.push(p.e.MatricesIndicesKind),t.hasMatricesWeights&&o._delayInfo.push(p.e.MatricesWeightsKind),o._delayLoadingFunction=T.c._ImportGeometry,m.e.ForceFullSceneLoadingForIncremental&&o._checkDelayState()):T.c._ImportGeometry(t,o),t.materialUniqueId?o._waitingMaterialId=t.materialUniqueId:t.materialId&&(o._waitingMaterialId=t.materialId),t.morphTargetManagerId>-1&&(o._waitingMorphTargetManagerId=t.morphTargetManagerId),void 0!==t.skeletonId&&null!==t.skeletonId&&(o.skeleton=b.getLastSkeletonById(t.skeletonId),t.numBoneInfluencers&&(o.numBoneInfluencers=t.numBoneInfluencers)),t.animations){for(let b=0;b<t.animations.length;b++){const Y=t.animations[b],x=(0,z.b)("BABYLON.Animation");x&&o.animations.push(x.Parse(Y))}C.c.ParseAnimationRanges(o,t,b)}if(t.autoAnimate&&b.beginAnimation(o,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,t.autoAnimateSpeed||1),t.layerMask&&!isNaN(t.layerMask)?o.layerMask=Math.abs(parseInt(t.layerMask)):o.layerMask=268435455,t.physicsImpostor&&(o.physicsImpostor=Q._PhysicsImpostorParser(b,o,t)),t.lodMeshIds&&(o._waitingData.lods={ids:t.lodMeshIds,distances:t.lodDistances?t.lodDistances:null,coverages:t.lodCoverages?t.lodCoverages:null}),t.instances)for(let x=0;x<t.instances.length;x++){const Y=t.instances[x],F=o.Dd(Y.name);if(Y.id&&(F.id=Y.id),r.b&&(Y.tags?r.b.AddTagsTo(F,Y.tags):r.b.AddTagsTo(F,t.tags)),F.position=E.l.ce(Y.position),void 0!==Y.metadata&&(F.metadata=Y.metadata),void 0!==Y.parentId&&(F._waitingParentId=Y.parentId),void 0!==Y.parentInstanceIndex&&(F._waitingParentInstanceIndex=Y.parentInstanceIndex),void 0!==Y.isEnabled&&null!==Y.isEnabled&&F.zg(Y.isEnabled),void 0!==Y.isVisible&&null!==Y.isVisible&&(F.isVisible=Y.isVisible),void 0!==Y.Ve&&null!==Y.Ve&&(F.Ve=Y.Ve),Y.rotationQuaternion?F.rotationQuaternion=E.e.ce(Y.rotationQuaternion):Y.rotation&&(F.rotation=E.l.ce(Y.rotation)),F.Oe=E.l.ce(Y.Oe),void 0!=Y.checkCollisions&&null!=Y.checkCollisions&&(F.checkCollisions=Y.checkCollisions),void 0!=Y.pickable&&null!=Y.pickable&&(F.Ve=Y.pickable),void 0!=Y.showBoundingBox&&null!=Y.showBoundingBox&&(F.showBoundingBox=Y.showBoundingBox),void 0!=Y.showSubMeshesBoundingBox&&null!=Y.showSubMeshesBoundingBox&&(F.showSubMeshesBoundingBox=Y.showSubMeshesBoundingBox),void 0!=Y.alphaIndex&&null!=Y.showSubMeshesBoundingBox&&(F.alphaIndex=Y.alphaIndex),Y.physicsImpostor&&(F.physicsImpostor=Q._PhysicsImpostorParser(b,F,Y)),void 0!==Y.actions&&(F._waitingData.actions=Y.actions),Y.animations){for(let t=0;t<Y.animations.length;t++){const b=Y.animations[t],o=(0,z.b)("BABYLON.Animation");o&&F.animations.push(o.Parse(b))}C.c.ParseAnimationRanges(F,Y,b),Y.autoAnimate&&b.beginAnimation(F,Y.autoAnimateFrom,Y.autoAnimateTo,Y.autoAnimateLoop,Y.autoAnimateSpeed||1)}}if(t.thinInstances){const b=t.thinInstances;if(o.thinInstanceEnablePicking=!!b.enablePicking,b.matrixData?(o.Mj("matrix",new Float32Array(b.matrixData),16,!1),o._thinInstanceDataStorage.matrixBufferSize=b.matrixBufferSize,o._thinInstanceDataStorage.instancesCount=b.instancesCount):o._thinInstanceDataStorage.matrixBufferSize=b.matrixBufferSize,t.thinInstances.userThinInstance){const b=t.thinInstances.userThinInstance;for(const t in b.data)o.Mj(t,new Float32Array(b.data[t]),b.strides[t],!1),o._userThinInstanceBuffersStorage.sizes[t]=b.sizes[t]}}return o}setPositionsForCPUSkinning(){const t=this._internalMeshDataInfo;if(!t._sourcePositions){const b=this.getVerticesData(p.e.PositionKind);if(!b)return t._sourcePositions;t._sourcePositions=new Float32Array(b),this.isVertexBufferUpdatable(p.e.PositionKind)||this.Ga(p.e.PositionKind,b,!0)}return t._sourcePositions}setNormalsForCPUSkinning(){const t=this._internalMeshDataInfo;if(!t._sourceNormals){const b=this.getVerticesData(p.e.NormalKind);if(!b)return t._sourceNormals;t._sourceNormals=new Float32Array(b),this.isVertexBufferUpdatable(p.e.NormalKind)||this.Ga(p.e.NormalKind,b,!0)}return t._sourceNormals}applySkeleton(t){if(!this.Ee)return this;if(this.Ee._softwareSkinningFrameId==this.va().getFrameId())return this;if(this.Ee._softwareSkinningFrameId=this.va().getFrameId(),!this.isVerticesDataPresent(p.e.PositionKind))return this;if(!this.isVerticesDataPresent(p.e.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(p.e.MatricesWeightsKind))return this;const b=this.isVerticesDataPresent(p.e.NormalKind),Y=this._internalMeshDataInfo;if(!Y._sourcePositions){const t=this.ne.slice();this.setPositionsForCPUSkinning(),this.ne=t}b&&!Y._sourceNormals&&this.setNormalsForCPUSkinning();let o=this.getVerticesData(p.e.PositionKind);if(!o)return this;o instanceof Float32Array||(o=new Float32Array(o));let x=this.getVerticesData(p.e.NormalKind);if(b){if(!x)return this;x instanceof Float32Array||(x=new Float32Array(x))}const F=this.getVerticesData(p.e.MatricesIndicesKind),r=this.getVerticesData(p.e.MatricesWeightsKind);if(!r||!F)return this;const R=this.numBoneInfluencers>4,d=R?this.getVerticesData(p.e.MatricesIndicesExtraKind):null,U=R?this.getVerticesData(p.e.MatricesWeightsExtraKind):null,C=t.getTransformMatrices(this),W=E.l.Zero(),T=new E.c,y=new E.c;let v,B=0;for(let p=0;p<o.length;p+=3,B+=4){let t;for(v=0;v<4;v++)t=r[B+v],t>0&&(E.c.FromFloat32ArrayToRefScaled(C,Math.floor(16*F[B+v]),t,y),T.addToSelf(y));if(R)for(v=0;v<4;v++)t=U[B+v],t>0&&(E.c.FromFloat32ArrayToRefScaled(C,Math.floor(16*d[B+v]),t,y),T.addToSelf(y));E.l.TransformCoordinatesFromFloatsToRef(Y._sourcePositions[p],Y._sourcePositions[p+1],Y._sourcePositions[p+2],T,W),W.toArray(o,p),b&&(E.l.TransformNormalFromFloatsToRef(Y._sourceNormals[p],Y._sourceNormals[p+1],Y._sourceNormals[p+2],T,W),W.toArray(x,p)),T.reset()}return this.updateVerticesData(p.e.PositionKind,o),b&&this.updateVerticesData(p.e.NormalKind,x),this}static MinMax(t){let b=null,Y=null;return t.forEach((function(t){const o=t.getBoundingInfo().boundingBox;b&&Y?(b.minimizeInPlace(o.minimumWorld),Y.maximizeInPlace(o.maximumWorld)):(b=o.minimumWorld,Y=o.maximumWorld)})),b&&Y?{min:b,max:Y}:{min:E.l.Zero(),max:E.l.Zero()}}static Center(t){const b=t instanceof Array?Q.MinMax(t):t;return E.l.Center(b.min,b.max)}static MergeMeshes(t){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],Y=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0,x=arguments.length>4?arguments[4]:void 0,F=arguments.length>5?arguments[5]:void 0;return(0,R.k)(Q._MergeMeshesCoroutine(t,b,Y,o,x,F,!1))}static MergeMeshesAsync(t){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],Y=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0,x=arguments.length>4?arguments[4]:void 0,F=arguments.length>5?arguments[5]:void 0;return(0,R.g)(Q._MergeMeshesCoroutine(t,b,Y,o,x,F,!0),(0,R.c)())}static*_MergeMeshesCoroutine(t){let b,Y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=arguments.length>2?arguments[2]:void 0,x=arguments.length>3?arguments[3]:void 0,F=arguments.length>4?arguments[4]:void 0,r=arguments.length>5?arguments[5]:void 0,R=arguments.length>6?arguments[6]:void 0;if(0===(t=t.filter(Boolean)).length)return null;if(!o){let Y=0;for(b=0;b<t.length;b++)if(Y+=t[b].getTotalVertices(),Y>=65536)return L.b.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}r&&(F=!1);const d=new Array,E=new Array,U=new Array,C=t[0].sideOrientation;for(b=0;b<t.length;b++){const Y=t[b];if(Y.isAnInstance)return L.b.Warn("Cannot merge instance meshes."),null;if(C!==Y.sideOrientation)return L.b.Warn("Cannot merge meshes with different sideOrientation values."),null;if(F&&U.push(Y.getTotalIndices()),r)if(Y.material){const t=Y.material;if(t instanceof J.d){for(let b=0;b<t.yg.length;b++)d.indexOf(t.yg[b])<0&&d.push(t.yg[b]);for(let b=0;b<Y.ne.length;b++)E.push(d.indexOf(t.yg[Y.ne[b].materialIndex])),U.push(Y.ne[b].indexCount)}else{d.indexOf(t)<0&&d.push(t);for(let b=0;b<Y.ne.length;b++)E.push(d.indexOf(t)),U.push(Y.ne[b].indexCount)}}else for(let t=0;t<Y.ne.length;t++)E.push(0),U.push(Y.ne[t].indexCount)}const p=t[0],T=t=>{const b=t.ve(!0);return{vertexData:W.c.ExtractFromMesh(t,!1,!1),transform:b}},{vertexData:y,transform:B}=T(p);R&&(yield);const m=new Array(t.length-1);for(let W=1;W<t.length;W++)m[W-1]=T(t[W]),R&&(yield);const K=y._mergeCoroutine(B,m,o,R,!Y);let z=K.next();for(;!z.done;)R&&(yield),z=K.next();const S=z.value;x||(x=new Q(p.name+"_merged",p.va()));const e=S._applyToCoroutine(x,void 0,R);let g=e.next();for(;!g.done;)R&&(yield),g=e.next();if(x.checkCollisions=p.checkCollisions,x.sideOrientation=p.sideOrientation,Y)for(b=0;b<t.length;b++)t[b].dispose();if(F||r){x.releaseSubMeshes(),b=0;let t=0;for(;b<U.length;)v.b.CreateFromIndices(0,t,U[b],x,void 0,!1),t+=U[b],b++;for(const b of x.ne)b.refreshBoundingInfo();x.ve(!0)}if(r){const t=new J.d(p.name+"_merged",p.va());t.yg=d;for(let b=0;b<x.ne.length;b++)x.ne[b].materialIndex=E[b];x.material=t}else x.material=p.material;return x}Cj(t){t._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(t)}Bj(t){const b=t._indexInSourceMeshInstanceArray;if(-1!=b){if(b!==this.instances.length-1){const t=this.instances[this.instances.length-1];this.instances[b]=t,t._indexInSourceMeshInstanceArray=b}t._indexInSourceMeshInstanceArray=-1,this.instances.pop()}}_shouldConvertRHS(){return this._scene.useRightHandedSystem&&this.sideOrientation===B.e.CounterClockWiseSideOrientation}_getRenderingFillMode(t){const b=this.va();return b.forcePointsCloud?B.e.PointFillMode:b.forceWireframe?B.e.WireFrameFillMode:this.overrideRenderingFillMode??t}setMaterialByID(t){return this.setMaterialById(t)}static CreateRibbon(t,b,Y,o,x,F,r,R,d){throw new Error("Import MeshBuilder to populate this function")}static kb(t,b,Y,o,x,F){throw new Error("Import MeshBuilder to populate this function")}static CreateBox(t,b,Y,o,x){throw new Error("Import MeshBuilder to populate this function")}static CreateSphere(t,b,Y,o,x,F){throw new Error("Import MeshBuilder to populate this function")}static CreateHemisphere(t,b,Y,o){throw new Error("Import MeshBuilder to populate this function")}static CreateCylinder(t,b,Y,o,x,F,r,R,d){throw new Error("Import MeshBuilder to populate this function")}static CreateTorus(t,b,Y,o,x,F,r){throw new Error("Import MeshBuilder to populate this function")}static CreateTorusKnot(t,b,Y,o,x,F,r,R,d,E){throw new Error("Import MeshBuilder to populate this function")}static lb(t,b,Y,o,x){throw new Error("Import MeshBuilder to populate this function")}static CreateDashedLines(t,b,Y,o,x,F,r,R){throw new Error("Import MeshBuilder to populate this function")}static CreatePolygon(t,b,Y,o,x,F,r){throw new Error("Import MeshBuilder to populate this function")}static ExtrudePolygon(t,b,Y,o,x,F,r,R){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShape(t,b,Y,o,x,F,r,R,d,E){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShapeCustom(t,b,Y,o,x,F,r,R,d,E,U,C){throw new Error("Import MeshBuilder to populate this function")}static CreateLathe(t,b,Y,o,x,F,r){throw new Error("Import MeshBuilder to populate this function")}static Dg(t,b,Y,o,x){throw new Error("Import MeshBuilder to populate this function")}static CreateGround(t,b,Y,o,x,F){throw new Error("Import MeshBuilder to populate this function")}static CreateTiledGround(t,b,Y,o,x,F,r,R,d){throw new Error("Import MeshBuilder to populate this function")}static CreateGroundFromHeightMap(t,b,Y,o,x,F,r,R,d,E,U){throw new Error("Import MeshBuilder to populate this function")}static CreateTube(t,b,Y,o,x,F,r,R,d,E){throw new Error("Import MeshBuilder to populate this function")}static CreatePolyhedron(t,b,Y){throw new Error("Import MeshBuilder to populate this function")}static CreateIcoSphere(t,b,Y){throw new Error("Import MeshBuilder to populate this function")}static CreateDecal(t,b,Y,o,x,F){throw new Error("Import MeshBuilder to populate this function")}static CreateCapsule(t,b,Y){throw new Error("Import MeshBuilder to populate this function")}static ExtendToGoldberg(t){throw new Error("Import MeshBuilder to populate this function")}}Q.FRONTSIDE=W.c.FRONTSIDE,Q.BACKSIDE=W.c.BACKSIDE,Q.DOUBLESIDE=W.c.DOUBLESIDE,Q.DEFAULTSIDE=W.c.DEFAULTSIDE,Q.NO_CAP=0,Q.CAP_START=1,Q.CAP_END=2,Q.CAP_ALL=3,Q.NO_FLIP=0,Q.FLIP_TILE=1,Q.ROTATE_TILE=2,Q.FLIP_ROW=3,Q.ROTATE_ROW=4,Q.FLIP_N_ROTATE_TILE=5,Q.FLIP_N_ROTATE_ROW=6,Q.CENTER=0,Q.LEFT=1,Q.RIGHT=2,Q.TOP=3,Q.BOTTOM=4,Q.INSTANCEDMESH_SORT_TRANSPARENT=!1,Q._GroundMeshParser=(t,b)=>{throw(0,S.c)("GroundMesh")},Q._GoldbergMeshParser=(t,b)=>{throw(0,S.c)("GoldbergMesh")},Q._LinesMeshParser=(t,b)=>{throw(0,S.c)("LinesMesh")},Q._GreasedLineMeshParser=(t,b)=>{throw(0,S.c)("GreasedLineMesh")},Q._GreasedLineRibbonMeshParser=(t,b)=>{throw(0,S.c)("GreasedLineRibbonMesh")},Q._TrailMeshParser=(t,b)=>{throw(0,S.c)("TrailMesh")},(0,z.d)("BABYLON.Mesh",Q)},11766:(t,b,Y)=>{"use strict";Y.d(b,{c:()=>T});var o=Y(999),x=Y(1019),F=Y(1307),r=Y(1129),R=Y(1229),d=Y(1144),E=Y(1001),U=Y(11744),C=Y(1102),p=Y(1401);class W{}class T{constructor(){this.uniqueId=0,this.metadata={},this._applyTo=(0,U.d)(this._applyToCoroutine.bind(this)),this.uniqueId=T._UniqueIDGenerator,T._UniqueIDGenerator++}set(t,b){switch(t.length||d.b.Warn(`Setting vertex data kind '${b}' with an empty array`),b){case F.e.PositionKind:this.xa=t;break;case F.e.NormalKind:this.ya=t;break;case F.e.TangentKind:this.tangents=t;break;case F.e.UVKind:this.Aa=t;break;case F.e.UV2Kind:this.uvs2=t;break;case F.e.UV3Kind:this.uvs3=t;break;case F.e.UV4Kind:this.uvs4=t;break;case F.e.UV5Kind:this.uvs5=t;break;case F.e.UV6Kind:this.uvs6=t;break;case F.e.ColorKind:this.za=t;break;case F.e.MatricesIndicesKind:this.matricesIndices=t;break;case F.e.MatricesWeightsKind:this.matricesWeights=t;break;case F.e.MatricesIndicesExtraKind:this.matricesIndicesExtra=t;break;case F.e.MatricesWeightsExtraKind:this.matricesWeightsExtra=t}}Ca(t,b){return this._applyTo(t,b,!1),this}applyToGeometry(t,b){return this._applyTo(t,b,!1),this}updateMesh(t){return this._update(t),this}updateGeometry(t){return this._update(t),this}*_applyToCoroutine(t){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=arguments.length>2?arguments[2]:void 0;if(this.xa&&(t.Ga(F.e.PositionKind,this.xa,b),Y&&(yield)),this.ya&&(t.Ga(F.e.NormalKind,this.ya,b),Y&&(yield)),this.tangents&&(t.Ga(F.e.TangentKind,this.tangents,b),Y&&(yield)),this.Aa&&(t.Ga(F.e.UVKind,this.Aa,b),Y&&(yield)),this.uvs2&&(t.Ga(F.e.UV2Kind,this.uvs2,b),Y&&(yield)),this.uvs3&&(t.Ga(F.e.UV3Kind,this.uvs3,b),Y&&(yield)),this.uvs4&&(t.Ga(F.e.UV4Kind,this.uvs4,b),Y&&(yield)),this.uvs5&&(t.Ga(F.e.UV5Kind,this.uvs5,b),Y&&(yield)),this.uvs6&&(t.Ga(F.e.UV6Kind,this.uvs6,b),Y&&(yield)),this.za&&(t.Ga(F.e.ColorKind,this.za,b),this.hasVertexAlpha&&void 0!==t.hasVertexAlpha&&(t.hasVertexAlpha=!0),Y&&(yield)),this.matricesIndices&&(t.Ga(F.e.MatricesIndicesKind,this.matricesIndices,b),Y&&(yield)),this.matricesWeights&&(t.Ga(F.e.MatricesWeightsKind,this.matricesWeights,b),Y&&(yield)),this.matricesIndicesExtra&&(t.Ga(F.e.MatricesIndicesExtraKind,this.matricesIndicesExtra,b),Y&&(yield)),this.matricesWeightsExtra&&(t.Ga(F.e.MatricesWeightsExtraKind,this.matricesWeightsExtra,b),Y&&(yield)),this.indices?(t.setIndices(this.indices,null,b),Y&&(yield)):t.setIndices([],null),t.ne&&this.materialInfos&&this.materialInfos.length>1){const b=t;b.ne=[];for(const t of this.materialInfos)new p.b(t.materialIndex,t.verticesStart,t.verticesCount,t.indexStart,t.indexCount,b)}return this}_update(t,b,Y){return this.xa&&t.updateVerticesData(F.e.PositionKind,this.xa,b,Y),this.ya&&t.updateVerticesData(F.e.NormalKind,this.ya,b,Y),this.tangents&&t.updateVerticesData(F.e.TangentKind,this.tangents,b,Y),this.Aa&&t.updateVerticesData(F.e.UVKind,this.Aa,b,Y),this.uvs2&&t.updateVerticesData(F.e.UV2Kind,this.uvs2,b,Y),this.uvs3&&t.updateVerticesData(F.e.UV3Kind,this.uvs3,b,Y),this.uvs4&&t.updateVerticesData(F.e.UV4Kind,this.uvs4,b,Y),this.uvs5&&t.updateVerticesData(F.e.UV5Kind,this.uvs5,b,Y),this.uvs6&&t.updateVerticesData(F.e.UV6Kind,this.uvs6,b,Y),this.za&&t.updateVerticesData(F.e.ColorKind,this.za,b,Y),this.matricesIndices&&t.updateVerticesData(F.e.MatricesIndicesKind,this.matricesIndices,b,Y),this.matricesWeights&&t.updateVerticesData(F.e.MatricesWeightsKind,this.matricesWeights,b,Y),this.matricesIndicesExtra&&t.updateVerticesData(F.e.MatricesIndicesExtraKind,this.matricesIndicesExtra,b,Y),this.matricesWeightsExtra&&t.updateVerticesData(F.e.MatricesWeightsExtraKind,this.matricesWeightsExtra,b,Y),this.indices&&t.setIndices(this.indices,null),this}static _TransformVector3Coordinates(t,b){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.length;const F=x.f.ae[0],r=x.f.ae[1];for(let R=Y;R<Y+o;R+=3)x.l.FromArrayToRef(t,R,F),x.l.TransformCoordinatesToRef(F,b,r),t[R]=r.x,t[R+1]=r.y,t[R+2]=r.z}static _TransformVector3Normals(t,b){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.length;const F=x.f.ae[0],r=x.f.ae[1];for(let R=Y;R<Y+o;R+=3)x.l.FromArrayToRef(t,R,F),x.l.TransformNormalToRef(F,b,r),t[R]=r.x,t[R+1]=r.y,t[R+2]=r.z}static _TransformVector4Normals(t,b){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.length;const F=x.f.Vector4[0],r=x.f.Vector4[1];for(let R=Y;R<Y+o;R+=4)x.m.FromArrayToRef(t,R,F),x.m.TransformNormalToRef(F,b,r),t[R]=r.x,t[R+1]=r.y,t[R+2]=r.z,t[R+3]=r.w}static _FlipFaces(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.length;for(let o=b;o<b+Y;o+=3){const b=t[o+1];t[o+1]=t[o+2],t[o+2]=b}}transform(t){const b=t.determinant()<0;return this.xa&&T._TransformVector3Coordinates(this.xa,t),this.ya&&T._TransformVector3Normals(this.ya,t),this.tangents&&T._TransformVector4Normals(this.tangents,t),b&&this.indices&&T._FlipFaces(this.indices),this}splitBasedOnMaterialID(){if(!this.materialInfos||this.materialInfos.length<2)return[this];const t=[];for(const b of this.materialInfos){const Y=new T;if(this.xa&&(Y.xa=this.xa.slice(3*b.verticesStart,3*(b.verticesCount+b.verticesStart))),this.ya&&(Y.ya=this.ya.slice(3*b.verticesStart,3*(b.verticesCount+b.verticesStart))),this.tangents&&(Y.tangents=this.tangents.slice(4*b.verticesStart,4*(b.verticesCount+b.verticesStart))),this.za&&(Y.za=this.za.slice(4*b.verticesStart,4*(b.verticesCount+b.verticesStart))),this.Aa&&(Y.Aa=this.Aa.slice(2*b.verticesStart,2*(b.verticesCount+b.verticesStart))),this.uvs2&&(Y.uvs2=this.uvs2.slice(2*b.verticesStart,2*(b.verticesCount+b.verticesStart))),this.uvs3&&(Y.uvs3=this.uvs3.slice(2*b.verticesStart,2*(b.verticesCount+b.verticesStart))),this.uvs4&&(Y.uvs4=this.uvs4.slice(2*b.verticesStart,2*(b.verticesCount+b.verticesStart))),this.uvs5&&(Y.uvs5=this.uvs5.slice(2*b.verticesStart,2*(b.verticesCount+b.verticesStart))),this.uvs6&&(Y.uvs6=this.uvs6.slice(2*b.verticesStart,2*(b.verticesCount+b.verticesStart))),this.matricesIndices&&(Y.matricesIndices=this.matricesIndices.slice(4*b.verticesStart,4*(b.verticesCount+b.verticesStart))),this.matricesIndicesExtra&&(Y.matricesIndicesExtra=this.matricesIndicesExtra.slice(4*b.verticesStart,4*(b.verticesCount+b.verticesStart))),this.matricesWeights&&(Y.matricesWeights=this.matricesWeights.slice(4*b.verticesStart,4*(b.verticesCount+b.verticesStart))),this.matricesWeightsExtra&&(Y.matricesWeightsExtra=this.matricesWeightsExtra.slice(4*b.verticesStart,4*(b.verticesCount+b.verticesStart))),this.indices){Y.indices=[];for(let t=b.indexStart;t<b.indexStart+b.indexCount;t++)Y.indices.push(this.indices[t]-b.verticesStart)}const o=new W;o.indexStart=0,o.indexCount=Y.indices?Y.indices.length:0,o.materialIndex=b.materialIndex,o.verticesStart=0,o.verticesCount=(Y.xa?Y.xa.length:0)/3,Y.materialInfos=[o],t.push(Y)}return t}merge(t){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],x=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const F=Array.isArray(t)?t.map((t=>({vertexData:t}))):[{vertexData:t}];return(0,U.k)(this._mergeCoroutine(void 0,F,b,!1,Y,o,x))}*_mergeCoroutine(t,b){var Y,o;let x=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0,R=arguments.length>4?arguments[4]:void 0,d=arguments.length>5&&void 0!==arguments[5]&&arguments[5],E=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this._validate();let U=b.map((t=>t.vertexData)),C=this;if(E)for(const F of U)F&&(F._validate(),!this.ya&&F.ya&&(this.ya=new Float32Array(this.xa.length)),!this.tangents&&F.tangents&&(this.tangents=new Float32Array(this.xa.length/3*4)),!this.Aa&&F.Aa&&(this.Aa=new Float32Array(this.xa.length/3*2)),!this.uvs2&&F.uvs2&&(this.uvs2=new Float32Array(this.xa.length/3*2)),!this.uvs3&&F.uvs3&&(this.uvs3=new Float32Array(this.xa.length/3*2)),!this.uvs4&&F.uvs4&&(this.uvs4=new Float32Array(this.xa.length/3*2)),!this.uvs5&&F.uvs5&&(this.uvs5=new Float32Array(this.xa.length/3*2)),!this.uvs6&&F.uvs6&&(this.uvs6=new Float32Array(this.xa.length/3*2)),!this.za&&F.za&&(this.za=new Float32Array(this.xa.length/3*4),this.za.fill(1)),!this.matricesIndices&&F.matricesIndices&&(this.matricesIndices=new Float32Array(this.xa.length/3*4)),!this.matricesWeights&&F.matricesWeights&&(this.matricesWeights=new Float32Array(this.xa.length/3*4)),!this.matricesIndicesExtra&&F.matricesIndicesExtra&&(this.matricesIndicesExtra=new Float32Array(this.xa.length/3*4)),!this.matricesWeightsExtra&&F.matricesWeightsExtra&&(this.matricesWeightsExtra=new Float32Array(this.xa.length/3*4)));for(const F of U)if(F)if(E)this.ya&&!F.ya&&(F.ya=new Float32Array(F.xa.length)),this.tangents&&!F.tangents&&(F.tangents=new Float32Array(F.xa.length/3*4)),this.Aa&&!F.Aa&&(F.Aa=new Float32Array(F.xa.length/3*2)),this.uvs2&&!F.uvs2&&(F.uvs2=new Float32Array(F.xa.length/3*2)),this.uvs3&&!F.uvs3&&(F.uvs3=new Float32Array(F.xa.length/3*2)),this.uvs4&&!F.uvs4&&(F.uvs4=new Float32Array(F.xa.length/3*2)),this.uvs5&&!F.uvs5&&(F.uvs5=new Float32Array(F.xa.length/3*2)),this.uvs6&&!F.uvs6&&(F.uvs6=new Float32Array(F.xa.length/3*2)),this.za&&!F.za&&(F.za=new Float32Array(F.xa.length/3*4),F.za.fill(1)),this.matricesIndices&&!F.matricesIndices&&(F.matricesIndices=new Float32Array(F.xa.length/3*4)),this.matricesWeights&&!F.matricesWeights&&(F.matricesWeights=new Float32Array(F.xa.length/3*4)),this.matricesIndicesExtra&&!F.matricesIndicesExtra&&(F.matricesIndicesExtra=new Float32Array(F.xa.length/3*4)),this.matricesWeightsExtra&&!F.matricesWeightsExtra&&(F.matricesWeightsExtra=new Float32Array(F.xa.length/3*4));else if(F._validate(),!this.ya!==!F.ya||!this.tangents!==!F.tangents||!this.Aa!==!F.Aa||!this.uvs2!==!F.uvs2||!this.uvs3!==!F.uvs3||!this.uvs4!==!F.uvs4||!this.uvs5!==!F.uvs5||!this.uvs6!==!F.uvs6||!this.za!==!F.za||!this.matricesIndices!==!F.matricesIndices||!this.matricesWeights!==!F.matricesWeights||!this.matricesIndicesExtra!==!F.matricesIndicesExtra||!this.matricesWeightsExtra!==!F.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(d){let Y=0,o=0,x=0;const F=[];let r=null;const R=[];for(const b of this.splitBasedOnMaterialID())R.push({vertexData:b,transform:t});for(const t of b)if(t.vertexData)for(const b of t.vertexData.splitBasedOnMaterialID())R.push({vertexData:b,transform:t.transform});R.sort(((t,b)=>{const Y=t.vertexData.materialInfos?t.vertexData.materialInfos[0].materialIndex:0,o=b.vertexData.materialInfos?b.vertexData.materialInfos[0].materialIndex:0;return Y>o?1:Y===o?0:-1}));for(const t of R){const b=t.vertexData;if(Y=b.materialInfos?b.materialInfos[0].materialIndex:0,r&&r.materialIndex===Y)r.indexCount+=b.indices.length,r.verticesCount+=b.xa.length/3;else{const t=new W;t.materialIndex=Y,t.indexStart=o,t.indexCount=b.indices.length,t.verticesStart=x,t.verticesCount=b.xa.length/3,F.push(t),r=t}o+=b.indices.length,x+=b.xa.length/3}const d=R.splice(0,1)[0];C=d.vertexData,t=d.transform,U=R.map((t=>t.vertexData)),b=R,this.materialInfos=F}const p=U.reduce(((t,b)=>{var Y;return t+((null===(Y=b.indices)||void 0===Y?void 0:Y.length)??0)}),(null===(Y=C.indices)||void 0===Y?void 0:Y.length)??0);let y=R||U.some((t=>t.indices===C.indices))?null===(o=C.indices)||void 0===o?void 0:o.slice():C.indices;if(p>0){var v;let Y=(null===(v=y)||void 0===v?void 0:v.length)??0;if(y||(y=new Array(p)),y.length!==p){if(Array.isArray(y))y.length=p;else{const t=x||y instanceof Uint32Array?new Uint32Array(p):new Uint16Array(p);t.set(y),y=t}t&&t.determinant()<0&&T._FlipFaces(y,0,Y)}let o=C.xa?C.xa.length/3:0;for(const{vertexData:t,transform:x}of b)if(t.indices){for(let b=0;b<t.indices.length;b++)y[Y+b]=t.indices[b]+o;x&&x.determinant()<0&&T._FlipFaces(y,Y,t.indices.length),o+=t.xa.length/3,Y+=t.indices.length,r&&(yield)}}return this.indices=y,this.xa=T._MergeElement(F.e.PositionKind,C.xa,t,b.map((t=>[t.vertexData.xa,t.transform]))),r&&(yield),C.ya&&(this.ya=T._MergeElement(F.e.NormalKind,C.ya,t,b.map((t=>[t.vertexData.ya,t.transform]))),r&&(yield)),C.tangents&&(this.tangents=T._MergeElement(F.e.TangentKind,C.tangents,t,b.map((t=>[t.vertexData.tangents,t.transform]))),r&&(yield)),C.Aa&&(this.Aa=T._MergeElement(F.e.UVKind,C.Aa,t,b.map((t=>[t.vertexData.Aa,t.transform]))),r&&(yield)),C.uvs2&&(this.uvs2=T._MergeElement(F.e.UV2Kind,C.uvs2,t,b.map((t=>[t.vertexData.uvs2,t.transform]))),r&&(yield)),C.uvs3&&(this.uvs3=T._MergeElement(F.e.UV3Kind,C.uvs3,t,b.map((t=>[t.vertexData.uvs3,t.transform]))),r&&(yield)),C.uvs4&&(this.uvs4=T._MergeElement(F.e.UV4Kind,C.uvs4,t,b.map((t=>[t.vertexData.uvs4,t.transform]))),r&&(yield)),C.uvs5&&(this.uvs5=T._MergeElement(F.e.UV5Kind,C.uvs5,t,b.map((t=>[t.vertexData.uvs5,t.transform]))),r&&(yield)),C.uvs6&&(this.uvs6=T._MergeElement(F.e.UV6Kind,C.uvs6,t,b.map((t=>[t.vertexData.uvs6,t.transform]))),r&&(yield)),C.za&&(this.za=T._MergeElement(F.e.ColorKind,C.za,t,b.map((t=>[t.vertexData.za,t.transform]))),(void 0!==C.hasVertexAlpha||b.some((t=>void 0!==t.vertexData.hasVertexAlpha)))&&(this.hasVertexAlpha=C.hasVertexAlpha||b.some((t=>t.vertexData.hasVertexAlpha))),r&&(yield)),C.matricesIndices&&(this.matricesIndices=T._MergeElement(F.e.MatricesIndicesKind,C.matricesIndices,t,b.map((t=>[t.vertexData.matricesIndices,t.transform]))),r&&(yield)),C.matricesWeights&&(this.matricesWeights=T._MergeElement(F.e.MatricesWeightsKind,C.matricesWeights,t,b.map((t=>[t.vertexData.matricesWeights,t.transform]))),r&&(yield)),C.matricesIndicesExtra&&(this.matricesIndicesExtra=T._MergeElement(F.e.MatricesIndicesExtraKind,C.matricesIndicesExtra,t,b.map((t=>[t.vertexData.matricesIndicesExtra,t.transform]))),r&&(yield)),C.matricesWeightsExtra&&(this.matricesWeightsExtra=T._MergeElement(F.e.MatricesWeightsExtraKind,C.matricesWeightsExtra,t,b.map((t=>[t.vertexData.matricesWeightsExtra,t.transform])))),this}static _MergeElement(t,b,Y,o){const x=o.filter((t=>null!==t[0]&&void 0!==t[0]));if(!b&&0==x.length)return b;if(!b)return this._MergeElement(t,x[0][0],x[0][1],x.slice(1));const r=x.reduce(((t,b)=>t+b[0].length),b.length),R=t===F.e.PositionKind?T._TransformVector3Coordinates:t===F.e.NormalKind?T._TransformVector3Normals:t===F.e.TangentKind?T._TransformVector4Normals:()=>{};if(b instanceof Float32Array){const t=new Float32Array(r);t.set(b),Y&&R(t,Y,0,b.length);let o=b.length;for(const[b,Y]of x)t.set(b,o),Y&&R(t,Y,o,b.length),o+=b.length;return t}{const t=new Array(r);for(let Y=0;Y<b.length;Y++)t[Y]=b[Y];Y&&R(t,Y,0,b.length);let o=b.length;for(const[b,Y]of x){for(let Y=0;Y<b.length;Y++)t[o+Y]=b[Y];Y&&R(t,Y,o,b.length),o+=b.length}return t}}_validate(){if(!this.xa)throw new C.k("Positions are required",C.g.MeshInvalidPositionsError);const t=(t,b)=>{const Y=F.e.DeduceStride(t);if(b.length%Y!==0)throw new Error("The "+t+"s array count must be a multiple of "+Y);return b.length/Y},b=t(F.e.PositionKind,this.xa),Y=(Y,o)=>{const x=t(Y,o);if(x!==b)throw new Error("The "+Y+"s element count ("+x+") does not match the positions count ("+b+")")};this.ya&&Y(F.e.NormalKind,this.ya),this.tangents&&Y(F.e.TangentKind,this.tangents),this.Aa&&Y(F.e.UVKind,this.Aa),this.uvs2&&Y(F.e.UV2Kind,this.uvs2),this.uvs3&&Y(F.e.UV3Kind,this.uvs3),this.uvs4&&Y(F.e.UV4Kind,this.uvs4),this.uvs5&&Y(F.e.UV5Kind,this.uvs5),this.uvs6&&Y(F.e.UV6Kind,this.uvs6),this.za&&Y(F.e.ColorKind,this.za),this.matricesIndices&&Y(F.e.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&Y(F.e.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&Y(F.e.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&Y(F.e.MatricesWeightsExtraKind,this.matricesWeightsExtra)}clone(){const t=this.serialize();return T.Parse(t)}serialize(){const t={};if(this.xa&&(t.xa=Array.from(this.xa)),this.ya&&(t.ya=Array.from(this.ya)),this.tangents&&(t.tangents=Array.from(this.tangents)),this.Aa&&(t.Aa=Array.from(this.Aa)),this.uvs2&&(t.uvs2=Array.from(this.uvs2)),this.uvs3&&(t.uvs3=Array.from(this.uvs3)),this.uvs4&&(t.uvs4=Array.from(this.uvs4)),this.uvs5&&(t.uvs5=Array.from(this.uvs5)),this.uvs6&&(t.uvs6=Array.from(this.uvs6)),this.za&&(t.za=Array.from(this.za),t.hasVertexAlpha=this.hasVertexAlpha),this.matricesIndices&&(t.matricesIndices=Array.from(this.matricesIndices),t.matricesIndices._isExpanded=!0),this.matricesWeights&&(t.matricesWeights=Array.from(this.matricesWeights)),this.matricesIndicesExtra&&(t.matricesIndicesExtra=Array.from(this.matricesIndicesExtra),t.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(t.matricesWeightsExtra=Array.from(this.matricesWeightsExtra)),t.indices=Array.from(this.indices),this.materialInfos){t.materialInfos=[];for(const b of this.materialInfos){const Y={indexStart:b.indexStart,indexCount:b.indexCount,materialIndex:b.materialIndex,verticesStart:b.verticesStart,verticesCount:b.verticesCount};t.materialInfos.push(Y)}}return t}static ExtractFromMesh(t,b,Y){return T._ExtractFrom(t,b,Y)}static ExtractFromGeometry(t,b,Y){return T._ExtractFrom(t,b,Y)}static _ExtractFrom(t,b,Y){const o=new T;if(t.isVerticesDataPresent(F.e.PositionKind)&&(o.xa=t.getVerticesData(F.e.PositionKind,b,Y)),t.isVerticesDataPresent(F.e.NormalKind)&&(o.ya=t.getVerticesData(F.e.NormalKind,b,Y)),t.isVerticesDataPresent(F.e.TangentKind)&&(o.tangents=t.getVerticesData(F.e.TangentKind,b,Y)),t.isVerticesDataPresent(F.e.UVKind)&&(o.Aa=t.getVerticesData(F.e.UVKind,b,Y)),t.isVerticesDataPresent(F.e.UV2Kind)&&(o.uvs2=t.getVerticesData(F.e.UV2Kind,b,Y)),t.isVerticesDataPresent(F.e.UV3Kind)&&(o.uvs3=t.getVerticesData(F.e.UV3Kind,b,Y)),t.isVerticesDataPresent(F.e.UV4Kind)&&(o.uvs4=t.getVerticesData(F.e.UV4Kind,b,Y)),t.isVerticesDataPresent(F.e.UV5Kind)&&(o.uvs5=t.getVerticesData(F.e.UV5Kind,b,Y)),t.isVerticesDataPresent(F.e.UV6Kind)&&(o.uvs6=t.getVerticesData(F.e.UV6Kind,b,Y)),t.isVerticesDataPresent(F.e.ColorKind)){const x=t.Ee||t,r=x.getVertexBuffer(F.e.ColorKind),R=x.getVerticesData(F.e.ColorKind,b,Y);if(3===r.getSize()){const t=new Float32Array(4*R.length/3);for(let b=0,Y=0;b<R.length;b+=3,Y+=4)t[Y]=R[b],t[Y+1]=R[b+1],t[Y+2]=R[b+2],t[Y+3]=1;o.za=t}else{if(4!==r.getSize())throw new Error(`Unexpected number of color components: ${r.getSize()}`);o.za=R}}return t.isVerticesDataPresent(F.e.MatricesIndicesKind)&&(o.matricesIndices=t.getVerticesData(F.e.MatricesIndicesKind,b,Y)),t.isVerticesDataPresent(F.e.MatricesWeightsKind)&&(o.matricesWeights=t.getVerticesData(F.e.MatricesWeightsKind,b,Y)),t.isVerticesDataPresent(F.e.MatricesIndicesExtraKind)&&(o.matricesIndicesExtra=t.getVerticesData(F.e.MatricesIndicesExtraKind,b,Y)),t.isVerticesDataPresent(F.e.MatricesWeightsExtraKind)&&(o.matricesWeightsExtra=t.getVerticesData(F.e.MatricesWeightsExtraKind,b,Y)),o.indices=t._d(b,Y),o}static CreateRibbon(t){throw(0,r.c)("ribbonBuilder")}static CreateBox(t){throw(0,r.c)("boxBuilder")}static CreateTiledBox(t){throw(0,r.c)("tiledBoxBuilder")}static CreateTiledPlane(t){throw(0,r.c)("tiledPlaneBuilder")}static CreateSphere(t){throw(0,r.c)("sphereBuilder")}static CreateCylinder(t){throw(0,r.c)("cylinderBuilder")}static CreateTorus(t){throw(0,r.c)("torusBuilder")}static CreateLineSystem(t){throw(0,r.c)("linesBuilder")}static CreateDashedLines(t){throw(0,r.c)("linesBuilder")}static CreateGround(t){throw(0,r.c)("groundBuilder")}static CreateTiledGround(t){throw(0,r.c)("groundBuilder")}static CreateGroundFromHeightMap(t){throw(0,r.c)("groundBuilder")}static Dg(t){throw(0,r.c)("planeBuilder")}static kb(t){throw(0,r.c)("discBuilder")}static CreatePolygon(t,b,Y,o,x,F,R){throw(0,r.c)("polygonBuilder")}static CreateIcoSphere(t){throw(0,r.c)("icoSphereBuilder")}static CreatePolyhedron(t){throw(0,r.c)("polyhedronBuilder")}static CreateCapsule(){arguments.length>0&&void 0!==arguments[0]||x.l.Up();throw(0,r.c)("capsuleBuilder")}static CreateTorusKnot(t){throw(0,r.c)("torusKnotBuilder")}static ComputeNormals(t,b,Y,o){let F=0,r=0,R=0,d=0,E=0,U=0,C=0,p=0,W=0,T=0,y=0,v=0,B=0,J=0,m=0,K=0,L=0,z=0,S=0,e=0,g=!1,D=!1,H=!1,f=!1,n=1,X=0,Q=null;o&&(g=!!o.facetNormals,D=!!o.facetPositions,H=!!o.facetPartitioning,n=!0===o.useRightHandedSystem?-1:1,X=o.ratio||0,f=!!o.depthSort,Q=o.distanceTo,f&&void 0===Q&&(Q=x.l.Zero()));let N=0,u=0,Z=0,a=0;for(H&&o&&o.bbSize&&(N=o.subDiv.X*X/o.bbSize.x,u=o.subDiv.Y*X/o.bbSize.y,Z=o.subDiv.Z*X/o.bbSize.z,a=o.subDiv.max*o.subDiv.max,o.facetPartitioning.length=0),F=0;F<t.length;F++)Y[F]=0;const A=b.length/3|0;for(F=0;F<A;F++){if(v=3*b[3*F],B=v+1,J=v+2,m=3*b[3*F+1],K=m+1,L=m+2,z=3*b[3*F+2],S=z+1,e=z+2,r=t[v]-t[m],R=t[B]-t[K],d=t[J]-t[L],E=t[z]-t[m],U=t[S]-t[K],C=t[e]-t[L],p=n*(R*C-d*U),W=n*(d*E-r*C),T=n*(r*U-R*E),y=Math.sqrt(p*p+W*W+T*T),y=0===y?1:y,p/=y,W/=y,T/=y,g&&o&&(o.facetNormals[F].x=p,o.facetNormals[F].y=W,o.facetNormals[F].z=T),D&&o&&(o.facetPositions[F].x=(t[v]+t[m]+t[z])/3,o.facetPositions[F].y=(t[B]+t[K]+t[S])/3,o.facetPositions[F].z=(t[J]+t[L]+t[e])/3),H&&o){const b=Math.floor((o.facetPositions[F].x-o.bInfo.minimum.x*X)*N),Y=Math.floor((o.facetPositions[F].y-o.bInfo.minimum.y*X)*u),x=Math.floor((o.facetPositions[F].z-o.bInfo.minimum.z*X)*Z),r=Math.floor((t[v]-o.bInfo.minimum.x*X)*N),R=Math.floor((t[B]-o.bInfo.minimum.y*X)*u),d=Math.floor((t[J]-o.bInfo.minimum.z*X)*Z),E=Math.floor((t[m]-o.bInfo.minimum.x*X)*N),U=Math.floor((t[K]-o.bInfo.minimum.y*X)*u),C=Math.floor((t[L]-o.bInfo.minimum.z*X)*Z),p=Math.floor((t[z]-o.bInfo.minimum.x*X)*N),W=Math.floor((t[S]-o.bInfo.minimum.y*X)*u),T=Math.floor((t[e]-o.bInfo.minimum.z*X)*Z),y=r+o.subDiv.max*R+a*d,g=E+o.subDiv.max*U+a*C,D=p+o.subDiv.max*W+a*T,H=b+o.subDiv.max*Y+a*x;o.facetPartitioning[H]=o.facetPartitioning[H]?o.facetPartitioning[H]:new Array,o.facetPartitioning[y]=o.facetPartitioning[y]?o.facetPartitioning[y]:new Array,o.facetPartitioning[g]=o.facetPartitioning[g]?o.facetPartitioning[g]:new Array,o.facetPartitioning[D]=o.facetPartitioning[D]?o.facetPartitioning[D]:new Array,o.facetPartitioning[y].push(F),g!=y&&o.facetPartitioning[g].push(F),D!=g&&D!=y&&o.facetPartitioning[D].push(F),H!=y&&H!=g&&H!=D&&o.facetPartitioning[H].push(F)}if(f&&o&&o.facetPositions){const t=o.depthSortedFacets[F];t.ind=3*F,t.sqDistance=x.l.DistanceSquared(o.facetPositions[F],Q)}Y[v]+=p,Y[B]+=W,Y[J]+=T,Y[m]+=p,Y[K]+=W,Y[L]+=T,Y[z]+=p,Y[S]+=W,Y[e]+=T}for(F=0;F<Y.length/3;F++)p=Y[3*F],W=Y[3*F+1],T=Y[3*F+2],y=Math.sqrt(p*p+W*W+T*T),y=0===y?1:y,p/=y,W/=y,T/=y,Y[3*F]=p,Y[3*F+1]=W,Y[3*F+2]=T}static _ComputeSides(t,b,Y,o,F,r,R){const d=Y.length,E=o.length;let U,C;switch(t=t||T.DEFAULTSIDE){case T.FRONTSIDE:break;case T.BACKSIDE:for(U=0;U<d;U+=3){const t=Y[U];Y[U]=Y[U+2],Y[U+2]=t}for(C=0;C<E;C++)o[C]=-o[C];break;case T.DOUBLESIDE:{const t=b.length,p=t/3;for(let Y=0;Y<t;Y++)b[t+Y]=b[Y];for(U=0;U<d;U+=3)Y[U+d]=Y[U+2]+p,Y[U+1+d]=Y[U+1]+p,Y[U+2+d]=Y[U]+p;for(C=0;C<E;C++)o[E+C]=-o[C];const W=F.length;let T=0;for(T=0;T<W;T++)F[T+W]=F[T];for(r=r||new x.m(0,0,1,1),R=R||new x.m(0,0,1,1),T=0,U=0;U<W/2;U++)F[T]=r.x+(r.z-r.x)*F[T],F[T+1]=r.y+(r.w-r.y)*F[T+1],F[T+W]=R.x+(R.z-R.x)*F[T+W],F[T+W+1]=R.y+(R.w-R.y)*F[T+W+1],T+=2;break}}}static Parse(t){const b=new T,Y=t.xa;Y&&b.set(Y,F.e.PositionKind);const o=t.ya;o&&b.set(o,F.e.NormalKind);const x=t.tangents;x&&b.set(x,F.e.TangentKind);const r=t.Aa;r&&b.set(r,F.e.UVKind);const d=t.uvs2;d&&b.set(d,F.e.UV2Kind);const E=t.uvs3;E&&b.set(E,F.e.UV3Kind);const U=t.uvs4;U&&b.set(U,F.e.UV4Kind);const C=t.uvs5;C&&b.set(C,F.e.UV5Kind);const p=t.uvs6;p&&b.set(p,F.e.UV6Kind);const y=t.za;y&&(b.set(R.h.CheckColors4(y,Y.length/3),F.e.ColorKind),void 0!==t.hasVertexAlpha&&(b.hasVertexAlpha=t.hasVertexAlpha));const v=t.matricesIndices;v&&b.set(v,F.e.MatricesIndicesKind);const B=t.matricesWeights;B&&b.set(B,F.e.MatricesWeightsKind);const J=t.indices;J&&(b.indices=J);const m=t.materialInfos;if(m){b.materialInfos=[];for(const t of m){const Y=new W;Y.indexCount=t.indexCount,Y.indexStart=t.indexStart,Y.verticesCount=t.verticesCount,Y.verticesStart=t.verticesStart,Y.materialIndex=t.materialIndex,b.materialInfos.push(Y)}}return b}static ImportVertexData(t,b){const Y=T.Parse(t);b.setAllVerticesData(Y,t.updatable)}}T.FRONTSIDE=0,T.BACKSIDE=1,T.DOUBLESIDE=2,T.DEFAULTSIDE=0,T._UniqueIDGenerator=0,(0,o.e)([E.d.filter((function(){for(var t=arguments.length,b=new Array(t),Y=0;Y<t;Y++)b[Y]=arguments[Y];let[o]=b;return!Array.isArray(o)}))],T,"_TransformVector3Coordinates",null),(0,o.e)([E.d.filter((function(){for(var t=arguments.length,b=new Array(t),Y=0;Y<t;Y++)b[Y]=arguments[Y];let[o]=b;return!Array.isArray(o)}))],T,"_TransformVector3Normals",null),(0,o.e)([E.d.filter((function(){for(var t=arguments.length,b=new Array(t),Y=0;Y<t;Y++)b[Y]=arguments[Y];let[o]=b;return!Array.isArray(o)}))],T,"_TransformVector4Normals",null),(0,o.e)([E.d.filter((function(){for(var t=arguments.length,b=new Array(t),Y=0;Y<t;Y++)b[Y]=arguments[Y];let[o]=b;return!Array.isArray(o)}))],T,"_FlipFaces",null)},12690:(t,b,Y)=>{"use strict";Y.d(b,{b:()=>yt});var o=Y(1019),x=Y(11737),F=Y(1307),r=Y(11766),R=Y(1240);function d(t){let b=t.pathArray;const Y=t.closeArray||!1,o=t.closePath||!1,x=t.invertUV||!1,d=Math.floor(b[0].length/2);let E=t.offset||d;E=E>d?d:Math.floor(E);const U=0===t.sideOrientation?0:t.sideOrientation||r.c.DEFAULTSIDE,C=t.Aa,p=t.za,W=[],T=[],y=[],v=[],B=[],J=[],m=[],K=[];let L;const z=[],S=[];let e,g,D;if(b.length<2){const t=[],Y=[];for(g=0;g<b[0].length-E;g++)t.push(b[0][g]),Y.push(b[0][g+E]);b=[t,Y]}let H=0;const f=o?1:0,n=Y?1:0;let X,Q,N,u,Z,a;for(L=b[0].length,e=0;e<b.length+n;e++){for(m[e]=0,B[e]=[0],X=e===b.length?b[0]:b[e],Q=X.length,L=L<Q?L:Q,D=0;D<Q;)W.push(X[D].x,X[D].y,X[D].z),D>0&&(N=X[D].fd(X[D-1]).length(),u=N+m[e],B[e].push(u),m[e]=u),D++;o&&(D--,W.push(X[0].x,X[0].y,X[0].z),N=X[D].fd(X[0]).length(),u=N+m[e],B[e].push(u),m[e]=u),z[e]=Q+f,S[e]=H,H+=Q+f}let A,M,w=null,c=null;for(g=0;g<L+f;g++)for(K[g]=0,J[g]=[0],e=0;e<b.length-1+n;e++)Z=b[e],a=e===b.length-1?b[0]:b[e+1],g===L?(w=Z[0],c=a[0]):(w=Z[g],c=a[g]),N=c.fd(w).length(),u=N+K[g],J[g].push(u),K[g]=u;if(C)for(e=0;e<C.length;e++)v.push(C[e].x,R.c?1-C[e].y:C[e].y);else for(e=0;e<b.length+n;e++)for(g=0;g<L+f;g++)A=0!=m[e]?B[e][g]/m[e]:0,M=0!=K[g]?J[g][e]/K[g]:0,x?v.push(M,A):v.push(A,R.c?1-M:M);e=0;let I=0,s=z[e]-1,l=z[e+1]-1,i=s<l?s:l,V=S[1]-S[0];const P=z.length-1;for(;I<=i&&e<P;)T.push(I,I+V,I+1),T.push(I+V+1,I+1,I+V),I+=1,I===i&&(e++,V=S[e+1]-S[e],s=z[e]-1,l=z[e+1]-1,I=S[e],i=s<l?s+I:l+I);if(r.c.ComputeNormals(W,T,y),o){let t=0,Y=0;for(e=0;e<b.length;e++){t=3*S[e],Y=e+1<b.length?3*(S[e+1]-1):y.length-3,y[t]=.5*(y[t]+y[Y]),y[t+1]=.5*(y[t+1]+y[Y+1]),y[t+2]=.5*(y[t+2]+y[Y+2]);const o=Math.sqrt(y[t]*y[t]+y[t+1]*y[t+1]+y[t+2]*y[t+2]);y[t]/=o,y[t+1]/=o,y[t+2]/=o,y[Y]=y[t],y[Y+1]=y[t+1],y[Y+2]=y[t+2]}}if(Y){let t=3*S[0],Y=3*S[b.length];for(g=0;g<L+f;g++){y[t]=.5*(y[t]+y[Y]),y[t+1]=.5*(y[t+1]+y[Y+1]),y[t+2]=.5*(y[t+2]+y[Y+2]);const b=Math.sqrt(y[t]*y[t]+y[t+1]*y[t+1]+y[t+2]*y[t+2]);y[t]/=b,y[t+1]/=b,y[t+2]/=b,y[Y]=y[t],y[Y+1]=y[t+1],y[Y+2]=y[t+2],t+=3,Y+=3}}r.c._ComputeSides(U,W,T,y,v,t.frontUVs,t.backUVs);let k=null;if(p){k=new Float32Array(4*p.length);for(let t=0;t<p.length;t++)k[4*t]=p[t].r,k[4*t+1]=p[t].g,k[4*t+2]=p[t].b,k[4*t+3]=p[t].a}const q=new r.c,O=new Float32Array(W),j=new Float32Array(y),G=new Float32Array(v);return q.indices=T,q.xa=O,q.ya=j,q.Aa=G,k&&q.set(k,F.e.ColorKind),o&&(q._idx=S),q}function E(t,b){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const E=b.pathArray,U=b.closeArray,C=b.closePath,p=x.d._GetDefaultSideOrientation(b.sideOrientation),W=b.instance,T=b.updatable;if(W){const t=o.f.ae[0].ee(Number.MAX_VALUE),Y=o.f.ae[1].ee(-Number.MAX_VALUE),d=b=>{let o=E[0].length;const F=W;let r=0;const R=F._originalBuilderSideOrientation===x.d.DOUBLESIDE?2:1;for(let x=1;x<=R;++x)for(let R=0;R<E.length;++R){const x=E[R],d=x.length;o=o<d?o:d;for(let F=0;F<o;++F){const o=x[F];b[r]=o.x,b[r+1]=o.y,b[r+2]=o.z,t.minimizeInPlaceFromFloats(o.x,o.y,o.z),Y.maximizeInPlaceFromFloats(o.x,o.y,o.z),r+=3}if(F._creationDataStorage&&F._creationDataStorage.closePath){const t=x[0];b[r]=t.x,b[r+1]=t.y,b[r+2]=t.z,r+=3}}},U=W.getVerticesData(F.e.PositionKind);if(d(U),W.hasBoundingInfo?W.getBoundingInfo().reConstruct(t,Y,W._worldMatrix):W.buildBoundingInfo(t,Y,W._worldMatrix),W.updateVerticesData(F.e.PositionKind,U,!1,!1),b.za){const t=W.getVerticesData(F.e.ColorKind);for(let Y=0,o=0;Y<b.za.length;Y++,o+=4){const x=b.za[Y];t[o]=x.r,t[o+1]=x.g,t[o+2]=x.b,t[o+3]=x.a}W.updateVerticesData(F.e.ColorKind,t,!1,!1)}if(b.Aa){const t=W.getVerticesData(F.e.UVKind);for(let Y=0;Y<b.Aa.length;Y++)t[2*Y]=b.Aa[Y].x,t[2*Y+1]=R.c?1-b.Aa[Y].y:b.Aa[Y].y;W.updateVerticesData(F.e.UVKind,t,!1,!1)}if(!W.areNormalsFrozen||W.isFacetDataEnabled){const t=W._d(),b=W.getVerticesData(F.e.NormalKind),Y=W.isFacetDataEnabled?W.getFacetDataParameters():null;if(r.c.ComputeNormals(U,t,b,Y),W._creationDataStorage&&W._creationDataStorage.closePath){let t=0,Y=0;for(let o=0;o<E.length;o++)t=3*W._creationDataStorage.idx[o],Y=o+1<E.length?3*(W._creationDataStorage.idx[o+1]-1):b.length-3,b[t]=.5*(b[t]+b[Y]),b[t+1]=.5*(b[t+1]+b[Y+1]),b[t+2]=.5*(b[t+2]+b[Y+2]),b[Y]=b[t],b[Y+1]=b[t+1],b[Y+2]=b[t+2]}W.areNormalsFrozen||W.updateVerticesData(F.e.NormalKind,b,!1,!1)}return W}{const o=new x.d(t,Y);o._originalBuilderSideOrientation=p,o._creationDataStorage=new x.h;const F=d(b);return C&&(o._creationDataStorage.idx=F._idx),o._creationDataStorage.closePath=C,o._creationDataStorage.closeArray=U,F.Ca(o,T),o}}r.c.CreateRibbon=d,x.d.CreateRibbon=function(t,b){return E(t,{pathArray:b,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var U=Y(11891),C=Y(11798),p=Y(1229);function W(t){const b=t.pattern||x.d.NO_FLIP,Y=t.tileWidth||t.tileSize||1,o=t.tileHeight||t.tileSize||1,F=t.alignHorizontal||0,R=t.alignVertical||0,d=t.width||t.size||1,E=Math.floor(d/Y);let U=d-E*Y;const C=t.height||t.size||1,p=Math.floor(C/o);let W=C-p*o;const T=Y*E/2,y=o*p/2;let v=0,B=0,J=0,m=0,K=0,L=0;if(U>0||W>0){switch(J=-T,m=-y,K=T,L=y,F){case x.d.CENTER:U/=2,J-=U,K+=U;break;case x.d.LEFT:K+=U,v=-U/2;break;case x.d.RIGHT:J-=U,v=U/2}switch(R){case x.d.CENTER:W/=2,m-=W,L+=W;break;case x.d.BOTTOM:L+=W,B=-W/2;break;case x.d.TOP:m-=W,B=W/2}}const z=[],S=[],e=[];e[0]=[0,0,1,0,1,1,0,1],e[1]=[0,0,1,0,1,1,0,1],b!==x.d.ROTATE_TILE&&b!==x.d.ROTATE_ROW||(e[1]=[1,1,0,1,0,0,1,0]),b!==x.d.FLIP_TILE&&b!==x.d.FLIP_ROW||(e[1]=[1,0,0,0,0,1,1,1]),b!==x.d.FLIP_N_ROTATE_TILE&&b!==x.d.FLIP_N_ROTATE_ROW||(e[1]=[0,1,1,1,1,0,0,0]);let g=[];const D=[],H=[];let f=0;for(let r=0;r<p;r++)for(let t=0;t<E;t++)z.push(t*Y-T+v,r*o-y+B,0),z.push((t+1)*Y-T+v,r*o-y+B,0),z.push((t+1)*Y-T+v,(r+1)*o-y+B,0),z.push(t*Y-T+v,(r+1)*o-y+B,0),H.push(f,f+1,f+3,f+1,f+2,f+3),g=b===x.d.FLIP_TILE||b===x.d.ROTATE_TILE||b===x.d.FLIP_N_ROTATE_TILE?g.concat(e[(t%2+r%2)%2]):b===x.d.FLIP_ROW||b===x.d.ROTATE_ROW||b===x.d.FLIP_N_ROTATE_ROW?g.concat(e[r%2]):g.concat(e[0]),D.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),S.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),f+=4;if(U>0||W>0){const t=W>0&&(R===x.d.CENTER||R===x.d.TOP),r=W>0&&(R===x.d.CENTER||R===x.d.BOTTOM),d=U>0&&(F===x.d.CENTER||F===x.d.RIGHT),C=U>0&&(F===x.d.CENTER||F===x.d.LEFT);let e,n,X,Q,N=[];if(t&&d&&(z.push(J+v,m+B,0),z.push(-T+v,m+B,0),z.push(-T+v,m+W+B,0),z.push(J+v,m+W+B,0),H.push(f,f+1,f+3,f+1,f+2,f+3),f+=4,e=1-U/Y,n=1-W/o,X=1,Q=1,N=[e,n,X,n,X,Q,e,Q],b===x.d.ROTATE_ROW&&(N=[1-e,1-n,1-X,1-n,1-X,1-Q,1-e,1-Q]),b===x.d.FLIP_ROW&&(N=[1-e,n,1-X,n,1-X,Q,1-e,Q]),b===x.d.FLIP_N_ROTATE_ROW&&(N=[e,1-n,X,1-n,X,1-Q,e,1-Q]),g=g.concat(N),D.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),S.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),t&&C&&(z.push(T+v,m+B,0),z.push(K+v,m+B,0),z.push(K+v,m+W+B,0),z.push(T+v,m+W+B,0),H.push(f,f+1,f+3,f+1,f+2,f+3),f+=4,e=0,n=1-W/o,X=U/Y,Q=1,N=[e,n,X,n,X,Q,e,Q],(b===x.d.ROTATE_ROW||b===x.d.ROTATE_TILE&&E%2===0)&&(N=[1-e,1-n,1-X,1-n,1-X,1-Q,1-e,1-Q]),(b===x.d.FLIP_ROW||b===x.d.FLIP_TILE&&E%2===0)&&(N=[1-e,n,1-X,n,1-X,Q,1-e,Q]),(b===x.d.FLIP_N_ROTATE_ROW||b===x.d.FLIP_N_ROTATE_TILE&&E%2===0)&&(N=[e,1-n,X,1-n,X,1-Q,e,1-Q]),g=g.concat(N),D.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),S.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),r&&d&&(z.push(J+v,y+B,0),z.push(-T+v,y+B,0),z.push(-T+v,L+B,0),z.push(J+v,L+B,0),H.push(f,f+1,f+3,f+1,f+2,f+3),f+=4,e=1-U/Y,n=0,X=1,Q=W/o,N=[e,n,X,n,X,Q,e,Q],(b===x.d.ROTATE_ROW&&p%2===1||b===x.d.ROTATE_TILE&&p%1===0)&&(N=[1-e,1-n,1-X,1-n,1-X,1-Q,1-e,1-Q]),(b===x.d.FLIP_ROW&&p%2===1||b===x.d.FLIP_TILE&&p%2===0)&&(N=[1-e,n,1-X,n,1-X,Q,1-e,Q]),(b===x.d.FLIP_N_ROTATE_ROW&&p%2===1||b===x.d.FLIP_N_ROTATE_TILE&&p%2===0)&&(N=[e,1-n,X,1-n,X,1-Q,e,1-Q]),g=g.concat(N),D.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),S.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),r&&C&&(z.push(T+v,y+B,0),z.push(K+v,y+B,0),z.push(K+v,L+B,0),z.push(T+v,L+B,0),H.push(f,f+1,f+3,f+1,f+2,f+3),f+=4,e=0,n=0,X=U/Y,Q=W/o,N=[e,n,X,n,X,Q,e,Q],(b===x.d.ROTATE_ROW&&p%2===1||b===x.d.ROTATE_TILE&&(p+E)%2===1)&&(N=[1-e,1-n,1-X,1-n,1-X,1-Q,1-e,1-Q]),(b===x.d.FLIP_ROW&&p%2===1||b===x.d.FLIP_TILE&&(p+E)%2===1)&&(N=[1-e,n,1-X,n,1-X,Q,1-e,Q]),(b===x.d.FLIP_N_ROTATE_ROW&&p%2===1||b===x.d.FLIP_N_ROTATE_TILE&&(p+E)%2===1)&&(N=[e,1-n,X,1-n,X,1-Q,e,1-Q]),g=g.concat(N),D.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),S.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),t){const t=[];e=0,n=1-W/o,X=1,Q=1,t[0]=[e,n,X,n,X,Q,e,Q],t[1]=[e,n,X,n,X,Q,e,Q],b!==x.d.ROTATE_TILE&&b!==x.d.ROTATE_ROW||(t[1]=[1-e,1-n,1-X,1-n,1-X,1-Q,1-e,1-Q]),b!==x.d.FLIP_TILE&&b!==x.d.FLIP_ROW||(t[1]=[1-e,n,1-X,n,1-X,Q,1-e,Q]),b!==x.d.FLIP_N_ROTATE_TILE&&b!==x.d.FLIP_N_ROTATE_ROW||(t[1]=[e,1-n,X,1-n,X,1-Q,e,1-Q]);for(let o=0;o<E;o++)z.push(o*Y-T+v,m+B,0),z.push((o+1)*Y-T+v,m+B,0),z.push((o+1)*Y-T+v,m+W+B,0),z.push(o*Y-T+v,m+W+B,0),H.push(f,f+1,f+3,f+1,f+2,f+3),f+=4,g=b===x.d.FLIP_TILE||b===x.d.ROTATE_TILE||b===x.d.FLIP_N_ROTATE_TILE?g.concat(t[(o+1)%2]):b===x.d.FLIP_ROW||b===x.d.ROTATE_ROW||b===x.d.FLIP_N_ROTATE_ROW?g.concat(t[1]):g.concat(t[0]),D.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),S.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(r){const t=[];e=0,n=0,X=1,Q=W/o,t[0]=[e,n,X,n,X,Q,e,Q],t[1]=[e,n,X,n,X,Q,e,Q],b!==x.d.ROTATE_TILE&&b!==x.d.ROTATE_ROW||(t[1]=[1-e,1-n,1-X,1-n,1-X,1-Q,1-e,1-Q]),b!==x.d.FLIP_TILE&&b!==x.d.FLIP_ROW||(t[1]=[1-e,n,1-X,n,1-X,Q,1-e,Q]),b!==x.d.FLIP_N_ROTATE_TILE&&b!==x.d.FLIP_N_ROTATE_ROW||(t[1]=[e,1-n,X,1-n,X,1-Q,e,1-Q]);for(let o=0;o<E;o++)z.push(o*Y-T+v,L-W+B,0),z.push((o+1)*Y-T+v,L-W+B,0),z.push((o+1)*Y-T+v,L+B,0),z.push(o*Y-T+v,L+B,0),H.push(f,f+1,f+3,f+1,f+2,f+3),f+=4,g=b===x.d.FLIP_TILE||b===x.d.ROTATE_TILE||b===x.d.FLIP_N_ROTATE_TILE?g.concat(t[(o+p)%2]):b===x.d.FLIP_ROW||b===x.d.ROTATE_ROW||b===x.d.FLIP_N_ROTATE_ROW?g.concat(t[p%2]):g.concat(t[0]),D.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),S.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(d){const t=[];e=1-U/Y,n=0,X=1,Q=1,t[0]=[e,n,X,n,X,Q,e,Q],t[1]=[e,n,X,n,X,Q,e,Q],b!==x.d.ROTATE_TILE&&b!==x.d.ROTATE_ROW||(t[1]=[1-e,1-n,1-X,1-n,1-X,1-Q,1-e,1-Q]),b!==x.d.FLIP_TILE&&b!==x.d.FLIP_ROW||(t[1]=[1-e,n,1-X,n,1-X,Q,1-e,Q]),b!==x.d.FLIP_N_ROTATE_TILE&&b!==x.d.FLIP_N_ROTATE_ROW||(t[1]=[e,1-n,X,1-n,X,1-Q,e,1-Q]);for(let Y=0;Y<p;Y++)z.push(J+v,Y*o-y+B,0),z.push(J+U+v,Y*o-y+B,0),z.push(J+U+v,(Y+1)*o-y+B,0),z.push(J+v,(Y+1)*o-y+B,0),H.push(f,f+1,f+3,f+1,f+2,f+3),f+=4,g=b===x.d.FLIP_TILE||b===x.d.ROTATE_TILE||b===x.d.FLIP_N_ROTATE_TILE?g.concat(t[(Y+1)%2]):b===x.d.FLIP_ROW||b===x.d.ROTATE_ROW||b===x.d.FLIP_N_ROTATE_ROW?g.concat(t[Y%2]):g.concat(t[0]),D.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),S.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(C){const t=[];e=0,n=0,X=U/o,Q=1,t[0]=[e,n,X,n,X,Q,e,Q],t[1]=[e,n,X,n,X,Q,e,Q],b!==x.d.ROTATE_TILE&&b!==x.d.ROTATE_ROW||(t[1]=[1-e,1-n,1-X,1-n,1-X,1-Q,1-e,1-Q]),b!==x.d.FLIP_TILE&&b!==x.d.FLIP_ROW||(t[1]=[1-e,n,1-X,n,1-X,Q,1-e,Q]),b!==x.d.FLIP_N_ROTATE_TILE&&b!==x.d.FLIP_N_ROTATE_ROW||(t[1]=[e,1-n,X,1-n,X,1-Q,e,1-Q]);for(let Y=0;Y<p;Y++)z.push(K-U+v,Y*o-y+B,0),z.push(K+v,Y*o-y+B,0),z.push(K+v,(Y+1)*o-y+B,0),z.push(K-U+v,(Y+1)*o-y+B,0),H.push(f,f+1,f+3,f+1,f+2,f+3),f+=4,g=b===x.d.FLIP_TILE||b===x.d.ROTATE_TILE||b===x.d.FLIP_N_ROTATE_TILE?g.concat(t[(Y+E)%2]):b===x.d.FLIP_ROW||b===x.d.ROTATE_ROW||b===x.d.FLIP_N_ROTATE_ROW?g.concat(t[Y%2]):g.concat(t[0]),D.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),S.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const n=0===t.sideOrientation?0:t.sideOrientation||r.c.DEFAULTSIDE;r.c._ComputeSides(n,z,H,S,g,t.frontUVs,t.backUVs);const X=new r.c;X.indices=H,X.xa=z,X.ya=S,X.Aa=g;const Q=n===r.c.DOUBLESIDE?D.concat(D):D;return X.za=Q,X}function T(t,b){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=new x.d(t,Y);b.sideOrientation=x.d._GetDefaultSideOrientation(b.sideOrientation),o._originalBuilderSideOrientation=b.sideOrientation;return W(b).Ca(o,b.updatable),o}function y(t){const b=t.faceUV||new Array(6),Y=t.faceColors,F=t.pattern||x.d.NO_FLIP,d=t.width||t.size||1,E=t.height||t.size||1,U=t.depth||t.size||1,C=t.tileWidth||t.tileSize||1,T=t.tileHeight||t.tileSize||1,y=t.alignHorizontal||0,v=t.alignVertical||0,B=0===t.sideOrientation?0:t.sideOrientation||r.c.DEFAULTSIDE;for(let x=0;x<6;x++)void 0===b[x]&&(b[x]=new o.m(0,0,1,1)),Y&&void 0===Y[x]&&(Y[x]=new p.h(1,1,1,1));const J=d/2,m=E/2,K=U/2,L=[];for(let o=0;o<2;o++)L[o]=W({pattern:F,tileWidth:C,tileHeight:T,width:d,height:E,alignVertical:v,alignHorizontal:y,sideOrientation:B});for(let o=2;o<4;o++)L[o]=W({pattern:F,tileWidth:C,tileHeight:T,width:U,height:E,alignVertical:v,alignHorizontal:y,sideOrientation:B});let z=v;v===x.d.BOTTOM?z=x.d.TOP:v===x.d.TOP&&(z=x.d.BOTTOM);for(let o=4;o<6;o++)L[o]=W({pattern:F,tileWidth:C,tileHeight:T,width:d,height:U,alignVertical:z,alignHorizontal:y,sideOrientation:B});let S=[],e=[],g=[],D=[];const H=[],f=[],n=[],X=[];let Q=0,N=0;for(let x=0;x<6;x++){const t=L[x].xa.length;f[x]=[],n[x]=[];for(let b=0;b<t/3;b++)f[x].push(new o.l(L[x].xa[3*b],L[x].xa[3*b+1],L[x].xa[3*b+2])),n[x].push(new o.l(L[x].ya[3*b],L[x].ya[3*b+1],L[x].ya[3*b+2]));Q=L[x].Aa.length,X[x]=[];for(let Y=0;Y<Q;Y+=2)X[x][Y]=b[x].x+(b[x].z-b[x].x)*L[x].Aa[Y],X[x][Y+1]=b[x].y+(b[x].w-b[x].y)*L[x].Aa[Y+1],R.c&&(X[x][Y+1]=1-X[x][Y+1]);if(g=g.concat(X[x]),D=D.concat(L[x].indices.map((t=>t+N))),N+=f[x].length,Y)for(let b=0;b<4;b++)H.push(Y[x].r,Y[x].g,Y[x].b,Y[x].a)}const u=new o.l(0,0,K),Z=o.c.RotationY(Math.PI);S=f[0].map((t=>o.l.TransformNormal(t,Z).add(u))).map((t=>[t.x,t.y,t.z])).reduce(((t,b)=>t.concat(b)),[]),e=n[0].map((t=>o.l.TransformNormal(t,Z))).map((t=>[t.x,t.y,t.z])).reduce(((t,b)=>t.concat(b)),[]),S=S.concat(f[1].map((t=>t.fd(u))).map((t=>[t.x,t.y,t.z])).reduce(((t,b)=>t.concat(b)),[])),e=e.concat(n[1].map((t=>[t.x,t.y,t.z])).reduce(((t,b)=>t.concat(b)),[]));const a=new o.l(J,0,0),A=o.c.RotationY(-Math.PI/2);S=S.concat(f[2].map((t=>o.l.TransformNormal(t,A).add(a))).map((t=>[t.x,t.y,t.z])).reduce(((t,b)=>t.concat(b)),[])),e=e.concat(n[2].map((t=>o.l.TransformNormal(t,A))).map((t=>[t.x,t.y,t.z])).reduce(((t,b)=>t.concat(b)),[]));const M=o.c.RotationY(Math.PI/2);S=S.concat(f[3].map((t=>o.l.TransformNormal(t,M).fd(a))).map((t=>[t.x,t.y,t.z])).reduce(((t,b)=>t.concat(b)),[])),e=e.concat(n[3].map((t=>o.l.TransformNormal(t,M))).map((t=>[t.x,t.y,t.z])).reduce(((t,b)=>t.concat(b)),[]));const w=new o.l(0,m,0),c=o.c.RotationX(Math.PI/2);S=S.concat(f[4].map((t=>o.l.TransformNormal(t,c).add(w))).map((t=>[t.x,t.y,t.z])).reduce(((t,b)=>t.concat(b)),[])),e=e.concat(n[4].map((t=>o.l.TransformNormal(t,c))).map((t=>[t.x,t.y,t.z])).reduce(((t,b)=>t.concat(b)),[]));const I=o.c.RotationX(-Math.PI/2);S=S.concat(f[5].map((t=>o.l.TransformNormal(t,I).fd(w))).map((t=>[t.x,t.y,t.z])).reduce(((t,b)=>t.concat(b)),[])),e=e.concat(n[5].map((t=>o.l.TransformNormal(t,I))).map((t=>[t.x,t.y,t.z])).reduce(((t,b)=>t.concat(b)),[])),r.c._ComputeSides(B,S,D,e,g);const s=new r.c;if(s.indices=D,s.xa=S,s.ya=e,s.Aa=g,Y){const t=B===r.c.DOUBLESIDE?H.concat(H):H;s.za=t}return s}function v(t,b){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=new x.d(t,Y);b.sideOrientation=x.d._GetDefaultSideOrientation(b.sideOrientation),o._originalBuilderSideOrientation=b.sideOrientation;return y(b).Ca(o,b.updatable),o}r.c.CreateTiledPlane=W;r.c.CreateTiledBox=y;var B=Y(11881),J=Y(1260),m=Y(1564);function K(t){const b=t.height||2;let Y=0===t.diameterTop?0:t.diameterTop||t.diameter||1,F=0===t.diameterBottom?0:t.diameterBottom||t.diameter||1;Y=Y||1e-5,F=F||1e-5;const d=0|(t.Ok||24),E=0|(t.subdivisions||1),U=!!t.hasRings,C=!!t.enclose,W=0===t.cap?0:t.cap||x.d.CAP_ALL,T=t.arc&&(t.arc<=0||t.arc>1)?1:t.arc||1,y=0===t.sideOrientation?0:t.sideOrientation||r.c.DEFAULTSIDE,v=t.faceUV||new Array(3),B=t.faceColors,J=2+(1+(1!==T&&C?2:0))*(U?E:1);let K;for(K=0;K<J;K++)B&&void 0===B[K]&&(B[K]=new p.h(1,1,1,1));for(K=0;K<J;K++)v&&void 0===v[K]&&(v[K]=new o.m(0,0,1,1));const L=[],z=[],S=[],e=[],g=[],D=2*Math.PI*T/d;let H,f,n;const X=(F-Y)/2/b,Q=o.l.Zero(),N=o.l.Zero(),u=o.l.Zero(),Z=o.l.Zero(),a=o.l.Zero(),A=m.b.Y;let M,w,c,I=1,s=1,l=0,i=0;for(M=0;M<=E;M++)for(f=M/E,n=(f*(Y-F)+F)/2,I=U&&0!==M&&M!==E?2:1,c=0;c<I;c++){for(U&&(s+=c),C&&(s+=2*c),w=0;w<=d;w++)H=w*D,Q.x=Math.cos(-H)*n,Q.y=-b/2+f*b,Q.z=Math.sin(-H)*n,0===Y&&M===E?(N.x=S[S.length-3*(d+1)],N.y=S[S.length-3*(d+1)+1],N.z=S[S.length-3*(d+1)+2]):(N.x=Q.x,N.z=Q.z,N.y=Math.sqrt(N.x*N.x+N.z*N.z)*X,N.normalize()),0===w&&(u.p(Q),Z.p(N)),z.push(Q.x,Q.y,Q.z),S.push(N.x,N.y,N.z),i=U?l!==s?v[s].y:v[s].w:v[s].y+(v[s].w-v[s].y)*f,e.push(v[s].x+(v[s].z-v[s].x)*w/d,R.c?1-i:i),B&&g.push(B[s].r,B[s].g,B[s].b,B[s].a);1!==T&&C&&(z.push(Q.x,Q.y,Q.z),z.push(0,Q.y,0),z.push(0,Q.y,0),z.push(u.x,u.y,u.z),o.l.CrossToRef(A,N,a),a.normalize(),S.push(a.x,a.y,a.z,a.x,a.y,a.z),o.l.CrossToRef(Z,A,a),a.normalize(),S.push(a.x,a.y,a.z,a.x,a.y,a.z),i=U?l!==s?v[s+1].y:v[s+1].w:v[s+1].y+(v[s+1].w-v[s+1].y)*f,e.push(v[s+1].x,R.c?1-i:i),e.push(v[s+1].z,R.c?1-i:i),i=U?l!==s?v[s+2].y:v[s+2].w:v[s+2].y+(v[s+2].w-v[s+2].y)*f,e.push(v[s+2].x,R.c?1-i:i),e.push(v[s+2].z,R.c?1-i:i),B&&(g.push(B[s+1].r,B[s+1].g,B[s+1].b,B[s+1].a),g.push(B[s+1].r,B[s+1].g,B[s+1].b,B[s+1].a),g.push(B[s+2].r,B[s+2].g,B[s+2].b,B[s+2].a),g.push(B[s+2].r,B[s+2].g,B[s+2].b,B[s+2].a))),l!==s&&(l=s)}const V=1!==T&&C?d+4:d;for(M=0,s=0;s<E;s++){let t=0,b=0,Y=0,o=0;for(w=0;w<d;w++)t=M*(V+1)+w,b=(M+1)*(V+1)+w,Y=M*(V+1)+(w+1),o=(M+1)*(V+1)+(w+1),L.push(t,b,Y),L.push(o,Y,b);1!==T&&C&&(L.push(t+2,b+2,Y+2),L.push(o+2,Y+2,b+2),L.push(t+4,b+4,Y+4),L.push(o+4,Y+4,b+4)),M=U?M+2:M+1}const P=t=>{const x=t?Y/2:F/2;if(0===x)return;let r,E,U;const C=t?v[J-1]:v[0];let p=null;B&&(p=t?B[J-1]:B[0]);const W=z.length/3,y=t?b/2:-b/2,m=new o.l(0,y,0);z.push(m.x,m.y,m.z),S.push(0,t?1:-1,0);const K=C.y+.5*(C.w-C.y);e.push(C.x+.5*(C.z-C.x),R.c?1-K:K),p&&g.push(p.r,p.g,p.b,p.a);const D=new o.i(.5,.5);for(U=0;U<=d;U++){r=2*Math.PI*U*T/d;const b=Math.cos(-r),Y=Math.sin(-r);E=new o.l(b*x,y,Y*x);const F=new o.i(b*D.x+.5,Y*D.y+.5);z.push(E.x,E.y,E.z),S.push(0,t?1:-1,0);const W=C.y+(C.w-C.y)*F.y;e.push(C.x+(C.z-C.x)*F.x,R.c?1-W:W),p&&g.push(p.r,p.g,p.b,p.a)}for(U=0;U<d;U++)t?(L.push(W),L.push(W+(U+2)),L.push(W+(U+1))):(L.push(W),L.push(W+(U+1)),L.push(W+(U+2)))};W!==x.d.CAP_START&&W!==x.d.CAP_ALL||P(!1),W!==x.d.CAP_END&&W!==x.d.CAP_ALL||P(!0),r.c._ComputeSides(y,z,L,S,e,t.frontUVs,t.backUVs);const k=new r.c;return k.indices=L,k.xa=z,k.ya=S,k.Aa=e,B&&(k.za=g),k}function L(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Y=arguments.length>2?arguments[2]:void 0;const o=new x.d(t,Y);b.sideOrientation=x.d._GetDefaultSideOrientation(b.sideOrientation),o._originalBuilderSideOrientation=b.sideOrientation;return K(b).Ca(o,b.updatable),o}function z(t){const b=[],Y=[],x=[],F=[],d=t.diameter||1,E=t.thickness||.5,U=0|(t.Ok||16),C=0===t.sideOrientation?0:t.sideOrientation||r.c.DEFAULTSIDE,p=U+1;for(let r=0;r<=U;r++){const t=r/U,C=r*Math.PI*2/U-Math.PI/2,W=o.c.Translation(d/2,0,0).multiply(o.c.RotationY(C));for(let d=0;d<=U;d++){const C=1-d/U,T=d*Math.PI*2/U+Math.PI,y=Math.cos(T),v=Math.sin(T);let B=new o.l(y,v,0),J=B.scale(E/2);const m=new o.i(t,C);J=o.l.TransformCoordinates(J,W),B=o.l.TransformNormal(B,W),Y.push(J.x,J.y,J.z),x.push(B.x,B.y,B.z),F.push(m.x,R.c?1-m.y:m.y);const K=(r+1)%p,L=(d+1)%p;b.push(r*p+d),b.push(r*p+L),b.push(K*p+d),b.push(r*p+L),b.push(K*p+L),b.push(K*p+d)}}r.c._ComputeSides(C,Y,b,x,F,t.frontUVs,t.backUVs);const W=new r.c;return W.indices=b,W.xa=Y,W.ya=x,W.Aa=F,W}function S(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Y=arguments.length>2?arguments[2]:void 0;const o=new x.d(t,Y);b.sideOrientation=x.d._GetDefaultSideOrientation(b.sideOrientation),o._originalBuilderSideOrientation=b.sideOrientation;return z(b).Ca(o,b.updatable),o}r.c.CreateCylinder=K,x.d.CreateCylinder=(t,b,Y,o,F,r,R,d,E)=>{void 0!==R&&R instanceof J.e||(void 0!==R&&(E=d||x.d.DEFAULTSIDE,d=R),R=r,r=1);return L(t,{height:b,diameterTop:Y,diameterBottom:o,Ok:F,subdivisions:r,sideOrientation:E,updatable:d},R)};function e(t){const b=[],Y=[],x=[],F=[],d=t.i||2,E=t.tube||.5,U=t.radialSegments||32,C=t.tubularSegments||32,p=t.p||2,W=t.q||3,T=0===t.sideOrientation?0:t.sideOrientation||r.c.DEFAULTSIDE,y=t=>{const b=Math.cos(t),Y=Math.sin(t),x=W/p*t,F=Math.cos(x),r=d*(2+F)*.5*b,R=d*(2+F)*Y*.5,E=d*Math.sin(x)*.5;return new o.l(r,R,E)};let v,B;for(v=0;v<=U;v++){const t=v%U/U*2*p*Math.PI,b=y(t),x=y(t+.01),r=x.fd(b);let d=x.add(b);const W=o.l.Cross(r,d);for(d=o.l.Cross(W,r),W.normalize(),d.normalize(),B=0;B<C;B++){const t=B%C/C*2*Math.PI,o=-E*Math.cos(t),x=E*Math.sin(t);Y.push(b.x+o*d.x+x*W.x),Y.push(b.y+o*d.y+x*W.y),Y.push(b.z+o*d.z+x*W.z),F.push(v/U),F.push(R.c?1-B/C:B/C)}}for(v=0;v<U;v++)for(B=0;B<C;B++){const t=(B+1)%C,Y=v*C+B,o=(v+1)*C+B,x=(v+1)*C+t,F=v*C+t;b.push(F),b.push(o),b.push(Y),b.push(F),b.push(x),b.push(o)}r.c.ComputeNormals(Y,b,x),r.c._ComputeSides(T,Y,b,x,F,t.frontUVs,t.backUVs);const J=new r.c;return J.indices=b,J.xa=Y,J.ya=x,J.Aa=F,J}function g(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Y=arguments.length>2?arguments[2]:void 0;const o=new x.d(t,Y);b.sideOrientation=x.d._GetDefaultSideOrientation(b.sideOrientation),o._originalBuilderSideOrientation=b.sideOrientation;return e(b).Ca(o,b.updatable),o}r.c.CreateTorus=z,x.d.CreateTorus=(t,b,Y,o,x,F,r)=>S(t,{diameter:b,thickness:Y,Ok:o,sideOrientation:r,updatable:F},x);r.c.CreateTorusKnot=e,x.d.CreateTorusKnot=(t,b,Y,o,x,F,r,R,d,E)=>g(t,{i:b,tube:Y,radialSegments:o,tubularSegments:x,p:F,q:r,sideOrientation:E,updatable:d},R);var D=Y(12699),H=Y(1144),f=Y(1566),n=Y(1028),X=Y(1051);class Q extends o.i{constructor(t,b){super(t.x,t.y),this.index=b}}class N{constructor(){this.elements=[]}add(t){const b=[];return t.forEach((t=>{const Y=new Q(t,this.elements.length);b.push(Y),this.elements.push(Y)})),b}computeBounds(){const t=new o.i(this.elements[0].x,this.elements[0].y),b=new o.i(this.elements[0].x,this.elements[0].y);return this.elements.forEach((Y=>{Y.x<t.x?t.x=Y.x:Y.x>b.x&&(b.x=Y.x),Y.y<t.y?t.y=Y.y:Y.y>b.y&&(b.y=Y.y)})),{min:t,max:b,width:b.x-t.x,height:b.y-t.y}}}class u{_addToepoint(t){for(const b of t)this._epoints.push(b.x,b.y)}constructor(t,b,Y){let o,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;this._points=new N,this._outlinepoints=new N,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=x,this._name=t,this._scene=Y||X.d.LastCreatedScene,o=b instanceof f.g?b.getPoints():b,this._addToepoint(o),this._points.add(o),this._outlinepoints.add(o),"undefined"===typeof this.bjsEarcut&&H.b.Warn("Earcut was not found, the polygon will not be built.")}addHole(t){this._points.add(t);const b=new N;return b.add(t),this._holes.push(b),this._eholes.push(this._epoints.length/2),this._addToepoint(t),this}build(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const o=new x.d(this._name,this._scene),r=this.buildVertexData(b,Y);return o.Ga(F.e.PositionKind,r.xa,t),o.Ga(F.e.NormalKind,r.ya,t),o.Ga(F.e.UVKind,r.Aa,t),o.setIndices(r.indices),o}buildVertexData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const Y=new r.c,o=[],x=[],F=[],R=this._points.computeBounds();this._points.elements.forEach((t=>{o.push(0,1,0),x.push(t.x,0,t.y),F.push((t.x-R.min.x)/R.width,(t.y-R.min.y)/R.height)}));const d=[],E=this.bjsEarcut(this._epoints,this._eholes,2);for(let r=0;r<E.length;r++)d.push(E[r]);if(t>0){const Y=x.length/3;this._points.elements.forEach((b=>{o.push(0,-1,0),x.push(b.x,-t,b.y),F.push(1-(b.x-R.min.x)/R.width,1-(b.y-R.min.y)/R.height)}));const r=d.length;for(let t=0;t<r;t+=3){const b=d[t+0],o=d[t+1],x=d[t+2];d.push(x+Y),d.push(o+Y),d.push(b+Y)}this._addSide(x,o,F,d,R,this._outlinepoints,t,!1,b),this._holes.forEach((Y=>{this._addSide(x,o,F,d,R,Y,t,!0,b)}))}return Y.indices=d,Y.xa=x,Y.ya=o,Y.Aa=F,Y}_addSide(t,b,Y,x,F,r,R,d,E){let U=t.length/3,C=0;for(let p=0;p<r.elements.length;p++){const W=r.elements[p],T=r.elements[(p+1)%r.elements.length];t.push(W.x,0,W.y),t.push(W.x,-R,W.y),t.push(T.x,0,T.y),t.push(T.x,-R,T.y);const y=r.elements[(p+r.elements.length-1)%r.elements.length],v=r.elements[(p+2)%r.elements.length];let B=new o.l(-(T.y-W.y),0,T.x-W.x),J=new o.l(-(W.y-y.y),0,W.x-y.x),m=new o.l(-(v.y-T.y),0,v.x-T.x);d||(B=B.scale(-1),J=J.scale(-1),m=m.scale(-1));const K=B.normalizeToNew();let L=J.normalizeToNew(),z=m.normalizeToNew();const S=o.l.Dot(L,K);L=S>E?S<n.e-1?new o.l(W.x,0,W.y).fd(new o.l(T.x,0,T.y)).normalize():J.add(B).normalize():K;const e=o.l.Dot(m,B);z=e>E?e<n.e-1?new o.l(T.x,0,T.y).fd(new o.l(W.x,0,W.y)).normalize():m.add(B).normalize():K,Y.push(C/F.width,0),Y.push(C/F.width,1),C+=B.length(),Y.push(C/F.width,0),Y.push(C/F.width,1),b.push(L.x,L.y,L.z),b.push(L.x,L.y,L.z),b.push(z.x,z.y,z.z),b.push(z.x,z.y,z.z),d?(x.push(U),x.push(U+2),x.push(U+1),x.push(U+1),x.push(U+2),x.push(U+3)):(x.push(U),x.push(U+1),x.push(U+2),x.push(U+1),x.push(U+3),x.push(U+2)),U+=4}}}function Z(t,b,Y,x,d,E,U){const C=Y||new Array(3),W=x,T=[],y=U||!1;for(let F=0;F<3;F++)void 0===C[F]&&(C[F]=new o.m(0,0,1,1)),W&&void 0===W[F]&&(W[F]=new p.h(1,1,1,1));const v=t.getVerticesData(F.e.PositionKind),B=t.getVerticesData(F.e.NormalKind),J=t.getVerticesData(F.e.UVKind),m=t._d(),K=v.length/9;let L=0,z=0,S=0,e=0,g=0;const D=[0];if(y)for(let o=K;o<v.length/3;o+=4)z=v[3*(o+2)]-v[3*o],S=v[3*(o+2)+2]-v[3*o+2],e=Math.sqrt(z*z+S*S),g+=e,D.push(g);let H=0,f=0;for(let o=0;o<B.length;o+=3)Math.abs(B[o+1])<.001&&(f=1),Math.abs(B[o+1]-1)<.001&&(f=0),Math.abs(B[o+1]+1)<.001&&(f=2),H=o/3,1===f?(L=H-K,J[2*H]=L%4<1.5?y?C[f].x+(C[f].z-C[f].x)*D[Math.floor(L/4)]/g:C[f].x:y?C[f].x+(C[f].z-C[f].x)*D[Math.floor(L/4)+1]/g:C[f].z,J[2*H+1]=L%2===0?R.c?1-C[f].w:C[f].w:R.c?1-C[f].y:C[f].y):(J[2*H]=(1-J[2*H])*C[f].x+J[2*H]*C[f].z,J[2*H+1]=(1-J[2*H+1])*C[f].y+J[2*H+1]*C[f].w,R.c&&(J[2*H+1]=1-J[2*H+1])),W&&T.push(W[f].r,W[f].g,W[f].b,W[f].a);r.c._ComputeSides(b,v,m,B,J,d,E);const n=new r.c;if(n.indices=m,n.xa=v,n.ya=B,n.Aa=J,W){const t=b===r.c.DOUBLESIDE?T.concat(T):T;n.za=t}return n}function a(t,b){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;b.sideOrientation=x.d._GetDefaultSideOrientation(b.sideOrientation);const r=b.shape,R=b.holes||[],d=b.depth||0,E=b.smoothingThreshold||2,U=[];let C=[];for(let x=0;x<r.length;x++)U[x]=new o.i(r[x].x,r[x].z);U[0].equalsWithEpsilon(U[U.length-1],1e-8)&&U.pop();const p=new u(t,U,Y||X.d.LastCreatedScene,F);for(let x=0;x<R.length;x++){C=[];for(let t=0;t<R[x].length;t++)C.push(new o.i(R[x][t].x,R[x][t].z));p.addHole(C)}const W=p.build(!1,d,E);W._originalBuilderSideOrientation=b.sideOrientation;return Z(W,b.sideOrientation,b.faceUV,b.faceColors,b.frontUVs,b.backUVs,b.wrap).Ca(W,b.updatable),W}function A(t,b){return a(t,b,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut)}function M(t,b){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=b.path,F=b.shape,r=b.scale||1,R=b.rotation||0,d=0===b.cap?0:b.cap||x.d.NO_CAP,E=b.updatable,U=x.d._GetDefaultSideOrientation(b.sideOrientation),C=b.instance||null,p=b.invertUV||!1,W=b.closeShape||!1;return c(t,F,o,r,R,null,null,b.closePath||!1,W,d,!1,Y,!!E,U,C,p,b.frontUVs||null,b.backUVs||null,b.firstNormal||null,!!b.adjustFrame)}function w(t,b){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=b.path,F=b.shape,r=b.scaleFunction||(()=>1),R=b.rotationFunction||(()=>0),d=b.closePath||b.ribbonCloseArray||!1,E=b.closeShape||b.ribbonClosePath||!1,U=0===b.cap?0:b.cap||x.d.NO_CAP,C=b.updatable,p=b.firstNormal||null,W=b.adjustFrame||!1;return c(t,F,o,null,null,r,R,d,E,U,!0,Y,!!C,x.d._GetDefaultSideOrientation(b.sideOrientation),b.instance||null,b.invertUV||!1,b.frontUVs||null,b.backUVs||null,p,W)}function c(t,b,Y,F,r,R,d,U,C,p,W,T,y,v,B,J,m,K,L,z){const S=(t,b,Y,F,r,R,d,E,U,C,p)=>{const W=Y.getTangents(),T=Y.getNormals(),y=Y.getBinormals(),v=Y.getDistances();if(p)for(let x=0;x<W.length;x++)if(0==W[x].x&&0==W[x].y&&0==W[x].z&&W[x].p(W[x-1]),0==T[x].x&&0==T[x].y&&0==T[x].z&&T[x].p(T[x-1]),0==y[x].x&&0==y[x].y&&0==y[x].z&&y[x].p(y[x-1]),x>0){let t=W[x-1];o.l.Dot(t,W[x])<0&&W[x].scaleInPlace(-1),t=T[x-1],o.l.Dot(t,T[x])<0&&T[x].scaleInPlace(-1),t=y[x-1],o.l.Dot(t,y[x])<0&&y[x].scaleInPlace(-1)}let B=0;const J=C&&E?E:()=>null!==R?R:0,m=C&&d?d:()=>null!==r?r:1;let K=U===x.d.NO_CAP||U===x.d.CAP_END?0:2;const L=o.f.Matrix[0];for(let x=0;x<b.length;x++){const Y=[],r=J(x,v[x]),R=m(x,v[x]);o.c.RotationAxisToRef(W[x],B,L);for(let F=0;F<t.length;F++){const r=W[x].scale(t[F].z).add(T[x].scale(t[F].x)).add(y[x].scale(t[F].y)),d=o.l.Zero();o.l.TransformCoordinatesToRef(r,L,d),d.scaleInPlace(R).addInPlace(b[x]),Y[F]=d}F[K]=Y,B+=r,K++}const z=t=>{const b=Array(),Y=o.l.Zero();let x;for(x=0;x<t.length;x++)Y.addInPlace(t[x]);for(Y.scaleInPlace(1/t.length),x=0;x<t.length;x++)b.push(Y);return b};switch(U){case x.d.NO_CAP:break;case x.d.CAP_START:F[0]=z(F[2]),F[1]=F[2];break;case x.d.CAP_END:F[K]=F[K-1],F[K+1]=z(F[K-1]);break;case x.d.CAP_ALL:F[0]=z(F[2]),F[1]=F[2],F[K]=F[K-1],F[K+1]=z(F[K-1])}return F};let e,g;if(B){const t=B._creationDataStorage;return e=L?t.path3D.update(Y,L):t.path3D.update(Y),g=S(b,Y,t.path3D,t.pathArray,F,r,R,d,t.cap,W,z),B=E("",{pathArray:g,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:B},T||void 0)}e=L?new f.j(Y,L):new f.j(Y);g=S(b,Y,e,new Array,F,r,R,d,p=p<0||p>3?0:p,W,z);const D=E(t,{pathArray:g,closeArray:U,closePath:C,updatable:y,sideOrientation:v,invertUV:J,frontUVs:m||void 0,backUVs:K||void 0},T);return D._creationDataStorage.pathArray=g,D._creationDataStorage.path3D=e,D._creationDataStorage.cap=p,D}r.c.CreatePolygon=Z,x.d.CreatePolygon=function(t,b,Y,o,x,F){return a(t,{shape:b,holes:o,updatable:x,sideOrientation:F},Y,arguments.length>6&&void 0!==arguments[6]?arguments[6]:earcut)},x.d.ExtrudePolygon=function(t,b,Y,o,x,F,r){return A(t,{shape:b,holes:x,depth:Y,updatable:F,sideOrientation:r},o,arguments.length>7&&void 0!==arguments[7]?arguments[7]:earcut)};function I(t,b){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const F=b.arc?b.arc<=0||b.arc>1?1:b.arc:1,r=void 0===b.closed||b.closed,R=b.shape,d=b.i||1,U=b.Ok||64,C=b.clip||0,p=b.updatable,W=x.d._GetDefaultSideOrientation(b.sideOrientation),T=b.cap||x.d.NO_CAP,y=2*Math.PI,v=[],B=b.invertUV||!1;let J=0,m=0;const K=y/U*F;let L,z;for(J=0;J<=U-C;J++){for(z=[],T!=x.d.CAP_START&&T!=x.d.CAP_ALL||(z.push(new o.l(0,R[0].y,0)),z.push(new o.l(Math.cos(J*K)*R[0].x*d,R[0].y,Math.sin(J*K)*R[0].x*d))),m=0;m<R.length;m++)L=new o.l(Math.cos(J*K)*R[m].x*d,R[m].y,Math.sin(J*K)*R[m].x*d),z.push(L);T!=x.d.CAP_END&&T!=x.d.CAP_ALL||(z.push(new o.l(Math.cos(J*K)*R[R.length-1].x*d,R[R.length-1].y,Math.sin(J*K)*R[R.length-1].x*d)),z.push(new o.l(0,R[R.length-1].y,0))),v.push(z)}return E(t,{pathArray:v,closeArray:r,sideOrientation:W,updatable:p,invertUV:B,frontUVs:b.frontUVs,backUVs:b.backUVs},Y)}x.d.ExtrudeShape=function(t,b,Y,o,F,r){let R=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,d=arguments.length>7?arguments[7]:void 0,E=arguments.length>8?arguments[8]:void 0,U=arguments.length>9?arguments[9]:void 0;return M(t,{shape:b,path:Y,scale:o,rotation:F,cap:0===r?0:r||x.d.NO_CAP,sideOrientation:E,instance:U,updatable:d},R)},x.d.ExtrudeShapeCustom=(t,b,Y,o,F,r,R,d,E,U,C,p)=>w(t,{shape:b,path:Y,scaleFunction:o,rotationFunction:F,ribbonCloseArray:r,ribbonClosePath:R,cap:0===d?0:d||x.d.NO_CAP,sideOrientation:C,instance:p,updatable:U},E);x.d.CreateLathe=(t,b,Y,o,x,F,r)=>I(t,{shape:b,i:Y,Ok:o,sideOrientation:r,updatable:F},x);var s=Y(11839),l=Y(11800);function i(t,b){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const F=b.path;let r=b.instance,R=1;void 0!==b.i?R=b.i:r&&(R=r._creationDataStorage.i);const d=b.Ok||64,U=b.radiusFunction||null;let C=b.cap||x.d.NO_CAP;const p=b.invertUV||!1,W=b.updatable,T=x.d._GetDefaultSideOrientation(b.sideOrientation);b.arc=b.arc&&(b.arc<=0||b.arc>1)?1:b.arc||1;const y=(t,b,Y,F,r,R,d,E)=>{const U=b.getTangents(),C=b.getNormals(),p=b.getDistances(),W=2*Math.PI/r*E,T=R||(()=>F);let y,v,B,J;const m=o.f.Matrix[0];let K=d===x.d.NO_CAP||d===x.d.CAP_END?0:2;for(let x=0;x<t.length;x++){v=T(x,p[x]),y=Array(),B=C[x];for(let b=0;b<r;b++)o.c.RotationAxisToRef(U[x],W*b,m),J=y[b]?y[b]:o.l.Zero(),o.l.TransformCoordinatesToRef(B,m,J),J.scaleInPlace(v).addInPlace(t[x]),y[b]=J;Y[K]=y,K++}const L=(b,Y)=>{const o=Array();for(let x=0;x<b;x++)o.push(t[Y]);return o};switch(d){case x.d.NO_CAP:break;case x.d.CAP_START:Y[0]=L(r,0),Y[1]=Y[2].slice(0);break;case x.d.CAP_END:Y[K]=Y[K-1].slice(0),Y[K+1]=L(r,t.length-1);break;case x.d.CAP_ALL:Y[0]=L(r,0),Y[1]=Y[2].slice(0),Y[K]=Y[K-1].slice(0),Y[K+1]=L(r,t.length-1)}return Y};let v,B;if(r){const t=r._creationDataStorage,Y=b.arc||t.arc;return v=t.path3D.update(F),B=y(F,v,t.pathArray,R,t.Ok,U,t.cap,Y),r=E("",{pathArray:B,instance:r}),t.path3D=v,t.pathArray=B,t.arc=Y,t.i=R,r}v=new f.j(F);C=C<0||C>3?0:C,B=y(F,v,new Array,R,d,U,C,b.arc);const J=E(t,{pathArray:B,closePath:!0,closeArray:!1,updatable:W,sideOrientation:T,invertUV:p,frontUVs:b.frontUVs,backUVs:b.backUVs},Y);return J._creationDataStorage.pathArray=B,J._creationDataStorage.path3D=v,J._creationDataStorage.Ok=d,J._creationDataStorage.cap=C,J._creationDataStorage.arc=b.arc,J._creationDataStorage.i=R,J}function V(t){const b=[];b[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},b[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},b[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},b[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},b[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},b[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},b[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},b[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},b[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},b[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},b[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},b[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},b[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},b[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},b[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const Y=t.type&&(t.type<0||t.type>=b.length)?0:t.type||0,x=t.size,F=t.sizeX||x||1,d=t.sizeY||x||1,E=t.sizeZ||x||1,U=t.custom||b[Y],C=U.face.length,W=t.faceUV||new Array(C),T=t.faceColors,y=void 0===t.flat||t.flat,v=0===t.sideOrientation?0:t.sideOrientation||r.c.DEFAULTSIDE,B=[],J=[],m=[],K=[],L=[];let z=0,S=0;const e=[];let g,D,H,f,n,X,Q=0,N=0;if(y)for(N=0;N<C;N++)T&&void 0===T[N]&&(T[N]=new p.h(1,1,1,1)),W&&void 0===W[N]&&(W[N]=new o.m(0,0,1,1));if(y)for(N=0;N<C;N++){const t=U.face[N].length;for(H=2*Math.PI/t,f=.5*Math.tan(H/2),n=.5,Q=0;Q<t;Q++)B.push(U.vertex[U.face[N][Q]][0]*F,U.vertex[U.face[N][Q]][1]*d,U.vertex[U.face[N][Q]][2]*E),e.push(z),z++,g=W[N].x+(W[N].z-W[N].x)*(.5+f),D=W[N].y+(W[N].w-W[N].y)*(n-.5),K.push(g,R.c?1-D:D),X=f*Math.cos(H)-n*Math.sin(H),n=f*Math.sin(H)+n*Math.cos(H),f=X,T&&L.push(T[N].r,T[N].g,T[N].b,T[N].a);for(Q=0;Q<t-2;Q++)J.push(e[0+S],e[Q+2+S],e[Q+1+S]);S+=t}else{for(Q=0;Q<U.vertex.length;Q++)B.push(U.vertex[Q][0]*F,U.vertex[Q][1]*d,U.vertex[Q][2]*E),K.push(0,R.c?1:0);for(N=0;N<C;N++)for(Q=0;Q<U.face[N].length-2;Q++)J.push(U.face[N][0],U.face[N][Q+2],U.face[N][Q+1])}r.c.ComputeNormals(B,J,m),r.c._ComputeSides(v,B,J,m,K,t.frontUVs,t.backUVs);const u=new r.c;return u.xa=B,u.indices=J,u.ya=m,u.Aa=K,T&&y&&(u.za=L),u}function P(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=new x.d(t,Y);b.sideOrientation=x.d._GetDefaultSideOrientation(b.sideOrientation),o._originalBuilderSideOrientation=b.sideOrientation;return V(b).Ca(o,b.updatable),o}x.d.CreateTube=(t,b,Y,o,x,F,r,R,d,E)=>i(t,{path:b,i:Y,Ok:o,radiusFunction:x,arc:1,cap:F,updatable:R,sideOrientation:d,instance:E},r);function k(t){const b=t.sideOrientation||r.c.DEFAULTSIDE,Y=t.i||1,x=void 0===t.flat||t.flat,F=0|(t.subdivisions||4),d=t.radiusX||Y,E=t.radiusY||Y,U=t.radiusZ||Y,C=(1+Math.sqrt(5))/2,p=[-1,C,-0,1,C,0,-1,-C,0,1,-C,0,0,-1,-C,0,1,-C,0,-1,C,0,1,C,C,0,1,C,0,-1,-C,0,1,-C,0,-1],W=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],T=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],y=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],v=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],B=[],J=[],m=[],K=[];let L=0;const z=new Array(3),S=new Array(3);let e;for(e=0;e<3;e++)z[e]=o.l.Zero(),S[e]=o.i.Zero();for(let r=0;r<20;r++){for(e=0;e<3;e++){const t=W[3*r+e];z[e].be(p[3*T[t]],p[3*T[t]+1],p[3*T[t]+2]),z[e].normalize(),S[e].be(.134765625*y[2*t]+.05859375+-.0390625*v[r],.2333984375*y[2*t+1]+.025390625+.01953125*v[r])}const t=(t,b,Y,r)=>{const C=o.l.Lerp(z[0],z[2],b/F),p=o.l.Lerp(z[1],z[2],b/F),W=F===b?z[2]:o.l.Lerp(C,p,t/(F-b));let T;if(W.normalize(),x){const t=o.l.Lerp(z[0],z[2],r/F),b=o.l.Lerp(z[1],z[2],r/F);T=o.l.Lerp(t,b,Y/(F-r))}else T=new o.l(W.x,W.y,W.z);T.x/=d,T.y/=E,T.z/=U,T.normalize();const y=o.i.Lerp(S[0],S[2],b/F),v=o.i.Lerp(S[1],S[2],b/F),e=F===b?S[2]:o.i.Lerp(y,v,t/(F-b));J.push(W.x*d,W.y*E,W.z*U),m.push(T.x,T.y,T.z),K.push(e.x,R.c?1-e.y:e.y),B.push(L),L++};for(let b=0;b<F;b++)for(let Y=0;Y+b<F;Y++)t(Y,b,Y+1/3,b+1/3),t(Y+1,b,Y+1/3,b+1/3),t(Y,b+1,Y+1/3,b+1/3),Y+b+1<F&&(t(Y+1,b,Y+2/3,b+2/3),t(Y+1,b+1,Y+2/3,b+2/3),t(Y,b+1,Y+2/3,b+2/3))}r.c._ComputeSides(b,J,B,m,K,t.frontUVs,t.backUVs);const g=new r.c;return g.indices=B,g.xa=J,g.ya=m,g.Aa=K,g}function q(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=new x.d(t,Y);b.sideOrientation=x.d._GetDefaultSideOrientation(b.sideOrientation),o._originalBuilderSideOrientation=b.sideOrientation;return k(b).Ca(o,b.updatable),o}r.c.CreatePolyhedron=V,x.d.CreatePolyhedron=(t,b,Y)=>P(t,b,Y);r.c.CreateIcoSphere=k,x.d.CreateIcoSphere=(t,b,Y)=>q(t,b,Y);var O=Y(1058);const j=new o.l(1,0,0),G=new o.l(-1,0,0),h=new o.l(0,1,0),tt=new o.l(0,-1,0),bt=new o.l(0,0,1),Yt=new o.l(0,0,-1);class ot{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o.l.Zero(),b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.l.Up(),Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.i.Zero(),x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,R=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,d=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,E=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=t,this.xe=b,this.uv=Y,this.vertexIdx=x,this.vertexIdxForBones=F,this.localPositionOverride=r,this.localNormalOverride=R,this.matrixIndicesOverride=d,this.matrixWeightsOverride=E}clone(){var t,b,Y,o;return new ot(this.position.clone(),this.xe.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(t=this.localPositionOverride)||void 0===t?void 0:t.slice(),null===(b=this.localNormalOverride)||void 0===b?void 0:b.slice(),null===(Y=this.matrixIndicesOverride)||void 0===Y?void 0:Y.slice(),null===(o=this.matrixWeightsOverride)||void 0===o?void 0:o.slice())}}function xt(t,b,Y){var d,E,U,C;const p=!!b.skeleton,W=Y.localMode||p,T=b._d(),y=p?b.Pf(!0,!0):b.getVerticesData(F.e.PositionKind),v=p?b.getNormalsData(!0,!0):b.getVerticesData(F.e.NormalKind),B=W?p?b.getVerticesData(F.e.PositionKind):y:null,J=W?p?b.getVerticesData(F.e.NormalKind):v:null,m=b.getVerticesData(F.e.UVKind),K=p?b.getVerticesData(F.e.MatricesIndicesKind):null,L=p?b.getVerticesData(F.e.MatricesWeightsKind):null,z=p?b.getVerticesData(F.e.MatricesIndicesExtraKind):null,S=p?b.getVerticesData(F.e.MatricesWeightsExtraKind):null,e=Y.position||o.l.Zero();let g=Y.xe||o.l.Up();const D=Y.size||o.l.One(),H=Y.angle||0;if(!g){const t=new o.l(0,0,1),Y=b.va().activeCamera,x=o.l.TransformCoordinates(t,Y.getWorldMatrix());g=Y.globalPosition.fd(x)}const f=-Math.atan2(g.z,g.x)-Math.PI/2,n=Math.sqrt(g.x*g.x+g.z*g.z),X=Math.atan2(g.y,n),Q=new r.c;Q.indices=[],Q.xa=[],Q.ya=[],Q.Aa=[],Q.matricesIndices=p?[]:null,Q.matricesWeights=p?[]:null,Q.matricesIndicesExtra=z?[]:null,Q.matricesWeightsExtra=S?[]:null;let N=0;const u=(t,b)=>{const x=new ot;if(!T||!y||!v)return x;const F=T[t];if(x.vertexIdx=3*F,x.vertexIdxForBones=4*F,x.position=new o.l(y[3*F],y[3*F+1],y[3*F+2]),o.l.TransformCoordinatesToRef(x.position,b,x.position),x.xe=new o.l(v[3*F],v[3*F+1],v[3*F+2]),o.l.TransformNormalToRef(x.xe,b,x.xe),Y.captureUVS&&m){const t=m[2*F+1];x.uv=new o.i(m[2*F],R.c?1-t:t)}return x},Z=[0,0,0,0],a=(t,b)=>{if(0===t.length)return t;const Y=.5*Math.abs(o.l.Dot(D,b)),x=(t,b,Y,o)=>{for(let x=0;x<o;++x)if(t[Y+x]===b)return Y+x;return-1},F=(t,F)=>{const r=o.l.GetClipFactor(t.position,F.position,b,Y);let R=Z,d=Z;if(K&&L){const b=t.matrixIndicesOverride?0:t.vertexIdxForBones,Y=t.matrixIndicesOverride??K,o=t.matrixWeightsOverride??L,E=F.matrixIndicesOverride?0:F.vertexIdxForBones,U=F.matrixIndicesOverride??K,C=F.matrixWeightsOverride??L;R=[0,0,0,0],d=[0,0,0,0];let p=0;for(let t=0;t<4;++t)if(o[b+t]>0){const F=x(U,Y[b+t],E,4);R[p]=Y[b+t],d[p]=(0,O.n)(o[b+t],F>=0?C[F]:0,r),p++}for(let t=0;t<4&&p<4;++t){const o=U[E+t];-1===x(Y,o,b,4)&&(R[p]=o,d[p]=(0,O.n)(0,C[E+t],r),p++)}const W=d[0]+d[1]+d[2]+d[3];d[0]/=W,d[1]/=W,d[2]/=W,d[3]/=W}const E=t.localPositionOverride?t.localPositionOverride[0]:(null===B||void 0===B?void 0:B[t.vertexIdx])??0,U=t.localPositionOverride?t.localPositionOverride[1]:(null===B||void 0===B?void 0:B[t.vertexIdx+1])??0,C=t.localPositionOverride?t.localPositionOverride[2]:(null===B||void 0===B?void 0:B[t.vertexIdx+2])??0,p=F.localPositionOverride?F.localPositionOverride[0]:(null===B||void 0===B?void 0:B[F.vertexIdx])??0,W=F.localPositionOverride?F.localPositionOverride[1]:(null===B||void 0===B?void 0:B[F.vertexIdx+1])??0,T=F.localPositionOverride?F.localPositionOverride[2]:(null===B||void 0===B?void 0:B[F.vertexIdx+2])??0,y=t.localNormalOverride?t.localNormalOverride[0]:(null===J||void 0===J?void 0:J[t.vertexIdx])??0,v=t.localNormalOverride?t.localNormalOverride[1]:(null===J||void 0===J?void 0:J[t.vertexIdx+1])??0,m=t.localNormalOverride?t.localNormalOverride[2]:(null===J||void 0===J?void 0:J[t.vertexIdx+2])??0,z=y+((F.localNormalOverride?F.localNormalOverride[0]:(null===J||void 0===J?void 0:J[F.vertexIdx])??0)-y)*r,S=v+((F.localNormalOverride?F.localNormalOverride[1]:(null===J||void 0===J?void 0:J[F.vertexIdx+1])??0)-v)*r,e=m+((F.localNormalOverride?F.localNormalOverride[2]:(null===J||void 0===J?void 0:J[F.vertexIdx+2])??0)-m)*r,g=Math.sqrt(z*z+S*S+e*e);return new ot(o.l.Lerp(t.position,F.position,r),o.l.Lerp(t.xe,F.xe,r).normalize(),o.i.Lerp(t.uv,F.uv,r),-1,-1,B?[E+(p-E)*r,U+(W-U)*r,C+(T-C)*r]:null,J?[z/g,S/g,e/g]:null,R,d)};let r=null;t.length>3&&(r=[]);for(let R=0;R<t.length;R+=3){let x=0,d=null,E=null,U=null,C=null;const p=o.l.Dot(t[R].position,b)-Y>0,W=o.l.Dot(t[R+1].position,b)-Y>0,T=o.l.Dot(t[R+2].position,b)-Y>0;switch(x=(p?1:0)+(W?1:0)+(T?1:0),x){case 0:t.length>3?(r.push(t[R]),r.push(t[R+1]),r.push(t[R+2])):r=t;break;case 1:if(r=r??new Array,p&&(d=t[R+1],E=t[R+2],U=F(t[R],d),C=F(t[R],E)),W){d=t[R],E=t[R+2],U=F(t[R+1],d),C=F(t[R+1],E),r.push(U),r.push(E.clone()),r.push(d.clone()),r.push(E.clone()),r.push(U.clone()),r.push(C);break}T&&(d=t[R],E=t[R+1],U=F(t[R+2],d),C=F(t[R+2],E)),d&&E&&U&&C&&(r.push(d.clone()),r.push(E.clone()),r.push(U),r.push(C),r.push(U.clone()),r.push(E.clone()));break;case 2:r=r??new Array,p||(d=t[R].clone(),E=F(d,t[R+1]),U=F(d,t[R+2]),r.push(d),r.push(E),r.push(U)),W||(d=t[R+1].clone(),E=F(d,t[R+2]),U=F(d,t[R]),r.push(d),r.push(E),r.push(U)),T||(d=t[R+2].clone(),E=F(d,t[R]),U=F(d,t[R+1]),r.push(d),r.push(E),r.push(U))}}return r},A=b instanceof x.d?b:null,M=null===A||void 0===A?void 0:A._thinInstanceDataStorage.matrixData,w=(null===A||void 0===A?void 0:A.Ij)||1,c=o.f.Matrix[0];c.p(o.c.IdentityReadOnly);for(let x=0;x<w;++x){if(null!==A&&void 0!==A&&A.hasThinInstances&&M){const t=16*x;c.setRowFromFloats(0,M[t+0],M[t+1],M[t+2],M[t+3]),c.setRowFromFloats(1,M[t+4],M[t+5],M[t+6],M[t+7]),c.setRowFromFloats(2,M[t+8],M[t+9],M[t+10],M[t+11]),c.setRowFromFloats(3,M[t+12],M[t+13],M[t+14],M[t+15])}const t=o.c.RotationYawPitchRoll(f,X,H).multiply(o.c.Translation(e.x,e.y,e.z)),F=o.c.Invert(t),r=b.getWorldMatrix(),d=c.multiply(r).multiply(F),E=new Array(3);for(let b=0;b<T.length;b+=3){let t=E;if(t[0]=u(b,d),t[1]=u(b+1,d),t[2]=u(b+2,d),!(Y.cullBackFaces&&-t[0].xe.z<=0&&-t[1].xe.z<=0&&-t[2].xe.z<=0)&&(t=a(t,j),t&&(t=a(t,G),t&&(t=a(t,h),t&&(t=a(t,tt),t&&(t=a(t,bt),t&&(t=a(t,Yt),t)))))))for(let b=0;b<t.length;b++){const o=t[b];if(Q.indices.push(N),W?(o.localPositionOverride?(Q.xa[3*N]=o.localPositionOverride[0],Q.xa[3*N+1]=o.localPositionOverride[1],Q.xa[3*N+2]=o.localPositionOverride[2]):B&&(Q.xa[3*N]=B[o.vertexIdx],Q.xa[3*N+1]=B[o.vertexIdx+1],Q.xa[3*N+2]=B[o.vertexIdx+2]),o.localNormalOverride?(Q.ya[3*N]=o.localNormalOverride[0],Q.ya[3*N+1]=o.localNormalOverride[1],Q.ya[3*N+2]=o.localNormalOverride[2]):J&&(Q.ya[3*N]=J[o.vertexIdx],Q.ya[3*N+1]=J[o.vertexIdx+1],Q.ya[3*N+2]=J[o.vertexIdx+2])):(o.position.toArray(Q.xa,3*N),o.xe.toArray(Q.ya,3*N)),Q.matricesIndices&&Q.matricesWeights&&(o.matrixIndicesOverride?(Q.matricesIndices[4*N]=o.matrixIndicesOverride[0],Q.matricesIndices[4*N+1]=o.matrixIndicesOverride[1],Q.matricesIndices[4*N+2]=o.matrixIndicesOverride[2],Q.matricesIndices[4*N+3]=o.matrixIndicesOverride[3]):(K&&(Q.matricesIndices[4*N]=K[o.vertexIdxForBones],Q.matricesIndices[4*N+1]=K[o.vertexIdxForBones+1],Q.matricesIndices[4*N+2]=K[o.vertexIdxForBones+2],Q.matricesIndices[4*N+3]=K[o.vertexIdxForBones+3]),z&&Q.matricesIndicesExtra&&(Q.matricesIndicesExtra[4*N]=z[o.vertexIdxForBones],Q.matricesIndicesExtra[4*N+1]=z[o.vertexIdxForBones+1],Q.matricesIndicesExtra[4*N+2]=z[o.vertexIdxForBones+2],Q.matricesIndicesExtra[4*N+3]=z[o.vertexIdxForBones+3])),o.matrixWeightsOverride?(Q.matricesWeights[4*N]=o.matrixWeightsOverride[0],Q.matricesWeights[4*N+1]=o.matrixWeightsOverride[1],Q.matricesWeights[4*N+2]=o.matrixWeightsOverride[2],Q.matricesWeights[4*N+3]=o.matrixWeightsOverride[3]):(L&&(Q.matricesWeights[4*N]=L[o.vertexIdxForBones],Q.matricesWeights[4*N+1]=L[o.vertexIdxForBones+1],Q.matricesWeights[4*N+2]=L[o.vertexIdxForBones+2],Q.matricesWeights[4*N+3]=L[o.vertexIdxForBones+3]),S&&Q.matricesWeightsExtra&&(Q.matricesWeightsExtra[4*N]=S[o.vertexIdxForBones],Q.matricesWeightsExtra[4*N+1]=S[o.vertexIdxForBones+1],Q.matricesWeightsExtra[4*N+2]=S[o.vertexIdxForBones+2],Q.matricesWeightsExtra[4*N+3]=S[o.vertexIdxForBones+3]))),Y.captureUVS)o.uv.toArray(Q.Aa,2*N);else{Q.Aa.push(.5+o.position.x/D.x);const t=.5+o.position.y/D.y;Q.Aa.push(R.c?1-t:t)}N++}}}0===Q.indices.length&&(Q.indices=null),0===Q.xa.length&&(Q.xa=null),0===Q.ya.length&&(Q.ya=null),0===Q.Aa.length&&(Q.Aa=null),0===(null===(d=Q.matricesIndices)||void 0===d?void 0:d.length)&&(Q.matricesIndices=null),0===(null===(E=Q.matricesWeights)||void 0===E?void 0:E.length)&&(Q.matricesWeights=null),0===(null===(U=Q.matricesIndicesExtra)||void 0===U?void 0:U.length)&&(Q.matricesIndicesExtra=null),0===(null===(C=Q.matricesWeightsExtra)||void 0===C?void 0:C.length)&&(Q.matricesWeightsExtra=null);const I=new x.d(t,b.va());return Q.Ca(I),W?(I.skeleton=b.skeleton,I.parent=b):(I.position=e.clone(),I.rotation=new o.l(X,f,H)),I.ve(!0),I.refreshBoundingInfo(!0,!0),I}function Ft(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,Ok:16,height:1,i:.25,capSubdivisions:6};const b=0|Math.max(t.subdivisions?t.subdivisions:2,1),Y=0|Math.max(t.Ok?t.Ok:16,3),x=Math.max(t.height?t.height:1,0),F=Math.max(t.i?t.i:.25,0),d=0|Math.max(t.capSubdivisions?t.capSubdivisions:6,1),E=Y,U=b,C=Math.max(t.radiusTop?t.radiusTop:F,0),p=Math.max(t.radiusBottom?t.radiusBottom:F,0),W=x-(C+p),T=2*Math.PI,y=Math.max(t.topCapSubdivisions?t.topCapSubdivisions:d,1),v=Math.max(t.bottomCapSubdivisions?t.bottomCapSubdivisions:d,1),B=Math.acos((p-C)/x);let J=[];const m=[],K=[],L=[];let z=0;const S=[],e=.5*W,g=.5*Math.PI;let D,H;const f=o.l.Zero(),n=o.l.Zero(),X=Math.cos(B),Q=Math.sin(B),N=new o.i(C*Q,e+C*X).fd(new o.i(p*Q,p*X-e)).length(),u=C*B+N+p*(g-B);let Z=0;for(H=0;H<=y;H++){const t=[],b=g-B*(H/y);Z+=C*B/y;const Y=Math.cos(b),o=Math.sin(b),x=Y*C;for(D=0;D<=E;D++){const b=D/E,F=b*T+0,r=Math.sin(F),d=Math.cos(F);n.x=x*r,n.y=e+o*C,n.z=x*d,m.push(n.x,n.y,n.z),f.set(Y*r,o,Y*d),K.push(f.x,f.y,f.z),L.push(b,R.c?Z/u:1-Z/u),t.push(z),z++}S.push(t)}const a=x-C-p+X*C-X*p,A=Q*(p-C)/a;for(H=1;H<=U;H++){const t=[];Z+=N/U;const b=Q*(H*(p-C)/U+C);for(D=0;D<=E;D++){const Y=D/E,o=Y*T+0,x=Math.sin(o),F=Math.cos(o);n.x=b*x,n.y=e+X*C-H*a/U,n.z=b*F,m.push(n.x,n.y,n.z),f.set(x,A,F).normalize(),K.push(f.x,f.y,f.z),L.push(Y,R.c?Z/u:1-Z/u),t.push(z),z++}S.push(t)}for(H=1;H<=v;H++){const t=[],b=g-B-(Math.PI-B)*(H/v);Z+=p*B/v;const Y=Math.cos(b),o=Math.sin(b),x=Y*p;for(D=0;D<=E;D++){const b=D/E,F=b*T+0,r=Math.sin(F),d=Math.cos(F);n.x=x*r,n.y=o*p-e,n.z=x*d,m.push(n.x,n.y,n.z),f.set(Y*r,o,Y*d),K.push(f.x,f.y,f.z),L.push(b,R.c?Z/u:1-Z/u),t.push(z),z++}S.push(t)}for(D=0;D<E;D++)for(H=0;H<y+U+v;H++){const t=S[H][D],b=S[H+1][D],Y=S[H+1][D+1],o=S[H][D+1];J.push(t),J.push(b),J.push(o),J.push(b),J.push(Y),J.push(o)}if(J=J.reverse(),t.orientation&&!t.orientation.equals(o.l.Up())){const b=new o.c;t.orientation.clone().scale(.5*Math.PI).cross(o.l.Up()).toQuaternion().toRotationMatrix(b);const Y=o.l.Zero();for(let t=0;t<m.length;t+=3)Y.set(m[t],m[t+1],m[t+2]),o.l.TransformCoordinatesToRef(Y.clone(),b,Y),m[t]=Y.x,m[t+1]=Y.y,m[t+2]=Y.z}const M=new r.c;return M.xa=m,M.ya=K,M.Aa=L,M.indices=J,M}function rt(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:o.l.Up(),subdivisions:2,Ok:16,height:1,i:.25,capSubdivisions:6,updatable:!1},Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const F=new x.d(t,Y);return Ft(b).Ca(F,b.updatable),F}x.d.CreateDecal=(t,b,Y,o,x,F)=>xt(t,b,{position:Y,xe:o,size:x,angle:F});x.d.CreateCapsule=(t,b,Y)=>rt(t,b,Y),r.c.CreateCapsule=Ft;class Rt{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=t,this.y=b,t!==Math.floor(t)&&(t=Math.floor(t),H.b.Warn("x is not an integer, floor(x) used")),b!==Math.floor(b)&&(b=Math.floor(b),H.b.Warn("y is not an integer, floor(y) used"))}clone(){return new Rt(this.x,this.y)}rotate60About(t){const b=this.x;return this.x=t.x+t.y-this.y,this.y=b+this.y-t.x,this}rotateNeg60About(t){const b=this.x;return this.x=b+this.y-t.y,this.y=t.x+t.y-b,this}rotate120(t,b){t!==Math.floor(t)&&(t=Math.floor(t),H.b.Warn("m not an integer only floor(m) used")),b!==Math.floor(b)&&(b=Math.floor(b),H.b.Warn("n not an integer only floor(n) used"));const Y=this.x;return this.x=t-Y-this.y,this.y=b+Y,this}rotateNeg120(t,b){t!==Math.floor(t)&&(t=Math.floor(t),H.b.Warn("m is not an integer, floor(m) used")),b!==Math.floor(b)&&(b=Math.floor(b),H.b.Warn("n is not an integer,   floor(n) used"));const Y=this.x;return this.x=this.y-b,this.y=t+b-Y-this.y,this}toCartesianOrigin(t,b){const Y=o.l.Zero();return Y.x=t.x+2*this.x*b+this.y*b,Y.y=t.y+Math.sqrt(3)*this.y*b,Y}static Zero(){return new Rt(0,0)}}class dt{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new Et("icosahedron","Regular",[[0,n.i,-1],[-n.i,1,0],[-1,0,-n.i],[1,0,-n.i],[n.i,1,0],[0,n.i,1],[-1,0,n.i],[-n.i,-1,0],[0,-n.i,-1],[n.i,-1,0],[1,0,n.i],[0,-n.i,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let t=12;const b={},Y=this.m,o=this.n;let x,F,r,R,d,E=Y,U=1,C=0;0!==o&&(E=(0,O.i)(Y,o)),U=Y/E,C=o/E;const p=Rt.Zero(),W=new Rt(Y,o),T=new Rt(-o,Y+o),y=Rt.Zero(),v=Rt.Zero(),B=Rt.Zero();let J,m,K,L,z=[];const S=[],e=this.vertByDist,g=(Y,o,x,F)=>{J=Y+"|"+x,m=o+"|"+F,J in b||m in b?J in b&&!(m in b)?b[m]=b[J]:m in b&&!(J in b)&&(b[J]=b[m]):(b[J]=t,b[m]=t,t++),e[x][0]>2?S[b[J]]=[-e[x][0],e[x][1],b[J]]:S[b[J]]=[z[e[x][0]],e[x][1],b[J]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let D=0;D<20;D++){if(z=this.IDATA.face[D],r=z[2],R=z[1],d=z[0],K=p.x+"|"+p.y,J=D+"|"+K,J in b||(b[J]=r,S[r]=[z[e[K][0]],e[K][1]]),K=W.x+"|"+W.y,J=D+"|"+K,J in b||(b[J]=R,S[R]=[z[e[K][0]],e[K][1]]),K=T.x+"|"+T.y,J=D+"|"+K,J in b||(b[J]=d,S[d]=[z[e[K][0]],e[K][1]]),x=this.IDATA.edgematch[D][0],F=this.IDATA.edgematch[D][1],"B"===F)for(let t=1;t<E;t++)v.x=Y-t*(U+C),v.y=o+t*U,B.x=-t*C,B.y=t*(U+C),K=v.x+"|"+v.y,L=B.x+"|"+B.y,g(D,x,K,L);if("O"===F)for(let t=1;t<E;t++)B.x=-t*C,B.y=t*(U+C),y.x=t*U,y.y=t*C,K=B.x+"|"+B.y,L=y.x+"|"+y.y,g(D,x,K,L);if(x=this.IDATA.edgematch[D][2],F=this.IDATA.edgematch[D][3],F&&"A"===F)for(let t=1;t<E;t++)y.x=t*U,y.y=t*C,v.x=Y-(E-t)*(U+C),v.y=o+(E-t)*U,K=y.x+"|"+y.y,L=v.x+"|"+v.y,g(D,x,K,L);for(let Y=0;Y<this.vertices.length;Y++)K=this.vertices[Y].x+"|"+this.vertices[Y].y,J=D+"|"+K,J in b||(b[J]=t++,e[K][0]>2?S[b[J]]=[-e[K][0],e[K][1],b[J]]:S[b[J]]=[z[e[K][0]],e[K][1],b[J]])}this.closestTo=S,this.vecToidx=b}calcCoeffs(){const t=this.m,b=this.n,Y=Math.sqrt(3)/3,o=t*t+b*b+t*b;this.coau=(t+b)/o,this.cobu=-b/o,this.coav=-Y*(t-b)/o,this.cobv=Y*(2*t+b)/o}createInnerFacets(){const t=this.m,b=this.n;for(let Y=0;Y<b+t+1;Y++)for(let t=this.min[Y];t<this.max[Y]+1;t++)t<this.max[Y]&&t<this.max[Y+1]+1&&this.innerFacets.push(["|"+t+"|"+Y,"|"+t+"|"+(Y+1),"|"+(t+1)+"|"+Y]),Y>0&&t<this.max[Y-1]&&t+1<this.max[Y]+1&&this.innerFacets.push(["|"+t+"|"+Y,"|"+(t+1)+"|"+Y,"|"+(t+1)+"|"+(Y-1)])}edgeVecsABOB(){const t=this.m,b=this.n,Y=new Rt(-b,t+b);for(let o=1;o<t+b;o++){const t=new Rt(this.min[o],o),b=new Rt(this.min[o-1],o-1),x=new Rt(this.min[o+1],o+1),F=t.clone(),r=b.clone(),R=x.clone();F.rotate60About(Y),r.rotate60About(Y),R.rotate60About(Y);const d=new Rt(this.max[F.y],F.y),E=new Rt(this.max[F.y-1],F.y-1),U=new Rt(this.max[F.y-1]-1,F.y-1);F.x===d.x&&F.y===d.y||(F.x!==E.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([t,E,U]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([t,U,d])):F.y===R.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([t,b,E]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([t,E,x])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([t,b,E]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([t,E,d])))}}mapABOBtoOBOA(){const t=new Rt(0,0);for(let b=0;b<this.isoVecsABOB.length;b++){const Y=[];for(let o=0;o<3;o++)t.x=this.isoVecsABOB[b][o].x,t.y=this.isoVecsABOB[b][o].y,0===this.vertexTypes[b][o]&&t.rotateNeg120(this.m,this.n),Y.push(t.clone());this.isoVecsOBOA.push(Y)}}mapABOBtoBAOA(){const t=new Rt(0,0);for(let b=0;b<this.isoVecsABOB.length;b++){const Y=[];for(let o=0;o<3;o++)t.x=this.isoVecsABOB[b][o].x,t.y=this.isoVecsABOB[b][o].y,1===this.vertexTypes[b][o]&&t.rotate120(this.m,this.n),Y.push(t.clone());this.isoVecsBAOA.push(Y)}}MapToFace(t,b){const Y=this.IDATA.face[t],x=Y[2],F=Y[1],r=Y[0],R=o.l.ce(this.IDATA.vertex[x]),d=o.l.ce(this.IDATA.vertex[F]),E=o.l.ce(this.IDATA.vertex[r]),U=d.fd(R),C=E.fd(R),p=U.scale(this.coau).add(C.scale(this.cobu)),W=U.scale(this.coav).add(C.scale(this.cobv)),T=[];let y,v=o.f.ae[0];for(let o=0;o<this.cartesian.length;o++)v=p.scale(this.cartesian[o].x).add(W.scale(this.cartesian[o].y)).add(R),T[o]=[v.x,v.y,v.z],y=t+"|"+this.vertices[o].x+"|"+this.vertices[o].y,b.vertex[this.vecToidx[y]]=[v.x,v.y,v.z]}build(t,b){const Y=[],o=Rt.Zero(),x=new Rt(t,b),F=new Rt(-b,t+b);Y.push(o,x,F);for(let K=b;K<t+1;K++)for(let b=0;b<t+1-K;b++)Y.push(new Rt(b,K));if(b>0){const o=(0,O.i)(t,b),x=t/o,F=b/o;for(let R=1;R<o;R++)Y.push(new Rt(R*x,R*F)),Y.push(new Rt(-R*F,R*(x+F))),Y.push(new Rt(t-R*(x+F),b+R*x));const r=t/b;for(let R=1;R<b;R++)for(let o=0;o<R*r;o++)Y.push(new Rt(o,R)),Y.push(new Rt(o,R).rotate120(t,b)),Y.push(new Rt(o,R).rotateNeg120(t,b))}Y.sort(((t,b)=>t.x-b.x)),Y.sort(((t,b)=>t.y-b.y));const r=new Array(t+b+1),R=new Array(t+b+1);for(let K=0;K<r.length;K++)r[K]=1/0,R[K]=-1/0;let d=0,E=0;const U=Y.length;for(let K=0;K<U;K++)E=Y[K].x,d=Y[K].y,r[d]=Math.min(E,r[d]),R[d]=Math.max(E,R[d]);const C=(Y,o)=>{const x=Y.clone();return"A"===o&&x.rotateNeg120(t,b),"B"===o&&x.rotate120(t,b),x.x<0?x.y:x.x+x.y},p=[],W=[],T=[],y=[],v={},B=[];let J=-1,m=-1;for(let K=0;K<U;K++)p[K]=Y[K].toCartesianOrigin(new Rt(0,0),.5),W[K]=C(Y[K],"O"),T[K]=C(Y[K],"A"),y[K]=C(Y[K],"B"),W[K]===T[K]&&T[K]===y[K]?(J=3,m=W[K]):W[K]===T[K]?(J=4,m=W[K]):T[K]===y[K]?(J=5,m=T[K]):y[K]===W[K]&&(J=6,m=W[K]),W[K]<T[K]&&W[K]<y[K]&&(J=2,m=W[K]),T[K]<W[K]&&T[K]<y[K]&&(J=1,m=T[K]),y[K]<T[K]&&y[K]<W[K]&&(J=0,m=y[K]),B.push([J,m,Y[K].x,Y[K].y]);B.sort(((t,b)=>t[2]-b[2])),B.sort(((t,b)=>t[3]-b[3])),B.sort(((t,b)=>t[1]-b[1])),B.sort(((t,b)=>t[0]-b[0]));for(let K=0;K<B.length;K++)v[B[K][2]+"|"+B[K][3]]=[B[K][0],B[K][1],K];return this.m=t,this.n=b,this.vertices=Y,this.vertByDist=v,this.cartesian=p,this.min=r,this.max=R,this}}class Et{constructor(t,b,Y,o){this.name=t,this.category=b,this.vertex=Y,this.face=o}}class Ut extends Et{innerToData(t,b){for(let Y=0;Y<b.innerFacets.length;Y++)this.face.push(b.innerFacets[Y].map((Y=>b.vecToidx[t+Y])))}mapABOBtoDATA(t,b){const Y=b.IDATA.edgematch[t][0];for(let o=0;o<b.isoVecsABOB.length;o++){const x=[];for(let F=0;F<3;F++)0===b.vertexTypes[o][F]?x.push(t+"|"+b.isoVecsABOB[o][F].x+"|"+b.isoVecsABOB[o][F].y):x.push(Y+"|"+b.isoVecsABOB[o][F].x+"|"+b.isoVecsABOB[o][F].y);this.face.push([b.vecToidx[x[0]],b.vecToidx[x[1]],b.vecToidx[x[2]]])}}mapOBOAtoDATA(t,b){const Y=b.IDATA.edgematch[t][0];for(let o=0;o<b.isoVecsOBOA.length;o++){const x=[];for(let F=0;F<3;F++)1===b.vertexTypes[o][F]?x.push(t+"|"+b.isoVecsOBOA[o][F].x+"|"+b.isoVecsOBOA[o][F].y):x.push(Y+"|"+b.isoVecsOBOA[o][F].x+"|"+b.isoVecsOBOA[o][F].y);this.face.push([b.vecToidx[x[0]],b.vecToidx[x[1]],b.vecToidx[x[2]]])}}mapBAOAtoDATA(t,b){const Y=b.IDATA.edgematch[t][2];for(let o=0;o<b.isoVecsBAOA.length;o++){const x=[];for(let F=0;F<3;F++)1===b.vertexTypes[o][F]?x.push(t+"|"+b.isoVecsBAOA[o][F].x+"|"+b.isoVecsBAOA[o][F].y):x.push(Y+"|"+b.isoVecsBAOA[o][F].x+"|"+b.isoVecsBAOA[o][F].y);this.face.push([b.vecToidx[x[0]],b.vecToidx[x[1]],b.vecToidx[x[2]]])}}orderData(t){const b=[];for(let F=0;F<13;F++)b[F]=[];const Y=t.closestTo;for(let F=0;F<Y.length;F++)Y[F][0]>-1?Y[F][1]>0&&b[Y[F][0]].push([F,Y[F][1]]):b[12].push([F,Y[F][0]]);const o=[];for(let F=0;F<12;F++)o[F]=F;let x=12;for(let F=0;F<12;F++){b[F].sort(((t,b)=>t[1]-b[1]));for(let t=0;t<b[F].length;t++)o[b[F][t][0]]=x++}for(let F=0;F<b[12].length;F++)o[b[12][F][0]]=x++;for(let F=0;F<this.vertex.length;F++)this.vertex[F].push(o[F]);this.vertex.sort(((t,b)=>t[3]-b[3]));for(let F=0;F<this.vertex.length;F++)this.vertex[F].pop();for(let F=0;F<this.face.length;F++)for(let t=0;t<this.face[F].length;t++)this.face[F][t]=o[this.face[F][t]];this.sharedNodes=b[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(t,b){const Y=[],o=[];let x=b.pop();o.push(x);let F=this.face[x].indexOf(t);F=(F+2)%3;let r=this.face[x][F];Y.push(r);let R=0;for(;b.length>0;)x=b[R],this.face[x].indexOf(r)>-1?(F=(this.face[x].indexOf(r)+1)%3,r=this.face[x][F],Y.push(r),o.push(x),b.splice(R,1),R=0):R++;return this.adjacentFaces.push(Y),o}toGoldbergPolyhedronData(){const t=new Et("GeoDual","Goldberg",[],[]);t.name="GD dual";const b=this.vertex.length,Y=new Array(b);for(let d=0;d<b;d++)Y[d]=[];for(let d=0;d<this.face.length;d++)for(let t=0;t<3;t++)Y[this.face[d][t]].push(d);let o=0,x=0,F=0,r=[],R=[];this.adjacentFaces=[];for(let d=0;d<Y.length;d++)t.face[d]=this.setOrder(d,Y[d].concat([])),Y[d].forEach((b=>{o=0,x=0,F=0,r=this.face[b];for(let t=0;t<3;t++)R=this.vertex[r[t]],o+=R[0],x+=R[1],F+=R[2];t.vertex[b]=[o/3,x/3,F/3]}));return t}static BuildGeodesicData(t){const b=new Ut("Geodesic-m-n","Geodesic",[[0,n.i,-1],[-n.i,1,0],[-1,0,-n.i],[1,0,-n.i],[n.i,1,0],[0,n.i,1],[-1,0,n.i],[-n.i,-1,0],[0,-n.i,-1],[n.i,-1,0],[1,0,n.i],[0,-n.i,1]],[]);t.setIndices(),t.calcCoeffs(),t.createInnerFacets(),t.edgeVecsABOB(),t.mapABOBtoOBOA(),t.mapABOBtoBAOA();for(let Y=0;Y<t.IDATA.face.length;Y++)t.MapToFace(Y,b),b.innerToData(Y,t),"B"===t.IDATA.edgematch[Y][1]&&b.mapABOBtoDATA(Y,t),"O"===t.IDATA.edgematch[Y][1]&&b.mapOBOAtoDATA(Y,t),"A"===t.IDATA.edgematch[Y][3]&&b.mapBAOAtoDATA(Y,t);b.orderData(t);return b.vertex=b.vertex.map((function(t){const b=t[0],Y=t[1],o=t[2],x=Math.sqrt(b*b+Y*Y+o*o);return t[0]*=1/x,t[1]*=1/x,t[2]*=1/x,t})),b}}x.d._GoldbergMeshParser=(t,b)=>Ct.Parse(t,b);class Ct extends x.d{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(t,b){return void 0===b?(t>this.goldbergData.nbUnsharedFaces-1&&(H.b.Warn("Maximum number of unshared faces used"),t=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+t):(t>11&&(H.b.Warn("Last pole used"),t=11),b>this.goldbergData.nbFacesAtPole-1&&(H.b.Warn("Maximum number of faces at a pole used"),b=this.goldbergData.nbFacesAtPole-1),12+t*this.goldbergData.nbFacesAtPole+b)}_changeGoldbergFaceColors(t){for(let Y=0;Y<t.length;Y++){const b=t[Y][0],o=t[Y][1],x=t[Y][2];for(let t=b;t<o+1;t++)this.goldbergData.faceColors[t]=x}const b=[];for(let Y=0;Y<12;Y++)for(let t=0;t<5;t++)b.push(this.goldbergData.faceColors[Y].r,this.goldbergData.faceColors[Y].g,this.goldbergData.faceColors[Y].b,this.goldbergData.faceColors[Y].a);for(let Y=12;Y<this.goldbergData.faceColors.length;Y++)for(let t=0;t<6;t++)b.push(this.goldbergData.faceColors[Y].r,this.goldbergData.faceColors[Y].g,this.goldbergData.faceColors[Y].b,this.goldbergData.faceColors[Y].a);return b}setGoldbergFaceColors(t){const b=this._changeGoldbergFaceColors(t);this.Ga(F.e.ColorKind,b)}updateGoldbergFaceColors(t){const b=this._changeGoldbergFaceColors(t);this.updateVerticesData(F.e.ColorKind,b)}_changeGoldbergFaceUVs(t){const b=this.getVerticesData(F.e.UVKind);for(let Y=0;Y<t.length;Y++){const o=t[Y][0],x=t[Y][1],F=t[Y][2],r=t[Y][3],R=t[Y][4],d=[],E=[];let U,C;for(let t=0;t<5;t++)U=F.x+r*Math.cos(R+t*Math.PI/2.5),C=F.y+r*Math.sin(R+t*Math.PI/2.5),U<0&&(U=0),U>1&&(U=1),d.push(U,C);for(let t=0;t<6;t++)U=F.x+r*Math.cos(R+t*Math.PI/3),C=F.y+r*Math.sin(R+t*Math.PI/3),U<0&&(U=0),U>1&&(U=1),E.push(U,C);for(let t=o;t<Math.min(12,x+1);t++)for(let Y=0;Y<5;Y++)b[10*t+2*Y]=d[2*Y],b[10*t+2*Y+1]=d[2*Y+1];for(let t=Math.max(12,o);t<x+1;t++)for(let Y=0;Y<6;Y++)b[12*t-24+2*Y]=E[2*Y],b[12*t-23+2*Y]=E[2*Y+1]}return b}setGoldbergFaceUVs(t){const b=this._changeGoldbergFaceUVs(t);this.Ga(F.e.UVKind,b)}updateGoldbergFaceUVs(t){const b=this._changeGoldbergFaceUVs(t);this.updateVerticesData(F.e.UVKind,b)}placeOnGoldbergFaceAt(t,b,Y){const x=o.l.RotationFromAxis(this.goldbergData.faceXaxis[b],this.goldbergData.faceYaxis[b],this.goldbergData.faceZaxis[b]);t.rotation=x,t.position=this.goldbergData.faceCenters[b].add(this.goldbergData.faceXaxis[b].scale(Y.x)).add(this.goldbergData.faceYaxis[b].scale(Y.y)).add(this.goldbergData.faceZaxis[b].scale(Y.z))}serialize(t){super.serialize(t),t.type="GoldbergMesh";const b={};if(b.adjacentFaces=this.goldbergData.adjacentFaces,b.nbSharedFaces=this.goldbergData.nbSharedFaces,b.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,b.nbFaces=this.goldbergData.nbFaces,b.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){b.faceColors=[];for(const t of this.goldbergData.faceColors)b.faceColors.push(t.qe())}if(this.goldbergData.faceCenters){b.faceCenters=[];for(const t of this.goldbergData.faceCenters)b.faceCenters.push(t.qe())}if(this.goldbergData.faceZaxis){b.faceZaxis=[];for(const t of this.goldbergData.faceZaxis)b.faceZaxis.push(t.qe())}if(this.goldbergData.faceYaxis){b.faceYaxis=[];for(const t of this.goldbergData.faceYaxis)b.faceYaxis.push(t.qe())}if(this.goldbergData.faceXaxis){b.faceXaxis=[];for(const t of this.goldbergData.faceXaxis)b.faceXaxis.push(t.qe())}t.goldbergData=b}static Parse(t,b){const Y=t.goldbergData;Y.faceColors=Y.faceColors.map((t=>p.h.ce(t))),Y.faceCenters=Y.faceCenters.map((t=>o.l.ce(t))),Y.faceZaxis=Y.faceZaxis.map((t=>o.l.ce(t))),Y.faceXaxis=Y.faceXaxis.map((t=>o.l.ce(t))),Y.faceYaxis=Y.faceYaxis.map((t=>o.l.ce(t)));const x=new Ct(t.name,b);return x.goldbergData=Y,x}}var pt=Y(11790);class Wt{constructor(t){this._paths=[],this._tempPaths=[],this._holes=[],this._resolution=t}moveTo(t,b){this._currentPath=new f.g(t,b),this._tempPaths.push(this._currentPath)}lineTo(t,b){this._currentPath.addLineTo(t,b)}quadraticCurveTo(t,b,Y,o){this._currentPath.addQuadraticCurveTo(t,b,Y,o,this._resolution)}bezierCurveTo(t,b,Y,o,x,F){this._currentPath.addBezierCurveTo(t,b,Y,o,x,F,this._resolution)}extractHoles(){for(const t of this._tempPaths)t.area()>0?this._holes.push(t):this._paths.push(t);if(!this._paths.length&&this._holes.length){const t=this._holes;this._holes=this._paths,this._paths=t}this._tempPaths.length=0}get paths(){return this._paths}get holes(){return this._holes}}function Tt(t,b,Y,o,x,F){const r=F.glyphs[t]||F.glyphs["?"];if(!r)return null;const R=new Wt(x);if(r.o){const t=r.o.split(" ");for(let x=0,F=t.length;x<F;){switch(t[x++]){case"m":{const F=parseInt(t[x++])*b+Y,r=parseInt(t[x++])*b+o;R.moveTo(F,r);break}case"l":{const F=parseInt(t[x++])*b+Y,r=parseInt(t[x++])*b+o;R.lineTo(F,r);break}case"q":{const F=parseInt(t[x++])*b+Y,r=parseInt(t[x++])*b+o,d=parseInt(t[x++])*b+Y,E=parseInt(t[x++])*b+o;R.quadraticCurveTo(d,E,F,r);break}case"b":{const F=parseInt(t[x++])*b+Y,r=parseInt(t[x++])*b+o,d=parseInt(t[x++])*b+Y,E=parseInt(t[x++])*b+o,U=parseInt(t[x++])*b+Y,C=parseInt(t[x++])*b+o;R.bezierCurveTo(d,E,U,C,F,r);break}}}}return R.extractHoles(),{offsetX:r.ha*b,shapePath:R}}const yt={CreateBox:C.d,CreateTiledBox:v,CreateSphere:B.e,kb:U.c,CreateIcoSphere:q,CreateRibbon:E,CreateCylinder:L,CreateTorus:S,CreateTorusKnot:g,CreateLineSystem:D.e,lb:D.h,CreateDashedLines:D.d,ExtrudeShape:M,ExtrudeShapeCustom:w,CreateLathe:I,CreateTiledPlane:T,Dg:s.d,CreateGround:l.f,CreateTiledGround:l.g,CreateGroundFromHeightMap:l.c,CreatePolygon:a,ExtrudePolygon:A,CreateTube:i,CreatePolyhedron:P,CreateGeodesic:function(t,b){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=b.m||1;o!==Math.floor(o)&&(o=Math.floor(o),H.b.Warn("m not an integer only floor(m) used"));let x=b.n||0;if(x!==Math.floor(x)&&(x=Math.floor(x),H.b.Warn("n not an integer only floor(n) used")),x>o){const t=x;x=o,o=t,H.b.Warn("n > m therefore m and n swapped")}const F=new dt;return F.build(o,x),P(t,{custom:Ut.BuildGeodesicData(F),size:b.size,sizeX:b.sizeX,sizeY:b.sizeY,sizeZ:b.sizeZ,faceUV:b.faceUV,faceColors:b.faceColors,flat:b.flat,updatable:b.updatable,sideOrientation:b.sideOrientation,frontUVs:b.frontUVs,backUVs:b.backUVs},Y)},CreateGoldberg:function(t,b){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const F=b.size,d=b.sizeX||F||1,E=b.sizeY||F||1,U=b.sizeZ||F||1;let C=b.m||1;C!==Math.floor(C)&&(C=Math.floor(C),H.b.Warn("m not an integer only floor(m) used"));let W=b.n||0;if(W!==Math.floor(W)&&(W=Math.floor(W),H.b.Warn("n not an integer only floor(n) used")),W>C){const t=W;W=C,C=t,H.b.Warn("n > m therefore m and n swapped")}const T=new dt;T.build(C,W);const y=Ut.BuildGeodesicData(T),v=y.toGoldbergPolyhedronData(),B=new Ct(t,Y);b.sideOrientation=x.d._GetDefaultSideOrientation(b.sideOrientation),B._originalBuilderSideOrientation=b.sideOrientation;(function(t,b){const Y=t.size,x=t.sizeX||Y||1,F=t.sizeY||Y||1,d=t.sizeZ||Y||1,E=0===t.sideOrientation?0:t.sideOrientation||r.c.DEFAULTSIDE,U=[],C=[],p=[],W=[];let T=1/0,y=-1/0,v=1/0,B=-1/0;for(let o=0;o<b.vertex.length;o++)T=Math.min(T,b.vertex[o][0]*x),y=Math.max(y,b.vertex[o][0]*x),v=Math.min(v,b.vertex[o][1]*F),B=Math.max(B,b.vertex[o][1]*F);let J=0;for(let r=0;r<b.face.length;r++){const t=b.face[r],Y=o.l.ce(b.vertex[t[0]]),E=o.l.ce(b.vertex[t[2]]),m=o.l.ce(b.vertex[t[1]]),K=E.fd(Y),L=m.fd(Y),z=o.l.Cross(L,K).normalize();for(let o=0;o<t.length;o++){p.push(z.x,z.y,z.z);const Y=b.vertex[t[o]];U.push(Y[0]*x,Y[1]*F,Y[2]*d);const r=(Y[1]*F-v)/(B-v);W.push((Y[0]*x-T)/(y-T),R.c?1-r:r)}for(let b=0;b<t.length-2;b++)C.push(J,J+b+2,J+b+1);J+=t.length}r.c._ComputeSides(E,U,C,p,W);const m=new r.c;return m.xa=U,m.indices=C,m.ya=p,m.Aa=W,m})(b,v).Ca(B,b.updatable),B.goldbergData.nbSharedFaces=y.sharedNodes,B.goldbergData.nbUnsharedFaces=y.poleNodes,B.goldbergData.adjacentFaces=y.adjacentFaces,B.goldbergData.nbFaces=B.goldbergData.nbSharedFaces+B.goldbergData.nbUnsharedFaces,B.goldbergData.nbFacesAtPole=(B.goldbergData.nbUnsharedFaces-12)/12;for(let x=0;x<y.vertex.length;x++)B.goldbergData.faceCenters.push(o.l.ce(y.vertex[x])),B.goldbergData.faceCenters[x].x*=d,B.goldbergData.faceCenters[x].y*=E,B.goldbergData.faceCenters[x].z*=U,B.goldbergData.faceColors.push(new p.h(1,1,1,1));for(let x=0;x<v.face.length;x++){const t=v.face[x],b=o.l.ce(v.vertex[t[0]]),Y=o.l.ce(v.vertex[t[2]]),F=o.l.ce(v.vertex[t[1]]),r=Y.fd(b),R=F.fd(b),d=o.l.Cross(R,r).normalize(),E=o.l.Cross(R,d).normalize();B.goldbergData.faceXaxis.push(R.normalize()),B.goldbergData.faceYaxis.push(d),B.goldbergData.faceZaxis.push(E)}return B},CreateDecal:xt,CreateCapsule:rt,CreateText:function(t,b,Y){let F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{size:50,resolution:8,depth:1},r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,R=arguments.length>5&&void 0!==arguments[5]?arguments[5]:earcut;const d=function(t,b,Y,o){const x=Array.from(t),F=b/o.resolution,r=(o.boundingBox.yMax-o.boundingBox.yMin+o.underlineThickness)*F,R=[];let d=0,E=0;for(let U=0;U<x.length;U++){const t=x[U];if("\n"===t)d=0,E-=r;else{const b=Tt(t,F,d,E,Y,o);b&&(d+=b.offsetX,R.push(b.shapePath))}}return R}(b,F.size||50,F.resolution||8,Y),E=[];let U=0;for(const T of d){if(!T.paths.length)continue;const b=T.holes.slice();for(const Y of T.paths){var C,p;const d=[],W=[],T=Y.getPoints();for(const t of T)W.push(new o.l(t.x,0,t.y));const y=b.slice();for(const t of y){const x=t.getPoints();let F=!1;for(const t of x)if(Y.isPointInside(t)){F=!0;break}if(!F)continue;const r=[];for(const t of x)r.push(new o.l(t.x,0,t.y));d.push(r),b.splice(b.indexOf(t),1)}if(!d.length&&b.length)for(const t of b){const b=t.getPoints(),Y=[];for(const t of b)Y.push(new o.l(t.x,0,t.y));d.push(Y)}const v=A(t,{shape:W,holes:d.length?d:void 0,depth:F.depth||1,faceUV:F.faceUV||(null===(C=F.perLetterFaceUV)||void 0===C?void 0:C.call(F,U)),faceColors:F.faceColors||(null===(p=F.perLetterFaceColors)||void 0===p?void 0:p.call(F,U)),sideOrientation:x.d._GetDefaultSideOrientation(F.sideOrientation||x.d.DOUBLESIDE)},r,R);E.push(v),U++}}const W=x.d.MergeMeshes(E,!0,!0);if(W){const b=W.getBoundingInfo().boundingBox;W.position.x+=-(b.minimumWorld.x+b.maximumWorld.x)/2,W.position.y+=-(b.minimumWorld.y+b.maximumWorld.y)/2,W.position.z+=-(b.minimumWorld.z+b.maximumWorld.z)/2+b.extendSize.z,W.name=t;const Y=new pt.d("pivot",r);Y.rotation.x=-Math.PI/2,W.parent=Y,W.bakeCurrentTransformIntoVertices(),W.parent=null,Y.dispose()}return W}}},12384:(t,b,Y)=>{"use strict";var o=Y(11737),x=Y(1307),F=Y(1019),r=Y(1144),R=Y(1415);o.d.prototype.thinInstanceAdd=function(t){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.va().getEngine().getCaps().instancedArrays)return r.b.Error("Thin Instances are not supported on this device as Instanced Array extension not supported"),-1;this._thinInstanceUpdateBufferSize("matrix",Array.isArray(t)?t.length:1);const Y=this._thinInstanceDataStorage.instancesCount;if(Array.isArray(t))for(let o=0;o<t.length;++o)this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,t[o],o===t.length-1&&b);else this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,t,b);return Y},o.d.prototype.thinInstanceAddSelf=function(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.thinInstanceAdd(F.c.IdentityReadOnly,t)},o.d.prototype.thinInstanceRegisterAttribute=function(t,b){t===x.e.ColorKind&&(t=x.e.ColorInstanceKind),this.removeVerticesData(t),this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.strides[t]=b,this._userThinInstanceBuffersStorage.sizes[t]=b*Math.max(32,this._thinInstanceDataStorage.instancesCount),this._userThinInstanceBuffersStorage.data[t]=new Float32Array(this._userThinInstanceBuffersStorage.sizes[t]),this._userThinInstanceBuffersStorage.vertexBuffers[t]=new x.e(this.getEngine(),this._userThinInstanceBuffersStorage.data[t],t,!0,!1,b,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[t])},o.d.prototype.thinInstanceSetMatrixAt=function(t,b){let Y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!this._thinInstanceDataStorage.matrixData||t>=this._thinInstanceDataStorage.instancesCount)return!1;const o=this._thinInstanceDataStorage.matrixData;return b.copyToArray(o,16*t),this._thinInstanceDataStorage.worldMatrices&&(this._thinInstanceDataStorage.worldMatrices[t]=b),Y&&(this.Lj("matrix"),this.Da||this.thinInstanceRefreshBoundingInfo(!1)),!0},o.d.prototype.thinInstanceSetAttributeAt=function(t,b,Y){let o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return t===x.e.ColorKind&&(t=x.e.ColorInstanceKind),!(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.data[t]||b>=this._thinInstanceDataStorage.instancesCount)&&(this._thinInstanceUpdateBufferSize(t,0),this._userThinInstanceBuffersStorage.data[t].set(Y,b*this._userThinInstanceBuffersStorage.strides[t]),o&&this.Lj(t),!0)},Object.defineProperty(o.d.prototype,"Ij",{get:function(){return this._thinInstanceDataStorage.instancesCount},set:function(t){var b;const Y=this._thinInstanceDataStorage.matrixData??(null===(b=this.source)||void 0===b?void 0:b._thinInstanceDataStorage.matrixData);t<=(Y?Y.length/16:0)&&(this._thinInstanceDataStorage.instancesCount=t)},enumerable:!0,configurable:!0}),o.d.prototype._thinInstanceCreateMatrixBuffer=function(t,b){let Y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const o=new x.d(this.getEngine(),b,!Y,16,!1,!0);for(let x=0;x<4;x++)this.setVerticesBuffer(o.createVertexBuffer(t+x,4*x,4));return o},o.d.prototype.Mj=function(t,b){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];var F;if(Y=Y||16,"matrix"===t)null===(F=this._thinInstanceDataStorage.matrixBuffer)||void 0===F||F.dispose(),this._thinInstanceDataStorage.matrixBuffer=null,this._thinInstanceDataStorage.matrixBufferSize=b?b.length:32*Y,this._thinInstanceDataStorage.matrixData=b,this._thinInstanceDataStorage.worldMatrices=null,null!==b?(this._thinInstanceDataStorage.instancesCount=b.length/Y,this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",b,o),this.Da||this.thinInstanceRefreshBoundingInfo(!1)):(this._thinInstanceDataStorage.instancesCount=0,this.Da||this.refreshBoundingInfo());else if("previousMatrix"===t){var r;null===(r=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===r||r.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=null,this._thinInstanceDataStorage.previousMatrixData=b,null!==b&&(this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",b,o))}else{var R;if(t===x.e.ColorKind&&(t=x.e.ColorInstanceKind),null===b)null!==(R=this._userThinInstanceBuffersStorage)&&void 0!==R&&R.data[t]&&(this.removeVerticesData(t),delete this._userThinInstanceBuffersStorage.data[t],delete this._userThinInstanceBuffersStorage.strides[t],delete this._userThinInstanceBuffersStorage.sizes[t],delete this._userThinInstanceBuffersStorage.vertexBuffers[t]);else this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.data[t]=b,this._userThinInstanceBuffersStorage.strides[t]=Y,this._userThinInstanceBuffersStorage.sizes[t]=b.length,this._userThinInstanceBuffersStorage.vertexBuffers[t]=new x.e(this.getEngine(),b,t,!o,!1,Y,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[t])}},o.d.prototype.Lj=function(t){var b;if("matrix"===t)this.Hj&&this._thinInstanceDataStorage.matrixBuffer&&!this._thinInstanceDataStorage.matrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(t),null===(b=this._thinInstanceDataStorage.matrixBuffer)||void 0===b||b.updateDirectly(this._thinInstanceDataStorage.matrixData,0,this._thinInstanceDataStorage.instancesCount);else if("previousMatrix"===t){var Y;this.Hj&&this._thinInstanceDataStorage.previousMatrixBuffer&&!this._thinInstanceDataStorage.previousMatrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(t),null===(Y=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===Y||Y.updateDirectly(this._thinInstanceDataStorage.previousMatrixData,0,this._thinInstanceDataStorage.instancesCount)}else{var o;t===x.e.ColorKind&&(t=x.e.ColorInstanceKind),null!==(o=this._userThinInstanceBuffersStorage)&&void 0!==o&&o.vertexBuffers[t]&&(this.Hj&&!this._userThinInstanceBuffersStorage.vertexBuffers[t].isUpdatable()&&this._thinInstanceRecreateBuffer(t),this._userThinInstanceBuffersStorage.vertexBuffers[t].updateDirectly(this._userThinInstanceBuffersStorage.data[t],0))}},o.d.prototype.thinInstancePartialBufferUpdate=function(t,b,Y){var o;"matrix"===t?this._thinInstanceDataStorage.matrixBuffer&&this._thinInstanceDataStorage.matrixBuffer.updateDirectly(b,Y):(t===x.e.ColorKind&&(t=x.e.ColorInstanceKind),null!==(o=this._userThinInstanceBuffersStorage)&&void 0!==o&&o.vertexBuffers[t]&&this._userThinInstanceBuffersStorage.vertexBuffers[t].updateDirectly(b,Y))},o.d.prototype.thinInstanceGetWorldMatrices=function(){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return[];const t=this._thinInstanceDataStorage.matrixData;if(!this._thinInstanceDataStorage.worldMatrices){this._thinInstanceDataStorage.worldMatrices=[];for(let b=0;b<this._thinInstanceDataStorage.instancesCount;++b)this._thinInstanceDataStorage.worldMatrices[b]=F.c.ce(t,16*b)}return this._thinInstanceDataStorage.worldMatrices},o.d.prototype.thinInstanceRefreshBoundingInfo=function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return;const o=this._thinInstanceDataStorage.boundingVectors;if(t||!this.rawBoundingInfo){o.length=0,this.refreshBoundingInfo(b,Y);const t=this.getBoundingInfo();this.rawBoundingInfo=new R.b(t.minimum,t.maximum)}const x=this.getBoundingInfo(),r=this._thinInstanceDataStorage.matrixData;if(0===o.length)for(let F=0;F<x.boundingBox.vectors.length;++F)o.push(x.boundingBox.vectors[F].clone());F.f.ae[0].ee(Number.POSITIVE_INFINITY),F.f.ae[1].ee(Number.NEGATIVE_INFINITY);for(let R=0;R<this._thinInstanceDataStorage.instancesCount;++R){F.c.FromArrayToRef(r,16*R,F.f.Matrix[0]);for(let t=0;t<o.length;++t)F.l.TransformCoordinatesToRef(o[t],F.f.Matrix[0],F.f.ae[2]),F.f.ae[0].minimizeInPlace(F.f.ae[2]),F.f.ae[1].maximizeInPlace(F.f.ae[2])}x.reConstruct(F.f.ae[0],F.f.ae[1]),this.Ea()},o.d.prototype._thinInstanceRecreateBuffer=function(t){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var Y;if("matrix"===t)null===(Y=this._thinInstanceDataStorage.matrixBuffer)||void 0===Y||Y.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",this._thinInstanceDataStorage.matrixData,b);else if("previousMatrix"===t){var o;if(this._scene.needsPreviousWorldMatrices)null===(o=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===o||o.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.previousMatrixData??this._thinInstanceDataStorage.matrixData,b)}else{var F;t===x.e.ColorKind&&(t=x.e.ColorInstanceKind),null===(F=this._userThinInstanceBuffersStorage.vertexBuffers[t])||void 0===F||F.dispose(),this._userThinInstanceBuffersStorage.vertexBuffers[t]=new x.e(this.getEngine(),this._userThinInstanceBuffersStorage.data[t],t,!b,!1,this._userThinInstanceBuffersStorage.strides[t],!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[t])}},o.d.prototype._thinInstanceUpdateBufferSize=function(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;t===x.e.ColorKind&&(t=x.e.ColorInstanceKind);const Y="matrix"===t;if(!Y&&(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.strides[t]))return;const o=Y?16:this._userThinInstanceBuffersStorage.strides[t],F=Y?this._thinInstanceDataStorage.matrixBufferSize:this._userThinInstanceBuffersStorage.sizes[t];let r=Y?this._thinInstanceDataStorage.matrixData:this._userThinInstanceBuffersStorage.data[t];const R=(this._thinInstanceDataStorage.instancesCount+b)*o;let d=F;for(;d<R;)d*=2;if(!r||F!=d){if(r){const t=new Float32Array(d);t.set(r,0),r=t}else r=new Float32Array(d);var E,U,C;if(Y){if(null===(E=this._thinInstanceDataStorage.matrixBuffer)||void 0===E||E.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",r,!1),this._thinInstanceDataStorage.matrixData=r,this._thinInstanceDataStorage.matrixBufferSize=d,this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData)null===(U=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===U||U.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",r,!1)}else null===(C=this._userThinInstanceBuffersStorage.vertexBuffers[t])||void 0===C||C.dispose(),this._userThinInstanceBuffersStorage.data[t]=r,this._userThinInstanceBuffersStorage.sizes[t]=d,this._userThinInstanceBuffersStorage.vertexBuffers[t]=new x.e(this.getEngine(),r,t,!0,!1,o,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[t])}},o.d.prototype._thinInstanceInitializeUserStorage=function(){this._userThinInstanceBuffersStorage||(this._userThinInstanceBuffersStorage={data:{},sizes:{},vertexBuffers:{},strides:{}})},o.d.prototype._disposeThinInstanceSpecificData=function(){var t;null!==(t=this._thinInstanceDataStorage)&&void 0!==t&&t.matrixBuffer&&(this._thinInstanceDataStorage.matrixBuffer.dispose(),this._thinInstanceDataStorage.matrixBuffer=null)}},11790:(t,b,Y)=>{"use strict";Y.d(b,{d:()=>C});var o=Y(999),x=Y(1001),F=Y(1224),r=Y(1013),R=Y(1019),d=Y(11759),E=Y(1041);const U=R.c.Compose(R.l.One(),R.e.FromEulerAngles(0,Math.PI,0),R.l.Zero());class C extends d.c{get billboardMode(){return this._billboardMode}set billboardMode(t){this._billboardMode!==t&&(this._billboardMode=t,this._cache.useBillboardPosition=0!==(this._billboardMode&C.BILLBOARDMODE_USE_POSITION),this._computeUseBillboardPath())}get preserveParentRotationForBillboard(){return this._preserveParentRotationForBillboard}set preserveParentRotationForBillboard(t){t!==this._preserveParentRotationForBillboard&&(this._preserveParentRotationForBillboard=t,this._computeUseBillboardPath())}_computeUseBillboardPath(){this._cache.useBillboardPath=this._billboardMode!==C.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}get infiniteDistance(){return this._infiniteDistance}set infiniteDistance(t){this._infiniteDistance!==t&&(this._infiniteDistance=t)}constructor(t){let b=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,!1),this._forward=new R.l(0,0,1),this._up=new R.l(0,1,0),this._right=new R.l(1,0,0),this._position=R.l.Zero(),this._rotation=R.l.Zero(),this._rotationQuaternion=null,this._scaling=R.l.One(),this._transformToBoneReferal=null,this._isAbsoluteSynced=!1,this._billboardMode=C.BILLBOARDMODE_NONE,this._preserveParentRotationForBillboard=!1,this.scalingDeterminant=1,this._infiniteDistance=!1,this.ignoreNonUniformScaling=!1,this.reIntegrateRotationIntoRotationQuaternion=!1,this._poseMatrix=null,this.Kj=R.c.Zero(),this._usePivotMatrix=!1,this._absolutePosition=R.l.Zero(),this._absoluteScaling=R.l.Zero(),this._absoluteRotationQuaternion=R.e.Identity(),this._pivotMatrix=R.c.Identity(),this._postMultiplyPivotMatrix=!1,this._isWorldMatrixFrozen=!1,this._indexInSceneTransformNodesArray=-1,this.onAfterWorldMatrixUpdateObservable=new r.e,this._nonUniformScaling=!1,b&&this.va().addTransformNode(this)}getClassName(){return"mb"}get position(){return this._position}set position(t){this._position=t,this._markAsDirtyInternal()}isUsingPivotMatrix(){return this._usePivotMatrix}isUsingPostMultiplyPivotMatrix(){return this._postMultiplyPivotMatrix}get rotation(){return this._rotation}set rotation(t){this._rotation=t,this._rotationQuaternion=null,this._markAsDirtyInternal()}get Oe(){return this._scaling}set Oe(t){this._scaling=t,this._markAsDirtyInternal()}get rotationQuaternion(){return this._rotationQuaternion}set rotationQuaternion(t){this._rotationQuaternion=t,t&&this._rotation.ee(0),this._markAsDirtyInternal()}_markAsDirtyInternal(){this._isDirty||(this._isDirty=!0,this.customMarkAsDirty&&this.customMarkAsDirty())}get forward(){return R.l.TransformNormalFromFloatsToRef(0,0,this.va().useRightHandedSystem?-1:1,this.getWorldMatrix(),this._forward),this._forward.normalize()}get up(){return R.l.TransformNormalFromFloatsToRef(0,1,0,this.getWorldMatrix(),this._up),this._up.normalize()}get right(){return R.l.TransformNormalFromFloatsToRef(this.va().useRightHandedSystem?-1:1,0,0,this.getWorldMatrix(),this._right),this._right.normalize()}updatePoseMatrix(t){return this._poseMatrix?(this._poseMatrix.p(t),this):(this._poseMatrix=t.clone(),this)}getPoseMatrix(){return this._poseMatrix||(this._poseMatrix=R.c.Identity()),this._poseMatrix}_isSynchronized(){const t=this._cache;return this._billboardMode===t.billboardMode&&this._billboardMode===C.BILLBOARDMODE_NONE&&(!t.pivotMatrixUpdated&&(!this._infiniteDistance&&(!this._position._isDirty&&(!this._scaling._isDirty&&!(this._rotationQuaternion&&this._rotationQuaternion._isDirty||this._rotation._isDirty)))))}_initCache(){super._initCache();const t=this._cache;t.localMatrixUpdated=!1,t.billboardMode=-1,t.infiniteDistance=!1,t.useBillboardPosition=!1,t.useBillboardPath=!1}get absolutePosition(){return this.getAbsolutePosition()}get absoluteScaling(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling}get absoluteRotationQuaternion(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion}setPreTransformMatrix(t){return this.setPivotMatrix(t,!1)}setPivotMatrix(t){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._pivotMatrix.p(t),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=b,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=R.c.Invert(this._pivotMatrix)),this}getPivotMatrix(){return this._pivotMatrix}instantiateHierarchy(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,b=arguments.length>1?arguments[1]:void 0,Y=arguments.length>2?arguments[2]:void 0;const o=this.clone("Clone of "+(this.name||this.id),t||this.parent,!0);o&&Y&&Y(this,o);for(const x of this.getChildTransformNodes(!0))x.instantiateHierarchy(o,b,Y);return o}$h(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return t?arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(this._rotation.ee(0),this._rotationQuaternion=this._rotationQuaternion||R.e.Identity(),t.decompose(this._scaling,this._rotationQuaternion,this._position),this.ve(!0)):(this._worldMatrix=t,this._absolutePosition.be(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._afterComputeWorldMatrix()):(this._isWorldMatrixFrozen=!1,this.ve(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this}unfreezeWorldMatrix(){return this._isWorldMatrixFrozen=!1,this.ve(!0),this}get nj(){return this._isWorldMatrixFrozen}getAbsolutePosition(){return this.ve(),this._absolutePosition}setAbsolutePosition(t){if(!t)return this;let b,Y,o;if(void 0===t.x){if(arguments.length<3)return this;b=arguments[0],Y=arguments[1],o=arguments[2]}else b=t.x,Y=t.y,o=t.z;if(this.parent){const t=R.f.Matrix[0];this.parent.getWorldMatrix().invertToRef(t),R.l.TransformCoordinatesFromFloatsToRef(b,Y,o,t,this.position)}else this.position.x=b,this.position.y=Y,this.position.z=o;return this._absolutePosition.p(t),this}setPositionWithLocalVector(t){return this.ve(),this.position=R.l.TransformNormal(t,this.Kj),this}getPositionExpressedInLocalSpace(){this.ve();const t=R.f.Matrix[0];return this.Kj.invertToRef(t),R.l.TransformNormal(this.position,t)}locallyTranslate(t){return this.ve(!0),this.position=R.l.TransformCoordinates(t,this.Kj),this}lookAt(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const F=C._LookAtVectorCache,r=0===x?this.position:this.getAbsolutePosition();if(t.subtractToRef(r,F),this.setDirection(F,b,Y,o),1===x&&this.parent)if(this.rotationQuaternion){const t=R.f.Matrix[0];this.rotationQuaternion.toRotationMatrix(t);const b=R.f.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(b),b.invert(),t.multiplyToRef(b,t),this.rotationQuaternion.fromRotationMatrix(t)}else{const t=R.f.Quaternion[0];R.e.FromEulerVectorToRef(this.rotation,t);const b=R.f.Matrix[0];t.toRotationMatrix(b);const Y=R.f.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(Y),Y.invert(),b.multiplyToRef(Y,b),t.fromRotationMatrix(b),t.toEulerAnglesToRef(this.rotation)}return this}pf(t){const b=R.l.Zero();return this.getDirectionToRef(t,b),b}getDirectionToRef(t,b){return R.l.TransformNormalToRef(t,this.getWorldMatrix(),b),this}setDirection(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const x=-Math.atan2(t.z,t.x)+Math.PI/2,F=Math.sqrt(t.x*t.x+t.z*t.z),r=-Math.atan2(t.y,F);return this.rotationQuaternion?R.e.RotationYawPitchRollToRef(x+b,r+Y,o,this.rotationQuaternion):(this.rotation.x=r+Y,this.rotation.y=x+b,this.rotation.z=o),this}setPivotPoint(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;0==this.va().getRenderId()&&this.ve(!0);const Y=this.getWorldMatrix();if(1==b){const b=R.f.Matrix[0];Y.invertToRef(b),t=R.l.TransformCoordinates(t,b)}return this.setPivotMatrix(R.c.Translation(-t.x,-t.y,-t.z),!0)}getPivotPoint(){const t=R.l.Zero();return this.getPivotPointToRef(t),t}getPivotPointToRef(t){return t.x=-this._pivotMatrix.m[12],t.y=-this._pivotMatrix.m[13],t.z=-this._pivotMatrix.m[14],this}getAbsolutePivotPoint(){const t=R.l.Zero();return this.getAbsolutePivotPointToRef(t),t}getAbsolutePivotPointToRef(t){return this.getPivotPointToRef(t),R.l.TransformCoordinatesToRef(t,this.getWorldMatrix(),t),this}Ae(t){if(this._isDirty)return this;if(this._children)for(const b of this._children)b.Ae(t);return super.Ae(t)}setParent(t){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!t&&!this.parent)return this;const o=R.f.Quaternion[0],x=R.f.ae[0],F=R.f.ae[1],r=R.f.Matrix[1];R.c.IdentityToRef(r);const d=R.f.Matrix[0];this.ve(!0);let E=this.rotationQuaternion;return E||(E=C._TmpRotation,R.e.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,E)),R.c.ComposeToRef(this.Oe,E,this.position,d),this.parent&&d.multiplyToRef(this.parent.ve(!0),d),t&&(t.ve(!0).invertToRef(r),d.multiplyToRef(r,d)),d.decompose(F,o,x,b?this:void 0),this.rotationQuaternion?this.rotationQuaternion.p(o):o.toEulerAnglesToRef(this.rotation),this.Oe.p(F),this.position.p(x),this.parent=t,Y&&this.setPivotMatrix(R.c.Identity()),this}addChild(t){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t.setParent(this,b),this}removeChild(t){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t.setParent(null,b),this}get nonUniformScaling(){return this._nonUniformScaling}_updateNonUniformScalingState(t){return this._nonUniformScaling!==t&&(this._nonUniformScaling=t,!0)}attachToBone(t,b){return this._currentParentWhenAttachingToBone=this.parent,this._transformToBoneReferal=b,this.parent=t,t.getSkeleton().prepare(!0),t.getFinalMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this}detachFromBone(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=t?this._currentParentWhenAttachingToBone:null,this):(t&&(this.parent=this._currentParentWhenAttachingToBone),this)}rotate(t,b,Y){let o;if(t.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.ee(0)),Y&&0!==Y){if(this.parent){const Y=this.parent.getWorldMatrix(),o=R.f.Matrix[0];Y.invertToRef(o),t=R.l.TransformNormal(t,o),Y.determinant()<0&&(b*=-1)}o=R.e.RotationAxisToRef(t,b,C._RotationAxisCache),o.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else o=R.e.RotationAxisToRef(t,b,C._RotationAxisCache),this.rotationQuaternion.multiplyToRef(o,this.rotationQuaternion);return this}rotateAround(t,b,Y){b.normalize(),this.rotationQuaternion||(this.rotationQuaternion=R.e.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.ee(0));const o=R.f.ae[0],x=R.f.ae[1],F=R.f.ae[2],r=R.f.Quaternion[0],d=R.f.Matrix[0],E=R.f.Matrix[1],U=R.f.Matrix[2],C=R.f.Matrix[3];return t.subtractToRef(this.position,o),R.c.TranslationToRef(o.x,o.y,o.z,d),R.c.TranslationToRef(-o.x,-o.y,-o.z,E),R.c.RotationAxisToRef(b,Y,U),E.multiplyToRef(U,C),C.multiplyToRef(d,C),C.decompose(x,r,F),this.position.addInPlace(F),r.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this}translate(t,b,Y){const o=t.scale(b);if(Y&&0!==Y)this.setAbsolutePosition(this.getAbsolutePosition().add(o));else{const t=this.getPositionExpressedInLocalSpace().add(o);this.setPositionWithLocalVector(t)}return this}addRotation(t,b,Y){let o;this.rotationQuaternion?o=this.rotationQuaternion:(o=R.f.Quaternion[1],R.e.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,o));const x=R.f.Quaternion[0];return R.e.RotationYawPitchRollToRef(b,t,Y,x),o.multiplyInPlace(x),this.rotationQuaternion||o.toEulerAnglesToRef(this.rotation),this}_getEffectiveParent(){return this.parent}isWorldMatrixCameraDependent(){return this._infiniteDistance&&!this.parent||this._billboardMode!==C.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}ve(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;const Y=this.va().getRenderId();if(!this._isDirty&&!t&&(this._currentRenderId===Y||this.isSynchronized()))return this._currentRenderId=Y,this._worldMatrix;b=b||this.va().activeCamera,this._updateCache();const o=this._cache;o.pivotMatrixUpdated=!1,o.billboardMode=this.billboardMode,o.infiniteDistance=this.infiniteDistance,o.parent=this._parentNode,this._currentRenderId=Y,this._childUpdateId+=1,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;const x=this._getEffectiveParent(),F=C._TmpScaling;let r,d=this._position;if(this._infiniteDistance&&!this.parent&&b){const t=b.getWorldMatrix(),Y=new R.l(t.m[12],t.m[13],t.m[14]);d=C._TmpTranslation,d.be(this._position.x+Y.x,this._position.y+Y.y,this._position.z+Y.z)}if(F.be(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant),this._rotationQuaternion){if(this._rotationQuaternion._isDirty=!1,r=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion){this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(R.e.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.be(0,0,0))}}else r=C._TmpRotation,R.e.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,r);if(this._usePivotMatrix){const t=R.f.Matrix[1];R.c.ScalingToRef(F.x,F.y,F.z,t);const b=R.f.Matrix[0];r.toRotationMatrix(b),this._pivotMatrix.multiplyToRef(t,R.f.Matrix[4]),R.f.Matrix[4].multiplyToRef(b,this.Kj),this._postMultiplyPivotMatrix&&this.Kj.multiplyToRef(this._pivotMatrixInverse,this.Kj),this.Kj.addTranslationFromFloats(d.x,d.y,d.z)}else R.c.ComposeToRef(F,r,d,this.Kj);if(x&&x.getWorldMatrix){if(t&&x.ve(t),o.useBillboardPath){if(this._transformToBoneReferal){const t=this.parent;t.getSkeleton().prepare(),t.getFinalMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),R.f.Matrix[7])}else R.f.Matrix[7].p(x.getWorldMatrix());const t=R.f.ae[5],b=R.f.ae[6],Y=R.f.Quaternion[0];R.f.Matrix[7].decompose(b,Y,t),R.c.ScalingToRef(b.x,b.y,b.z,R.f.Matrix[7]),R.f.Matrix[7].setTranslation(t),C.BillboardUseParentOrientation&&(this._position.applyRotationQuaternionToRef(Y,t),this.Kj.setTranslation(t)),this.Kj.multiplyToRef(R.f.Matrix[7],this._worldMatrix)}else if(this._transformToBoneReferal){const t=this.parent;t.getSkeleton().prepare(),this.Kj.multiplyToRef(t.getFinalMatrix(),R.f.Matrix[6]),R.f.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)}else this.Kj.multiplyToRef(x.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.p(this.Kj);if(o.useBillboardPath&&b&&this.billboardMode&&!o.useBillboardPosition){const t=R.f.ae[0];if(this._worldMatrix.getTranslationToRef(t),R.f.Matrix[1].p(b.getViewMatrix()),this._scene.useRightHandedSystem&&R.f.Matrix[1].multiplyToRef(U,R.f.Matrix[1]),R.f.Matrix[1].setTranslationFromFloats(0,0,0),R.f.Matrix[1].invertToRef(R.f.Matrix[0]),(this.billboardMode&C.BILLBOARDMODE_ALL)!==C.BILLBOARDMODE_ALL){R.f.Matrix[0].decompose(void 0,R.f.Quaternion[0],void 0);const t=R.f.ae[1];R.f.Quaternion[0].toEulerAnglesToRef(t),(this.billboardMode&C.BILLBOARDMODE_X)!==C.BILLBOARDMODE_X&&(t.x=0),(this.billboardMode&C.BILLBOARDMODE_Y)!==C.BILLBOARDMODE_Y&&(t.y=0),(this.billboardMode&C.BILLBOARDMODE_Z)!==C.BILLBOARDMODE_Z&&(t.z=0),R.c.RotationYawPitchRollToRef(t.y,t.x,t.z,R.f.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(R.f.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(R.f.ae[0])}else if(o.useBillboardPath&&b&&o.useBillboardPosition){const t=R.f.ae[0];this._worldMatrix.getTranslationToRef(t);const Y=b.globalPosition;this._worldMatrix.invertToRef(R.f.Matrix[1]);const o=R.f.ae[1];R.l.TransformCoordinatesToRef(Y,R.f.Matrix[1],o),o.normalize();const x=-Math.atan2(o.z,o.x)+Math.PI/2,F=Math.sqrt(o.x*o.x+o.z*o.z),r=-Math.atan2(o.y,F);if(R.e.RotationYawPitchRollToRef(x,r,0,R.f.Quaternion[0]),(this.billboardMode&C.BILLBOARDMODE_ALL)!==C.BILLBOARDMODE_ALL){const t=R.f.ae[1];R.f.Quaternion[0].toEulerAnglesToRef(t),(this.billboardMode&C.BILLBOARDMODE_X)!==C.BILLBOARDMODE_X&&(t.x=0),(this.billboardMode&C.BILLBOARDMODE_Y)!==C.BILLBOARDMODE_Y&&(t.y=0),(this.billboardMode&C.BILLBOARDMODE_Z)!==C.BILLBOARDMODE_Z&&(t.z=0),R.c.RotationYawPitchRollToRef(t.y,t.x,t.z,R.f.Matrix[0])}else R.c.FromQuaternionToRef(R.f.Quaternion[0],R.f.Matrix[0]);this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(R.f.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(R.f.ae[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):x&&x._nonUniformScaling?this._updateNonUniformScalingState(x._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.be(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=R.c.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix}resetLocalMatrix(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.ve(),t){const t=this.getChildren();for(let b=0;b<t.length;++b){const Y=t[b];if(Y){Y.ve();const t=R.f.Matrix[0];Y.Kj.multiplyToRef(this.Kj,t);const b=R.f.Quaternion[0];t.decompose(Y.Oe,b,Y.position),Y.rotationQuaternion?Y.rotationQuaternion.p(b):b.toEulerAnglesToRef(Y.rotation)}}}this.Oe.be(1,1,1),this.position.be(0,0,0),this.rotation.be(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=R.e.Identity()),this._worldMatrix=R.c.Identity()}_afterComputeWorldMatrix(){}registerAfterWorldMatrixUpdate(t){return this.onAfterWorldMatrixUpdateObservable.add(t),this}unregisterAfterWorldMatrixUpdate(t){return this.onAfterWorldMatrixUpdateObservable.removeCallback(t),this}getPositionInCameraSpace(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return t||(t=this.va().activeCamera),R.l.TransformCoordinates(this.getAbsolutePosition(),t.getViewMatrix())}getDistanceToCamera(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return t||(t=this.va().activeCamera),this.getAbsolutePosition().fd(t.globalPosition).length()}clone(t,b,Y){const o=F.d.Clone((()=>new C(t,this.va())),this);if(o.name=t,o.id=t,b&&(o.parent=b),!Y){const b=this.getDescendants(!0);for(let Y=0;Y<b.length;Y++){const x=b[Y];x.clone&&x.clone(t+"."+x.name,o)}}return o}serialize(t){const b=F.d.Serialize(this,t);return b.type=this.getClassName(),b.uniqueId=this.uniqueId,this.parent&&this.parent._serializeAsParent(b),b.localMatrix=this.getPivotMatrix().qe(),b.isEnabled=this.isEnabled(),F.d.AppendSerializedAnimations(this,b),b.ranges=this.serializeAnimationRanges(),b}static Parse(t,b,Y){const o=F.d.Parse((()=>new C(t.name,b)),t,b,Y);if(t.localMatrix?o.setPreTransformMatrix(R.c.ce(t.localMatrix)):t.pivotMatrix&&o.setPivotMatrix(R.c.ce(t.pivotMatrix)),o.zg(t.isEnabled),o._waitingParsedUniqueId=t.uniqueId,void 0!==t.parentId&&(o._waitingParentId=t.parentId),void 0!==t.parentInstanceIndex&&(o._waitingParentInstanceIndex=t.parentInstanceIndex),t.animations){for(let b=0;b<t.animations.length;b++){const Y=t.animations[b],x=(0,E.b)("BABYLON.Animation");x&&o.animations.push(x.Parse(Y))}d.c.ParseAnimationRanges(o,t,b)}return t.autoAnimate&&b.beginAnimation(o,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,t.autoAnimateSpeed||1),o}getChildTransformNodes(t,b){const Y=[];return this._getDescendants(Y,t,(t=>(!b||b(t))&&t instanceof C)),Y}dispose(t){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.va().stopAnimation(this),this.va().removeTransformNode(this),this._parentContainer){const t=this._parentContainer.transformNodes.indexOf(this);t>-1&&this._parentContainer.transformNodes.splice(t,1),this._parentContainer=null}if(this.onAfterWorldMatrixUpdateObservable.clear(),t){const t=this.getChildTransformNodes(!0);for(const b of t)b.parent=null,b.ve(!0)}super.dispose(t,b)}normalizeToUnitCube(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=arguments.length>2?arguments[2]:void 0,o=null,x=null;b&&(this.rotationQuaternion?(x=this.rotationQuaternion.clone(),this.rotationQuaternion.be(0,0,0,1)):this.rotation&&(o=this.rotation.clone(),this.rotation.be(0,0,0)));const F=this.getHierarchyBoundingVectors(t,Y),r=F.max.fd(F.min),R=Math.max(r.x,r.y,r.z);if(0===R)return this;const d=1/R;return this.Oe.scaleInPlace(d),b&&(this.rotationQuaternion&&x?this.rotationQuaternion.p(x):this.rotation&&o&&this.rotation.p(o)),this}_syncAbsoluteScalingAndRotation(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)}}C.BILLBOARDMODE_NONE=0,C.BILLBOARDMODE_X=1,C.BILLBOARDMODE_Y=2,C.BILLBOARDMODE_Z=4,C.BILLBOARDMODE_ALL=7,C.BILLBOARDMODE_USE_POSITION=128,C.BillboardUseParentOrientation=!1,C._TmpRotation=R.e.Zero(),C._TmpScaling=R.l.Zero(),C._TmpTranslation=R.l.Zero(),C._LookAtVectorCache=new R.l(0,0,0),C._RotationAxisCache=new R.e,(0,o.e)([(0,x.L)("position")],C.prototype,"_position",void 0),(0,o.e)([(0,x.L)("rotation")],C.prototype,"_rotation",void 0),(0,o.e)([(0,x.E)("rotationQuaternion")],C.prototype,"_rotationQuaternion",void 0),(0,o.e)([(0,x.L)("Oe")],C.prototype,"_scaling",void 0),(0,o.e)([(0,x.P)("billboardMode")],C.prototype,"_billboardMode",void 0),(0,o.e)([(0,x.P)()],C.prototype,"scalingDeterminant",void 0),(0,o.e)([(0,x.P)("infiniteDistance")],C.prototype,"_infiniteDistance",void 0),(0,o.e)([(0,x.P)()],C.prototype,"ignoreNonUniformScaling",void 0),(0,o.e)([(0,x.P)()],C.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0)},12340:(t,b,Y)=>{"use strict";Y.d(b,{b:()=>r});var o=Y(990),x=Y(10669);let F=0;const r=t=>{if(!t.environmentBRDFTexture){const b=t.useDelayedTextureLoading;t.useDelayedTextureLoading=!1;const Y=t._blockEntityCollection;t._blockEntityCollection=!1;const r=o.b.CreateFromBase64String("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR42u29yY5tWXIlZnbuiSaTbZFUkZRKrCKhElASQA0EoQABgn6hJvoXzfUP+gP9hWb6Bg00IgRoQJaKqUxmZmTEe8/v0uB2u7Fm2T7HIyIrnz88uPvt3f2a2WrMbOvf/u3PvvzP/sUf/N6//i8vf/lv/3v5H//d//Sb//Uq/5u8yf8hV/m/5Cp/L1f5hVzlG7nKJ7mKyJuIXN/hPwqXI/g++zq6rPI5u8z+WqfLre+zy7PrVv9L8brsMiGvk8XLmM/sdfHXal4e3ad6GXPdyu2ij8u/+uv/5cuf/OSLfdtEfvUr+dnf/d0X//t3H/7bf/hP//N/928h/0Yg/4VA/kogfyGQP5Wr/IFAvhbIlwK5CGQTPP+9z5uPeePJSW+yo2+s/GtN30Rnv1E+f5zxof9R/lSXv/nr//mrr3+i+5dfyX7ZZQP07Tffys//8R/l/9TtX7790T/7r/8G8pdy+/8XAvnnAvkzgfwzgfyxQP5AIL8vkJ8K5KsmMVzu1U7p5PA5AXxOAJ8TwPf7sX/51ZeXfcemqnp9w/W77/S7X/6T/vzf/7383RWCX3/z05/9i3/13/0PX//eX/2FyP8tIv+PiPy9iPy/IvIzEfm5iPxCRH4lIt/c/393//9BRD6KyKf7f488fP74/PH544dJAF9cLl98IZfLBZtuqterXr/7Dt9982v95S9+Lv+gF/3i7Spv/8lf/vnf/vGf/dF/JfKnIvLnIvLvReQ/NEngn0TklyLy6/v/34jIt00iGJOBlxAsdvv54/PH5493SQCXy9t2ueh2ueimKorrFbjq9eNH+fDtb+TXv/ol/vHyhX4Fxfbx7euPf/Lnf/PfiPyeiPyhiPxxkwB+fk8AvxzQgJcIrGTwFsiAEXH4/PH54/PHUgLY7whgu2C7bLqpQgHB2xvePn6SDx8+6G9+84384vKF/IPu8iVU9Y/+7C/+jWxffiHytYj8VER+X0T+oEEBvxqQwCMJeIngo5EI3goIwVMIPn98/vj8ESaAbbtu2ybbvl8u2ybbdtluSECA65u8ffqIDx8+6G++/VZ/efkV/sO261dQXP7wT/7kX8vl8qXIFyLylbySwe/dE0CLAr65B/9vGn0gQwRMMqgmhM/J4fPH548eAezbZd/lsm3YtssNAYiqiogAAkCvb5/k46cP8u2HD/rrb7+R/2/b9Wu9yJe//8d/9Ney6S5yEZFdRL68/38khG/uKOCnAwoYkcCoEXwkEgGDDq7CeQfyOTl8/vhd1QCum26ybZtu2yabbrKpQvXue1yvuF6v+vbpTT5+/CDffviAX1++1V9sO77WXb/66R/+4V/dgkbllQi+aBLBV/dE8LWRALwkYCWCNyMZXElkwLTMeMkga/P4/PH547ccAVwuctkvdxSw6bbdtYDbTfSZBN7e8PHTR/3u4wf55vKd/nL7DX6mu3791U9//5+/gkNFZGuSgZUQvnKowKgLWLTAQgRtEniTuEfwaELw0MJvf3LQzynud+53uG+X6y3gN9kul+2y6XVT1U27JCDAFVc8ksAn/e7jR/nN5YP+avtWfq6Xy9f7Vz/9w1dgRYngiyYhfNkkgzYBWHTg44AEMmqQUYQKOmDaiCIa8TmsfmzB+DnZDQjgcpGLbti2y3bZHjRAdRMVvb/dcYU8kcDbPQlsH/CrbddfbF98+RPZfvLFnAQeieCRDC5DMvju/vmD4JkEvjRQgKULeGggowdHkAHTYxihg89vu88I5UeGAPSOAFTlrgPopiqbKPSmCKreUoAAkCcSePukHz590m8vH+WbD9/JP335k6/+tA86KxFchv8jMvhiogE4JQm8XhfKqOAqx5qRPyeGzx8/cgSwbXcUoLJtim27C4Oi93+4v6VxQwKAvl2v+Hj9pB8+fZJvt4/yzfbF9lPdv/wJnsE2BogmyeCRED40tGFvksIXiSbgiYSRRpDNDZ6BDI6ghM+J4fPHeyKAO+zX7cb9t4tedMMNAQju5V+f1uAtBSiu1zsduMrHy5t8ePsk3376KN98sX/xE5FPAnm7/782o0DiUINXMkCXCB7/P94/e87AWUmARQWVvgMuKej9t1RLBp+Tw+ePgwngsutFFdu26WXbbl+rSvdfbnqAiuA23QcBgCugV1zl7e1NPm5v+LC96XfbJ/1W9y++fgXjA3bDYXV+MuhRwSPwL3JLMFYC+HS/LU8HYrGwIhwyNOF12SvgM4SgztdifP85MXz+KGsA2C6X7aJ6bXSAOwrY5OYIqGy3d5uq4P5GhABXuV6veLvRAf10fZMPb2/y3b7vX7+g+9v98/WOBq7GG7RNAlYy+Dgkhhb+Xxp0sE8IAC4SGAP/TbgVJK/PoJPBnAiwPKxsXfbbnRg+i3s/JAK4Q/4b9NfLtomBAqCickMBjy7BuywAUVyv8na94tMjCVzf9KNcLl/0SeA6oAEYb1i9g+FtSALb/bKL8/+t+wxXFMyswqiHoK4ToIgKqslgpg1qUC0QoYbvJZg/B/q5v4szHmPX7YEAsD0CX25OwEUVm9xag1+agKg+nxQArnKjAtDr9U0+Xd/k4/UqH7bL5YsewrcBBiMJZPRAp6TwQgWfjM9vgRbgUYGL8AvLWH2gqhesCokeUmCSwPsnhs8fP2YNYMO2XeSmAWxy2VQaXeDmDIhApf33rD4PTUCuV+DtCn27XuXT5ir8VmCJ2G5BpBM8/r/dEcJb8/0lEQMtJHA5TAlqNuLRhJChhEpSqFabH3di+G1AGj+W1/dyAR4IYJNNnuLf6+tWC9CHHiAtFhAIFLjK2/Uqn65X+SS67aK+3QeTDoy/IG2ogQ7fb/dAtz5vBgrYGqrwNtCHsVfgIvwK07OTQBURVNCBFpKCOjqCHn5L/67TgTN+fpySAC56nwSUi256kXsSuFGAVyLoUIDo8/Pz7fdoErr/v17lk162HbgHvFpIYDfoAJJfW4sGPjkU4VNAF8ZEcLmLhdc7kljdY1y1Dq9yLiI4IiRqcLujb138KIPn80ejATwRwIbtBvn1cqv+2J78/5EI5N4cJA8qIPcmwRsKAHDF9WYP6mV7VmrgLuTpxYTcMEW0LAmoQxFsuvAI8tv/a/C5fV2ZMMiKg++FCM7RDPRu8ebWY7VG6VJi+Bzk35MI2LsAckMAgwvQ0gC5DQjd3ABg2HQLAPpEAlZ1Bu7VV7MGHDFRAbo3VKsTbAY9sPWC/uvx86gBbDK3D1eEQS8pbAeSgSwmhepnJb6uBv/o/PzHLzxWA/X7TH77De5j6AGQi6o0CUGfCOD2X7cXAlCFQABtEsGLDtxuOyQB2UTQBKZe5GUPXgkUYCUAbZJRhBDeuq8xBf+bgwbehDm+BFQi2IJksOocvA8ysIMfxluVcRsY/eB3JzH8GFDAXQO48X/dcIf9jyDHptIigDsFkEe066tBSETQUYF7ElDdYEBytN4+rk9UcBPfrKaZqFHWcw3i4J8/X4ev2//bSXqAhwTay6OEIPLD2Ipt8OtAGzxkwLw9WVFRjTc/qC6H3+YK/b1oAA0KuOizHfieCLaHHiAb5NYTIC9EMEbZrVEQt1xwhVy1UfBh8PUOquMizwaap3tQXfY5B//tea/NZdfhsvbz+PURQTDSGWB87VX/7WSd4KxjUqrIgE0IUkoKGnhIvwvawpGf6eECXJ7tv4qbA7DJgwpsKthEmmYgfaAAffYF3HLxo0vwNjJ0SwRWMG4db4eh1gPNm18vQ+us/0eGmxDemu/fnM/X4evq/8342ksGHgLY5LyT/zg0wM8lcMjgGFXwqIOVFJBQw99eCvF9oZL9Mfl3QwAvIXDsBRC9R+fz8x0FPBLB0xJEpwUobrfAkARgIAF41h3wQgP6QAmX5E/7eI43IxGwwf/moIkRyWRJQIPgt9CA9b39nzt4bYUWjAlCjWDPgv8IEjgLJfzuaAsrv9VdVG4OwOXW/fdoA35qAdL0BDwvf6AAUVHd8LIEu94A3K+Q+2YxaB84MOH62P//qoo38fCRDERE2zf0JfmDa+MieElAjcDPKz+mRKCOtdgGtXaBjgNJ4H2owSpNeAW/rRH4CaHSpMwnBYYycjgSJwfie9CR6mPu20Uv8kABF206AvXlBMiIBPSlB9wjBW1fwEuSb94296VCqgMaGCt/G1BbExi3IG+r3a3J6P48Gv/J0YmEYoiGY7V/SxwFCwGoE/xa0AJ0CEiV9QPCJb1OJ5F1VTjEY2/MO9AEJvj1BJTQpqLfTlGwjABuzT962e4IoKnyrdh3+/6mzDVJ4PHOxj0JqGKoy20+wBMN6D1gLWi9NQHfVP5MEEPzjGYy8BMAOnTAJgEr8HUIejRo5xrA5xkR5AngmiSHs+zDDAmMgWzTg55GSJEmHE8IvWPAoYTfhWak/Wn/bQ0CGLSAjv83SUEfKp5q24LXuQICpzrjrgWoza8xVE00CQCORdhMJuTUT/rjuls0gO4Iby8BIEgK6gS7BsGuTtDrScH/fR68biUHNVGBnxjeNyHEvQe/ve3LZQqgG3rof6cEclsNflG9J4KtaQ8WHcVBHS1BtHE4QP9OBMS98mpbKTeDW7dJwRsnHpMBTFJpV4I+b0kY/NqInVFSyBLANbnMSgBM8F+Fqfxq/h657/Up+GaBnwV9hRqc9bZ/vA6vu+T9E8KPJWns94UfTeCj2QXwCHS9dNL8Xf3Ho/rfewSeFODGDV69AU0y6NFAE1DP3qK++rdB7/1HRxf86gT376zOr99T/h/ioBiXWQkgQgVeIrCC/WomhDmQK+hASI2ARQZKooHMLdCJwGEBBXC3+uERwg+VOHZ9ioAt9H80AI06wGgJ3nQA3BoCut6AhxYwgcPOFnxuFnrphk+NIKIGrWPQtgz3b0i7Y6D5rs1GKqTop0nQX52vmQC4BkjA+r4a7Kx9WLENGeegkhSETBCrNXIMdi/444Rw1n6E96ry7OPuj8UfLxtQ78NA2iSBbg7gIiIbdDLsb5agPhLC3RkYKv8NDbS2YGsatNRAG2oQwf9ZIOydgy1MAzBkAw8UwEEIDzSAqdPQ6za0PkeJAMH3Z0wXniUSZoHvBXU2mcjQgv56TedIKglCpIoQfgwCIjOytd8WgN0bfxoR8Fn9Gx0Aj5Zgq0lIZbsH/ibSJoFnS+C98g9ooHEELI3gliy25yONIiE6pb0NfBlyNEYyENoodkKwgl6I6s8kARgJ4ZoEfuYWHLEJa0LhSBXm7kImGeSfVdoJ1DO2G7WXsehAptupSOoyrCSF904k+6vt98X/ZcM98Hsd4JYIXhQAIg3/f9AAUYhsLQKAtkHVBnzjCKhOoYl2ym+iBtvzDzQ2DLXJ4PUmbJHAVnBQX4jkxfvHhNDqAdHXGQJgv0aSDGItgOseHIU+K9hXnIJzkoGlEKzNHagTdJ6VWEUH4iCKH4fd2AwDPaYBm4Wgng4gQ9V/CoGiuNmD04AQtNGMGzSAAQ2I2pzfogY9LRh7BrbOh4+D30sAencljFu2CUFrwY8UAWRfWwGvVOVfbx2uIILM0pwDv082dUTw8hYs8L+uIWiHGpWgClnAa1lMPJogovvvbePPs/q3Xr++kgCsfgB5oQF9WYKPJqEn6G+OE3i5AqouF59FQOmahQC8rlPLj38kg1c2f30vw+XaoIX24/pMGIgSBoZqoH3wo0sIIGlA9PWcCPrAtpPB8eBf6x1o6cHra+2+tpIFP4PgBfxZtZUJfo4qxELT948D9ucK8Mt9+ccjIQw6QJcEbrD/1g340ATuDgDkFfx6twSf1f9xvuBECYxq/7ythQQGm+5JDx6Brw4CkMGT3wgscCUoQ4sU2t6DR2ciBjTgtcpenQoZVX9NuL4Owc+dVaDursYVkVALX+shjSBKBuvCYDUZjE5BdNkxdHAUBexyHwB6NP7Iyw7sxUDViwge1t+mz8B/LAvVx/c3PeBBCToB8IUGOgqA3iV4yUg6UAOxaUFHDx6CYS8SorMOue0CCJGAf5YfRhoAI+A1CvwxqNkAY5yAIx2EQmkFfeWOXi+nEdSQQA0ZHMEItiagJArQxDXIrj8nCfQi4HZPAttrIahso9oPQ/2/JwV5JQU8zw+7I4D7/sBn4EO6rjw0FR+i3Z9fHtahzsFvJgM0X+tmVH5vaYiNDGAigewAz+gyNLThnjCURQFR1b9d3lZvnVqmj9mEPDKIUIC4KCCjBXywS4N+otp/Hk3QVthOkwEKlV9PQwXjT7s/zwF4Qf9toAAzFdjuaEB6S7D1//U5FIQu2MevO0rQQH8ZmoXE6B/IkgE60XCjVoq8gt2iCG0S8L5GdxkM1cGsfsCMArSCAnrr7dzAZxCEEpepvB8tqHJ/q+bmJGGts/AcAXFOMMeTwC7Pw0B6CtCtA2vWgonqBQJFSwH0JQK29OB2kvgj2HHXAoyeAIsCQO0kMNECAhFMqCBf8mElAkyBbX1tJQP2RJ/ha0gpAfS9l+/5n00CkrQpq0MZbOdAuxmMvHswog62jZj7BnYQe19b14kxNq2D/ehX/p68HEcF+x3yP7z/V/A/q/5DA3i5A/dzA5pdgbKp3v3/wQF4Bb70WkCTHGRAA6+KL0bFl6FJaFw0ImZwm6igSwbbwPn9RMBWf3sN2JgA/BVh/Rg0kQBgePf6HglAHLFQwqQQOwDjbdVxNZjR4iM6Qa3WxwvNxh0JFb3g/WzFQQS8b/ttKcDWoABtUMAd8j9hf0MB2uDXhzX4CHj03L9DBU3Qjz0C0l4mLSLQPicOOwZoVCB6P6dA7nDbGkVuxcNr8PU2JQO4wX5trEqmccZaHU4q8oCDFOpzAnOwqyMIMktNNNAHouDGxO37DgArQZzlmp/14W1QlqHTMaIIx7SCx0+5yza7AKJ3IXBrNAHVDcMZAU/BT/vgv/ULPOA+XiLggAREDF2g0ci6xNDRglegd7P7TWWH5oJfayliEg7bScQRBVgI4Ookg/F6rvpLWP29swREqA3CaG8/FpKqS8DTAV4TiBqIqtxfzaQRLys5I0XEFIFrPbZRQb+16Fgi2LvJv8EFUPW1gGfQv1T/F/d/HBnccP7rAwnIIyHI4ArgWeGbU4eHy6Tx/EeTZIb5bo/BsMBjmjBE08f/RB0PHYBd9eVRAGY7cHRwiBf8WeCPHY1bgBTa9xKTELzEkQX9CPtl0gJiqsAmCT7I8xbjivh3JGFI+D2nBcSJQJ8agDX+O9iBL7UfG4bzAkcaICrbtYHz1ycSmGmAjJfL3CMgT3tQpmrfB7gxSzC1DnvdhQMieG47u75+kTouKNkM8c/+vq/Q7ZYjO/hhVvRq8F/9gGfhP8aqE9EIdR6LTwJ1h0BItyDqB8iFwuNqASscRnYioxOg9ApvnYA35f8e9Ohbfe8J4rknoFkO0lmA2gmAG0YK0DkB4ieEjiLoMD8wBzom27ANZkzIoU8EMHk/uo1mzeVoEoRWKn8L/62EYAX/lsB7D/LXg74uAMr9oGivJ0CNJCGD6i9DhZdQF+gtOp4S+NODRzsDVbhdgv4BqTMNyIL9SCKwL9/FGPp5oQKxIf8A/UX6r231H7YIqLML0Ae2GtrADOvRQH5b/MPE9dt9BGLNG8jVTAQvIaK5TtvvvWQgDvyXIClUA78S9Nfg7VtIBlO7cbsEYkQDMot+ygQ7QwmOawTHnAM2XUSnJvPIYRYMmYPS+sv3J+cfP3d04JYIXsF/EwMbBKB9Q9AY+BiSwFj9mzrSXmcJhFPVHySTbgHJCPvRQ/z7G/SVUETsg0ZF+i3CRoCjhf7y1A9mOiDD7TwdwEoEXjLwAv+avLE2B7Jnb+OqDpBoAchoQJskxKnss0vu7Q2YhcDv4ySeLOg9GsCKiUIihP7yfW7zbTsBh0TQfN0iAWn9f72Z56/Ax9P7j5OAH/Qvv3/QxKfk0DgDuP+R3USg3bzBC7bO/QT9Eeh9QvDPG7glBQzJwK740lAFFgFk8P88CqDGAa223YckWYhr+c0BPdwetl2ocnsfzePAWcVnnAIp6gDVhDLyfV4nqFEDPxHsbWD3k4BDkN+pARqKMLYBPzYEvxp9xmCHQQdgWH/9EtH2TIFpu3AH/cdGydv1j0TQbRrq+D/mLcX3ZACZ15bF378CG0My6Kq/zoGOQwhASDFwFbxyNGBuSxbCEhQ/uEPe/6gAERWQObCVVfjPpQX+rexxYhYFxIkgpgX7Y/vPs+Pvxf9vwt8kAs7i32t3QCP+3SPaTwIytQXP38u0PESm+YER+o9B3vr8mETAUfDrEkPI80ck0FZ0dXh9U+HRbhey0cAc2H7A4y4egoD6y8JfkBiigLdFP8v2W00E8deT2IeAKujZ/QAVKpAtKI20gLWksHedfgPcb+0+NEHefd9vB9rayi8h7J91gBbaw20MsnWAF5xHkyDUCOoXp+yrOwwxcKj0aL6fFppaaKDv6OpHR5sgx5BAlK/+fYhuP1D196o8e7lFBaKqv5YIMnFQpd0FGVR35RJCnCDaABaXBtgbiSwtICMtalKC+1JQ6bx/PLcDPQL91QFodQNKpwOgF/9eqcBxBBqRcKAAVk+ArQOMx1RYGgB6naDhlK+uQQwJYx4meQbxtNnYQwMjt/d4f3M9ZE4UOld1LAh99fbfzOxiEkKFCkTJIUIMUeVnJ/9sDt8/e1NEJOi9oVHDGYhgnSLss9DX2IAqw1zALUncKcDr0FB5NP+0cBQNrEezDiyiADPkt9qGpwoPdL0AGPx/NOKeyf3b9WJNdfcFv6bKd2cLMJVfJ6Y3B6wB9WFUfWWEwKMfGiQL+3bz9XGQz2EHKhF41GCtZyDi/gUCsNhYoAr3UNJ58YidHKqnMb/6AB5J4N73/4L+t7mAkeeP3P+1LNSB/l0SkMEd8DcEuUlguEw6t2AU/PCE/q++Akw6QFf1u6SBrj1ZnnhG50AfkoGIdf7gJv1KcSfgzWWkQ9U33Z3tHXYASKJ9e/YhU90rvD+q9Ej69/wxYJVs506Eg/r3DkMDzEdDBRGgcZay49XihLA30P+l8N+hf1f57/0AoxbQbwYaan/rBMirE9Dk+sBzTkC8JNDEUlv5McB8PP19Y01Gayep+hC/2zvQ/2HGLAurowsNGlA1cnqGGzeH5weiYLZm7h3QQC4O2tXdhvMMk1ZS5ebpgI8eMrPvPGkwaxayk8Yc6PMOBPEdC1XZ+2UfbfOPtxLMQQAG9BcZFoF0gp/RKjxe7+oAw9T7ZPWhgedodgz0gf5KBtrtIZhQAZpAV1Bi36w6t98qVfH7hqGI318lLCjLCUFlxRHwqYEH9a2qb4XjWvDT7kBwfbZA5P0+PNuRuW1yf4yNQH3zzwv6b70QOJ0G9OT/dhoYRUGT15uQH/71MjQLtQlxfDuiCXrtM+SkA+icQdH6sU/xz7Ze7FlubV4TpoTQ2osdpaEjtqADmEU7OkBEFoLeC3IWFFeswJXKXzkboNL+wzcFHU8hTGKIboO7CLi1/P+5F+gydQhuvRbwEgxvtACmANikhLTbj0gCYk8KdlYgmj+4Ymaod7TwahwadICuX0Cm2fE5iNHPK0x/CDV66Kyg1MnqjNFBnhBoLQCgUULfaVe5nq/6EQWY67bXCszUb+7232fVPz51iGB12owK9peyP1T4raMFF/OEYJP792mgXYfZ04GHMAhBkCSmSj+dKqRPgVFGHbpLEGMiGFeQWfSgrY52VxaeDUPSNJI0P7NoisG729HHl78z6hxfs9rV3m4JjgM/lsui2qmThjCfDFSb+I9vwUqG5wwL55U7C+6ot8B+7N2o6r3q37T9trfpjgmTvv7PSQATLLeRAOZhIJHBQfDQQJPBdUwEbVW3+L08EcEE/9G4ANrCeWcnPKRHDupbNynMx5AA9IRYLmrc/YLSiD5EaEBS/s/TgnU9ILcH19n+CpHwegLejx7Mn/d25fdN+e9U/1vgb7bqf08MOtf8EXxaoh+GY8L6gDfhvs4i6HQ7seYI2sv1GchdMsBIG3xlvxcCRzdgCPTn+6q/TW00VE8Q9FaFv+R2VlOM1vm/hhjhDCdgNflVKME5B47I9xT8z0YgPAJ8myb/LqHy36j/Mwqw9AALxuO1JVjiuQAYLcFzIhiEPe05fk8tRjGw7yWQbsfuLAT2VqOId1osnr0F49VM8INACPHDoBz4B5mqqSnUgyh3ArjXxfQH5BbgUS8gP7aU+w0zHD9GGD0CGHf+P1p/DeivlhU4BbxR9a2kYFR58YaDZCUR2P0DMmgED2eg77puegy6PgDphEB0CwlG/i9d+/Hs34pBEQrBn0W51mqGnJAk3ACCHeiqkQ1XFQA5AlKH7Lk8yJKWY3/nym14h2C3JvxeMwD9ZVMz0BPMi1n1RbKl1cYhIVblF3G0ATsRiCMUvoK9//OgcwYMoe+ZKOLlC6/Xk50br9NFz9fanqA8UIYSpCwlBO4kHc4WLLBfBHVaKwKgLQjmP4Un61Vq+3s7Bsyi0WztmLjJwJwFeE0I2vD/1Q6MVwefxfUf32skCPbCnxQqf+QMPEUDHZ7vGeyj020JgkPXXwsldA7SYR1RE3h94NvNtugswcgxXEkIcBPCGZ1rmrgDC0A4K88nm2fn/eTnpQtWyZfybRoK8Dro4zYDIMGsf7saTBzvX0SMbkAD6o9CYbsfMK38cJKD9l2FJt9/VGs0h5Gib33pxMKWNsigFUh3G2un+/N1WUglI/EEx8fq27vUNnwsiOoKecL7kQS8VnWAGCFUgn6dBtQhv40CmIYggwK0uwDHRGAuBXVdfwzHUjZzATLMAoyJ4FmBhzaWBlrHld9CCWpPHRqofBqMReMGTJ78q9rDes1Tv7/0m0v0AFHXNR6P6g30SHivin7V1BOhh3iWPwvps/yE836L2XiwnUT8x2iHgfqhnwn667QHEE8oLQjEvtEW7GYBZDrDVkwNIO4G5GiBDf9fGoFM6n+vbEtzXwP6u9AduaWnGYSLAlVdl/AU+ikrSeEIKgwdaZ4AACAASURBVKj4/wtgHcHtdO2nWKcBkPfxcvnNQvsj2Me9f02r76T8q0IBn9OLKfz1HX8yVXQYGoAB/2UeBQ5/5kCL6+H/OGGoRnLSwdd3oH8r7KkGTbgIxEwVWvnF8KOpHnyzfF9Jod5Px+IF1h8owyitDw/XEgRb5bPqbt1uvn7qBIQ16vtS/u+DP3cR7CH0WWJgd5mTJKYgNzoGjQrfvu99NDBC+bnyW1x/qhTatv2OaMKgJWPvv5kwnMgxHYGFRtJW8VMl3uP+MgoqSZyWFKr7+KIDw1d6+IiOgZI4+d5iYL3imzbgyO+tph9t2oSBxOM3ugHtPoFZ1LM0hF4kXNEBssvVgPdjdXZWK7uKvyS3q1Xb1WQwtVDqSUggq+Vw3t56JA2cz7PXOwGNW1ecwxPhfe3QEUsDsFaAz8jg0nf+iZMAHNg/XSazDuC18Iq1HBRrOsAQ8NLB+16g614jmuSgs3bROxE55D+WDDQNA4ivdMJ9M1b309UqknaDU8ObV9/PwmMPATvTMAxpABLBzugUtV9bLdhNDQA+7B9tQJ06/7QNDHGSwtgZOCIA47InIoDdROQGtt0U1HI3GaoUnCnC/rzBMQJteN17+VaAzYNA7e+PFqHQUyXPUYB7iQYa5ZFjq1Zqpx8Uqu/XT7+6BWC1Xaj0GlBIwMoHu7UzcI/6/Acb8KIq+hzmGWmAYnADrIpvKP7TZeLaf0LAeQkGgebbq9FToI44p654F47tekKkI0L5PQNZPsDwPBpy/ni+wKMN76Vav4+2cFZFf8+JwAraMt0DFB7beA/u4Zz/a+RXx0M/ct4/jwaNAS8G17eSwmta0Fhx0VRxJkHMivso+onMXr+YwdWKbgioy1jp4x4AzIKg5lEA7wvHEYCRmdx11TAuT6lDLVl4KvXkAET9P4RT8H2u+lg9EPQIpw+/NpJ7RwE8HaDv/Mu4f3OdNkq/EfAiEiOANjEALvcWL9gfFV4NZbgbQc6qPky4Pm35QZxtH1f4j+P/jXuaYPcWwIEH/fmEPBoAO4m4LGxV3txOQqDU+dXgey+UwSzuqP++uImO/u/6ogCb7wTc1n61sL+vZi87rxnrNas+giTg6QLzaUCjIp6JfhwtGI7AjBBB9JjDY4ePYVR6ZPgN4owVv6Q2N5hhVHwNeYrM+w6dN6K1sMHZm/Ce7bHe3dzKr1xw1w4JrSQMZtgnoQHlr18fzunAszD4qurNUg/TDqzx/lfCaO6t4tACMUQ6P6htWjDPC1hCoZ8kpODzJ70MUR9AODcgwyqyPhmE+wfHYB/hvSqt6qeXUShhXH+d9SR8DzrDaZZdpSp/HxqLMQuATgDU/qDPRgOIeT8cvz/h/XC6BtE7ACLOWPE0KIS4UUjmZaJ2grBphiWgT41BUVWZfP3AnEIT6OrfoF122l2rMycBoU5i/OXoUZ4/aglsXwLzHNU++FVF3qikOj5HXm2PBitT1WuvJRAB+6O//W0/PY8vQH5IrAsMs/WuVmAdHBrQgrbOxJShXwRSsu08h8JMBpo0+aDTALwV4tbswgzHrftG/dJKIAQb5h9KCssWIMeto+GYqG12/HWGjx8kzqNJaa0noMWOr2KwW01AMwJoNvhMQda2/RKQP/3ecABM3g9uD6BY68Ntz9+nDOMb5iV+hIE+dP/Zs/wwJhJ9mgBnohBuStABUXjugF3hkXF9ZZJAjefKdHZCc389LoStKvIl7QIEb1d9RyciQgFDI9Cjyccc/23Aam7/PZJBhgDgin5CtQvbCzX8ip9YgIFtOAt+w0owp/hOiCWgEGbVHuYjRigPGR/YOnEoqPDoV5z5YqB3mRq2ox5ICmSSgAP1Ne+XV2NE+/vuFbCTRADxtS70VRBCjgBk2OyDUQiUgfl77b7DwaHm2rAZ7osRSOOUoHgKfNBSLI767+oDYrfwZvqChSpGfj3pFwZFsCJg2jeIQQBUiyI4WgD68ww4qO8khuWkkIuDrxWv2nv+UTBpJYiPd0KemTA8qqFiuUF1jWS3BoG6pADJq751JqBI0wvAVPyMQvjcX1zbELltKK+zBiXRFiRxG+b7q3M9xuLdzR8g0gCGNzSM5gNYfqGO9CBT8OHct6oB3KsSDBisUnwsFuISQaRHxDSv0vptt2oeLHMERfRn/FG/Cx01EpgIQG8LP+/i37PKw53xn6sYCM4/JwSRrCnIeB1ZkLsawDhaPKv/njU3wnZ/dBdGE8+YTHSG8+ofGgIjsC19YnwdM/KAnTSsqj6ig7uGgIPw3nYFzhhIIvriAxFP9CQd4HSlnzgxONIdrE7A8ZDPx9fjib8ifgegNIliRgdx95+E1T7+3nQVNNhEzDgGA3T2rEDLduwtPpuuouPcs8swwXFjdTaMKt+jA5gUAQPcf95KJQxYU0cYxEDvsBSmYuukp7AwnqniC9Afa5z8vboI68ImT0t26CvwBzSggkj447r9IojvCn7U92J/Hw0QSdwZKNNjxPCfSxRqnATkdwpOwh88oc4J8KTSm/wdbZjrc+4iFP8YO0/5JJDCfaijK5xVXevqfg6zGRrQf83chvX4aRfAE//6vv5+6490U4ADdO7QgM/5bcHP/n4OtCQhBEFeDWSvos8DPq8/IwzLzjpa8/U6MMSkBklDm8e0mn3QIY7XG1Om8wzN48y7HwhOK3P0/ZwUQHHv4psbdoVeb9VlAjChBCdtDDpOKTh9ZfcagOYq31RFjN4/gwBYzp8lAwYNwBELhZoxECeZxMlAzWGdCRV0fQWGHo8+8Kx+AAxnCIzowAxy9KvNepWfsfp4RR9kUrD88CPVTuXRybhqqTHcnxEGndsgub1Gdug8yz9fHt3Hpl57x/mfCOC29FOSQ7/noAZR5W3Ob24UMpuPYAYiQrQgk1gnFoUIKr4vKFpV15pHUJO3Y5rfH3UFHU4bGkU+NKJ9f2hJyOMxDBDpjAgwiYqvk5TqNl9EH2Arb6fA3yaA4cBtPWewhkEcIQJBlGzYp6zRmr1v+e3Fv27xpzvyI44NGDkCIi7CGNV9Dw0M8NtHC2vUwHINumCGNG8erxOwtQINsW88Tlwdoc+F85nI559ngEDpt2F/Uu3hiXYrkN/pBFS26hYDAkFgErMK67y9mGBA3L5ore5izf8b3n805MOq/t7XU4WHv1DUF/5gugCSOAIW/59uMwl6CHWAib8bvfxWl9/rBGEMTTwDfG+ezEYG4yk6FvRPuPwE+wvc39IRjENWM+/cm5b0W4Pf4WuKUnw/vD6eDbB1ETs5vl77Dhnm/51g6wPWwQAqxnivgQaeS3gy/u/1H4hpTPrIgHAN0mSgXUX13YP5PMIuQAfBr/f70cdeE+QoCX3i8nFMLcAjInBoAIYqt1LhC1WdtvmSab28AYffaeivCB+ohdYQgfUa/WS4ToMsNLHLc9nnvPZLwn1/EefPVf+U/xvnCVSEQEkEQEnEQJO7S7RvYDxNeNYKrG7DKMhtsQ8cMmhgPKKKj+F7CiHYFR5KIIPxOmg5IVAtu3ACQSPh7CzUQOgAej5CWEkIe3vgxz0ROGO//qYfz/dnLT+ZxDr4QW0eNCJBorCFOVC312Ec2TiY5Bk0cAaQmiA1VH1MOwDHQ0kHdEDDf+2UTWhS4Z8diQMicLx8MLBfverLcP/jQzF0P8EJj5+NGK9RCz755S6F/f1+X/gxeP+Wsedv+vF8/54aSPJYFjIQd624MDz/UDLQnr8HU3ztKHRf8Qeno1vyAQJBaLcMtTV3cvgP56COCqd/QP9xLgBkH4BxO13n4hNUDtACC6G1S3zqooZ6Ba4lp/zcAFb7iERKQwQcF39IFJjdXECGADw0IE4gg674pYAnk4HoHPx54tD5daO5vxrugSkMjgiiqc7TVKAT6AT8R4ckbHEQCYR/IZBxJgA+XZjsR7vaoRpIxWqeqfXuGC2CxwudicwePEB1kNkaZCuwyF0DuKv/4sz9mzP/Qxdg3BDkBTMC8Q+loD6UGBzx0Kz6eAX/KArOQTlPHFoI4vVtf4rNuLrca9edRn4xBP7k8w+9AgZCgBfEUZWfEs8iFNZ3UO7TqmkjCO/rWdgco/yIqHcQWaC2EGTzgz5y/iXQAvyx3riyxxV/JeBriaGB9OrTA5g9/eokM+37GszqfA/UZk9iW5UnCtBqBl3XoNN6Ag/+zy6A5evPAp+TIFDn15gQw9rjrOzFX0s2JBVAxa/nP1a6AsNWYGjPNGPLTQgBsNUFvOA3Ht9o/rGDN0tWOCcxJGp+f7++kkP7PxcGv1+GjkaLt/fawpwwerQxBJNW4b+PJsYEgiAYYdEAGIlDNaAbRkIgK3ut0jKByp+8yz23X6GttmBmjwDvChgiYLP5V/zhH6/110sGcKo5CkggCngxnIPoPja0j2B+1BRkiYJiviaLJqghDI63G2nAgAxMCuDdnoD0wIQm+urMB3VuAwbBrFGgGgnhAFqg9+ujKsLxB3qGCQNEEtPinIQlAj4WgIw7/iXc9V/x/yUWFs2KH504bAh4aYWf4TrTLGTy9YbftyLeVOWNfYNyt/ji29mQnqMAltU3ioTtbX343yv/1u0YPUBz6zB702tQucnX0gWaFh6DgPdmhXaapGotw0SFz1qDiTMdd8h45HfcqCPRUhA3+NmKz1l9teCPaMd4urGaewRitNBDdahR5c3AfQmDCFT9vmtQEwqAYXX4XI2n23Z9B/Yb1FL+LWox6wHGbZSo6FR1LzyG+3hriSZvWT6jfXhl2cmQZJDrAbuYAqAHo1GA/EOgD8eGcU7A8eDvH4fQBuAhBL/Zp/vamPTrRENDGLTV/7E1WEPLDlP/PwzU4YhusIMUgfIPAr6Dhv5R4y2r8ldFwiFoYHnmr8TAHbhRQSZOctH598ZYhqt6wP7q/ouqe77RJxvzFYaji/z4vna4v5cUMDXqDAJ5ytktqtBDckyjvJg04hl16LB0xFfyMfD77PZjErGQRRjYIfSvoAXntks0ok8MsUC4KARWnYPlJBeIgLeFrUgDOHYCag0/XNAbWgRwQuLAsaQwIhC1g7+jCNKuT38JfnYSyTi+QQEwwHeT4/dWHYxJPxfOj5oAnRQqgU3YgGZSOaDyK3n/qkDYBKptzR3oD6B4fyRKjp2AzSl80YR/3P+/1vBjX18Jbu+YsrMRgbqPP8zrDLTAaupphfeZtyPs9BPztpLSBZjowF3woYRwBwOWaqbev15b7X4RWsiqYiY6ZkFEIoUwUA2OrkeEQE8HYNyD/rl3m88jCGgO/nPW3xy8x4Q/HBcM1dYg5q8N+B/SBSYhtD0EY1PRGLDoKIBHF3yLz4H/gSYQJRETgqeB2d4vC8L2NVnQn4PoVJJAcP0inahAfdXVI8CFszjRagCTtRdV7Sr895NBpRKXIT64RMFw/iw5eChhEvmmyUIH+k+Qu3cLzOAN6ILlFvgWnx3YWFDz0f38ze9GlfP6UQ3ojEY0gtqRIEbA5/WgQFhsEuIeL75uTzvqHktAWfj/OD6sQXssROcGiRgFn0QVkld7OznMDT7CJKzhMIqxW9B+LCOQdH4uyxIcE49VTSeLj0wKjzcp2oDXQA8YoDEGBLMW0BJw+eAxXejPV/IXd59/tp5rVyYXDw5BlRetSpQAcvgfOwVM8ObzBq/AQ2wX4lwkQV3vNhYFfn2LFgaoDU1ogqsfqGkJYmrj9Tr22KQwBLzbLuzDeA9yzyJjVRfwegWq0H+FThDPA6ZhZwX2M2Kh4waovCzAWJTzD/qY00c+6PM8coz08VNqglzx54LfHuTJK7z2rwX35ABLg1DzsZ7Qv7l/f2yXDlbf4C/irg0MJ0aCuD0wP74MrxfdFlX7tq+vtRdCpvt599EG9Yz3V+P+Oj/n4zLruZHcJ7oMt/MNp9eD6HEeFb6/TMfbWo85Pb79HJo8t3371/PuIAZqMvjPC34nVV6ZB4hEuA7AzA5cfU0y2n6ux89D/35/n2/vWY5Bf0qwf3tPLISO1Tap9qzFB6eap/beqI94NCCbGwgqOItY3CGl446CaQ8i2Q9g0AvmgJOnBoAA0gu17tsKtKS7D4udgCYERy2QIceCX/P7mBW+g/7D9S6Mn50CS0eAoQPDcBjopIA5+EcxEjLweRjXq0UbLIjcBxsGx2IZvlf0ATjz/6qypAmY7bhrk4ahsIis6ccXKHdueAfUgk+RWPCLh42c6zEeKyJpRTdRAOqBbl/Wq/uT+q+Fx3FoTIuCzc6+hN8j4veGjuAnhSE5gKnco3A3XwYlq2sq+lmP4yEOpqEoG0M+mGDYuYT0pKCFHgLHKt3T7T9p8GcWH+n1UwGa8X6kQt2x4CeqPexegT6o/Z4Cr313PHdgrsS2ZReLfpKIf+IMFnmVmwxQ9AhithYT73+p2s+JIVfrjwiHnpAZrSsr9CMstQXP1+1+510N/q8E/YoekMN9OMFvi5LvkRDsy9rgFCOoPdpgaQIWBZjf5KCSQszZJ1ivTvLokpen6tsJAVND0NFqb6GUGg2Im4Dyx9Pn7/0dm4pADAslJzTv+dKNrAPQ0wyySm7bj1RQgbAXsRa4R+mBJzpaQmHLmy0BLoL+Nh2ZRca8uUc6P37k97n451fvTieAE8BdZ2ItqFEK6oOJIYPsiU4woo140Oh+H/UC++gatHYcOFT+2y3AYvD1rM/fpxdUcsAi70c0OxAEP45X/hymE9XeoC0zfYhbcqfbhs09HpwnKMDR6g0mmYyKth/UcLl9ITGQ8N1S6s+gA1HvQCc2pluPvN2Br8SyZyfyxPP/VhCi1L1HWX2CQCuAE8TIq/sBYdANZmTIwqq0sb0HIzhhugBeUpBZLFyA8y+EErsBUYDZHYN9QAAooQwOws+uQlhdESSSqk5Qsh8LSYI6LDS1AbmOvLlRBqQIeITvM36+TP63VfE5hFClCTr9zEyVFwS3STQBy66DMHB+PJWIrfgGnYBx2dTboPa2X49GaBVlePA7CFx4iaGi4ns0aLVjMGvtPTDtmO4XEE8E5Kb/8qYai+NHl60LgAICcUCoJPVeiYG6Pxw/X9VFNVbFn9FNPzXoIRDTyzcpREYB5Fm1EQQn3KRi9wKApR8Tz48SwxnV3qM0q7ZhpdKvr0zfY+gO4oQf+EGPFYW/Xf5hwWsUgxiBbShGoGIx+D2eH1h2EeR3UQMH4zMaUKr4033nzkSkfQADelFbLOQCalxdxvN8mInhPas9bxtGJw29Fx3Y8429MAS0fL33Oeo7qFZeiToCC3B/VSNYuU0fgDnkhxGgMFdxiYEY7MYel+OHPH30IMeVFK1C79l+QdXVpFqHlMAXEf3EYDyfkkGdNvJ8f3RAXU0jpgM7jMNA5yCrtfzOicKG/M9bgEkEjqqPPDEcDfqVwGZv6zcO9avDfOhf4OmLFd9OLBHHdxp51HvOBlnAoQksYjASA1xnIhPsapTCPjbsGB2YevpPpgM73EYeSYIftgPgte6CWesVBB9QEgfnWYMgoeC8ql69bWoRIqYHvSIv/u26bj/jdqZ9KSGk74JRo6QS9PuTiSHm6Z62kLUGH0UO4rwWrhtRETkR4iKRdI8giJ2D2nUCMjsA0TXiVDb98NAf/rCMlajA9wesWHZrAe1dlwRyVI2jx4KkyUHSx7YDe6YD4tOC6XW01puEdAJwaEJzf1uATHi6ZlSCpBQscsh6C1xRcWEG4bCFeKcAVhVlDu54JQIkTT21hptIT/Afk0kMcS9BKfjBJozcDXCrtgbWXxbMAw3INQIxtQJPAGwXmYaBbYh4SCsuKwLOAQ5awKskCMmRg8P3xwlBfbosQaDqyZqBkyQe1CLQACoTgN4qbyHsPwkTiF2pYaj6MAXBmUosQHnUEYCsBL3MW39SNKMJ5PfoBsT33DVJCEbFnBCMOkHfvj6Xq8uw+dgRIhGgAiUqf5QgKDFyhe8nnYrlqn9sG1GoAfirubygX4H+8IM1CmQrMFAJ5ExzKIp54nPoVU2Auh6eBShDlTV4u5c4HE/fVvjFrsII0Ik6QX+Iq68jB19ziLoKC27FYe0gC+j1RSS+BgB7AvAM3m8HLdy5fV60C8RMVuhD1ieQB32MCCq0QPJuvuw5IHF/geMKwOPdpmsxBwVEfGEOgeincJqNmuSFIPhPq/xM81CWIIi+gCFBqDX3QPYd2OcCRo6GZBoA3AM+00aesAOQ7/2Pe/vBCXoguD4OBD1WfPwClzcui12AuH+gC0gEwW72KfjBCQRBr05D0IQc7N8PzOCMehPWK384MPVDJQim7yDdoiRTItzzFV/ZOX9sYFetP0fsQzb6O7wOoFjxk89YoQXv+BmSN+yYHYO+BsDRAXHhuJXsEFbdIEGZQWUkNVNzGA9NZUVBIQL7jASR0AclE4Pb7JN3BO72mG92+o8UG3nybj+mASh0FsLKn9GPxDrEcS2Au35BzHO1BksriIJdpqWjKR1wlpR4fN977rZqI+XbYjYDgVDpcYQalOYKMiuQbB3G6Pu/HlMbi9a0EMkksXtjvvXTfgMKAEZRN/i/O7yD8Da2S2Bdh3ICWfp8yuMkYl5a4df4vVWt4UF0yyqEnaT6swYyWB8/j111Y1ERS9oB0SLMtBGDEBD1PEHwtdjUEAHnqmoHU4wCDAoAS+lHwtu9eQLUAgmxVvAuMB9cELMV3m8EUtcBYYI9nkNIEEJYrQeUHfnzzRyC39j8CgSkir/E0P2odnAmAqDnDIhqrtV9BDNS2POjv/0pwKr6z1h/PMz3uf9ykFYq9TtoAXSwpz0HljdvBCVAPY6t7osv6gFhMpkX13rcfXQMIpuTsfTibkfOPRAC2meLRipI4mDPwMD5x+v3+Ey+qEfACwoUEkKQSMZxYJDz9R68PyP43yvo2aYf881rNQbZgRU/jp80QnW/hdXqJxMvCFxXQSNHpE8QiF4XI+wFfQcw7VL2Md7RRajsKgh2D+6SLAKPF356+/7yXYBTUgFy/38StUjFHweD+iiHh8/LV/i/TSvGk4L5x7F6AsIKbgb4C0YjgdGRIToGUx7cgS3JKP8pRcgak95BJGQbjaJdBYQ1qHYnYHL8F45QgHx2gLMQ2cDxBD/4SeR0LSDi5XzPQNjM4ySE/HGG6g+ugltLNSARn281BPtNO72eJLjdX4ITSEgpQvJYFEUg24f1qAYQNQdxx6Q/RcB85j9f+03zf2QV33IDPHegNgPABTfqFR8cZK9TA7/ll0EQbUUHW8Gr1d+MSadia+LRHwhunv87yWoJ3h/pRDwJAbDNQQFd2P2mH4kP/wDT/ZeN3CK3+ZjvgVpw4r20AMafb58j4N1UMknuj6iCx883PU9g2VHVH5JX2eEcPghSgRBCKPzK0Q3fknwPN0Hk0CyC0zBkz//7duEetgFjVtypASDI4CsknYJgYDhqsBxxy29+eyxrAZX75EEf8f+CkOcijMDDHx4ASYGGu8WHgPwpHJc0qOG8FgFTuVk0cRZVePFwHEIUEu8xSHoL5qWg4I7/HgOKXe2dcnu2SSdCGIDTA+AcxY1zYL6Q6AAFu+/1GvjKPSeEoJV3NiM4Dz9C6oWkEav+NWjPWXNOIkKgNTi2I8LeBgaZHJxqrC4oNXoB9pzzMws/OW3ghSyQJgjbygOVEDhoj4nHLld8HPD6UUMFVLIgKrTL7cFoBRLQgEdXIseZ2/HhFPKbk4d5tYWwwR0nIFQSD2P5gQhs6meVfB+Bkyz2fOIvX/zxqsSODuAGIOLtPNnmIPCrv6Kqvgz3q4tCwNl9lWYfnsdHj2HTgQw5IBHwULmfSu1jEV3gDFSxTBmqSEVqiYK2IkWcRiAkwV/cyW9YhqHXDw9dkNQAcO6HFNJT7oChfrPUYc3KY17zAd+evAwF2w5SCKLV4EuCEKsKfjBVWHu9Q9Arh4CoBqEMWYBsNX7YgKP/69uC3M7/mOOz232QT+ox4iCyJGEFP4oBHd+GVvXBwX35nqp7qeIbV6L6tdZub3ueJ+gBIKgC6S5gOQFxDoGr+Bv2nzqbknd7ph/EmXzO0o+kZdc/wqvQkAOUffVMzKtYgx5Vob1/+HAfCdzHSiXHenX35/2JTr3KZ9Ruj2lYiMhLIFoNyMq9hFroeYMTE0bSLbhb4l3YlFPa6hMd2jk8dmrDgdQCnC4/+ANFlYTB6ATlx2GDGXP1rvL+SnWHw+cJes5/rRWt4H2pw9GklD4uSMpwasIQiaYR92gIyFX5S8dtRZt/nCAH48VXW3hRE/HKOsGquj8EM85Q9cfeAV4XwNGAlmIFIwPYrfLKuxV476RRetzcdeAsRSZhiHizCKEIOHn3EMOWy5X4uIJnXX6sFiBFLaBm/THOQAkVJK9j6TKwiSDTBWpwHkSPQJX7U959uAkoaTUuug6oQCBz1Zlxm0OJSIoIw04M+7zCGuYiznCfHww9AN6Ir+HXA7lfn2oBSJ2FOOh8SzINfmcAyITq8JX/sOMPx6A9LeYtVfwgCBZhdu25OB9/XmWWNPUEPD5dUuJ68wd1AqD2+w1PI9KxE9BW5t3z/igdYGWiL7L+wPv9jgVY8f0ZcbCKCuLAHN+c5wa69Zpr0J9t2KnpAGzyiAIPiFalJ8/xXrrA6Y+/8NoDnWCPNwFJzf5DpVkHte8hx76P+HU1+HEytEeSEIzAsu5r6wPJGu6oLz8VrKofXLce+ywIHhNa/Dmw8LrptWXZ4NKZm4pr/QQ7Qk8ehMrPtAF7PQCD309QgRgRZMKgAbFREAfBBXNalbHA9cEHMo4IgIUuPjjBWEUFEQpYTkhVO43eRiynJw9Jjj8TOUIlJExK+0wA4gWgQvcFBHAc7P4/u78/Ff4CC5ATB3P3oUwFClYgcALcxzp/B9Ez4DUV8RjBbsCBrMH4dLNwIDaCGhA6o3pXksdBvYBsktrXDgNJKAFy1Z+ZGIy5NXgXoBT8a3ZgVSPIUAMV6DjLxhsV8wX4n4ibbONObHNyCr8Z4FinNFjg8ziiF5zSV8A99u7Zdf5OisvVaAAAG3VJREFU/kIPAJLWX3hUIFD6o7MD4WkHIMXBk4IftSrPNBJVk0OoC7ice8HGS8XBKDoz/YFBLaQi392lGpCMJfhD9xVkx5Xbj73P9V4m1j0v73x9FjDDPlYvATkgFAVWcdNvJBamliOjAwRV0EpeRymAe717kMYRyy/j5FwFBX0fP7Dyx8gq8wn2ZXi8GfGYR+lFcGJSxa3Y84WgzBHetlU4cvKY44Ps4iP9fsgsPGEhQTAcHqwwGCj61SoPexKwasXFqtxq8qhD9SixoBBYcJEDNzmIoi3J7QkoJActVHocTVpPBCDhElAvMDK1PT/Sq3DwB/ygmyB9GNhYDH4so4Foy48kkPtZfZEv1PQTxYpyX0EI3Bu+/5krcN8fgwVdwWu2JNVNWAk+PcOOPMNdGFyAZ5Aj6gicgzNfwuHZg0HrLxBWfjSRl88fVCo/apX/IBrIvf65ZxtEoK9Bec4KZIPLe76osQns46NwW0pUPCPAyMc4A/KXOwZzFLGbAqD5xhhbgBcWfoJBAlarcCSQgdQJ+Movnih4gjZQTw51rz588y/ZgxVUEAQ8soCfX8OR26JwujCLGFAMsOjnwGrlPuQw9D/PPv8BYVR7pG/eeFtQpsLzR2KFI8SwKj9KlX++HeLOPuSBKrKeHBi7L4b+Kx184+ptAp4Trcscv69oARVYzWgaK01H1X0K3zNSmARKtxXYHvwJuT+8gLGGWgpHcWOmBeljFB2Ckg6wiAYOqfxEK3GMCAj6kIiTWdCBCXhkjUKMgJcLk271N9uLSbtvvK0S69OXAvoA5z94VsFubbmZvx4QAnXgBnJxENyQjy38wef81uPhxMpPJIQzr5ckuUTKe0wZyN57iFTWga8GvCwlh5UqvYgmaNV9XSxEVWs40kkosFwA70RgNOu8mLZfR6wDiwRa35y7j08NksqPQhcfkRBK/J8R75Iz+9C8gJpqzwiIeZII3QnYOkJWbVEI5jNuA+o2BwK82ifwnpSgHwaC+GNAdmW2VXfC+vPu6wR6lBj84C9WfvivZyUhZMJlJhjSukDlFJ3g4AvGJfC1iEpQJ/CaEd7G9wds7p71+odruKrHip/C7RdsxeVjzIxhoNkFGOW/+sk/YVAGtltfzZAIfzix8gcHhZCXpcGN2u69qWqD9OlRFAy7x2fQBhHUiETB+DocqvArYt98f+AEAXApsEmEcNLC0t2uPHCqPQIXwHYDfI4/9+8LMpchqr5HK39MJSrBXwnutNqjovjHFdq+fcHLp7YLR4mGgduW5hFpAXUoL4cTTuW5HJSkB5PC0S7A+8c+837DyoM1J9iv/po/o3BunlDqPjOSO/YbLFd+FGy9sxKFeT8b+nLNPrkAyD53FtT27yUS32yqUaEGTMBiASGcZ0FmK8nWxbvjC1q6WQC4VdWdAcBY8eFoAzIrC0b7Wt8wlPcIdE1FhUWeKU1Igv8Q/0dl4k/NnYSxdlDon8diUDeuQB4c8XVzcahRgyyZmNC+LAgeCfSVALde8/t1DCYawNoePGT83wlOpFUdOZKwxn89OsMEf0X8CxJCBN/dwKbFwkSMgx0ACJJDJD4iC1JEYh6XcEqVHpx4+J4I4UiAl26r5x64sttvSlAn3LBuQCz6edU8C+J5epBrC4YP52EFDgHrCw1B0eU9bOaTgh3wmYvQV3Oqqcf53XnVNXUBELX1xtSgFrirlII5d3HFulxBCNEfZx0h7K2f34XwdHpuYQcguN189Ow/nPXclaUcqMH5leCXjKOjbv3F0a7i2ZaRHmBe5zwnhA9S736ZC8AH8LHkg/T5znYgmES1dtuzGo92qwHIquiWX+4KgVLd8utv9Ml1BQNhEJW/FOgweiTguCUoQHkEwYhjfQIgm8eAzPKzHqAG5xGiiPyxeGRRaYetUpDVpHVC1T9bHGyaknb/TQTnuG7rDYwYCUT7/cMjtILzA+Go/FPw581F/mWeTkDuBsBCAK8ki+A29nMzPn4Rzjv6QV7xWW4fzQFUxb9jQQ1qc28kMi4mDl1NBr4usIsz5ltZqNm7AeJXfuTHd7nioLEyPBISU+8/tP1AC4Il/n+YGmjg2NiBRdl6yCw//zG5ph7bqaBuz8B4VMU/TqSsNPbwCeZA1cdxyG9SgKzRZPL+GXFOiH1/SFZ9wX8M3zUgvH8a4rMBjZj/h1W9MrwTiN6MlsCKiI4gycBzgV/xUaQGjGDHwHiYi0VIzeEAasCpNuL76AC7BIEl7i4AIxnAfoMxk35eJbZ68wWEUChs8IPz/EEE9BkUoNA4RCWSLJkY1h0Y/dG9bVCtUVPe7QRhtStXG4nOECDfUxc4Uw/Ik8JkA9o9+a83IrfHH11EdFUWc4phNgVFWkPsIHBnCvCCYBSgqEN9qtoXuwHhByYoJJA7BxIkkRwpDGgAHo+vQ3ZGOwCFJCJKUAx4MBpFZWvReeLgtBBkDDQu2OJxXa7SE/P4ZiUPHABjY1DsFIhPAaygWewiXK72hHjow/k8gCL6gKES8qcDZ7A+EhYlWCPGCX1wXIwzkQEKt8cP6iqkC0FEhFj/ZYtvXCtwuBLcDT5wXN+9H6ZEIkTwV/x/s78fXFX3siWHEKrC3tw7EFZ31Ll7ttknQyEMGgAqCaVe1bGk8r8nFWCQQR0h7CY0dsU/mIeIuA1AGCo02Q0YVXxub36sG1Qgfo0CBBUXxap+ECFEycQVyViBEBFPt14TK9rZHB9EwMG7DPXOv0OVHkdtx7OSCXfb3av4CFZGTwQBwT7/hKPHE4PzpJ4L4+FM9r1n8B+B+9R9I4Fu9brYUZgCunZWNxdQgIs8mASBQ4F8hJpEiaf4GPihk8FdAxin/kybjZjTj+mAQy6ihZ9whDvHAWB6BKrBXQr+5SBfqPaINwiz12UIwoTmbPACZY/fshBBBKNlW8ZCHwH/cVKSOZMm4Mxk4OwE9JeB+EFkn1IzcPQoiSB4vGgNeJSoik1A7m0TCmE/HrggB+/1M12C1Z18ACGoIeH1pH2IhAqFWgBq+kDFEWAvA3X8tpW0cnSD5WAOriOHhnYraF1eLTkS8P/QsHUBdtMPnOrMaANJE9AZiaKWII5Ue/8PTHn/UcCSTgIF2xN4zdmAQYIAKeBFl6FiO0aKfq5jcImHfPwTxcEdRmD3LcFoAva1Hdjm9UgGggI9YOoPkOBYLsT8HlG3nucMDGkOOJ8CkNOELdSO7D5qqAeJYBb2GpABgRi2gxLITgrOQ9C937HgB+0i7MeRx3gfPWCXLtgbLJAu/gCFBPzRX8eADJqCvA3FViC/BlOQC4LZyrBq8BdQAOUKoKjqR7v7EFfVFMojPgEoSlJesNIePyLHwW9NRgq7E6HvUN8A0yj0wyWDHRZ3J2A1jHdMyu3hCGwSDwdRir7h9VP7AKLgPoMCgKziOFLtrUm8aIFHlgxYfz8WBYUU55iAXauo+evJaIK/NTgRJM9sUcZRzcCnMdNKMJc7usnAyrpxHYkTRHK+n1HxS01LheAHqRWwKIDqLvQC0+PupHZgBawfVGsiniTVHwZHRqbUI/D4Cd+ftgyLAR1ehkIiqaKFw7MJEwUIuK5zsu4svoFYCFKgBJZACBuppOId2RDkPZas8H9kULcA9a0KTCQDGtpnzT+RMJiOGseHl4BQ1C29AWUXIIf/OIwwqoNEK3SCuA7FRiBrE9B4/PcrGJ1OQNj83F4Xbol/TgVHfMiIZLAdcaVkgh8sLrd+liNQH/FqsNTfj15m1J0X+ffZuq/gTY7QnvIfJz6UzBJLs83ItQpt3RfZz5iuGfNPajpngUm0R8DoA5jDlzsOTAwZjzsC3Jjxg7H914PjlcskGdghgx9HG4OOQH34uwQyzz61/0qiYNQjXxECuWYbGM/DrjtPH/Mw/K+gBLLSA+cEfPr4MroArzcDuybbr8Zc72i2UnzeHnTgzD4Ug78SzIvCoARVOQxaFFR3TzWnkkHUVFShEuqKxZnKz4p4YYcf8ZhYhuu8wFgSHcuuwCJagI4bgchJQK/qe9c/RT6nGcg6KGREJpb+MI0EY/b0jcsni3AJBeCQNsBOFVYoApcM2Aom4VFgIRdHpeIG8D3YaxBD+qCiQ+rBOSVnci8hzkAG1t/pgHA4uwDzmu8xFKkkkIqCfkIRs204r/hiDgutoAAcowBMZ9+KS0CcXVBOHCvJw2jMQSJyeoeExF2DuTuRcuWAo9sefyUQ6/oBaIjPtiRH1KvQKvygAHb171d+vc4GRMDPoxN/kL5pwlVh1mBQ1quQJAJ5j0TgOAis+h8d3mnC8xTKE34+8sDNjyVXE6nFMN+H39TQDmocHScENvN74LoGScGU4f7g6IG3n3C3qnG6JBS+Z5tHOOzRYQx+u7MZmAl0OSsRLAS/VIKfRAWU92+12aaVPksGDBWQuCMvgNy2M2Mt8EwqbjosZAec5xLEAmXmcFTHiOWARWglpNpjdEtBQRxJJU5VL5/7F1X86XntXgUK4q+KggsUoIIK8oA+kgy4+zLaACqQGTVOX6MBWdehL6BxHn+tlyBMDGAqufd7WOX5WTJwKYDfXJJP2GXDPk7Tj5Ed7BOG7DMFaBRAJgI/+H2Ngeb2SKb0zkoGlQBHkefDr7xMA5HZeJPtKIzyApI9gmnPgf1c3mulfhe0gFekDCdNFnrOwi4Gs6eTACNjB+Uegcgojog4V25P8bctRYY6RL8AJklE9ACFAGZdBEahd4d4CmghFhbzcwaXYH5qTlS6DY+KfNH5Avzjo2JJ0poDkSCMxLn73H/eB+ifvgvyIFCWAji7BWC8hd0qj0FziMdrS70BlVbgamIgcmotGZDNPwm0L9l5iHv7WRoAFx57ScFS2r2iwot8oKu8l+TOCOg2mZ2nFdjTgOFQENzKkJ8OjEnsE8f6AzyXwT6MNF3RDRnuj0Lwo6wTlBMDIyqaz6G+RiLJMg/KUrQV/rh9uH0tWduwoxmky0kSMQ+rnXxZsGadgnxfgk1pCnsIsGYltvfdzTOBIclIsN8MLAGcz5gBwj94AE8DuC9Molip/JGwB57nRyJiyD3pyk6q5ij+3TzRLohcqyqCEQBTepF15+WVmW8SEr5jMUUkx3oMIsrH3ndwAQganKzyMpOJNxMQooGBYwcByw7axIhgPRGEr6GSGJhkAELoQ1YRg+dPeD5IIRDIqq5PA2Jh0Rq0YcS8XBi0ghGRFpCtWTdum5+yLOsQf2EuYY8AfnbQZDgCjHxBSKwTGpt8QCIDVH3/4H5OwEvldhliINwAFLsEyyIfGKV+vm3eEehVqKTdNxtDiPoLHCRiuwTJxCECxMDqDjTvZ63KaPKvRgV2i/F3ohm88V8LN8hgJcXD5pVGIPPNn9EBqSQC0I4AMxBUcQNCkarkFgSn/oCs9GCVep4eUG5BRAOcQOCWlGSc3If0IFqRfURQGRrKewPKEJ9sLnIowKCcw+f48N6UHjqYtgInaCCkBbPSj8VEkCr2g8U43wY1xX/BNkwreQrzg+oaJghOCGTU8RBxuIp6VFOGoEXgEsBLIgV6gBgxoLSI5CgiYNT+GBHsU01GthrceiMUtv9KgAYktgVNeGrBbtiOQVi9x8WjiAW7UNUnm4Vet7WtsFgDCDYEwQ/EVL1PnQf/xCDLTowTh4c4HPRDoQaiwhKIAae4B7xgCBydI/CDPOrevK0FR4p6w3VfoXgQiB3T1N8Y1PCD0X19JqcHGfzB5WkQE4p/kdeXBcEVUXEIFqSij82lMyrWq/7c+LFHA7z5/dwOHHg8s/Y8C2CmhbmALtare+4UWLfb25BmXABKABTniC8gRAP2yvDAiUAsElnrxFzITQa/sAFecAOY7zPV/8jMQHSbWAiUPGkQNABhw85xrSCv+mMSzFR8+7mjw01A8f4F8S/td4jnDHYxpT8/OEyV3gz2+GTfdAeAszswfJNGlQhEIjB0Bls0BKn4Iw7WKu9f1gmSagmvqleEwJwnZwjO7npz1HdCJ1hS/mlBcRXyF3i/M7NxqJFoeH27z7nnJaBmpUZKHsTbGUc1ALEoIGsGYl9ixS50gjAT/VhB8IzvGTrBVfWEz1MzAkRFTtecW731VdjNQPukVdhdn0Y8d/a7WYH6i/TBPBzUFwAlHwtGHOQISrgb1AMUgDETTA3+THAdeRJhg59V/Ektofa9I8wxVICkC7QQSAd2O3cftzPzdMK6aA4iZI4ILfYRbb9RgqICt2AxVnYZ4kkBvHOBxT/zN9ybHx/f5Ql2fkGCX6ANm6F8WCfqAS+Eq5AGcHJd2IFHagTMHAAj+mWBnDXuc81CjhsAi5dL2K8QCYI1aJ/PJtSSxEFXASv7C2I3ZB9/a0j/7nDn/j1pHsz9Jr8fNpxPBUAUUYD4wz5GBlmyAiORjtAIGDFwzSUwqiNZ1d1tPiB7/Q9VeI9KeJU16/knkEeQJEALjY4rkp74fCZiMDSA/PgvT/aT2gYgp5E/P29AKBQAo6TRth5T4VesQFb0i4K7RA2MZpgyFXCEQHCOixuYMPgy2L7+45ezSSKt2oUkURlpXkEMOLSiXPuDQZjk63N5bmzOSxQdLHX7AhwUEA0BAeQPJIQzkAuFlOK/GtyLdiGDKEBdllQ7YouxV2Xdwza9So4Kp5Z0yAgUhTlJgFzSFrznIHYIwKcCu2/L3LsCg6UI1b1/CA+ApIV5/32HqOIjdQusE4azip5Wc1b0q/QGIAlaWEJbXP3r/L+AEipw/+BtkQVY9fIM2i/ZhgVEgJO6DZ1ksVtlYdoQAPhVO0oKmYBmnAYco4DRCRB3TwCziptaE0auER9/VzRqKNOEYINOQg2m1l9GpGNQAhh1v6UmxNQh2M4+LmlUzll0OTjYQOaGlZAEMCrdhmBphaMBwBADrSQQc3//He8KgFETT7p6BHnjj2X9EXsDjrgBS6ihoAmcSQVYmE4JgYWFpp1waAQRoqDzxDhU+HxSnZHz/9JEY6Y5MJA+cwoWrt99+U3Mc/9g/NQTFaigAEtwB1yBzwzucZSX7RZEILhR1d5GDCsBLVUdIQvsldZfEJt5i/MHx2hGJZFkVVyK242iFeh58oBUFqIQbkfp2DV2X0CkAYgv1sU+P+I/HmBu8nErugdRnUWhfp+A/ddlbEH3uQlBsNobUEMHasK1HOYn8BEEvCUaiuigXRIKj+sGOPA4KAWz9/s7WxcgB4+a6/fI2osEwv4yOENAiPf+wQhbc/5f0gGisWuQaRFmGoIqguARWsBQgTTocDLMT5OJUQnhqdCEig+/EShKSEgTVV0MBMnz04BcshPnLk/+OaV0/dwKzB4QUt1NB6uTDfGOP+cNm9mEsBAFiM7AQh9AKVEU75vy68jeOxrUC4mDEuYO0oLqoSdHaEF2eXYYSm0V+oEOwpLmYFOF3Z4CmAeBTIGueiIw2xoKPzDBJVBXQ5g5O8/twwA+QguIjJt3+g0NQEcDfUXgO5gsqlTBLkQLdl86K3CWneitQ8sg/5oWAUJP2C3V3RoEyji5n4b9lB4t9pz2CA+cAFn1Z9I/uzYsU/ELtEBOCHYQQqGcFejV+yeuRJX31zsKV5IGjway9z6PLDxKwNEPsBuOEiqw57jGgOtZ1Y++T50AuMFl7hPIbhskiOwsATtRoc7rS7dXrpcgrMCGJca6ELJo+Y0be0BW5ZKGcFz4y8W9BduwcDnK9iO5fagsKpp9ANnvDPxeP8THNyIVFo1AMas8Qk5v2Ytm0LCCYAXqn+wQsPTBh/5Bcnne14Os3uCQt28vsK1WUESJFviBgAW//3u9PLxusXchcCR2WsNzv/ImvgZzzkUByDUAIrjTvmSHAowpJBQE4SUlxMxnARlQbIqkArVAJ6pBBvELCCKlkyCDAP45BYfEPfcUpfMch3Vn4bheYK4E66BxAxHSVd5INgEPgU/NBCDfNQ8Ho1CoINAPQAW/QT8OCIZlNFCB84XhoDChFByHGjx35v9BLgyhmojqHYb5QYXnuAecvua0hZe6BV9f7v4ibvgvamrmAc1TmaEir0LQ9h97eYAYVoM/nWA60i8Q3Ifezha9BqaaL3zvqd6IAuwwLSCCuCLuJWch4h30giPtyiAphKEBcCu9BV5wwzkMxID8rhMwdwMhcSFgrBT3RUTQboAUg3+p+Qe1IGarOioVnazmefV3lHpwA0AcLWCahUiXwePHWJsP+GH1gnp/we5KfOhJAbsj0H/BIEb04TbrTPsAyb2LLu93KwfCvn5PLAwrOXAa72eEQRo1CNdw5IprsAZ3hApy9zlcITG2vpCihsRSYxNS+J4vdBZ6B52eqRcQ/QXmSjAWSfa/5GA5qEg4iJFtm624AqXLrSA2gx8p1Mdqcghv41S0lSp/xAYs9gakQc4Ie2RTUYwYgt748mV+FU1Xgp14eW3XYZ6cdqGTNHwHICTwEeTPl0jEZwIgP9gDEaogeg5IHWCF+1eoAhvEKPB/EAeTRsM/pSAP5wjWEUMM1/NJRhwJbpJSgK7S7zF3EOsI5jBQBK9DV80Z8Y0COzvmWzJXgDl40KEC6cqvqgi4OB5cpgLFYK/1CvDiItXqC6/S87wfAUfPtxqfGNzlYaOjlf1IsHPPvffHgDAoEeEST4ZLZUd/RSo91/BjXY5ggWgQ4In3fyj4mUqPrInHOCLKO3wUwRsfyXpt1nEIRLrqcWeTuk7bigsbid1zD4iDRQtnIdQsyIXnFCn1I9D7ADgxEhOvR5AJosoUbu1FkJyYCi9OhQERoIx+4AX/YqUXQhtYEwKN4Cy1HntLMmtaAQpqfrT/UCoLSxeswjA5UWPPi0mjajUWxMTdVusNvt/ChMdmILK5IRMFu90BMEzFYHdg2GAgeYVHMMJIBTA7EFTx/5fpgTFXz9w/en0ZjD8kCDoKPNGwlB01BmoWQbh+AxR689mBponGJOr9OwmMu3dtJ/ylW1Tik4ElUPmR9RqII+pVhD9ychABMQ51gOIZg+/G+5mGIzLB1JJC5WhzYjhJ7IWmLDpA8jzsAafUPkB2WnFBF4iSxkq1ty7f25rv/+EQLOxs2oUdTSA9HIR9swdBlCcFe9owPC3XWDDC0ISVzsEVbSCF/sWdA5Fu4HJqankp2SeQCYYrImNalfmhpVxYrGkUS4LeSUjg8dD7+D7w/ybIfy7vlB9/HJ978zr7/45Qgajzj+4EjIK/ULHPRAOlKr/aG0AFcqCyu0GcW45Igh6JMJmhA49/U+cEssHNJhtXDC1MOya3j/sAiAGcrEtqtgjBD6wEzSDc7D8o6C8rIqAZyPk+NQoNLAZ1hR64Yl1FBY648smUYKnSg1Xwk/0DyRyArByMUobyByhCcPnOaPyoegREFS4jNfYAw+IHCjdC1J2WDZBke/OyN85J24WiXwDYPoJyYuCD238ulvuzwt6KgHf0shWKsqCFFGjB/w8HU8eeTED9wAAAAABJRU5ErkJggg==","EnvironmentBRDFTexture"+F++,t,!0,!1,o.b.BILINEAR_SAMPLINGMODE);t._blockEntityCollection=Y;const R=t.getEngine().getLoadedTexturesCache(),d=R.indexOf(r.getInternalTexture());-1!==d&&R.splice(d,1),r.isRGBD=!0,r.wrapU=o.b.CLAMP_ADDRESSMODE,r.wrapV=o.b.CLAMP_ADDRESSMODE,t.environmentBRDFTexture=r,t.useDelayedTextureLoading=b,x.d.ExpandRGBDTexture(r);const E=t.getEngine().onContextRestoredObservable.add((()=>{r.isRGBD=!0;const b=t.onBeforeRenderObservable.add((()=>{r.isReady()&&(t.onBeforeRenderObservable.remove(b),x.d.ExpandRGBDTexture(r))}))}));t.le.add((()=>{t.getEngine().onContextRestoredObservable.remove(E)}))}return t.environmentBRDFTexture}},11744:(t,b,Y)=>{"use strict";function o(t,b,Y){try{const o=t.next();o.done?b(o):o.value?o.value.then((()=>{o.value=void 0,b(o)}),Y):b(o)}catch(o){Y(o)}}function x(){let t,b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:25;return(Y,x,F)=>{const r=performance.now();void 0===t||r-t>b?(t=r,setTimeout((()=>{o(Y,x,F)}),0)):o(Y,x,F)}}function F(t,b,Y,o,x){const F=()=>{let r;const R=t=>{t.done?Y(t.value):void 0===r?r=!0:F()};do{r=void 0,x&&x.aborted?o(new Error("Aborted")):b(t,R,o),void 0===r&&(r=!1)}while(r)};F()}function r(t,b){let Y;return F(t,o,(t=>Y=t),(t=>{throw t}),b),Y}function R(t,b,Y){return new Promise(((o,x)=>{F(t,b,o,x,Y)}))}function d(t,b){return function(){return r(t(...arguments),b)}}Y.d(b,{c:()=>x,d:()=>d,g:()=>R,k:()=>r})},10704:(t,b,Y)=>{"use strict";Y.d(b,{c:()=>x});class o{constructor(t){this._pendingActions=new Array,this._workerInfos=t.map((t=>({workerPromise:Promise.resolve(t),idle:!0})))}dispose(){for(const t of this._workerInfos)t.workerPromise.then((t=>{t.terminate()}));this._workerInfos.length=0,this._pendingActions.length=0}push(t){this._executeOnIdleWorker(t)||this._pendingActions.push(t)}_executeOnIdleWorker(t){for(const b of this._workerInfos)if(b.idle)return this._execute(b,t),!0;return!1}_execute(t,b){t.idle=!1,t.workerPromise.then((Y=>{b(Y,(()=>{const b=this._pendingActions.shift();b?this._execute(t,b):t.idle=!0}))}))}}class x extends o{constructor(t,b){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:x.DefaultOptions;super([]),this._maxWorkers=t,this._createWorkerAsync=b,this._options=Y}push(t){if(!this._executeOnIdleWorker(t))if(this._workerInfos.length<this._maxWorkers){const b={workerPromise:this._createWorkerAsync(),idle:!1};this._workerInfos.push(b),this._execute(b,t)}else this._pendingActions.push(t)}_execute(t,b){t.timeoutId&&(clearTimeout(t.timeoutId),delete t.timeoutId),super._execute(t,((Y,o)=>{b(Y,(()=>{o(),t.idle&&(t.timeoutId=setTimeout((()=>{t.workerPromise.then((t=>{t.terminate()}));const b=this._workerInfos.indexOf(t);-1!==b&&this._workerInfos.splice(b,1)}),this._options.idleTimeElapsedBeforeRelease))}))}))}}x.DefaultOptions={idleTimeElapsedBeforeRelease:1e3}},11871:(t,b,Y)=>{"use strict";Y.d(b,{c:()=>Bt});var o=Y(1019),x=Y(1452);class F extends x.b{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var r=Y(1229),R=(Y(1536),Y(1041));class d{get noiseTexture(){return this._noiseTexture}set noiseTexture(t){this._noiseTexture!==t&&(this._noiseTexture=t,this._reset())}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(t){this._isAnimationSheetEnabled!=t&&(this._isAnimationSheetEnabled=t,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(t){this._useLogarithmicDepth=t&&this.va().getEngine().getCaps().fragmentDepthSupported}va(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:o.l.Zero()}set direction1(t){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=t)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:o.l.Zero()}set direction2(t){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=t)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:o.l.Zero()}set minEmitBox(t){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=t)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:o.l.Zero()}set maxEmitBox(t){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=t)}get billboardMode(){return this._billboardMode}set billboardMode(t){this._billboardMode!==t&&(this._billboardMode=t,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(t){this._isBillboardBased!==t&&(this._isBillboardBased=t,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(t){this._attachImageProcessingConfiguration(t)}_attachImageProcessingConfiguration(t){t!==this._imageProcessingConfiguration&&(!t&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=t)}_reset(){}_removeGradientAndTexture(t,b,Y){if(!b)return this;let o=0;for(const x of b){if(x.gradient===t){b.splice(o,1);break}o++}return Y&&Y.dispose(),this}constructor(t){this.animations=[],this.renderingGroupId=0,this.k=o.l.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this.targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new o.l(10,10,10),this.onAnimationEnd=null,this.blendMode=d.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new o.i(0,0),this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.rg=new o.l(0,0,0),this._useLogarithmicDepth=!1,this.gravity=o.l.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new r.h(1,1,1,1),this.color2=new r.h(1,1,1,1),this.colorDead=new r.h(0,0,0,1),this.textureMask=new r.h(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new F,this.id=t,this.name=t}createPointEmitter(t,b){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new o.l(0,1,0),arguments.length>2&&void 0!==arguments[2]||new o.l(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new o.l(0,1,0),arguments.length>4&&void 0!==arguments[4]||new o.l(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new o.l(0,1,0),arguments.length>3&&void 0!==arguments[3]||new o.l(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(t,b,Y,o){throw new Error("Method not implemented.")}}d.BLENDMODE_ONEONE=0,d.BLENDMODE_STANDARD=1,d.BLENDMODE_ADD=2,d.BLENDMODE_MULTIPLY=3,d.BLENDMODE_MULTIPLYADD=4,(0,R.d)("BABYLON.BaseParticleSystem",d);var E=Y(1058),U=Y(1268);class C{constructor(){this.direction1=new o.l(0,1,0),this.direction2=new o.l(0,1,0),this.minEmitBox=new o.l(-.5,-.5,-.5),this.maxEmitBox=new o.l(.5,.5,.5)}startDirectionFunction(t,b,Y,x){const F=(0,E.p)(this.direction1.x,this.direction2.x),r=(0,E.p)(this.direction1.y,this.direction2.y),R=(0,E.p)(this.direction1.z,this.direction2.z);if(x)return b.x=F,b.y=r,void(b.z=R);o.l.TransformNormalFromFloatsToRef(F,r,R,t,b)}startPositionFunction(t,b,Y,x){const F=(0,E.p)(this.minEmitBox.x,this.maxEmitBox.x),r=(0,E.p)(this.minEmitBox.y,this.maxEmitBox.y),R=(0,E.p)(this.minEmitBox.z,this.maxEmitBox.z);if(x)return b.x=F,b.y=r,void(b.z=R);o.l.TransformCoordinatesFromFloatsToRef(F,r,R,t,b)}clone(){const t=new C;return U.b.DeepCopy(this,t),t}applyToShader(t){t.setVector3("direction1",this.direction1),t.setVector3("direction2",this.direction2),t.setVector3("minEmitBox",this.minEmitBox),t.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(t){t.addUniform("direction1",3),t.addUniform("direction2",3),t.addUniform("minEmitBox",3),t.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const t={};return t.type=this.getClassName(),t.direction1=this.direction1.qe(),t.direction2=this.direction2.qe(),t.minEmitBox=this.minEmitBox.qe(),t.maxEmitBox=this.maxEmitBox.qe(),t}parse(t){o.l.FromArrayToRef(t.direction1,0,this.direction1),o.l.FromArrayToRef(t.direction2,0,this.direction2),o.l.FromArrayToRef(t.minEmitBox,0,this.minEmitBox),o.l.FromArrayToRef(t.maxEmitBox,0,this.maxEmitBox)}}class p{get i(){return this._radius}set i(t){this._radius=t,this._buildHeight()}get angle(){return this._angle}set angle(t){this._angle=t,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=Y,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=b,this.i=t}startDirectionFunction(t,b,Y,x){x?o.f.ae[0].p(Y.vg).normalize():Y.position.subtractToRef(t.getTranslation(),o.f.ae[0]).normalize();const F=(0,E.p)(0,this.directionRandomizer),r=(0,E.p)(0,this.directionRandomizer),R=(0,E.p)(0,this.directionRandomizer);b.x=o.f.ae[0].x+F,b.y=o.f.ae[0].y+r,b.z=o.f.ae[0].z+R,b.normalize()}startPositionFunction(t,b,Y,x){const F=(0,E.p)(0,2*Math.PI);let r;this.emitFromSpawnPointOnly?r=1e-4:(r=(0,E.p)(0,this.heightRange),r=1-r*r);let R=this._radius-(0,E.p)(0,this._radius*this.radiusRange);R*=r;const d=R*Math.sin(F),U=R*Math.cos(F),C=r*this._height;if(x)return b.x=d,b.y=C,void(b.z=U);o.l.TransformCoordinatesFromFloatsToRef(d,C,U,t,b)}clone(){const t=new p(this._radius,this._angle,this.directionRandomizer);return U.b.DeepCopy(this,t),t}applyToShader(t){t.setFloat2("i",this._radius,this.radiusRange),t.setFloat("coneAngle",this._angle),t.setFloat2("height",this._height,this.heightRange),t.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(t){t.addUniform("i",2),t.addUniform("coneAngle",1),t.addUniform("height",2),t.addUniform("directionRandomizer",1)}getEffectDefines(){let t="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(t+="\n#define CONEEMITTERSPAWNPOINT"),t}getClassName(){return"ConeParticleEmitter"}serialize(){const t={};return t.type=this.getClassName(),t.i=this._radius,t.angle=this._angle,t.directionRandomizer=this.directionRandomizer,t.radiusRange=this.radiusRange,t.heightRange=this.heightRange,t.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,t}parse(t){this.i=t.i,this.angle=t.angle,this.directionRandomizer=t.directionRandomizer,this.radiusRange=void 0!==t.radiusRange?t.radiusRange:1,this.heightRange=void 0!==t.radiusRange?t.heightRange:1,this.emitFromSpawnPointOnly=void 0!==t.emitFromSpawnPointOnly&&t.emitFromSpawnPointOnly}}class W extends p{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new o.l(0,1,0),x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new o.l(0,1,0);super(t,b),this.direction1=Y,this.direction2=x}startDirectionFunction(t,b){const Y=(0,E.p)(this.direction1.x,this.direction2.x),x=(0,E.p)(this.direction1.y,this.direction2.y),F=(0,E.p)(this.direction1.z,this.direction2.z);o.l.TransformNormalFromFloatsToRef(Y,x,F,t,b)}clone(){const t=new W(this.i,this.angle,this.direction1,this.direction2);return U.b.DeepCopy(this,t),t}applyToShader(t){t.setFloat("i",this.i),t.setFloat("radiusRange",this.radiusRange),t.setVector3("direction1",this.direction1),t.setVector3("direction2",this.direction2)}buildUniformLayout(t){t.addUniform("i",1),t.addUniform("radiusRange",1),t.addUniform("direction1",3),t.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const t=super.serialize();return t.direction1=this.direction1.qe(),t.direction2=this.direction2.qe(),t}parse(t){super.parse(t),this.direction1.p(t.direction1),this.direction2.p(t.direction2)}}class T{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.i=t,this.height=b,this.radiusRange=Y,this.directionRandomizer=x,this._tempVector=o.l.Zero()}startDirectionFunction(t,b,Y,x,F){Y.position.subtractToRef(t.getTranslation(),this._tempVector),this._tempVector.normalize(),o.l.TransformNormalToRef(this._tempVector,F,this._tempVector);const r=(0,E.p)(-this.directionRandomizer/2,this.directionRandomizer/2);let R=Math.atan2(this._tempVector.x,this._tempVector.z);R+=(0,E.p)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=r,this._tempVector.x=Math.sin(R),this._tempVector.z=Math.cos(R),this._tempVector.normalize(),x?b.p(this._tempVector):o.l.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,t,b)}startPositionFunction(t,b,Y,x){const F=(0,E.p)(-this.height/2,this.height/2),r=(0,E.p)(0,2*Math.PI),R=(0,E.p)((1-this.radiusRange)*(1-this.radiusRange),1),d=Math.sqrt(R)*this.i,U=d*Math.cos(r),C=d*Math.sin(r);x?b.be(U,F,C):o.l.TransformCoordinatesFromFloatsToRef(U,F,C,t,b)}clone(){const t=new T(this.i,this.directionRandomizer);return U.b.DeepCopy(this,t),t}applyToShader(t){t.setFloat("i",this.i),t.setFloat("height",this.height),t.setFloat("radiusRange",this.radiusRange),t.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(t){t.addUniform("i",1),t.addUniform("height",1),t.addUniform("radiusRange",1),t.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const t={};return t.type=this.getClassName(),t.i=this.i,t.height=this.height,t.radiusRange=this.radiusRange,t.directionRandomizer=this.directionRandomizer,t}parse(t){this.i=t.i,this.height=t.height,this.radiusRange=t.radiusRange,this.directionRandomizer=t.directionRandomizer}}class y extends T{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new o.l(0,1,0),F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new o.l(0,1,0);super(t,b,Y),this.direction1=x,this.direction2=F}startDirectionFunction(t,b,Y,x){const F=(0,E.p)(this.direction1.x,this.direction2.x),r=(0,E.p)(this.direction1.y,this.direction2.y),R=(0,E.p)(this.direction1.z,this.direction2.z);x?b.be(F,r,R):o.l.TransformNormalFromFloatsToRef(F,r,R,t,b)}clone(){const t=new y(this.i,this.height,this.radiusRange,this.direction1,this.direction2);return U.b.DeepCopy(this,t),t}applyToShader(t){t.setFloat("i",this.i),t.setFloat("height",this.height),t.setFloat("radiusRange",this.radiusRange),t.setVector3("direction1",this.direction1),t.setVector3("direction2",this.direction2)}buildUniformLayout(t){t.addUniform("i",1),t.addUniform("height",1),t.addUniform("radiusRange",1),t.addUniform("direction1",3),t.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const t=super.serialize();return t.direction1=this.direction1.qe(),t.direction2=this.direction2.qe(),t}parse(t){super.parse(t),o.l.FromArrayToRef(t.direction1,0,this.direction1),o.l.FromArrayToRef(t.direction2,0,this.direction2)}}class v{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.i=t,this.radiusRange=b,this.directionRandomizer=Y}startDirectionFunction(t,b,Y,x){const F=Y.position.fd(t.getTranslation()).normalize(),r=(0,E.p)(0,this.directionRandomizer),R=(0,E.p)(0,this.directionRandomizer),d=(0,E.p)(0,this.directionRandomizer);F.x+=r,F.y+=R,F.z+=d,F.normalize(),x?b.p(F):o.l.TransformNormalFromFloatsToRef(F.x,F.y,F.z,t,b)}startPositionFunction(t,b,Y,x){const F=this.i-(0,E.p)(0,this.i*this.radiusRange),r=(0,E.p)(0,1),R=(0,E.p)(0,2*Math.PI),d=Math.acos(2*r-1),U=F*Math.cos(R)*Math.sin(d),C=F*Math.cos(d),p=F*Math.sin(R)*Math.sin(d);x?b.be(U,Math.abs(C),p):o.l.TransformCoordinatesFromFloatsToRef(U,Math.abs(C),p,t,b)}clone(){const t=new v(this.i,this.directionRandomizer);return U.b.DeepCopy(this,t),t}applyToShader(t){t.setFloat("i",this.i),t.setFloat("radiusRange",this.radiusRange),t.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(t){t.addUniform("i",1),t.addUniform("radiusRange",1),t.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const t={};return t.type=this.getClassName(),t.i=this.i,t.radiusRange=this.radiusRange,t.directionRandomizer=this.directionRandomizer,t}parse(t){this.i=t.i,this.radiusRange=t.radiusRange,this.directionRandomizer=t.directionRandomizer}}class B{constructor(){this.direction1=new o.l(0,1,0),this.direction2=new o.l(0,1,0)}startDirectionFunction(t,b,Y,x){const F=(0,E.p)(this.direction1.x,this.direction2.x),r=(0,E.p)(this.direction1.y,this.direction2.y),R=(0,E.p)(this.direction1.z,this.direction2.z);x?b.be(F,r,R):o.l.TransformNormalFromFloatsToRef(F,r,R,t,b)}startPositionFunction(t,b,Y,x){x?b.be(0,0,0):o.l.TransformCoordinatesFromFloatsToRef(0,0,0,t,b)}clone(){const t=new B;return U.b.DeepCopy(this,t),t}applyToShader(t){t.setVector3("direction1",this.direction1),t.setVector3("direction2",this.direction2)}buildUniformLayout(t){t.addUniform("direction1",3),t.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const t={};return t.type=this.getClassName(),t.direction1=this.direction1.qe(),t.direction2=this.direction2.qe(),t}parse(t){o.l.FromArrayToRef(t.direction1,0,this.direction1),o.l.FromArrayToRef(t.direction2,0,this.direction2)}}class J{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.i=t,this.radiusRange=b,this.directionRandomizer=Y}startDirectionFunction(t,b,Y,x){const F=Y.position.fd(t.getTranslation()).normalize(),r=(0,E.p)(0,this.directionRandomizer),R=(0,E.p)(0,this.directionRandomizer),d=(0,E.p)(0,this.directionRandomizer);F.x+=r,F.y+=R,F.z+=d,F.normalize(),x?b.p(F):o.l.TransformNormalFromFloatsToRef(F.x,F.y,F.z,t,b)}startPositionFunction(t,b,Y,x){const F=this.i-(0,E.p)(0,this.i*this.radiusRange),r=(0,E.p)(0,1),R=(0,E.p)(0,2*Math.PI),d=Math.acos(2*r-1),U=F*Math.cos(R)*Math.sin(d),C=F*Math.cos(d),p=F*Math.sin(R)*Math.sin(d);x?b.be(U,C,p):o.l.TransformCoordinatesFromFloatsToRef(U,C,p,t,b)}clone(){const t=new J(this.i,this.directionRandomizer);return U.b.DeepCopy(this,t),t}applyToShader(t){t.setFloat("i",this.i),t.setFloat("radiusRange",this.radiusRange),t.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(t){t.addUniform("i",1),t.addUniform("radiusRange",1),t.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const t={};return t.type=this.getClassName(),t.i=this.i,t.radiusRange=this.radiusRange,t.directionRandomizer=this.directionRandomizer,t}parse(t){this.i=t.i,this.radiusRange=t.radiusRange,this.directionRandomizer=t.directionRandomizer}}class m extends J{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new o.l(0,1,0),Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new o.l(0,1,0);super(t),this.direction1=b,this.direction2=Y}startDirectionFunction(t,b){const Y=(0,E.p)(this.direction1.x,this.direction2.x),x=(0,E.p)(this.direction1.y,this.direction2.y),F=(0,E.p)(this.direction1.z,this.direction2.z);o.l.TransformNormalFromFloatsToRef(Y,x,F,t,b)}clone(){const t=new m(this.i,this.direction1,this.direction2);return U.b.DeepCopy(this,t),t}applyToShader(t){t.setFloat("i",this.i),t.setFloat("radiusRange",this.radiusRange),t.setVector3("direction1",this.direction1),t.setVector3("direction2",this.direction2)}buildUniformLayout(t){t.addUniform("i",1),t.addUniform("radiusRange",1),t.addUniform("direction1",3),t.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const t=super.serialize();return t.direction1=this.direction1.qe(),t.direction2=this.direction2.qe(),t}parse(t){super.parse(t),this.direction1.p(t.direction1),this.direction2.p(t.direction2)}}class K{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{}}startDirectionFunction(t,b,Y,x){const F=o.f.ae[0];if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,Y,F);const t=o.f.ae[1];F.subtractToRef(Y.position,t),t.scaleToRef(1/Y.lifeTime,F)}else F.set(0,0,0);x?b.p(F):o.l.TransformNormalToRef(F,t,b)}startPositionFunction(t,b,Y,x){const F=o.f.ae[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,Y,F):F.set(0,0,0),x?b.p(F):o.l.TransformCoordinatesToRef(F,t,b)}clone(){const t=new K;return U.b.DeepCopy(this,t),t}applyToShader(t){}buildUniformLayout(t){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const t={};return t.type=this.getClassName(),t.particlePositionGenerator=this.particlePositionGenerator,t.particleDestinationGenerator=this.particleDestinationGenerator,t}parse(t){t.particlePositionGenerator&&(this.particlePositionGenerator=t.particlePositionGenerator),t.particleDestinationGenerator&&(this.particleDestinationGenerator=t.particleDestinationGenerator)}}var L=Y(1307);class z{get mesh(){return this.ze}set mesh(t){this.ze!==t&&(this.ze=t,t?(this._indices=t._d(),this._positions=t.getVerticesData(L.e.PositionKind),this._normals=t.getVerticesData(L.e.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=o.l.Zero(),this.ze=null,this.direction1=new o.l(0,1,0),this.direction2=new o.l(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=t}startDirectionFunction(t,b,Y,x){if(this.useMeshNormalsForDirection&&this._normals)return void o.l.TransformNormalToRef(this._storedNormal,t,b);const F=(0,E.p)(this.direction1.x,this.direction2.x),r=(0,E.p)(this.direction1.y,this.direction2.y),R=(0,E.p)(this.direction1.z,this.direction2.z);x?b.be(F,r,R):o.l.TransformNormalFromFloatsToRef(F,r,R,t,b)}startPositionFunction(t,b,Y,x){if(!this._indices||!this._positions)return;const F=3*Math.random()*(this._indices.length/3)|0,r=Math.random(),R=Math.random()*(1-r),d=1-r-R,E=this._indices[F],U=this._indices[F+1],C=this._indices[F+2],p=o.f.ae[0],W=o.f.ae[1],T=o.f.ae[2],y=o.f.ae[3];o.l.FromArrayToRef(this._positions,3*E,p),o.l.FromArrayToRef(this._positions,3*U,W),o.l.FromArrayToRef(this._positions,3*C,T),y.x=r*p.x+R*W.x+d*T.x,y.y=r*p.y+R*W.y+d*T.y,y.z=r*p.z+R*W.z+d*T.z,x?b.be(y.x,y.y,y.z):o.l.TransformCoordinatesFromFloatsToRef(y.x,y.y,y.z,t,b),this.useMeshNormalsForDirection&&this._normals&&(o.l.FromArrayToRef(this._normals,3*E,p),o.l.FromArrayToRef(this._normals,3*U,W),o.l.FromArrayToRef(this._normals,3*C,T),this._storedNormal.x=r*p.x+R*W.x+d*T.x,this._storedNormal.y=r*p.y+R*W.y+d*T.y,this._storedNormal.z=r*p.z+R*W.z+d*T.z)}clone(){const t=new z(this.mesh);return U.b.DeepCopy(this,t),t}applyToShader(t){t.setVector3("direction1",this.direction1),t.setVector3("direction2",this.direction2)}buildUniformLayout(t){t.addUniform("direction1",3),t.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var t;const b={};return b.type=this.getClassName(),b.direction1=this.direction1.qe(),b.direction2=this.direction2.qe(),b.meshId=null===(t=this.mesh)||void 0===t?void 0:t.id,b.useMeshNormalsForDirection=this.useMeshNormalsForDirection,b}parse(t,b){o.l.FromArrayToRef(t.direction1,0,this.direction1),o.l.FromArrayToRef(t.direction2,0,this.direction2),t.meshId&&b&&(this.mesh=b.getLastMeshById(t.meshId)),this.useMeshNormalsForDirection=t.useMeshNormalsForDirection}}var S=Y(1167);class e{_isUbo(t){return void 0!==t.addUniform}constructor(t){this._isUbo(t)?(this.setMatrix3x3=t.updateMatrix3x3.bind(t),this.setMatrix2x2=t.updateMatrix2x2.bind(t),this.setFloat=t.updateFloat.bind(t),this.setFloat2=t.updateFloat2.bind(t),this.setFloat3=t.updateFloat3.bind(t),this.setFloat4=t.updateFloat4.bind(t),this.setFloatArray=t.updateFloatArray.bind(t),this.setArray=t.updateArray.bind(t),this.setIntArray=t.updateIntArray.bind(t),this.setMatrix=t.Ge.bind(t),this.setMatrices=t.updateMatrices.bind(t),this.setVector3=t.updateVector3.bind(t),this.setVector4=t.updateVector4.bind(t),this.setColor3=t.updateColor3.bind(t),this.setColor4=t.updateColor4.bind(t),this.setDirectColor4=t.updateDirectColor4.bind(t),this.setInt=t.updateInt.bind(t),this.setInt2=t.updateInt2.bind(t),this.setInt3=t.updateInt3.bind(t),this.setInt4=t.updateInt4.bind(t)):(this.setMatrix3x3=t.setMatrix3x3.bind(t),this.setMatrix2x2=t.setMatrix2x2.bind(t),this.setFloat=t.setFloat.bind(t),this.setFloat2=t.setFloat2.bind(t),this.setFloat3=t.setFloat3.bind(t),this.setFloat4=t.setFloat4.bind(t),this.setFloatArray=t.setFloatArray.bind(t),this.setArray=t.setArray.bind(t),this.setIntArray=t.setIntArray.bind(t),this.setMatrix=t.setMatrix.bind(t),this.setMatrices=t.setMatrices.bind(t),this.setVector3=t.setVector3.bind(t),this.setVector4=t.setVector4.bind(t),this.setColor3=t.setColor3.bind(t),this.setColor4=t.setColor4.bind(t),this.setDirectColor4=t.setDirectColor4.bind(t),this.setInt=t.setInt.bind(t),this.setInt2=t.setInt2.bind(t),this.setInt3=t.setInt3.bind(t),this.setInt4=t.setInt4.bind(t))}}var g=Y(1175);const D="gpuUpdateParticlesPixelShader",H="#version 300 es\nvoid main() {discard;}\n";g.d.ShadersStore[D]=H;const f="gpuUpdateParticlesVertexShader",n="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";g.d.ShadersStore[f]=n;(0,R.d)("BABYLON.WebGL2ParticleSystem",class{constructor(t,b){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=t,this._engine=b,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","i","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var t;return(null===(t=this._updateEffect)||void 0===t?void 0:t.isReady())??!1}createUpdateBuffer(t){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof K&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=t,this._updateEffect=new S.c("gpuUpdateParticles",this._updateEffectOptions,this._engine),new e(this._updateEffect)}createVertexBuffers(t,b){this._updateVAO.push(this._createUpdateVAO(t)),this._renderVAO.push(this._engine.recordVertexArrayObject(b,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=b}createParticleBuffer(t){return t}bindDrawBuffers(t,b,Y){Y?this._engine.bindBuffers(this._renderVertexBuffers,Y,b):this._engine.bindVertexArrayObject(this._renderVAO[t],null)}preUpdateParticleBuffer(){const t=this._engine;if(this._engine.enableEffect(this._updateEffect),!t.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(t,b,Y){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[t],null);const o=this._engine;o.bindTransformFeedbackBuffer(b.getBuffer()),o.setRasterizerState(!1),o.beginTransformFeedback(!0),o.drawArraysType(3,0,Y),o.endTransformFeedback(),o.setRasterizerState(!0),o.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let t=0;t<this._updateVAO.length;t++)this._engine.releaseVertexArrayObject(this._updateVAO[t]);this._updateVAO.length=0;for(let t=0;t<this._renderVAO.length;t++)this._engine.releaseVertexArrayObject(this._renderVAO[t]);this._renderVAO.length=0}_createUpdateVAO(t){const b={};b.position=t.createVertexBuffer("position",0,3);let Y=3;b.age=t.createVertexBuffer("age",Y,1),Y+=1,b.size=t.createVertexBuffer("size",Y,3),Y+=3,b.life=t.createVertexBuffer("life",Y,1),Y+=1,b.seed=t.createVertexBuffer("seed",Y,4),Y+=4,b.direction=t.createVertexBuffer("direction",Y,3),Y+=3,this._parent.particleEmitterType instanceof K&&(b.initialPosition=t.createVertexBuffer("initialPosition",Y,3),Y+=3),this._parent._colorGradientsTexture||(b.color=t.createVertexBuffer("color",Y,4),Y+=4),this._parent._isBillboardBased||(b.initialDirection=t.createVertexBuffer("initialDirection",Y,3),Y+=3),this._parent.noiseTexture&&(b.noiseCoordinates1=t.createVertexBuffer("noiseCoordinates1",Y,3),Y+=3,b.noiseCoordinates2=t.createVertexBuffer("noiseCoordinates2",Y,3),Y+=3),this._parent._angularSpeedGradientsTexture?(b.angle=t.createVertexBuffer("angle",Y,1),Y+=1):(b.angle=t.createVertexBuffer("angle",Y,2),Y+=2),this._parent._isAnimationSheetEnabled&&(b.cellIndex=t.createVertexBuffer("cellIndex",Y,1),Y+=1,this._parent.spriteRandomStartCell&&(b.cellStartOffset=t.createVertexBuffer("cellStartOffset",Y,1),Y+=1));const o=this._engine.recordVertexArrayObject(b,null,this._updateEffect);return this._engine.bindArrayBuffer(null),o}});class X{constructor(t,b){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,o=arguments.length>3?arguments[3]:void 0;this._engine=t,this._label=o,this._engine._storageBuffers.push(this),this._create(b,Y)}_create(t,b){this._bufferSize=t,this._creationFlags=b,this._buffer=this._engine.createStorageBuffer(t,b,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(t,b,Y){this._buffer&&this._engine.updateStorageBuffer(this._buffer,t,b,Y)}read(t,b,Y,o){return this._engine.readFromStorageBuffer(this._buffer,t,b,Y,o)}dispose(){const t=this._engine._storageBuffers,b=t.indexOf(this);-1!==b&&(t[b]=t[t.length-1],t.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var Q=Y(999),N=Y(1001),u=Y(1224),Z=Y(990),a=Y(1374),A=Y(1144),M=Y(1206),w=Y(1366);class c{constructor(){this._gpuTimeInFrameId=-1,this.counter=new w.d}_addDuration(t,b){t<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==t?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(b,!1),this._gpuTimeInFrameId=t):this.counter.addCount(b,!1))}}class I{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(t,b,Y){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=t,this._engine=b,this.uniqueId=a.b.UniqueId,b.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new c),this._engine.getCaps().supportComputeShaders?o.bindingsMapping?(this._context=b.createComputeContext(),this._shaderPath=Y,this._options={bindingsMapping:{},defines:[],...o}):A.b.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):A.b.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(t,b){let Y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const o=this._bindings[t];this._bindings[t]={type:Y?0:4,object:b,indexInGroupEntries:null===o||void 0===o?void 0:o.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!o||o.object!==b||o.type!==this._bindings[t].type)}setStorageTexture(t,b){const Y=this._bindings[t];this._contextIsDirty||(this._contextIsDirty=!Y||Y.object!==b),this._bindings[t]={type:1,object:b,indexInGroupEntries:null===Y||void 0===Y?void 0:Y.indexInGroupEntries}}setExternalTexture(t,b){const Y=this._bindings[t];this._contextIsDirty||(this._contextIsDirty=!Y||Y.object!==b),this._bindings[t]={type:6,object:b,indexInGroupEntries:null===Y||void 0===Y?void 0:Y.indexInGroupEntries}}setVideoTexture(t,b){return!!b.externalTexture&&(this.setExternalTexture(t,b.externalTexture),!0)}setUniformBuffer(t,b){const Y=this._bindings[t];this._contextIsDirty||(this._contextIsDirty=!Y||Y.object!==b),this._bindings[t]={type:I._BufferIsDataBuffer(b)?7:2,object:b,indexInGroupEntries:null===Y||void 0===Y?void 0:Y.indexInGroupEntries}}setStorageBuffer(t,b){const Y=this._bindings[t];this._contextIsDirty||(this._contextIsDirty=!Y||Y.object!==b),this._bindings[t]={type:I._BufferIsDataBuffer(b)?7:3,object:b,indexInGroupEntries:null===Y||void 0===Y?void 0:Y.indexInGroupEntries}}setTextureSampler(t,b){const Y=this._bindings[t];this._contextIsDirty||(this._contextIsDirty=!Y||!b.compareSampler(Y.object)),this._bindings[t]={type:5,object:b,indexInGroupEntries:null===Y||void 0===Y?void 0:Y.indexInGroupEntries}}isReady(){let t=this._effect;for(const x in this._bindings){const t=this._bindings[x],b=t.type,Y=t.object;switch(b){case 0:case 4:case 1:if(!Y.isReady())return!1;break;case 6:if(!Y.isReady())return!1;break}}const b=[],Y=this._shaderPath;if(this._options.defines)for(let x=0;x<this._options.defines.length;x++)b.push(this._options.defines[x]);const o=b.join("\n");return this._cachedDefines!==o&&(this._cachedDefines=o,t=this._engine.createComputeEffect(Y,{defines:o,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=t),!!t.isReady()}dispatch(t,b,Y){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,t,b,Y,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const Y=I._BufferIsDataBuffer(t)?t:t.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,Y,b,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const b in this._bindings){const Y=this._bindings[b];if(!this._options.bindingsMapping[b])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+b+"'");switch(Y.type){case 0:{const o=this._samplers[b],x=Y.object;var t;if(!o||!x._texture||!o.compareSampler(x._texture))this._samplers[b]=(new M.d).setParameters(x.wrapU,x.wrapV,x.wrapR,x.anisotropicFilteringLevel,x._texture.samplingMode,null===(t=x._texture)||void 0===t?void 0:t._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const t=Y.object;t.getBuffer()!==Y.buffer&&(Y.buffer=t.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}dispatchWhenReady(t,b,Y){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return new Promise((x=>{const F=()=>{this.dispatch(t,b,Y)?x():setTimeout(F,o)};F()}))}serialize(){const t=u.d.Serialize(this);t.options=this._options,t.shaderPath=this._shaderPath,t.uj={},t.textures={};for(const b in this._bindings){const Y=this._bindings[b],o=Y.object;switch(Y.type){case 0:case 4:case 1:{const x=o.serialize();x&&(t.textures[b]=x,t.uj[b]={type:Y.type});break}}}return t}static Parse(t,b,Y){const o=u.d.Parse((()=>new I(t.name,b.getEngine(),t.shaderPath,t.options)),t,b,Y);for(const x in t.textures){const F=t.uj[x],r=Z.b.Parse(t.textures[x],b,Y);0===F.type?o.setTexture(x,r):4===F.type?o.setTexture(x,r,!1):o.setStorageTexture(x,r)}return o}static _BufferIsDataBuffer(t){return void 0!==t.underlyingResource}}(0,Q.e)([(0,N.P)()],I.prototype,"name",void 0),(0,Q.e)([(0,N.P)()],I.prototype,"fastMode",void 0),(0,R.d)("BABYLON.ComputeShader",I);var s=Y(1294);const l="gpuUpdateParticlesComputeShader",i="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";g.d.ShadersStoreWGSL[l]=i;(0,R.d)("BABYLON.ComputeShaderParticleSystem",class{constructor(t,b){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=t,this._engine=b}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var t;return(null===(t=this._updateComputeShader)||void 0===t?void 0:t.isReady())??!1}createUpdateBuffer(t){var b;const Y={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(Y.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(Y.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(Y.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(Y.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(Y.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(Y.noiseTexture={group:1,binding:11}),this._updateComputeShader=new I("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:Y,defines:t.split("\n")}),null===(b=this._simParamsComputeShader)||void 0===b||b.dispose(),this._simParamsComputeShader=new s.e(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new e(this._simParamsComputeShader)}createVertexBuffers(t,b){this._renderVertexBuffers.push(b)}createParticleBuffer(t){const b=new X(this._engine,4*t.length,11,"ComputeShaderParticleSystemBuffer");return b.update(t),this._bufferComputeShader.push(b),b.getBuffer()}bindDrawBuffers(t,b,Y){this._engine.bindBuffers(this._renderVertexBuffers[t],Y,b)}preUpdateParticleBuffer(){}updateParticleBuffer(t,b,Y){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[t]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^t]),this._updateComputeShader.dispatch(Math.ceil(Y/64))}releaseBuffers(){var t;for(let b=0;b<this._bufferComputeShader.length;++b)this._bufferComputeShader[b].dispose();this._bufferComputeShader.length=0,null===(t=this._simParamsComputeShader)||void 0===t||t.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class V{constructor(t,b,Y){this.gradient=t,this.color1=b,this.color2=Y}getColorToRef(t){this.color2?r.h.LerpToRef(this.color1,this.color2,Math.random(),t):t.p(this.color1)}}class P{constructor(t,b){this.gradient=t,this.color=b}}class k{constructor(t,b,Y){this.gradient=t,this.factor1=b,this.factor2=Y}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class q{static GetCurrentGradient(t,b,Y){if(b[0].gradient>t)return void Y(b[0],b[0],1);for(let x=0;x<b.length-1;x++){const o=b[x],F=b[x+1];if(t>=o.gradient&&t<=F.gradient){return void Y(o,F,(t-o.gradient)/(F.gradient-o.gradient))}}const o=b.length-1;Y(b[o],b[o],1)}}var O=Y(1013),j=Y(11875),G=Y(1051);class h{constructor(t){this.particleSystem=t,this.position=o.l.Zero(),this.direction=o.l.Zero(),this.color=new r.h(0,0,0,0),this.colorStep=new r.h(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new o.i(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new r.h(0,0,0,0),this._currentColor2=new r.h(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=h._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let t=this.age,b=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===b?(b=1,t=this._randomCellOffset):t+=this._randomCellOffset);const Y=this._initialEndSpriteCellID-this._initialStartSpriteCellID+1;let o;o=this._initialSpriteCellLoop?(0,E.e)(t*b%this.lifeTime/this.lifeTime):(0,E.e)(t*b/this.lifeTime),this.cellIndex=this._initialStartSpriteCellID+o*Y|0}_inheritParticleInfoToSubEmitter(t){if(t.particleSystem.k.position){const b=t.particleSystem.k;if(b.position.p(this.position),t.inheritDirection){const t=o.f.ae[0];this.direction.normalizeToRef(t),b.setDirection(t,0,Math.PI/2)}}else{t.particleSystem.k.p(this.position)}this.direction.scaleToRef(t.inheritedVelocityAmount/2,o.f.ae[0]),t.particleSystem._inheritedVelocityOffset.p(o.f.ae[0])}_inheritParticleInfoToSubEmitters(){this._attachedSubEmitters&&this._attachedSubEmitters.length>0&&this._attachedSubEmitters.forEach((t=>{this._inheritParticleInfoToSubEmitter(t)}))}_reset(){this.age=0,this.id=h._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(t){t.position.p(this.position),this._initialDirection?t._initialDirection?t._initialDirection.p(this._initialDirection):t._initialDirection=this._initialDirection.clone():t._initialDirection=null,t.direction.p(this.direction),this.vg&&(t.vg?t.vg.p(this.vg):t.vg=this.vg.clone()),t.color.p(this.color),t.colorStep.p(this.colorStep),t.lifeTime=this.lifeTime,t.age=this.age,t._randomCellOffset=this._randomCellOffset,t.size=this.size,t.scale.p(this.scale),t.angle=this.angle,t.angularSpeed=this.angularSpeed,t.particleSystem=this.particleSystem,t.cellIndex=this.cellIndex,t.id=this.id,t._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(t._currentColorGradient=this._currentColorGradient,t._currentColor1.p(this._currentColor1),t._currentColor2.p(this._currentColor2)),this._currentSizeGradient&&(t._currentSizeGradient=this._currentSizeGradient,t._currentSize1=this._currentSize1,t._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(t._currentAngularSpeedGradient=this._currentAngularSpeedGradient,t._currentAngularSpeed1=this._currentAngularSpeed1,t._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(t._currentVelocityGradient=this._currentVelocityGradient,t._currentVelocity1=this._currentVelocity1,t._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(t._currentLimitVelocityGradient=this._currentLimitVelocityGradient,t._currentLimitVelocity1=this._currentLimitVelocity1,t._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(t._currentDragGradient=this._currentDragGradient,t._currentDrag1=this._currentDrag1,t._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(t._initialStartSpriteCellID=this._initialStartSpriteCellID,t._initialEndSpriteCellID=this._initialEndSpriteCellID,t._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(t.remapData&&this.remapData?t.remapData.p(this.remapData):t.remapData=new o.m(0,0,0,0)),this._randomNoiseCoordinates1&&(t._randomNoiseCoordinates1?(t._randomNoiseCoordinates1.p(this._randomNoiseCoordinates1),t._randomNoiseCoordinates2.p(this._randomNoiseCoordinates2)):(t._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),t._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}h._Count=0;var tt=Y(1436),bt=(Y(1530),Y(1446)),Yt=Y(1438),ot=Y(1287);class xt extends d{set onDispose(t){this._onDisposeObserver&&this.le.remove(this._onDisposeObserver),this._onDisposeObserver=this.le.add(t)}get useRampGradients(){return this._useRampGradients}set useRampGradients(t){this._useRampGradients!==t&&(this._useRampGradients=t,this._resetEffect())}get particles(){return this.pj}get shaderLanguage(){return this._shaderLanguage}getActiveCount(){return this.pj.length}getClassName(){return"jf"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var t;let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(t=this._customWrappers[b])||void 0===t?void 0:t.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[t]??this._customWrappers[0]}setCustomEffect(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[b]=new tt.e(this._engine),this._customWrappers[b].effect=t,this._customWrappers[b].drawContext&&(this._customWrappers[b].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new O.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}constructor(t,b,Y){let x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,F=arguments.length>4&&void 0!==arguments[4]&&arguments[4],R=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01;super(t),this._emitterInverseWorldMatrix=o.c.Identity(),this._inheritedVelocityOffset=new o.l,this.le=new O.e,this.onStoppedObservable=new O.e,this.pj=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new r.h(0,0,0,0),this._colorDiff=new r.h(0,0,0,0),this._scaledDirection=o.l.Zero(),this._scaledGravity=o.l.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this.isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=t=>{},this.recycleParticle=t=>{const b=this.pj.pop();b!==t&&b.copyTo(t),this._stockParticles.push(b)},this._createParticle=()=>{let t;return 0!==this._stockParticles.length?(t=this._stockParticles.pop(),t._reset()):t=new h(this),this._prepareParticle(t),t},this._shadersLoaded=!1,this._capacity=b,this._epsilon=R,this._isAnimationSheetEnabled=F,Y&&"Scene"!==Y.getClassName()?(this._engine=Y,this.defaultProjectionMatrix=o.c.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=Y||G.d.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.ue.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._attachImageProcessingConfiguration(null),this._customWrappers={0:new tt.e(this._engine)},this._customWrappers[0].effect=x,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new C;let d=null;this.updateFunction=t=>{let b=null;var Y;this.noiseTexture&&(b=this.noiseTexture.getSize(),null===(Y=this.noiseTexture.getContent())||void 0===Y||Y.then((t=>{d=t})));const x=t===this.pj;for(let F=0;F<t.length;F++){const Y=t[F];let R=this._scaledUpdateSpeed;const U=Y.age;if(Y.age+=R,Y.age>Y.lifeTime){const t=Y.age-U;R=(Y.lifeTime-U)*R/t,Y.age=Y.lifeTime}const C=Y.age/Y.lifeTime;this._colorGradients&&this._colorGradients.length>0?q.GetCurrentGradient(C,this._colorGradients,((t,b,o)=>{t!==Y._currentColorGradient&&(Y._currentColor1.p(Y._currentColor2),b.getColorToRef(Y._currentColor2),Y._currentColorGradient=t),r.h.LerpToRef(Y._currentColor1,Y._currentColor2,o,Y.color)})):(Y.colorStep.scaleToRef(R,this._scaledColorStep),Y.color.addInPlace(this._scaledColorStep),Y.color.a<0&&(Y.color.a=0)),this._angularSpeedGradients&&this._angularSpeedGradients.length>0&&q.GetCurrentGradient(C,this._angularSpeedGradients,((t,b,o)=>{t!==Y._currentAngularSpeedGradient&&(Y._currentAngularSpeed1=Y._currentAngularSpeed2,Y._currentAngularSpeed2=b.getFactor(),Y._currentAngularSpeedGradient=t),Y.angularSpeed=(0,E.n)(Y._currentAngularSpeed1,Y._currentAngularSpeed2,o)})),Y.angle+=Y.angularSpeed*R;let p=R;if(this._velocityGradients&&this._velocityGradients.length>0&&q.GetCurrentGradient(C,this._velocityGradients,((t,b,o)=>{t!==Y._currentVelocityGradient&&(Y._currentVelocity1=Y._currentVelocity2,Y._currentVelocity2=b.getFactor(),Y._currentVelocityGradient=t),p*=(0,E.n)(Y._currentVelocity1,Y._currentVelocity2,o)})),Y.direction.scaleToRef(p,this._scaledDirection),this._limitVelocityGradients&&this._limitVelocityGradients.length>0&&q.GetCurrentGradient(C,this._limitVelocityGradients,((t,b,o)=>{t!==Y._currentLimitVelocityGradient&&(Y._currentLimitVelocity1=Y._currentLimitVelocity2,Y._currentLimitVelocity2=b.getFactor(),Y._currentLimitVelocityGradient=t);const x=(0,E.n)(Y._currentLimitVelocity1,Y._currentLimitVelocity2,o);Y.direction.length()>x&&Y.direction.scaleInPlace(this.limitVelocityDamping)})),this._dragGradients&&this._dragGradients.length>0&&q.GetCurrentGradient(C,this._dragGradients,((t,b,o)=>{t!==Y._currentDragGradient&&(Y._currentDrag1=Y._currentDrag2,Y._currentDrag2=b.getFactor(),Y._currentDragGradient=t);const x=(0,E.n)(Y._currentDrag1,Y._currentDrag2,o);this._scaledDirection.scaleInPlace(1-x)})),this.isLocal&&Y.vg?(Y.vg.addInPlace(this._scaledDirection),o.l.TransformCoordinatesToRef(Y.vg,this._emitterWorldMatrix,Y.position)):Y.position.addInPlace(this._scaledDirection),d&&b&&Y._randomNoiseCoordinates1){const t=this._fetchR(Y._randomNoiseCoordinates1.x,Y._randomNoiseCoordinates1.y,b.width,b.height,d),x=this._fetchR(Y._randomNoiseCoordinates1.z,Y._randomNoiseCoordinates2.x,b.width,b.height,d),F=this._fetchR(Y._randomNoiseCoordinates2.y,Y._randomNoiseCoordinates2.z,b.width,b.height,d),r=o.f.ae[0],E=o.f.ae[1];r.be((2*t-1)*this.noiseStrength.x,(2*x-1)*this.noiseStrength.y,(2*F-1)*this.noiseStrength.z),r.scaleToRef(R,E),Y.direction.addInPlace(E)}this.gravity.scaleToRef(R,this._scaledGravity),Y.direction.addInPlace(this._scaledGravity),this._sizeGradients&&this._sizeGradients.length>0&&q.GetCurrentGradient(C,this._sizeGradients,((t,b,o)=>{t!==Y._currentSizeGradient&&(Y._currentSize1=Y._currentSize2,Y._currentSize2=b.getFactor(),Y._currentSizeGradient=t),Y.size=(0,E.n)(Y._currentSize1,Y._currentSize2,o)})),this._useRampGradients&&(this._colorRemapGradients&&this._colorRemapGradients.length>0&&q.GetCurrentGradient(C,this._colorRemapGradients,((t,b,o)=>{const x=(0,E.n)(t.factor1,b.factor1,o),F=(0,E.n)(t.factor2,b.factor2,o);Y.remapData.x=x,Y.remapData.y=F-x})),this._alphaRemapGradients&&this._alphaRemapGradients.length>0&&q.GetCurrentGradient(C,this._alphaRemapGradients,((t,b,o)=>{const x=(0,E.n)(t.factor1,b.factor1,o),F=(0,E.n)(t.factor2,b.factor2,o);Y.remapData.z=x,Y.remapData.w=F-x}))),this._isAnimationSheetEnabled&&Y.updateCellIndex(),Y._inheritParticleInfoToSubEmitters(),Y.age>=Y.lifeTime&&(this._emitFromParticle(Y),Y._attachedSubEmitters&&(Y._attachedSubEmitters.forEach((t=>{t.particleSystem.disposeOnStop=!0,t.particleSystem.stop()})),Y._attachedSubEmitters=null),this.recycleParticle(Y),x&&F--)}}}serialize(t){throw new Error("Method not implemented.")}clone(t,b){throw new Error("Method not implemented.")}_addFactorGradient(t,b,Y,o){const x=new k(b,Y,o);t.push(x),t.sort(((t,b)=>t.gradient<b.gradient?-1:t.gradient>b.gradient?1:0))}_removeFactorGradient(t,b){if(!t)return;let Y=0;for(const o of t){if(o.gradient===b){t.splice(Y,1);break}Y++}}addLifeTimeGradient(t,b,Y){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,t,b,Y),this}removeLifeTimeGradient(t){return this._removeFactorGradient(this._lifeTimeGradients,t),this}addSizeGradient(t,b,Y){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,t,b,Y),this}removeSizeGradient(t){return this._removeFactorGradient(this._sizeGradients,t),this}addColorRemapGradient(t,b,Y){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,t,b,Y),this}removeColorRemapGradient(t){return this._removeFactorGradient(this._colorRemapGradients,t),this}addAlphaRemapGradient(t,b,Y){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,t,b,Y),this}removeAlphaRemapGradient(t){return this._removeFactorGradient(this._alphaRemapGradients,t),this}addAngularSpeedGradient(t,b,Y){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,t,b,Y),this}removeAngularSpeedGradient(t){return this._removeFactorGradient(this._angularSpeedGradients,t),this}addVelocityGradient(t,b,Y){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,t,b,Y),this}removeVelocityGradient(t){return this._removeFactorGradient(this._velocityGradients,t),this}addLimitVelocityGradient(t,b,Y){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,t,b,Y),this}removeLimitVelocityGradient(t){return this._removeFactorGradient(this._limitVelocityGradients,t),this}addDragGradient(t,b,Y){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,t,b,Y),this}removeDragGradient(t){return this._removeFactorGradient(this._dragGradients,t),this}addEmitRateGradient(t,b,Y){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,t,b,Y),this}removeEmitRateGradient(t){return this._removeFactorGradient(this._emitRateGradients,t),this}addStartSizeGradient(t,b,Y){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,t,b,Y),this}removeStartSizeGradient(t){return this._removeFactorGradient(this._startSizeGradients,t),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const t=new Uint8Array(4*this._rawTextureWidth),b=r.k.Le[0];for(let Y=0;Y<this._rawTextureWidth;Y++){const o=Y/this._rawTextureWidth;q.GetCurrentGradient(o,this._rampGradients,((o,x,F)=>{r.d.LerpToRef(o.color,x.color,F,b),t[4*Y]=255*b.r,t[4*Y+1]=255*b.g,t[4*Y+2]=255*b.b,t[4*Y+3]=255}))}this._rampGradientsTexture=j.c.CreateRGBATexture(t,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((t,b)=>t.gradient<b.gradient?-1:t.gradient>b.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(t,b){this._rampGradients||(this._rampGradients=[]);const Y=new P(t,b);return this._rampGradients.push(Y),this._syncRampGradientTexture(),this}removeRampGradient(t){return this._removeGradientAndTexture(t,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(t,b,Y){this._colorGradients||(this._colorGradients=[]);const o=new V(t,b,Y);return this._colorGradients.push(o),this._colorGradients.sort(((t,b)=>t.gradient<b.gradient?-1:t.gradient>b.gradient?1:0)),this}removeColorGradient(t){if(!this._colorGradients)return this;let b=0;for(const Y of this._colorGradients){if(Y.gradient===t){this._colorGradients.splice(b,1);break}b++}return this}resetDrawCache(){for(const t of this._drawWrappers)if(t)for(const b of t)null===b||void 0===b||b.dispose();this._drawWrappers=[]}_fetchR(t,b,Y,o,x){return x[4*(((t=.5*Math.abs(t)+.5)*Y%Y|0)+((b=.5*Math.abs(b)+.5)*o%o|0)*Y)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const t=this._engine,b=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*b),this._vertexBuffer=new L.d(t,this._vertexData,!0,b);let Y=0;const o=this._vertexBuffer.createVertexBuffer(L.e.PositionKind,Y,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[L.e.PositionKind]=o,Y+=3;const x=this._vertexBuffer.createVertexBuffer(L.e.ColorKind,Y,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[L.e.ColorKind]=x,Y+=4;const F=this._vertexBuffer.createVertexBuffer("angle",Y,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=F,Y+=1;const r=this._vertexBuffer.createVertexBuffer("size",Y,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=r,Y+=2,this._isAnimationSheetEnabled){const t=this._vertexBuffer.createVertexBuffer("cellIndex",Y,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=t,Y+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const t=this._vertexBuffer.createVertexBuffer("direction",Y,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=t,Y+=3}if(this._useRampGradients){const t=this._vertexBuffer.createVertexBuffer("remapData",Y,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=t,Y+=4}let R;if(this._useInstancing){const b=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new L.d(t,b,!1,2),R=this._spriteBuffer.createVertexBuffer("offset",0,2)}else R=this._vertexBuffer.createVertexBuffer("offset",Y,2,this._vertexBufferSize,this._useInstancing),Y+=2;this._vertexBuffers.offset=R,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const t=[],b=[];let Y=0;for(let o=0;o<this._capacity;o++)t.push(Y),t.push(Y+1),t.push(Y+2),t.push(Y),t.push(Y+2),t.push(Y+3),b.push(Y,Y+1,Y+1,Y+2,Y+2,Y+3,Y+3,Y,Y,Y+3),Y+=4;this._indexBuffer=this._engine.createIndexBuffer(t),this._linesIndexBuffer=this._engine.createIndexBuffer(b)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(t)setTimeout((()=>{this.start(0)}),t);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var b;-1!==(null===(b=this.k)||void 0===b?void 0:b.getClassName().indexOf("Mesh"))&&this.k.ve(!0);const t=this.noiseTexture;if(t&&t.onGeneratedObservable)t.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let b=0;b<this.preWarmCycles;b++)this.animate(!0),t.render()}))}));else for(let b=0;b<this.preWarmCycles;b++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop)}}stop(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(t))}_postStop(t){}reset(){this._stockParticles.length=0,this.pj.length=0}_appendParticleVertex(t,b,Y,x){let F=t*this._vertexBufferSize;if(this._vertexData[F++]=b.position.x+this.rg.x,this._vertexData[F++]=b.position.y+this.rg.y,this._vertexData[F++]=b.position.z+this.rg.z,this._vertexData[F++]=b.color.r,this._vertexData[F++]=b.color.g,this._vertexData[F++]=b.color.b,this._vertexData[F++]=b.color.a,this._vertexData[F++]=b.angle,this._vertexData[F++]=b.scale.x*b.size,this._vertexData[F++]=b.scale.y*b.size,this._isAnimationSheetEnabled&&(this._vertexData[F++]=b.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[F++]=b.direction.x,this._vertexData[F++]=b.direction.y,this._vertexData[F++]=b.direction.z);else if(b._initialDirection){let t=b._initialDirection;this.isLocal&&(o.l.TransformNormalToRef(t,this._emitterWorldMatrix,o.f.ae[0]),t=o.f.ae[0]),0===t.x&&0===t.z&&(t.x=.001),this._vertexData[F++]=t.x,this._vertexData[F++]=t.y,this._vertexData[F++]=t.z}else{let t=b.direction;this.isLocal&&(o.l.TransformNormalToRef(t,this._emitterWorldMatrix,o.f.ae[0]),t=o.f.ae[0]),0===t.x&&0===t.z&&(t.x=.001),this._vertexData[F++]=t.x,this._vertexData[F++]=t.y,this._vertexData[F++]=t.z}this._useRampGradients&&b.remapData&&(this._vertexData[F++]=b.remapData.x,this._vertexData[F++]=b.remapData.y,this._vertexData[F++]=b.remapData.z,this._vertexData[F++]=b.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===Y?Y=this._epsilon:1===Y&&(Y=1-this._epsilon),0===x?x=this._epsilon:1===x&&(x=1-this._epsilon)),this._vertexData[F++]=Y,this._vertexData[F++]=x)}_prepareParticle(t){}_update(t){if(this._alive=this.pj.length>0,this.k.position){const t=this.k;this._emitterWorldMatrix=t.getWorldMatrix()}else{const t=this.k;this._emitterWorldMatrix=o.c.Translation(t.x,t.y,t.z)}let b;this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.pj);for(let Y=0;Y<t&&this.pj.length!==this._capacity;Y++){if(b=this._createParticle(),this.pj.push(b),this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0){const t=(0,E.e)(this._actualFrame/this.targetStopDuration);q.GetCurrentGradient(t,this._lifeTimeGradients,((Y,o)=>{const x=Y,F=o,r=x.getFactor(),R=F.getFactor(),d=(t-x.gradient)/(F.gradient-x.gradient);b.lifeTime=(0,E.n)(r,R,d)}))}else b.lifeTime=(0,E.p)(this.minLifeTime,this.maxLifeTime);const t=(0,E.p)(this.minEmitPower,this.maxEmitPower);if(this.startPositionFunction?this.startPositionFunction(this._emitterWorldMatrix,b.position,b,this.isLocal):this.particleEmitterType.startPositionFunction(this._emitterWorldMatrix,b.position,b,this.isLocal),this.isLocal&&(b.vg?b.vg.p(b.position):b.vg=b.position.clone(),o.l.TransformCoordinatesToRef(b.vg,this._emitterWorldMatrix,b.position)),this.startDirectionFunction?this.startDirectionFunction(this._emitterWorldMatrix,b.direction,b,this.isLocal):this.particleEmitterType.startDirectionFunction(this._emitterWorldMatrix,b.direction,b,this.isLocal,this._emitterInverseWorldMatrix),0===t?b._initialDirection?b._initialDirection.p(b.direction):b._initialDirection=b.direction.clone():b._initialDirection=null,b.direction.scaleInPlace(t),this._sizeGradients&&0!==this._sizeGradients.length?(b._currentSizeGradient=this._sizeGradients[0],b._currentSize1=b._currentSizeGradient.getFactor(),b.size=b._currentSize1,this._sizeGradients.length>1?b._currentSize2=this._sizeGradients[1].getFactor():b._currentSize2=b._currentSize1):b.size=(0,E.p)(this.minSize,this.maxSize),b.scale.be((0,E.p)(this.minScaleX,this.maxScaleX),(0,E.p)(this.minScaleY,this.maxScaleY)),this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration){const t=this._actualFrame/this.targetStopDuration;q.GetCurrentGradient(t,this._startSizeGradients,((t,Y,o)=>{t!==this._currentStartSizeGradient&&(this._currentStartSize1=this._currentStartSize2,this._currentStartSize2=Y.getFactor(),this._currentStartSizeGradient=t);const x=(0,E.n)(this._currentStartSize1,this._currentStartSize2,o);b.scale.scaleInPlace(x)}))}if(this._angularSpeedGradients&&0!==this._angularSpeedGradients.length?(b._currentAngularSpeedGradient=this._angularSpeedGradients[0],b.angularSpeed=b._currentAngularSpeedGradient.getFactor(),b._currentAngularSpeed1=b.angularSpeed,this._angularSpeedGradients.length>1?b._currentAngularSpeed2=this._angularSpeedGradients[1].getFactor():b._currentAngularSpeed2=b._currentAngularSpeed1):b.angularSpeed=(0,E.p)(this.minAngularSpeed,this.maxAngularSpeed),b.angle=(0,E.p)(this.minInitialRotation,this.maxInitialRotation),this._velocityGradients&&this._velocityGradients.length>0&&(b._currentVelocityGradient=this._velocityGradients[0],b._currentVelocity1=b._currentVelocityGradient.getFactor(),this._velocityGradients.length>1?b._currentVelocity2=this._velocityGradients[1].getFactor():b._currentVelocity2=b._currentVelocity1),this._limitVelocityGradients&&this._limitVelocityGradients.length>0&&(b._currentLimitVelocityGradient=this._limitVelocityGradients[0],b._currentLimitVelocity1=b._currentLimitVelocityGradient.getFactor(),this._limitVelocityGradients.length>1?b._currentLimitVelocity2=this._limitVelocityGradients[1].getFactor():b._currentLimitVelocity2=b._currentLimitVelocity1),this._dragGradients&&this._dragGradients.length>0&&(b._currentDragGradient=this._dragGradients[0],b._currentDrag1=b._currentDragGradient.getFactor(),this._dragGradients.length>1?b._currentDrag2=this._dragGradients[1].getFactor():b._currentDrag2=b._currentDrag1),this._colorGradients&&0!==this._colorGradients.length)b._currentColorGradient=this._colorGradients[0],b._currentColorGradient.getColorToRef(b.color),b._currentColor1.p(b.color),this._colorGradients.length>1?this._colorGradients[1].getColorToRef(b._currentColor2):b._currentColor2.p(b.color);else{const t=(0,E.p)(0,1);r.h.LerpToRef(this.color1,this.color2,t,b.color),this.colorDead.subtractToRef(b.color,this._colorDiff),this._colorDiff.scaleToRef(1/b.lifeTime,b.colorStep)}this._isAnimationSheetEnabled&&(b._initialStartSpriteCellID=this.startSpriteCellID,b._initialEndSpriteCellID=this.endSpriteCellID,b._initialSpriteCellLoop=this.spriteCellLoop),b.direction.addInPlace(this._inheritedVelocityOffset),this._useRampGradients&&(b.remapData=new o.m(0,1,0,1)),this.noiseTexture&&(b._randomNoiseCoordinates1?(b._randomNoiseCoordinates1.be(Math.random(),Math.random(),Math.random()),b._randomNoiseCoordinates2.be(Math.random(),Math.random(),Math.random())):(b._randomNoiseCoordinates1=new o.l(Math.random(),Math.random(),Math.random()),b._randomNoiseCoordinates2=new o.l(Math.random(),Math.random(),Math.random()))),b._inheritParticleInfoToSubEmitters()}}static _GetAttributeNamesOrOptions(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const o=[L.e.PositionKind,L.e.ColorKind,"angle","offset","size"];return t&&o.push("cellIndex"),b||o.push("direction"),Y&&o.push("remapData"),o}static _GetEffectCreationOptions(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const o=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,bt.b)(o),t&&o.push("particlesInfos"),b&&o.push("logarithmicDepthConstant"),Y&&(o.push("vFogInfos"),o.push("vFogColor")),o}fillDefines(t,b){let Y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,bt.k)(this,this._scene,t),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&t.push("#define FOG")),this._isAnimationSheetEnabled&&t.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&t.push("#define LOGARITHMICDEPTH"),b===d.BLENDMODE_MULTIPLY&&t.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&t.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(t.push("#define BILLBOARD"),this.billboardMode){case 2:t.push("#define BILLBOARDY");break;case 8:case 9:t.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&t.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:t.push("#define BILLBOARDMODE_ALL")}Y&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),t.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(t,b,Y){b.push(...xt._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),t.push(...xt._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),Y.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,ot.e)(t,this._imageProcessingConfigurationDefines),(0,ot.c)(Y,this._imageProcessingConfigurationDefines))}_getWrapper(t){const b=this._getCustomDrawWrapper(t);if(null!==b&&void 0!==b&&b.effect)return b;const Y=[];this.fillDefines(Y,t);const o=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let x=this._drawWrappers[o];x||(x=this._drawWrappers[o]=[]);let F=x[t];F||(F=new tt.e(this._engine),F.drawContext&&(F.drawContext.useInstancing=this._useInstancing),x[t]=F);const r=Y.join("\n");if(F.defines!==r){const t=[],b=[],Y=[];this.fillUniformsAttributesAndSamplerNames(b,t,Y),F.setEffect(this._engine.createEffect("particles",t,b,Y,r,void 0,void 0,void 0,void 0,this._shaderLanguage),r)}return F}animate(){var t;let b,Y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started){if(!Y&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(Y?this.preWarmStepOffset:(null===(t=this._scene)||void 0===t?void 0:t.getAnimationRatio())||1),this.manualEmitCount>-1)b=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let t=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const b=this._actualFrame/this.targetStopDuration;q.GetCurrentGradient(b,this._emitRateGradients,((b,Y,o)=>{b!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=Y.getFactor(),this._currentEmitRateGradient=b),t=(0,E.n)(this._currentEmitRate1,this._currentEmitRate2,o)}))}b=t*this._scaledUpdateSpeed|0,this._newPartsExcess+=t*this._scaledUpdateSpeed-b}if(this._newPartsExcess>1&&(b+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?b=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(b),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!Y){let t=0;for(let b=0;b<this.pj.length;b++){const Y=this.pj[b];this._appendParticleVertices(t,Y),t+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.pj.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(t,b){this._appendParticleVertex(t++,b,0,0),this._useInstancing||(this._appendParticleVertex(t++,b,1,0),this._appendParticleVertex(t++,b,1,1),this._appendParticleVertex(t++,b,0,1))}rebuild(){var t;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(t=this._spriteBuffer)||void 0===t||t._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!xt.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(Y.bind(Y,11904)),Promise.resolve().then(Y.bind(Y,11902))])):await Promise.all([Promise.resolve().then(Y.bind(Y,11899)),Promise.resolve().then(Y.bind(Y,11897))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.k||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==d.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(d.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(d.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(t){const b=this._getWrapper(t),Y=b.effect,x=this._engine;x.enableEffect(b);const F=this.defaultViewMatrix??this._scene.getViewMatrix();if(Y.setTexture("diffuseSampler",this.particleTexture),Y.setMatrix("view",F),Y.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const t=this.particleTexture.getBaseSize();Y.setFloat3("particlesInfos",this.spriteCellWidth/t.width,this.spriteCellHeight/t.height,this.spriteCellWidth/t.width)}if(Y.setVector2("translationPivot",this.translationPivot),Y.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const t=this._scene.activeCamera;Y.setVector3("eyePosition",t.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),Y.setTexture("rampSampler",this._rampGradientsTexture));const r=Y.defines;var R,E,U,C,p,W;(this._scene&&((0,bt.e)(Y,this,this._scene),this.applyFog&&(0,Yt.h)(this._scene,void 0,Y)),r.indexOf("#define BILLBOARDMODE_ALL")>=0&&(F.invertToRef(o.f.Matrix[0]),Y.setMatrix("invView",o.f.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(R=this._scene)&&void 0!==R&&R.forceWireframe?x.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,Y):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,Y)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(E=this._scene)&&void 0!==E&&E.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?x.bindBuffers(this._vertexBuffers,null!==(U=this._scene)&&void 0!==U&&U.forceWireframe?this._linesIndexBuffer:this._indexBuffer,Y):x.bindBuffers(this._vertexBuffers,null!==(C=this._scene)&&void 0!==C&&C.forceWireframe?this._linesIndexBufferUseInstancing:null,Y);switch(this.useLogarithmicDepth&&this._scene&&(0,Yt.n)(r,Y,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(Y),t){case d.BLENDMODE_ADD:x.setAlphaMode(1);break;case d.BLENDMODE_ONEONE:x.setAlphaMode(6);break;case d.BLENDMODE_STANDARD:x.setAlphaMode(2);break;case d.BLENDMODE_MULTIPLY:x.setAlphaMode(4)}(this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(Y),this._useInstancing)?null!==(p=this._scene)&&void 0!==p&&p.forceWireframe?x.drawElementsType(6,0,10,this.pj.length):x.drawArraysType(7,0,4,this.pj.length):null!==(W=this._scene)&&void 0!==W&&W.forceWireframe?x.drawElementsType(1,0,10*this.pj.length):x.drawElementsType(0,0,6*this.pj.length);return this.pj.length}render(){if(!this.isReady()||!this.pj.length)return 0;const t=this._engine;t.setState&&(t.setState(!1),this.forceDepthWrite&&t.setDepthWrite(!0));let b=0;return b=this.blendMode===d.BLENDMODE_MULTIPLYADD?this._render(d.BLENDMODE_MULTIPLY)+this._render(d.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),b}_onDispose(){}dispose(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),t&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),t&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(b,Y),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const t=this._scene.ue.indexOf(this);t>-1&&this._scene.ue.splice(t,1),this._scene._activeParticleSystems.dispose()}this.le.notifyObservers(this),this.le.clear(),this.onStoppedObservable.clear(),this.reset()}}xt.ForceGLSL=!1;var Ft,rt=Y(1129);!function(t){t[t.ATTACHED=0]="ATTACHED",t[t.END=1]="END"}(Ft||(Ft={}));class Rt{constructor(t){if(this.particleSystem=t,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!t.k||!t.k.dispose){const b=(0,R.b)("BABYLON.AbstractMesh");t.k=new b("SubemitterSystemEmitter",t.va()),t._disposeEmitterOnDispose=!0}}clone(){let t=this.particleSystem.k;if(t){if(t instanceof o.l)t=t.clone();else if(-1!==t.getClassName().indexOf("Mesh")){t=new((0,R.b)("BABYLON.Mesh"))("",t.va()),t.isVisible=!1}}else t=new o.l;const b=new Rt(this.particleSystem.clone(this.particleSystem.name,t));return b.particleSystem.name+="Clone",b.type=this.type,b.inheritDirection=this.inheritDirection,b.inheritedVelocityAmount=this.inheritedVelocityAmount,b.particleSystem._disposeEmitterOnDispose=!0,b.particleSystem.disposeOnStop=!0,b}serialize(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b={};return b.type=this.type,b.inheritDirection=this.inheritDirection,b.inheritedVelocityAmount=this.inheritedVelocityAmount,b.particleSystem=this.particleSystem.serialize(t),b}static _ParseParticleSystem(t,b,Y){throw(0,rt.c)("ParseParticle")}static Parse(t,b,Y){const o=t.particleSystem,x=new Rt(Rt._ParseParticleSystem(o,b,Y,!0));return x.type=t.type,x.inheritDirection=t.inheritDirection,x.inheritedVelocityAmount=t.inheritedVelocityAmount,x.particleSystem._isSubEmitter=!0,x}dispose(){this.particleSystem.dispose()}}var dt=Y(1160);function Et(t,b){const Y=new B;return Y.direction1=t,Y.direction2=b,Y}function Ut(){return new v(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function Ct(){return new J(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function pt(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new o.l(0,1,0),Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new o.l(0,1,0);return new m(t,b,Y)}function Wt(){return new T(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function Tt(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new o.l(0,1,0),F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new o.l(0,1,0);return new y(t,b,Y,x,F)}function yt(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new p(t,b)}function vt(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new o.l(0,1,0),x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new o.l(0,1,0);return new W(t,b,Y,x)}class Bt extends xt{constructor(){super(...arguments),this._disposeEmitterOnDispose=!1,this._emitFromParticle=t=>{if(!this._subEmitters||0===this._subEmitters.length)return;const b=Math.floor(Math.random()*this._subEmitters.length);this._subEmitters[b].forEach((b=>{if(1===b.type){const Y=b.clone();t._inheritParticleInfoToSubEmitter(Y),Y.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(Y.particleSystem),Y.particleSystem.start()}}))}}createPointEmitter(t,b){const Y=Et(t,b);return this.particleEmitterType=Y,Y}createHemisphericEmitter(){const t=Ut(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=t,t}createSphereEmitter(){const t=Ct(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=t,t}createDirectedSphereEmitter(){const t=pt(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new o.l(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new o.l(0,1,0));return this.particleEmitterType=t,t}createCylinderEmitter(){const t=Wt(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=t,t}createDirectedCylinderEmitter(){const t=Tt(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new o.l(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new o.l(0,1,0));return this.particleEmitterType=t,t}createConeEmitter(){const t=yt(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=t,t}createDirectedConeEmitter(){const t=vt(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new o.l(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new o.l(0,1,0));return this.particleEmitterType=t,t}createBoxEmitter(t,b,Y,o){const x=new C;return this.particleEmitterType=x,this.direction1=t,this.direction2=b,this.minEmitBox=Y,this.maxEmitBox=o,x}_prepareSubEmitterInternalArray(){this._subEmitters=new Array,this.subEmitters&&this.subEmitters.forEach((t=>{t instanceof Bt?this._subEmitters.push([new Rt(t)]):t instanceof Rt?this._subEmitters.push([t]):t instanceof Array&&this._subEmitters.push(t)}))}_stopSubEmitters(){this.activeSubSystems&&(this.activeSubSystems.forEach((t=>{t.stop(!0)})),this.activeSubSystems=[])}_removeFromRoot(){if(!this._rootParticleSystem)return;const t=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==t&&this._rootParticleSystem.activeSubSystems.splice(t,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(t){t&&this._stopSubEmitters()}_prepareParticle(t){if(this._subEmitters&&this._subEmitters.length>0){const b=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];t._attachedSubEmitters=[],b.forEach((b=>{if(0===b.type){const Y=b.clone();t._attachedSubEmitters.push(Y),Y.particleSystem.start()}}))}}_onDispose(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];var Y;(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),t)&&(null===(Y=this.particles)||void 0===Y||Y.forEach((t=>{if(t._attachedSubEmitters)for(let b=t._attachedSubEmitters.length-1;b>=0;b-=1)t._attachedSubEmitters[b].dispose()})));if(b&&this.activeSubSystems)for(let o=this.activeSubSystems.length-1;o>=0;o-=1)this.activeSubSystems[o].dispose();if(this._subEmitters&&this._subEmitters.length){for(let t=0;t<this._subEmitters.length;t++)for(const b of this._subEmitters[t])b.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.k&&this.k.dispose&&this.k.dispose(!0)}static _Parse(t,b,Y,x){let F;F=Y instanceof dt.c?null:Y;const d=(0,R.b)("BABYLON.Texture");if(d&&F&&(t.texture?b.particleTexture=d.Parse(t.texture,F,x):t.textureName&&(b.particleTexture=new d(x+t.textureName,F,!1,void 0===t.invertY||t.invertY),b.particleTexture.name=t.textureName)),t.emitterId||0===t.emitterId||void 0!==t.k?t.emitterId&&F?b.k=F.getLastMeshById(t.emitterId):b.k=o.l.ce(t.k):b.k=o.l.Zero(),b.isLocal=!!t.isLocal,void 0!==t.renderingGroupId&&(b.renderingGroupId=t.renderingGroupId),void 0!==t.isBillboardBased&&(b.isBillboardBased=t.isBillboardBased),void 0!==t.billboardMode&&(b.billboardMode=t.billboardMode),void 0!==t.useLogarithmicDepth&&(b.useLogarithmicDepth=t.useLogarithmicDepth),t.animations){for(let Y=0;Y<t.animations.length;Y++){const o=t.animations[Y],x=(0,R.b)("BABYLON.Animation");x&&b.animations.push(x.Parse(o))}b.beginAnimationOnStart=t.beginAnimationOnStart,b.beginAnimationFrom=t.beginAnimationFrom,b.beginAnimationTo=t.beginAnimationTo,b.beginAnimationLoop=t.beginAnimationLoop}if(t.autoAnimate&&F&&F.beginAnimation(b,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,t.autoAnimateSpeed||1),b.startDelay=0|t.startDelay,b.minAngularSpeed=t.minAngularSpeed,b.maxAngularSpeed=t.maxAngularSpeed,b.minSize=t.minSize,b.maxSize=t.maxSize,t.minScaleX&&(b.minScaleX=t.minScaleX,b.maxScaleX=t.maxScaleX,b.minScaleY=t.minScaleY,b.maxScaleY=t.maxScaleY),void 0!==t.preWarmCycles&&(b.preWarmCycles=t.preWarmCycles,b.preWarmStepOffset=t.preWarmStepOffset),void 0!==t.minInitialRotation&&(b.minInitialRotation=t.minInitialRotation,b.maxInitialRotation=t.maxInitialRotation),b.minLifeTime=t.minLifeTime,b.maxLifeTime=t.maxLifeTime,b.minEmitPower=t.minEmitPower,b.maxEmitPower=t.maxEmitPower,b.emitRate=t.emitRate,b.gravity=o.l.ce(t.gravity),t.noiseStrength&&(b.noiseStrength=o.l.ce(t.noiseStrength)),b.color1=r.h.ce(t.color1),b.color2=r.h.ce(t.color2),b.colorDead=r.h.ce(t.colorDead),b.updateSpeed=t.updateSpeed,b.targetStopDuration=t.targetStopDuration,b.blendMode=t.blendMode,t.colorGradients)for(const o of t.colorGradients)b.addColorGradient(o.gradient,r.h.ce(o.color1),o.color2?r.h.ce(o.color2):void 0);if(t.rampGradients){for(const Y of t.rampGradients)b.addRampGradient(Y.gradient,r.d.ce(Y.color));b.useRampGradients=t.useRampGradients}if(t.colorRemapGradients)for(const o of t.colorRemapGradients)b.addColorRemapGradient(o.gradient,void 0!==o.factor1?o.factor1:o.factor,o.factor2);if(t.alphaRemapGradients)for(const o of t.alphaRemapGradients)b.addAlphaRemapGradient(o.gradient,void 0!==o.factor1?o.factor1:o.factor,o.factor2);if(t.sizeGradients)for(const o of t.sizeGradients)b.addSizeGradient(o.gradient,void 0!==o.factor1?o.factor1:o.factor,o.factor2);if(t.angularSpeedGradients)for(const o of t.angularSpeedGradients)b.addAngularSpeedGradient(o.gradient,void 0!==o.factor1?o.factor1:o.factor,o.factor2);if(t.velocityGradients)for(const o of t.velocityGradients)b.addVelocityGradient(o.gradient,void 0!==o.factor1?o.factor1:o.factor,o.factor2);if(t.dragGradients)for(const o of t.dragGradients)b.addDragGradient(o.gradient,void 0!==o.factor1?o.factor1:o.factor,o.factor2);if(t.emitRateGradients)for(const o of t.emitRateGradients)b.addEmitRateGradient(o.gradient,void 0!==o.factor1?o.factor1:o.factor,o.factor2);if(t.startSizeGradients)for(const o of t.startSizeGradients)b.addStartSizeGradient(o.gradient,void 0!==o.factor1?o.factor1:o.factor,o.factor2);if(t.lifeTimeGradients)for(const o of t.lifeTimeGradients)b.addLifeTimeGradient(o.gradient,void 0!==o.factor1?o.factor1:o.factor,o.factor2);if(t.limitVelocityGradients){for(const Y of t.limitVelocityGradients)b.addLimitVelocityGradient(Y.gradient,void 0!==Y.factor1?Y.factor1:Y.factor,Y.factor2);b.limitVelocityDamping=t.limitVelocityDamping}if(t.noiseTexture&&F){const Y=(0,R.b)("BABYLON.ProceduralTexture");b.noiseTexture=Y.Parse(t.noiseTexture,F,x)}let E;if(t.particleEmitterType){switch(t.particleEmitterType.type){case"SphereParticleEmitter":E=new J;break;case"SphereDirectedParticleEmitter":E=new m;break;case"ConeEmitter":case"ConeParticleEmitter":E=new p;break;case"ConeDirectedParticleEmitter":E=new W;break;case"CylinderParticleEmitter":E=new T;break;case"CylinderDirectedParticleEmitter":E=new y;break;case"HemisphericParticleEmitter":E=new v;break;case"PointParticleEmitter":E=new B;break;case"MeshParticleEmitter":E=new z;break;case"CustomParticleEmitter":E=new K;break;default:E=new C}E.parse(t.particleEmitterType,F)}else E=new C,E.parse(t,F);b.particleEmitterType=E,b.startSpriteCellID=t.startSpriteCellID,b.endSpriteCellID=t.endSpriteCellID,b.spriteCellLoop=t.spriteCellLoop??!0,b.spriteCellWidth=t.spriteCellWidth,b.spriteCellHeight=t.spriteCellHeight,b.spriteCellChangeSpeed=t.spriteCellChangeSpeed,b.spriteRandomStartCell=t.spriteRandomStartCell,b.disposeOnStop=t.disposeOnStop??!1,b.manualEmitCount=t.manualEmitCount??-1}static Parse(t,b,Y){let x=arguments.length>3&&void 0!==arguments[3]&&arguments[3],F=arguments.length>4?arguments[4]:void 0;const R=t.name;let d,E,U=null,C=null;if(b instanceof dt.c?d=b:(E=b,d=E.getEngine()),t.customShader&&d.createEffectForParticles){C=t.customShader;const b=C.shaderOptions.defines.length>0?C.shaderOptions.defines.join("\n"):"";U=d.createEffectForParticles(C.shaderPath.fragmentElement,C.shaderOptions.uniforms,C.shaderOptions.samplers,b)}const p=new Bt(R,F||t.Xc,b,U,t.isAnimationSheetEnabled);if(p.customShader=C,p._rootUrl=Y,t.id&&(p.id=t.id),t.subEmitters){p.subEmitters=[];for(const o of t.subEmitters){const t=[];for(const x of o)t.push(Rt.Parse(x,b,Y));p.subEmitters.push(t)}}return Bt._Parse(t,p,b,Y),t.textureMask&&(p.textureMask=r.h.ce(t.textureMask)),t.rg&&(p.rg=o.l.ce(t.rg)),t.preventAutoStart&&(p.preventAutoStart=t.preventAutoStart),x||p.preventAutoStart||p.start(),p}serialize(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b={};if(Bt._Serialize(b,this,t),b.textureMask=this.textureMask.qe(),b.customShader=this.customShader,b.preventAutoStart=this.preventAutoStart,b.rg=this.rg.qe(),this.subEmitters){b.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const Y of this._subEmitters){const o=[];for(const b of Y)o.push(b.serialize(t));b.subEmitters.push(o)}}return b}static _Serialize(t,b,Y){if(t.name=b.name,t.id=b.id,t.Xc=b.getCapacity(),t.disposeOnStop=b.disposeOnStop,t.manualEmitCount=b.manualEmitCount,b.k.position){const Y=b.k;t.emitterId=Y.id}else{const Y=b.k;t.k=Y.qe()}b.particleEmitterType&&(t.particleEmitterType=b.particleEmitterType.serialize()),b.particleTexture&&(Y?t.texture=b.particleTexture.serialize():(t.textureName=b.particleTexture.name,t.invertY=!!b.particleTexture._invertY)),t.isLocal=b.isLocal,u.d.AppendSerializedAnimations(b,t),t.beginAnimationOnStart=b.beginAnimationOnStart,t.beginAnimationFrom=b.beginAnimationFrom,t.beginAnimationTo=b.beginAnimationTo,t.beginAnimationLoop=b.beginAnimationLoop,t.startDelay=b.startDelay,t.renderingGroupId=b.renderingGroupId,t.isBillboardBased=b.isBillboardBased,t.billboardMode=b.billboardMode,t.minAngularSpeed=b.minAngularSpeed,t.maxAngularSpeed=b.maxAngularSpeed,t.minSize=b.minSize,t.maxSize=b.maxSize,t.minScaleX=b.minScaleX,t.maxScaleX=b.maxScaleX,t.minScaleY=b.minScaleY,t.maxScaleY=b.maxScaleY,t.minEmitPower=b.minEmitPower,t.maxEmitPower=b.maxEmitPower,t.minLifeTime=b.minLifeTime,t.maxLifeTime=b.maxLifeTime,t.emitRate=b.emitRate,t.gravity=b.gravity.qe(),t.noiseStrength=b.noiseStrength.qe(),t.color1=b.color1.qe(),t.color2=b.color2.qe(),t.colorDead=b.colorDead.qe(),t.updateSpeed=b.updateSpeed,t.targetStopDuration=b.targetStopDuration,t.blendMode=b.blendMode,t.preWarmCycles=b.preWarmCycles,t.preWarmStepOffset=b.preWarmStepOffset,t.minInitialRotation=b.minInitialRotation,t.maxInitialRotation=b.maxInitialRotation,t.startSpriteCellID=b.startSpriteCellID,t.spriteCellLoop=b.spriteCellLoop,t.endSpriteCellID=b.endSpriteCellID,t.spriteCellChangeSpeed=b.spriteCellChangeSpeed,t.spriteCellWidth=b.spriteCellWidth,t.spriteCellHeight=b.spriteCellHeight,t.spriteRandomStartCell=b.spriteRandomStartCell,t.isAnimationSheetEnabled=b.isAnimationSheetEnabled,t.useLogarithmicDepth=b.useLogarithmicDepth;const o=b.getColorGradients();if(o){t.colorGradients=[];for(const b of o){const Y={gradient:b.gradient,color1:b.color1.qe()};b.color2?Y.color2=b.color2.qe():Y.color2=b.color1.qe(),t.colorGradients.push(Y)}}const x=b.getRampGradients();if(x){t.rampGradients=[];for(const b of x){const Y={gradient:b.gradient,color:b.color.qe()};t.rampGradients.push(Y)}t.useRampGradients=b.useRampGradients}const F=b.getColorRemapGradients();if(F){t.colorRemapGradients=[];for(const b of F){const Y={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?Y.factor2=b.factor2:Y.factor2=b.factor1,t.colorRemapGradients.push(Y)}}const r=b.getAlphaRemapGradients();if(r){t.alphaRemapGradients=[];for(const b of r){const Y={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?Y.factor2=b.factor2:Y.factor2=b.factor1,t.alphaRemapGradients.push(Y)}}const R=b.getSizeGradients();if(R){t.sizeGradients=[];for(const b of R){const Y={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?Y.factor2=b.factor2:Y.factor2=b.factor1,t.sizeGradients.push(Y)}}const d=b.getAngularSpeedGradients();if(d){t.angularSpeedGradients=[];for(const b of d){const Y={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?Y.factor2=b.factor2:Y.factor2=b.factor1,t.angularSpeedGradients.push(Y)}}const E=b.getVelocityGradients();if(E){t.velocityGradients=[];for(const b of E){const Y={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?Y.factor2=b.factor2:Y.factor2=b.factor1,t.velocityGradients.push(Y)}}const U=b.getDragGradients();if(U){t.dragGradients=[];for(const b of U){const Y={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?Y.factor2=b.factor2:Y.factor2=b.factor1,t.dragGradients.push(Y)}}const C=b.getEmitRateGradients();if(C){t.emitRateGradients=[];for(const b of C){const Y={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?Y.factor2=b.factor2:Y.factor2=b.factor1,t.emitRateGradients.push(Y)}}const p=b.getStartSizeGradients();if(p){t.startSizeGradients=[];for(const b of p){const Y={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?Y.factor2=b.factor2:Y.factor2=b.factor1,t.startSizeGradients.push(Y)}}const W=b.getLifeTimeGradients();if(W){t.lifeTimeGradients=[];for(const b of W){const Y={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?Y.factor2=b.factor2:Y.factor2=b.factor1,t.lifeTimeGradients.push(Y)}}const T=b.getLimitVelocityGradients();if(T){t.limitVelocityGradients=[];for(const b of T){const Y={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?Y.factor2=b.factor2:Y.factor2=b.factor1,t.limitVelocityGradients.push(Y)}t.limitVelocityDamping=b.limitVelocityDamping}b.noiseTexture&&(t.noiseTexture=b.noiseTexture.serialize())}clone(t,b){let Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const o={...this._customWrappers};let x=null;const F=this._engine;if(F.createEffectForParticles&&null!=this.customShader){x=this.customShader;const t=x.shaderOptions.defines.length>0?x.shaderOptions.defines.join("\n"):"",b=F.createEffectForParticles(x.shaderPath.fragmentElement,x.shaderOptions.uniforms,x.shaderOptions.samplers,t);o[0]?o[0].effect=b:this.setCustomEffect(b,0)}const r=this.serialize(Y),R=Bt.Parse(r,this._scene||this._engine,this._rootUrl);return R.name=t,R.customShader=x,R._customWrappers=o,void 0===b&&(b=this.k),this.noiseTexture&&(R.noiseTexture=this.noiseTexture.clone()),R.k=b,this.preventAutoStart||R.start(),R}}Bt.BILLBOARDMODE_Y=2,Bt.BILLBOARDMODE_ALL=7,Bt.BILLBOARDMODE_STRETCHED=8,Bt.BILLBOARDMODE_STRETCHED_LOCAL=9,Rt._ParseParticleSystem=Bt.Parse;var Jt=Y(1280),mt=Y(1260),Kt=Y(1497);Kt.e.prototype.createTransformFeedback=function(){const t=this._gl.createTransformFeedback();if(!t)throw new Error("Unable to create Transform Feedback");return t},Kt.e.prototype.deleteTransformFeedback=function(t){this._gl.deleteTransformFeedback(t)},Kt.e.prototype.bindTransformFeedback=function(t){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,t)},Kt.e.prototype.beginTransformFeedback=function(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(t?this._gl.POINTS:this._gl.TRIANGLES)},Kt.e.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},Kt.e.prototype.setTranformFeedbackVaryings=function(t,b){this._gl.transformFeedbackVaryings(t,b,this._gl.INTERLEAVED_ATTRIBS)},Kt.e.prototype.bindTransformFeedbackBuffer=function(t){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,t?t.underlyingResource:null)},Kt.e.prototype.readTransformFeedbackBuffer=function(t){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,t)};const Lt="clipPlaneFragmentDeclaration2",zt="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";g.d.IncludesShadersStore[Lt]=zt;Y(11285),Y(11155),Y(11074),Y(11290),Y(11309),Y(11315),Y(11344),Y(11350);const St="gpuRenderParticlesPixelShader",et="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";g.d.ShadersStore[St]=et;const gt="clipPlaneVertexDeclaration2",Dt="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";g.d.IncludesShadersStore[gt]=Dt;Y(11128),Y(11214),Y(11219),Y(11235);const Ht="gpuRenderParticlesVertexShader",ft="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";g.d.ShadersStore[Ht]=ft;class nt extends d{static get IsSupported(){if(!G.d.LastCreatedEngine)return!1;const t=G.d.LastCreatedEngine.getCaps();return t.supportTransformFeedbacks||t.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(t){this._maxActiveParticleCount=Math.min(t,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(t){this.maxActiveParticleCount=t}createPointEmitter(t,b){const Y=Et(t,b);return this.particleEmitterType=Y,Y}createHemisphericEmitter(){const t=Ut(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=t,t}createSphereEmitter(){const t=Ct(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=t,t}createDirectedSphereEmitter(){const t=pt(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new o.l(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new o.l(0,1,0));return this.particleEmitterType=t,t}createCylinderEmitter(){const t=Wt(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=t,t}createDirectedCylinderEmitter(){const t=Tt(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new o.l(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new o.l(0,1,0));return this.particleEmitterType=t,t}createConeEmitter(){const t=yt(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=t,t}createDirectedConeEmitter(){const t=vt(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new o.l(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new o.l(0,1,0));return this.particleEmitterType=t,t}createBoxEmitter(t,b,Y,o){const x=new C;return this.particleEmitterType=x,this.direction1=t,this.direction2=b,this.minEmitBox=Y,this.maxEmitBox=o,x}isReady(){if(!this.k||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==Bt.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(Bt.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(Bt.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";t?setTimeout((()=>{this.start(0)}),t):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var t;let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(t=this._customWrappers[b])||void 0===t?void 0:t.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[t]??this._customWrappers[0]}setCustomEffect(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[b]=new tt.e(this._engine),this._customWrappers[b].effect=t}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new O.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(t,b,Y){return super._removeGradientAndTexture(t,b,Y),this._releaseBuffers(),this}addColorGradient(t,b){this._colorGradients||(this._colorGradients=[]);const Y=new V(t,b);return this._colorGradients.push(Y),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(t&&this._colorGradients.sort(((t,b)=>t.gradient<b.gradient?-1:t.gradient>b.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(t){return this._removeGradientAndTexture(t,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const b in this._drawWrappers){var t;null===(t=this._drawWrappers[b].drawContext)||void 0===t||t.reset()}}_addFactorGradient(t,b,Y){const o=new k(b,Y);t.push(o),this._releaseBuffers()}addSizeGradient(t,b){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,t,b),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(t){return this._removeGradientAndTexture(t,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(t,b){if(!t)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&t.sort(((t,b)=>t.gradient<b.gradient?-1:t.gradient>b.gradient?1:0));const Y=this;Y[b]&&(Y[b].dispose(),Y[b]=null)}addAngularSpeedGradient(t,b){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,t,b),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(t){return this._removeGradientAndTexture(t,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(t,b){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,t,b),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(t){return this._removeGradientAndTexture(t,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(t,b){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,t,b),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(t){return this._removeGradientAndTexture(t,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(t,b){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,t,b),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(t){return this._removeGradientAndTexture(t,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(t){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(t,b,Y){let x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,F=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(t),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.le=new O.e,this.onStoppedObservable=new O.e,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._onBeforeDrawParticlesObservable=null,Y&&"Scene"!==Y.getClassName()?(this._engine=Y,this.defaultProjectionMatrix=o.c.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=Y||G.d.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.ue.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,R.b)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,R.b)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,R.b)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,R.b)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new tt.e(this._engine)},this._customWrappers[0].effect=x,this._drawWrappers={0:new tt.e(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(b=b??{}).randomTextureSize||delete b.randomTextureSize;const r={Xc:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...b},d=b;isFinite(d)&&(r.Xc=d),this._capacity=r.Xc,this._maxActiveParticleCount=r.Xc,this._currentActiveCount=0,this._isAnimationSheetEnabled=F,this.particleEmitterType=new C;const E=Math.min(this._engine.getCaps().maxTextureSize,r.randomTextureSize);let U=[];for(let o=0;o<E;++o)U.push(Math.random()),U.push(Math.random()),U.push(Math.random()),U.push(Math.random());this._randomTexture=new j.c(new Float32Array(U),E,1,5,Y,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,U=[];for(let o=0;o<E;++o)U.push(Math.random()),U.push(Math.random()),U.push(Math.random()),U.push(Math.random());this._randomTexture2=new j.c(new Float32Array(U),E,1,5,Y,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=E}_reset(){this._releaseBuffers()}_createVertexBuffers(t,b,Y){const o={};o.position=b.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let x=3;o.age=b.createVertexBuffer("age",x,1,this._attributesStrideSize,!0),x+=1,o.size=b.createVertexBuffer("size",x,3,this._attributesStrideSize,!0),x+=3,o.life=b.createVertexBuffer("life",x,1,this._attributesStrideSize,!0),x+=1,x+=4,this.billboardMode===Bt.BILLBOARDMODE_STRETCHED&&(o.direction=b.createVertexBuffer("direction",x,3,this._attributesStrideSize,!0)),x+=3,this._platform.alignDataInBuffer&&(x+=1),this.particleEmitterType instanceof K&&(x+=3,this._platform.alignDataInBuffer&&(x+=1)),this._colorGradientsTexture||(o.color=b.createVertexBuffer("color",x,4,this._attributesStrideSize,!0),x+=4),this._isBillboardBased||(o.initialDirection=b.createVertexBuffer("initialDirection",x,3,this._attributesStrideSize,!0),x+=3,this._platform.alignDataInBuffer&&(x+=1)),this.noiseTexture&&(o.noiseCoordinates1=b.createVertexBuffer("noiseCoordinates1",x,3,this._attributesStrideSize,!0),x+=3,this._platform.alignDataInBuffer&&(x+=1),o.noiseCoordinates2=b.createVertexBuffer("noiseCoordinates2",x,3,this._attributesStrideSize,!0),x+=3,this._platform.alignDataInBuffer&&(x+=1)),o.angle=b.createVertexBuffer("angle",x,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?x++:x+=2,this._isAnimationSheetEnabled&&(o.cellIndex=b.createVertexBuffer("cellIndex",x,1,this._attributesStrideSize,!0),x+=1,this.spriteRandomStartCell&&(o.cellStartOffset=b.createVertexBuffer("cellStartOffset",x,1,this._attributesStrideSize,!0),x+=1)),o.offset=Y.createVertexBuffer("offset",0,2),o.uv=Y.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(o),this._platform.createVertexBuffers(t,o),this.resetDrawCache()}_initialize(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!t)return;const b=this._engine,Y=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof K&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const x=this.particleEmitterType instanceof K,F=o.f.ae[0];let r=0;for(let o=0;o<this._capacity;o++)if(Y.push(0),Y.push(0),Y.push(0),Y.push(0),Y.push(0),Y.push(0),Y.push(0),Y.push(0),Y.push(Math.random()),Y.push(Math.random()),Y.push(Math.random()),Y.push(Math.random()),x?(this.particleEmitterType.particleDestinationGenerator(o,null,F),Y.push(F.x),Y.push(F.y),Y.push(F.z)):(Y.push(0),Y.push(0),Y.push(0)),this._platform.alignDataInBuffer&&Y.push(0),r+=16,x&&(this.particleEmitterType.particlePositionGenerator(o,null,F),Y.push(F.x),Y.push(F.y),Y.push(F.z),this._platform.alignDataInBuffer&&Y.push(0),r+=4),this._colorGradientsTexture||(Y.push(0),Y.push(0),Y.push(0),Y.push(0),r+=4),this.isBillboardBased||(Y.push(0),Y.push(0),Y.push(0),this._platform.alignDataInBuffer&&Y.push(0),r+=4),this.noiseTexture&&(Y.push(Math.random()),Y.push(Math.random()),Y.push(Math.random()),this._platform.alignDataInBuffer&&Y.push(0),Y.push(Math.random()),Y.push(Math.random()),Y.push(Math.random()),this._platform.alignDataInBuffer&&Y.push(0),r+=8),Y.push(0),r+=1,this._angularSpeedGradientsTexture||(Y.push(0),r+=1),this._isAnimationSheetEnabled&&(Y.push(0),r+=1,this.spriteRandomStartCell&&(Y.push(0),r+=1)),this._platform.alignDataInBuffer){let t=3-(r+3&3);for(r+=t;t-- >0;)Y.push(0)}const R=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),d=this._platform.createParticleBuffer(Y),E=this._platform.createParticleBuffer(Y);this._buffer0=new L.d(b,d,!1,this._attributesStrideSize),this._buffer1=new L.d(b,E,!1,this._attributesStrideSize),this._spriteBuffer=new L.d(b,R,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let t=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(t+="\n#define BILLBOARD"),this._colorGradientsTexture&&(t+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(t+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(t+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(t+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(t+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(t+="\n#define DRAGGRADIENTS"),this.isAnimationSheetEnabled&&(t+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(t+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(t+="\n#define NOISE"),this.isLocal&&(t+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===t||(this._cachedUpdateDefines=t,this._updateBuffer=this._platform.createUpdateBuffer(t)),this._platform.isUpdateBufferReady()}_getWrapper(t){const b=this._getCustomDrawWrapper(t);if(null!==b&&void 0!==b&&b.effect)return b;const Y=[];this.fillDefines(Y,t);let o=this._drawWrappers[t];o||(o=new tt.e(this._engine),o.drawContext&&(o.drawContext.useInstancing=!0),this._drawWrappers[t]=o);const x=Y.join("\n");if(o.defines!==x){const t=[],b=[],Y=[];this.fillUniformsAttributesAndSamplerNames(b,t,Y),o.setEffect(this._engine.createEffect("gpuRenderParticles",t,b,Y,x),x)}return o}static _GetAttributeNamesOrOptions(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const x=[L.e.PositionKind,"age","life","size","angle"];return t||x.push(L.e.ColorKind),b&&x.push("cellIndex"),Y||x.push("initialDirection"),o&&x.push("direction"),x.push("offset",L.e.UVKind),x}static _GetEffectCreationOptions(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const o=["emitterWM","rg","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,bt.b)(o),t&&o.push("sheetInfos"),b&&o.push("logarithmicDepthConstant"),Y&&(o.push("vFogInfos"),o.push("vFogColor")),o}fillDefines(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,bt.k)(this,this._scene,t),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==mt.e.FOGMODE_NONE&&t.push("#define FOG")),b===Bt.BLENDMODE_MULTIPLY&&t.push("#define BLENDMULTIPLYMODE"),this.isLocal&&t.push("#define LOCAL"),this.useLogarithmicDepth&&t.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(t.push("#define BILLBOARD"),this.billboardMode){case Bt.BILLBOARDMODE_Y:t.push("#define BILLBOARDY");break;case Bt.BILLBOARDMODE_STRETCHED:t.push("#define BILLBOARDSTRETCHED");break;case Bt.BILLBOARDMODE_ALL:t.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&t.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&t.push("#define ANIMATESHEET"),Y&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),t.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(t,b,Y){b.push(...nt._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===Bt.BILLBOARDMODE_STRETCHED)),t.push(...nt._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),Y.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(Jt.e.PrepareUniforms(t,this._imageProcessingConfigurationDefines),Jt.e.PrepareSamplers(Y,this._imageProcessingConfigurationDefines))}animate(){var t;let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(b?this.preWarmStepOffset:(null===(t=this._scene)||void 0===t?void 0:t.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(t,b){const Y=this[b];if(!t||!t.length||Y)return;const o=new Float32Array(this._rawTextureWidth);for(let x=0;x<this._rawTextureWidth;x++){const b=x/this._rawTextureWidth;q.GetCurrentGradient(b,t,((t,b,Y)=>{o[x]=(0,E.n)(t.factor1,b.factor1,Y)}))}this[b]=j.c.CreateRTexture(o,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[b].name=b.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const t=new Uint8Array(4*this._rawTextureWidth),b=r.k.Ne[0];for(let Y=0;Y<this._rawTextureWidth;Y++){const o=Y/this._rawTextureWidth;q.GetCurrentGradient(o,this._colorGradients,((o,x,F)=>{r.h.LerpToRef(o.color1,x.color1,F,b),t[4*Y]=255*b.r,t[4*Y+1]=255*b.g,t[4*Y+2]=255*b.b,t[4*Y+3]=255*b.a}))}this._colorGradientsTexture=j.c.CreateRGBATexture(t,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(t,b){var Y,x,F,r;const R=this._getWrapper(t),d=R.effect;this._engine.enableEffect(R);const E=(null===(Y=this._scene)||void 0===Y?void 0:Y.getViewMatrix())||o.c.IdentityReadOnly;if(d.setMatrix("view",E),d.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),d.setTexture("diffuseSampler",this.particleTexture),d.setVector2("translationPivot",this.translationPivot),d.setVector3("rg",this.rg),this.isLocal&&d.setMatrix("emitterWM",b),this._colorGradientsTexture?d.setTexture("colorGradientSampler",this._colorGradientsTexture):d.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const t=this.particleTexture.getBaseSize();d.setFloat3("sheetInfos",this.spriteCellWidth/t.width,this.spriteCellHeight/t.height,t.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const t=this._scene.activeCamera;d.setVector3("eyePosition",t.globalPosition)}const U=d.defines;if(this._scene&&((0,bt.e)(d,this,this._scene),this.applyFog&&(0,Yt.h)(this._scene,void 0,d)),U.indexOf("#define BILLBOARDMODE_ALL")>=0){const t=E.clone();t.invert(),d.setMatrix("invView",t)}switch(this.useLogarithmicDepth&&this._scene&&(0,Yt.n)(U,d,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(d),t){case Bt.BLENDMODE_ADD:this._engine.setAlphaMode(1);break;case Bt.BLENDMODE_ONEONE:this._engine.setAlphaMode(6);break;case Bt.BLENDMODE_STANDARD:this._engine.setAlphaMode(2);break;case Bt.BLENDMODE_MULTIPLY:this._engine.setAlphaMode(4)}return this._platform.bindDrawBuffers(this._targetIndex,d,null!==(x=this._scene)&&void 0!==x&&x.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(d),null!==(F=this._scene)&&void 0!==F&&F.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(r=this._scene)&&void 0!==r&&r.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(t){if(!this.k||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!t)if(this.k.position){t=this.k.getWorldMatrix()}else{const b=this.k;t=o.f.Matrix[0],o.c.TranslationToRef(b.x,b.y,b.z,t)}this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this.isLocal||this._updateBuffer.setMatrix("emitterWM",t),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const b=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=b}render(){let t,b=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!b&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let t=0;t<this.preWarmCycles;t++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>1){const t=0|this._accumulatedCount;this._accumulatedCount-=t,this._currentActiveCount+=t}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.k.position){t=this.k.getWorldMatrix()}else{const b=this.k;t=o.f.Matrix[0],o.c.TranslationToRef(b.x,b.y,b.z,t)}const x=this._engine;this.updateInAnimate||this._update(t);let F=0;return b||Y||(x.setState(!1),this.forceDepthWrite&&x.setDepthWrite(!0),F=this.blendMode===Bt.BLENDMODE_MULTIPLYADD?this._render(Bt.BLENDMODE_MULTIPLY,t)+this._render(Bt.BLENDMODE_ADD,t):this._render(this.blendMode,t),this._engine.setAlphaMode(0)),F}rebuild(){const t=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(t,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,t()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const b in this._drawWrappers){this._drawWrappers[b].dispose()}if(this._drawWrappers={},this._scene){const t=this._scene.ue.indexOf(this);t>-1&&this._scene.ue.splice(t,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let b=0;b<this._renderVertexBuffers.length;++b){const t=this._renderVertexBuffers[b];for(const b in t)t[b].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),t&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),t&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.le.notifyObservers(this),this.le.clear()}clone(t,b){let Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const o={...this._customWrappers};let x=null;const F=this._engine;if(F.createEffectForParticles&&null!=this.customShader){x=this.customShader;const t=x.shaderOptions.defines.length>0?x.shaderOptions.defines.join("\n"):"";o[0]=F.createEffectForParticles(x.shaderPath.fragmentElement,x.shaderOptions.uniforms,x.shaderOptions.samplers,t,void 0,void 0,void 0,this)}const r=this.serialize(Y),R=nt.Parse(r,this._scene||this._engine,this._rootUrl);return R.name=t,R.customShader=x,R._customWrappers=o,void 0===b&&(b=this.k),this.noiseTexture&&(R.noiseTexture=this.noiseTexture.clone()),R.k=b,R}serialize(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b={};return Bt._Serialize(b,this,t),b.activeParticleCount=this.activeParticleCount,b.randomTextureSize=this._randomTextureSize,b.customShader=this.customShader,b}static Parse(t,b,Y){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],x=arguments.length>4?arguments[4]:void 0;const F=t.name;let r,R;b instanceof dt.c?r=b:(R=b,r=R.getEngine());const d=new nt(F,{Xc:x||t.Xc,randomTextureSize:t.randomTextureSize},b,null,t.isAnimationSheetEnabled);if(d._rootUrl=Y,t.customShader&&r.createEffectForParticles){const b=t.customShader,Y=b.shaderOptions.defines.length>0?b.shaderOptions.defines.join("\n"):"",o=r.createEffectForParticles(b.shaderPath.fragmentElement,b.shaderOptions.uniforms,b.shaderOptions.samplers,Y,void 0,void 0,void 0,d);d.setCustomEffect(o,0),d.customShader=b}return t.id&&(d.id=t.id),t.activeParticleCount&&(d.activeParticleCount=t.activeParticleCount),Bt._Parse(t,d,b,Y),t.preventAutoStart&&(d.preventAutoStart=t.preventAutoStart),o||d.preventAutoStart||d.start(),d}}var Xt=Y(1265),Qt=Y(11881),Nt=Y(1247);class ut{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(t){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const b of this.systems)b.k=t;this._emitterNode=t}setEmitterAsSphere(t,b,Y){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:t,renderingGroupId:b};const o=(0,Qt.e)("emitterSphere",{diameter:t.diameter,segments:t.segments},Y);o.renderingGroupId=b;const x=new Nt.d("emitterSphereMaterial",Y);x.emissiveColor=t.color,o.material=x;for(const F of this.systems)F.k=o;this._emitterNode=o}start(t){for(const b of this.systems)t&&(b.k=t),b.start()}dispose(){for(const t of this.systems)t.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b={systems:[]};for(const Y of this.systems)b.systems.push(Y.serialize(t));return this._emitterNode&&(b.k=this._emitterCreationOptions),b}static Parse(t,b){let Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3?arguments[3]:void 0;const x=new ut,F=this.BaseAssetsUrl+"/textures/";b=b||G.d.LastCreatedScene;for(const r of t.systems)x.systems.push(Y?nt.Parse(r,b,F,!0,o):Bt.Parse(r,b,F,!0,o));if(t.k){const Y=t.k.options;if("Sphere"===t.k.kind)x.setEmitterAsSphere({diameter:Y.diameter,segments:Y.segments,color:r.d.ce(Y.color)},t.k.renderingGroupId,b)}return x}}ut.BaseAssetsUrl="https://assets.babylonjs.com/particles";var Zt=Y(1086);class at{static CreateDefault(t){let b,Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,o=arguments.length>2?arguments[2]:void 0;return b=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new nt("default system",{Xc:Y},o):new Bt("default system",Y,o),b.k=t,b.particleTexture=new Z.b("https://assets.babylonjs.com/textures/flare.png",b.va()),b.createConeEmitter(.1,Math.PI/4),b.color1=new r.h(1,1,1,1),b.color2=new r.h(1,1,1,1),b.colorDead=new r.h(1,1,1,0),b.minSize=.1,b.maxSize=.1,b.minEmitPower=2,b.maxEmitPower=2,b.updateSpeed=1/60,b.emitRate=30,b}static CreateAsync(t,b){let Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3?arguments[3]:void 0;b||(b=G.d.LastCreatedScene);const x={};return b.addPendingData(x),new Promise(((F,r)=>{if(Y&&!nt.IsSupported)return b.removePendingData(x),r("Particle system with GPU is not supported.");Xt.f.LoadFile(`${at.BaseAssetsUrl}/systems/${t}.json`,(t=>{b.removePendingData(x);const r=JSON.parse(t.toString());return F(ut.Parse(r,b,Y,o))}),void 0,void 0,void 0,(()=>(b.removePendingData(x),r(`An error occurred with the creation of your particle system. Check if your type '${t}' exists.`))))}))}static ExportSet(t){const b=new ut;for(const Y of t)b.systems.push(Y);return b}static ParseFromFileAsync(t,b,Y){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",F=arguments.length>5?arguments[5]:void 0;return new Promise(((r,R)=>{const d=new Zt.e;d.addEventListener("readystatechange",(()=>{if(4==d.readyState)if(200==d.status){const b=JSON.parse(d.responseText);let R;R=o?nt.Parse(b,Y,x,!1,F):Bt.Parse(b,Y,x,!1,F),t&&(R.name=t),r(R)}else R("Unable to load the particle system")})),d.open("GET",b),d.send()}))}static ParseFromSnippetAsync(t,b){let Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",x=arguments.length>4?arguments[4]:void 0;if("_BLANK"===t){const t=this.CreateDefault(null);return t.start(),Promise.resolve(t)}return new Promise(((F,r)=>{const R=new Zt.e;R.addEventListener("readystatechange",(()=>{if(4==R.readyState)if(200==R.status){const r=JSON.parse(JSON.parse(R.responseText).jsonPayload),d=JSON.parse(r.particleSystem);let E;E=Y?nt.Parse(d,b,o,!1,x):Bt.Parse(d,b,o,!1,x),E.snippetId=t,F(E)}else r("Unable to load the snippet "+t)})),R.open("GET",this.SnippetUrl+"/"+t.replace(/#/g,"/")),R.send()}))}}at.BaseAssetsUrl=ut.BaseAssetsUrl,at.SnippetUrl="https://snippet.babylonjs.com",at.CreateFromSnippetAsync=at.ParseFromSnippetAsync;var At=Y(11737),Mt=Y(1336),wt=Y(11883);(0,wt.c)(Mt.b.NAME_PARTICLESYSTEM,((t,b,Y,o)=>{const x=(0,wt.f)(Mt.b.NAME_PARTICLESYSTEM);if(x&&void 0!==t.ue&&null!==t.ue)for(let F=0,r=t.ue.length;F<r;F++){const r=t.ue[F];Y.ue.push(x(r,b,o))}})),(0,wt.b)(Mt.b.NAME_PARTICLESYSTEM,((t,b,Y)=>{if(t.activeParticleCount){return nt.Parse(t,b,Y)}return Bt.Parse(t,b,Y)})),dt.c.prototype.createEffectForParticles=function(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",F=arguments.length>4?arguments[4]:void 0,r=arguments.length>5?arguments[5]:void 0,R=arguments.length>6?arguments[6]:void 0,d=arguments.length>7?arguments[7]:void 0,E=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,U=[],C=[];const p=[];return d?d.fillUniformsAttributesAndSamplerNames(C,U,p):(U=Bt._GetAttributeNamesOrOptions(),C=Bt._GetEffectCreationOptions()),-1===x.indexOf(" BILLBOARD")&&(x+="\n#define BILLBOARD\n"),null!==d&&void 0!==d&&d.isAnimationSheetEnabled&&-1===x.indexOf(" ANIMATESHEET")&&(x+="\n#define ANIMATESHEET\n"),-1===o.indexOf("diffuseSampler")&&o.push("diffuseSampler"),this.createEffect({vertex:(null===d||void 0===d?void 0:d.vertexShaderName)??"particles",fragmentElement:t},U,C.concat(b),p.concat(o),x,F,r,R,void 0,E,(async()=>{0===E?await Promise.resolve().then(Y.bind(Y,11899)):await Promise.resolve().then(Y.bind(Y,11904))}))},At.d.prototype.getEmittedParticleSystems=function(){const t=[];for(let b=0;b<this.va().ue.length;b++){const Y=this.va().ue[b];Y.k===this&&t.push(Y)}return t},At.d.prototype.getHierarchyEmittedParticleSystems=function(){const t=[],b=this.getDescendants();b.push(this);for(let Y=0;Y<this.va().ue.length;Y++){const o=this.va().ue[Y],x=o.k;x.position&&-1!==b.indexOf(x)&&t.push(o)}return t};Y(1415),Y(1427),Y(11781);Y(11766),Y(11891),Y(1564),Y(1401),Y(11795);Y(1562);var ct;Y(11894),Y(1066);!function(t){t[t.Color=2]="Color",t[t.UV=1]="UV",t[t.Random=0]="Random",t[t.Stated=3]="Stated"}(ct||(ct={}));Y(11897),Y(11899),Y(11902),Y(11904)},10981:(t,b,Y)=>{"use strict";const o="clipPlaneFragment",x="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";Y(1175).d.IncludesShadersStoreWGSL[o]=x},10968:(t,b,Y)=>{"use strict";const o="clipPlaneFragmentDeclaration",x="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";Y(1175).d.IncludesShadersStoreWGSL[o]=x},10874:(t,b,Y)=>{"use strict";const o="clipPlaneVertex",x="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";Y(1175).d.IncludesShadersStoreWGSL[o]=x},10794:(t,b,Y)=>{"use strict";const o="clipPlaneVertexDeclaration",x="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";Y(1175).d.IncludesShadersStoreWGSL[o]=x},11019:(t,b,Y)=>{"use strict";const o="fogFragment",x="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";Y(1175).d.IncludesShadersStoreWGSL[o]=x},10972:(t,b,Y)=>{"use strict";const o="fogFragmentDeclaration",x="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";Y(1175).d.IncludesShadersStoreWGSL[o]=x},10877:(t,b,Y)=>{"use strict";const o="fogVertex",x="#ifdef FOG\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#endif\n";Y(1175).d.IncludesShadersStoreWGSL[o]=x},10799:(t,b,Y)=>{"use strict";const o="fogVertexDeclaration",x="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";Y(1175).d.IncludesShadersStoreWGSL[o]=x},10750:(t,b,Y)=>{"use strict";const o="helperFunctions",x="const PI: f32=3.1415926535897932384626433832795;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3<f32>=vec3<f32> (0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(0.0),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);} \nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3<f32>=inMatrix[0];let i1: vec3<f32>=inMatrix[1];let i2: vec3<f32>=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3<f32>)->vec3<f32>\n{let nearZeroSection: vec3<f32>=0.0773993808*color;let remainingSection: vec3<f32>=pow(0.947867299*(color+vec3<f32>(0.055)),vec3<f32>(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3<f32>(0.04045)));}\nfn toGammaSpaceExact(color: vec3<f32>)->vec3<f32>\n{let nearZeroSection: vec3<f32>=12.92*color;let remainingSection: vec3<f32>=1.055*pow(color,vec3<f32>(0.41666))-vec3<f32>(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3<f32>(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3<f32>)->vec3<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3<f32>(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3<f32>(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3<f32>)->vec3<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3<f32>(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3<f32>)->vec3<f32>\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3<f32>)->f32\n{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3<f32>)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3<f32> =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(clamp(rgb,vec3<f32>(0.,0.,0.),vec3<f32>(1.,1.,1.)),D); }\nfn fromRGBD(rgbd: vec4<f32>)->vec3<f32> {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3<f32>,origVec: vec3<f32>,cubeSize: vec3<f32>,cubePos: vec3<f32>)->vec3<f32> {let invOrigVec: vec3<f32>=vec3<f32>(1.0,1.0,1.0)/origVec;let halfSize: vec3<f32>=cubeSize*0.5;let intersecAtMaxPlane: vec3<f32>=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3<f32>=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3<f32>=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3<f32>=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\n";Y(1175).d.IncludesShadersStoreWGSL[o]=x},10940:(t,b,Y)=>{"use strict";const o="imageProcessingDeclaration",x="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";Y(1175).d.IncludesShadersStoreWGSL[o]=x},10947:(t,b,Y)=>{"use strict";const o="imageProcessingFunctions",x="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";Y(1175).d.IncludesShadersStoreWGSL[o]=x},10824:(t,b,Y)=>{"use strict";const o="logDepthDeclaration",x="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";Y(1175).d.IncludesShadersStoreWGSL[o]=x},11013:(t,b,Y)=>{"use strict";const o="logDepthFragment",x="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";Y(1175).d.IncludesShadersStoreWGSL[o]=x},10897:(t,b,Y)=>{"use strict";const o="logDepthVertex",x="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";Y(1175).d.IncludesShadersStoreWGSL[o]=x},11902:(t,b,Y)=>{"use strict";Y.r(b),Y.d(b,{particlesPixelShaderWGSL:()=>r});var o=Y(1175);Y(10968),Y(10940),Y(10824),Y(10750),Y(10947),Y(10972),Y(10981),Y(11013),Y(11019);const x="particlesPixelShader",F="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";o.d.ShadersStoreWGSL[x]=F;const r={name:x,shader:F}},11904:(t,b,Y)=>{"use strict";Y.r(b),Y.d(b,{particlesVertexShaderWGSL:()=>r});var o=Y(1175);Y(10794),Y(10799),Y(10824),Y(10874),Y(10877),Y(10897);const x="particlesVertexShader",F="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return input.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";o.d.ShadersStoreWGSL[x]=F;const r={name:x,shader:F}},11315:(t,b,Y)=>{"use strict";const o="clipPlaneFragment",x="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";Y(1175).d.IncludesShadersStore[o]=x},11301:(t,b,Y)=>{"use strict";const o="clipPlaneFragmentDeclaration",x="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";Y(1175).d.IncludesShadersStore[o]=x},11214:(t,b,Y)=>{"use strict";const o="clipPlaneVertex",x="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";Y(1175).d.IncludesShadersStore[o]=x},11123:(t,b,Y)=>{"use strict";const o="clipPlaneVertexDeclaration",x="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";Y(1175).d.IncludesShadersStore[o]=x},11350:(t,b,Y)=>{"use strict";const o="fogFragment",x="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";Y(1175).d.IncludesShadersStore[o]=x},11309:(t,b,Y)=>{"use strict";const o="fogFragmentDeclaration",x="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";Y(1175).d.IncludesShadersStore[o]=x},11219:(t,b,Y)=>{"use strict";const o="fogVertex",x="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";Y(1175).d.IncludesShadersStore[o]=x},11128:(t,b,Y)=>{"use strict";const o="fogVertexDeclaration",x="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";Y(1175).d.IncludesShadersStore[o]=x},11074:(t,b,Y)=>{"use strict";const o="helperFunctions",x="const float PI=3.1415926535897932384626433832795;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.0;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(clamp(rgb,0.,1.),D); }\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.0,1.0,1.0)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\n";Y(1175).d.IncludesShadersStore[o]=x},11285:(t,b,Y)=>{"use strict";const o="imageProcessingDeclaration",x="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";Y(1175).d.IncludesShadersStore[o]=x},11290:(t,b,Y)=>{"use strict";const o="imageProcessingFunctions",x="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";Y(1175).d.IncludesShadersStore[o]=x},11155:(t,b,Y)=>{"use strict";const o="logDepthDeclaration",x="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";Y(1175).d.IncludesShadersStore[o]=x},11344:(t,b,Y)=>{"use strict";const o="logDepthFragment",x="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";Y(1175).d.IncludesShadersStore[o]=x},11235:(t,b,Y)=>{"use strict";const o="logDepthVertex",x="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";Y(1175).d.IncludesShadersStore[o]=x},11897:(t,b,Y)=>{"use strict";Y.r(b),Y.d(b,{particlesPixelShader:()=>r});var o=Y(1175);Y(11301),Y(11285),Y(11155),Y(11074),Y(11290),Y(11309),Y(11315),Y(11344),Y(11350);const x="particlesPixelShader",F="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";o.d.ShadersStore[x]=F;const r={name:x,shader:F}},11899:(t,b,Y)=>{"use strict";Y.r(b),Y.d(b,{particlesVertexShader:()=>r});var o=Y(1175);Y(11123),Y(11128),Y(11155),Y(11214),Y(11219),Y(11235);const x="particlesVertexShader",F="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";o.d.ShadersStore[x]=F;const r={name:x,shader:F}},11759:(t,b,Y)=>{"use strict";Y.d(b,{c:()=>C});var o=Y(999),x=Y(1019),F=Y(1001),r=Y(1013),R=Y(1051),d=Y(1129),E=Y(1224);class U{constructor(){this._doNotSerialize=!1,this._isDisposed=!1,this._sceneRootNodesIndex=-1,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._onEnabledStateChangedObservable=new r.e,this._onClonedObservable=new r.e}}class C{static AddNodeConstructor(t,b){this._NodeConstructors[t]=b}static Construct(t,b,Y,o){const x=this._NodeConstructors[t];return x?x(b,Y,o):null}set accessibilityTag(t){this._accessibilityTag=t,this.onAccessibilityTagChangedObservable.notifyObservers(t)}get accessibilityTag(){return this._accessibilityTag}get doNotSerialize(){return!!this._nodeDataStorage._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize}set doNotSerialize(t){this._nodeDataStorage._doNotSerialize=t}u(){return this._nodeDataStorage._isDisposed}set parent(t){if(this._parentNode===t)return;const b=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){const b=this._parentNode._children.indexOf(this);-1!==b&&this._parentNode._children.splice(b,1),t||this._nodeDataStorage._isDisposed||this._addToSceneRootNodes()}this._parentNode=t,this._isDirty=!0,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),b||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}get parent(){return this._parentNode}_serializeAsParent(t){t.parentId=this.uniqueId}_addToSceneRootNodes(){-1===this._nodeDataStorage._sceneRootNodesIndex&&(this._nodeDataStorage._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))}_removeFromSceneRootNodes(){if(-1!==this._nodeDataStorage._sceneRootNodesIndex){const t=this._scene.rootNodes,b=t.length-1;t[this._nodeDataStorage._sceneRootNodesIndex]=t[b],t[this._nodeDataStorage._sceneRootNodesIndex]._nodeDataStorage._sceneRootNodesIndex=this._nodeDataStorage._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._nodeDataStorage._sceneRootNodesIndex=-1}}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(t){this._animationPropertiesOverride=t}getClassName(){return"Node"}set onDispose(t){this._onDisposeObserver&&this.le.remove(this._onDisposeObserver),this._onDisposeObserver=this.le.add(t)}get onEnabledStateChangedObservable(){return this._nodeDataStorage._onEnabledStateChangedObservable}get onClonedObservable(){return this._nodeDataStorage._onClonedObservable}constructor(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._isDirty=!1,this._nodeDataStorage=new U,this.state="",this.metadata=null,this.reservedDataStore=null,this._accessibilityTag=null,this.onAccessibilityTagChangedObservable=new r.e,this._parentContainer=null,this.animations=[],this._ranges={},this.onReady=null,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._waitingParentInstanceIndex=null,this._waitingParsedUniqueId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=x.c.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._animationPropertiesOverride=null,this._isNode=!0,this.le=new r.e,this._onDisposeObserver=null,this._behaviors=new Array,this.name=t,this.id=t,this._scene=b||R.d.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache(),Y&&this._addToSceneRootNodes()}va(){return this._scene}getEngine(){return this._scene.getEngine()}addBehavior(t){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return-1!==this._behaviors.indexOf(t)||(t.init(),this._scene.isLoading&&!b?this._scene.onDataLoadedObservable.addOnce((()=>{t.attach(this)})):t.attach(this),this._behaviors.push(t)),this}removeBehavior(t){const b=this._behaviors.indexOf(t);return-1===b||(this._behaviors[b].detach(),this._behaviors.splice(b,1)),this}get behaviors(){return this._behaviors}getBehaviorByName(t){for(const b of this._behaviors)if(b.name===t)return b;return null}getWorldMatrix(){return this._currentRenderId!==this._scene.getRenderId()&&this.ve(),this._worldMatrix}_getWorldMatrixDeterminant(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant}get worldMatrixFromCache(){return this._worldMatrix}_initCache(){this._cache={}}updateCache(t){!t&&this.isSynchronized()||this._updateCache()}_getActionManagerForTrigger(t){return this.parent?this.parent._getActionManagerForTrigger(t,!1):null}_updateCache(t){}_isSynchronized(){return!0}_markSyncedWithParent(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)}isSynchronizedWithParent(){return!this._parentNode||!this._parentNode._isDirty&&this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()}isSynchronized(){return!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()}isReady(){return this._nodeDataStorage._isReady}Ae(t){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}isEnabled(){return!1===(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])?this._nodeDataStorage._isEnabled:!!this._nodeDataStorage._isEnabled&&this._nodeDataStorage._isParentEnabled}_syncParentEnabledState(){this._nodeDataStorage._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children&&this._children.forEach((t=>{t._syncParentEnabledState()}))}zg(t){this._nodeDataStorage._isEnabled!==t&&(this._nodeDataStorage._isEnabled=t,this._syncParentEnabledState(),this._nodeDataStorage._onEnabledStateChangedObservable.notifyObservers(t))}isDescendantOf(t){return!!this.parent&&(this.parent===t||this.parent.isDescendantOf(t))}_getDescendants(t){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=arguments.length>2?arguments[2]:void 0;if(this._children)for(let o=0;o<this._children.length;o++){const x=this._children[o];Y&&!Y(x)||t.push(x),b||x._getDescendants(t,!1,Y)}}getDescendants(t,b){const Y=[];return this._getDescendants(Y,t,b),Y}getChildMeshes(t,b){const Y=[];return this._getDescendants(Y,t,(t=>(!b||b(t))&&void 0!==t.Qe)),Y}getChildren(t){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.getDescendants(b,t)}_setReady(t){t!==this._nodeDataStorage._isReady&&(t?(this.onReady&&this.onReady(this),this._nodeDataStorage._isReady=!0):this._nodeDataStorage._isReady=!1)}getAnimationByName(t){for(let b=0;b<this.animations.length;b++){const Y=this.animations[b];if(Y.name===t)return Y}return null}createAnimationRange(t,b,Y){if(!this._ranges[t]){this._ranges[t]=C._AnimationRangeFactory(t,b,Y);for(let o=0,x=this.animations.length;o<x;o++)this.animations[o]&&this.animations[o].createRange(t,b,Y)}}deleteAnimationRange(t){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let Y=0,o=this.animations.length;Y<o;Y++)this.animations[Y]&&this.animations[Y].deleteRange(t,b);this._ranges[t]=null}getAnimationRange(t){return this._ranges[t]||null}clone(t,b,Y){const o=E.d.Clone((()=>new C(t,this.va())),this);if(b&&(o.parent=b),!Y){const b=this.getDescendants(!0);for(let Y=0;Y<b.length;Y++){const x=b[Y];x.clone(t+"."+x.name,o)}}return o}getAnimationRanges(){const t=[];let b;for(b in this._ranges)t.push(this._ranges[b]);return t}beginAnimation(t,b,Y,o){const x=this.getAnimationRange(t);return x?this._scene.beginAnimation(this,x.from,x.to,b,Y,o):null}serializeAnimationRanges(){const t=[];for(const b in this._ranges){const Y=this._ranges[b];if(!Y)continue;const o={};o.name=b,o.from=Y.from,o.to=Y.to,t.push(o)}return t}ve(t){return this._worldMatrix||(this._worldMatrix=x.c.Identity()),this._worldMatrix}dispose(t){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._nodeDataStorage._isDisposed=!0,!t){const Y=this.getDescendants(!0);for(const o of Y)o.dispose(t,b)}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.le.notifyObservers(this),this.le.clear(),this.onEnabledStateChangedObservable.clear(),this.onClonedObservable.clear();for(const Y of this._behaviors)Y.detach();this._behaviors.length=0,this.metadata=null}static ParseAnimationRanges(t,b,Y){if(b.ranges)for(let o=0;o<b.ranges.length;o++){const Y=b.ranges[o];t.createAnimationRange(Y.name,Y.from,Y.to)}}getHierarchyBoundingVectors(){let t,b,Y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.va().incrementRenderId(),this.ve(!0);const F=this;if(F.getBoundingInfo&&F.ne){const Y=F.getBoundingInfo();t=Y.boundingBox.minimumWorld.clone(),b=Y.boundingBox.maximumWorld.clone()}else t=new x.l(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),b=new x.l(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(Y){const Y=this.getDescendants(!1);for(const F of Y){const Y=F;if(Y.ve(!0),o&&!o(Y))continue;if(!Y.getBoundingInfo||0===Y.getTotalVertices())continue;const r=Y.getBoundingInfo().boundingBox,R=r.minimumWorld,d=r.maximumWorld;x.l.CheckExtends(R,t,b),x.l.CheckExtends(d,t,b)}}return{min:t,max:b}}}C._AnimationRangeFactory=(t,b,Y)=>{throw(0,d.c)("AnimationRange")},C._NodeConstructors={},(0,o.e)([(0,F.P)()],C.prototype,"name",void 0),(0,o.e)([(0,F.P)()],C.prototype,"id",void 0),(0,o.e)([(0,F.P)()],C.prototype,"uniqueId",void 0),(0,o.e)([(0,F.P)()],C.prototype,"state",void 0),(0,o.e)([(0,F.P)()],C.prototype,"metadata",void 0)},12296:(t,b,Y)=>{"use strict";class o{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((t,b)=>{this._resolve=t,this._reject=b}))}}var x=Y(1019),F=Y(1229),r=Y(1265),R=Y(11750),d=Y(12298),E=Y(12320),U=Y(1013),C=Y(11875),p=Y(12329),W=Y(12334),T=Y(1051),y=Y(1144),v=Y(1268);class B{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(t){this._useTextureToStoreBoneMatrices=t,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(t){this._animationPropertiesOverride=t}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(t,b,Y){this.name=t,this.id=b,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=x.c.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new U.e,this.bones=[],this._scene=Y||T.d.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const o=this._scene.getEngine().getCaps();this._canUseTextureForBones=o.textureFloat&&o.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((t=>!t.getParent()))}getTransformMatrices(t){if(this.needInitialSkinMatrix){if(!t)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return t._bonesTransformMatrices||this.prepare(!0),t._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(t){return this.needInitialSkinMatrix&&t._transformMatrixTexture?t._transformMatrixTexture:this._transformMatrixTexture}va(){return this._scene}toString(t){let b=`Name: ${this.name}, nBones: ${this.bones.length}`;if(b+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,t){b+=", Ranges: {";let t=!0;for(const Y in this._ranges)t&&(b+=", ",t=!1),b+=Y;b+="}"}return b}getBoneIndexByName(t){for(let b=0,Y=this.bones.length;b<Y;b++)if(this.bones[b].name===t)return b;return-1}createAnimationRange(t,b,Y){if(!this._ranges[t]){this._ranges[t]=new W.b(t,b,Y);for(let o=0,x=this.bones.length;o<x;o++)this.bones[o].animations[0]&&this.bones[o].animations[0].createRange(t,b,Y)}}deleteAnimationRange(t){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let Y=0,o=this.bones.length;Y<o;Y++)this.bones[Y].animations[0]&&this.bones[Y].animations[0].deleteRange(t,b);this._ranges[t]=null}getAnimationRange(t){return this._ranges[t]||null}getAnimationRanges(){const t=[];let b;for(b in this._ranges)t.push(this._ranges[b]);return t}copyAnimationRange(t,b){let Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[b]||!t.getAnimationRange(b))return!1;let o=!0;const x=this._getHighestAnimationFrame()+1,F={},r=t.bones;let R,d;for(d=0,R=r.length;d<R;d++)F[r[d].name]=r[d];this.bones.length!==r.length&&(y.b.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${r.length}`),o=!1);const E=Y&&this.dimensionsAtRest&&t.dimensionsAtRest?this.dimensionsAtRest.divide(t.dimensionsAtRest):null;for(d=0,R=this.bones.length;d<R;d++){const t=this.bones[d].name,r=F[t];r?o=o&&this.bones[d].copyAnimationRange(r,b,x,Y,E):(y.b.Warn("copyAnimationRange: not same rig, missing source bone "+t),o=!1)}const U=t.getAnimationRange(b);return U&&(this._ranges[b]=new W.b(b,U.from+x,U.to+x)),o}returnToRest(){for(const t of this.bones)-1!==t._index&&t.returnToRest()}_getHighestAnimationFrame(){let t=0;for(let b=0,Y=this.bones.length;b<Y;b++)if(this.bones[b].animations[0]){const Y=this.bones[b].animations[0].getHighestFrame();t<Y&&(t=Y)}return t}beginAnimation(t,b,Y,o){const x=this.getAnimationRange(t);return x?this._scene.beginAnimation(this,x.from,x.to,b,Y,o):null}static MakeAnimationAdditive(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Y=arguments.length>2?arguments[2]:void 0;const o=t.getAnimationRange(Y);if(!o)return null;const x=t._scene.getAllAnimatablesByTarget(t);let F=null;for(let R=0;R<x.length;R++){const t=x[R];if(t.fromFrame===(null===o||void 0===o?void 0:o.from)&&t.toFrame===(null===o||void 0===o?void 0:o.to)){F=t;break}}const r=t.getAnimatables();for(let R=0;R<r.length;R++){const t=r[R].animations;if(t)for(let o=0;o<t.length;o++)p.d.MakeAnimationAdditive(t[o],b,Y)}return F&&(F.isAdditive=!0),t}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(t){this._meshesWithPoseMatrix.push(t)}_unregisterMeshWithPoseMatrix(t){const b=this._meshesWithPoseMatrix.indexOf(t);b>-1&&this._meshesWithPoseMatrix.splice(b,1)}_computeTransformMatrices(t,b){this.onBeforeComputeObservable.notifyObservers(this);for(let Y=0;Y<this.bones.length;Y++){const o=this.bones[Y];o._childUpdateId++;const x=o.getParent();if(x?o.getLocalMatrix().multiplyToRef(x.getFinalMatrix(),o.getFinalMatrix()):b?o.getLocalMatrix().multiplyToRef(b,o.getFinalMatrix()):o.getFinalMatrix().p(o.getLocalMatrix()),-1!==o._index){const b=null===o._index?Y:o._index;o.getAbsoluteInverseBindMatrix().multiplyToArray(o.getFinalMatrix(),t,16*b)}}this._identity.copyToArray(t,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const t=this.va().getRenderId();if(this._currentRenderId===t)return;this._currentRenderId=t}if(this._numBonesWithLinkedTransformNode>0)for(const t of this.bones)if(t._linkedTransformNode){const b=t._linkedTransformNode;t.position=b.position,b.rotationQuaternion?t.rotationQuaternion=b.rotationQuaternion:t.rotation=b.rotation,t.Oe=b.Oe}if(this.needInitialSkinMatrix)for(const t of this._meshesWithPoseMatrix){const b=t.getPoseMatrix();let Y=this._isDirty;if(t._bonesTransformMatrices&&t._bonesTransformMatrices.length===16*(this.bones.length+1)||(t._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),Y=!0),Y){if(this._synchronizedWithMesh!==t){this._synchronizedWithMesh=t;for(const t of this.bones)if(!t.getParent()){t.getBindMatrix().multiplyToRef(b,x.f.Matrix[1]),t._updateAbsoluteBindMatrices(x.f.Matrix[1])}if(this.isUsingTextureForMatrices){const b=4*(this.bones.length+1);t._transformMatrixTexture&&t._transformMatrixTexture.getSize().width===b||(t._transformMatrixTexture&&t._transformMatrixTexture.dispose(),t._transformMatrixTexture=C.c.CreateRGBATexture(t._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(t._bonesTransformMatrices,b),this.isUsingTextureForMatrices&&t._transformMatrixTexture&&t._transformMatrixTexture.update(t._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=C.c.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let t=0;t<this.bones.length;t++)this._animatables.push(this.bones[t])}return this._animatables}clone(t,b){const Y=new B(t,b||t,this._scene);Y.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let o=0;o<this.bones.length;o++){const t=this.bones[o];let b=null;const x=t.getParent();if(x){const t=this.bones.indexOf(x);b=Y.bones[t]}const F=new E.d(t.name,Y,b,t.getBindMatrix().clone(),t.getRestMatrix().clone());F._index=t._index,t._linkedTransformNode&&F.linkTransformNode(t._linkedTransformNode),v.b.DeepCopy(t.animations,F.animations)}if(this._ranges){Y._ranges={};for(const t in this._ranges){const b=this._ranges[t];b&&(Y._ranges[t]=b.clone())}}return this._isDirty=!0,Y.prepare(!0),Y}enableBlending(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;this.bones.forEach((b=>{b.animations.forEach((b=>{b.enableBlending=!0,b.blendingSpeed=t}))}))}dispose(){if(this._meshesWithPoseMatrix.length=0,this.va().stopAnimation(this),this.va().removeSkeleton(this),this._parentContainer){const t=this._parentContainer.skeletons.indexOf(this);t>-1&&this._parentContainer.skeletons.splice(t,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const t={};t.name=this.name,t.id=this.id,this.dimensionsAtRest&&(t.dimensionsAtRest=this.dimensionsAtRest.qe()),t.bones=[],t.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let Y=0;Y<this.bones.length;Y++){var b;const o=this.bones[Y],x=o.getParent(),F={parentBoneIndex:x?this.bones.indexOf(x):-1,index:o.getIndex(),name:o.name,id:o.id,matrix:o.getBindMatrix().qe(),rest:o.getRestMatrix().qe(),linkedTransformNodeId:null===(b=o.getTransformNode())||void 0===b?void 0:b.id};t.bones.push(F),o.length&&(F.length=o.length),o.metadata&&(F.metadata=o.metadata),o.animations&&o.animations.length>0&&(F.animation=o.animations[0].serialize()),t.ranges=[];for(const b in this._ranges){const Y=this._ranges[b];if(!Y)continue;const o={};o.name=b,o.from=Y.from,o.to=Y.to,t.ranges.push(o)}}return t}static Parse(t,b){const Y=new B(t.name,t.id,b);let o;for(t.dimensionsAtRest&&(Y.dimensionsAtRest=x.l.ce(t.dimensionsAtRest)),Y.needInitialSkinMatrix=t.needInitialSkinMatrix,o=0;o<t.bones.length;o++){const b=t.bones[o],F=t.bones[o].index;let r=null;b.parentBoneIndex>-1&&(r=Y.bones[b.parentBoneIndex]);const R=b.rest?x.c.ce(b.rest):null,d=new E.d(b.name,Y,r,x.c.ce(b.matrix),R,null,F);void 0!==b.id&&null!==b.id&&(d.id=b.id),b.length&&(d.length=b.length),b.metadata&&(d.metadata=b.metadata),b.animation&&d.animations.push(p.d.Parse(b.animation)),void 0!==b.linkedTransformNodeId&&null!==b.linkedTransformNodeId&&(Y._hasWaitingData=!0,d._waitingTransformNodeId=b.linkedTransformNodeId)}if(t.ranges)for(o=0;o<t.ranges.length;o++){const b=t.ranges[o];Y.createAnimationRange(b.name,b.from,b.to)}return Y}computeAbsoluteMatrices(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||t)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(t)}getPoseMatrix(){let t=null;return this._meshesWithPoseMatrix.length>0&&(t=this._meshesWithPoseMatrix[0].getPoseMatrix()),t}sortBones(){const t=[],b=new Array(this.bones.length);for(let Y=0;Y<this.bones.length;Y++)this._sortBones(Y,t,b);this.bones=t}_sortBones(t,b,Y){if(Y[t])return;Y[t]=!0;const o=this.bones[t];if(!o)return;void 0===o._index&&(o._index=t);const x=o.getParent();x&&this._sortBones(this.bones.indexOf(x),b,Y),b.push(o)}setCurrentPoseAsRest(){this.bones.forEach((t=>{t.setCurrentPoseAsRest()}))}}var J=Y(1394),m=Y(999),K=Y(1001),L=Y(12340),z=Y(12346),S=Y(1041),e=Y(1224);class g extends z.e{get refractionTexture(){return this.subSurface.refractionTexture}set refractionTexture(t){this.subSurface.refractionTexture=t,t?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)}get indexOfRefraction(){return this.subSurface.indexOfRefraction}set indexOfRefraction(t){this.subSurface.indexOfRefraction=t}get invertRefractionY(){return this.subSurface.invertRefractionY}set invertRefractionY(t){this.subSurface.invertRefractionY=t}get linkRefractionWithTransparency(){return this.subSurface.linkRefractionWithTransparency}set linkRefractionWithTransparency(t){this.subSurface.linkRefractionWithTransparency=t,t&&(this.subSurface.isRefractionEnabled=!0)}get usePhysicalLightFalloff(){return this._lightFalloff===z.e.LIGHTFALLOFF_PHYSICAL}set usePhysicalLightFalloff(t){t!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=t?z.e.LIGHTFALLOFF_PHYSICAL:z.e.LIGHTFALLOFF_STANDARD)}get useGLTFLightFalloff(){return this._lightFalloff===z.e.LIGHTFALLOFF_GLTF}set useGLTFLightFalloff(t){t!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=t?z.e.LIGHTFALLOFF_GLTF:z.e.LIGHTFALLOFF_STANDARD)}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(t){this._attachImageProcessingConfiguration(t),this._markAllSubMeshesAsTexturesDirty()}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(t){this.imageProcessingConfiguration.colorCurvesEnabled=t}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(t){this.imageProcessingConfiguration.colorGradingEnabled=t}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(t){this._imageProcessingConfiguration.toneMappingEnabled=t}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(t){this._imageProcessingConfiguration.exposure=t}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(t){this._imageProcessingConfiguration.contrast=t}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(t){this._imageProcessingConfiguration.colorGradingTexture=t}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(t){this._imageProcessingConfiguration.colorCurves=t}constructor(t,b){super(t,b,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.directIntensity=1,this.emissiveIntensity=1,this.environmentIntensity=1,this.specularIntensity=1,this.disableBumpMap=!1,this.ambientTextureStrength=1,this.ambientTextureImpactOnAnalyticalLights=g.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this.metallicF0Factor=1,this.metallicReflectanceColor=F.d.White(),this.useOnlyMetallicFromMetallicReflectanceTexture=!1,this.ambientColor=new F.d(0,0,0),this.albedoColor=new F.d(1,1,1),this.reflectivityColor=new F.d(1,1,1),this.reflectionColor=new F.d(1,1,1),this.emissiveColor=new F.d(0,0,0),this.microSurface=1,this.useLightmapAsShadowmap=!1,this.useAlphaFromAlbedoTexture=!1,this.forceAlphaTest=!1,this.alphaCutOff=.4,this.useSpecularOverAlpha=!0,this.useMicroSurfaceFromReflectivityMapAlpha=!1,this.useRoughnessFromMetallicTextureAlpha=!0,this.useRoughnessFromMetallicTextureGreen=!1,this.useMetallnessFromMetallicTextureBlue=!1,this.useAmbientOcclusionFromMetallicTextureRed=!1,this.useAmbientInGrayScale=!1,this.useAutoMicroSurfaceFromReflectivityMap=!1,this.useRadianceOverAlpha=!0,this.useObjectSpaceNormalMap=!1,this.useParallax=!1,this.useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this.disableLighting=!1,this.forceIrradianceInFragment=!1,this.maxSimultaneousLights=4,this.invertNormalMapX=!1,this.invertNormalMapY=!1,this.twoSidedLighting=!1,this.useAlphaFresnel=!1,this.useLinearAlphaFresnel=!1,this.environmentBRDFTexture=null,this.forceNormalForward=!1,this.enableSpecularAntiAliasing=!1,this.useHorizonOcclusion=!0,this.useRadianceOcclusion=!0,this.unlit=!1,this.applyDecalMapAfterDetailMap=!1,this._environmentBRDFTexture=(0,L.b)(this.va())}getClassName(){return"PBRMaterial"}clone(t){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const o=e.d.Clone((()=>new g(t,this.va())),this,{cloneTexturesOnlyOnce:b});return o.id=t,o.name=t,this.stencil.copyTo(o.stencil),this._clonePlugins(o,Y),o}serialize(){const t=super.serialize();return t.customType="BABYLON.PBRMaterial",t}static Parse(t,b,Y){const o=e.d.Parse((()=>new g(t.name,b)),t,b,Y);return t.stencil&&o.stencil.parse(t.stencil,b,Y),J.e._ParsePlugins(t,o,b,Y),t.clearCoat&&o.clearCoat.parse(t.clearCoat,b,Y),t.anisotropy&&o.anisotropy.parse(t.anisotropy,b,Y),t.brdf&&o.brdf.parse(t.brdf,b,Y),t.sheen&&o.sheen.parse(t.sheen,b,Y),t.subSurface&&o.subSurface.parse(t.subSurface,b,Y),t.iridescence&&o.iridescence.parse(t.iridescence,b,Y),o}}g.PBRMATERIAL_OPAQUE=z.e.PBRMATERIAL_OPAQUE,g.PBRMATERIAL_ALPHATEST=z.e.PBRMATERIAL_ALPHATEST,g.PBRMATERIAL_ALPHABLEND=z.e.PBRMATERIAL_ALPHABLEND,g.PBRMATERIAL_ALPHATESTANDBLEND=z.e.PBRMATERIAL_ALPHATESTANDBLEND,g.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=z.e.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,(0,m.e)([(0,K.P)(),(0,K.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"directIntensity",void 0),(0,m.e)([(0,K.P)(),(0,K.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"emissiveIntensity",void 0),(0,m.e)([(0,K.P)(),(0,K.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"environmentIntensity",void 0),(0,m.e)([(0,K.P)(),(0,K.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"specularIntensity",void 0),(0,m.e)([(0,K.P)(),(0,K.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"disableBumpMap",void 0),(0,m.e)([(0,K.I)(),(0,K.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"albedoTexture",void 0),(0,m.e)([(0,K.I)(),(0,K.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"ambientTexture",void 0),(0,m.e)([(0,K.P)(),(0,K.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"ambientTextureStrength",void 0),(0,m.e)([(0,K.P)(),(0,K.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),(0,m.e)([(0,K.I)(),(0,K.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],g.prototype,"opacityTexture",void 0),(0,m.e)([(0,K.I)(),(0,K.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"reflectionTexture",void 0),(0,m.e)([(0,K.I)(),(0,K.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"emissiveTexture",void 0),(0,m.e)([(0,K.I)(),(0,K.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"reflectivityTexture",void 0),(0,m.e)([(0,K.I)(),(0,K.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"metallicTexture",void 0),(0,m.e)([(0,K.P)(),(0,K.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"metallic",void 0),(0,m.e)([(0,K.P)(),(0,K.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"roughness",void 0),(0,m.e)([(0,K.P)(),(0,K.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"metallicF0Factor",void 0),(0,m.e)([(0,K.h)(),(0,K.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"metallicReflectanceColor",void 0),(0,m.e)([(0,K.P)(),(0,K.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"useOnlyMetallicFromMetallicReflectanceTexture",void 0),(0,m.e)([(0,K.I)(),(0,K.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"metallicReflectanceTexture",void 0),(0,m.e)([(0,K.I)(),(0,K.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"reflectanceTexture",void 0),(0,m.e)([(0,K.I)(),(0,K.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"microSurfaceTexture",void 0),(0,m.e)([(0,K.I)(),(0,K.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"bumpTexture",void 0),(0,m.e)([(0,K.I)(),(0,K.b)("_markAllSubMeshesAsTexturesDirty",null)],g.prototype,"lightmapTexture",void 0),(0,m.e)([(0,K.h)("ambient"),(0,K.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"ambientColor",void 0),(0,m.e)([(0,K.h)("albedo"),(0,K.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"albedoColor",void 0),(0,m.e)([(0,K.h)("reflectivity"),(0,K.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"reflectivityColor",void 0),(0,m.e)([(0,K.h)("reflection"),(0,K.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"reflectionColor",void 0),(0,m.e)([(0,K.h)("emissive"),(0,K.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"emissiveColor",void 0),(0,m.e)([(0,K.P)(),(0,K.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"microSurface",void 0),(0,m.e)([(0,K.P)(),(0,K.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"useLightmapAsShadowmap",void 0),(0,m.e)([(0,K.P)(),(0,K.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],g.prototype,"useAlphaFromAlbedoTexture",void 0),(0,m.e)([(0,K.P)(),(0,K.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],g.prototype,"forceAlphaTest",void 0),(0,m.e)([(0,K.P)(),(0,K.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],g.prototype,"alphaCutOff",void 0),(0,m.e)([(0,K.P)(),(0,K.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"useSpecularOverAlpha",void 0),(0,m.e)([(0,K.P)(),(0,K.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),(0,m.e)([(0,K.P)(),(0,K.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),(0,m.e)([(0,K.P)(),(0,K.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"useRoughnessFromMetallicTextureGreen",void 0),(0,m.e)([(0,K.P)(),(0,K.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"useMetallnessFromMetallicTextureBlue",void 0),(0,m.e)([(0,K.P)(),(0,K.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),(0,m.e)([(0,K.P)(),(0,K.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"useAmbientInGrayScale",void 0),(0,m.e)([(0,K.P)(),(0,K.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),(0,m.e)([(0,K.P)()],g.prototype,"usePhysicalLightFalloff",null),(0,m.e)([(0,K.P)()],g.prototype,"useGLTFLightFalloff",null),(0,m.e)([(0,K.P)(),(0,K.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"useRadianceOverAlpha",void 0),(0,m.e)([(0,K.P)(),(0,K.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"useObjectSpaceNormalMap",void 0),(0,m.e)([(0,K.P)(),(0,K.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"useParallax",void 0),(0,m.e)([(0,K.P)(),(0,K.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"useParallaxOcclusion",void 0),(0,m.e)([(0,K.P)(),(0,K.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"parallaxScaleBias",void 0),(0,m.e)([(0,K.P)(),(0,K.b)("_markAllSubMeshesAsLightsDirty")],g.prototype,"disableLighting",void 0),(0,m.e)([(0,K.P)(),(0,K.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"forceIrradianceInFragment",void 0),(0,m.e)([(0,K.P)(),(0,K.b)("_markAllSubMeshesAsLightsDirty")],g.prototype,"maxSimultaneousLights",void 0),(0,m.e)([(0,K.P)(),(0,K.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"invertNormalMapX",void 0),(0,m.e)([(0,K.P)(),(0,K.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"invertNormalMapY",void 0),(0,m.e)([(0,K.P)(),(0,K.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"twoSidedLighting",void 0),(0,m.e)([(0,K.P)(),(0,K.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"useAlphaFresnel",void 0),(0,m.e)([(0,K.P)(),(0,K.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"useLinearAlphaFresnel",void 0),(0,m.e)([(0,K.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"environmentBRDFTexture",void 0),(0,m.e)([(0,K.P)(),(0,K.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"forceNormalForward",void 0),(0,m.e)([(0,K.P)(),(0,K.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"enableSpecularAntiAliasing",void 0),(0,m.e)([(0,K.P)(),(0,K.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"useHorizonOcclusion",void 0),(0,m.e)([(0,K.P)(),(0,K.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"useRadianceOcclusion",void 0),(0,m.e)([(0,K.P)(),(0,K.b)("_markAllSubMeshesAsMiscDirty")],g.prototype,"unlit",void 0),(0,m.e)([(0,K.P)(),(0,K.b)("_markAllSubMeshesAsMiscDirty")],g.prototype,"applyDecalMapAfterDetailMap",void 0),(0,S.d)("BABYLON.PBRMaterial",g);var D=Y(990),H=Y(11790),f=Y(1307),n=Y(11773),X=Y(11781),Q=Y(11737);class N{get influence(){return this._influence}set influence(t){if(this._influence===t)return;const b=this._influence;this._influence=t,this.onInfluenceChanged.hasObservers()&&this.onInfluenceChanged.notifyObservers(0===b||0===t)}get animationPropertiesOverride(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride}set animationPropertiesOverride(t){this._animationPropertiesOverride=t}constructor(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.name=t,this.animations=[],this._positions=null,this._normals=null,this._tangents=null,this._uvs=null,this._uniqueId=0,this.onInfluenceChanged=new U.e,this._onDataLayoutChanged=new U.e,this._animationPropertiesOverride=null,this.id=t,this._scene=Y||T.d.LastCreatedScene,this.influence=b,this._scene&&(this._uniqueId=this._scene.getUniqueId())}get uniqueId(){return this._uniqueId}get hasPositions(){return!!this._positions}get hasNormals(){return!!this._normals}get hasTangents(){return!!this._tangents}get hasUVs(){return!!this._uvs}setPositions(t){const b=this.hasPositions;this._positions=t,b!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)}getPositions(){return this._positions}setNormals(t){const b=this.hasNormals;this._normals=t,b!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)}getNormals(){return this._normals}setTangents(t){const b=this.hasTangents;this._tangents=t,b!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)}getTangents(){return this._tangents}setUVs(t){const b=this.hasUVs;this._uvs=t,b!==this.hasUVs&&this._onDataLayoutChanged.notifyObservers(void 0)}getUVs(){return this._uvs}clone(){const t=e.d.Clone((()=>new N(this.name,this.influence,this._scene)),this);return t._positions=this._positions,t._normals=this._normals,t._tangents=this._tangents,t._uvs=this._uvs,t}serialize(){const t={};return t.name=this.name,t.influence=this.influence,t.xa=Array.prototype.slice.call(this.getPositions()),null!=this.id&&(t.id=this.id),this.hasNormals&&(t.ya=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(t.tangents=Array.prototype.slice.call(this.getTangents())),this.hasUVs&&(t.Aa=Array.prototype.slice.call(this.getUVs())),e.d.AppendSerializedAnimations(this,t),t}getClassName(){return"MorphTarget"}static Parse(t,b){const Y=new N(t.name,t.influence);if(Y.setPositions(t.xa),null!=t.id&&(Y.id=t.id),t.ya&&Y.setNormals(t.ya),t.tangents&&Y.setTangents(t.tangents),t.Aa&&Y.setUVs(t.Aa),t.animations){for(let b=0;b<t.animations.length;b++){const o=t.animations[b],x=(0,S.b)("BABYLON.Animation");x&&Y.animations.push(x.Parse(o))}t.autoAnimate&&b&&b.beginAnimation(Y,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,t.autoAnimateSpeed||1)}return Y}static FromMesh(t,b,Y){b||(b=t.name);const o=new N(b,Y,t.va());return o.setPositions(t.getVerticesData(f.e.PositionKind)),t.isVerticesDataPresent(f.e.NormalKind)&&o.setNormals(t.getVerticesData(f.e.NormalKind)),t.isVerticesDataPresent(f.e.TangentKind)&&o.setTangents(t.getVerticesData(f.e.TangentKind)),t.isVerticesDataPresent(f.e.UVKind)&&o.setUVs(t.getVerticesData(f.e.UVKind)),o}}(0,m.e)([(0,K.P)()],N.prototype,"id",void 0);var u=Y(1252),Z=Y(1633);class a{set areUpdatesFrozen(t){t?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(!0)))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new u.d(16),this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,t||(t=T.d.LastCreatedScene),this._scene=t,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const t=this._scene.getEngine().getCaps();this._canUseTextureForTargets=t.canUseGLVertexID&&t.textureFloat&&t.maxVertexTextureImageUnits>0&&t.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return this._numMaxInfluencers}set numMaxInfluencers(t){this._numMaxInfluencers!==t&&(this._numMaxInfluencers=t,this._syncActiveTargets(!0))}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(t){this._useTextureToStoreTargets=t}get isUsingTextureForTargets(){var t;return a.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(t=this._scene)&&void 0!==t&&t.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(t){return this._activeTargets.data[t]}getTarget(t){return this._targets[t]}getTargetByName(t){for(const b of this._targets)if(b.name===t)return b;return null}addTarget(t){this._targets.push(t),this._targetInfluenceChangedObservers.push(t.onInfluenceChanged.add((t=>{this._syncActiveTargets(t)}))),this._targetDataLayoutChangedObservers.push(t._onDataLayoutChanged.add((()=>{this._syncActiveTargets(!0)}))),this._syncActiveTargets(!0)}removeTarget(t){const b=this._targets.indexOf(t);b>=0&&(this._targets.splice(b,1),t.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(b,1)[0]),t._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(b,1)[0]),this._syncActiveTargets(!0)),this._scene&&this._scene.stopAnimation(t)}_bind(t){t.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),t.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),t.setTexture("morphTargets",this._targetStoreTexture),t.setInt("morphTargetCount",this.numInfluencers)}clone(){const t=new a(this._scene);for(const b of this._targets)t.addTarget(b.clone());return t.enableNormalMorphing=this.enableNormalMorphing,t.enableTangentMorphing=this.enableTangentMorphing,t.enableUVMorphing=this.enableUVMorphing,t}serialize(){const t={};t.id=this.uniqueId,t.targets=[];for(const b of this._targets)t.targets.push(b.serialize());return t}_syncActiveTargets(t){if(this.areUpdatesFrozen)return;let b=0;this._activeTargets.reset(),this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._vertexCount=0,this._scene&&this._targets.length>this._scene.getEngine().getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let Y=-1;for(const o of this._targets){if(Y++,0===o.influence&&this.optimizeInfluencers)continue;if(this._activeTargets.length>=a.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(o),this._morphTargetTextureIndices[b]=Y,this._tempInfluences[b++]=o.influence,this._supportsNormals=this._supportsNormals&&o.hasNormals,this._supportsTangents=this._supportsTangents&&o.hasTangents,this._supportsUVs=this._supportsUVs&&o.hasUVs;const t=o.getPositions();if(t){const b=t.length/3;if(0===this._vertexCount)this._vertexCount=b;else if(this._vertexCount!==b)return void y.b.Error("Incompatible target. Targets must all have the same vertices count.")}}this._morphTargetTextureIndices.length!==b&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,b)),this._influences&&this._influences.length===b||(this._influences=new Float32Array(b));for(let o=0;o<b;o++)this._influences[o]=this._tempInfluences[o];t&&this.synchronize()}synchronize(){if(this._scene&&!this.areUpdatesFrozen){if(this.isUsingTextureForTargets&&(this._vertexCount||this.numMaxInfluencers>0)){this._textureVertexStride=1,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const t=this._scene.getEngine().getCaps().maxTextureSize;this._textureWidth>t&&(this._textureHeight=Math.ceil(this._textureWidth/t),this._textureWidth=t);let b=!0;if(this._targetStoreTexture){const t=this._targetStoreTexture.getSize();t.width===this._textureWidth&&t.height===this._textureHeight&&this._targetStoreTexture.depth===this._targets.length&&(b=!1)}if(b){this._targetStoreTexture&&this._targetStoreTexture.dispose();const t=this._targets.length,b=new Float32Array(t*this._textureWidth*this._textureHeight*4);let Y=0;for(let o=0;o<t;o++){const t=this._targets[o],x=t.getPositions(),F=t.getNormals(),r=t.getUVs(),R=t.getTangents();if(!x)return void(0===o&&y.b.Error("Invalid morph target. Target must have positions."));Y=o*this._textureWidth*this._textureHeight*4;for(let o=0;o<this._vertexCount;o++)b[Y]=x[3*o],b[Y+1]=x[3*o+1],b[Y+2]=x[3*o+2],Y+=4,this._supportsNormals&&F&&(b[Y]=F[3*o],b[Y+1]=F[3*o+1],b[Y+2]=F[3*o+2],Y+=4),this._supportsUVs&&r&&(b[Y]=r[2*o],b[Y+1]=r[2*o+1],Y+=4),this._supportsTangents&&R&&(b[Y]=R[3*o],b[Y+1]=R[3*o+1],b[Y+2]=R[3*o+2],Y+=4)}this._targetStoreTexture=Z.e.CreateRGBATexture(b,this._textureWidth,this._textureHeight,t,this._scene,!1,!1,1,1)}}for(const t of this._scene.meshes)t.morphTargetManager===this&&t._syncGeometryWithMorphTargetManager()}}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const t=this._parentContainer.morphTargetManagers.indexOf(this);t>-1&&this._parentContainer.morphTargetManagers.splice(t,1),this._parentContainer=null}for(const t of this._targets)this._scene.stopAnimation(t)}}static Parse(t,b){const Y=new a(b);for(const o of t.targets)Y.addTarget(N.Parse(o,b));return Y}}a.EnableTextureStorage=!0,a.MaxActiveMorphTargetsInVertexAttributeMode=8;var A=Y(12352),M=Y(1081),w=Y(1415);function c(t,b,Y,o){return x.l.ce(b,Y).scaleInPlace(o)}class I{constructor(t,b,Y,o){this.type=t,this.name=b,this.getValue=Y,this.getStride=o}_buildAnimation(t,b,Y){const o=new p.d(t,this.name,b,this.type);return o.setKeys(Y),o}}class s extends I{buildAnimations(t,b,Y,o,x){x(t._babylonTransformNode,this._buildAnimation(b,Y,o))}}const l={translation:[new s(p.d.ANIMATIONTYPE_VECTOR3,"position",c,(()=>3))],rotation:[new s(p.d.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",(function(t,b,Y,o){return x.e.ce(b,Y).scaleInPlace(o)}),(()=>4))],scale:[new s(p.d.ANIMATIONTYPE_VECTOR3,"Oe",c,(()=>3))],weights:[new class extends I{buildAnimations(t,b,Y,o,x){if(t._numMorphTargets)for(let F=0;F<t._numMorphTargets;F++){const r=new p.d(`${b}_${F}`,this.name,Y,this.type);if(r.setKeys(o.map((t=>({frame:t.frame,inTangent:t.inTangent?t.inTangent[F]:void 0,value:t.value[F],outTangent:t.outTangent?t.outTangent[F]:void 0,interpolation:t.interpolation})))),t._primitiveBabylonMeshes)for(const b of t._primitiveBabylonMeshes)if(b.morphTargetManager){const t=b.morphTargetManager.getTarget(F),Y=r.clone();t.animations.push(Y),x(t,Y)}}}}(p.d.ANIMATIONTYPE_FLOAT,"influence",(function(t,b,Y,o){const x=new Array(t._numMorphTargets);for(let F=0;F<x.length;F++)x[F]=b[Y++]*o;return x}),(t=>t._numMorphTargets))]},i=new Map,V=i;function P(t,b,Y){k(t)&&y.b.Warn(`Extension with the name '${t}' already exists`),i.set(t,{isGLTFExtension:b,factory:Y})}function k(t){return i.delete(t)}function q(){const t=t=>t&&"object"===typeof t;for(var b=arguments.length,Y=new Array(b),o=0;o<b;o++)Y[o]=arguments[o];return Y.reduce(((b,Y)=>(Object.keys(Y).forEach((o=>{const x=b[o],F=Y[o];Array.isArray(x)&&Array.isArray(F)?b[o]=x.concat(...F):t(x)&&t(F)?b[o]=q(x,F):b[o]=F})),b)),{})}class O{static Get(t,b,Y){if(!b||void 0==Y||!b[Y])throw new Error(`${t}: Failed to find index (${Y})`);return b[Y]}static TryGet(t,b){return t&&void 0!=b&&t[b]?t[b]:null}static Assign(t){if(t)for(let b=0;b<t.length;b++)t[b].index=b}}class j{static RegisterExtension(t,b){P(t,!1,b)}static UnregisterExtension(t){return k(t)}get Wi(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(t){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=t}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((t=>t.dispose&&t.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}importMeshAsync(t,b,Y,o,x,F){let r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return Promise.resolve().then((()=>{this._babylonScene=b,this._assetContainer=Y,this._loadData(o);let F=null;if(t){const b={};if(this._gltf.nodes)for(const t of this._gltf.nodes)t.name&&(b[t.name]=t.index);F=(t instanceof Array?t:[t]).map((t=>{const Y=b[t];if(void 0===Y)throw new Error(`Failed to find node '${t}'`);return Y}))}return this._loadAsync(x,r,F,(()=>({meshes:this._getMeshes(),ue:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}loadAsync(t,b,Y,o){let x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return Promise.resolve().then((()=>(this._babylonScene=t,this._loadData(b),this._loadAsync(Y,x,null,(()=>{})))))}_loadAsync(t,b,Y,o){return Promise.resolve().then((async()=>{this._rootUrl=t,this._uniqueRootUrl=!t.startsWith("file:")&&b?t:`${t}${Date.now()}/`,this._fileName=b,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const x=`${A.m[A.m.LOADING]} => ${A.m[A.m.READY]}`,F=`${A.m[A.m.LOADING]} => ${A.m[A.m.COMPLETE]}`;this._parent._startPerformanceCounter(x),this._parent._startPerformanceCounter(F),this._parent._setState(A.m.LOADING),this._extensionsOnLoading();const R=new Array;if(!this.parent.loadOnlyMaterials)if(Y)R.push(this.loadSceneAsync("/nodes",{nodes:Y,index:-1}));else if(void 0!=this._gltf.Se||this._gltf.scenes&&this._gltf.scenes[0]){const t=O.Get("/scene",this._gltf.scenes,this._gltf.Se||0);R.push(this.loadSceneAsync(`/scenes/${t.index}`,t))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let t=0;t<this._gltf.materials.length;++t){const b=this._gltf.materials[t],Y="/materials/"+t,o=J.e.TriangleFillMode;R.push(this._loadMaterialAsync(Y,b,null,o,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&R.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&R.push(this._compileShadowGeneratorsAsync());return Promise.all(R).then((()=>(this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.zg(!0),this._extensionsOnReady(),this._parent._setState(A.m.READY),this._startAnimations(),o()))).then((t=>(this._parent._endPerformanceCounter(x),r.f.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(F),this._parent._setState(A.m.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(t=>{this._parent.onErrorObservable.notifyObservers(t),this._parent.onErrorObservable.clear(),this.dispose()}))})),t)))})).catch((t=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(t),this._parent.onErrorObservable.clear(),this.dispose()),t}))}_loadData(t){if(this._gltf=t.json,this._setupData(),t.bin){const b=this._gltf.buffers;if(b&&b[0]&&!b[0].uri){const Y=b[0];(Y.byteLength<t.bin.byteLength-3||Y.byteLength>t.bin.byteLength)&&y.b.Warn(`Binary buffer length (${Y.byteLength}) from JSON does not match chunk length (${t.bin.byteLength})`),this._bin=t.bin}else y.b.Warn("Unexpected BIN chunk")}}_setupData(){if(O.Assign(this._gltf.accessors),O.Assign(this._gltf.animations),O.Assign(this._gltf.buffers),O.Assign(this._gltf.bufferViews),O.Assign(this._gltf.cameras),O.Assign(this._gltf.images),O.Assign(this._gltf.materials),O.Assign(this._gltf.meshes),O.Assign(this._gltf.nodes),O.Assign(this._gltf.samplers),O.Assign(this._gltf.scenes),O.Assign(this._gltf.skins),O.Assign(this._gltf.textures),this._gltf.nodes){const t={};for(const Y of this._gltf.nodes)if(Y.children)for(const b of Y.children)t[b]=Y.index;const b=this._createRootNode();for(const Y of this._gltf.nodes){const o=t[Y.index];Y.parent=void 0===o?b:this._gltf.nodes[o]}}}async _loadExtensionsAsync(){const t=[];if(V.forEach(((b,Y)=>{var o;!1===(null===(o=this.parent.extensionOptions[Y])||void 0===o?void 0:o.enabled)?b.isGLTFExtension&&this.isExtensionUsed(Y)&&y.b.Warn(`Extension ${Y} is used but has been explicitly disabled.`):b.isGLTFExtension&&!this.isExtensionUsed(Y)||t.push((async()=>{const t=await b.factory(this);return t.name!==Y&&y.b.Warn(`The name of the glTF loader extension instance does not match the registered name: ${t.name} !== ${Y}`),this._parent.onExtensionLoadedObservable.notifyObservers(t),t})())})),this._extensions.push(...await Promise.all(t)),this._extensions.sort(((t,b)=>(t.order||Number.MAX_VALUE)-(b.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const Y of this._gltf.extensionsRequired){if(!this._extensions.some((t=>t.name===Y&&t.enabled))){var b;if(!1===(null===(b=this.parent.extensionOptions[Y])||void 0===b?void 0:b.enabled))throw new Error(`Required extension ${Y} is disabled`);throw new Error(`Required extension ${Y} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const t=new Q.d("__root__",this._babylonScene);this._rootBabylonMesh=t,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.zg(!1);const b={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case A.k.AUTO:this._babylonScene.useRightHandedSystem||(b.rotation=[0,1,0,0],b.scale=[1,1,-1],j._LoadTransform(b,this._rootBabylonMesh));break;case A.k.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(t),b}loadSceneAsync(t,b){const Y=this._extensionsLoadSceneAsync(t,b);if(Y)return Y;const o=new Array;if(this.logOpen(`${t} ${b.name||""}`),b.nodes)for(const x of b.nodes){const b=O.Get(`${t}/nodes/${x}`,this._gltf.nodes,x);o.push(this.loadNodeAsync(`/nodes/${b.index}`,b,(t=>{t.parent=this._rootBabylonMesh})))}for(const x of this._postSceneLoadActions)x();return o.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(o).then((()=>{}))}_forEachPrimitive(t,b){if(t._primitiveBabylonMeshes)for(const Y of t._primitiveBabylonMeshes)b(Y)}_getGeometries(){const t=[],b=this._gltf.nodes;if(b)for(const Y of b)this._forEachPrimitive(Y,(b=>{const Y=b.Ee;Y&&-1===t.indexOf(Y)&&t.push(Y)}));return t}_getMeshes(){const t=[];this._rootBabylonMesh instanceof X.b&&t.push(this._rootBabylonMesh);const b=this._gltf.nodes;if(b)for(const Y of b)this._forEachPrimitive(Y,(b=>{t.push(b)}));return t}_getTransformNodes(){const t=[],b=this._gltf.nodes;if(b)for(const Y of b)Y._babylonTransformNode&&"mb"===Y._babylonTransformNode.getClassName()&&t.push(Y._babylonTransformNode),Y._babylonTransformNodeForSkin&&t.push(Y._babylonTransformNodeForSkin);return t}_getSkeletons(){const t=[],b=this._gltf.skins;if(b)for(const Y of b)Y._data&&t.push(Y._data.babylonSkeleton);return t}_getAnimationGroups(){const t=[],b=this._gltf.animations;if(b)for(const Y of b)Y._babylonAnimationGroup&&t.push(Y._babylonAnimationGroup);return t}_startAnimations(){switch(this._parent.animationStartMode){case A.g.NONE:break;case A.g.FIRST:{const t=this._getAnimationGroups();0!==t.length&&t[0].start(!0);break}case A.g.ALL:{const t=this._getAnimationGroups();for(const b of t)b.start(!0);break}default:return void y.b.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(t,b){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const o=this._extensionsLoadNodeAsync(t,b,Y);if(o)return o;if(b._babylonTransformNode)throw new Error(`${t}: Invalid recursive node hierarchy`);const x=new Array;this.logOpen(`${t} ${b.name||""}`);const F=o=>{if(j.AddPointerMetadata(o,t),j._LoadTransform(b,o),void 0!=b.camera){const Y=O.Get(`${t}/camera`,this._gltf.cameras,b.camera);x.push(this.loadCameraAsync(`/cameras/${Y.index}`,Y,(t=>{t.parent=o})))}if(b.children)for(const Y of b.children){const b=O.Get(`${t}/children/${Y}`,this._gltf.nodes,Y);x.push(this.loadNodeAsync(`/nodes/${b.index}`,b,(t=>{t.parent=o})))}Y(o)},r=void 0!=b.mesh,R=this._parent.loadSkins&&void 0!=b.skin;if(!r||R){const t=b.name||`node${b.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const Y=new H.d(t,this._babylonScene);Y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==b.mesh?b._babylonTransformNode=Y:b._babylonTransformNodeForSkin=Y,F(Y)}if(r)if(R){const Y=O.Get(`${t}/mesh`,this._gltf.meshes,b.mesh);x.push(this._loadMeshAsync(`/meshes/${Y.index}`,b,Y,(Y=>{const o=b._babylonTransformNodeForSkin;Y.metadata=q(o.metadata,Y.metadata||{});const F=O.Get(`${t}/skin`,this._gltf.skins,b.skin);x.push(this._loadSkinAsync(`/skins/${F.index}`,b,F,(t=>{this._forEachPrimitive(b,(b=>{b.skeleton=t})),this._postSceneLoadActions.push((()=>{if(void 0!=F.skeleton){const t=O.Get(`/skins/${F.index}/skeleton`,this._gltf.nodes,F.skeleton).parent;b.index===t.index?Y.parent=o.parent:Y.parent=t._babylonTransformNode}else Y.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:o,skinnedNode:Y})}))})))})))}else{const Y=O.Get(`${t}/mesh`,this._gltf.meshes,b.mesh);x.push(this._loadMeshAsync(`/meshes/${Y.index}`,b,Y,F))}return this.logClose(),Promise.all(x).then((()=>(this._forEachPrimitive(b,(t=>{t.Ee&&t.Ee.useBoundingInfoFromGeometry?t.Ea():t.refreshBoundingInfo(!0,!0)})),b._babylonTransformNode)))}_loadMeshAsync(t,b,Y,o){const x=Y.primitives;if(!x||!x.length)throw new Error(`${t}: Primitives are missing`);void 0==x[0].index&&O.Assign(x);const F=new Array;this.logOpen(`${t} ${Y.name||""}`);const r=b.name||`node${b.index}`;if(1===x.length){const o=Y.primitives[0];F.push(this._loadMeshPrimitiveAsync(`${t}/primitives/${o.index}`,r,b,Y,o,(t=>{b._babylonTransformNode=t,b._primitiveBabylonMeshes=[t]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,b._babylonTransformNode=new H.d(r,this._babylonScene),b._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,b._primitiveBabylonMeshes=[];for(const o of x)F.push(this._loadMeshPrimitiveAsync(`${t}/primitives/${o.index}`,`${r}_primitive${o.index}`,b,Y,o,(t=>{t.parent=b._babylonTransformNode,b._primitiveBabylonMeshes.push(t)})))}return o(b._babylonTransformNode),this.logClose(),Promise.all(F).then((()=>b._babylonTransformNode))}_loadMeshPrimitiveAsync(t,b,Y,o,x,F){const r=this._extensionsLoadMeshPrimitiveAsync(t,b,Y,o,x,F);if(r)return r;this.logOpen(`${t}`);const R=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==Y.skin&&!o.primitives[0].targets;let d,E;if(R&&x._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,d=x._instanceData.babylonSourceMesh.Dd(b),d._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,E=x._instanceData.promise;else{const F=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const r=new Q.d(b,this._babylonScene);r._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,r.sideOrientation=this._babylonScene.useRightHandedSystem?J.e.CounterClockWiseSideOrientation:J.e.ClockWiseSideOrientation,this._createMorphTargets(t,Y,o,x,r),F.push(this._loadVertexDataAsync(t,x,r).then((b=>this._loadMorphTargetsAsync(t,x,r,b).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,b.Ca(r),b._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const U=j._GetDrawMode(t,x.mode);if(void 0==x.material){let t=this._defaultBabylonMaterialData[U];t||(t=this._createDefaultMaterial("__GLTFLoader._default",U),this._parent.onMaterialLoadedObservable.notifyObservers(t),this._defaultBabylonMaterialData[U]=t),r.material=t}else if(!this.parent.skipMaterials){const b=O.Get(`${t}/material`,this._gltf.materials,x.material);F.push(this._loadMaterialAsync(`/materials/${b.index}`,b,r,U,(t=>{r.material=t})))}E=Promise.all(F),R&&(x._instanceData={babylonSourceMesh:r,promise:E}),d=r}return j.AddPointerMetadata(d,t),this._parent.onMeshLoadedObservable.notifyObservers(d),F(d),this.logClose(),E.then((()=>d))}_loadVertexDataAsync(t,b,Y){const o=this._extensionsLoadVertexDataAsync(t,b,Y);if(o)return o;const F=b.attributes;if(!F)throw new Error(`${t}: Attributes are missing`);const r=new Array,R=new n.c(Y.name,this._babylonScene);if(void 0==b.indices)Y.isUnIndexed=!0;else{const Y=O.Get(`${t}/indices`,this._gltf.accessors,b.indices);r.push(this._loadIndicesAccessorAsync(`/accessors/${Y.index}`,Y).then((t=>{R.setIndices(t)})))}const d=(b,o,d)=>{if(void 0==F[b])return;Y._delayInfo=Y._delayInfo||[],-1===Y._delayInfo.indexOf(o)&&Y._delayInfo.push(o);const E=O.Get(`${t}/attributes/${b}`,this._gltf.accessors,F[b]);r.push(this._loadVertexAccessorAsync(`/accessors/${E.index}`,E,o).then((t=>{if(t.getKind()===f.e.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!Y.skeleton&&E.min&&E.max){const t=x.f.ae[0].be(...E.min),b=x.f.ae[1].be(...E.max);if(E.normalized&&5126!==E.componentType){let Y=1;switch(E.componentType){case 5120:Y=127;break;case 5121:Y=255;break;case 5122:Y=32767;break;case 5123:Y=65535}const o=1/Y;t.scaleInPlace(o),b.scaleInPlace(o)}R._boundingInfo=new w.b(t,b),R.useBoundingInfoFromGeometry=!0}R.setVerticesBuffer(t,E.count)}))),o==f.e.MatricesIndicesExtraKind&&(Y.numBoneInfluencers=8),d&&d(E)};return d("POSITION",f.e.PositionKind),d("NORMAL",f.e.NormalKind),d("TANGENT",f.e.TangentKind),d("TEXCOORD_0",f.e.UVKind),d("TEXCOORD_1",f.e.UV2Kind),d("TEXCOORD_2",f.e.UV3Kind),d("TEXCOORD_3",f.e.UV4Kind),d("TEXCOORD_4",f.e.UV5Kind),d("TEXCOORD_5",f.e.UV6Kind),d("JOINTS_0",f.e.MatricesIndicesKind),d("WEIGHTS_0",f.e.MatricesWeightsKind),d("JOINTS_1",f.e.MatricesIndicesExtraKind),d("WEIGHTS_1",f.e.MatricesWeightsExtraKind),d("COLOR_0",f.e.ColorKind,(t=>{"VEC4"===t.type&&(Y.hasVertexAlpha=!0)})),Promise.all(r).then((()=>R))}_createMorphTargets(t,b,Y,o,x){if(!o.targets||!this._parent.loadMorphTargets)return;if(void 0==b._numMorphTargets)b._numMorphTargets=o.targets.length;else if(o.targets.length!==b._numMorphTargets)throw new Error(`${t}: Primitives do not have the same number of targets`);const F=Y.extras?Y.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,x.morphTargetManager=new a(this._babylonScene),x.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,x.morphTargetManager.areUpdatesFrozen=!0;for(let r=0;r<o.targets.length;r++){const t=b.weights?b.weights[r]:Y.weights?Y.weights[r]:0,o=F?F[r]:`morphTarget${r}`;x.morphTargetManager.addTarget(new N(o,t,x.va()))}}_loadMorphTargetsAsync(t,b,Y,o){if(!b.targets||!this._parent.loadMorphTargets)return Promise.resolve();const x=new Array,F=Y.morphTargetManager;for(let r=0;r<F.numTargets;r++){const Y=F.getTarget(r);x.push(this._loadMorphTargetVertexDataAsync(`${t}/targets/${r}`,o,b.targets[r],Y))}return Promise.all(x).then((()=>{F.areUpdatesFrozen=!1}))}_loadMorphTargetVertexDataAsync(t,b,Y,o){const x=new Array,F=(o,F,r)=>{if(void 0==Y[o])return;const R=b.getVertexBuffer(F);if(!R)return;const d=O.Get(`${t}/${o}`,this._gltf.accessors,Y[o]);x.push(this._loadFloatAccessorAsync(`/accessors/${d.index}`,d).then((t=>{r(R,t)})))};return F("POSITION",f.e.PositionKind,((t,b)=>{const Y=new Float32Array(b.length);t.forEach(b.length,((t,o)=>{Y[o]=b[o]+t})),o.setPositions(Y)})),F("NORMAL",f.e.NormalKind,((t,b)=>{const Y=new Float32Array(b.length);t.forEach(Y.length,((t,o)=>{Y[o]=b[o]+t})),o.setNormals(Y)})),F("TANGENT",f.e.TangentKind,((t,b)=>{const Y=new Float32Array(b.length/3*4);let x=0;t.forEach(b.length/3*4,((t,o)=>{(o+1)%4!==0&&(Y[x]=b[x]+t,x++)})),o.setTangents(Y)})),Promise.all(x).then((()=>{}))}static _LoadTransform(t,b){if(void 0!=t.skin)return;let Y=x.l.Zero(),o=x.e.Identity(),F=x.l.One();if(t.matrix){x.c.ce(t.matrix).decompose(F,o,Y)}else t.translation&&(Y=x.l.ce(t.translation)),t.rotation&&(o=x.e.ce(t.rotation)),t.scale&&(F=x.l.ce(t.scale));b.position=Y,b.rotationQuaternion=o,b.Oe=F}_loadSkinAsync(t,b,Y,o){if(!this._parent.loadSkins)return Promise.resolve();const x=this._extensionsLoadSkinAsync(t,b,Y);if(x)return x;if(Y._data)return o(Y._data.babylonSkeleton),Y._data.promise;const F=`skeleton${Y.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const r=new B(Y.name||F,F,this._babylonScene);r._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(t,Y,r);const R=this._loadSkinInverseBindMatricesDataAsync(t,Y).then((t=>{this._updateBoneMatrices(r,t)}));return Y._data={babylonSkeleton:r,promise:R},o(r),R}_loadBones(t,b,Y){if(void 0==b.skeleton||this._parent.alwaysComputeSkeletonRootNode){const Y=this._findSkeletonRootNode(`${t}/joints`,b.joints);if(Y)if(void 0===b.skeleton)b.skeleton=Y.index;else{const o=(t,b)=>{for(;b.parent;b=b.parent)if(b.parent===t)return!0;return!1},x=O.Get(`${t}/skeleton`,this._gltf.nodes,b.skeleton);x===Y||o(x,Y)||(y.b.Warn(`${t}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),b.skeleton=Y.index)}else y.b.Warn(`${t}: Failed to find common root`)}const o={};for(const x of b.joints){const F=O.Get(`${t}/joints/${x}`,this._gltf.nodes,x);this._loadBone(F,b,Y,o)}}_findSkeletonRootNode(t,b){if(0===b.length)return null;const Y={};for(const x of b){const b=[];let o=O.Get(`${t}/${x}`,this._gltf.nodes,x);for(;-1!==o.index;)b.unshift(o),o=o.parent;Y[x]=b}let o=null;for(let x=0;;++x){let t=Y[b[0]];if(x>=t.length)return o;const F=t[x];for(let r=1;r<b.length;++r)if(t=Y[b[r]],x>=t.length||F!==t[x])return o;o=F}}_loadBone(t,b,Y,o){t._isJoint=!0;let x=o[t.index];if(x)return x;let F=null;t.index!==b.skeleton&&(t.parent&&-1!==t.parent.index?F=this._loadBone(t.parent,b,Y,o):void 0!==b.skeleton&&y.b.Warn(`/skins/${b.index}/skeleton: Skeleton node is not a common root`));const r=b.joints.indexOf(t.index);return x=new E.d(t.name||`joint${t.index}`,Y,F,this._getNodeMatrix(t),null,null,r),o[t.index]=x,this._postSceneLoadActions.push((()=>{x.linkTransformNode(t._babylonTransformNode)})),x}_loadSkinInverseBindMatricesDataAsync(t,b){if(void 0==b.inverseBindMatrices)return Promise.resolve(null);const Y=O.Get(`${t}/inverseBindMatrices`,this._gltf.accessors,b.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${Y.index}`,Y)}_updateBoneMatrices(t,b){for(const Y of t.bones){const t=x.c.Identity(),o=Y._index;b&&-1!==o&&(x.c.FromArrayToRef(b,16*o,t),t.invertToRef(t));const F=Y.getParent();F&&t.multiplyToRef(F.getAbsoluteInverseBindMatrix(),t),Y.Ge(t,!1,!1),Y._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(t){return t.matrix?x.c.ce(t.matrix):x.c.Compose(t.scale?x.l.ce(t.scale):x.l.One(),t.rotation?x.e.ce(t.rotation):x.e.Identity(),t.translation?x.l.ce(t.translation):x.l.Zero())}loadCameraAsync(t,b){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const o=this._extensionsLoadCameraAsync(t,b,Y);if(o)return o;const F=new Array;this.logOpen(`${t} ${b.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const r=new d.c(b.name||`camera${b.index}`,x.l.Zero(),this._babylonScene,!1);switch(r._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,r.ignoreParentScaling=!0,b._babylonCamera=r,r.rotation.set(0,Math.PI,0),b.type){case"perspective":{const Y=b.perspective;if(!Y)throw new Error(`${t}: Camera perspective properties are missing`);r.fov=Y.yfov,r._i=Y.znear,r.maxZ=Y.zfar||0;break}case"orthographic":if(!b.orthographic)throw new Error(`${t}: Camera orthographic properties are missing`);r.mode=R.b.ORTHOGRAPHIC_CAMERA,r.orthoLeft=-b.orthographic.xmag,r.orthoRight=b.orthographic.xmag,r.orthoBottom=-b.orthographic.ymag,r.orthoTop=b.orthographic.ymag,r._i=b.orthographic.znear,r.maxZ=b.orthographic.zfar;break;default:throw new Error(`${t}: Invalid camera type (${b.type})`)}return j.AddPointerMetadata(r,t),this._parent.onCameraLoadedObservable.notifyObservers(r),Y(r),this.logClose(),Promise.all(F).then((()=>r))}_loadAnimationsAsync(){const t=this._gltf.animations;if(!t)return Promise.resolve();const b=new Array;for(let Y=0;Y<t.length;Y++){const o=t[Y];b.push(this.loadAnimationAsync(`/animations/${o.index}`,o).then((t=>{0===t.targetedAnimations.length&&t.dispose()})))}return Promise.all(b).then((()=>{}))}loadAnimationAsync(t,b){const o=this._extensionsLoadAnimationAsync(t,b);return o||Y.e(43).then(Y.bind(Y,12973)).then((Y=>{let{AnimationGroup:o}=Y;this._babylonScene._blockEntityCollection=!!this._assetContainer;const x=new o(b.name||`animation${b.index}`,this._babylonScene);x._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,b._babylonAnimationGroup=x;const F=new Array;O.Assign(b.channels),O.Assign(b.samplers);for(const r of b.channels)F.push(this._loadAnimationChannelAsync(`${t}/channels/${r.index}`,t,b,r,((t,b)=>{t.animations=t.animations||[],t.animations.push(b),x.addTargetedAnimation(b,t)})));return Promise.all(F).then((()=>(x.normalize(0),x)))}))}_loadAnimationChannelAsync(t,b,Y,o,x){const F=this._extensionsLoadAnimationChannelAsync(t,b,Y,o,x);if(F)return F;if(void 0==o.target.node)return Promise.resolve();const r=O.Get(`${t}/target/node`,this._gltf.nodes,o.target.node),R=o.target.path,d="weights"===R;if(d&&!r._numMorphTargets||!d&&!r._babylonTransformNode)return Promise.resolve();if(!this._parent.loadNodeAnimations&&!d&&!r._isJoint)return Promise.resolve();let E;switch(R){case"translation":E=l.translation;break;case"rotation":E=l.rotation;break;case"scale":E=l.scale;break;case"weights":E=l.weights;break;default:throw new Error(`${t}/target/path: Invalid value (${o.target.path})`)}const U={object:r,info:E};return this._loadAnimationChannelFromTargetInfoAsync(t,b,Y,o,U,x)}_loadAnimationChannelFromTargetInfoAsync(t,b,Y,o,x,F){const r=this.parent.targetFps,R=1/r,d=O.Get(`${t}/sampler`,Y.samplers,o.sampler);return this._loadAnimationSamplerAsync(`${b}/samplers/${o.sampler}`,d).then((t=>{let b=0;const d=x.object,E=x.info;for(const x of E){const E=x.getStride(d),U=t.input,C=t.output,p=new Array(U.length);let W=0;switch(t.interpolation){case"STEP":for(let t=0;t<U.length;t++){const b=x.getValue(d,C,W,1);W+=E,p[t]={frame:U[t]*r,value:b,interpolation:1}}break;case"CUBICSPLINE":for(let t=0;t<U.length;t++){const b=x.getValue(d,C,W,R);W+=E;const Y=x.getValue(d,C,W,1);W+=E;const o=x.getValue(d,C,W,R);W+=E,p[t]={frame:U[t]*r,inTangent:b,value:Y,outTangent:o}}break;case"LINEAR":for(let t=0;t<U.length;t++){const b=x.getValue(d,C,W,1);W+=E,p[t]={frame:U[t]*r,value:b}}}if(W>0){const t=`${Y.name||`animation${Y.index}`}_channel${o.index}_${b}`;x.buildAnimations(d,t,r,p,((t,Y)=>{++b,F(t,Y)}))}}}))}_loadAnimationSamplerAsync(t,b){if(b._data)return b._data;const Y=b.interpolation||"LINEAR";switch(Y){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${t}/interpolation: Invalid value (${b.interpolation})`)}const o=O.Get(`${t}/input`,this._gltf.accessors,b.input),x=O.Get(`${t}/output`,this._gltf.accessors,b.output);return b._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${o.index}`,o),this._loadFloatAccessorAsync(`/accessors/${x.index}`,x)]).then((t=>{let[b,o]=t;return{input:b,interpolation:Y,output:o}})),b._data}loadBufferAsync(t,b,Y,o){const x=this._extensionsLoadBufferAsync(t,b,Y,o);if(x)return x;if(!b._data)if(b.uri)b._data=this.loadUriAsync(`${t}/uri`,b,b.uri);else{if(!this._bin)throw new Error(`${t}: Uri is missing or the binary glTF is missing its binary chunk`);b._data=this._bin.readAsync(0,b.byteLength)}return b._data.then((b=>{try{return new Uint8Array(b.buffer,b.byteOffset+Y,o)}catch(x){throw new Error(`${t}: ${x.message}`)}}))}loadBufferViewAsync(t,b){const Y=this._extensionsLoadBufferViewAsync(t,b);if(Y)return Y;if(b._data)return b._data;const o=O.Get(`${t}/buffer`,this._gltf.buffers,b.buffer);return b._data=this.loadBufferAsync(`/buffers/${o.index}`,o,b.byteOffset||0,b.byteLength),b._data}_loadAccessorAsync(t,b,Y){if(b._data)return b._data;const o=j._GetNumComponents(t,b.type),x=o*f.e.GetTypeByteLength(b.componentType),F=o*b.count;if(void 0==b.bufferView)b._data=Promise.resolve(new Y(F));else{const r=O.Get(`${t}/bufferView`,this._gltf.bufferViews,b.bufferView);b._data=this.loadBufferViewAsync(`/bufferViews/${r.index}`,r).then((R=>{if(5126!==b.componentType||b.normalized||r.byteStride&&r.byteStride!==x){const t=new Y(F);return f.e.ForEach(R,b.byteOffset||0,r.byteStride||x,o,b.componentType,t.length,b.normalized||!1,((b,Y)=>{t[Y]=b})),t}return j._GetTypedArray(t,b.componentType,R,b.byteOffset,F)}))}if(b.sparse){const F=b.sparse;b._data=b._data.then((r=>{const R=r,d=O.Get(`${t}/sparse/indices/bufferView`,this._gltf.bufferViews,F.indices.bufferView),E=O.Get(`${t}/sparse/values/bufferView`,this._gltf.bufferViews,F.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${d.index}`,d),this.loadBufferViewAsync(`/bufferViews/${E.index}`,E)]).then((r=>{let[d,E]=r;const U=j._GetTypedArray(`${t}/sparse/indices`,F.indices.componentType,d,F.indices.byteOffset,F.count),C=o*F.count;let p;if(5126!==b.componentType||b.normalized){const r=j._GetTypedArray(`${t}/sparse/values`,b.componentType,E,F.values.byteOffset,C);p=new Y(C),f.e.ForEach(r,0,x,o,b.componentType,p.length,b.normalized||!1,((t,b)=>{p[b]=t}))}else p=j._GetTypedArray(`${t}/sparse/values`,b.componentType,E,F.values.byteOffset,C);let W=0;for(let t=0;t<U.length;t++){let b=U[t]*o;for(let t=0;t<o;t++)R[b++]=p[W++]}return R}))}))}return b._data}_loadFloatAccessorAsync(t,b){return this._loadAccessorAsync(t,b,Float32Array)}_loadIndicesAccessorAsync(t,b){if("SCALAR"!==b.type)throw new Error(`${t}/type: Invalid value ${b.type}`);if(5121!==b.componentType&&5123!==b.componentType&&5125!==b.componentType)throw new Error(`${t}/componentType: Invalid value ${b.componentType}`);if(b._data)return b._data;if(b.sparse){const Y=j._GetTypedArrayConstructor(`${t}/componentType`,b.componentType);b._data=this._loadAccessorAsync(t,b,Y)}else{const Y=O.Get(`${t}/bufferView`,this._gltf.bufferViews,b.bufferView);b._data=this.loadBufferViewAsync(`/bufferViews/${Y.index}`,Y).then((Y=>j._GetTypedArray(t,b.componentType,Y,b.byteOffset,b.count)))}return b._data}_loadVertexBufferViewAsync(t){if(t._babylonBuffer)return t._babylonBuffer;const b=this._babylonScene.getEngine();return t._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${t.index}`,t).then((t=>new f.d(b,t,!1))),t._babylonBuffer}_loadVertexAccessorAsync(t,b,Y){var o;if(null!==(o=b._babylonVertexBuffer)&&void 0!==o&&o[Y])return b._babylonVertexBuffer[Y];b._babylonVertexBuffer||(b._babylonVertexBuffer={});const x=this._babylonScene.getEngine();if(b.sparse||void 0==b.bufferView)b._babylonVertexBuffer[Y]=this._loadFloatAccessorAsync(t,b).then((t=>new f.e(x,t,Y,!1)));else{const o=O.Get(`${t}/bufferView`,this._gltf.bufferViews,b.bufferView);b._babylonVertexBuffer[Y]=this._loadVertexBufferViewAsync(o).then((F=>{const r=j._GetNumComponents(t,b.type);return new f.e(x,F,Y,!1,void 0,o.byteStride,void 0,b.byteOffset,r,b.componentType,b.normalized,!0,void 0,!0)}))}return b._babylonVertexBuffer[Y]}_loadMaterialMetallicRoughnessPropertiesAsync(t,b,Y){if(!(Y instanceof g))throw new Error(`${t}: Material type not supported`);const o=new Array;return b&&(b.baseColorFactor?(Y.albedoColor=F.d.ce(b.baseColorFactor),Y.alpha=b.baseColorFactor[3]):Y.albedoColor=F.d.White(),Y.metallic=void 0==b.metallicFactor?1:b.metallicFactor,Y.roughness=void 0==b.roughnessFactor?1:b.roughnessFactor,b.baseColorTexture&&o.push(this.loadTextureInfoAsync(`${t}/baseColorTexture`,b.baseColorTexture,(t=>{t.name=`${Y.name} (Base Color)`,Y.albedoTexture=t}))),b.metallicRoughnessTexture&&(b.metallicRoughnessTexture.nonColorData=!0,o.push(this.loadTextureInfoAsync(`${t}/metallicRoughnessTexture`,b.metallicRoughnessTexture,(t=>{t.name=`${Y.name} (Metallic Roughness)`,Y.metallicTexture=t}))),Y.useMetallnessFromMetallicTextureBlue=!0,Y.useRoughnessFromMetallicTextureGreen=!0,Y.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(o).then((()=>{}))}_loadMaterialAsync(t,b,Y,o){let x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const F=this._extensionsLoadMaterialAsync(t,b,Y,o,x);if(F)return F;b._data=b._data||{};let r=b._data[o];if(!r){this.logOpen(`${t} ${b.name||""}`);const Y=this.createMaterial(t,b,o);r={babylonMaterial:Y,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(t,b,Y)},b._data[o]=r,j.AddPointerMetadata(Y,t),this._parent.onMaterialLoadedObservable.notifyObservers(Y),this.logClose()}return Y&&(r.babylonMeshes.push(Y),Y.le.addOnce((()=>{const t=r.babylonMeshes.indexOf(Y);-1!==t&&r.babylonMeshes.splice(t,1)}))),x(r.babylonMaterial),r.promise.then((()=>r.babylonMaterial))}_createDefaultMaterial(t,b){this._babylonScene._blockEntityCollection=!!this._assetContainer;const Y=new g(t,this._babylonScene);return Y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,Y.fillMode=b,Y.enableSpecularAntiAliasing=!0,Y.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,Y.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,Y.transparencyMode=g.PBRMATERIAL_OPAQUE,Y.metallic=1,Y.roughness=1,Y}createMaterial(t,b,Y){const o=this._extensionsCreateMaterial(t,b,Y);if(o)return o;const x=b.name||`material${b.index}`;return this._createDefaultMaterial(x,Y)}loadMaterialPropertiesAsync(t,b,Y){const o=this._extensionsLoadMaterialPropertiesAsync(t,b,Y);if(o)return o;const x=new Array;return x.push(this.loadMaterialBasePropertiesAsync(t,b,Y)),b.pbrMetallicRoughness&&x.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${t}/pbrMetallicRoughness`,b.pbrMetallicRoughness,Y)),this.loadMaterialAlphaProperties(t,b,Y),Promise.all(x).then((()=>{}))}loadMaterialBasePropertiesAsync(t,b,Y){if(!(Y instanceof g))throw new Error(`${t}: Material type not supported`);const o=new Array;return Y.emissiveColor=b.emissiveFactor?F.d.ce(b.emissiveFactor):new F.d(0,0,0),b.doubleSided&&(Y.Ce=!1,Y.twoSidedLighting=!0),b.normalTexture&&(b.normalTexture.nonColorData=!0,o.push(this.loadTextureInfoAsync(`${t}/normalTexture`,b.normalTexture,(t=>{t.name=`${Y.name} (Normal)`,Y.bumpTexture=t}))),Y.invertNormalMapX=!this._babylonScene.useRightHandedSystem,Y.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=b.normalTexture.scale&&Y.bumpTexture&&(Y.bumpTexture.level=b.normalTexture.scale),Y.forceIrradianceInFragment=!0),b.occlusionTexture&&(b.occlusionTexture.nonColorData=!0,o.push(this.loadTextureInfoAsync(`${t}/occlusionTexture`,b.occlusionTexture,(t=>{t.name=`${Y.name} (Occlusion)`,Y.ambientTexture=t}))),Y.useAmbientInGrayScale=!0,void 0!=b.occlusionTexture.strength&&(Y.ambientTextureStrength=b.occlusionTexture.strength)),b.emissiveTexture&&o.push(this.loadTextureInfoAsync(`${t}/emissiveTexture`,b.emissiveTexture,(t=>{t.name=`${Y.name} (Emissive)`,Y.emissiveTexture=t}))),Promise.all(o).then((()=>{}))}loadMaterialAlphaProperties(t,b,Y){if(!(Y instanceof g))throw new Error(`${t}: Material type not supported`);switch(b.alphaMode||"OPAQUE"){case"OPAQUE":Y.transparencyMode=g.PBRMATERIAL_OPAQUE,Y.alpha=1;break;case"MASK":Y.transparencyMode=g.PBRMATERIAL_ALPHATEST,Y.alphaCutOff=void 0==b.alphaCutoff?.5:b.alphaCutoff,Y.albedoTexture&&(Y.albedoTexture.Cc=!0);break;case"BLEND":Y.transparencyMode=g.PBRMATERIAL_ALPHABLEND,Y.albedoTexture&&(Y.albedoTexture.Cc=!0,Y.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${t}/alphaMode: Invalid value (${b.alphaMode})`)}}loadTextureInfoAsync(t,b){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const o=this._extensionsLoadTextureInfoAsync(t,b,Y);if(o)return o;if(this.logOpen(`${t}`),b.texCoord>=6)throw new Error(`${t}/texCoord: Invalid value (${b.texCoord})`);const x=O.Get(`${t}/index`,this._gltf.textures,b.index);x._textureInfo=b;const F=this._loadTextureAsync(`/textures/${b.index}`,x,(o=>{o.coordinatesIndex=b.texCoord||0,j.AddPointerMetadata(o,t),this._parent.onTextureLoadedObservable.notifyObservers(o),Y(o)}));return this.logClose(),F}_loadTextureAsync(t,b){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const o=this._extensionsLoadTextureAsync(t,b,Y);if(o)return o;this.logOpen(`${t} ${b.name||""}`);const x=void 0==b.sampler?j.DefaultSampler:O.Get(`${t}/sampler`,this._gltf.samplers,b.sampler),F=O.Get(`${t}/source`,this._gltf.images,b.source),r=this._createTextureAsync(t,x,F,Y,void 0,!b._textureInfo.nonColorData);return this.logClose(),r}_createTextureAsync(t,b,Y){let x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},F=arguments.length>4?arguments[4]:void 0,r=arguments.length>5?arguments[5]:void 0;const R=this._loadSampler(`/samplers/${b.index}`,b),d=new Array,E=new o;this._babylonScene._blockEntityCollection=!!this._assetContainer;const U={noMipmap:R.noMipMaps,invertY:!1,samplingMode:R.samplingMode,X:()=>{this._disposed||E.resolve()},onError:(b,Y)=>{this._disposed||E.reject(new Error(`${t}: ${Y&&Y.message?Y.message:b||"Failed to load texture"}`))},mimeType:Y.mimeType,loaderOptions:F,useSRGBBuffer:!!r&&this._parent.useSRGBBuffers},C=new D.b(null,this._babylonScene,U);return C._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,d.push(E.promise),d.push(this.loadImageAsync(`/images/${Y.index}`,Y).then((t=>{const b=Y.uri||`${this._fileName}#image${Y.index}`,o=`data:${this._uniqueRootUrl}${b}`;C.updateURL(o,t);const x=C.getInternalTexture();x&&(x.label=Y.name)}))),C.wrapU=R.wrapU,C.wrapV=R.wrapV,x(C),this._parent.useGltfTextureNames&&(C.name=Y.name||Y.uri||`image${Y.index}`),Promise.all(d).then((()=>C))}_loadSampler(t,b){return b._data||(b._data={noMipMaps:9728===b.minFilter||9729===b.minFilter,samplingMode:j._GetTextureSamplingMode(t,b),wrapU:j._GetTextureWrapMode(`${t}/wrapS`,b.wrapS),wrapV:j._GetTextureWrapMode(`${t}/wrapT`,b.wrapT)}),b._data}loadImageAsync(t,b){if(!b._data){if(this.logOpen(`${t} ${b.name||""}`),b.uri)b._data=this.loadUriAsync(`${t}/uri`,b,b.uri);else{const Y=O.Get(`${t}/bufferView`,this._gltf.bufferViews,b.bufferView);b._data=this.loadBufferViewAsync(`/bufferViews/${Y.index}`,Y)}this.logClose()}return b._data}loadUriAsync(t,b,Y){const o=this._extensionsLoadUriAsync(t,b,Y);if(o)return o;if(!j._ValidateUri(Y))throw new Error(`${t}: '${Y}' is invalid`);if((0,M.f)(Y)){const b=new Uint8Array((0,M.c)(Y));return this.log(`${t}: Decoded ${Y.substring(0,64)}... (${b.length} bytes)`),Promise.resolve(b)}return this.log(`${t}: Loading ${Y}`),this._parent.preprocessUrlAsync(this._rootUrl+Y).then((b=>new Promise(((o,x)=>{this._parent._loadFile(this._babylonScene,b,(b=>{this._disposed||(this.log(`${t}: Loaded ${Y} (${b.byteLength} bytes)`),o(new Uint8Array(b)))}),!0,(b=>{x(new M.i(`${t}: Failed to load '${Y}'${b?": "+b.status+" "+b.statusText:""}`,b))}))}))))}static AddPointerMetadata(t,b){t.metadata=t.metadata||{};const Y=t._internalMetadata=t._internalMetadata||{},o=Y.Wi=Y.Wi||{};(o.pointers=o.pointers||[]).push(b)}static _GetTextureWrapMode(t,b){switch(b=void 0==b?10497:b){case 33071:return D.b.CLAMP_ADDRESSMODE;case 33648:return D.b.MIRROR_ADDRESSMODE;case 10497:return D.b.WRAP_ADDRESSMODE;default:return y.b.Warn(`${t}: Invalid value (${b})`),D.b.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(t,b){const Y=void 0==b.magFilter?9729:b.magFilter,o=void 0==b.minFilter?9987:b.minFilter;if(9729===Y)switch(o){case 9728:return D.b.LINEAR_NEAREST;case 9729:return D.b.LINEAR_LINEAR;case 9984:return D.b.LINEAR_NEAREST_MIPNEAREST;case 9985:return D.b.LINEAR_LINEAR_MIPNEAREST;case 9986:return D.b.LINEAR_NEAREST_MIPLINEAR;case 9987:return D.b.LINEAR_LINEAR_MIPLINEAR;default:return y.b.Warn(`${t}/minFilter: Invalid value (${o})`),D.b.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==Y&&y.b.Warn(`${t}/magFilter: Invalid value (${Y})`),o){case 9728:return D.b.NEAREST_NEAREST;case 9729:return D.b.NEAREST_LINEAR;case 9984:return D.b.NEAREST_NEAREST_MIPNEAREST;case 9985:return D.b.NEAREST_LINEAR_MIPNEAREST;case 9986:return D.b.NEAREST_NEAREST_MIPLINEAR;case 9987:return D.b.NEAREST_LINEAR_MIPLINEAR;default:return y.b.Warn(`${t}/minFilter: Invalid value (${o})`),D.b.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(t,b){switch(b){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`${t}: Invalid component type ${b}`)}}static _GetTypedArray(t,b,Y,o,x){const F=Y.buffer;o=Y.byteOffset+(o||0);const r=j._GetTypedArrayConstructor(`${t}/componentType`,b),R=f.e.GetTypeByteLength(b);return o%R!==0?(y.b.Warn(`${t}: Copying buffer as byte offset (${o}) is not a multiple of component type byte length (${R})`),new r(F.slice(o,o+x*R),0)):new r(F,o,x)}static _GetNumComponents(t,b){switch(b){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${t}: Invalid type (${b})`)}static _ValidateUri(t){return r.f.IsBase64(t)||-1===t.indexOf("..")}static _GetDrawMode(t,b){switch(void 0==b&&(b=4),b){case 0:return J.e.PointListDrawMode;case 1:return J.e.LineListDrawMode;case 2:return J.e.LineLoopDrawMode;case 3:return J.e.LineStripDrawMode;case 4:return J.e.TriangleFillMode;case 5:return J.e.TriangleStripDrawMode;case 6:return J.e.TriangleFanDrawMode}throw new Error(`${t}: Invalid mesh primitive mode (${b})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const t=new Array;if(this._gltf.materials)for(const b of this._gltf.materials)if(b._data)for(const Y in b._data){const o=b._data[Y];for(const b of o.babylonMeshes){b.ve(!0);const Y=o.babylonMaterial;t.push(Y.forceCompilationAsync(b)),t.push(Y.forceCompilationAsync(b,{useInstances:!0})),this._parent.useClipPlane&&(t.push(Y.forceCompilationAsync(b,{clipPlane:!0})),t.push(Y.forceCompilationAsync(b,{clipPlane:!0,useInstances:!0})))}}return Promise.all(t).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const t=new Array,b=this._babylonScene.lights;for(const Y of b){const b=Y.getShadowGenerator();b&&t.push(b.forceCompilationAsync())}return Promise.all(t).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(t){for(const b of this._extensions)b.enabled&&t(b)}_applyExtensions(t,b,Y){for(const o of this._extensions)if(o.enabled){const x=`${o.name}.${b}`,F=t;F._activeLoaderExtensionFunctions=F._activeLoaderExtensionFunctions||{};const r=F._activeLoaderExtensionFunctions;if(!r[x]){r[x]=!0;try{const t=Y(o);if(t)return t}finally{delete r[x]}}}return null}_extensionsOnLoading(){this._forEachExtensions((t=>t.onLoading&&t.onLoading()))}_extensionsOnReady(){this._forEachExtensions((t=>t.onReady&&t.onReady()))}_extensionsLoadSceneAsync(t,b){return this._applyExtensions(b,"loadScene",(Y=>Y.loadSceneAsync&&Y.loadSceneAsync(t,b)))}_extensionsLoadNodeAsync(t,b,Y){return this._applyExtensions(b,"loadNode",(o=>o.loadNodeAsync&&o.loadNodeAsync(t,b,Y)))}_extensionsLoadCameraAsync(t,b,Y){return this._applyExtensions(b,"loadCamera",(o=>o.loadCameraAsync&&o.loadCameraAsync(t,b,Y)))}_extensionsLoadVertexDataAsync(t,b,Y){return this._applyExtensions(b,"loadVertexData",(o=>o._loadVertexDataAsync&&o._loadVertexDataAsync(t,b,Y)))}_extensionsLoadMeshPrimitiveAsync(t,b,Y,o,x,F){return this._applyExtensions(x,"loadMeshPrimitive",(r=>r._loadMeshPrimitiveAsync&&r._loadMeshPrimitiveAsync(t,b,Y,o,x,F)))}_extensionsLoadMaterialAsync(t,b,Y,o,x){return this._applyExtensions(b,"loadMaterial",(F=>F._loadMaterialAsync&&F._loadMaterialAsync(t,b,Y,o,x)))}_extensionsCreateMaterial(t,b,Y){return this._applyExtensions(b,"createMaterial",(o=>o.createMaterial&&o.createMaterial(t,b,Y)))}_extensionsLoadMaterialPropertiesAsync(t,b,Y){return this._applyExtensions(b,"loadMaterialProperties",(o=>o.loadMaterialPropertiesAsync&&o.loadMaterialPropertiesAsync(t,b,Y)))}_extensionsLoadTextureInfoAsync(t,b,Y){return this._applyExtensions(b,"loadTextureInfo",(o=>o.loadTextureInfoAsync&&o.loadTextureInfoAsync(t,b,Y)))}_extensionsLoadTextureAsync(t,b,Y){return this._applyExtensions(b,"loadTexture",(o=>o._loadTextureAsync&&o._loadTextureAsync(t,b,Y)))}_extensionsLoadAnimationAsync(t,b){return this._applyExtensions(b,"loadAnimation",(Y=>Y.loadAnimationAsync&&Y.loadAnimationAsync(t,b)))}_extensionsLoadAnimationChannelAsync(t,b,Y,o,x){return this._applyExtensions(Y,"loadAnimationChannel",(F=>F._loadAnimationChannelAsync&&F._loadAnimationChannelAsync(t,b,Y,o,x)))}_extensionsLoadSkinAsync(t,b,Y){return this._applyExtensions(Y,"loadSkin",(o=>o._loadSkinAsync&&o._loadSkinAsync(t,b,Y)))}_extensionsLoadUriAsync(t,b,Y){return this._applyExtensions(b,"loadUri",(o=>o._loadUriAsync&&o._loadUriAsync(t,b,Y)))}_extensionsLoadBufferViewAsync(t,b){return this._applyExtensions(b,"loadBufferView",(Y=>Y.loadBufferViewAsync&&Y.loadBufferViewAsync(t,b)))}_extensionsLoadBufferAsync(t,b,Y,o){return this._applyExtensions(b,"loadBuffer",(x=>x.loadBufferAsync&&x.loadBufferAsync(t,b,Y,o)))}static LoadExtensionAsync(t,b,Y,o){if(!b.extensions)return null;const x=b.extensions[Y];return x?o(`${t}/extensions/${Y}`,x):null}static LoadExtraAsync(t,b,Y,o){if(!b.extras)return null;const x=b.extras[Y];return x?o(`${t}/extras/${Y}`,x):null}isExtensionUsed(t){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(t)}logOpen(t){this._parent._logOpen(t)}logClose(){this._parent._logClose()}log(t){this._parent._log(t)}startPerformanceCounter(t){this._parent._startPerformanceCounter(t)}endPerformanceCounter(t){this._parent._endPerformanceCounter(t)}}j.DefaultSampler={index:-1},A.d._CreateGLTF2Loader=t=>new j(t);var G=Y(1558),h=Y(10663),tt=Y(12380);class bt extends tt.b{constructor(t,b,Y){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,F=arguments.length>5&&void 0!==arguments[5]&&arguments[5],r=arguments.length>6&&void 0!==arguments[6]&&arguments[6],R=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,d=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",t),this._texture=t.getEngine().createRawCubeTexture(b,Y,o,x,F,r,R,d)}update(t,b,Y,o){let x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,t,b,Y,o,x)}updateRGBDAsync(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,h.k)(this._texture,t,b,Y,o).then((()=>{}))}clone(){return e.d.Clone((()=>{const t=this.va(),b=this._texture,Y=new bt(t,b._bufferViewArray,b.width,b.format,b.type,b.generateMipMaps,b.invertY,b.samplingMode,b._compression);return 13===b.source&&Y.updateRGBDAsync(b._bufferViewArrayArray,b._sphericalPolynomial,b._lodGenerationScale,b._lodGenerationOffset),Y}),this)}}const Yt="EXT_lights_image_based";class ot{constructor(t){this.name=Yt,this._loader=t,this.enabled=this._loader.isExtensionUsed(Yt)}dispose(){this._loader=null,delete this._lights}onLoading(){const t=this._loader.Wi.extensions;if(t&&t[this.name]){const b=t[this.name];this._lights=b.lights}}loadSceneAsync(t,b){return j.LoadExtensionAsync(t,b,this.name,((Y,o)=>{this._loader._allMaterialsDirtyRequired=!0;const x=new Array;x.push(this._loader.loadSceneAsync(t,b)),this._loader.logOpen(`${Y}`);const F=O.Get(`${Y}/light`,this._lights,o.eb);return x.push(this._loadLightAsync(`/extensions/${this.name}/lights/${o.eb}`,F).then((t=>{this._loader.babylonScene.environmentTexture=t}))),this._loader.logClose(),Promise.all(x).then((()=>{}))}))}_loadLightAsync(t,b){if(!b._loaded){const Y=new Array;this._loader.logOpen(`${t}`);const o=new Array(b.specularImages.length);for(let x=0;x<b.specularImages.length;x++){const F=b.specularImages[x];o[x]=new Array(F.length);for(let b=0;b<F.length;b++){const r=`${t}/specularImages/${x}/${b}`;this._loader.logOpen(`${r}`);const R=F[b],d=O.Get(r,this._loader.Wi.images,R);Y.push(this._loader.loadImageAsync(`/images/${R}`,d).then((t=>{o[x][b]=t}))),this._loader.logClose()}}this._loader.logClose(),b._loaded=Promise.all(Y).then((()=>{const Y=new bt(this._loader.babylonScene,null,b.specularImageSize);if(Y.name=b.name||"environment",b._babylonTexture=Y,void 0!=b.dj&&(Y.level=b.dj),b.rotation){let t=x.e.ce(b.rotation);this._loader.babylonScene.useRightHandedSystem||(t=x.e.Inverse(t)),x.c.FromQuaternionToRef(t,Y.getReflectionTextureMatrix())}if(!b.irradianceCoefficients)throw new Error(`${t}: Irradiance coefficients are missing`);const F=G.e.ce(b.irradianceCoefficients);F.scaleInPlace(b.dj),F.convertIrradianceToLambertianRadiance();const r=G.i.FromHarmonics(F),R=(o.length-1)/Math.log2(b.specularImageSize);return Y.updateRGBDAsync(o,r,R)}))}return b._loaded.then((()=>b._babylonTexture))}}k(Yt),P(Yt,!0,(t=>new ot(t)));Y(12384);const xt="EXT_mesh_gpu_instancing";class Ft{constructor(t){this.name=xt,this._loader=t,this.enabled=this._loader.isExtensionUsed(xt)}dispose(){this._loader=null}loadNodeAsync(t,b,Y){return j.LoadExtensionAsync(t,b,this.name,((t,o)=>{this._loader._disableInstancedMesh++;const F=this._loader.loadNodeAsync(`/nodes/${b.index}`,b,Y);if(this._loader._disableInstancedMesh--,!b._primitiveBabylonMeshes)return F;const r=new Array;let R=0;const d=b=>{if(void 0==o.attributes[b])return void r.push(Promise.resolve(null));const Y=O.Get(`${t}/attributes/${b}`,this._loader.Wi.accessors,o.attributes[b]);if(r.push(this._loader._loadFloatAccessorAsync(`/accessors/${Y.bufferView}`,Y)),0===R)R=Y.count;else if(R!==Y.count)throw new Error(`${t}/attributes: Instance buffer accessors do not have the same count.`)};return d("TRANSLATION"),d("ROTATION"),d("SCALE"),F.then((t=>Promise.all(r).then((Y=>{let[o,F,r]=Y;const d=new Float32Array(16*R);x.f.ae[0].be(0,0,0),x.f.Quaternion[0].be(0,0,0,1),x.f.ae[1].be(1,1,1);for(let t=0;t<R;++t)o&&x.l.FromArrayToRef(o,3*t,x.f.ae[0]),F&&x.e.FromArrayToRef(F,4*t,x.f.Quaternion[0]),r&&x.l.FromArrayToRef(r,3*t,x.f.ae[1]),x.c.ComposeToRef(x.f.ae[1],x.f.Quaternion[0],x.f.ae[0],x.f.Matrix[0]),x.f.Matrix[0].copyToArray(d,16*t);for(const t of b._primitiveBabylonMeshes)t.Mj("matrix",d,16,!0);return t}))))}))}}k(xt),P(xt,!0,(t=>new Ft(t)));class rt{static get Default(){return rt._Default||(rt._Default=new rt),rt._Default}constructor(){const t=rt.Configuration.decoder;this._decoderModulePromise=r.f.LoadBabylonScriptAsync(t.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}decodeGltfBufferAsync(t,b,Y,o,x){return this._decoderModulePromise.then((async()=>{MeshoptDecoder.useWorkers(1);const F=await MeshoptDecoder.decodeGltfBufferAsync(b,Y,t,o,x);return MeshoptDecoder.useWorkers(0),F}))}}rt.Configuration={decoder:{url:`${r.f._DefaultCdnUrl}/meshopt_decoder.js`}},rt._Default=null;const Rt="EXT_meshopt_compression";class dt{constructor(t){this.name=Rt,this.enabled=t.isExtensionUsed(Rt),this._loader=t}dispose(){this._loader=null}loadBufferViewAsync(t,b){return j.LoadExtensionAsync(t,b,this.name,((Y,o)=>{const x=b;if(x._meshOptData)return x._meshOptData;const F=O.Get(`${t}/buffer`,this._loader.Wi.buffers,o.buffer);return x._meshOptData=this._loader.loadBufferAsync(`/buffers/${F.index}`,F,o.byteOffset||0,o.byteLength).then((t=>rt.Default.decodeGltfBufferAsync(t,o.count,o.byteStride,o.mode,o.filter))),x._meshOptData}))}}k(Rt),P(Rt,!0,(t=>new dt(t)));const Et="EXT_texture_webp";class Ut{constructor(t){this.name=Et,this._loader=t,this.enabled=t.isExtensionUsed(Et)}dispose(){this._loader=null}_loadTextureAsync(t,b,Y){return j.LoadExtensionAsync(t,b,this.name,((o,x)=>{const F=void 0==b.sampler?j.DefaultSampler:O.Get(`${t}/sampler`,this._loader.Wi.samplers,b.sampler),r=O.Get(`${o}/source`,this._loader.Wi.images,x.source);return this._loader._createTextureAsync(t,F,r,(t=>{Y(t)}),void 0,!b._textureInfo.nonColorData)}))}}k(Et),P(Et,!0,(t=>new Ut(t)));const Ct="EXT_texture_avif";class pt{constructor(t){this.name=Ct,this._loader=t,this.enabled=t.isExtensionUsed(Ct)}dispose(){this._loader=null}_loadTextureAsync(t,b,Y){return j.LoadExtensionAsync(t,b,this.name,((o,x)=>{const F=void 0==b.sampler?j.DefaultSampler:O.Get(`${t}/sampler`,this._loader.Wi.samplers,b.sampler),r=O.Get(`${o}/source`,this._loader.Wi.images,x.source);return this._loader._createTextureAsync(t,F,r,(t=>{Y(t)}),void 0,!b._textureInfo.nonColorData)}))}}k(Ct),P(Ct,!0,(t=>new pt(t)));var Wt=Y(12389);const Tt="KHR_draco_mesh_compression";class yt{constructor(t){this.name=Tt,this.useNormalizedFlagFromAccessor=!0,this._loader=t,this.enabled=Wt.e.DecoderAvailable&&this._loader.isExtensionUsed(Tt)}dispose(){delete this.dracoCompression,this._loader=null}_loadVertexDataAsync(t,b,Y){return j.LoadExtensionAsync(t,b,this.name,((o,x)=>{if(void 0!=b.mode&&4!==b.mode&&5!==b.mode)throw new Error(`${t}: Unsupported mode ${b.mode}`);const F={},r={},R=(t,o)=>{const R=x.attributes[t];if(void 0!=R&&(Y._delayInfo=Y._delayInfo||[],-1===Y._delayInfo.indexOf(o)&&Y._delayInfo.push(o),F[o]=R,this.useNormalizedFlagFromAccessor)){const Y=O.TryGet(this._loader.Wi.accessors,b.attributes[t]);Y&&(r[o]=Y.normalized||!1)}};R("POSITION",f.e.PositionKind),R("NORMAL",f.e.NormalKind),R("TANGENT",f.e.TangentKind),R("TEXCOORD_0",f.e.UVKind),R("TEXCOORD_1",f.e.UV2Kind),R("TEXCOORD_2",f.e.UV3Kind),R("TEXCOORD_3",f.e.UV4Kind),R("TEXCOORD_4",f.e.UV5Kind),R("TEXCOORD_5",f.e.UV6Kind),R("JOINTS_0",f.e.MatricesIndicesKind),R("WEIGHTS_0",f.e.MatricesWeightsKind),R("COLOR_0",f.e.ColorKind);const d=O.Get(o,this._loader.Wi.bufferViews,x.bufferView);return d._dracoBabylonGeometry||(d._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${d.index}`,d).then((b=>(this.dracoCompression||Wt.e.Default)._decodeMeshToGeometryForGltfAsync(Y.name,this._loader.babylonScene,b,F,r).catch((b=>{throw new Error(`${t}: ${b.message}`)}))))),d._dracoBabylonGeometry}))}}k(Tt),P(Tt,!0,(t=>new yt(t)));var vt=Y(12396),Bt=Y(11759),Jt=Y(12365),mt=Y(12405);Bt.c.AddNodeConstructor("Light_Type_0",((t,b)=>()=>new Kt(t,x.l.Zero(),b)));class Kt extends mt.c{get shadowAngle(){return this._shadowAngle}set shadowAngle(t){this._shadowAngle=t,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(t){const b=this.needCube();if(this._direction=t,this.needCube()!==b&&this._shadowGenerators){const t=this._shadowGenerators.values();for(let b=t.next();!0!==b.done;b=t.next()){b.value.recreateShadowMap()}}}constructor(t,b,Y){super(t,Y),this._shadowAngle=Math.PI/2,this.position=b}getClassName(){return"PointLight"}getTypeID(){return Jt.c.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(t){if(this.direction)return super.getShadowDirection(t);switch(t){case 0:return new x.l(1,0,0);case 1:return new x.l(-1,0,0);case 2:return new x.l(0,-1,0);case 3:return new x.l(0,1,0);case 4:return new x.l(0,0,1);case 5:return new x.l(0,0,-1)}return x.l.Zero()}_setDefaultShadowProjectionMatrix(t,b,Y){const o=this.va().activeCamera;if(!o)return;const F=void 0!==this.shadowMinZ?this.shadowMinZ:o._i,r=void 0!==this.shadowMaxZ?this.shadowMaxZ:o.maxZ,R=this.va().getEngine().useReverseDepthBuffer;x.c.PerspectiveFovLHToRef(this.shadowAngle,1,R?r:F,R?F:r,t,!0,this._scene.getEngine().isNDCHalfZRange,void 0,R)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(t,b){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,b):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,b),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,b),this}transferToNodeMaterialEffect(t,b){return this.computeTransformedInformation()?t.setFloat3(b,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):t.setFloat3(b,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(t,b){t["POINTLIGHT"+b]=!0}}(0,m.e)([(0,K.P)()],Kt.prototype,"shadowAngle",null),(0,S.d)("BABYLON.PointLight",Kt),Bt.c.AddNodeConstructor("Light_Type_2",((t,b)=>()=>new Lt(t,x.l.Zero(),x.l.Zero(),0,0,b)));class Lt extends mt.c{get angle(){return this._angle}set angle(t){this._angle=t,this._cosHalfAngle=Math.cos(.5*t),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(t){this._innerAngle=t,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(t){this._shadowAngleScale=t,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(t){this._projectionTextureLightNear=t,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(t){this._projectionTextureLightFar=t,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(t){this._projectionTextureUpDirection=t,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(t){this._projectionTexture!==t&&(this._projectionTexture=t,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(Lt._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):Lt._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(t){return void 0!==t.onGeneratedObservable}static _IsTexture(t){return void 0!==t.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(t){this._projectionTextureProjectionLightMatrix=t,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(t,b,Y,o,F,r){super(t,r),this._innerAngle=0,this._projectionTextureMatrix=x.c.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=x.l.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=x.l.Zero(),this._projectionTextureViewLightMatrix=x.c.Zero(),this._projectionTextureProjectionLightMatrix=x.c.Zero(),this._projectionTextureScalingMatrix=x.c.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=b,this.direction=Y,this.angle=o,this.exponent=F}getClassName(){return"SpotLight"}getTypeID(){return Jt.c.LIGHTTYPEID_SPOTLIGHT}_setDirection(t){super._setDirection(t),this._projectionTextureViewLightDirty=!0}_setPosition(t){super._setPosition(t),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(t,b,Y){const o=this.va().activeCamera;if(!o)return;this._shadowAngleScale=this._shadowAngleScale||1;const F=this._shadowAngleScale*this._angle,r=void 0!==this.shadowMinZ?this.shadowMinZ:o._i,R=void 0!==this.shadowMaxZ?this.shadowMaxZ:o.maxZ,d=this.va().getEngine().useReverseDepthBuffer;x.c.PerspectiveFovLHToRef(F,1,d?R:r,d?r:R,t,!0,this._scene.getEngine().isNDCHalfZRange,void 0,d)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),x.c.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const t=this.projectionTextureLightFar,b=this.projectionTextureLightNear,Y=t/(t-b),o=-Y*b,F=1/Math.tan(this._angle/2);x.c.FromValuesToRef(F/1,0,0,0,0,F,0,0,0,0,Y,1,0,0,o,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof D.b){const t=this._projectionTexture.uScale/2,b=this._projectionTexture.vScale/2;x.c.FromValuesToRef(t,0,0,0,0,b,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(t,b){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),t.setMatrix("textureProjectionMatrix"+b,this._projectionTextureMatrix),t.setTexture("projectionLightTexture"+b,this.projectionTexture)),this}transferToEffect(t,b){let Y;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,b),Y=x.l.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,b),Y=x.l.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",Y.x,Y.y,Y.z,this._cosHalfAngle,b),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,b),this}transferToNodeMaterialEffect(t,b){let Y;return Y=this.computeTransformedInformation()?x.l.Normalize(this.transformedDirection):x.l.Normalize(this.direction),this.va().useRightHandedSystem?t.setFloat3(b,-Y.x,-Y.y,-Y.z):t.setFloat3(b,Y.x,Y.y,Y.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose()}getDepthMinZ(t){const b=this._scene.getEngine(),Y=void 0!==this.shadowMinZ?this.shadowMinZ:t._i;return b.useReverseDepthBuffer&&b.isNDCHalfZRange?Y:this._scene.getEngine().isNDCHalfZRange?0:Y}getDepthMaxZ(t){const b=this._scene.getEngine(),Y=void 0!==this.shadowMaxZ?this.shadowMaxZ:t.maxZ;return b.useReverseDepthBuffer&&b.isNDCHalfZRange?0:Y}prepareLightSpecificDefines(t,b){t["SPOTLIGHT"+b]=!0,t["PROJECTEDLIGHTTEXTURE"+b]=!(!this.projectionTexture||!this.projectionTexture.isReady())}}(0,m.e)([(0,K.P)()],Lt.prototype,"angle",null),(0,m.e)([(0,K.P)()],Lt.prototype,"innerAngle",null),(0,m.e)([(0,K.P)()],Lt.prototype,"shadowAngleScale",null),(0,m.e)([(0,K.P)()],Lt.prototype,"exponent",void 0),(0,m.e)([(0,K.P)()],Lt.prototype,"projectionTextureLightNear",null),(0,m.e)([(0,K.P)()],Lt.prototype,"projectionTextureLightFar",null),(0,m.e)([(0,K.P)()],Lt.prototype,"projectionTextureUpDirection",null),(0,m.e)([(0,K.I)("projectedLightTexture")],Lt.prototype,"_projectionTexture",void 0),(0,S.d)("BABYLON.SpotLight",Lt);const zt="KHR_lights_punctual";class St{constructor(t){this.name=zt,this._loader=t,this.enabled=this._loader.isExtensionUsed(zt)}dispose(){this._loader=null,delete this._lights}onLoading(){const t=this._loader.Wi.extensions;if(t&&t[this.name]){const b=t[this.name];this._lights=b.lights,O.Assign(this._lights)}}loadNodeAsync(t,b,Y){return j.LoadExtensionAsync(t,b,this.name,((o,r)=>(this._loader._allMaterialsDirtyRequired=!0,this._loader.loadNodeAsync(t,b,(t=>{let b;const R=O.Get(o,this._lights,r.eb),d=R.name||t.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,R.type){case"directional":{const t=new vt.e(d,x.l.Backward(),this._loader.babylonScene);t.position.ee(0),b=t;break}case"point":b=new Kt(d,x.l.Zero(),this._loader.babylonScene);break;case"spot":{const t=new Lt(d,x.l.Zero(),x.l.Backward(),0,1,this._loader.babylonScene);t.angle=2*(R.spot&&R.spot.outerConeAngle||Math.PI/4),t.innerAngle=2*(R.spot&&R.spot.innerConeAngle||0),b=t;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${o}: Invalid light type (${R.type})`)}b._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,R._babylonLight=b,b.falloffType=Jt.c.FALLOFF_GLTF,b.Nh=R.color?F.d.ce(R.color):F.d.White(),b.dj=void 0==R.dj?1:R.dj,b.range=void 0==R.range?Number.MAX_VALUE:R.range,b.parent=t,this._loader._babylonLights.push(b),j.AddPointerMetadata(b,o),Y(t)})))))}}k(zt),P(zt,!0,(t=>new St(t)));const et="KHR_materials_pbrSpecularGlossiness";class gt{constructor(t){this.name=et,this.order=200,this._loader=t,this.enabled=this._loader.isExtensionUsed(et)}dispose(){this._loader=null}loadMaterialPropertiesAsync(t,b,Y){return j.LoadExtensionAsync(t,b,this.name,((o,x)=>{const F=new Array;return F.push(this._loader.loadMaterialBasePropertiesAsync(t,b,Y)),F.push(this._loadSpecularGlossinessPropertiesAsync(o,x,Y)),this._loader.loadMaterialAlphaProperties(t,b,Y),Promise.all(F).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(t,b,Y){if(!(Y instanceof g))throw new Error(`${t}: Material type not supported`);const o=new Array;return Y.metallic=null,Y.roughness=null,b.diffuseFactor?(Y.albedoColor=F.d.ce(b.diffuseFactor),Y.alpha=b.diffuseFactor[3]):Y.albedoColor=F.d.White(),Y.reflectivityColor=b.specularFactor?F.d.ce(b.specularFactor):F.d.White(),Y.microSurface=void 0==b.glossinessFactor?1:b.glossinessFactor,b.diffuseTexture&&o.push(this._loader.loadTextureInfoAsync(`${t}/diffuseTexture`,b.diffuseTexture,(t=>{t.name=`${Y.name} (Diffuse)`,Y.albedoTexture=t}))),b.specularGlossinessTexture&&(o.push(this._loader.loadTextureInfoAsync(`${t}/specularGlossinessTexture`,b.specularGlossinessTexture,(t=>{t.name=`${Y.name} (Specular Glossiness)`,Y.reflectivityTexture=t,Y.reflectivityTexture.Cc=!0}))),Y.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(o).then((()=>{}))}}k(et),P(et,!0,(t=>new gt(t)));const Dt="KHR_materials_unlit";class Ht{constructor(t){this.name=Dt,this.order=210,this._loader=t,this.enabled=this._loader.isExtensionUsed(Dt)}dispose(){this._loader=null}loadMaterialPropertiesAsync(t,b,Y){return j.LoadExtensionAsync(t,b,this.name,(()=>this._loadUnlitPropertiesAsync(t,b,Y)))}_loadUnlitPropertiesAsync(t,b,Y){if(!(Y instanceof g))throw new Error(`${t}: Material type not supported`);const o=new Array;Y.unlit=!0;const x=b.pbrMetallicRoughness;return x&&(x.baseColorFactor?(Y.albedoColor=F.d.ce(x.baseColorFactor),Y.alpha=x.baseColorFactor[3]):Y.albedoColor=F.d.White(),x.baseColorTexture&&o.push(this._loader.loadTextureInfoAsync(`${t}/baseColorTexture`,x.baseColorTexture,(t=>{t.name=`${Y.name} (Base Color)`,Y.albedoTexture=t})))),b.doubleSided&&(Y.Ce=!1,Y.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(t,b,Y),Promise.all(o).then((()=>{}))}}k(Dt),P(Dt,!0,(t=>new Ht(t)));const ft="KHR_materials_clearcoat";class nt{constructor(t){this.name=ft,this.order=190,this._loader=t,this.enabled=this._loader.isExtensionUsed(ft)}dispose(){this._loader=null}loadMaterialPropertiesAsync(t,b,Y){return j.LoadExtensionAsync(t,b,this.name,((o,x)=>{const F=new Array;return F.push(this._loader.loadMaterialPropertiesAsync(t,b,Y)),F.push(this._loadClearCoatPropertiesAsync(o,x,Y)),Promise.all(F).then((()=>{}))}))}_loadClearCoatPropertiesAsync(t,b,Y){if(!(Y instanceof g))throw new Error(`${t}: Material type not supported`);const o=new Array;return Y.clearCoat.isEnabled=!0,Y.clearCoat.useRoughnessFromMainTexture=!1,Y.clearCoat.remapF0OnInterfaceChange=!1,void 0!=b.clearcoatFactor?Y.clearCoat.dj=b.clearcoatFactor:Y.clearCoat.dj=0,b.clearcoatTexture&&o.push(this._loader.loadTextureInfoAsync(`${t}/clearcoatTexture`,b.clearcoatTexture,(t=>{t.name=`${Y.name} (ClearCoat)`,Y.clearCoat.texture=t}))),void 0!=b.clearcoatRoughnessFactor?Y.clearCoat.roughness=b.clearcoatRoughnessFactor:Y.clearCoat.roughness=0,b.clearcoatRoughnessTexture&&(b.clearcoatRoughnessTexture.nonColorData=!0,o.push(this._loader.loadTextureInfoAsync(`${t}/clearcoatRoughnessTexture`,b.clearcoatRoughnessTexture,(t=>{t.name=`${Y.name} (ClearCoat Roughness)`,Y.clearCoat.textureRoughness=t})))),b.clearcoatNormalTexture&&(b.clearcoatNormalTexture.nonColorData=!0,o.push(this._loader.loadTextureInfoAsync(`${t}/clearcoatNormalTexture`,b.clearcoatNormalTexture,(t=>{t.name=`${Y.name} (ClearCoat Normal)`,Y.clearCoat.bumpTexture=t}))),Y.invertNormalMapX=!Y.va().useRightHandedSystem,Y.invertNormalMapY=Y.va().useRightHandedSystem,void 0!=b.clearcoatNormalTexture.scale&&(Y.clearCoat.bumpTexture.level=b.clearcoatNormalTexture.scale)),Promise.all(o).then((()=>{}))}}k(ft),P(ft,!0,(t=>new nt(t)));const Xt="KHR_materials_iridescence";class Qt{constructor(t){this.name=Xt,this.order=195,this._loader=t,this.enabled=this._loader.isExtensionUsed(Xt)}dispose(){this._loader=null}loadMaterialPropertiesAsync(t,b,Y){return j.LoadExtensionAsync(t,b,this.name,((o,x)=>{const F=new Array;return F.push(this._loader.loadMaterialPropertiesAsync(t,b,Y)),F.push(this._loadIridescencePropertiesAsync(o,x,Y)),Promise.all(F).then((()=>{}))}))}_loadIridescencePropertiesAsync(t,b,Y){if(!(Y instanceof g))throw new Error(`${t}: Material type not supported`);const o=new Array;return Y.iridescence.isEnabled=!0,Y.iridescence.dj=b.iridescenceFactor??0,Y.iridescence.indexOfRefraction=b.iridescenceIor??b.iridescenceIOR??1.3,Y.iridescence.minimumThickness=b.iridescenceThicknessMinimum??100,Y.iridescence.maximumThickness=b.iridescenceThicknessMaximum??400,b.iridescenceTexture&&o.push(this._loader.loadTextureInfoAsync(`${t}/iridescenceTexture`,b.iridescenceTexture,(t=>{t.name=`${Y.name} (Iridescence)`,Y.iridescence.texture=t}))),b.iridescenceThicknessTexture&&o.push(this._loader.loadTextureInfoAsync(`${t}/iridescenceThicknessTexture`,b.iridescenceThicknessTexture,(t=>{t.name=`${Y.name} (Iridescence Thickness)`,Y.iridescence.thicknessTexture=t}))),Promise.all(o).then((()=>{}))}}k(Xt),P(Xt,!0,(t=>new Qt(t)));const Nt="KHR_materials_anisotropy";class ut{constructor(t){this.name=Nt,this.order=195,this._loader=t,this.enabled=this._loader.isExtensionUsed(Nt)}dispose(){this._loader=null}loadMaterialPropertiesAsync(t,b,Y){return j.LoadExtensionAsync(t,b,this.name,((o,x)=>{const F=new Array;return F.push(this._loader.loadMaterialPropertiesAsync(t,b,Y)),F.push(this._loadIridescencePropertiesAsync(o,x,Y)),Promise.all(F).then((()=>{}))}))}_loadIridescencePropertiesAsync(t,b,Y){if(!(Y instanceof g))throw new Error(`${t}: Material type not supported`);const o=new Array;return Y.anisotropy.isEnabled=!0,Y.anisotropy.dj=b.anisotropyStrength??0,Y.anisotropy.angle=b.anisotropyRotation??0,b.anisotropyTexture&&(b.anisotropyTexture.nonColorData=!0,o.push(this._loader.loadTextureInfoAsync(`${t}/anisotropyTexture`,b.anisotropyTexture,(t=>{t.name=`${Y.name} (Anisotropy Intensity)`,Y.anisotropy.texture=t})))),Promise.all(o).then((()=>{}))}}k(Nt),P(Nt,!0,(t=>new ut(t)));const Zt="KHR_materials_emissive_strength";class at{constructor(t){this.name=Zt,this.order=170,this._loader=t,this.enabled=this._loader.isExtensionUsed(Zt)}dispose(){this._loader=null}loadMaterialPropertiesAsync(t,b,Y){return j.LoadExtensionAsync(t,b,this.name,((o,x)=>this._loader.loadMaterialPropertiesAsync(t,b,Y).then((()=>{this._loadEmissiveProperties(o,x,Y)}))))}_loadEmissiveProperties(t,b,Y){if(!(Y instanceof g))throw new Error(`${t}: Material type not supported`);void 0!==b.emissiveStrength&&(Y.emissiveIntensity=b.emissiveStrength)}}k(Zt),P(Zt,!0,(t=>new at(t)));const At="KHR_materials_sheen";class Mt{constructor(t){this.name=At,this.order=190,this._loader=t,this.enabled=this._loader.isExtensionUsed(At)}dispose(){this._loader=null}loadMaterialPropertiesAsync(t,b,Y){return j.LoadExtensionAsync(t,b,this.name,((o,x)=>{const F=new Array;return F.push(this._loader.loadMaterialPropertiesAsync(t,b,Y)),F.push(this._loadSheenPropertiesAsync(o,x,Y)),Promise.all(F).then((()=>{}))}))}_loadSheenPropertiesAsync(t,b,Y){if(!(Y instanceof g))throw new Error(`${t}: Material type not supported`);const o=new Array;return Y.sheen.isEnabled=!0,Y.sheen.dj=1,void 0!=b.sheenColorFactor?Y.sheen.color=F.d.ce(b.sheenColorFactor):Y.sheen.color=F.d.Black(),b.sheenColorTexture&&o.push(this._loader.loadTextureInfoAsync(`${t}/sheenColorTexture`,b.sheenColorTexture,(t=>{t.name=`${Y.name} (Sheen Color)`,Y.sheen.texture=t}))),void 0!==b.sheenRoughnessFactor?Y.sheen.roughness=b.sheenRoughnessFactor:Y.sheen.roughness=0,b.sheenRoughnessTexture&&(b.sheenRoughnessTexture.nonColorData=!0,o.push(this._loader.loadTextureInfoAsync(`${t}/sheenRoughnessTexture`,b.sheenRoughnessTexture,(t=>{t.name=`${Y.name} (Sheen Roughness)`,Y.sheen.textureRoughness=t})))),Y.sheen.albedoScaling=!0,Y.sheen.useRoughnessFromMainTexture=!1,Promise.all(o).then((()=>{}))}}k(At),P(At,!0,(t=>new Mt(t)));const wt="KHR_materials_specular";class ct{constructor(t){this.name=wt,this.order=190,this._loader=t,this.enabled=this._loader.isExtensionUsed(wt)}dispose(){this._loader=null}loadMaterialPropertiesAsync(t,b,Y){return j.LoadExtensionAsync(t,b,this.name,((o,x)=>{const F=new Array;return F.push(this._loader.loadMaterialPropertiesAsync(t,b,Y)),F.push(this._loadSpecularPropertiesAsync(o,x,Y)),Promise.all(F).then((()=>{}))}))}_loadSpecularPropertiesAsync(t,b,Y){if(!(Y instanceof g))throw new Error(`${t}: Material type not supported`);const o=new Array;return void 0!==b.specularFactor&&(Y.metallicF0Factor=b.specularFactor),void 0!==b.specularColorFactor&&(Y.metallicReflectanceColor=F.d.ce(b.specularColorFactor)),b.specularTexture&&(b.specularTexture.nonColorData=!0,o.push(this._loader.loadTextureInfoAsync(`${t}/specularTexture`,b.specularTexture,(t=>{t.name=`${Y.name} (Specular)`,Y.metallicReflectanceTexture=t,Y.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),b.specularColorTexture&&o.push(this._loader.loadTextureInfoAsync(`${t}/specularColorTexture`,b.specularColorTexture,(t=>{t.name=`${Y.name} (Specular Color)`,Y.reflectanceTexture=t}))),Promise.all(o).then((()=>{}))}}k(wt),P(wt,!0,(t=>new ct(t)));const It="KHR_materials_ior";class st{constructor(t){this.name=It,this.order=180,this._loader=t,this.enabled=this._loader.isExtensionUsed(It)}dispose(){this._loader=null}loadMaterialPropertiesAsync(t,b,Y){return j.LoadExtensionAsync(t,b,this.name,((o,x)=>{const F=new Array;return F.push(this._loader.loadMaterialPropertiesAsync(t,b,Y)),F.push(this._loadIorPropertiesAsync(o,x,Y)),Promise.all(F).then((()=>{}))}))}_loadIorPropertiesAsync(t,b,Y){if(!(Y instanceof g))throw new Error(`${t}: Material type not supported`);return void 0!==b.ior?Y.indexOfRefraction=b.ior:Y.indexOfRefraction=st._DEFAULT_IOR,Promise.resolve()}}st._DEFAULT_IOR=1.5,k(It),P(It,!0,(t=>new st(t)));const lt="KHR_materials_variants";class it{constructor(t){this.name=lt,this._loader=t,this.enabled=this._loader.isExtensionUsed(lt)}dispose(){this._loader=null}static GetAvailableVariants(t){const b=this._GetExtensionMetadata(t);return b?Object.keys(b.variants):[]}getAvailableVariants(t){return it.GetAvailableVariants(t)}static SelectVariant(t,b){const Y=this._GetExtensionMetadata(t);if(!Y)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${lt} extension`);const o=t=>{const b=Y.variants[t];if(b)for(const Y of b)Y.mesh.material=Y.material};if(b instanceof Array)for(const x of b)o(x);else o(b);Y.lastSelected=b}selectVariant(t,b){it.SelectVariant(t,b)}static Reset(t){const b=this._GetExtensionMetadata(t);if(!b)throw new Error(`Cannot reset on a glTF mesh that does not have the ${lt} extension`);for(const Y of b.original)Y.mesh.material=Y.material;b.lastSelected=null}reset(t){it.Reset(t)}static GetLastSelectedVariant(t){const b=this._GetExtensionMetadata(t);if(!b)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${lt} extension`);return b.lastSelected}getLastSelectedVariant(t){return it.GetLastSelectedVariant(t)}static _GetExtensionMetadata(t){var b,Y;return(null===t||void 0===t||null===(b=t._internalMetadata)||void 0===b||null===(Y=b.Wi)||void 0===Y?void 0:Y[lt])||null}onLoading(){const t=this._loader.Wi.extensions;if(t&&t[this.name]){const b=t[this.name];this._variants=b.variants}}_loadMeshPrimitiveAsync(t,b,Y,o,x,F){return j.LoadExtensionAsync(t,x,this.name,((r,R)=>{const d=new Array;return d.push(this._loader._loadMeshPrimitiveAsync(t,b,Y,o,x,(b=>{if(F(b),b instanceof Q.d){const Y=j._GetDrawMode(t,x.mode),o=this._loader.rootBabylonMesh,F=o?o._internalMetadata=o._internalMetadata||{}:{},E=F.Wi=F.Wi||{},U=E[lt]=E[lt]||{lastSelected:null,original:[],variants:{}};U.original.push({mesh:b,material:b.material});for(let t=0;t<R.mappings.length;++t){const x=R.mappings[t],F=O.Get(`${r}/mappings/${t}/material`,this._loader.Wi.materials,x.material);d.push(this._loader._loadMaterialAsync(`#/materials/${x.material}`,F,b,Y,(t=>{for(let Y=0;Y<x.variants.length;++Y){const F=x.variants[Y],r=O.Get(`/extensions/${lt}/variants/${F}`,this._variants,F);U.variants[r.name]=U.variants[r.name]||[],U.variants[r.name].push({mesh:b,material:t}),b.onClonedObservable.add((t=>{const Y=t;let x=null,F=Y;do{if(F=F.parent,!F)return;x=it._GetExtensionMetadata(F)}while(null===x);if(o&&x===it._GetExtensionMetadata(o)){F._internalMetadata={};for(const t in o._internalMetadata)F._internalMetadata[t]=o._internalMetadata[t];F._internalMetadata.Wi=[];for(const t in o._internalMetadata.Wi)F._internalMetadata.Wi[t]=o._internalMetadata.Wi[t];F._internalMetadata.Wi[lt]={lastSelected:null,original:[],variants:{}};for(const t of x.original)F._internalMetadata.Wi[lt].original.push({mesh:t.mesh,material:t.material});for(const t in x.variants)if(Object.prototype.hasOwnProperty.call(x.variants,t)){F._internalMetadata.Wi[lt].variants[t]=[];for(const b of x.variants[t])F._internalMetadata.Wi[lt].variants[t].push({mesh:b.mesh,material:b.material})}x=F._internalMetadata.Wi[lt]}for(const o of x.original)o.mesh===b&&(o.mesh=Y);for(const o of x.variants[r.name])o.mesh===b&&(o.mesh=Y)}))}})))}}}))),Promise.all(d).then((t=>{let[b]=t;return b}))}))}}k(lt),P(lt,!0,(t=>new it(t)));var Vt=Y(1597);class Pt{}Pt.AUTOSAMPLERSUFFIX="Sampler",Pt.DISABLEUA="#define DISABLE_UNIFORMITY_ANALYSIS",Pt.ALPHA_DISABLE=0,Pt.ALPHA_ADD=1,Pt.ALPHA_COMBINE=2,Pt.ALPHA_SUBTRACT=3,Pt.ALPHA_MULTIPLY=4,Pt.ALPHA_MAXIMIZED=5,Pt.ALPHA_ONEONE=6,Pt.ALPHA_PREMULTIPLIED=7,Pt.ALPHA_PREMULTIPLIED_PORTERDUFF=8,Pt.ALPHA_INTERPOLATE=9,Pt.ALPHA_SCREENMODE=10,Pt.ALPHA_ONEONE_ONEONE=11,Pt.ALPHA_ALPHATOCOLOR=12,Pt.ALPHA_REVERSEONEMINUS=13,Pt.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,Pt.ALPHA_ONEONE_ONEZERO=15,Pt.ALPHA_EXCLUSION=16,Pt.ALPHA_LAYER_ACCUMULATE=17,Pt.ALPHA_EQUATION_ADD=0,Pt.ALPHA_EQUATION_SUBSTRACT=1,Pt.ALPHA_EQUATION_REVERSE_SUBTRACT=2,Pt.ALPHA_EQUATION_MAX=3,Pt.ALPHA_EQUATION_MIN=4,Pt.ALPHA_EQUATION_DARKEN=5,Pt.DELAYLOADSTATE_NONE=0,Pt.DELAYLOADSTATE_LOADED=1,Pt.DELAYLOADSTATE_LOADING=2,Pt.DELAYLOADSTATE_NOTLOADED=4,Pt.NEVER=512,Pt.ALWAYS=519,Pt.LESS=513,Pt.EQUAL=514,Pt.LEQUAL=515,Pt.GREATER=516,Pt.GEQUAL=518,Pt.NOTEQUAL=517,Pt.KEEP=7680,Pt.ZERO=0,Pt.REPLACE=7681,Pt.INCR=7682,Pt.DECR=7683,Pt.INVERT=5386,Pt.INCR_WRAP=34055,Pt.DECR_WRAP=34056,Pt.TEXTURE_CLAMP_ADDRESSMODE=0,Pt.TEXTURE_WRAP_ADDRESSMODE=1,Pt.TEXTURE_MIRROR_ADDRESSMODE=2,Pt.TEXTURE_CREATIONFLAG_STORAGE=1,Pt.TEXTUREFORMAT_ALPHA=0,Pt.TEXTUREFORMAT_LUMINANCE=1,Pt.TEXTUREFORMAT_LUMINANCE_ALPHA=2,Pt.TEXTUREFORMAT_RGB=4,Pt.TEXTUREFORMAT_RGBA=5,Pt.TEXTUREFORMAT_RED=6,Pt.TEXTUREFORMAT_R=6,Pt.TEXTUREFORMAT_RG=7,Pt.TEXTUREFORMAT_RED_INTEGER=8,Pt.TEXTUREFORMAT_R_INTEGER=8,Pt.TEXTUREFORMAT_RG_INTEGER=9,Pt.TEXTUREFORMAT_RGB_INTEGER=10,Pt.TEXTUREFORMAT_RGBA_INTEGER=11,Pt.TEXTUREFORMAT_BGRA=12,Pt.TEXTUREFORMAT_DEPTH24_STENCIL8=13,Pt.TEXTUREFORMAT_DEPTH32_FLOAT=14,Pt.TEXTUREFORMAT_DEPTH16=15,Pt.TEXTUREFORMAT_DEPTH24=16,Pt.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17,Pt.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18,Pt.TEXTUREFORMAT_STENCIL8=19,Pt.TEXTUREFORMAT_UNDEFINED=4294967295,Pt.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492,Pt.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493,Pt.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495,Pt.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494,Pt.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779,Pt.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919,Pt.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778,Pt.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918,Pt.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777,Pt.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776,Pt.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917,Pt.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916,Pt.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808,Pt.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840,Pt.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196,Pt.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492,Pt.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493,Pt.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494,Pt.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495,Pt.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496,Pt.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497,Pt.TEXTURETYPE_UNSIGNED_BYTE=0,Pt.TEXTURETYPE_UNSIGNED_INT=0,Pt.TEXTURETYPE_FLOAT=1,Pt.TEXTURETYPE_HALF_FLOAT=2,Pt.TEXTURETYPE_BYTE=3,Pt.TEXTURETYPE_SHORT=4,Pt.TEXTURETYPE_UNSIGNED_SHORT=5,Pt.TEXTURETYPE_INT=6,Pt.TEXTURETYPE_UNSIGNED_INTEGER=7,Pt.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,Pt.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,Pt.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,Pt.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,Pt.TEXTURETYPE_UNSIGNED_INT_24_8=12,Pt.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,Pt.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,Pt.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,Pt.TEXTURETYPE_UNDEFINED=16,Pt.TEXTURE_2D=3553,Pt.TEXTURE_2D_ARRAY=35866,Pt.TEXTURE_CUBE_MAP=34067,Pt.TEXTURE_CUBE_MAP_ARRAY=3735928559,Pt.TEXTURE_3D=32879,Pt.TEXTURE_NEAREST_SAMPLINGMODE=1,Pt.TEXTURE_NEAREST_NEAREST=1,Pt.TEXTURE_BILINEAR_SAMPLINGMODE=2,Pt.TEXTURE_LINEAR_LINEAR=2,Pt.TEXTURE_TRILINEAR_SAMPLINGMODE=3,Pt.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,Pt.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,Pt.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,Pt.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,Pt.TEXTURE_NEAREST_LINEAR=7,Pt.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,Pt.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,Pt.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,Pt.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,Pt.TEXTURE_LINEAR_NEAREST=12,Pt.TEXTURE_EXPLICIT_MODE=0,Pt.TEXTURE_SPHERICAL_MODE=1,Pt.TEXTURE_PLANAR_MODE=2,Pt.TEXTURE_CUBIC_MODE=3,Pt.TEXTURE_PROJECTION_MODE=4,Pt.TEXTURE_SKYBOX_MODE=5,Pt.TEXTURE_INVCUBIC_MODE=6,Pt.TEXTURE_EQUIRECTANGULAR_MODE=7,Pt.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,Pt.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,Pt.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,Pt.TEXTURE_FILTERING_QUALITY_HIGH=64,Pt.TEXTURE_FILTERING_QUALITY_MEDIUM=16,Pt.TEXTURE_FILTERING_QUALITY_LOW=8,Pt.SCALEMODE_FLOOR=1,Pt.SCALEMODE_NEAREST=2,Pt.SCALEMODE_CEILING=3,Pt.MATERIAL_TextureDirtyFlag=1,Pt.MATERIAL_LightDirtyFlag=2,Pt.MATERIAL_FresnelDirtyFlag=4,Pt.MATERIAL_AttributesDirtyFlag=8,Pt.MATERIAL_MiscDirtyFlag=16,Pt.MATERIAL_PrePassDirtyFlag=32,Pt.MATERIAL_AllDirtyFlag=63,Pt.MATERIAL_TriangleFillMode=0,Pt.MATERIAL_WireFrameFillMode=1,Pt.MATERIAL_PointFillMode=2,Pt.MATERIAL_PointListDrawMode=3,Pt.MATERIAL_LineListDrawMode=4,Pt.MATERIAL_LineLoopDrawMode=5,Pt.MATERIAL_LineStripDrawMode=6,Pt.MATERIAL_TriangleStripDrawMode=7,Pt.MATERIAL_TriangleFanDrawMode=8,Pt.MATERIAL_ClockWiseSideOrientation=0,Pt.MATERIAL_CounterClockWiseSideOrientation=1,Pt.ACTION_NothingTrigger=0,Pt.ACTION_OnPickTrigger=1,Pt.ACTION_OnLeftPickTrigger=2,Pt.ACTION_OnRightPickTrigger=3,Pt.ACTION_OnCenterPickTrigger=4,Pt.ACTION_OnPickDownTrigger=5,Pt.ACTION_OnDoublePickTrigger=6,Pt.ACTION_OnPickUpTrigger=7,Pt.ACTION_OnPickOutTrigger=16,Pt.ACTION_OnLongPressTrigger=8,Pt.ACTION_OnPointerOverTrigger=9,Pt.ACTION_OnPointerOutTrigger=10,Pt.ACTION_OnEveryFrameTrigger=11,Pt.ACTION_OnIntersectionEnterTrigger=12,Pt.ACTION_OnIntersectionExitTrigger=13,Pt.ACTION_OnKeyDownTrigger=14,Pt.ACTION_OnKeyUpTrigger=15,Pt.PARTICLES_BILLBOARDMODE_Y=2,Pt.PARTICLES_BILLBOARDMODE_ALL=7,Pt.PARTICLES_BILLBOARDMODE_STRETCHED=8,Pt.PARTICLES_BILLBOARDMODE_STRETCHED_LOCAL=9,Pt.MESHES_CULLINGSTRATEGY_STANDARD=0,Pt.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,Pt.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,Pt.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,Pt.SCENELOADER_NO_LOGGING=0,Pt.SCENELOADER_MINIMAL_LOGGING=1,Pt.SCENELOADER_SUMMARY_LOGGING=2,Pt.SCENELOADER_DETAILED_LOGGING=3,Pt.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,Pt.PREPASS_POSITION_TEXTURE_TYPE=1,Pt.PREPASS_VELOCITY_TEXTURE_TYPE=2,Pt.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,Pt.PREPASS_COLOR_TEXTURE_TYPE=4,Pt.PREPASS_DEPTH_TEXTURE_TYPE=5,Pt.PREPASS_NORMAL_TEXTURE_TYPE=6,Pt.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7,Pt.PREPASS_WORLD_NORMAL_TEXTURE_TYPE=8,Pt.PREPASS_LOCAL_POSITION_TEXTURE_TYPE=9,Pt.PREPASS_SCREENSPACE_DEPTH_TEXTURE_TYPE=10,Pt.PREPASS_VELOCITY_LINEAR_TEXTURE_TYPE=11,Pt.PREPASS_ALBEDO_TEXTURE_TYPE=12,Pt.BUFFER_CREATIONFLAG_READ=1,Pt.BUFFER_CREATIONFLAG_WRITE=2,Pt.BUFFER_CREATIONFLAG_READWRITE=3,Pt.BUFFER_CREATIONFLAG_UNIFORM=4,Pt.BUFFER_CREATIONFLAG_VERTEX=8,Pt.BUFFER_CREATIONFLAG_INDEX=16,Pt.BUFFER_CREATIONFLAG_STORAGE=32,Pt.BUFFER_CREATIONFLAG_INDIRECT=64,Pt.RENDERPASS_MAIN=0,Pt.INPUT_ALT_KEY=18,Pt.INPUT_CTRL_KEY=17,Pt.INPUT_META_KEY1=91,Pt.INPUT_META_KEY2=92,Pt.INPUT_META_KEY3=93,Pt.INPUT_SHIFT_KEY=16,Pt.SNAPSHOTRENDERING_STANDARD=0,Pt.SNAPSHOTRENDERING_FAST=1,Pt.PERSPECTIVE_CAMERA=0,Pt.ORTHOGRAPHIC_CAMERA=1,Pt.FOVMODE_VERTICAL_FIXED=0,Pt.FOVMODE_HORIZONTAL_FIXED=1,Pt.RIG_MODE_NONE=0,Pt.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,Pt.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,Pt.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,Pt.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,Pt.RIG_MODE_STEREOSCOPIC_INTERLACED=14,Pt.RIG_MODE_VR=20,Pt.RIG_MODE_CUSTOM=22,Pt.MAX_SUPPORTED_UV_SETS=6,Pt.GL_ALPHA_EQUATION_ADD=32774,Pt.GL_ALPHA_EQUATION_MIN=32775,Pt.GL_ALPHA_EQUATION_MAX=32776,Pt.GL_ALPHA_EQUATION_SUBTRACT=32778,Pt.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779,Pt.GL_ALPHA_FUNCTION_SRC=768,Pt.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769,Pt.GL_ALPHA_FUNCTION_SRC_ALPHA=770,Pt.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771,Pt.GL_ALPHA_FUNCTION_DST_ALPHA=772,Pt.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773,Pt.GL_ALPHA_FUNCTION_DST_COLOR=774,Pt.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775,Pt.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776,Pt.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769,Pt.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770,Pt.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771,Pt.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772,Pt.GL_ALPHA_FUNCTION_SRC1_COLOR=35065,Pt.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_COLOR=35066,Pt.GL_ALPHA_FUNCTION_SRC1_ALPHA=34185,Pt.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_ALPHA=35067,Pt.SnippetUrl="https://snippet.babylonjs.com",Pt.FOGMODE_NONE=0,Pt.FOGMODE_EXP=1,Pt.FOGMODE_EXP2=2,Pt.FOGMODE_LINEAR=3,Pt.BYTE=5120,Pt.UNSIGNED_BYTE=5121,Pt.SHORT=5122,Pt.UNSIGNED_SHORT=5123,Pt.INT=5124,Pt.UNSIGNED_INT=5125,Pt.FLOAT=5126,Pt.PositionKind="position",Pt.NormalKind="xe",Pt.TangentKind="tangent",Pt.UVKind="uv",Pt.UV2Kind="uv2",Pt.UV3Kind="uv3",Pt.UV4Kind="uv4",Pt.UV5Kind="uv5",Pt.UV6Kind="uv6",Pt.ColorKind="color",Pt.ColorInstanceKind="instanceColor",Pt.MatricesIndicesKind="matricesIndices",Pt.MatricesWeightsKind="matricesWeights",Pt.MatricesIndicesExtraKind="matricesIndicesExtra",Pt.MatricesWeightsExtraKind="matricesWeightsExtra";class kt{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:Pt.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(t,b){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...kt._GetDefaultOptions(),...t},this._scene=b,this._scene._transmissionHelper=this,this.onErrorObservable=new U.e,this._scene.le.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(t){if(!Object.keys(t).filter((b=>this._options[b]!==t[b])).length)return;const b={...this._options,...t},Y=this._options;this._options=b,b.renderSize===Y.renderSize&&b.renderTargetTextureType===Y.renderTargetTextureType&&b.generateMipmaps===Y.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=b.samples,this._opaqueRenderTarget.lodGenerationScale=b.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=b.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(t){return!!t&&!!(t instanceof g&&t.subSurface.isRefractionEnabled)}_addMesh(t){this._materialObservers[t.uniqueId]=t.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),r.f.SetImmediate((()=>{this._shouldRenderAsTransmission(t.material)?(t.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(t)&&this._transparentMeshesCache.push(t)):-1===this._opaqueMeshesCache.indexOf(t)&&this._opaqueMeshesCache.push(t)}))}_removeMesh(t){t.onMaterialChangedObservable.remove(this._materialObservers[t.uniqueId]),delete this._materialObservers[t.uniqueId];let b=this._transparentMeshesCache.indexOf(t);-1!==b&&this._transparentMeshesCache.splice(b,1),b=this._opaqueMeshesCache.indexOf(t),-1!==b&&this._opaqueMeshesCache.splice(b,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(t){const b=this._transparentMeshesCache.indexOf(t),Y=this._opaqueMeshesCache.indexOf(t);this._shouldRenderAsTransmission(t.material)?(t.material instanceof g&&(t.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==Y?(this._opaqueMeshesCache.splice(Y,1),this._transparentMeshesCache.push(t)):-1===b&&this._transparentMeshesCache.push(t)):-1!==b?(this._transparentMeshesCache.splice(b,1),this._opaqueMeshesCache.push(t)):-1===Y&&this._opaqueMeshesCache.push(t)}_isRenderTargetValid(){var t;return null!==(null===(t=this._opaqueRenderTarget)||void 0===t?void 0:t.getInternalTexture())}_setupRenderTargets(){var t;let b,Y;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new Vt.d("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(t=this._options.clearColor)||void 0===t?void 0:t.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((t=>{Y=this._scene.environmentIntensity,this._scene.environmentIntensity=1,b=this._scene.imageProcessingConfiguration.applyByPostProcess,this._options.clearColor?t.clearColor.p(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(t.clearColor,this._scene.getEngine().useExactSrgbConversions),this._scene.imageProcessingConfiguration._applyByPostProcess=!0})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=Y,this._scene.imageProcessingConfiguration._applyByPostProcess=b})),this._transparentMeshesCache.forEach((t=>{this._shouldRenderAsTransmission(t.material)&&(t.material.refractionTexture=this._opaqueRenderTarget)}))}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const qt="KHR_materials_transmission";class Ot{constructor(t){this.name=qt,this.order=175,this._loader=t,this.enabled=this._loader.isExtensionUsed(qt),this.enabled&&(t.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(t,b,Y){return j.LoadExtensionAsync(t,b,this.name,((o,x)=>{const F=new Array;return F.push(this._loader.loadMaterialPropertiesAsync(t,b,Y)),F.push(this._loadTransparentPropertiesAsync(o,b,Y,x)),Promise.all(F).then((()=>{}))}))}_loadTransparentPropertiesAsync(t,b,Y,o){if(!(Y instanceof g))throw new Error(`${t}: Material type not supported`);const x=Y;if(x.subSurface.isRefractionEnabled=!0,x.subSurface.volumeIndexOfRefraction=1,x.subSurface.useAlbedoToTintRefraction=!0,void 0===o.transmissionFactor)return x.subSurface.refractionIntensity=0,x.subSurface.isRefractionEnabled=!1,Promise.resolve();{var F;x.subSurface.refractionIntensity=o.transmissionFactor;const t=x.va();if(x.subSurface.refractionIntensity&&!t._transmissionHelper)new kt({},x.va());else if(x.subSurface.refractionIntensity&&(null===(F=t._transmissionHelper)||void 0===F||!F._isRenderTargetValid())){var r;null===(r=t._transmissionHelper)||void 0===r||r._setupRenderTargets()}}return x.subSurface.minimumThickness=0,x.subSurface.maximumThickness=0,o.transmissionTexture?(o.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${t}/transmissionTexture`,o.transmissionTexture,void 0).then((t=>{t.name=`${Y.name} (Transmission)`,x.subSurface.refractionIntensityTexture=t,x.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}k(qt),P(qt,!0,(t=>new Ot(t)));const jt="KHR_materials_diffuse_transmission";class Gt{constructor(t){this.name=jt,this.order=174,this._loader=t,this.enabled=this._loader.isExtensionUsed(jt),this.enabled&&(t.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(t,b,Y){return j.LoadExtensionAsync(t,b,this.name,((o,x)=>{const F=new Array;return F.push(this._loader.loadMaterialPropertiesAsync(t,b,Y)),F.push(this._loadTranslucentPropertiesAsync(o,b,Y,x)),Promise.all(F).then((()=>{}))}))}_loadTranslucentPropertiesAsync(t,b,Y,o){if(!(Y instanceof g))throw new Error(`${t}: Material type not supported`);const x=Y;if(x.subSurface.isTranslucencyEnabled=!0,x.subSurface.volumeIndexOfRefraction=1,x.subSurface.minimumThickness=0,x.subSurface.maximumThickness=0,x.subSurface.useAlbedoToTintTranslucency=!1,void 0===o.diffuseTransmissionFactor)return x.subSurface.translucencyIntensity=0,x.subSurface.isTranslucencyEnabled=!1,Promise.resolve();x.subSurface.translucencyIntensity=o.diffuseTransmissionFactor;const r=new Array;return x.subSurface.useGltfStyleTextures=!0,o.diffuseTransmissionTexture&&(o.diffuseTransmissionTexture.nonColorData=!0,r.push(this._loader.loadTextureInfoAsync(`${t}/diffuseTransmissionTexture`,o.diffuseTransmissionTexture).then((t=>{t.name=`${Y.name} (Diffuse Transmission)`,x.subSurface.translucencyIntensityTexture=t})))),void 0!==o.diffuseTransmissionColorFactor?x.subSurface.translucencyColor=F.d.ce(o.diffuseTransmissionColorFactor):x.subSurface.translucencyColor=F.d.White(),o.diffuseTransmissionColorTexture&&r.push(this._loader.loadTextureInfoAsync(`${t}/diffuseTransmissionColorTexture`,o.diffuseTransmissionColorTexture).then((t=>{t.name=`${Y.name} (Diffuse Transmission Color)`,x.subSurface.translucencyColorTexture=t}))),Promise.all(r).then((()=>{}))}}k(jt),P(jt,!0,(t=>new Gt(t)));const ht="KHR_materials_volume";class tb{constructor(t){this.name=ht,this.order=173,this._loader=t,this.enabled=this._loader.isExtensionUsed(ht),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(t,b,Y){return j.LoadExtensionAsync(t,b,this.name,((o,x)=>{const F=new Array;return F.push(this._loader.loadMaterialPropertiesAsync(t,b,Y)),F.push(this._loadVolumePropertiesAsync(o,b,Y,x)),Promise.all(F).then((()=>{}))}))}_loadVolumePropertiesAsync(t,b,Y,o){if(!(Y instanceof g))throw new Error(`${t}: Material type not supported`);if(!Y.subSurface.isRefractionEnabled&&!Y.subSurface.isTranslucencyEnabled||!o.thicknessFactor)return Promise.resolve();Y.subSurface.volumeIndexOfRefraction=Y.indexOfRefraction;const x=void 0!==o.attenuationDistance?o.attenuationDistance:Number.MAX_VALUE;return Y.subSurface.tintColorAtDistance=x,void 0!==o.attenuationColor&&3==o.attenuationColor.length&&Y.subSurface.tintColor.be(o.attenuationColor[0],o.attenuationColor[1],o.attenuationColor[2]),Y.subSurface.minimumThickness=0,Y.subSurface.maximumThickness=o.thicknessFactor,Y.subSurface.useThicknessAsDepth=!0,o.thicknessTexture?(o.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${t}/thicknessTexture`,o.thicknessTexture).then((t=>{t.name=`${Y.name} (Thickness)`,Y.subSurface.thicknessTexture=t,Y.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}k(ht),P(ht,!0,(t=>new tb(t)));const bb="KHR_materials_dispersion";class Yb{constructor(t){this.name=bb,this.order=174,this._loader=t,this.enabled=this._loader.isExtensionUsed(bb)}dispose(){this._loader=null}loadMaterialPropertiesAsync(t,b,Y){return j.LoadExtensionAsync(t,b,this.name,((o,x)=>{const F=new Array;return F.push(this._loader.loadMaterialPropertiesAsync(t,b,Y)),F.push(this._loadDispersionPropertiesAsync(o,b,Y,x)),Promise.all(F).then((()=>{}))}))}_loadDispersionPropertiesAsync(t,b,Y,o){if(!(Y instanceof g))throw new Error(`${t}: Material type not supported`);return Y.subSurface.isRefractionEnabled&&o.dispersion?(Y.subSurface.isDispersionEnabled=!0,Y.subSurface.dispersion=o.dispersion,Promise.resolve()):Promise.resolve()}}k(bb),P(bb,!0,(t=>new Yb(t)));const ob="KHR_mesh_quantization";class xb{constructor(t){this.name=ob,this.enabled=t.isExtensionUsed(ob)}dispose(){}}k(ob),P(ob,!0,(t=>new xb(t)));const Fb="KHR_texture_basisu";class rb{constructor(t){this.name=Fb,this._loader=t,this.enabled=t.isExtensionUsed(Fb)}dispose(){this._loader=null}_loadTextureAsync(t,b,Y){return j.LoadExtensionAsync(t,b,this.name,((o,x)=>{const F=void 0==b.sampler?j.DefaultSampler:O.Get(`${t}/sampler`,this._loader.Wi.samplers,b.sampler),r=O.Get(`${o}/source`,this._loader.Wi.images,x.source);return this._loader._createTextureAsync(t,F,r,(t=>{Y(t)}),b._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!b._textureInfo.nonColorData)}))}}k(Fb),P(Fb,!0,(t=>new rb(t)));const Rb="KHR_texture_transform";class db{constructor(t){this.name=Rb,this._loader=t,this.enabled=this._loader.isExtensionUsed(Rb)}dispose(){this._loader=null}loadTextureInfoAsync(t,b,Y){return j.LoadExtensionAsync(t,b,this.name,((o,x)=>this._loader.loadTextureInfoAsync(t,b,(t=>{if(!(t instanceof D.b))throw new Error(`${o}: Texture type not supported`);x.offset&&(t.uOffset=x.offset[0],t.vOffset=x.offset[1]),t.uRotationCenter=0,t.vRotationCenter=0,x.rotation&&(t.wAng=-x.rotation),x.scale&&(t.uScale=x.scale[0],t.vScale=x.scale[1]),void 0!=x.texCoord&&(t.coordinatesIndex=x.texCoord),Y(t)}))))}}k(Rb),P(Rb,!0,(t=>new db(t)));const Eb="KHR_xmp_json_ld";class Ub{constructor(t){this.name=Eb,this.order=100,this._loader=t,this.enabled=this._loader.isExtensionUsed(Eb)}dispose(){this._loader=null}onLoading(){var t,b,Y;if(null===this._loader.rootBabylonMesh)return;const o=null===(t=this._loader.Wi.extensions)||void 0===t?void 0:t.KHR_xmp_json_ld,x=null===(b=this._loader.Wi.asset)||void 0===b||null===(Y=b.extensions)||void 0===Y?void 0:Y.KHR_xmp_json_ld;if(o&&x){const t=+x.packet;o.packets&&t<o.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=o.packets[t])}}}function Cb(t,b,Y,o){return F.d.ce(b,Y).scale(o)}function pb(t,b,Y,o){return b[Y]*o}function Wb(t,b,Y,o){return-b[Y]*o}function Tb(t,b,Y,o){return b[Y+1]*o}function yb(t,b,Y,o){return b[Y]*o*2}function vb(t){return{scale:[new Jb(p.d.ANIMATIONTYPE_FLOAT,`${t}.uScale`,pb,(()=>2)),new Jb(p.d.ANIMATIONTYPE_FLOAT,`${t}.vScale`,Tb,(()=>2))],offset:[new Jb(p.d.ANIMATIONTYPE_FLOAT,`${t}.uOffset`,pb,(()=>2)),new Jb(p.d.ANIMATIONTYPE_FLOAT,`${t}.vOffset`,Tb,(()=>2))],rotation:[new Jb(p.d.ANIMATIONTYPE_FLOAT,`${t}.wAng`,Wb,(()=>1))]}}k(Eb),P(Eb,!0,(t=>new Ub(t)));class Bb extends I{buildAnimations(t,b,Y,o,x){x(t._babylonCamera,this._buildAnimation(b,Y,o))}}class Jb extends I{buildAnimations(t,b,Y,o,x){for(const F in t._data)x(t._data[F].babylonMaterial,this._buildAnimation(b,Y,o))}}class mb extends I{buildAnimations(t,b,Y,o,x){x(t._babylonLight,this._buildAnimation(b,Y,o))}}const Kb={__array__:{__target__:!0,...l}},Lb={__array__:{__target__:!0,orthographic:{xmag:[new Bb(p.d.ANIMATIONTYPE_FLOAT,"orthoLeft",Wb,(()=>1)),new Bb(p.d.ANIMATIONTYPE_FLOAT,"orthoRight",Tb,(()=>1))],ymag:[new Bb(p.d.ANIMATIONTYPE_FLOAT,"orthoBottom",Wb,(()=>1)),new Bb(p.d.ANIMATIONTYPE_FLOAT,"orthoTop",Tb,(()=>1))],zfar:[new Bb(p.d.ANIMATIONTYPE_FLOAT,"maxZ",pb,(()=>1))],znear:[new Bb(p.d.ANIMATIONTYPE_FLOAT,"_i",pb,(()=>1))]},perspective:{yfov:[new Bb(p.d.ANIMATIONTYPE_FLOAT,"fov",pb,(()=>1))],zfar:[new Bb(p.d.ANIMATIONTYPE_FLOAT,"maxZ",pb,(()=>1))],znear:[new Bb(p.d.ANIMATIONTYPE_FLOAT,"_i",pb,(()=>1))]}}},zb={nodes:Kb,materials:{__array__:{__target__:!0,pbrMetallicRoughness:{baseColorFactor:[new Jb(p.d.ANIMATIONTYPE_COLOR3,"albedoColor",Cb,(()=>4)),new Jb(p.d.ANIMATIONTYPE_FLOAT,"alpha",(function(t,b,Y,o){return b[Y+3]*o}),(()=>4))],metallicFactor:[new Jb(p.d.ANIMATIONTYPE_FLOAT,"metallic",pb,(()=>1))],roughnessFactor:[new Jb(p.d.ANIMATIONTYPE_FLOAT,"roughness",pb,(()=>1))],baseColorTexture:{extensions:{KHR_texture_transform:vb("albedoTexture")}},metallicRoughnessTexture:{extensions:{KHR_texture_transform:vb("metallicTexture")}}},emissiveFactor:[new Jb(p.d.ANIMATIONTYPE_COLOR3,"emissiveColor",Cb,(()=>3))],normalTexture:{scale:[new Jb(p.d.ANIMATIONTYPE_FLOAT,"bumpTexture.level",pb,(()=>1))],extensions:{KHR_texture_transform:vb("bumpTexture")}},occlusionTexture:{strength:[new Jb(p.d.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",pb,(()=>1))],extensions:{KHR_texture_transform:vb("ambientTexture")}},emissiveTexture:{extensions:{KHR_texture_transform:vb("emissiveTexture")}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:[new Jb(p.d.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",pb,(()=>1))],anisotropyRotation:[new Jb(p.d.ANIMATIONTYPE_FLOAT,"anisotropy.angle",pb,(()=>1))],anisotropyTexture:{extensions:{KHR_texture_transform:vb("anisotropy.texture")}}},KHR_materials_clearcoat:{clearcoatFactor:[new Jb(p.d.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",pb,(()=>1))],clearcoatRoughnessFactor:[new Jb(p.d.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",pb,(()=>1))],clearcoatTexture:{extensions:{KHR_texture_transform:vb("clearCoat.texture")}},clearcoatNormalTexture:{scale:[new Jb(p.d.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",pb,(()=>1))],extensions:{KHR_texture_transform:vb("clearCoat.bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:vb("clearCoat.textureRoughness")}}},KHR_materials_dispersion:{dispersion:[new Jb(p.d.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",pb,(()=>1))]},KHR_materials_emissive_strength:{emissiveStrength:[new Jb(p.d.ANIMATIONTYPE_FLOAT,"emissiveIntensity",pb,(()=>1))]},KHR_materials_ior:{ior:[new Jb(p.d.ANIMATIONTYPE_FLOAT,"indexOfRefraction",pb,(()=>1))]},KHR_materials_iridescence:{iridescenceFactor:[new Jb(p.d.ANIMATIONTYPE_FLOAT,"iridescence.intensity",pb,(()=>1))],iridescenceIor:[new Jb(p.d.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",pb,(()=>1))],iridescenceThicknessMinimum:[new Jb(p.d.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",pb,(()=>1))],iridescenceThicknessMaximum:[new Jb(p.d.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",pb,(()=>1))],iridescenceTexture:{extensions:{KHR_texture_transform:vb("iridescence.texture")}},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:vb("iridescence.thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:[new Jb(p.d.ANIMATIONTYPE_COLOR3,"sheen.color",Cb,(()=>3))],sheenRoughnessFactor:[new Jb(p.d.ANIMATIONTYPE_FLOAT,"sheen.roughness",pb,(()=>1))],sheenColorTexture:{extensions:{KHR_texture_transform:vb("sheen.texture")}},sheenRoughnessTexture:{extensions:{KHR_texture_transform:vb("sheen.textureRoughness")}}},KHR_materials_specular:{specularFactor:[new Jb(p.d.ANIMATIONTYPE_FLOAT,"metallicF0Factor",pb,(()=>1))],specularColorFactor:[new Jb(p.d.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",Cb,(()=>3))],specularTexture:{extensions:{KHR_texture_transform:vb("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:vb("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:[new Jb(p.d.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",pb,(()=>1))],transmissionTexture:{extensions:{KHR_texture_transform:vb("subSurface.refractionIntensityTexture")}}},KHR_materials_volume:{attenuationColor:[new Jb(p.d.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",Cb,(()=>3))],attenuationDistance:[new Jb(p.d.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",pb,(()=>1))],thicknessFactor:[new Jb(p.d.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",pb,(()=>1))],thicknessTexture:{extensions:{KHR_texture_transform:vb("subSurface.thicknessTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:[new Jb(p.d.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",pb,(()=>1))],diffuseTransmissionTexture:{extensions:{KHR_texture_transform:vb("subSurface.translucencyIntensityTexture")}},diffuseTransmissionColorFactor:[new Jb(p.d.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",Cb,(()=>3))],diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:vb("subSurface.translucencyColorTexture")}}}}}},cameras:Lb,extensions:{KHR_lights_punctual:{lights:{__array__:{__target__:!0,color:[new mb(p.d.ANIMATIONTYPE_COLOR3,"diffuse",Cb,(()=>3))],dj:[new mb(p.d.ANIMATIONTYPE_FLOAT,"intensity",pb,(()=>1))],range:[new mb(p.d.ANIMATIONTYPE_FLOAT,"range",pb,(()=>1))],spot:{innerConeAngle:[new mb(p.d.ANIMATIONTYPE_FLOAT,"innerAngle",yb,(()=>1))],outerConeAngle:[new mb(p.d.ANIMATIONTYPE_FLOAT,"angle",yb,(()=>1))]}}}}}};class Sb{constructor(t,b){this._gltf=t,this._infoTree=b}convert(t){let b,Y=this._gltf,o=this._infoTree;if(!t.startsWith("/"))throw new Error("Path must start with a /");const x=t.split("/");x.shift();for(const F of x){if(o.__array__)o=o.__array__;else if(o=o[F],!o)throw new Error(`Path ${t} is invalid`);if(void 0===Y)throw new Error(`Path ${t} is invalid`);Y=Y[F],o.__target__&&(b=Y)}return{object:b,info:o}}}const eb="KHR_animation_pointer";class gb extends Sb{constructor(t){super(t,zb)}}class Db{constructor(t){this.name=eb,this._loader=t,this._pathToObjectConverter=new gb(this._loader.Wi)}get enabled(){return this._loader.isExtensionUsed(eb)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(t,b,Y,o,x){var F;const r=null===(F=o.target.extensions)||void 0===F?void 0:F.KHR_animation_pointer;if(!r||!this._pathToObjectConverter)return null;"pointer"!==o.target.path&&y.b.Warn(`${t}/target/path: Value (${o.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=o.target.node&&y.b.Warn(`${t}/target/node: Value (${o.target.node}) must not be present when using the ${this.name} extension`);const R=`${t}/extensions/${this.name}`,d=r.pointer;if(!d)throw new Error(`${R}: Pointer is missing`);try{const F=this._pathToObjectConverter.convert(d);return this._loader._loadAnimationChannelFromTargetInfoAsync(t,b,Y,o,F,x)}catch(E){return y.b.Warn(`${R}/pointer: Invalid pointer (${d}) skipped`),null}}}k(eb),P(eb,!0,(t=>new Db(t)));class Hb{constructor(t,b,Y){this.frame=t,this.action=b,this.onlyOnce=Y,this.isDone=!1}_clone(){return new Hb(this.frame,this.action,this.onlyOnce)}}var fb=Y(1129),nb=Y(1160);class Xb{get loop(){return this._loop}set loop(t){t!==this._loop&&(this._loop=t,this.updateOptions({loop:t}))}get currentTime(){var t;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(t=nb.c.audioEngine)&&void 0!==t&&t.audioContext&&(this.isPlaying||this.isPaused)){const t=this.isPaused?0:nb.c.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+t}return 0}get spatialSound(){return this._spatialSound}set spatialSound(t){if(t==this._spatialSound)return;const b=this.isPlaying;this.pause(),t?(this._spatialSound=t,this._updateSpatialParameters()):this._disableSpatialSound(),b&&this.play()}constructor(t,b,Y){var o;let F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,R=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new U.e,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=x.l.Zero(),this._localDirection=new x.l(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=t,Y=Y||T.d.LastCreatedScene)if(this._scene=Y,Xb._SceneComponentInitialization(Y),this._readyToPlayCallback=F,this._customAttenuationFunction=(t,b,Y,o,x)=>b<Y?t*(1-b/Y):0,R&&(this.autoplay=R.autoplay||!1,this._loop=R.loop||!1,void 0!==R.volume&&(this._volume=R.volume),this._spatialSound=R.spatialSound??!1,this.maxDistance=R.maxDistance??100,this.useCustomAttenuation=R.useCustomAttenuation??!1,this.rolloffFactor=R.rolloffFactor||1,this.refDistance=R.refDistance||1,this.distanceModel=R.distanceModel||"linear",this._playbackRate=R.playbackRate||1,this._streaming=R.streaming??!1,this._length=R.length,this._offset=R.offset),null!==(o=nb.c.audioEngine)&&void 0!==o&&o.canUseWebAudio&&nb.c.audioEngine.audioContext){this._soundGain=nb.c.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let t=!0;if(b)try{"string"===typeof b?(this._urlType="String",this._url=b):b instanceof ArrayBuffer?this._urlType="ArrayBuffer":b instanceof HTMLMediaElement?this._urlType="MediaElement":b instanceof MediaStream?this._urlType="MediaStream":b instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(b)&&(this._urlType="Array");let Y=[],o=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=nb.c.audioEngine.audioContext.createMediaElementSource(b),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=nb.c.audioEngine.audioContext.createMediaStreamSource(b),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":b.byteLength>0&&(o=!0,this._soundLoaded(b));break;case"AudioBuffer":this._audioBufferLoaded(b);break;case"String":Y.push(b);case"Array":0===Y.length&&(Y=b);for(let t=0;t<Y.length;t++){const b=Y[t];if(o=R&&R.skipCodecCheck||-1!==b.indexOf(".mp3",b.length-4)&&nb.c.audioEngine.isMP3supported||-1!==b.indexOf(".ogg",b.length-4)&&nb.c.audioEngine.isOGGsupported||-1!==b.indexOf(".wav",b.length-4)||-1!==b.indexOf(".m4a",b.length-4)||-1!==b.indexOf(".mp4",b.length-4)||-1!==b.indexOf("blob:"),o){this._streaming?(this._htmlAudioElement=new Audio(b),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,r.f.SetCorsBehavior(b,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(b,(t=>{this._soundLoaded(t)}),void 0,!0,!0,(t=>{t&&y.b.Error("XHR "+t.status+" error on: "+b+"."),y.b.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:t=!1}t?o||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):y.b.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(d){y.b.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),nb.c.audioEngine&&!nb.c.audioEngine.WarnedWebAudioUnsupported&&(y.b.Error("Web Audio is not supported by your browser."),nb.c.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var t;null!==(t=nb.c.audioEngine)&&void 0!==t&&t.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(t){var b;null!==(b=nb.c.audioEngine)&&void 0!==b&&b.audioContext&&(this._audioBuffer=t,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(t){var b;null!==(b=nb.c.audioEngine)&&void 0!==b&&b.audioContext&&nb.c.audioEngine.audioContext.decodeAudioData(t,(t=>{this._audioBufferLoaded(t)}),(t=>{y.b.Error("Error while decoding audio data for: "+this.name+" / Error: "+t)}))}setAudioBuffer(t){var b;null!==(b=nb.c.audioEngine)&&void 0!==b&&b.canUseWebAudio&&(this._audioBuffer=t,this._isReadyToPlay=!0)}updateOptions(t){t&&(this.loop=t.loop??this.loop,this.maxDistance=t.maxDistance??this.maxDistance,this.useCustomAttenuation=t.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=t.rolloffFactor??this.rolloffFactor,this.refDistance=t.refDistance??this.refDistance,this.distanceModel=t.distanceModel??this.distanceModel,this._playbackRate=t.playbackRate??this._playbackRate,this._length=t.length??void 0,this.spatialSound=t.spatialSound??this._spatialSound,this._setOffset(t.offset??void 0),this.setVolume(t.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var t;null!==(t=nb.c.audioEngine)&&void 0!==t&&t.canUseWebAudio&&nb.c.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??nb.c.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var t;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(t=this._soundPanner)||void 0===t||t.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var t;null!==(t=nb.c.audioEngine)&&void 0!==t&&t.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(t){var b;null!==(b=nb.c.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(t),this._isOutputConnected=!0)}setDirectionalCone(t,b,Y){b<t?y.b.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=t,this._coneOuterAngle=b,this._coneOuterGain=Y,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(t){if(t!=this._coneInnerAngle){var b;if(this._coneOuterAngle<t)return void y.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=t,null!==(b=nb.c.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(t){if(t!=this._coneOuterAngle){var b;if(t<this._coneInnerAngle)return void y.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=t,null!==(b=nb.c.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(t){var b;t.equals(this._position)||(this._position.p(t),null!==(b=nb.c.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(t){var b;this._localDirection=t,null!==(b=nb.c.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const t=this._connectedTransformNode.getWorldMatrix(),b=x.l.TransformNormal(this._localDirection,t);b.normalize(),this._soundPanner.orientationX.value=b.x,this._soundPanner.orientationY.value=b.y,this._soundPanner.orientationZ.value=b.z}updateDistanceFromListener(){var t;if(null!==(t=nb.c.audioEngine)&&void 0!==t&&t.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const t=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.fd(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,t,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(t){this._customAttenuationFunction=t}play(t,b,Y){var o;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(o=nb.c.audioEngine)&&void 0!==o&&o.audioContext)try{var x,F;this._clearTimeoutsAndObservers();let o=t?(null===(x=nb.c.audioEngine)||void 0===x?void 0:x.audioContext.currentTime)+t:null===(F=nb.c.audioEngine)||void 0===F?void 0:F.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=nb.c.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const t=()=>{var Y;if(null!==(Y=nb.c.audioEngine)&&void 0!==Y&&Y.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=b??0;const Y=this._htmlAudioElement.play();void 0!==Y&&Y.catch((()=>{var b,Y;(null===(b=nb.c.audioEngine)||void 0===b||b.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(Y=nb.c.audioEngine)||void 0===Y?void 0:Y.onAudioUnlockedObservable.addOnce((()=>{t()})))}))}else{var o;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(o=nb.c.audioEngine)||void 0===o?void 0:o.onAudioUnlockedObservable.addOnce((()=>{t()}))}};t()}}else{var r;const x=()=>{var x;if(null!==(x=nb.c.audioEngine)&&void 0!==x&&x.audioContext){var F;if(Y=Y||this._length,void 0!==b&&this._setOffset(b),this._soundSource){const t=this._soundSource;t.onended=()=>{t.disconnect()}}if(this._soundSource=null===(F=nb.c.audioEngine)||void 0===F?void 0:F.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var r;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==b&&(this._soundSource.loopStart=b),void 0!==Y&&(this._soundSource.loopEnd=(0|b)+Y),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},o=t?(null===(r=nb.c.audioEngine)||void 0===r?void 0:r.audioContext.currentTime)+t:nb.c.audioEngine.audioContext.currentTime;const x=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(o,x,this.loop?void 0:Y)}}};"suspended"===(null===(r=nb.c.audioEngine)||void 0===r?void 0:r.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var t;"suspended"===(null===(t=nb.c.audioEngine)||void 0===t?void 0:t.audioContext.state)?(nb.c.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=nb.c.audioEngine.onAudioUnlockedObservable.addOnce((()=>{x()})))):x()}),500):x()}this._startTime=o,this.isPlaying=!0,this.isPaused=!1}catch(R){y.b.Error("Error while trying to play audio: "+this.name+", "+R.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(t){var b;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var Y;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(Y=this._streamingSource)||void 0===Y||Y.disconnect();this.isPlaying=!1}else if(null!==(b=nb.c.audioEngine)&&void 0!==b&&b.audioContext&&this._soundSource){const b=t?nb.c.audioEngine.audioContext.currentTime+t:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(b)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var t;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var b;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(b=this._streamingSource)||void 0===b||b.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(t=nb.c.audioEngine)&&void 0!==t&&t.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=nb.c.audioEngine.audioContext.currentTime-this._startTime)}setVolume(t,b){var Y;null!==(Y=nb.c.audioEngine)&&void 0!==Y&&Y.canUseWebAudio&&this._soundGain&&(b&&nb.c.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(nb.c.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,nb.c.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(t,nb.c.audioEngine.audioContext.currentTime+b)):this._soundGain.gain.value=t),this._volume=t}setPlaybackRate(t){this._playbackRate=t,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(t){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=t,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=t=>this._onRegisterAfterWorldMatrixUpdate(t),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(t){var b;if(t.getBoundingInfo){const b=t.getBoundingInfo();this.setPosition(b.boundingSphere.centerWorld)}else this.setPosition(t.absolutePosition);null!==(b=nb.c.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const t=()=>{this._isReadyToPlay?(Y._audioBuffer=this.getAudioBuffer(),Y._isReadyToPlay=!0,Y.autoplay&&Y.play(0,this._offset,this._length)):setTimeout(t,300)},b={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},Y=new Xb(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,b);return this.useCustomAttenuation&&Y.setAttenuationFunction(this._customAttenuationFunction),Y.setPosition(this._position),Y.setPlaybackRate(this._playbackRate),t(),Y}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const t={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(t.connectedMeshId=this._connectedTransformNode.id),t.position=this._position.qe(),t.refDistance=this.refDistance,t.distanceModel=this.distanceModel,t.isDirectional=this._isDirectional,t.localDirectionToMesh=this._localDirection.qe(),t.coneInnerAngle=this._coneInnerAngle,t.coneOuterAngle=this._coneOuterAngle,t.coneOuterGain=this._coneOuterGain),t}static Parse(t,b,Y,o){const F=t.name;let r;r=t.url?Y+t.url:Y+F;const R={autoplay:t.autoplay,loop:t.loop,volume:t.volume,spatialSound:t.spatialSound,maxDistance:t.maxDistance,rolloffFactor:t.rolloffFactor,refDistance:t.refDistance,distanceModel:t.distanceModel,playbackRate:t.playbackRate};let d;if(o){const t=()=>{o._isReadyToPlay?(d._audioBuffer=o.getAudioBuffer(),d._isReadyToPlay=!0,d.autoplay&&d.play(0,d._offset,d._length)):setTimeout(t,300)};d=new Xb(F,new ArrayBuffer(0),b,null,R),t()}else d=new Xb(F,r,b,(()=>{b.removePendingData(d)}),R),b.addPendingData(d);if(t.position){const b=x.l.ce(t.position);d.setPosition(b)}if(t.isDirectional&&(d.setDirectionalCone(t.coneInnerAngle||360,t.coneOuterAngle||360,t.coneOuterGain||0),t.localDirectionToMesh)){const b=x.l.ce(t.localDirectionToMesh);d.setLocalDirectionToMesh(b)}if(t.connectedMeshId){const Y=b.getMeshById(t.connectedMeshId);Y&&d.attachToMesh(Y)}return t.metadata&&(d.metadata=t.metadata),d}_setOffset(t){this._offset!==t&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=t)}_clearTimeoutsAndObservers(){var t;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(t=nb.c.audioEngine)||void 0===t||t.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}Xb._SceneComponentInitialization=t=>{throw(0,fb.c)("AudioSceneComponent")},(0,S.d)("BABYLON.Sound",Xb);class Qb{constructor(t,b,Y){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],b.length!==Y.length)throw new Error("Sounds length does not equal weights length");this.loop=t,this._weights=Y;let o=0;for(const F of Y)o+=F;const x=o>0?1/o:0;for(let F=0;F<this._weights.length;F++)this._weights[F]*=x;this._sounds=b;for(const F of this._sounds)F.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(t){if(t!==this._coneInnerAngle){if(this._coneOuterAngle<t)return void y.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=t;for(const b of this._sounds)b.directionalConeInnerAngle=t}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(t){if(t!==this._coneOuterAngle){if(t<this._coneInnerAngle)return void y.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=t;for(const b of this._sounds)b.directionalConeOuterAngle=t}}get volume(){return this._volume}set volume(t){if(t!==this._volume)for(const b of this._sounds)b.setVolume(t)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(t){if(!this.isPaused){this.stop();const t=Math.random();let b=0;for(let Y=0;Y<this._weights.length;Y++)if(b+=this._weights[Y],t<=b){this._currentIndex=Y;break}}const b=this._sounds[this._currentIndex??0];b.isReady()?b.play(0,this.isPaused?void 0:t):b.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class Nb{constructor(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(t=t||T.d.LastCreatedScene)&&(this._scene=t,this.soundCollection=[],this._options=b,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var t;null!==(t=nb.c.audioEngine)&&void 0!==t&&t.canUseWebAudio&&nb.c.audioEngine.audioContext&&(this._outputAudioNode=nb.c.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(nb.c.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(nb.c.audioEngine&&nb.c.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(t){var b;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(b=nb.c.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._outputAudioNode&&t.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==t.soundTrackId&&(-1===t.soundTrackId?this._scene.mainSoundTrack.removeSound(t):this._scene.soundTracks&&this._scene.soundTracks[t.soundTrackId].removeSound(t)),this.soundCollection.push(t),t.soundTrackId=this.id}removeSound(t){const b=this.soundCollection.indexOf(t);-1!==b&&this.soundCollection.splice(b,1)}setVolume(t){var b;null!==(b=nb.c.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=t)}switchPanningModelToHRTF(){var t;if(null!==(t=nb.c.audioEngine)&&void 0!==t&&t.canUseWebAudio)for(let b=0;b<this.soundCollection.length;b++)this.soundCollection[b].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var t;if(null!==(t=nb.c.audioEngine)&&void 0!==t&&t.canUseWebAudio)for(let b=0;b<this.soundCollection.length;b++)this.soundCollection[b].switchPanningModelToEqualPower()}connectToAnalyser(t){var b;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=t,null!==(b=nb.c.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,nb.c.audioEngine.masterGain))}}var ub=Y(1336),Zb=Y(1260),ab=(Y(1626),Y(1195));(0,Y(11883).c)(ub.b.NAME_AUDIO,((t,b,Y,o)=>{let x,F=[];if(Y.bf=Y.bf||[],void 0!==t.bf&&null!==t.bf)for(let R=0,d=t.bf.length;R<d;R++){var r;const d=t.bf[R];null!==(r=nb.c.audioEngine)&&void 0!==r&&r.canUseWebAudio?(d.url||(d.url=d.name),F[d.url]?Y.bf.push(Xb.Parse(d,b,o,F[d.url])):(x=Xb.Parse(d,b,o),F[d.url]=x,Y.bf.push(x))):Y.bf.push(new Xb(d.name,null,b))}F=[]})),Object.defineProperty(Zb.e.prototype,"mainSoundTrack",{get:function(){let t=this._getComponent(ub.b.NAME_AUDIO);return t||(t=new Ab(this),this.af(t)),this._mainSoundTrack||(this._mainSoundTrack=new Nb(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),Zb.e.prototype.getSoundByName=function(t){let b;for(b=0;b<this.mainSoundTrack.soundCollection.length;b++)if(this.mainSoundTrack.soundCollection[b].name===t)return this.mainSoundTrack.soundCollection[b];if(this.soundTracks)for(let Y=0;Y<this.soundTracks.length;Y++)for(b=0;b<this.soundTracks[Y].soundCollection.length;b++)if(this.soundTracks[Y].soundCollection[b].name===t)return this.soundTracks[Y].soundCollection[b];return null},Object.defineProperty(Zb.e.prototype,"audioEnabled",{get:function(){let t=this._getComponent(ub.b.NAME_AUDIO);return t||(t=new Ab(this),this.af(t)),t.audioEnabled},set:function(t){let b=this._getComponent(ub.b.NAME_AUDIO);b||(b=new Ab(this),this.af(b)),t?b.enableAudio():b.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(Zb.e.prototype,"headphone",{get:function(){let t=this._getComponent(ub.b.NAME_AUDIO);return t||(t=new Ab(this),this.af(t)),t.headphone},set:function(t){let b=this._getComponent(ub.b.NAME_AUDIO);b||(b=new Ab(this),this.af(b)),t?b.switchAudioModeForHeadphones():b.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(Zb.e.prototype,"audioListenerPositionProvider",{get:function(){let t=this._getComponent(ub.b.NAME_AUDIO);return t||(t=new Ab(this),this.af(t)),t.audioListenerPositionProvider},set:function(t){let b=this._getComponent(ub.b.NAME_AUDIO);if(b||(b=new Ab(this),this.af(b)),t&&"function"!==typeof t)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");b.audioListenerPositionProvider=t},enumerable:!0,configurable:!0}),Object.defineProperty(Zb.e.prototype,"audioListenerRotationProvider",{get:function(){let t=this._getComponent(ub.b.NAME_AUDIO);return t||(t=new Ab(this),this.af(t)),t.audioListenerRotationProvider},set:function(t){let b=this._getComponent(ub.b.NAME_AUDIO);if(b||(b=new Ab(this),this.af(b)),t&&"function"!==typeof t)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");b.audioListenerRotationProvider=t},enumerable:!0,configurable:!0}),Object.defineProperty(Zb.e.prototype,"audioPositioningRefreshRate",{get:function(){let t=this._getComponent(ub.b.NAME_AUDIO);return t||(t=new Ab(this),this.af(t)),t.audioPositioningRefreshRate},set:function(t){let b=this._getComponent(ub.b.NAME_AUDIO);b||(b=new Ab(this),this.af(b)),b.audioPositioningRefreshRate=t},enumerable:!0,configurable:!0});class Ab{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(t){this.name=ub.b.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new x.l,this._cachedCameraPosition=new x.l,this._lastCheck=0,this._invertMatrixTemp=new x.c,this._cameraDirectionTemp=new x.l,(t=t||T.d.LastCreatedScene)&&(this.Se=t,t.soundTracks=[],t.bf=[])}register(){this.Se._afterRenderStage.registerStep(ub.b.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(t){if(t.bf=[],this.Se.soundTracks)for(let b=0;b<this.Se.soundTracks.length;b++){const Y=this.Se.soundTracks[b];for(let b=0;b<Y.soundCollection.length;b++)t.bf.push(Y.soundCollection[b].serialize())}}addFromContainer(t){t.bf&&t.bf.forEach((t=>{t.play(),t.autoplay=!0,this.Se.mainSoundTrack.addSound(t)}))}removeFromContainer(t){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t.bf&&t.bf.forEach((t=>{t.stop(),t.autoplay=!1,this.Se.mainSoundTrack.removeSound(t),b&&t.dispose()}))}dispose(){const t=this.Se;if(t._mainSoundTrack&&t.mainSoundTrack.dispose(),t.soundTracks)for(let b=0;b<t.soundTracks.length;b++)t.soundTracks[b].dispose()}disableAudio(){const t=this.Se;let b;for(this._audioEnabled=!1,nb.c.audioEngine&&nb.c.audioEngine.audioContext&&nb.c.audioEngine.audioContext.suspend(),b=0;b<t.mainSoundTrack.soundCollection.length;b++)t.mainSoundTrack.soundCollection[b].pause();if(t.soundTracks)for(b=0;b<t.soundTracks.length;b++)for(let Y=0;Y<t.soundTracks[b].soundCollection.length;Y++)t.soundTracks[b].soundCollection[Y].pause()}enableAudio(){const t=this.Se;let b;for(this._audioEnabled=!0,nb.c.audioEngine&&nb.c.audioEngine.audioContext&&nb.c.audioEngine.audioContext.resume(),b=0;b<t.mainSoundTrack.soundCollection.length;b++)t.mainSoundTrack.soundCollection[b].isPaused&&t.mainSoundTrack.soundCollection[b].play();if(t.soundTracks)for(b=0;b<t.soundTracks.length;b++)for(let Y=0;Y<t.soundTracks[b].soundCollection.length;Y++)t.soundTracks[b].soundCollection[Y].isPaused&&t.soundTracks[b].soundCollection[Y].play()}switchAudioModeForHeadphones(){const t=this.Se;if(this._headphone=!0,t.mainSoundTrack.switchPanningModelToHRTF(),t.soundTracks)for(let b=0;b<t.soundTracks.length;b++)t.soundTracks[b].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const t=this.Se;if(this._headphone=!1,t.mainSoundTrack.switchPanningModelToEqualPower(),t.soundTracks)for(let b=0;b<t.soundTracks.length;b++)t.soundTracks[b].switchPanningModelToEqualPower()}_afterRender(){const t=ab.c.Now;if(this._lastCheck&&t-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=t;const b=this.Se;if(!this._audioEnabled||!b._mainSoundTrack||!b.soundTracks||0===b._mainSoundTrack.soundCollection.length&&1===b.soundTracks.length)return;const Y=nb.c.audioEngine;if(Y&&Y.audioContext){let t,o=b.activeCamera;if(b.activeCameras&&b.activeCameras.length>0&&(o=b.activeCameras[0]),this.audioListenerPositionProvider){const t=this.audioListenerPositionProvider();Y.audioContext.listener.setPosition(t.x||0,t.y||0,t.z||0)}else o?this._cachedCameraPosition.equals(o.globalPosition)||(this._cachedCameraPosition.p(o.globalPosition),Y.audioContext.listener.setPosition(o.globalPosition.x,o.globalPosition.y,o.globalPosition.z)):Y.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const t=this.audioListenerRotationProvider();Y.audioContext.listener.setOrientation(t.x||0,t.y||0,t.z||0,0,1,0)}else o?(o.rigCameras&&o.rigCameras.length>0&&(o=o.rigCameras[0]),o.getViewMatrix().invertToRef(this._invertMatrixTemp),x.l.TransformNormalToRef(Ab._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.p(this._cameraDirectionTemp),Y.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):Y.audioContext.listener.setOrientation(0,0,0,0,1,0);for(t=0;t<b.mainSoundTrack.soundCollection.length;t++){const Y=b.mainSoundTrack.soundCollection[t];Y.useCustomAttenuation&&Y.updateDistanceFromListener()}if(b.soundTracks)for(t=0;t<b.soundTracks.length;t++)for(let Y=0;Y<b.soundTracks[t].soundCollection.length;Y++){const o=b.soundTracks[t].soundCollection[Y];o.useCustomAttenuation&&o.updateDistanceFromListener()}}}}Ab._CameraDirection=new x.l(0,0,-1),Xb._SceneComponentInitialization=t=>{let b=t._getComponent(ub.b.NAME_AUDIO);b||(b=new Ab(t),t.af(b))};const Mb="MSFT_audio_emitter";class wb{constructor(t){this.name=Mb,this._loader=t,this.enabled=this._loader.isExtensionUsed(Mb)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const t=this._loader.Wi.extensions;if(t&&t[this.name]){const b=t[this.name];this._clips=b.clips,this._emitters=b.emitters,O.Assign(this._clips),O.Assign(this._emitters)}}loadSceneAsync(t,b){return j.LoadExtensionAsync(t,b,this.name,((Y,o)=>{const x=new Array;x.push(this._loader.loadSceneAsync(t,b));for(const t of o.emitters){const b=O.Get(`${Y}/emitters`,this._emitters,t);if(void 0!=b.refDistance||void 0!=b.maxDistance||void 0!=b.rolloffFactor||void 0!=b.distanceModel||void 0!=b.innerAngle||void 0!=b.outerAngle)throw new Error(`${Y}: Direction or Distance properties are not allowed on emitters attached to a scene`);x.push(this._loadEmitterAsync(`${Y}/emitters/${b.index}`,b))}return Promise.all(x).then((()=>{}))}))}loadNodeAsync(t,b,Y){return j.LoadExtensionAsync(t,b,this.name,((t,o)=>{const F=new Array;return this._loader.loadNodeAsync(t,b,(b=>{for(const Y of o.emitters){const o=O.Get(`${t}/emitters`,this._emitters,Y);F.push(this._loadEmitterAsync(`${t}/emitters/${o.index}`,o).then((()=>{for(const t of o._babylonSounds)t.attachToMesh(b),void 0==o.innerAngle&&void 0==o.outerAngle||(t.setLocalDirectionToMesh(x.l.Forward()),t.setDirectionalCone(2*r.f.ToDegrees(void 0==o.innerAngle?Math.PI:o.innerAngle),2*r.f.ToDegrees(void 0==o.outerAngle?Math.PI:o.outerAngle),0))})))}Y(b)})).then((t=>Promise.all(F).then((()=>t))))}))}loadAnimationAsync(t,b){return j.LoadExtensionAsync(t,b,this.name,((Y,o)=>this._loader.loadAnimationAsync(t,b).then((x=>{const F=new Array;O.Assign(o.events);for(const r of o.events)F.push(this._loadAnimationEventAsync(`${Y}/events/${r.index}`,t,b,r,x));return Promise.all(F).then((()=>x))}))))}_loadClipAsync(t,b){if(b._objectURL)return b._objectURL;let Y;if(b.uri)Y=this._loader.loadUriAsync(t,b,b.uri);else{const o=O.Get(`${t}/bufferView`,this._loader.Wi.bufferViews,b.bufferView);Y=this._loader.loadBufferViewAsync(`/bufferViews/${o.index}`,o)}return b._objectURL=Y.then((t=>URL.createObjectURL(new Blob([t],{type:b.mimeType})))),b._objectURL}_loadEmitterAsync(t,b){if(b._babylonSounds=b._babylonSounds||[],!b._babylonData){const t=new Array,Y=b.name||`emitter${b.index}`,o={loop:!1,autoplay:!1,volume:void 0==b.volume?1:b.volume};for(let F=0;F<b.clips.length;F++){const x=`/extensions/${this.name}/clips`,r=O.Get(x,this._clips,b.clips[F].clip);t.push(this._loadClipAsync(`${x}/${b.clips[F].clip}`,r).then((t=>{const x=b._babylonSounds[F]=new Xb(Y,t,this._loader.babylonScene,null,o);x.refDistance=b.refDistance||1,x.maxDistance=b.maxDistance||256,x.rolloffFactor=b.rolloffFactor||1,x.distanceModel=b.distanceModel||"exponential"})))}const x=Promise.all(t).then((()=>{const t=b.clips.map((t=>t.weight||1)),Y=new Qb(b.loop||!1,b._babylonSounds,t);b.innerAngle&&(Y.directionalConeInnerAngle=2*r.f.ToDegrees(b.innerAngle)),b.outerAngle&&(Y.directionalConeOuterAngle=2*r.f.ToDegrees(b.outerAngle)),b.volume&&(Y.volume=b.volume),b._babylonData.sound=Y}));b._babylonData={loaded:x}}return b._babylonData.loaded}_getEventAction(t,b,Y,o,x){switch(Y){case"play":return t=>{const Y=(x||0)+(t-o);b.play(Y)};case"stop":return()=>{b.stop()};case"pause":return()=>{b.pause()};default:throw new Error(`${t}: Unsupported action ${Y}`)}}_loadAnimationEventAsync(t,b,Y,o,x){if(0==x.targetedAnimations.length)return Promise.resolve();const F=x.targetedAnimations[0],r=o.k,R=O.Get(`/extensions/${this.name}/emitters`,this._emitters,r);return this._loadEmitterAsync(t,R).then((()=>{const b=R._babylonData.sound;if(b){const Y=new Hb(o.time,this._getEventAction(t,b,o.action,o.time,o.startOffset));F.animation.addEvent(Y),x.onAnimationGroupEndObservable.add((()=>{b.stop()})),x.onAnimationGroupPauseObservable.add((()=>{b.pause()}))}}))}}k(Mb),P(Mb,!0,(t=>new wb(t)));const cb="MSFT_lod";class Ib{constructor(t){var b;this.name=cb,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new U.e,this.onMaterialLODsLoadedObservable=new U.e,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=t,this.maxLODsToLoad=(null===(b=this._loader.parent.extensionOptions[cb])||void 0===b?void 0:b.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(cb)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let t=0;t<this._nodePromiseLODs.length;t++){const b=Promise.all(this._nodePromiseLODs[t]).then((()=>{0!==t&&(this._loader.endPerformanceCounter(`Node LOD ${t}`),this._loader.log(`Loaded node LOD ${t}`)),this.onNodeLODsLoadedObservable.notifyObservers(t),t!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${t+1}`),this._loadBufferLOD(this._nodeBufferLODs,t+1),this._nodeSignalLODs[t]&&this._nodeSignalLODs[t].resolve())}));this._loader._completePromises.push(b)}for(let t=0;t<this._materialPromiseLODs.length;t++){const b=Promise.all(this._materialPromiseLODs[t]).then((()=>{0!==t&&(this._loader.endPerformanceCounter(`Material LOD ${t}`),this._loader.log(`Loaded material LOD ${t}`)),this.onMaterialLODsLoadedObservable.notifyObservers(t),t!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${t+1}`),this._loadBufferLOD(this._materialBufferLODs,t+1),this._materialSignalLODs[t]&&this._materialSignalLODs[t].resolve())}));this._loader._completePromises.push(b)}}loadSceneAsync(t,b){const Y=this._loader.loadSceneAsync(t,b);return this._loadBufferLOD(this._bufferLODs,0),Y}loadNodeAsync(t,b,Y){return j.LoadExtensionAsync(t,b,this.name,((t,x)=>{let F;const r=this._getLODs(t,b,this._loader.Wi.nodes,x.ids);this._loader.logOpen(`${t}`);for(let b=0;b<r.length;b++){const t=r[b];0!==b&&(this._nodeIndexLOD=b,this._nodeSignalLODs[b]=this._nodeSignalLODs[b]||new o);const x=t=>{Y(t),t.zg(!1)},R=this._loader.loadNodeAsync(`/nodes/${t.index}`,t,x).then((t=>{if(0!==b){const t=r[b-1];t._babylonTransformNode&&(this._disposeTransformNode(t._babylonTransformNode),delete t._babylonTransformNode)}return t.zg(!0),t}));this._nodePromiseLODs[b]=this._nodePromiseLODs[b]||[],0===b?F=R:(this._nodeIndexLOD=null,this._nodePromiseLODs[b].push(R))}return this._loader.logClose(),F}))}_loadMaterialAsync(t,b,Y,o,x){return this._nodeIndexLOD?null:j.LoadExtensionAsync(t,b,this.name,((t,F)=>{let r;const R=this._getLODs(t,b,this._loader.Wi.materials,F.ids);this._loader.logOpen(`${t}`);for(let b=0;b<R.length;b++){const t=R[b];0!==b&&(this._materialIndexLOD=b);const F=this._loader._loadMaterialAsync(`/materials/${t.index}`,t,Y,o,(t=>{0===b&&x(t)})).then((t=>{if(0!==b){x(t);const Y=R[b-1]._data;Y[o]&&(this._disposeMaterials([Y[o].babylonMaterial]),delete Y[o])}return t}));this._materialPromiseLODs[b]=this._materialPromiseLODs[b]||[],0===b?r=F:(this._materialIndexLOD=null,this._materialPromiseLODs[b].push(F))}return this._loader.logClose(),r}))}_loadUriAsync(t,b,Y){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const x=this._nodeIndexLOD-1;return this._nodeSignalLODs[x]=this._nodeSignalLODs[x]||new o,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((()=>this._loader.loadUriAsync(t,b,Y)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const x=this._materialIndexLOD-1;return this._materialSignalLODs[x]=this._materialSignalLODs[x]||new o,this._materialSignalLODs[x].promise.then((()=>this._loader.loadUriAsync(t,b,Y)))}return null}loadBufferAsync(t,b,Y,x){if(this._loader.parent.useRangeRequests&&!b.uri){if(!this._loader.bin)throw new Error(`${t}: Uri is missing or the binary glTF is missing its binary chunk`);const b=(t,b)=>{const F=Y,r=F+x-1;let R=t[b];return R?(R.start=Math.min(R.start,F),R.end=Math.max(R.end,r)):(R={start:F,end:r,loaded:new o},t[b]=R),R.loaded.promise.then((t=>new Uint8Array(t.buffer,t.byteOffset+Y-R.start,x)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?b(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?b(this._materialBufferLODs,this._materialIndexLOD):b(this._bufferLODs,0)}return null}_loadBufferLOD(t,b){const Y=t[b];Y&&(this._loader.log(`Loading buffer range [${Y.start}-${Y.end}]`),this._loader.bin.readAsync(Y.start,Y.end-Y.start+1).then((t=>{Y.loaded.resolve(t)}),(t=>{Y.loaded.reject(t)})))}_getLODs(t,b,Y,o){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const x=[];for(let F=o.length-1;F>=0;F--)if(x.push(O.Get(`${t}/ids/${o[F]}`,Y,o[F])),x.length===this.maxLODsToLoad)return x;return x.push(b),x}_disposeTransformNode(t){const b=[],Y=t.material;Y&&b.push(Y);for(const x of t.getChildMeshes())x.material&&b.push(x.material);t.dispose();const o=b.filter((t=>this._loader.babylonScene.meshes.every((b=>b.material!=t))));this._disposeMaterials(o)}_disposeMaterials(t){const b={};for(const Y of t){for(const t of Y.getActiveTextures())b[t.uniqueId]=t;Y.dispose()}for(const Y in b)for(const t of this._loader.babylonScene.materials)t.hasTexture(b[Y])&&delete b[Y];for(const Y in b)b[Y].dispose()}}k(cb),P(cb,!0,(t=>new Ib(t)));const sb="MSFT_minecraftMesh";class lb{constructor(t){this.name=sb,this._loader=t,this.enabled=this._loader.isExtensionUsed(sb)}dispose(){this._loader=null}loadMaterialPropertiesAsync(t,b,Y){return j.LoadExtraAsync(t,b,this.name,((o,x)=>{if(x){if(!(Y instanceof g))throw new Error(`${o}: Material type not supported`);const x=this._loader.loadMaterialPropertiesAsync(t,b,Y);return Y.needAlphaBlending()&&(Y.forceDepthWrite=!0,Y.separateCullingPass=!0),Y.Ce=Y.forceDepthWrite,Y.twoSidedLighting=!0,x}return null}))}}k(sb),P(sb,!0,(t=>new lb(t)));const ib="MSFT_sRGBFactors";class Vb{constructor(t){this.name=ib,this._loader=t,this.enabled=this._loader.isExtensionUsed(ib)}dispose(){this._loader=null}loadMaterialPropertiesAsync(t,b,Y){return j.LoadExtraAsync(t,b,this.name,((o,x)=>{if(x){if(!(Y instanceof g))throw new Error(`${o}: Material type not supported`);const x=this._loader.loadMaterialPropertiesAsync(t,b,Y),F=Y.va().getEngine().useExactSrgbConversions;return Y.albedoTexture||Y.albedoColor.toLinearSpaceToRef(Y.albedoColor,F),Y.reflectivityTexture||Y.reflectivityColor.toLinearSpaceToRef(Y.reflectivityColor,F),x}return null}))}}k(ib),P(ib,!0,(t=>new Vb(t)));var Pb,kb=Y(1072);!function(t){t[t.Input=0]="Input",t[t.Output=1]="Output"}(Pb||(Pb={}));class qb{constructor(t,b,Y){this._ownerBlock=Y,this._connectedPoint=[],this.uniqueId=(0,kb.c)(),this.connectedPointIds=[],this.name=t,this._connectionType=b}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(t){if(this._connectionType===t._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||t._isSingularConnection()&&t._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(t),t._connectedPoint.push(this)}serialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.uniqueId=this.uniqueId,t.name=this.name,t._connectionType=this._connectionType,t.connectedPointIds=[],t.className=this.getClassName();for(const b of this._connectedPoint)t.connectedPointIds.push(b.uniqueId)}getClassName(){return"FGConnection"}deserialize(t){this.uniqueId=t.uniqueId,this.name=t.name,this._connectionType=t._connectionType,this.connectedPointIds=t.connectedPointIds}static Parse(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=arguments.length>1?arguments[1]:void 0;const Y=new(r.f.Instantiate(t.className))(t.name,t._connectionType,b);return Y.deserialize(t),Y}}class Ob{constructor(t){this.value=this._toInt(t)}_toInt(t){return 0|t}add(t){return new Ob(this.value+t.value)}fd(t){return new Ob(this.value-t.value)}multiply(t){return new Ob(Math.imul(this.value,t.value))}divide(t){return new Ob(this.value/t.value)}getClassName(){return Ob.ClassName}equals(t){return this.value===t.value}static Parse(t){return new Ob(t.value)}}Ob.ClassName="FlowGraphInteger",(0,S.d)("FlowGraphInteger",Ob);class jb{constructor(t,b){this.typeName=t,this.defaultValue=b}serialize(t){t.typeName=this.typeName,t.defaultValue=this.defaultValue}static Parse(t){return new jb(t.typeName,t.defaultValue)}}const Gb=new jb("any",void 0),hb=(new jb("string",""),new jb("number",0)),tY=new jb("boolean",!1),bY=new jb("Vector2",x.i.Zero()),YY=new jb("ae",x.l.Zero()),oY=(new jb("Vector4",x.m.Zero()),new jb("Matrix",x.c.Identity())),xY=(new jb("Le",F.d.Black()),new jb("Ne",new F.h(0,0,0,0)),new jb("Quaternion",x.e.Identity()),new jb("FlowGraphInteger",new Ob(0)));class FY extends qb{constructor(t,b,Y,o){super(t,b,Y),this.richType=o}_isSingularConnection(){return 0===this.connectionType}setValue(t,b){b._setConnectionValue(this,t)}connectTo(t){super.connectTo(t)}_getValueOrDefault(t){return t._hasConnectionValue(this)?t._getConnectionValue(this):this.richType.defaultValue}getValue(t){return 1===this.connectionType?(t._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(t),this._getValueOrDefault(t)):this.isConnected()?this._connectedPoint[0].getValue(t):this._getValueOrDefault(t)}getClassName(){return"FGDataConnection"}serialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(t),t.richType={},this.richType.serialize(t.richType)}static Parse(t,b){const Y=qb.Parse(t,b);return Y.richType=jb.Parse(t.richType),Y}}function rY(t){return"Mesh"===t||"AbstractMesh"===t||"GroundMesh"===t||"InstanceMesh"===t||"LinesMesh"===t||"GoldbergMesh"===t||"GreasedLineMesh"===t||"TrailMesh"===t}function RY(t){return"Vector2"===t||"ae"===t||"Vector4"===t||"Quaternion"===t||"Le"===t||"Ne"===t}function dY(t,b,Y){var o;const x=(null===b||void 0===b||null===(o=b.getClassName)||void 0===o?void 0:o.call(b))??"";rY(x)?Y[t]={name:b.name,className:x}:RY(x)?Y[t]={value:b.qe(),className:x}:Y[t]=b}function EY(t,b,Y){const o=b[t];let r;const R=null===o||void 0===o?void 0:o.className;return r=rY(R)?Y.getMeshByName(o.name):RY(R)?function(t,b){if("Vector2"===t)return x.i.ce(b);if("ae"===t)return x.l.ce(b);if("Vector4"===t)return x.m.ce(b);if("Quaternion"===t)return x.e.ce(b);if("Le"===t)return new F.d(b[0],b[1],b[2]);if("Ne"===t)return new F.h(b[0],b[1],b[2],b[3]);throw new Error(`Unknown vector class name ${t}`)}(R,o.value):"Matrix"===R?x.c.ce(o.value):R===Ob.ClassName?Ob.Parse(o):o&&void 0!==o.value?o.value:o,r}(0,S.d)("FGDataConnection",FY);class UY{constructor(t){var b;this.config=t,this.uniqueId=(0,kb.c)(),this.name=(null===(b=this.config)||void 0===b?void 0:b.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(t){}registerDataInput(t,b){const Y=new FY(t,0,this,b);return this.dataInputs.push(Y),Y}registerDataOutput(t,b){const Y=new FY(t,1,this,b);return this.dataOutputs.push(Y),Y}getDataInput(t){return this.dataInputs.find((b=>b.name===t))}getDataOutput(t){return this.dataOutputs.find((b=>b.name===t))}serialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.uniqueId=this.uniqueId,t.config={},this.config&&(t.config.name=this.config.name),t.dataInputs=[],t.dataOutputs=[],t.className=this.getClassName();for(const b of this.dataInputs){const Y={};b.serialize(Y),t.dataInputs.push(Y)}for(const b of this.dataOutputs){const Y={};b.serialize(Y),t.dataOutputs.push(Y)}}getClassName(){return"FGBlock"}static Parse(t,b){const Y=r.f.Instantiate(t.className),o={},x=b.valueParseFunction??EY;if(t.config)for(const r in t.config)o[r]=x(r,t.config,b.Se);var F;("FGSetPropertyBlock"===(F=t.className)||"FGGetPropertyBlock"===F||"FGPlayAnimationBlock"===F||"FGMeshPickEventBlock"===F)&&(o.pathConverter=b.pathConverter);const R=new Y(o);R.uniqueId=t.uniqueId;for(let r=0;r<t.dataInputs.length;r++){const b=R.getDataInput(t.dataInputs[r].name);if(!b)throw new Error("Could not find data input with name "+t.dataInputs[r].name+" in block "+t.className);b.deserialize(t.dataInputs[r])}for(let r=0;r<t.dataOutputs.length;r++){const b=R.getDataOutput(t.dataOutputs[r].name);if(!b)throw new Error("Could not find data output with name "+t.dataOutputs[r].name+" in block "+t.className);b.deserialize(t.dataOutputs[r])}return R.metadata=t.metadata,R.deserialize&&R.deserialize(t),R}}class CY extends qb{_isSingularConnection(){return 1===this.connectionType}_activateSignal(t){var b;0===this.connectionType?(t._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(t,this),t._increaseExecutionId()):null===(b=this._connectedPoint[0])||void 0===b||b._activateSignal(t)}}(0,S.d)("FlowGraphSignalConnection",CY);class pY extends UY{constructor(t){super(t),this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in")}_registerSignalInput(t){const b=new CY(t,0,this);return this.signalInputs.push(b),b}_registerSignalOutput(t){const b=new CY(t,1,this);return this.signalOutputs.push(b),b}getSignalInput(t){return this.signalInputs.find((b=>b.name===t))}getSignalOutput(t){return this.signalOutputs.find((b=>b.name===t))}serialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(t),t.signalInputs=[],t.signalOutputs=[];for(const b of this.signalInputs){const Y={};b.serialize(Y),t.signalInputs.push(Y)}for(const b of this.signalOutputs){const Y={};b.serialize(Y),t.signalOutputs.push(Y)}}deserialize(t){for(let b=0;b<t.signalInputs.length;b++){const Y=this.getSignalInput(t.signalInputs[b].name);if(!Y)throw new Error("Could not find signal input with name "+t.signalInputs[b].name+" in block "+t.className);Y.deserialize(t.signalInputs[b])}for(let b=0;b<t.signalOutputs.length;b++){const Y=this.getSignalOutput(t.signalOutputs[b].name);if(!Y)throw new Error("Could not find signal output with name "+t.signalOutputs[b].name+" in block "+t.className);Y.deserialize(t.signalOutputs[b])}}getClassName(){return"FGExecutionBlock"}}class WY extends pY{constructor(t){super(t),this.out=this._registerSignalOutput("out"),this.done=this._registerSignalOutput("done")}_startPendingTasks(t){this._preparePendingTasks(t),t._addPendingBlock(this)}}class TY extends WY{_execute(t){t._notifyExecuteNode(this),this.out._activateSignal(t)}}class yY{constructor(t){this.uniqueId=(0,kb.c)(),this._userVariables={},this._executionVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new U.e,this._configuration=t}hasVariable(t){return t in this._userVariables}setVariable(t,b){this._userVariables[t]=b}getVariable(t){return this._userVariables[t]}get userVariables(){return this._userVariables}_getUniqueIdPrefixedName(t,b){return`${t.uniqueId}_${b}`}_setExecutionVariable(t,b,Y){this._executionVariables[this._getUniqueIdPrefixedName(t,b)]=Y}_getExecutionVariable(t,b,Y){return this._hasExecutionVariable(t,b)?this._executionVariables[this._getUniqueIdPrefixedName(t,b)]:Y}_deleteExecutionVariable(t,b){delete this._executionVariables[this._getUniqueIdPrefixedName(t,b)]}_hasExecutionVariable(t,b){return this._getUniqueIdPrefixedName(t,b)in this._executionVariables}_hasConnectionValue(t){return t.uniqueId in this._connectionValues}_setConnectionValue(t,b){this._connectionValues[t.uniqueId]=b}_getConnectionValue(t){return this._connectionValues[t.uniqueId]}get configuration(){return this._configuration}_addPendingBlock(t){this._pendingBlocks.push(t)}_removePendingBlock(t){const b=this._pendingBlocks.indexOf(t);-1!==b&&this._pendingBlocks.splice(b,1)}_clearPendingBlocks(){for(const t of this._pendingBlocks)t._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(t){this.onNodeExecutedObservable.notifyObservers(t)}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:dY;t.uniqueId=this.uniqueId,t._userVariables={};for(const Y in this._userVariables)b(Y,this._userVariables[Y],t._userVariables);t._connectionValues={};for(const Y in this._connectionValues)b(Y,this._connectionValues[Y],t._connectionValues)}getClassName(){return"FGContext"}static Parse(t,b){const Y=b.graph.createContext(),o=b.valueParseFunction??EY;Y.uniqueId=t.uniqueId;for(const x in t._userVariables){const b=o(x,t._userVariables,Y._configuration.Se);Y._userVariables[x]=b}for(const x in t._connectionValues){const b=o(x,t._connectionValues,Y._configuration.Se);Y._connectionValues[x]=b}return Y}}(0,m.e)([(0,K.P)()],yY.prototype,"uniqueId",void 0);var vY,BY,JY=Y(1343);function mY(t,b){return!(!t.parent||t.parent!==b&&!mY(t.parent,b))}class KY extends TY{constructor(t){super(t),this.config=t}_getReferencedMesh(){const t=this.config.pathConverter.convert(this.config.path),b=t.info.getObject(t.object);if(!b||!(b instanceof X.b))throw new Error("Mesh pick event block requires a valid mesh");return b}_preparePendingTasks(t){let b=t._getExecutionVariable(this,"meshPickObserver");if(!b){const Y=this._getReferencedMesh();t._setExecutionVariable(this,"mesh",Y),b=Y.va().onPointerObservable.add((b=>{var o,x,F;b.type===JY.b.POINTERPICK&&null!==(o=b.pickInfo)&&void 0!==o&&o.pickedMesh&&((null===(x=b.pickInfo)||void 0===x?void 0:x.pickedMesh)===Y||mY(null===(F=b.pickInfo)||void 0===F?void 0:F.pickedMesh,Y))&&this._execute(t)}));const o=Y.le.add((()=>this._onDispose));t._setExecutionVariable(this,"meshPickObserver",b),t._setExecutionVariable(this,"meshDisposeObserver",o)}}_onDispose(t){this._cancelPendingTasks(t),t._removePendingBlock(this)}_cancelPendingTasks(t){const b=t._getExecutionVariable(this,"mesh"),Y=t._getExecutionVariable(this,"meshPickObserver"),o=t._getExecutionVariable(this,"meshDisposeObserver");b.va().onPointerObservable.remove(Y),b.le.remove(o),t._deleteExecutionVariable(this,"mesh"),t._deleteExecutionVariable(this,"meshPickObserver"),t._deleteExecutionVariable(this,"meshDisposeObserver")}getClassName(){return KY.ClassName}serialize(t){super.serialize(t),t.config.path=this.config.path}}KY.ClassName="FGMeshPickEventBlock",(0,S.d)(KY.ClassName,KY),function(t){t[t.Stopped=0]="Stopped",t[t.Started=1]="Started"}(vY||(vY={}));class LY{constructor(t){this._eventBlocks=[],this._executionContexts=[],this.state=0,this._scene=t.Se,this._coordinator=t.coordinator,this._sceneDisposeObserver=this._scene.le.add((()=>this.dispose()))}createContext(){const t=new yY({Se:this._scene,coordinator:this._coordinator});return this._executionContexts.push(t),t}getContext(t){return this._executionContexts[t]}addEventBlock(t){this._eventBlocks.push(t)}start(){if(1!==this.state){this.state=1,0===this._executionContexts.length&&this.createContext();for(const t of this._executionContexts){const b=this._getContextualOrder();for(const Y of b)Y._startPendingTasks(t)}}}_getContextualOrder(){const t=[];for(const b of this._eventBlocks)if(b.getClassName()===KY.ClassName){const Y=b._getReferencedMesh();let o=0;for(;o<t.length;o++){const b=t[o]._getReferencedMesh();if(Y&&b&&mY(Y,b))break}t.splice(o,0,b)}else t.push(b);return t}dispose(){if(0!==this.state){this.state=0;for(const t of this._executionContexts)t._clearPendingBlocks();this._executionContexts.length=0,this._eventBlocks.length=0,this._scene.le.remove(this._sceneDisposeObserver),this._sceneDisposeObserver=null}}visitAllBlocks(t){const b=[],Y=new Set;for(const o of this._eventBlocks)b.push(o),Y.add(o.uniqueId);for(;b.length>0;){const o=b.pop();t(o);for(const t of o.dataInputs)for(const o of t._connectedPoint)Y.has(o._ownerBlock.uniqueId)||(b.push(o._ownerBlock),Y.add(o._ownerBlock.uniqueId));if(o instanceof pY)for(const t of o.signalOutputs)for(const o of t._connectedPoint)Y.has(o._ownerBlock.uniqueId)||(b.push(o._ownerBlock),Y.add(o._ownerBlock.uniqueId))}}serialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=arguments.length>1?arguments[1]:void 0;t.allBlocks=[],this.visitAllBlocks((b=>{const Y={};b.serialize(Y),t.allBlocks.push(Y)})),t.executionContexts=[];for(const Y of this._executionContexts){const o={};Y.serialize(o,b),t.executionContexts.push(o)}}static GetDataOutConnectionByUniqueId(t,b){for(const Y of t)for(const t of Y.dataOutputs)if(t.uniqueId===b)return t;throw new Error("Could not find data out connection with unique id "+b)}static GetSignalInConnectionByUniqueId(t,b){for(const Y of t)if(Y instanceof pY)for(const t of Y.signalInputs)if(t.uniqueId===b)return t;throw new Error("Could not find signal in connection with unique id "+b)}static Parse(t,b){const Y=b.coordinator.createGraph(),o=[],x=b.valueParseFunction??EY;for(const F of t.allBlocks){const t=UY.Parse(F,{Se:b.coordinator.config.Se,pathConverter:b.pathConverter,valueParseFunction:x});o.push(t),t instanceof TY&&Y.addEventBlock(t)}for(const F of o){for(const t of F.dataInputs)for(const b of t.connectedPointIds){const Y=LY.GetDataOutConnectionByUniqueId(o,b);t.connectTo(Y)}if(F instanceof pY)for(const t of F.signalOutputs)for(const b of t.connectedPointIds){const Y=LY.GetSignalInConnectionByUniqueId(o,b);t.connectTo(Y)}}for(const F of t.executionContexts)yY.Parse(F,{graph:Y,valueParseFunction:x});return Y}}class zY{constructor(t){this.config=t,this._flowGraphs=[],this._customEventsMap=new Map,this.config.Se.le.add((()=>{this.dispose()}));(zY.SceneCoordinators.get(this.config.Se)??[]).push(this)}createGraph(){const t=new LY({Se:this.config.Se,coordinator:this});return this._flowGraphs.push(t),t}removeGraph(t){const b=this._flowGraphs.indexOf(t);-1!==b&&(t.dispose(),this._flowGraphs.splice(b,1))}start(){this._flowGraphs.forEach((t=>t.start()))}dispose(){this._flowGraphs.forEach((t=>t.dispose())),this._flowGraphs.length=0;const t=zY.SceneCoordinators.get(this.config.Se)??[],b=t.indexOf(this);-1!==b&&t.splice(b,1)}serialize(t,b){t._flowGraphs=[],this._flowGraphs.forEach((Y=>{const o={};Y.serialize(o,b),t._flowGraphs.push(o)}))}static Parse(t,b){var Y;const o=b.valueParseFunction??EY,x=new zY({Se:b.Se});return null===(Y=t._flowGraphs)||void 0===Y||Y.forEach((t=>{LY.Parse(t,{coordinator:x,valueParseFunction:o,pathConverter:b.pathConverter})})),x}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(t){let b=this._customEventsMap.get(t);return b||(b=new U.e,this._customEventsMap.set(t,b)),b}notifyCustomEvent(t,b){const Y=this._customEventsMap.get(t);Y&&Y.notifyObservers(b)}}zY.SceneCoordinators=new Map;class SY extends TY{_preparePendingTasks(t){if(!t._getExecutionVariable(this,"sceneReadyObserver")){const b=t.configuration.Se.onReadyObservable.add((()=>{this._execute(t)}));t._setExecutionVariable(this,"sceneReadyObserver",b)}}_cancelPendingTasks(t){const b=t._getExecutionVariable(this,"sceneReadyObserver");t.configuration.Se.onReadyObservable.remove(b),t._deleteExecutionVariable(this,"sceneReadyObserver")}getClassName(){return SY.ClassName}}SY.ClassName="FGSceneReadyEventBlock",(0,S.d)("FGSceneReadyEventBlock",SY);class eY extends TY{_preparePendingTasks(t){if(!t._getExecutionVariable(this,"sceneBeforeRender")){const b=t.configuration.Se.onBeforeRenderObservable.add((()=>{this._execute(t)}));t._setExecutionVariable(this,"sceneBeforeRender",b)}}_cancelPendingTasks(t){const b=t._getExecutionVariable(this,"sceneBeforeRender");t.configuration.Se.onBeforeRenderObservable.remove(b),t._deleteExecutionVariable(this,"sceneBeforeRender")}getClassName(){return eY.ClassName}}eY.ClassName="FGSceneTickEventBlock",(0,S.d)(eY.ClassName,eY);class gY extends pY{constructor(t){super(t),this.out=this._registerSignalOutput("out")}}class DY extends gY{constructor(t){super(t),this.message=this.registerDataInput("message",Gb)}_execute(t){const b=this.message.getValue(t);y.b.Log(b),this.out._activateSignal(t)}getClassName(){return DY.ClassName}}DY.ClassName="FGConsoleLogBlock",(0,S.d)(DY.ClassName,DY),function(t){t[t.INIT=0]="INIT",t[t.STARTED=1]="STARTED",t[t.ENDED=2]="ENDED"}(BY||(BY={}));class HY{constructor(t){this.onEachCountObservable=new U.e,this.onTimerAbortedObservable=new U.e,this.onTimerEndedObservable=new U.e,this.onStateChangedObservable=new U.e,this._observer=null,this._breakOnNextTick=!1,this._tick=t=>{const b=Date.now();this._timer=b-this._startTime;const Y={startTime:this._startTime,currentTime:b,deltaTime:this._timer,completeRate:this._timer/this._timeToEnd,payload:t},o=this._breakOnNextTick||this._breakCondition(Y);o||this._timer>=this._timeToEnd?this._stop(Y,o):this.onEachCountObservable.notifyObservers(Y)},this._setState(0),this._contextObservable=t.contextObservable,this._observableParameters=t.observableParameters??{},this._breakCondition=t.breakCondition??(()=>!1),this._timeToEnd=t.timeout,t.onEnded&&this.onTimerEndedObservable.add(t.onEnded),t.ni&&this.onEachCountObservable.add(t.ni),t.onAborted&&this.onTimerAbortedObservable.add(t.onAborted)}set breakCondition(t){this._breakCondition=t}clearObservables(){this.onEachCountObservable.clear(),this.onTimerAbortedObservable.clear(),this.onTimerEndedObservable.clear(),this.onStateChangedObservable.clear()}start(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._timeToEnd;if(1===this._state)throw new Error("Timer already started. Please stop it before starting again");this._timeToEnd=t,this._startTime=Date.now(),this._timer=0,this._observer=this._contextObservable.add(this._tick,this._observableParameters.mask,this._observableParameters.insertFirst,this._observableParameters.scope),this._setState(1)}stop(){1===this._state&&(this._breakOnNextTick=!0)}dispose(){this._observer&&this._contextObservable.remove(this._observer),this.clearObservables()}_setState(t){this._state=t,this.onStateChangedObservable.notifyObservers(this._state)}_stop(t){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._contextObservable.remove(this._observer),this._setState(2),b?this.onTimerAbortedObservable.notifyObservers(t):this.onTimerEndedObservable.notifyObservers(t)}}class fY extends WY{constructor(t){super(t),this.timeout=this.registerDataInput("timeout",hb)}_preparePendingTasks(t){const b=this.timeout.getValue(t);if(void 0!==b&&b>=0){const Y=t._getExecutionVariable(this,"runningTimers")||[],o=t.configuration.Se,x=new HY({timeout:b,contextObservable:o.onBeforeRenderObservable,onEnded:()=>this._onEnded(x,t)});x.start(),Y.push(x),t._setExecutionVariable(this,"runningTimers",Y)}}_execute(t){this._startPendingTasks(t),this.out._activateSignal(t)}_onEnded(t,b){const Y=b._getExecutionVariable(this,"runningTimers")||[],o=Y.indexOf(t);-1!==o?Y.splice(o,1):r.f.Warn("FlowGraphTimerBlock: Timer ended but was not found in the running timers list"),b._removePendingBlock(this),this.done._activateSignal(b)}_cancelPendingTasks(t){const b=t._getExecutionVariable(this,"runningTimers")||[];for(const Y of b)Y.dispose();t._deleteExecutionVariable(this,"runningTimers")}getClassName(){return fY.ClassName}}fY.ClassName="FGTimerBlock",(0,S.d)("FGTimerBlock",fY);class nY extends gY{constructor(t){super(t),this.config=t;for(let b=0;b<this.config.eventData.length;b++){const t=this.config.eventData[b];this.registerDataInput(t,Gb)}}_execute(t){const b=this.config.eventId,Y=this.dataInputs.map((b=>b.getValue(t)));t.configuration.coordinator.notifyCustomEvent(b,Y),this.out._activateSignal(t)}getClassName(){return nY.ClassName}}nY.ClassName="FGSendCustomEventBlock",(0,S.d)("FGSendCustomEventBlock",nY);class XY extends TY{constructor(t){super(t),this.config=t;for(let b=0;b<this.config.eventData.length;b++){const t=this.config.eventData[b];this.registerDataOutput(t,Gb)}}_preparePendingTasks(t){const b=t.configuration.coordinator.getCustomEventObservable(this.config.eventId);this._eventObserver=b.add((b=>{for(let Y=0;Y<b.length;Y++)this.dataOutputs[Y].setValue(b[Y],t);this._execute(t)}))}_cancelPendingTasks(t){const b=t.configuration.coordinator.getCustomEventObservable(this.config.eventId);b?b.remove(this._eventObserver):r.f.Warn(`FlowGraphReceiveCustomEventBlock: Missing observable for event ${this.config.eventId}`)}getClassName(){return XY.ClassName}serialize(t){super.serialize(t),t.eventId=this.config.eventId,t.eventData=this.config.eventData}}XY.ClassName="FGReceiveCustomEventBlock",(0,S.d)(XY.ClassName,XY);class QY extends pY{constructor(t){super(t),this.config=t,this.outFlows=[];for(let b=0;b<this.config.numberOutputFlows;b++)this.outFlows.push(this._registerSignalOutput(`${b}`))}_execute(t){for(let b=0;b<this.config.numberOutputFlows;b++)this.outFlows[b]._activateSignal(t)}getClassName(){return QY.ClassName}}QY.ClassName="FGSequenceBlock",(0,S.d)(QY.ClassName,QY);const NY=new RegExp(/\{(\w+)\}/g);class uY{constructor(t,b){this.path=t,this.ownerBlock=b,this.templatedInputs=[];let Y=NY.exec(t);for(;Y;){const[,o]=Y;this.templatedInputs.push(b.registerDataInput(o,xY)),Y=NY.exec(t)}}getAccessor(t,b){let Y=this.path;for(const o of this.templatedInputs){const t=o.getValue(b).value;Y=Y.replace(`{${o.name}}`,t.toString())}return t.convert(Y)}}class ZY extends UY{constructor(t){super(t),this.config=t,this.value=this.registerDataOutput("value",Gb),this.templateComponent=new uY(t.path,this)}_updateOutputs(t){const b=this.templateComponent.getAccessor(this.config.pathConverter,t),Y=b.info.get(b.object);this.value.setValue(Y,t)}getClassName(){return ZY.ClassName}serialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(t),t.config.path=this.config.path}}ZY.ClassName="FGGetPropertyBlock",(0,S.d)(ZY.ClassName,ZY);class aY extends gY{constructor(t){super(t),this.config=t,this.a=this.registerDataInput("a",Gb),this.templateComponent=new uY(t.path,this)}_execute(t){const b=this.a.getValue(t),Y=this.templateComponent.getAccessor(this.config.pathConverter,t);Y.info.set(b,Y.object),this.out._activateSignal(t)}serialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(t),t.config.path=this.config.path}getClassName(){return aY.ClassName}}aY.ClassName="FGSetPropertyBlock",(0,S.d)("FGSetPropertyBlock",aY);const AY="cachedOperationValue",MY="cachedExecutionId";class wY extends UY{constructor(t,b){super(b),this.value=this.registerDataOutput("value",t)}_updateOutputs(t){const b=t._getExecutionVariable(this,MY),Y=t._getExecutionVariable(this,AY);if(void 0!==Y&&b===t.executionId)this.value.setValue(Y,t);else{const b=this._doOperation(t);t._setExecutionVariable(this,AY,b),t._setExecutionVariable(this,MY,t.executionId),this.value.setValue(b,t)}}}class cY extends wY{constructor(t,b,Y,o,x,F){super(Y,F),this._operation=o,this._className=x,this.a=this.registerDataInput("a",t),this.b=this.registerDataInput("b",b)}_doOperation(t){return this._operation(this.a.getValue(t),this.b.getValue(t))}getClassName(){return this._className}}class IY extends wY{constructor(t,b,Y,o){super(t,o),this._operation=b,this._className=Y}_doOperation(t){return this._operation()}getClassName(){return this._className}}class sY extends wY{constructor(t,b,Y,o,x){super(b,x),this._operation=Y,this._className=o,this.a=this.registerDataInput("a",t)}_doOperation(t){return this._operation(this.a.getValue(t))}getClassName(){return this._className}}class lY extends wY{constructor(t,b,Y,o,x,F,r){super(o,r),this._operation=x,this._className=F,this.a=this.registerDataInput("a",t),this.b=this.registerDataInput("b",b),this.c=this.registerDataInput("c",Y)}_doOperation(t){return this._operation(this.a.getValue(t),this.b.getValue(t),this.c.getValue(t))}getClassName(){return this._className}}function iY(t){return t.getClassName?t.getClassName():""}function VY(t,b){return"Vector2"===t&&"Vector2"===b||"ae"===t&&"ae"===b||"Vector4"===t&&"Vector4"===b}function PY(t,b){return"Matrix"===t&&"Matrix"===b}function kY(t,b){return"FlowGraphInteger"===t&&"FlowGraphInteger"===b}class qY extends cY{constructor(t){super(Gb,Gb,Gb,((t,b)=>this._polymorphicAdd(t,b)),qY.ClassName,t)}_polymorphicAdd(t,b){const Y=iY(t),o=iY(b);return VY(Y,o)||PY(Y,o)||kY(Y,o)?t.add(b):t+b}}qY.ClassName="FGAddBlock",(0,S.d)(qY.ClassName,qY);class OY extends cY{constructor(t){super(Gb,Gb,Gb,((t,b)=>this._polymorphicAdd(t,b)),OY.ClassName,t)}_polymorphicAdd(t,b){const Y=iY(t),o=iY(b);return VY(Y,o)||kY(Y,o)?t.fd(b):PY(Y,o)?t.add(b.scale(-1)):t-b}}OY.ClassName="FGSubBlock",(0,S.d)(OY.ClassName,OY);class jY extends cY{constructor(t){super(Gb,Gb,Gb,((t,b)=>this._polymorphicMultiply(t,b)),jY.ClassName,t)}_polymorphicMultiply(t,b){const Y=iY(t),o=iY(b);return VY(Y,o)||kY(Y,o)?t.multiply(b):PY(Y,o)?x.c.FromValues(t.m[0]*b.m[0],t.m[4]*b.m[4],t.m[8]*b.m[8],t.m[12]*b.m[12],t.m[1]*b.m[1],t.m[5]*b.m[5],t.m[9]*b.m[9],t.m[13]*b.m[13],t.m[2]*b.m[2],t.m[6]*b.m[6],t.m[10]*b.m[10],t.m[14]*b.m[14],t.m[3]*b.m[3],t.m[7]*b.m[7],t.m[11]*b.m[11],t.m[15]*b.m[15]):t*b}}jY.ClassName="FGMultiplyBlock",(0,S.d)(jY.ClassName,jY);class GY extends cY{constructor(t){super(Gb,Gb,Gb,((t,b)=>this._polymorphicDivide(t,b)),GY.ClassName,t)}_polymorphicDivide(t,b){const Y=iY(t),o=iY(b);return VY(Y,o)||kY(Y,o)?t.divide(b):PY(Y,o)?x.c.FromValues(t.m[0]/b.m[0],t.m[4]/b.m[4],t.m[8]/b.m[8],t.m[12]/b.m[12],t.m[1]/b.m[1],t.m[5]/b.m[5],t.m[9]/b.m[9],t.m[13]/b.m[13],t.m[2]/b.m[2],t.m[6]/b.m[6],t.m[10]/b.m[10],t.m[14]/b.m[14],t.m[3]/b.m[3],t.m[7]/b.m[7],t.m[11]/b.m[11],t.m[15]/b.m[15]):t/b}}GY.ClassName="FGDivideBlock",(0,S.d)(GY.ClassName,GY);class hY extends IY{constructor(t){super(hb,(()=>Math.random()),hY.ClassName,t)}}hY.ClassName="FGRandomBlock",(0,S.d)(hY.ClassName,hY);class to extends cY{constructor(t){super(Gb,Gb,hb,((t,b)=>this._polymorphicDot(t,b)),to.ClassName,t)}_polymorphicDot(t,b){switch(iY(t)){case"Vector2":return x.i.Dot(t,b);case"ae":return x.l.Dot(t,b);case"Vector4":return x.m.Dot(t,b);default:throw new Error(`Cannot get dot product of ${t} and ${b}`)}}}to.ClassName="FGDotBlock",(0,S.d)(to.ClassName,to);class bo extends IY{constructor(t){super(hb,(()=>Math.E),bo.ClassName,t)}}bo.ClassName="FGEBlock",(0,S.d)(bo.ClassName,bo);class Yo extends IY{constructor(t){super(hb,(()=>Math.PI),Yo.ClassName,t)}}Yo.ClassName="FGPIBlock",(0,S.d)(Yo.ClassName,Yo);class oo extends IY{constructor(t){super(hb,(()=>Number.POSITIVE_INFINITY),oo.ClassName,t)}}oo.ClassName="FGInfBlock",(0,S.d)(oo.ClassName,oo);class xo extends IY{constructor(t){super(hb,(()=>Number.NaN),xo.ClassName,t)}}function Fo(t,b){switch(iY(t)){case"FlowGraphInteger":return new Ob(b(t.value));case"Vector2":return new x.i(b(t.x),b(t.y));case"ae":return new x.l(b(t.x),b(t.y),b(t.z));case"Vector4":return new x.m(b(t.x),b(t.y),b(t.z),b(t.w));case"Matrix":return x.c.FromValues(b(t.m[0]),b(t.m[4]),b(t.m[8]),b(t.m[12]),b(t.m[1]),b(t.m[5]),b(t.m[9]),b(t.m[13]),b(t.m[2]),b(t.m[6]),b(t.m[10]),b(t.m[14]),b(t.m[3]),b(t.m[7]),b(t.m[11]),b(t.m[15]));default:return b(t)}}xo.ClassName="FGNaNBlock",(0,S.d)(xo.ClassName,xo);class ro extends sY{constructor(t){super(Gb,Gb,(t=>this._polymorphicAbs(t)),ro.ClassName,t)}_polymorphicAbs(t){return Fo(t,Math.abs)}}ro.ClassName="FGAbsBlock",(0,S.d)(ro.ClassName,ro);class Ro extends sY{constructor(t){super(Gb,Gb,(t=>this._polymorphicSign(t)),Ro.ClassName,t)}_polymorphicSign(t){return Fo(t,Math.sign)}}Ro.ClassName="FGSignBlock",(0,S.d)(Ro.ClassName,Ro);class Eo extends sY{constructor(t){super(Gb,Gb,(t=>this._polymorphicTrunc(t)),Eo.ClassName,t)}_polymorphicTrunc(t){return Fo(t,Math.trunc)}}Eo.ClassName="FGTruncBlock",(0,S.d)(Eo.ClassName,Eo);class Uo extends sY{constructor(t){super(Gb,Gb,(t=>this._polymorphicFloor(t)),Uo.ClassName,t)}_polymorphicFloor(t){return Fo(t,Math.floor)}}Uo.ClassName="FGFloorBlock",(0,S.d)(Uo.ClassName,Uo);class Co extends sY{constructor(t){super(Gb,Gb,(t=>this._polymorphicCeiling(t)),Co.ClassName,t)}_polymorphicCeiling(t){return Fo(t,Math.ceil)}}Co.ClassName="FGCeilBlock",(0,S.d)(Co.ClassName,Co);class po extends sY{constructor(t){super(Gb,Gb,(t=>this._polymorphicFract(t)),po.ClassName,t)}_polymorphicFract(t){return Fo(t,(t=>t-Math.floor(t)))}}po.ClassName="FGFractBlock",(0,S.d)(po.ClassName,po);class Wo extends sY{constructor(t){super(Gb,Gb,(t=>this._polymorphicNeg(t)),Wo.ClassName,t)}_polymorphicNeg(t){return Fo(t,(t=>-t))}}function To(t,b,Y){switch(iY(t)){case"FlowGraphInteger":return new Ob(Y(t.value,b.value));case"Vector2":return new x.i(Y(t.x,b.x),Y(t.y,b.y));case"ae":return new x.l(Y(t.x,b.x),Y(t.y,b.y),Y(t.z,b.z));case"Vector4":return new x.m(Y(t.x,b.x),Y(t.y,b.y),Y(t.z,b.z),Y(t.w,b.w));case"Matrix":return x.c.FromValues(Y(t.m[0],b.m[0]),Y(t.m[4],b.m[4]),Y(t.m[8],b.m[8]),Y(t.m[12],b.m[12]),Y(t.m[1],b.m[1]),Y(t.m[5],b.m[5]),Y(t.m[9],b.m[9]),Y(t.m[13],b.m[13]),Y(t.m[2],b.m[2]),Y(t.m[6],b.m[6]),Y(t.m[10],b.m[10]),Y(t.m[14],b.m[14]),Y(t.m[3],b.m[3]),Y(t.m[7],b.m[7]),Y(t.m[11],b.m[11]),Y(t.m[15],b.m[15]));default:return Y(t,b)}}Wo.ClassName="FGNegBlock",(0,S.d)(Wo.ClassName,Wo);class yo extends cY{constructor(t){super(Gb,Gb,Gb,((t,b)=>this._polymorphicRemainder(t,b)),yo.ClassName,t)}_polymorphicRemainder(t,b){return To(t,b,((t,b)=>t%b))}}yo.ClassName="FGRemainderBlock",(0,S.d)(yo.ClassName,yo);class vo extends cY{constructor(t){super(Gb,Gb,Gb,((t,b)=>this._polymorphicMin(t,b)),vo.ClassName,t)}_polymorphicMin(t,b){return To(t,b,Math.min)}}vo.ClassName="FGMinBlock",(0,S.d)(vo.ClassName,vo);class Bo extends cY{constructor(t){super(Gb,Gb,Gb,((t,b)=>this._polymorphicMax(t,b)),Bo.ClassName,t)}_polymorphicMax(t,b){return To(t,b,Math.max)}}function Jo(t,b,Y){return Math.min(Math.max(t,Math.min(b,Y)),Math.max(b,Y))}function mo(t,b,Y,o){switch(iY(t)){case"FlowGraphInteger":return new Ob(o(t.value,b.value,Y.value));case"Vector2":return new x.i(o(t.x,b.x,Y.x),o(t.y,b.y,Y.y));case"ae":return new x.l(o(t.x,b.x,Y.x),o(t.y,b.y,Y.y),o(t.z,b.z,Y.z));case"Vector4":return new x.m(o(t.x,b.x,Y.x),o(t.y,b.y,Y.y),o(t.z,b.z,Y.z),o(t.w,b.w,Y.w));case"Matrix":return x.c.FromValues(o(t.m[0],b.m[0],Y.m[0]),o(t.m[4],b.m[4],Y.m[4]),o(t.m[8],b.m[8],Y.m[8]),o(t.m[12],b.m[12],Y.m[12]),o(t.m[1],b.m[1],Y.m[1]),o(t.m[5],b.m[5],Y.m[5]),o(t.m[9],b.m[9],Y.m[9]),o(t.m[13],b.m[13],Y.m[13]),o(t.m[2],b.m[2],Y.m[2]),o(t.m[6],b.m[6],Y.m[6]),o(t.m[10],b.m[10],Y.m[10]),o(t.m[14],b.m[14],Y.m[14]),o(t.m[3],b.m[3],Y.m[3]),o(t.m[7],b.m[7],Y.m[7]),o(t.m[11],b.m[11],Y.m[11]),o(t.m[15],b.m[15],Y.m[15]));default:return o(t,b,Y)}}Bo.ClassName="FGMaxBlock",(0,S.d)(Bo.ClassName,Bo);class Ko extends lY{constructor(t){super(Gb,Gb,Gb,Gb,((t,b,Y)=>this._polymorphicClamp(t,b,Y)),Ko.ClassName,t)}_polymorphicClamp(t,b,Y){return mo(t,b,Y,Jo)}}function Lo(t){return Math.min(Math.max(t,0),1)}Ko.ClassName="FGClampBlock",(0,S.d)(Ko.ClassName,Ko);class zo extends sY{constructor(t){super(Gb,Gb,(t=>this._polymorphicSaturate(t)),zo.ClassName,t)}_polymorphicSaturate(t){return Fo(t,Lo)}}zo.ClassName="FGSaturateBlock",(0,S.d)(zo.ClassName,zo);class So extends lY{constructor(t){super(Gb,Gb,Gb,Gb,((t,b,Y)=>this._polymorphicInterpolate(t,b,Y)),So.ClassName,t)}_interpolate(t,b,Y){return(1-Y)*t+Y*b}_polymorphicInterpolate(t,b,Y){return mo(t,b,Y,this._interpolate)}}So.ClassName="FGInterpolateBlock",(0,S.d)(So.ClassName,So);class eo extends cY{constructor(t){super(Gb,Gb,tY,((t,b)=>this._polymorphicEq(t,b)),eo.ClassName,t)}_polymorphicEq(t,b){const Y=iY(t),o=iY(b);return VY(Y,o)||PY(Y,o)||kY(Y,o)?t.equals(b):t===b}}function go(t,b,Y){const o=iY(t);if(o===iY(b)){if(""===o)return Y(t,b);if("FlowGraphInteger"===o)return Y(t.value,b.value);throw new Error(`Cannot compare ${t} and ${b}`)}throw new Error(`${t} and ${b} are of different types.`)}eo.ClassName="FGEqBlock",(0,S.d)(eo.ClassName,eo);class Do extends cY{constructor(t){super(Gb,Gb,tY,((t,b)=>this._polymorphicLessThan(t,b)),Do.ClassName,t)}_polymorphicLessThan(t,b){return go(t,b,((t,b)=>t<b))}}Do.ClassName="FGLessThanBlock",(0,S.d)(Do.ClassName,Do);class Ho extends cY{constructor(t){super(Gb,Gb,tY,((t,b)=>this._polymorphicLessThanOrEqual(t,b)),Ho.ClassName,t)}_polymorphicLessThanOrEqual(t,b){return go(t,b,((t,b)=>t<=b))}}Ho.ClassName="FGLessThanOrEqualBlock";class fo extends cY{constructor(t){super(Gb,Gb,tY,((t,b)=>this._polymorphicGreaterThan(t,b)),fo.ClassName,t)}_polymorphicGreaterThan(t,b){return go(t,b,((t,b)=>t>b))}}fo.ClassName="FGGreaterThanBlock",(0,S.d)(fo.ClassName,fo);class no extends cY{constructor(t){super(Gb,Gb,tY,((t,b)=>this._polymorphicGreaterThanOrEqual(t,b)),no.ClassName,t)}_polymorphicGreaterThanOrEqual(t,b){return go(t,b,((t,b)=>t>=b))}}no.ClassName="FGGreaterThanOrEqualBlock",(0,S.d)(no.ClassName,no);class Xo extends sY{constructor(t){super(Gb,tY,(t=>this._polymorphicIsNan(t)),Xo.ClassName,t)}_polymorphicIsNan(t){const b=iY(t);if(""===b)return isNaN(t);if("FlowGraphInteger"===b)return isNaN(t.value);throw new Error(`Cannot get NaN of ${t}`)}}Xo.ClassName="FGIsNanBlock",(0,S.d)(Xo.ClassName,Xo);class Qo extends sY{constructor(t){super(Gb,tY,(t=>this._polymorphicIsInf(t)),Qo.ClassName,t)}_polymorphicIsInf(t){const b=iY(t);if(""===b)return!isFinite(t);if("FlowGraphInteger"===b)return!isFinite(t.value);throw new Error(`Cannot get isInf of ${t}`)}}Qo.ClassName="FGIsInfBlock";class No extends sY{constructor(t){super(Gb,Gb,(t=>this._polymorphicDegToRad(t)),No.ClassName,t)}_degToRad(t){return t*Math.PI/180}_polymorphicDegToRad(t){return Fo(t,this._degToRad)}}No.ClassName="FGDegToRadBlock",(0,S.d)(No.ClassName,No);class uo extends sY{constructor(t){super(Gb,Gb,(t=>this._polymorphicRadToDeg(t)),uo.ClassName,t)}_radToDeg(t){return 180*t/Math.PI}_polymorphicRadToDeg(t){return Fo(t,this._radToDeg)}}uo.ClassName="FGRadToDegBlock",(0,S.d)(uo.ClassName,uo);class Zo extends sY{constructor(t){super(Gb,Gb,(t=>this._polymorphicSin(t)),Zo.ClassName,t)}_polymorphicSin(t){return Fo(t,Math.sin)}}Zo.ClassName="FGSinBlock",(0,S.d)(Zo.ClassName,Zo);class ao extends sY{constructor(t){super(Gb,Gb,(t=>this._polymorphicCos(t)),ao.ClassName,t)}_polymorphicCos(t){return Fo(t,Math.cos)}}ao.ClassName="FGCosBlock",(0,S.d)(ao.ClassName,ao);class Ao extends sY{constructor(t){super(Gb,Gb,(t=>this._polymorphicTan(t)),Ao.ClassName,t)}_polymorphicTan(t){return Fo(t,Math.tan)}}Ao.ClassName="FGTanBlock",(0,S.d)(Ao.ClassName,Ao);class Mo extends sY{constructor(t){super(Gb,Gb,(t=>this._polymorphicAsin(t)),Mo.ClassName,t)}_polymorphicAsin(t){return Fo(t,Math.asin)}}Mo.ClassName="FGAsinBlock",(0,S.d)(Mo.ClassName,Mo);class wo extends sY{constructor(t){super(Gb,Gb,(t=>this._polymorphicAcos(t)),wo.ClassName,t)}_polymorphicAcos(t){return Fo(t,Math.acos)}}wo.ClassName="FGAcosBlock",(0,S.d)(wo.ClassName,wo);class co extends sY{constructor(t){super(Gb,Gb,(t=>this._polymorphicAtan(t)),co.ClassName,t)}_polymorphicAtan(t){return Fo(t,Math.atan)}}co.ClassName="FGAtanBlock",(0,S.d)(co.ClassName,co);class Io extends cY{constructor(t){super(Gb,Gb,Gb,((t,b)=>this._polymorphicAtan2(t,b)),Io.ClassName,t)}_polymorphicAtan2(t,b){return To(t,b,Math.atan2)}}Io.ClassName="FGAtan2Block",(0,S.d)(Io.ClassName,Io);class so extends sY{constructor(t){super(Gb,Gb,(t=>this._polymorphicSinh(t)),so.ClassName,t)}_polymorphicSinh(t){return Fo(t,Math.sinh)}}so.ClassName="FGSinhBlock",(0,S.d)(so.ClassName,so);class lo extends sY{constructor(t){super(Gb,Gb,(t=>this._polymorphicCosh(t)),lo.ClassName,t)}_polymorphicCosh(t){return Fo(t,Math.cosh)}}lo.ClassName="FGCoshBlock",(0,S.d)(lo.ClassName,lo);class io extends sY{constructor(t){super(Gb,Gb,(t=>this._polymorphicTanh(t)),io.ClassName,t)}_polymorphicTanh(t){return Fo(t,Math.tanh)}}io.ClassName="FGTanhBlock",(0,S.d)(io.ClassName,io);class Vo extends sY{constructor(t){super(Gb,hb,(t=>this._polymorphicAsinh(t)),Vo.ClassName,t)}_polymorphicAsinh(t){return Fo(t,Math.asinh)}}Vo.ClassName="FGAsinhBlock",(0,S.d)(Vo.ClassName,Vo);class Po extends sY{constructor(t){super(Gb,hb,(t=>this._polymorphicAcosh(t)),Po.ClassName,t)}_polymorphicAcosh(t){return Fo(t,Math.acosh)}}Po.ClassName="FGAcoshBlock",(0,S.d)(Po.ClassName,Po);class ko extends sY{constructor(t){super(Gb,hb,(t=>this._polymorphicAtanh(t)),ko.ClassName,t)}_polymorphicAtanh(t){return Fo(t,Math.atanh)}}ko.ClassName="FGAtanhBlock",(0,S.d)(ko.ClassName,ko);class qo extends sY{constructor(t){super(Gb,hb,(t=>this._polymorphicExp(t)),qo.ClassName,t)}_polymorphicExp(t){return Fo(t,Math.exp)}}qo.ClassName="FGExpBlock",(0,S.d)(qo.ClassName,qo);class Oo extends sY{constructor(t){super(Gb,hb,(t=>this._polymorphicLog(t)),Oo.ClassName,t)}_polymorphicLog(t){return Fo(t,Math.log)}}Oo.ClassName="FGLogBlock",(0,S.d)(Oo.ClassName,Oo);class jo extends sY{constructor(t){super(Gb,hb,(t=>this._polymorphicLog2(t)),jo.ClassName,t)}_polymorphicLog2(t){return Fo(t,Math.log2)}}jo.ClassName="FGLog2Block",(0,S.d)(jo.ClassName,jo);class Go extends sY{constructor(t){super(Gb,hb,(t=>this._polymorphicLog10(t)),Go.ClassName,t)}_polymorphicLog10(t){return Fo(t,Math.log10)}}Go.ClassName="FGLog10Block",(0,S.d)(Go.ClassName,Go);class ho extends sY{constructor(t){super(Gb,hb,(t=>this._polymorphicSqrt(t)),ho.ClassName,t)}_polymorphicSqrt(t){return Fo(t,Math.sqrt)}}ho.ClassName="FGSqrtBlock",(0,S.d)(ho.ClassName,ho);class tx extends sY{constructor(t){super(Gb,hb,(t=>this._polymorphicCubeRoot(t)),tx.ClassName,t)}_polymorphicCubeRoot(t){return Fo(t,Math.cbrt)}}tx.ClassName="FGCubeRootBlock",(0,S.d)(tx.ClassName,tx);class bx extends cY{constructor(t){super(Gb,hb,hb,((t,b)=>this._polymorphicPow(t,b)),bx.ClassName,t)}_polymorphicPow(t,b){return To(t,b,Math.pow)}}bx.ClassName="FGPowBlock",(0,S.d)(bx.ClassName,bx);class Yx extends sY{constructor(t){super(Gb,hb,(t=>this._polymorphicLength(t)),Yx.ClassName,t)}_polymorphicLength(t){switch(iY(t)){case"Vector2":case"ae":case"Vector4":return t.length();default:throw new Error(`Cannot compute length of value ${t}`)}}}Yx.ClassName="FGLengthBlock",(0,S.d)(Yx.ClassName,Yx);class ox extends sY{constructor(t){super(Gb,Gb,(t=>this._polymorphicNormalize(t)),ox.ClassName,t)}_polymorphicNormalize(t){switch(iY(t)){case"Vector2":case"ae":case"Vector4":return t.normalize();default:throw new Error(`Cannot normalize value ${t}`)}}}ox.ClassName="FGNormalizeBlock",(0,S.d)(ox.ClassName,ox);class xx extends cY{constructor(t){super(YY,YY,YY,((t,b)=>x.l.Cross(t,b)),xx.ClassName,t)}}xx.ClassName="FGCrossBlock",(0,S.d)(xx.ClassName,xx);class Fx extends cY{constructor(t){super(bY,hb,bY,((t,b)=>x.i.Transform(t,x.c.RotationZ(b))),Fx.ClassName,t)}}Fx.ClassName="FGRotate2DBlock",(0,S.d)(Fx.ClassName,Fx);class rx extends lY{constructor(t){super(YY,YY,hb,YY,((t,b,Y)=>x.l.TransformCoordinates(t,x.c.RotationAxis(b,Y))),rx.ClassName,t)}}rx.ClassName="FGRotate3DBlock",(0,S.d)(rx.ClassName,rx);class Rx extends sY{constructor(t){super(oY,oY,(t=>x.c.Transpose(t)),Rx.ClassName,t)}}Rx.ClassName="FGTransposeBlock",(0,S.d)(Rx.ClassName,Rx);class dx extends sY{constructor(t){super(oY,hb,(t=>t.determinant()),dx.ClassName,t)}}dx.ClassName="FGDeterminantBlock",(0,S.d)(dx.ClassName,dx);class Ex extends sY{constructor(t){super(oY,oY,(t=>x.c.Invert(t)),Ex.ClassName,t)}}Ex.ClassName="FGInvertMatrixBlock",(0,S.d)(Ex.ClassName,Ex);class Ux extends cY{constructor(t){super(oY,oY,oY,((t,b)=>b.multiply(t)),Ux.ClassName,t)}}Ux.ClassName="FGMatMulBlock",(0,S.d)(Ux.ClassName,Ux);class Cx extends sY{constructor(t){super(xY,xY,(t=>new Ob(~t.value)),Cx.ClassName,t)}}Cx.ClassName="FGBitwiseNotBlock",(0,S.d)(Cx.ClassName,Cx);class px extends cY{constructor(t){super(xY,xY,xY,((t,b)=>new Ob(t.value&b.value)),px.ClassName,t)}}px.ClassName="FGBitwiseAndBlock",(0,S.d)(px.ClassName,px);class Wx extends cY{constructor(t){super(xY,xY,xY,((t,b)=>new Ob(t.value|b.value)),Wx.ClassName,t)}}Wx.ClassName="FGBitwiseOrBlock",(0,S.d)(Wx.ClassName,Wx);class Tx extends cY{constructor(t){super(xY,xY,xY,((t,b)=>new Ob(t.value^b.value)),Tx.ClassName,t)}}Tx.ClassName="FGBitwiseXorBlock",(0,S.d)(Tx.ClassName,Tx);class yx extends cY{constructor(t){super(xY,xY,xY,((t,b)=>new Ob(t.value<<b.value)),yx.ClassName,t)}}yx.ClassName="FGBitwiseLeftShiftBlock",(0,S.d)(yx.ClassName,yx);class vx extends cY{constructor(t){super(xY,xY,xY,((t,b)=>new Ob(t.value>>b.value)),vx.ClassName,t)}}vx.ClassName="FGBitwiseRightShiftBlock",(0,S.d)(vx.ClassName,vx);class Bx extends sY{constructor(t){super(xY,xY,(t=>new Ob(Math.clz32(t.value))),Bx.ClassName,t)}}Bx.ClassName="FGCountLeadingZerosBlock",(0,S.d)(Bx.ClassName,Bx);class Jx extends sY{constructor(t){super(xY,xY,(t=>new Ob(t.value?31-Math.clz32(t.value&-t.value):32)),Jx.ClassName,t)}}Jx.ClassName="FGCountTrailingZerosBlock",(0,S.d)(Jx.ClassName,Jx);class mx extends sY{constructor(t){super(xY,xY,(t=>new Ob(function(t){let b=0;for(;t;)b+=1&t,t>>=1;return b}(t.value))),mx.ClassName,t)}}mx.ClassName="FGCountOneBitsBlock",(0,S.d)(mx.ClassName,mx);class Kx extends gY{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{startIndex:new Ob(0)};super(t),this.config=t,this.reset=this._registerSignalInput("reset"),this.n=this.registerDataInput("n",xY),this.value=this.registerDataOutput("value",xY)}_execute(t,b){if(b===this.reset)this.value.setValue(this.config.startIndex,t);else{const b=this.value.getValue(t);b.value<this.n.getValue(t).value&&(this.value.setValue(new Ob(b.value+1),t),this.out._activateSignal(t))}}getClassName(){return Kx.ClassName}}Kx.ClassName="FGDoNBlock",(0,S.d)(Kx.ClassName,Kx);class Lx extends UY{constructor(t){super(t),this.config=t,this.output=this.registerDataOutput(t.variableName,Gb)}_updateOutputs(t){const b=this.config.variableName;t.hasVariable(b)&&this.output.setValue(t.getVariable(b),t)}getClassName(){return Lx.ClassName}serialize(t){super.serialize(t),t.config.variableName=this.config.variableName}}Lx.ClassName="FGGetVariableBlock",(0,S.d)(Lx.ClassName,Lx);class zx extends gY{constructor(t){super(t),this.config=t,this.input=this.registerDataInput(t.variableName,Gb)}_execute(t){const b=this.config.variableName,Y=this.input.getValue(t);t.setVariable(b,Y),this.out._activateSignal(t)}getClassName(){return zx.ClassName}}zx.ClassName="FGSetVariableBlock",(0,S.d)(zx.ClassName,zx);class Sx extends gY{constructor(t){super(t),this.config=t,this.condition=this.registerDataInput("condition",tY),this.loopBody=this._registerSignalOutput("loopBody")}_execute(t,b){var Y;let o=this.condition.getValue(t);for(null!==(Y=this.config)&&void 0!==Y&&Y.isDo&&!o&&this.loopBody._activateSignal(t);o;)this.loopBody._activateSignal(t),o=this.condition.getValue(t);this.out._activateSignal(t)}getClassName(){return Sx.ClassName}serialize(t){var b;super.serialize(t),t.isDo=null===(b=this.config)||void 0===b?void 0:b.isDo}}Sx.ClassName="FGWhileLoopBlock",(0,S.d)(Sx.ClassName,Sx);const ex={"lifecycle/onStart":SY.ClassName,"lifecycle/onTick":eY.ClassName,log:DY.ClassName,"flow/delay":fY.ClassName,"customEvent/send":nY.ClassName,"customEvent/receive":XY.ClassName,"flow/sequence":QY.ClassName,"world/get":ZY.ClassName,"world/set":aY.ClassName,"flow/doN":Kx.ClassName,"variable/get":Lx.ClassName,"variable/set":zx.ClassName,"flow/whileLoop":Sx.ClassName,"math/random":hY.ClassName,"math/e":bo.ClassName,"math/pi":Yo.ClassName,"math/inf":oo.ClassName,"math/nan":xo.ClassName,"math/abs":ro.ClassName,"math/sign":Ro.ClassName,"math/trunc":Eo.ClassName,"math/floor":Uo.ClassName,"math/ceil":Co.ClassName,"math/fract":po.ClassName,"math/neg":Wo.ClassName,"math/add":qY.ClassName,"math/sub":OY.ClassName,"math/mul":jY.ClassName,"math/div":GY.ClassName,"math/rem":yo.ClassName,"math/min":vo.ClassName,"math/max":Bo.ClassName,"math/clamp":Ko.ClassName,"math/saturate":zo.ClassName,"math/mix":So.ClassName,"math/eq":eo.ClassName,"math/lt":Do.ClassName,"math/le":Ho.ClassName,"math/gt":fo.ClassName,"math/ge":no.ClassName,"math/isnan":Xo.ClassName,"math/isinf":Qo.ClassName,"math/rad":No.ClassName,"math/deg":uo.ClassName,"math/sin":Zo.ClassName,"math/cos":ao.ClassName,"math/tan":Ao.ClassName,"math/asin":Mo.ClassName,"math/acos":wo.ClassName,"math/atan":co.ClassName,"math/atan2":Io.ClassName,"math/sinh":so.ClassName,"math/cosh":lo.ClassName,"math/tanh":io.ClassName,"math/asinh":Vo.ClassName,"math/acosh":Po.ClassName,"math/atanh":ko.ClassName,"math/exp":qo.ClassName,"math/log":Oo.ClassName,"math/log2":jo.ClassName,"math/log10":Go.ClassName,"math/sqrt":ho.ClassName,"math/cbrt":tx.ClassName,"math/pow":bx.ClassName,"math/length":Yx.ClassName,"math/normalize":ox.ClassName,"math/dot":to.ClassName,"math/cross":xx.ClassName,"math/rotate2d":Fx.ClassName,"math/rotate3d":rx.ClassName,"math/transpose":Rx.ClassName,"math/determinant":dx.ClassName,"math/inverse":Ex.ClassName,"math/matmul":Ux.ClassName,"math/not":Cx.ClassName,"math/and":px.ClassName,"math/or":Wx.ClassName,"math/xor":Tx.ClassName,"math/asr":vx.ClassName,"math/lsl":yx.ClassName,"math/clz":Bx.ClassName,"math/ctz":Jx.ClassName,"math/popcnt":mx.ClassName},gx={float2:"Vector2",float3:"ae",float4:"Vector4",float4x4:"Matrix",int:"FlowGraphInteger"};function Dx(t,b,Y){if(void 0!==t.type){const o=b.types&&b.types[t.type];if(!o)throw new Error(`${Y}: Unknown type: ${t.type}`);const x=o.signature;if(!x)throw new Error(`${Y}: Type ${t.type} has no signature`);const F=gx[x];return{value:t.value,className:F}}return t.value}function Hx(t,b,Y){const o=ex[b.type];if(!o)throw new Error(`/extensions/KHR_interactivity/nodes/${t}: Unknown block type: ${b.type}`);const x=t.toString(),F=function(t,b,Y){const o={},x=t.configuration??[];for(const F of x)if("customEvent"===F.id){const t=b.customEvents&&b.customEvents[F.value];if(!t)throw new Error(`/extensions/KHR_interactivity/nodes/${Y}: Unknown custom event: ${F.value}`);o.eventId=t.id,o.eventData=t.values.map((t=>t.id))}else if("variable"===F.id){const t=b.variables&&b.variables[F.value];if(!t)throw new Error(`/extensions/KHR_interactivity/nodes/${Y}: Unknown variable: ${F.value}`);o.variableName=t.id}else if("path"===F.id){const t=F.value;o.path=t}else o[F.id]=Dx(F,b,`/extensions/KHR_interactivity/nodes/${Y}`);return o}(b,Y,x);return{className:o,config:F,uniqueId:x,metadata:b.metadata,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[]}}class fx extends Sb{constructor(t){super(t,Xx)}}const nx={__array__:{__target__:!0,translation:{type:"ae",get:t=>t._babylonTransformNode.position,set:(t,b)=>{b._babylonTransformNode.position=t},getObject:t=>t._babylonTransformNode}}},Xx={nodes:nx},Qx="KHR_interactivity";class Nx{constructor(t){this._loader=t,this.name=Qx,this.enabled=this._loader.isExtensionUsed(Qx),this._pathConverter=new fx(this._loader.Wi)}dispose(){this._loader=null,delete this._pathConverter}onReady(){var t;if(!this._loader.babylonScene||!this._pathConverter)return;const b=this._loader.babylonScene,Y=function(t){const b={uniqueId:(0,kb.c)(),_userVariables:{},_connectionValues:{}},Y=[b],o=[];for(let F=0;F<t.nodes.length;F++){const b=Hx(F,t.nodes[F],t);o.push(b)}for(let F=0;F<t.nodes.length;F++){const Y=t.nodes[F],x=o[F],r=Y.flows??[];for(const t of r){const b=t.id,Y={uniqueId:(0,kb.c)(),name:b,_connectionType:1,connectedPointIds:[]};x.signalOutputs.push(Y);const r=t.node,R=t.socket,d=o[r];if(!d)throw new Error(`/extensions/KHR_interactivity/nodes/${F}: Could not find node with id ${r} that connects its input with with node ${F}'s output ${b}`);let E=d.signalInputs.find((t=>t.name===R));E||(E={uniqueId:(0,kb.c)(),name:R,_connectionType:0,connectedPointIds:[]},d.signalInputs.push(E)),E.connectedPointIds.push(Y.uniqueId),Y.connectedPointIds.push(E.uniqueId)}const R=Y.values??[];for(const d of R){const Y=d.id,r={uniqueId:(0,kb.c)(),name:Y,_connectionType:0,connectedPointIds:[]};if(x.dataInputs.push(r),void 0!==d.value){const Y=Dx(d,t,`/extensions/KHR_interactivity/nodes/${F}`);b._connectionValues[r.uniqueId]=Y}else{if(void 0===d.node||void 0===d.socket)throw new Error(`/extensions/KHR_interactivity/nodes/${F}: Invalid socket ${Y} in node ${F}`);{const t=d.node,b=d.socket,x=o[t];if(!x)throw new Error(`/extensions/KHR_interactivity/nodes/${F}: Could not find node with id ${t} that connects its output with node${F}'s input ${Y}`);let R=x.dataOutputs.find((t=>t.name===b));R||(R={uniqueId:(0,kb.c)(),name:b,_connectionType:1,connectedPointIds:[]},x.dataOutputs.push(R)),r.connectedPointIds.push(R.uniqueId),R.connectedPointIds.push(r.uniqueId)}}}}const x=t.variables??[];for(let F=0;F<x.length;F++){const Y=x[F],o=Y.id;b._userVariables[o]=Dx(Y,t,`/extensions/KHR_interactivity/variables/${F}`)}return{allBlocks:o,executionContexts:Y}}(null===(t=this._loader.Wi.extensions)||void 0===t?void 0:t.KHR_interactivity),o=new zY({Se:b});LY.Parse(Y,{coordinator:o,pathConverter:this._pathConverter}),o.start()}}k(Qx),P(Qx,!0,(t=>new Nx(t)));const ux="KHR_node_visibility";class Zx{constructor(t){this.name=ux,this._loader=t,this.enabled=t.isExtensionUsed(ux)}async onReady(){var t;null===(t=this._loader.Wi.nodes)||void 0===t||t.forEach((t=>{var b,Y,o,x;(null===(b=t._primitiveBabylonMeshes)||void 0===b||b.forEach((t=>{t.inheritVisibility=!0})),null!==(Y=t.extensions)&&void 0!==Y&&Y.KHR_node_visibility)&&(!1===(null===(o=t.extensions)||void 0===o?void 0:o.KHR_node_visibility.visible)&&(t._babylonTransformNode&&(t._babylonTransformNode.isVisible=!1),null===(x=t._primitiveBabylonMeshes)||void 0===x||x.forEach((t=>{t.isVisible=!1}))))}))}dispose(){this._loader=null}}k(ux),P(ux,!0,(t=>new Zx(t)));const ax="ExtrasAsMetadata";class Ax{_assignExtras(t,b){if(b.extras&&Object.keys(b.extras).length>0){const Y=t.metadata=t.metadata||{};(Y.Wi=Y.Wi||{}).extras=b.extras}}constructor(t){this.name=ax,this.enabled=!0,this._loader=t}dispose(){this._loader=null}loadNodeAsync(t,b,Y){return this._loader.loadNodeAsync(t,b,(t=>{this._assignExtras(t,b),Y(t)}))}loadCameraAsync(t,b,Y){return this._loader.loadCameraAsync(t,b,(t=>{this._assignExtras(t,b),Y(t)}))}createMaterial(t,b,Y){const o=this._loader.createMaterial(t,b,Y);return this._assignExtras(o,b),o}}k(ax),P(ax,!1,(t=>new Ax(t)))},12352:(t,b,Y)=>{"use strict";Y.d(b,{d:()=>X,g:()=>e,k:()=>S,m:()=>g});var o=Y(1013),x=Y(1265),F=Y(11837),r=Y(11737),R=Y(11790),d=Y(11781),E=Y(1144),U=Y(1051),C=Y(12359),p=Y(12365),W=Y(11750);class T{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.ue=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.bf=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(t){this._environmentTexture=t}getNodes(){let t=[];return t=t.concat(this.meshes),t=t.concat(this.lights),t=t.concat(this.cameras),t=t.concat(this.transformNodes),this.skeletons.forEach((b=>t=t.concat(b.bones))),t}}class y extends T{}class v{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){this.rootNodes.slice(0).forEach((t=>{t.dispose()})),this.rootNodes.length=0,this.skeletons.slice(0).forEach((t=>{t.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((t=>{t.dispose()})),this.animationGroups.length=0}}class B extends T{constructor(t){super(),this._wasAddedToScene=!1,(t=t||U.d.LastCreatedScene)&&(this.Se=t,this.proceduralTextures=[],t.le.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=t.getEngine().onContextRestoredObservable.add((()=>{for(const t of this.geometries)t._rebuild();for(const t of this.meshes)t._rebuild();for(const t of this.ue)t.rebuild();for(const t of this.textures)t._rebuild()})))}_topologicalSort(t){const b=new Map;for(const r of t)b.set(r.uniqueId,r);const Y={dependsOn:new Map,dependedBy:new Map};for(const r of t){const t=r.uniqueId;Y.dependsOn.set(t,new Set),Y.dependedBy.set(t,new Set)}for(const r of t){const t=r.uniqueId,o=Y.dependsOn.get(t);if(r instanceof C.c){const x=r.sourceMesh;b.has(x.uniqueId)&&(o.add(x.uniqueId),Y.dependedBy.get(x.uniqueId).add(t))}const x=Y.dependedBy.get(t);for(const F of r.getDescendants()){const o=F.uniqueId;if(b.has(o)){x.add(o);Y.dependsOn.get(o).add(t)}}}const o=[],x=[];for(const r of t){const t=r.uniqueId;0===Y.dependsOn.get(t).size&&(x.push(r),b.delete(t))}const F=x;for(;F.length>0;){const t=F.shift();o.push(t);const x=Y.dependedBy.get(t.uniqueId);for(const o of Array.from(x.values())){const x=Y.dependsOn.get(o);x.delete(t.uniqueId),0===x.size&&b.get(o)&&(F.push(b.get(o)),b.delete(o))}}return b.size>0&&(E.b.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),b.forEach((t=>E.b.Error(t.name)))),o}_addNodeAndDescendantsToList(t,b,Y,o){if(Y&&(!o||o(Y))&&!b.has(Y.uniqueId)){t.push(Y),b.add(Y.uniqueId);for(const x of Y.getDescendants(!0))this._addNodeAndDescendantsToList(t,b,x,o)}}_isNodeInContainer(t){return t instanceof d.b&&-1!==this.meshes.indexOf(t)||(t instanceof R.d&&-1!==this.transformNodes.indexOf(t)||(t instanceof p.c&&-1!==this.lights.indexOf(t)||t instanceof W.b&&-1!==this.cameras.indexOf(t)))}_isValidHierarchy(){for(const t of this.meshes)if(t.parent&&!this._isNodeInContainer(t.parent))return E.b.Warn(`Node ${t.name} has a parent that is not in the container.`),!1;for(const t of this.transformNodes)if(t.parent&&!this._isNodeInContainer(t.parent))return E.b.Warn(`Node ${t.name} has a parent that is not in the container.`),!1;for(const t of this.lights)if(t.parent&&!this._isNodeInContainer(t.parent))return E.b.Warn(`Node ${t.name} has a parent that is not in the container.`),!1;for(const t of this.cameras)if(t.parent&&!this._isNodeInContainer(t.parent))return E.b.Warn(`Node ${t.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(t){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||x.f.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const o={},F={},R=new v,d=[],E=[],U={doNotInstantiate:!0,...Y},C=[],p=new Set;for(const x of this.transformNodes)null===x.parent&&this._addNodeAndDescendantsToList(C,p,x,U.predicate);for(const x of this.meshes)null===x.parent&&this._addNodeAndDescendantsToList(C,p,x,U.predicate);const W=this._topologicalSort(C),T=(Y,x)=>{if(((b,Y)=>{if(o[b.uniqueId]=Y.uniqueId,F[Y.uniqueId]=Y,t&&(Y.name=t(b.name)),Y instanceof r.d){const t=Y;if(t.morphTargetManager){const Y=b.morphTargetManager;t.morphTargetManager=Y.clone();for(let b=0;b<Y.numTargets;b++){const x=Y.getTarget(b),r=t.morphTargetManager.getTarget(b);o[x.uniqueId]=r.uniqueId,F[r.uniqueId]=r}}}})(Y,x),Y.parent){const t=o[Y.parent.uniqueId],b=F[t];x.parent=b||Y.parent}if(x.position&&Y.position&&x.position.p(Y.position),x.rotationQuaternion&&Y.rotationQuaternion&&x.rotationQuaternion.p(Y.rotationQuaternion),x.rotation&&Y.rotation&&x.rotation.p(Y.rotation),x.Oe&&Y.Oe&&x.Oe.p(Y.Oe),x.material){const r=x;if(r.material)if(b){const b=Y.material;if(-1===E.indexOf(b)){let Y=b.clone(t?t(b.name):"Clone of "+b.name);if(E.push(b),o[b.uniqueId]=Y.uniqueId,F[Y.uniqueId]=Y,"MultiMaterial"===b.getClassName()){const x=b;for(const b of x.yg)b&&(Y=b.clone(t?t(b.name):"Clone of "+b.name),E.push(b),o[b.uniqueId]=Y.uniqueId,F[Y.uniqueId]=Y);x.yg=x.yg.map((t=>t&&F[o[t.uniqueId]]))}}"InstancedMesh"!==r.getClassName()&&(r.material=F[o[b.uniqueId]])}else"MultiMaterial"===r.material.getClassName()?-1===this.Se.multiMaterials.indexOf(r.material)&&this.Se.addMultiMaterial(r.material):-1===this.Se.materials.indexOf(r.material)&&this.Se.addMaterial(r.material)}null===x.parent&&R.rootNodes.push(x)};return W.forEach((t=>{if("InstancedMesh"===t.getClassName()){const b=t,Y=b.sourceMesh,x=o[Y.uniqueId],r=("number"===typeof x?F[x]:Y).Dd(b.name);T(b,r)}else{let b=!0;"mb"===t.getClassName()||"Node"===t.getClassName()||t.skeleton||!t.getTotalVertices||0===t.getTotalVertices()?b=!1:U.doNotInstantiate&&(b="function"===typeof U.doNotInstantiate?!U.doNotInstantiate(t):!U.doNotInstantiate);const Y=b?t.Dd(`instance of ${t.name}`):t.clone(`Clone of ${t.name}`,null,!0);if(!Y)throw new Error(`Could not clone or instantiate node on Asset Container ${t.name}`);T(t,Y)}})),this.skeletons.forEach((b=>{if(U.predicate&&!U.predicate(b))return;const Y=b.clone(t?t(b.name):"Clone of "+b.name);for(const t of this.meshes)if(t.skeleton===b&&!t.isAnInstance){const b=F[o[t.uniqueId]];if(!b||b.isAnInstance)continue;if(b.skeleton=Y,-1!==d.indexOf(Y))continue;d.push(Y);for(const t of Y.bones)t._linkedTransformNode&&(t._linkedTransformNode=F[o[t._linkedTransformNode.uniqueId]])}R.skeletons.push(Y)})),this.animationGroups.forEach((b=>{if(U.predicate&&!U.predicate(b))return;const Y=b.clone(t?t(b.name):"Clone of "+b.name,(t=>F[o[t.uniqueId]]||t));R.animationGroups.push(Y)})),R}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||x.f.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.Se.environmentTexture=this.environmentTexture);for(const t of this.Se._serializableComponents)t.addFromContainer(this);this.Se.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const b=[];this.cameras.forEach((Y=>{t&&!t(Y)||(this.Se.addCamera(Y),b.push(Y))})),this.lights.forEach((Y=>{t&&!t(Y)||(this.Se.addLight(Y),b.push(Y))})),this.meshes.forEach((Y=>{t&&!t(Y)||(this.Se.df(Y),b.push(Y))})),this.skeletons.forEach((b=>{t&&!t(b)||this.Se.addSkeleton(b)})),this.animations.forEach((b=>{t&&!t(b)||this.Se.addAnimation(b)})),this.animationGroups.forEach((b=>{t&&!t(b)||this.Se.addAnimationGroup(b)})),this.multiMaterials.forEach((b=>{t&&!t(b)||this.Se.addMultiMaterial(b)})),this.materials.forEach((b=>{t&&!t(b)||this.Se.addMaterial(b)})),this.morphTargetManagers.forEach((b=>{t&&!t(b)||this.Se.addMorphTargetManager(b)})),this.geometries.forEach((b=>{t&&!t(b)||this.Se.addGeometry(b)})),this.transformNodes.forEach((Y=>{t&&!t(Y)||(this.Se.addTransformNode(Y),b.push(Y))})),this.actionManagers.forEach((b=>{t&&!t(b)||this.Se.addActionManager(b)})),this.textures.forEach((b=>{t&&!t(b)||this.Se.addTexture(b)})),this.reflectionProbes.forEach((b=>{t&&!t(b)||this.Se.addReflectionProbe(b)}));for(const Y of b)Y.parent&&-1===this.Se.getNodes().indexOf(Y.parent)&&(Y.setParent?Y.setParent(null):Y.parent=null)}removeAllFromScene(){this._isValidHierarchy()||x.f.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.Se.environmentTexture&&(this.Se.environmentTexture=null);for(const t of this.Se._serializableComponents)t.removeFromContainer(this)}removeFromScene(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.cameras.forEach((b=>{t&&!t(b)||this.Se.removeCamera(b)})),this.lights.forEach((b=>{t&&!t(b)||this.Se.removeLight(b)})),this.meshes.forEach((b=>{t&&!t(b)||this.Se.gf(b,!0)})),this.skeletons.forEach((b=>{t&&!t(b)||this.Se.removeSkeleton(b)})),this.animations.forEach((b=>{t&&!t(b)||this.Se.removeAnimation(b)})),this.animationGroups.forEach((b=>{t&&!t(b)||this.Se.removeAnimationGroup(b)})),this.multiMaterials.forEach((b=>{t&&!t(b)||this.Se.removeMultiMaterial(b)})),this.materials.forEach((b=>{t&&!t(b)||this.Se.removeMaterial(b)})),this.morphTargetManagers.forEach((b=>{t&&!t(b)||this.Se.removeMorphTargetManager(b)})),this.geometries.forEach((b=>{t&&!t(b)||this.Se.removeGeometry(b)})),this.transformNodes.forEach((b=>{t&&!t(b)||this.Se.removeTransformNode(b)})),this.actionManagers.forEach((b=>{t&&!t(b)||this.Se.removeActionManager(b)})),this.textures.forEach((b=>{t&&!t(b)||this.Se.removeTexture(b)})),this.reflectionProbes.forEach((b=>{t&&!t(b)||this.Se.removeReflectionProbe(b)}))}dispose(){this.cameras.slice(0).forEach((t=>{t.dispose()})),this.cameras.length=0,this.lights.slice(0).forEach((t=>{t.dispose()})),this.lights.length=0,this.meshes.slice(0).forEach((t=>{t.dispose()})),this.meshes.length=0,this.skeletons.slice(0).forEach((t=>{t.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((t=>{t.dispose()})),this.animationGroups.length=0,this.multiMaterials.slice(0).forEach((t=>{t.dispose()})),this.multiMaterials.length=0,this.materials.slice(0).forEach((t=>{t.dispose()})),this.materials.length=0,this.geometries.slice(0).forEach((t=>{t.dispose()})),this.geometries.length=0,this.transformNodes.slice(0).forEach((t=>{t.dispose()})),this.transformNodes.length=0,this.actionManagers.slice(0).forEach((t=>{t.dispose()})),this.actionManagers.length=0,this.textures.slice(0).forEach((t=>{t.dispose()})),this.textures.length=0,this.reflectionProbes.slice(0).forEach((t=>{t.dispose()})),this.reflectionProbes.length=0,this.morphTargetManagers.slice(0).forEach((t=>{t.dispose()})),this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const t of this.Se._serializableComponents)t.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.Se.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(t,b,Y){if(t&&b)for(const o of t){let t=!0;if(Y)for(const b of Y)if(o===b){t=!1;break}t&&(b.push(o),o._parentContainer=this)}}moveAllFromScene(t){this._wasAddedToScene=!1,void 0===t&&(t=new y);for(const b in this)Object.prototype.hasOwnProperty.call(this,b)&&(this[b]=this[b]||("_environmentTexture"===b?null:[]),this._moveAssets(this.Se[b],this[b],t[b]));this.environmentTexture=this.Se.environmentTexture,this.removeAllFromScene()}createRootMesh(){const t=new r.d("assetContainerRootMesh",this.Se);return this.meshes.forEach((b=>{b.parent||t.addChild(b)})),this.meshes.unshift(t),t}mergeAnimationsTo(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:U.d.LastCreatedScene,b=arguments.length>1?arguments[1]:void 0,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!t)return E.b.Error("No scene available to merge animations to"),[];const o=Y||(b=>{let Y=null;const o=b.animations.length?b.animations[0].targetProperty:"",x=b.name.split(".").join("").split("_primitive")[0];switch(o){case"position":case"rotationQuaternion":Y=t.getTransformNodeByName(b.name)||t.getTransformNodeByName(x);break;case"influence":Y=t.getMorphTargetByName(b.name)||t.getMorphTargetByName(x);break;default:Y=t.getNodeByName(b.name)||t.getNodeByName(x)}return Y});this.getNodes().forEach((t=>{const b=o(t);if(null!==b){for(const Y of t.animations){const t=b.animations.filter((t=>t.targetProperty===Y.targetProperty));for(const Y of t){const t=b.animations.indexOf(Y,0);t>-1&&b.animations.splice(t,1)}}b.animations=b.animations.concat(t.animations)}}));const x=[];return this.animationGroups.slice().forEach((t=>{x.push(t.clone(t.name,o)),t.animatables.forEach((t=>{t.stop()}))})),b.forEach((b=>{const Y=o(b.target);Y&&(t.beginAnimation(Y,b.fromFrame,b.toFrame,b.loopAnimation,b.speedRatio,b.onAnimationEnd?b.onAnimationEnd:void 0,void 0,!0,void 0,b.onAnimationLoop?b.onAnimationLoop:void 0),t.stopAnimation(b.target))})),x}populateRootNodes(){this.rootNodes.length=0,this.meshes.forEach((t=>{t.parent||-1!==this.rootNodes.indexOf(t)||this.rootNodes.push(t)})),this.transformNodes.forEach((t=>{t.parent||-1!==this.rootNodes.indexOf(t)||this.rootNodes.push(t)})),this.lights.forEach((t=>{t.parent||-1!==this.rootNodes.indexOf(t)||this.rootNodes.push(t)})),this.cameras.forEach((t=>{t.parent||-1!==this.rootNodes.indexOf(t)||this.rootNodes.push(t)}))}addAllAssetsToContainer(t){if(!t)return;const b=[],Y=new Set;for(b.push(t);b.length>0;){const t=b.pop();if(t instanceof r.d?(t.Ee&&-1===this.geometries.indexOf(t.Ee)&&this.geometries.push(t.Ee),this.meshes.push(t)):t instanceof R.d?this.transformNodes.push(t):t instanceof p.c?this.lights.push(t):t instanceof W.b&&this.cameras.push(t),t instanceof d.b){if(t.material&&-1===this.materials.indexOf(t.material)){this.materials.push(t.material);for(const b of t.material.getActiveTextures())-1===this.textures.indexOf(b)&&this.textures.push(b)}t.skeleton&&-1===this.skeletons.indexOf(t.skeleton)&&this.skeletons.push(t.skeleton),t.morphTargetManager&&-1===this.morphTargetManagers.indexOf(t.morphTargetManager)&&this.morphTargetManagers.push(t.morphTargetManager)}for(const o of t.getChildren())Y.has(o)||b.push(o);Y.add(t)}this.populateRootNodes()}}var J=Y(1111);class m{constructor(t){this.byteOffset=0,this.buffer=t}loadAsync(t){return this.buffer.readAsync(this.byteOffset,t).then((t=>{this._dataView=new DataView(t.buffer,t.byteOffset,t.byteLength),this._dataByteOffset=0}))}readUint32(){const t=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,t}readUint8Array(t){const b=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,t);return this._dataByteOffset+=t,this.byteOffset+=t,b}readString(t){return(0,J.j)(this.readUint8Array(t))}skipBytes(t){this._dataByteOffset+=t,this.byteOffset+=t}}var K=Y(12373);const L="Z2xURg",z={name:"Wi",extensions:{".gltf":{isBinary:!1},".glb":{isBinary:!0}},canDirectLoad:t=>-1!==t.indexOf("asset")&&-1!==t.indexOf("version")||t.startsWith("data:base64,"+L)||t.startsWith("data:;base64,"+L)||t.startsWith("data:application/octet-stream;base64,"+L)||t.startsWith("data:model/gltf-binary;base64,"+L)};var S,e,g,D=Y(1081),H=Y(1102);function f(t,b,Y){try{return Promise.resolve(new Uint8Array(t,b,Y))}catch(o){return Promise.reject(o)}}!function(t){t[t.AUTO=0]="AUTO",t[t.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(S||(S={})),function(t){t[t.NONE=0]="NONE",t[t.FIRST=1]="FIRST",t[t.ALL=2]="ALL"}(e||(e={})),function(t){t[t.LOADING=0]="LOADING",t[t.READY=1]="READY",t[t.COMPLETE=2]="COMPLETE"}(g||(g={}));class n{constructor(){this.coordinateSystemMode=S.AUTO,this.animationStartMode=e.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=t=>Promise.resolve(t),this.extensionOptions={}}p(t){t&&(this.onParsed=t.onParsed,this.coordinateSystemMode=t.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=t.animationStartMode??this.animationStartMode,this.loadNodeAnimations=t.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=t.loadSkins??this.loadSkins,this.loadMorphTargets=t.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=t.compileMaterials??this.compileMaterials,this.useClipPlane=t.useClipPlane??this.useClipPlane,this.compileShadowGenerators=t.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=t.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=t.useRangeRequests??this.useRangeRequests,this.createInstances=t.createInstances??this.createInstances,this.alwaysComputeBoundingBox=t.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=t.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=t.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=t.skipMaterials??this.skipMaterials,this.useSRGBBuffers=t.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=t.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=t.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=t.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=t.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=t.customRootNode,this.onMeshLoaded=t.onMeshLoaded,this.onSkinLoaded=t.onSkinLoaded,this.onTextureLoaded=t.onTextureLoaded,this.onMaterialLoaded=t.onMaterialLoaded,this.onCameraLoaded=t.onCameraLoaded,this.extensionOptions=t.extensionOptions??this.extensionOptions)}}class X extends n{constructor(t){super(),this.onParsedObservable=new o.e,this.onMeshLoadedObservable=new o.e,this.onSkinLoadedObservable=new o.e,this.onTextureLoadedObservable=new o.e,this.onMaterialLoadedObservable=new o.e,this.onCameraLoadedObservable=new o.e,this.onCompleteObservable=new o.e,this.onErrorObservable=new o.e,this.le=new o.e,this.onExtensionLoadedObservable=new o.e,this.validate=!1,this.onValidatedObservable=new o.e,this._loader=null,this._state=null,this._requests=new Array,this.name=z.name,this.extensions=z.extensions,this.onLoaderStateChangedObservable=new o.e,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.p(t)}set onParsed(t){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),t&&(this._onParsedObserver=this.onParsedObservable.add(t))}set onMeshLoaded(t){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),t&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(t))}set onSkinLoaded(t){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),t&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((b=>t(b.node,b.skinnedNode))))}set onTextureLoaded(t){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),t&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(t))}set onMaterialLoaded(t){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),t&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(t))}set onCameraLoaded(t){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),t&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(t))}set onComplete(t){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(t)}set onError(t){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(t)}set onDispose(t){this._onDisposeObserver&&this.le.remove(this._onDisposeObserver),this._onDisposeObserver=this.le.add(t)}set onExtensionLoaded(t){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(t)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(t){this._loggingEnabled!==t&&(this._loggingEnabled=t,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(t){this._capturePerformanceCounters!==t&&(this._capturePerformanceCounters=t,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(t){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(t)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const t of this._requests)t.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=t=>Promise.resolve(t),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.le.notifyObservers(void 0),this.le.clear()}loadFile(t,b,Y,F,r,R,d,U){if(ArrayBuffer.isView(b))return this._loadBinary(t,b,Y,F,d,U),null;this._progressCallback=r;const C=b.name||x.f.GetFilename(b);if(R){if(this.useRangeRequests){this.validate&&E.b.Warn("glTF validation is not supported when range requests are enabled");const Y={abort:()=>{},onCompleteObservable:new o.e},x={readAsync:(Y,o)=>new Promise(((x,F)=>{this._loadFile(t,b,(t=>{x(new Uint8Array(t))}),!0,(t=>{F(t)}),(t=>{t.setRequestHeader("Range",`bytes=${Y}-${Y+o-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new m(x)).then((t=>{Y.onCompleteObservable.notifyObservers(Y),F(t)}),d?t=>d(void 0,t):void 0),Y}return this._loadFile(t,b,(b=>{this._validate(t,new Uint8Array(b,0,b.byteLength),Y,C),this._unpackBinaryAsync(new m({readAsync:(t,Y)=>f(b,t,Y),byteLength:b.byteLength})).then((t=>{F(t)}),d?t=>d(void 0,t):void 0)}),!0,d)}return this._loadFile(t,b,(b=>{try{this._validate(t,b,Y,C),F({json:this._parseJson(b)})}catch{d&&d()}}),!1,d)}_loadBinary(t,b,Y,o,x,F){this._validate(t,new Uint8Array(b.buffer,b.byteOffset,b.byteLength),Y,F),this._unpackBinaryAsync(new m({readAsync:(t,Y)=>function(t,b,Y){try{if(b<0||b>=t.byteLength)throw new RangeError("Offset is out of range.");if(b+Y>t.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(t.buffer,t.byteOffset+b,Y))}catch(o){return Promise.reject(o)}}(b,t,Y),byteLength:b.byteLength})).then((t=>{o(t)}),x?t=>x(void 0,t):void 0)}importMeshAsync(t,b,Y,o,x,F){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(Y),this.onParsedObservable.clear(),this._log(`Loading ${F||""}`),this._loader=this._getLoader(Y),this._loader.importMeshAsync(t,b,null,Y,o,x,F))))}loadAsync(t,b,Y,o,x){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(b),this.onParsedObservable.clear(),this._log(`Loading ${x||""}`),this._loader=this._getLoader(b),this._loader.loadAsync(t,b,Y,o,x))))}loadAssetContainerAsync(t,b,Y,o,x){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(b),this.onParsedObservable.clear(),this._log(`Loading ${x||""}`),this._loader=this._getLoader(b);const F=new B(t),r=[];this.onMaterialLoadedObservable.add((t=>{r.push(t)}));const R=[];this.onTextureLoadedObservable.add((t=>{R.push(t)}));const d=[];this.onCameraLoadedObservable.add((t=>{d.push(t)}));const E=[];return this.onMeshLoadedObservable.add((t=>{t.morphTargetManager&&E.push(t.morphTargetManager)})),this._loader.importMeshAsync(null,t,F,b,Y,o,x).then((t=>(Array.prototype.push.apply(F.geometries,t.geometries),Array.prototype.push.apply(F.meshes,t.meshes),Array.prototype.push.apply(F.ue,t.ue),Array.prototype.push.apply(F.skeletons,t.skeletons),Array.prototype.push.apply(F.animationGroups,t.animationGroups),Array.prototype.push.apply(F.materials,r),Array.prototype.push.apply(F.textures,R),Array.prototype.push.apply(F.lights,t.lights),Array.prototype.push.apply(F.transformNodes,t.transformNodes),Array.prototype.push.apply(F.cameras,d),Array.prototype.push.apply(F.morphTargetManagers,E),F)))}))}canDirectLoad(t){return z.canDirectLoad(t)}directLoad(t,b){if(b.startsWith("base64,"+L)||b.startsWith(";base64,"+L)||b.startsWith("application/octet-stream;base64,"+L)||b.startsWith("model/gltf-binary;base64,"+L)){const Y=(0,D.c)(b);return this._validate(t,new Uint8Array(Y,0,Y.byteLength)),this._unpackBinaryAsync(new m({readAsync:(t,b)=>f(Y,t,b),byteLength:Y.byteLength}))}return this._validate(t,b),Promise.resolve({json:this._parseJson(b)})}createPlugin(t){return new X(t[z.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((t,b)=>{this.onCompleteObservable.addOnce((()=>{t()})),this.onErrorObservable.addOnce((t=>{b(t)}))}))}_setState(t){this._state!==t&&(this._state=t,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(g[this._state]))}_loadFile(t,b,Y,o,x,F){const r=t._loadFile(b,Y,(t=>{this._onProgress(t,r)}),!0,o,x,F);return r.onCompleteObservable.add((()=>{r._lengthComputable=!0,r._total=r._loaded})),this._requests.push(r),r}_onProgress(t,b){if(!this._progressCallback)return;b._lengthComputable=t.lengthComputable,b._loaded=t.loaded,b._total=t.total;let Y=!0,o=0,x=0;for(const F of this._requests){if(void 0===F._lengthComputable||void 0===F._loaded||void 0===F._total)return;Y=Y&&F._lengthComputable,o+=F._loaded,x+=F._total}this._progressCallback({lengthComputable:Y,loaded:o,total:Y?x:0})}_validate(t,b){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),K.d.ValidateAsync(b,Y,o,(b=>this.preprocessUrlAsync(Y+b).then((b=>t._loadFileAsync(b,void 0,!0,!0).then((t=>new Uint8Array(t,0,t.byteLength))))))).then((t=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(t),this.onValidatedObservable.clear()}),(t=>{this._endPerformanceCounter("Validate JSON"),x.f.Warn(`Failed to validate: ${t.message}`),this.onValidatedObservable.clear()})))}_getLoader(t){const b=t.json.asset||{};this._log(`Asset version: ${b.version}`),b.minVersion&&this._log(`Asset minimum version: ${b.minVersion}`),b.generator&&this._log(`Asset generator: ${b.generator}`);const Y=X._parseVersion(b.version);if(!Y)throw new Error("Invalid version: "+b.version);if(void 0!==b.minVersion){const t=X._parseVersion(b.minVersion);if(!t)throw new Error("Invalid minimum version: "+b.minVersion);if(X._compareVersion(t,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+b.minVersion)}const o={1:X._CreateGLTF1Loader,2:X._CreateGLTF2Loader}[Y.major];if(!o)throw new Error("Unsupported version: "+b.version);return o(this)}_parseJson(t){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${t.length}`);const b=JSON.parse(t);return this._endPerformanceCounter("Parse JSON"),b}_unpackBinaryAsync(t){return this._startPerformanceCounter("Unpack Binary"),t.loadAsync(20).then((()=>{const b=t.readUint32();if(1179937895!==b)throw new H.k("Unexpected magic: "+b,H.g.GLTFLoaderUnexpectedMagicError);const Y=t.readUint32();this.loggingEnabled&&this._log(`Binary version: ${Y}`);const o=t.readUint32();let x;switch(this.useRangeRequests||o===t.buffer.byteLength||E.b.Warn(`Length in header does not match actual data length: ${o} != ${t.buffer.byteLength}`),Y){case 1:x=this._unpackBinaryV1Async(t,o);break;case 2:x=this._unpackBinaryV2Async(t,o);break;default:throw new Error("Unsupported version: "+Y)}return this._endPerformanceCounter("Unpack Binary"),x}))}_unpackBinaryV1Async(t,b){const Y=t.readUint32(),o=t.readUint32();if(0!==o)throw new Error(`Unexpected content format: ${o}`);const x=b-t.byteOffset,F={json:this._parseJson(t.readString(Y)),bin:null};if(0!==x){const b=t.byteOffset;F.bin={readAsync:(Y,o)=>t.buffer.readAsync(b+Y,o),byteLength:x}}return Promise.resolve(F)}_unpackBinaryV2Async(t,b){const Y=1313821514,o=5130562,x=t.readUint32();if(t.readUint32()!==Y)throw new Error("First chunk format is not JSON");return t.byteOffset+x===b?t.loadAsync(x).then((()=>({json:this._parseJson(t.readString(x)),bin:null}))):t.loadAsync(x+8).then((()=>{const F={json:this._parseJson(t.readString(x)),bin:null},r=()=>{const x=t.readUint32();switch(t.readUint32()){case Y:throw new Error("Unexpected JSON chunk");case o:{const b=t.byteOffset;F.bin={readAsync:(Y,o)=>t.buffer.readAsync(b+Y,o),byteLength:x},t.skipBytes(x);break}default:t.skipBytes(x)}return t.byteOffset!==b?t.loadAsync(8).then(r):Promise.resolve(F)};return r()}))}static _parseVersion(t){if("1.0"===t||"1.0.1"===t)return{major:1,minor:0};const b=(t+"").match(/^(\d+)\.(\d+)/);return b?{major:parseInt(b[1]),minor:parseInt(b[2])}:null}static _compareVersion(t,b){return t.major>b.major?1:t.major<b.major?-1:t.minor>b.minor?1:t.minor<b.minor?-1:0}_logOpen(t){this._log(t),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(t){const b=X._logSpaces.substring(0,2*this._logIndentLevel);E.b.Log(`${b}${t}`)}_logDisabled(t){}_startPerformanceCounterEnabled(t){x.f.StartPerformanceCounter(t)}_startPerformanceCounterDisabled(t){}_endPerformanceCounterEnabled(t){x.f.EndPerformanceCounter(t)}_endPerformanceCounterDisabled(t){}}X.IncrementalLoading=!0,X.HomogeneousCoordinates=!1,X._logSpaces="                                ",(0,F.f)(new X)},12373:(t,b,Y)=>{"use strict";Y.d(b,{d:()=>r});var o=Y(1265);function x(t,b,Y,o){const x={externalResourceFunction:o};return Y&&(x.uri="file:"===b?Y:b+Y),ArrayBuffer.isView(t)?GLTFValidator.validateBytes(t,x):GLTFValidator.validateString(t,x)}function F(){const t=[];onmessage=b=>{const Y=b.data;switch(Y.id){case"init":importScripts(Y.url);break;case"validate":x(Y.data,Y.rootUrl,Y.fileName,(b=>new Promise(((Y,o)=>{const x=t.length;t.push({resolve:Y,reject:o}),postMessage({id:"getExternalResource",index:x,uri:b})})))).then((t=>{postMessage({id:"validate.resolve",value:t})}),(t=>{postMessage({id:"validate.reject",reason:t})}));break;case"getExternalResource.resolve":t[Y.index].resolve(Y.value);break;case"getExternalResource.reject":t[Y.index].reject(Y.reason)}}}class r{static ValidateAsync(t,b,Y,r){return"function"===typeof Worker?new Promise(((R,d)=>{const E=`${x}(${F})()`,U=URL.createObjectURL(new Blob([E],{type:"application/javascript"})),C=new Worker(U),p=t=>{C.removeEventListener("error",p),C.removeEventListener("message",W),d(t)},W=t=>{const b=t.data;switch(b.id){case"getExternalResource":r(b.uri).then((t=>{C.postMessage({id:"getExternalResource.resolve",index:b.index,value:t},[t.buffer])}),(t=>{C.postMessage({id:"getExternalResource.reject",index:b.index,reason:t})}));break;case"validate.resolve":C.removeEventListener("error",p),C.removeEventListener("message",W),R(b.value),C.terminate();break;case"validate.reject":C.removeEventListener("error",p),C.removeEventListener("message",W),d(b.reason),C.terminate()}};if(C.addEventListener("error",p),C.addEventListener("message",W),C.postMessage({id:"init",url:o.f.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(t)){const o=t.slice();C.postMessage({id:"validate",data:o,rootUrl:b,fileName:Y},[o.buffer])}else C.postMessage({id:"validate",data:t,rootUrl:b,fileName:Y})})):(this._LoadScriptPromise||(this._LoadScriptPromise=o.f.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>x(t,b,Y,r))))}}r.Configuration={url:`${o.f._DefaultCdnUrl}/gltf_validator.js`}},12710:(t,b,Y)=>{"use strict";Y.d(b,{e:()=>S});var o=Y(999),x=Y(1001),F=Y(1224),r=Y(1019),R=Y(1452),d=Y(1461),E=Y(1307),U=Y(1260),C=Y(1041),p=Y(1175);Y(11301),Y(11155),Y(11309),Y(11074),Y(11315),Y(11344),Y(11350);const W="imageProcessingCompatibility",T="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";p.d.IncludesShadersStore[W]=T;const y="skyPixelShader",v="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";p.d.ShadersStore[y]=v;Y(11123),Y(11128),Y(11214),Y(11235),Y(11219);const B="skyVertexShader",J="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";p.d.ShadersStore[B]=J;var m=Y(1469),K=Y(1446),L=Y(1438);class z extends R.b{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class S extends d.b{constructor(t,b){super(t,b),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new r.l(0,100,0),this.useSunPosition=!1,this.cameraOffset=r.l.Zero(),this.up=r.l.Up(),this.dithering=!1,this._cameraPosition=r.l.Zero(),this._skyOrientation=new r.e}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(t,b){const Y=b._drawWrapper;if(this.isFrozen&&Y.effect&&Y._wasPreviouslyReady)return!0;b.materialDefines||(b.materialDefines=new z);const o=b.materialDefines,x=this.va();if(this._isReadyForSubMesh(b))return!0;if((0,L.Q)(t,x,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,o),(0,L.I)(t,o,!0,!1),o.IMAGEPROCESSINGPOSTPROCESS!==x.imageProcessingConfiguration.applyByPostProcess&&o.markAsMiscDirty(),o.DITHER!==this.dithering&&o.markAsMiscDirty(),o.isDirty){o.markAsProcessed(),x.resetCachedMaterial();const t=new m.b;o.FOG&&t.addFallback(1,"FOG"),o.IMAGEPROCESSINGPOSTPROCESS=x.imageProcessingConfiguration.applyByPostProcess,o.DITHER=this.dithering;const Y=[E.e.PositionKind];o.VERTEXCOLOR&&Y.push(E.e.ColorKind);const F="sky",r=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,K.b)(r);const R=o.toString();b.setEffect(x.getEngine().createEffect(F,Y,r,[],R,t,this.onCompiled,this.onError),o,this._materialContext)}return!(!b.effect||!b.effect.isReady())&&(o._renderId=x.getRenderId(),Y._wasPreviouslyReady=!0,!0)}bindForSubMesh(t,b,Y){const o=this.va(),x=Y.materialDefines;if(!x)return;const F=Y.effect;if(!F)return;this._activeEffect=F,this.bindOnlyWorldMatrix(t),this._activeEffect.setMatrix("viewProjection",o.getTransformMatrix()),this._mustRebind(o,F,Y)&&((0,K.e)(F,this,o),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,L.n)(x,F,o)),o.fogEnabled&&b.applyFog&&o.fogMode!==U.e.FOGMODE_NONE&&this._activeEffect.setMatrix("view",o.getViewMatrix()),(0,L.h)(o,b,this._activeEffect);const R=o.activeCamera;if(R){const t=R.getWorldMatrix();this._cameraPosition.x=t.m[12],this._cameraPosition.y=t.m[13],this._cameraPosition.z=t.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const t=Math.PI*(this.inclination-.5),b=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(b)*Math.cos(t),this.sunPosition.y=this.distance*Math.sin(-t),this.sunPosition.z=this.distance*Math.sin(b)*Math.cos(t),r.e.FromUnitVectorsToRef(r.l.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(b,this._activeEffect,Y)}getAnimatables(){return[]}dispose(t){super.dispose(t)}clone(t){return F.d.Clone((()=>new S(t,this.va())),this)}serialize(){const t=super.serialize();return t.customType="BABYLON.SkyMaterial",t}getClassName(){return"SkyMaterial"}static Parse(t,b,Y){return F.d.Parse((()=>new S(t.name,b)),t,b,Y)}}(0,o.e)([(0,x.P)()],S.prototype,"luminance",void 0),(0,o.e)([(0,x.P)()],S.prototype,"turbidity",void 0),(0,o.e)([(0,x.P)()],S.prototype,"rayleigh",void 0),(0,o.e)([(0,x.P)()],S.prototype,"mieCoefficient",void 0),(0,o.e)([(0,x.P)()],S.prototype,"mieDirectionalG",void 0),(0,o.e)([(0,x.P)()],S.prototype,"distance",void 0),(0,o.e)([(0,x.P)()],S.prototype,"inclination",void 0),(0,o.e)([(0,x.P)()],S.prototype,"azimuth",void 0),(0,o.e)([(0,x.L)()],S.prototype,"sunPosition",void 0),(0,o.e)([(0,x.P)()],S.prototype,"useSunPosition",void 0),(0,o.e)([(0,x.L)()],S.prototype,"cameraOffset",void 0),(0,o.e)([(0,x.L)()],S.prototype,"up",void 0),(0,o.e)([(0,x.P)()],S.prototype,"dithering",void 0),(0,C.d)("BABYLON.SkyMaterial",S)},11466:(t,b,Y)=>{"use strict";function o(t,b){b.headers=t.headers||{},b.statusMessage=t.statusText,b.statusCode=t.status,b.data=t.response}function x(t,b,Y){return new Promise((function(x,F){Y=Y||{};var r,R,d,E=new XMLHttpRequest,U=Y.body,C=Y.headers||{};for(r in Y.timeout&&(E.timeout=Y.timeout),E.ontimeout=E.onerror=function(t){t.timeout="timeout"==t.type,F(t)},E.open(t,b.href||b),E.onload=function(){for(d=E.getAllResponseHeaders().trim().split(/[\r\n]+/),o(E,E);R=d.shift();)R=R.split(": "),E.headers[R.shift().toLowerCase()]=R.join(": ");if((R=E.headers["content-type"])&&~R.indexOf("application/json"))try{E.data=JSON.parse(E.data,Y.reviver)}catch(t){return o(E,t),F(t)}(E.status>=400?F:x)(E)},typeof FormData<"u"&&U instanceof FormData||U&&"object"==typeof U&&(C["content-type"]="application/json",U=JSON.stringify(U)),E.withCredentials=!!Y.withCredentials,C)E.setRequestHeader(r,C[r]);E.send(U)}))}Y.r(b),Y.d(b,{del:()=>d,get:()=>F,patch:()=>R,post:()=>r,put:()=>E,send:()=>x});var F=x.bind(x,"GET"),r=x.bind(x,"POST"),R=x.bind(x,"PATCH"),d=x.bind(x,"DELETE"),E=x.bind(x,"PUT")},12819:(t,b,Y)=>{"use strict";Y.d(b,{d:()=>C});const o=.5*(Math.sqrt(3)-1),x=(3-Math.sqrt(3))/6,F=1/3,r=1/6,R=(Math.sqrt(5)-1)/4,d=(5-Math.sqrt(5))/20,E=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),U=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const C=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const b="function"==typeof t?t:function(t){let b=0,Y=0,o=0,x=1;const F=function(){let t=4022871197;return function(b){b=b.toString();for(let Y=0;Y<b.length;Y++){t+=b.charCodeAt(Y);let o=.02519603282416938*t;t=o>>>0,o-=t,o*=t,t=o>>>0,o-=t,t+=4294967296*o}return 2.3283064365386963e-10*(t>>>0)}}();b=F(" "),Y=F(" "),o=F(" "),b-=F(t),b<0&&(b+=1);Y-=F(t),Y<0&&(Y+=1);o-=F(t),o<0&&(o+=1);return function(){const t=2091639*b+2.3283064365386963e-10*x;return b=Y,Y=o,o=t-(x=0|t)}}(t);this.p=function(t){const b=new Uint8Array(256);for(let Y=0;Y<256;Y++)b[Y]=Y;for(let Y=0;Y<255;Y++){const o=Y+~~(t()*(256-Y)),x=b[Y];b[Y]=b[o],b[o]=x}return b}(b),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let Y=0;Y<512;Y++)this.perm[Y]=this.p[255&Y],this.permMod12[Y]=this.perm[Y]%12}noise2D(t,b){const Y=this.permMod12,F=this.perm;let r=0,R=0,d=0;const U=(t+b)*o,C=Math.floor(t+U),p=Math.floor(b+U),W=(C+p)*x,T=t-(C-W),y=b-(p-W);let v,B;T>y?(v=1,B=0):(v=0,B=1);const J=T-v+x,m=y-B+x,K=T-1+2*x,L=y-1+2*x,z=255&C,S=255&p;let e=.5-T*T-y*y;if(e>=0){const t=3*Y[z+F[S]];e*=e,r=e*e*(E[t]*T+E[t+1]*y)}let g=.5-J*J-m*m;if(g>=0){const t=3*Y[z+v+F[S+B]];g*=g,R=g*g*(E[t]*J+E[t+1]*m)}let D=.5-K*K-L*L;if(D>=0){const t=3*Y[z+1+F[S+1]];D*=D,d=D*D*(E[t]*K+E[t+1]*L)}return 70*(r+R+d)}noise3D(t,b,Y){const o=this.permMod12,x=this.perm;let R,d,U,C;const p=(t+b+Y)*F,W=Math.floor(t+p),T=Math.floor(b+p),y=Math.floor(Y+p),v=(W+T+y)*r,B=t-(W-v),J=b-(T-v),m=Y-(y-v);let K,L,z,S,e,g;B>=J?J>=m?(K=1,L=0,z=0,S=1,e=1,g=0):B>=m?(K=1,L=0,z=0,S=1,e=0,g=1):(K=0,L=0,z=1,S=1,e=0,g=1):J<m?(K=0,L=0,z=1,S=0,e=1,g=1):B<m?(K=0,L=1,z=0,S=0,e=1,g=1):(K=0,L=1,z=0,S=1,e=1,g=0);const D=B-K+r,H=J-L+r,f=m-z+r,n=B-S+2*r,X=J-e+2*r,Q=m-g+2*r,N=B-1+.5,u=J-1+.5,Z=m-1+.5,a=255&W,A=255&T,M=255&y;let w=.6-B*B-J*J-m*m;if(w<0)R=0;else{const t=3*o[a+x[A+x[M]]];w*=w,R=w*w*(E[t]*B+E[t+1]*J+E[t+2]*m)}let c=.6-D*D-H*H-f*f;if(c<0)d=0;else{const t=3*o[a+K+x[A+L+x[M+z]]];c*=c,d=c*c*(E[t]*D+E[t+1]*H+E[t+2]*f)}let I=.6-n*n-X*X-Q*Q;if(I<0)U=0;else{const t=3*o[a+S+x[A+e+x[M+g]]];I*=I,U=I*I*(E[t]*n+E[t+1]*X+E[t+2]*Q)}let s=.6-N*N-u*u-Z*Z;if(s<0)C=0;else{const t=3*o[a+1+x[A+1+x[M+1]]];s*=s,C=s*s*(E[t]*N+E[t+1]*u+E[t+2]*Z)}return 32*(R+d+U+C)}noise4D(t,b,Y,o){const x=this.perm;let F,r,E,C,p;const W=(t+b+Y+o)*R,T=Math.floor(t+W),y=Math.floor(b+W),v=Math.floor(Y+W),B=Math.floor(o+W),J=(T+y+v+B)*d,m=t-(T-J),K=b-(y-J),L=Y-(v-J),z=o-(B-J);let S=0,e=0,g=0,D=0;m>K?S++:e++,m>L?S++:g++,m>z?S++:D++,K>L?e++:g++,K>z?e++:D++,L>z?g++:D++;const H=S>=3?1:0,f=e>=3?1:0,n=g>=3?1:0,X=D>=3?1:0,Q=S>=2?1:0,N=e>=2?1:0,u=g>=2?1:0,Z=D>=2?1:0,a=S>=1?1:0,A=e>=1?1:0,M=g>=1?1:0,w=D>=1?1:0,c=m-H+d,I=K-f+d,s=L-n+d,l=z-X+d,i=m-Q+2*d,V=K-N+2*d,P=L-u+2*d,k=z-Z+2*d,q=m-a+3*d,O=K-A+3*d,j=L-M+3*d,G=z-w+3*d,h=m-1+4*d,tt=K-1+4*d,bt=L-1+4*d,Yt=z-1+4*d,ot=255&T,xt=255&y,Ft=255&v,rt=255&B;let Rt=.6-m*m-K*K-L*L-z*z;if(Rt<0)F=0;else{const t=x[ot+x[xt+x[Ft+x[rt]]]]%32*4;Rt*=Rt,F=Rt*Rt*(U[t]*m+U[t+1]*K+U[t+2]*L+U[t+3]*z)}let dt=.6-c*c-I*I-s*s-l*l;if(dt<0)r=0;else{const t=x[ot+H+x[xt+f+x[Ft+n+x[rt+X]]]]%32*4;dt*=dt,r=dt*dt*(U[t]*c+U[t+1]*I+U[t+2]*s+U[t+3]*l)}let Et=.6-i*i-V*V-P*P-k*k;if(Et<0)E=0;else{const t=x[ot+Q+x[xt+N+x[Ft+u+x[rt+Z]]]]%32*4;Et*=Et,E=Et*Et*(U[t]*i+U[t+1]*V+U[t+2]*P+U[t+3]*k)}let Ut=.6-q*q-O*O-j*j-G*G;if(Ut<0)C=0;else{const t=x[ot+a+x[xt+A+x[Ft+M+x[rt+w]]]]%32*4;Ut*=Ut,C=Ut*Ut*(U[t]*q+U[t+1]*O+U[t+2]*j+U[t+3]*G)}let Ct=.6-h*h-tt*tt-bt*bt-Yt*Yt;if(Ct<0)p=0;else{const t=x[ot+1+x[xt+1+x[Ft+1+x[rt+1]]]]%32*4;Ct*=Ct,p=Ct*Ct*(U[t]*h+U[t+1]*tt+U[t+2]*bt+U[t+3]*Yt)}return 27*(F+r+E+C+p)}}}}]);