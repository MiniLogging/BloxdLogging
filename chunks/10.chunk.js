/*! For license information please see 1kv4fg.10.fc88b17a.chunk.js.LICENSE.txt */
(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[10],{12861:(D,j,W)=>{"use strict";var Q=W(12870),C=W(12874),k=W(12876);W.g.__TYPEDARRAY_POOL||(W.g.__TYPEDARRAY_POOL={UINT8:C([32,0]),UINT16:C([32,0]),UINT32:C([32,0]),INT8:C([32,0]),INT16:C([32,0]),INT32:C([32,0]),FLOAT:C([32,0]),DOUBLE:C([32,0]),DATA:C([32,0]),UINT8C:C([32,0]),BUFFER:C([32,0])});var M="undefined"!==typeof Uint8ClampedArray,O=W.g.__TYPEDARRAY_POOL;O.UINT8C||(O.UINT8C=C([32,0])),O.BUFFER||(O.BUFFER=C([32,0]));var E=O.DATA,f=O.BUFFER;function F(D){if(D){var j=D.length||D.byteLength,W=Q.log2(j);E[W].push(D)}}function Z(D){D=Q.nextPow2(D);var j=Q.log2(D),W=E[j];return W.length>0?W.pop():new ArrayBuffer(D)}function P(D){return new Uint8Array(Z(D),0,D)}function X(D){return new Uint16Array(Z(2*D),0,D)}function x(D){return new Uint32Array(Z(4*D),0,D)}function R(D){return new Int8Array(Z(D),0,D)}function V(D){return new Int16Array(Z(2*D),0,D)}function U(D){return new Int32Array(Z(4*D),0,D)}function g(D){return new Float32Array(Z(4*D),0,D)}function N(D){return new Float64Array(Z(8*D),0,D)}function G(D){return M?new Uint8ClampedArray(Z(D),0,D):P(D)}function K(D){return new DataView(Z(D),0,D)}j.free=function(D){if(k(D))f[Q.log2(D.length)].push(D);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(D)&&(D=D.buffer),!D)return;var j=D.length||D.byteLength,W=0|Q.log2(j);E[W].push(D)}},j.freeUint8=j.freeUint16=j.freeUint32=j.freeInt8=j.freeInt16=j.freeInt32=j.freeFloat32=j.freeFloat=j.freeFloat64=j.freeDouble=j.freeUint8Clamped=j.freeDataView=function(D){F(D.buffer)},j.freeArrayBuffer=F,j.freeBuffer=function(D){f[Q.log2(D.length)].push(D)},j.malloc=function(D,j){if(void 0===j||"arraybuffer"===j)return Z(D);switch(j){case"uint8":return P(D);case"uint16":return X(D);case"uint32":return x(D);case"int8":return R(D);case"int16":return V(D);case"int32":return U(D);case"float":case"float32":return g(D);case"double":case"float64":return N(D);case"uint8_clamped":return G(D);case"buffer":throw"Buffer not supported";case"data":case"dataview":return K(D);default:return null}return null},j.mallocArrayBuffer=Z,j.mallocUint8=P,j.mallocUint16=X,j.mallocUint32=x,j.mallocInt8=R,j.mallocInt16=V,j.mallocInt32=U,j.mallocFloat32=j.mallocFloat=g,j.mallocFloat64=j.mallocDouble=N,j.mallocUint8Clamped=G,j.mallocDataView=K,j.clearCache=function(){for(var D=0;D<32;++D)O.UINT8[D].length=0,O.UINT16[D].length=0,O.UINT32[D].length=0,O.INT8[D].length=0,O.INT16[D].length=0,O.INT32[D].length=0,O.FLOAT[D].length=0,O.DOUBLE[D].length=0,O.UINT8C[D].length=0,E[D].length=0,f[D].length=0}},12967:(D,j,W)=>{D.exports=C;var Q=W(12384);function C(D,j){if(!(this instanceof C))return new C(D,j);var W=Q.create();Q.add(W,D,j),this.base=Q.min(Q.create(),D,W),this.Mh=Q.clone(j),this.max=Q.max(Q.create(),D,W),this.mag=Q.length(this.Mh)}var k=C.prototype;k.width=function(){return this.Mh[0]},k.height=function(){return this.Mh[1]},k.depth=function(){return this.Mh[2]},k.x0=function(){return this.base[0]},k.y0=function(){return this.base[1]},k.z0=function(){return this.base[2]},k.x1=function(){return this.max[0]},k.y1=function(){return this.max[1]},k.z1=function(){return this.max[2]},k.translate=function(D){return Q.add(this.max,this.max,D),Q.add(this.base,this.base,D),this},k.setPosition=function(D){return Q.add(this.max,D,this.Mh),Q.j(this.base,D),this},k.expand=function(D){var j=Q.create(),W=Q.create();return Q.max(j,D.max,this.max),Q.min(W,D.base,this.base),Q.Qc(j,j,W),new C(W,j)},k.intersects=function(D){return!(D.base[0]>this.max[0])&&(!(D.base[1]>this.max[1])&&(!(D.base[2]>this.max[2])&&(!(D.max[0]<this.base[0])&&(!(D.max[1]<this.base[1])&&!(D.max[2]<this.base[2])))))},k.touches=function(D){var j=this.union(D);return null!==j&&(0==j.width()||0==j.height()||0==j.depth())},k.union=function(D){if(!this.intersects(D))return null;var j=Math.max(D.base[0],this.base[0]),W=Math.max(D.base[1],this.base[1]),Q=Math.max(D.base[2],this.base[2]);return new C([j,W,Q],[Math.min(D.max[0],this.max[0])-j,Math.min(D.max[1],this.max[1])-W,Math.min(D.max[2],this.max[2])-Q])}},12870:(D,j)=>{"use strict";function W(D){var j=32;return(D&=-D)&&j--,65535&D&&(j-=16),16711935&D&&(j-=8),252645135&D&&(j-=4),858993459&D&&(j-=2),1431655765&D&&(j-=1),j}j.INT_BITS=32,j.INT_MAX=2147483647,j.INT_MIN=-1<<31,j.sign=function(D){return(D>0)-(D<0)},j.abs=function(D){var j=D>>31;return(D^j)-j},j.min=function(D,j){return j^(D^j)&-(D<j)},j.max=function(D,j){return D^(D^j)&-(D<j)},j.isPow2=function(D){return!(D&D-1)&&!!D},j.log2=function(D){var j,W;return j=(D>65535)<<4,j|=W=((D>>>=j)>255)<<3,j|=W=((D>>>=W)>15)<<2,(j|=W=((D>>>=W)>3)<<1)|(D>>>=W)>>1},j.log10=function(D){return D>=1e9?9:D>=1e8?8:D>=1e7?7:D>=1e6?6:D>=1e5?5:D>=1e4?4:D>=1e3?3:D>=100?2:D>=10?1:0},j.popCount=function(D){return 16843009*((D=(858993459&(D-=D>>>1&1431655765))+(D>>>2&858993459))+(D>>>4)&252645135)>>>24},j.countTrailingZeros=W,j.nextPow2=function(D){return D+=0===D,--D,D|=D>>>1,D|=D>>>2,D|=D>>>4,D|=D>>>8,(D|=D>>>16)+1},j.prevPow2=function(D){return D|=D>>>1,D|=D>>>2,D|=D>>>4,D|=D>>>8,(D|=D>>>16)-(D>>>1)},j.parity=function(D){return D^=D>>>16,D^=D>>>8,D^=D>>>4,27030>>>(D&=15)&1};var Q=new Array(256);!function(D){for(var j=0;j<256;++j){var W=j,Q=j,C=7;for(W>>>=1;W;W>>>=1)Q<<=1,Q|=1&W,--C;D[j]=Q<<C&255}}(Q),j.reverse=function(D){return Q[255&D]<<24|Q[D>>>8&255]<<16|Q[D>>>16&255]<<8|Q[D>>>24&255]},j.interleave2=function(D,j){return(D=1431655765&((D=858993459&((D=252645135&((D=16711935&((D&=65535)|D<<8))|D<<4))|D<<2))|D<<1))|(j=1431655765&((j=858993459&((j=252645135&((j=16711935&((j&=65535)|j<<8))|j<<4))|j<<2))|j<<1))<<1},j.deinterleave2=function(D,j){return(D=65535&((D=16711935&((D=252645135&((D=858993459&((D=D>>>j&1431655765)|D>>>1))|D>>>2))|D>>>4))|D>>>16))<<16>>16},j.interleave3=function(D,j,W){return D=1227133513&((D=3272356035&((D=251719695&((D=4278190335&((D&=1023)|D<<16))|D<<8))|D<<4))|D<<2),(D|=(j=1227133513&((j=3272356035&((j=251719695&((j=4278190335&((j&=1023)|j<<16))|j<<8))|j<<4))|j<<2))<<1)|(W=1227133513&((W=3272356035&((W=251719695&((W=4278190335&((W&=1023)|W<<16))|W<<8))|W<<4))|W<<2))<<2},j.deinterleave3=function(D,j){return(D=1023&((D=4278190335&((D=251719695&((D=3272356035&((D=D>>>j&1227133513)|D>>>2))|D>>>4))|D>>>8))|D>>>16))<<22>>22},j.nextCombination=function(D){var j=D|D-1;return j+1|(~j&-~j)-1>>>W(D)+1}},12855:(D,j,W)=>{"use strict";D.exports=function(D,j,W){switch(arguments.length){case 1:return Q=[],f(C=D,C,F,!0),Q;case 2:return"function"===typeof j?f(D,D,j,!0):function(D,j){return Q=[],f(D,j,F,!1),Q}(D,j);case 3:return f(D,j,W,!1);default:throw new Error("box-intersect: Invalid arguments")}var C};var Q,C=W(12861),k=W(12883),M=W(12895);function O(D,j){for(var W=0;W<D;++W)if(!(j[W]<=j[W+D]))return!0;return!1}function E(D,j,W,Q){for(var C=0,k=0,M=0,E=D.length;M<E;++M){var f=D[M];if(!O(j,f)){for(var F=0;F<2*j;++F)W[C++]=f[F];Q[k++]=M}}return k}function f(D,j,W,Q){var O=D.length,f=j.length;if(!(O<=0||f<=0)){var F=D[0].length>>>1;if(!(F<=0)){var Z,P=C.mallocDouble(2*F*O),X=C.mallocInt32(O);if((O=E(D,F,P,X))>0){if(1===F&&Q)k.init(O),Z=k.sweepComplete(F,W,0,O,P,X,0,O,P,X);else{var x=C.mallocDouble(2*F*f),R=C.mallocInt32(f);(f=E(j,F,x,R))>0&&(k.init(O+f),Z=1===F?k.sweepBipartite(F,W,0,O,P,X,0,f,x,R):M(F,W,Q,O,P,X,f,x,R),C.free(x),C.free(R))}C.free(P),C.free(X)}return Z}}}function F(D,j){Q.push([D,j])}},12903:(D,j)=>{"use strict";var W="d",Q="ax",C="fp",k="es",M="rs",O="re",E="rb",f="bs",F="be",Z="bb",P=[W,Q,"vv",M,O,E,"ri",f,F,Z,"bi"];function X(D){var j="bruteForce"+(D?"Full":"Partial"),Q=[],M=P.slice();D||M.splice(3,0,C);var O=["function "+j+"("+M.join()+"){"];function E(j,C){var M=function(D,j,Q){var C="bruteForce"+(D?"Red":"Blue")+(j?"Flip":"")+(Q?"Full":""),M=["function ",C,"(",P.join(),"){","var ",k,"=2*",W,";"],O="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",E="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(Q?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return D?M.push(O,"Q",":",E):M.push(E,"Q",":",O),Q?M.push("if(y1<x0||x1<y0)continue;"):j?M.push("if(y0<=x0||x1<y0)continue;"):M.push("if(y0<x0||x1<y0)continue;"),M.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),j?M.push("yi,xi"):M.push("xi,yi"),M.push(");if(rv!==void 0)return rv;}}}"),{name:C,code:M.join("")}}(j,C,D);Q.push(M.code),O.push("return "+M.name+"("+P.join()+");")}O.push("if(re-rs>be-bs){"),D?(E(!0,!1),O.push("}else{"),E(!1,!1)):(O.push("if(fp){"),E(!0,!0),O.push("}else{"),E(!0,!1),O.push("}}else{if(fp){"),E(!1,!0),O.push("}else{"),E(!1,!1),O.push("}")),O.push("}}return "+j);var f=Q.join("")+O.join("");return new Function(f)()}j.partial=X(!1),j.full=X(!0)},12895:(D,j,W)=>{"use strict";D.exports=function(D,j,W,k,F,t,c,l,I){!function(D,j){var W=8*C.log2(j+1)*(D+1)|0,k=C.nextPow2(G*W);L.length<k&&(Q.free(L),L=Q.mallocInt32(k));var M=C.nextPow2(K*W);e.length<M&&(Q.free(e),e=Q.mallocDouble(M))}(D,k+c);var y,m=0,a=2*D;s(m++,0,0,k,0,c,W?16:0,-1/0,1/0),W||s(m++,0,0,c,0,k,1,-1/0,1/0);for(;m>0;){var S=(m-=1)*G,H=L[S],z=L[S+1],i=L[S+2],p=L[S+3],T=L[S+4],A=L[S+5],w=m*K,n=e[w],u=e[w+1],q=1&A,o=!!(16&A),J=F,h=t,d=l,v=I;if(q&&(J=l,h=I,d=F,v=t),!(2&A&&z>=(i=V(D,H,z,i,J,h,u)))&&!(4&A&&(z=U(D,H,z,i,J,h,n))>=i)){var B=i-z,r=T-p;if(o){if(D*B*(B+r)<X){if(void 0!==(y=E.scanComplete(D,H,j,z,i,J,h,p,T,d,v)))return y;continue}}else{if(D*Math.min(B,r)<Z){if(void 0!==(y=M(D,H,j,q,z,i,J,h,p,T,d,v)))return y;continue}if(D*B*r<P){if(void 0!==(y=E.scanBipartite(D,H,j,q,z,i,J,h,p,T,d,v)))return y;continue}}var DD=x(D,H,z,i,J,h,n,u);if(z<DD)if(D*(DD-z)<Z){if(void 0!==(y=O(D,H+1,j,z,DD,J,h,p,T,d,v)))return y}else if(H===D-2){if(void 0!==(y=q?E.sweepBipartite(D,j,p,T,d,v,z,DD,J,h):E.sweepBipartite(D,j,z,DD,J,h,p,T,d,v)))return y}else s(m++,H+1,z,DD,p,T,q,-1/0,1/0),s(m++,H+1,p,T,z,DD,1^q,-1/0,1/0);if(DD<i){var jD=f(D,H,p,T,d,v),WD=d[a*jD+H],QD=R(D,H,jD,T,d,v,WD);if(QD<T&&s(m++,H,DD,i,QD,T,(4|q)+(o?16:0),WD,u),p<jD&&s(m++,H,DD,i,p,jD,(2|q)+(o?16:0),n,WD),jD+1===QD){if(void 0!==(y=o?Y(D,H,j,DD,i,J,h,jD,d,v[jD]):b(D,H,j,q,DD,i,J,h,jD,d,v[jD])))return y}else if(jD<QD){var CD;if(o){if(DD<(CD=g(D,H,DD,i,J,h,WD))){var kD=R(D,H,DD,CD,J,h,WD);if(H===D-2){if(DD<kD&&void 0!==(y=E.sweepComplete(D,j,DD,kD,J,h,jD,QD,d,v)))return y;if(kD<CD&&void 0!==(y=E.sweepBipartite(D,j,kD,CD,J,h,jD,QD,d,v)))return y}else DD<kD&&s(m++,H+1,DD,kD,jD,QD,16,-1/0,1/0),kD<CD&&(s(m++,H+1,kD,CD,jD,QD,0,-1/0,1/0),s(m++,H+1,jD,QD,kD,CD,1,-1/0,1/0))}}else DD<(CD=q?N(D,H,DD,i,J,h,WD):g(D,H,DD,i,J,h,WD))&&(H===D-2?y=q?E.sweepBipartite(D,j,jD,QD,d,v,DD,CD,J,h):E.sweepBipartite(D,j,DD,CD,J,h,jD,QD,d,v):(s(m++,H+1,DD,CD,jD,QD,q,-1/0,1/0),s(m++,H+1,jD,QD,DD,CD,1^q,-1/0,1/0)))}}}}};var Q=W(12861),C=W(12870),k=W(12903),M=k.partial,O=k.full,E=W(12883),f=W(12911),F=W(12916),Z=128,P=1<<22,X=1<<22,x=F("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),R=F("lo===p0",["p0"]),V=F("lo<p0",["p0"]),U=F("hi<=p0",["p0"]),g=F("lo<=p0&&p0<=hi",["p0"]),N=F("lo<p0&&p0<=hi",["p0"]),G=6,K=2,L=Q.mallocInt32(1024),e=Q.mallocDouble(1024);function s(D,j,W,Q,C,k,M,O,E){var f=G*D;L[f]=j,L[f+1]=W,L[f+2]=Q,L[f+3]=C,L[f+4]=k,L[f+5]=M;var F=K*D;e[F]=O,e[F+1]=E}function b(D,j,W,Q,C,k,M,O,E,f,F){var Z=2*D,P=E*Z,X=f[P+j];D:for(var x=C,R=C*Z;x<k;++x,R+=Z){var V=M[R+j],U=M[R+j+D];if(!(X<V||U<X)&&(!Q||X!==V)){for(var g,N=O[x],G=j+1;G<D;++G){V=M[R+G],U=M[R+G+D];var K=f[P+G],L=f[P+G+D];if(U<K||L<V)continue D}if(void 0!==(g=Q?W(F,N):W(N,F)))return g}}}function Y(D,j,W,Q,C,k,M,O,E,f){var F=2*D,Z=O*F,P=E[Z+j];D:for(var X=Q,x=Q*F;X<C;++X,x+=F){var R=M[X];if(R!==f){var V=k[x+j],U=k[x+j+D];if(!(P<V||U<P)){for(var g=j+1;g<D;++g){V=k[x+g],U=k[x+g+D];var N=E[Z+g],G=E[Z+g+D];if(U<N||G<V)continue D}var K=W(R,f);if(void 0!==K)return K}}}}},12911:(D,j,W)=>{"use strict";D.exports=function(D,j,W,M,O,E){if(M<=W+1)return W;var f=W,F=M,Z=M+W>>>1,P=2*D,X=Z,x=O[P*Z+j];for(;f<F;){if(F-f<C){k(D,j,f,F,O,E),x=O[P*Z+j];break}var R=F-f,V=Math.random()*R+f|0,U=O[P*V+j],g=Math.random()*R+f|0,N=O[P*g+j],G=Math.random()*R+f|0,K=O[P*G+j];U<=N?K>=N?(X=g,x=N):U>=K?(X=V,x=U):(X=G,x=K):N>=K?(X=g,x=N):K>=U?(X=V,x=U):(X=G,x=K);for(var L=P*(F-1),e=P*X,s=0;s<P;++s,++L,++e){var b=O[L];O[L]=O[e],O[e]=b}var Y=E[F-1];E[F-1]=E[X],E[X]=Y;for(L=P*(F-1),e=P*(X=Q(D,j,f,F-1,O,E,x)),s=0;s<P;++s,++L,++e){b=O[L];O[L]=O[e],O[e]=b}Y=E[F-1];if(E[F-1]=E[X],E[X]=Y,Z<X){for(F=X-1;f<F&&O[P*(F-1)+j]===x;)F-=1;F+=1}else{if(!(X<Z))break;for(f=X+1;f<F&&O[P*f+j]===x;)f+=1}}return Q(D,j,W,Z,O,E,O[P*Z+j])};var Q=W(12916)("lo<p0",["p0"]),C=8;function k(D,j,W,Q,C,k){for(var M=2*D,O=M*(W+1)+j,E=W+1;E<Q;++E,O+=M)for(var f=C[O],F=E,Z=M*(E-1);F>W&&C[Z+j]>f;--F,Z-=M){for(var P=Z,X=Z+M,x=0;x<M;++x,++P,++X){var R=C[P];C[P]=C[X],C[X]=R}var V=k[F];k[F]=k[F-1],k[F-1]=V}}},12916:D=>{"use strict";D.exports=function(D,W){var Q="abcdef".split("").concat(W),C=[];D.indexOf("lo")>=0&&C.push("lo=e[k+n]");D.indexOf("hi")>=0&&C.push("hi=e[k+o]");return Q.push(j.replace("_",C.join()).replace("$",D)),Function.apply(void 0,Q)};var j="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},12892:D=>{"use strict";D.exports=function(D,Q){Q<=4*j?W(0,Q-1,D):f(0,Q-1,D)};var j=32;function W(D,j,W){for(var Q=2*(D+1),C=D+1;C<=j;++C){for(var k=W[Q++],M=W[Q++],O=C,E=Q-2;O-- >D;){var f=W[E-2],F=W[E-1];if(f<k)break;if(f===k&&F<M)break;W[E]=f,W[E+1]=F,E-=2}W[E]=k,W[E+1]=M}}function Q(D,j,W){j*=2;var Q=W[D*=2],C=W[D+1];W[D]=W[j],W[D+1]=W[j+1],W[j]=Q,W[j+1]=C}function C(D,j,W){j*=2,W[D*=2]=W[j],W[D+1]=W[j+1]}function k(D,j,W,Q){j*=2,W*=2;var C=Q[D*=2],k=Q[D+1];Q[D]=Q[j],Q[D+1]=Q[j+1],Q[j]=Q[W],Q[j+1]=Q[W+1],Q[W]=C,Q[W+1]=k}function M(D,j,W,Q,C){j*=2,C[D*=2]=C[j],C[j]=W,C[D+1]=C[j+1],C[j+1]=Q}function O(D,j,W){j*=2;var Q=W[D*=2],C=W[j];return!(Q<C)&&(Q!==C||W[D+1]>W[j+1])}function E(D,j,W,Q){var C=Q[D*=2];return C<j||C===j&&Q[D+1]<W}function f(D,F,Z){var P=(F-D+1)/6|0,X=D+P,x=F-P,R=D+F>>1,V=R-P,U=R+P,g=X,N=V,G=R,K=U,L=x,e=D+1,s=F-1,b=0;O(g,N,Z)&&(b=g,g=N,N=b),O(K,L,Z)&&(b=K,K=L,L=b),O(g,G,Z)&&(b=g,g=G,G=b),O(N,G,Z)&&(b=N,N=G,G=b),O(g,K,Z)&&(b=g,g=K,K=b),O(G,K,Z)&&(b=G,G=K,K=b),O(N,L,Z)&&(b=N,N=L,L=b),O(N,G,Z)&&(b=N,N=G,G=b),O(K,L,Z)&&(b=K,K=L,L=b);for(var Y=Z[2*N],t=Z[2*N+1],c=Z[2*K],l=Z[2*K+1],I=2*g,y=2*G,m=2*L,a=2*X,S=2*R,H=2*x,z=0;z<2;++z){var i=Z[I+z],p=Z[y+z],T=Z[m+z];Z[a+z]=i,Z[S+z]=p,Z[H+z]=T}C(V,D,Z),C(U,F,Z);for(var A=e;A<=s;++A)if(E(A,Y,t,Z))A!==e&&Q(A,e,Z),++e;else if(!E(A,c,l,Z))for(;;){if(E(s,c,l,Z)){E(s,Y,t,Z)?(k(A,e,s,Z),++e,--s):(Q(A,s,Z),--s);break}if(--s<A)break}M(D,e-1,Y,t,Z),M(F,s+1,c,l,Z),e-2-D<=j?W(D,e-2,Z):f(D,e-2,Z),F-(s+2)<=j?W(s+2,F,Z):f(s+2,F,Z),s-e<=j?W(e,s,Z):f(e,s,Z)}},12883:(D,j,W)=>{"use strict";D.exports={init:function(D){var j=C.nextPow2(D);E.length<j&&(Q.free(E),E=Q.mallocInt32(j));f.length<j&&(Q.free(f),f=Q.mallocInt32(j));F.length<j&&(Q.free(F),F=Q.mallocInt32(j));Z.length<j&&(Q.free(Z),Z=Q.mallocInt32(j));P.length<j&&(Q.free(P),P=Q.mallocInt32(j));X.length<j&&(Q.free(X),X=Q.mallocInt32(j));var W=8*j;x.length<W&&(Q.free(x),x=Q.mallocDouble(W))},sweepBipartite:function(D,j,W,Q,C,O,P,X,U,g){for(var N=0,G=2*D,K=D-1,L=G-1,e=W;e<Q;++e){var s=O[e],b=G*e;x[N++]=C[b+K],x[N++]=-(s+1),x[N++]=C[b+L],x[N++]=s}for(e=P;e<X;++e){s=g[e]+M;var Y=G*e;x[N++]=U[Y+K],x[N++]=-s,x[N++]=U[Y+L],x[N++]=s}var t=N>>>1;k(x,t);var c=0,l=0;for(e=0;e<t;++e){var I=0|x[2*e+1];if(I>=M)R(F,Z,l--,I=I-M|0);else if(I>=0)R(E,f,c--,I);else if(I<=-M){I=-I-M|0;for(var y=0;y<c;++y){if(void 0!==(m=j(E[y],I)))return m}V(F,Z,l++,I)}else{I=-I-1|0;for(y=0;y<l;++y){var m;if(void 0!==(m=j(I,F[y])))return m}V(E,f,c++,I)}}},sweepComplete:function(D,j,W,Q,C,M,O,U,g,N){for(var G=0,K=2*D,L=D-1,e=K-1,s=W;s<Q;++s){var b=M[s]+1<<1,Y=K*s;x[G++]=C[Y+L],x[G++]=-b,x[G++]=C[Y+e],x[G++]=b}for(s=O;s<U;++s){b=N[s]+1<<1;var t=K*s;x[G++]=g[t+L],x[G++]=1|-b,x[G++]=g[t+e],x[G++]=1|b}var c=G>>>1;k(x,c);var l=0,I=0,y=0;for(s=0;s<c;++s){var m=0|x[2*s+1],a=1&m;if(s<c-1&&m>>1===x[2*s+3]>>1&&(a=2,s+=1),m<0){for(var S=-(m>>1)-1,H=0;H<y;++H){if(void 0!==(z=j(P[H],S)))return z}if(0!==a)for(H=0;H<l;++H){if(void 0!==(z=j(E[H],S)))return z}if(1!==a)for(H=0;H<I;++H){var z;if(void 0!==(z=j(F[H],S)))return z}0===a?V(E,f,l++,S):1===a?V(F,Z,I++,S):2===a&&V(P,X,y++,S)}else{S=(m>>1)-1;0===a?R(E,f,l--,S):1===a?R(F,Z,I--,S):2===a&&R(P,X,y--,S)}}},scanBipartite:function(D,j,W,Q,C,O,F,Z,P,X,U,g){var N=0,G=2*D,K=j,L=j+D,e=1,s=1;Q?s=M:e=M;for(var b=C;b<O;++b){var Y=b+e,t=G*b;x[N++]=F[t+K],x[N++]=-Y,x[N++]=F[t+L],x[N++]=Y}for(b=P;b<X;++b){Y=b+s;var c=G*b;x[N++]=U[c+K],x[N++]=-Y}var l=N>>>1;k(x,l);var I=0;for(b=0;b<l;++b){var y=0|x[2*b+1];if(y<0){var m=!1;if((Y=-y)>=M?(m=!Q,Y-=M):(m=!!Q,Y-=1),m)V(E,f,I++,Y);else{var a=g[Y],S=G*Y,H=U[S+j+1],z=U[S+j+1+D];D:for(var i=0;i<I;++i){var p=E[i],T=G*p;if(!(z<F[T+j+1]||F[T+j+1+D]<H)){for(var A=j+2;A<D;++A)if(U[S+A+D]<F[T+A]||F[T+A+D]<U[S+A])continue D;var w,n=Z[p];if(void 0!==(w=Q?W(a,n):W(n,a)))return w}}}}else R(E,f,I--,y-e)}},scanComplete:function(D,j,W,Q,C,O,f,F,Z,P,X){for(var R=0,V=2*D,U=j,g=j+D,N=Q;N<C;++N){var G=N+M,K=V*N;x[R++]=O[K+U],x[R++]=-G,x[R++]=O[K+g],x[R++]=G}for(N=F;N<Z;++N){G=N+1;var L=V*N;x[R++]=P[L+U],x[R++]=-G}var e=R>>>1;k(x,e);var s=0;for(N=0;N<e;++N){var b=0|x[2*N+1];if(b<0){if((G=-b)>=M)E[s++]=G-M;else{var Y=X[G-=1],t=V*G,c=P[t+j+1],l=P[t+j+1+D];D:for(var I=0;I<s;++I){var y=E[I],m=f[y];if(m===Y)break;var a=V*y;if(!(l<O[a+j+1]||O[a+j+1+D]<c)){for(var S=j+2;S<D;++S)if(P[t+S+D]<O[a+S]||O[a+S+D]<P[t+S])continue D;var H=W(m,Y);if(void 0!==H)return H}}}}else{for(G=b-M,I=s-1;I>=0;--I)if(E[I]===G){for(S=I+1;S<s;++S)E[S-1]=E[S];break}--s}}}};var Q=W(12861),C=W(12870),k=W(12892),M=1<<28,O=1024,E=Q.mallocInt32(O),f=Q.mallocInt32(O),F=Q.mallocInt32(O),Z=Q.mallocInt32(O),P=Q.mallocInt32(O),X=Q.mallocInt32(O),x=Q.mallocDouble(8192);function R(D,j,W,Q){var C=j[Q],k=D[W-1];D[C]=k,j[k]=C}function V(D,j,W,Q){D[W]=Q,j[Q]=W}},12874:D=>{"use strict";function j(D,W,Q){var C=0|D[Q];if(C<=0)return[];var k,M=new Array(C);if(Q===D.length-1)for(k=0;k<C;++k)M[k]=W;else for(k=0;k<C;++k)M[k]=j(D,W,Q+1);return M}D.exports=function(D,W){switch("undefined"===typeof W&&(W=0),typeof D){case"number":if(D>0)return function(D,j){var W,Q;for(W=new Array(D),Q=0;Q<D;++Q)W[Q]=j;return W}(0|D,W);break;case"object":if("number"===typeof D.length)return j(D,W,0)}return[]}},12829:(D,j,W)=>{D.exports=function(){var D=this;this.components={},this.comps=this.components;var j=this.components,W=1,C={},k=[],M=[],O={timeout:!1,removals:[],multiComps:[]};function E(D,W){var Q=j[W],k=C[W],M=k.hash[D];M&&(k.remove(D),Q.ab&&(Q.multi?(M.forEach((j=>{j&&Q.ab(D,j)})),M.length=0):Q.ab(D,M)),O.removals.push(k),f())}function f(){O.timeout||(O.timeout=!0,setTimeout(F,1))}function F(){O.timeout=!1,Z()}function Z(){O.multiComps.length&&function(D){for(var j=0;j<D.length;j++){var{entID:W,data:Q}=D[j],C=Q.hash[W];if(C){for(var k=0;k<C.length;k++)C[k]||(C.splice(k,1),k--);0===C.length&&(Q.remove(W),O.removals.push(Q))}}D.length=0}(O.multiComps),O.removals.length&&function(D){for(var j=0;j<D.length;j++){D[j].flush()}D.length=0}(O.removals)}this._i=C,this._systems=k,this._renderSystems=M,this.Rh=function(j){var Q=W++;return Array.isArray(j)&&j.forEach((j=>D.Hf(Q,j))),Q},this.deleteEntity=function(j){return Object.keys(C).forEach((D=>{C[D].hash[j]&&E(j,D)})),D},this.fi=function(D){if(!D)throw new Error("Missing component definition");var W=D.name;if(!W)throw new Error("Component definition must have a name property.");if("string"!==typeof W)throw new Error("Component name must be a string.");if(""===W)throw new Error("Component name must be a non-empty string.");if(C[W])throw new Error(`Component ${W} already exists.`);var O={};return O.name=W,O.multi=!!D.multi,O.order=isNaN(D.order)?99:D.order,O.stateConstructor=D.stateConstructor||null,O.state=D.state||{},O.Pf=D.Pf||null,O.ab=D.ab||null,O.system=D.system||null,O.eh=D.eh||null,j[W]=O,C[W]=new Q,C[W]._pendingMultiCleanup=!1,C[W]._multiCleanupIDs=O.multi?[]:null,O.system&&(k.push(W),k.sort(((D,W)=>j[D].order-j[W].order))),O.eh&&(M.push(W),M.sort(((D,W)=>j[D].order-j[W].order))),W},this.overwriteComponent=function(D,W){var Q=j[D];if(!Q)throw new Error(`Unknown component: ${D}`);if(!W)throw new Error("Missing component definition");if(Q.name!==W.name)throw new Error("Overwriting component must use the same name property.");var O={};O.name=D,O.multi=!!W.multi,O.order=isNaN(W.order)?99:W.order,O.state=W.state||{},O.Pf=W.Pf||null,O.ab=W.ab||null,O.system=W.system||null,O.eh=W.eh||null,j[D]=O,C[D]._pendingMultiCleanup=!1,C[D]._multiCleanupIDs=O.multi?[]:null;var E=k.indexOf(D);O.system&&E<0&&k.push(D),!O.system&&E>=0&&k.splice(E,1),k.sort(((D,W)=>j[D].order-j[W].order));var f=M.indexOf(D);O.eh&&f<0&&M.push(D),!O.eh&&f>=0&&M.splice(f,1),M.sort(((D,W)=>j[D].order-j[W].order));var F=O.state;return this.jh(D).forEach((D=>{for(var j in F)j in D||(D[j]=F[j]);O.Pf&&O.Pf(D.dh,D)})),D},this.deleteComponent=function(W){var Q=C[W];if(!Q)throw new Error(`Unknown component: ${W}`);Q.flush(),Q.list.forEach((D=>{D&&E(D.dh||D[0].dh,W)}));var O=k.indexOf(W),f=M.indexOf(W);return O>-1&&k.splice(O,1),f>-1&&M.splice(f,1),C[W].dispose(),delete C[W],delete j[W],D},this.Hf=function(D,W,Q){var k,M=j[W],O=C[W];if(!O)throw new Error(`Unknown component: ${W}.`);if(O.hash[D]&&!M.multi)throw new Error(`Entity ${D} already has component: ${W}.`);if(M.stateConstructor){if(!(k=new M.stateConstructor).hasOwnProperty("dh"))throw new Error(`Component ${M.name} stateConstructor type does not have property __id`)}else k=Object.assign({},{dh:D},M.state,Q);if(k.dh=D,M.multi){var E=O.hash[D];E||(E=[],O.add(D,E)),E.push(k)}else O.add(D,k);return M.Pf&&M.Pf(D,k),this},this.Xf=function(D,j){var W=C[j];if(!W)throw new Error(`Unknown component: ${j}.`);return!!W.hash[D]},this.Mf=function(j,W){if(!C[W])throw new Error(`Unknown component: ${W}.`);return E(j,W),D},this.getState=function(D,j){var W=C[j];if(!W)throw new Error(`Unknown component: ${j}.`);return W.hash[D]},this.jh=function(D){var j=C[D];if(!j)throw new Error(`Unknown component: ${D}.`);return Z(),j.list},this.Jk=function(D){if(!C[D])throw new Error(`Unknown component: ${D}.`);var j=C[D].hash;return D=>j[D]},this.Mk=function(D){if(!C[D])throw new Error(`Unknown component: ${D}.`);var j=C[D].hash;return D=>!!j[D]},this.Df=function(W){Z();for(var Q=0;Q<k.length;Q++){var M=k[Q],O=j[M],E=C[M];O.system(W,E.list),Z()}return D},this.render=function(W){Z();for(var Q=0;Q<M.length;Q++){var k=M[Q],O=j[k],E=C[k];O.eh(W,E.list),Z()}return D},this.removeMultiComponent=function(W,Q,k){var M=j[Q],E=C[Q];if(!E)throw new Error(`Unknown component: ${Q}.`);if(!M.multi)throw new Error("removeMultiComponent called on non-multi component");return function(D,j,W,Q){var C=W.hash[D];if(C){var k=C[Q];k&&(C[Q]=null,j.ab&&j.ab(D,k),O.multiComps.push({entID:D,data:W}),f())}}(W,M,E,k),D}};var Q=W(12836)},12836:D=>{function j(D,j){var W=D._map[j];if(delete D.hash[j],delete D._map[j],W===D.list.length-1)D.list.pop();else{var Q=D.list.pop();if(D.list[W]=Q,null===Q||null===Q[0]){var C=D.list.length;for(var k in D._map)if(D._map[k]===C)return void(D._map[k]=W)}else{var M=Q.dh||Q[0].dh;D._map[M]=W}}}D.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(D,j){if("number"===typeof this._map[D]){var W=this._map[D];this.hash[D]=j,this.list[W]=j}else this._map[D]=this.list.length,this.hash[D]=j,this.list.push(j)}remove(D){var j=this._map[D];this.hash[D]=null,this.list[j]=null,this._pendingRemovals.push(D)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var D=0;D<this._pendingRemovals.length;D++){var W=this._pendingRemovals[D];null===this.hash[W]&&j(this,W)}this._pendingRemovals.length=0}}},12784:D=>{"use strict";var j,W="object"===typeof Reflect?Reflect:null,Q=function(D,j,W){return Function.prototype.apply.call(D,j,W)};j=W&&"function"===typeof W.ownKeys?W.ownKeys:Object.getOwnPropertySymbols?function(D){return Object.getOwnPropertyNames(D).concat(Object.getOwnPropertySymbols(D))}:function(D){return Object.getOwnPropertyNames(D)};var C=Number.isNaN||function(D){return D!==D};function k(){k.init.call(this)}D.exports=k,D.exports.once=function(D,j){return new Promise((function(W,Q){function C(W){D.removeListener(j,k),Q(W)}function k(){"function"===typeof D.removeListener&&D.removeListener("error",C),W([].slice.call(arguments))}R(D,j,k,{once:!0}),"error"!==j&&function(D,j,W){"function"===typeof D.on&&R(D,"error",j,W)}(D,C,{once:!0})}))},k.EventEmitter=k,k.prototype._events=void 0,k.prototype._eventsCount=0,k.prototype._maxListeners=void 0;var M=10;function O(D){if("function"!==typeof D)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof D)}function E(D){return void 0===D._maxListeners?k.defaultMaxListeners:D._maxListeners}function f(D,j,W,Q){var C,k,M,f;if(O(W),void 0===(k=D._events)?(k=D._events=Object.create(null),D._eventsCount=0):(void 0!==k.newListener&&(D.emit("newListener",j,W.listener?W.listener:W),k=D._events),M=k[j]),void 0===M)M=k[j]=W,++D._eventsCount;else if("function"===typeof M?M=k[j]=Q?[W,M]:[M,W]:Q?M.unshift(W):M.push(W),(C=E(D))>0&&M.length>C&&!M.warned){M.warned=!0;var F=new Error("Possible EventEmitter memory leak detected. "+M.length+" "+String(j)+" listeners added. Use emitter.setMaxListeners() to increase limit");F.name="MaxListenersExceededWarning",F.k=D,F.type=j,F.count=M.length,f=F,console&&console.warn&&console.warn(f)}return D}function F(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Z(D,j,W){var Q={fired:!1,wrapFn:void 0,target:D,type:j,listener:W},C=F.bind(Q);return C.listener=W,Q.wrapFn=C,C}function P(D,j,W){var Q=D._events;if(void 0===Q)return[];var C=Q[j];return void 0===C?[]:"function"===typeof C?W?[C.listener||C]:[C]:W?function(D){for(var j=new Array(D.length),W=0;W<j.length;++W)j[W]=D[W].listener||D[W];return j}(C):x(C,C.length)}function X(D){var j=this._events;if(void 0!==j){var W=j[D];if("function"===typeof W)return 1;if(void 0!==W)return W.length}return 0}function x(D,j){for(var W=new Array(j),Q=0;Q<j;++Q)W[Q]=D[Q];return W}function R(D,j,W,Q){if("function"===typeof D.on)Q.once?D.once(j,W):D.on(j,W);else{if("function"!==typeof D.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof D);D.addEventListener(j,(function C(k){Q.once&&D.removeEventListener(j,C),W(k)}))}}Object.defineProperty(k,"defaultMaxListeners",{enumerable:!0,get:function(){return M},set:function(D){if("number"!==typeof D||D<0||C(D))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+D+".");M=D}}),k.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},k.prototype.setMaxListeners=function(D){if("number"!==typeof D||D<0||C(D))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+D+".");return this._maxListeners=D,this},k.prototype.getMaxListeners=function(){return E(this)},k.prototype.emit=function(D){for(var j=[],W=1;W<arguments.length;W++)j.push(arguments[W]);var C="error"===D,k=this._events;if(void 0!==k)C=C&&void 0===k.error;else if(!C)return!1;if(C){var M;if(j.length>0&&(M=j[0]),M instanceof Error)throw M;var O=new Error("Unhandled error."+(M?" ("+M.message+")":""));throw O.context=M,O}var E=k[D];if(void 0===E)return!1;if("function"===typeof E)Q(E,this,j);else{var f=E.length,F=x(E,f);for(W=0;W<f;++W)Q(F[W],this,j)}return!0},k.prototype.addListener=function(D,j){return f(this,D,j,!1)},k.prototype.on=k.prototype.addListener,k.prototype.prependListener=function(D,j){return f(this,D,j,!0)},k.prototype.once=function(D,j){return O(j),this.on(D,Z(this,D,j)),this},k.prototype.prependOnceListener=function(D,j){return O(j),this.prependListener(D,Z(this,D,j)),this},k.prototype.removeListener=function(D,j){var W,Q,C,k,M;if(O(j),void 0===(Q=this._events))return this;if(void 0===(W=Q[D]))return this;if(W===j||W.listener===j)0===--this._eventsCount?this._events=Object.create(null):(delete Q[D],Q.removeListener&&this.emit("removeListener",D,W.listener||j));else if("function"!==typeof W){for(C=-1,k=W.length-1;k>=0;k--)if(W[k]===j||W[k].listener===j){M=W[k].listener,C=k;break}if(C<0)return this;0===C?W.shift():function(D,j){for(;j+1<D.length;j++)D[j]=D[j+1];D.pop()}(W,C),1===W.length&&(Q[D]=W[0]),void 0!==Q.removeListener&&this.emit("removeListener",D,M||j)}return this},k.prototype.off=k.prototype.removeListener,k.prototype.removeAllListeners=function(D){var j,W,Q;if(void 0===(W=this._events))return this;if(void 0===W.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==W[D]&&(0===--this._eventsCount?this._events=Object.create(null):delete W[D]),this;if(0===arguments.length){var C,k=Object.keys(W);for(Q=0;Q<k.length;++Q)"removeListener"!==(C=k[Q])&&this.removeAllListeners(C);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(j=W[D]))this.removeListener(D,j);else if(void 0!==j)for(Q=j.length-1;Q>=0;Q--)this.removeListener(D,j[Q]);return this},k.prototype.listeners=function(D){return P(this,D,!0)},k.prototype.rawListeners=function(D){return P(this,D,!1)},k.listenerCount=function(D,j){return"function"===typeof D.listenerCount?D.listenerCount(j):X.call(D,j)},k.prototype.listenerCount=X,k.prototype.eventNames=function(){return this._eventsCount>0?j(this._events):[]}},13104:D=>{"use strict";D.exports=function(D,j,W,Q,C,k){var M=+j[0],O=+j[1],E=+j[2],f=+W[0],F=+W[1],Z=+W[2],P=Math.sqrt(f*f+F*F+Z*Z);if(0===P)throw new Error("Can't raycast along a zero vector");return function(D,j,W,Q,C,k,M,O,E,f){for(var F=0,Z=Math.floor,P=0|Z(j),X=0|Z(W),x=0|Z(Q),R=C>0?1:-1,V=k>0?1:-1,U=M>0?1:-1,g=Math.abs(1/C),N=Math.abs(1/k),G=Math.abs(1/M),K=g<1/0?g*(R>0?P+1-j:j-P):1/0,L=N<1/0?N*(V>0?X+1-W:W-X):1/0,e=G<1/0?G*(U>0?x+1-Q:Q-x):1/0,s=-1;F<=O;){var b=D(P,X,x);if(b)return E&&(E[0]=j+F*C,E[1]=W+F*k,E[2]=Q+F*M),f&&(f[0]=f[1]=f[2]=0,0===s&&(f[0]=-R),1===s&&(f[1]=-V),2===s&&(f[2]=-U)),b;K<L?K<e?(P+=R,F=K,K+=g,s=0):(x+=U,F=e,e+=G,s=2):L<e?(X+=V,F=L,L+=N,s=1):(x+=U,F=e,e+=G,s=2)}return E&&(E[0]=j+F*C,E[1]=W+F*k,E[2]=Q+F*M),f&&(f[0]=f[1]=f[2]=0),0}(D,M,O,E,f/=P,F/=P,Z/=P,Q="undefined"===typeof Q?64:+Q,C,k)}},13147:(D,j,W)=>{"use strict";W.d(j,{b:()=>k});var Q=W(12784);function C(){this.Jj=!1,this.stopPropagation=!1,this.Kj=!1,this.disabled=!1}class k{constructor(D,j){this.version="0.7.0";var W=Object.assign({},new C,j||{});this.element=D||document,this.Jj=!!W.Jj,this.stopPropagation=!!W.stopPropagation,this.Kj=!!W.Kj,this.disabled=!!W.disabled,this.filterEvents=(D,j)=>!0,this.down=new Q.EventEmitter,this.up=new Q.EventEmitter,this.state={},this.Vg={dx:0,dy:0,Ak:0,Tg:0,Bk:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?O(this):document.addEventListener("DOMContentLoaded",(D=>{O(this)}),{once:!0})}bind(D){for(var j=arguments.length,W=new Array(j>1?j-1:0),Q=1;Q<j;Q++)W[Q-1]=arguments[Q];W.forEach((j=>{var W=this._keyBindmap[j]||[];W.includes(D)||(W.push(D),this._keyBindmap[j]=W)})),this.state[D]=!!this.state[D],this.pressCount[D]=this.pressCount[D]||0,this.releaseCount[D]=this.releaseCount[D]||0}unbind(D){for(var j in this._keyBindmap){var W=this._keyBindmap[j],Q=W.indexOf(D);Q>-1&&W.splice(Q,1)}}getBindings(){var D={};for(var j in this._keyBindmap){this._keyBindmap[j].forEach((W=>{D[W]=D[W]||[],D[W].push(j)}))}return D}Df(){M(this.Vg),M(this.pressCount),M(this.releaseCount)}}function M(D){for(var j in D)D[j]=0}function O(D){window.addEventListener("keydown",x.bind(null,D,!0),!1),window.addEventListener("keyup",x.bind(null,D,!1),!1);var j={passive:!0};D.element.addEventListener("touchstart",Z.bind(void 0,D),{passive:!1}),D.element.addEventListener("touchend",X.bind(void 0,D),j),D.element.addEventListener("mousedown",R.bind(null,D,!0),j),window.document.addEventListener("mouseup",R.bind(null,D,!1),j),D.element.addEventListener("touchmove",V.bind(null,D),j),D.element.addEventListener("mousemove",V.bind(null,D),j),window.PointerEvent,D.element.addEventListener("wheel",U.bind(null,D),j),D.element.addEventListener("contextmenu",g.bind(null,D),!1),window.addEventListener("blur",N.bind(null,D),!1)}var E=0,f=0,F=null;function Z(D,j){j.preventDefault(),P(j)}function P(D){let j=!1;for(let W=0;W<D.touches.length;++W)if(D.touches[W].identifier===F){j=!0;break}if(!j){const j=D.changedTouches[0];E=j.clientX,f=j.clientY,F=j.identifier}}function X(D,j){for(var W=j.changedTouches,Q=0;Q<W.length;++Q)W[Q].identifier===F&&(F=null)}function x(D,j,W){G(W.code,j,D,W)}function R(D,j,W){if("pointerId"in W)if(j){if(null!==D._touches.currID)return;D._touches.currID=W.pointerId}else{if(D._touches.currID!==W.pointerId)return;D._touches.currID=null}return G("Mouse"+("button"in W?W.button+1:1),j,D,W),!1}function V(D,j){var W=j.movementX||j.mozMovementX||0,Q=j.movementY||j.mozMovementY||0;if(j.touches&&0===(W|Q)){var C=function(D){P(D);for(let j=0;j<D.changedTouches.length;++j)if(D.changedTouches[j].identifier==F){const W=D.changedTouches[j],Q=[W.clientX-E,W.clientY-f];return E=W.clientX,f=W.clientY,Q}return console.error(`Did not find touch id ${F}`),[0,0]}(j);W=C[0],Q=C[1]}D.Vg.dx+=W,D.Vg.dy+=Q}function U(D,j){var W=1;switch(j.deltaMode){case 0:W=1;break;case 1:W=12;break;case 2:W=D.element.clientHeight||window.innerHeight}D.Vg.Ak+=(j.deltaX||0)*W,D.Vg.Tg+=(j.deltaY||0)*W,D.Vg.Bk+=(j.deltaZ||0)*W}function g(D,j){if(!D.Kj)return j.preventDefault(),!1}function N(D){for(var j in D._keyStates)D._keyStates[j]&&(/^Mouse\d/.test(j)||G(j,!1,D,{code:j,note:"This is a mocked KeyboardEvent made by the 'game-inputs' module",preventDefault:()=>{},stopPropagation:()=>{}}))}function G(D,j,W,Q){var C=W._keyBindmap[D];C&&(K(W._keyStates[D],j)&&(W._keyStates[D]=j,C.forEach((D=>{(!W.filterEvents||W.filterEvents(Q,D))&&function(D,j,W,Q){var C=j?W.pressCount:W.releaseCount;C[D]=(C[D]||0)+1;var k=W._bindPressCount[D]||0;(k+=j?1:-1)<0&&(k=0);W._bindPressCount[D]=k;var M=W.state[D];if(K(M,k)){W.state[D]=k>0;var O=j?W.down:W.up;W.disabled||O.emit(D,Q)}}(D,j,W,Q)}))),"button"in Q||(W.Jj&&!Q.defaultPrevented&&Q.preventDefault(),W.stopPropagation&&Q.stopPropagation()))}function K(D,j){return D?!j:j}},12436:D=>{D.exports=function(D,j,W){return D[0]=j[0]+W[0],D[1]=j[1]+W[1],D[2]=j[2]+W[2],D}},12405:(D,j,W)=>{D.exports=function(D,j){var W=Q(D[0],D[1],D[2]),M=Q(j[0],j[1],j[2]);C(W,W),C(M,M);var O=k(W,M);return O>1?0:Math.acos(O)};var Q=W(12409),C=W(12413),k=W(12415)},12497:D=>{D.exports=function(D,j){return D[0]=Math.ceil(j[0]),D[1]=Math.ceil(j[1]),D[2]=Math.ceil(j[2]),D}},12396:D=>{D.exports=function(D){var j=new Float32Array(3);return j[0]=D[0],j[1]=D[1],j[2]=D[2],j}},12417:D=>{D.exports=function(D,j){return D[0]=j[0],D[1]=j[1],D[2]=j[2],D}},12392:D=>{D.exports=function(){var D=new Float32Array(3);return D[0]=0,D[1]=0,D[2]=0,D}},12587:D=>{D.exports=function(D,j,W){var Q=j[0],C=j[1],k=j[2],M=W[0],O=W[1],E=W[2];return D[0]=C*E-k*O,D[1]=k*M-Q*E,D[2]=Q*O-C*M,D}},12535:(D,j,W)=>{D.exports=W(12528)},12528:D=>{D.exports=function(D,j){var W=j[0]-D[0],Q=j[1]-D[1],C=j[2]-D[2];return Math.sqrt(W*W+Q*Q+C*C)}},12469:(D,j,W)=>{D.exports=W(12460)},12460:D=>{D.exports=function(D,j,W){return D[0]=j[0]/W[0],D[1]=j[1]/W[1],D[2]=j[2]/W[2],D}},12415:D=>{D.exports=function(D,j){return D[0]*j[0]+D[1]*j[1]+D[2]*j[2]}},12389:D=>{D.exports=1e-6},12427:(D,j,W)=>{D.exports=function(D,j){var W=D[0],C=D[1],k=D[2],M=j[0],O=j[1],E=j[2];return Math.abs(W-M)<=Q*Math.max(1,Math.abs(W),Math.abs(M))&&Math.abs(C-O)<=Q*Math.max(1,Math.abs(C),Math.abs(O))&&Math.abs(k-E)<=Q*Math.max(1,Math.abs(k),Math.abs(E))};var Q=W(12389)},12431:D=>{D.exports=function(D,j){return D[0]===j[0]&&D[1]===j[1]&&D[2]===j[2]}},12492:D=>{D.exports=function(D,j){return D[0]=Math.floor(j[0]),D[1]=Math.floor(j[1]),D[2]=Math.floor(j[2]),D}},12644:(D,j,W)=>{D.exports=function(D,j,W,C,k,M){var O,E;j||(j=3);W||(W=0);E=C?Math.min(C*j+W,D.length):D.length;for(O=W;O<E;O+=j)Q[0]=D[O],Q[1]=D[O+1],Q[2]=D[O+2],k(Q,Q,M),D[O]=Q[0],D[O+1]=Q[1],D[O+2]=Q[2];return D};var Q=W(12392)()},12409:D=>{D.exports=function(D,j,W){var Q=new Float32Array(3);return Q[0]=D,Q[1]=j,Q[2]=W,Q}},12384:(D,j,W)=>{D.exports={EPSILON:W(12389),create:W(12392),clone:W(12396),angle:W(12405),Nc:W(12409),j:W(12417),set:W(12419),equals:W(12427),exactEquals:W(12431),add:W(12436),Qc:W(12443),sub:W(12446),multiply:W(12452),mul:W(12456),divide:W(12460),div:W(12469),min:W(12478),max:W(12485),floor:W(12492),ceil:W(12497),round:W(12504),scale:W(12512),Zc:W(12520),distance:W(12528),dist:W(12535),_c:W(12538),sqrDist:W(12546),length:W(12554),len:W(12557),squaredLength:W(12559),ad:W(12567),negate:W(12575),inverse:W(12580),normalize:W(12413),dot:W(12415),cross:W(12587),dd:W(12589),random:W(12594),transformMat4:W(12601),transformMat3:W(12607),transformQuat:W(12615),fd:W(12620),gd:W(12629),hd:W(12636),forEach:W(12644)}},12580:D=>{D.exports=function(D,j){return D[0]=1/j[0],D[1]=1/j[1],D[2]=1/j[2],D}},12557:(D,j,W)=>{D.exports=W(12554)},12554:D=>{D.exports=function(D){var j=D[0],W=D[1],Q=D[2];return Math.sqrt(j*j+W*W+Q*Q)}},12589:D=>{D.exports=function(D,j,W,Q){var C=j[0],k=j[1],M=j[2];return D[0]=C+Q*(W[0]-C),D[1]=k+Q*(W[1]-k),D[2]=M+Q*(W[2]-M),D}},12485:D=>{D.exports=function(D,j,W){return D[0]=Math.max(j[0],W[0]),D[1]=Math.max(j[1],W[1]),D[2]=Math.max(j[2],W[2]),D}},12478:D=>{D.exports=function(D,j,W){return D[0]=Math.min(j[0],W[0]),D[1]=Math.min(j[1],W[1]),D[2]=Math.min(j[2],W[2]),D}},12456:(D,j,W)=>{D.exports=W(12452)},12452:D=>{D.exports=function(D,j,W){return D[0]=j[0]*W[0],D[1]=j[1]*W[1],D[2]=j[2]*W[2],D}},12575:D=>{D.exports=function(D,j){return D[0]=-j[0],D[1]=-j[1],D[2]=-j[2],D}},12413:D=>{D.exports=function(D,j){var W=j[0],Q=j[1],C=j[2],k=W*W+Q*Q+C*C;k>0&&(k=1/Math.sqrt(k),D[0]=j[0]*k,D[1]=j[1]*k,D[2]=j[2]*k);return D}},12594:D=>{D.exports=function(D,j){j=j||1;var W=2*Math.random()*Math.PI,Q=2*Math.random()-1,C=Math.sqrt(1-Q*Q)*j;return D[0]=Math.cos(W)*C,D[1]=Math.sin(W)*C,D[2]=Q*j,D}},12620:D=>{D.exports=function(D,j,W,Q){var C=W[1],k=W[2],M=j[1]-C,O=j[2]-k,E=Math.sin(Q),f=Math.cos(Q);return D[0]=j[0],D[1]=C+M*f-O*E,D[2]=k+M*E+O*f,D}},12629:D=>{D.exports=function(D,j,W,Q){var C=W[0],k=W[2],M=j[0]-C,O=j[2]-k,E=Math.sin(Q),f=Math.cos(Q);return D[0]=C+O*E+M*f,D[1]=j[1],D[2]=k+O*f-M*E,D}},12636:D=>{D.exports=function(D,j,W,Q){var C=W[0],k=W[1],M=j[0]-C,O=j[1]-k,E=Math.sin(Q),f=Math.cos(Q);return D[0]=C+M*f-O*E,D[1]=k+M*E+O*f,D[2]=j[2],D}},12504:D=>{D.exports=function(D,j){return D[0]=Math.round(j[0]),D[1]=Math.round(j[1]),D[2]=Math.round(j[2]),D}},12512:D=>{D.exports=function(D,j,W){return D[0]=j[0]*W,D[1]=j[1]*W,D[2]=j[2]*W,D}},12520:D=>{D.exports=function(D,j,W,Q){return D[0]=j[0]+W[0]*Q,D[1]=j[1]+W[1]*Q,D[2]=j[2]+W[2]*Q,D}},12419:D=>{D.exports=function(D,j,W,Q){return D[0]=j,D[1]=W,D[2]=Q,D}},12546:(D,j,W)=>{D.exports=W(12538)},12567:(D,j,W)=>{D.exports=W(12559)},12538:D=>{D.exports=function(D,j){var W=j[0]-D[0],Q=j[1]-D[1],C=j[2]-D[2];return W*W+Q*Q+C*C}},12559:D=>{D.exports=function(D){var j=D[0],W=D[1],Q=D[2];return j*j+W*W+Q*Q}},12446:(D,j,W)=>{D.exports=W(12443)},12443:D=>{D.exports=function(D,j,W){return D[0]=j[0]-W[0],D[1]=j[1]-W[1],D[2]=j[2]-W[2],D}},12607:D=>{D.exports=function(D,j,W){var Q=j[0],C=j[1],k=j[2];return D[0]=Q*W[0]+C*W[3]+k*W[6],D[1]=Q*W[1]+C*W[4]+k*W[7],D[2]=Q*W[2]+C*W[5]+k*W[8],D}},12601:D=>{D.exports=function(D,j,W){var Q=j[0],C=j[1],k=j[2],M=W[3]*Q+W[7]*C+W[11]*k+W[15];return M=M||1,D[0]=(W[0]*Q+W[4]*C+W[8]*k+W[12])/M,D[1]=(W[1]*Q+W[5]*C+W[9]*k+W[13])/M,D[2]=(W[2]*Q+W[6]*C+W[10]*k+W[14])/M,D}},12615:D=>{D.exports=function(D,j,W){var Q=j[0],C=j[1],k=j[2],M=W[0],O=W[1],E=W[2],f=W[3],F=f*Q+O*k-E*C,Z=f*C+E*Q-M*k,P=f*k+M*C-O*Q,X=-M*Q-O*C-E*k;return D[0]=F*f+X*-M+Z*-E-P*-O,D[1]=Z*f+X*-O+P*-M-F*-E,D[2]=P*f+X*-E+F*-O-Z*-M,D}},12812:D=>{"use strict";D.exports=function(D){for(var j=new Array(D),W=0;W<D;++W)j[W]=W;return j}},12876:D=>{D.exports=function(D){return null!=D&&null!=D.constructor&&"function"===typeof D.constructor.isBuffer&&D.constructor.isBuffer(D)}},13112:(D,j,W)=>{"use strict";W.d(j,{e:()=>Q});class Q{constructor(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.Bi=!1,this.Ci=!1,this.zi=30,this.Ai=0,this.Ki=!1,this.fullscreen=!1,this.Ei=function(D){},this.Fi=function(){},this.Ii=function(){},this.bb=function(){},this.Gi=function(D){},this.onFullscreenChanged=function(D){},f((()=>{!function(D,j){D._nowObject=performance||Date,D._lastTick=0,D._renderAccum=0,D._rt=0,D._frameCB=O.bind(null,D),requestAnimationFrame(D._frameCB),j>0&&(D._intervalCB=M.bind(null,D),D._interval=setInterval(D._intervalCB,Math.max(j,1e3/D.zi/2)))}(this,j),function(D,j){if(!j)return;var W=!1,Q=!1;document.addEventListener("pointerlockchange",(Q=>{W=document.pointerLockElement===j,D.Gi(W)})),document.addEventListener("fullscreenchange",(W=>{Q=document.fullscreenElement===j,D.onFullscreenChanged(Q)})),Object.defineProperty(D,"Ki",{get:()=>W,set:D=>{D&&!W?E(j):W&&!D&&function(D){D.exitPointerLock&&D.exitPointerLock()}(document)}}),Object.defineProperty(D,"fullscreen",{get:()=>Q,set:D=>{D&&!Q?j.requestFullscreen():Q&&!D&&document.exitFullscreen()}}),j.addEventListener("click",(C=>{D.Bi&&!W&&E(j),D.Ci&&!Q&&j.requestFullscreen()}));var C=()=>D.bb();if(window.ResizeObserver){new ResizeObserver(C).observe(j)}else window.addEventListener("resize",C)}(this,D),this.Ii()}))}}var C=3,k=20;function M(D){for(var j=1e3/D.zi,W=D._nowObject.now()+k,Q=0;D._nowObject.now()>=D._lastTick+j&&D._nowObject.now()<W&&++Q<=C;)D.Ei(j),D._lastTick+=j;var M=5*(j+5),O=D._nowObject.now();if(O-D._lastTick>M)for(;O>=D._lastTick+j;)D._lastTick+=j}function O(D){requestAnimationFrame(D._frameCB),M(D);var j=D._nowObject.now(),W=j-D._rt;if(D._rt=j,D.Ai>0){D._renderAccum+=W;var Q=1e3/D.Ai;if(D._renderAccum<Q)return;D._renderAccum=Math.min(D._renderAccum-Q,Q)}var C=1e3/D.zi,k=(j-D._lastTick)/C;D.Fi(W,k,C)}function E(D){D.requestPointerLock&&D.requestPointerLock()}var f=D=>{if("loading"===document.readyState){var j=()=>{document.removeEventListener("readystatechange",j),D()};document.addEventListener("readystatechange",j)}else setTimeout(D,1)}},12809:(D,j,W)=>{var Q=W(12812),C=W(12818),k="undefined"!==typeof Float64Array;function M(D,j){return D[0]-j[0]}function O(){var D,j=this.stride,W=new Array(j.length);for(D=0;D<W.length;++D)W[D]=[Math.abs(j[D]),D];W.sort(M);var Q=new Array(W.length);for(D=0;D<Q.length;++D)Q[D]=W[D][1];return Q}function E(D,j){var W=["View",j,"d",D].join("");j<0&&(W="View_Nil"+D);var C="generic"===D;if(-1===j){var k="function "+W+"(a){this.data=a;};var proto="+W+".prototype;proto.dtype='"+D+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+W+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+W+"(a){return new "+W+"(a);}";return new Function(k)()}if(0===j){k="function "+W+"(a,d) {this.data = a;this.offset = d};var proto="+W+".prototype;proto.dtype='"+D+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+W+"_copy() {return new "+W+"(this.data,this.offset)};proto.pick=function "+W+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+W+"_get(){return "+(C?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+W+"_set(v){return "+(C?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+W+"(a,b,c,d){return new "+W+"(a,d)}";return new Function("TrivialArray",k)(f[D][0])}k=["'use strict'"];var M=Q(j),E=M.map((function(D){return"i"+D})),F="this.offset+"+M.map((function(D){return"this.stride["+D+"]*i"+D})).join("+"),Z=M.map((function(D){return"b"+D})).join(","),P=M.map((function(D){return"c"+D})).join(",");k.push("function "+W+"(a,"+Z+","+P+",d){this.data=a","this.shape=["+Z+"]","this.stride=["+P+"]","this.offset=d|0}","var proto="+W+".prototype","proto.dtype='"+D+"'","proto.dimension="+j),k.push("Object.defineProperty(proto,'size',{get:function "+W+"_size(){return "+M.map((function(D){return"this.shape["+D+"]"})).join("*"),"}})"),1===j?k.push("proto.order=[0]"):(k.push("Object.defineProperty(proto,'order',{get:"),j<4?(k.push("function "+W+"_order(){"),2===j?k.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===j&&k.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):k.push("ORDER})")),k.push("proto.set=function "+W+"_set("+E.join(",")+",v){"),C?k.push("return this.data.set("+F+",v)}"):k.push("return this.data["+F+"]=v}"),k.push("proto.get=function "+W+"_get("+E.join(",")+"){"),C?k.push("return this.data.get("+F+")}"):k.push("return this.data["+F+"]}"),k.push("proto.index=function "+W+"_index(",E.join(),"){return "+F+"}"),k.push("proto.hi=function "+W+"_hi("+E.join(",")+"){return new "+W+"(this.data,"+M.map((function(D){return["(typeof i",D,"!=='number'||i",D,"<0)?this.shape[",D,"]:i",D,"|0"].join("")})).join(",")+","+M.map((function(D){return"this.stride["+D+"]"})).join(",")+",this.offset)}");var X=M.map((function(D){return"a"+D+"=this.shape["+D+"]"})),x=M.map((function(D){return"c"+D+"=this.stride["+D+"]"}));k.push("proto.lo=function "+W+"_lo("+E.join(",")+"){var b=this.offset,d=0,"+X.join(",")+","+x.join(","));for(var R=0;R<j;++R)k.push("if(typeof i"+R+"==='number'&&i"+R+">=0){d=i"+R+"|0;b+=c"+R+"*d;a"+R+"-=d}");k.push("return new "+W+"(this.data,"+M.map((function(D){return"a"+D})).join(",")+","+M.map((function(D){return"c"+D})).join(",")+",b)}"),k.push("proto.step=function "+W+"_step("+E.join(",")+"){var "+M.map((function(D){return"a"+D+"=this.shape["+D+"]"})).join(",")+","+M.map((function(D){return"b"+D+"=this.stride["+D+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(R=0;R<j;++R)k.push("if(typeof i"+R+"==='number'){d=i"+R+"|0;if(d<0){c+=b"+R+"*(a"+R+"-1);a"+R+"=ceil(-a"+R+"/d)}else{a"+R+"=ceil(a"+R+"/d)}b"+R+"*=d}");k.push("return new "+W+"(this.data,"+M.map((function(D){return"a"+D})).join(",")+","+M.map((function(D){return"b"+D})).join(",")+",c)}");var V=new Array(j),U=new Array(j);for(R=0;R<j;++R)V[R]="a[i"+R+"]",U[R]="b[i"+R+"]";k.push("proto.transpose=function "+W+"_transpose("+E+"){"+E.map((function(D,j){return D+"=("+D+"===undefined?"+j+":"+D+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+W+"(this.data,"+V.join(",")+","+U.join(",")+",this.offset)}"),k.push("proto.pick=function "+W+"_pick("+E+"){var a=[],b=[],c=this.offset");for(R=0;R<j;++R)k.push("if(typeof i"+R+"==='number'&&i"+R+">=0){c=(c+this.stride["+R+"]*i"+R+")|0}else{a.push(this.shape["+R+"]);b.push(this.stride["+R+"])}");return k.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),k.push("return function construct_"+W+"(data,shape,stride,offset){return new "+W+"(data,"+M.map((function(D){return"shape["+D+"]"})).join(",")+","+M.map((function(D){return"stride["+D+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",k.join("\n"))(f[D],O)}var f={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};D.exports=function(D,j,W,Q){if(void 0===D)return(0,f.array[0])([]);"number"===typeof D&&(D=[D]),void 0===j&&(j=[D.length]);var M=j.length;if(void 0===W){W=new Array(M);for(var O=M-1,F=1;O>=0;--O)W[O]=F,F*=j[O]}if(void 0===Q){Q=0;for(O=0;O<M;++O)W[O]<0&&(Q-=(j[O]-1)*W[O])}for(var Z=function(D){if(C(D))return"buffer";if(k)switch(Object.prototype.toString.call(D)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(D)?"array":"generic"}(D),P=f[Z];P.length<=M+1;)P.push(E(Z,P.length-1));return(0,P[M+1])(D,j,W,Q)}},12818:D=>{function j(D){return!!D.constructor&&"function"===typeof D.constructor.isBuffer&&D.constructor.isBuffer(D)}D.exports=function(D){return null!=D&&(j(D)||function(D){return"function"===typeof D.readFloatLE&&"function"===typeof D.slice&&j(D.slice(0,0))}(D)||!!D._isBuffer)}},12972:D=>{"use strict";var j=[],W=[],Q=[],C=[],k=[],M=[],O=[],E=[],f=[],F=[],Z=[],P=[];D.exports=function(D,X,x,R,V,U){for(var g=O,N=f,G=F,K=P,L=0;L<3;L++)g[L]=+x[L],G[L]=+X.max[L],N[L]=+X.base[L];U||(U=1e-10);var e=function(D,O,f,F,P,X){var x=j,R=W,V=Q,U=C,g=k,N=M,G=E,K=Math.floor,L=0,e=0,s=0,b=0,Y=0;if(t(),0===s)return 0;for(b=I();e<=s;){if(c(b)&&l())return L;b=I()}for(L+=s,Y=0;Y<3;Y++)F[Y]+=f[Y],P[Y]+=f[Y];return L;function t(){if(e=0,0!==(s=Math.sqrt(f[0]*f[0]+f[1]*f[1]+f[2]*f[2])))for(var D=0;D<3;D++){var j=f[D]>=0;U[D]=j?1:-1;var W=j?P[D]:F[D];x[D]=j?F[D]:P[D],R[D]=y(W,U[D]),V[D]=m(x[D],U[D]),G[D]=f[D]/s,g[D]=Math.abs(1/G[D]);var Q=j?R[D]+1-W:W-R[D];N[D]=g[D]<1/0?g[D]*Q:1/0}}function c(j){for(var W=U[0],Q=0===j?R[0]:V[0],C=R[0]+W,k=U[1],M=1===j?R[1]:V[1],O=R[1]+k,E=U[2],f=2===j?R[2]:V[2],F=R[2]+E,Z=Q;Z!=C;Z+=W)for(var P=M;P!=O;P+=k)for(var X=f;X!=F;X+=E)if(D(Z,P,X))return!0;return!1}function l(){L+=e;var D=U[b],j=e/s,W=Z;for(Y=0;Y<3;Y++){var Q=f[Y]*j;F[Y]+=Q,P[Y]+=Q,W[Y]=f[Y]-Q}if(D>0?P[b]=Math.round(P[b]):F[b]=Math.round(F[b]),O(L,b,D,W))return!0;for(Y=0;Y<3;Y++)f[Y]=W[Y];return t(),0===s}function I(){var D=N[0]<N[1]?N[0]<N[2]?0:2:N[1]<N[2]?1:2,j=N[D]-e;for(e=N[D],R[D]+=U[D],N[D]+=g[D],Y=0;Y<3;Y++)x[Y]+=j*G[Y],V[Y]=m(x[Y],U[Y]);return D}function y(D,j){return K(D-j*X)}function m(D,j){return K(D+j*X)}}(D,R,g,N,G,U);if(!V){for(L=0;L<3;L++)K[L]=x[L]>0?G[L]-X.max[L]:N[L]-X.base[L];X.translate(K)}return e}},13149:(D,j,W)=>{"use strict";W.d(j,{d:()=>Z});var Q=W(12967),C=W(12384);class k{constructor(D,j,W,k,M,O,E){this.hh=new Q(D.base,D.Mh),this.mass=j,this.friction=W,this.restitution=k,this.Fb=M,this.Uk=O,this.Mb=!!E,this.Ih=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.Hl=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.wg=C.create(),this.bh=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=C.create(),this._impulses=C.create(),this._sleepFrameCount=10}loadFromCopy(D){C.j(this.hh.base,D.hh.base),C.j(this.hh.Mh,D.hh.Mh),C.j(this.hh.max,D.hh.max),this.hh.mag=D.hh.mag,this.mass=D.mass,this.friction=D.friction,this.restitution=D.restitution,this.Fb=D.Fb,this.Uk=D.Uk,this.Mb=D.Mb,this.Ih=D.Ih,this.fluidDrag=D.fluidDrag,this.Hl=D.Hl,this.preventFallOffEdge=D.preventFallOffEdge,this.rolledBackLastTick=D.rolledBackLastTick,C.j(this.wg,D.wg),C.j(this.bh,D.bh),this.inFluid=D.inFluid,this._ratioInFluid=D._ratioInFluid,C.j(this._forces,D._forces),C.j(this._impulses,D._impulses),this._sleepFrameCount=D._sleepFrameCount}setPosition(D){M(D),C.Qc(D,D,this.hh.base),this.hh.translate(D),this.Bg()}cb(){return C.clone(this.hh.base)}applyForce(D){M(D),C.add(this._forces,this._forces,D),this.Bg()}applyImpulse(D){M(D),C.add(this._impulses,this._impulses,D),this.Bg()}Bg(){this._sleepFrameCount=10}atRestX(){return this.bh[0]}atRestY(){return this.bh[1]}atRestZ(){return this.bh[2]}}var M=D=>{};var O=W(12967),E=W(12384),f=W(12972);function F(){this.Ih=.1,this.fluidDrag=.4,this.xc=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function Z(D,j,W){D=Object.assign(new F,D),this.gravity=D.gravity||[0,-10,0],this.Ih=D.Ih||.1,this.xc=D.xc||2,this.fluidDrag=D.fluidDrag||.4,this.minBounceImpulse=D.minBounceImpulse,this.bodies=[],this.qk=D.qk,this.testSolid=j,this.testFluid=W}Z.prototype._k=function(D,j,W,Q,C,M){D=D||new O([0,0,0],[1,1,1]),"undefined"==typeof j&&(j=1),"undefined"==typeof W&&(W=1),"undefined"==typeof Q&&(Q=0),"undefined"==typeof C&&(C=1);var E=new k(D,j,W,Q,C,M);return this.bodies.push(E),E},Z.prototype.al=function(D){var j=this.bodies.indexOf(D);j<0||(this.bodies.splice(j,1),D.hh=D.Uk=null)};var P=E.create(),X=E.create(),x=E.create(),R=E.create(),V=E.create(),U=E.create(),g=E.create(),N=new O([0,0,0],[1,1,1]),G=new k(N,1,1,0,1,(()=>{}),!1);function K(D,j,W){return j=W,j*=1-(1-D.ratioInFluid)**2}Z.prototype.Df=function(D){D/=1e3;var j=i(0,E.squaredLength(this.gravity));this.bodies.forEach((W=>function(D,j,W,Q){E.j(V,j.bh),D.qk&&G.loadFromCopy(j);if(j.mass<=0)return E.set(j.wg,0,0,0),E.set(j._forces,0,0,0),void E.set(j._impulses,0,0,0);var C=Q||0===j.Fb;if(function(D,j,W,Q){if(j._sleepFrameCount>0)return!1;if(Q)return!0;var C=!1,k=.5*W*W*j.Fb;return E.scale(z,D.gravity,k),f(D.testSolid,j.hh,z,(function(){return C=!0,!0}),!0),C}(D,j,W,C))return;j._sleepFrameCount--,function(D,j){var W=j.hh,Q=Math.floor(W.base[0]),C=Math.floor(W.base[2]),k=Math.floor(W.base[1]),M=Math.floor(W.max[1]);if(!D.testFluid(Q,k,C))return j.inFluid=!1,void(j.ratioInFluid=0);var O=1,f=k+1;for(;f<=M&&D.testFluid(Q,f,C);)O++,f++;var F=(k+O-W.base[1])/W.Mh[1];F>1&&(F=1);var Z=W.Mh[0]*W.Mh[1]*W.Mh[2]*F,P=e;E.scale(P,D.gravity,-D.xc*Z*j.Fb),j.applyForce(P),j.inFluid=!0,j.ratioInFluid=F}(D,j),T(j._forces),T(j._impulses),T(j.wg),T(j.bh),E.scale(P,j._forces,1/j.mass),E.Zc(P,P,D.gravity,j.Fb),E.scale(X,j._impulses,1/j.mass),E.Zc(X,X,P,W),E.add(j.wg,j.wg,X),j.friction&&(s(D,0,j,X,W),s(D,1,j,X,W),s(D,2,j,X,W));var k=j.fluidDrag>=0?j.fluidDrag:D.fluidDrag,M=j.Ih>=0?j.Ih:D.Ih,O=M,F=M;j.inFluid&&(O=K(j,O,j.fluidDragHoriz>=0?j.fluidDragHoriz:k),F=K(j,F,j.fluidDragVert>=0?j.fluidDragVert:k));O=Math.max(1-O*W/j.mass,0),F=Math.max(1-F*W/j.mass,0),E.set(L,O,F,O),E.multiply(j.wg,j.wg,L),E.scale(x,j.wg,W),E.set(j._forces,0,0,0),E.set(j._impulses,0,0,0),j.Mb&&p(t,j.hh);E.j(U,x),E.set(g,0,0,0),j.preventFallOffEdge&&function(D,j,W,Q){if(!j.bh[1]||W[1]>0)return;var C=a;p(C,j.hh);for(var k=0;k<3;k+=2){E.set(m,0,0,0),m[k]=W[k];var M=!0;(M=(M=(M=(M=M&&!H(D,C.base[0]+m[0]+1e-5,C.base[1],C.base[2]+m[2]+1e-5))&&!H(D,C.max[0]+m[0]-1e-5,C.base[1],C.base[2]+m[2]+1e-5))&&!H(D,C.base[0]+m[0]+1e-5,C.base[1],C.max[2]+m[2]-1e-5))&&!H(D,C.max[0]+m[0]-1e-5,C.base[1],C.max[2]+m[2]-1e-5))?(Q[k]=W[k]>0?1:-1,W[k]=0):0===k&&(E.set(S,W[0],0,0),Y(D,C,S,Q,j.slideOnCollision))}}(D,j,x,g);Y(D,j.hh,x,j.bh,j.slideOnCollision),j.Mb&&function(D,j,W,Q){if(j.bh[1]>=0&&!j.inFluid)return;var C=0!==j.bh[0],k=0!==j.bh[2];if(!C&&!k)return;var M=Math.abs(Q[0]/Q[2]),O=4;if(!C&&M>O)return;if(!k&&M<1/O)return;E.add(l,W.base,Q);var F=D.testSolid;f(F,W,Q,(function(D,j,W,Q){if(1!==j)return!0;Q[j]=0}));var Z=W.base[1],P=j.inFluid?1.951:1.001,X=Math.floor(Z+P)-Z;E.set(I,0,X,0);var x=!1;if(f(F,W,I,(function(D,j,W,Q){return x=!0,!0})),x)return;E.Qc(y,l,W.base),y[1]=0,Y(D,W,y,c,!0);var R=i(W.base[0],l[0]),V=i(W.base[2],l[2]);if(C&&!R&&(!V||!k))return;if(k&&(!R||!C)&&!V)return;var U=!0;if(U=U&&!H(D,W.base[0]+1e-5,W.base[1],W.base[2]+1e-5),U=U&&!H(D,W.max[0]-1e-5,W.base[1],W.base[2]+1e-5),U=U&&!H(D,W.base[0]+1e-5,W.base[1],W.max[2]-1e-5),U=U&&!H(D,W.max[0]-1e-5,W.base[1],W.max[2]-1e-5),U)return;p(j.hh,W),j.bh[0]=c[0],j.bh[2]=c[2],j.Hl&&j.Hl()}(D,j,t,U);for(var Z=0;Z<3;++Z)j.bh[Z]=j.bh[Z]||g[Z],R[Z]=0,j.bh[Z]&&(V[Z]||(R[Z]=-j.wg[Z]),j.wg[Z]=0);var N=E.length(R);N>.001&&(E.scale(R,R,j.mass),j.Uk&&j.Uk(R),j.restitution>0&&N>D.minBounceImpulse&&(E.scale(R,R,j.restitution),j.applyImpulse(R)));var b=E.squaredLength(j.wg);b>1e-5&&j.Bg();D.qk&&D.qk(j)?(j.loadFromCopy(G),j.rolledBackLastTick=!0):j.rolledBackLastTick=!1}(this,W,D,j)))};var L=E.create([0,0,0]);var e=E.create();function s(D,j,W,Q,C){var k=W.bh[j],M=Q[j];if(!W.alwaysApplyHorizFriction||1!==j){if(0===k)return;if(k*M<=0)return}E.j(b,W.wg),b[j]=0;var O=E.length(b);if(!i(O,0)){var f=Math.abs(W.friction*D.gravity[j]*C),F=O>f?(O-f)/O:0;W.wg[(j+1)%3]*=F,W.wg[(j+2)%3]*=F}}var b=E.create();function Y(D,j,W,Q,C){return E.set(Q,0,0,0),f(D.testSolid,j,W,(function(D,j,W,k){Q[j]=W,k[j]=0,C||(k[0]=0,k[1]=0,k[2]=0)}))}var t=new O([],[]),c=E.create(),l=E.create(),I=E.create(),y=E.create();var m=E.create(),a=new O([],[]),S=E.create();function H(D,j,W,Q){return D.testSolid(Math.floor(j),Math.floor(W-1),Math.floor(Q))}var z=E.create();function i(D,j){return Math.abs(D-j)<1e-5}function p(D,j){for(var W=0;W<3;W++)D.base[W]=j.base[W],D.max[W]=j.max[W],D.Mh[W]=j.Mh[W]}var T=function(D){}},11775:function(D,j){!function(D){"use strict";var j=function(D,W){return j=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(D,j){D.__proto__=j}||function(D,j){for(var W in j)Object.prototype.hasOwnProperty.call(j,W)&&(D[W]=j[W])},j(D,W)};function W(D,W){if("function"!==typeof W&&null!==W)throw new TypeError("Class extends value "+String(W)+" is not a constructor or null");function Q(){this.constructor=D}j(D,W),D.prototype=null===W?Object.create(W):(Q.prototype=W.prototype,new Q)}function Q(D,j,W,Q){var C,k=arguments.length,M=k<3?j:null===Q?Q=Object.getOwnPropertyDescriptor(j,W):Q;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)M=Reflect.decorate(D,j,W,Q);else for(var O=D.length-1;O>=0;O--)(C=D[O])&&(M=(k<3?C(M):k>3?C(j,W,M):C(j,W))||M);return k>3&&M&&Object.defineProperty(j,W,M),M}function C(D,j,W){if(W||2===arguments.length)for(var Q,C=0,k=j.length;C<k;C++)!Q&&C in j||(Q||(Q=Array.prototype.slice.call(j,0,C)),Q[C]=j[C]);return D.concat(Q||Array.prototype.slice.call(j))}var k,M=255,O=213;D.OPERATION=void 0,(k=D.OPERATION||(D.OPERATION={}))[k.ADD=128]="ADD",k[k.REPLACE=0]="REPLACE",k[k.DELETE=64]="DELETE",k[k.DELETE_AND_ADD=192]="DELETE_AND_ADD",k[k.TOUCH=1]="TOUCH",k[k.CLEAR=10]="CLEAR";var E=function(){function j(D,j,W){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=D,this.setParent(j,W)}return j.prototype.setParent=function(D,j,W){var Q=this;if(this.indexes||(this.indexes=this.ref instanceof yD?this.ref._definition.indexes:{}),this.parent=D,this.parentIndex=W,j)if(this.root=j,this.ref instanceof yD){var C=this.ref._definition;for(var k in C.schema){var M=this.ref[k];if(M&&M.$changes){var O=C.indexes[k];M.$changes.setParent(this.ref,j,O)}}}else"object"===typeof this.ref&&this.ref.forEach((function(D,j){if(D instanceof yD){var W=D.$changes,C=Q.ref.$changes.indexes[j];W.setParent(Q.ref,Q.root,C)}}))},j.prototype.operation=function(D){this.changes.set(--this.currentCustomOperation,D)},j.prototype.change=function(j,W){void 0===W&&(W=D.OPERATION.ADD);var Q="number"===typeof j?j:this.indexes[j];this.assertValidIndex(Q,j);var C=this.changes.get(Q);C&&C.op!==D.OPERATION.DELETE&&C.op!==D.OPERATION.TOUCH||this.changes.set(Q,{op:C&&C.op===D.OPERATION.DELETE?D.OPERATION.DELETE_AND_ADD:W,index:Q}),this.allChanges.add(Q),this.changed=!0,this.touchParents()},j.prototype.touch=function(j){var W="number"===typeof j?j:this.indexes[j];this.assertValidIndex(W,j),this.changes.has(W)||this.changes.set(W,{op:D.OPERATION.TOUCH,index:W}),this.allChanges.add(W),this.touchParents()},j.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},j.prototype.getType=function(D){if(this.ref._definition)return(j=this.ref._definition).schema[j.fieldsByIndex[D]];var j,W=(j=this.parent._definition).schema[j.fieldsByIndex[this.parentIndex]];return Object.values(W)[0]},j.prototype.getChildrenFilter=function(){var D=this.parent._definition.childFilters;return D&&D[this.parentIndex]},j.prototype.getValue=function(D){return this.ref.getByIndex(D)},j.prototype.delete=function(j){var W="number"===typeof j?j:this.indexes[j];if(void 0!==W){var Q=this.getValue(W);this.changes.set(W,{op:D.OPERATION.DELETE,index:W}),this.allChanges.delete(W),delete this.caches[W],Q&&Q.$changes&&(Q.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(j," (").concat(W,")"))},j.prototype.discard=function(j,W){var Q=this;void 0===j&&(j=!1),void 0===W&&(W=!1),this.ref instanceof yD||this.changes.forEach((function(j){if(j.op===D.OPERATION.DELETE){var W=Q.ref.getIndex(j.index);delete Q.indexes[W]}})),this.changes.clear(),this.changed=j,W&&this.allChanges.clear(),this.currentCustomOperation=0},j.prototype.discardAll=function(){var D=this;this.changes.forEach((function(j){var W=D.getValue(j.index);W&&W.$changes&&W.$changes.discardAll()})),this.discard()},j.prototype.cache=function(D,j){this.caches[D]=j},j.prototype.clone=function(){return new j(this.ref,this.parent,this.root)},j.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},j.prototype.assertValidIndex=function(D,j){if(void 0===D)throw new Error('ChangeTree: missing index for field "'.concat(j,'"'))},j}();function f(D,j,W,Q){return D[j]||(D[j]=[]),D[j].push(W),null===Q||void 0===Q||Q.forEach((function(D,j){return W(D,j)})),function(){return Z(D[j],D[j].indexOf(W))}}function F(j){var W=this,Q="string"!==typeof this.$changes.getType();this.$items.forEach((function(C,k){j.push({refId:W.$changes.refId,op:D.OPERATION.DELETE,field:k,value:void 0,previousValue:C}),Q&&W.$changes.root.removeRef(C.$changes.refId)}))}function Z(D,j){if(-1===j||j>=D.length)return!1;for(var W=D.length-1,Q=j;Q<W;Q++)D[Q]=D[Q+1];return D.length=W,!0}var P=function(D,j){var W=D.toString(),Q=j.toString();return W<Q?-1:W>Q?1:0};function X(D){return D.$proxy=!0,D=new Proxy(D,{get:function(D,j){return"symbol"===typeof j||isNaN(j)?D[j]:D.at(j)},set:function(D,j,W){if("symbol"===typeof j||isNaN(j))D[j]=W;else{var Q=Array.from(D.$items.keys()),C=parseInt(Q[j]||j);void 0===W||null===W?D.deleteAt(C):D.setAt(C,W)}return!0},deleteProperty:function(D,j){return"number"===typeof j?D.deleteAt(j):delete D[j],!0}})}var x=function(){function j(){for(var D=[],j=0;j<arguments.length;j++)D[j]=arguments[j];this.$changes=new E(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,D)}return j.prototype.Pf=function(j,W){return void 0===W&&(W=!0),f(this.$callbacks||(this.$callbacks=[]),D.OPERATION.ADD,j,W?this.$items:void 0)},j.prototype.ab=function(j){return f(this.$callbacks||(this.$callbacks=[]),D.OPERATION.DELETE,j)},j.prototype.onChange=function(j){return f(this.$callbacks||(this.$callbacks=[]),D.OPERATION.REPLACE,j)},j.is=function(D){return Array.isArray(D)||void 0!==D.array},Object.defineProperty(j.prototype,"length",{get:function(){return this.$items.size},set:function(D){0===D?this.clear():this.splice(D,this.length-D)},enumerable:!1,configurable:!0}),j.prototype.push=function(){for(var D,j=this,W=[],Q=0;Q<arguments.length;Q++)W[Q]=arguments[Q];return W.forEach((function(W){D=j.$refId++,j.setAt(D,W)})),D},j.prototype.pop=function(){var D=Array.from(this.$indexes.values()).pop();if(void 0!==D){this.$changes.delete(D),this.$indexes.delete(D);var j=this.$items.get(D);return this.$items.delete(D),j}},j.prototype.at=function(D){var j=Array.from(this.$items.keys())[D];return this.$items.get(j)},j.prototype.setAt=function(j,W){var Q,C;if(void 0!==W&&null!==W){if(this.$items.get(j)!==W){void 0!==W.$changes&&W.$changes.setParent(this,this.$changes.root,j);var k=null!==(C=null===(Q=this.$changes.indexes[j])||void 0===Q?void 0:Q.op)&&void 0!==C?C:D.OPERATION.ADD;this.$changes.indexes[j]=j,this.$indexes.set(j,j),this.$items.set(j,W),this.$changes.change(j,k)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},j.prototype.deleteAt=function(D){var j=Array.from(this.$items.keys())[D];return void 0!==j&&this.$deleteAt(j)},j.prototype.$deleteAt=function(D){return this.$changes.delete(D),this.$indexes.delete(D),this.$items.delete(D)},j.prototype.clear=function(j){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),j&&F.call(this,j),this.$items.clear(),this.$changes.operation({index:0,op:D.OPERATION.CLEAR}),this.$changes.touchParents()},j.prototype.concat=function(){for(var D,W=[],Q=0;Q<arguments.length;Q++)W[Q]=arguments[Q];return new(j.bind.apply(j,C([void 0],(D=Array.from(this.$items.values())).concat.apply(D,W),!1)))},j.prototype.join=function(D){return Array.from(this.$items.values()).join(D)},j.prototype.reverse=function(){var D=this,j=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(W,Q){D.setAt(j[Q],W)})),this},j.prototype.shift=function(){var D=Array.from(this.$items.keys()).shift();if(void 0!==D){var j=this.$items.get(D);return this.$deleteAt(D),j}},j.prototype.slice=function(D,W){var Q=new j;return Q.push.apply(Q,Array.from(this.$items.values()).slice(D,W)),Q},j.prototype.sort=function(D){var j=this;void 0===D&&(D=P);var W=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(D).forEach((function(D,Q){j.setAt(W[Q],D)})),this},j.prototype.splice=function(D,j){void 0===j&&(j=this.length-D);for(var W=Array.from(this.$items.keys()),Q=[],C=D;C<D+j;C++)Q.push(this.$items.get(W[C])),this.$deleteAt(W[C]);return Q},j.prototype.unshift=function(){for(var D=this,j=[],W=0;W<arguments.length;W++)j[W]=arguments[W];var Q=this.length,C=j.length,k=Array.from(this.$items.values());return j.forEach((function(j,W){D.setAt(W,j)})),k.forEach((function(j,W){D.setAt(C+W,j)})),Q+C},j.prototype.indexOf=function(D,j){return Array.from(this.$items.values()).indexOf(D,j)},j.prototype.lastIndexOf=function(D,j){return void 0===j&&(j=this.length-1),Array.from(this.$items.values()).lastIndexOf(D,j)},j.prototype.every=function(D,j){return Array.from(this.$items.values()).every(D,j)},j.prototype.some=function(D,j){return Array.from(this.$items.values()).some(D,j)},j.prototype.forEach=function(D,j){Array.from(this.$items.values()).forEach(D,j)},j.prototype.map=function(D,j){return Array.from(this.$items.values()).map(D,j)},j.prototype.filter=function(D,j){return Array.from(this.$items.values()).filter(D,j)},j.prototype.reduce=function(D,j){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},j.prototype.reduceRight=function(D,j){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},j.prototype.find=function(D,j){return Array.from(this.$items.values()).find(D,j)},j.prototype.findIndex=function(D,j){return Array.from(this.$items.values()).findIndex(D,j)},j.prototype.fill=function(D,j,W){throw new Error("ArraySchema#fill() not implemented")},j.prototype.copyWithin=function(D,j,W){throw new Error("ArraySchema#copyWithin() not implemented")},j.prototype.toString=function(){return this.$items.toString()},j.prototype.toLocaleString=function(){return this.$items.toLocaleString()},j.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(j,Symbol.species,{get:function(){return j},enumerable:!1,configurable:!0}),j.prototype.entries=function(){return this.$items.entries()},j.prototype.keys=function(){return this.$items.keys()},j.prototype.values=function(){return this.$items.values()},j.prototype.includes=function(D,j){return Array.from(this.$items.values()).includes(D,j)},j.prototype.flatMap=function(D,j){throw new Error("ArraySchema#flatMap() is not supported.")},j.prototype.flat=function(D){throw new Error("ArraySchema#flat() is not supported.")},j.prototype.findLast=function(){var D=Array.from(this.$items.values());return D.findLast.apply(D,arguments)},j.prototype.findLastIndex=function(){var D=Array.from(this.$items.values());return D.findLastIndex.apply(D,arguments)},j.prototype.setIndex=function(D,j){this.$indexes.set(D,j)},j.prototype.getIndex=function(D){return this.$indexes.get(D)},j.prototype.getByIndex=function(D){return this.$items.get(this.$indexes.get(D))},j.prototype.deleteByIndex=function(D){var j=this.$indexes.get(D);this.$items.delete(j),this.$indexes.delete(D)},j.prototype.toArray=function(){return Array.from(this.$items.values())},j.prototype.toJSON=function(){return this.toArray().map((function(D){return"function"===typeof D.toJSON?D.toJSON():D}))},j.prototype.clone=function(D){return D?new(j.bind.apply(j,C([void 0],Array.from(this.$items.values()),!1))):new(j.bind.apply(j,C([void 0],this.map((function(D){return D.$changes?D.clone():D})),!1)))},j}();function R(D){return D.$proxy=!0,D=new Proxy(D,{get:function(D,j){return"symbol"!==typeof j&&"undefined"===typeof D[j]?D.get(j):D[j]},set:function(D,j,W){return"symbol"!==typeof j&&-1===j.indexOf("$")&&"Pf"!==j&&"ab"!==j&&"onChange"!==j?D.set(j,W):D[j]=W,!0},deleteProperty:function(D,j){return D.delete(j),!0}})}var V=function(){function j(D){var W=this;if(this.$changes=new E(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,D)if(D instanceof Map||D instanceof j)D.forEach((function(D,j){return W.set(j,D)}));else for(var Q in D)this.set(Q,D[Q])}return j.prototype.Pf=function(j,W){return void 0===W&&(W=!0),f(this.$callbacks||(this.$callbacks=[]),D.OPERATION.ADD,j,W?this.$items:void 0)},j.prototype.ab=function(j){return f(this.$callbacks||(this.$callbacks=[]),D.OPERATION.DELETE,j)},j.prototype.onChange=function(j){return f(this.$callbacks||(this.$callbacks=[]),D.OPERATION.REPLACE,j)},j.is=function(D){return void 0!==D.map},j.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(j.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(j,Symbol.species,{get:function(){return j},enumerable:!1,configurable:!0}),j.prototype.set=function(j,W){if(void 0===W||null===W)throw new Error("MapSchema#set('".concat(j,"', ").concat(W,"): trying to set ").concat(W," value on '").concat(j,"'."));j=j.toString();var Q="undefined"!==typeof this.$changes.indexes[j],C=Q?this.$changes.indexes[j]:this.$refId++,k=Q?D.OPERATION.REPLACE:D.OPERATION.ADD,M=void 0!==W.$changes;if(M&&W.$changes.setParent(this,this.$changes.root,C),Q){if(!M&&this.$items.get(j)===W)return;M&&this.$items.get(j)!==W&&(k=D.OPERATION.ADD)}else this.$changes.indexes[j]=C,this.$indexes.set(C,j);return this.$items.set(j,W),this.$changes.change(j,k),this},j.prototype.get=function(D){return this.$items.get(D)},j.prototype.delete=function(D){return this.$changes.delete(D),this.$items.delete(D)},j.prototype.clear=function(j){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),j&&F.call(this,j),this.$items.clear(),this.$changes.operation({index:0,op:D.OPERATION.CLEAR}),this.$changes.touchParents()},j.prototype.has=function(D){return this.$items.has(D)},j.prototype.forEach=function(D){this.$items.forEach(D)},j.prototype.entries=function(){return this.$items.entries()},j.prototype.keys=function(){return this.$items.keys()},j.prototype.values=function(){return this.$items.values()},Object.defineProperty(j.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),j.prototype.setIndex=function(D,j){this.$indexes.set(D,j)},j.prototype.getIndex=function(D){return this.$indexes.get(D)},j.prototype.getByIndex=function(D){return this.$items.get(this.$indexes.get(D))},j.prototype.deleteByIndex=function(D){var j=this.$indexes.get(D);this.$items.delete(j),this.$indexes.delete(D)},j.prototype.toJSON=function(){var D={};return this.forEach((function(j,W){D[W]="function"===typeof j.toJSON?j.toJSON():j})),D},j.prototype.clone=function(D){var W;return D?W=Object.assign(new j,this):(W=new j,this.forEach((function(D,j){D.$changes?W.set(j,D.clone()):W.set(j,D)}))),W},j}(),U={};function g(D,j){U[D]=j}function N(D){return U[D]}var G=function(){function D(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return D.create=function(j){var W=new D;return W.schema=Object.assign({},j&&j.schema||{}),W.indexes=Object.assign({},j&&j.indexes||{}),W.fieldsByIndex=Object.assign({},j&&j.fieldsByIndex||{}),W.descriptors=Object.assign({},j&&j.descriptors||{}),W.deprecated=Object.assign({},j&&j.deprecated||{}),W},D.prototype.addField=function(D,j){var W=this.getNextFieldIndex();this.fieldsByIndex[W]=D,this.indexes[D]=W,this.schema[D]=Array.isArray(j)?{array:j[0]}:j},D.prototype.hasField=function(D){return void 0!==this.indexes[D]},D.prototype.addFilter=function(D,j){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[D]]=j,this.indexesWithFilters.push(this.indexes[D]),!0},D.prototype.addChildrenFilter=function(D,j){var W=this.indexes[D],Q=this.schema[D];if(N(Object.keys(Q)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[W]=j,!0;console.warn("@filterChildren: field '".concat(D,"' can't have children. Ignoring filter."))},D.prototype.getChildrenFilter=function(D){return this.childFilters&&this.childFilters[this.indexes[D]]},D.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},D}();function K(D){return D._context&&D._context.useFilters}var L=function(){function D(){this.types={},this.schemas=new Map,this.useFilters=!1}return D.prototype.has=function(D){return this.schemas.has(D)},D.prototype.get=function(D){return this.types[D]},D.prototype.add=function(D,j){void 0===j&&(j=this.schemas.size),D._definition=G.create(D._definition),D._typeid=j,this.types[j]=D,this.schemas.set(D,j)},D.create=function(j){return void 0===j&&(j={}),function(W){return j.context||(j.context=new D),s(W,j)}},D}(),e=new L;function s(D,j){return void 0===j&&(j={}),function(W,Q){var k=j.context||e,M=W.constructor;if(M._context=k,!D)throw new Error("".concat(M.name,': @type() reference provided for "').concat(Q,"\" is undefined. Make sure you don't have any circular dependencies."));k.has(M)||k.add(M);var O=M._definition;if(O.addField(Q,D),O.descriptors[Q]){if(O.deprecated[Q])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(Q,"' definition on '").concat(M.name,"'.\nCheck @type() annotation"))}catch(U){var E=U.stack.split("\n")[4].trim();throw new Error("".concat(U.message," ").concat(E))}}var f=x.is(D),F=!f&&V.is(D);if("string"!==typeof D&&!yD.is(D)){var Z=Object.values(D)[0];"string"===typeof Z||k.has(Z)||k.add(Z)}if(j.manual)O.descriptors[Q]={enumerable:!0,configurable:!0,writable:!0};else{var P="_".concat(Q);O.descriptors[P]={enumerable:!1,configurable:!1,writable:!0},O.descriptors[Q]={get:function(){return this[P]},set:function(D){D!==this[P]&&(void 0!==D&&null!==D?(!f||D instanceof x||(D=new(x.bind.apply(x,C([void 0],D,!1)))),!F||D instanceof V||(D=new V(D)),void 0===D.$proxy&&(F?D=R(D):f&&(D=X(D))),this.$changes.change(Q),D.$changes&&D.$changes.setParent(this,this.$changes.root,this._definition.indexes[Q])):this[P]&&this.$changes.delete(Q),this[P]=D)},enumerable:!0,configurable:!0}}}}function b(D){return function(j,W){var Q=j.constructor;Q._definition.addFilter(W,D)&&(Q._context.useFilters=!0)}}function Y(D){return function(j,W){var Q=j.constructor;Q._definition.addChildrenFilter(W,D)&&(Q._context.useFilters=!0)}}function t(D){return void 0===D&&(D=!0),function(j,W){var Q=j.constructor._definition;Q.deprecated[W]=!0,D&&(Q.descriptors[W]={get:function(){throw new Error("".concat(W," is deprecated."))},set:function(D){},enumerable:!1,configurable:!0})}}function c(D,j,W){for(var Q in void 0===W&&(W={}),W.context||(W.context=D._context||W.context||e),j)s(j[Q],W)(D.prototype,Q);return D}function l(D){for(var j=0,W=0,Q=0,C=D.length;Q<C;Q++)(j=D.charCodeAt(Q))<128?W+=1:j<2048?W+=2:j<55296||j>=57344?W+=3:(Q++,W+=4);return W}function I(D,j,W){for(var Q=0,C=0,k=W.length;C<k;C++)(Q=W.charCodeAt(C))<128?D[j++]=Q:Q<2048?(D[j++]=192|Q>>6,D[j++]=128|63&Q):Q<55296||Q>=57344?(D[j++]=224|Q>>12,D[j++]=128|Q>>6&63,D[j++]=128|63&Q):(C++,Q=65536+((1023&Q)<<10|1023&W.charCodeAt(C)),D[j++]=240|Q>>18,D[j++]=128|Q>>12&63,D[j++]=128|Q>>6&63,D[j++]=128|63&Q)}function y(D,j){D.push(255&j)}function m(D,j){D.push(255&j)}function a(D,j){D.push(255&j),D.push(j>>8&255)}function S(D,j){D.push(255&j),D.push(j>>8&255)}function H(D,j){D.push(255&j),D.push(j>>8&255),D.push(j>>16&255),D.push(j>>24&255)}function z(D,j){var W=j>>24,Q=j>>16,C=j>>8,k=j;D.push(255&k),D.push(255&C),D.push(255&Q),D.push(255&W)}function i(D,j){var W=Math.floor(j/Math.pow(2,32));z(D,j>>>0),z(D,W)}function p(D,j){var W=j/Math.pow(2,32)|0;z(D,j>>>0),z(D,W)}function T(D,j){q(D,j)}function A(D,j){o(D,j)}var w=new Int32Array(2),n=new Float32Array(w.buffer),u=new Float64Array(w.buffer);function q(D,j){n[0]=j,H(D,w[0])}function o(D,j){u[0]=j,H(D,w[0]),H(D,w[1])}function J(D,j){return m(D,j?1:0)}function h(D,j){j||(j="");var W=l(j),Q=0;if(W<32)D.push(160|W),Q=1;else if(W<256)D.push(217),m(D,W),Q=2;else if(W<65536)D.push(218),S(D,W),Q=3;else{if(!(W<4294967296))throw new Error("String too long");D.push(219),z(D,W),Q=5}return I(D,D.length,j),Q+W}function d(D,j){return isNaN(j)?d(D,0):isFinite(j)?j!==(0|j)?(D.push(203),o(D,j),9):j>=0?j<128?(m(D,j),1):j<256?(D.push(204),m(D,j),2):j<65536?(D.push(205),S(D,j),3):j<4294967296?(D.push(206),z(D,j),5):(D.push(207),p(D,j),9):j>=-32?(D.push(224|j+32),1):j>=-128?(D.push(208),y(D,j),2):j>=-32768?(D.push(209),a(D,j),3):j>=-2147483648?(D.push(210),H(D,j),5):(D.push(211),i(D,j),9):d(D,j>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var v=Object.freeze({__proto__:null,utf8Write:I,int8:y,uint8:m,int16:a,uint16:S,int32:H,uint32:z,int64:i,uint64:p,float32:T,float64:A,writeFloat32:q,writeFloat64:o,boolean:J,string:h,number:d});function B(D,j,W){for(var Q="",C=0,k=j,M=j+W;k<M;k++){var O=D[k];0!==(128&O)?192!==(224&O)?224!==(240&O)?240!==(248&O)?console.error("Invalid byte "+O.toString(16)):(C=(7&O)<<18|(63&D[++k])<<12|(63&D[++k])<<6|63&D[++k])>=65536?(C-=65536,Q+=String.fromCharCode(55296+(C>>>10),56320+(1023&C))):Q+=String.fromCharCode(C):Q+=String.fromCharCode((15&O)<<12|(63&D[++k])<<6|63&D[++k]):Q+=String.fromCharCode((31&O)<<6|63&D[++k]):Q+=String.fromCharCode(O)}return Q}function r(D,j){return DD(D,j)<<24>>24}function DD(D,j){return D[j.offset++]}function jD(D,j){return WD(D,j)<<16>>16}function WD(D,j){return D[j.offset++]|D[j.offset++]<<8}function QD(D,j){return D[j.offset++]|D[j.offset++]<<8|D[j.offset++]<<16|D[j.offset++]<<24}function CD(D,j){return QD(D,j)>>>0}function kD(D,j){return PD(D,j)}function MD(D,j){return XD(D,j)}function OD(D,j){var W=CD(D,j);return QD(D,j)*Math.pow(2,32)+W}function ED(D,j){var W=CD(D,j);return CD(D,j)*Math.pow(2,32)+W}var fD=new Int32Array(2),FD=new Float32Array(fD.buffer),ZD=new Float64Array(fD.buffer);function PD(D,j){return fD[0]=QD(D,j),FD[0]}function XD(D,j){return fD[0]=QD(D,j),fD[1]=QD(D,j),ZD[0]}function xD(D,j){return DD(D,j)>0}function RD(D,j){var W,Q=D[j.offset++];Q<192?W=31&Q:217===Q?W=DD(D,j):218===Q?W=WD(D,j):219===Q&&(W=CD(D,j));var C=B(D,j.offset,W);return j.offset+=W,C}function VD(D,j){var W=D[j.offset];return W<192&&W>160||217===W||218===W||219===W}function UD(D,j){var W=D[j.offset++];return W<128?W:202===W?PD(D,j):203===W?XD(D,j):204===W?DD(D,j):205===W?WD(D,j):206===W?CD(D,j):207===W?ED(D,j):208===W?r(D,j):209===W?jD(D,j):210===W?QD(D,j):211===W?OD(D,j):W>223?-1*(255-W+1):void 0}function gD(D,j){var W=D[j.offset];return W<128||W>=202&&W<=211}function ND(D,j){return D[j.offset]<160}function GD(D,j){return D[j.offset-1]===M&&(D[j.offset]<128||D[j.offset]>=202&&D[j.offset]<=211)}var KD=Object.freeze({__proto__:null,int8:r,uint8:DD,int16:jD,uint16:WD,int32:QD,uint32:CD,float32:kD,float64:MD,int64:OD,uint64:ED,readFloat32:PD,readFloat64:XD,boolean:xD,string:RD,stringCheck:VD,number:UD,numberCheck:gD,arrayCheck:ND,switchStructureCheck:GD}),LD=function(){function j(D){var j=this;this.$changes=new E(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,D&&D.forEach((function(D){return j.add(D)}))}return j.prototype.Pf=function(j,W){return void 0===W&&(W=!0),f(this.$callbacks||(this.$callbacks=[]),D.OPERATION.ADD,j,W?this.$items:void 0)},j.prototype.ab=function(j){return f(this.$callbacks||(this.$callbacks=[]),D.OPERATION.DELETE,j)},j.prototype.onChange=function(j){return f(this.$callbacks||(this.$callbacks=[]),D.OPERATION.REPLACE,j)},j.is=function(D){return void 0!==D.collection},j.prototype.add=function(D){var j=this.$refId++;return void 0!==D.$changes&&D.$changes.setParent(this,this.$changes.root,j),this.$changes.indexes[j]=j,this.$indexes.set(j,j),this.$items.set(j,D),this.$changes.change(j),j},j.prototype.at=function(D){var j=Array.from(this.$items.keys())[D];return this.$items.get(j)},j.prototype.entries=function(){return this.$items.entries()},j.prototype.delete=function(D){for(var j,W,Q=this.$items.entries();(W=Q.next())&&!W.done;)if(D===W.value[1]){j=W.value[0];break}return void 0!==j&&(this.$changes.delete(j),this.$indexes.delete(j),this.$items.delete(j))},j.prototype.clear=function(j){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),j&&F.call(this,j),this.$items.clear(),this.$changes.operation({index:0,op:D.OPERATION.CLEAR}),this.$changes.touchParents()},j.prototype.has=function(D){return Array.from(this.$items.values()).some((function(j){return j===D}))},j.prototype.forEach=function(D){var j=this;this.$items.forEach((function(W,Q,C){return D(W,Q,j)}))},j.prototype.values=function(){return this.$items.values()},Object.defineProperty(j.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),j.prototype.setIndex=function(D,j){this.$indexes.set(D,j)},j.prototype.getIndex=function(D){return this.$indexes.get(D)},j.prototype.getByIndex=function(D){return this.$items.get(this.$indexes.get(D))},j.prototype.deleteByIndex=function(D){var j=this.$indexes.get(D);this.$items.delete(j),this.$indexes.delete(D)},j.prototype.toArray=function(){return Array.from(this.$items.values())},j.prototype.toJSON=function(){var D=[];return this.forEach((function(j,W){D.push("function"===typeof j.toJSON?j.toJSON():j)})),D},j.prototype.clone=function(D){var W;return D?W=Object.assign(new j,this):(W=new j,this.forEach((function(D){D.$changes?W.add(D.clone()):W.add(D)}))),W},j}(),eD=function(){function j(D){var j=this;this.$changes=new E(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,D&&D.forEach((function(D){return j.add(D)}))}return j.prototype.Pf=function(j,W){return void 0===W&&(W=!0),f(this.$callbacks||(this.$callbacks=[]),D.OPERATION.ADD,j,W?this.$items:void 0)},j.prototype.ab=function(j){return f(this.$callbacks||(this.$callbacks=[]),D.OPERATION.DELETE,j)},j.prototype.onChange=function(j){return f(this.$callbacks||(this.$callbacks=[]),D.OPERATION.REPLACE,j)},j.is=function(D){return void 0!==D.set},j.prototype.add=function(j){var W,Q;if(this.has(j))return!1;var C=this.$refId++;void 0!==j.$changes&&j.$changes.setParent(this,this.$changes.root,C);var k=null!==(Q=null===(W=this.$changes.indexes[C])||void 0===W?void 0:W.op)&&void 0!==Q?Q:D.OPERATION.ADD;return this.$changes.indexes[C]=C,this.$indexes.set(C,C),this.$items.set(C,j),this.$changes.change(C,k),C},j.prototype.entries=function(){return this.$items.entries()},j.prototype.delete=function(D){for(var j,W,Q=this.$items.entries();(W=Q.next())&&!W.done;)if(D===W.value[1]){j=W.value[0];break}return void 0!==j&&(this.$changes.delete(j),this.$indexes.delete(j),this.$items.delete(j))},j.prototype.clear=function(j){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),j&&F.call(this,j),this.$items.clear(),this.$changes.operation({index:0,op:D.OPERATION.CLEAR}),this.$changes.touchParents()},j.prototype.has=function(D){for(var j,W=this.$items.values(),Q=!1;(j=W.next())&&!j.done;)if(D===j.value){Q=!0;break}return Q},j.prototype.forEach=function(D){var j=this;this.$items.forEach((function(W,Q,C){return D(W,Q,j)}))},j.prototype.values=function(){return this.$items.values()},Object.defineProperty(j.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),j.prototype.setIndex=function(D,j){this.$indexes.set(D,j)},j.prototype.getIndex=function(D){return this.$indexes.get(D)},j.prototype.getByIndex=function(D){return this.$items.get(this.$indexes.get(D))},j.prototype.deleteByIndex=function(D){var j=this.$indexes.get(D);this.$items.delete(j),this.$indexes.delete(D)},j.prototype.toArray=function(){return Array.from(this.$items.values())},j.prototype.toJSON=function(){var D=[];return this.forEach((function(j,W){D.push("function"===typeof j.toJSON?j.toJSON():j)})),D},j.prototype.clone=function(D){var W;return D?W=Object.assign(new j,this):(W=new j,this.forEach((function(D){D.$changes?W.add(D.clone()):W.add(D)}))),W},j}(),sD=function(){function D(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return D.prototype.addRefId=function(D){this.refIds.has(D)||(this.refIds.add(D),this.containerIndexes.set(D,new Set))},D.get=function(j){return void 0===j.$filterState&&(j.$filterState=new D),j.$filterState},D}(),bD=function(){function D(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return D.prototype.getNextUniqueId=function(){return this.nextUniqueId++},D.prototype.addRef=function(D,j,W){void 0===W&&(W=!0),this.refs.set(D,j),W&&(this.refCounts[D]=(this.refCounts[D]||0)+1)},D.prototype.removeRef=function(D){this.refCounts[D]=this.refCounts[D]-1,this.deletedRefs.add(D)},D.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},D.prototype.garbageCollectDeletedRefs=function(){var D=this;this.deletedRefs.forEach((function(j){if(!(D.refCounts[j]>0)){var W=D.refs.get(j);if(W instanceof yD)for(var Q in W._definition.schema)"string"!==typeof W._definition.schema[Q]&&W[Q]&&W[Q].$changes&&D.removeRef(W[Q].$changes.refId);else{var C=W.$changes.parent._definition,k=C.schema[C.fieldsByIndex[W.$changes.parentIndex]];"function"===typeof Object.values(k)[0]&&Array.from(W.values()).forEach((function(j){return D.removeRef(j.$changes.refId)}))}D.refs.delete(j),delete D.refCounts[j]}})),this.deletedRefs.clear()},D}(),YD=function(D){function j(){return null!==D&&D.apply(this,arguments)||this}return W(j,D),j}(Error);function tD(D,j,W,Q){var C,k=!1;switch(j){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":C="number",isNaN(D)&&console.log('trying to encode "NaN" in '.concat(W.constructor.name,"#").concat(Q));break;case"string":C="string",k=!0;break;case"boolean":return}if(typeof D!==C&&(!k||k&&null!==D)){var M="'".concat(JSON.stringify(D),"'").concat(D&&D.constructor&&" (".concat(D.constructor.name,")")||"");throw new YD("a '".concat(C,"' was expected, but ").concat(M," was provided in ").concat(W.constructor.name,"#").concat(Q))}}function cD(D,j,W,Q){if(!(D instanceof j))throw new YD("a '".concat(j.name,"' was expected, but '").concat(D.constructor.name,"' was provided in ").concat(W.constructor.name,"#").concat(Q))}function lD(D,j,W,Q,C){tD(W,D,Q,C);var k=v[D];if(!k)throw new YD("a '".concat(D,"' was expected, but ").concat(W," was provided in ").concat(Q.constructor.name,"#").concat(C));k(j,W)}function ID(D,j,W){return KD[D](j,W)}var yD=function(){function j(){for(var D=[],j=0;j<arguments.length;j++)D[j]=arguments[j];Object.defineProperties(this,{$changes:{value:new E(this,void 0,new bD),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var W=this._definition.descriptors;W&&Object.defineProperties(this,W),D[0]&&this.assign(D[0])}return j.onError=function(D){console.error(D)},j.is=function(D){return D._definition&&void 0!==D._definition.schema},j.prototype.onChange=function(j){return f(this.$callbacks||(this.$callbacks=[]),D.OPERATION.REPLACE,j)},j.prototype.ab=function(j){return f(this.$callbacks||(this.$callbacks=[]),D.OPERATION.DELETE,j)},j.prototype.assign=function(D){return Object.assign(this,D),this},Object.defineProperty(j.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),j.prototype.setDirty=function(D,j){this.$changes.change(D,j)},j.prototype.listen=function(D,j,W){var Q=this;return void 0===W&&(W=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[D]||(this.$callbacks[D]=[]),this.$callbacks[D].push(j),W&&void 0!==this[D]&&j(this[D],void 0),function(){return Z(Q.$callbacks[D],Q.$callbacks[D].indexOf(j))}},j.prototype.decode=function(W,Q,C){var k;void 0===Q&&(Q={offset:0}),void 0===C&&(C=this);var O=[],E=this.$changes.root,f=W.length,F=0;for(E.refs.set(F,this);Q.offset<f;){var Z=W[Q.offset++];if(Z!=M){var P=C.$changes,X=void 0!==C._definition,R=X?Z>>6<<6:Z;if(R!==D.OPERATION.CLEAR){var U=X?Z%(R||255):UD(W,Q),g=X?C._definition.fieldsByIndex[U]:"",G=P.getType(U),K=void 0,L=void 0,e=void 0;if(X?L=C["_".concat(g)]:(L=C.getByIndex(U),(R&D.OPERATION.ADD)===D.OPERATION.ADD?(e=C instanceof V?RD(W,Q):U,C.setIndex(U,e)):e=C.getIndex(U)),(R&D.OPERATION.DELETE)===D.OPERATION.DELETE&&(R!==D.OPERATION.DELETE_AND_ADD&&C.deleteByIndex(U),L&&L.$changes&&E.removeRef(L.$changes.refId),K=null),void 0!==g){if(R===D.OPERATION.DELETE);else if(j.is(G)){var s=UD(W,Q);if(K=E.refs.get(s),R!==D.OPERATION.REPLACE){var b=this.getSchemaType(W,Q,G);K||((K=this.createTypeInstance(b)).$changes.refId=s,L&&(K.$callbacks=L.$callbacks,L.$changes.refId&&s!==L.$changes.refId&&E.removeRef(L.$changes.refId))),E.addRef(s,K,K!==L)}}else if("string"===typeof G)K=ID(G,W,Q);else{var Y=N(Object.keys(G)[0]),t=UD(W,Q),c=E.refs.has(t)?L||E.refs.get(t):new Y.constructor;if((K=c.clone(!0)).$changes.refId=t,L&&(K.$callbacks=L.$callbacks,L.$changes.refId&&t!==L.$changes.refId)){E.removeRef(L.$changes.refId);for(var l=L.entries(),I=void 0;(I=l.next())&&!I.done;){var y=(k=I.value)[0],m=k[1];O.push({refId:t,op:D.OPERATION.DELETE,field:y,value:void 0,previousValue:m})}}E.addRef(t,K,c!==L)}if(null!==K&&void 0!==K)if(K.$changes&&K.$changes.setParent(P.ref,P.root,U),C instanceof j)C[g]=K;else if(C instanceof V)y=e,C.$items.set(y,K),C.$changes.allChanges.add(U);else if(C instanceof x)C.setAt(U,K);else if(C instanceof LD){var a=C.add(K);C.setIndex(U,a)}else C instanceof eD&&!1!==(a=C.add(K))&&C.setIndex(U,a);L!==K&&O.push({refId:F,op:R,field:g,dynamicIndex:e,value:K,previousValue:L})}else{console.warn("@colyseus/schema: definition mismatch");for(var S={offset:Q.offset};Q.offset<f&&(!GD(W,Q)||(S.offset=Q.offset+1,!E.refs.has(UD(W,S))));)Q.offset++}}else C.clear(O)}else{F=UD(W,Q);var H=E.refs.get(F);if(!H)throw new Error('"refId" not found: '.concat(F));C=H}}return this._triggerChanges(O),E.garbageCollectDeletedRefs(),O},j.prototype.encode=function(W,Q,C){void 0===W&&(W=!1),void 0===Q&&(Q=[]),void 0===C&&(C=!1);for(var k=this.$changes,O=new WeakSet,E=[k],f=1,F=0;F<f;F++){var Z=E[F],P=Z.ref,X=P instanceof j;Z.ensureRefId(),O.add(Z),Z!==k&&(Z.changed||W)&&(m(Q,M),d(Q,Z.refId));for(var x=W?Array.from(Z.allChanges):Array.from(Z.changes.values()),R=0,U=x.length;R<U;R++){var g=W?{op:D.OPERATION.ADD,index:x[R]}:x[R],G=g.index,K=X?P._definition.fieldsByIndex&&P._definition.fieldsByIndex[G]:G,L=Q.length;if(g.op!==D.OPERATION.TOUCH)if(X)m(Q,G|g.op);else{if(m(Q,g.op),g.op===D.OPERATION.CLEAR)continue;d(Q,G)}if(X||(g.op&D.OPERATION.ADD)!=D.OPERATION.ADD||P instanceof V&&h(Q,Z.ref.$indexes.get(G)),g.op!==D.OPERATION.DELETE){var e=Z.getType(G),s=Z.getValue(G);if(s&&s.$changes&&!O.has(s.$changes)&&(E.push(s.$changes),s.$changes.ensureRefId(),f++),g.op!==D.OPERATION.TOUCH){if(j.is(e))cD(s,e,P,K),d(Q,s.$changes.refId),(g.op&D.OPERATION.ADD)===D.OPERATION.ADD&&this.tryEncodeTypeId(Q,e,s.constructor);else if("string"===typeof e)lD(e,Q,s,P,K);else{var b=N(Object.keys(e)[0]);cD(P["_".concat(K)],b.constructor,P,K),d(Q,s.$changes.refId)}C&&Z.cache(G,Q.slice(L))}}}W||C||Z.discard()}return Q},j.prototype.encodeAll=function(D){return this.encode(!0,[],D)},j.prototype.applyFilters=function(W,Q){var C,k;void 0===Q&&(Q=!1);for(var O=this,E=new Set,f=sD.get(W),F=[this.$changes],Z=1,P=[],X=function(X){var x=F[X];if(E.has(x.refId))return"continue";var R=x.ref,U=R instanceof j;m(P,M),d(P,x.refId);var g=f.refIds.has(x),N=Q||!g;f.addRefId(x);var G=f.containerIndexes.get(x),K=N?Array.from(x.allChanges):Array.from(x.changes.values());!Q&&U&&R._definition.indexesWithFilters&&R._definition.indexesWithFilters.forEach((function(j){!G.has(j)&&x.allChanges.has(j)&&(N?K.push(j):K.push({op:D.OPERATION.ADD,index:j}))}));for(var L=0,e=K.length;L<e;L++){var s=N?{op:D.OPERATION.ADD,index:K[L]}:K[L];if(s.op!==D.OPERATION.CLEAR){var b=s.index;if(s.op!==D.OPERATION.DELETE){var Y=x.getValue(b),t=x.getType(b);if(U){if((c=R._definition.filters&&R._definition.filters[b])&&!c.call(R,W,Y,O)){Y&&Y.$changes&&E.add(Y.$changes.refId);continue}}else{var c,l=x.parent;if((c=x.getChildrenFilter())&&!c.call(l,W,R.$indexes.get(b),Y,O)){Y&&Y.$changes&&E.add(Y.$changes.refId);continue}}if(Y.$changes&&(F.push(Y.$changes),Z++),s.op!==D.OPERATION.TOUCH)if(s.op===D.OPERATION.ADD||U)P.push.apply(P,null!==(C=x.caches[b])&&void 0!==C?C:[]),G.add(b);else if(G.has(b))P.push.apply(P,null!==(k=x.caches[b])&&void 0!==k?k:[]);else{if(G.add(b),m(P,D.OPERATION.ADD),d(P,b),R instanceof V){var I=x.ref.$indexes.get(b);h(P,I)}Y.$changes?d(P,Y.$changes.refId):v[t](P,Y)}else Y.$changes&&!U&&(m(P,D.OPERATION.ADD),d(P,b),R instanceof V&&(I=x.ref.$indexes.get(b),h(P,I)),d(P,Y.$changes.refId))}else U?m(P,s.op|b):(m(P,s.op),d(P,b))}else m(P,s.op)}},x=0;x<Z;x++)X(x);return P},j.prototype.clone=function(){var D,j=new this.constructor,W=this._definition.schema;for(var Q in W)"object"===typeof this[Q]&&"function"===typeof(null===(D=this[Q])||void 0===D?void 0:D.clone)?j[Q]=this[Q].clone():j[Q]=this[Q];return j},j.prototype.toJSON=function(){var D=this._definition.schema,j=this._definition.deprecated,W={};for(var Q in D)j[Q]||null===this[Q]||"undefined"===typeof this[Q]||(W[Q]="function"===typeof this[Q].toJSON?this[Q].toJSON():this["_".concat(Q)]);return W},j.prototype.discardAllChanges=function(){this.$changes.discardAll()},j.prototype.getByIndex=function(D){return this[this._definition.fieldsByIndex[D]]},j.prototype.deleteByIndex=function(D){this[this._definition.fieldsByIndex[D]]=void 0},j.prototype.tryEncodeTypeId=function(D,j,W){j._typeid!==W._typeid&&(m(D,O),d(D,W._typeid))},j.prototype.getSchemaType=function(D,j,W){var Q;return D[j.offset]===O&&(j.offset++,Q=this.constructor._context.get(UD(D,j))),Q||W},j.prototype.createTypeInstance=function(D){var j=new D;return j.$changes.root=this.$changes.root,j},j.prototype._triggerChanges=function(W){for(var Q,C,k,M,O,E,f,F,Z,P=new Set,X=this.$changes.root.refs,x=function(x){var R=W[x],V=R.refId,U=X.get(V),g=U.$callbacks;if((R.op&D.OPERATION.DELETE)===D.OPERATION.DELETE&&R.previousValue instanceof j&&(null===(C=null===(Q=R.previousValue.$callbacks)||void 0===Q?void 0:Q[D.OPERATION.DELETE])||void 0===C||C.forEach((function(D){return D()}))),!g)return"continue";if(U instanceof j){if(!P.has(V))try{null===(k=null===g||void 0===g?void 0:g[D.OPERATION.REPLACE])||void 0===k||k.forEach((function(D){return D()}))}catch(N){j.onError(N)}try{g.hasOwnProperty(R.field)&&(null===(M=g[R.field])||void 0===M||M.forEach((function(D){return D(R.value,R.previousValue)})))}catch(N){j.onError(N)}}else R.op===D.OPERATION.ADD&&void 0===R.previousValue?null===(O=g[D.OPERATION.ADD])||void 0===O||O.forEach((function(D){var j;return D(R.value,null!==(j=R.dynamicIndex)&&void 0!==j?j:R.field)})):R.op===D.OPERATION.DELETE?void 0!==R.previousValue&&(null===(E=g[D.OPERATION.DELETE])||void 0===E||E.forEach((function(D){var j;return D(R.previousValue,null!==(j=R.dynamicIndex)&&void 0!==j?j:R.field)}))):R.op===D.OPERATION.DELETE_AND_ADD&&(void 0!==R.previousValue&&(null===(f=g[D.OPERATION.DELETE])||void 0===f||f.forEach((function(D){var j;return D(R.previousValue,null!==(j=R.dynamicIndex)&&void 0!==j?j:R.field)}))),null===(F=g[D.OPERATION.ADD])||void 0===F||F.forEach((function(D){var j;return D(R.value,null!==(j=R.dynamicIndex)&&void 0!==j?j:R.field)}))),R.value!==R.previousValue&&(null===(Z=g[D.OPERATION.REPLACE])||void 0===Z||Z.forEach((function(D){var j;return D(R.value,null!==(j=R.dynamicIndex)&&void 0!==j?j:R.field)})));P.add(V)},R=0;R<W.length;R++)x(R)},j._definition=G.create(),j}();function mD(D){for(var j=[D.$changes],W=1,Q={},C=Q,k=function(D){var W=j[D];W.changes.forEach((function(D){var j=W.ref,Q=D.index,k=j._definition?j._definition.fieldsByIndex[Q]:j.$indexes.get(Q);C[k]=W.getValue(Q)}))},M=0;M<W;M++)k(M);return Q}var aD={context:new L},SD=function(D){function j(){return null!==D&&D.apply(this,arguments)||this}return W(j,D),Q([s("string",aD)],j.prototype,"name",void 0),Q([s("string",aD)],j.prototype,"type",void 0),Q([s("number",aD)],j.prototype,"referencedType",void 0),j}(yD),HD=function(D){function j(){var j=null!==D&&D.apply(this,arguments)||this;return j.fields=new x,j}return W(j,D),Q([s("number",aD)],j.prototype,"id",void 0),Q([s([SD],aD)],j.prototype,"fields",void 0),j}(yD),zD=function(D){function j(){var j=null!==D&&D.apply(this,arguments)||this;return j.types=new x,j}return W(j,D),j.encode=function(D){var W=D.constructor,Q=new j;Q.rootType=W._typeid;var C=function(D,j){for(var W in j){var C=new SD;C.name=W;var k=void 0;if("string"===typeof j[W])k=j[W];else{var M=j[W],O=void 0;yD.is(M)?(k="ref",O=j[W]):"string"===typeof M[k=Object.keys(M)[0]]?k+=":"+M[k]:O=M[k],C.referencedType=O?O._typeid:-1}C.type=k,D.fields.push(C)}Q.types.push(D)},k=W._context.types;for(var M in k){var O=new HD;O.id=Number(M),C(O,k[M]._definition.schema)}return Q.encodeAll()},j.decode=function(D,Q){var C=new L,k=new j;k.decode(D,Q);var M=k.types.reduce((function(D,j){var Q=function(D){function j(){return null!==D&&D.apply(this,arguments)||this}return W(j,D),j}(yD),k=j.id;return D[k]=Q,C.add(Q,k),D}),{});k.types.forEach((function(D){var j=M[D.id];D.fields.forEach((function(D){var W;if(void 0!==D.referencedType){var Q=D.type,k=M[D.referencedType];if(!k){var O=D.type.split(":");Q=O[0],k=O[1]}"ref"===Q?s(k,{context:C})(j.prototype,D.name):s(((W={})[Q]=k,W),{context:C})(j.prototype,D.name)}else s(D.type,{context:C})(j.prototype,D.name)}))}));var O=M[k.rootType],E=new O;for(var f in O._definition.schema){var F=O._definition.schema[f];"string"!==typeof F&&(E[f]="function"===typeof F?new F:new(N(Object.keys(F)[0]).constructor))}return E},Q([s([HD],aD)],j.prototype,"types",void 0),Q([s("number",aD)],j.prototype,"rootType",void 0),j}(yD);g("map",{constructor:V}),g("array",{constructor:x}),g("set",{constructor:eD}),g("collection",{constructor:LD}),D.ArraySchema=x,D.CollectionSchema=LD,D.Context=L,D.MapSchema=V,D.Reflection=zD,D.ReflectionField=SD,D.ReflectionType=HD,D.Schema=yD,D.SchemaDefinition=G,D.SetSchema=eD,D.decode=KD,D.defineTypes=c,D.deprecated=t,D.dumpChanges=mD,D.encode=v,D.filter=b,D.filterChildren=Y,D.hasFilter=K,D.registerType=g,D.type=s,Object.defineProperty(D,"__esModule",{value:!0})}(j)},13014:D=>{"use strict";D.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13006:(D,j,W)=>{var Q=W(13014),C=W(13018),k=Object.hasOwnProperty,M=Object.create(null);for(var O in Q)k.call(Q,O)&&(M[Q[O]]=O);var E=D.exports={to:{},get:{}};function f(D,j,W){return Math.min(Math.max(j,D),W)}function F(D){var j=Math.round(D).toString(16).toUpperCase();return j.length<2?"0"+j:j}E.get=function(D){var j,W;switch(D.substring(0,3).toLowerCase()){case"hsl":j=E.get.hsl(D),W="hsl";break;case"hwb":j=E.get.hwb(D),W="hwb";break;default:j=E.get.rgb(D),W="rgb"}return j?{model:W,value:j}:null},E.get.rgb=function(D){if(!D)return null;var j,W,C,M=[0,0,0,1];if(j=D.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(C=j[2],j=j[1],W=0;W<3;W++){var O=2*W;M[W]=parseInt(j.slice(O,O+2),16)}C&&(M[3]=parseInt(C,16)/255)}else if(j=D.match(/^#([a-f0-9]{3,4})$/i)){for(C=(j=j[1])[3],W=0;W<3;W++)M[W]=parseInt(j[W]+j[W],16);C&&(M[3]=parseInt(C+C,16)/255)}else if(j=D.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(W=0;W<3;W++)M[W]=parseInt(j[W+1],0);j[4]&&(j[5]?M[3]=.01*parseFloat(j[4]):M[3]=parseFloat(j[4]))}else{if(!(j=D.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(j=D.match(/^(\w+)$/))?"transparent"===j[1]?[0,0,0,0]:k.call(Q,j[1])?((M=Q[j[1]])[3]=1,M):null:null;for(W=0;W<3;W++)M[W]=Math.round(2.55*parseFloat(j[W+1]));j[4]&&(j[5]?M[3]=.01*parseFloat(j[4]):M[3]=parseFloat(j[4]))}for(W=0;W<3;W++)M[W]=f(M[W],0,255);return M[3]=f(M[3],0,1),M},E.get.hsl=function(D){if(!D)return null;var j=D.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(j){var W=parseFloat(j[4]);return[(parseFloat(j[1])%360+360)%360,f(parseFloat(j[2]),0,100),f(parseFloat(j[3]),0,100),f(isNaN(W)?1:W,0,1)]}return null},E.get.hwb=function(D){if(!D)return null;var j=D.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(j){var W=parseFloat(j[4]);return[(parseFloat(j[1])%360+360)%360,f(parseFloat(j[2]),0,100),f(parseFloat(j[3]),0,100),f(isNaN(W)?1:W,0,1)]}return null},E.to.hex=function(){var D=C(arguments);return"#"+F(D[0])+F(D[1])+F(D[2])+(D[3]<1?F(Math.round(255*D[3])):"")},E.to.rgb=function(){var D=C(arguments);return D.length<4||1===D[3]?"rgb("+Math.round(D[0])+", "+Math.round(D[1])+", "+Math.round(D[2])+")":"rgba("+Math.round(D[0])+", "+Math.round(D[1])+", "+Math.round(D[2])+", "+D[3]+")"},E.to.rgb.percent=function(){var D=C(arguments),j=Math.round(D[0]/255*100),W=Math.round(D[1]/255*100),Q=Math.round(D[2]/255*100);return D.length<4||1===D[3]?"rgb("+j+"%, "+W+"%, "+Q+"%)":"rgba("+j+"%, "+W+"%, "+Q+"%, "+D[3]+")"},E.to.hsl=function(){var D=C(arguments);return D.length<4||1===D[3]?"hsl("+D[0]+", "+D[1]+"%, "+D[2]+"%)":"hsla("+D[0]+", "+D[1]+"%, "+D[2]+"%, "+D[3]+")"},E.to.hwb=function(){var D=C(arguments),j="";return D.length>=4&&1!==D[3]&&(j=", "+D[3]),"hwb("+D[0]+", "+D[1]+"%, "+D[2]+"%"+j+")"},E.to.keyword=function(D){return M[D.slice(0,3)]}},13e3:(D,j,W)=>{const Q=W(13006),C=W(13024),k=["keyword","gray","hex"],M={};for(const X of Object.keys(C))M[[...C[X].labels].sort().join("")]=X;const O={};function E(D,j){if(!(this instanceof E))return new E(D,j);if(j&&j in k&&(j=null),j&&!(j in C))throw new Error("Unknown model: "+j);let W,f;if(null==D)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(D instanceof E)this.model=D.model,this.color=[...D.color],this.valpha=D.valpha;else if("string"===typeof D){const j=Q.get(D);if(null===j)throw new Error("Unable to parse color from string: "+D);this.model=j.model,f=C[this.model].channels,this.color=j.value.slice(0,f),this.valpha="number"===typeof j.value[f]?j.value[f]:1}else if(D.length>0){this.model=j||"rgb",f=C[this.model].channels;const W=Array.prototype.slice.call(D,0,f);this.color=P(W,f),this.valpha="number"===typeof D[f]?D[f]:1}else if("number"===typeof D)this.model="rgb",this.color=[D>>16&255,D>>8&255,255&D],this.valpha=1;else{this.valpha=1;const j=Object.keys(D);"alpha"in D&&(j.splice(j.indexOf("alpha"),1),this.valpha="number"===typeof D.alpha?D.alpha:0);const Q=j.sort().join("");if(!(Q in M))throw new Error("Unable to parse color from object: "+JSON.stringify(D));this.model=M[Q];const{labels:k}=C[this.model],O=[];for(W=0;W<k.length;W++)O.push(D[k[W]]);this.color=P(O)}if(O[this.model])for(f=C[this.model].channels,W=0;W<f;W++){const D=O[this.model][W];D&&(this.color[W]=D(this.color[W]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}E.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(D){let j=this.model in Q.to?this:this.rgb();j=j.round("number"===typeof D?D:1);const W=1===j.valpha?j.color:[...j.color,this.valpha];return Q.to[j.model](W)},percentString(D){const j=this.rgb().round("number"===typeof D?D:1),W=1===j.valpha?j.color:[...j.color,this.valpha];return Q.to.rgb.percent(W)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const D={},{channels:j}=C[this.model],{labels:W}=C[this.model];for(let Q=0;Q<j;Q++)D[W[Q]]=this.color[Q];return 1!==this.valpha&&(D.alpha=this.valpha),D},unitArray(){const D=this.rgb().color;return D[0]/=255,D[1]/=255,D[2]/=255,1!==this.valpha&&D.push(this.valpha),D},unitObject(){const D=this.rgb().object();return D.r/=255,D.g/=255,D.b/=255,1!==this.valpha&&(D.alpha=this.valpha),D},round(D){return D=Math.max(D||0,0),new E([...this.color.map(f(D)),this.valpha],this.model)},alpha(D){return void 0!==D?new E([...this.color,Math.max(0,Math.min(1,D))],this.model):this.valpha},red:F("rgb",0,Z(255)),green:F("rgb",1,Z(255)),blue:F("rgb",2,Z(255)),hue:F(["hsl","hsv","hsl","hwb","hcg"],0,(D=>(D%360+360)%360)),saturationl:F("hsl",1,Z(100)),lightness:F("hsl",2,Z(100)),saturationv:F("hsv",1,Z(100)),value:F("hsv",2,Z(100)),chroma:F("hcg",1,Z(100)),gray:F("hcg",2,Z(100)),white:F("hwb",1,Z(100)),wblack:F("hwb",2,Z(100)),cyan:F("cmyk",0,Z(100)),magenta:F("cmyk",1,Z(100)),yellow:F("cmyk",2,Z(100)),black:F("cmyk",3,Z(100)),x:F("xyz",0,Z(95.047)),y:F("xyz",1,Z(100)),z:F("xyz",2,Z(108.833)),l:F("lab",0,Z(100)),a:F("lab",1),b:F("lab",2),keyword(D){return void 0!==D?new E(D):C[this.model].keyword(this.color)},hex(D){return void 0!==D?new E(D):Q.to.hex(this.rgb().round().color)},hexa(D){if(void 0!==D)return new E(D);const j=this.rgb().round().color;let W=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===W.length&&(W="0"+W),Q.to.hex(j)+W},rgbNumber(){const D=this.rgb().color;return(255&D[0])<<16|(255&D[1])<<8|255&D[2]},luminosity(){const D=this.rgb().color,j=[];for(const[W,Q]of D.entries()){const D=Q/255;j[W]=D<=.04045?D/12.92:((D+.055)/1.055)**2.4}return.2126*j[0]+.7152*j[1]+.0722*j[2]},contrast(D){const j=this.luminosity(),W=D.luminosity();return j>W?(j+.05)/(W+.05):(W+.05)/(j+.05)},level(D){const j=this.contrast(D);return j>=7?"AAA":j>=4.5?"AA":""},isDark(){const D=this.rgb().color;return(2126*D[0]+7152*D[1]+722*D[2])/1e4<128},isLight(){return!this.isDark()},negate(){const D=this.rgb();for(let j=0;j<3;j++)D.color[j]=255-D.color[j];return D},lighten(D){const j=this.hsl();return j.color[2]+=j.color[2]*D,j},darken(D){const j=this.hsl();return j.color[2]-=j.color[2]*D,j},saturate(D){const j=this.hsl();return j.color[1]+=j.color[1]*D,j},desaturate(D){const j=this.hsl();return j.color[1]-=j.color[1]*D,j},whiten(D){const j=this.hwb();return j.color[1]+=j.color[1]*D,j},blacken(D){const j=this.hwb();return j.color[2]+=j.color[2]*D,j},grayscale(){const D=this.rgb().color,j=.3*D[0]+.59*D[1]+.11*D[2];return E.rgb(j,j,j)},fade(D){return this.alpha(this.valpha-this.valpha*D)},opaquer(D){return this.alpha(this.valpha+this.valpha*D)},rotate(D){const j=this.hsl();let W=j.color[0];return W=(W+D)%360,W=W<0?360+W:W,j.color[0]=W,j},mix(D,j){if(!D||!D.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof D);const W=D.rgb(),Q=this.rgb(),C=void 0===j?.5:j,k=2*C-1,M=W.alpha()-Q.alpha(),O=((k*M===-1?k:(k+M)/(1+k*M))+1)/2,f=1-O;return E.rgb(O*W.red()+f*Q.red(),O*W.green()+f*Q.green(),O*W.blue()+f*Q.blue(),W.alpha()*C+Q.alpha()*(1-C))}};for(const X of Object.keys(C)){if(k.includes(X))continue;const{channels:D}=C[X];E.prototype[X]=function(){if(this.model===X)return new E(this);for(var D=arguments.length,j=new Array(D),W=0;W<D;W++)j[W]=arguments[W];return j.length>0?new E(j,X):new E([...(Q=C[this.model][X].raw(this.color),Array.isArray(Q)?Q:[Q]),this.valpha],X);var Q},E[X]=function(){for(var j=arguments.length,W=new Array(j),Q=0;Q<j;Q++)W[Q]=arguments[Q];let C=W[0];return"number"===typeof C&&(C=P(W,D)),new E(C,X)}}function f(D){return function(j){return function(D,j){return Number(D.toFixed(j))}(j,D)}}function F(D,j,W){D=Array.isArray(D)?D:[D];for(const Q of D)(O[Q]||(O[Q]=[]))[j]=W;return D=D[0],function(Q){let C;return void 0!==Q?(W&&(Q=W(Q)),C=this[D](),C.color[j]=Q,C):(C=this[D]().color[j],W&&(C=W(C)),C)}}function Z(D){return function(j){return Math.max(0,Math.min(D,j))}}function P(D,j){for(let W=0;W<j;W++)"number"!==typeof D[W]&&(D[W]=0);return D}D.exports=E},13029:(D,j,W)=>{const Q=W(13033),C={};for(const M of Object.keys(Q))C[Q[M]]=M;const k={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};D.exports=k;for(const M of Object.keys(k)){if(!("channels"in k[M]))throw new Error("missing channels property: "+M);if(!("labels"in k[M]))throw new Error("missing channel labels property: "+M);if(k[M].labels.length!==k[M].channels)throw new Error("channel and label counts mismatch: "+M);const{channels:D,labels:j}=k[M];delete k[M].channels,delete k[M].labels,Object.defineProperty(k[M],"channels",{value:D}),Object.defineProperty(k[M],"labels",{value:j})}k.rgb.hsl=function(D){const j=D[0]/255,W=D[1]/255,Q=D[2]/255,C=Math.min(j,W,Q),k=Math.max(j,W,Q),M=k-C;let O,E;k===C?O=0:j===k?O=(W-Q)/M:W===k?O=2+(Q-j)/M:Q===k&&(O=4+(j-W)/M),O=Math.min(60*O,360),O<0&&(O+=360);const f=(C+k)/2;return E=k===C?0:f<=.5?M/(k+C):M/(2-k-C),[O,100*E,100*f]},k.rgb.hsv=function(D){let j,W,Q,C,k;const M=D[0]/255,O=D[1]/255,E=D[2]/255,f=Math.max(M,O,E),F=f-Math.min(M,O,E),Z=function(D){return(f-D)/6/F+.5};return 0===F?(C=0,k=0):(k=F/f,j=Z(M),W=Z(O),Q=Z(E),M===f?C=Q-W:O===f?C=1/3+j-Q:E===f&&(C=2/3+W-j),C<0?C+=1:C>1&&(C-=1)),[360*C,100*k,100*f]},k.rgb.hwb=function(D){const j=D[0],W=D[1];let Q=D[2];const C=k.rgb.hsl(D)[0],M=1/255*Math.min(j,Math.min(W,Q));return Q=1-1/255*Math.max(j,Math.max(W,Q)),[C,100*M,100*Q]},k.rgb.cmyk=function(D){const j=D[0]/255,W=D[1]/255,Q=D[2]/255,C=Math.min(1-j,1-W,1-Q);return[100*((1-j-C)/(1-C)||0),100*((1-W-C)/(1-C)||0),100*((1-Q-C)/(1-C)||0),100*C]},k.rgb.keyword=function(D){const j=C[D];if(j)return j;let W,k=1/0;for(const C of Object.keys(Q)){const j=Q[C],E=(O=j,((M=D)[0]-O[0])**2+(M[1]-O[1])**2+(M[2]-O[2])**2);E<k&&(k=E,W=C)}var M,O;return W},k.keyword.rgb=function(D){return Q[D]},k.rgb.xyz=function(D){let j=D[0]/255,W=D[1]/255,Q=D[2]/255;j=j>.04045?((j+.055)/1.055)**2.4:j/12.92,W=W>.04045?((W+.055)/1.055)**2.4:W/12.92,Q=Q>.04045?((Q+.055)/1.055)**2.4:Q/12.92;return[100*(.4124*j+.3576*W+.1805*Q),100*(.2126*j+.7152*W+.0722*Q),100*(.0193*j+.1192*W+.9505*Q)]},k.rgb.lab=function(D){const j=k.rgb.xyz(D);let W=j[0],Q=j[1],C=j[2];W/=95.047,Q/=100,C/=108.883,W=W>.008856?W**(1/3):7.787*W+16/116,Q=Q>.008856?Q**(1/3):7.787*Q+16/116,C=C>.008856?C**(1/3):7.787*C+16/116;return[116*Q-16,500*(W-Q),200*(Q-C)]},k.hsl.rgb=function(D){const j=D[0]/360,W=D[1]/100,Q=D[2]/100;let C,k,M;if(0===W)return M=255*Q,[M,M,M];C=Q<.5?Q*(1+W):Q+W-Q*W;const O=2*Q-C,E=[0,0,0];for(let f=0;f<3;f++)k=j+1/3*-(f-1),k<0&&k++,k>1&&k--,M=6*k<1?O+6*(C-O)*k:2*k<1?C:3*k<2?O+(C-O)*(2/3-k)*6:O,E[f]=255*M;return E},k.hsl.hsv=function(D){const j=D[0];let W=D[1]/100,Q=D[2]/100,C=W;const k=Math.max(Q,.01);Q*=2,W*=Q<=1?Q:2-Q,C*=k<=1?k:2-k;return[j,100*(0===Q?2*C/(k+C):2*W/(Q+W)),100*((Q+W)/2)]},k.hsv.rgb=function(D){const j=D[0]/60,W=D[1]/100;let Q=D[2]/100;const C=Math.floor(j)%6,k=j-Math.floor(j),M=255*Q*(1-W),O=255*Q*(1-W*k),E=255*Q*(1-W*(1-k));switch(Q*=255,C){case 0:return[Q,E,M];case 1:return[O,Q,M];case 2:return[M,Q,E];case 3:return[M,O,Q];case 4:return[E,M,Q];case 5:return[Q,M,O]}},k.hsv.hsl=function(D){const j=D[0],W=D[1]/100,Q=D[2]/100,C=Math.max(Q,.01);let k,M;M=(2-W)*Q;const O=(2-W)*C;return k=W*C,k/=O<=1?O:2-O,k=k||0,M/=2,[j,100*k,100*M]},k.hwb.rgb=function(D){const j=D[0]/360;let W=D[1]/100,Q=D[2]/100;const C=W+Q;let k;C>1&&(W/=C,Q/=C);const M=Math.floor(6*j),O=1-Q;k=6*j-M,0!==(1&M)&&(k=1-k);const E=W+k*(O-W);let f,F,Z;switch(M){default:case 6:case 0:f=O,F=E,Z=W;break;case 1:f=E,F=O,Z=W;break;case 2:f=W,F=O,Z=E;break;case 3:f=W,F=E,Z=O;break;case 4:f=E,F=W,Z=O;break;case 5:f=O,F=W,Z=E}return[255*f,255*F,255*Z]},k.cmyk.rgb=function(D){const j=D[0]/100,W=D[1]/100,Q=D[2]/100,C=D[3]/100;return[255*(1-Math.min(1,j*(1-C)+C)),255*(1-Math.min(1,W*(1-C)+C)),255*(1-Math.min(1,Q*(1-C)+C))]},k.xyz.rgb=function(D){const j=D[0]/100,W=D[1]/100,Q=D[2]/100;let C,k,M;return C=3.2406*j+-1.5372*W+-.4986*Q,k=-.9689*j+1.8758*W+.0415*Q,M=.0557*j+-.204*W+1.057*Q,C=C>.0031308?1.055*C**(1/2.4)-.055:12.92*C,k=k>.0031308?1.055*k**(1/2.4)-.055:12.92*k,M=M>.0031308?1.055*M**(1/2.4)-.055:12.92*M,C=Math.min(Math.max(0,C),1),k=Math.min(Math.max(0,k),1),M=Math.min(Math.max(0,M),1),[255*C,255*k,255*M]},k.xyz.lab=function(D){let j=D[0],W=D[1],Q=D[2];j/=95.047,W/=100,Q/=108.883,j=j>.008856?j**(1/3):7.787*j+16/116,W=W>.008856?W**(1/3):7.787*W+16/116,Q=Q>.008856?Q**(1/3):7.787*Q+16/116;return[116*W-16,500*(j-W),200*(W-Q)]},k.lab.xyz=function(D){let j,W,Q;W=(D[0]+16)/116,j=D[1]/500+W,Q=W-D[2]/200;const C=W**3,k=j**3,M=Q**3;return W=C>.008856?C:(W-16/116)/7.787,j=k>.008856?k:(j-16/116)/7.787,Q=M>.008856?M:(Q-16/116)/7.787,j*=95.047,W*=100,Q*=108.883,[j,W,Q]},k.lab.lch=function(D){const j=D[0],W=D[1],Q=D[2];let C;C=360*Math.atan2(Q,W)/2/Math.PI,C<0&&(C+=360);return[j,Math.sqrt(W*W+Q*Q),C]},k.lch.lab=function(D){const j=D[0],W=D[1],Q=D[2]/360*2*Math.PI;return[j,W*Math.cos(Q),W*Math.sin(Q)]},k.rgb.ansi16=function(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[W,Q,C]=D;let M=null===j?k.rgb.hsv(D)[2]:j;if(M=Math.round(M/50),0===M)return 30;let O=30+(Math.round(C/255)<<2|Math.round(Q/255)<<1|Math.round(W/255));return 2===M&&(O+=60),O},k.hsv.ansi16=function(D){return k.rgb.ansi16(k.hsv.rgb(D),D[2])},k.rgb.ansi256=function(D){const j=D[0],W=D[1],Q=D[2];if(j===W&&W===Q)return j<8?16:j>248?231:Math.round((j-8)/247*24)+232;return 16+36*Math.round(j/255*5)+6*Math.round(W/255*5)+Math.round(Q/255*5)},k.ansi16.rgb=function(D){let j=D%10;if(0===j||7===j)return D>50&&(j+=3.5),j=j/10.5*255,[j,j,j];const W=.5*(1+~~(D>50));return[(1&j)*W*255,(j>>1&1)*W*255,(j>>2&1)*W*255]},k.ansi256.rgb=function(D){if(D>=232){const j=10*(D-232)+8;return[j,j,j]}let j;D-=16;return[Math.floor(D/36)/5*255,Math.floor((j=D%36)/6)/5*255,j%6/5*255]},k.rgb.hex=function(D){const j=(((255&Math.round(D[0]))<<16)+((255&Math.round(D[1]))<<8)+(255&Math.round(D[2]))).toString(16).toUpperCase();return"000000".substring(j.length)+j},k.hex.rgb=function(D){const j=D.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!j)return[0,0,0];let W=j[0];3===j[0].length&&(W=W.split("").map((D=>D+D)).join(""));const Q=parseInt(W,16);return[Q>>16&255,Q>>8&255,255&Q]},k.rgb.hcg=function(D){const j=D[0]/255,W=D[1]/255,Q=D[2]/255,C=Math.max(Math.max(j,W),Q),k=Math.min(Math.min(j,W),Q),M=C-k;let O,E;return O=M<1?k/(1-M):0,E=M<=0?0:C===j?(W-Q)/M%6:C===W?2+(Q-j)/M:4+(j-W)/M,E/=6,E%=1,[360*E,100*M,100*O]},k.hsl.hcg=function(D){const j=D[1]/100,W=D[2]/100,Q=W<.5?2*j*W:2*j*(1-W);let C=0;return Q<1&&(C=(W-.5*Q)/(1-Q)),[D[0],100*Q,100*C]},k.hsv.hcg=function(D){const j=D[1]/100,W=D[2]/100,Q=j*W;let C=0;return Q<1&&(C=(W-Q)/(1-Q)),[D[0],100*Q,100*C]},k.hcg.rgb=function(D){const j=D[0]/360,W=D[1]/100,Q=D[2]/100;if(0===W)return[255*Q,255*Q,255*Q];const C=[0,0,0],k=j%1*6,M=k%1,O=1-M;let E=0;switch(Math.floor(k)){case 0:C[0]=1,C[1]=M,C[2]=0;break;case 1:C[0]=O,C[1]=1,C[2]=0;break;case 2:C[0]=0,C[1]=1,C[2]=M;break;case 3:C[0]=0,C[1]=O,C[2]=1;break;case 4:C[0]=M,C[1]=0,C[2]=1;break;default:C[0]=1,C[1]=0,C[2]=O}return E=(1-W)*Q,[255*(W*C[0]+E),255*(W*C[1]+E),255*(W*C[2]+E)]},k.hcg.hsv=function(D){const j=D[1]/100,W=j+D[2]/100*(1-j);let Q=0;return W>0&&(Q=j/W),[D[0],100*Q,100*W]},k.hcg.hsl=function(D){const j=D[1]/100,W=D[2]/100*(1-j)+.5*j;let Q=0;return W>0&&W<.5?Q=j/(2*W):W>=.5&&W<1&&(Q=j/(2*(1-W))),[D[0],100*Q,100*W]},k.hcg.hwb=function(D){const j=D[1]/100,W=j+D[2]/100*(1-j);return[D[0],100*(W-j),100*(1-W)]},k.hwb.hcg=function(D){const j=D[1]/100,W=1-D[2]/100,Q=W-j;let C=0;return Q<1&&(C=(W-Q)/(1-Q)),[D[0],100*Q,100*C]},k.apple.rgb=function(D){return[D[0]/65535*255,D[1]/65535*255,D[2]/65535*255]},k.rgb.apple=function(D){return[D[0]/255*65535,D[1]/255*65535,D[2]/255*65535]},k.gray.rgb=function(D){return[D[0]/100*255,D[0]/100*255,D[0]/100*255]},k.gray.hsl=function(D){return[0,0,D[0]]},k.gray.hsv=k.gray.hsl,k.gray.hwb=function(D){return[0,100,D[0]]},k.gray.cmyk=function(D){return[0,0,0,D[0]]},k.gray.lab=function(D){return[D[0],0,0]},k.gray.hex=function(D){const j=255&Math.round(D[0]/100*255),W=((j<<16)+(j<<8)+j).toString(16).toUpperCase();return"000000".substring(W.length)+W},k.rgb.gray=function(D){return[(D[0]+D[1]+D[2])/3/255*100]}},13024:(D,j,W)=>{const Q=W(13029),C=W(13040),k={};Object.keys(Q).forEach((D=>{k[D]={},Object.defineProperty(k[D],"channels",{value:Q[D].channels}),Object.defineProperty(k[D],"labels",{value:Q[D].labels});const j=C(D);Object.keys(j).forEach((W=>{const Q=j[W];k[D][W]=function(D){const j=function(){for(var j=arguments.length,W=new Array(j),Q=0;Q<j;Q++)W[Q]=arguments[Q];const C=W[0];if(void 0===C||null===C)return C;C.length>1&&(W=C);const k=D(W);if("object"===typeof k)for(let D=k.length,M=0;M<D;M++)k[M]=Math.round(k[M]);return k};return"conversion"in D&&(j.conversion=D.conversion),j}(Q),k[D][W].raw=function(D){const j=function(){for(var j=arguments.length,W=new Array(j),Q=0;Q<j;Q++)W[Q]=arguments[Q];const C=W[0];return void 0===C||null===C?C:(C.length>1&&(W=C),D(W))};return"conversion"in D&&(j.conversion=D.conversion),j}(Q)}))})),D.exports=k},13040:(D,j,W)=>{const Q=W(13029);function C(D){const j=function(){const D={},j=Object.keys(Q);for(let W=j.length,Q=0;Q<W;Q++)D[j[Q]]={distance:-1,parent:null};return D}(),W=[D];for(j[D].distance=0;W.length;){const D=W.pop(),C=Object.keys(Q[D]);for(let Q=C.length,k=0;k<Q;k++){const Q=C[k],M=j[Q];-1===M.distance&&(M.distance=j[D].distance+1,M.parent=D,W.unshift(Q))}}return j}function k(D,j){return function(W){return j(D(W))}}function M(D,j){const W=[j[D].parent,D];let C=Q[j[D].parent][D],M=j[D].parent;for(;j[M].parent;)W.unshift(j[M].parent),C=k(Q[j[M].parent][M],C),M=j[M].parent;return C.conversion=W,C}D.exports=function(D){const j=C(D),W={},Q=Object.keys(j);for(let C=Q.length,k=0;k<C;k++){const D=Q[k];null!==j[D].parent&&(W[D]=M(D,j))}return W}},13033:D=>{"use strict";D.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},11783:function(D,j,W){"use strict";var Q=this&&this.__createBinding||(Object.create?function(D,j,W,Q){void 0===Q&&(Q=W);var C=Object.getOwnPropertyDescriptor(j,W);C&&!("get"in C?!j.__esModule:C.writable||C.configurable)||(C={enumerable:!0,get:function(){return j[W]}}),Object.defineProperty(D,Q,C)}:function(D,j,W,Q){void 0===Q&&(Q=W),D[Q]=j[W]}),C=this&&this.__setModuleDefault||(Object.create?function(D,j){Object.defineProperty(D,"default",{enumerable:!0,value:j})}:function(D,j){D.default=j}),k=this&&this.__importStar||function(D){if(D&&D.__esModule)return D;var j={};if(null!=D)for(var W in D)"default"!==W&&Object.prototype.hasOwnProperty.call(D,W)&&Q(j,D,W);return C(j,D),j},M=this&&this.__awaiter||function(D,j,W,Q){return new(W||(W=Promise))((function(C,k){function M(D){try{E(Q.next(D))}catch(j){k(j)}}function O(D){try{E(Q.throw(D))}catch(j){k(j)}}function E(D){var j;D.done?C(D.value):(j=D.value,j instanceof W?j:new W((function(D){D(j)}))).then(M,O)}E((Q=Q.apply(D,j||[])).next())}))};Object.defineProperty(j,"__esModule",{value:!0}),j.Auth=j.Platform=void 0;const O=k(W(11725)),E=W(11792),f="colyseus-auth-token";!function(D){D.ios="ios",D.android="android"}(j.Platform||(j.Platform={}));j.Auth=class{constructor(D){this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=D.replace("ws","http"),(0,E.getItem)(f,(D=>this.token=D))}get hasToken(){return!!this.token}login(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return M(this,void 0,void 0,(function*(){const j=Object.assign({},D);this.hasToken&&(j.token=this.token);const W=yield this.request("post","/auth",j);this.token=W.token,(0,E.setItem)(f,this.token);for(let D in W)this.hasOwnProperty(D)&&(this[D]=W[D]);return this.registerPingService(),this}))}save(){return M(this,void 0,void 0,(function*(){return yield this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone}),this}))}getFriends(){return M(this,void 0,void 0,(function*(){return yield this.request("get","/friends/all")}))}getOnlineFriends(){return M(this,void 0,void 0,(function*(){return yield this.request("get","/friends/online")}))}getFriendRequests(){return M(this,void 0,void 0,(function*(){return yield this.request("get","/friends/requests")}))}sendFriendRequest(D){return M(this,void 0,void 0,(function*(){return yield this.request("post","/friends/requests",{userId:D})}))}acceptFriendRequest(D){return M(this,void 0,void 0,(function*(){return yield this.request("put","/friends/requests",{userId:D})}))}declineFriendRequest(D){return M(this,void 0,void 0,(function*(){return yield this.request("del","/friends/requests",{userId:D})}))}blockUser(D){return M(this,void 0,void 0,(function*(){return yield this.request("post","/friends/block",{userId:D})}))}unblockUser(D){return M(this,void 0,void 0,(function*(){return yield this.request("put","/friends/block",{userId:D})}))}request(D,j){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},Q=arguments.length>3?arguments[3]:void 0,C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return M(this,void 0,void 0,(function*(){C.Accept="application/json",this.hasToken&&(C.Authorization="Bearer "+this.token);const k=[];for(const D in W)k.push(`${D}=${W[D]}`);const M=k.length>0?`?${k.join("&")}`:"",E={headers:C};return Q&&(E.body=Q),(yield O[D](`${this.endpoint}${j}${M}`,E)).data}))}logout(){this.token=void 0,(0,E.removeItem)(f),this.unregisterPingService()}registerPingService(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;this.unregisterPingService(),this.keepOnlineInterval=setInterval((()=>this.request("get","/auth")),D)}unregisterPingService(){clearInterval(this.keepOnlineInterval)}}},11719:function(D,j,W){"use strict";var Q,C=this&&this.__awaiter||function(D,j,W,Q){return new(W||(W=Promise))((function(C,k){function M(D){try{E(Q.next(D))}catch(j){k(j)}}function O(D){try{E(Q.throw(D))}catch(j){k(j)}}function E(D){var j;D.done?C(D.value):(j=D.value,j instanceof W?j:new W((function(D){D(j)}))).then(M,O)}E((Q=Q.apply(D,j||[])).next())}))};Object.defineProperty(j,"__esModule",{value:!0}),j.Client=j.MatchMakeError=void 0;const k=W(11725),M=W(11733),O=W(11735);class E extends Error{constructor(D,j){super(D),this.code=j,Object.setPrototypeOf(this,E.prototype)}}j.MatchMakeError=E;const f="undefined"!==typeof window&&"undefined"!==typeof(null===(Q=null===window||void 0===window?void 0:window.location)||void 0===Q?void 0:Q.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";j.Client=class{constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f;if("string"===typeof D){const j=new URL(D),W="https:"===j.protocol||"wss:"===j.protocol,Q=Number(j.port||(W?443:80));this.settings={hostname:j.hostname,pathname:"/"!==j.pathname?j.pathname:"",port:Q,secure:W}}else void 0===D.port&&(D.port=D.secure?443:80),void 0===D.pathname&&(D.pathname=""),this.settings=D}joinOrCreate(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},W=arguments.length>2?arguments[2]:void 0;return C(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",D,j,W)}))}create(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},W=arguments.length>2?arguments[2]:void 0;return C(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",D,j,W)}))}join(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},W=arguments.length>2?arguments[2]:void 0;return C(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",D,j,W)}))}joinById(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},W=arguments.length>2?arguments[2]:void 0;return C(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",D,j,W)}))}reconnect(D,j){return C(this,void 0,void 0,(function*(){if("string"===typeof D&&"string"===typeof j)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[W,Q]=D.split(":");return yield this.createMatchMakeRequest("reconnect",W,{reconnectionToken:Q},j)}))}getAvailableRooms(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return C(this,void 0,void 0,(function*(){return(yield(0,k.get)(this.getHttpEndpoint(`${D}`),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(D,j,W){return C(this,void 0,void 0,(function*(){const Q=this.createRoom(D.room.name,j);Q.roomId=D.room.roomId,Q.sessionId=D.sessionId;const k={sessionId:Q.sessionId};D.reconnectionToken&&(k.reconnectionToken=D.reconnectionToken);const O=W||Q;return Q.connect(this.buildEndpoint(D.room,k),D.devMode&&(()=>C(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${Q.roomId}'...`);let W=0;const k=()=>C(this,void 0,void 0,(function*(){W++;try{yield this.consumeSeatReservation(D,j,O),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${Q.roomId}'`)}catch(C){W<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${W} out of 8)`),setTimeout(k,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(k,2e3)}))),O),new Promise(((D,j)=>{const W=(D,W)=>j(new M.ServerError(D,W));O.onError.once(W),O.onJoin.once((()=>{O.onError.remove(W),D(O)}))}))}))}createMatchMakeRequest(D,j){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},Q=arguments.length>3?arguments[3]:void 0,M=arguments.length>4?arguments[4]:void 0;return C(this,void 0,void 0,(function*(){const C=(yield(0,k.post)(this.getHttpEndpoint(`${D}/${j}`),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(W)})).data;if(C.error)throw new E(C.error,C.code);return"reconnect"===D&&(C.reconnectionToken=W.reconnectionToken),yield this.consumeSeatReservation(C,Q,M)}))}createRoom(D,j){return new O.Room(D,j)}buildEndpoint(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const W=[];for(const C in j)j.hasOwnProperty(C)&&W.push(`${C}=${j[C]}`);let Q=this.settings.secure?"wss://":"ws://";return D.publicAddress?Q+=`${D.publicAddress}`:Q+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`,`${Q}/${D.processId}/${D.roomId}?${W.join("&")}`}getHttpEndpoint(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}/matchmake/${D}`}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},11741:(D,j,W)=>{"use strict";Object.defineProperty(j,"__esModule",{value:!0}),j.Connection=void 0;const Q=W(11748);j.Connection=class{constructor(){this.events={},this.transport=new Q.WebSocketTransport(this.events)}send(D){this.transport.send(D)}connect(D){this.transport.connect(D)}close(D,j){this.transport.close(D,j)}get isOpen(){return this.transport.isOpen}}},11758:(D,j)=>{"use strict";Object.defineProperty(j,"__esModule",{value:!0}),j.utf8Length=j.utf8Read=j.ErrorCode=j.Protocol=void 0,function(D){D[D.HANDSHAKE=9]="HANDSHAKE",D[D.JOIN_ROOM=10]="JOIN_ROOM",D[D.ERROR=11]="ERROR",D[D.LEAVE_ROOM=12]="LEAVE_ROOM",D[D.ROOM_DATA=13]="ROOM_DATA",D[D.ROOM_STATE=14]="ROOM_STATE",D[D.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",D[D.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",D[D.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(j.Protocol||(j.Protocol={})),function(D){D[D.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",D[D.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",D[D.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",D[D.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",D[D.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",D[D.AUTH_FAILED=4215]="AUTH_FAILED",D[D.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(j.ErrorCode||(j.ErrorCode={})),j.utf8Read=function(D,j){const W=D[j++];for(var Q="",C=0,k=j,M=j+W;k<M;k++){var O=D[k];if(0!==(128&O))if(192!==(224&O))if(224!==(240&O)){if(240!==(248&O))throw new Error("Invalid byte "+O.toString(16));(C=(7&O)<<18|(63&D[++k])<<12|(63&D[++k])<<6|63&D[++k])>=65536?(C-=65536,Q+=String.fromCharCode(55296+(C>>>10),56320+(1023&C))):Q+=String.fromCharCode(C)}else Q+=String.fromCharCode((15&O)<<12|(63&D[++k])<<6|63&D[++k]);else Q+=String.fromCharCode((31&O)<<6|63&D[++k]);else Q+=String.fromCharCode(O)}return Q},j.utf8Length=function(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",j=0,W=0;for(let Q=0,C=D.length;Q<C;Q++)j=D.charCodeAt(Q),j<128?W+=1:j<2048?W+=2:j<55296||j>=57344?W+=3:(Q++,W+=4);return W+1}},11735:function(D,j,W){"use strict";var Q=this&&this.__createBinding||(Object.create?function(D,j,W,Q){void 0===Q&&(Q=W);var C=Object.getOwnPropertyDescriptor(j,W);C&&!("get"in C?!j.__esModule:C.writable||C.configurable)||(C={enumerable:!0,get:function(){return j[W]}}),Object.defineProperty(D,Q,C)}:function(D,j,W,Q){void 0===Q&&(Q=W),D[Q]=j[W]}),C=this&&this.__setModuleDefault||(Object.create?function(D,j){Object.defineProperty(D,"default",{enumerable:!0,value:j})}:function(D,j){D.default=j}),k=this&&this.__importStar||function(D){if(D&&D.__esModule)return D;var j={};if(null!=D)for(var W in D)"default"!==W&&Object.prototype.hasOwnProperty.call(D,W)&&Q(j,D,W);return C(j,D),j};Object.defineProperty(j,"__esModule",{value:!0}),j.Room=void 0;const M=k(W(11739)),O=W(11741),E=W(11758),f=W(11764),F=W(11767),Z=W(11770),P=W(11775),X=W(11733);class x{constructor(D,j){this.onStateChange=(0,Z.createSignal)(),this.onError=(0,Z.createSignal)(),this.onLeave=(0,Z.createSignal)(),this.onJoin=(0,Z.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,F.createNanoEvents)(),this.roomId=null,this.name=D,j&&(this.serializer=new((0,f.getSerializer)("schema")),this.rootSchema=j,this.serializer.state=new j),this.onError(((D,j)=>{var W;return null===(W=console.warn)||void 0===W?void 0:W.call(console,`colyseus.js - onError => (${D}) ${j}`)})),this.onLeave((()=>this.removeAllListeners()))}get id(){return this.roomId}connect(D,j){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;const Q=new O.Connection;W.connection=Q,Q.events.onmessage=x.prototype.onMessageCallback.bind(W),Q.events.onclose=function(D){var Q;if(!W.hasJoined)return null===(Q=console.warn)||void 0===Q||Q.call(console,`Room connection was closed unexpectedly (${D.code}): ${D.reason}`),void W.onError.invoke(D.code,D.reason);D.code===X.CloseCode.DEVMODE_RESTART&&j?j():(W.onLeave.invoke(D.code),W.destroy())},Q.events.onerror=function(D){var j;null===(j=console.warn)||void 0===j||j.call(console,`Room, onError (${D.code}): ${D.reason}`),W.onError.invoke(D.code,D.reason)},Q.connect(D)}leave(){let D=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((j=>{this.onLeave((D=>j(D))),this.connection?D?this.connection.send([E.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(X.CloseCode.CONSENTED)}))}onMessage(D,j){return this.onMessageHandlers.on(this.getMessageHandlerKey(D),j)}send(D,j){const W=[E.Protocol.ROOM_DATA];let Q;if("string"===typeof D?P.encode.string(W,D):P.encode.number(W,D),void 0!==j){const D=M.encode(j);Q=new Uint8Array(W.length+D.byteLength),Q.set(new Uint8Array(W),0),Q.set(new Uint8Array(D),W.length)}else Q=new Uint8Array(W);this.connection.send(Q.buffer)}sendBytes(D,j){const W=[E.Protocol.ROOM_DATA_BYTES];let Q;"string"===typeof D?P.encode.string(W,D):P.encode.number(W,D),Q=new Uint8Array(W.length+(j.byteLength||j.length)),Q.set(new Uint8Array(W),0),Q.set(new Uint8Array(j),W.length),this.connection.send(Q.buffer)}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(D){const j=Array.from(new Uint8Array(D.data)),W=j[0];if(W===E.Protocol.JOIN_ROOM){let D=1;const W=(0,E.utf8Read)(j,D);if(D+=(0,E.utf8Length)(W),this.serializerId=(0,E.utf8Read)(j,D),D+=(0,E.utf8Length)(this.serializerId),!this.serializer){const D=(0,f.getSerializer)(this.serializerId);this.serializer=new D}j.length>D&&this.serializer.handshake&&this.serializer.handshake(j,{offset:D}),this.reconnectionToken=`${this.roomId}:${W}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([E.Protocol.JOIN_ROOM])}else if(W===E.Protocol.ERROR){const D={offset:1},W=P.decode.number(j,D),Q=P.decode.string(j,D);this.onError.invoke(W,Q)}else if(W===E.Protocol.LEAVE_ROOM)this.leave();else if(W===E.Protocol.ROOM_DATA_SCHEMA){const D={offset:1},W=this.serializer.getState().constructor._context.get(P.decode.number(j,D)),Q=new W;Q.decode(j,D),this.dispatchMessage(W,Q)}else if(W===E.Protocol.ROOM_STATE)j.shift(),this.setState(j);else if(W===E.Protocol.ROOM_STATE_PATCH)j.shift(),this.patch(j);else if(W===E.Protocol.ROOM_DATA){const W={offset:1},Q=P.decode.stringCheck(j,W)?P.decode.string(j,W):P.decode.number(j,W),C=j.length>W.offset?M.decode(D.data,W.offset):void 0;this.dispatchMessage(Q,C)}else if(W===E.Protocol.ROOM_DATA_BYTES){const D={offset:1},W=P.decode.stringCheck(j,D)?P.decode.string(j,D):P.decode.number(j,D);this.dispatchMessage(W,new Uint8Array(j.slice(D.offset)))}}setState(D){this.serializer.setState(D),this.onStateChange.invoke(this.serializer.getState())}patch(D){this.serializer.patch(D),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(D,j){var W;const Q=this.getMessageHandlerKey(D);this.onMessageHandlers.events[Q]?this.onMessageHandlers.emit(Q,j):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",D,j):null===(W=console.warn)||void 0===W||W.call(console,`colyseus.js: onMessage() not registered for type '${D}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(D){switch(typeof D){case"function":return`$${D._typeid}`;case"string":return D;case"number":return`i${D}`;default:throw new Error("invalid message type.")}}}j.Room=x},11792:(D,j)=>{"use strict";let W;function Q(){return W||(W="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!==typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(D,j){this.cache[D]=j},getItem:function(D){this.cache[D]},removeItem:function(D){delete this.cache[D]}}),W}Object.defineProperty(j,"__esModule",{value:!0}),j.getItem=j.removeItem=j.setItem=void 0,j.setItem=function(D,j){Q().setItem(D,j)},j.removeItem=function(D){Q().removeItem(D)},j.getItem=function(D,j){const W=Q().getItem(D);"undefined"!==typeof Promise&&W instanceof Promise?W.then((D=>j(D))):j(W)}},11767:(D,j)=>{"use strict";Object.defineProperty(j,"__esModule",{value:!0}),j.createNanoEvents=void 0;j.createNanoEvents=()=>({emit(D){let j=this.events[D]||[];for(var W=arguments.length,Q=new Array(W>1?W-1:0),C=1;C<W;C++)Q[C-1]=arguments[C];for(let k=0,M=j.length;k<M;k++)j[k](...Q)},events:{},on(D,j){var W;return(null===(W=this.events[D])||void 0===W?void 0:W.push(j))||(this.events[D]=[j]),()=>{var W;this.events[D]=null===(W=this.events[D])||void 0===W?void 0:W.filter((D=>j!==D))}}})},11770:(D,j)=>{"use strict";Object.defineProperty(j,"__esModule",{value:!0}),j.createSignal=j.EventEmitter=void 0;class W{constructor(){this.handlers=[]}register(D){return this.handlers.push(D),this}invoke(){for(var D=arguments.length,j=new Array(D),W=0;W<D;W++)j[W]=arguments[W];this.handlers.forEach((D=>D.apply(this,j)))}invokeAsync(){for(var D=arguments.length,j=new Array(D),W=0;W<D;W++)j[W]=arguments[W];return Promise.all(this.handlers.map((D=>D.apply(this,j))))}remove(D){const j=this.handlers.indexOf(D);this.handlers[j]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}j.EventEmitter=W,j.createSignal=function(){const D=new W;function j(j){return D.register(j,null===this)}return j.once=j=>{const W=function(){for(var Q=arguments.length,C=new Array(Q),k=0;k<Q;k++)C[k]=arguments[k];j.apply(this,C),D.remove(W)};D.register(W)},j.remove=j=>D.remove(j),j.invoke=function(){return D.invoke(...arguments)},j.invokeAsync=function(){return D.invokeAsync(...arguments)},j.clear=()=>D.clear(),j}},11733:(D,j)=>{"use strict";Object.defineProperty(j,"__esModule",{value:!0}),j.ServerError=j.CloseCode=void 0,function(D){D[D.CONSENTED=4e3]="CONSENTED",D[D.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(j.CloseCode||(j.CloseCode={}));class W extends Error{constructor(D,j){super(j),this.name="ServerError",this.code=D}}j.ServerError=W},11705:(D,j,W)=>{"use strict";j.c=void 0,W(11714);var Q=W(11719);Object.defineProperty(j,"c",{enumerable:!0,get:function(){return Q.Client}});var C=W(11758);var k=W(11735);var M=W(11783);const O=W(11797);const E=W(11806),f=W(11764);(0,f.registerSerializer)("schema",O.SchemaSerializer),(0,f.registerSerializer)("none",E.NoneSerializer)},11714:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=D=>null!==D&&"object"===typeof D&&D.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},11739:(D,j)=>{"use strict";function W(D,j){if(this._offset=j,D instanceof ArrayBuffer)this._buffer=D,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(D))throw new Error("Invalid argument");this._buffer=D.buffer,this._view=new DataView(this._buffer,D.byteOffset,D.byteLength)}}Object.defineProperty(j,"__esModule",{value:!0}),j.decode=j.encode=void 0,W.prototype._array=function(D){for(var j=new Array(D),W=0;W<D;W++)j[W]=this._parse();return j},W.prototype._map=function(D){for(var j={},W=0;W<D;W++)j[this._parse()]=this._parse();return j},W.prototype._str=function(D){var j=function(D,j,W){for(var Q="",C=0,k=j,M=j+W;k<M;k++){var O=D.getUint8(k);if(0!==(128&O))if(192!==(224&O))if(224!==(240&O)){if(240!==(248&O))throw new Error("Invalid byte "+O.toString(16));(C=(7&O)<<18|(63&D.getUint8(++k))<<12|(63&D.getUint8(++k))<<6|63&D.getUint8(++k))>=65536?(C-=65536,Q+=String.fromCharCode(55296+(C>>>10),56320+(1023&C))):Q+=String.fromCharCode(C)}else Q+=String.fromCharCode((15&O)<<12|(63&D.getUint8(++k))<<6|63&D.getUint8(++k));else Q+=String.fromCharCode((31&O)<<6|63&D.getUint8(++k));else Q+=String.fromCharCode(O)}return Q}(this._view,this._offset,D);return this._offset+=D,j},W.prototype._bin=function(D){var j=this._buffer.slice(this._offset,this._offset+D);return this._offset+=D,j},W.prototype._parse=function(){var D,j=this._view.getUint8(this._offset++),W=0,Q=0,C=0,k=0;if(j<192)return j<128?j:j<144?this._map(15&j):j<160?this._array(15&j):this._str(31&j);if(j>223)return-1*(255-j+1);switch(j){case 192:return null;case 194:return!1;case 195:return!0;case 196:return W=this._view.getUint8(this._offset),this._offset+=1,this._bin(W);case 197:return W=this._view.getUint16(this._offset),this._offset+=2,this._bin(W);case 198:return W=this._view.getUint32(this._offset),this._offset+=4,this._bin(W);case 199:if(W=this._view.getUint8(this._offset),Q=this._view.getInt8(this._offset+1),this._offset+=2,-1===Q){var M=this._view.getUint32(this._offset);return C=this._view.getInt32(this._offset+4),k=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*C+k)+M/1e6)}return[Q,this._bin(W)];case 200:return W=this._view.getUint16(this._offset),Q=this._view.getInt8(this._offset+2),this._offset+=3,[Q,this._bin(W)];case 201:return W=this._view.getUint32(this._offset),Q=this._view.getInt8(this._offset+4),this._offset+=5,[Q,this._bin(W)];case 202:return D=this._view.getFloat32(this._offset),this._offset+=4,D;case 203:return D=this._view.getFloat64(this._offset),this._offset+=8,D;case 204:return D=this._view.getUint8(this._offset),this._offset+=1,D;case 205:return D=this._view.getUint16(this._offset),this._offset+=2,D;case 206:return D=this._view.getUint32(this._offset),this._offset+=4,D;case 207:return C=this._view.getUint32(this._offset)*Math.pow(2,32),k=this._view.getUint32(this._offset+4),this._offset+=8,C+k;case 208:return D=this._view.getInt8(this._offset),this._offset+=1,D;case 209:return D=this._view.getInt16(this._offset),this._offset+=2,D;case 210:return D=this._view.getInt32(this._offset),this._offset+=4,D;case 211:return C=this._view.getInt32(this._offset)*Math.pow(2,32),k=this._view.getUint32(this._offset+4),this._offset+=8,C+k;case 212:return Q=this._view.getInt8(this._offset),this._offset+=1,0===Q?void(this._offset+=1):[Q,this._bin(1)];case 213:return Q=this._view.getInt8(this._offset),this._offset+=1,[Q,this._bin(2)];case 214:return Q=this._view.getInt8(this._offset),this._offset+=1,-1===Q?(D=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*D)):[Q,this._bin(4)];case 215:return Q=this._view.getInt8(this._offset),this._offset+=1,0===Q?(C=this._view.getInt32(this._offset)*Math.pow(2,32),k=this._view.getUint32(this._offset+4),this._offset+=8,new Date(C+k)):-1===Q?(C=this._view.getUint32(this._offset),k=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&C)+k)+(C>>>2)/1e6)):[Q,this._bin(8)];case 216:return Q=this._view.getInt8(this._offset),this._offset+=1,[Q,this._bin(16)];case 217:return W=this._view.getUint8(this._offset),this._offset+=1,this._str(W);case 218:return W=this._view.getUint16(this._offset),this._offset+=2,this._str(W);case 219:return W=this._view.getUint32(this._offset),this._offset+=4,this._str(W);case 220:return W=this._view.getUint16(this._offset),this._offset+=2,this._array(W);case 221:return W=this._view.getUint32(this._offset),this._offset+=4,this._array(W);case 222:return W=this._view.getUint16(this._offset),this._offset+=2,this._map(W);case 223:return W=this._view.getUint32(this._offset),this._offset+=4,this._map(W)}throw new Error("Could not parse")},j.decode=function(D){var j=new W(D,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),Q=j._parse();if(j._offset!==D.byteLength)throw new Error(D.byteLength-j._offset+" trailing bytes");return Q};function Q(D,j,W){for(var Q=0,C=0,k=W.length;C<k;C++)(Q=W.charCodeAt(C))<128?D.setUint8(j++,Q):Q<2048?(D.setUint8(j++,192|Q>>6),D.setUint8(j++,128|63&Q)):Q<55296||Q>=57344?(D.setUint8(j++,224|Q>>12),D.setUint8(j++,128|Q>>6&63),D.setUint8(j++,128|63&Q)):(C++,Q=65536+((1023&Q)<<10|1023&W.charCodeAt(C)),D.setUint8(j++,240|Q>>18),D.setUint8(j++,128|Q>>12&63),D.setUint8(j++,128|Q>>6&63),D.setUint8(j++,128|63&Q))}function C(D,j,W){var Q=typeof W,k=0,M=0,O=0,E=0,f=0,F=0;if("string"===Q){if(f=function(D){for(var j=0,W=0,Q=0,C=D.length;Q<C;Q++)(j=D.charCodeAt(Q))<128?W+=1:j<2048?W+=2:j<55296||j>=57344?W+=3:(Q++,W+=4);return W}(W),f<32)D.push(160|f),F=1;else if(f<256)D.push(217,f),F=2;else if(f<65536)D.push(218,f>>8,f),F=3;else{if(!(f<4294967296))throw new Error("String too long");D.push(219,f>>24,f>>16,f>>8,f),F=5}return j.push({_str:W,_length:f,_offset:D.length}),F+f}if("number"===Q)return Math.floor(W)===W&&isFinite(W)?W>=0?W<128?(D.push(W),1):W<256?(D.push(204,W),2):W<65536?(D.push(205,W>>8,W),3):W<4294967296?(D.push(206,W>>24,W>>16,W>>8,W),5):(O=W/Math.pow(2,32)|0,E=W>>>0,D.push(207,O>>24,O>>16,O>>8,O,E>>24,E>>16,E>>8,E),9):W>=-32?(D.push(W),1):W>=-128?(D.push(208,W),2):W>=-32768?(D.push(209,W>>8,W),3):W>=-2147483648?(D.push(210,W>>24,W>>16,W>>8,W),5):(O=Math.floor(W/Math.pow(2,32)),E=W>>>0,D.push(211,O>>24,O>>16,O>>8,O,E>>24,E>>16,E>>8,E),9):(D.push(203),j.push({_float:W,_length:8,_offset:D.length}),9);if("object"===Q){if(null===W)return D.push(192),1;if(Array.isArray(W)){if((f=W.length)<16)D.push(144|f),F=1;else if(f<65536)D.push(220,f>>8,f),F=3;else{if(!(f<4294967296))throw new Error("Array too large");D.push(221,f>>24,f>>16,f>>8,f),F=5}for(k=0;k<f;k++)F+=C(D,j,W[k]);return F}if(W instanceof Date){var Z=W.getTime(),P=Math.floor(Z/1e3),X=1e6*(Z-1e3*P);return P>=0&&X>=0&&P<=17179869183?0===X&&P<=4294967295?(D.push(214,255,P>>24,P>>16,P>>8,P),6):(O=P/4294967296,E=4294967295&P,D.push(215,255,X>>22,X>>14,X>>6,O,E>>24,E>>16,E>>8,E),10):(O=Math.floor(P/4294967296),E=P>>>0,D.push(199,12,255,X>>24,X>>16,X>>8,X,O>>24,O>>16,O>>8,O,E>>24,E>>16,E>>8,E),15)}if(W instanceof ArrayBuffer){if((f=W.byteLength)<256)D.push(196,f),F=2;else if(f<65536)D.push(197,f>>8,f),F=3;else{if(!(f<4294967296))throw new Error("Buffer too large");D.push(198,f>>24,f>>16,f>>8,f),F=5}return j.push({_bin:W,_length:f,_offset:D.length}),F+f}if("function"===typeof W.toJSON)return C(D,j,W.toJSON());var x=[],R="",V=Object.keys(W);for(k=0,M=V.length;k<M;k++)void 0!==W[R=V[k]]&&"function"!==typeof W[R]&&x.push(R);if((f=x.length)<16)D.push(128|f),F=1;else if(f<65536)D.push(222,f>>8,f),F=3;else{if(!(f<4294967296))throw new Error("Object too large");D.push(223,f>>24,f>>16,f>>8,f),F=5}for(k=0;k<f;k++)F+=C(D,j,R=x[k]),F+=C(D,j,W[R]);return F}if("boolean"===Q)return D.push(W?195:194),1;if("undefined"===Q)return D.push(192),1;if("function"===typeof W.toJSON)return C(D,j,W.toJSON());throw new Error("Could not encode")}j.encode=function(D){var j=[],W=[],k=C(j,W,D),M=new ArrayBuffer(k),O=new DataView(M),E=0,f=0,F=-1;W.length>0&&(F=W[0]._offset);for(var Z,P=0,X=0,x=0,R=j.length;x<R;x++)if(O.setUint8(f+x,j[x]),x+1===F){if(P=(Z=W[E])._length,X=f+F,Z._bin)for(var V=new Uint8Array(Z._bin),U=0;U<P;U++)O.setUint8(X+U,V[U]);else Z._str?Q(O,X,Z._str):void 0!==Z._float&&O.setFloat64(X,Z._float);f+=P,W[++E]&&(F=W[E]._offset)}return M}},11806:(D,j)=>{"use strict";Object.defineProperty(j,"__esModule",{value:!0}),j.NoneSerializer=void 0;j.NoneSerializer=class{setState(D){}getState(){return null}patch(D){}teardown(){}handshake(D){}}},11797:(D,j,W)=>{"use strict";Object.defineProperty(j,"__esModule",{value:!0}),j.SchemaSerializer=void 0;const Q=W(11775);j.SchemaSerializer=class{setState(D){return this.state.decode(D)}getState(){return this.state}patch(D){return this.state.decode(D)}teardown(){var D,j;null===(j=null===(D=this.state)||void 0===D?void 0:D.$changes)||void 0===j||j.root.clearRefs()}handshake(D,j){if(this.state){(new Q.Reflection).decode(D,j)}else this.state=Q.Reflection.decode(D,j)}}},11764:(D,j)=>{"use strict";Object.defineProperty(j,"__esModule",{value:!0}),j.getSerializer=j.registerSerializer=void 0;const W={};j.registerSerializer=function(D,j){W[D]=j},j.getSerializer=function(D){const j=W[D];if(!j)throw new Error("missing serializer: "+D);return j}},11748:function(D,j,W){"use strict";var Q=this&&this.__importDefault||function(D){return D&&D.__esModule?D:{default:D}};Object.defineProperty(j,"__esModule",{value:!0}),j.WebSocketTransport=void 0;const C=Q(W(11756)),k=globalThis.WebSocket||C.default;j.WebSocketTransport=class{constructor(D){this.events=D}send(D){D instanceof ArrayBuffer?this.ws.send(D):Array.isArray(D)&&this.ws.send(new Uint8Array(D).buffer)}connect(D){this.ws=new k(D,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(D,j){this.ws.close(D,j)}get isOpen(){return this.ws.readyState===k.OPEN}}},11756:D=>{"use strict";D.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},11849:D=>{"use strict";D.exports=function(D){for(var j=new Array(D),W=0;W<D;++W)j[W]=W;return j}},11856:D=>{function j(D){return!!D.constructor&&"function"===typeof D.constructor.isBuffer&&D.constructor.isBuffer(D)}D.exports=function(D){return null!=D&&(j(D)||function(D){return"function"===typeof D.readFloatLE&&"function"===typeof D.slice&&j(D.slice(0,0))}(D)||!!D._isBuffer)}},11846:(D,j,W)=>{var Q=W(11849),C=W(11856),k="undefined"!==typeof Float64Array;function M(D,j){return D[0]-j[0]}function O(){var D,j=this.stride,W=new Array(j.length);for(D=0;D<W.length;++D)W[D]=[Math.abs(j[D]),D];W.sort(M);var Q=new Array(W.length);for(D=0;D<Q.length;++D)Q[D]=W[D][1];return Q}function E(D,j){var W=["View",j,"d",D].join("");j<0&&(W="View_Nil"+D);var C="generic"===D;if(-1===j){var k="function "+W+"(a){this.data=a;};var proto="+W+".prototype;proto.dtype='"+D+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+W+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+W+"(a){return new "+W+"(a);}";return new Function(k)()}if(0===j){k="function "+W+"(a,d) {this.data = a;this.offset = d};var proto="+W+".prototype;proto.dtype='"+D+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+W+"_copy() {return new "+W+"(this.data,this.offset)};proto.pick=function "+W+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+W+"_get(){return "+(C?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+W+"_set(v){return "+(C?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+W+"(a,b,c,d){return new "+W+"(a,d)}";return new Function("TrivialArray",k)(f[D][0])}k=["'use strict'"];var M=Q(j),E=M.map((function(D){return"i"+D})),F="this.offset+"+M.map((function(D){return"this.stride["+D+"]*i"+D})).join("+"),Z=M.map((function(D){return"b"+D})).join(","),P=M.map((function(D){return"c"+D})).join(",");k.push("function "+W+"(a,"+Z+","+P+",d){this.data=a","this.shape=["+Z+"]","this.stride=["+P+"]","this.offset=d|0}","var proto="+W+".prototype","proto.dtype='"+D+"'","proto.dimension="+j),k.push("Object.defineProperty(proto,'size',{get:function "+W+"_size(){return "+M.map((function(D){return"this.shape["+D+"]"})).join("*"),"}})"),1===j?k.push("proto.order=[0]"):(k.push("Object.defineProperty(proto,'order',{get:"),j<4?(k.push("function "+W+"_order(){"),2===j?k.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===j&&k.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):k.push("ORDER})")),k.push("proto.set=function "+W+"_set("+E.join(",")+",v){"),C?k.push("return this.data.set("+F+",v)}"):k.push("return this.data["+F+"]=v}"),k.push("proto.get=function "+W+"_get("+E.join(",")+"){"),C?k.push("return this.data.get("+F+")}"):k.push("return this.data["+F+"]}"),k.push("proto.index=function "+W+"_index(",E.join(),"){return "+F+"}"),k.push("proto.hi=function "+W+"_hi("+E.join(",")+"){return new "+W+"(this.data,"+M.map((function(D){return["(typeof i",D,"!=='number'||i",D,"<0)?this.shape[",D,"]:i",D,"|0"].join("")})).join(",")+","+M.map((function(D){return"this.stride["+D+"]"})).join(",")+",this.offset)}");var X=M.map((function(D){return"a"+D+"=this.shape["+D+"]"})),x=M.map((function(D){return"c"+D+"=this.stride["+D+"]"}));k.push("proto.lo=function "+W+"_lo("+E.join(",")+"){var b=this.offset,d=0,"+X.join(",")+","+x.join(","));for(var R=0;R<j;++R)k.push("if(typeof i"+R+"==='number'&&i"+R+">=0){d=i"+R+"|0;b+=c"+R+"*d;a"+R+"-=d}");k.push("return new "+W+"(this.data,"+M.map((function(D){return"a"+D})).join(",")+","+M.map((function(D){return"c"+D})).join(",")+",b)}"),k.push("proto.step=function "+W+"_step("+E.join(",")+"){var "+M.map((function(D){return"a"+D+"=this.shape["+D+"]"})).join(",")+","+M.map((function(D){return"b"+D+"=this.stride["+D+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(R=0;R<j;++R)k.push("if(typeof i"+R+"==='number'){d=i"+R+"|0;if(d<0){c+=b"+R+"*(a"+R+"-1);a"+R+"=ceil(-a"+R+"/d)}else{a"+R+"=ceil(a"+R+"/d)}b"+R+"*=d}");k.push("return new "+W+"(this.data,"+M.map((function(D){return"a"+D})).join(",")+","+M.map((function(D){return"b"+D})).join(",")+",c)}");var V=new Array(j),U=new Array(j);for(R=0;R<j;++R)V[R]="a[i"+R+"]",U[R]="b[i"+R+"]";k.push("proto.transpose=function "+W+"_transpose("+E+"){"+E.map((function(D,j){return D+"=("+D+"===undefined?"+j+":"+D+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+W+"(this.data,"+V.join(",")+","+U.join(",")+",this.offset)}"),k.push("proto.pick=function "+W+"_pick("+E+"){var a=[],b=[],c=this.offset");for(R=0;R<j;++R)k.push("if(typeof i"+R+"==='number'&&i"+R+">=0){c=(c+this.stride["+R+"]*i"+R+")|0}else{a.push(this.shape["+R+"]);b.push(this.stride["+R+"])}");return k.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),k.push("return function construct_"+W+"(data,shape,stride,offset){return new "+W+"(data,"+M.map((function(D){return"shape["+D+"]"})).join(",")+","+M.map((function(D){return"stride["+D+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",k.join("\n"))(f[D],O)}var f={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};D.exports=function(D,j,W,Q){if(void 0===D)return(0,f.array[0])([]);"number"===typeof D&&(D=[D]),void 0===j&&(j=[D.length]);var M=j.length;if(void 0===W){W=new Array(M);for(var O=M-1,F=1;O>=0;--O)W[O]=F,F*=j[O]}if(void 0===Q){Q=0;for(O=0;O<M;++O)W[O]<0&&(Q-=(j[O]-1)*W[O])}for(var Z=function(D){if(C(D))return"buffer";if(k)switch(Object.prototype.toString.call(D)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(D)?"array":"generic"}(D),P=f[Z];P.length<=M+1;)P.push(E(Z,P.length-1));return(0,P[M+1])(D,j,W,Q)}},11817:D=>{var j;self,j=()=>(()=>{"use strict";var D={d:(j,W)=>{for(var Q in W)D.o(W,Q)&&!D.o(j,Q)&&Object.defineProperty(j,Q,{enumerable:!0,get:W[Q]})},o:(D,j)=>Object.prototype.hasOwnProperty.call(D,j)},j={};D.d(j,{default:()=>m});var W,Q=function(D,j){var W=j.x-D.x,Q=j.y-D.y;return Math.sqrt(W*W+Q*Q)},C=function(D){return D*(Math.PI/180)},k=new Map,M=function(D){k.has(D)&&clearTimeout(k.get(D)),k.set(D,setTimeout(D,100))},O=function(D,j,W){for(var Q,C=j.split(/[ ,]+/g),k=0;k<C.length;k+=1)Q=C[k],D.addEventListener?D.addEventListener(Q,W,!1):D.attachEvent&&D.attachEvent(Q,W)},E=function(D,j,W){for(var Q,C=j.split(/[ ,]+/g),k=0;k<C.length;k+=1)Q=C[k],D.removeEventListener?D.removeEventListener(Q,W):D.detachEvent&&D.detachEvent(Q,W)},f=function(D){return D.preventDefault(),D.type.match(/^touch/)?D.changedTouches:D},F=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},Z=function(D,j){j.top||j.right||j.bottom||j.left?(D.style.top=j.top,D.style.right=j.right,D.style.bottom=j.bottom,D.style.left=j.left):(D.style.left=j.x+"px",D.style.top=j.y+"px")},P=function(D,j,W){var Q=X(D);for(var C in Q)if(Q.hasOwnProperty(C))if("string"==typeof j)Q[C]=j+" "+W;else{for(var k="",M=0,O=j.length;M<O;M+=1)k+=j[M]+" "+W+", ";Q[C]=k.slice(0,-2)}return Q},X=function(D){var j={};return j[D]="",["webkit","Moz","o"].forEach((function(W){j[W+D.charAt(0).toUpperCase()+D.slice(1)]=""})),j},x=function(D,j){for(var W in j)j.hasOwnProperty(W)&&(D[W]=j[W]);return D},R=function(D,j){if(D.length)for(var W=0,Q=D.length;W<Q;W+=1)j(D[W]);else j(D)},V="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,U=window.matchMedia("(any-hover: none)").matches,g=!!("ontouchstart"in window),N=!!window.PointerEvent,G=!!window.MSPointerEvent,K={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},L={start:"mousedown",move:"mousemove",end:"mouseup"},e={};function s(){}V&&!U?W=K:N?W={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:G?W={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:g?(W=K,e=L):W=L,s.prototype.on=function(D,j){var W,Q=this,C=D.split(/[ ,]+/g);Q._handlers_=Q._handlers_||{};for(var k=0;k<C.length;k+=1)W=C[k],Q._handlers_[W]=Q._handlers_[W]||[],Q._handlers_[W].push(j);return Q},s.prototype.off=function(D,j){var W=this;return W._handlers_=W._handlers_||{},void 0===D?W._handlers_={}:void 0===j?W._handlers_[D]=null:W._handlers_[D]&&W._handlers_[D].indexOf(j)>=0&&W._handlers_[D].splice(W._handlers_[D].indexOf(j),1),W},s.prototype.trigger=function(D,j){var W,Q=this,C=D.split(/[ ,]+/g);Q._handlers_=Q._handlers_||{};for(var k=0;k<C.length;k+=1)W=C[k],Q._handlers_[W]&&Q._handlers_[W].length&&Q._handlers_[W].forEach((function(D){D.call(Q,{type:W,target:Q},j)}))},s.prototype.config=function(D){var j=this;j.options=j.defaults||{},D&&(j.options=function(D,j){var W={};for(var Q in D)D.hasOwnProperty(Q)&&j.hasOwnProperty(Q)?W[Q]=j[Q]:D.hasOwnProperty(Q)&&(W[Q]=D[Q]);return W}(j.options,D))},s.prototype.bindEvt=function(D,j){var Q=this;return Q._domHandlers_=Q._domHandlers_||{},Q._domHandlers_[j]=function(){"function"==typeof Q["on"+j]?Q["on"+j].apply(Q,arguments):console.warn('[WARNING] : Missing "on'+j+'" handler.')},O(D,W[j],Q._domHandlers_[j]),e[j]&&O(D,e[j],Q._domHandlers_[j]),Q},s.prototype.unbindEvt=function(D,j){var Q=this;return Q._domHandlers_=Q._domHandlers_||{},E(D,W[j],Q._domHandlers_[j]),e[j]&&E(D,e[j],Q._domHandlers_[j]),delete Q._domHandlers_[j],this};const b=s;function Y(D,j){return this.identifier=j.identifier,this.position=j.position,this.frontPosition=j.frontPosition,this.collection=D,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(j),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=Y.id,Y.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}Y.prototype=new b,Y.constructor=Y,Y.id=0,Y.prototype.buildEl=function(D){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},Y.prototype.stylize=function(){if(this.options.dataOnly)return this;var D=this.options.fadeTime+"ms",j=function(){var D=X("borderRadius");for(var j in D)D.hasOwnProperty(j)&&(D[j]="50%");return D}(),W=P("transition","opacity",D),Q={};return Q.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},Q.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},Q.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},x(Q.el,W),"circle"===this.options.shape&&x(Q.back,j),x(Q.front,j),this.applyStyles(Q),this},Y.prototype.applyStyles=function(D){for(var j in this.ui)if(this.ui.hasOwnProperty(j))for(var W in D[j])this.ui[j].style[W]=D[j][W];return this},Y.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},Y.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},Y.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},Y.prototype.show=function(D){var j=this;return j.options.dataOnly||(clearTimeout(j.removeTimeout),clearTimeout(j.showTimeout),clearTimeout(j.restTimeout),j.addToDom(),j.restCallback(),setTimeout((function(){j.ui.el.style.opacity=1}),0),j.showTimeout=setTimeout((function(){j.trigger("shown",j.instance),"function"==typeof D&&D.call(this)}),j.options.fadeTime)),j},Y.prototype.hide=function(D){var j=this;if(j.options.dataOnly)return j;if(j.ui.el.style.opacity=j.options.restOpacity,clearTimeout(j.removeTimeout),clearTimeout(j.showTimeout),clearTimeout(j.restTimeout),j.removeTimeout=setTimeout((function(){var W="dynamic"===j.options.mode?"none":"block";j.ui.el.style.display=W,"function"==typeof D&&D.call(j),j.trigger("hidden",j.instance)}),j.options.fadeTime),j.options.restJoystick){var W=j.options.restJoystick,Q={};Q.x=!0===W||!1!==W.x?0:j.instance.frontPosition.x,Q.y=!0===W||!1!==W.y?0:j.instance.frontPosition.y,j.setPosition(D,Q)}return j},Y.prototype.setPosition=function(D,j){var W=this;W.frontPosition={x:j.x,y:j.y};var Q=W.options.fadeTime+"ms",C={};C.front=P("transition",["transform"],Q);var k={front:{}};k.front={transform:"translate("+W.frontPosition.x+"px,"+W.frontPosition.y+"px)"},W.applyStyles(C),W.applyStyles(k),W.restTimeout=setTimeout((function(){"function"==typeof D&&D.call(W),W.restCallback()}),W.options.fadeTime)},Y.prototype.restCallback=function(){var D=this,j={};j.front=P("transition","none",""),D.applyStyles(j),D.trigger("rested",D.instance)},Y.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},Y.prototype.computeDirection=function(D){var j,W,Q,C=D.angle.radian,k=Math.PI/4,M=Math.PI/2;if(C>k&&C<3*k&&!D.lockX?j="up":C>-k&&C<=k&&!D.lockY?j="left":C>3*-k&&C<=-k&&!D.lockX?j="down":D.lockY||(j="right"),D.lockY||(W=C>-M&&C<M?"left":"right"),D.lockX||(Q=C>0?"up":"down"),D.force>this.options.threshold){var O,E={};for(O in this.direction)this.direction.hasOwnProperty(O)&&(E[O]=this.direction[O]);var f={};for(O in this.direction={x:W,y:Q,angle:j},D.direction=this.direction,E)E[O]===this.direction[O]&&(f[O]=!0);if(f.x&&f.y&&f.angle)return D;f.x&&f.y||this.trigger("plain",D),f.x||this.trigger("plain:"+W,D),f.y||this.trigger("plain:"+Q,D),f.angle||this.trigger("dir dir:"+j,D)}else this.resetDirection();return D};const t=Y;function c(D,j){var W=this;W.nipples=[],W.idles=[],W.actives=[],W.ids=[],W.pressureIntervals={},W.manager=D,W.id=c.id,c.id+=1,W.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},W.config(j),"static"!==W.options.mode&&"semi"!==W.options.mode||(W.options.multitouch=!1),W.options.multitouch||(W.options.maxNumberOfNipples=1);var Q=getComputedStyle(W.options.zone.parentElement);return Q&&"flex"===Q.display&&(W.parentIsFlex=!0),W.updateBox(),W.prepareNipples(),W.Lj(),W.begin(),W.nipples}c.prototype=new b,c.constructor=c,c.id=0,c.prototype.prepareNipples=function(){var D=this,j=D.nipples;j.on=D.on.bind(D),j.off=D.off.bind(D),j.options=D.options,j.destroy=D.destroy.bind(D),j.ids=D.ids,j.id=D.id,j.processOnMove=D.processOnMove.bind(D),j.processOnEnd=D.processOnEnd.bind(D),j.get=function(D){if(void 0===D)return j[0];for(var W=0,Q=j.length;W<Q;W+=1)if(j[W].identifier===D)return j[W];return!1}},c.prototype.Lj=function(){var D=this;D.bindEvt(D.options.zone,"start"),D.options.zone.style.touchAction="none",D.options.zone.style.msTouchAction="none"},c.prototype.begin=function(){var D=this,j=D.options;if("static"===j.mode){var W=D.createNipple(j.position,D.manager.getIdentifier());W.add(),D.idles.push(W)}},c.prototype.createNipple=function(D,j){var W=this,Q=W.manager.scroll,C={},k=W.options,M=W.parentIsFlex?Q.x:Q.x+W.box.left,O=W.parentIsFlex?Q.y:Q.y+W.box.top;if(D.x&&D.y)C={x:D.x-M,y:D.y-O};else if(D.top||D.right||D.bottom||D.left){var E=document.createElement("DIV");E.style.display="hidden",E.style.top=D.top,E.style.right=D.right,E.style.bottom=D.bottom,E.style.left=D.left,E.style.position="absolute",k.zone.appendChild(E);var f=E.getBoundingClientRect();k.zone.removeChild(E),C=D,D={x:f.left+Q.x,y:f.top+Q.y}}var F=new t(W,{color:k.color,size:k.size,threshold:k.threshold,fadeTime:k.fadeTime,dataOnly:k.dataOnly,restJoystick:k.restJoystick,restOpacity:k.restOpacity,mode:k.mode,identifier:j,position:D,zone:k.zone,frontPosition:{x:0,y:0},shape:k.shape});return k.dataOnly||(Z(F.ui.el,C),Z(F.ui.front,F.frontPosition)),W.nipples.push(F),W.trigger("added "+F.identifier+":added",F),W.manager.trigger("added "+F.identifier+":added",F),W.bindNipple(F),F},c.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},c.prototype.bindNipple=function(D){var j,W=this,Q=function(D,Q){j=D.type+" "+Q.id+":"+D.type,W.trigger(j,Q)};D.on("destroyed",W.onDestroyed.bind(W)),D.on("shown hidden rested dir plain",Q),D.on("dir:up dir:right dir:down dir:left",Q),D.on("plain:up plain:right plain:down plain:left",Q)},c.prototype.pressureFn=function(D,j,W){var Q=this,C=0;clearInterval(Q.pressureIntervals[W]),Q.pressureIntervals[W]=setInterval(function(){var W=D.force||D.pressure||D.webkitForce||0;W!==C&&(j.trigger("pressure",W),Q.trigger("pressure "+j.identifier+":pressure",W),C=W)}.bind(Q),100)},c.prototype.onstart=function(D){var j=this,W=j.options,Q=D;return D=f(D),j.updateBox(),R(D,(function(C){j.actives.length<W.maxNumberOfNipples?j.processOnStart(C):Q.type.match(/^touch/)&&(Object.keys(j.manager.ids).forEach((function(W){if(Object.values(Q.touches).findIndex((function(D){return D.identifier===W}))<0){var C=[D[0]];C.identifier=W,j.processOnEnd(C)}})),j.actives.length<W.maxNumberOfNipples&&j.processOnStart(C))})),j.manager.bindDocument(),!1},c.prototype.processOnStart=function(D){var j,W=this,C=W.options,k=W.manager.getIdentifier(D),M=D.force||D.pressure||D.webkitForce||0,O={x:D.pageX,y:D.pageY},E=W.getOrCreate(k,O);E.identifier!==k&&W.manager.removeIdentifier(E.identifier),E.identifier=k;var f=function(j){j.trigger("start",j),W.trigger("start "+j.id+":start",j),j.show(),M>0&&W.pressureFn(D,j,j.identifier),W.processOnMove(D)};if((j=W.idles.indexOf(E))>=0&&W.idles.splice(j,1),W.actives.push(E),W.ids.push(E.identifier),"semi"!==C.mode)f(E);else{if(!(Q(O,E.position)<=C.catchDistance))return E.destroy(),void W.processOnStart(D);f(E)}return E},c.prototype.getOrCreate=function(D,j){var W,Q=this,C=Q.options;return/(semi|static)/.test(C.mode)?(W=Q.idles[0])?(Q.idles.splice(0,1),W):"semi"===C.mode?Q.createNipple(j,D):(console.warn("Coudln't find the needed nipple."),!1):W=Q.createNipple(j,D)},c.prototype.processOnMove=function(D){var j=this,W=j.options,k=j.manager.getIdentifier(D),M=j.nipples.get(k),O=j.manager.scroll;if(function(D){return isNaN(D.buttons)?0!==D.pressure:0!==D.buttons}(D)){if(!M)return console.error("Found zombie joystick with ID "+k),void j.manager.removeIdentifier(k);if(W.dynamicPage){var E=M.el.getBoundingClientRect();M.position={x:O.x+E.left,y:O.y+E.top}}M.identifier=k;var f=M.options.size/2,F={x:D.pageX,y:D.pageY};W.lockX&&(F.y=M.position.y),W.lockY&&(F.x=M.position.x);var Z,P,X,x,R,V,U,g,N,G,K=Q(F,M.position),L=(Z=F,X=(P=M.position).x-Z.x,x=P.y-Z.y,function(D){return D*(180/Math.PI)}(Math.atan2(x,X))),e=C(L),s=K/f,b={distance:K,position:F};if("circle"===M.options.shape?(R=Math.min(K,f),U=M.position,g=R,G={x:0,y:0},N=C(N=L),G.x=U.x-g*Math.cos(N),G.y=U.y-g*Math.sin(N),V=G):(V=function(D,j,W){return{x:Math.min(Math.max(D.x,j.x-W),j.x+W),y:Math.min(Math.max(D.y,j.y-W),j.y+W)}}(F,M.position,f),R=Q(V,M.position)),W.follow){if(K>f){var Y=F.x-V.x,t=F.y-V.y;M.position.x+=Y,M.position.y+=t,M.el.style.top=M.position.y-(j.box.top+O.y)+"px",M.el.style.left=M.position.x-(j.box.left+O.x)+"px",K=Q(F,M.position)}}else F=V,K=R;var c=F.x-M.position.x,l=F.y-M.position.y;M.frontPosition={x:c,y:l},W.dataOnly||(M.ui.front.style.transform="translate("+c+"px,"+l+"px)");var I={identifier:M.identifier,position:F,force:s,pressure:D.force||D.pressure||D.webkitForce||0,distance:K,angle:{radian:e,degree:L},vector:{x:c/f,y:-l/f},raw:b,instance:M,lockX:W.lockX,lockY:W.lockY};(I=M.computeDirection(I)).angle={radian:C(180-L),degree:180-L},M.trigger("move",I),j.trigger("move "+M.id+":move",I)}else this.processOnEnd(D)},c.prototype.processOnEnd=function(D){var j=this,W=j.options,Q=j.manager.getIdentifier(D),C=j.nipples.get(Q),k=j.manager.removeIdentifier(C.identifier);C&&(W.dataOnly||C.hide((function(){"dynamic"===W.mode&&(C.trigger("removed",C),j.trigger("removed "+C.id+":removed",C),j.manager.trigger("removed "+C.id+":removed",C),C.destroy())})),clearInterval(j.pressureIntervals[C.identifier]),C.resetDirection(),C.trigger("end",C),j.trigger("end "+C.id+":end",C),j.ids.indexOf(C.identifier)>=0&&j.ids.splice(j.ids.indexOf(C.identifier),1),j.actives.indexOf(C)>=0&&j.actives.splice(j.actives.indexOf(C),1),/(semi|static)/.test(W.mode)?j.idles.push(C):j.nipples.indexOf(C)>=0&&j.nipples.splice(j.nipples.indexOf(C),1),j.manager.unbindDocument(),/(semi|static)/.test(W.mode)&&(j.manager.ids[k.id]=k.identifier))},c.prototype.onDestroyed=function(D,j){var W=this;W.nipples.indexOf(j)>=0&&W.nipples.splice(W.nipples.indexOf(j),1),W.actives.indexOf(j)>=0&&W.actives.splice(W.actives.indexOf(j),1),W.idles.indexOf(j)>=0&&W.idles.splice(W.idles.indexOf(j),1),W.ids.indexOf(j.identifier)>=0&&W.ids.splice(W.ids.indexOf(j.identifier),1),W.manager.removeIdentifier(j.identifier),W.manager.unbindDocument()},c.prototype.destroy=function(){var D=this;for(var j in D.unbindEvt(D.options.zone,"start"),D.nipples.forEach((function(D){D.destroy()})),D.pressureIntervals)D.pressureIntervals.hasOwnProperty(j)&&clearInterval(D.pressureIntervals[j]);D.trigger("destroyed",D.nipples),D.manager.unbindDocument(),D.off()};const l=c;function I(D){var j=this;j.ids={},j.index=0,j.collections=[],j.scroll=F(),j.config(D),j.prepareCollections();var W=function(){var D;j.collections.forEach((function(W){W.forEach((function(W){D=W.el.getBoundingClientRect(),W.position={x:j.scroll.x+D.left,y:j.scroll.y+D.top}}))}))};O(window,"resize",(function(){M(W)}));var Q=function(){j.scroll=F()};return O(window,"scroll",(function(){M(Q)})),j.collections}I.prototype=new b,I.constructor=I,I.prototype.prepareCollections=function(){var D=this;D.collections.create=D.create.bind(D),D.collections.on=D.on.bind(D),D.collections.off=D.off.bind(D),D.collections.destroy=D.destroy.bind(D),D.collections.get=function(j){var W;return D.collections.every((function(D){return!(W=D.get(j))})),W}},I.prototype.create=function(D){return this.createCollection(D)},I.prototype.createCollection=function(D){var j=this,W=new l(j,D);return j.bindCollection(W),j.collections.push(W),W},I.prototype.bindCollection=function(D){var j,W=this,Q=function(D,Q){j=D.type+" "+Q.id+":"+D.type,W.trigger(j,Q)};D.on("destroyed",W.onDestroyed.bind(W)),D.on("shown hidden rested dir plain",Q),D.on("dir:up dir:right dir:down dir:left",Q),D.on("plain:up plain:right plain:down plain:left",Q)},I.prototype.bindDocument=function(){var D=this;D.binded||(D.bindEvt(document,"move").bindEvt(document,"end"),D.binded=!0)},I.prototype.unbindDocument=function(D){var j=this;Object.keys(j.ids).length&&!0!==D||(j.unbindEvt(document,"move").unbindEvt(document,"end"),j.binded=!1)},I.prototype.getIdentifier=function(D){var j;return D?void 0===(j=void 0===D.identifier?D.pointerId:D.identifier)&&(j=this.latest||0):j=this.index,void 0===this.ids[j]&&(this.ids[j]=this.index,this.index+=1),this.latest=j,this.ids[j]},I.prototype.removeIdentifier=function(D){var j={};for(var W in this.ids)if(this.ids[W]===D){j.id=W,j.identifier=this.ids[W],delete this.ids[W];break}return j},I.prototype.onmove=function(D){return this.onAny("move",D),!1},I.prototype.onend=function(D){return this.onAny("end",D),!1},I.prototype.oncancel=function(D){return this.onAny("end",D),!1},I.prototype.onAny=function(D,j){var W,Q=this,C="processOn"+D.charAt(0).toUpperCase()+D.slice(1);j=f(j);var k=function(D,j,W){W.ids.indexOf(j)>=0&&(W[C](D),D._found_=!0)};return R(j,(function(D){W=Q.getIdentifier(D),R(Q.collections,k.bind(null,D,W)),D._found_||Q.removeIdentifier(W)})),!1},I.prototype.destroy=function(){var D=this;D.unbindDocument(!0),D.ids={},D.index=0,D.collections.forEach((function(D){D.destroy()})),D.off()},I.prototype.onDestroyed=function(D,j){var W=this;if(W.collections.indexOf(j)<0)return!1;W.collections.splice(W.collections.indexOf(j),1)};var y=new I;const m={create:function(D){return y.create(D)},factory:y};return j.default})(),D.exports=j()},11868:(D,j,W)=>{"use strict";const{Deflate:Q,deflate:C,deflateRaw:k,gzip:M}=W(11877),{Inflate:O,inflate:E,inflateRaw:f,ungzip:F}=W(11932),Z=W(11908);D.exports.Deflate=Q,D.exports.deflate=C,D.exports.deflateRaw=k,D.exports.gzip=M,D.exports.Inflate=O,D.exports.inflate=E,D.exports.inflateRaw=f,D.exports.ungzip=F,D.exports.constants=Z},11877:(D,j,W)=>{"use strict";const Q=W(11886),C=W(11911),k=W(11919),M=W(11901),O=W(11924),E=Object.prototype.toString,{Z_NO_FLUSH:f,Z_SYNC_FLUSH:F,Z_FULL_FLUSH:Z,Z_FINISH:P,Z_OK:X,Z_STREAM_END:x,Z_DEFAULT_COMPRESSION:R,Z_DEFAULT_STRATEGY:V,Z_DEFLATED:U}=W(11908);function g(D){this.options=C.assign({level:R,method:U,Ja:16384,windowBits:15,memLevel:8,strategy:V},D||{});let j=this.options;j.raw&&j.windowBits>0?j.windowBits=-j.windowBits:j.gzip&&j.windowBits>0&&j.windowBits<16&&(j.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new O,this.strm.avail_out=0;let W=Q.deflateInit2(this.strm,j.level,j.method,j.windowBits,j.memLevel,j.strategy);if(W!==X)throw new Error(M[W]);if(j.header&&Q.deflateSetHeader(this.strm,j.header),j.dictionary){let D;if(D="string"===typeof j.dictionary?k.string2buf(j.dictionary):"[object ArrayBuffer]"===E.call(j.dictionary)?new Uint8Array(j.dictionary):j.dictionary,W=Q.deflateSetDictionary(this.strm,D),W!==X)throw new Error(M[W]);this._dict_set=!0}}function N(D,j){const W=new g(j);if(W.push(D,!0),W.err)throw W.msg||M[W.err];return W.result}g.prototype.push=function(D,j){const W=this.strm,C=this.options.Ja;let M,O;if(this.ended)return!1;for(O=j===~~j?j:!0===j?P:f,"string"===typeof D?W.input=k.string2buf(D):"[object ArrayBuffer]"===E.call(D)?W.input=new Uint8Array(D):W.input=D,W.next_in=0,W.avail_in=W.input.length;;)if(0===W.avail_out&&(W.output=new Uint8Array(C),W.next_out=0,W.avail_out=C),(O===F||O===Z)&&W.avail_out<=6)this.onData(W.output.subarray(0,W.next_out)),W.avail_out=0;else{if(M=Q.deflate(W,O),M===x)return W.next_out>0&&this.onData(W.output.subarray(0,W.next_out)),M=Q.deflateEnd(this.strm),this.onEnd(M),this.ended=!0,M===X;if(0!==W.avail_out){if(O>0&&W.next_out>0)this.onData(W.output.subarray(0,W.next_out)),W.avail_out=0;else if(0===W.avail_in)break}else this.onData(W.output)}return!0},g.prototype.onData=function(D){this.chunks.push(D)},g.prototype.onEnd=function(D){D===X&&(this.result=C.flattenChunks(this.chunks)),this.chunks=[],this.err=D,this.msg=this.strm.msg},D.exports.Deflate=g,D.exports.deflate=N,D.exports.deflateRaw=function(D,j){return(j=j||{}).raw=!0,N(D,j)},D.exports.gzip=function(D,j){return(j=j||{}).gzip=!0,N(D,j)},D.exports.constants=W(11908)},11932:(D,j,W)=>{"use strict";const Q=W(11936),C=W(11911),k=W(11919),M=W(11901),O=W(11924),E=W(11959),f=Object.prototype.toString,{Z_NO_FLUSH:F,Z_FINISH:Z,Z_OK:P,Z_STREAM_END:X,Z_NEED_DICT:x,Z_STREAM_ERROR:R,Z_DATA_ERROR:V,Z_MEM_ERROR:U}=W(11908);function g(D){this.options=C.assign({Ja:65536,windowBits:15,to:""},D||{});const j=this.options;j.raw&&j.windowBits>=0&&j.windowBits<16&&(j.windowBits=-j.windowBits,0===j.windowBits&&(j.windowBits=-15)),!(j.windowBits>=0&&j.windowBits<16)||D&&D.windowBits||(j.windowBits+=32),j.windowBits>15&&j.windowBits<48&&0===(15&j.windowBits)&&(j.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new O,this.strm.avail_out=0;let W=Q.inflateInit2(this.strm,j.windowBits);if(W!==P)throw new Error(M[W]);if(this.header=new E,Q.inflateGetHeader(this.strm,this.header),j.dictionary&&("string"===typeof j.dictionary?j.dictionary=k.string2buf(j.dictionary):"[object ArrayBuffer]"===f.call(j.dictionary)&&(j.dictionary=new Uint8Array(j.dictionary)),j.raw&&(W=Q.inflateSetDictionary(this.strm,j.dictionary),W!==P)))throw new Error(M[W])}function N(D,j){const W=new g(j);if(W.push(D),W.err)throw W.msg||M[W.err];return W.result}g.prototype.push=function(D,j){const W=this.strm,C=this.options.Ja,M=this.options.dictionary;let O,E,g;if(this.ended)return!1;for(E=j===~~j?j:!0===j?Z:F,"[object ArrayBuffer]"===f.call(D)?W.input=new Uint8Array(D):W.input=D,W.next_in=0,W.avail_in=W.input.length;;){for(0===W.avail_out&&(W.output=new Uint8Array(C),W.next_out=0,W.avail_out=C),O=Q.inflate(W,E),O===x&&M&&(O=Q.inflateSetDictionary(W,M),O===P?O=Q.inflate(W,E):O===V&&(O=x));W.avail_in>0&&O===X&&W.state.wrap>0&&0!==D[W.next_in];)Q.inflateReset(W),O=Q.inflate(W,E);switch(O){case R:case V:case x:case U:return this.onEnd(O),this.ended=!0,!1}if(g=W.avail_out,W.next_out&&(0===W.avail_out||O===X))if("string"===this.options.to){let D=k.utf8border(W.output,W.next_out),j=W.next_out-D,Q=k.buf2string(W.output,D);W.next_out=j,W.avail_out=C-j,j&&W.output.set(W.output.subarray(D,D+j),0),this.onData(Q)}else this.onData(W.output.length===W.next_out?W.output:W.output.subarray(0,W.next_out));if(O!==P||0!==g){if(O===X)return O=Q.inflateEnd(this.strm),this.onEnd(O),this.ended=!0,!0;if(0===W.avail_in)break}}return!0},g.prototype.onData=function(D){this.chunks.push(D)},g.prototype.onEnd=function(D){D===P&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=C.flattenChunks(this.chunks)),this.chunks=[],this.err=D,this.msg=this.strm.msg},D.exports.Inflate=g,D.exports.inflate=N,D.exports.inflateRaw=function(D,j){return(j=j||{}).raw=!0,N(D,j)},D.exports.ungzip=N,D.exports.constants=W(11908)},11911:D=>{"use strict";const j=(D,j)=>Object.prototype.hasOwnProperty.call(D,j);D.exports.assign=function(D){const W=Array.prototype.slice.call(arguments,1);for(;W.length;){const Q=W.shift();if(Q){if("object"!==typeof Q)throw new TypeError(Q+"must be non-object");for(const W in Q)j(Q,W)&&(D[W]=Q[W])}}return D},D.exports.flattenChunks=D=>{let j=0;for(let Q=0,C=D.length;Q<C;Q++)j+=D[Q].length;const W=new Uint8Array(j);for(let Q=0,C=0,k=D.length;Q<k;Q++){let j=D[Q];W.set(j,C),C+=j.length}return W}},11919:D=>{"use strict";let j=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(Q){j=!1}const W=new Uint8Array(256);for(let C=0;C<256;C++)W[C]=C>=252?6:C>=248?5:C>=240?4:C>=224?3:C>=192?2:1;W[254]=W[254]=1,D.exports.string2buf=D=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(D);let j,W,Q,C,k,M=D.length,O=0;for(C=0;C<M;C++)W=D.charCodeAt(C),55296===(64512&W)&&C+1<M&&(Q=D.charCodeAt(C+1),56320===(64512&Q)&&(W=65536+(W-55296<<10)+(Q-56320),C++)),O+=W<128?1:W<2048?2:W<65536?3:4;for(j=new Uint8Array(O),k=0,C=0;k<O;C++)W=D.charCodeAt(C),55296===(64512&W)&&C+1<M&&(Q=D.charCodeAt(C+1),56320===(64512&Q)&&(W=65536+(W-55296<<10)+(Q-56320),C++)),W<128?j[k++]=W:W<2048?(j[k++]=192|W>>>6,j[k++]=128|63&W):W<65536?(j[k++]=224|W>>>12,j[k++]=128|W>>>6&63,j[k++]=128|63&W):(j[k++]=240|W>>>18,j[k++]=128|W>>>12&63,j[k++]=128|W>>>6&63,j[k++]=128|63&W);return j};D.exports.buf2string=(D,Q)=>{const C=Q||D.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(D.subarray(0,Q));let k,M;const O=new Array(2*C);for(M=0,k=0;k<C;){let j=D[k++];if(j<128){O[M++]=j;continue}let Q=W[j];if(Q>4)O[M++]=65533,k+=Q-1;else{for(j&=2===Q?31:3===Q?15:7;Q>1&&k<C;)j=j<<6|63&D[k++],Q--;Q>1?O[M++]=65533:j<65536?O[M++]=j:(j-=65536,O[M++]=55296|j>>10&1023,O[M++]=56320|1023&j)}}return((D,W)=>{if(W<65534&&D.subarray&&j)return String.fromCharCode.apply(null,D.length===W?D:D.subarray(0,W));let Q="";for(let j=0;j<W;j++)Q+=String.fromCharCode(D[j]);return Q})(O,M)},D.exports.utf8border=(D,j)=>{(j=j||D.length)>D.length&&(j=D.length);let Q=j-1;for(;Q>=0&&128===(192&D[Q]);)Q--;return Q<0||0===Q?j:Q+W[D[Q]]>j?Q:j}},11894:D=>{"use strict";D.exports=(D,j,W,Q)=>{let C=65535&D,k=D>>>16&65535,M=0;for(;0!==W;){M=W>2e3?2e3:W,W-=M;do{C=C+j[Q++]|0,k=k+C|0}while(--M);C%=65521,k%=65521}return C|k<<16}},11908:D=>{"use strict";D.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},11897:D=>{"use strict";const j=new Uint32Array((()=>{let D,j=[];for(var W=0;W<256;W++){D=W;for(var Q=0;Q<8;Q++)D=1&D?3988292384^D>>>1:D>>>1;j[W]=D}return j})());D.exports=(D,W,Q,C)=>{const k=j,M=C+Q;D^=-1;for(let j=C;j<M;j++)D=D>>>8^k[255&(D^W[j])];return~D}},11886:(D,j,W)=>{"use strict";const{_tr_init:Q,_tr_stored_block:C,_tr_flush_block:k,_tr_tally:M,_tr_align:O}=W(11889),E=W(11894),f=W(11897),F=W(11901),{Z_NO_FLUSH:Z,Z_PARTIAL_FLUSH:P,Z_FULL_FLUSH:X,Z_FINISH:x,Z_BLOCK:R,Z_OK:V,Z_STREAM_END:U,Z_STREAM_ERROR:g,Z_DATA_ERROR:N,Z_BUF_ERROR:G,Z_DEFAULT_COMPRESSION:K,Z_FILTERED:L,Z_HUFFMAN_ONLY:e,Z_RLE:s,Z_FIXED:b,Z_DEFAULT_STRATEGY:Y,Z_UNKNOWN:t,Z_DEFLATED:c}=W(11908),l=258,I=262,y=103,m=113,a=666,S=(D,j)=>(D.msg=F[j],j),H=D=>(D<<1)-(D>4?9:0),z=D=>{let j=D.length;for(;--j>=0;)D[j]=0};let i=(D,j,W)=>(j<<D.hash_shift^W)&D.hash_mask;const p=D=>{const j=D.state;let W=j.pending;W>D.avail_out&&(W=D.avail_out),0!==W&&(D.output.set(j.pending_buf.subarray(j.pending_out,j.pending_out+W),D.next_out),D.next_out+=W,j.pending_out+=W,D.total_out+=W,D.avail_out-=W,j.pending-=W,0===j.pending&&(j.pending_out=0))},T=(D,j)=>{k(D,D.block_start>=0?D.block_start:-1,D.strstart-D.block_start,j),D.block_start=D.strstart,p(D.strm)},A=(D,j)=>{D.pending_buf[D.pending++]=j},w=(D,j)=>{D.pending_buf[D.pending++]=j>>>8&255,D.pending_buf[D.pending++]=255&j},n=(D,j,W,Q)=>{let C=D.avail_in;return C>Q&&(C=Q),0===C?0:(D.avail_in-=C,j.set(D.input.subarray(D.next_in,D.next_in+C),W),1===D.state.wrap?D.adler=E(D.adler,j,C,W):2===D.state.wrap&&(D.adler=f(D.adler,j,C,W)),D.next_in+=C,D.total_in+=C,C)},u=(D,j)=>{let W,Q,C=D.max_chain_length,k=D.strstart,M=D.prev_length,O=D.nice_match;const E=D.strstart>D.w_size-I?D.strstart-(D.w_size-I):0,f=D.window,F=D.w_mask,Z=D.prev,P=D.strstart+l;let X=f[k+M-1],x=f[k+M];D.prev_length>=D.good_match&&(C>>=2),O>D.lookahead&&(O=D.lookahead);do{if(W=j,f[W+M]===x&&f[W+M-1]===X&&f[W]===f[k]&&f[++W]===f[k+1]){k+=2,W++;do{}while(f[++k]===f[++W]&&f[++k]===f[++W]&&f[++k]===f[++W]&&f[++k]===f[++W]&&f[++k]===f[++W]&&f[++k]===f[++W]&&f[++k]===f[++W]&&f[++k]===f[++W]&&k<P);if(Q=l-(P-k),k=P-l,Q>M){if(D.match_start=j,M=Q,Q>=O)break;X=f[k+M-1],x=f[k+M]}}}while((j=Z[j&F])>E&&0!==--C);return M<=D.lookahead?M:D.lookahead},q=D=>{const j=D.w_size;let W,Q,C,k,M;do{if(k=D.window_size-D.lookahead-D.strstart,D.strstart>=j+(j-I)){D.window.set(D.window.subarray(j,j+j),0),D.match_start-=j,D.strstart-=j,D.block_start-=j,Q=D.hash_size,W=Q;do{C=D.head[--W],D.head[W]=C>=j?C-j:0}while(--Q);Q=j,W=Q;do{C=D.prev[--W],D.prev[W]=C>=j?C-j:0}while(--Q);k+=j}if(0===D.strm.avail_in)break;if(Q=n(D.strm,D.window,D.strstart+D.lookahead,k),D.lookahead+=Q,D.lookahead+D.insert>=3)for(M=D.strstart-D.insert,D.ins_h=D.window[M],D.ins_h=i(D,D.ins_h,D.window[M+1]);D.insert&&(D.ins_h=i(D,D.ins_h,D.window[M+3-1]),D.prev[M&D.w_mask]=D.head[D.ins_h],D.head[D.ins_h]=M,M++,D.insert--,!(D.lookahead+D.insert<3)););}while(D.lookahead<I&&0!==D.strm.avail_in)},o=(D,j)=>{let W,Q;for(;;){if(D.lookahead<I){if(q(D),D.lookahead<I&&j===Z)return 1;if(0===D.lookahead)break}if(W=0,D.lookahead>=3&&(D.ins_h=i(D,D.ins_h,D.window[D.strstart+3-1]),W=D.prev[D.strstart&D.w_mask]=D.head[D.ins_h],D.head[D.ins_h]=D.strstart),0!==W&&D.strstart-W<=D.w_size-I&&(D.match_length=u(D,W)),D.match_length>=3)if(Q=M(D,D.strstart-D.match_start,D.match_length-3),D.lookahead-=D.match_length,D.match_length<=D.max_lazy_match&&D.lookahead>=3){D.match_length--;do{D.strstart++,D.ins_h=i(D,D.ins_h,D.window[D.strstart+3-1]),W=D.prev[D.strstart&D.w_mask]=D.head[D.ins_h],D.head[D.ins_h]=D.strstart}while(0!==--D.match_length);D.strstart++}else D.strstart+=D.match_length,D.match_length=0,D.ins_h=D.window[D.strstart],D.ins_h=i(D,D.ins_h,D.window[D.strstart+1]);else Q=M(D,0,D.window[D.strstart]),D.lookahead--,D.strstart++;if(Q&&(T(D,!1),0===D.strm.avail_out))return 1}return D.insert=D.strstart<2?D.strstart:2,j===x?(T(D,!0),0===D.strm.avail_out?3:4):D.last_lit&&(T(D,!1),0===D.strm.avail_out)?1:2},J=(D,j)=>{let W,Q,C;for(;;){if(D.lookahead<I){if(q(D),D.lookahead<I&&j===Z)return 1;if(0===D.lookahead)break}if(W=0,D.lookahead>=3&&(D.ins_h=i(D,D.ins_h,D.window[D.strstart+3-1]),W=D.prev[D.strstart&D.w_mask]=D.head[D.ins_h],D.head[D.ins_h]=D.strstart),D.prev_length=D.match_length,D.prev_match=D.match_start,D.match_length=2,0!==W&&D.prev_length<D.max_lazy_match&&D.strstart-W<=D.w_size-I&&(D.match_length=u(D,W),D.match_length<=5&&(D.strategy===L||3===D.match_length&&D.strstart-D.match_start>4096)&&(D.match_length=2)),D.prev_length>=3&&D.match_length<=D.prev_length){C=D.strstart+D.lookahead-3,Q=M(D,D.strstart-1-D.prev_match,D.prev_length-3),D.lookahead-=D.prev_length-1,D.prev_length-=2;do{++D.strstart<=C&&(D.ins_h=i(D,D.ins_h,D.window[D.strstart+3-1]),W=D.prev[D.strstart&D.w_mask]=D.head[D.ins_h],D.head[D.ins_h]=D.strstart)}while(0!==--D.prev_length);if(D.match_available=0,D.match_length=2,D.strstart++,Q&&(T(D,!1),0===D.strm.avail_out))return 1}else if(D.match_available){if(Q=M(D,0,D.window[D.strstart-1]),Q&&T(D,!1),D.strstart++,D.lookahead--,0===D.strm.avail_out)return 1}else D.match_available=1,D.strstart++,D.lookahead--}return D.match_available&&(Q=M(D,0,D.window[D.strstart-1]),D.match_available=0),D.insert=D.strstart<2?D.strstart:2,j===x?(T(D,!0),0===D.strm.avail_out?3:4):D.last_lit&&(T(D,!1),0===D.strm.avail_out)?1:2};function h(D,j,W,Q,C){this.good_length=D,this.max_lazy=j,this.nice_length=W,this.max_chain=Q,this.func=C}const d=[new h(0,0,0,0,((D,j)=>{let W=65535;for(W>D.pending_buf_size-5&&(W=D.pending_buf_size-5);;){if(D.lookahead<=1){if(q(D),0===D.lookahead&&j===Z)return 1;if(0===D.lookahead)break}D.strstart+=D.lookahead,D.lookahead=0;const Q=D.block_start+W;if((0===D.strstart||D.strstart>=Q)&&(D.lookahead=D.strstart-Q,D.strstart=Q,T(D,!1),0===D.strm.avail_out))return 1;if(D.strstart-D.block_start>=D.w_size-I&&(T(D,!1),0===D.strm.avail_out))return 1}return D.insert=0,j===x?(T(D,!0),0===D.strm.avail_out?3:4):(D.strstart>D.block_start&&(T(D,!1),D.strm.avail_out),1)})),new h(4,4,8,4,o),new h(4,5,16,8,o),new h(4,6,32,32,o),new h(4,4,16,16,J),new h(8,16,32,32,J),new h(8,16,128,128,J),new h(8,32,128,256,J),new h(32,128,258,1024,J),new h(32,258,258,4096,J)];function v(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=c,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),z(this.dyn_ltree),z(this.dyn_dtree),z(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),z(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),z(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const B=D=>{if(!D||!D.state)return S(D,g);D.total_in=D.total_out=0,D.data_type=t;const j=D.state;return j.pending=0,j.pending_out=0,j.wrap<0&&(j.wrap=-j.wrap),j.status=j.wrap?42:m,D.adler=2===j.wrap?0:1,j.last_flush=Z,Q(j),V},r=D=>{const j=B(D);var W;return j===V&&((W=D.state).window_size=2*W.w_size,z(W.head),W.max_lazy_match=d[W.level].max_lazy,W.good_match=d[W.level].good_length,W.nice_match=d[W.level].nice_length,W.max_chain_length=d[W.level].max_chain,W.strstart=0,W.block_start=0,W.lookahead=0,W.insert=0,W.match_length=W.prev_length=2,W.match_available=0,W.ins_h=0),j},DD=(D,j,W,Q,C,k)=>{if(!D)return g;let M=1;if(j===K&&(j=6),Q<0?(M=0,Q=-Q):Q>15&&(M=2,Q-=16),C<1||C>9||W!==c||Q<8||Q>15||j<0||j>9||k<0||k>b)return S(D,g);8===Q&&(Q=9);const O=new v;return D.state=O,O.strm=D,O.wrap=M,O.gzhead=null,O.w_bits=Q,O.w_size=1<<O.w_bits,O.w_mask=O.w_size-1,O.hash_bits=C+7,O.hash_size=1<<O.hash_bits,O.hash_mask=O.hash_size-1,O.hash_shift=~~((O.hash_bits+3-1)/3),O.window=new Uint8Array(2*O.w_size),O.head=new Uint16Array(O.hash_size),O.prev=new Uint16Array(O.w_size),O.lit_bufsize=1<<C+6,O.pending_buf_size=4*O.lit_bufsize,O.pending_buf=new Uint8Array(O.pending_buf_size),O.d_buf=1*O.lit_bufsize,O.l_buf=3*O.lit_bufsize,O.level=j,O.strategy=k,O.method=W,r(D)};D.exports.deflateInit=(D,j)=>DD(D,j,c,15,8,Y),D.exports.deflateInit2=DD,D.exports.deflateReset=r,D.exports.deflateResetKeep=B,D.exports.deflateSetHeader=(D,j)=>D&&D.state?2!==D.state.wrap?g:(D.state.gzhead=j,V):g,D.exports.deflate=(D,j)=>{let W,Q;if(!D||!D.state||j>R||j<0)return D?S(D,g):g;const k=D.state;if(!D.output||!D.input&&0!==D.avail_in||k.status===a&&j!==x)return S(D,0===D.avail_out?G:g);k.strm=D;const E=k.last_flush;if(k.last_flush=j,42===k.status)if(2===k.wrap)D.adler=0,A(k,31),A(k,139),A(k,8),k.gzhead?(A(k,(k.gzhead.text?1:0)+(k.gzhead.hcrc?2:0)+(k.gzhead.extra?4:0)+(k.gzhead.name?8:0)+(k.gzhead.comment?16:0)),A(k,255&k.gzhead.time),A(k,k.gzhead.time>>8&255),A(k,k.gzhead.time>>16&255),A(k,k.gzhead.time>>24&255),A(k,9===k.level?2:k.strategy>=e||k.level<2?4:0),A(k,255&k.gzhead.os),k.gzhead.extra&&k.gzhead.extra.length&&(A(k,255&k.gzhead.extra.length),A(k,k.gzhead.extra.length>>8&255)),k.gzhead.hcrc&&(D.adler=f(D.adler,k.pending_buf,k.pending,0)),k.gzindex=0,k.status=69):(A(k,0),A(k,0),A(k,0),A(k,0),A(k,0),A(k,9===k.level?2:k.strategy>=e||k.level<2?4:0),A(k,3),k.status=m);else{let j=c+(k.w_bits-8<<4)<<8,W=-1;W=k.strategy>=e||k.level<2?0:k.level<6?1:6===k.level?2:3,j|=W<<6,0!==k.strstart&&(j|=32),j+=31-j%31,k.status=m,w(k,j),0!==k.strstart&&(w(k,D.adler>>>16),w(k,65535&D.adler)),D.adler=1}if(69===k.status)if(k.gzhead.extra){for(W=k.pending;k.gzindex<(65535&k.gzhead.extra.length)&&(k.pending!==k.pending_buf_size||(k.gzhead.hcrc&&k.pending>W&&(D.adler=f(D.adler,k.pending_buf,k.pending-W,W)),p(D),W=k.pending,k.pending!==k.pending_buf_size));)A(k,255&k.gzhead.extra[k.gzindex]),k.gzindex++;k.gzhead.hcrc&&k.pending>W&&(D.adler=f(D.adler,k.pending_buf,k.pending-W,W)),k.gzindex===k.gzhead.extra.length&&(k.gzindex=0,k.status=73)}else k.status=73;if(73===k.status)if(k.gzhead.name){W=k.pending;do{if(k.pending===k.pending_buf_size&&(k.gzhead.hcrc&&k.pending>W&&(D.adler=f(D.adler,k.pending_buf,k.pending-W,W)),p(D),W=k.pending,k.pending===k.pending_buf_size)){Q=1;break}Q=k.gzindex<k.gzhead.name.length?255&k.gzhead.name.charCodeAt(k.gzindex++):0,A(k,Q)}while(0!==Q);k.gzhead.hcrc&&k.pending>W&&(D.adler=f(D.adler,k.pending_buf,k.pending-W,W)),0===Q&&(k.gzindex=0,k.status=91)}else k.status=91;if(91===k.status)if(k.gzhead.comment){W=k.pending;do{if(k.pending===k.pending_buf_size&&(k.gzhead.hcrc&&k.pending>W&&(D.adler=f(D.adler,k.pending_buf,k.pending-W,W)),p(D),W=k.pending,k.pending===k.pending_buf_size)){Q=1;break}Q=k.gzindex<k.gzhead.comment.length?255&k.gzhead.comment.charCodeAt(k.gzindex++):0,A(k,Q)}while(0!==Q);k.gzhead.hcrc&&k.pending>W&&(D.adler=f(D.adler,k.pending_buf,k.pending-W,W)),0===Q&&(k.status=y)}else k.status=y;if(k.status===y&&(k.gzhead.hcrc?(k.pending+2>k.pending_buf_size&&p(D),k.pending+2<=k.pending_buf_size&&(A(k,255&D.adler),A(k,D.adler>>8&255),D.adler=0,k.status=m)):k.status=m),0!==k.pending){if(p(D),0===D.avail_out)return k.last_flush=-1,V}else if(0===D.avail_in&&H(j)<=H(E)&&j!==x)return S(D,G);if(k.status===a&&0!==D.avail_in)return S(D,G);if(0!==D.avail_in||0!==k.lookahead||j!==Z&&k.status!==a){let W=k.strategy===e?((D,j)=>{let W;for(;;){if(0===D.lookahead&&(q(D),0===D.lookahead)){if(j===Z)return 1;break}if(D.match_length=0,W=M(D,0,D.window[D.strstart]),D.lookahead--,D.strstart++,W&&(T(D,!1),0===D.strm.avail_out))return 1}return D.insert=0,j===x?(T(D,!0),0===D.strm.avail_out?3:4):D.last_lit&&(T(D,!1),0===D.strm.avail_out)?1:2})(k,j):k.strategy===s?((D,j)=>{let W,Q,C,k;const O=D.window;for(;;){if(D.lookahead<=l){if(q(D),D.lookahead<=l&&j===Z)return 1;if(0===D.lookahead)break}if(D.match_length=0,D.lookahead>=3&&D.strstart>0&&(C=D.strstart-1,Q=O[C],Q===O[++C]&&Q===O[++C]&&Q===O[++C])){k=D.strstart+l;do{}while(Q===O[++C]&&Q===O[++C]&&Q===O[++C]&&Q===O[++C]&&Q===O[++C]&&Q===O[++C]&&Q===O[++C]&&Q===O[++C]&&C<k);D.match_length=l-(k-C),D.match_length>D.lookahead&&(D.match_length=D.lookahead)}if(D.match_length>=3?(W=M(D,1,D.match_length-3),D.lookahead-=D.match_length,D.strstart+=D.match_length,D.match_length=0):(W=M(D,0,D.window[D.strstart]),D.lookahead--,D.strstart++),W&&(T(D,!1),0===D.strm.avail_out))return 1}return D.insert=0,j===x?(T(D,!0),0===D.strm.avail_out?3:4):D.last_lit&&(T(D,!1),0===D.strm.avail_out)?1:2})(k,j):d[k.level].func(k,j);if(3!==W&&4!==W||(k.status=a),1===W||3===W)return 0===D.avail_out&&(k.last_flush=-1),V;if(2===W&&(j===P?O(k):j!==R&&(C(k,0,0,!1),j===X&&(z(k.head),0===k.lookahead&&(k.strstart=0,k.block_start=0,k.insert=0))),p(D),0===D.avail_out))return k.last_flush=-1,V}return j!==x?V:k.wrap<=0?U:(2===k.wrap?(A(k,255&D.adler),A(k,D.adler>>8&255),A(k,D.adler>>16&255),A(k,D.adler>>24&255),A(k,255&D.total_in),A(k,D.total_in>>8&255),A(k,D.total_in>>16&255),A(k,D.total_in>>24&255)):(w(k,D.adler>>>16),w(k,65535&D.adler)),p(D),k.wrap>0&&(k.wrap=-k.wrap),0!==k.pending?V:U)},D.exports.deflateEnd=D=>{if(!D||!D.state)return g;const j=D.state.status;return 42!==j&&69!==j&&73!==j&&91!==j&&j!==y&&j!==m&&j!==a?S(D,g):(D.state=null,j===m?S(D,N):V)},D.exports.deflateSetDictionary=(D,j)=>{let W=j.length;if(!D||!D.state)return g;const Q=D.state,C=Q.wrap;if(2===C||1===C&&42!==Q.status||Q.lookahead)return g;if(1===C&&(D.adler=E(D.adler,j,W,0)),Q.wrap=0,W>=Q.w_size){0===C&&(z(Q.head),Q.strstart=0,Q.block_start=0,Q.insert=0);let D=new Uint8Array(Q.w_size);D.set(j.subarray(W-Q.w_size,W),0),j=D,W=Q.w_size}const k=D.avail_in,M=D.next_in,O=D.input;for(D.avail_in=W,D.next_in=0,D.input=j,q(Q);Q.lookahead>=3;){let D=Q.strstart,j=Q.lookahead-2;do{Q.ins_h=i(Q,Q.ins_h,Q.window[D+3-1]),Q.prev[D&Q.w_mask]=Q.head[Q.ins_h],Q.head[Q.ins_h]=D,D++}while(--j);Q.strstart=D,Q.lookahead=2,q(Q)}return Q.strstart+=Q.lookahead,Q.block_start=Q.strstart,Q.insert=Q.lookahead,Q.lookahead=0,Q.match_length=Q.prev_length=2,Q.match_available=0,D.next_in=M,D.input=O,D.avail_in=k,Q.wrap=C,V},D.exports.deflateInfo="pako deflate (from Nodeca project)"},11959:D=>{"use strict";D.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},11943:D=>{"use strict";D.exports=function(D,j){let W,Q,C,k,M,O,E,f,F,Z,P,X,x,R,V,U,g,N,G,K,L,e,s,b;const Y=D.state;W=D.next_in,s=D.input,Q=W+(D.avail_in-5),C=D.next_out,b=D.output,k=C-(j-D.avail_out),M=C+(D.avail_out-257),O=Y.dmax,E=Y.wsize,f=Y.whave,F=Y.wnext,Z=Y.window,P=Y.hold,X=Y.bits,x=Y.lencode,R=Y.distcode,V=(1<<Y.lenbits)-1,U=(1<<Y.distbits)-1;D:do{X<15&&(P+=s[W++]<<X,X+=8,P+=s[W++]<<X,X+=8),g=x[P&V];j:for(;;){if(N=g>>>24,P>>>=N,X-=N,N=g>>>16&255,0===N)b[C++]=65535&g;else{if(!(16&N)){if(0===(64&N)){g=x[(65535&g)+(P&(1<<N)-1)];continue j}if(32&N){Y.mode=12;break D}D.msg="invalid literal/length code",Y.mode=30;break D}G=65535&g,N&=15,N&&(X<N&&(P+=s[W++]<<X,X+=8),G+=P&(1<<N)-1,P>>>=N,X-=N),X<15&&(P+=s[W++]<<X,X+=8,P+=s[W++]<<X,X+=8),g=R[P&U];W:for(;;){if(N=g>>>24,P>>>=N,X-=N,N=g>>>16&255,!(16&N)){if(0===(64&N)){g=R[(65535&g)+(P&(1<<N)-1)];continue W}D.msg="invalid distance code",Y.mode=30;break D}if(K=65535&g,N&=15,X<N&&(P+=s[W++]<<X,X+=8,X<N&&(P+=s[W++]<<X,X+=8)),K+=P&(1<<N)-1,K>O){D.msg="invalid distance too far back",Y.mode=30;break D}if(P>>>=N,X-=N,N=C-k,K>N){if(N=K-N,N>f&&Y.sane){D.msg="invalid distance too far back",Y.mode=30;break D}if(L=0,e=Z,0===F){if(L+=E-N,N<G){G-=N;do{b[C++]=Z[L++]}while(--N);L=C-K,e=b}}else if(F<N){if(L+=E+F-N,N-=F,N<G){G-=N;do{b[C++]=Z[L++]}while(--N);if(L=0,F<G){N=F,G-=N;do{b[C++]=Z[L++]}while(--N);L=C-K,e=b}}}else if(L+=F-N,N<G){G-=N;do{b[C++]=Z[L++]}while(--N);L=C-K,e=b}for(;G>2;)b[C++]=e[L++],b[C++]=e[L++],b[C++]=e[L++],G-=3;G&&(b[C++]=e[L++],G>1&&(b[C++]=e[L++]))}else{L=C-K;do{b[C++]=b[L++],b[C++]=b[L++],b[C++]=b[L++],G-=3}while(G>2);G&&(b[C++]=b[L++],G>1&&(b[C++]=b[L++]))}break}}break}}while(W<Q&&C<M);G=X>>3,W-=G,X-=G<<3,P&=(1<<X)-1,D.next_in=W,D.next_out=C,D.avail_in=W<Q?Q-W+5:5-(W-Q),D.avail_out=C<M?M-C+257:257-(C-M),Y.hold=P,Y.bits=X}},11936:(D,j,W)=>{"use strict";const Q=W(11894),C=W(11897),k=W(11943),M=W(11951),{Z_FINISH:O,Z_BLOCK:E,Z_TREES:f,Z_OK:F,Z_STREAM_END:Z,Z_NEED_DICT:P,Z_STREAM_ERROR:X,Z_DATA_ERROR:x,Z_MEM_ERROR:R,Z_BUF_ERROR:V,Z_DEFLATED:U}=W(11908),g=12,N=30,G=D=>(D>>>24&255)+(D>>>8&65280)+((65280&D)<<8)+((255&D)<<24);function K(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const L=D=>{if(!D||!D.state)return X;const j=D.state;return D.total_in=D.total_out=j.total=0,D.msg="",j.wrap&&(D.adler=1&j.wrap),j.mode=1,j.last=0,j.havedict=0,j.dmax=32768,j.head=null,j.hold=0,j.bits=0,j.lencode=j.lendyn=new Int32Array(852),j.distcode=j.distdyn=new Int32Array(592),j.sane=1,j.back=-1,F},e=D=>{if(!D||!D.state)return X;const j=D.state;return j.wsize=0,j.whave=0,j.wnext=0,L(D)},s=(D,j)=>{let W;if(!D||!D.state)return X;const Q=D.state;return j<0?(W=0,j=-j):(W=1+(j>>4),j<48&&(j&=15)),j&&(j<8||j>15)?X:(null!==Q.window&&Q.wbits!==j&&(Q.window=null),Q.wrap=W,Q.wbits=j,e(D))},b=(D,j)=>{if(!D)return X;const W=new K;D.state=W,W.window=null;const Q=s(D,j);return Q!==F&&(D.state=null),Q};let Y,t,c=!0;const l=D=>{if(c){Y=new Int32Array(512),t=new Int32Array(32);let j=0;for(;j<144;)D.lens[j++]=8;for(;j<256;)D.lens[j++]=9;for(;j<280;)D.lens[j++]=7;for(;j<288;)D.lens[j++]=8;for(M(1,D.lens,0,288,Y,0,D.work,{bits:9}),j=0;j<32;)D.lens[j++]=5;M(2,D.lens,0,32,t,0,D.work,{bits:5}),c=!1}D.lencode=Y,D.lenbits=9,D.distcode=t,D.distbits=5},I=(D,j,W,Q)=>{let C;const k=D.state;return null===k.window&&(k.wsize=1<<k.wbits,k.wnext=0,k.whave=0,k.window=new Uint8Array(k.wsize)),Q>=k.wsize?(k.window.set(j.subarray(W-k.wsize,W),0),k.wnext=0,k.whave=k.wsize):(C=k.wsize-k.wnext,C>Q&&(C=Q),k.window.set(j.subarray(W-Q,W-Q+C),k.wnext),(Q-=C)?(k.window.set(j.subarray(W-Q,W),0),k.wnext=Q,k.whave=k.wsize):(k.wnext+=C,k.wnext===k.wsize&&(k.wnext=0),k.whave<k.wsize&&(k.whave+=C))),0};D.exports.inflateReset=e,D.exports.inflateReset2=s,D.exports.inflateResetKeep=L,D.exports.inflateInit=D=>b(D,15),D.exports.inflateInit2=b,D.exports.inflate=(D,j)=>{let W,K,L,e,s,b,Y,t,c,y,m,a,S,H,z,i,p,T,A,w,n,u,q=0;const o=new Uint8Array(4);let J,h;const d=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!D||!D.state||!D.output||!D.input&&0!==D.avail_in)return X;W=D.state,W.mode===g&&(W.mode=13),s=D.next_out,L=D.output,Y=D.avail_out,e=D.next_in,K=D.input,b=D.avail_in,t=W.hold,c=W.bits,y=b,m=Y,u=F;D:for(;;)switch(W.mode){case 1:if(0===W.wrap){W.mode=13;break}for(;c<16;){if(0===b)break D;b--,t+=K[e++]<<c,c+=8}if(2&W.wrap&&35615===t){W.check=0,o[0]=255&t,o[1]=t>>>8&255,W.check=C(W.check,o,2,0),t=0,c=0,W.mode=2;break}if(W.flags=0,W.head&&(W.head.done=!1),!(1&W.wrap)||(((255&t)<<8)+(t>>8))%31){D.msg="incorrect header check",W.mode=N;break}if((15&t)!==U){D.msg="unknown compression method",W.mode=N;break}if(t>>>=4,c-=4,n=8+(15&t),0===W.wbits)W.wbits=n;else if(n>W.wbits){D.msg="invalid window size",W.mode=N;break}W.dmax=1<<W.wbits,D.adler=W.check=1,W.mode=512&t?10:g,t=0,c=0;break;case 2:for(;c<16;){if(0===b)break D;b--,t+=K[e++]<<c,c+=8}if(W.flags=t,(255&W.flags)!==U){D.msg="unknown compression method",W.mode=N;break}if(57344&W.flags){D.msg="unknown header flags set",W.mode=N;break}W.head&&(W.head.text=t>>8&1),512&W.flags&&(o[0]=255&t,o[1]=t>>>8&255,W.check=C(W.check,o,2,0)),t=0,c=0,W.mode=3;case 3:for(;c<32;){if(0===b)break D;b--,t+=K[e++]<<c,c+=8}W.head&&(W.head.time=t),512&W.flags&&(o[0]=255&t,o[1]=t>>>8&255,o[2]=t>>>16&255,o[3]=t>>>24&255,W.check=C(W.check,o,4,0)),t=0,c=0,W.mode=4;case 4:for(;c<16;){if(0===b)break D;b--,t+=K[e++]<<c,c+=8}W.head&&(W.head.xflags=255&t,W.head.os=t>>8),512&W.flags&&(o[0]=255&t,o[1]=t>>>8&255,W.check=C(W.check,o,2,0)),t=0,c=0,W.mode=5;case 5:if(1024&W.flags){for(;c<16;){if(0===b)break D;b--,t+=K[e++]<<c,c+=8}W.length=t,W.head&&(W.head.extra_len=t),512&W.flags&&(o[0]=255&t,o[1]=t>>>8&255,W.check=C(W.check,o,2,0)),t=0,c=0}else W.head&&(W.head.extra=null);W.mode=6;case 6:if(1024&W.flags&&(a=W.length,a>b&&(a=b),a&&(W.head&&(n=W.head.extra_len-W.length,W.head.extra||(W.head.extra=new Uint8Array(W.head.extra_len)),W.head.extra.set(K.subarray(e,e+a),n)),512&W.flags&&(W.check=C(W.check,K,a,e)),b-=a,e+=a,W.length-=a),W.length))break D;W.length=0,W.mode=7;case 7:if(2048&W.flags){if(0===b)break D;a=0;do{n=K[e+a++],W.head&&n&&W.length<65536&&(W.head.name+=String.fromCharCode(n))}while(n&&a<b);if(512&W.flags&&(W.check=C(W.check,K,a,e)),b-=a,e+=a,n)break D}else W.head&&(W.head.name=null);W.length=0,W.mode=8;case 8:if(4096&W.flags){if(0===b)break D;a=0;do{n=K[e+a++],W.head&&n&&W.length<65536&&(W.head.comment+=String.fromCharCode(n))}while(n&&a<b);if(512&W.flags&&(W.check=C(W.check,K,a,e)),b-=a,e+=a,n)break D}else W.head&&(W.head.comment=null);W.mode=9;case 9:if(512&W.flags){for(;c<16;){if(0===b)break D;b--,t+=K[e++]<<c,c+=8}if(t!==(65535&W.check)){D.msg="header crc mismatch",W.mode=N;break}t=0,c=0}W.head&&(W.head.hcrc=W.flags>>9&1,W.head.done=!0),D.adler=W.check=0,W.mode=g;break;case 10:for(;c<32;){if(0===b)break D;b--,t+=K[e++]<<c,c+=8}D.adler=W.check=G(t),t=0,c=0,W.mode=11;case 11:if(0===W.havedict)return D.next_out=s,D.avail_out=Y,D.next_in=e,D.avail_in=b,W.hold=t,W.bits=c,P;D.adler=W.check=1,W.mode=g;case g:if(j===E||j===f)break D;case 13:if(W.last){t>>>=7&c,c-=7&c,W.mode=27;break}for(;c<3;){if(0===b)break D;b--,t+=K[e++]<<c,c+=8}switch(W.last=1&t,t>>>=1,c-=1,3&t){case 0:W.mode=14;break;case 1:if(l(W),W.mode=20,j===f){t>>>=2,c-=2;break D}break;case 2:W.mode=17;break;case 3:D.msg="invalid block type",W.mode=N}t>>>=2,c-=2;break;case 14:for(t>>>=7&c,c-=7&c;c<32;){if(0===b)break D;b--,t+=K[e++]<<c,c+=8}if((65535&t)!==(t>>>16^65535)){D.msg="invalid stored block lengths",W.mode=N;break}if(W.length=65535&t,t=0,c=0,W.mode=15,j===f)break D;case 15:W.mode=16;case 16:if(a=W.length,a){if(a>b&&(a=b),a>Y&&(a=Y),0===a)break D;L.set(K.subarray(e,e+a),s),b-=a,e+=a,Y-=a,s+=a,W.length-=a;break}W.mode=g;break;case 17:for(;c<14;){if(0===b)break D;b--,t+=K[e++]<<c,c+=8}if(W.nlen=257+(31&t),t>>>=5,c-=5,W.ndist=1+(31&t),t>>>=5,c-=5,W.ncode=4+(15&t),t>>>=4,c-=4,W.nlen>286||W.ndist>30){D.msg="too many length or distance symbols",W.mode=N;break}W.have=0,W.mode=18;case 18:for(;W.have<W.ncode;){for(;c<3;){if(0===b)break D;b--,t+=K[e++]<<c,c+=8}W.lens[d[W.have++]]=7&t,t>>>=3,c-=3}for(;W.have<19;)W.lens[d[W.have++]]=0;if(W.lencode=W.lendyn,W.lenbits=7,J={bits:W.lenbits},u=M(0,W.lens,0,19,W.lencode,0,W.work,J),W.lenbits=J.bits,u){D.msg="invalid code lengths set",W.mode=N;break}W.have=0,W.mode=19;case 19:for(;W.have<W.nlen+W.ndist;){for(;q=W.lencode[t&(1<<W.lenbits)-1],z=q>>>24,i=q>>>16&255,p=65535&q,!(z<=c);){if(0===b)break D;b--,t+=K[e++]<<c,c+=8}if(p<16)t>>>=z,c-=z,W.lens[W.have++]=p;else{if(16===p){for(h=z+2;c<h;){if(0===b)break D;b--,t+=K[e++]<<c,c+=8}if(t>>>=z,c-=z,0===W.have){D.msg="invalid bit length repeat",W.mode=N;break}n=W.lens[W.have-1],a=3+(3&t),t>>>=2,c-=2}else if(17===p){for(h=z+3;c<h;){if(0===b)break D;b--,t+=K[e++]<<c,c+=8}t>>>=z,c-=z,n=0,a=3+(7&t),t>>>=3,c-=3}else{for(h=z+7;c<h;){if(0===b)break D;b--,t+=K[e++]<<c,c+=8}t>>>=z,c-=z,n=0,a=11+(127&t),t>>>=7,c-=7}if(W.have+a>W.nlen+W.ndist){D.msg="invalid bit length repeat",W.mode=N;break}for(;a--;)W.lens[W.have++]=n}}if(W.mode===N)break;if(0===W.lens[256]){D.msg="invalid code -- missing end-of-block",W.mode=N;break}if(W.lenbits=9,J={bits:W.lenbits},u=M(1,W.lens,0,W.nlen,W.lencode,0,W.work,J),W.lenbits=J.bits,u){D.msg="invalid literal/lengths set",W.mode=N;break}if(W.distbits=6,W.distcode=W.distdyn,J={bits:W.distbits},u=M(2,W.lens,W.nlen,W.ndist,W.distcode,0,W.work,J),W.distbits=J.bits,u){D.msg="invalid distances set",W.mode=N;break}if(W.mode=20,j===f)break D;case 20:W.mode=21;case 21:if(b>=6&&Y>=258){D.next_out=s,D.avail_out=Y,D.next_in=e,D.avail_in=b,W.hold=t,W.bits=c,k(D,m),s=D.next_out,L=D.output,Y=D.avail_out,e=D.next_in,K=D.input,b=D.avail_in,t=W.hold,c=W.bits,W.mode===g&&(W.back=-1);break}for(W.back=0;q=W.lencode[t&(1<<W.lenbits)-1],z=q>>>24,i=q>>>16&255,p=65535&q,!(z<=c);){if(0===b)break D;b--,t+=K[e++]<<c,c+=8}if(i&&0===(240&i)){for(T=z,A=i,w=p;q=W.lencode[w+((t&(1<<T+A)-1)>>T)],z=q>>>24,i=q>>>16&255,p=65535&q,!(T+z<=c);){if(0===b)break D;b--,t+=K[e++]<<c,c+=8}t>>>=T,c-=T,W.back+=T}if(t>>>=z,c-=z,W.back+=z,W.length=p,0===i){W.mode=26;break}if(32&i){W.back=-1,W.mode=g;break}if(64&i){D.msg="invalid literal/length code",W.mode=N;break}W.extra=15&i,W.mode=22;case 22:if(W.extra){for(h=W.extra;c<h;){if(0===b)break D;b--,t+=K[e++]<<c,c+=8}W.length+=t&(1<<W.extra)-1,t>>>=W.extra,c-=W.extra,W.back+=W.extra}W.was=W.length,W.mode=23;case 23:for(;q=W.distcode[t&(1<<W.distbits)-1],z=q>>>24,i=q>>>16&255,p=65535&q,!(z<=c);){if(0===b)break D;b--,t+=K[e++]<<c,c+=8}if(0===(240&i)){for(T=z,A=i,w=p;q=W.distcode[w+((t&(1<<T+A)-1)>>T)],z=q>>>24,i=q>>>16&255,p=65535&q,!(T+z<=c);){if(0===b)break D;b--,t+=K[e++]<<c,c+=8}t>>>=T,c-=T,W.back+=T}if(t>>>=z,c-=z,W.back+=z,64&i){D.msg="invalid distance code",W.mode=N;break}W.offset=p,W.extra=15&i,W.mode=24;case 24:if(W.extra){for(h=W.extra;c<h;){if(0===b)break D;b--,t+=K[e++]<<c,c+=8}W.offset+=t&(1<<W.extra)-1,t>>>=W.extra,c-=W.extra,W.back+=W.extra}if(W.offset>W.dmax){D.msg="invalid distance too far back",W.mode=N;break}W.mode=25;case 25:if(0===Y)break D;if(a=m-Y,W.offset>a){if(a=W.offset-a,a>W.whave&&W.sane){D.msg="invalid distance too far back",W.mode=N;break}a>W.wnext?(a-=W.wnext,S=W.wsize-a):S=W.wnext-a,a>W.length&&(a=W.length),H=W.window}else H=L,S=s-W.offset,a=W.length;a>Y&&(a=Y),Y-=a,W.length-=a;do{L[s++]=H[S++]}while(--a);0===W.length&&(W.mode=21);break;case 26:if(0===Y)break D;L[s++]=W.length,Y--,W.mode=21;break;case 27:if(W.wrap){for(;c<32;){if(0===b)break D;b--,t|=K[e++]<<c,c+=8}if(m-=Y,D.total_out+=m,W.total+=m,m&&(D.adler=W.check=W.flags?C(W.check,L,m,s-m):Q(W.check,L,m,s-m)),m=Y,(W.flags?t:G(t))!==W.check){D.msg="incorrect data check",W.mode=N;break}t=0,c=0}W.mode=28;case 28:if(W.wrap&&W.flags){for(;c<32;){if(0===b)break D;b--,t+=K[e++]<<c,c+=8}if(t!==(4294967295&W.total)){D.msg="incorrect length check",W.mode=N;break}t=0,c=0}W.mode=29;case 29:u=Z;break D;case N:u=x;break D;case 31:return R;default:return X}return D.next_out=s,D.avail_out=Y,D.next_in=e,D.avail_in=b,W.hold=t,W.bits=c,(W.wsize||m!==D.avail_out&&W.mode<N&&(W.mode<27||j!==O))&&I(D,D.output,D.next_out,m-D.avail_out)?(W.mode=31,R):(y-=D.avail_in,m-=D.avail_out,D.total_in+=y,D.total_out+=m,W.total+=m,W.wrap&&m&&(D.adler=W.check=W.flags?C(W.check,L,m,D.next_out-m):Q(W.check,L,m,D.next_out-m)),D.data_type=W.bits+(W.last?64:0)+(W.mode===g?128:0)+(20===W.mode||15===W.mode?256:0),(0===y&&0===m||j===O)&&u===F&&(u=V),u)},D.exports.inflateEnd=D=>{if(!D||!D.state)return X;let j=D.state;return j.window&&(j.window=null),D.state=null,F},D.exports.inflateGetHeader=(D,j)=>{if(!D||!D.state)return X;const W=D.state;return 0===(2&W.wrap)?X:(W.head=j,j.done=!1,F)},D.exports.inflateSetDictionary=(D,j)=>{const W=j.length;let C,k,M;return D&&D.state?(C=D.state,0!==C.wrap&&11!==C.mode?X:11===C.mode&&(k=1,k=Q(k,j,W,0),k!==C.check)?x:(M=I(D,j,W,W),M?(C.mode=31,R):(C.havedict=1,F))):X},D.exports.inflateInfo="pako inflate (from Nodeca project)"},11951:D=>{"use strict";const j=15,W=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Q=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),C=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),k=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);D.exports=(D,M,O,E,f,F,Z,P)=>{const X=P.bits;let x,R,V,U,g,N,G=0,K=0,L=0,e=0,s=0,b=0,Y=0,t=0,c=0,l=0,I=null,y=0;const m=new Uint16Array(16),a=new Uint16Array(16);let S,H,z,i=null,p=0;for(G=0;G<=j;G++)m[G]=0;for(K=0;K<E;K++)m[M[O+K]]++;for(s=X,e=j;e>=1&&0===m[e];e--);if(s>e&&(s=e),0===e)return f[F++]=20971520,f[F++]=20971520,P.bits=1,0;for(L=1;L<e&&0===m[L];L++);for(s<L&&(s=L),t=1,G=1;G<=j;G++)if(t<<=1,t-=m[G],t<0)return-1;if(t>0&&(0===D||1!==e))return-1;for(a[1]=0,G=1;G<j;G++)a[G+1]=a[G]+m[G];for(K=0;K<E;K++)0!==M[O+K]&&(Z[a[M[O+K]]++]=K);if(0===D?(I=i=Z,N=19):1===D?(I=W,y-=257,i=Q,p-=257,N=256):(I=C,i=k,N=-1),l=0,K=0,G=L,g=F,b=s,Y=0,V=-1,c=1<<s,U=c-1,1===D&&c>852||2===D&&c>592)return 1;for(;;){S=G-Y,Z[K]<N?(H=0,z=Z[K]):Z[K]>N?(H=i[p+Z[K]],z=I[y+Z[K]]):(H=96,z=0),x=1<<G-Y,R=1<<b,L=R;do{R-=x,f[g+(l>>Y)+R]=S<<24|H<<16|z}while(0!==R);for(x=1<<G-1;l&x;)x>>=1;if(0!==x?(l&=x-1,l+=x):l=0,K++,0===--m[G]){if(G===e)break;G=M[O+Z[K]]}if(G>s&&(l&U)!==V){for(0===Y&&(Y=s),g+=L,b=G-Y,t=1<<b;b+Y<e&&(t-=m[b+Y],!(t<=0));)b++,t<<=1;if(c+=1<<b,1===D&&c>852||2===D&&c>592)return 1;V=l&U,f[V]=s<<24|b<<16|g-F}}return 0!==l&&(f[g+l]=G-Y<<24|64<<16),P.bits=s,0}},11901:D=>{"use strict";D.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},11889:D=>{"use strict";function j(D){let j=D.length;for(;--j>=0;)D[j]=0}const W=256,Q=286,C=30,k=15,M=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),O=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),E=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),f=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),F=new Array(576);j(F);const Z=new Array(60);j(Z);const P=new Array(512);j(P);const X=new Array(256);j(X);const x=new Array(29);j(x);const R=new Array(C);function V(D,j,W,Q,C){this.static_tree=D,this.extra_bits=j,this.extra_base=W,this.elems=Q,this.max_length=C,this.has_stree=D&&D.length}let U,g,N;function G(D,j){this.dyn_tree=D,this.max_code=0,this.stat_desc=j}j(R);const K=D=>D<256?P[D]:P[256+(D>>>7)],L=(D,j)=>{D.pending_buf[D.pending++]=255&j,D.pending_buf[D.pending++]=j>>>8&255},e=(D,j,W)=>{D.bi_valid>16-W?(D.bi_buf|=j<<D.bi_valid&65535,L(D,D.bi_buf),D.bi_buf=j>>16-D.bi_valid,D.bi_valid+=W-16):(D.bi_buf|=j<<D.bi_valid&65535,D.bi_valid+=W)},s=(D,j,W)=>{e(D,W[2*j],W[2*j+1])},b=(D,j)=>{let W=0;do{W|=1&D,D>>>=1,W<<=1}while(--j>0);return W>>>1},Y=(D,j,W)=>{const Q=new Array(16);let C,M,O=0;for(C=1;C<=k;C++)Q[C]=O=O+W[C-1]<<1;for(M=0;M<=j;M++){let j=D[2*M+1];0!==j&&(D[2*M]=b(Q[j]++,j))}},t=D=>{let j;for(j=0;j<Q;j++)D.dyn_ltree[2*j]=0;for(j=0;j<C;j++)D.dyn_dtree[2*j]=0;for(j=0;j<19;j++)D.bl_tree[2*j]=0;D.dyn_ltree[512]=1,D.opt_len=D.static_len=0,D.last_lit=D.matches=0},c=D=>{D.bi_valid>8?L(D,D.bi_buf):D.bi_valid>0&&(D.pending_buf[D.pending++]=D.bi_buf),D.bi_buf=0,D.bi_valid=0},l=(D,j,W,Q)=>{const C=2*j,k=2*W;return D[C]<D[k]||D[C]===D[k]&&Q[j]<=Q[W]},I=(D,j,W)=>{const Q=D.heap[W];let C=W<<1;for(;C<=D.heap_len&&(C<D.heap_len&&l(j,D.heap[C+1],D.heap[C],D.depth)&&C++,!l(j,Q,D.heap[C],D.depth));)D.heap[W]=D.heap[C],W=C,C<<=1;D.heap[W]=Q},y=(D,j,Q)=>{let C,k,E,f,F=0;if(0!==D.last_lit)do{C=D.pending_buf[D.d_buf+2*F]<<8|D.pending_buf[D.d_buf+2*F+1],k=D.pending_buf[D.l_buf+F],F++,0===C?s(D,k,j):(E=X[k],s(D,E+W+1,j),f=M[E],0!==f&&(k-=x[E],e(D,k,f)),C--,E=K(C),s(D,E,Q),f=O[E],0!==f&&(C-=R[E],e(D,C,f)))}while(F<D.last_lit);s(D,256,j)},m=(D,j)=>{const W=j.dyn_tree,Q=j.stat_desc.static_tree,C=j.stat_desc.has_stree,M=j.stat_desc.elems;let O,E,f,F=-1;for(D.heap_len=0,D.heap_max=573,O=0;O<M;O++)0!==W[2*O]?(D.heap[++D.heap_len]=F=O,D.depth[O]=0):W[2*O+1]=0;for(;D.heap_len<2;)f=D.heap[++D.heap_len]=F<2?++F:0,W[2*f]=1,D.depth[f]=0,D.opt_len--,C&&(D.static_len-=Q[2*f+1]);for(j.max_code=F,O=D.heap_len>>1;O>=1;O--)I(D,W,O);f=M;do{O=D.heap[1],D.heap[1]=D.heap[D.heap_len--],I(D,W,1),E=D.heap[1],D.heap[--D.heap_max]=O,D.heap[--D.heap_max]=E,W[2*f]=W[2*O]+W[2*E],D.depth[f]=(D.depth[O]>=D.depth[E]?D.depth[O]:D.depth[E])+1,W[2*O+1]=W[2*E+1]=f,D.heap[1]=f++,I(D,W,1)}while(D.heap_len>=2);D.heap[--D.heap_max]=D.heap[1],((D,j)=>{const W=j.dyn_tree,Q=j.max_code,C=j.stat_desc.static_tree,M=j.stat_desc.has_stree,O=j.stat_desc.extra_bits,E=j.stat_desc.extra_base,f=j.stat_desc.max_length;let F,Z,P,X,x,R,V=0;for(X=0;X<=k;X++)D.bl_count[X]=0;for(W[2*D.heap[D.heap_max]+1]=0,F=D.heap_max+1;F<573;F++)Z=D.heap[F],X=W[2*W[2*Z+1]+1]+1,X>f&&(X=f,V++),W[2*Z+1]=X,Z>Q||(D.bl_count[X]++,x=0,Z>=E&&(x=O[Z-E]),R=W[2*Z],D.opt_len+=R*(X+x),M&&(D.static_len+=R*(C[2*Z+1]+x)));if(0!==V){do{for(X=f-1;0===D.bl_count[X];)X--;D.bl_count[X]--,D.bl_count[X+1]+=2,D.bl_count[f]--,V-=2}while(V>0);for(X=f;0!==X;X--)for(Z=D.bl_count[X];0!==Z;)P=D.heap[--F],P>Q||(W[2*P+1]!==X&&(D.opt_len+=(X-W[2*P+1])*W[2*P],W[2*P+1]=X),Z--)}})(D,j),Y(W,F,D.bl_count)},a=(D,j,W)=>{let Q,C,k=-1,M=j[1],O=0,E=7,f=4;for(0===M&&(E=138,f=3),j[2*(W+1)+1]=65535,Q=0;Q<=W;Q++)C=M,M=j[2*(Q+1)+1],++O<E&&C===M||(O<f?D.bl_tree[2*C]+=O:0!==C?(C!==k&&D.bl_tree[2*C]++,D.bl_tree[32]++):O<=10?D.bl_tree[34]++:D.bl_tree[36]++,O=0,k=C,0===M?(E=138,f=3):C===M?(E=6,f=3):(E=7,f=4))},S=(D,j,W)=>{let Q,C,k=-1,M=j[1],O=0,E=7,f=4;for(0===M&&(E=138,f=3),Q=0;Q<=W;Q++)if(C=M,M=j[2*(Q+1)+1],!(++O<E&&C===M)){if(O<f)do{s(D,C,D.bl_tree)}while(0!==--O);else 0!==C?(C!==k&&(s(D,C,D.bl_tree),O--),s(D,16,D.bl_tree),e(D,O-3,2)):O<=10?(s(D,17,D.bl_tree),e(D,O-3,3)):(s(D,18,D.bl_tree),e(D,O-11,7));O=0,k=C,0===M?(E=138,f=3):C===M?(E=6,f=3):(E=7,f=4)}};let H=!1;const z=(D,j,W,Q)=>{e(D,0+(Q?1:0),3),((D,j,W,Q)=>{c(D),Q&&(L(D,W),L(D,~W)),D.pending_buf.set(D.window.subarray(j,j+W),D.pending),D.pending+=W})(D,j,W,!0)};D.exports._tr_init=D=>{H||((()=>{let D,j,W,f,G;const K=new Array(16);for(W=0,f=0;f<28;f++)for(x[f]=W,D=0;D<1<<M[f];D++)X[W++]=f;for(X[W-1]=f,G=0,f=0;f<16;f++)for(R[f]=G,D=0;D<1<<O[f];D++)P[G++]=f;for(G>>=7;f<C;f++)for(R[f]=G<<7,D=0;D<1<<O[f]-7;D++)P[256+G++]=f;for(j=0;j<=k;j++)K[j]=0;for(D=0;D<=143;)F[2*D+1]=8,D++,K[8]++;for(;D<=255;)F[2*D+1]=9,D++,K[9]++;for(;D<=279;)F[2*D+1]=7,D++,K[7]++;for(;D<=287;)F[2*D+1]=8,D++,K[8]++;for(Y(F,287,K),D=0;D<C;D++)Z[2*D+1]=5,Z[2*D]=b(D,5);U=new V(F,M,257,Q,k),g=new V(Z,O,0,C,k),N=new V(new Array(0),E,0,19,7)})(),H=!0),D.l_desc=new G(D.dyn_ltree,U),D.d_desc=new G(D.dyn_dtree,g),D.bl_desc=new G(D.bl_tree,N),D.bi_buf=0,D.bi_valid=0,t(D)},D.exports._tr_stored_block=z,D.exports._tr_flush_block=(D,j,Q,C)=>{let k,M,O=0;D.level>0?(2===D.strm.data_type&&(D.strm.data_type=(D=>{let j,Q=4093624447;for(j=0;j<=31;j++,Q>>>=1)if(1&Q&&0!==D.dyn_ltree[2*j])return 0;if(0!==D.dyn_ltree[18]||0!==D.dyn_ltree[20]||0!==D.dyn_ltree[26])return 1;for(j=32;j<W;j++)if(0!==D.dyn_ltree[2*j])return 1;return 0})(D)),m(D,D.l_desc),m(D,D.d_desc),O=(D=>{let j;for(a(D,D.dyn_ltree,D.l_desc.max_code),a(D,D.dyn_dtree,D.d_desc.max_code),m(D,D.bl_desc),j=18;j>=3&&0===D.bl_tree[2*f[j]+1];j--);return D.opt_len+=3*(j+1)+5+5+4,j})(D),k=D.opt_len+3+7>>>3,M=D.static_len+3+7>>>3,M<=k&&(k=M)):k=M=Q+5,Q+4<=k&&-1!==j?z(D,j,Q,C):4===D.strategy||M===k?(e(D,2+(C?1:0),3),y(D,F,Z)):(e(D,4+(C?1:0),3),((D,j,W,Q)=>{let C;for(e(D,j-257,5),e(D,W-1,5),e(D,Q-4,4),C=0;C<Q;C++)e(D,D.bl_tree[2*f[C]+1],3);S(D,D.dyn_ltree,j-1),S(D,D.dyn_dtree,W-1)})(D,D.l_desc.max_code+1,D.d_desc.max_code+1,O+1),y(D,D.dyn_ltree,D.dyn_dtree)),t(D),C&&c(D)},D.exports._tr_tally=(D,j,Q)=>(D.pending_buf[D.d_buf+2*D.last_lit]=j>>>8&255,D.pending_buf[D.d_buf+2*D.last_lit+1]=255&j,D.pending_buf[D.l_buf+D.last_lit]=255&Q,D.last_lit++,0===j?D.dyn_ltree[2*Q]++:(D.matches++,j--,D.dyn_ltree[2*(X[Q]+W+1)]++,D.dyn_dtree[2*K(j)]++),D.last_lit===D.lit_bufsize-1),D.exports._tr_align=D=>{e(D,2,3),s(D,256,F),(D=>{16===D.bi_valid?(L(D,D.bi_buf),D.bi_buf=0,D.bi_valid=0):D.bi_valid>=8&&(D.pending_buf[D.pending++]=255&D.bi_buf,D.bi_buf>>=8,D.bi_valid-=8)})(D)}},11924:D=>{"use strict";D.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},12371:D=>{function j(D,j,W){for(var Q=D.length,C=-1/0,k=1/0,M=0;M<Q;M++){var O=(W[0][M]-D[M])/j[M],E=(W[1][M]-D[M])/j[M];if(O>E){var f=O;O=E,E=f}if(E<C||O>k)return 1/0;O>C&&(C=O),E<k&&(k=E)}return C>k?1/0:C}D.exports=function(D,W,Q,C){var k=j(W,Q,C);if(k===1/0)D=null;else{D=D||[];for(var M=0;M<W.length;M++)D[M]=W[M]+Q[M]*k}return D},D.exports.distance=j},13058:(D,j,W)=>{"use strict";W.d(j,{c:()=>M});var Q=W(33);const C=Q.useLayoutEffect;const k=function(D){var j=(0,Q.useRef)(D);return C((function(){j.current=D})),j};var M=function(D){var j=k(D);(0,Q.useEffect)((function(){var D=function(D){var W;if(null!=j.current&&(W=j.current(D)),D.defaultPrevented&&(D.returnValue=""),"string"===typeof W)return D.returnValue=W,W};return window.addEventListener("beforeunload",D),function(){window.removeEventListener("beforeunload",D)}}),[])}},13018:(D,j,W)=>{"use strict";var Q=W(13020),C=Array.prototype.concat,k=Array.prototype.slice,M=D.exports=function(D){for(var j=[],W=0,M=D.length;W<M;W++){var O=D[W];Q(O)?j=C.call(j,k.call(O)):j.push(O)}return j};M.wrap=function(D){return function(){return D(M(arguments))}}},13020:D=>{D.exports=function(D){return!(!D||"string"===typeof D)&&(D instanceof Array||Array.isArray(D)||D.length>=0&&(D.splice instanceof Function||Object.getOwnPropertyDescriptor(D,D.length-1)&&"String"!==D.constructor.name))}},11831:(D,j,W)=>{var Q=W(11838);function C(D){for(var j,W,C=0,k=D.length,M=0;M<D.length;){for(j=D[M],W=0;M<k&&D[M]===j;)++M,++W;C+=Q.log2(W)/7|0,C+=Q.log2(j>>>0)/7|0,C+=2}return C}j.size=C,j.encode=function(D,j){j||(j=new Uint8Array(C(D)));for(var W,Q,k=0,M=j.length,O=0;O<D.length;){for(W=D[O],Q=0;O<D.length&&D[O]===W;)++O,++Q;for(;k<M&&Q>=128;)j[k++]=128+(127&Q),Q>>>=7;if(k>=M)throw new Error("RLE buffer overflow");for(j[k++]=Q,W>>>=0;k<M&&W>=128;)j[k++]=128+(127&W),W>>>=7;if(k>=M)throw new Error("RLE buffer overflow");j[k++]=W}return j},j.decode=function(D,j){for(var W,Q,C,k,M=j.length,O=D.length,E=0,f=0;f<O;){for(W=0,Q=0;f<O&&D[f]>=128;)W+=(127&D[f++])<<Q,Q+=7;if(W+=D[f++]<<Q,f>=O)throw new Error("RLE buffer underrun");if(E+W>M)throw new Error("Chunk buffer overflow");for(C=0,Q=0;f<O&&D[f]>=128;)C+=(127&D[f++])<<Q,Q+=7;if(f>=O)throw new Error("RLE buffer underrun");for(C+=D[f++]<<Q,k=0;k<W;++k)j[E++]=C}return j}},11838:(D,j)=>{"use strict";function W(D){var j=32;return(D&=-D)&&j--,65535&D&&(j-=16),16711935&D&&(j-=8),252645135&D&&(j-=4),858993459&D&&(j-=2),1431655765&D&&(j-=1),j}j.INT_BITS=32,j.INT_MAX=2147483647,j.INT_MIN=-1<<31,j.sign=function(D){return(D>0)-(D<0)},j.abs=function(D){var j=D>>31;return(D^j)-j},j.min=function(D,j){return j^(D^j)&-(D<j)},j.max=function(D,j){return D^(D^j)&-(D<j)},j.isPow2=function(D){return!(D&D-1)&&!!D},j.log2=function(D){var j,W;return j=(D>65535)<<4,j|=W=((D>>>=j)>255)<<3,j|=W=((D>>>=W)>15)<<2,(j|=W=((D>>>=W)>3)<<1)|(D>>>=W)>>1},j.log10=function(D){return D>=1e9?9:D>=1e8?8:D>=1e7?7:D>=1e6?6:D>=1e5?5:D>=1e4?4:D>=1e3?3:D>=100?2:D>=10?1:0},j.popCount=function(D){return 16843009*((D=(858993459&(D-=D>>>1&1431655765))+(D>>>2&858993459))+(D>>>4)&252645135)>>>24},j.countTrailingZeros=W,j.nextPow2=function(D){return D+=0===D,--D,D|=D>>>1,D|=D>>>2,D|=D>>>4,D|=D>>>8,(D|=D>>>16)+1},j.prevPow2=function(D){return D|=D>>>1,D|=D>>>2,D|=D>>>4,D|=D>>>8,(D|=D>>>16)-(D>>>1)},j.parity=function(D){return D^=D>>>16,D^=D>>>8,D^=D>>>4,27030>>>(D&=15)&1};var Q=new Array(256);!function(D){for(var j=0;j<256;++j){var W=j,Q=j,C=7;for(W>>>=1;W;W>>>=1)Q<<=1,Q|=1&W,--C;D[j]=Q<<C&255}}(Q),j.reverse=function(D){return Q[255&D]<<24|Q[D>>>8&255]<<16|Q[D>>>16&255]<<8|Q[D>>>24&255]},j.interleave2=function(D,j){return(D=1431655765&((D=858993459&((D=252645135&((D=16711935&((D&=65535)|D<<8))|D<<4))|D<<2))|D<<1))|(j=1431655765&((j=858993459&((j=252645135&((j=16711935&((j&=65535)|j<<8))|j<<4))|j<<2))|j<<1))<<1},j.deinterleave2=function(D,j){return(D=65535&((D=16711935&((D=252645135&((D=858993459&((D=D>>>j&1431655765)|D>>>1))|D>>>2))|D>>>4))|D>>>16))<<16>>16},j.interleave3=function(D,j,W){return D=1227133513&((D=3272356035&((D=251719695&((D=4278190335&((D&=1023)|D<<16))|D<<8))|D<<4))|D<<2),(D|=(j=1227133513&((j=3272356035&((j=251719695&((j=4278190335&((j&=1023)|j<<16))|j<<8))|j<<4))|j<<2))<<1)|(W=1227133513&((W=3272356035&((W=251719695&((W=4278190335&((W&=1023)|W<<16))|W<<8))|W<<4))|W<<2))<<2},j.deinterleave3=function(D,j){return(D=1023&((D=4278190335&((D=251719695&((D=3272356035&((D=D>>>j&1227133513)|D>>>2))|D>>>4))|D>>>8))|D>>>16))<<22>>22},j.nextCombination=function(D){var j=D|D-1;return j+1|(~j&-~j)-1>>>W(D)+1}},11861:D=>{"use strict";D.exports=function(D,j,W,Q){var C=self||window;try{try{var k;try{k=new C.Blob([D])}catch(f){(k=new(C.BlobBuilder||C.WebKitBlobBuilder||C.MozBlobBuilder||C.MSBlobBuilder)).append(D),k=k.getBlob()}var M=C.URL||C.webkitURL,O=M.createObjectURL(k),E=new C[j](O,W);return M.revokeObjectURL(O),E}catch(f){return new C[j]("data:application/javascript,".concat(encodeURIComponent(D)),W)}}catch(f){if(!Q)throw Error("Inline worker is not supported");return new C[j](Q,W)}}},12348:(D,j,W)=>{"use strict";function Q(D,j,W,Q,C){var k={};return Object.keys(Q).forEach((function(D){k[D]=Q[D]})),k.enumerable=!!k.enumerable,k.configurable=!!k.configurable,("value"in k||k.initializer)&&(k.writable=!0),k=W.slice().reverse().reduce((function(W,Q){return Q(D,j,W)||W}),k),C&&void 0!==k.initializer&&(k.value=k.initializer?k.initializer.call(C):void 0,k.initializer=void 0),void 0===k.initializer&&(Object.defineProperty(D,j,k),k=null),k}W.d(j,{e:()=>Q})},12343:(D,j,W)=>{"use strict";function Q(D,j,W,Q){W&&Object.defineProperty(D,j,{enumerable:W.enumerable,configurable:W.configurable,writable:W.writable,value:W.initializer?W.initializer.call(Q):void 0})}W.d(j,{c:()=>Q})},12682:(D,j,W)=>{"use strict";W.d(j,{c:()=>N,f:()=>V,i:()=>U,k:()=>P,l:()=>R,p:()=>x,s:()=>X});var Q=W(966),C=W(1163),k=W(1e3),M=W(981),O=W(12685),E=W(12011),f=W(1146),F=W(1028),Z=W(1151);const P=Object.freeze(new Q.d(0,0,0,0)),X=Object.freeze(Q.j.Zero()),x=Object.freeze(Q.f.Zero()),R=Object.freeze(f.e.Zero()),V=Object.freeze(C.d.Black()),U=Object.freeze(new C.h(0,0,0,0)),g={key:0,repeatCount:0,loopMode:2};class N{static _PrepareAnimation(D,j,W,k,M,O,E,F){let Z;if(!isNaN(parseFloat(M))&&isFinite(M)?Z=N.ANIMATIONTYPE_FLOAT:M instanceof Q.d?Z=N.ANIMATIONTYPE_QUATERNION:M instanceof Q.j?Z=N.ANIMATIONTYPE_VECTOR3:M instanceof Q.f?Z=N.ANIMATIONTYPE_VECTOR2:M instanceof C.d?Z=N.ANIMATIONTYPE_COLOR3:M instanceof C.h?Z=N.ANIMATIONTYPE_COLOR4:M instanceof f.e&&(Z=N.ANIMATIONTYPE_SIZE),void 0==Z)return null;const P=new N(D,j,W,Z,E),X=[{frame:0,value:M},{frame:k,value:O}];return P.setKeys(X),void 0!==F&&P.setEasingFunction(F),P}static CreateAnimation(D,j,W,Q){const C=new N(D+"Animation",D,W,j,N.ANIMATIONLOOPMODE_CONSTANT);return C.setEasingFunction(Q),C}static CreateAndStartAnimation(D,j,W,Q,C,k,M,O,E,f,F){const Z=N._PrepareAnimation(D,W,Q,C,k,M,O,E);return Z?(j.va&&(F=j.va()),F?F.beginDirectAnimation(j,[Z],0,C,1===Z.loopMode,1,f):null):null}static CreateAndStartHierarchyAnimation(D,j,W,Q,C,k,M,O,E,f,F){const Z=N._PrepareAnimation(D,Q,C,k,M,O,E,f);if(!Z)return null;return j.va().beginDirectHierarchyAnimation(j,W,[Z],0,k,1===Z.loopMode,1,F)}static CreateMergeAndStartAnimation(D,j,W,Q,C,k,M,O,E,f){const F=N._PrepareAnimation(D,W,Q,C,k,M,O,E);return F?(j.animations.push(F),j.va().beginAnimation(j,0,C,1===F.loopMode,1,f)):null}static MakeAnimationAdditive(D,j,W){let C;C="object"===typeof j?j:{referenceFrame:j??0,range:W,cloneOriginalAnimation:arguments.length>3&&void 0!==arguments[3]&&arguments[3],clonedAnimationName:arguments.length>4?arguments[4]:void 0};let k=D;if(C.cloneOriginalAnimation&&(k=D.clone(),k.name=C.clonedAnimationName||k.name),!k._keys.length)return k;const M=C.referenceFrame&&C.referenceFrame>=0?C.referenceFrame:0;let O=0;const E=k._keys[0];let f=k._keys.length-1;const F=k._keys[f],Z={referenceValue:E.value,referencePosition:Q.e.Kd[0],referenceQuaternion:Q.e.Quaternion[0],referenceScaling:Q.e.Kd[1],keyPosition:Q.e.Kd[2],keyQuaternion:Q.e.Quaternion[1],keyScaling:Q.e.Kd[3]};let P=E.frame,X=F.frame;if(C.range){const D=k.getRange(C.range);D&&(P=D.from,X=D.to)}else P=C.fromFrame??P,X=C.toFrame??X;if(P!==E.frame&&(O=k.createKeyForFrame(P)),X!==F.frame&&(f=k.createKeyForFrame(X)),1===k._keys.length){const D=k._getKeyValue(k._keys[0]);Z.referenceValue=D.clone?D.clone():D}else if(M<=E.frame){const D=k._getKeyValue(E.value);Z.referenceValue=D.clone?D.clone():D}else if(M>=F.frame){const D=k._getKeyValue(F.value);Z.referenceValue=D.clone?D.clone():D}else{g.key=0;const D=k._interpolate(M,g);Z.referenceValue=D.clone?D.clone():D}k.dataType===N.ANIMATIONTYPE_QUATERNION?Z.referenceValue.normalize().conjugateInPlace():k.dataType===N.ANIMATIONTYPE_MATRIX&&(Z.referenceValue.decompose(Z.referenceScaling,Z.referenceQuaternion,Z.referencePosition),Z.referenceQuaternion.normalize().conjugateInPlace());let x=Number.MAX_VALUE;const R=C.clipKeys?[]:null;for(let V=O;V<=f;V++){let D=k._keys[V];if((R||C.cloneOriginalAnimation)&&(D={frame:D.frame,value:D.value.clone?D.value.clone():D.value,inTangent:D.inTangent,outTangent:D.outTangent,interpolation:D.interpolation,lockedTangent:D.lockedTangent},R&&(x===Number.MAX_VALUE&&(x=D.frame),D.frame-=x,R.push(D))),!V||k.dataType===N.ANIMATIONTYPE_FLOAT||D.value!==E.value)switch(k.dataType){case N.ANIMATIONTYPE_MATRIX:D.value.decompose(Z.keyScaling,Z.keyQuaternion,Z.keyPosition),Z.keyPosition.Bd(Z.referencePosition),Z.keyScaling.divideInPlace(Z.referenceScaling),Z.referenceQuaternion.multiplyToRef(Z.keyQuaternion,Z.keyQuaternion),Q.b.ComposeToRef(Z.keyScaling,Z.keyQuaternion,Z.keyPosition,D.value);break;case N.ANIMATIONTYPE_QUATERNION:Z.referenceValue.multiplyToRef(D.value,D.value);break;case N.ANIMATIONTYPE_VECTOR2:case N.ANIMATIONTYPE_VECTOR3:case N.ANIMATIONTYPE_COLOR3:case N.ANIMATIONTYPE_COLOR4:D.value.subtractToRef(Z.referenceValue,D.value);break;case N.ANIMATIONTYPE_SIZE:D.value.width-=Z.referenceValue.width,D.value.height-=Z.referenceValue.height;break;default:D.value-=Z.referenceValue}}return R&&k.setKeys(R,!0),k}static TransitionTo(D,j,W,Q,C,k,M){let O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;if(M<=0)return W[D]=j,O&&O(),null;const E=C*(M/1e3);k.setKeys([{frame:0,value:W[D].clone?W[D].clone():W[D]},{frame:E,value:j}]),W.animations||(W.animations=[]),W.animations.push(k);const f=Q.beginAnimation(W,0,E,!1);return f.onAnimationEnd=O,f}get runtimeAnimations(){return this._runtimeAnimations}get hasRunningRuntimeAnimations(){for(const D of this._runtimeAnimations)if(!D.isStopped())return!0;return!1}constructor(D,j,W,Q,C,k){this.name=D,this.targetProperty=j,this.framePerSecond=W,this.dataType=Q,this.loopMode=C,this.enableBlending=k,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=j.split("."),this.dataType=Q,this.loopMode=void 0===C?N.ANIMATIONLOOPMODE_CYCLE:C,this.uniqueId=N._UniqueIdGenerator++}toString(D){let j="Name: "+this.name+", property: "+this.targetProperty;if(j+=", datatype: "+["Float","Kd","Quaternion","Matrix","Wd","Vector2"][this.dataType],j+=", nKeys: "+(this._keys?this._keys.length:"none"),j+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),D){j+=", Ranges: {";let D=!0;for(const W in this._ranges)D&&(j+=", ",D=!1),j+=W;j+="}"}return j}addEvent(D){this._events.push(D),this._events.sort(((D,j)=>D.frame-j.frame))}removeEvents(D){for(let j=0;j<this._events.length;j++)this._events[j].frame===D&&(this._events.splice(j,1),j--)}getEvents(){return this._events}createRange(D,j,W){this._ranges[D]||(this._ranges[D]=new O.e(D,j,W))}deleteRange(D){let j=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const W=this._ranges[D];if(W){if(j){const D=W.from,j=W.to;for(let W=this._keys.length-1;W>=0;W--)this._keys[W].frame>=D&&this._keys[W].frame<=j&&this._keys.splice(W,1)}this._ranges[D]=null}}getRange(D){return this._ranges[D]}getKeys(){return this._keys}getHighestFrame(){let D=0;for(let j=0,W=this._keys.length;j<W;j++)D<this._keys[j].frame&&(D=this._keys[j].frame);return D}getEasingFunction(){return this._easingFunction}setEasingFunction(D){this._easingFunction=D}floatInterpolateFunction(D,j,W){return(0,k.o)(D,j,W)}floatInterpolateFunctionWithTangents(D,j,W,Q,C){return(0,k.f)(D,j,W,Q,C)}quaternionInterpolateFunction(D,j,W){return Q.d.Slerp(D,j,W)}quaternionInterpolateFunctionWithTangents(D,j,W,C,k){return Q.d.Hermite(D,j,W,C,k).normalize()}vector3InterpolateFunction(D,j,W){return Q.j.Lerp(D,j,W)}vector3InterpolateFunctionWithTangents(D,j,W,C,k){return Q.j.Hermite(D,j,W,C,k)}vector2InterpolateFunction(D,j,W){return Q.f.Lerp(D,j,W)}vector2InterpolateFunctionWithTangents(D,j,W,C,k){return Q.f.Hermite(D,j,W,C,k)}sizeInterpolateFunction(D,j,W){return f.e.Lerp(D,j,W)}color3InterpolateFunction(D,j,W){return C.d.Lerp(D,j,W)}color3InterpolateFunctionWithTangents(D,j,W,Q,k){return C.d.Hermite(D,j,W,Q,k)}color4InterpolateFunction(D,j,W){return C.h.Lerp(D,j,W)}color4InterpolateFunctionWithTangents(D,j,W,Q,k){return C.h.Hermite(D,j,W,Q,k)}_getKeyValue(D){return"function"===typeof D?D():D}evaluate(D){return g.key=0,this._interpolate(D,g)}_interpolate(D,j){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(j.loopMode===N.ANIMATIONLOOPMODE_CONSTANT&&j.repeatCount>0)return j.highLimitValue.clone?j.highLimitValue.clone():j.highLimitValue;const Q=this._keys,C=Q.length;let k=j.key;for(;k>=0&&D<Q[k].frame;)--k;for(;k+1<=C-1&&D>=Q[k+1].frame;)++k;if(j.key=k,k<0)return W?void 0:this._getKeyValue(Q[0].value);if(k+1>C-1)return W?void 0:this._getKeyValue(Q[C-1].value);const M=Q[k],O=Q[k+1];if(W&&(D===M.frame||D===O.frame))return;const E=this._getKeyValue(M.value),f=this._getKeyValue(O.value);if(1===M.interpolation)return O.frame>D?E:f;const F=void 0!==M.outTangent&&void 0!==O.inTangent,Z=O.frame-M.frame;let g=(D-M.frame)/Z;const G=M.easingFunction||this.getEasingFunction();switch(null!==G&&(g=G.ease(g)),this.dataType){case N.ANIMATIONTYPE_FLOAT:{const D=F?this.floatInterpolateFunctionWithTangents(E,M.outTangent*Z,f,O.inTangent*Z,g):this.floatInterpolateFunction(E,f,g);switch(j.loopMode){case N.ANIMATIONLOOPMODE_CYCLE:case N.ANIMATIONLOOPMODE_CONSTANT:case N.ANIMATIONLOOPMODE_YOYO:return D;case N.ANIMATIONLOOPMODE_RELATIVE:case N.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return(j.offsetValue??0)*j.repeatCount+D}break}case N.ANIMATIONTYPE_QUATERNION:{const D=F?this.quaternionInterpolateFunctionWithTangents(E,M.outTangent.scale(Z),f,O.inTangent.scale(Z),g):this.quaternionInterpolateFunction(E,f,g);switch(j.loopMode){case N.ANIMATIONLOOPMODE_CYCLE:case N.ANIMATIONLOOPMODE_CONSTANT:case N.ANIMATIONLOOPMODE_YOYO:return D;case N.ANIMATIONLOOPMODE_RELATIVE:case N.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return D.addInPlace((j.offsetValue||P).scale(j.repeatCount))}return D}case N.ANIMATIONTYPE_VECTOR3:{const D=F?this.vector3InterpolateFunctionWithTangents(E,M.outTangent.scale(Z),f,O.inTangent.scale(Z),g):this.vector3InterpolateFunction(E,f,g);switch(j.loopMode){case N.ANIMATIONLOOPMODE_CYCLE:case N.ANIMATIONLOOPMODE_CONSTANT:case N.ANIMATIONLOOPMODE_YOYO:return D;case N.ANIMATIONLOOPMODE_RELATIVE:case N.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return D.add((j.offsetValue||X).scale(j.repeatCount))}break}case N.ANIMATIONTYPE_VECTOR2:{const D=F?this.vector2InterpolateFunctionWithTangents(E,M.outTangent.scale(Z),f,O.inTangent.scale(Z),g):this.vector2InterpolateFunction(E,f,g);switch(j.loopMode){case N.ANIMATIONLOOPMODE_CYCLE:case N.ANIMATIONLOOPMODE_CONSTANT:case N.ANIMATIONLOOPMODE_YOYO:return D;case N.ANIMATIONLOOPMODE_RELATIVE:case N.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return D.add((j.offsetValue||x).scale(j.repeatCount))}break}case N.ANIMATIONTYPE_SIZE:switch(j.loopMode){case N.ANIMATIONLOOPMODE_CYCLE:case N.ANIMATIONLOOPMODE_CONSTANT:case N.ANIMATIONLOOPMODE_YOYO:return this.sizeInterpolateFunction(E,f,g);case N.ANIMATIONLOOPMODE_RELATIVE:case N.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return this.sizeInterpolateFunction(E,f,g).add((j.offsetValue||R).scale(j.repeatCount))}break;case N.ANIMATIONTYPE_COLOR3:{const D=F?this.color3InterpolateFunctionWithTangents(E,M.outTangent.scale(Z),f,O.inTangent.scale(Z),g):this.color3InterpolateFunction(E,f,g);switch(j.loopMode){case N.ANIMATIONLOOPMODE_CYCLE:case N.ANIMATIONLOOPMODE_CONSTANT:case N.ANIMATIONLOOPMODE_YOYO:return D;case N.ANIMATIONLOOPMODE_RELATIVE:case N.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return D.add((j.offsetValue||V).scale(j.repeatCount))}break}case N.ANIMATIONTYPE_COLOR4:{const D=F?this.color4InterpolateFunctionWithTangents(E,M.outTangent.scale(Z),f,O.inTangent.scale(Z),g):this.color4InterpolateFunction(E,f,g);switch(j.loopMode){case N.ANIMATIONLOOPMODE_CYCLE:case N.ANIMATIONLOOPMODE_CONSTANT:case N.ANIMATIONLOOPMODE_YOYO:return D;case N.ANIMATIONLOOPMODE_RELATIVE:case N.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return D.add((j.offsetValue||U).scale(j.repeatCount))}break}case N.ANIMATIONTYPE_MATRIX:switch(j.loopMode){case N.ANIMATIONLOOPMODE_CYCLE:case N.ANIMATIONLOOPMODE_CONSTANT:case N.ANIMATIONLOOPMODE_YOYO:return N.AllowMatricesInterpolation?this.matrixInterpolateFunction(E,f,g,j.workValue):E;case N.ANIMATIONLOOPMODE_RELATIVE:case N.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return E}}return 0}matrixInterpolateFunction(D,j,W,C){return N.AllowMatrixDecomposeForInterpolation?C?(Q.b.DecomposeLerpToRef(D,j,W,C),C):Q.b.DecomposeLerp(D,j,W):C?(Q.b.LerpToRef(D,j,W,C),C):Q.b.Lerp(D,j,W)}clone(){const D=new N(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(D.enableBlending=this.enableBlending,D.blendingSpeed=this.blendingSpeed,this._keys&&D.setKeys(this._keys),this._ranges){D._ranges={};for(const j in this._ranges){const W=this._ranges[j];W&&(D._ranges[j]=W.clone())}}return D}setKeys(D){let j=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._keys=j?D:D.slice(0)}createKeyForFrame(D){g.key=0;const j=this._interpolate(D,g,!0);if(!j)return this._keys[g.key].frame===D?g.key:g.key+1;const W={frame:D,value:j.clone?j.clone():j};return this._keys.splice(g.key+1,0,W),g.key+1}serialize(){const D={};D.name=this.name,D.property=this.targetProperty,D.framePerSecond=this.framePerSecond,D.dataType=this.dataType,D.loopBehavior=this.loopMode,D.enableBlending=this.enableBlending,D.blendingSpeed=this.blendingSpeed;const j=this.dataType;D.keys=[];const W=this.getKeys();for(let Q=0;Q<W.length;Q++){const C=W[Q],k={};switch(k.frame=C.frame,j){case N.ANIMATIONTYPE_FLOAT:k.values=[C.value],void 0!==C.inTangent&&k.values.push(C.inTangent),void 0!==C.outTangent&&(void 0===C.inTangent&&k.values.push(void 0),k.values.push(C.outTangent)),void 0!==C.interpolation&&(void 0===C.inTangent&&k.values.push(void 0),void 0===C.outTangent&&k.values.push(void 0),k.values.push(C.interpolation));break;case N.ANIMATIONTYPE_QUATERNION:case N.ANIMATIONTYPE_MATRIX:case N.ANIMATIONTYPE_VECTOR3:case N.ANIMATIONTYPE_COLOR3:case N.ANIMATIONTYPE_COLOR4:k.values=C.value.Gd(),void 0!=C.inTangent&&k.values.push(C.inTangent.Gd()),void 0!=C.outTangent&&(void 0===C.inTangent&&k.values.push(void 0),k.values.push(C.outTangent.Gd())),void 0!==C.interpolation&&(void 0===C.inTangent&&k.values.push(void 0),void 0===C.outTangent&&k.values.push(void 0),k.values.push(C.interpolation))}D.keys.push(k)}D.ranges=[];for(const Q in this._ranges){const j=this._ranges[Q];if(!j)continue;const W={};W.name=Q,W.from=j.from,W.to=j.to,D.ranges.push(W)}return D}static _UniversalLerp(D,j,W){const Q=D.constructor;return Q.Lerp?Q.Lerp(D,j,W):Q.Slerp?Q.Slerp(D,j,W):D.toFixed?D*(1-W)+W*j:j}static Parse(D){const j=new N(D.name,D.property,D.framePerSecond,D.dataType,D.loopBehavior),W=D.dataType,k=[];let M,O;for(D.enableBlending&&(j.enableBlending=D.enableBlending),D.blendingSpeed&&(j.blendingSpeed=D.blendingSpeed),O=0;O<D.keys.length;O++){const j=D.keys[O];let E,f,F;switch(W){case N.ANIMATIONTYPE_FLOAT:M=j.values[0],j.values.length>=2&&(E=j.values[1]),j.values.length>=3&&(f=j.values[2]),j.values.length>=4&&(F=j.values[3]);break;case N.ANIMATIONTYPE_QUATERNION:if(M=Q.d.Dd(j.values),j.values.length>=8){const D=Q.d.Dd(j.values.slice(4,8));D.equals(Q.d.Zero())||(E=D)}if(j.values.length>=12){const D=Q.d.Dd(j.values.slice(8,12));D.equals(Q.d.Zero())||(f=D)}j.values.length>=13&&(F=j.values[12]);break;case N.ANIMATIONTYPE_MATRIX:M=Q.b.Dd(j.values),j.values.length>=17&&(F=j.values[16]);break;case N.ANIMATIONTYPE_COLOR3:M=C.d.Dd(j.values),j.values[3]&&(E=C.d.Dd(j.values[3])),j.values[4]&&(f=C.d.Dd(j.values[4])),j.values[5]&&(F=j.values[5]);break;case N.ANIMATIONTYPE_COLOR4:M=C.h.Dd(j.values),j.values[4]&&(E=C.h.Dd(j.values[4])),j.values[5]&&(f=C.h.Dd(j.values[5])),j.values[6]&&(F=C.h.Dd(j.values[6]));break;case N.ANIMATIONTYPE_VECTOR3:default:M=Q.j.Dd(j.values),j.values[3]&&(E=Q.j.Dd(j.values[3])),j.values[4]&&(f=Q.j.Dd(j.values[4])),j.values[5]&&(F=j.values[5])}const Z={};Z.frame=j.frame,Z.value=M,void 0!=E&&(Z.inTangent=E),void 0!=f&&(Z.outTangent=f),void 0!=F&&(Z.interpolation=F),k.push(Z)}if(j.setKeys(k),D.ranges)for(O=0;O<D.ranges.length;O++)M=D.ranges[O],j.createRange(M.name,M.from,M.to);return j}static AppendSerializedAnimations(D,j){Z.d.AppendSerializedAnimations(D,j)}static ParseFromFileAsync(D,j){return new Promise(((W,Q)=>{const C=new F.e;C.addEventListener("readystatechange",(()=>{if(4==C.readyState)if(200==C.status){let j=JSON.parse(C.responseText);if(j.animations&&(j=j.animations),j.length){const D=[];for(const W of j)D.push(this.Parse(W));W(D)}else{const Q=this.Parse(j);D&&(Q.name=D),W(Q)}}else Q("Unable to load the animation")})),C.open("GET",j),C.send()}))}static ParseFromSnippetAsync(D){return new Promise(((j,W)=>{const Q=new F.e;Q.addEventListener("readystatechange",(()=>{if(4==Q.readyState)if(200==Q.status){const W=JSON.parse(JSON.parse(Q.responseText).jsonPayload);if(W.animations){const Q=JSON.parse(W.animations),C=[];for(const j of Q.animations){const W=this.Parse(j);W.snippetId=D,C.push(W)}j(C)}else{const Q=JSON.parse(W.animation),C=this.Parse(Q);C.snippetId=D,j(C)}}else W("Unable to load the snippet "+D)})),Q.open("GET",this.SnippetUrl+"/"+D.replace(/#/g,"/")),Q.send()}))}}N._UniqueIdGenerator=0,N.AllowMatricesInterpolation=!1,N.AllowMatrixDecomposeForInterpolation=!0,N.SnippetUrl="https://snippet.babylonjs.com",N.ANIMATIONTYPE_FLOAT=0,N.ANIMATIONTYPE_VECTOR3=1,N.ANIMATIONTYPE_QUATERNION=2,N.ANIMATIONTYPE_MATRIX=3,N.ANIMATIONTYPE_COLOR3=4,N.ANIMATIONTYPE_COLOR4=7,N.ANIMATIONTYPE_VECTOR2=5,N.ANIMATIONTYPE_SIZE=6,N.ANIMATIONLOOPMODE_RELATIVE=0,N.ANIMATIONLOOPMODE_CYCLE=1,N.ANIMATIONLOOPMODE_CONSTANT=2,N.ANIMATIONLOOPMODE_YOYO=4,N.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT=5,N.CreateFromSnippetAsync=N.ParseFromSnippetAsync,(0,M.c)("BABYLON.Animation",N),E.e._AnimationRangeFactory=(D,j,W)=>new O.e(D,j,W)},12685:(D,j,W)=>{"use strict";W.d(j,{e:()=>Q});class Q{constructor(D,j,W){this.name=D,this.from=j,this.to=W}clone(){return new Q(this.name,this.from,this.to)}}},12673:(D,j,W)=>{"use strict";W.d(j,{e:()=>M});var Q=W(966),C=W(979),k=W(12011);class M extends k.e{get _matrix(){return this._compose(),this._j}set _matrix(D){(D.updateFlag!==this._j.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this._j.p(D),this._markAsDirtyAndDecompose())}constructor(D,j){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,M=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,O=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(D,j.va(),!1),this.name=D,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=j,this._j=(null===C||void 0===C?void 0:C.clone())??Q.b.Identity(),this._restMatrix=k??this._j.clone(),this._bindMatrix=M??this._j.clone(),this._index=O,this._absoluteMatrix=new Q.b,this._absoluteBindMatrix=new Q.b,this._absoluteInverseBindMatrix=new Q.b,this._finalMatrix=new Q.b,j.bones.push(this),this.setParent(W,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(D){this.setParent(D)}setParent(D){let j=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==D){if(this.parent){const D=this.parent.children.indexOf(this);-1!==D&&this.parent.children.splice(D,1)}this._parentNode=D,this.parent&&this.parent.children.push(this),j&&this._updateAbsoluteBindMatrices(),this.Le()}}getLocalMatrix(){return this._compose(),this._j}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(D){this._restMatrix.p(D)}setRestPose(D){this.setRestMatrix(D)}getBindPose(){return this.getBindMatrix()}setBindMatrix(D){this.de(D)}setBindPose(D){this.setBindMatrix(D)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const D=Q.e.Kd[0],j=Q.e.Quaternion[0],W=Q.e.Kd[1];this.getRestMatrix().decompose(D,j,W),this._linkedTransformNode.position.p(W),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??Q.d.Identity(),this._linkedTransformNode.rotationQuaternion.p(j),this._linkedTransformNode.Pd.p(D)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(D){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=D,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.Hg}set position(D){this._decompose(),this.Hg.p(D),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(D){this.setRotation(D)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(D){this.setRotationQuaternion(D)}get Pd(){return this.getScale()}set Pd(D){this.setScale(D)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=Q.j.Zero(),this._localRotation=Q.d.Zero(),this.Hg=Q.j.Zero()),this._j.decompose(this._localScaling,this._localRotation,this.Hg))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,Q.b.ComposeToRef(this._localScaling,this._localRotation,this.Hg,this._j)):this._needToCompose=!1)}de(D){let j=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],W=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.p(D),j&&this._updateAbsoluteBindMatrices(),W?this._matrix=D:this.Le()}_updateAbsoluteBindMatrices(D){let j=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(D||(D=this._bindMatrix),this.parent?D.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.p(D),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),j)for(let W=0;W<this.children.length;W++)this.children[W]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}Le(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.Le(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.Le(),this._needToDecompose=!0}_updatePosition(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2?arguments[2]:void 0,C=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const k=this.getLocalMatrix();if(0==j)C?(k.addAtIndex(12,D.x),k.addAtIndex(13,D.y),k.addAtIndex(14,D.z)):k.setTranslationFromFloats(D.x,D.y,D.z);else{let j=null;W&&(j=W.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const O=M._TmpMats[0],E=M._TmpVecs[0];this.parent?W&&j?(O.p(this.parent.getAbsoluteMatrix()),O.multiplyToRef(j,O)):O.p(this.parent.getAbsoluteMatrix()):Q.b.IdentityToRef(O),C&&O.setTranslationFromFloats(0,0,0),O.invert(),Q.j.TransformCoordinatesToRef(D,O,E),C?(k.addAtIndex(12,E.x),k.addAtIndex(13,E.y),k.addAtIndex(14,E.z)):k.setTranslationFromFloats(E.x,E.y,E.z)}this._markAsDirtyAndDecompose()}translate(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2?arguments[2]:void 0;this._updatePosition(D,j,W,!0)}setPosition(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2?arguments[2]:void 0;this._updatePosition(D,j,W,!1)}setAbsolutePosition(D,j){this.setPosition(D,1,j)}scale(D,j,W){let C=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const k=this.getLocalMatrix(),O=M._TmpMats[0];Q.b.ScalingToRef(D,j,W,O),O.multiplyToRef(k,k),O.invert();for(const Q of this.children){const C=Q.getLocalMatrix();C.multiplyToRef(O,C),C.multiplyAtIndex(12,D),C.multiplyAtIndex(13,j),C.multiplyAtIndex(14,W),Q._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),C)for(const Q of this.children)Q.scale(D,j,W,C)}setScale(D){this._decompose(),this._localScaling.p(D),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(D){this._decompose(),D.p(this._localScaling)}setYawPitchRoll(D,j,W){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,k=arguments.length>4?arguments[4]:void 0;if(0===C){const O=M._TmpQuat;return Q.d.RotationYawPitchRollToRef(D,j,W,O),void this.setRotationQuaternion(O,C,k)}const O=M._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(O,k))return;const E=M._TmpMats[1];Q.b.RotationYawPitchRollToRef(D,j,W,E),O.multiplyToRef(E,E),this._rotateWithMatrix(E,C,k)}rotate(D,j){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,C=arguments.length>3?arguments[3]:void 0;const k=M._TmpMats[0];k.setTranslationFromFloats(0,0,0),Q.b.RotationAxisToRef(D,j,k),this._rotateWithMatrix(k,W,C)}setAxisAngle(D,j){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,C=arguments.length>3?arguments[3]:void 0;if(0===W){const k=M._TmpQuat;return Q.d.RotationAxisToRef(D,j,k),void this.setRotationQuaternion(k,W,C)}const k=M._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(k,C))return;const O=M._TmpMats[1];Q.b.RotationAxisToRef(D,j,O),k.multiplyToRef(O,O),this._rotateWithMatrix(O,W,C)}setRotation(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(D.y,D.x,D.z,j,W)}setRotationQuaternion(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2?arguments[2]:void 0;if(0===j)return this._decompose(),this._localRotation.p(D),void this._markAsDirtyAndCompose();const C=M._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(C,W))return;const k=M._TmpMats[1];Q.b.FromQuaternionToRef(D,k),C.multiplyToRef(k,k),this._rotateWithMatrix(k,j,W)}setRotationMatrix(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2?arguments[2]:void 0;if(0===j){const C=M._TmpQuat;return Q.d.FromRotationMatrixToRef(D,C),void this.setRotationQuaternion(C,j,W)}const C=M._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(C,W))return;const k=M._TmpMats[1];k.p(D),C.multiplyToRef(D,k),this._rotateWithMatrix(k,j,W)}_rotateWithMatrix(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2?arguments[2]:void 0;const Q=this.getLocalMatrix(),C=Q.m[12],k=Q.m[13],O=Q.m[14],E=this.getParent(),f=M._TmpMats[3],F=M._TmpMats[4];E&&1==j?(W?(f.p(W.getWorldMatrix()),E.getAbsoluteMatrix().multiplyToRef(f,f)):f.p(E.getAbsoluteMatrix()),F.p(f),F.invert(),Q.multiplyToRef(f,Q),Q.multiplyToRef(D,Q),Q.multiplyToRef(F,Q)):1==j&&W?(f.p(W.getWorldMatrix()),F.p(f),F.invert(),Q.multiplyToRef(f,Q),Q.multiplyToRef(D,Q),Q.multiplyToRef(F,Q)):Q.multiplyToRef(D,Q),Q.setTranslationFromFloats(C,k,O),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(D,j){const W=M._TmpMats[2];return D.p(this.getAbsoluteMatrix()),j?(D.multiplyToRef(j.getWorldMatrix(),D),Q.b.ScalingToRef(j.Pd.x,j.Pd.y,j.Pd.z,W)):Q.b.IdentityToRef(W),D.invert(),!isNaN(D.m[0])&&(W.multiplyAtIndex(0,this._scalingDeterminant),D.multiplyToRef(W,D),!0)}cb(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const W=Q.j.Zero();return this.getPositionToRef(D,j,W),W}getPositionToRef(){let D=arguments.length>1?arguments[1]:void 0,j=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const D=this.getLocalMatrix();j.x=D.m[12],j.y=D.m[13],j.z=D.m[14]}else{let W=null;D&&(W=D.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let Q=M._TmpMats[0];D&&W?(Q.p(this.getAbsoluteMatrix()),Q.multiplyToRef(W,Q)):Q=this.getAbsoluteMatrix(),j.x=Q.m[12],j.y=Q.m[13],j.z=Q.m[14]}}getAbsolutePosition(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const j=Q.j.Zero();return this.getPositionToRef(1,D,j),j}getAbsolutePositionToRef(D,j){this.getPositionToRef(1,D,j)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this._j.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.p(this._j);const D=this._skeleton.getPoseMatrix();D&&this._absoluteMatrix.multiplyToRef(D,this._absoluteMatrix)}const D=this.children,j=D.length;for(let W=0;W<j;W++)D[W].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}ie(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const W=Q.j.Zero();return this.getDirectionToRef(D,j,W),W}getDirectionToRef(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2?arguments[2]:void 0,C=null;j&&(C=j.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const k=M._TmpMats[0];k.p(this.getAbsoluteMatrix()),j&&C&&k.multiplyToRef(C,k),Q.j.TransformNormalToRef(D,k,W),W.normalize()}getRotation(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const W=Q.j.Zero();return this.getRotationToRef(D,j,W),W}getRotationToRef(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2?arguments[2]:void 0;const Q=M._TmpQuat;this.getRotationQuaternionToRef(D,j,Q),Q.toEulerAnglesToRef(W)}getRotationQuaternion(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const W=Q.d.Identity();return this.getRotationQuaternionToRef(D,j,W),W}getRotationQuaternionToRef(){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,j=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),j.p(this._localRotation);else{const W=M._TmpMats[0],Q=this.getAbsoluteMatrix();D?Q.multiplyToRef(D.getWorldMatrix(),W):W.p(Q),W.multiplyAtIndex(0,this._scalingDeterminant),W.multiplyAtIndex(1,this._scalingDeterminant),W.multiplyAtIndex(2,this._scalingDeterminant),W.decompose(void 0,j,void 0)}}getRotationMatrix(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,j=arguments.length>1?arguments[1]:void 0;const W=Q.b.Identity();return this.getRotationMatrixToRef(D,j,W),W}getRotationMatrixToRef(){let D=arguments.length>1?arguments[1]:void 0,j=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(j);else{const W=M._TmpMats[0],Q=this.getAbsoluteMatrix();D?Q.multiplyToRef(D.getWorldMatrix(),W):W.p(Q),W.multiplyAtIndex(0,this._scalingDeterminant),W.multiplyAtIndex(1,this._scalingDeterminant),W.multiplyAtIndex(2,this._scalingDeterminant),W.getRotationMatrixToRef(j)}}getAbsolutePositionFromLocal(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const W=Q.j.Zero();return this.getAbsolutePositionFromLocalToRef(D,j,W),W}getAbsolutePositionFromLocalToRef(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2?arguments[2]:void 0,C=null;j&&(C=j.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const k=M._TmpMats[0];k.p(this.getAbsoluteMatrix()),j&&C&&k.multiplyToRef(C,k),Q.j.TransformCoordinatesToRef(D,k,W)}getLocalPositionFromAbsolute(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const W=Q.j.Zero();return this.getLocalPositionFromAbsoluteToRef(D,j,W),W}getLocalPositionFromAbsoluteToRef(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2?arguments[2]:void 0,C=null;j&&(C=j.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const k=M._TmpMats[0];k.p(this.getAbsoluteMatrix()),j&&C&&k.multiplyToRef(C,k),k.invert(),Q.j.TransformCoordinatesToRef(D,k,W)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}}M._TmpVecs=(0,C.b)(2,Q.j.Zero),M._TmpQuat=Q.d.Identity(),M._TmpMats=(0,C.b)(5,Q.b.Identity)},13049:(D,j,W)=>{"use strict";W.d(j,{b:()=>y});var Q=W(942),C=W(948),k=W(961),M=W(966),O=W(12011),E=W(11994),f=W(1283),F=W(1122),Z=W(971);class P{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(D){this._zoomStopsAnimation=D}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(D){this._idleRotationSpeed=D}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(D){this._idleRotationWaitTime=D}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(D){this._idleRotationSpinupTime=D}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(D){this._attachedCamera=D;const j=this._attachedCamera.va();this._onPrePointerObservableObserver=j.onPrePointerObservable.add((D=>{D.type!==f.d.POINTERDOWN?D.type===f.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=D.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const D=F.b.Now;let j=0;null!=this._lastFrameTime&&(j=D-this._lastFrameTime),this._lastFrameTime=D,this._applyUserInteraction();const W=D-this._lastInteractionTime-this._idleRotationWaitTime,Q=Math.max(Math.min(W/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*Q,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(j/1e3))}))}detach(){if(!this._attachedCamera)return;const D=this._attachedCamera.va();this._onPrePointerObservableObserver&&D.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(D){this._lastInteractionTime=D??F.b.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<Z.c}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let D=!1;return this._lastFrameRadius===this._attachedCamera.i&&0!==this._attachedCamera.inertialRadiusOffset&&(D=!0),this._lastFrameRadius=this._attachedCamera.i,this._zoomStopsAnimation?D:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=F.b.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}W(1517);class X{constructor(){this._easingMode=X.EASINGMODE_EASEIN}setEasingMode(D){const j=Math.min(Math.max(D,0),2);this._easingMode=j}getEasingMode(){return this._easingMode}easeInCore(D){throw new Error("You must implement this method")}ease(D){switch(this._easingMode){case X.EASINGMODE_EASEIN:return this.easeInCore(D);case X.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-D)}return D>=.5?.5*(1-this.easeInCore(2*(1-D)))+.5:.5*this.easeInCore(2*D)}}X.EASINGMODE_EASEIN=0,X.EASINGMODE_EASEOUT=1,X.EASINGMODE_EASEINOUT=2;var x=W(12682);class R{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(D){if(this._autoTransitionRange===D)return;this._autoTransitionRange=D;const j=this._attachedCamera;j&&(D?this._onMeshTargetChangedObserver=j.onMeshTargetChangedObservable.add((D=>{if(D&&(D.Ge(!0),D.getBoundingInfo)){const j=D.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*j,this.upperRadiusTransitionRange=.05*j}})):this._onMeshTargetChangedObserver&&j.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(D){this._attachedCamera=D,this._onAfterCheckInputsObserver=D.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(D){return!!this._attachedCamera&&(this._attachedCamera.i===D&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(D){if(!this._attachedCamera)return;this._radiusBounceTransition||(R.EasingFunction.setEasingMode(R.EasingMode),this._radiusBounceTransition=x.c.CreateAnimation("i",x.c.ANIMATIONTYPE_FLOAT,60,R.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const j=x.c.TransitionTo("i",this._attachedCamera.i+D,this._attachedCamera,this._attachedCamera.va(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));j&&this._animatables.push(j)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}R.EasingFunction=new class extends X{constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=D}easeInCore(D){const j=Math.max(0,this.amplitude);return Math.pow(D,3)-D*j*Math.sin(3.141592653589793*D)}}(.3),R.EasingMode=X.EASINGMODE_EASEOUT;class V{constructor(){this.onTargetFramingAnimationEndObservable=new k.d,this._mode=V.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(D){this._mode=D}get mode(){return this._mode}set radiusScale(D){this._radiusScale=D}get radiusScale(){return this._radiusScale}set positionScale(D){this._positionScale=D}get positionScale(){return this._positionScale}set defaultElevation(D){this._defaultElevation=D}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(D){this._elevationReturnTime=D}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(D){this._elevationReturnWaitTime=D}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(D){this._zoomStopsAnimation=D}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(D){this._framingTime=D}get framingTime(){return this._framingTime}init(){}attach(D){this._attachedCamera=D;const j=this._attachedCamera.va();V.EasingFunction.setEasingMode(V.EasingMode),this._onPrePointerObservableObserver=j.onPrePointerObservable.add((D=>{D.type!==f.d.POINTERDOWN?D.type===f.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=D.onMeshTargetChangedObservable.add((D=>{D&&D.getBoundingInfo&&this.zoomOnMesh(D,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=D.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const D=this._attachedCamera.va();this._onPrePointerObservableObserver&&D.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(D){let j=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;D.Ge(!0);const Q=D.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(Q.minimumWorld,Q.maximumWorld,j,W)}zoomOnMeshHierarchy(D){let j=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;D.Ge(!0);const Q=D.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(Q.min,Q.max,j,W)}zoomOnMeshesHierarchy(D){let j=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=new M.j(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),C=new M.j(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let k=0;k<D.length;k++){const j=D[k].getHierarchyBoundingVectors(!0);M.j.CheckExtends(j.min,Q,C),M.j.CheckExtends(j.max,Q,C)}this.zoomOnBoundingInfo(Q,C,j,W)}zoomOnBoundingInfo(D,j){let W,Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2],C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const k=D.y,O=k+(j.y-k)*this._positionScale,E=j.Qc(D).scale(.5);if(Q)W=new M.j(0,O,0);else{const j=D.add(E);W=new M.j(j.x,O,j.z)}this._vectorTransition||(this._vectorTransition=x.c.CreateAnimation("target",x.c.ANIMATIONTYPE_VECTOR3,60,V.EasingFunction)),this._betaIsAnimating=!0;let f=x.c.TransitionTo("target",W,this._attachedCamera,this._attachedCamera.va(),60,this._vectorTransition,this._framingTime);f&&this._animatables.push(f);let F=0;if(this._mode===V.FitFrustumSidesMode){const W=this._calculateLowerRadiusFromModelBoundingSphere(D,j);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=E.length()+this._attachedCamera.qj),F=W}else this._mode===V.IgnoreBoundsSizeMode&&(F=this._calculateLowerRadiusFromModelBoundingSphere(D,j),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.qj));if(this.autoCorrectCameraLimitsAndSensibility){const W=j.Qc(D).length();this._attachedCamera.panningSensibility=5e3/W,this._attachedCamera.wheelPrecision=100/F}return this._radiusTransition||(this._radiusTransition=x.c.CreateAnimation("i",x.c.ANIMATIONTYPE_FLOAT,60,V.EasingFunction)),f=x.c.TransitionTo("i",F,this._attachedCamera,this._attachedCamera.va(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),C&&C(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),f&&this._animatables.push(f),!0}_calculateLowerRadiusFromModelBoundingSphere(D,j){const W=this._attachedCamera;if(!W)return 0;let Q=W._calculateLowerRadiusFromModelBoundingSphere(D,j,this._radiusScale);return W.lowerRadiusLimit&&this._mode===V.IgnoreBoundsSizeMode&&(Q=Q<W.lowerRadiusLimit?W.lowerRadiusLimit:Q),W.upperRadiusLimit&&(Q=Q>W.upperRadiusLimit?W.upperRadiusLimit:Q),Q}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const D=F.b.Now-this._lastInteractionTime,j=.5*Math.PI-this._defaultElevation,W=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>W&&D>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=x.c.CreateAnimation("beta",x.c.ANIMATIONTYPE_FLOAT,60,V.EasingFunction));const D=x.c.TransitionTo("beta",j,this._attachedCamera,this._attachedCamera.va(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));D&&this._animatables.push(D)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=F.b.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}V.EasingFunction=new class extends X{constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=D}easeInCore(D){return this.exponent<=0?D:(Math.exp(this.exponent*D)-1)/(Math.exp(this.exponent)-1)}},V.EasingMode=X.EASINGMODE_EASEINOUT,V.IgnoreBoundsSizeMode=0,V.FitFrustumSidesMode=1;var U=W(12005),g=W(12669),N=W(12671),G=W(1207);class K{constructor(){this._currentActiveButton=-1,this.buttons=[0,1,2]}attachControl(D){D=G.f.BackCompatCameraNoPreventDefault(arguments);const j=this.camera.getEngine(),W=j.getInputElement();let Q=0,C=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=k=>{var M,O;const E=k.event,F="touch"===E.pointerType;if(k.type!==f.d.POINTERMOVE&&-1===this.buttons.indexOf(E.button))return;const Z=E.target;if(this._altKey=E.altKey,this._ctrlKey=E.ctrlKey,this._metaKey=E.metaKey,this._shiftKey=E.shiftKey,this._buttonsPressed=E.buttons,j.isPointerLock){const D=E.movementX,j=E.movementY;this.onTouch(null,D,j),this._pointA=null,this._pointB=null}else{if(k.type!==f.d.POINTERDOWN&&k.type!==f.d.POINTERDOUBLETAP&&F&&(null===(M=this._pointA)||void 0===M?void 0:M.pointerId)!==E.pointerId&&(null===(O=this._pointB)||void 0===O?void 0:O.pointerId)!==E.pointerId)return;if(k.type!==f.d.POINTERDOWN||-1!==this._currentActiveButton&&!F)if(k.type===f.d.POINTERDOUBLETAP)this.onDoubleTap(E.pointerType);else if(k.type!==f.d.POINTERUP||this._currentActiveButton!==E.button&&!F){if(k.type===f.d.POINTERMOVE)if(D||E.preventDefault(),this._pointA&&null===this._pointB){const D=E.clientX-this._pointA.x,j=E.clientY-this._pointA.y;this._pointA.x=E.clientX,this._pointA.y=E.clientY,this.onTouch(this._pointA,D,j)}else if(this._pointA&&this._pointB){const D=this._pointA.pointerId===E.pointerId?this._pointA:this._pointB;D.x=E.clientX,D.y=E.clientY;const j=this._pointA.x-this._pointB.x,W=this._pointA.y-this._pointB.y,M=j*j+W*W,O={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:E.pointerId,type:k.type};this.onMultiTouch(this._pointA,this._pointB,Q,M,C,O),C=O,Q=M}}else{try{null===Z||void 0===Z||Z.releasePointerCapture(E.pointerId)}catch(P){}F||(this._pointB=null),j._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==E.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==E.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==Q||C)&&(this.onMultiTouch(this._pointA,this._pointB,Q,0,C,null),Q=0,C=null),this._currentActiveButton=-1,this.onButtonUp(E),D||E.preventDefault()}else{try{null===Z||void 0===Z||Z.setPointerCapture(E.pointerId)}catch(P){}if(null===this._pointA)this._pointA={x:E.clientX,y:E.clientY,pointerId:E.pointerId,type:E.pointerType};else{if(null!==this._pointB)return;this._pointB={x:E.clientX,y:E.clientY,pointerId:E.pointerId,type:E.pointerType}}-1!==this._currentActiveButton||F||(this._currentActiveButton=E.button),this.onButtonDown(E),D||(E.preventDefault(),W&&W.focus())}}},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,f.d.POINTERDOWN|f.d.POINTERUP|f.d.POINTERMOVE|f.d.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,Q=0,C=null,this.onLostFocus()},this._contextMenuBind=D=>this.onContextMenu(D),W&&W.addEventListener("contextmenu",this._contextMenuBind,!1);const k=this.camera.va().getEngine().getHostWindow();k&&G.f.RegisterTopRootEvents(k,[{name:"blur",handler:this._onLostFocus}])}le(){if(this._onLostFocus){const D=this.camera.va().getEngine().getHostWindow();D&&G.f.UnregisterTopRootEvents(D,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const D=this.camera.va().getEngine().getInputElement();D&&D.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentActiveButton=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(D){}onTouch(D,j,W){}onMultiTouch(D,j,W,Q,C,k){}onContextMenu(D){D.preventDefault()}onButtonDown(D){}onButtonUp(D){}onLostFocus(){}}(0,Q.b)([(0,C.O)()],K.prototype,"buttons",void 0);class L extends K{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(D,j){if(0!==this.panningSensibility&&D&&j){const W=j.x-D.x,Q=j.y-D.y;this.camera.inertialPanningX+=-W/this.panningSensibility,this.camera.inertialPanningY+=Q/this.panningSensibility}}_computePinchZoom(D,j){const W=this.camera.i||L.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.i=W*Math.sqrt(D)/Math.sqrt(j):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(j-D)*W*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(j-D)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(D,j,W){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-j/this.panningSensibility,this.camera.inertialPanningY+=W/this.panningSensibility):(this.camera.inertialAlphaOffset-=j/this.angularSensibilityX,this.camera.inertialBetaOffset-=W/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(D,j,W,Q,C,k){0===W&&null===C||0===Q&&null===k||(this.multiTouchPanAndZoom?(this._computePinchZoom(W,Q),this._computeMultiTouchPanning(C,k)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(Q)-Math.sqrt(W))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(W,Q),this._isPinching=!0):this._computeMultiTouchPanning(C,k)):this.multiTouchPanning?this._computeMultiTouchPanning(C,k):this.pinchZoom&&this._computePinchZoom(W,Q))}onButtonDown(D){this._isPanClick=D.button===this.camera._panningMouseButton}onButtonUp(D){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}L.MinimumRadiusForPinch=.001,(0,Q.b)([(0,C.O)()],L.prototype,"buttons",void 0),(0,Q.b)([(0,C.O)()],L.prototype,"angularSensibilityX",void 0),(0,Q.b)([(0,C.O)()],L.prototype,"angularSensibilityY",void 0),(0,Q.b)([(0,C.O)()],L.prototype,"pinchPrecision",void 0),(0,Q.b)([(0,C.O)()],L.prototype,"pinchDeltaPercentage",void 0),(0,Q.b)([(0,C.O)()],L.prototype,"useNaturalPinchZoom",void 0),(0,Q.b)([(0,C.O)()],L.prototype,"pinchZoom",void 0),(0,Q.b)([(0,C.O)()],L.prototype,"panningSensibility",void 0),(0,Q.b)([(0,C.O)()],L.prototype,"multiTouchPanning",void 0),(0,Q.b)([(0,C.O)()],L.prototype,"multiTouchPanAndZoom",void 0),N.e.ArcRotateCameraPointersInput=L;var e=W(1291);class s{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(D){D=G.f.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((j=>{const W=j.event;if(!W.metaKey)if(j.type===e.b.KEYDOWN){if(this._ctrlPressed=W.ctrlKey,this._altPressed=W.altKey,-1!==this.keysUp.indexOf(W.keyCode)||-1!==this.keysDown.indexOf(W.keyCode)||-1!==this.keysLeft.indexOf(W.keyCode)||-1!==this.keysRight.indexOf(W.keyCode)||-1!==this.keysReset.indexOf(W.keyCode)){-1===this._keys.indexOf(W.keyCode)&&this._keys.push(W.keyCode),W.preventDefault&&(D||W.preventDefault())}}else if(-1!==this.keysUp.indexOf(W.keyCode)||-1!==this.keysDown.indexOf(W.keyCode)||-1!==this.keysLeft.indexOf(W.keyCode)||-1!==this.keysRight.indexOf(W.keyCode)||-1!==this.keysReset.indexOf(W.keyCode)){const j=this._keys.indexOf(W.keyCode);j>=0&&this._keys.splice(j,1),W.preventDefault&&(D||W.preventDefault())}})))}le(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const D=this.camera;for(let j=0;j<this._keys.length;j++){const W=this._keys[j];-1!==this.keysLeft.indexOf(W)?this._ctrlPressed&&this.camera._useCtrlForPanning?D.inertialPanningX-=1/this.panningSensibility:D.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(W)?this._ctrlPressed&&this.camera._useCtrlForPanning?D.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?D.inertialRadiusOffset+=1/this.zoomingSensibility:D.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(W)?this._ctrlPressed&&this.camera._useCtrlForPanning?D.inertialPanningX+=1/this.panningSensibility:D.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(W)?this._ctrlPressed&&this.camera._useCtrlForPanning?D.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?D.inertialRadiusOffset-=1/this.zoomingSensibility:D.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(W)&&D.useInputToRestoreState&&D.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,Q.b)([(0,C.O)()],s.prototype,"keysUp",void 0),(0,Q.b)([(0,C.O)()],s.prototype,"keysDown",void 0),(0,Q.b)([(0,C.O)()],s.prototype,"keysLeft",void 0),(0,Q.b)([(0,C.O)()],s.prototype,"keysRight",void 0),(0,Q.b)([(0,C.O)()],s.prototype,"keysReset",void 0),(0,Q.b)([(0,C.O)()],s.prototype,"panningSensibility",void 0),(0,Q.b)([(0,C.O)()],s.prototype,"zoomingSensibility",void 0),(0,Q.b)([(0,C.O)()],s.prototype,"useAltToZoom",void 0),(0,Q.b)([(0,C.O)()],s.prototype,"angularSpeed",void 0),N.e.ArcRotateCameraKeyboardMoveInput=s;var b=W(1174),Y=W(1300),t=W(1e3);class c{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new M.j(0,0,0),this._globalOffset=new M.j(0,0,0),this._inertialPanning=M.j.Zero()}_computeDeltaFromMouseWheelLegacyEvent(D,j){let W=0;const Q=.01*D*this.wheelDeltaPercentage*j;return W=D>0?Q/(1+this.wheelDeltaPercentage):Q*(1+this.wheelDeltaPercentage),W}attachControl(D){D=G.f.BackCompatCameraNoPreventDefault(arguments),this._wheel=j=>{if(j.type!==f.d.POINTERWHEEL)return;const W=j.event;let Q=0;const C=W.deltaMode===Y.e.DOM_DELTA_LINE?40:1,k=-W.deltaY*C;if(this.customComputeDeltaFromMouseWheel)Q=this.customComputeDeltaFromMouseWheel(k,this,W);else if(this.wheelDeltaPercentage){if(Q=this._computeDeltaFromMouseWheelLegacyEvent(k,this.camera.i),Q>0){let D=this.camera.i,j=this.camera.inertialRadiusOffset+Q;for(let W=0;W<20&&Math.abs(j)>.001;W++)D-=j,j*=this.camera.inertia;D=(0,t.e)(D,0,Number.MAX_VALUE),Q=this._computeDeltaFromMouseWheelLegacyEvent(k,D)}}else Q=k/(40*this.wheelPrecision);Q&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(Q)):this.camera.inertialRadiusOffset+=Q),W.preventDefault&&(D||W.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,f.d.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.Jd(0)}le(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const D=this.camera;0+D.inertialAlphaOffset+D.inertialBetaOffset+D.inertialRadiusOffset&&(this._updateHitPlane(),D.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(D.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const D=this.camera,j=D.target.Qc(D.position);this._hitPlane=b.b.FromPositionAndNormal(D.target,j)}_getPosition(){const D=this.camera,j=D.va(),W=j.createPickingRay(j.pointerX,j.pointerY,M.b.Identity(),D,!1);0===D.targetScreenOffset.x&&0===D.targetScreenOffset.y||(this._viewOffset.set(D.targetScreenOffset.x,D.targetScreenOffset.y,0),D.getViewMatrix().invertToRef(D._cameraTransformMatrix),this._globalOffset=M.j.TransformNormal(this._viewOffset,D._cameraTransformMatrix),W.origin.addInPlace(this._globalOffset));let Q=0;return this._hitPlane&&(Q=W.intersectsPlane(this._hitPlane)??0),W.origin.addInPlace(W.direction.scaleInPlace(Q))}_zoomToMouse(D){const j=this.camera,W=1-j.inertia;if(j.lowerRadiusLimit){const Q=j.lowerRadiusLimit??0;j.i-(j.inertialRadiusOffset+D)/W<Q&&(D=(j.i-Q)*W-j.inertialRadiusOffset)}if(j.upperRadiusLimit){const Q=j.upperRadiusLimit??0;j.i-(j.inertialRadiusOffset+D)/W>Q&&(D=(j.i-Q)*W-j.inertialRadiusOffset)}const Q=D/W/j.i,C=this._getPosition(),k=M.e.Kd[6];C.subtractToRef(j.target,k),k.scaleInPlace(Q),k.scaleInPlace(W),this._inertialPanning.addInPlace(k),j.inertialRadiusOffset+=D}_zeroIfClose(D){Math.abs(D.x)<Z.c&&(D.x=0),Math.abs(D.y)<Z.c&&(D.y=0),Math.abs(D.z)<Z.c&&(D.z=0)}}(0,Q.b)([(0,C.O)()],c.prototype,"wheelPrecision",void 0),(0,Q.b)([(0,C.O)()],c.prototype,"zoomToMouseLocation",void 0),(0,Q.b)([(0,C.O)()],c.prototype,"wheelDeltaPercentage",void 0),N.e.ArcRotateCameraMouseWheelInput=c;class l extends N.g{constructor(D){super(D)}addMouseWheel(){return this.add(new c),this}addPointers(){return this.add(new L),this}addKeyboard(){return this.add(new s),this}}var I=W(981);O.e.AddNodeConstructor("ArcRotateCamera",((D,j)=>()=>new y(D,0,0,1,M.j.Zero(),j)));class y extends g.e{get target(){return this._target}set target(D){this.setTarget(D)}get targetHost(){return this._targetHost}set targetHost(D){D&&this.setTarget(D)}getTarget(){return this.target}get position(){return this._position}set position(D){this.setPosition(D)}set upVector(D){this._upToYMatrix||(this._yToUpMatrix=new M.b,this._upToYMatrix=new M.b,this._upVector=M.j.Zero()),D.normalize(),this._upVector.p(D),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){M.b.RotationAlignToRef(M.j.UpReadOnly,this._upVector,this._yToUpMatrix),M.b.RotationAlignToRef(this._upVector,M.j.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const D=this.inputs.attached.pointers;return D?D.angularSensibilityX:0}set angularSensibilityX(D){const j=this.inputs.attached.pointers;j&&(j.angularSensibilityX=D)}get angularSensibilityY(){const D=this.inputs.attached.pointers;return D?D.angularSensibilityY:0}set angularSensibilityY(D){const j=this.inputs.attached.pointers;j&&(j.angularSensibilityY=D)}get pinchPrecision(){const D=this.inputs.attached.pointers;return D?D.pinchPrecision:0}set pinchPrecision(D){const j=this.inputs.attached.pointers;j&&(j.pinchPrecision=D)}get pinchDeltaPercentage(){const D=this.inputs.attached.pointers;return D?D.pinchDeltaPercentage:0}set pinchDeltaPercentage(D){const j=this.inputs.attached.pointers;j&&(j.pinchDeltaPercentage=D)}get useNaturalPinchZoom(){const D=this.inputs.attached.pointers;return!!D&&D.useNaturalPinchZoom}set useNaturalPinchZoom(D){const j=this.inputs.attached.pointers;j&&(j.useNaturalPinchZoom=D)}get panningSensibility(){const D=this.inputs.attached.pointers;return D?D.panningSensibility:0}set panningSensibility(D){const j=this.inputs.attached.pointers;j&&(j.panningSensibility=D)}get keysUp(){const D=this.inputs.attached.keyboard;return D?D.keysUp:[]}set keysUp(D){const j=this.inputs.attached.keyboard;j&&(j.keysUp=D)}get keysDown(){const D=this.inputs.attached.keyboard;return D?D.keysDown:[]}set keysDown(D){const j=this.inputs.attached.keyboard;j&&(j.keysDown=D)}get keysLeft(){const D=this.inputs.attached.keyboard;return D?D.keysLeft:[]}set keysLeft(D){const j=this.inputs.attached.keyboard;j&&(j.keysLeft=D)}get keysRight(){const D=this.inputs.attached.keyboard;return D?D.keysRight:[]}set keysRight(D){const j=this.inputs.attached.keyboard;j&&(j.keysRight=D)}get wheelPrecision(){const D=this.inputs.attached.mousewheel;return D?D.wheelPrecision:0}set wheelPrecision(D){const j=this.inputs.attached.mousewheel;j&&(j.wheelPrecision=D)}get zoomToMouseLocation(){const D=this.inputs.attached.mousewheel;return!!D&&D.zoomToMouseLocation}set zoomToMouseLocation(D){const j=this.inputs.attached.mousewheel;j&&(j.zoomToMouseLocation=D)}get wheelDeltaPercentage(){const D=this.inputs.attached.mousewheel;return D?D.wheelDeltaPercentage:0}set wheelDeltaPercentage(D){const j=this.inputs.attached.mousewheel;j&&(j.wheelDeltaPercentage=D)}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(D){D!==this.useBouncingBehavior&&(D?(this._bouncingBehavior=new R,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(D){D!==this.useFramingBehavior&&(D?(this._framingBehavior=new V,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(D){D!==this.useAutoRotationBehavior&&(D?(this._autoRotationBehavior=new P,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(D,j,W,Q,C,O){var E;let f=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(D,M.j.Zero(),O,f),E=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=M.j.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=M.f.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._viewMatrix=new M.b,this.panningAxis=new M.j(1,1,0),this._transformedDirection=new M.j,this.mapPanning=!1,this._progressiveRestore=!1,this.onMeshTargetChangedObservable=new k.d,this.checkCollisions=!1,this.collisionRadius=new M.j(.5,.5,.5),this._previousPosition=M.j.Zero(),this._collisionVelocity=M.j.Zero(),this._newPosition=M.j.Zero(),this._computationVector=M.j.Zero(),this._onCollisionPositionChange=function(D,j){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;W?(E.setPosition(j),E.Uk&&E.Uk(W)):E._previousPosition.p(E._position);const Q=Math.cos(E.alpha),C=Math.sin(E.alpha),k=Math.cos(E.beta);let M=Math.sin(E.beta);0===M&&(M=1e-4);const O=E._getTargetPosition();E._computationVector.Id(E.i*Q*M,E.i*k,E.i*C*M),O.addToRef(E._computationVector,E._newPosition),E._position.p(E._newPosition);let f=E.upVector;E.allowUpsideDown&&E.beta<0&&(f=f.clone(),f=f.negate()),E._computeViewMatrix(E._position,O,f),E._viewMatrix.addAtIndex(12,E.targetScreenOffset.x),E._viewMatrix.addAtIndex(13,E.targetScreenOffset.y),E._collisionTriggered=!1},this._target=M.j.Zero(),C&&this.setTarget(C),this.alpha=j,this.beta=W,this.i=Q,this.getViewMatrix(),this.inputs=new l(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new M.j(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.i=void 0,this._cache.targetScreenOffset=M.f.Zero()}_updateCache(D){D||super._updateCache(),this._cache._target.p(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.i=this.i,this._cache.targetScreenOffset.p(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const D=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?D.addToRef(this._targetBoundingCenter,this._target):this._target.p(D)}const D=this._getLockedTargetPosition();return D||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.i,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>Z.c&&this.restoreStateInterpolationFactor<1?(this._progressiveRestore=!0,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.i=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.i===this.i&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(D,j){let W=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const C=arguments;j=G.f.BackCompatCameraNoPreventDefault(C),this._useCtrlForPanning=W,this._panningMouseButton=Q,"boolean"===typeof C[0]&&(C.length>1&&(this._useCtrlForPanning=C[1]),C.length>2&&(this._panningMouseButton=C[2])),this.inputs.attachElement(j),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}le(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),this._progressiveRestore){const D=this._scene.getEngine().getDeltaTime()/1e3,j=1-Math.pow(2,-D/this.restoreStateInterpolationFactor);this.setTarget(M.j.Lerp(this.getTarget(),this._storedTarget,j)),M.d.RotationAlphaBetaGammaToRef(this._storedAlpha,this._storedBeta,0,M.e.Quaternion[0]),M.d.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,M.e.Quaternion[1]),M.d.SlerpToRef(M.e.Quaternion[1],M.e.Quaternion[0],j,M.e.Quaternion[2]),M.e.Quaternion[2].normalize(),M.e.Quaternion[2].toAlphaBetaGammaToRef(M.e.Kd[0]),this.alpha=M.e.Kd[0].x,this.beta=M.e.Kd[0].y,this.i+=(this._storedRadius-this.i)*j,M.f.LerpToRef(this.targetScreenOffset,this._storedTargetScreenOffset,j,this.targetScreenOffset),(M.j.DistanceSquared(this.getTarget(),this._storedTarget)<Z.c&&M.e.Quaternion[2].equalsWithEpsilon(M.e.Quaternion[0])&&Math.pow(this._storedRadius-this.i,2)<Z.c&&M.f.Distance(this.targetScreenOffset,this._storedTargetScreenOffset)<Z.c||0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset||0!==this.inertialPanningX||0!==this.inertialPanningY)&&(this._progressiveRestore=!1)}if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){const D=this.invertRotation?-1:1,j=this._calculateHandednessMultiplier();let W=this.inertialAlphaOffset*j;this.beta<0&&(W*=-1),this.alpha+=W*D,this.beta+=this.inertialBetaOffset*D,this.i-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<Z.c&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<Z.c&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*Z.c&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){const D=new M.j(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),D.multiplyInPlace(this.panningAxis),M.j.TransformNormalToRef(D,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const D=this.upVector,j=M.j.CrossToRef(this._transformedDirection,D,this._transformedDirection);M.j.CrossToRef(D,j,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);M.j.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.p(this._transformedDirection)}else{if(this.parent){const D=M.e.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(D),D.transposeToRef(D),M.j.TransformCoordinatesToRef(this._transformedDirection,D,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*Z.c&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*Z.c&&(this.inertialPanningY=0)}this._checkLimits(),super._checkInputs()}}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.i<this.lowerRadiusLimit&&(this.i=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.i>this.upperRadiusLimit&&(this.i=this.upperRadiusLimit,this.inertialRadiusOffset=0)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||M.j.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.i=this._computationVector.length(),0===this.i&&(this.i=1e-4);const D=this.alpha;0===this._computationVector.x&&0===this._computationVector.z?this.alpha=Math.PI/2:this.alpha=Math.acos(this._computationVector.x/Math.sqrt(Math.pow(this._computationVector.x,2)+Math.pow(this._computationVector.z,2))),this._computationVector.z<0&&(this.alpha=2*Math.PI-this.alpha);const j=Math.round((D-this.alpha)/(2*Math.PI));this.alpha+=2*j*Math.PI,this.beta=Math.acos(this._computationVector.y/this.i),this._checkLimits()}setPosition(D){this._position.equals(D)||(this._position.p(D),this.rebuildAnglesAndRadius())}setTarget(D){let j=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Q=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(Q=this.overrideCloneAlphaBetaRadius??Q,D.Ge)j&&D.getBoundingInfo?this._targetBoundingCenter=D.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,D.Ge(),this._targetHost=D,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const j=D,Q=this._getTargetPosition();if(Q&&!W&&Q.equals(j))return;this._targetHost=null,this._target=j,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}Q||this.rebuildAnglesAndRadius()}_getViewMatrix(){const D=Math.cos(this.alpha),j=Math.sin(this.alpha),W=Math.cos(this.beta);let Q=Math.sin(this.beta);0===Q&&(Q=1e-4),0===this.i&&(this.i=1e-4);const C=this._getTargetPosition();if(this._computationVector.Id(this.i*D*Q,this.i*W,this.i*j*Q),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||M.j.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),C.addToRef(this._computationVector,this._newPosition),this.va().collisionsEnabled&&this.checkCollisions){const D=this.va().collisionCoordinator;this._collider||(this._collider=D.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,D.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.p(this._newPosition);let D=this.upVector;this.allowUpsideDown&&Q<0&&(D=D.negate()),this._computeViewMatrix(this._position,C,D),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget=C,this._viewMatrix}zoomOn(D){let j=arguments.length>1&&void 0!==arguments[1]&&arguments[1];D=D||this.va().meshes;const W=E.d.MinMax(D);let Q=this._calculateLowerRadiusFromModelBoundingSphere(W.min,W.max);Q=Math.max(Math.min(Q,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.i=Q*this.zoomOnFactor,this.focusOn({min:W.min,max:W.max,distance:Q},j)}focusOn(D){let j,W,Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===D.min){const Q=D||this.va().meshes;j=E.d.MinMax(Q),W=M.j.Distance(j.min,j.max)}else{j=D,W=D.distance}this._target=E.d.Center(j),Q||(this.maxZ=2*W)}createRigCamera(D,j){let W=0;switch(this.cameraRigMode){case U.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case U.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case U.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case U.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case U.d.RIG_MODE_VR:W=this._cameraRigParams.stereoHalfAngle*(0===j?1:-1);break;case U.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:W=this._cameraRigParams.stereoHalfAngle*(0===j?-1:1)}const Q=new y(D,this.alpha+W,this.beta,this.i,this._target,this.va());return Q._cameraRigParams={},Q.isRigCamera=!0,Q.rigParent=this,Q.upVector=this.upVector,Q.mode=this.mode,Q.orthoLeft=this.orthoLeft,Q.orthoRight=this.orthoRight,Q.orthoBottom=this.orthoBottom,Q.orthoTop=this.orthoTop,Q}_updateRigCameras(){const D=this._rigCameras[0],j=this._rigCameras[1];switch(D.beta=j.beta=this.beta,this.cameraRigMode){case U.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case U.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case U.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case U.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case U.d.RIG_MODE_VR:D.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,j.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case U.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:D.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,j.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(D,j){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const Q=M.j.Distance(D,j),C=this.va().getEngine().getAspectRatio(this),k=Math.tan(this.fov/2),O=k*C,E=.5*Q*W,f=E*Math.sqrt(1+1/(O*O)),F=E*Math.sqrt(1+1/(k*k));return Math.max(f,F)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,Q.b)([(0,C.O)()],y.prototype,"alpha",void 0),(0,Q.b)([(0,C.O)()],y.prototype,"beta",void 0),(0,Q.b)([(0,C.O)()],y.prototype,"i",void 0),(0,Q.b)([(0,C.O)()],y.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,Q.b)([(0,C.L)("target")],y.prototype,"_target",void 0),(0,Q.b)([(0,C.A)("targetHost")],y.prototype,"_targetHost",void 0),(0,Q.b)([(0,C.O)()],y.prototype,"inertialAlphaOffset",void 0),(0,Q.b)([(0,C.O)()],y.prototype,"inertialBetaOffset",void 0),(0,Q.b)([(0,C.O)()],y.prototype,"inertialRadiusOffset",void 0),(0,Q.b)([(0,C.O)()],y.prototype,"lowerAlphaLimit",void 0),(0,Q.b)([(0,C.O)()],y.prototype,"upperAlphaLimit",void 0),(0,Q.b)([(0,C.O)()],y.prototype,"lowerBetaLimit",void 0),(0,Q.b)([(0,C.O)()],y.prototype,"upperBetaLimit",void 0),(0,Q.b)([(0,C.O)()],y.prototype,"lowerRadiusLimit",void 0),(0,Q.b)([(0,C.O)()],y.prototype,"upperRadiusLimit",void 0),(0,Q.b)([(0,C.O)()],y.prototype,"inertialPanningX",void 0),(0,Q.b)([(0,C.O)()],y.prototype,"inertialPanningY",void 0),(0,Q.b)([(0,C.O)()],y.prototype,"pinchToPanMaxDistance",void 0),(0,Q.b)([(0,C.O)()],y.prototype,"panningDistanceLimit",void 0),(0,Q.b)([(0,C.L)()],y.prototype,"panningOriginTarget",void 0),(0,Q.b)([(0,C.O)()],y.prototype,"panningInertia",void 0),(0,Q.b)([(0,C.O)()],y.prototype,"zoomToMouseLocation",null),(0,Q.b)([(0,C.O)()],y.prototype,"zoomOnFactor",void 0),(0,Q.b)([(0,C.J)()],y.prototype,"targetScreenOffset",void 0),(0,Q.b)([(0,C.O)()],y.prototype,"allowUpsideDown",void 0),(0,Q.b)([(0,C.O)()],y.prototype,"useInputToRestoreState",void 0),(0,Q.b)([(0,C.O)()],y.prototype,"restoreStateInterpolationFactor",void 0),(0,I.c)("BABYLON.ArcRotateCamera",y)},12005:(D,j,W)=>{"use strict";W.d(j,{d:()=>V});var Q=W(942),C=W(948),k=W(1191),M=W(1207),O=W(961),E=W(966),f=W(12011),F=W(1083),Z=W(981),P=W(1070),X=W(1525),x=W(1323),R=W(1151);class V extends f.e{get position(){return this._position}set position(D){this._position=D}set upVector(D){this._upVector=D}get upVector(){return this._upVector}get screenArea(){let D=0,j=0;if(this.mode===V.PERSPECTIVE_CAMERA)this.fovMode===V.FOVMODE_VERTICAL_FIXED?(j=2*this.qj*Math.tan(this.fov/2),D=this.getEngine().getAspectRatio(this)*j):(D=2*this.qj*Math.tan(this.fov/2),j=D/this.getEngine().getAspectRatio(this));else{const W=this.getEngine().getRenderWidth()/2,Q=this.getEngine().getRenderHeight()/2;D=(this.orthoRight??W)-(this.orthoLeft??-W),j=(this.orthoTop??Q)-(this.orthoBottom??-Q)}return D*j}set orthoLeft(D){this._orthoLeft=D;for(const j of this._rigCameras)j.orthoLeft=D}get orthoLeft(){return this._orthoLeft}set orthoRight(D){this._orthoRight=D;for(const j of this._rigCameras)j.orthoRight=D}get orthoRight(){return this._orthoRight}set orthoBottom(D){this._orthoBottom=D;for(const j of this._rigCameras)j.orthoBottom=D}get orthoBottom(){return this._orthoBottom}set orthoTop(D){this._orthoTop=D;for(const j of this._rigCameras)j.orthoTop=D}get orthoTop(){return this._orthoTop}set mode(D){this._mode=D;for(const j of this._rigCameras)j.mode=D}get mode(){return this._mode}get hasMoved(){return this._hasMoved}constructor(D,j,W){let Q=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];super(D,W,!1),this._position=E.j.Zero(),this._upVector=E.j.Up(),this.oblique=null,this._orthoLeft=null,this._orthoRight=null,this._orthoBottom=null,this._orthoTop=null,this.fov=.8,this.projectionPlaneTilt=0,this.qj=1,this.maxZ=1e4,this.inertia=.9,this._mode=V.PERSPECTIVE_CAMERA,this.isIntermediate=!1,this.viewport=new X.e(0,0,1,1),this.layerMask=268435455,this.fovMode=V.FOVMODE_VERTICAL_FIXED,this.cameraRigMode=V.RIG_MODE_NONE,this.customRenderTargets=[],this.outputRenderTarget=null,this.onViewMatrixChangedObservable=new O.d,this.onProjectionMatrixChangedObservable=new O.d,this.onAfterCheckInputsObservable=new O.d,this.onRestoreStateObservable=new O.d,this.isRigCamera=!1,this._hasMoved=!1,this._rigCameras=new Array,this._skipRendering=!1,this._projectionMatrix=new E.b,this._postProcesses=new Array,this._activeMeshes=new k.i(256),this._globalPosition=E.j.Zero(),this._computedViewMatrix=E.b.Identity(),this._doNotComputeProjectionMatrix=!1,this._transformMatrix=E.b.Zero(),this._refreshFrustumPlanes=!0,this._absoluteRotation=E.d.Identity(),this._isCamera=!0,this._isLeftCamera=!1,this._isRightCamera=!1,this.va().addCamera(this),Q&&!this.va().activeCamera&&(this.va().activeCamera=this),this.position=j,this.renderPassId=this.va().getEngine().createRenderPassId(`Camera ${D}`)}storeState(){return this._stateStored=!0,this._storedFov=this.fov,this}hasStateStored(){return!!this._stateStored}_restoreStateValues(){return!!this._stateStored&&(this.fov=this._storedFov,!0)}restoreState(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)}getClassName(){return"ai"}toString(D){let j="Name: "+this.name;if(j+=", type: "+this.getClassName(),this.animations)for(let W=0;W<this.animations.length;W++)j+=", animation[0]: "+this.animations[W].toString(D);return j}applyVerticalCorrection(){const D=this.absoluteRotation.toEulerAngles();this.projectionPlaneTilt=this._scene.useRightHandedSystem?-D.x:D.x}get globalPosition(){return this._globalPosition}getActiveMeshes(){return this._activeMeshes}isActiveMesh(D){return-1!==this._activeMeshes.indexOf(D)}isReady(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(D)for(const j of this._postProcesses)if(j&&!j.isReady())return!1;return super.isReady(D)}_initCache(){super._initCache(),this._cache.position=new E.j(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new E.j(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.qj=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.obliqueAngle=void 0,this._cache.obliqueLength=void 0,this._cache.obliqueOffset=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0}_updateCache(D){D||super._updateCache(),this._cache.position.p(this.position),this._cache.upVector.p(this.upVector)}_isSynchronized(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()}_isSynchronizedViewMatrix(){return!!super._isSynchronized()&&(this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent())}_isSynchronizedProjectionMatrix(){let D=this._cache.mode===this.mode&&this._cache.qj===this.qj&&this._cache.maxZ===this.maxZ;if(!D)return!1;const j=this.getEngine();return this.mode===V.PERSPECTIVE_CAMERA?D=this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===j.getAspectRatio(this)&&this._cache.projectionPlaneTilt===this.projectionPlaneTilt:(D=this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===j.getRenderWidth()&&this._cache.renderHeight===j.getRenderHeight(),this.oblique&&(D=D&&this._cache.obliqueAngle===this.oblique.angle&&this._cache.obliqueLength===this.oblique.length&&this._cache.obliqueOffset===this.oblique.offset)),D}attachControl(D,j){}le(D){}update(){this._hasMoved=!1,this._checkInputs(),this.cameraRigMode!==V.RIG_MODE_NONE&&this._updateRigCameras(),this.getViewMatrix(),this.getProjectionMatrix()}_checkInputs(){this.onAfterCheckInputsObservable.notifyObservers(this)}get rigCameras(){return this._rigCameras}get rigPostProcess(){return this._rigPostProcess}_getFirstPostProcess(){for(let D=0;D<this._postProcesses.length;D++)if(null!==this._postProcesses[D])return this._postProcesses[D];return null}_cascadePostProcessesToRigCams(){const D=this._getFirstPostProcess();D&&D.markTextureDirty();for(let j=0,W=this._rigCameras.length;j<W;j++){const D=this._rigCameras[j],W=D._rigPostProcess;if(W){"pass"===W.getEffectName()&&(D.isIntermediate=0===this._postProcesses.length),D._postProcesses=this._postProcesses.slice(0).concat(W),W.markTextureDirty()}else D._postProcesses=this._postProcesses.slice(0)}}attachPostProcess(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return!D.isReusable()&&this._postProcesses.indexOf(D)>-1?(F.b.Error("You're trying to reuse a post process not defined as reusable."),0):(null==j||j<0?this._postProcesses.push(D):null===this._postProcesses[j]?this._postProcesses[j]=D:this._postProcesses.splice(j,0,D),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.Le(),this._postProcesses.indexOf(D))}detachPostProcess(D){const j=this._postProcesses.indexOf(D);-1!==j&&(this._postProcesses[j]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.Le(),this._cascadePostProcessesToRigCams()}getWorldMatrix(){return this._isSynchronizedViewMatrix()||this.getViewMatrix(),this._worldMatrix}_getViewMatrix(){return E.b.Identity()}getViewMatrix(D){return!D&&this._isSynchronizedViewMatrix()||(this._hasMoved=!0,this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.va().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix)),this._computedViewMatrix}freezeProjectionMatrix(D){this._doNotComputeProjectionMatrix=!0,void 0!==D&&(this._projectionMatrix=D)}unfreezeProjectionMatrix(){this._doNotComputeProjectionMatrix=!1}getProjectionMatrix(D){if(this._doNotComputeProjectionMatrix||!D&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.qj=this.qj,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;const j=this.getEngine(),W=this.va(),Q=j.useReverseDepthBuffer;if(this.mode===V.PERSPECTIVE_CAMERA){let D;this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=j.getAspectRatio(this),this._cache.projectionPlaneTilt=this.projectionPlaneTilt,this.qj<=0&&(this.qj=.1),D=W.useRightHandedSystem?E.b.PerspectiveFovRHToRef:E.b.PerspectiveFovLHToRef,D(this.fov,j.getAspectRatio(this),Q?this.maxZ:this.qj,Q?this.qj:this.maxZ,this._projectionMatrix,this.fovMode===V.FOVMODE_VERTICAL_FIXED,j.isNDCHalfZRange,this.projectionPlaneTilt,Q)}else{var C,k,M;const D=j.getRenderWidth()/2,O=j.getRenderHeight()/2;W.useRightHandedSystem?this.oblique?E.b.ObliqueOffCenterRHToRef(this.orthoLeft??-D,this.orthoRight??D,this.orthoBottom??-O,this.orthoTop??O,Q?this.maxZ:this.qj,Q?this.qj:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,j.isNDCHalfZRange):E.b.OrthoOffCenterRHToRef(this.orthoLeft??-D,this.orthoRight??D,this.orthoBottom??-O,this.orthoTop??O,Q?this.maxZ:this.qj,Q?this.qj:this.maxZ,this._projectionMatrix,j.isNDCHalfZRange):this.oblique?E.b.ObliqueOffCenterLHToRef(this.orthoLeft??-D,this.orthoRight??D,this.orthoBottom??-O,this.orthoTop??O,Q?this.maxZ:this.qj,Q?this.qj:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,j.isNDCHalfZRange):E.b.OrthoOffCenterLHToRef(this.orthoLeft??-D,this.orthoRight??D,this.orthoBottom??-O,this.orthoTop??O,Q?this.maxZ:this.qj,Q?this.qj:this.maxZ,this._projectionMatrix,j.isNDCHalfZRange),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.obliqueAngle=null===(C=this.oblique)||void 0===C?void 0:C.angle,this._cache.obliqueLength=null===(k=this.oblique)||void 0===k?void 0:k.length,this._cache.obliqueOffset=null===(M=this.oblique)||void 0===M?void 0:M.offset,this._cache.renderWidth=j.getRenderWidth(),this._cache.renderHeight=j.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix}getTransformationMatrix(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix}_computeObliqueDistance(D){return(this.i||(this.target?E.j.Distance(this.position,this.target):this.position.length()))+D}_updateFrustumPlanes(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?x.e.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=x.e.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)}isInFrustum(D){let j=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._updateFrustumPlanes(),j&&this.rigCameras.length>0){let j=!1;return this.rigCameras.forEach((W=>{W._updateFrustumPlanes(),j=j||D.isInFrustum(W._frustumPlanes)})),j}return D.isInFrustum(this._frustumPlanes)}isCompletelyInFrustum(D){return this._updateFrustumPlanes(),D.isCompletelyInFrustum(this._frustumPlanes)}getForwardRay(){throw(0,P.d)("Ray")}getForwardRayToRef(D){throw(0,P.d)("Ray")}dispose(D){let j=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.va().stopAnimation(this),this.va().removeCamera(this);this._rigCameras.length>0;){const D=this._rigCameras.pop();D&&D.dispose()}if(this._parentContainer){const D=this._parentContainer.cameras.indexOf(this);D>-1&&this._parentContainer.cameras.splice(D,1),this._parentContainer=null}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses.length=0;else if(this.cameraRigMode!==V.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses.length=0;else{let D=this._postProcesses.length;for(;--D>=0;){const j=this._postProcesses[D];j&&j.dispose(this)}}let W=this.customRenderTargets.length;for(;--W>=0;)this.customRenderTargets[W].dispose();this.customRenderTargets.length=0,this._activeMeshes.dispose(),this.va().getEngine().releaseRenderPassId(this.renderPassId),super.dispose(D,j)}get isLeftCamera(){return this._isLeftCamera}get isRightCamera(){return this._isRightCamera}get leftCamera(){return this._rigCameras.length<1?null:this._rigCameras[0]}get rightCamera(){return this._rigCameras.length<2?null:this._rigCameras[1]}getLeftTarget(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()}getRightTarget(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()}setCameraRigMode(D,j){if(this.cameraRigMode!==D){for(;this._rigCameras.length>0;){const D=this._rigCameras.pop();D&&D.dispose()}if(this.cameraRigMode=D,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=j.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=M.f.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==V.RIG_MODE_NONE){const D=this.createRigCamera(this.name+"_L",0);D&&(D._isLeftCamera=!0);const j=this.createRigCamera(this.name+"_R",1);j&&(j._isRightCamera=!0),D&&j&&(this._rigCameras.push(D),this._rigCameras.push(j))}this._setRigMode(j),this._cascadePostProcessesToRigCams(),this.update()}}_setRigMode(D){}_getVRProjectionMatrix(){return E.b.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.qj,this.maxZ,this._cameraRigParams.vrWorkMatrix,!0,this.getEngine().isNDCHalfZRange),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix}setCameraRigParameter(D,j){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[D]=j,"interaxialDistance"===D&&(this._cameraRigParams.stereoHalfAngle=M.f.ToRadians(j/.0637))}createRigCamera(D,j){return null}_updateRigCameras(){for(let D=0;D<this._rigCameras.length;D++)this._rigCameras[D].qj=this.qj,this._rigCameras[D].maxZ=this.maxZ,this._rigCameras[D].fov=this.fov,this._rigCameras[D].upVector.p(this.upVector);this.cameraRigMode===V.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)}_setupInputs(){}serialize(){const D=R.d.Serialize(this);return D.uniqueId=this.uniqueId,D.type=this.getClassName(),this.parent&&this.parent._serializeAsParent(D),this.inputs&&this.inputs.serialize(D),R.d.AppendSerializedAnimations(this,D),D.ranges=this.serializeAnimationRanges(),D.isEnabled=this.isEnabled(),D}clone(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const W=R.d.Clone(V.GetConstructorFromName(this.getClassName(),D,this.va(),this.interaxialDistance,this.isStereoscopicSideBySide),this);return W.name=D,W.parent=j,this.onClonedObservable.notifyObservers(W),W}ie(D){const j=E.j.Zero();return this.getDirectionToRef(D,j),j}get absoluteRotation(){return this.getWorldMatrix().decompose(void 0,this._absoluteRotation),this._absoluteRotation}getDirectionToRef(D,j){E.j.TransformNormalToRef(D,this.getWorldMatrix(),j)}static GetConstructorFromName(D,j,W){let Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,C=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const k=f.e.Construct(D,j,W,{interaxial_distance:Q,isStereoscopicSideBySide:C});return k||(()=>V._CreateDefaultParsedCamera(j,W))}Ge(){return this.getWorldMatrix()}static Parse(D,j){const W=D.type,Q=V.GetConstructorFromName(W,D.name,j,D.interaxial_distance,D.isStereoscopicSideBySide),C=R.d.Parse(Q,D,j);if(void 0!==D.parentId&&(C._waitingParentId=D.parentId),void 0!==D.parentInstanceIndex&&(C._waitingParentInstanceIndex=D.parentInstanceIndex),C.inputs&&(C.inputs.parse(D),C._setupInputs()),D.upVector&&(C.upVector=E.j.Dd(D.upVector)),C.setPosition&&(C.position.Id(0,0,0),C.setPosition(E.j.Dd(D.position))),D.target&&C.setTarget&&C.setTarget(E.j.Dd(D.target)),D.cameraRigMode){const j=D.interaxial_distance?{interaxialDistance:D.interaxial_distance}:{};C.setCameraRigMode(D.cameraRigMode,j)}if(D.animations){for(let j=0;j<D.animations.length;j++){const W=D.animations[j],Q=(0,Z.b)("BABYLON.Animation");Q&&C.animations.push(Q.Parse(W))}f.e.ParseAnimationRanges(C,D,j)}return D.autoAnimate&&j.beginAnimation(C,D.autoAnimateFrom,D.autoAnimateTo,D.autoAnimateLoop,D.autoAnimateSpeed||1),void 0!==D.isEnabled&&C.Kg(D.isEnabled),C}_calculateHandednessMultiplier(){let D=this.va().useRightHandedSystem?-1:1;return this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(D*=-1),D}}V._CreateDefaultParsedCamera=(D,j)=>{throw(0,P.d)("UniversalCamera")},V.PERSPECTIVE_CAMERA=0,V.ORTHOGRAPHIC_CAMERA=1,V.FOVMODE_VERTICAL_FIXED=0,V.FOVMODE_HORIZONTAL_FIXED=1,V.RIG_MODE_NONE=0,V.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,V.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,V.RIG_MODE_STEREOSCOPIC_INTERLACED=14,V.RIG_MODE_VR=20,V.RIG_MODE_CUSTOM=22,V.ForceAttachControlToAlwaysPreventDefault=!1,(0,Q.b)([(0,C.L)("position")],V.prototype,"_position",void 0),(0,Q.b)([(0,C.L)("upVector")],V.prototype,"_upVector",void 0),(0,Q.b)([(0,C.O)()],V.prototype,"orthoLeft",null),(0,Q.b)([(0,C.O)()],V.prototype,"orthoRight",null),(0,Q.b)([(0,C.O)()],V.prototype,"orthoBottom",null),(0,Q.b)([(0,C.O)()],V.prototype,"orthoTop",null),(0,Q.b)([(0,C.O)()],V.prototype,"fov",void 0),(0,Q.b)([(0,C.O)()],V.prototype,"projectionPlaneTilt",void 0),(0,Q.b)([(0,C.O)()],V.prototype,"qj",void 0),(0,Q.b)([(0,C.O)()],V.prototype,"maxZ",void 0),(0,Q.b)([(0,C.O)()],V.prototype,"inertia",void 0),(0,Q.b)([(0,C.O)()],V.prototype,"mode",null),(0,Q.b)([(0,C.O)()],V.prototype,"layerMask",void 0),(0,Q.b)([(0,C.O)()],V.prototype,"fovMode",void 0),(0,Q.b)([(0,C.O)()],V.prototype,"cameraRigMode",void 0),(0,Q.b)([(0,C.O)()],V.prototype,"interaxialDistance",void 0),(0,Q.b)([(0,C.O)()],V.prototype,"isStereoscopicSideBySide",void 0)},12671:(D,j,W)=>{"use strict";W.d(j,{e:()=>M,g:()=>O});var Q=W(1083),C=W(1151),k=W(12005),M={};class O{constructor(D){this.attachedToElement=!1,this.attached={},this.camera=D,this.checkInputs=()=>{}}add(D){const j=D.getSimpleName();this.attached[j]?Q.b.Warn("camera input of type "+j+" already exists on camera"):(this.attached[j]=D,D.camera=this.camera,D.checkInputs&&(this.checkInputs=this._addCheckInputs(D.checkInputs.bind(D))),this.attachedToElement&&D.attachControl(this.noPreventDefault))}remove(D){for(const j in this.attached){const W=this.attached[j];if(W===D)return W.le(),W.camera=null,delete this.attached[j],void this.rebuildInputCheck()}}removeByType(D){for(const j in this.attached){const W=this.attached[j];W.getClassName()===D&&(W.le(),W.camera=null,delete this.attached[j],this.rebuildInputCheck())}}_addCheckInputs(D){const j=this.checkInputs;return()=>{j(),D()}}attachInput(D){this.attachedToElement&&D.attachControl(this.noPreventDefault)}attachElement(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){D=!k.d.ForceAttachControlToAlwaysPreventDefault&&D,this.attachedToElement=!0,this.noPreventDefault=D;for(const j in this.attached)this.attached[j].attachControl(D)}}detachElement(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const j in this.attached)this.attached[j].le(),D&&(this.attached[j].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const D in this.attached){const j=this.attached[D];j.checkInputs&&(this.checkInputs=this._addCheckInputs(j.checkInputs.bind(j)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(D){const j={};for(const W in this.attached){const D=this.attached[W],Q=C.d.Serialize(D);j[D.getClassName()]=Q}D.inputsmgr=j}parse(D){const j=D.inputsmgr;if(j){this.clear();for(const D in j){const W=M[D];if(W){const Q=j[D],k=C.d.Parse((()=>new W),Q,null);this.add(k)}}}else for(const W in this.attached){const j=M[this.attached[W].getClassName()];if(j){const Q=C.d.Parse((()=>new j),D,null);this.remove(this.attached[W]),this.add(Q)}}}}},12667:(D,j,W)=>{"use strict";W.d(j,{c:()=>L});var Q=W(942),C=W(948),k=W(966),M=W(12669),O=W(12671),E=W(1291),f=W(1207);class F{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(D){D=f.f.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((j=>{const W=j.event;if(!W.metaKey)if(j.type===E.b.KEYDOWN){if(-1!==this.keysUp.indexOf(W.keyCode)||-1!==this.keysDown.indexOf(W.keyCode)||-1!==this.keysLeft.indexOf(W.keyCode)||-1!==this.keysRight.indexOf(W.keyCode)||-1!==this.keysUpward.indexOf(W.keyCode)||-1!==this.keysDownward.indexOf(W.keyCode)||-1!==this.keysRotateLeft.indexOf(W.keyCode)||-1!==this.keysRotateRight.indexOf(W.keyCode)||-1!==this.keysRotateUp.indexOf(W.keyCode)||-1!==this.keysRotateDown.indexOf(W.keyCode)){-1===this._keys.indexOf(W.keyCode)&&this._keys.push(W.keyCode),D||W.preventDefault()}}else if(-1!==this.keysUp.indexOf(W.keyCode)||-1!==this.keysDown.indexOf(W.keyCode)||-1!==this.keysLeft.indexOf(W.keyCode)||-1!==this.keysRight.indexOf(W.keyCode)||-1!==this.keysUpward.indexOf(W.keyCode)||-1!==this.keysDownward.indexOf(W.keyCode)||-1!==this.keysRotateLeft.indexOf(W.keyCode)||-1!==this.keysRotateRight.indexOf(W.keyCode)||-1!==this.keysRotateUp.indexOf(W.keyCode)||-1!==this.keysRotateDown.indexOf(W.keyCode)){const j=this._keys.indexOf(W.keyCode);j>=0&&this._keys.splice(j,1),D||W.preventDefault()}})))}le(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const D=this.camera;for(let j=0;j<this._keys.length;j++){const W=this._keys[j],Q=D._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(W)?D._localDirection.Id(-Q,0,0):-1!==this.keysUp.indexOf(W)?D._localDirection.Id(0,0,Q):-1!==this.keysRight.indexOf(W)?D._localDirection.Id(Q,0,0):-1!==this.keysDown.indexOf(W)?D._localDirection.Id(0,0,-Q):-1!==this.keysUpward.indexOf(W)?D._localDirection.Id(0,Q,0):-1!==this.keysDownward.indexOf(W)?D._localDirection.Id(0,-Q,0):-1!==this.keysRotateLeft.indexOf(W)?(D._localDirection.Id(0,0,0),D.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(W)?(D._localDirection.Id(0,0,0),D.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(W)?(D._localDirection.Id(0,0,0),D.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(W)&&(D._localDirection.Id(0,0,0),D.cameraRotation.x+=this._getLocalRotation()),D.va().useRightHandedSystem&&(D._localDirection.z*=-1),D.getViewMatrix().invertToRef(D._cameraTransformMatrix),k.j.TransformNormalToRef(D._localDirection,D._cameraTransformMatrix,D._transformedDirection),D.cameraDirection.addInPlace(D._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const D=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*D}}(0,Q.b)([(0,C.O)()],F.prototype,"keysUp",void 0),(0,Q.b)([(0,C.O)()],F.prototype,"keysUpward",void 0),(0,Q.b)([(0,C.O)()],F.prototype,"keysDown",void 0),(0,Q.b)([(0,C.O)()],F.prototype,"keysDownward",void 0),(0,Q.b)([(0,C.O)()],F.prototype,"keysLeft",void 0),(0,Q.b)([(0,C.O)()],F.prototype,"keysRight",void 0),(0,Q.b)([(0,C.O)()],F.prototype,"rotationSpeed",void 0),(0,Q.b)([(0,C.O)()],F.prototype,"keysRotateLeft",void 0),(0,Q.b)([(0,C.O)()],F.prototype,"keysRotateRight",void 0),(0,Q.b)([(0,C.O)()],F.prototype,"keysRotateUp",void 0),(0,Q.b)([(0,C.O)()],F.prototype,"keysRotateDown",void 0),O.e.FreeCameraKeyboardMoveInput=F;var Z=W(961),P=W(1283);class X{constructor(){let D=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=D,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new Z.d,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(D){D=f.f.BackCompatCameraNoPreventDefault(arguments);const j=this.camera.getEngine(),W=j.getInputElement();this._pointerInput||(this._pointerInput=Q=>{const C=Q.event,k="touch"===C.pointerType;if(!this.touchEnabled&&k)return;if(Q.type!==P.d.POINTERMOVE&&-1===this.buttons.indexOf(C.button))return;const M=C.target;if(Q.type===P.d.POINTERDOWN){if(k&&-1!==this._activePointerId||!k&&-1!==this._currentActiveButton)return;this._activePointerId=C.pointerId;try{null===M||void 0===M||M.setPointerCapture(C.pointerId)}catch(O){}-1===this._currentActiveButton&&(this._currentActiveButton=C.button),this._previousPosition={x:C.clientX,y:C.clientY},D||(C.preventDefault(),W&&W.focus()),j.isPointerLock&&this._onMouseMove&&this._onMouseMove(Q.event)}else if(Q.type===P.d.POINTERUP){if(k&&this._activePointerId!==C.pointerId||!k&&this._currentActiveButton!==C.button)return;try{null===M||void 0===M||M.releasePointerCapture(C.pointerId)}catch(O){}this._currentActiveButton=-1,this._previousPosition=null,D||C.preventDefault(),this._activePointerId=-1}else if(Q.type===P.d.POINTERMOVE&&(this._activePointerId===C.pointerId||!k))if(j.isPointerLock&&this._onMouseMove)this._onMouseMove(Q.event);else if(this._previousPosition){const j=this.camera._calculateHandednessMultiplier(),W=(C.clientX-this._previousPosition.x)*j,Q=C.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=W/this.angularSensibility,this.camera.cameraRotation.x+=Q/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:W,offsetY:Q}),this._previousPosition={x:C.clientX,y:C.clientY},D||C.preventDefault()}}),this._onMouseMove=W=>{if(!j.isPointerLock)return;const Q=this.camera._calculateHandednessMultiplier(),C=W.movementX*Q;this.camera.cameraRotation.y+=C/this.angularSensibility;const k=W.movementY;this.camera.cameraRotation.x+=k/this.angularSensibility,this._previousPosition=null,D||W.preventDefault()},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,P.d.POINTERDOWN|P.d.POINTERUP|P.d.POINTERMOVE),W&&(this._contextMenuBind=D=>this.onContextMenu(D),W.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(D){D.preventDefault()}le(){if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const D=this.camera.getEngine().getInputElement();D&&D.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,Q.b)([(0,C.O)()],X.prototype,"buttons",void 0),(0,Q.b)([(0,C.O)()],X.prototype,"angularSensibility",void 0),O.e.FreeCameraMouseInput=X;var x,R=W(1300);class V{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new Z.d,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(D){D=f.f.BackCompatCameraNoPreventDefault(arguments),this._wheel=j=>{if(j.type!==P.d.POINTERWHEEL)return;const W=j.event,Q=W.deltaMode===R.e.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*Q*W.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*Q*W.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*Q*W.deltaZ/this._normalize,W.preventDefault&&(D||W.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,P.d.POINTERWHEEL)}le(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,Q.b)([(0,C.O)()],V.prototype,"wheelPrecisionX",void 0),(0,Q.b)([(0,C.O)()],V.prototype,"wheelPrecisionY",void 0),(0,Q.b)([(0,C.O)()],V.prototype,"wheelPrecisionZ",void 0),function(D){D[D.MoveRelative=0]="MoveRelative",D[D.RotateRelative=1]="RotateRelative",D[D.MoveScene=2]="MoveScene"}(x||(x={}));class U extends V{constructor(){super(...arguments),this._moveRelative=k.j.Zero(),this._rotateRelative=k.j.Zero(),this._moveScene=k.j.Zero(),this._wheelXAction=x.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=x.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(D){null===D&&this._wheelXAction!==x.MoveRelative||(this._wheelXAction=x.MoveRelative,this._wheelXActionCoordinate=D)}get wheelXMoveRelative(){return this._wheelXAction!==x.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(D){null===D&&this._wheelYAction!==x.MoveRelative||(this._wheelYAction=x.MoveRelative,this._wheelYActionCoordinate=D)}get wheelYMoveRelative(){return this._wheelYAction!==x.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(D){null===D&&this._wheelZAction!==x.MoveRelative||(this._wheelZAction=x.MoveRelative,this._wheelZActionCoordinate=D)}get wheelZMoveRelative(){return this._wheelZAction!==x.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(D){null===D&&this._wheelXAction!==x.RotateRelative||(this._wheelXAction=x.RotateRelative,this._wheelXActionCoordinate=D)}get wheelXRotateRelative(){return this._wheelXAction!==x.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(D){null===D&&this._wheelYAction!==x.RotateRelative||(this._wheelYAction=x.RotateRelative,this._wheelYActionCoordinate=D)}get wheelYRotateRelative(){return this._wheelYAction!==x.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(D){null===D&&this._wheelZAction!==x.RotateRelative||(this._wheelZAction=x.RotateRelative,this._wheelZActionCoordinate=D)}get wheelZRotateRelative(){return this._wheelZAction!==x.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(D){null===D&&this._wheelXAction!==x.MoveScene||(this._wheelXAction=x.MoveScene,this._wheelXActionCoordinate=D)}get wheelXMoveScene(){return this._wheelXAction!==x.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(D){null===D&&this._wheelYAction!==x.MoveScene||(this._wheelYAction=x.MoveScene,this._wheelYActionCoordinate=D)}get wheelYMoveScene(){return this._wheelYAction!==x.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(D){null===D&&this._wheelZAction!==x.MoveScene||(this._wheelZAction=x.MoveScene,this._wheelZActionCoordinate=D)}get wheelZMoveScene(){return this._wheelZAction!==x.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.Jd(0),this._rotateRelative.Jd(0),this._moveScene.Jd(0),this._updateCamera(),this.camera.va().useRightHandedSystem&&(this._moveRelative.z*=-1);const D=k.b.Zero();this.camera.getViewMatrix().invertToRef(D);const j=k.j.Zero();k.j.TransformNormalToRef(this._moveRelative,D,j),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(j),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(D,j,W){if(0===D)return;if(null===j||null===W)return;let Q=null;switch(j){case x.MoveRelative:Q=this._moveRelative;break;case x.RotateRelative:Q=this._rotateRelative;break;case x.MoveScene:Q=this._moveScene}switch(W){case 0:Q.set(D,0,0);break;case 1:Q.set(0,D,0);break;case 2:Q.set(0,0,D)}}}(0,Q.b)([(0,C.O)()],U.prototype,"wheelXMoveRelative",null),(0,Q.b)([(0,C.O)()],U.prototype,"wheelYMoveRelative",null),(0,Q.b)([(0,C.O)()],U.prototype,"wheelZMoveRelative",null),(0,Q.b)([(0,C.O)()],U.prototype,"wheelXRotateRelative",null),(0,Q.b)([(0,C.O)()],U.prototype,"wheelYRotateRelative",null),(0,Q.b)([(0,C.O)()],U.prototype,"wheelZRotateRelative",null),(0,Q.b)([(0,C.O)()],U.prototype,"wheelXMoveScene",null),(0,Q.b)([(0,C.O)()],U.prototype,"wheelYMoveScene",null),(0,Q.b)([(0,C.O)()],U.prototype,"wheelZMoveScene",null),O.e.FreeCameraMouseWheelInput=U;class g{constructor(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=D,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=f.f.IsSafari()}attachControl(D){D=f.f.BackCompatCameraNoPreventDefault(arguments);let j=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=W=>{const Q=W.event,C="mouse"===Q.pointerType||this._isSafari&&"undefined"===typeof Q.pointerType;if(this.allowMouse||!C)if(W.type===P.d.POINTERDOWN){if(D||Q.preventDefault(),this._pointerPressed.push(Q.pointerId),1!==this._pointerPressed.length)return;j={x:Q.clientX,y:Q.clientY}}else if(W.type===P.d.POINTERUP){D||Q.preventDefault();const W=this._pointerPressed.indexOf(Q.pointerId);if(-1===W)return;if(this._pointerPressed.splice(W,1),0!=W)return;j=null,this._offsetX=null,this._offsetY=null}else if(W.type===P.d.POINTERMOVE){if(D||Q.preventDefault(),!j)return;if(0!=this._pointerPressed.indexOf(Q.pointerId))return;this._offsetX=Q.clientX-j.x,this._offsetY=-(Q.clientY-j.y)}}),this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,P.d.POINTERDOWN|P.d.POINTERUP|P.d.POINTERMOVE),this._onLostFocus){const D=this.camera.getEngine().getInputElement();D&&D.addEventListener("blur",this._onLostFocus)}}le(){if(this._pointerInput){if(this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const D=this.camera.getEngine().getInputElement();D&&D.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const D=this.camera,j=D._calculateHandednessMultiplier();D.cameraRotation.y=j*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)D.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const j=D._computeLocalCameraSpeed(),W=new k.j(0,0,0!==this.touchMoveSensibility?j*this._offsetY/this.touchMoveSensibility:0);k.b.RotationYawPitchRollToRef(D.rotation.y,D.rotation.x,0,D._cameraRotationMatrix),D.cameraDirection.addInPlace(k.j.TransformCoordinates(W,D._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,Q.b)([(0,C.O)()],g.prototype,"touchAngularSensibility",void 0),(0,Q.b)([(0,C.O)()],g.prototype,"touchMoveSensibility",void 0),O.e.FreeCameraTouchInput=g;class N extends O.g{constructor(D){super(D),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new F),this}addMouse(){let D=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new X(D),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new U,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new g),this}clear(){super.clear(),this._mouseInput=null}}var G=W(981),K=W(1096);class L extends M.e{get angularSensibility(){const D=this.inputs.attached.mouse;return D?D.angularSensibility:0}set angularSensibility(D){const j=this.inputs.attached.mouse;j&&(j.angularSensibility=D)}get keysUp(){const D=this.inputs.attached.keyboard;return D?D.keysUp:[]}set keysUp(D){const j=this.inputs.attached.keyboard;j&&(j.keysUp=D)}get keysUpward(){const D=this.inputs.attached.keyboard;return D?D.keysUpward:[]}set keysUpward(D){const j=this.inputs.attached.keyboard;j&&(j.keysUpward=D)}get keysDown(){const D=this.inputs.attached.keyboard;return D?D.keysDown:[]}set keysDown(D){const j=this.inputs.attached.keyboard;j&&(j.keysDown=D)}get keysDownward(){const D=this.inputs.attached.keyboard;return D?D.keysDownward:[]}set keysDownward(D){const j=this.inputs.attached.keyboard;j&&(j.keysDownward=D)}get keysLeft(){const D=this.inputs.attached.keyboard;return D?D.keysLeft:[]}set keysLeft(D){const j=this.inputs.attached.keyboard;j&&(j.keysLeft=D)}get keysRight(){const D=this.inputs.attached.keyboard;return D?D.keysRight:[]}set keysRight(D){const j=this.inputs.attached.keyboard;j&&(j.keysRight=D)}get keysRotateLeft(){const D=this.inputs.attached.keyboard;return D?D.keysRotateLeft:[]}set keysRotateLeft(D){const j=this.inputs.attached.keyboard;j&&(j.keysRotateLeft=D)}get keysRotateRight(){const D=this.inputs.attached.keyboard;return D?D.keysRotateRight:[]}set keysRotateRight(D){const j=this.inputs.attached.keyboard;j&&(j.keysRotateRight=D)}get keysRotateUp(){const D=this.inputs.attached.keyboard;return D?D.keysRotateUp:[]}set keysRotateUp(D){const j=this.inputs.attached.keyboard;j&&(j.keysRotateUp=D)}get keysRotateDown(){const D=this.inputs.attached.keyboard;return D?D.keysRotateDown:[]}set keysRotateDown(D){const j=this.inputs.attached.keyboard;j&&(j.keysRotateDown=D)}constructor(D,j,W){var Q;super(D,j,W,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),Q=this,this.ellipsoid=new k.j(.5,1,.5),this.ellipsoidOffset=new k.j(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=k.j.Zero(),this._diffPosition=k.j.Zero(),this._newPosition=k.j.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(D,j){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Q._newPosition.p(j),Q._newPosition.subtractToRef(Q._oldPosition,Q._diffPosition),Q._diffPosition.length()>K.e.CollisionsEpsilon&&(Q.position.addToRef(Q._diffPosition,Q._deferredPositionUpdate),Q._deferOnly?Q._deferredUpdated=!0:Q.position.p(Q._deferredPositionUpdate),Q.Uk&&W&&Q.Uk(W))},this.inputs=new N(this),this.inputs.addKeyboard().addMouse()}attachControl(D,j){j=f.f.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(j)}le(){this.inputs.detachElement(),this.cameraDirection=new k.j(0,0,0),this.cameraRotation=new k.f(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(D){this._collisionMask=isNaN(D)?-1:D}_collideWithWorld(D){let j;j=this.parent?k.j.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,j.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const W=this.va().collisionCoordinator;this._collider||(this._collider=W.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let Q=D;this.applyGravity&&(Q=D.add(this.va().gravity)),W.getNewPosition(this._oldPosition,Q,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=k.j.Zero(),this._transformedDirection=k.j.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(D){this._needMoveForGravity=D}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.va().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"fb"}}(0,Q.b)([(0,C.L)()],L.prototype,"ellipsoid",void 0),(0,Q.b)([(0,C.L)()],L.prototype,"ellipsoidOffset",void 0),(0,Q.b)([(0,C.O)()],L.prototype,"checkCollisions",void 0),(0,Q.b)([(0,C.O)()],L.prototype,"applyGravity",void 0),(0,G.c)("BABYLON.FreeCamera",L)},12669:(D,j,W)=>{"use strict";W.d(j,{e:()=>f});var Q=W(942),C=W(948),k=W(12005),M=W(966),O=W(971),E=W(1510);W(12011).e.AddNodeConstructor("TargetCamera",((D,j)=>()=>new f(D,M.j.Zero(),j)));class f extends k.d{constructor(D,j,W){super(D,j,W,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),this._tmpUpVector=M.j.Zero(),this._tmpTargetVector=M.j.Zero(),this.cameraDirection=new M.j(0,0,0),this.cameraRotation=new M.f(0,0),this.ignoreParentScaling=!1,this.updateUpVectorFromRotation=!1,this._tmpQuaternion=new M.d,this.rotation=new M.j(0,0,0),this.speed=2,this.noRotationConstraint=!1,this.invertRotation=!1,this.inverseRotationSpeed=.2,this.lockedTarget=null,this._currentTarget=M.j.Zero(),this._initialFocalDistance=1,this._viewMatrix=M.b.Zero(),this._camMatrix=M.b.Zero(),this._cameraTransformMatrix=M.b.Zero(),this._cameraRotationMatrix=M.b.Zero(),this._referencePoint=new M.j(0,0,1),this._transformedReferencePoint=M.j.Zero(),this._deferredPositionUpdate=new M.j,this._deferredRotationQuaternionUpdate=new M.d,this._deferredRotationUpdate=new M.j,this._deferredUpdated=!1,this._deferOnly=!1,this._defaultUp=M.j.Up(),this._cachedRotationZ=0,this._cachedQuaternionRotationZ=0}getFrontPosition(D){this.getWorldMatrix();const j=this.getTarget().Qc(this.position);return j.normalize(),j.scaleInPlace(D),this.globalPosition.add(j)}_getLockedTargetPosition(){if(!this.lockedTarget)return null;if(this.lockedTarget.absolutePosition){const D=this.lockedTarget;D.Ge().getTranslationToRef(D.absolutePosition)}return this.lockedTarget.absolutePosition||this.lockedTarget}storeState(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),super.storeState()}_restoreStateValues(){return!!super._restoreStateValues()&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.Id(0,0,0),this.cameraRotation.Id(0,0),!0)}_initCache(){super._initCache(),this._cache.lockedTarget=new M.j(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new M.j(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new M.d(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}_updateCache(D){D||super._updateCache();const j=this._getLockedTargetPosition();j?this._cache.lockedTarget?this._cache.lockedTarget.p(j):this._cache.lockedTarget=j.clone():this._cache.lockedTarget=null,this._cache.rotation.p(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.p(this.rotationQuaternion)}_isSynchronizedViewMatrix(){if(!super._isSynchronizedViewMatrix())return!1;const D=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(D):!D)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))}_computeLocalCameraSpeed(){const D=this.getEngine();return this.speed*Math.sqrt(D.getDeltaTime()/(100*D.getFps()))}setTarget(D){this.upVector.normalize(),this._initialFocalDistance=D.Qc(this.position).length(),this.position.z===D.z&&(this.position.z+=O.c),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),M.b.LookAtLHToRef(this.position,D,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);const j=D.Qc(this.position);j.x>=0?this.rotation.y=-Math.atan(j.z/j.x)+Math.PI/2:this.rotation.y=-Math.atan(j.z/j.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&M.d.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)}get target(){return this.getTarget()}set target(D){this.setTarget(D)}getTarget(){return this._currentTarget}_decideIfNeedsToMove(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(M.e.Matrix[0]),M.j.TransformNormalToRef(this.cameraDirection,M.e.Matrix[0],M.e.Kd[0]),this._deferredPositionUpdate.addInPlace(M.e.Kd[0]),void(this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate));this._deferredPositionUpdate.addInPlace(this.cameraDirection),this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate)}_checkInputs(){const D=this.invertRotation?-this.inverseRotationSpeed:1,j=this._decideIfNeedsToMove(),W=this.cameraRotation.x||this.cameraRotation.y;if(this._deferredUpdated=!1,this._deferredRotationUpdate.p(this.rotation),this._deferredPositionUpdate.p(this.position),this.rotationQuaternion&&this._deferredRotationQuaternionUpdate.p(this.rotationQuaternion),j&&this._updatePosition(),W){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this._deferredRotationUpdate),this._deferredRotationUpdate.x+=this.cameraRotation.x*D,this._deferredRotationUpdate.y+=this.cameraRotation.y*D,!this.noRotationConstraint){const D=1.570796;this._deferredRotationUpdate.x>D&&(this._deferredRotationUpdate.x=D),this._deferredRotationUpdate.x<-D&&(this._deferredRotationUpdate.x=-D)}if(this._deferOnly?this._deferredUpdated=!0:this.rotation.p(this._deferredRotationUpdate),this.rotationQuaternion){this._deferredRotationUpdate.lengthSquared()&&(M.d.RotationYawPitchRollToRef(this._deferredRotationUpdate.y,this._deferredRotationUpdate.x,this._deferredRotationUpdate.z,this._deferredRotationQuaternionUpdate),this._deferOnly?this._deferredUpdated=!0:this.rotationQuaternion.p(this._deferredRotationQuaternionUpdate))}}j&&(Math.abs(this.cameraDirection.x)<this.speed*O.c&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*O.c&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*O.c&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),W&&(Math.abs(this.cameraRotation.x)<this.speed*O.c&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*O.c&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),super._checkInputs()}_updateCameraRotationMatrix(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):M.b.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)}_rotateUpVectorWithCameraRotationMatrix(){return M.j.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this}_getViewMatrix(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),M.j.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?E.c.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(M.d.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),E.c.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix}_computeViewMatrix(D,j,W){if(this.ignoreParentScaling){if(this.parent){const Q=this.parent.getWorldMatrix();M.j.TransformCoordinatesToRef(D,Q,this._globalPosition),M.j.TransformCoordinatesToRef(j,Q,this._tmpTargetVector),M.j.TransformNormalToRef(W,Q,this._tmpUpVector),this._markSyncedWithParent()}else this._globalPosition.p(D),this._tmpTargetVector.p(j),this._tmpUpVector.p(W);this.va().useRightHandedSystem?M.b.LookAtRHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix):M.b.LookAtLHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix)}else if(this.va().useRightHandedSystem?M.b.LookAtRHToRef(D,j,W,this._viewMatrix):M.b.LookAtLHToRef(D,j,W,this._viewMatrix),this.parent){const D=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(D,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.p(D)}createRigCamera(D,j){if(this.cameraRigMode!==k.d.RIG_MODE_NONE){const j=new f(D,this.position.clone(),this.va());return j.isRigCamera=!0,j.rigParent=this,this.cameraRigMode===k.d.RIG_MODE_VR&&(this.rotationQuaternion||(this.rotationQuaternion=new M.d),j._cameraRigParams={},j.rotationQuaternion=new M.d),j.mode=this.mode,j.orthoLeft=this.orthoLeft,j.orthoRight=this.orthoRight,j.orthoTop=this.orthoTop,j.orthoBottom=this.orthoBottom,j}return null}_updateRigCameras(){const D=this._rigCameras[0],j=this._rigCameras[1];switch(this.Ge(),this.cameraRigMode){case k.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case k.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case k.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case k.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case k.d.RIG_MODE_STEREOSCOPIC_INTERLACED:{const W=this.cameraRigMode===k.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,Q=this.cameraRigMode===k.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*W,D),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*Q,j);break}case k.d.RIG_MODE_VR:D.rotationQuaternion?(D.rotationQuaternion.p(this.rotationQuaternion),j.rotationQuaternion.p(this.rotationQuaternion)):(D.rotation.p(this.rotation),j.rotation.p(this.rotation)),D.position.p(this.position),j.position.p(this.position)}super._updateRigCameras()}_getRigCamPositionAndTarget(D,j){this.getTarget().subtractToRef(this.position,f._TargetFocalPoint),f._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);const W=f._TargetFocalPoint.addInPlace(this.position);M.b.TranslationToRef(-W.x,-W.y,-W.z,f._TargetTransformMatrix),f._TargetTransformMatrix.multiplyToRef(M.b.RotationAxis(j.upVector,D),f._RigCamTransformMatrix),M.b.TranslationToRef(W.x,W.y,W.z,f._TargetTransformMatrix),f._RigCamTransformMatrix.multiplyToRef(f._TargetTransformMatrix,f._RigCamTransformMatrix),M.j.TransformCoordinatesToRef(this.position,f._RigCamTransformMatrix,j.position),j.setTarget(W)}getClassName(){return"TargetCamera"}}f._RigCamTransformMatrix=new M.b,f._TargetTransformMatrix=new M.b,f._TargetFocalPoint=new M.j,(0,Q.b)([(0,C.L)()],f.prototype,"rotation",void 0),(0,Q.b)([(0,C.O)()],f.prototype,"speed",void 0),(0,Q.b)([(0,C.A)("lockedTargetId")],f.prototype,"lockedTarget",void 0)},13121:(D,j,W)=>{"use strict";W.d(j,{c:()=>k});var Q=W(1191),C=W(13129);class k{constructor(D,j){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=W,this.Ni=[],this._maxBlockCapacity=j||64,this._selectionContent=new Q.e(1024),this._creationFunc=D}update(D,j,W){C.e._CreateBlocks(D,j,W,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}Ce(D){for(let j=0;j<this.ei.length;j++){this.ei[j].addEntry(D)}}De(D){for(let j=0;j<this.ei.length;j++){this.ei[j].removeEntry(D)}}select(D,j){this._selectionContent.reset();for(let W=0;W<this.ei.length;W++){this.ei[W].select(D,this._selectionContent,j)}return j?this._selectionContent.concat(this.Ni):this._selectionContent.concatWithNoDuplicate(this.Ni),this._selectionContent}intersects(D,j,W){this._selectionContent.reset();for(let Q=0;Q<this.ei.length;Q++){this.ei[Q].intersects(D,j,this._selectionContent,W)}return W?this._selectionContent.concat(this.Ni):this._selectionContent.concatWithNoDuplicate(this.Ni),this._selectionContent}intersectsRay(D){this._selectionContent.reset();for(let j=0;j<this.ei.length;j++){this.ei[j].intersectsRay(D,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.Ni),this._selectionContent}}k.CreationFuncForMeshes=(D,j)=>{const W=D.getBoundingInfo();!D.isBlocked&&W.boundingBox.intersectsMinMax(j.Ri,j.Si)&&j.entries.push(D)},k.CreationFuncForSubMeshes=(D,j)=>{D.getBoundingInfo().boundingBox.intersectsMinMax(j.Ri,j.Si)&&j.entries.push(D)}},13129:(D,j,W)=>{"use strict";W.d(j,{e:()=>k});var Q=W(966),C=W(1361);class k{constructor(D,j,W,Q,C,k){this.entries=[],this.Ti=new Array,this._capacity=W,this._depth=Q,this._maxDepth=C,this._creationFunc=k,this._minPoint=D,this._maxPoint=j,this.Ti.push(D.clone()),this.Ti.push(j.clone()),this.Ti.push(D.clone()),this.Ti[2].x=j.x,this.Ti.push(D.clone()),this.Ti[3].y=j.y,this.Ti.push(D.clone()),this.Ti[4].z=j.z,this.Ti.push(j.clone()),this.Ti[5].z=D.z,this.Ti.push(j.clone()),this.Ti[6].x=D.x,this.Ti.push(j.clone()),this.Ti[7].y=D.y}get Ne(){return this._capacity}get Ri(){return this._minPoint}get Si(){return this._maxPoint}addEntry(D){if(this.ei)for(let j=0;j<this.ei.length;j++){this.ei[j].addEntry(D)}else this._creationFunc(D,this),this.entries.length>this.Ne&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(D){if(this.ei){for(let j=0;j<this.ei.length;j++){this.ei[j].removeEntry(D)}return}const j=this.entries.indexOf(D);j>-1&&this.entries.splice(j,1)}addEntries(D){for(let j=0;j<D.length;j++){const W=D[j];this.addEntry(W)}}select(D,j,W){if(C.e.IsInFrustum(this.Ti,D)){if(this.ei){for(let Q=0;Q<this.ei.length;Q++){this.ei[Q].select(D,j,W)}return}W?j.concat(this.entries):j.concatWithNoDuplicate(this.entries)}}intersects(D,j,W,Q){if(C.e.IntersectsSphere(this._minPoint,this._maxPoint,D,j)){if(this.ei){for(let C=0;C<this.ei.length;C++){this.ei[C].intersects(D,j,W,Q)}return}Q?W.concat(this.entries):W.concatWithNoDuplicate(this.entries)}}intersectsRay(D,j){if(D.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.ei){for(let W=0;W<this.ei.length;W++){this.ei[W].intersectsRay(D,j)}return}j.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){k._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(D,j,W,C,M,O,E,f){E.ei=new Array;const F=new Q.j((j.x-D.x)/2,(j.y-D.y)/2,(j.z-D.z)/2);for(let Q=0;Q<2;Q++)for(let j=0;j<2;j++)for(let Z=0;Z<2;Z++){const P=D.add(F.multiplyByFloats(Q,j,Z)),X=D.add(F.multiplyByFloats(Q+1,j+1,Z+1)),x=new k(P,X,C,M+1,O,f);x.addEntries(W),E.ei.push(x)}}}},13131:(D,j,W)=>{"use strict";W.d(j,{b:()=>F});var Q=W(1199),C=W(966),k=W(12035),M=W(12180),O=W(1281),E=W(13121),f=W(991);Q.b.prototype.createOrUpdateSelectionOctree=function(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,W=this._getComponent(O.d.NAME_OCTREE);W||(W=new F(this),this.re(W)),this.Li||(this.Li=new E.c(E.c.CreationFuncForMeshes,D,j));const Q=this.getWorldExtends();return this.Li.update(Q.min,Q.max,this.meshes),this.Li},Object.defineProperty(Q.b.prototype,"selectionOctree",{get:function(){return this.Li},enumerable:!0,configurable:!0}),k.c.prototype.createOrUpdateSubmeshesOctree=function(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const W=this.va();let Q=W._getComponent(O.d.NAME_OCTREE);Q||(Q=new F(W),W.re(Q)),this._submeshesOctree||(this._submeshesOctree=new E.c(E.c.CreationFuncForSubMeshes,D,j)),this.Ge(!0);const C=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(C.minimumWorld,C.maximumWorld,this.xe),this._submeshesOctree};class F{constructor(D){this.name=O.d.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new M.d(C.j.Zero(),new C.j(1,1,1)),(D=D||f.b.LastCreatedScene)&&(this.Be=D,this.Be.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.Be.getActiveSubMeshCandidates=D=>this.getActiveSubMeshCandidates(D),this.Be.getCollidingSubMeshCandidates=(D,j)=>this.getCollidingSubMeshCandidates(D,j),this.Be.getIntersectingSubMeshCandidates=(D,j)=>this.getIntersectingSubMeshCandidates(D,j))}register(){this.Be.onMeshRemovedObservable.add((D=>{const j=this.Be.selectionOctree;if(void 0!==j&&null!==j){const W=j.Ni.indexOf(D);-1!==W&&j.Ni.splice(W,1)}})),this.Be.onMeshImportedObservable.add((D=>{const j=this.Be.selectionOctree;void 0!==j&&null!==j&&j.Ce(D)}))}getActiveMeshCandidates(){var D;return(null===(D=this.Be.Li)||void 0===D?void 0:D.select(this.Be.frustumPlanes))||this.Be._getDefaultMeshCandidates()}getActiveSubMeshCandidates(D){if(D._submeshesOctree&&D.useOctreeForRenderingSelection){return D._submeshesOctree.select(this.Be.frustumPlanes)}return this.Be._getDefaultSubMeshCandidates(D)}getIntersectingSubMeshCandidates(D,j){if(D._submeshesOctree&&D.useOctreeForPicking){M.d.TransformToRef(j,D.getWorldMatrix(),this._tempRay);return D._submeshesOctree.intersectsRay(this._tempRay)}return this.Be._getDefaultSubMeshCandidates(D)}getCollidingSubMeshCandidates(D,j){if(D._submeshesOctree&&D.useOctreeForCollisions){const W=j._velocityWorldLength+Math.max(j._radius.x,j._radius.y,j._radius.z);return D._submeshesOctree.intersects(j._basePointWorld,W)}return this.Be._getDefaultSubMeshCandidates(D)}rebuild(){}dispose(){}}},12180:(D,j,W)=>{"use strict";W.d(j,{d:()=>X});var Q=W(1199),C=W(12005),k=W(971),M=W(966),O=W(979),E=W(1355),f=W(1247),F=W(991),Z=W(1308);const P={internalPickerForMesh:void 0};class X{constructor(D,j){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:k.c;this.origin=D,this.direction=j,this.length=W,this.epsilon=Q}clone(){return new X(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(D,j){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const Q=X._TmpVector3[0].Id(D.x-W,D.y-W,D.z-W),C=X._TmpVector3[1].Id(j.x+W,j.y+W,j.z+W);let k,M,O,E,f=0,F=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<Q.x||this.origin.x>C.x)return!1}else if(k=1/this.direction.x,M=(Q.x-this.origin.x)*k,O=(C.x-this.origin.x)*k,O===-1/0&&(O=1/0),M>O&&(E=M,M=O,O=E),f=Math.max(M,f),F=Math.min(O,F),f>F)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<Q.y||this.origin.y>C.y)return!1}else if(k=1/this.direction.y,M=(Q.y-this.origin.y)*k,O=(C.y-this.origin.y)*k,O===-1/0&&(O=1/0),M>O&&(E=M,M=O,O=E),f=Math.max(M,f),F=Math.min(O,F),f>F)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<Q.z||this.origin.z>C.z)return!1}else if(k=1/this.direction.z,M=(Q.z-this.origin.z)*k,O=(C.z-this.origin.z)*k,O===-1/0&&(O=1/0),M>O&&(E=M,M=O,O=E),f=Math.max(M,f),F=Math.min(O,F),f>F)return!1;return!0}intersectsBox(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(D.minimum,D.maximum,j)}intersectsSphere(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const W=D.center.x-this.origin.x,Q=D.center.y-this.origin.y,C=D.center.z-this.origin.z,k=W*W+Q*Q+C*C,M=D.i+j,O=M*M;if(k<=O)return!0;const E=W*this.direction.x+Q*this.direction.y+C*this.direction.z;if(E<0)return!1;return k-E*E<=O}intersectsTriangle(D,j,W){const Q=X._TmpVector3[0],C=X._TmpVector3[1],k=X._TmpVector3[2],O=X._TmpVector3[3],f=X._TmpVector3[4];j.subtractToRef(D,Q),W.subtractToRef(D,C),M.j.CrossToRef(this.direction,C,k);const F=M.j.Dot(Q,k);if(0===F)return null;const Z=1/F;this.origin.subtractToRef(D,O);const P=M.j.Dot(O,k)*Z;if(P<-this.epsilon||P>1+this.epsilon)return null;M.j.CrossToRef(O,Q,f);const x=M.j.Dot(this.direction,f)*Z;if(x<-this.epsilon||P+x>1+this.epsilon)return null;const R=M.j.Dot(C,f)*Z;return R>this.length?null:new E.b(1-P-x,P,R)}intersectsPlane(D){let j;const W=M.j.Dot(D.Md,this.direction);if(Math.abs(W)<9.99999997475243e-7)return null;{const Q=M.j.Dot(D.Md,this.origin);return j=(-D.d-Q)/W,j<0?j<-9.99999997475243e-7?null:0:j}}intersectsAxis(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(D){case"y":{const D=(this.origin.y-j)/this.direction.y;return D>0?null:new M.j(this.origin.x+this.direction.x*-D,j,this.origin.z+this.direction.z*-D)}case"x":{const D=(this.origin.x-j)/this.direction.x;return D>0?null:new M.j(j,this.origin.y+this.direction.y*-D,this.origin.z+this.direction.z*-D)}case"z":{const D=(this.origin.z-j)/this.direction.z;return D>0?null:new M.j(this.origin.x+this.direction.x*-D,this.origin.y+this.direction.y*-D,j)}default:return null}}intersectsMesh(D,j,W){let Q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],C=arguments.length>4?arguments[4]:void 0,k=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const O=M.e.Matrix[0];return D.getWorldMatrix().invertToRef(O),this._tmpRay?X.TransformToRef(this,O,this._tmpRay):this._tmpRay=X.Transform(this,O),D.intersects(this._tmpRay,j,W,Q,C,k)}intersectsMeshes(D,j,W){W?W.length=0:W=[];for(let Q=0;Q<D.length;Q++){const C=this.intersectsMesh(D[Q],j);C.hit&&W.push(C)}return W.sort(this._comparePickingInfo),W}_comparePickingInfo(D,j){return D.distance<j.distance?-1:D.distance>j.distance?1:0}intersectionSegment(D,j,W){const Q=this.origin,C=M.e.Kd[0],k=M.e.Kd[1],O=M.e.Kd[2],E=M.e.Kd[3];j.subtractToRef(D,C),this.direction.scaleToRef(X._Rayl,O),Q.addToRef(O,k),D.subtractToRef(Q,E);const f=M.j.Dot(C,C),F=M.j.Dot(C,O),Z=M.j.Dot(O,O),P=M.j.Dot(C,E),x=M.j.Dot(O,E),R=f*Z-F*F;let V,U,g=R,N=R;R<X._Smallnum?(V=0,g=1,U=x,N=Z):(V=F*x-Z*P,U=f*x-F*P,V<0?(V=0,U=x,N=Z):V>g&&(V=g,U=x+F,N=Z)),U<0?(U=0,-P<0?V=0:-P>f?V=g:(V=-P,g=f)):U>N&&(U=N,-P+F<0?V=0:-P+F>f?V=g:(V=-P+F,g=f));const G=Math.abs(V)<X._Smallnum?0:V/g,K=Math.abs(U)<X._Smallnum?0:U/N,L=M.e.Kd[4];O.scaleToRef(K,L);const e=M.e.Kd[5];C.scaleToRef(G,e),e.addInPlace(E);const s=M.e.Kd[6];e.subtractToRef(L,s);return K>0&&K<=this.length&&s.lengthSquared()<W*W?e.length():-1}update(D,j,W,Q,C,k,O){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){X._RayDistant||(X._RayDistant=X.Zero()),X._RayDistant.unprojectRayToRef(D,j,W,Q,M.b.IdentityReadOnly,k,O);const E=M.e.Matrix[0];C.invertToRef(E),X.TransformToRef(X._RayDistant,E,this)}else this.unprojectRayToRef(D,j,W,Q,C,k,O);return this}static Zero(){return new X(M.j.Zero(),M.j.Zero())}static CreateNew(D,j,W,Q,C,k,M){return X.Zero().update(D,j,W,Q,C,k,M)}static CreateNewFromTo(D,j){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:M.b.IdentityReadOnly;const Q=new X(new M.j(0,0,0),new M.j(0,0,0));return X.CreateFromToToRef(D,j,Q,W)}static CreateFromToToRef(D,j,W){let Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:M.b.IdentityReadOnly;W.origin.p(D);const C=j.subtractToRef(D,W.direction),k=Math.sqrt(C.x*C.x+C.y*C.y+C.z*C.z);return W.length=k,W.direction.normalize(),X.TransformToRef(W,Q,W)}static Transform(D,j){const W=new X(new M.j(0,0,0),new M.j(0,0,0));return X.TransformToRef(D,j,W),W}static TransformToRef(D,j,W){M.j.TransformCoordinatesToRef(D.origin,j,W.origin),M.j.TransformNormalToRef(D.direction,j,W.direction),W.length=D.length,W.epsilon=D.epsilon;const Q=W.direction,C=Q.length();if(0!==C&&1!==C){const D=1/C;Q.x*=D,Q.y*=D,Q.z*=D,W.length*=C}return W}unprojectRayToRef(D,j,W,Q,C,k,O){const E=M.e.Matrix[0];C.multiplyToRef(k,E),E.multiplyToRef(O,E),E.invert();const f=F.b.LastCreatedEngine,Z=M.e.Kd[0];Z.x=D/W*2-1,Z.y=-(j/Q*2-1),Z.z=null!==f&&void 0!==f&&f.useReverseDepthBuffer?1:null!==f&&void 0!==f&&f.isNDCHalfZRange?0:-1;const P=M.e.Kd[1].Id(Z.x,Z.y,1-1e-8),X=M.e.Kd[2],x=M.e.Kd[3];M.j._UnprojectFromInvertedMatrixToRef(Z,E,X),M.j._UnprojectFromInvertedMatrixToRef(P,E,x),this.origin.p(X),x.subtractToRef(X,this.direction),this.direction.normalize()}}function x(D,j,W,Q,C){let k=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const M=X.Zero();return R(D,j,W,Q,M,C,k),M}function R(D,j,W,Q,C,k){let O=arguments.length>6&&void 0!==arguments[6]&&arguments[6],E=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const f=D.getEngine();if(!k&&!(k=D.activeCamera))return D;const F=k.viewport,Z=f.getRenderHeight(),{x:P,y:X,width:x,height:R}=F.toGlobal(f.getRenderWidth(),Z),V=1/f.getHardwareScalingLevel();return j=j*V-P,W=W*V-(Z-X-R),C.update(j,W,x,R,Q||M.b.IdentityReadOnly,O?M.b.IdentityReadOnly:k.getViewMatrix(),k.getProjectionMatrix(),E),D}function V(D,j,W,Q,C){if(!f.c)return D;const k=D.getEngine();if(!C&&!(C=D.activeCamera))throw new Error("Active camera not set");const O=C.viewport,E=k.getRenderHeight(),{x:F,y:Z,width:P,height:X}=O.toGlobal(k.getRenderWidth(),E),x=M.b.Identity(),R=1/k.getHardwareScalingLevel();return j=j*R-F,W=W*R-(E-Z-X),Q.update(j,W,P,X,x,x,C.getProjectionMatrix()),D}function U(D,j,W,Q,C,k,M,O){const E=j(Q,W.enableDistantPicking),f=W.intersects(E,C,M,k,Q,O);return f&&f.hit?!C&&null!=D&&f.distance>=D.distance?null:f:null}function g(D,j,W,Q,C,k){let O=null;const E=!!(D.activeCameras&&D.activeCameras.length>1&&D.cameraToUseForPointers!==D.activeCamera),F=D.cameraToUseForPointers||D.activeCamera,Z=P.internalPickerForMesh||U;for(let f=0;f<D.meshes.length;f++){const P=D.meshes[f];if(W){if(!W(P,-1))continue}else if(!P.isEnabled()||!P.isVisible||!P.he)continue;const X=E&&P.isWorldMatrixCameraDependent(),x=P.Ge(X,F);if(P.hasThinInstances&&P.thinInstanceEnablePicking){const D=Z(O,j,P,x,!0,!0,k);if(D){if(C)return D;const E=M.e.Matrix[1],f=P.thinInstanceGetWorldMatrices();for(let D=0;D<f.length;D++){if(W&&!W(P,D))continue;f[D].multiplyToRef(x,E);const M=Z(O,j,P,E,Q,C,k,!0);if(M&&(O=M,O.thinInstanceIndex=D,Q))return O}}}else{const D=Z(O,j,P,x,Q,C,k);if(D&&(O=D,Q))return O}}return O||new f.c}function N(D,j,W,Q){if(!f.c)return null;const C=[],k=!!(D.activeCameras&&D.activeCameras.length>1&&D.cameraToUseForPointers!==D.activeCamera),O=D.cameraToUseForPointers||D.activeCamera,E=P.internalPickerForMesh||U;for(let f=0;f<D.meshes.length;f++){const F=D.meshes[f];if(W){if(!W(F,-1))continue}else if(!F.isEnabled()||!F.isVisible||!F.he)continue;const Z=k&&F.isWorldMatrixCameraDependent(),P=F.Ge(Z,O);if(F.hasThinInstances&&F.thinInstanceEnablePicking){if(E(null,j,F,P,!0,!0,Q)){const D=M.e.Matrix[1],k=F.thinInstanceGetWorldMatrices();for(let M=0;M<k.length;M++){if(W&&!W(F,M))continue;k[M].multiplyToRef(P,D);const O=E(null,j,F,D,!1,!1,Q,!0);O&&(O.thinInstanceIndex=M,C.push(O))}}}else{const D=E(null,j,F,P,!1,!1,Q);D&&C.push(D)}}return C}function G(D,j){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,Q=arguments.length>3?arguments[3]:void 0,C=arguments.length>4?arguments[4]:void 0;Q||(Q=D.getWorldMatrix()),j.length=W,C?j.origin.p(C):j.origin.p(D.position);const k=M.e.Kd[2];k.set(0,0,D._scene.useRightHandedSystem?-1:1);const O=M.e.Kd[3];return M.j.TransformNormalToRef(k,Q,O),M.j.NormalizeToRef(O,j.direction),j}var K,L;X._TmpVector3=(0,O.b)(6,M.j.Zero),X._RayDistant=X.Zero(),X._Smallnum=1e-8,X._Rayl=1e9,K=Q.b,(L=C.d)&&(L.prototype.getForwardRay=function(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,j=arguments.length>1?arguments[1]:void 0,W=arguments.length>2?arguments[2]:void 0;return G(this,new X(M.j.Zero(),M.j.Zero(),D),D,j,W)},L.prototype.getForwardRayToRef=function(D){return G(this,D,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),K&&(Z.c._IsPickingAvailable=!0,K.prototype.createPickingRay=function(D,j,W,Q){return x(this,D,j,W,Q,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),Q.b.prototype.createPickingRayToRef=function(D,j,W,Q,C){return R(this,D,j,W,Q,C,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},Q.b.prototype.createPickingRayInCameraSpace=function(D,j,W){return function(D,j,W,Q){const C=X.Zero();return V(D,j,W,C,Q),C}(this,D,j,W)},Q.b.prototype.createPickingRayInCameraSpaceToRef=function(D,j,W,Q){return V(this,D,j,W,Q)},Q.b.prototype.pickWithBoundingInfo=function(D,j,W,Q,C){return function(D,j,W,Q,C,k){if(!f.c)return null;const O=g(D,(Q=>(D._tempPickingRay||(D._tempPickingRay=X.Zero()),R(D,j,W,Q,D._tempPickingRay,k||null),D._tempPickingRay)),Q,C,!0);return O&&(O.ray=x(D,j,W,M.b.Identity(),k||null)),O}(this,D,j,W,Q,C)},Q.b.prototype.fe=function(D,j,W,Q,C,k){return function(D,j,W,Q,C,k,O){const E=g(D,((Q,C)=>(D._tempPickingRay||(D._tempPickingRay=X.Zero()),R(D,j,W,Q,D._tempPickingRay,k||null,!1,C),D._tempPickingRay)),Q,C,!1,O);return E&&(E.ray=x(D,j,W,M.b.Identity(),k||null)),E}(this,D,j,W,Q,C,k)},Q.b.prototype.pickWithRay=function(D,j,W,Q){return function(D,j,W,Q,C){const k=g(D,(W=>(D._pickWithRayInverseMatrix||(D._pickWithRayInverseMatrix=M.b.Identity()),W.invertToRef(D._pickWithRayInverseMatrix),D._cachedRayForTransform||(D._cachedRayForTransform=X.Zero()),X.TransformToRef(j,D._pickWithRayInverseMatrix,D._cachedRayForTransform),D._cachedRayForTransform)),W,Q,!1,C);return k&&(k.ray=j),k}(this,D,j,W,Q)},Q.b.prototype.multiPick=function(D,j,W,Q,C){return function(D,j,W,Q,C,k){return N(D,(Q=>x(D,j,W,Q,C||null)),Q,k)}(this,D,j,W,Q,C)},Q.b.prototype.multiPickWithRay=function(D,j,W){return function(D,j,W,Q){return N(D,(W=>(D._pickWithRayInverseMatrix||(D._pickWithRayInverseMatrix=M.b.Identity()),W.invertToRef(D._pickWithRayInverseMatrix),D._cachedRayForTransform||(D._cachedRayForTransform=X.Zero()),X.TransformToRef(j,D._pickWithRayInverseMatrix,D._cachedRayForTransform),D._cachedRayForTransform)),W,Q)}(this,D,j,W)}},13139:(D,j,W)=>{"use strict";W(1083);var Q=W(1444);W(1129),W(1263),W(985),W(1491),W(1450);Q.e},11859:(D,j,W)=>{"use strict";W.r(j),W.d(j,{SceneInstrumentation:()=>k});var Q=W(1207),C=W(1316);class k{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(D){D!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=D,D?(this._onBeforeActiveMeshesEvaluationObserver=this.Be.onBeforeActiveMeshesEvaluationObservable.add((()=>{Q.f.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.Be.onAfterActiveMeshesEvaluationObservable.add((()=>{Q.f.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.Be.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Be.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(D){D!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=D,D?(this._onBeforeRenderTargetsRenderObserver=this.Be.onBeforeRenderTargetsRenderObservable.add((()=>{Q.f.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.Be.onAfterRenderTargetsRenderObservable.add((()=>{Q.f.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.Be.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Be.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(D){D!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=D,D?(this._onBeforeParticlesRenderingObserver=this.Be.onBeforeParticlesRenderingObservable.add((()=>{Q.f.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.Be.onAfterParticlesRenderingObservable.add((()=>{Q.f.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.Be.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Be.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(D){D!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=D,this.Be.spriteManagers&&(D?(this._onBeforeSpritesRenderingObserver=this.Be.onBeforeSpritesRenderingObservable.add((()=>{Q.f.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.Be.onAfterSpritesRenderingObservable.add((()=>{Q.f.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.Be.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.Be.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(D){D!==this._capturePhysicsTime&&this.Be.onBeforePhysicsObservable&&(this._capturePhysicsTime=D,D?(this._onBeforePhysicsObserver=this.Be.onBeforePhysicsObservable.add((()=>{Q.f.StartPerformanceCounter("gb"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.Be.onAfterPhysicsObservable.add((()=>{Q.f.EndPerformanceCounter("gb"),this._physicsTime.endMonitoring()}))):(this.Be.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.Be.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(D){D!==this._captureAnimationsTime&&(this._captureAnimationsTime=D,D?this._onAfterAnimationsObserver=this.Be.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.Be.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(D){this._captureFrameTime=D}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(D){this._captureInterFrameTime=D}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(D){D!==this._captureRenderTime&&(this._captureRenderTime=D,D?(this._onBeforeDrawPhaseObserver=this.Be.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),Q.f.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.Be.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),Q.f.EndPerformanceCounter("Main render")}))):(this.Be.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Be.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(D){D!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=D,D?(this._onBeforeCameraRenderObserver=this.Be.onBeforeCameraRenderObservable.add((D=>{this._cameraRenderTime.beginMonitoring(),Q.f.StartPerformanceCounter(`Rendering camera ${D.name}`)})),this._onAfterCameraRenderObserver=this.Be.onAfterCameraRenderObservable.add((D=>{this._cameraRenderTime.endMonitoring(!1),Q.f.EndPerformanceCounter(`Rendering camera ${D.name}`)}))):(this.Be.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Be.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.Be.getEngine()._drawCalls}constructor(D){this.Be=D,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new C.b,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new C.b,this._captureFrameTime=!1,this._frameTime=new C.b,this._captureRenderTime=!1,this._renderTime=new C.b,this._captureInterFrameTime=!1,this._interFrameTime=new C.b,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new C.b,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new C.b,this._capturePhysicsTime=!1,this._physicsTime=new C.b,this._captureAnimationsTime=!1,this._animationsTime=new C.b,this._captureCameraRenderTime=!1,this._cameraRenderTime=new C.b,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._onBeforeAnimationsObserver=D.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(Q.f.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.Be.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=D.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(Q.f.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.Vd(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.Vd(),this._captureParticlesRenderTime&&this._particlesRenderTime.Vd(),this._captureSpritesRenderTime&&this._spritesRenderTime.Vd(),this._captureRenderTime&&this._renderTime.Vd(),this._captureCameraRenderTime&&this._cameraRenderTime.Vd()}))}dispose(){this.Be.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.Be.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Be.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.Be.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Be.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.Be.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.Be.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Be.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.Be.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.Be.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.Be.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Be.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.Be.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.Be.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.Be.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.Be.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Be.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.Be=null}}},12754:(D,j,W)=>{"use strict";W.d(j,{e:()=>F});var Q=W(942),C=W(948),k=W(966),M=W(12011),O=W(12716),E=W(12758),f=W(981);M.e.AddNodeConstructor("Light_Type_1",((D,j)=>()=>new F(D,k.j.Zero(),j)));class F extends E.b{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(D){this._shadowFrustumSize=D,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(D){this._shadowOrthoScale=D,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(D){this._orthoLeft=D}get orthoRight(){return this._orthoRight}set orthoRight(D){this._orthoRight=D}get orthoTop(){return this._orthoTop}set orthoTop(D){this._orthoTop=D}get orthoBottom(){return this._orthoBottom}set orthoBottom(D){this._orthoBottom=D}constructor(D,j,W){super(D,W),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=j.scale(-1),this.direction=j}getClassName(){return"hb"}getTypeID(){return O.d.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(D,j,W){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(D):this._setDefaultAutoExtendShadowProjectionMatrix(D,j,W)}_setDefaultFixedFrustumShadowProjectionMatrix(D){const j=this.va().activeCamera;j&&k.b.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:j.qj,void 0!==this.shadowMaxZ?this.shadowMaxZ:j.maxZ,D,this.va().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(D,j,W){const Q=this.va().activeCamera;if(!Q)return;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const D=k.j.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let Q=Number.MAX_VALUE,C=-Number.MAX_VALUE;for(let M=0;M<W.length;M++){const O=W[M];if(!O)continue;const E=O.getBoundingInfo().boundingBox;for(let W=0;W<E.vectorsWorld.length;W++)k.j.TransformCoordinatesToRef(E.vectorsWorld[W],j,D),D.x<this._orthoLeft&&(this._orthoLeft=D.x),D.y<this._orthoBottom&&(this._orthoBottom=D.y),D.x>this._orthoRight&&(this._orthoRight=D.x),D.y>this._orthoTop&&(this._orthoTop=D.y),this.autoCalcShadowZBounds&&(D.z<Q&&(Q=D.z),D.z>C&&(C=D.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=Q,this._shadowMaxZ=C)}const C=this._orthoRight-this._orthoLeft,M=this._orthoTop-this._orthoBottom,O=void 0!==this.shadowMinZ?this.shadowMinZ:Q.qj,E=void 0!==this.shadowMaxZ?this.shadowMaxZ:Q.maxZ,f=this.va().getEngine().useReverseDepthBuffer;k.b.OrthoOffCenterLHToRef(this._orthoLeft-C*this.shadowOrthoScale,this._orthoRight+C*this.shadowOrthoScale,this._orthoBottom-M*this.shadowOrthoScale,this._orthoTop+M*this.shadowOrthoScale,f?E:O,f?O:E,D,this.va().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(D,j){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,j),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,j),this)}transferToNodeMaterialEffect(D,j){return this.computeTransformedInformation()?(D.setFloat3(j,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(D.setFloat3(j,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(D){const j=this._scene.getEngine();return!j.useReverseDepthBuffer&&j.isNDCHalfZRange?0:1}getDepthMaxZ(D){const j=this._scene.getEngine();return j.useReverseDepthBuffer&&j.isNDCHalfZRange?0:1}prepareLightSpecificDefines(D,j){D["DIRLIGHT"+j]=!0}}(0,Q.b)([(0,C.O)()],F.prototype,"shadowFrustumSize",null),(0,Q.b)([(0,C.O)()],F.prototype,"shadowOrthoScale",null),(0,Q.b)([(0,C.O)()],F.prototype,"autoUpdateExtends",void 0),(0,Q.b)([(0,C.O)()],F.prototype,"autoCalcShadowZBounds",void 0),(0,Q.b)([(0,C.O)("orthoLeft")],F.prototype,"_orthoLeft",void 0),(0,Q.b)([(0,C.O)("orthoRight")],F.prototype,"_orthoRight",void 0),(0,Q.b)([(0,C.O)("orthoTop")],F.prototype,"_orthoTop",void 0),(0,Q.b)([(0,C.O)("orthoBottom")],F.prototype,"_orthoBottom",void 0),(0,f.c)("BABYLON.DirectionalLight",F)},13053:(D,j,W)=>{"use strict";W.d(j,{e:()=>F});var Q=W(942),C=W(948),k=W(966),M=W(1163),O=W(12011),E=W(12716),f=W(981);O.e.AddNodeConstructor("Light_Type_3",((D,j)=>()=>new F(D,k.j.Zero(),j)));class F extends E.d{constructor(D,j,W){super(D,W),this.groundColor=new M.d(0,0,0),this.direction=j||k.j.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"ib"}setDirectionToTarget(D){return this.direction=k.j.Normalize(D.Qc(k.j.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(D,j){const W=k.j.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",W.x,W.y,W.z,0,j),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.uj),j),this}transferToNodeMaterialEffect(D,j){const W=k.j.Normalize(this.direction);return D.setFloat3(j,W.x,W.y,W.z),this}Ge(){return this._worldMatrix||(this._worldMatrix=k.b.Identity()),this._worldMatrix}getTypeID(){return E.d.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(D,j){D["HEMILIGHT"+j]=!0}}(0,Q.b)([(0,C.n)()],F.prototype,"groundColor",void 0),(0,Q.b)([(0,C.L)()],F.prototype,"direction",void 0),(0,f.c)("BABYLON.HemisphericLight",F)},12716:(D,j,W)=>{"use strict";W.d(j,{d:()=>P});var Q=W(942),C=W(948),k=W(966),M=W(1163),O=W(12011),E=W(1239),f=W(981),F=W(1337),Z=W(1151);class P extends O.e{get range(){return this._range}set range(D){this._range=D,this._inverseSquaredRange=1/(this.range*this.range)}get intensityMode(){return this._intensityMode}set intensityMode(D){this._intensityMode=D,this._computePhotometricScale()}get i(){return this._radius}set i(D){this._radius=D,this._computePhotometricScale()}get shadowEnabled(){return this._shadowEnabled}set shadowEnabled(D){this._shadowEnabled!==D&&(this._shadowEnabled=D,this._markMeshesAsLightDirty())}get includedOnlyMeshes(){return this._includedOnlyMeshes}set includedOnlyMeshes(D){this._includedOnlyMeshes=D,this._hookArrayForIncludedOnly(D)}get excludedMeshes(){return this._excludedMeshes}set excludedMeshes(D){this._excludedMeshes=D,this._hookArrayForExcluded(D)}get excludeWithLayerMask(){return this._excludeWithLayerMask}set excludeWithLayerMask(D){this._excludeWithLayerMask=D,this._resyncMeshes()}get includeOnlyWithLayerMask(){return this._includeOnlyWithLayerMask}set includeOnlyWithLayerMask(D){this._includeOnlyWithLayerMask=D,this._resyncMeshes()}get lightmapMode(){return this._lightmapMode}set lightmapMode(D){this._lightmapMode!==D&&(this._lightmapMode=D,this._markMeshesAsLightDirty())}getViewMatrix(D){return null}getProjectionMatrix(D,j){return null}constructor(D,j){super(D,j,!1),this.bi=new M.d(1,1,1),this.Xe=new M.d(1,1,1),this.falloffType=P.FALLOFF_DEFAULT,this.uj=1,this._range=Number.MAX_VALUE,this._inverseSquaredRange=0,this._photometricScale=1,this._intensityMode=P.INTENSITYMODE_AUTOMATIC,this._radius=1e-5,this.renderPriority=0,this._shadowEnabled=!0,this._excludeWithLayerMask=0,this._includeOnlyWithLayerMask=0,this._lightmapMode=0,this._shadowGenerators=null,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,this._isLight=!0,this.va().addLight(this),this._uniformBuffer=new E.e(this.va().getEngine(),void 0,void 0,D),this._buildUniformLayout(),this.includedOnlyMeshes=[],this.excludedMeshes=[],this._resyncMeshes()}transferTexturesToEffect(D,j){return this}_bindLight(D,j,W,Q){let C=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const k=D.toString();let O=!1;if(this._uniformBuffer.bindToEffect(W,"Light"+k),this._renderId!==j.getRenderId()||this._lastUseSpecular!==Q||!this._uniformBuffer.useUbo){this._renderId=j.getRenderId(),this._lastUseSpecular=Q;const D=this.getScaledIntensity();this.transferToEffect(W,k),this.bi.scaleToRef(D,M.l.Wd[0]),this._uniformBuffer.updateColor4("vLightDiffuse",M.l.Wd[0],this.range,k),Q&&(this.Xe.scaleToRef(D,M.l.Wd[1]),this._uniformBuffer.updateColor4("vLightSpecular",M.l.Wd[1],this.i,k)),O=!0}if(this.transferTexturesToEffect(W,k),j.shadowsEnabled&&this.shadowEnabled&&C){const D=this.getShadowGenerator(j.activeCamera)??this.getShadowGenerator();D&&(D.bindShadowLight(k,W),O=!0)}O?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()}getClassName(){return"Light"}toString(D){let j="Name: "+this.name;if(j+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(let W=0;W<this.animations.length;W++)j+=", animation[0]: "+this.animations[W].toString(D);return j}_syncParentEnabledState(){super._syncParentEnabledState(),this.u()||this._resyncMeshes()}Kg(D){super.Kg(D),this._resyncMeshes()}getShadowGenerator(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===this._shadowGenerators?null:this._shadowGenerators.get(D)??null}getShadowGenerators(){return this._shadowGenerators}getAbsolutePosition(){return k.j.Zero()}canAffectMesh(D){return!D||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(D))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(D))&&((0===this.includeOnlyWithLayerMask||0!==(this.includeOnlyWithLayerMask&D.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&D.layerMask)))}dispose(D){let j=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._shadowGenerators){const D=this._shadowGenerators.values();for(let j=D.next();!0!==j.done;j=D.next()){j.value.dispose()}this._shadowGenerators=null}if(this.va().stopAnimation(this),this._parentContainer){const D=this._parentContainer.lights.indexOf(this);D>-1&&this._parentContainer.lights.splice(D,1),this._parentContainer=null}for(const W of this.va().meshes)W._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.va().removeLight(this),super.dispose(D,j)}getTypeID(){return 0}getScaledIntensity(){return this._photometricScale*this.uj}clone(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const W=P.GetConstructorFromName(this.getTypeID(),D,this.va());if(!W)return null;const Q=Z.d.Clone(W,this);return D&&(Q.name=D),j&&(Q.parent=j),Q.Kg(this.isEnabled()),this.onClonedObservable.notifyObservers(Q),Q}serialize(){const D=Z.d.Serialize(this);return D.uniqueId=this.uniqueId,D.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(D),this.excludedMeshes.length>0&&(D.excludedMeshesIds=[],this.excludedMeshes.forEach((j=>{D.excludedMeshesIds.push(j.id)}))),this.includedOnlyMeshes.length>0&&(D.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach((j=>{D.includedOnlyMeshesIds.push(j.id)}))),Z.d.AppendSerializedAnimations(this,D),D.ranges=this.serializeAnimationRanges(),D.isEnabled=this.isEnabled(),D}static GetConstructorFromName(D,j,W){const Q=O.e.Construct("Light_Type_"+D,j,W);return Q||null}static Parse(D,j){const W=P.GetConstructorFromName(D.type,D.name,j);if(!W)return null;const Q=Z.d.Parse(W,D,j);if(D.excludedMeshesIds&&(Q._excludedMeshesIds=D.excludedMeshesIds),D.includedOnlyMeshesIds&&(Q._includedOnlyMeshesIds=D.includedOnlyMeshesIds),void 0!==D.parentId&&(Q._waitingParentId=D.parentId),void 0!==D.parentInstanceIndex&&(Q._waitingParentInstanceIndex=D.parentInstanceIndex),void 0!==D.falloffType&&(Q.falloffType=D.falloffType),void 0!==D.lightmapMode&&(Q.lightmapMode=D.lightmapMode),D.animations){for(let j=0;j<D.animations.length;j++){const W=D.animations[j],C=(0,f.b)("BABYLON.Animation");C&&Q.animations.push(C.Parse(W))}O.e.ParseAnimationRanges(Q,D,j)}return D.autoAnimate&&j.beginAnimation(Q,D.autoAnimateFrom,D.autoAnimateTo,D.autoAnimateLoop,D.autoAnimateSpeed||1),void 0!==D.isEnabled&&Q.Kg(D.isEnabled),Q}_hookArrayForExcluded(D){var j=this;const W=D.push;D.push=function(){for(var Q=arguments.length,C=new Array(Q),k=0;k<Q;k++)C[k]=arguments[k];const M=W.apply(D,C);for(const D of C)D._resyncLightSource(j);return M};const Q=D.splice;D.splice=(j,W)=>{const C=Q.apply(D,[j,W]);for(const D of C)D._resyncLightSource(this);return C};for(const C of D)C._resyncLightSource(this)}_hookArrayForIncludedOnly(D){var j=this;const W=D.push;D.push=function(){for(var Q=arguments.length,C=new Array(Q),k=0;k<Q;k++)C[k]=arguments[k];const M=W.apply(D,C);return j._resyncMeshes(),M};const Q=D.splice;D.splice=(j,W)=>{const C=Q.apply(D,[j,W]);return this._resyncMeshes(),C},this._resyncMeshes()}_resyncMeshes(){for(const D of this.va().meshes)D._resyncLightSource(this)}_markMeshesAsLightDirty(){for(const D of this.va().meshes)-1!==D.lightSources.indexOf(this)&&D._markSubMeshesAsLightDirty()}_computePhotometricScale(){this._photometricScale=this._getPhotometricScale(),this.va().resetCachedMaterial()}_getPhotometricScale(){let D=0;const j=this.getTypeID();let W=this.intensityMode;switch(W===P.INTENSITYMODE_AUTOMATIC&&(W=j===P.LIGHTTYPEID_DIRECTIONALLIGHT?P.INTENSITYMODE_ILLUMINANCE:P.INTENSITYMODE_LUMINOUSINTENSITY),j){case P.LIGHTTYPEID_POINTLIGHT:case P.LIGHTTYPEID_SPOTLIGHT:switch(W){case P.INTENSITYMODE_LUMINOUSPOWER:D=1/(4*Math.PI);break;case P.INTENSITYMODE_LUMINOUSINTENSITY:D=1;break;case P.INTENSITYMODE_LUMINANCE:D=this.i*this.i}break;case P.LIGHTTYPEID_DIRECTIONALLIGHT:switch(W){case P.INTENSITYMODE_ILLUMINANCE:D=1;break;case P.INTENSITYMODE_LUMINANCE:{let j=this.i;j=Math.max(j,.001);D=2*Math.PI*(1-Math.cos(j));break}}break;case P.LIGHTTYPEID_HEMISPHERICLIGHT:D=1}return D}_reorderLightsInScene(){const D=this.va();0!=this._renderPriority&&(D.requireLightSorting=!0),this.va().sortLightsByPriority()}}P.FALLOFF_DEFAULT=F.b.FALLOFF_DEFAULT,P.FALLOFF_PHYSICAL=F.b.FALLOFF_PHYSICAL,P.FALLOFF_GLTF=F.b.FALLOFF_GLTF,P.FALLOFF_STANDARD=F.b.FALLOFF_STANDARD,P.LIGHTMAP_DEFAULT=F.b.LIGHTMAP_DEFAULT,P.LIGHTMAP_SPECULAR=F.b.LIGHTMAP_SPECULAR,P.LIGHTMAP_SHADOWSONLY=F.b.LIGHTMAP_SHADOWSONLY,P.INTENSITYMODE_AUTOMATIC=F.b.INTENSITYMODE_AUTOMATIC,P.INTENSITYMODE_LUMINOUSPOWER=F.b.INTENSITYMODE_LUMINOUSPOWER,P.INTENSITYMODE_LUMINOUSINTENSITY=F.b.INTENSITYMODE_LUMINOUSINTENSITY,P.INTENSITYMODE_ILLUMINANCE=F.b.INTENSITYMODE_ILLUMINANCE,P.INTENSITYMODE_LUMINANCE=F.b.INTENSITYMODE_LUMINANCE,P.LIGHTTYPEID_POINTLIGHT=F.b.LIGHTTYPEID_POINTLIGHT,P.LIGHTTYPEID_DIRECTIONALLIGHT=F.b.LIGHTTYPEID_DIRECTIONALLIGHT,P.LIGHTTYPEID_SPOTLIGHT=F.b.LIGHTTYPEID_SPOTLIGHT,P.LIGHTTYPEID_HEMISPHERICLIGHT=F.b.LIGHTTYPEID_HEMISPHERICLIGHT,(0,Q.b)([(0,C.n)()],P.prototype,"diffuse",void 0),(0,Q.b)([(0,C.n)()],P.prototype,"specular",void 0),(0,Q.b)([(0,C.O)()],P.prototype,"falloffType",void 0),(0,Q.b)([(0,C.O)()],P.prototype,"intensity",void 0),(0,Q.b)([(0,C.O)()],P.prototype,"range",null),(0,Q.b)([(0,C.O)()],P.prototype,"intensityMode",null),(0,Q.b)([(0,C.O)()],P.prototype,"i",null),(0,Q.b)([(0,C.O)()],P.prototype,"_renderPriority",void 0),(0,Q.b)([(0,C.e)("_reorderLightsInScene")],P.prototype,"renderPriority",void 0),(0,Q.b)([(0,C.O)("shadowEnabled")],P.prototype,"_shadowEnabled",void 0),(0,Q.b)([(0,C.O)("excludeWithLayerMask")],P.prototype,"_excludeWithLayerMask",void 0),(0,Q.b)([(0,C.O)("includeOnlyWithLayerMask")],P.prototype,"_includeOnlyWithLayerMask",void 0),(0,Q.b)([(0,C.O)("lightmapMode")],P.prototype,"_lightmapMode",void 0)},12758:(D,j,W)=>{"use strict";W.d(j,{b:()=>E});var Q=W(942),C=W(948),k=W(966),M=W(12716),O=W(1510);class E extends M.d{constructor(){super(...arguments),this._needProjectionMatrixCompute=!0,this._viewMatrix=k.b.Identity(),this._projectionMatrix=k.b.Identity()}_setPosition(D){this._position=D}get position(){return this._position}set position(D){this._setPosition(D)}_setDirection(D){this._direction=D}get direction(){return this._direction}set direction(D){this._setDirection(D)}get shadowMinZ(){return this._shadowMinZ}set shadowMinZ(D){this._shadowMinZ=D,this.forceProjectionMatrixCompute()}get shadowMaxZ(){return this._shadowMaxZ}set shadowMaxZ(D){this._shadowMaxZ=D,this.forceProjectionMatrixCompute()}computeTransformedInformation(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=k.j.Zero()),k.j.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=k.j.Zero()),k.j.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)}getDepthScale(){return 50}getShadowDirection(D){return this.transformedDirection?this.transformedDirection:this.direction}getAbsolutePosition(){return this.transformedPosition?this.transformedPosition:this.position}setDirectionToTarget(D){return this.direction=k.j.Normalize(D.Qc(this.position)),this.direction}getRotation(){this.direction.normalize();const D=k.j.Cross(this.direction,O.c.Y),j=k.j.Cross(D,this.direction);return k.j.RotationFromAxis(D,j,this.direction)}needCube(){return!1}needProjectionMatrixCompute(){return this._needProjectionMatrixCompute}forceProjectionMatrixCompute(){this._needProjectionMatrixCompute=!0}_initCache(){super._initCache(),this._cache.position=k.j.Zero()}_isSynchronized(){return!!this._cache.position.equals(this.position)}Ge(D){return!D&&this.isSynchronized()?(this._currentRenderId=this.va().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.p(this.position),this._worldMatrix||(this._worldMatrix=k.b.Identity()),k.b.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)}getDepthMinZ(D){return void 0!==this.shadowMinZ?this.shadowMinZ:D.qj}getDepthMaxZ(D){return void 0!==this.shadowMaxZ?this.shadowMaxZ:D.maxZ}setShadowProjectionMatrix(D,j,W){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(j,W,D):this._setDefaultShadowProjectionMatrix(D,j,W),this}_syncParentEnabledState(){super._syncParentEnabledState(),this.parent&&this.parent.getWorldMatrix||(this.transformedPosition=null,this.transformedDirection=null)}getViewMatrix(D){const j=k.e.Kd[0];let W=this.position;this.computeTransformedInformation()&&(W=this.transformedPosition),k.j.NormalizeToRef(this.getShadowDirection(D),j),1===Math.abs(k.j.Dot(j,k.j.Up()))&&(j.z=1e-13);const Q=k.e.Kd[1];return W.addToRef(j,Q),k.b.LookAtLHToRef(W,Q,k.j.Up(),this._viewMatrix),this._viewMatrix}getProjectionMatrix(D,j){return this.setShadowProjectionMatrix(this._projectionMatrix,D??this._viewMatrix,j??[]),this._projectionMatrix}}(0,Q.b)([(0,C.L)()],E.prototype,"position",null),(0,Q.b)([(0,C.L)()],E.prototype,"direction",null),(0,Q.b)([(0,C.O)()],E.prototype,"shadowMinZ",null),(0,Q.b)([(0,C.O)()],E.prototype,"shadowMaxZ",null)},12167:(D,j,W)=>{"use strict";W.d(j,{e:()=>M,g:()=>k,k:()=>O});const Q={},C={};function k(D,j){Q[D]=j}function M(D,j){C[D]=j}function O(D){return C[D]?C[D]:null}},12102:(D,j,W)=>{"use strict";W.d(j,{b:()=>m,f:()=>L});var Q,C=W(1207),k=W(961),M=W(1199),O=W(991),E=W(1083),f=W(12028),F=W(1019),Z=W(1044),P=W(1013),X=W(1096);!function(D){D[D.Clean=0]="Clean",D[D.Stop=1]="Stop",D[D.Sync=2]="Sync",D[D.NoSync=3]="NoSync"}(Q||(Q={}));const x=new k.d,R={};let V=!1;function U(){return R[".babylon"]}function g(D){const j=R[D];return j||(E.b.Warn("Unable to find a plugin to load "+D+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),U())}function N(D,j,W){let Q="Unable to load from "+(D.rawData?"binary data":D.url);return j?Q+=`: ${j}`:W&&(Q+=`: ${W}`),Q}function G(D,j,W,Q,C,k,M,O,E){var f;const Z="data:"===(P=D.url).substring(0,5)?P.substring(5):null;var P;if(D.rawData&&!M)throw"When using ArrayBufferView to load data the file extension must be provided.";const V=M?g(M):Z?function(D){for(const j in R){const W=R[j].plugin;if(W.canDirectLoad&&W.canDirectLoad(D))return R[j]}return U()}(D.url):function(D){const j=D.indexOf("?");-1!==j&&(D=D.substring(0,j));const W=D.lastIndexOf(".");return g(D.substring(W,D.length).toLowerCase())}(D.url);if(!V)throw new Error(`No plugin or fallback for ${M??D.url}`);if(!1===(null===E||void 0===E||null===(f=E[V.plugin.name])||void 0===f?void 0:f.enabled))throw new Error(`The '${V.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(D.rawData&&!V.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(D=>{if(V.plugin.createPlugin){const j=V.plugin.createPlugin(E??{});return j instanceof Promise?(j.then(D).catch((D=>{C("Error instantiating plugin.",D)})),null):(D(j),j)}return D(V.plugin),V.plugin})((E=>{var f;if(!E)throw`The loader plugin corresponding to the '${M}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(x.notifyObservers(E),Z&&(E.canDirectLoad&&E.canDirectLoad(D.url)||!(0,F.j)(D.url))){if(E.directLoad){const D=E.directLoad(j,Z);D instanceof Promise?D.then((D=>{W(E,D)})).catch((D=>{C("Error in directLoad of _loadData: "+D,D)})):W(E,D)}else W(E,Z);return}const P=V.isBinary,R=(D,Q)=>{j.u?C("Scene has been disposed"):W(E,D,Q)};let U=null,g=!1;null===(f=E.Qd)||void 0===f||f.add((()=>{g=!0,U&&(U.abort(),U=null),k()}));const N=()=>{if(g)return;const W=(D,j)=>{C(null===D||void 0===D?void 0:D.statusText,j)};if(!E.loadFile&&D.rawData)throw"Plugin does not support loading ArrayBufferView.";U=E.loadFile?E.loadFile(j,D.rawData||D.file||D.url,D.rootUrl,R,Q,P,W,O):j._loadFile(D.file||D.url,R,Q,!0,P,W)},G=j.getEngine();let K=G.enableOfflineSupport;if(K){let W=!1;for(const Q of j.disableOfflineSupportExceptionRules)if(Q.test(D.url)){W=!0;break}K=!W}K&&X.e.OfflineProviderFactory?j.offlineProvider=X.e.OfflineProviderFactory(D.url,N,G.disableManifestCheck):N()}))}function K(D,j){let W,Q,k=null,M=null;if(j)if(j.name)W=`file:${j.name}`,Q=j.name,k=j;else if(ArrayBuffer.isView(j))W="",Q=(0,P.c)(),M=j;else if(j.startsWith("data:"))W=j,Q="";else if(D){const k=j;if("/"===k.substring(0,1))return C.f.Error("Wrong sceneFilename parameter"),null;W=D+k,Q=k}else W=j,Q=C.f.GetFilename(j),D=C.f.GetFolderPath(j);else W=D,Q=C.f.GetFilename(D),D=C.f.GetFolderPath(D);return{url:W,rootUrl:D,name:Q,file:k,rawData:M}}function L(D){if("string"===typeof D.extensions){const j=D.extensions;R[j.toLowerCase()]={plugin:D,isBinary:!1}}else{const j=D.extensions;Object.keys(j).forEach((W=>{R[W.toLowerCase()]={plugin:D,isBinary:j[W].isBinary}}))}}function e(D,j){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:O.b.LastCreatedScene,C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,M=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,f=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,F=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",P=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!Q)return E.b.Error("No scene available to import mesh to"),null;const X=K(j,W);if(!X)return null;const x={};Q.addPendingData(x);const R=()=>{Q.removePendingData(x)},V=(D,j)=>{const W=N(X,D,j);M?M(Q,W,new Z.i(W,Z.e.SceneLoaderError,j)):E.b.Error(W),R()},U=k?D=>{try{k(D)}catch(j){V("Error in onProgress callback: "+j,j)}}:void 0,g=(D,j,W,k,M,O,E,f)=>{if(Q.importedMeshesFiles.push(X.url),C)try{C(D,j,W,k,M,O,E,f)}catch(F){V("Error in onSuccess callback: "+F,F)}Q.removePendingData(x)};return G(X,Q,((j,W,C)=>{if(j.rewriteRootURL&&(X.rootUrl=j.rewriteRootURL(X.rootUrl,C)),j.importMesh){const C=[],k=[],M=[];if(!j.importMesh(D,Q,W,X.rootUrl,C,k,M,V))return;Q.loadingPluginName=j.name,g(C,k,M,[],[],[],[],[])}else{j.importMeshAsync(D,Q,W,X.rootUrl,U,X.name).then((D=>{Q.loadingPluginName=j.name,g(D.meshes,D.te,D.skeletons,D.animationGroups,D.transformNodes,D.geometries,D.lights,D.spriteManagers)})).catch((D=>{V(D.message,D)}))}}),U,V,R,f,F,P)}function s(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:O.b.LastCreatedEngine,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,f=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,F=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",Z=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};return W?Y(D,j,new M.b(W),Q,k,E,f,F,Z):(C.f.Error("No engine available"),null)}function b(D,j,W,Q,C,k,M){return new Promise(((O,E)=>{s(D,j,W,(D=>{O(D)}),Q,((D,j,W)=>{E(W||new Error(j))}),C,k,M)}))}function Y(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:O.b.LastCreatedScene,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,M=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,F=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",P=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!W)return E.b.Error("No scene available to append to"),null;const X=K(D,j);if(!X)return null;const x={};W.addPendingData(x);const R=()=>{W.removePendingData(x)};f.c.ShowLoadingScreen&&!V&&(V=!0,W.getEngine().displayLoadingUI(),W.executeWhenReady((()=>{W.getEngine().hideLoadingUI(),V=!1})));const U=(D,j)=>{const Q=N(X,D,j);k?k(W,Q,new Z.i(Q,Z.e.SceneLoaderError,j)):E.b.Error(Q),R()},g=C?D=>{try{C(D)}catch(j){U("Error in onProgress callback",j)}}:void 0,L=()=>{if(Q)try{Q(W)}catch(D){U("Error in onSuccess callback",D)}W.removePendingData(x)};return G(X,W,((D,j)=>{if(D.load){if(!D.load(W,j,X.rootUrl,U))return;W.loadingPluginName=D.name,L()}else{D.loadAsync(W,j,X.rootUrl,g,X.name).then((()=>{W.loadingPluginName=D.name,L()})).catch((D=>{U(D.message,D)}))}}),g,U,R,M,F,P)}function t(D,j,W,Q,C,k,M){return new Promise(((O,E)=>{Y(D,j,W,(D=>{O(D)}),Q,((D,j,W)=>{E(W||new Error(j))}),C,k,M)}))}function c(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:O.b.LastCreatedScene,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,M=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,f=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",F=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!W)return E.b.Error("No scene available to load asset container to"),null;const P=K(D,j);if(!P)return null;const X={};W.addPendingData(X);const x=()=>{W.removePendingData(X)},R=(D,j)=>{const Q=N(P,D,j);k?k(W,Q,new Z.i(Q,Z.e.SceneLoaderError,j)):E.b.Error(Q),x()},V=C?D=>{try{C(D)}catch(j){R("Error in onProgress callback",j)}}:void 0,U=D=>{if(Q)try{Q(D)}catch(j){R("Error in onSuccess callback",j)}W.removePendingData(X)};return G(P,W,((D,j)=>{if(D.loadAssetContainer){const Q=D.loadAssetContainer(W,j,P.rootUrl,R);if(!Q)return;Q.populateRootNodes(),W.loadingPluginName=D.name,U(Q)}else if(D.loadAssetContainerAsync){D.loadAssetContainerAsync(W,j,P.rootUrl,V,P.name).then((j=>{j.populateRootNodes(),W.loadingPluginName=D.name,U(j)})).catch((D=>{R(D.message,D)}))}else R("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),V,R,x,M,f,F)}function l(D,j,W,Q,C,k,M){return new Promise(((O,E)=>{c(D,j,W,(D=>{O(D)}),Q,((D,j,W)=>{E(W||new Error(j))}),C,k,M)}))}function I(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:O.b.LastCreatedScene,Q=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,M=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,f=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,F=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,Z=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,P=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",X=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!W)return void E.b.Error("No scene available to load animations to");if(Q){for(const D of W.animatables)D.reset();W.stopAllAnimations(),W.animationGroups.slice().forEach((D=>{D.dispose()}));W.getNodes().forEach((D=>{D.animations&&(D.animations=[])}))}else switch(C){case 0:W.animationGroups.slice().forEach((D=>{D.dispose()}));break;case 1:W.animationGroups.forEach((D=>{D.stop()}));break;case 2:W.animationGroups.forEach((D=>{D.reset(),D.restart()}));break;case 3:break;default:return void E.b.Error("Unknown animation group loading mode value '"+C+"'")}const x=W.animatables.length;c(D,j,W,(D=>{D.mergeAnimationsTo(W,W.animatables.slice(x),k),D.dispose(),W.onAnimationFileImportedObservable.notifyObservers(W),M&&M(W)}),f,F,Z,P,X)}function y(D,j,W,Q,C,k,M,O,E,f){return new Promise(((F,Z)=>{I(D,j,W,Q,C,k,(D=>{F(D)}),M,((D,j,W)=>{Z(W||new Error(j))}),O,E,f)}))}class m{static get ForceFullSceneLoadingForIncremental(){return f.c.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(D){f.c.ForceFullSceneLoadingForIncremental=D}static get ShowLoadingScreen(){return f.c.ShowLoadingScreen}static set ShowLoadingScreen(D){f.c.ShowLoadingScreen=D}static get loggingLevel(){return f.c.loggingLevel}static set loggingLevel(D){f.c.loggingLevel=D}static get CleanBoneMatrixWeights(){return f.c.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(D){f.c.CleanBoneMatrixWeights=D}static GetDefaultPlugin(){return U()}static GetPluginForExtension(D){var j;return null===(j=g(D))||void 0===j?void 0:j.plugin}static IsPluginForExtensionAvailable(D){return function(D){return!!R[D]}(D)}static RegisterPlugin(D){L(D)}static ImportMesh(D,j,W,Q,C,k,M,O,E){return e(D,j,W,Q,C,k,M,O,E)}static ImportMeshAsync(D,j,W,Q,C,k,M){return function(D,j,W,Q,C,k,M,O){return new Promise(((E,f)=>{e(D,j,W,Q,((D,j,W,Q,C,k,M,O)=>{E({meshes:D,te:j,skeletons:W,animationGroups:Q,transformNodes:C,geometries:k,lights:M,spriteManagers:O})}),C,((D,j,W)=>{f(W||new Error(j))}),k,M,O)}))}(D,j,W,Q,C,k,M)}static Load(D,j,W,Q,C,k,M,O){return s(D,j,W,Q,C,k,M,O)}static LoadAsync(D,j,W,Q,C,k){return b(D,j,W,Q,C,k)}static Append(D,j,W,Q,C,k,M,O){return Y(D,j,W,Q,C,k,M,O)}static AppendAsync(D,j,W,Q,C,k){return t(D,j,W,Q,C,k)}static LoadAssetContainer(D,j,W,Q,C,k,M,O){return c(D,j,W,Q,C,k,M,O)}static LoadAssetContainerAsync(D,j,W,Q,C,k){return l(D,j,W,Q,C,k)}static ImportAnimations(D,j,W,Q,C,k,M,O,E,f,F){I(D,j,W,Q,C,k,M,O,E,f,F)}static ImportAnimationsAsync(D,j,W,Q,C,k,M,O,E,f,F){return y(D,j,W,Q,C,k,O,f,F)}}m.NO_LOGGING=0,m.MINIMAL_LOGGING=1,m.SUMMARY_LOGGING=2,m.DETAILED_LOGGING=3,m.OnPluginActivatedObservable=x},12028:(D,j,W)=>{"use strict";W.d(j,{c:()=>Q});class Q{static get ForceFullSceneLoadingForIncremental(){return Q._ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(D){Q._ForceFullSceneLoadingForIncremental=D}static get ShowLoadingScreen(){return Q._ShowLoadingScreen}static set ShowLoadingScreen(D){Q._ShowLoadingScreen=D}static get loggingLevel(){return Q._LoggingLevel}static set loggingLevel(D){Q._LoggingLevel=D}static get CleanBoneMatrixWeights(){return Q._CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(D){Q._CleanBoneMatrixWeights=D}}Q._ForceFullSceneLoadingForIncremental=!1,Q._ShowLoadingScreen=!0,Q._CleanBoneMatrixWeights=!1,Q._LoggingLevel=0},12698:(D,j,W)=>{"use strict";W.d(j,{d:()=>T});var Q=W(942),C=W(948),k=W(1083),M=W(1191),O=W(12691),E=W(1199),f=W(966),F=W(1256),Z=W(1389),P=W(1424);class X extends Z.d{constructor(){super(...arguments),this.BRDF_V_HEIGHT_CORRELATED=!1,this.MS_BRDF_ENERGY_CONSERVATION=!1,this.SPHERICAL_HARMONICS=!1,this.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1}}class x extends P.d{_markAllSubMeshesAsMiscDirty(){this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(D){let j=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(D,"PBRBRDF",90,new X,j),this._useEnergyConservation=x.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=x.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=x.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=x.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=x.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=x.DEFAULT_USE_SPHERICAL_HARMONICS,this._useSpecularGlossinessInputEnergyConservation=x.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this.useSpecularGlossinessInputEnergyConservation=x.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this._internalMarkAllSubMeshesAsMiscDirty=D._dirtyCallbacks[16],this._enable(!0)}prepareDefines(D){D.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,D.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,D.SPHERICAL_HARMONICS=this._useSphericalHarmonics,D.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation}getClassName(){return"PBRBRDFConfiguration"}}x.DEFAULT_USE_ENERGY_CONSERVATION=!0,x.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,x.DEFAULT_USE_SPHERICAL_HARMONICS=!0,x.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0,(0,Q.b)([(0,C.O)(),(0,C.e)("_markAllSubMeshesAsMiscDirty")],x.prototype,"useEnergyConservation",void 0),(0,Q.b)([(0,C.O)(),(0,C.e)("_markAllSubMeshesAsMiscDirty")],x.prototype,"useSmithVisibilityHeightCorrelated",void 0),(0,Q.b)([(0,C.O)(),(0,C.e)("_markAllSubMeshesAsMiscDirty")],x.prototype,"useSphericalHarmonics",void 0),(0,Q.b)([(0,C.O)(),(0,C.e)("_markAllSubMeshesAsMiscDirty")],x.prototype,"useSpecularGlossinessInputEnergyConservation",void 0);var R=W(1340),V=W(1163),U=W(1217),g=W(1344),N=W(1396),G=W(936),K=W(1400),L=(W(10931),W(1408)),e=W(1382);class s extends Z.d{constructor(){super(...arguments),this.CLEARCOAT=!1,this.CLEARCOAT_DEFAULTIOR=!1,this.CLEARCOAT_TEXTURE=!1,this.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this.CLEARCOAT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,this.CLEARCOAT_BUMP=!1,this.CLEARCOAT_BUMPDIRECTUV=0,this.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,this.CLEARCOAT_REMAP_F0=!1,this.CLEARCOAT_TINT=!1,this.CLEARCOAT_TINT_TEXTURE=!1,this.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TINT_GAMMATEXTURE=!1}}class b extends P.d{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(D){let j=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(D,"PBRClearCoat",100,new s,j),this._isEnabled=!1,this.isEnabled=!1,this.uj=1,this.roughness=0,this._indexOfRefraction=b._DefaultIndexOfRefraction,this.indexOfRefraction=b._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._textureRoughness=null,this.textureRoughness=null,this._remapF0OnInterfaceChange=!0,this.remapF0OnInterfaceChange=!0,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=V.d.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=D._dirtyCallbacks[1]}isReadyForSubMesh(D,j,W){if(!this._isEnabled)return!0;const Q=this._material._disableBumpMap;if(D._areTexturesDirty&&j.texturesEnabled){if(this._texture&&K.e.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&K.e.ClearCoatTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1;if(W.getCaps().standardDerivatives&&this._bumpTexture&&K.e.ClearCoatBumpTextureEnabled&&!Q&&!this._bumpTexture.isReady())return!1;if(this._isTintEnabled&&this._tintTexture&&K.e.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(D,j){this._isEnabled?(D.CLEARCOAT=!0,D.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,D.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange,D._areTexturesDirty&&j.texturesEnabled&&(this._texture&&K.e.ClearCoatTextureEnabled?(0,e.N)(this._texture,D,"CLEARCOAT_TEXTURE"):D.CLEARCOAT_TEXTURE=!1,this._textureRoughness&&K.e.ClearCoatTextureEnabled?(0,e.N)(this._textureRoughness,D,"CLEARCOAT_TEXTURE_ROUGHNESS"):D.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this._bumpTexture&&K.e.ClearCoatBumpTextureEnabled?(0,e.N)(this._bumpTexture,D,"CLEARCOAT_BUMP"):D.CLEARCOAT_BUMP=!1,D.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===b._DefaultIndexOfRefraction,this._isTintEnabled?(D.CLEARCOAT_TINT=!0,this._tintTexture&&K.e.ClearCoatTintTextureEnabled?((0,e.N)(this._tintTexture,D,"CLEARCOAT_TINT_TEXTURE"),D.CLEARCOAT_TINT_GAMMATEXTURE=this._tintTexture.gammaSpace):D.CLEARCOAT_TINT_TEXTURE=!1):(D.CLEARCOAT_TINT=!1,D.CLEARCOAT_TINT_TEXTURE=!1))):(D.CLEARCOAT=!1,D.CLEARCOAT_TEXTURE=!1,D.CLEARCOAT_TEXTURE_ROUGHNESS=!1,D.CLEARCOAT_BUMP=!1,D.CLEARCOAT_TINT=!1,D.CLEARCOAT_TINT_TEXTURE=!1,D.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,D.CLEARCOAT_DEFAULTIOR=!1,D.CLEARCOAT_TEXTUREDIRECTUV=0,D.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,D.CLEARCOAT_BUMPDIRECTUV=0,D.CLEARCOAT_REMAP_F0=!1,D.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,D.CLEARCOAT_TINT_GAMMATEXTURE=!1)}bindForSubMesh(D,j,W,Q){if(!this._isEnabled)return;const C=Q.materialDefines,k=this._material.isFrozen,M=this._material._disableBumpMap,O=this._material._invertNormalMapX,E=this._material._invertNormalMapY;if(!D.useUbo||!k||!D.isSync){var f,F,Z,P;if((this._texture||this._textureRoughness)&&K.e.ClearCoatTextureEnabled)D.updateFloat4("vClearCoatInfos",(null===(f=this._texture)||void 0===f?void 0:f.coordinatesIndex)??0,(null===(F=this._texture)||void 0===F?void 0:F.level)??0,(null===(Z=this._textureRoughness)||void 0===Z?void 0:Z.coordinatesIndex)??0,(null===(P=this._textureRoughness)||void 0===P?void 0:P.level)??0),this._texture&&(0,e.r)(this._texture,D,"clearCoat"),this._textureRoughness&&!C.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,e.r)(this._textureRoughness,D,"clearCoatRoughness");this._bumpTexture&&W.getCaps().standardDerivatives&&K.e.ClearCoatTextureEnabled&&!M&&(D.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),(0,e.r)(this._bumpTexture,D,"clearCoatBump"),j._mirroredCameraPosition?D.updateFloat2("vClearCoatTangentSpaceParams",O?1:-1,E?1:-1):D.updateFloat2("vClearCoatTangentSpaceParams",O?-1:1,E?-1:1)),this._tintTexture&&K.e.ClearCoatTintTextureEnabled&&(D.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),(0,e.r)(this._tintTexture,D,"clearCoatTint")),D.updateFloat2("vClearCoatParams",this.uj,this.roughness);const Q=1-this._indexOfRefraction,k=1+this._indexOfRefraction,X=Math.pow(-Q/k,2),x=1/this._indexOfRefraction;D.updateFloat4("vClearCoatRefractionParams",X,x,Q,k),this._isTintEnabled&&(D.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),D.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}j.texturesEnabled&&(this._texture&&K.e.ClearCoatTextureEnabled&&D.setTexture("clearCoatSampler",this._texture),this._textureRoughness&&!C.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&K.e.ClearCoatTextureEnabled&&D.setTexture("clearCoatRoughnessSampler",this._textureRoughness),this._bumpTexture&&W.getCaps().standardDerivatives&&K.e.ClearCoatBumpTextureEnabled&&!M&&D.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&K.e.ClearCoatTintTextureEnabled&&D.setTexture("clearCoatTintSampler",this._tintTexture))}hasTexture(D){return this._texture===D||(this._textureRoughness===D||(this._bumpTexture===D||this._tintTexture===D))}getActiveTextures(D){this._texture&&D.push(this._texture),this._textureRoughness&&D.push(this._textureRoughness),this._bumpTexture&&D.push(this._bumpTexture),this._tintTexture&&D.push(this._tintTexture)}getAnimatables(D){this._texture&&this._texture.animations&&this._texture.animations.length>0&&D.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&D.push(this._textureRoughness),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&D.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&D.push(this._tintTexture)}dispose(D){var j,W,Q,C;D&&(null===(j=this._texture)||void 0===j||j.dispose(),null===(W=this._textureRoughness)||void 0===W||W.dispose(),null===(Q=this._bumpTexture)||void 0===Q||Q.dispose(),null===(C=this._tintTexture)||void 0===C||C.dispose())}getClassName(){return"PBRClearCoatConfiguration"}addFallbacks(D,j,W){return D.CLEARCOAT_BUMP&&j.addFallback(W++,"CLEARCOAT_BUMP"),D.CLEARCOAT_TINT&&j.addFallback(W++,"CLEARCOAT_TINT"),D.CLEARCOAT&&j.addFallback(W++,"CLEARCOAT"),W}getSamplers(D){D.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler")}getUniforms(){return{ubo:[{name:"vClearCoatParams",size:2,type:"vec2"},{name:"vClearCoatRefractionParams",size:4,type:"vec4"},{name:"vClearCoatInfos",size:4,type:"vec4"},{name:"clearCoatMatrix",size:16,type:"mat4"},{name:"clearCoatRoughnessMatrix",size:16,type:"mat4"},{name:"vClearCoatBumpInfos",size:2,type:"vec2"},{name:"vClearCoatTangentSpaceParams",size:2,type:"vec2"},{name:"clearCoatBumpMatrix",size:16,type:"mat4"},{name:"vClearCoatTintParams",size:4,type:"vec4"},{name:"clearCoatColorAtDistance",size:1,type:"float"},{name:"vClearCoatTintInfos",size:2,type:"vec2"},{name:"clearCoatTintMatrix",size:16,type:"mat4"}]}}}b._DefaultIndexOfRefraction=1.5,(0,Q.b)([(0,C.O)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"isEnabled",void 0),(0,Q.b)([(0,C.O)()],b.prototype,"intensity",void 0),(0,Q.b)([(0,C.O)()],b.prototype,"roughness",void 0),(0,Q.b)([(0,C.O)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"indexOfRefraction",void 0),(0,Q.b)([(0,C.I)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"texture",void 0),(0,Q.b)([(0,C.O)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"useRoughnessFromMainTexture",void 0),(0,Q.b)([(0,C.I)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"textureRoughness",void 0),(0,Q.b)([(0,C.O)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"remapF0OnInterfaceChange",void 0),(0,Q.b)([(0,C.I)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"bumpTexture",void 0),(0,Q.b)([(0,C.O)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"isTintEnabled",void 0),(0,Q.b)([(0,C.n)()],b.prototype,"tintColor",void 0),(0,Q.b)([(0,C.O)()],b.prototype,"tintColorAtDistance",void 0),(0,Q.b)([(0,C.O)()],b.prototype,"tintThickness",void 0),(0,Q.b)([(0,C.I)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"tintTexture",void 0);class Y extends Z.d{constructor(){super(...arguments),this.IRIDESCENCE=!1,this.IRIDESCENCE_TEXTURE=!1,this.IRIDESCENCE_TEXTUREDIRECTUV=0,this.IRIDESCENCE_THICKNESS_TEXTURE=!1,this.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0}}class t extends P.d{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(D){let j=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(D,"PBRIridescence",110,new Y,j),this._isEnabled=!1,this.isEnabled=!1,this.uj=1,this.minimumThickness=t._DefaultMinimumThickness,this.maximumThickness=t._DefaultMaximumThickness,this.indexOfRefraction=t._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._thicknessTexture=null,this.thicknessTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=D._dirtyCallbacks[1]}isReadyForSubMesh(D,j){if(!this._isEnabled)return!0;if(D._areTexturesDirty&&j.texturesEnabled){if(this._texture&&K.e.IridescenceTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._thicknessTexture&&K.e.IridescenceTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(D,j){this._isEnabled?(D.IRIDESCENCE=!0,D._areTexturesDirty&&j.texturesEnabled&&(this._texture&&K.e.IridescenceTextureEnabled?(0,e.N)(this._texture,D,"IRIDESCENCE_TEXTURE"):D.IRIDESCENCE_TEXTURE=!1,this._thicknessTexture&&K.e.IridescenceTextureEnabled?(0,e.N)(this._thicknessTexture,D,"IRIDESCENCE_THICKNESS_TEXTURE"):D.IRIDESCENCE_THICKNESS_TEXTURE=!1)):(D.IRIDESCENCE=!1,D.IRIDESCENCE_TEXTURE=!1,D.IRIDESCENCE_THICKNESS_TEXTURE=!1,D.IRIDESCENCE_TEXTUREDIRECTUV=0,D.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0)}bindForSubMesh(D,j){if(!this._isEnabled)return;const W=this._material.isFrozen;if(!D.useUbo||!W||!D.isSync){var Q,C,k,M;if((this._texture||this._thicknessTexture)&&K.e.IridescenceTextureEnabled)D.updateFloat4("vIridescenceInfos",(null===(Q=this._texture)||void 0===Q?void 0:Q.coordinatesIndex)??0,(null===(C=this._texture)||void 0===C?void 0:C.level)??0,(null===(k=this._thicknessTexture)||void 0===k?void 0:k.coordinatesIndex)??0,(null===(M=this._thicknessTexture)||void 0===M?void 0:M.level)??0),this._texture&&(0,e.r)(this._texture,D,"iridescence"),this._thicknessTexture&&(0,e.r)(this._thicknessTexture,D,"iridescenceThickness");D.updateFloat4("vIridescenceParams",this.uj,this.indexOfRefraction,this.minimumThickness,this.maximumThickness)}j.texturesEnabled&&(this._texture&&K.e.IridescenceTextureEnabled&&D.setTexture("iridescenceSampler",this._texture),this._thicknessTexture&&K.e.IridescenceTextureEnabled&&D.setTexture("iridescenceThicknessSampler",this._thicknessTexture))}hasTexture(D){return this._texture===D||this._thicknessTexture===D}getActiveTextures(D){this._texture&&D.push(this._texture),this._thicknessTexture&&D.push(this._thicknessTexture)}getAnimatables(D){this._texture&&this._texture.animations&&this._texture.animations.length>0&&D.push(this._texture),this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&D.push(this._thicknessTexture)}dispose(D){var j,W;D&&(null===(j=this._texture)||void 0===j||j.dispose(),null===(W=this._thicknessTexture)||void 0===W||W.dispose())}getClassName(){return"PBRIridescenceConfiguration"}addFallbacks(D,j,W){return D.IRIDESCENCE&&j.addFallback(W++,"IRIDESCENCE"),W}getSamplers(D){D.push("iridescenceSampler","iridescenceThicknessSampler")}getUniforms(){return{ubo:[{name:"vIridescenceParams",size:4,type:"vec4"},{name:"vIridescenceInfos",size:4,type:"vec4"},{name:"iridescenceMatrix",size:16,type:"mat4"},{name:"iridescenceThicknessMatrix",size:16,type:"mat4"}]}}}t._DefaultMinimumThickness=100,t._DefaultMaximumThickness=400,t._DefaultIndexOfRefraction=1.3,(0,Q.b)([(0,C.O)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"isEnabled",void 0),(0,Q.b)([(0,C.O)()],t.prototype,"intensity",void 0),(0,Q.b)([(0,C.O)()],t.prototype,"minimumThickness",void 0),(0,Q.b)([(0,C.O)()],t.prototype,"maximumThickness",void 0),(0,Q.b)([(0,C.O)()],t.prototype,"indexOfRefraction",void 0),(0,Q.b)([(0,C.I)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"texture",void 0),(0,Q.b)([(0,C.I)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"thicknessTexture",void 0);class c extends Z.d{constructor(){super(...arguments),this.ANISOTROPIC=!1,this.ANISOTROPIC_TEXTURE=!1,this.ANISOTROPIC_TEXTUREDIRECTUV=0,this.ANISOTROPIC_LEGACY=!1,this.MAINUV1=!1}}class l extends P.d{set angle(D){this.direction.x=Math.cos(D),this.direction.y=Math.sin(D)}get angle(){return Math.atan2(this.direction.y,this.direction.x)}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markAllSubMeshesAsMiscDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(D){let j=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(D,"PBRAnisotropic",110,new c,j),this._isEnabled=!1,this.isEnabled=!1,this.uj=1,this.direction=new f.f(1,0),this._texture=null,this.texture=null,this._legacy=!1,this.legacy=!1,this._internalMarkAllSubMeshesAsTexturesDirty=D._dirtyCallbacks[1],this._internalMarkAllSubMeshesAsMiscDirty=D._dirtyCallbacks[16]}isReadyForSubMesh(D,j){return!this._isEnabled||!(D._areTexturesDirty&&j.texturesEnabled&&this._texture&&K.e.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())}prepareDefinesBeforeAttributes(D,j,W){this._isEnabled?(D.ANISOTROPIC=this._isEnabled,this._isEnabled&&!W.isVerticesDataPresent(F.f.TangentKind)&&(D._needUVs=!0,D.MAINUV1=!0),D._areTexturesDirty&&j.texturesEnabled&&(this._texture&&K.e.AnisotropicTextureEnabled?(0,e.N)(this._texture,D,"ANISOTROPIC_TEXTURE"):D.ANISOTROPIC_TEXTURE=!1),D._areMiscDirty&&(D.ANISOTROPIC_LEGACY=this._legacy)):(D.ANISOTROPIC=!1,D.ANISOTROPIC_TEXTURE=!1,D.ANISOTROPIC_TEXTUREDIRECTUV=0,D.ANISOTROPIC_LEGACY=!1)}bindForSubMesh(D,j){if(!this._isEnabled)return;const W=this._material.isFrozen;D.useUbo&&W&&D.isSync||(this._texture&&K.e.AnisotropicTextureEnabled&&(D.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),(0,e.r)(this._texture,D,"anisotropy")),D.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.uj)),j.texturesEnabled&&this._texture&&K.e.AnisotropicTextureEnabled&&D.setTexture("anisotropySampler",this._texture)}hasTexture(D){return this._texture===D}getActiveTextures(D){this._texture&&D.push(this._texture)}getAnimatables(D){this._texture&&this._texture.animations&&this._texture.animations.length>0&&D.push(this._texture)}dispose(D){D&&this._texture&&this._texture.dispose()}getClassName(){return"PBRAnisotropicConfiguration"}addFallbacks(D,j,W){return D.ANISOTROPIC&&j.addFallback(W++,"ANISOTROPIC"),W}getSamplers(D){D.push("anisotropySampler")}getUniforms(){return{ubo:[{name:"vAnisotropy",size:3,type:"vec3"},{name:"vAnisotropyInfos",size:2,type:"vec2"},{name:"anisotropyMatrix",size:16,type:"mat4"}]}}parse(D,j,W){super.parse(D,j,W),void 0===D.legacy&&(this.legacy=!0)}}(0,Q.b)([(0,C.O)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"isEnabled",void 0),(0,Q.b)([(0,C.O)()],l.prototype,"intensity",void 0),(0,Q.b)([(0,C.J)()],l.prototype,"direction",void 0),(0,Q.b)([(0,C.I)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"texture",void 0),(0,Q.b)([(0,C.O)(),(0,C.e)("_markAllSubMeshesAsMiscDirty")],l.prototype,"legacy",void 0);class I extends Z.d{constructor(){super(...arguments),this.SHEEN=!1,this.SHEEN_TEXTURE=!1,this.SHEEN_GAMMATEXTURE=!1,this.SHEEN_TEXTURE_ROUGHNESS=!1,this.SHEEN_TEXTUREDIRECTUV=0,this.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0,this.SHEEN_LINKWITHALBEDO=!1,this.SHEEN_ROUGHNESS=!1,this.SHEEN_ALBEDOSCALING=!1,this.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1}}class y extends P.d{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(D){let j=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(D,"Sheen",120,new I,j),this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.uj=1,this.color=V.d.White(),this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._roughness=null,this.roughness=null,this._textureRoughness=null,this.textureRoughness=null,this._albedoScaling=!1,this.albedoScaling=!1,this._internalMarkAllSubMeshesAsTexturesDirty=D._dirtyCallbacks[1]}isReadyForSubMesh(D,j){if(!this._isEnabled)return!0;if(D._areTexturesDirty&&j.texturesEnabled){if(this._texture&&K.e.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&K.e.SheenTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(D,j){this._isEnabled?(D.SHEEN=!0,D.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,D.SHEEN_ROUGHNESS=null!==this._roughness,D.SHEEN_ALBEDOSCALING=this._albedoScaling,D.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,D._areTexturesDirty&&j.texturesEnabled&&(this._texture&&K.e.SheenTextureEnabled?((0,e.N)(this._texture,D,"SHEEN_TEXTURE"),D.SHEEN_GAMMATEXTURE=this._texture.gammaSpace):D.SHEEN_TEXTURE=!1,this._textureRoughness&&K.e.SheenTextureEnabled?(0,e.N)(this._textureRoughness,D,"SHEEN_TEXTURE_ROUGHNESS"):D.SHEEN_TEXTURE_ROUGHNESS=!1)):(D.SHEEN=!1,D.SHEEN_TEXTURE=!1,D.SHEEN_TEXTURE_ROUGHNESS=!1,D.SHEEN_LINKWITHALBEDO=!1,D.SHEEN_ROUGHNESS=!1,D.SHEEN_ALBEDOSCALING=!1,D.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,D.SHEEN_GAMMATEXTURE=!1,D.SHEEN_TEXTUREDIRECTUV=0,D.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0)}bindForSubMesh(D,j,W,Q){if(!this._isEnabled)return;const C=Q.materialDefines,k=this._material.isFrozen;if(!D.useUbo||!k||!D.isSync){var M,O,E,f;if((this._texture||this._textureRoughness)&&K.e.SheenTextureEnabled)D.updateFloat4("vSheenInfos",(null===(M=this._texture)||void 0===M?void 0:M.coordinatesIndex)??0,(null===(O=this._texture)||void 0===O?void 0:O.level)??0,(null===(E=this._textureRoughness)||void 0===E?void 0:E.coordinatesIndex)??0,(null===(f=this._textureRoughness)||void 0===f?void 0:f.level)??0),this._texture&&(0,e.r)(this._texture,D,"sheen"),this._textureRoughness&&!C.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,e.r)(this._textureRoughness,D,"sheenRoughness");D.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.uj),null!==this._roughness&&D.updateFloat("vSheenRoughness",this._roughness)}j.texturesEnabled&&(this._texture&&K.e.SheenTextureEnabled&&D.setTexture("sheenSampler",this._texture),this._textureRoughness&&!C.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&K.e.SheenTextureEnabled&&D.setTexture("sheenRoughnessSampler",this._textureRoughness))}hasTexture(D){return this._texture===D||this._textureRoughness===D}getActiveTextures(D){this._texture&&D.push(this._texture),this._textureRoughness&&D.push(this._textureRoughness)}getAnimatables(D){this._texture&&this._texture.animations&&this._texture.animations.length>0&&D.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&D.push(this._textureRoughness)}dispose(D){var j,W;D&&(null===(j=this._texture)||void 0===j||j.dispose(),null===(W=this._textureRoughness)||void 0===W||W.dispose())}getClassName(){return"PBRSheenConfiguration"}addFallbacks(D,j,W){return D.SHEEN&&j.addFallback(W++,"SHEEN"),W}getSamplers(D){D.push("sheenSampler","sheenRoughnessSampler")}getUniforms(){return{ubo:[{name:"vSheenColor",size:4,type:"vec4"},{name:"vSheenRoughness",size:1,type:"float"},{name:"vSheenInfos",size:4,type:"vec4"},{name:"sheenMatrix",size:16,type:"mat4"},{name:"sheenRoughnessMatrix",size:16,type:"mat4"}]}}}(0,Q.b)([(0,C.O)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"isEnabled",void 0),(0,Q.b)([(0,C.O)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"linkSheenWithAlbedo",void 0),(0,Q.b)([(0,C.O)()],y.prototype,"intensity",void 0),(0,Q.b)([(0,C.n)()],y.prototype,"color",void 0),(0,Q.b)([(0,C.I)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"texture",void 0),(0,Q.b)([(0,C.O)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"useRoughnessFromMainTexture",void 0),(0,Q.b)([(0,C.O)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"roughness",void 0),(0,Q.b)([(0,C.I)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"textureRoughness",void 0),(0,Q.b)([(0,C.O)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"albedoScaling",void 0);class m extends Z.d{constructor(){super(...arguments),this.SUBSURFACE=!1,this.SS_REFRACTION=!1,this.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_TRANSLUCENCY=!1,this.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_SCATTERING=!1,this.SS_DISPERSION=!1,this.SS_THICKNESSANDMASK_TEXTURE=!1,this.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,this.SS_HAS_THICKNESS=!1,this.SS_REFRACTIONINTENSITY_TEXTURE=!1,this.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,this.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,this.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,this.SS_REFRACTIONMAP_3D=!1,this.SS_REFRACTIONMAP_OPPOSITEZ=!1,this.SS_LODINREFRACTIONALPHA=!1,this.SS_GAMMAREFRACTION=!1,this.SS_RGBDREFRACTION=!1,this.SS_LINEARSPECULARREFRACTION=!1,this.SS_LINKREFRACTIONTOTRANSPARENCY=!1,this.SS_ALBEDOFORREFRACTIONTINT=!1,this.SS_ALBEDOFORTRANSLUCENCYTINT=!1,this.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.SS_USE_THICKNESS_AS_DEPTH=!1,this.SS_USE_GLTF_TEXTURES=!1}}class a extends P.d{get scatteringDiffusionProfile(){return this._scene.subSurfaceConfiguration?this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex]:null}set scatteringDiffusionProfile(D){this._scene.enableSubSurfaceForPrePass()&&D&&(this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(D))}get volumeIndexOfRefraction(){return this._volumeIndexOfRefraction>=1?this._volumeIndexOfRefraction:this._indexOfRefraction}set volumeIndexOfRefraction(D){this._volumeIndexOfRefraction=D>=1?D:-1}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markScenePrePassDirty(){this._internalMarkAllSubMeshesAsTexturesDirty(),this._internalMarkScenePrePassDirty()}isCompatible(){return!0}constructor(D){let j=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(D,"PBRSubSurface",130,new m,j),this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isDispersionEnabled=!1,this.isDispersionEnabled=!1,this._isScatteringEnabled=!1,this.isScatteringEnabled=!1,this._scatteringDiffusionProfileIndex=0,this.refractionIntensity=1,this.translucencyIntensity=1,this.useAlbedoToTintRefraction=!1,this.useAlbedoToTintTranslucency=!1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1.5,this.indexOfRefraction=1.5,this._volumeIndexOfRefraction=-1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.useThicknessAsDepth=!1,this.tintColor=V.d.White(),this.tintColorAtDistance=1,this.dispersion=0,this.diffusionDistance=V.d.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._refractionIntensityTexture=null,this.refractionIntensityTexture=null,this._translucencyIntensityTexture=null,this.translucencyIntensityTexture=null,this.translucencyColor=null,this._translucencyColorTexture=null,this.translucencyColorTexture=null,this._useGltfStyleTextures=!0,this.useGltfStyleTextures=!0,this._scene=D.va(),this.registerForExtraEvents=!0,this._internalMarkAllSubMeshesAsTexturesDirty=D._dirtyCallbacks[1],this._internalMarkScenePrePassDirty=D._dirtyCallbacks[32]}isReadyForSubMesh(D,j){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return!0;if(D._areTexturesDirty&&j.texturesEnabled){if(this._thicknessTexture&&K.e.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;if(this._translucencyColorTexture&&K.e.TranslucencyColorTextureEnabled&&!this._translucencyColorTexture.isReadyOrNotBlocking())return!1;if(this._translucencyIntensityTexture&&K.e.TranslucencyIntensityTextureEnabled&&!this._translucencyIntensityTexture.isReadyOrNotBlocking())return!1;const D=this._getRefractionTexture(j);if(D&&K.e.RefractionTextureEnabled&&!D.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(D,j){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return D.SUBSURFACE=!1,D.SS_DISPERSION=!1,D.SS_TRANSLUCENCY=!1,D.SS_SCATTERING=!1,D.SS_REFRACTION=!1,D.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,D.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,D.SS_THICKNESSANDMASK_TEXTURE=!1,D.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,D.SS_HAS_THICKNESS=!1,D.SS_REFRACTIONINTENSITY_TEXTURE=!1,D.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,D.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,D.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,D.SS_REFRACTIONMAP_3D=!1,D.SS_REFRACTIONMAP_OPPOSITEZ=!1,D.SS_LODINREFRACTIONALPHA=!1,D.SS_GAMMAREFRACTION=!1,D.SS_RGBDREFRACTION=!1,D.SS_LINEARSPECULARREFRACTION=!1,D.SS_LINKREFRACTIONTOTRANSPARENCY=!1,D.SS_ALBEDOFORREFRACTIONTINT=!1,D.SS_ALBEDOFORTRANSLUCENCYTINT=!1,D.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,D.SS_USE_THICKNESS_AS_DEPTH=!1,D.SS_USE_GLTF_TEXTURES=!1,D.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,void(D.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0);if(D._areTexturesDirty){if(D.SUBSURFACE=!0,D.SS_DISPERSION=this._isDispersionEnabled,D.SS_TRANSLUCENCY=this._isTranslucencyEnabled,D.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,D.SS_SCATTERING=this._isScatteringEnabled,D.SS_THICKNESSANDMASK_TEXTURE=!1,D.SS_REFRACTIONINTENSITY_TEXTURE=!1,D.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,D.SS_HAS_THICKNESS=!1,D.SS_USE_GLTF_TEXTURES=!1,D.SS_REFRACTION=!1,D.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,D.SS_REFRACTIONMAP_3D=!1,D.SS_GAMMAREFRACTION=!1,D.SS_RGBDREFRACTION=!1,D.SS_LINEARSPECULARREFRACTION=!1,D.SS_REFRACTIONMAP_OPPOSITEZ=!1,D.SS_LODINREFRACTIONALPHA=!1,D.SS_LINKREFRACTIONTOTRANSPARENCY=!1,D.SS_ALBEDOFORREFRACTIONTINT=!1,D.SS_ALBEDOFORTRANSLUCENCYTINT=!1,D.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,D.SS_USE_THICKNESS_AS_DEPTH=!1,D.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,D._areTexturesDirty&&j.texturesEnabled&&(this._thicknessTexture&&K.e.ThicknessTextureEnabled&&(0,e.N)(this._thicknessTexture,D,"SS_THICKNESSANDMASK_TEXTURE"),this._refractionIntensityTexture&&K.e.RefractionIntensityTextureEnabled&&(0,e.N)(this._refractionIntensityTexture,D,"SS_REFRACTIONINTENSITY_TEXTURE"),this._translucencyIntensityTexture&&K.e.TranslucencyIntensityTextureEnabled&&(0,e.N)(this._translucencyIntensityTexture,D,"SS_TRANSLUCENCYINTENSITY_TEXTURE"),this._translucencyColorTexture&&K.e.TranslucencyColorTextureEnabled&&(0,e.N)(this._translucencyColorTexture,D,"SS_TRANSLUCENCYCOLOR_TEXTURE")),D.SS_HAS_THICKNESS=this.maximumThickness-this.minimumThickness!==0,D.SS_USE_GLTF_TEXTURES=this._useGltfStyleTextures,D.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._refractionIntensityTexture,D.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._translucencyIntensityTexture,this._isRefractionEnabled&&j.texturesEnabled){const W=this._getRefractionTexture(j);W&&K.e.RefractionTextureEnabled&&(D.SS_REFRACTION=!0,D.SS_REFRACTIONMAP_3D=W.isCube,D.SS_GAMMAREFRACTION=W.gammaSpace,D.SS_RGBDREFRACTION=W.isRGBD,D.SS_LINEARSPECULARREFRACTION=W.linearSpecularLOD,D.SS_REFRACTIONMAP_OPPOSITEZ=this._scene.useRightHandedSystem&&W.isCube?!W.invertZ:W.invertZ,D.SS_LODINREFRACTIONALPHA=W.lodLevelInAlpha,D.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency,D.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction,D.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=W.isCube&&W.boundingBoxSize,D.SS_USE_THICKNESS_AS_DEPTH=this.useThicknessAsDepth)}this._isTranslucencyEnabled&&(D.SS_ALBEDOFORTRANSLUCENCYTINT=this.useAlbedoToTintTranslucency)}}hardBindForSubMesh(D,j,W,Q){if(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled)if(0===this.maximumThickness&&0===this.minimumThickness)D.updateFloat2("vThicknessParam",0,0);else{Q.getRenderingMesh().getWorldMatrix().decompose(f.e.Kd[0]);const j=Math.max(Math.abs(f.e.Kd[0].x),Math.abs(f.e.Kd[0].y),Math.abs(f.e.Kd[0].z));D.updateFloat2("vThicknessParam",this.minimumThickness*j,(this.maximumThickness-this.minimumThickness)*j)}}bindForSubMesh(D,j,W,Q){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return;const C=Q.materialDefines,k=this._material.isFrozen,M=this._material.realTimeFiltering,O=C.LODBASEDMICROSFURACE,E=this._getRefractionTexture(j);if(!D.useUbo||!k||!D.isSync){if(this._thicknessTexture&&K.e.ThicknessTextureEnabled&&(D.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),(0,e.r)(this._thicknessTexture,D,"thickness")),this._refractionIntensityTexture&&K.e.RefractionIntensityTextureEnabled&&C.SS_REFRACTIONINTENSITY_TEXTURE&&(D.updateFloat2("vRefractionIntensityInfos",this._refractionIntensityTexture.coordinatesIndex,this._refractionIntensityTexture.level),(0,e.r)(this._refractionIntensityTexture,D,"refractionIntensity")),this._translucencyColorTexture&&K.e.TranslucencyColorTextureEnabled&&C.SS_TRANSLUCENCYCOLOR_TEXTURE&&(D.updateFloat2("vTranslucencyColorInfos",this._translucencyColorTexture.coordinatesIndex,this._translucencyColorTexture.level),(0,e.r)(this._translucencyColorTexture,D,"translucencyColor")),this._translucencyIntensityTexture&&K.e.TranslucencyIntensityTextureEnabled&&C.SS_TRANSLUCENCYINTENSITY_TEXTURE&&(D.updateFloat2("vTranslucencyIntensityInfos",this._translucencyIntensityTexture.coordinatesIndex,this._translucencyIntensityTexture.level),(0,e.r)(this._translucencyIntensityTexture,D,"translucencyIntensity")),E&&K.e.RefractionTextureEnabled){D.de("refractionMatrix",E.getRefractionTextureMatrix());let j=1;E.isCube||E.depth&&(j=E.depth);const W=E.getSize().width,Q=this.volumeIndexOfRefraction;if(D.updateFloat4("vRefractionInfos",E.level,1/Q,j,this._invertRefractionY?-1:1),D.updateFloat4("vRefractionMicrosurfaceInfos",W,E.lodGenerationScale,E.lodGenerationOffset,1/this.indexOfRefraction),M&&D.updateFloat2("vRefractionFilteringInfo",W,Math.log2(W)),E.boundingBoxSize){const j=E;D.updateVector3("vRefractionPosition",j.boundingBoxPosition),D.updateVector3("vRefractionSize",j.boundingBoxSize)}}this._isScatteringEnabled&&D.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex),D.updateColor3("vDiffusionDistance",this.diffusionDistance),D.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintColorAtDistance)),D.updateColor4("vTranslucencyColor",this.translucencyColor??this.tintColor,0),D.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0),D.updateFloat("dispersion",this.dispersion)}j.texturesEnabled&&(this._thicknessTexture&&K.e.ThicknessTextureEnabled&&D.setTexture("thicknessSampler",this._thicknessTexture),this._refractionIntensityTexture&&K.e.RefractionIntensityTextureEnabled&&C.SS_REFRACTIONINTENSITY_TEXTURE&&D.setTexture("refractionIntensitySampler",this._refractionIntensityTexture),this._translucencyIntensityTexture&&K.e.TranslucencyIntensityTextureEnabled&&C.SS_TRANSLUCENCYINTENSITY_TEXTURE&&D.setTexture("translucencyIntensitySampler",this._translucencyIntensityTexture),this._translucencyColorTexture&&K.e.TranslucencyColorTextureEnabled&&C.SS_TRANSLUCENCYCOLOR_TEXTURE&&D.setTexture("translucencyColorSampler",this._translucencyColorTexture),E&&K.e.RefractionTextureEnabled&&(O?D.setTexture("refractionSampler",E):(D.setTexture("refractionSampler",E._lodTextureMid||E),D.setTexture("refractionSamplerLow",E._lodTextureLow||E),D.setTexture("refractionSamplerHigh",E._lodTextureHigh||E))))}_getRefractionTexture(D){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?D.environmentTexture:null}get disableAlphaBlending(){return this._isRefractionEnabled&&this._linkRefractionWithTransparency}fillRenderTargetTextures(D){K.e.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&D.push(this._refractionTexture)}hasTexture(D){return this._thicknessTexture===D||(this._refractionTexture===D||(this._refractionIntensityTexture===D||(this._translucencyIntensityTexture===D||this._translucencyColorTexture===D)))}hasRenderTargetTextures(){return!!(K.e.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)}getActiveTextures(D){this._thicknessTexture&&D.push(this._thicknessTexture),this._refractionTexture&&D.push(this._refractionTexture),this._translucencyColorTexture&&D.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&D.push(this._translucencyIntensityTexture)}getAnimatables(D){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&D.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&D.push(this._refractionTexture),this._translucencyColorTexture&&this._translucencyColorTexture.animations&&this._translucencyColorTexture.animations.length>0&&D.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.animations&&this._translucencyIntensityTexture.animations.length>0&&D.push(this._translucencyIntensityTexture)}dispose(D){D&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose(),this._translucencyColorTexture&&this._translucencyColorTexture.dispose(),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.dispose())}getClassName(){return"PBRSubSurfaceConfiguration"}addFallbacks(D,j,W){return D.SS_SCATTERING&&j.addFallback(W++,"SS_SCATTERING"),D.SS_TRANSLUCENCY&&j.addFallback(W++,"SS_TRANSLUCENCY"),W}getSamplers(D){D.push("thicknessSampler","refractionIntensitySampler","translucencyIntensitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh","translucencyColorSampler")}getUniforms(){return{ubo:[{name:"vRefractionMicrosurfaceInfos",size:4,type:"vec4"},{name:"vRefractionFilteringInfo",size:2,type:"vec2"},{name:"vTranslucencyIntensityInfos",size:2,type:"vec2"},{name:"vRefractionInfos",size:4,type:"vec4"},{name:"refractionMatrix",size:16,type:"mat4"},{name:"vThicknessInfos",size:2,type:"vec2"},{name:"vRefractionIntensityInfos",size:2,type:"vec2"},{name:"thicknessMatrix",size:16,type:"mat4"},{name:"refractionIntensityMatrix",size:16,type:"mat4"},{name:"translucencyIntensityMatrix",size:16,type:"mat4"},{name:"vThicknessParam",size:2,type:"vec2"},{name:"vDiffusionDistance",size:3,type:"vec3"},{name:"vTintColor",size:4,type:"vec4"},{name:"vSubSurfaceIntensity",size:3,type:"vec3"},{name:"vRefractionPosition",size:3,type:"vec3"},{name:"vRefractionSize",size:3,type:"vec3"},{name:"scatteringDiffusionProfile",size:1,type:"float"},{name:"dispersion",size:1,type:"float"},{name:"vTranslucencyColor",size:4,type:"vec4"},{name:"vTranslucencyColorInfos",size:2,type:"vec2"},{name:"translucencyColorMatrix",size:16,type:"mat4"}]}}}(0,Q.b)([(0,C.O)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"isRefractionEnabled",void 0),(0,Q.b)([(0,C.O)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"isTranslucencyEnabled",void 0),(0,Q.b)([(0,C.O)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"isDispersionEnabled",void 0),(0,Q.b)([(0,C.O)(),(0,C.e)("_markScenePrePassDirty")],a.prototype,"isScatteringEnabled",void 0),(0,Q.b)([(0,C.O)()],a.prototype,"_scatteringDiffusionProfileIndex",void 0),(0,Q.b)([(0,C.O)()],a.prototype,"refractionIntensity",void 0),(0,Q.b)([(0,C.O)()],a.prototype,"translucencyIntensity",void 0),(0,Q.b)([(0,C.O)()],a.prototype,"useAlbedoToTintRefraction",void 0),(0,Q.b)([(0,C.O)()],a.prototype,"useAlbedoToTintTranslucency",void 0),(0,Q.b)([(0,C.I)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"thicknessTexture",void 0),(0,Q.b)([(0,C.I)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"refractionTexture",void 0),(0,Q.b)([(0,C.O)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"indexOfRefraction",void 0),(0,Q.b)([(0,C.O)()],a.prototype,"_volumeIndexOfRefraction",void 0),(0,Q.b)([(0,C.e)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"volumeIndexOfRefraction",null),(0,Q.b)([(0,C.O)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"invertRefractionY",void 0),(0,Q.b)([(0,C.O)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"linkRefractionWithTransparency",void 0),(0,Q.b)([(0,C.O)()],a.prototype,"minimumThickness",void 0),(0,Q.b)([(0,C.O)()],a.prototype,"maximumThickness",void 0),(0,Q.b)([(0,C.O)()],a.prototype,"useThicknessAsDepth",void 0),(0,Q.b)([(0,C.n)()],a.prototype,"tintColor",void 0),(0,Q.b)([(0,C.O)()],a.prototype,"tintColorAtDistance",void 0),(0,Q.b)([(0,C.O)()],a.prototype,"dispersion",void 0),(0,Q.b)([(0,C.n)()],a.prototype,"diffusionDistance",void 0),(0,Q.b)([(0,C.O)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"useMaskFromThicknessTexture",void 0),(0,Q.b)([(0,C.I)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"refractionIntensityTexture",void 0),(0,Q.b)([(0,C.I)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"translucencyIntensityTexture",void 0),(0,Q.b)([(0,C.n)()],a.prototype,"translucencyColor",void 0),(0,Q.b)([(0,C.I)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"translucencyColorTexture",void 0),(0,Q.b)([(0,C.O)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"useGltfStyleTextures",void 0);var S=W(1416),H=W(1386),z=W(1426);const i={effect:null,subMesh:null};class p extends Z.d{constructor(D){super(D),this.PBR=!0,this.NUM_SAMPLES="0",this.REALTIME_FILTERING=!1,this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.ALBEDO=!1,this.GAMMAALBEDO=!1,this.ALBEDODIRECTUV=0,this.VERTEXCOLOR=!1,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.AMBIENTINGRAYSCALE=!1,this.OPACITY=!1,this.VERTEXALPHA=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHABLEND=!1,this.ALPHAFROMALBEDO=!1,this.ALPHATESTVALUE="0.5",this.SPECULAROVERALPHA=!1,this.RADIANCEOVERALPHA=!1,this.ALPHAFRESNEL=!1,this.LINEARALPHAFRESNEL=!1,this.PREMULTIPLYALPHA=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.GAMMAEMISSIVE=!1,this.REFLECTIVITY=!1,this.REFLECTIVITY_GAMMA=!1,this.REFLECTIVITYDIRECTUV=0,this.SPECULARTERM=!1,this.MICROSURFACEFROMREFLECTIVITYMAP=!1,this.MICROSURFACEAUTOMATIC=!1,this.LODBASEDMICROSFURACE=!1,this.MICROSURFACEMAP=!1,this.MICROSURFACEMAPDIRECTUV=0,this.METALLICWORKFLOW=!1,this.ROUGHNESSSTOREINMETALMAPALPHA=!1,this.ROUGHNESSSTOREINMETALMAPGREEN=!1,this.METALLNESSSTOREINMETALMAPBLUE=!1,this.AOSTOREINMETALMAPRED=!1,this.METALLIC_REFLECTANCE=!1,this.METALLIC_REFLECTANCE_GAMMA=!1,this.METALLIC_REFLECTANCEDIRECTUV=0,this.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=!1,this.REFLECTANCE=!1,this.REFLECTANCE_GAMMA=!1,this.REFLECTANCEDIRECTUV=0,this.ENVIRONMENTBRDF=!1,this.ENVIRONMENTBRDF_RGBD=!1,this.NORMAL=!1,this.TANGENT=!1,this.BUMP=!1,this.BUMPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.NORMALXYSCALE=!0,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.USELIGHTMAPASSHADOWMAP=!1,this.GAMMALIGHTMAP=!1,this.RGBDLIGHTMAP=!1,this.REFLECTION=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.INVERTCUBICMAP=!1,this.USESPHERICALFROMREFLECTIONMAP=!1,this.USEIRRADIANCEMAP=!1,this.USESPHERICALINVERTEX=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.LODINREFLECTIONALPHA=!1,this.GAMMAREFLECTION=!1,this.RGBDREFLECTION=!1,this.LINEARSPECULARREFLECTION=!1,this.RADIANCEOCCLUSION=!1,this.HORIZONOCCLUSION=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.NONUNIFORMSCALING=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.EXPOSURE=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.USEPHYSICALLIGHTFALLOFF=!1,this.USEGLTFLIGHTFALLOFF=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.LOGARITHMICDEPTH=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.FORCENORMALFORWARD=!1,this.SPECULARAA=!1,this.UNLIT=!1,this.DECAL_AFTER_DETAIL=!1,this.DEBUGMODE=0,this.rebuild()}reset(){super.reset(),this.ALPHATESTVALUE="0.5",this.PBR=!0,this.NORMALXYSCALE=!0}}class T extends N.d{get realTimeFiltering(){return this._realTimeFiltering}set realTimeFiltering(D){this._realTimeFiltering=D,this.Le(1)}get realTimeFilteringQuality(){return this._realTimeFilteringQuality}set realTimeFilteringQuality(D){this._realTimeFilteringQuality=D,this.Le(1)}get canRenderToMRT(){return!0}_attachImageProcessingConfiguration(D){D!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=D||this.va().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}constructor(D,j){super(D,j,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||T.ForceGLSL),this._directIntensity=1,this._emissiveIntensity=1,this._environmentIntensity=1,this._specularIntensity=1,this._lightingInfos=new f.m(this._directIntensity,this._emissiveIntensity,this._environmentIntensity,this._specularIntensity),this._disableBumpMap=!1,this._albedoTexture=null,this._ambientTexture=null,this._ambientTextureStrength=1,this._ambientTextureImpactOnAnalyticalLights=T.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._reflectivityTexture=null,this._metallicTexture=null,this._metallic=null,this._roughness=null,this._metallicF0Factor=1,this._metallicReflectanceColor=V.d.White(),this._useOnlyMetallicFromMetallicReflectanceTexture=!1,this._metallicReflectanceTexture=null,this._reflectanceTexture=null,this._microSurfaceTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._ambientColor=new V.d(0,0,0),this._albedoColor=new V.d(1,1,1),this._reflectivityColor=new V.d(1,1,1),this._reflectionColor=new V.d(1,1,1),this._emissiveColor=new V.d(0,0,0),this._microSurface=.9,this._useLightmapAsShadowmap=!1,this._useHorizonOcclusion=!0,this._useRadianceOcclusion=!0,this._useAlphaFromAlbedoTexture=!1,this._useSpecularOverAlpha=!0,this._useMicroSurfaceFromReflectivityMapAlpha=!1,this._useRoughnessFromMetallicTextureAlpha=!0,this._useRoughnessFromMetallicTextureGreen=!1,this._useMetallnessFromMetallicTextureBlue=!1,this._useAmbientOcclusionFromMetallicTextureRed=!1,this._useAmbientInGrayScale=!1,this._useAutoMicroSurfaceFromReflectivityMap=!1,this._lightFalloff=T.LIGHTFALLOFF_PHYSICAL,this._useRadianceOverAlpha=!0,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this._parallaxScaleBias=.05,this._disableLighting=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._alphaCutOff=.4,this._forceAlphaTest=!1,this._useAlphaFresnel=!1,this._useLinearAlphaFresnel=!1,this._environmentBRDFTexture=null,this._forceIrradianceInFragment=!1,this._realTimeFiltering=!1,this._realTimeFilteringQuality=8,this._forceNormalForward=!1,this._enableSpecularAntiAliasing=!1,this._imageProcessingObserver=null,this._renderTargets=new M.i(16),this._globalAmbientColor=new V.d(0,0,0),this._unlit=!1,this._applyDecalMapAfterDetailMap=!1,this._debugMode=0,this._shadersLoaded=!1,this._breakShaderLoadedCheck=!1,this.debugMode=0,this.debugLimit=-1,this.debugFactor=1,this._cacheHasRenderTargetTextures=!1,this.brdf=new x(this),this.clearCoat=new b(this),this.iridescence=new t(this),this.anisotropy=new l(this),this.sheen=new y(this),this.subSurface=new a(this),this.detailMap=new S.d(this),this._attachImageProcessingConfiguration(null),this.getRenderTargetTextures=()=>(this._renderTargets.reset(),K.e.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets),this._environmentBRDFTexture=(0,O.e)(this.va()),this.prePassConfiguration=new R.c}get hasRenderTargetTextures(){return!!(K.e.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures}get isPrePassCapable(){return!this.disableDepthWrite}getClassName(){return"PBRBaseMaterial"}get _disableAlphaBlending(){var D;return this._transparencyMode===T.PBRMATERIAL_OPAQUE||this._transparencyMode===T.PBRMATERIAL_ALPHATEST||(null===(D=this.subSurface)||void 0===D?void 0:D.disableAlphaBlending)}needAlphaBlending(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())}needAlphaTesting(){var D;return!!this._forceAlphaTest||(null===(D=this.subSurface)||void 0===D||!D.disableAlphaBlending)&&(this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===T.PBRMATERIAL_ALPHATEST))}_shouldUseAlphaFromAlbedoTexture(){return null!=this._albedoTexture&&this._albedoTexture.td&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==T.PBRMATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._albedoTexture&&this._albedoTexture.td||null!=this._opacityTexture}getAlphaTestTexture(){return this._albedoTexture}isReadyForSubMesh(D,j,W){this._uniformBufferLayoutBuilt||this.buildUniformLayout();const Q=j._drawWrapper;if(Q.effect&&this.isFrozen&&Q._wasPreviouslyReady&&Q._wasPreviouslyUsingInstances===W)return!0;j.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),j.materialDefines=new p(this._eventInfo.defineNames));const C=j.materialDefines;if(this._isReadyForSubMesh(j))return!0;const M=this.va(),O=M.getEngine();if(C._areTexturesDirty&&(this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,M.texturesEnabled)){if(this._albedoTexture&&K.e.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&K.e.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&K.e.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;const D=this._getReflectionTexture();if(D&&K.e.ReflectionTextureEnabled){if(!D.isReadyOrNotBlocking())return!1;var E;if(D.irradianceTexture){if(!D.irradianceTexture.isReadyOrNotBlocking())return!1}else if(!D.sphericalPolynomial&&null!==(E=D.getInternalTexture())&&void 0!==E&&E._sphericalPolynomialPromise)return!1}if(this._lightmapTexture&&K.e.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&K.e.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(K.e.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._metallicReflectanceTexture&&!this._metallicReflectanceTexture.isReadyOrNotBlocking())return!1;if(this._reflectanceTexture&&!this._reflectanceTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(O.getCaps().standardDerivatives&&this._bumpTexture&&K.e.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;if(this._environmentBRDFTexture&&K.e.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=C,this._eventInfo.subMesh=j,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(C._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;O.getCaps().standardDerivatives||D.isVerticesDataPresent(F.f.NormalKind)||(D.createNormals(!0),k.b.Warn("PBRMaterial: Normals have been created for the mesh: "+D.name));const f=j.effect,Z=C._areLightsDisposed;let P=this._prepareEffect(D,C,this.onCompiled,this.onError,W,null,j.getRenderingMesh().hasThinInstances),X=!1;if(P)if(this._onEffectCreatedObservable&&(i.effect=P,i.subMesh=j,this._onEffectCreatedObservable.notifyObservers(i)),this.allowShaderHotSwapping&&f&&!P.isReady()){if(P=f,C.markAsUnprocessed(),X=this.isFrozen,Z)return C._areLightsDisposed=!0,!1}else M.resetCachedMaterial(),j.setEffect(P,C,this._materialContext);return!(!j.effect||!j.effect.isReady())&&(C._renderId=M.getRenderId(),Q._wasPreviouslyReady=!X,Q._wasPreviouslyUsingInstances=!!W,this._checkScenePerformancePriority(),!0)}isMetallicWorkflow(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)}_prepareEffect(D,j){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,M=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,O=arguments.length>6?arguments[6]:void 0;if(this._prepareDefines(D,j,k,M,O),!j.isDirty)return null;j.markAsProcessed();const E=this.va().getEngine(),f=new L.d;let Z=0;j.USESPHERICALINVERTEX&&f.addFallback(Z++,"USESPHERICALINVERTEX"),j.FOG&&f.addFallback(Z,"FOG"),j.SPECULARAA&&f.addFallback(Z,"SPECULARAA"),j.POINTSIZE&&f.addFallback(Z,"POINTSIZE"),j.LOGARITHMICDEPTH&&f.addFallback(Z,"LOGARITHMICDEPTH"),j.PARALLAX&&f.addFallback(Z,"PARALLAX"),j.PARALLAX_RHS&&f.addFallback(Z,"PARALLAX_RHS"),j.PARALLAXOCCLUSION&&f.addFallback(Z++,"PARALLAXOCCLUSION"),j.ENVIRONMENTBRDF&&f.addFallback(Z++,"ENVIRONMENTBRDF"),j.TANGENT&&f.addFallback(Z++,"TANGENT"),j.BUMP&&f.addFallback(Z++,"BUMP"),Z=(0,e.v)(j,f,this._maxSimultaneousLights,Z++),j.SPECULARTERM&&f.addFallback(Z++,"SPECULARTERM"),j.USESPHERICALFROMREFLECTIONMAP&&f.addFallback(Z++,"USESPHERICALFROMREFLECTIONMAP"),j.USEIRRADIANCEMAP&&f.addFallback(Z++,"USEIRRADIANCEMAP"),j.LIGHTMAP&&f.addFallback(Z++,"LIGHTMAP"),j.NORMAL&&f.addFallback(Z++,"NORMAL"),j.AMBIENT&&f.addFallback(Z++,"AMBIENT"),j.EMISSIVE&&f.addFallback(Z++,"EMISSIVE"),j.VERTEXCOLOR&&f.addFallback(Z++,"VERTEXCOLOR"),j.MORPHTARGETS&&f.addFallback(Z++,"MORPHTARGETS"),j.MULTIVIEW&&f.addFallback(0,"MULTIVIEW");const P=[F.f.PositionKind];j.NORMAL&&P.push(F.f.NormalKind),j.TANGENT&&P.push(F.f.TangentKind);for(let W=1;W<=6;++W)j["UV"+W]&&P.push(`uv${1===W?"":W}`);j.VERTEXCOLOR&&P.push(F.f.ColorKind),(0,e.z)(P,D,j,f),(0,e.C)(P,j),(0,e.D)(P,D,j),(0,e.y)(P,D,j);let X="pbr";const x=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vReflectionFilteringInfo","vMetallicReflectanceInfos","vReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","albedoMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","reflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vTangentSpaceParams","boneTextureWidth","vDebugMode","morphTargetTextureInfo","morphTargetTextureIndices"],V=["albedoSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler","reflectanceSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],g=["Material","Scene","Mesh"],N={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:j.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=f,this._eventInfo.fallbackRank=Z,this._eventInfo.defines=j,this._eventInfo.uniforms=x,this._eventInfo.attributes=P,this._eventInfo.samplers=V,this._eventInfo.uniformBuffersNames=g,this._eventInfo.customCode=void 0,this._eventInfo.mesh=D,this._eventInfo.indexParameters=N,this._callbackPluginEventGeneric(128,this._eventInfo),z.b.AddUniformsAndSamplers(x,V),R.c.AddUniforms(x),R.c.AddSamplers(V),(0,H.e)(x),U.c&&(U.c.PrepareUniforms(x,j),U.c.PrepareSamplers(V,j)),(0,e.Z)({uniformsNames:x,uniformBuffersNames:g,samplers:V,defines:j,maxSimultaneousLights:this._maxSimultaneousLights});const G={};this.customShaderNameResolve&&(X=this.customShaderNameResolve(X,x,g,V,j,P,G));const K=j.toString(),s=E.createEffect(X,{attributes:P,uniformsNames:x,uniformBuffersNames:g,samplers:V,defines:K,fallbacks:f,onCompiled:Q,onError:C,indexParameters:N,processFinalCode:G.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:j.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this.shaderLanguage?await Promise.all([Promise.all([W.e(15),W.e(44)]).then(W.bind(W,13379)),Promise.all([W.e(16),W.e(45)]).then(W.bind(W,13398))]):await Promise.all([Promise.all([W.e(21),W.e(46)]).then(W.bind(W,13403)),Promise.all([W.e(23),W.e(47)]).then(W.bind(W,13425))]),this._shadersLoaded=!0}},E);return this._eventInfo.customCode=void 0,s}_prepareDefines(D,j){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,C=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const k=this.va(),M=k.getEngine();(0,e.L)(k,D,j,!0,this._maxSimultaneousLights,this._disableLighting),j._needNormals=!0,(0,e.T)(k,j);const O=this.needAlphaBlendingForMesh(D)&&this.va().useOrderIndependentTransparency;if((0,e.Y)(k,j,this.canRenderToMRT&&!O),(0,e.U)(k,j,O),z.b.PrepareDefines(M.currentRenderPassId,D,j),j.METALLICWORKFLOW=this.isMetallicWorkflow(),j._areTexturesDirty){j._needUVs=!1;for(let D=1;D<=6;++D)j["MAINUV"+D]=!1;if(k.texturesEnabled){j.ALBEDODIRECTUV=0,j.AMBIENTDIRECTUV=0,j.OPACITYDIRECTUV=0,j.EMISSIVEDIRECTUV=0,j.REFLECTIVITYDIRECTUV=0,j.MICROSURFACEMAPDIRECTUV=0,j.METALLIC_REFLECTANCEDIRECTUV=0,j.REFLECTANCEDIRECTUV=0,j.BUMPDIRECTUV=0,j.LIGHTMAPDIRECTUV=0,M.getCaps().textureLOD&&(j.LODBASEDMICROSFURACE=!0),this._albedoTexture&&K.e.DiffuseTextureEnabled?((0,e.N)(this._albedoTexture,j,"ALBEDO"),j.GAMMAALBEDO=this._albedoTexture.gammaSpace):j.ALBEDO=!1,this._ambientTexture&&K.e.AmbientTextureEnabled?((0,e.N)(this._ambientTexture,j,"AMBIENT"),j.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):j.AMBIENT=!1,this._opacityTexture&&K.e.OpacityTextureEnabled?((0,e.N)(this._opacityTexture,j,"OPACITY"),j.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):j.OPACITY=!1;const D=this._getReflectionTexture();if(D&&K.e.ReflectionTextureEnabled){switch(j.REFLECTION=!0,j.GAMMAREFLECTION=D.gammaSpace,j.RGBDREFLECTION=D.isRGBD,j.LODINREFLECTIONALPHA=D.lodLevelInAlpha,j.LINEARSPECULARREFLECTION=D.linearSpecularLOD,this.realTimeFiltering&&this.realTimeFilteringQuality>0?(j.NUM_SAMPLES=""+this.realTimeFilteringQuality,M._features.needTypeSuffixInShaderConstants&&(j.NUM_SAMPLES=j.NUM_SAMPLES+"u"),j.REALTIME_FILTERING=!0):j.REALTIME_FILTERING=!1,j.INVERTCUBICMAP=D.coordinatesMode===G.e.INVCUBIC_MODE,j.REFLECTIONMAP_3D=D.isCube,j.REFLECTIONMAP_OPPOSITEZ=j.REFLECTIONMAP_3D&&this.va().useRightHandedSystem?!D.invertZ:D.invertZ,j.REFLECTIONMAP_CUBIC=!1,j.REFLECTIONMAP_EXPLICIT=!1,j.REFLECTIONMAP_PLANAR=!1,j.REFLECTIONMAP_PROJECTION=!1,j.REFLECTIONMAP_SKYBOX=!1,j.REFLECTIONMAP_SPHERICAL=!1,j.REFLECTIONMAP_EQUIRECTANGULAR=!1,j.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,j.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,D.coordinatesMode){case G.e.EXPLICIT_MODE:j.REFLECTIONMAP_EXPLICIT=!0;break;case G.e.PLANAR_MODE:j.REFLECTIONMAP_PLANAR=!0;break;case G.e.PROJECTION_MODE:j.REFLECTIONMAP_PROJECTION=!0;break;case G.e.SKYBOX_MODE:j.REFLECTIONMAP_SKYBOX=!0;break;case G.e.SPHERICAL_MODE:j.REFLECTIONMAP_SPHERICAL=!0;break;case G.e.EQUIRECTANGULAR_MODE:j.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case G.e.FIXED_EQUIRECTANGULAR_MODE:j.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case G.e.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:j.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case G.e.CUBIC_MODE:case G.e.INVCUBIC_MODE:default:j.REFLECTIONMAP_CUBIC=!0,j.USE_LOCAL_REFLECTIONMAP_CUBIC=!!D.boundingBoxSize}D.coordinatesMode!==G.e.SKYBOX_MODE&&(D.irradianceTexture?(j.USEIRRADIANCEMAP=!0,j.USESPHERICALFROMREFLECTIONMAP=!1):D.isCube&&(j.USESPHERICALFROMREFLECTIONMAP=!0,j.USEIRRADIANCEMAP=!1,this._forceIrradianceInFragment||this.realTimeFiltering||this._twoSidedLighting||M.getCaps().maxVaryingVectors<=8?j.USESPHERICALINVERTEX=!1:j.USESPHERICALINVERTEX=!0))}else j.REFLECTION=!1,j.REFLECTIONMAP_3D=!1,j.REFLECTIONMAP_SPHERICAL=!1,j.REFLECTIONMAP_PLANAR=!1,j.REFLECTIONMAP_CUBIC=!1,j.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,j.REFLECTIONMAP_PROJECTION=!1,j.REFLECTIONMAP_SKYBOX=!1,j.REFLECTIONMAP_EXPLICIT=!1,j.REFLECTIONMAP_EQUIRECTANGULAR=!1,j.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,j.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,j.INVERTCUBICMAP=!1,j.USESPHERICALFROMREFLECTIONMAP=!1,j.USEIRRADIANCEMAP=!1,j.USESPHERICALINVERTEX=!1,j.REFLECTIONMAP_OPPOSITEZ=!1,j.LODINREFLECTIONALPHA=!1,j.GAMMAREFLECTION=!1,j.RGBDREFLECTION=!1,j.LINEARSPECULARREFLECTION=!1;this._lightmapTexture&&K.e.LightmapTextureEnabled?((0,e.N)(this._lightmapTexture,j,"LIGHTMAP"),j.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,j.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,j.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):j.LIGHTMAP=!1,this._emissiveTexture&&K.e.EmissiveTextureEnabled?((0,e.N)(this._emissiveTexture,j,"EMISSIVE"),j.GAMMAEMISSIVE=this._emissiveTexture.gammaSpace):j.EMISSIVE=!1,K.e.SpecularTextureEnabled?(this._metallicTexture?((0,e.N)(this._metallicTexture,j,"REFLECTIVITY"),j.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,j.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,j.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,j.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed,j.REFLECTIVITY_GAMMA=!1):this._reflectivityTexture?((0,e.N)(this._reflectivityTexture,j,"REFLECTIVITY"),j.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,j.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap,j.REFLECTIVITY_GAMMA=this._reflectivityTexture.gammaSpace):j.REFLECTIVITY=!1,this._metallicReflectanceTexture||this._reflectanceTexture?(j.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=this._useOnlyMetallicFromMetallicReflectanceTexture,this._metallicReflectanceTexture?((0,e.N)(this._metallicReflectanceTexture,j,"METALLIC_REFLECTANCE"),j.METALLIC_REFLECTANCE_GAMMA=this._metallicReflectanceTexture.gammaSpace):j.METALLIC_REFLECTANCE=!1,this._reflectanceTexture&&(!this._metallicReflectanceTexture||this._metallicReflectanceTexture&&this._useOnlyMetallicFromMetallicReflectanceTexture)?((0,e.N)(this._reflectanceTexture,j,"REFLECTANCE"),j.REFLECTANCE_GAMMA=this._reflectanceTexture.gammaSpace):j.REFLECTANCE=!1):(j.METALLIC_REFLECTANCE=!1,j.REFLECTANCE=!1),this._microSurfaceTexture?(0,e.N)(this._microSurfaceTexture,j,"MICROSURFACEMAP"):j.MICROSURFACEMAP=!1):(j.REFLECTIVITY=!1,j.MICROSURFACEMAP=!1),M.getCaps().standardDerivatives&&this._bumpTexture&&K.e.BumpTextureEnabled&&!this._disableBumpMap?((0,e.N)(this._bumpTexture,j,"BUMP"),this._useParallax&&this._albedoTexture&&K.e.DiffuseTextureEnabled?(j.PARALLAX=!0,j.PARALLAX_RHS=k.useRightHandedSystem,j.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):j.PARALLAX=!1,j.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):(j.BUMP=!1,j.PARALLAX=!1,j.PARALLAX_RHS=!1,j.PARALLAXOCCLUSION=!1,j.OBJECTSPACE_NORMALMAP=!1),this._environmentBRDFTexture&&K.e.ReflectionTextureEnabled?(j.ENVIRONMENTBRDF=!0,j.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(j.ENVIRONMENTBRDF=!1,j.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?j.ALPHAFROMALBEDO=!0:j.ALPHAFROMALBEDO=!1}j.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===T.LIGHTFALLOFF_STANDARD?(j.USEPHYSICALLIGHTFALLOFF=!1,j.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===T.LIGHTFALLOFF_GLTF?(j.USEPHYSICALLIGHTFALLOFF=!1,j.USEGLTFLIGHTFALLOFF=!0):(j.USEPHYSICALLIGHTFALLOFF=!0,j.USEGLTFLIGHTFALLOFF=!1),j.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.Se&&this._twoSidedLighting?j.TWOSIDEDLIGHTING=!0:j.TWOSIDEDLIGHTING=!1,j.SPECULARAA=M.getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(j._areTexturesDirty||j._areMiscDirty)&&(j.ALPHATESTVALUE=`${this._alphaCutOff}${this._alphaCutOff%1===0?".":""}`,j.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,j.ALPHABLEND=this.needAlphaBlendingForMesh(D),j.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,j.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),j._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(j),j.FORCENORMALFORWARD=this._forceNormalForward,j.RADIANCEOCCLUSION=this._useRadianceOcclusion,j.HORIZONOCCLUSION=this._useHorizonOcclusion,j._areMiscDirty&&((0,e.R)(D,k,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(D)||this._forceAlphaTest,j,this._applyDecalMapAfterDetailMap),j.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!D.isVerticesDataPresent(F.f.NormalKind),j.DEBUGMODE=this._debugMode),(0,e.H)(k,M,this,j,!!W,Q,C),this._eventInfo.defines=j,this._eventInfo.mesh=D,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,e.G)(D,j,!0,!0,!0,this._transparencyMode!==T.PBRMATERIAL_OPAQUE),this._callbackPluginEventPrepareDefines(this._eventInfo)}forceCompilation(D,j,W){const Q={clipPlane:!1,useInstances:!1,...W};this._uniformBufferLayoutBuilt||this.buildUniformLayout(),this._callbackPluginEventGeneric(4,this._eventInfo);(()=>{if(this._breakShaderLoadedCheck)return;const W=new p(this._eventInfo.defineNames),C=this._prepareEffect(D,W,void 0,void 0,Q.useInstances,Q.clipPlane,D.hasThinInstances);this._onEffectCreatedObservable&&(i.effect=C,i.subMesh=null,this._onEffectCreatedObservable.notifyObservers(i)),C.isReady()?j&&j(this):C.onCompileObservable.add((()=>{j&&j(this)}))})()}buildUniformLayout(){const D=this._uniformBuffer;D.addUniform("vAlbedoInfos",2),D.addUniform("vAmbientInfos",4),D.addUniform("vOpacityInfos",2),D.addUniform("vEmissiveInfos",2),D.addUniform("vLightmapInfos",2),D.addUniform("vReflectivityInfos",3),D.addUniform("vMicroSurfaceSamplerInfos",2),D.addUniform("vReflectionInfos",2),D.addUniform("vReflectionFilteringInfo",2),D.addUniform("vReflectionPosition",3),D.addUniform("vReflectionSize",3),D.addUniform("vBumpInfos",3),D.addUniform("albedoMatrix",16),D.addUniform("ambientMatrix",16),D.addUniform("opacityMatrix",16),D.addUniform("emissiveMatrix",16),D.addUniform("lightmapMatrix",16),D.addUniform("reflectivityMatrix",16),D.addUniform("microSurfaceSamplerMatrix",16),D.addUniform("bumpMatrix",16),D.addUniform("vTangentSpaceParams",2),D.addUniform("reflectionMatrix",16),D.addUniform("vReflectionColor",3),D.addUniform("vAlbedoColor",4),D.addUniform("vLightingIntensity",4),D.addUniform("vReflectionMicrosurfaceInfos",3),D.addUniform("pointSize",1),D.addUniform("vReflectivityColor",4),D.addUniform("vEmissiveColor",3),D.addUniform("vAmbientColor",3),D.addUniform("vDebugMode",2),D.addUniform("vMetallicReflectanceFactors",4),D.addUniform("vMetallicReflectanceInfos",2),D.addUniform("metallicReflectanceMatrix",16),D.addUniform("vReflectanceInfos",2),D.addUniform("reflectanceMatrix",16),D.addUniform("vSphericalL00",3),D.addUniform("vSphericalL1_1",3),D.addUniform("vSphericalL10",3),D.addUniform("vSphericalL11",3),D.addUniform("vSphericalL2_2",3),D.addUniform("vSphericalL2_1",3),D.addUniform("vSphericalL20",3),D.addUniform("vSphericalL21",3),D.addUniform("vSphericalL22",3),D.addUniform("vSphericalX",3),D.addUniform("vSphericalY",3),D.addUniform("vSphericalZ",3),D.addUniform("vSphericalXX_ZZ",3),D.addUniform("vSphericalYY_ZZ",3),D.addUniform("vSphericalZZ",3),D.addUniform("vSphericalXY",3),D.addUniform("vSphericalYZ",3),D.addUniform("vSphericalZX",3),super.buildUniformLayout()}bindForSubMesh(D,j,W){const Q=this.va(),C=W.materialDefines;if(!C)return;const k=W.effect;if(!k)return;this._activeEffect=k,j.getMeshUniformBuffer().bindToEffect(k,"Mesh"),j.transferToEffect(D);const M=Q.getEngine();this._uniformBuffer.bindToEffect(k,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,Q,j,D,this.isFrozen),z.b.Bind(M.currentRenderPassId,this._activeEffect,j,D),this._eventInfo.subMesh=W,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),C.OBJECTSPACE_NORMALMAP&&(D.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const O=this._mustRebind(Q,k,W,j.visibility);(0,e.d)(j,this._activeEffect,this.prePassConfiguration);let f=null;const F=this._uniformBuffer;if(O){if(this.bindViewProjection(k),f=this._getReflectionTexture(),!F.useUbo||!this.isFrozen||!F.isSync||W._drawWrapper._forceRebindOnNextCall){var Z;if(Q.texturesEnabled){if(this._albedoTexture&&K.e.DiffuseTextureEnabled&&(F.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),(0,e.r)(this._albedoTexture,F,"albedo")),this._ambientTexture&&K.e.AmbientTextureEnabled&&(F.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),(0,e.r)(this._ambientTexture,F,"ambient")),this._opacityTexture&&K.e.OpacityTextureEnabled&&(F.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,e.r)(this._opacityTexture,F,"opacity")),f&&K.e.ReflectionTextureEnabled){if(F.de("reflectionMatrix",f.getReflectionTextureMatrix()),F.updateFloat2("vReflectionInfos",f.level,0),f.boundingBoxSize){const D=f;F.updateVector3("vReflectionPosition",D.boundingBoxPosition),F.updateVector3("vReflectionSize",D.boundingBoxSize)}if(this.realTimeFiltering){const D=f.getSize().width;F.updateFloat2("vReflectionFilteringInfo",D,Math.log2(D))}if(!C.USEIRRADIANCEMAP){const D=f.sphericalPolynomial;if(C.USESPHERICALFROMREFLECTIONMAP&&D)if(C.SPHERICAL_HARMONICS){const j=D.preScaledHarmonics;F.updateVector3("vSphericalL00",j.l00),F.updateVector3("vSphericalL1_1",j.l1_1),F.updateVector3("vSphericalL10",j.l10),F.updateVector3("vSphericalL11",j.l11),F.updateVector3("vSphericalL2_2",j.l2_2),F.updateVector3("vSphericalL2_1",j.l2_1),F.updateVector3("vSphericalL20",j.l20),F.updateVector3("vSphericalL21",j.l21),F.updateVector3("vSphericalL22",j.l22)}else F.updateFloat3("vSphericalX",D.x.x,D.x.y,D.x.z),F.updateFloat3("vSphericalY",D.y.x,D.y.y,D.y.z),F.updateFloat3("vSphericalZ",D.z.x,D.z.y,D.z.z),F.updateFloat3("vSphericalXX_ZZ",D.xx.x-D.zz.x,D.xx.y-D.zz.y,D.xx.z-D.zz.z),F.updateFloat3("vSphericalYY_ZZ",D.yy.x-D.zz.x,D.yy.y-D.zz.y,D.yy.z-D.zz.z),F.updateFloat3("vSphericalZZ",D.zz.x,D.zz.y,D.zz.z),F.updateFloat3("vSphericalXY",D.xy.x,D.xy.y,D.xy.z),F.updateFloat3("vSphericalYZ",D.yz.x,D.yz.y,D.yz.z),F.updateFloat3("vSphericalZX",D.zx.x,D.zx.y,D.zx.z)}F.updateFloat3("vReflectionMicrosurfaceInfos",f.getSize().width,f.lodGenerationScale,f.lodGenerationOffset)}this._emissiveTexture&&K.e.EmissiveTextureEnabled&&(F.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,e.r)(this._emissiveTexture,F,"emissive")),this._lightmapTexture&&K.e.LightmapTextureEnabled&&(F.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,e.r)(this._lightmapTexture,F,"lightmap")),K.e.SpecularTextureEnabled&&(this._metallicTexture?(F.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),(0,e.r)(this._metallicTexture,F,"reflectivity")):this._reflectivityTexture&&(F.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),(0,e.r)(this._reflectivityTexture,F,"reflectivity")),this._metallicReflectanceTexture&&(F.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level),(0,e.r)(this._metallicReflectanceTexture,F,"metallicReflectance")),this._reflectanceTexture&&C.REFLECTANCE&&(F.updateFloat2("vReflectanceInfos",this._reflectanceTexture.coordinatesIndex,this._reflectanceTexture.level),(0,e.r)(this._reflectanceTexture,F,"reflectance")),this._microSurfaceTexture&&(F.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),(0,e.r)(this._microSurfaceTexture,F,"microSurfaceSampler"))),this._bumpTexture&&M.getCaps().standardDerivatives&&K.e.BumpTextureEnabled&&!this._disableBumpMap&&(F.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),(0,e.r)(this._bumpTexture,F,"bump"),Q._mirroredCameraPosition?F.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):F.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&F.updateFloat("pointSize",this.pointSize),C.METALLICWORKFLOW){var P;V.l.Wd[0].r=void 0===this._metallic||null===this._metallic?1:this._metallic,V.l.Wd[0].g=void 0===this._roughness||null===this._roughness?1:this._roughness,F.updateColor4("vReflectivityColor",V.l.Wd[0],1);const D=(null===(P=this.subSurface)||void 0===P?void 0:P._indexOfRefraction)??1.5,j=1,W=Math.pow((D-j)/(D+j),2);this._metallicReflectanceColor.scaleToRef(W*this._metallicF0Factor,V.l.Wd[0]);const Q=this._metallicF0Factor;F.updateColor4("vMetallicReflectanceFactors",V.l.Wd[0],Q)}else F.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);F.updateColor3("vEmissiveColor",K.e.EmissiveTextureEnabled?this._emissiveColor:V.d.BlackReadOnly),F.updateColor3("vReflectionColor",this._reflectionColor),!C.SS_REFRACTION&&null!==(Z=this.subSurface)&&void 0!==Z&&Z._linkRefractionWithTransparency?F.updateColor4("vAlbedoColor",this._albedoColor,1):F.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*Q.environmentIntensity,this._lightingInfos.w=this._specularIntensity,F.updateVector4("vLightingIntensity",this._lightingInfos),Q.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor),F.updateColor3("vAmbientColor",this._globalAmbientColor),F.updateFloat2("vDebugMode",this.debugLimit,this.debugFactor)}Q.texturesEnabled&&(this._albedoTexture&&K.e.DiffuseTextureEnabled&&F.setTexture("albedoSampler",this._albedoTexture),this._ambientTexture&&K.e.AmbientTextureEnabled&&F.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&K.e.OpacityTextureEnabled&&F.setTexture("opacitySampler",this._opacityTexture),f&&K.e.ReflectionTextureEnabled&&(C.LODBASEDMICROSFURACE?F.setTexture("reflectionSampler",f):(F.setTexture("reflectionSampler",f._lodTextureMid||f),F.setTexture("reflectionSamplerLow",f._lodTextureLow||f),F.setTexture("reflectionSamplerHigh",f._lodTextureHigh||f)),C.USEIRRADIANCEMAP&&F.setTexture("irradianceSampler",f.irradianceTexture)),C.ENVIRONMENTBRDF&&F.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&K.e.EmissiveTextureEnabled&&F.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&K.e.LightmapTextureEnabled&&F.setTexture("lightmapSampler",this._lightmapTexture),K.e.SpecularTextureEnabled&&(this._metallicTexture?F.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&F.setTexture("reflectivitySampler",this._reflectivityTexture),this._metallicReflectanceTexture&&F.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture),this._reflectanceTexture&&C.REFLECTANCE&&F.setTexture("reflectanceSampler",this._reflectanceTexture),this._microSurfaceTexture&&F.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&M.getCaps().standardDerivatives&&K.e.BumpTextureEnabled&&!this._disableBumpMap&&F.setTexture("bumpSampler",this._bumpTexture)),this.va().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(j)&&this.va().depthPeelingRenderer.bind(k),this._eventInfo.subMesh=W,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,H.h)(this._activeEffect,this,Q),this.bindEyePosition(k)}else Q.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(O||!this.isFrozen){var X;if(Q.lightsEnabled&&!this._disableLighting&&(0,e.j)(Q,j,this._activeEffect,C,this._maxSimultaneousLights),(Q.fogEnabled&&j.applyFog&&Q.fogMode!==E.b.FOGMODE_NONE||f||this.subSurface.refractionTexture||j.receiveShadows||C.PREPASS)&&this.bindView(k),(0,e.f)(Q,j,this._activeEffect,!0),C.NUM_MORPH_INFLUENCERS&&(0,e.o)(j,this._activeEffect),C.BAKED_VERTEX_ANIMATION_TEXTURE)null===(X=j.bakedVertexAnimationManager)||void 0===X||X.bind(k,C.INSTANCES);this._imageProcessingConfiguration.bind(this._activeEffect),(0,e.l)(C,this._activeEffect,Q)}this._afterBind(j,this._activeEffect,W),F.update()}getAnimatables(){const D=super.getAnimatables();return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&D.push(this._albedoTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&D.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&D.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&D.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&D.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?D.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&D.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&D.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&D.push(this._lightmapTexture),this._metallicReflectanceTexture&&this._metallicReflectanceTexture.animations&&this._metallicReflectanceTexture.animations.length>0&&D.push(this._metallicReflectanceTexture),this._reflectanceTexture&&this._reflectanceTexture.animations&&this._reflectanceTexture.animations.length>0&&D.push(this._reflectanceTexture),this._microSurfaceTexture&&this._microSurfaceTexture.animations&&this._microSurfaceTexture.animations.length>0&&D.push(this._microSurfaceTexture),D}_getReflectionTexture(){return this._reflectionTexture?this._reflectionTexture:this.va().environmentTexture}getActiveTextures(){const D=super.getActiveTextures();return this._albedoTexture&&D.push(this._albedoTexture),this._ambientTexture&&D.push(this._ambientTexture),this._opacityTexture&&D.push(this._opacityTexture),this._reflectionTexture&&D.push(this._reflectionTexture),this._emissiveTexture&&D.push(this._emissiveTexture),this._reflectivityTexture&&D.push(this._reflectivityTexture),this._metallicTexture&&D.push(this._metallicTexture),this._metallicReflectanceTexture&&D.push(this._metallicReflectanceTexture),this._reflectanceTexture&&D.push(this._reflectanceTexture),this._microSurfaceTexture&&D.push(this._microSurfaceTexture),this._bumpTexture&&D.push(this._bumpTexture),this._lightmapTexture&&D.push(this._lightmapTexture),D}hasTexture(D){return!!super.hasTexture(D)||(this._albedoTexture===D||(this._ambientTexture===D||(this._opacityTexture===D||(this._reflectionTexture===D||(this._emissiveTexture===D||(this._reflectivityTexture===D||(this._metallicTexture===D||(this._metallicReflectanceTexture===D||(this._reflectanceTexture===D||(this._microSurfaceTexture===D||(this._bumpTexture===D||this._lightmapTexture===D)))))))))))}setPrePassRenderer(){var D;if(null===(D=this.subSurface)||void 0===D||!D.isScatteringEnabled)return!1;const j=this.va().enableSubSurfaceForPrePass();return j&&(j.enabled=!0),!0}dispose(D,j){var W,Q,C,k,M,O,E,f,F,Z,P,X;(this._breakShaderLoadedCheck=!0,j)&&(this._environmentBRDFTexture&&this.va().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),null===(W=this._albedoTexture)||void 0===W||W.dispose(),null===(Q=this._ambientTexture)||void 0===Q||Q.dispose(),null===(C=this._opacityTexture)||void 0===C||C.dispose(),null===(k=this._reflectionTexture)||void 0===k||k.dispose(),null===(M=this._emissiveTexture)||void 0===M||M.dispose(),null===(O=this._metallicTexture)||void 0===O||O.dispose(),null===(E=this._reflectivityTexture)||void 0===E||E.dispose(),null===(f=this._bumpTexture)||void 0===f||f.dispose(),null===(F=this._lightmapTexture)||void 0===F||F.dispose(),null===(Z=this._metallicReflectanceTexture)||void 0===Z||Z.dispose(),null===(P=this._reflectanceTexture)||void 0===P||P.dispose(),null===(X=this._microSurfaceTexture)||void 0===X||X.dispose());this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(D,j)}}T.PBRMATERIAL_OPAQUE=g.c.MATERIAL_OPAQUE,T.PBRMATERIAL_ALPHATEST=g.c.MATERIAL_ALPHATEST,T.PBRMATERIAL_ALPHABLEND=g.c.MATERIAL_ALPHABLEND,T.PBRMATERIAL_ALPHATESTANDBLEND=g.c.MATERIAL_ALPHATESTANDBLEND,T.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,T.LIGHTFALLOFF_PHYSICAL=0,T.LIGHTFALLOFF_GLTF=1,T.LIGHTFALLOFF_STANDARD=2,T.ForceGLSL=!1,(0,Q.b)([(0,C.u)()],T.prototype,"_imageProcessingConfiguration",void 0),(0,Q.b)([(0,C.e)("_markAllSubMeshesAsMiscDirty")],T.prototype,"debugMode",void 0)},12733:(D,j,W)=>{"use strict";W.d(j,{c:()=>P});var Q=W(942),C=W(948),k=W(1207),M=W(966),O=W(1009),E=W(936),f=W(981),F=W(961),Z=W(1151);W(1566);class P extends O.b{set boundingBoxSize(D){if(this._boundingBoxSize&&this._boundingBoxSize.equals(D))return;this._boundingBoxSize=D;const j=this.va();j&&j.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(D){this._rotationY=D,this.setReflectionTextureMatrix(M.b.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(D,j,W){let Q="";return D.forEach((D=>Q+=D)),new P(Q,j,null,W,D)}static CreateFromPrefilteredData(D,j){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Q=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const C=j.useDelayedTextureLoading;j.useDelayedTextureLoading=!1;const k=new P(D,j,null,!1,null,null,null,void 0,!0,W,Q);return j.useDelayedTextureLoading=C,k}constructor(D,j){var W;let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,C=arguments.length>3&&void 0!==arguments[3]&&arguments[3],k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,f=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,P=arguments.length>8&&void 0!==arguments[8]&&arguments[8],X=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,x=arguments.length>10&&void 0!==arguments[10]&&arguments[10],R=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,V=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,U=arguments.length>13?arguments[13]:void 0,g=arguments.length>14?arguments[14]:void 0;super(j),this.onLoadObservable=new F.d,this.boundingBoxPosition=M.j.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new M.b,this._buffer=null,this.name=D,this.url=D,this._noMipmap=C,this.td=!1,this.isCube=!0,this._textureMatrix=M.b.Identity(),this.coordinatesMode=E.e.CUBIC_MODE;let N=null,G=null;null===Q||Array.isArray(Q)?(this._noMipmap=C,this._format=Z,this._createPolynomials=x,N=Q,this._loaderOptions=U,this._useSRGBBuffer=g,this._lodScale=R,this._lodOffset=V):(N=Q.extensions??null,this._noMipmap=Q.noMipmap??!1,k=Q.files??null,G=Q.buffer??null,this._format=Q.format??5,P=Q.prefiltered??!1,X=Q.forcedExtension??null,this._createPolynomials=Q.createPolynomials??!1,this._lodScale=Q.lodScale??.8,this._lodOffset=Q.lodOffset??0,this._loaderOptions=Q.loaderOptions,this._useSRGBBuffer=Q.useSRGBBuffer,O=Q.X??null,f=Q.onError??null),(D||k)&&this.updateURL(D,X,O,P,f,N,null===(W=this.va())||void 0===W?void 0:W.useDelayedTextureLoading,k,G)}getClassName(){return"CubeTexture"}updateURL(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,M=arguments.length>6&&void 0!==arguments[6]&&arguments[6],O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,E=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=D),this.url=D,j&&(this._forcedExtension=j);const f=D.lastIndexOf("."),F=j||(f>-1?D.substring(f).toLowerCase():""),Z=0===F.indexOf(".dds"),P=0===F.indexOf(".env"),X=0===F.indexOf(".basis");if(P?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=Q,Q&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),O)this._files=O;else if(X||P||Z||k||(k=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,k){for(let j=0;j<k.length;j++)this._files.push(D+k[j]);this._extensions=k}this._buffer=E,M?(this.delayLoadState=4,this._delayedOnLoad=W,this._delayedOnError=C):this._loadTexture(W,C)}delayLoad(D){4===this.delayLoadState&&(D&&(this._forcedExtension=D),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(D){var j,W;if(D.updateFlag===this._textureMatrix.updateFlag)return;D.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(W=this.va())||void 0===W||W.markAllMaterialsAsDirty(1,(D=>-1!==D.getActiveTextures().indexOf(this))));if(this._textureMatrix=D,null===(j=this.va())||void 0===j||!j.useRightHandedSystem)return;const Q=M.e.Kd[0],C=M.e.Quaternion[0],k=M.e.Kd[1];this._textureMatrix.decompose(Q,C,k),C.z*=-1,C.w*=-1,M.b.ComposeToRef(Q,C,k,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var D;return null!==(D=this.va())&&void 0!==D&&D.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const W=this.va(),Q=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const C=()=>{var j;(this.onLoadObservable.notifyObservers(this),Q)&&(Q.dispose(),null===(j=this.va())||void 0===j||j.markAllMaterialsAsDirty(1));D&&D()},M=(D,W)=>{this._loadingError=!0,this._errorObject={message:D,exception:W},j&&j(D,W),E.e.OnTextureLoadErrorObservable.notifyObservers(this)};var O;this._texture?this._texture.isReady?k.f.SetImmediate((()=>C())):this._texture.onLoadedObservable.add((()=>C())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,W,this._lodScale,this._lodOffset,D,M,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,W,this._files,this._noMipmap,D,M,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(O=this._texture)||void 0===O||O.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(D,j,W){const Q=Z.d.Parse((()=>{let Q=!1;return D.prefiltered&&(Q=D.prefiltered),new P(W+(D.url??D.name),j,D.extensions,!1,D.files||null,null,null,void 0,Q,D.forcedExtension)}),D,j);if(D.boundingBoxPosition&&(Q.boundingBoxPosition=M.j.Dd(D.boundingBoxPosition)),D.boundingBoxSize&&(Q.boundingBoxSize=M.j.Dd(D.boundingBoxSize)),D.animations)for(let C=0;C<D.animations.length;C++){const j=D.animations[C],W=(0,f.b)("BABYLON.Animation");W&&Q.animations.push(W.Parse(j))}return Q}clone(){let D=0;const j=Z.d.Clone((()=>{const j=new P(this.url,this.va()||this._getEngine(),this._extensions,this._noMipmap,this._files);return D=j.uniqueId,j}),this);return j.uniqueId=D,j}}(0,Q.b)([(0,C.O)()],P.prototype,"url",void 0),(0,Q.b)([(0,C.L)()],P.prototype,"boundingBoxPosition",void 0),(0,Q.b)([(0,C.L)()],P.prototype,"boundingBoxSize",null),(0,Q.b)([(0,C.O)("rotationY")],P.prototype,"rotationY",null),(0,Q.b)([(0,C.O)("files")],P.prototype,"_files",void 0),(0,Q.b)([(0,C.O)("forcedExtension")],P.prototype,"_forcedExtension",void 0),(0,Q.b)([(0,C.O)("extensions")],P.prototype,"_extensions",void 0),(0,Q.b)([(0,C.y)("textureMatrix")],P.prototype,"_textureMatrix",void 0),(0,Q.b)([(0,C.y)("textureMatrixRefraction")],P.prototype,"_textureMatrixRefraction",void 0),E.e._CubeTextureParser=P.Parse,(0,f.c)("BABYLON.CubeTexture",P)},13078:(D,j,W)=>{"use strict";W.d(j,{c:()=>E});var Q=W(1083),C=W(936),k=W(1212),M=W(1447),O=W(1129);M.ThinEngine.prototype.createDynamicTexture=function(D,j,W,Q){const C=new O.d(this,4);return C.baseWidth=D,C.baseHeight=j,W&&(D=this.needPOTTextures?(0,k.g)(D,this._caps.maxTextureSize):D,j=this.needPOTTextures?(0,k.g)(j,this._caps.maxTextureSize):j),C.width=D,C.height=j,C.isReady=!1,C.generateMipMaps=W,C.samplingMode=Q,this.updateTextureSamplingMode(Q,C),this._internalTexturesCache.push(C),C},M.ThinEngine.prototype.updateDynamicTexture=function(D,j,W){let Q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],C=arguments.length>4?arguments[4]:void 0,k=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!D)return;const M=this._gl,O=M.TEXTURE_2D,E=this._bindTextureDirectly(O,D,!0,k);this._unpackFlipY(void 0===W?D.invertY:W),Q&&M.pixelStorei(M.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const f=this._getWebGLTextureType(D.type),F=this._getInternalFormat(C||D.format),Z=this._getRGBABufferInternalSizedFormat(D.type,F);M.texImage2D(O,0,Z,F,f,j),D.generateMipMaps&&M.generateMipmap(O),E||this._bindTextureDirectly(O,null),Q&&M.pixelStorei(M.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),C&&(D.format=C),D._dynamicTextureSource=j,D._premulAlpha=Q,D.invertY=W||!1,D.isReady=!0};class E extends C.e{constructor(D,j,W){let Q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,M=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,O=arguments.length>6?arguments[6]:void 0;const E=!W||W._isScene;super(null,E?W:null===W||void 0===W?void 0:W.Be,E?!Q:W,O,k,void 0,void 0,void 0,void 0,M),this.name=D,this.wrapU=C.e.CLAMP_ADDRESSMODE,this.wrapV=C.e.CLAMP_ADDRESSMODE,this._generateMipMaps=Q;const f=this._getEngine();if(!f)return;if(j.getContext)this._canvas=j,this._ownCanvas=!1,this._texture=f.createDynamicTexture(this._canvas.width,this._canvas.height,Q,k);else{this._canvas=f.createCanvas(1,1),this._ownCanvas=!0;const D=j;D.width||0===D.width?this._texture=f.createDynamicTexture(D.width,D.height,Q,k):this._texture=f.createDynamicTexture(j,j,Q,k)}const F=this.getSize();this._canvas.width!==F.width&&(this._canvas.width=F.width),this._canvas.height!==F.height&&(this._canvas.height=F.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(D){this._canvas.width=D.width,this._canvas.height=D.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(D.width,D.height,this._generateMipMaps,this.samplingMode)}scale(D){const j=this.getSize();j.width*=D,j.height*=D,this._recreate(j)}scaleTo(D,j){const W=this.getSize();W.width=D,W.height=j,this._recreate(W)}getContext(){return this._context}clear(D){const j=this.getSize();D&&(this._context.fillStyle=D),this._context.clearRect(0,0,j.width,j.height)}update(D){let j=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===D||D,j,this._format||void 0,void 0,W)}drawText(D,j,W,Q,C,k,M){let O=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const E=this.getSize();if(k&&(this._context.fillStyle=k,this._context.fillRect(0,0,E.width,E.height)),this._context.font=Q,null===j||void 0===j){const W=this._context.measureText(D);j=(E.width-W.width)/2}if(null===W||void 0===W){const D=parseInt(Q.replace(/\D/g,""));W=E.height/2+D/3.65}this._context.fillStyle=C||"",this._context.fillText(D,j,W),O&&this.update(M)}dispose(){var D,j;(super.dispose(),this._ownCanvas)&&(null===(D=this._canvas)||void 0===D||null===(j=D.remove)||void 0===j||j.call(D));this._canvas=null,this._context=null}clone(){const D=this.va();if(!D)return this;const j=this.getSize(),W=new E(this.name,j,D,this._generateMipMaps);return W.td=this.td,W.level=this.level,W.wrapU=this.wrapU,W.wrapV=this.wrapV,W}serialize(){const D=this.va();D&&!D.isReady()&&Q.b.Warn("The scene must be ready before serializing the dynamic texture");const j=super.serialize();return E._IsCanvasElement(this._canvas)&&(j.base64String=this._canvas.toDataURL()),j.invertY=this._invertY,j.samplingMode=this.samplingMode,j}static _IsCanvasElement(D){return void 0!==D.toDataURL}_rebuild(){this.update()}}},12158:(D,j,W)=>{"use strict";W.d(j,{d:()=>C});var Q=W(936);class C extends Q.e{constructor(D,j,W,C,k){let M=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],O=arguments.length>6&&void 0!==arguments[6]&&arguments[6],E=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,f=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,F=arguments.length>9?arguments[9]:void 0,Z=arguments.length>10?arguments[10]:void 0;super(null,k,!M,O,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,F),this.format=C,this._engine&&(this._engine._caps.textureFloatLinearFiltering||1!==f||(E=1),this._engine._caps.textureHalfFloatLinearFiltering||2!==f||(E=1),this._texture=this._engine.createRawTexture(D,j,W,C,M,O,E,null,f,F??0,Z??!1),this.wrapU=Q.e.CLAMP_ADDRESSMODE,this.wrapV=Q.e.CLAMP_ADDRESSMODE)}update(D){this._getEngine().updateRawTexture(this._texture,D,this._texture.format,this._texture.invertY,null,this._texture.type,this._texture._useSRGBBuffer)}clone(){if(!this._texture)return super.clone();const D=new C(null,this.getSize().width,this.getSize().height,this.format,this.va(),this._texture.generateMipMaps,this._invertY,this.samplingMode,this._texture.type,this._texture._creationFlags,this._useSRGBBuffer);return D._texture=this._texture,this._texture.incrementReferences(),D}static CreateLuminanceTexture(D,j,W,Q){return new C(D,j,W,1,Q,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateLuminanceAlphaTexture(D,j,W,Q){return new C(D,j,W,2,Q,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateAlphaTexture(D,j,W,Q){return new C(D,j,W,0,Q,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateRGBTexture(D,j,W,Q){return new C(D,j,W,4,Q,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBATexture(D,j,W,Q){return new C(D,j,W,5,Q,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBAStorageTexture(D,j,W,Q){return new C(D,j,W,5,Q,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,1,arguments.length>8&&void 0!==arguments[8]&&arguments[8])}static CreateRTexture(D,j,W,k){let M=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],O=arguments.length>5&&void 0!==arguments[5]&&arguments[5],E=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Q.e.TRILINEAR_SAMPLINGMODE;return new C(D,j,W,6,k,M,O,E,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1)}static CreateRStorageTexture(D,j,W,k){let M=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],O=arguments.length>5&&void 0!==arguments[5]&&arguments[5],E=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Q.e.TRILINEAR_SAMPLINGMODE;return new C(D,j,W,6,k,M,O,E,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,1)}}},12040:(D,j,W)=>{"use strict";W.d(j,{e:()=>M});var Q=W(1344),C=W(1155),k=W(981);class M extends Q.c{get Jg(){return this._subMaterials}set Jg(D){this._subMaterials=D,this._hookArray(D)}getChildren(){return this.Jg}constructor(D,j){super(D,j,!0),this._waitingSubMaterialsUniqueIds=[],this.va().addMultiMaterial(this),this.Jg=[],this._storeEffectOnSubMeshes=!0}_hookArray(D){var j=this;const W=D.push;D.push=function(){for(var Q=arguments.length,C=new Array(Q),k=0;k<Q;k++)C[k]=arguments[k];const M=W.apply(D,C);return j._markAllSubMeshesAsTexturesDirty(),M};const Q=D.splice;D.splice=(j,W)=>{const C=Q.apply(D,[j,W]);return this._markAllSubMeshesAsTexturesDirty(),C}}getSubMaterial(D){return D<0||D>=this.Jg.length?this.va().defaultMaterial:this.Jg[D]}getActiveTextures(){return super.getActiveTextures().concat(...this.Jg.map((D=>D?D.getActiveTextures():[])))}hasTexture(D){if(super.hasTexture(D))return!0;for(let W=0;W<this.Jg.length;W++){var j;if(null!==(j=this.Jg[W])&&void 0!==j&&j.hasTexture(D))return!0}return!1}getClassName(){return"MultiMaterial"}isReadyForSubMesh(D,j,W){for(let Q=0;Q<this.Jg.length;Q++){const C=this.Jg[Q];if(C){if(C._storeEffectOnSubMeshes){if(!C.isReadyForSubMesh(D,j,W))return!1;continue}if(!C.isReady(D))return!1}}return!0}clone(D,j){const W=new M(D,this.va());for(let Q=0;Q<this.Jg.length;Q++){let C=null;const k=this.Jg[Q];C=j&&k?k.clone(D+"-"+k.name):this.Jg[Q],W.Jg.push(C)}return W}serialize(){const D={};D.name=this.name,D.id=this.id,D.uniqueId=this.uniqueId,C.e&&(D.tags=C.e.GetTags(this)),D.materialsUniqueIds=[],D.materials=[];for(let j=0;j<this.Jg.length;j++){const W=this.Jg[j];W?(D.materialsUniqueIds.push(W.uniqueId),D.materials.push(W.id)):(D.materialsUniqueIds.push(null),D.materials.push(null))}return D}dispose(D,j,W){const Q=this.va();if(!Q)return;if(W)for(let k=0;k<this.Jg.length;k++){const W=this.Jg[k];W&&W.dispose(D,j)}const C=Q.multiMaterials.indexOf(this);C>=0&&Q.multiMaterials.splice(C,1),super.dispose(D,j)}static ParseMultiMaterial(D,j){const W=new M(D.name,j);return W.id=D.id,W._loadedUniqueId=D.uniqueId,C.e&&C.e.AddTagsTo(W,D.tags),D.materialsUniqueIds?W._waitingSubMaterialsUniqueIds=D.materialsUniqueIds:D.materials.forEach((D=>W.Jg.push(j.getLastMaterialById(D)))),W}}(0,k.c)("BABYLON.MultiMaterial",M)},12049:(D,j,W)=>{"use strict";W.d(j,{c:()=>F,d:()=>f});var Q=W(966),C=W(1163),k=W(11994),M=W(12016),O=W(1182);W(12055);function E(D){let j=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const W=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],k=[];let E=[];const f=D.width||D.size||1,F=D.height||D.size||1,Z=D.depth||D.size||1,P=D.wrap||!1;let X=void 0===D.topBaseAt?1:D.topBaseAt,x=void 0===D.bottomBaseAt?0:D.bottomBaseAt;X=(X+4)%4,x=(x+4)%4;let R=[2,0,3,1][X],V=[2,0,1,3][x],U=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(P){j=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],U=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let D=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],W=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const Q=[17,18,19,16],C=[22,23,20,21];for(;R>0;)D.unshift(D.pop()),Q.unshift(Q.pop()),R--;for(;V>0;)W.unshift(W.pop()),C.unshift(C.pop()),V--;D=D.flat(),W=W.flat(),U=U.concat(D).concat(W),j.push(Q[0],Q[2],Q[3],Q[0],Q[1],Q[2]),j.push(C[0],C[2],C[3],C[0],C[1],C[2])}const g=[f/2,F/2,Z/2];E=U.reduce(((D,j,W)=>D.concat(j*g[W%3])),[]);const N=0===D.sideOrientation?0:D.sideOrientation||M.b.DEFAULTSIDE,G=D.faceUV||new Array(6),K=D.faceColors,L=[];for(let M=0;M<6;M++)void 0===G[M]&&(G[M]=new Q.m(0,0,1,1)),K&&void 0===K[M]&&(K[M]=new C.h(1,1,1,1));for(let Q=0;Q<6;Q++)if(k.push(G[Q].z,O.b?1-G[Q].w:G[Q].w),k.push(G[Q].x,O.b?1-G[Q].w:G[Q].w),k.push(G[Q].x,O.b?1-G[Q].y:G[Q].y),k.push(G[Q].z,O.b?1-G[Q].y:G[Q].y),K)for(let D=0;D<4;D++)L.push(K[Q].r,K[Q].g,K[Q].b,K[Q].a);M.b._ComputeSides(N,E,j,W,k,D.frontUVs,D.backUVs);const e=new M.b;if(e.indices=j,e.xa=E,e.ya=W,e.Aa=k,K){const D=N===M.b.DOUBLESIDE?L.concat(L):L;e.za=D}return e}function f(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=new k.d(D,W);j.sideOrientation=k.d._GetDefaultSideOrientation(j.sideOrientation),Q._originalBuilderSideOrientation=j.sideOrientation;return E(j).Ca(Q,j.updatable),Q}const F={CreateBox:f};M.b.CreateBox=E,k.d.CreateBox=function(D,j){return f(D,{size:j,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},12176:(D,j,W)=>{"use strict";W.d(j,{b:()=>O});var Q=W(11994),C=W(12016),k=W(1182);function M(D){const j=[],W=[],Q=[],M=[],O=D.i||.5,E=D.dl||64,f=D.arc&&(D.arc<=0||D.arc>1)?1:D.arc||1,F=0===D.sideOrientation?0:D.sideOrientation||C.b.DEFAULTSIDE;j.push(0,0,0),M.push(.5,.5);const Z=2*Math.PI*f,P=1===f?Z/E:Z/(E-1);let X=0;for(let C=0;C<E;C++){const D=Math.cos(X),W=Math.sin(X),Q=(D+1)/2,C=(1-W)/2;j.push(O*D,O*W,0),M.push(Q,k.b?1-C:C),X+=P}1===f&&(j.push(j[3],j[4],j[5]),M.push(M[2],k.b?1-M[3]:M[3]));const x=j.length/3;for(let C=1;C<x-1;C++)W.push(C+1,0,C);C.b.ComputeNormals(j,W,Q),C.b._ComputeSides(F,j,W,Q,M,D.frontUVs,D.backUVs);const R=new C.b;return R.indices=W,R.xa=j,R.ya=Q,R.Aa=M,R}function O(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=new Q.d(D,W);j.sideOrientation=Q.d._GetDefaultSideOrientation(j.sideOrientation),C._originalBuilderSideOrientation=j.sideOrientation;return M(j).Ca(C,j.updatable),C}C.b.jb=M,Q.d.jb=function(D,j,W){return O(D,{i:j,dl:W,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},12055:(D,j,W)=>{"use strict";W.d(j,{g:()=>V,d:()=>g,i:()=>U});var Q=W(966),C=W(1163),k=W(11994),M=W(12016),O=W(1256);k.d._GroundMeshParser=(D,j)=>E.Parse(D,j);class E extends k.d{constructor(D,j){super(D,j),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=D,this._subdivisionsY=D,this.subdivide(D);const W=this;W.createOrUpdateSubmeshesOctree&&W.createOrUpdateSubmeshesOctree(j)}getHeightAtCoordinates(D,j){const W=this.getWorldMatrix(),C=Q.e.Matrix[5];W.invertToRef(C);const k=Q.e.Kd[8];if(Q.j.TransformCoordinatesFromFloatsToRef(D,0,j,C,k),D=k.x,j=k.z,D<this._minX||D>=this._maxX||j<=this._minZ||j>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const M=this._getFacetAt(D,j),O=-(M.x*D+M.z*j+M.w)/M.y;return Q.j.TransformCoordinatesFromFloatsToRef(0,O,0,W,k),k.y}getNormalAtCoordinates(D,j){const W=new Q.j(0,1,0);return this.getNormalAtCoordinatesToRef(D,j,W),W}getNormalAtCoordinatesToRef(D,j,W){const C=this.getWorldMatrix(),k=Q.e.Matrix[5];C.invertToRef(k);const M=Q.e.Kd[8];if(Q.j.TransformCoordinatesFromFloatsToRef(D,0,j,k,M),D=M.x,j=M.z,D<this._minX||D>this._maxX||j<this._minZ||j>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const O=this._getFacetAt(D,j);return Q.j.TransformNormalFromFloatsToRef(O.x,O.y,O.z,C,W),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(D,j){const W=Math.floor((D+this._maxX)*this._subdivisionsX/this._width),Q=Math.floor(-(j+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),C=this._heightQuads[Q*this._subdivisionsX+W];let k;return k=j<C.slope.x*D+C.slope.y?C.facet1:C.facet2,k}_initHeightQuads(){const D=this._subdivisionsX,j=this._subdivisionsY;this._heightQuads=new Array;for(let W=0;W<j;W++)for(let j=0;j<D;j++){const C={slope:Q.f.Zero(),facet1:new Q.m(0,0,0,0),facet2:new Q.m(0,0,0,0)};this._heightQuads[W*D+j]=C}return this}_computeHeightQuads(){const D=this.getVerticesData(O.f.PositionKind);if(!D)return this;const j=Q.e.Kd[3],W=Q.e.Kd[2],C=Q.e.Kd[1],k=Q.e.Kd[0],M=Q.e.Kd[4],E=Q.e.Kd[5],f=Q.e.Kd[6],F=Q.e.Kd[7],Z=Q.e.Kd[8];let P=0,X=0,x=0,R=0,V=0,U=0,g=0;const N=this._subdivisionsX,G=this._subdivisionsY;for(let O=0;O<G;O++)for(let G=0;G<N;G++){P=3*G,X=O*(N+1)*3,x=(O+1)*(N+1)*3,j.x=D[X+P],j.y=D[X+P+1],j.z=D[X+P+2],W.x=D[X+P+3],W.y=D[X+P+4],W.z=D[X+P+5],C.x=D[x+P],C.y=D[x+P+1],C.z=D[x+P+2],k.x=D[x+P+3],k.y=D[x+P+4],k.z=D[x+P+5],R=(k.z-j.z)/(k.x-j.x),V=j.z-R*j.x,W.subtractToRef(j,M),C.subtractToRef(j,E),k.subtractToRef(j,f),Q.j.CrossToRef(f,E,F),Q.j.CrossToRef(M,f,Z),F.normalize(),Z.normalize(),U=-(F.x*j.x+F.y*j.y+F.z*j.z),g=-(Z.x*W.x+Z.y*W.y+Z.z*W.z);const K=this._heightQuads[O*N+G];K.slope.Id(R,V),K.facet1.Id(F.x,F.y,F.z,U),K.facet2.Id(Z.x,Z.y,Z.z,g)}return this}serialize(D){super.serialize(D),D.subdivisionsX=this._subdivisionsX,D.subdivisionsY=this._subdivisionsY,D.minX=this._minX,D.maxX=this._maxX,D.qj=this._minZ,D.maxZ=this._maxZ,D.width=this._width,D.height=this._height}static Parse(D,j){const W=new E(D.name,j);return W._subdivisionsX=D.subdivisionsX||1,W._subdivisionsY=D.subdivisionsY||1,W._minX=D.minX,W._maxX=D.maxX,W._minZ=D.qj,W._maxZ=D.maxZ,W._width=D.width,W._height=D.height,W}}var f=W(1207),F=W(991),Z=W(971),P=W(1182);function X(D){const j=[],W=[],C=[],k=[];let O,E;const f=D.width||D.size||1,F=D.height||D.size||1,Z=0|(D.subdivisionsX||D.subdivisions||1),X=0|(D.subdivisionsY||D.subdivisions||1);for(O=0;O<=X;O++)for(E=0;E<=Z;E++){const D=new Q.j(E*f/Z-f/2,0,(X-O)*F/X-F/2),j=new Q.j(0,1,0);W.push(D.x,D.y,D.z),C.push(j.x,j.y,j.z),k.push(E/Z,P.b?O/X:1-O/X)}for(O=0;O<X;O++)for(E=0;E<Z;E++)j.push(E+1+(O+1)*(Z+1)),j.push(E+1+O*(Z+1)),j.push(E+O*(Z+1)),j.push(E+(O+1)*(Z+1)),j.push(E+1+(O+1)*(Z+1)),j.push(E+O*(Z+1));const x=new M.b;return x.indices=j,x.xa=W,x.ya=C,x.Aa=k,x}function x(D){const j=void 0!==D.xmin&&null!==D.xmin?D.xmin:-1,W=void 0!==D.zmin&&null!==D.zmin?D.zmin:-1,C=void 0!==D.xmax&&null!==D.xmax?D.xmax:1,k=void 0!==D.zmax&&null!==D.zmax?D.zmax:1,O=D.subdivisions||{w:1,h:1},E=D.precision||{w:1,h:1},f=[],F=[],Z=[],P=[];let X,x,R,V;O.h=O.h<1?1:O.h,O.w=O.w<1?1:O.w,E.w=E.w<1?1:E.w,E.h=E.h<1?1:E.h;const U=(C-j)/O.w,g=(k-W)/O.h;function N(D,j,W,C){const k=F.length/3,M=E.w+1;for(X=0;X<E.h;X++)for(x=0;x<E.w;x++){const D=[k+x+X*M,k+(x+1)+X*M,k+(x+1)+(X+1)*M,k+x+(X+1)*M];f.push(D[1]),f.push(D[2]),f.push(D[3]),f.push(D[0]),f.push(D[1]),f.push(D[3])}const O=Q.j.Zero(),R=new Q.j(0,1,0);for(X=0;X<=E.h;X++)for(O.z=X*(C-j)/E.h+j,x=0;x<=E.w;x++)O.x=x*(W-D)/E.w+D,O.y=0,F.push(O.x,O.y,O.z),Z.push(R.x,R.y,R.z),P.push(x/E.w,X/E.h)}for(R=0;R<O.h;R++)for(V=0;V<O.w;V++)N(j+V*U,W+R*g,j+(V+1)*U,W+(R+1)*g);const G=new M.b;return G.indices=f,G.xa=F,G.ya=Z,G.Aa=P,G}function R(D){const j=[],W=[],k=[],O=[];let E,f;const F=D.colorFilter||new C.d(.3,.59,.11),P=D.alphaFilter||0;let X=!1;if(D.minHeight>D.maxHeight){X=!0;const j=D.maxHeight;D.maxHeight=D.minHeight,D.minHeight=j}for(E=0;E<=D.subdivisions;E++)for(f=0;f<=D.subdivisions;f++){const j=new Q.j(f*D.width/D.subdivisions-D.width/2,0,(D.subdivisions-E)*D.height/D.subdivisions-D.height/2),C=4*(((j.x+D.width/2)/D.width*(D.bufferWidth-1)|0)+((1-(j.z+D.height/2)/D.height)*(D.bufferHeight-1)|0)*D.bufferWidth);let M=D.buffer[C]/255,x=D.buffer[C+1]/255,R=D.buffer[C+2]/255;const V=D.buffer[C+3]/255;X&&(M=1-M,x=1-x,R=1-R);const U=M*F.r+x*F.g+R*F.b;j.y=V>=P?D.minHeight+(D.maxHeight-D.minHeight)*U:D.minHeight-Z.c,D.heightBuffer&&(D.heightBuffer[E*(D.subdivisions+1)+f]=j.y),W.push(j.x,j.y,j.z),k.push(0,0,0),O.push(f/D.subdivisions,1-E/D.subdivisions)}for(E=0;E<D.subdivisions;E++)for(f=0;f<D.subdivisions;f++){const Q=f+1+(E+1)*(D.subdivisions+1),C=f+1+E*(D.subdivisions+1),k=f+E*(D.subdivisions+1),M=f+(E+1)*(D.subdivisions+1),O=W[3*Q+1]>=D.minHeight,F=W[3*C+1]>=D.minHeight,Z=W[3*k+1]>=D.minHeight;O&&F&&Z&&(j.push(Q),j.push(C),j.push(k));W[3*M+1]>=D.minHeight&&O&&Z&&(j.push(M),j.push(Q),j.push(k))}M.b.ComputeNormals(W,j,k);const x=new M.b;return x.indices=j,x.xa=W,x.ya=k,x.Aa=O,x}function V(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const W=new E(D,arguments.length>2?arguments[2]:void 0);W._setReady(!1),W._subdivisionsX=j.subdivisionsX||j.subdivisions||1,W._subdivisionsY=j.subdivisionsY||j.subdivisions||1,W._width=j.width||1,W._height=j.height||1,W._maxX=W._width/2,W._maxZ=W._height/2,W._minX=-W._maxX,W._minZ=-W._maxZ;return X(j).Ca(W,j.updatable),W._setReady(!0),W}function U(D,j){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=new k.d(D,W);return x(j).Ca(Q,j.updatable),Q}function g(D,j){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const k=W.width||10,M=W.height||10,O=W.subdivisions||1,Z=W.minHeight||0,P=W.maxHeight||1,X=W.colorFilter||new C.d(.3,.59,.11),x=W.alphaFilter||0,V=W.updatable,U=W.onReady;Q=Q||F.b.LastCreatedScene;const g=new E(D,Q);let N;g._subdivisionsX=O,g._subdivisionsY=O,g._width=k,g._height=M,g._maxX=g._width/2,g._maxZ=g._height/2,g._minX=-g._maxX,g._minZ=-g._maxZ,g._setReady(!1),W.passHeightBufferInCallback&&(N=new Float32Array((O+1)*(O+1)));const G=(D,j,W)=>{R({width:k,height:M,subdivisions:O,minHeight:Z,maxHeight:P,colorFilter:X,buffer:D,bufferWidth:j,bufferHeight:W,alphaFilter:x,heightBuffer:N}).Ca(g,V),U&&U(g,N),g._setReady(!0)};if("string"===typeof j){const D=D=>{var j;const W=D.width,C=D.height;if(Q.u)return;const k=null===(j=Q)||void 0===j?void 0:j.getEngine().resizeImageBitmap(D,W,C);G(k,W,C)};f.f.LoadImage(j,D,W.onError?W.onError:()=>{},Q.offlineProvider)}else G(j.data,j.width,j.height);return g}M.b.CreateGround=X,M.b.CreateTiledGround=x,M.b.CreateGroundFromHeightMap=R,k.d.CreateGround=(D,j,W,Q,C,k)=>V(D,{width:j,height:W,subdivisions:Q,updatable:k},C),k.d.CreateTiledGround=(D,j,W,Q,C,k,M,O,E)=>U(D,{xmin:j,zmin:W,xmax:Q,zmax:C,subdivisions:k,precision:M,updatable:E},O),k.d.CreateGroundFromHeightMap=(D,j,W,Q,C,k,M,O,E,f,F)=>g(D,j,{width:W,height:Q,subdivisions:C,minHeight:k,maxHeight:M,updatable:E,onReady:f,alphaFilter:F},O)},13069:(D,j,W)=>{"use strict";W.d(j,{d:()=>l,g:()=>t,k:()=>c});var Q=W(966),C=W(11994),k=W(12016),M=W(1163),O=W(1256),E=W(12707),f=W(1344),F=W(1151),Z=W(1199),P=W(936),X=W(981),x=W(1408),R=W(1028),V=W(1396),U=W(991),g=W(1386),N=W(1382);const G={effect:null,subMesh:null};class K extends V.d{constructor(D,j,W){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(D,j,!(arguments.length>4&&void 0!==arguments[4])||arguments[4]),this._textures={},this._textureArrays={},this._externalTextures={},this._floats={},this._ints={},this._uints={},this._floatsArrays={},this._colors3={},this._colors3Arrays={},this._colors4={},this._colors4Arrays={},this._vectors2={},this._vectors3={},this._vectors4={},this._quaternions={},this._quaternionsArrays={},this._matrices={},this._matrixArrays={},this._matrices3x3={},this._matrices2x2={},this._vectors2Arrays={},this._vectors3Arrays={},this._vectors4Arrays={},this._uniformBuffers={},this._textureSamplers={},this._storageBuffers={},this._cachedWorldViewMatrix=new Q.b,this._cachedWorldViewProjectionMatrix=new Q.b,this._multiview=!1,this._materialHelperNeedsPreviousMatrices=!1,this._shaderPath=W,this._options={needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","Md","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],externalTextures:[],samplerObjects:[],storageBuffers:[],defines:[],useClipPlane:!1,...C}}get shaderPath(){return this._shaderPath}set shaderPath(D){this._shaderPath=D}get options(){return this._options}get isMultiview(){return this._multiview}getClassName(){return"ShaderMaterial"}needAlphaBlending(){return this.alpha<1||this._options.needAlphaBlending}needAlphaTesting(){return this._options.needAlphaTesting}_checkUniform(D){-1===this._options.uniforms.indexOf(D)&&this._options.uniforms.push(D)}setTexture(D,j){return-1===this._options.samplers.indexOf(D)&&this._options.samplers.push(D),this._textures[D]=j,this}removeTexture(D){delete this._textures[D]}setTextureArray(D,j){return-1===this._options.samplers.indexOf(D)&&this._options.samplers.push(D),this._checkUniform(D),this._textureArrays[D]=j,this}setExternalTexture(D,j){return-1===this._options.externalTextures.indexOf(D)&&this._options.externalTextures.push(D),this._externalTextures[D]=j,this}setFloat(D,j){return this._checkUniform(D),this._floats[D]=j,this}setInt(D,j){return this._checkUniform(D),this._ints[D]=j,this}setUInt(D,j){return this._checkUniform(D),this._uints[D]=j,this}setFloats(D,j){return this._checkUniform(D),this._floatsArrays[D]=j,this}setColor3(D,j){return this._checkUniform(D),this._colors3[D]=j,this}setColor3Array(D,j){return this._checkUniform(D),this._colors3Arrays[D]=j.reduce(((D,j)=>(j.toArray(D,D.length),D)),[]),this}setColor4(D,j){return this._checkUniform(D),this._colors4[D]=j,this}setColor4Array(D,j){return this._checkUniform(D),this._colors4Arrays[D]=j.reduce(((D,j)=>(j.toArray(D,D.length),D)),[]),this}setVector2(D,j){return this._checkUniform(D),this._vectors2[D]=j,this}setVector3(D,j){return this._checkUniform(D),this._vectors3[D]=j,this}setVector4(D,j){return this._checkUniform(D),this._vectors4[D]=j,this}setQuaternion(D,j){return this._checkUniform(D),this._quaternions[D]=j,this}setQuaternionArray(D,j){return this._checkUniform(D),this._quaternionsArrays[D]=j.reduce(((D,j)=>(j.toArray(D,D.length),D)),[]),this}setMatrix(D,j){return this._checkUniform(D),this._matrices[D]=j,this}setMatrices(D,j){this._checkUniform(D);const W=new Float32Array(16*j.length);for(let Q=0;Q<j.length;Q++){j[Q].copyToArray(W,16*Q)}return this._matrixArrays[D]=W,this}setMatrix3x3(D,j){return this._checkUniform(D),this._matrices3x3[D]=j,this}setMatrix2x2(D,j){return this._checkUniform(D),this._matrices2x2[D]=j,this}setArray2(D,j){return this._checkUniform(D),this._vectors2Arrays[D]=j,this}setArray3(D,j){return this._checkUniform(D),this._vectors3Arrays[D]=j,this}setArray4(D,j){return this._checkUniform(D),this._vectors4Arrays[D]=j,this}setUniformBuffer(D,j){return-1===this._options.uniformBuffers.indexOf(D)&&this._options.uniformBuffers.push(D),this._uniformBuffers[D]=j,this}setTextureSampler(D,j){return-1===this._options.samplerObjects.indexOf(D)&&this._options.samplerObjects.push(D),this._textureSamplers[D]=j,this}setStorageBuffer(D,j){return-1===this._options.storageBuffers.indexOf(D)&&this._options.storageBuffers.push(D),this._storageBuffers[D]=j,this}setDefine(D,j){const W=D.trimEnd()+" ",Q=this.options.defines.findIndex((j=>j===D||j.startsWith(W)));return Q>=0&&this.options.defines.splice(Q,1),("boolean"!==typeof j||j)&&this.options.defines.push(W+j),this}isReadyForSubMesh(D,j,W){return this.isReady(D,W,j)}isReady(D,j,W){var Q;const C=W&&this._storeEffectOnSubMeshes;if(this.isFrozen){const D=C?W._drawWrapper:this._drawWrapper;if(D.effect&&D._wasPreviouslyReady&&D._wasPreviouslyUsingInstances===j)return!0}const k=this.va(),M=k.getEngine(),E=[],f=[],F=new x.d;let P=this._shaderPath,X=this._options.uniforms,R=this._options.uniformBuffers,V=this._options.samplers;M.getCaps().multiview&&k.activeCamera&&k.activeCamera.outputRenderTarget&&k.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,E.push("#define MULTIVIEW"),-1!==X.indexOf("viewProjection")&&-1===X.indexOf("viewProjectionR")&&X.push("viewProjectionR"));for(let O=0;O<this._options.defines.length;O++){const D=0===this._options.defines[O].indexOf("#define")?this._options.defines[O]:`#define ${this._options.defines[O]}`;E.push(D)}for(let O=0;O<this._options.attributes.length;O++)f.push(this._options.attributes[O]);if(D&&D.isVerticesDataPresent(O.f.ColorKind)&&(-1===f.indexOf(O.f.ColorKind)&&f.push(O.f.ColorKind),E.push("#define VERTEXCOLOR")),j&&(E.push("#define INSTANCES"),(0,N.$)(f,this._materialHelperNeedsPreviousMatrices),null!==D&&void 0!==D&&D.hasThinInstances&&(E.push("#define THIN_INSTANCES"),D&&D.isVerticesDataPresent(O.f.ColorInstanceKind)&&(f.push(O.f.ColorInstanceKind),E.push("#define INSTANCESCOLOR")))),D&&D.useBones&&D.computeBonesUsingShaders&&D.skeleton){f.push(O.f.MatricesIndicesKind),f.push(O.f.MatricesWeightsKind),D.numBoneInfluencers>4&&(f.push(O.f.MatricesIndicesExtraKind),f.push(O.f.MatricesWeightsExtraKind));const j=D.skeleton;E.push("#define NUM_BONE_INFLUENCERS "+D.numBoneInfluencers),F.addCPUSkinningFallback(0,D),j.isUsingTextureForMatrices?(E.push("#define BONETEXTURE"),-1===X.indexOf("boneTextureWidth")&&X.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(E.push("#define BonesPerMesh "+(j.bones.length+1)),-1===X.indexOf("mBones")&&X.push("mBones"))}else E.push("#define NUM_BONE_INFLUENCERS 0");let U=0;const K=D?D.morphTargetManager:null;if(K){const D=K.supportsUVs&&-1!==E.indexOf("#define UV1"),j=K.supportsTangents&&-1!==E.indexOf("#define TANGENT"),W=K.supportsNormals&&-1!==E.indexOf("#define NORMAL");U=K.numMaxInfluencers||K.numInfluencers,D&&E.push("#define MORPHTARGETS_UV"),j&&E.push("#define MORPHTARGETS_TANGENT"),W&&E.push("#define MORPHTARGETS_NORMAL"),U>0&&E.push("#define MORPHTARGETS"),K.isUsingTextureForTargets&&(E.push("#define MORPHTARGETS_TEXTURE"),-1===X.indexOf("morphTargetTextureIndices")&&X.push("morphTargetTextureIndices"),-1===this._options.samplers.indexOf("morphTargets")&&this._options.samplers.push("morphTargets")),E.push("#define NUM_MORPH_INFLUENCERS "+U);for(let Q=0;Q<U;Q++)f.push(O.f.PositionKind+Q),W&&f.push(O.f.NormalKind+Q),j&&f.push(O.f.TangentKind+Q),D&&f.push(O.f.UVKind+"_"+Q);U>0&&(X=X.slice(),X.push("morphTargetInfluences"),X.push("morphTargetCount"),X.push("morphTargetTextureInfo"),X.push("morphTargetTextureIndices"))}else E.push("#define NUM_MORPH_INFLUENCERS 0");if(D){const j=D.bakedVertexAnimationManager;j&&j.isEnabled&&(E.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),-1===X.indexOf("bakedVertexAnimationSettings")&&X.push("bakedVertexAnimationSettings"),-1===X.indexOf("bakedVertexAnimationTextureSizeInverted")&&X.push("bakedVertexAnimationTextureSizeInverted"),-1===X.indexOf("bakedVertexAnimationTime")&&X.push("bakedVertexAnimationTime"),-1===this._options.samplers.indexOf("bakedVertexAnimationTexture")&&this._options.samplers.push("bakedVertexAnimationTexture")),(0,N.y)(f,D,E)}for(const O in this._textures)if(!this._textures[O].isReady())return!1;D&&this._shouldTurnAlphaTestOn(D)&&E.push("#define ALPHATEST"),!1!==this._options.useClipPlane&&((0,g.e)(X),(0,g.n)(this,k,E)),k.fogEnabled&&null!==D&&void 0!==D&&D.applyFog&&k.fogMode!==Z.b.FOGMODE_NONE&&(E.push("#define FOG"),-1===X.indexOf("view")&&X.push("view"),-1===X.indexOf("vFogInfos")&&X.push("vFogInfos"),-1===X.indexOf("vFogColor")&&X.push("vFogColor")),this._useLogarithmicDepth&&(E.push("#define LOGARITHMICDEPTH"),-1===X.indexOf("logarithmicDepthConstant")&&X.push("logarithmicDepthConstant")),this.customShaderNameResolve&&(X=X.slice(),R=R.slice(),V=V.slice(),P=this.customShaderNameResolve(this.name,X,R,V,E,f));const L=C?W._getDrawWrapper(void 0,!0):this._drawWrapper,e=(null===L||void 0===L?void 0:L.effect)??null,s=(null===L||void 0===L?void 0:L.defines)??null,b=E.join("\n");let Y=e;return s!==b&&(Y=M.createEffect(P,{attributes:f,uniformsNames:X,uniformBuffersNames:R,samplers:V,defines:b,fallbacks:F,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousMorphTargets:U},shaderLanguage:this._options.shaderLanguage,extraInitializationsAsync:this._options.extraInitializationsAsync},M),C?W.setEffect(Y,b,this._materialContext):L&&L.setEffect(Y,b),this._onEffectCreatedObservable&&(G.effect=Y,G.subMesh=W??(null===D||void 0===D?void 0:D.xe[0])??null,this._onEffectCreatedObservable.notifyObservers(G))),L._wasPreviouslyUsingInstances=!!j,!((null===(Q=Y)||void 0===Q||!Q.isReady())??1)&&(e!==Y&&k.resetCachedMaterial(),L._wasPreviouslyReady=!0,!0)}bindOnlyWorldMatrix(D,j){const W=this.va(),Q=j??this.getEffect();Q&&(-1!==this._options.uniforms.indexOf("world")&&Q.setMatrix("world",D),-1!==this._options.uniforms.indexOf("worldView")&&(D.multiplyToRef(W.getViewMatrix(),this._cachedWorldViewMatrix),Q.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==this._options.uniforms.indexOf("worldViewProjection")&&(D.multiplyToRef(W.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),Q.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)),-1!==this._options.uniforms.indexOf("view")&&Q.setMatrix("view",W.getViewMatrix()))}bindForSubMesh(D,j,W){var Q;this.bind(D,j,null===(Q=W._drawWrapperOverride)||void 0===Q?void 0:Q.effect,W)}bind(D,j,W,Q){const C=Q&&this._storeEffectOnSubMeshes,k=W??(C?Q.effect:this.getEffect());if(!k)return;const M=this.va();this._activeEffect=k,this.bindOnlyWorldMatrix(D,W);const O=this._options.uniformBuffers;let E=!1;if(k&&O&&O.length>0&&M.getEngine().supportsUniformBuffers)for(let Z=0;Z<O.length;++Z){switch(O[Z]){case"Mesh":j&&(j.getMeshUniformBuffer().bindToEffect(k,"Mesh"),j.transferToEffect(D));break;case"Scene":(0,N.q)(k,M.getSceneUniformBuffer()),M.finalizeSceneUbo(),E=!0}}const f=j&&C?this._mustRebind(M,k,Q,j.visibility):M.getCachedMaterial()!==this;if(k&&f){let D;for(D in E||-1===this._options.uniforms.indexOf("view")||k.setMatrix("view",M.getViewMatrix()),E||-1===this._options.uniforms.indexOf("projection")||k.setMatrix("projection",M.getProjectionMatrix()),E||-1===this._options.uniforms.indexOf("viewProjection")||(k.setMatrix("viewProjection",M.getTransformMatrix()),this._multiview&&k.setMatrix("viewProjectionR",M._transformMatrixR)),M.activeCamera&&-1!==this._options.uniforms.indexOf("cameraPosition")&&k.setVector3("cameraPosition",M.activeCamera.globalPosition),(0,N.d)(j,k),(0,g.h)(k,this,M),this._useLogarithmicDepth&&(0,N.l)(C?Q.materialDefines:k.defines,k,M),j&&(0,N.f)(M,j,k),this._textures)k.setTexture(D,this._textures[D]);for(D in this._textureArrays)k.setTextureArray(D,this._textureArrays[D]);for(D in this._ints)k.setInt(D,this._ints[D]);for(D in this._uints)k.setUInt(D,this._uints[D]);for(D in this._floats)k.setFloat(D,this._floats[D]);for(D in this._floatsArrays)k.setArray(D,this._floatsArrays[D]);for(D in this._colors3)k.setColor3(D,this._colors3[D]);for(D in this._colors3Arrays)k.setArray3(D,this._colors3Arrays[D]);for(D in this._colors4){const j=this._colors4[D];k.setFloat4(D,j.r,j.g,j.b,j.a)}for(D in this._colors4Arrays)k.setArray4(D,this._colors4Arrays[D]);for(D in this._vectors2)k.setVector2(D,this._vectors2[D]);for(D in this._vectors3)k.setVector3(D,this._vectors3[D]);for(D in this._vectors4)k.setVector4(D,this._vectors4[D]);for(D in this._quaternions)k.setQuaternion(D,this._quaternions[D]);for(D in this._matrices)k.setMatrix(D,this._matrices[D]);for(D in this._matrixArrays)k.setMatrices(D,this._matrixArrays[D]);for(D in this._matrices3x3)k.setMatrix3x3(D,this._matrices3x3[D]);for(D in this._matrices2x2)k.setMatrix2x2(D,this._matrices2x2[D]);for(D in this._vectors2Arrays)k.setArray2(D,this._vectors2Arrays[D]);for(D in this._vectors3Arrays)k.setArray3(D,this._vectors3Arrays[D]);for(D in this._vectors4Arrays)k.setArray4(D,this._vectors4Arrays[D]);for(D in this._quaternionsArrays)k.setArray4(D,this._quaternionsArrays[D]);for(D in this._uniformBuffers){const j=this._uniformBuffers[D].getBuffer();j&&k.bindUniformBuffer(j,D)}const W=M.getEngine(),O=W.setExternalTexture;if(O)for(D in this._externalTextures)O.call(W,D,this._externalTextures[D]);const f=W.setTextureSampler;if(f)for(D in this._textureSamplers)f.call(W,D,this._textureSamplers[D]);const F=W.setStorageBuffer;if(F)for(D in this._storageBuffers)F.call(W,D,this._storageBuffers[D])}if(k&&j&&(f||!this.isFrozen)){const D=j.morphTargetManager;D&&D.numInfluencers>0&&(0,N.o)(j,k);const W=j.bakedVertexAnimationManager;if(W&&W.isEnabled){var F;const D=C?Q._drawWrapper:this._drawWrapper;null===(F=j.bakedVertexAnimationManager)||void 0===F||F.bind(k,!!D._wasPreviouslyUsingInstances)}}this._afterBind(j,k,Q)}getActiveTextures(){const D=super.getActiveTextures();for(const j in this._textures)D.push(this._textures[j]);for(const j in this._textureArrays){const W=this._textureArrays[j];for(let j=0;j<W.length;j++)D.push(W[j])}return D}hasTexture(D){if(super.hasTexture(D))return!0;for(const j in this._textures)if(this._textures[j]===D)return!0;for(const j in this._textureArrays){const W=this._textureArrays[j];for(let j=0;j<W.length;j++)if(W[j]===D)return!0}return!1}clone(D){const j=F.d.Clone((()=>new K(D,this.va(),this._shaderPath,this._options,this._storeEffectOnSubMeshes)),this);j.name=D,j.id=D,"object"===typeof j._shaderPath&&(j._shaderPath={...j._shaderPath}),this._options={...this._options},Object.keys(this._options).forEach((D=>{const j=this._options[D];Array.isArray(j)&&(this._options[D]=j.slice(0))})),this.stencil.copyTo(j.stencil);for(const W in this._textures)j.setTexture(W,this._textures[W]);for(const W in this._textureArrays)j.setTextureArray(W,this._textureArrays[W]);for(const W in this._externalTextures)j.setExternalTexture(W,this._externalTextures[W]);for(const W in this._ints)j.setInt(W,this._ints[W]);for(const W in this._uints)j.setUInt(W,this._uints[W]);for(const W in this._floats)j.setFloat(W,this._floats[W]);for(const W in this._floatsArrays)j.setFloats(W,this._floatsArrays[W]);for(const W in this._colors3)j.setColor3(W,this._colors3[W]);for(const W in this._colors3Arrays)j._colors3Arrays[W]=this._colors3Arrays[W];for(const W in this._colors4)j.setColor4(W,this._colors4[W]);for(const W in this._colors4Arrays)j._colors4Arrays[W]=this._colors4Arrays[W];for(const W in this._vectors2)j.setVector2(W,this._vectors2[W]);for(const W in this._vectors3)j.setVector3(W,this._vectors3[W]);for(const W in this._vectors4)j.setVector4(W,this._vectors4[W]);for(const W in this._quaternions)j.setQuaternion(W,this._quaternions[W]);for(const W in this._quaternionsArrays)j._quaternionsArrays[W]=this._quaternionsArrays[W];for(const W in this._matrices)j.setMatrix(W,this._matrices[W]);for(const W in this._matrixArrays)j._matrixArrays[W]=this._matrixArrays[W].slice();for(const W in this._matrices3x3)j.setMatrix3x3(W,this._matrices3x3[W]);for(const W in this._matrices2x2)j.setMatrix2x2(W,this._matrices2x2[W]);for(const W in this._vectors2Arrays)j.setArray2(W,this._vectors2Arrays[W]);for(const W in this._vectors3Arrays)j.setArray3(W,this._vectors3Arrays[W]);for(const W in this._vectors4Arrays)j.setArray4(W,this._vectors4Arrays[W]);for(const W in this._uniformBuffers)j.setUniformBuffer(W,this._uniformBuffers[W]);for(const W in this._textureSamplers)j.setTextureSampler(W,this._textureSamplers[W]);for(const W in this._storageBuffers)j.setStorageBuffer(W,this._storageBuffers[W]);return j}dispose(D,j,W){if(j){let D;for(D in this._textures)this._textures[D].dispose();for(D in this._textureArrays){const j=this._textureArrays[D];for(let D=0;D<j.length;D++)j[D].dispose()}}this._textures={},super.dispose(D,j,W)}serialize(){const D=F.d.Serialize(this);let j;for(j in D.customType="BABYLON.ShaderMaterial",D.uniqueId=this.uniqueId,D.options=this._options,D.shaderPath=this._shaderPath,D.storeEffectOnSubMeshes=this._storeEffectOnSubMeshes,D.stencil=this.stencil.serialize(),D.textures={},this._textures)D.textures[j]=this._textures[j].serialize();for(j in D.textureArrays={},this._textureArrays){D.textureArrays[j]=[];const W=this._textureArrays[j];for(let Q=0;Q<W.length;Q++)D.textureArrays[j].push(W[Q].serialize())}for(j in D.ints={},this._ints)D.ints[j]=this._ints[j];for(j in D.uints={},this._uints)D.uints[j]=this._uints[j];for(j in D.floats={},this._floats)D.floats[j]=this._floats[j];for(j in D.floatsArrays={},this._floatsArrays)D.floatsArrays[j]=this._floatsArrays[j];for(j in D.colors3={},this._colors3)D.colors3[j]=this._colors3[j].Gd();for(j in D.colors3Arrays={},this._colors3Arrays)D.colors3Arrays[j]=this._colors3Arrays[j];for(j in D.colors4={},this._colors4)D.colors4[j]=this._colors4[j].Gd();for(j in D.colors4Arrays={},this._colors4Arrays)D.colors4Arrays[j]=this._colors4Arrays[j];for(j in D.vectors2={},this._vectors2)D.vectors2[j]=this._vectors2[j].Gd();for(j in D.vectors3={},this._vectors3)D.vectors3[j]=this._vectors3[j].Gd();for(j in D.vectors4={},this._vectors4)D.vectors4[j]=this._vectors4[j].Gd();for(j in D.quaternions={},this._quaternions)D.quaternions[j]=this._quaternions[j].Gd();for(j in D.matrices={},this._matrices)D.matrices[j]=this._matrices[j].Gd();for(j in D.matrixArray={},this._matrixArrays)D.matrixArray[j]=this._matrixArrays[j];for(j in D.matrices3x3={},this._matrices3x3)D.matrices3x3[j]=this._matrices3x3[j];for(j in D.matrices2x2={},this._matrices2x2)D.matrices2x2[j]=this._matrices2x2[j];for(j in D.vectors2Arrays={},this._vectors2Arrays)D.vectors2Arrays[j]=this._vectors2Arrays[j];for(j in D.vectors3Arrays={},this._vectors3Arrays)D.vectors3Arrays[j]=this._vectors3Arrays[j];for(j in D.vectors4Arrays={},this._vectors4Arrays)D.vectors4Arrays[j]=this._vectors4Arrays[j];for(j in D.quaternionsArrays={},this._quaternionsArrays)D.quaternionsArrays[j]=this._quaternionsArrays[j];return D}static Parse(D,j,W){const C=F.d.Parse((()=>new K(D.name,j,D.shaderPath,D.options,D.storeEffectOnSubMeshes)),D,j,W);let k;for(k in D.stencil&&C.stencil.parse(D.stencil,j,W),D.textures)C.setTexture(k,P.e.Parse(D.textures[k],j,W));for(k in D.textureArrays){const Q=D.textureArrays[k],M=[];for(let D=0;D<Q.length;D++)M.push(P.e.Parse(Q[D],j,W));C.setTextureArray(k,M)}for(k in D.ints)C.setInt(k,D.ints[k]);for(k in D.uints)C.setUInt(k,D.uints[k]);for(k in D.floats)C.setFloat(k,D.floats[k]);for(k in D.floatsArrays)C.setFloats(k,D.floatsArrays[k]);for(k in D.colors3)C.setColor3(k,M.d.Dd(D.colors3[k]));for(k in D.colors3Arrays){const j=D.colors3Arrays[k].reduce(((D,j,W)=>(W%3===0?D.push([j]):D[D.length-1].push(j),D)),[]).map((D=>M.d.Dd(D)));C.setColor3Array(k,j)}for(k in D.colors4)C.setColor4(k,M.h.Dd(D.colors4[k]));for(k in D.colors4Arrays){const j=D.colors4Arrays[k].reduce(((D,j,W)=>(W%4===0?D.push([j]):D[D.length-1].push(j),D)),[]).map((D=>M.h.Dd(D)));C.setColor4Array(k,j)}for(k in D.vectors2)C.setVector2(k,Q.f.Dd(D.vectors2[k]));for(k in D.vectors3)C.setVector3(k,Q.j.Dd(D.vectors3[k]));for(k in D.vectors4)C.setVector4(k,Q.m.Dd(D.vectors4[k]));for(k in D.quaternions)C.setQuaternion(k,Q.d.Dd(D.quaternions[k]));for(k in D.matrices)C.setMatrix(k,Q.b.Dd(D.matrices[k]));for(k in D.matrixArray)C._matrixArrays[k]=new Float32Array(D.matrixArray[k]);for(k in D.matrices3x3)C.setMatrix3x3(k,D.matrices3x3[k]);for(k in D.matrices2x2)C.setMatrix2x2(k,D.matrices2x2[k]);for(k in D.vectors2Arrays)C.setArray2(k,D.vectors2Arrays[k]);for(k in D.vectors3Arrays)C.setArray3(k,D.vectors3Arrays[k]);for(k in D.vectors4Arrays)C.setArray4(k,D.vectors4Arrays[k]);for(k in D.quaternionsArrays)C.setArray4(k,D.quaternionsArrays[k]);return C}static ParseFromFileAsync(D,j,W){let Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return new Promise(((C,k)=>{const M=new R.e;M.addEventListener("readystatechange",(()=>{if(4==M.readyState)if(200==M.status){const j=JSON.parse(M.responseText),k=this.Parse(j,W||U.b.LastCreatedScene,Q);D&&(k.name=D),C(k)}else k("Unable to load the ShaderMaterial")})),M.open("GET",j),M.send()}))}static ParseFromSnippetAsync(D,j){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Promise(((Q,C)=>{const k=new R.e;k.addEventListener("readystatechange",(()=>{if(4==k.readyState)if(200==k.status){const C=JSON.parse(JSON.parse(k.responseText).jsonPayload),M=JSON.parse(C.shaderMaterial),O=this.Parse(M,j||U.b.LastCreatedScene,W);O.snippetId=D,Q(O)}else C("Unable to load the snippet "+D)})),k.open("GET",this.SnippetUrl+"/"+D.replace(/#/g,"/")),k.send()}))}}K.SnippetUrl="https://snippet.babylonjs.com",K.CreateFromSnippetAsync=K.ParseFromSnippetAsync,(0,X.c)("BABYLON.ShaderMaterial",K),C.d._LinesMeshParser=(D,j)=>L.Parse(D,j);class L extends C.d{_isShaderMaterial(D){return"ShaderMaterial"===D.getClassName()}constructor(D){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Q=arguments.length>5?arguments[5]:void 0,C=arguments.length>6?arguments[6]:void 0,k=arguments.length>7?arguments[7]:void 0;super(D,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,j,arguments.length>4?arguments[4]:void 0),this.useVertexColor=Q,this.useVertexAlpha=C,this.color=new M.d(1,1,1),this.alpha=1,this._shaderLanguage=0,j&&(this.color=j.color.clone(),this.alpha=j.alpha,this.useVertexColor=j.useVertexColor,this.useVertexAlpha=j.useVertexAlpha),this.intersectionThreshold=.1;const E={attributes:[O.f.PositionKind],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:[],useClipPlane:null,shaderLanguage:0};if(!1===C?E.needAlphaBlending=!1:E.defines.push("#define VERTEXALPHA"),Q?(E.defines.push("#define VERTEXCOLOR"),E.attributes.push(O.f.ColorKind)):(E.uniforms.push("color"),this._color4=new M.h),k)this.material=k;else{this.va().getEngine().isWebGPU&&!L.ForceGLSL&&(this._shaderLanguage=1),E.shaderLanguage=this._shaderLanguage,E.extraInitializationsAsync=async()=>{1===this._shaderLanguage?await Promise.all([W.e(19).then(W.bind(W,13432)),W.e(48).then(W.bind(W,13438))]):await Promise.all([W.e(26).then(W.bind(W,13445)),W.e(49).then(W.bind(W,13451))])},this.material=new K("colorShader",this.va(),"color",E,!1),this.material.doNotSerialize=!0}}isReady(){return!!this._lineMaterial.isReady(this,!!this._userInstancedBuffersStorage||this.hasThinInstances)&&super.isReady()}getClassName(){return"LinesMesh"}get material(){return this._lineMaterial}set material(D){this._lineMaterial=D,this._lineMaterial.fillMode=f.c.LineListDrawMode}get checkCollisions(){return!1}set checkCollisions(D){}_bind(D,j){if(!this._geometry)return this;const W=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(!this._userInstancedBuffersStorage||this.hasThinInstances?this._geometry._bind(j,W):this._geometry._bind(j,W,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects),!this.useVertexColor&&this._isShaderMaterial(this._lineMaterial)){const{r:D,g:j,b:W}=this.color;this._color4.set(D,j,W,this.alpha),this._lineMaterial.setColor4("color",this._color4)}return this}_draw(D,j,W){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const Q=this.va().getEngine();return this._unIndexed?Q.drawArraysType(f.c.LineListDrawMode,D.verticesStart,D.verticesCount,W):Q.drawElementsType(f.c.LineListDrawMode,D.indexStart,D.indexCount,W),this}dispose(D){(arguments.length>2?arguments[2]:void 0)||this._lineMaterial.dispose(!1,!1,!0),super.dispose(D)}clone(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2?arguments[2]:void 0;return new L(D,this.va(),j,this,W)}yb(D){const j=new e(D,this);if(this.instancedBuffers){j.instancedBuffers={};for(const D in this.instancedBuffers)j.instancedBuffers[D]=this.instancedBuffers[D]}return j}serialize(D){super.serialize(D),D.color=this.color.Gd(),D.alpha=this.alpha}static Parse(D,j){const W=new L(D.name,j);return W.color=M.d.Dd(D.color),W.alpha=D.alpha,W}}L.ForceGLSL=!1;class e extends E.e{constructor(D,j){super(D,j),this.intersectionThreshold=j.intersectionThreshold}getClassName(){return"InstancedLinesMesh"}}var s=W(1083);function b(D){const j=[],W=[],Q=D.lines,C=D.za,M=[];let O=0;for(let k=0;k<Q.length;k++){const D=Q[k];for(let Q=0;Q<D.length;Q++){const{x:E,y:f,z:F}=D[Q];if(W.push(E,f,F),C){const D=C[k],{r:j,g:W,b:O,a:E}=D[Q];M.push(j,W,O,E)}Q>0&&(j.push(O-1),j.push(O)),O++}}const E=new k.b;return E.indices=j,E.xa=W,C&&(E.za=M),E}function Y(D){const j=D.dashSize||3,W=D.gapSize||1,C=D.dashNb||200,M=D.points,O=[],E=[],f=Q.j.Zero();let F=0,Z=0,P=0,X=0,x=0,R=0,V=0;for(V=0;V<M.length-1;V++)M[V+1].subtractToRef(M[V],f),F+=f.length();for(P=F/C,X=j*P/(j+W),V=0;V<M.length-1;V++){M[V+1].subtractToRef(M[V],f),Z=Math.floor(f.length()/P),f.normalize();for(let D=0;D<Z;D++)x=P*D,O.push(M[V].x+x*f.x,M[V].y+x*f.y,M[V].z+x*f.z),O.push(M[V].x+(x+X)*f.x,M[V].y+(x+X)*f.y,M[V].z+(x+X)*f.z),E.push(R,R+1),R+=2}const U=new k.b;return U.xa=O,U.indices=E,U}function t(D,j){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=j.instance,C=j.lines,k=j.za;if(Q){const D=Q.getVerticesData(O.f.PositionKind);let j,W;k&&(j=Q.getVerticesData(O.f.ColorKind));let M=0,E=0;for(let Q=0;Q<C.length;Q++){const O=C[Q];for(let C=0;C<O.length;C++)D[M]=O[C].x,D[M+1]=O[C].y,D[M+2]=O[C].z,k&&j&&(W=k[Q],j[E]=W[C].r,j[E+1]=W[C].g,j[E+2]=W[C].b,j[E+3]=W[C].a,E+=4),M+=3}return Q.updateVerticesData(O.f.PositionKind,D,!1,!1),k&&j&&Q.updateVerticesData(O.f.ColorKind,j,!1,!1),Q.refreshBoundingInfo(),Q}const M=new L(D,W,null,void 0,void 0,!!k,j.useVertexAlpha,j.material);return b(j).Ca(M,j.updatable),M}function c(D,j){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=j.za?[j.za]:null;return t(D,{lines:[j.points],updatable:j.updatable,instance:j.instance,za:Q,useVertexAlpha:j.useVertexAlpha,material:j.material},W)}function l(D,j){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const k=j.points,M=j.instance,O=j.gapSize||1,E=j.dashSize||3;if(M){const D=D=>{const j=Q.j.Zero(),W=D.length/6;let C=0,O=0,E=0,f=0,F=0,Z=0,P=0,X=0;for(P=0;P<k.length-1;P++)k[P+1].subtractToRef(k[P],j),C+=j.length();E=C/W;const x=M._creationDataStorage.dashSize;for(f=x*E/(x+M._creationDataStorage.gapSize),P=0;P<k.length-1;P++)for(k[P+1].subtractToRef(k[P],j),O=Math.floor(j.length()/E),j.normalize(),X=0;X<O&&Z<D.length;)F=E*X,D[Z]=k[P].x+F*j.x,D[Z+1]=k[P].y+F*j.y,D[Z+2]=k[P].z+F*j.z,D[Z+3]=k[P].x+(F+f)*j.x,D[Z+4]=k[P].y+(F+f)*j.y,D[Z+5]=k[P].z+(F+f)*j.z,Z+=6,X++;for(;Z<D.length;)D[Z]=k[P].x,D[Z+1]=k[P].y,D[Z+2]=k[P].z,Z+=3};return(j.dashNb||j.dashSize||j.gapSize||j.useVertexAlpha||j.material)&&s.b.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),M.updateMeshPositions(D,!1),M}const f=new L(D,W,null,void 0,void 0,void 0,j.useVertexAlpha,j.material);return Y(j).Ca(f,j.updatable),f._creationDataStorage=new C.g,f._creationDataStorage.dashSize=E,f._creationDataStorage.gapSize=O,f}k.b.CreateLineSystem=b,k.b.CreateDashedLines=Y,C.d.kb=function(D,j){return c(D,{points:j,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},C.d.CreateDashedLines=function(D,j,W,Q,C){return l(D,{points:j,dashSize:W,gapSize:Q,dashNb:C,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},12107:(D,j,W)=>{"use strict";W.d(j,{c:()=>O,g:()=>E});var Q=W(11994),C=W(12016),k=W(1182);function M(D){const j=[],W=[],Q=[],M=[],O=D.width||D.size||1,E=D.height||D.size||1,f=0===D.sideOrientation?0:D.sideOrientation||C.b.DEFAULTSIDE,F=O/2,Z=E/2;W.push(-F,-Z,0),Q.push(0,0,-1),M.push(0,k.b?1:0),W.push(F,-Z,0),Q.push(0,0,-1),M.push(1,k.b?1:0),W.push(F,Z,0),Q.push(0,0,-1),M.push(1,k.b?0:1),W.push(-F,Z,0),Q.push(0,0,-1),M.push(0,k.b?0:1),j.push(0),j.push(1),j.push(2),j.push(0),j.push(2),j.push(3),C.b._ComputeSides(f,W,j,Q,M,D.frontUVs,D.backUVs);const P=new C.b;return P.indices=j,P.xa=W,P.ya=Q,P.Aa=M,P}function O(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=new Q.d(D,W);j.sideOrientation=Q.d._GetDefaultSideOrientation(j.sideOrientation),C._originalBuilderSideOrientation=j.sideOrientation;return M(j).Ca(C,j.updatable),j.sourcePlane&&(C.translate(j.sourcePlane.Md,-j.sourcePlane.d),C.setDirection(j.sourcePlane.Md.scale(-1))),C}const E={Lg:O};C.b.Lg=M,Q.d.Lg=(D,j,W,Q,C)=>O(D,{size:j,width:j,height:j,sideOrientation:C,updatable:Q},W)},12161:(D,j,W)=>{"use strict";W.d(j,{d:()=>E});var Q=W(966),C=W(11994),k=W(12016),M=W(1182);function O(D){const j=0|(D.segments||32),W=D.diameterX||D.diameter||1,C=D.diameterY||D.diameter||1,O=D.diameterZ||D.diameter||1,E=D.arc&&(D.arc<=0||D.arc>1)?1:D.arc||1,f=D.slice&&D.slice<=0?1:D.slice||1,F=0===D.sideOrientation?0:D.sideOrientation||k.b.DEFAULTSIDE,Z=!!D.dedupTopBottomIndices,P=new Q.j(W/2,C/2,O/2),X=2+j,x=2*X,R=[],V=[],U=[],g=[];for(let k=0;k<=X;k++){const D=k/X,j=D*Math.PI*f;for(let W=0;W<=x;W++){const C=W/x,k=C*Math.PI*2*E,O=Q.b.RotationZ(-j),f=Q.b.RotationY(k),F=Q.j.TransformCoordinates(Q.j.Up(),O),Z=Q.j.TransformCoordinates(F,f),X=Z.multiply(P),R=Z.divide(P).normalize();V.push(X.x,X.y,X.z),U.push(R.x,R.y,R.z),g.push(C,M.b?1-D:D)}if(k>0){const D=V.length/3;for(let j=D-2*(x+1);j+x+2<D;j++)Z?(k>1&&(R.push(j),R.push(j+1),R.push(j+x+1)),(k<X||f<1)&&(R.push(j+x+1),R.push(j+1),R.push(j+x+2))):(R.push(j),R.push(j+1),R.push(j+x+1),R.push(j+x+1),R.push(j+1),R.push(j+x+2))}}k.b._ComputeSides(F,V,R,U,g,D.frontUVs,D.backUVs);const N=new k.b;return N.indices=R,N.xa=V,N.ya=U,N.Aa=g,N}function E(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=new C.d(D,W);j.sideOrientation=C.d._GetDefaultSideOrientation(j.sideOrientation),Q._originalBuilderSideOrientation=j.sideOrientation;return O(j).Ca(Q,j.updatable),Q}k.b.CreateSphere=O,C.d.CreateSphere=(D,j,W,Q,C,k)=>E(D,{segments:j,diameterX:W,diameterY:W,diameterZ:W,sideOrientation:k,updatable:C},Q)},12746:(D,j,W)=>{"use strict";W.d(j,{e:()=>Z});var Q=W(1207),C=W(10959),k=W(12021),M=W(1256),O=W(12016),E=W(1083);function f(D,j,W,Q,C){let k=null,M=null,O=null;try{let E;k=new D.Decoder,M=new D.DecoderBuffer,M.Init(j,j.byteLength);const f=k.GetEncodedGeometryType(M);switch(f){case D.TRIANGULAR_MESH:{const j=new D.Mesh;if(E=k.DecodeBufferToMesh(M,j),!E.ok()||0===j.ptr)throw new Error(E.error_msg());const W=3*j.num_faces(),C=4*W,f=D._malloc(C);try{k.GetTrianglesUInt32Array(j,C,f);const M=new Uint32Array(W);M.set(new Uint32Array(D.HEAPF32.buffer,f,W)),Q(M)}finally{D._free(f)}O=j;break}case D.POINT_CLOUD:{const j=new D.PointCloud;if(E=k.DecodeBufferToPointCloud(M,j),!E.ok()||!j.ptr)throw new Error(E.error_msg());O=j;break}default:throw new Error(`Invalid geometry type ${f}`)}const F=O.num_points(),Z=(j,W,Q,k)=>{const M=k.data_type(),O=k.num_components(),E=k.normalized(),f=k.byte_stride(),Z=k.byte_offset(),P={[D.DT_FLOAT32]:{typedArrayConstructor:Float32Array,heap:D.HEAPF32},[D.DT_INT8]:{typedArrayConstructor:Int8Array,heap:D.HEAP8},[D.DT_INT16]:{typedArrayConstructor:Int16Array,heap:D.HEAP16},[D.DT_INT32]:{typedArrayConstructor:Int32Array,heap:D.HEAP32},[D.DT_UINT8]:{typedArrayConstructor:Uint8Array,heap:D.HEAPU8},[D.DT_UINT16]:{typedArrayConstructor:Uint16Array,heap:D.HEAPU16},[D.DT_UINT32]:{typedArrayConstructor:Uint32Array,heap:D.HEAPU32}}[M];if(!P)throw new Error(`Invalid data type ${M}`);const X=F*O,x=X*P.typedArrayConstructor.BYTES_PER_ELEMENT,R=D._malloc(x);try{j.GetAttributeDataArrayForAllPoints(W,k,M,x,R);const D=new P.typedArrayConstructor(P.heap.buffer,R,X);C(Q,D.slice(),O,Z,f,E)}finally{D._free(R)}};if(W)for(const D in W){const j=W[D],Q=k.GetAttributeByUniqueId(O,j);Z(k,O,D,Q)}else{const j={position:D.POSITION,Md:D.NORMAL,color:D.COLOR,uv:D.TEX_COORD};for(const D in j){const W=k.GetAttributeId(O,j[D]);if(-1!==W){const j=k.GetAttribute(O,W);Z(k,O,D,j)}}}return F}finally{O&&D.destroy(O),M&&D.destroy(M),k&&D.destroy(k)}}function F(){let D;onmessage=j=>{const W=j.data;switch(W.id){case"init":{const j=W.decoder;j.url&&importScripts(j.url);const Q=j.wasmBinary?{wasmBinary:j.wasmBinary}:{};D=DracoDecoderModule(Q),postMessage({id:"initDone"});break}case"decodeMesh":if(!D)throw new Error("Draco decoder module is not available");D.then((D=>{const j=f(D,W.dataView,W.attributes,(D=>{postMessage({id:"indices",data:D},[D.buffer])}),((D,j,W,Q,C,k)=>{postMessage({id:"attribute",kind:D,data:j,size:W,byteOffset:Q,byteStride:C,normalized:k},[j.buffer])}));postMessage({id:"decodeMeshDone",totalVertices:j})}))}}}class Z{static get DecoderAvailable(){const D=Z.Configuration.decoder;return!!(D.wasmUrl&&D.wasmBinaryUrl&&"object"===typeof WebAssembly||D.fallbackUrl)}static GetDefaultNumWorkers(){return"object"===typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1}static get Default(){return Z._Default||(Z._Default=new Z),Z._Default}static ResetDefault(D){Z._Default&&(D||Z._Default.dispose(),Z._Default=null)}constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Z.DefaultNumWorkers;const j=Z.Configuration.decoder;if(j.workerPool||"object"===typeof D&&D.workerPool)this._workerPoolPromise=Promise.resolve(j.workerPool||D.workerPool);else{const W=j.wasmBinary||"object"===typeof D&&D.wasmBinary,k="number"===typeof D?D:D.numWorkers,M=k&&"function"===typeof Worker&&"function"===typeof URL,O=M||!M&&!j.jsModule,E=j.wasmUrl&&j.wasmBinaryUrl&&"object"===typeof WebAssembly?{url:O?Q.f.GetBabylonScriptURL(j.wasmUrl,!0):"",wasmBinaryPromise:W?Promise.resolve(W):Q.f.LoadFileAsync(Q.f.GetBabylonScriptURL(j.wasmBinaryUrl,!0))}:{url:O?Q.f.GetBabylonScriptURL(j.fallbackUrl):"",wasmBinaryPromise:Promise.resolve(void 0)};M?this._workerPoolPromise=E.wasmBinaryPromise.then((D=>{const j=`${f}(${F})()`,W=URL.createObjectURL(new Blob([j],{type:"application/javascript"}));return new C.e(k,(()=>function(D,j,W){return new Promise(((Q,C)=>{const k=j=>{D.removeEventListener("error",k),D.removeEventListener("message",M),C(j)},M=j=>{"initDone"===j.data.id&&(D.removeEventListener("error",k),D.removeEventListener("message",M),Q(D))};if(D.addEventListener("error",k),D.addEventListener("message",M),j){const Q=j.slice(0);D.postMessage({id:"init",decoder:{url:W,wasmBinary:Q}},[Q])}else D.postMessage({id:"init",decoder:{url:W}})}))}(new Worker(W),D,E.url)))})):this._decoderModulePromise=E.wasmBinaryPromise.then((async D=>{if("undefined"===typeof DracoDecoderModule&&!j.jsModule){if(!E.url)throw new Error("Draco decoder module is not available");await Q.f.LoadBabylonScriptAsync(E.url)}return await(W=D,C=j.jsModule,new Promise((D=>{(C||DracoDecoderModule)({wasmBinary:W}).then((j=>{D({module:j})}))})));var W,C}))}}dispose(){this._workerPoolPromise&&this._workerPoolPromise.then((D=>{D.dispose()})),delete this._workerPoolPromise,delete this._decoderModulePromise}async whenReadyAsync(){this._workerPoolPromise?await this._workerPoolPromise:this._decoderModulePromise&&await this._decoderModulePromise}decodeMeshToMeshDataAsync(D,j,W){const Q=D instanceof ArrayBuffer?new Int8Array(D):new Int8Array(D.buffer,D.byteOffset,D.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((D=>new Promise(((C,k)=>{D.push(((D,M)=>{let O=null;const f=[],F=j=>{D.removeEventListener("error",F),D.removeEventListener("message",Z),k(j),M()},Z=j=>{const Q=j.data;switch(Q.id){case"decodeMeshDone":D.removeEventListener("error",F),D.removeEventListener("message",Z),C({indices:O,attributes:f,totalVertices:Q.totalVertices}),M();break;case"indices":O=Q.data;break;case"attribute":f.push({kind:Q.kind,data:Q.data,size:Q.size,byteOffset:Q.byteOffset,byteStride:Q.byteStride,normalized:(k=Q.kind,P=Q.normalized,W&&void 0!==W[k]?(P!==W[k]&&E.b.Warn(`Normalized flag from Draco data (${P}) does not match normalized flag from glTF accessor (${W[k]}). Using flag from glTF accessor.`),W[k]):P)})}var k,P};D.addEventListener("error",F),D.addEventListener("message",Z);const P=Q.slice();D.postMessage({id:"decodeMesh",dataView:P,attributes:j},[P.buffer])}))}))));if(this._decoderModulePromise)return this._decoderModulePromise.then((D=>{let W=null;const C=[],k=f(D.module,Q,j,(D=>{W=D}),((D,j,W,Q,k,M)=>{C.push({kind:D,data:j,size:W,byteOffset:Q,byteStride:k,normalized:M})}));return{indices:W,attributes:C,totalVertices:k}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(D,j,W,Q){const C=await this.decodeMeshToMeshDataAsync(W,Q),O=new k.b(D,j);C.indices&&O.setIndices(C.indices);for(const k of C.attributes)O.setVerticesBuffer(new M.f(j.getEngine(),k.data,k.kind,!1,void 0,k.byteStride,void 0,k.byteOffset,k.size,void 0,k.normalized,!0),C.totalVertices);return O}async _decodeMeshToGeometryForGltfAsync(D,j,W,Q,C){const O=await this.decodeMeshToMeshDataAsync(W,Q,C),E=new k.b(D,j);O.indices&&E.setIndices(O.indices);for(const k of O.attributes)E.setVerticesBuffer(new M.f(j.getEngine(),k.data,k.kind,!1,void 0,k.byteStride,void 0,k.byteOffset,k.size,void 0,k.normalized,!0),O.totalVertices);return E}async decodeMeshAsync(D,j){const W=await this.decodeMeshToMeshDataAsync(D,j),Q=new O.b;W.indices&&(Q.indices=W.indices);for(const C of W.attributes){const D=M.f.GetFloatData(C.data,C.size,M.f.GetDataType(C.data),C.byteOffset,C.byteStride,C.normalized,W.totalVertices);Q.set(D,C.kind)}return Q}}Z.Configuration={decoder:{wasmUrl:`${Q.f._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${Q.f._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${Q.f._DefaultCdnUrl}/draco_decoder_gltf.js`}},Z.DefaultNumWorkers=Z.GetDefaultNumWorkers(),Z._Default=null},12035:(D,j,W)=>{"use strict";W.d(j,{c:()=>e});var Q=W(942),C=W(961),k=W(966),M=W(1256),O=W(12016),E=W(12037),f=W(1247),F=W(1357),Z=W(1239);class P{constructor(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new k.j(0,0,0),this._diffPositionForCollisions=new k.j(0,0,0),this._collisionResponse=!0}}var X=W(1070),x=W(1373),R=W(1163),V=W(971),U=W(1510),g=W(981),N=W(948),G=W(1096);class K{constructor(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=k.j.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1}}class L{constructor(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new K,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=null,this._currentLODIsUpToDate=!1,this._collisionRetryCount=3,this._morphTargetManager=null,this._renderingGroupId=0,this._bakedVertexAnimationManager=null,this._material=null,this._positions=null,this._pointerOverDisableMeshTesting=!1,this._meshCollisionData=new P,this._enableDistantPicking=!1,this._rawBoundingInfo=null,this._sideOrientationHint=!1,this._inheritVisibility=!1}}class e extends E.c{static get BILLBOARDMODE_NONE(){return E.c.BILLBOARDMODE_NONE}static get BILLBOARDMODE_X(){return E.c.BILLBOARDMODE_X}static get BILLBOARDMODE_Y(){return E.c.BILLBOARDMODE_Y}static get BILLBOARDMODE_Z(){return E.c.BILLBOARDMODE_Z}static get BILLBOARDMODE_ALL(){return E.c.BILLBOARDMODE_ALL}static get BILLBOARDMODE_USE_POSITION(){return E.c.BILLBOARDMODE_USE_POSITION}get facetNb(){return this._internalAbstractMeshDataInfo._facetData.facetNb}get partitioningSubdivisions(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions}set partitioningSubdivisions(D){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=D}get partitioningBBoxRatio(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio}set partitioningBBoxRatio(D){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=D}get mustDepthSortFacets(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort}set mustDepthSortFacets(D){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=D}get facetDepthSortFrom(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom}set facetDepthSortFrom(D){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=D}get collisionRetryCount(){return this._internalAbstractMeshDataInfo._collisionRetryCount}set collisionRetryCount(D){this._internalAbstractMeshDataInfo._collisionRetryCount=D}get isFacetDataEnabled(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled}get morphTargetManager(){return this._internalAbstractMeshDataInfo._morphTargetManager}set morphTargetManager(D){this._internalAbstractMeshDataInfo._morphTargetManager!==D&&(this._internalAbstractMeshDataInfo._morphTargetManager=D,this._syncGeometryWithMorphTargetManager())}get bakedVertexAnimationManager(){return this._internalAbstractMeshDataInfo._bakedVertexAnimationManager}set bakedVertexAnimationManager(D){this._internalAbstractMeshDataInfo._bakedVertexAnimationManager!==D&&(this._internalAbstractMeshDataInfo._bakedVertexAnimationManager=D,this._markSubMeshesAsAttributesDirty())}_syncGeometryWithMorphTargetManager(){}_updateNonUniformScalingState(D){return!!super._updateNonUniformScalingState(D)&&(this._markSubMeshesAsMiscDirty(),!0)}get rawBoundingInfo(){return this._internalAbstractMeshDataInfo._rawBoundingInfo}set rawBoundingInfo(D){this._internalAbstractMeshDataInfo._rawBoundingInfo=D}set Uk(D){this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver=this.onCollideObservable.add(D)}set onCollisionPositionChange(D){this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(D)}get visibility(){return this._internalAbstractMeshDataInfo._visibility}set visibility(D){if(this._internalAbstractMeshDataInfo._visibility===D)return;const j=this._internalAbstractMeshDataInfo._visibility;this._internalAbstractMeshDataInfo._visibility=D,(1===j&&1!==D||1!==j&&1===D)&&this._markSubMeshesAsDirty((D=>{D.markAsMiscDirty(),D.markAsPrePassDirty()}))}get inheritVisibility(){return this._internalAbstractMeshDataInfo._inheritVisibility}set inheritVisibility(D){this._internalAbstractMeshDataInfo._inheritVisibility=D}get isVisible(){if(!this._isVisible||!this.inheritVisibility||!this._parentNode)return this._isVisible;if(this._isVisible){let D=this._parentNode;for(;D;){const j=D.isVisible;if("undefined"!==typeof j)return j;D=D.parent}}return this._isVisible}set isVisible(D){this._isVisible=D}get pointerOverDisableMeshTesting(){return this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting}set pointerOverDisableMeshTesting(D){this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting=D}get renderingGroupId(){return this._internalAbstractMeshDataInfo._renderingGroupId}set renderingGroupId(D){this._internalAbstractMeshDataInfo._renderingGroupId=D}get material(){return this._internalAbstractMeshDataInfo._material}set material(D){this._setMaterial(D)}_setMaterial(D){this._internalAbstractMeshDataInfo._material!==D&&(this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._material=D,D&&D.meshMap&&(D.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.xe&&(this.resetDrawCache(),this._unBindEffect()))}getMaterialForRenderPass(D){var j;return null===(j=this._internalAbstractMeshDataInfo._materialForRenderPass)||void 0===j?void 0:j[D]}setMaterialForRenderPass(D,j){this.resetDrawCache(D),this._internalAbstractMeshDataInfo._materialForRenderPass||(this._internalAbstractMeshDataInfo._materialForRenderPass=[]),this._internalAbstractMeshDataInfo._materialForRenderPass[D]=j}get receiveShadows(){return this._internalAbstractMeshDataInfo._receiveShadows}set receiveShadows(D){this._internalAbstractMeshDataInfo._receiveShadows!==D&&(this._internalAbstractMeshDataInfo._receiveShadows=D,this._markSubMeshesAsLightDirty())}get hasVertexAlpha(){return this._internalAbstractMeshDataInfo._hasVertexAlpha}set hasVertexAlpha(D){this._internalAbstractMeshDataInfo._hasVertexAlpha!==D&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=D,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())}get useVertexColors(){return this._internalAbstractMeshDataInfo._useVertexColors}set useVertexColors(D){this._internalAbstractMeshDataInfo._useVertexColors!==D&&(this._internalAbstractMeshDataInfo._useVertexColors=D,this._markSubMeshesAsAttributesDirty())}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(D){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==D&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=D,this._markSubMeshesAsAttributesDirty())}get numBoneInfluencers(){return this._internalAbstractMeshDataInfo._numBoneInfluencers}set numBoneInfluencers(D){this._internalAbstractMeshDataInfo._numBoneInfluencers!==D&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=D,this._markSubMeshesAsAttributesDirty())}get applyFog(){return this._internalAbstractMeshDataInfo._applyFog}set applyFog(D){this._internalAbstractMeshDataInfo._applyFog!==D&&(this._internalAbstractMeshDataInfo._applyFog=D,this._markSubMeshesAsMiscDirty())}get enableDistantPicking(){return this._internalAbstractMeshDataInfo._enableDistantPicking}set enableDistantPicking(D){this._internalAbstractMeshDataInfo._enableDistantPicking=D}get layerMask(){return this._internalAbstractMeshDataInfo._layerMask}set layerMask(D){D!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=D,this._resyncLightSources())}get collisionMask(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask}set collisionMask(D){this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask=isNaN(D)?-1:D}get collisionResponse(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse}set collisionResponse(D){this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse=D}get collisionGroup(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup}set collisionGroup(D){this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup=isNaN(D)?-1:D}get surroundingMeshes(){return this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes}set surroundingMeshes(D){this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes=D}get lightSources(){return this._lightSources}set skeleton(D){const j=this._internalAbstractMeshDataInfo._skeleton;j&&j.needInitialSkinMatrix&&j._unregisterMeshWithPoseMatrix(this),D&&D.needInitialSkinMatrix&&D._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=D,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()}get skeleton(){return this._internalAbstractMeshDataInfo._skeleton}constructor(D){var j;let W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;switch(super(D,W,!1),j=this,this._internalAbstractMeshDataInfo=new L,this._waitingMaterialId=null,this._waitingMorphTargetManagerId=null,this.We=e.aj,this.onCollideObservable=new C.d,this.onCollisionPositionChangeObservable=new C.d,this.onMaterialChangedObservable=new C.d,this.definedFacingForward=!0,this._occlusionQuery=null,this._renderingGroup=null,this.alphaIndex=Number.MAX_VALUE,this._isVisible=!0,this.he=!0,this.isNearPickable=!1,this.isNearGrabbable=!1,this.showSubMeshesBoundingBox=!1,this.isBlocker=!1,this.enablePointerMoveEvents=!1,this.outlineColor=R.d.Red(),this.outlineWidth=.02,this.overlayColor=R.d.Red(),this.overlayAlpha=.5,this.useOctreeForRenderingSelection=!0,this.useOctreeForPicking=!0,this.useOctreeForCollisions=!0,this.He=!1,this.Da=!1,this.actionManager=null,this.ellipsoid=new k.j(.5,1,.5),this.ellipsoidOffset=new k.j(0,0,0),this.edgesWidth=1,this.edgesColor=new R.h(1,0,0,1),this._edgesRenderer=null,this._masterMesh=null,this._boundingInfo=null,this._boundingInfoIsDirty=!0,this._renderId=0,this._intersectionsInProgress=new Array,this._unIndexed=!1,this._lightSources=new Array,this._waitingData={lods:null,actions:null,oi:null},this._bonesTransformMatrices=null,this._transformMatrixTexture=null,this.onRebuildObservable=new C.d,this._onCollisionPositionChange=function(D,W){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;W.subtractToRef(j._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,j._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),j._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions.length()>G.e.CollisionsEpsilon&&j.position.addInPlace(j._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),Q&&j.onCollideObservable.notifyObservers(Q),j.onCollisionPositionChangeObservable.notifyObservers(j.position)},W=this.va(),W.Ce(this),this._resyncLightSources(),this._uniformBuffer=new Z.e(this.va().getEngine(),void 0,void 0,D,!this.va().getEngine().isWebGPU),this._buildUniformLayout(),W.performancePriority){case 2:this.Da=!0;case 1:this.He=!0,this.he=!1}}_buildUniformLayout(){this._uniformBuffer.addUniform("world",16),this._uniformBuffer.addUniform("visibility",1),this._uniformBuffer.create()}transferToEffect(D){const j=this._uniformBuffer;j.de("world",D),j.updateFloat("visibility",this._internalAbstractMeshDataInfo._visibility),j.update()}getMeshUniformBuffer(){return this._uniformBuffer}getClassName(){return"AbstractMesh"}toString(D){let j="Name: "+this.name+", isInstance: "+("InstancedMesh"!==this.getClassName()?"YES":"NO");j+=", # of submeshes: "+(this.xe?this.xe.length:0);const W=this._internalAbstractMeshDataInfo._skeleton;return W&&(j+=", skeleton: "+W.name),D&&(j+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],j+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.oi?"YES":"NO")),j}_getEffectiveParent(){return this._masterMesh&&this.billboardMode!==E.c.BILLBOARDMODE_NONE?this._masterMesh:super._getEffectiveParent()}_getActionManagerForTrigger(D){let j=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.actionManager&&(j||this.actionManager.isRecursive)){if(!D)return this.actionManager;if(this.actionManager.hasSpecificTrigger(D))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(D,!1):null}_rebuild(){if(this.onRebuildObservable.notifyObservers(this),null!==this._occlusionQuery&&(this._occlusionQuery=null),this.xe){for(const D of this.xe)D._rebuild();this.resetDrawCache()}}_resyncLightSources(){this._lightSources.length=0;for(const D of this.va().lights)D.isEnabled()&&D.canAffectMesh(this)&&this._lightSources.push(D);this._markSubMeshesAsLightDirty()}_resyncLightSource(D){const j=D.isEnabled()&&D.canAffectMesh(this),W=this._lightSources.indexOf(D);let Q=!1;if(-1===W){if(!j)return;this._lightSources.push(D)}else{if(j)return;Q=!0,this._lightSources.splice(W,1)}this._markSubMeshesAsLightDirty(Q)}_unBindEffect(){for(const D of this.xe)D.setEffect(null)}_removeLightSource(D,j){const W=this._lightSources.indexOf(D);-1!==W&&(this._lightSources.splice(W,1),this._markSubMeshesAsLightDirty(j))}_markSubMeshesAsDirty(D){if(this.xe)for(const j of this.xe)for(let W=0;W<j._drawWrappers.length;++W){const Q=j._drawWrappers[W];Q&&Q.defines&&Q.defines.markAllAsDirty&&D(Q.defines)}}_markSubMeshesAsLightDirty(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._markSubMeshesAsDirty((j=>j.markAsLightDirty(D)))}_markSubMeshesAsAttributesDirty(){this._markSubMeshesAsDirty((D=>D.markAsAttributesDirty()))}_markSubMeshesAsMiscDirty(){this._markSubMeshesAsDirty((D=>D.markAsMiscDirty()))}Le(D){return this._currentRenderId=Number.MAX_VALUE,super.Le(D),this._isDirty=!0,this}resetDrawCache(D){if(this.xe)for(const j of this.xe)j.resetDrawCache(D)}get isBlocked(){return!1}getLOD(D){return this}getTotalVertices(){return 0}getTotalIndices(){return 0}Me(){return null}getVerticesData(D){return null}Ga(D,j,W,Q){return this}updateVerticesData(D,j,W,Q){return this}setIndices(D,j){return this}isVerticesDataPresent(D){return!1}getBoundingInfo(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfoIsDirty&&(this._boundingInfoIsDirty=!1,this.Ea()),this._boundingInfo)}getRawBoundingInfo(){return this.rawBoundingInfo??this.getBoundingInfo()}setBoundingInfo(D){return this._boundingInfo=D,this}get hasBoundingInfo(){return null!==this._boundingInfo}buildBoundingInfo(D,j,W){return this._boundingInfo=new F.d(D,j,W),this._boundingInfo}normalizeToUnitCube(){let D=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],j=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2?arguments[2]:void 0;return super.normalizeToUnitCube(D,j,W)}get useBones(){return this.skeleton&&this.va().skeletonsEnabled&&this.isVerticesDataPresent(M.f.MatricesIndicesKind)&&this.isVerticesDataPresent(M.f.MatricesWeightsKind)}_preActivate(){}_preActivateForIntermediateRendering(D){}_activate(D,j){return this._renderId=D,!0}_postActivate(){}_freeze(){}_unFreeze(){}getWorldMatrix(){return this._masterMesh&&this.billboardMode===E.c.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():super.getWorldMatrix()}_getWorldMatrixDeterminant(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():super._getWorldMatrixDeterminant()}get isAnInstance(){return!1}get hasInstances(){return!1}get hasThinInstances(){return!1}movePOV(D,j,W){return this.position.addInPlace(this.calcMovePOV(D,j,W)),this}calcMovePOV(D,j,W){const Q=new k.b;(this.rotationQuaternion?this.rotationQuaternion:k.d.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(Q);const C=k.j.Zero(),M=this.definedFacingForward?-1:1;return k.j.TransformCoordinatesFromFloatsToRef(D*M,j,W*M,Q,C),C}rotatePOV(D,j,W){return this.rotation.addInPlace(this.calcRotatePOV(D,j,W)),this}calcRotatePOV(D,j,W){const Q=this.definedFacingForward?1:-1;return new k.j(D*Q,j,W*Q)}Fa(D,j){if(D){const W=(0,x.e)(D,0,this.getTotalVertices(),j);this._boundingInfo?this._boundingInfo.reConstruct(W.minimum,W.maximum):this._boundingInfo=new F.d(W.minimum,W.maximum)}if(this.xe)for(let W=0;W<this.xe.length;W++)this.xe[W].refreshBoundingInfo(D);this.Ea()}_refreshBoundingInfoDirect(D){if(this._boundingInfo?this._boundingInfo.reConstruct(D.minimum,D.maximum):this._boundingInfo=new F.d(D.minimum,D.maximum),this.xe)for(let j=0;j<this.xe.length;j++)this.xe[j].refreshBoundingInfo(null);this.Ea()}static _ApplySkeleton(D,j,W,Q,C,O,E){!function(D,j,W,Q,C,O,E){const f=k.e.Kd[0],F=k.e.Matrix[0],Z=k.e.Matrix[1],P=j===M.f.NormalKind?k.j.TransformNormalFromFloatsToRef:k.j.TransformCoordinatesFromFloatsToRef;for(let M=0,X=0;M<D.length;M+=3,X+=4){let j,x;for(F.reset(),j=0;j<4;j++)x=C[X+j],x>0&&(k.b.FromFloat32ArrayToRefScaled(W,Math.floor(16*Q[X+j]),x,Z),F.addToSelf(Z));if(O&&E)for(j=0;j<4;j++)x=E[X+j],x>0&&(k.b.FromFloat32ArrayToRefScaled(W,Math.floor(16*O[X+j]),x,Z),F.addToSelf(Z));P(D[M],D[M+1],D[M+2],F,f),f.toArray(D,M)}}(D,j,W,Q,C,O,E)}_getData(D,j){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:M.f.PositionKind;const Q=D.cache,C=D=>{if(Q){const j=Q._vertexData||(Q._vertexData={});return j[D]||this.copyVerticesData(D,j),j[D]}return this.getVerticesData(D)};if(j||(j=C(W)),!j)return null;if(Q?(Q._outputData?Q._outputData.set(j):Q._outputData=new Float32Array(j),j=Q._outputData):(D.applyMorph&&this.morphTargetManager||D.applySkeleton&&this.skeleton)&&(j=j.slice()),D.applyMorph&&this.morphTargetManager&&function(D,j,W){let Q=null;switch(j){case M.f.PositionKind:Q=D=>D.getPositions();break;case M.f.NormalKind:Q=D=>D.getNormals();break;case M.f.TangentKind:Q=D=>D.getTangents();break;case M.f.UVKind:Q=D=>D.getUVs();break;default:return}for(let C=0;C<D.length;C++){let j=D[C];for(let k=0;k<W.numTargets;k++){const M=W.getTarget(k),O=M.influence;if(0!==O){const W=Q(M);W&&(j+=(W[C]-D[C])*O)}}D[C]=j}}(j,W,this.morphTargetManager),D.applySkeleton&&this.skeleton){const D=C(M.f.MatricesIndicesKind),Q=C(M.f.MatricesWeightsKind);if(Q&&D){const k=this.numBoneInfluencers>4,O=k?C(M.f.MatricesIndicesExtraKind):null,E=k?C(M.f.MatricesWeightsExtraKind):null,f=this.skeleton.getTransformMatrices(this);e._ApplySkeleton(j,W,f,D,Q,O,E)}}if(!1!==D.updatePositionsArray&&W===M.f.PositionKind){const D=this._internalAbstractMeshDataInfo._positions||[],W=D.length;if(D.length=j.length/3,W<D.length)for(let j=W;j<D.length;j++)D[j]=new k.j;for(let Q=0,C=0;Q<D.length;Q++,C+=3)D[Q].Id(j[C],j[C+1],j[C+2]);this._internalAbstractMeshDataInfo._positions=D}return j}getNormalsData(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0],j=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getData({applySkeleton:D,applyMorph:j,updatePositionsArray:!1},null,M.f.NormalKind)}Vf(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0],j=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this._getData({applySkeleton:D,applyMorph:j,updatePositionsArray:!1},W,M.f.PositionKind)}Ea(){return this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=new F.d(k.j.Zero(),k.j.Zero(),this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}_updateSubMeshesBoundingInfo(D){if(!this.xe)return this;const j=this.xe.length;for(let W=0;W<j;W++){const Q=this.xe[W];(j>1||!Q.IsGlobal)&&Q.updateBoundingInfo(D)}return this}_afterComputeWorldMatrix(){this.Da||(this._boundingInfoIsDirty=!0)}isInFrustum(D){return this.getBoundingInfo().isInFrustum(D,this.We)}isCompletelyInFrustum(D){return this.getBoundingInfo().isCompletelyInFrustum(D)}intersectsMesh(D){let j=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2?arguments[2]:void 0;const Q=this.getBoundingInfo(),C=D.getBoundingInfo();if(Q.intersects(C,j))return!0;if(W)for(const k of this.getChildMeshes())if(k.intersectsMesh(D,j,!0))return!0;return!1}intersectsPoint(D){return this.getBoundingInfo().intersectsPoint(D)}get checkCollisions(){return this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions}set checkCollisions(D){this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions=D}get collider(){return this._internalAbstractMeshDataInfo._meshCollisionData._collider}moveWithCollisions(D){this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions);const j=this.va().collisionCoordinator;return this._internalAbstractMeshDataInfo._meshCollisionData._collider||(this._internalAbstractMeshDataInfo._meshCollisionData._collider=j.createCollider()),this._internalAbstractMeshDataInfo._meshCollisionData._collider._radius=this.ellipsoid,j.getNewPosition(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,D,this._internalAbstractMeshDataInfo._meshCollisionData._collider,this.collisionRetryCount,this,this._onCollisionPositionChange,this.uniqueId),this}_collideForSubMesh(D,j,W){var Q;if(this._generatePointsArray(),!this._positions)return this;if(!D._lastColliderWorldVertices||!D._lastColliderTransformMatrix.equals(j)){D._lastColliderTransformMatrix=j.clone(),D._lastColliderWorldVertices=[],D._trianglePlanes=[];const W=D.verticesStart,Q=D.verticesStart+D.verticesCount;for(let C=W;C<Q;C++)D._lastColliderWorldVertices.push(k.j.TransformCoordinates(this._positions[C],j))}return W._collide(D._trianglePlanes,D._lastColliderWorldVertices,this.Me(),D.indexStart,D.indexStart+D.indexCount,D.verticesStart,!!D.Ha(),this,this._shouldConvertRHS(),7===(null===(Q=D.Ha())||void 0===Q?void 0:Q.fillMode)),this}_processCollisionsForSubMeshes(D,j){const W=this._scene.getCollidingSubMeshCandidates(this,D),Q=W.length;for(let C=0;C<Q;C++){const k=W.data[C];Q>1&&!k._checkCollision(D)||this._collideForSubMesh(k,j,D)}return this}_shouldConvertRHS(){return!1}_checkCollision(D){if(!this.getBoundingInfo()._checkCollision(D))return this;const j=k.e.Matrix[0],W=k.e.Matrix[1];return k.b.ScalingToRef(1/D._radius.x,1/D._radius.y,1/D._radius.z,j),this.worldMatrixFromCache.multiplyToRef(j,W),this._processCollisionsForSubMeshes(D,W),this}_generatePointsArray(){return!1}intersects(D,j,W){let Q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],C=arguments.length>4?arguments[4]:void 0,M=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const O=new f.c,E=this.getClassName(),F="InstancedLinesMesh"===E||"LinesMesh"===E||"GreasedLineMesh"===E?this.intersectionThreshold:0,Z=this.getBoundingInfo();if(!this.xe)return O;if(!M&&(!D.intersectsSphere(Z.boundingSphere,F)||!D.intersectsBox(Z.boundingBox,F)))return O;if(Q)return O.hit=!M,O.pickedMesh=M?null:this,O.distance=M?0:k.j.Distance(D.origin,Z.boundingSphere.center),O.subMeshId=0,O;if(!this._generatePointsArray())return O;let P=null;const X=this._scene.getIntersectingSubMeshCandidates(this,D),x=X.length;let R=!1;for(let k=0;k<x;k++){const D=X.data[k].Ha();if(D&&(7==D.fillMode||0==D.fillMode||1==D.fillMode||2==D.fillMode||4==D.fillMode)){R=!0;break}}if(!R)return O.hit=!0,O.pickedMesh=this,O.distance=k.j.Distance(D.origin,Z.boundingSphere.center),O.subMeshId=-1,O;for(let k=0;k<x;k++){const Q=X.data[k];if(x>1&&!M&&!Q.canIntersects(D))continue;const C=Q.intersects(D,this._positions,this.Me(),j,W);if(C&&(j||!P||C.distance<P.distance)&&(P=C,P.subMeshId=k,j))break}if(P){const j=C??this.getWorldMatrix(),W=k.e.Kd[0],Q=k.e.Kd[1];k.j.TransformCoordinatesToRef(D.origin,j,W),D.direction.scaleToRef(P.distance,Q);const M=k.j.TransformNormal(Q,j).addInPlace(W);return O.hit=!0,O.distance=k.j.Distance(W,M),O.pickedPoint=M,O.pickedMesh=this,O.bu=P.bu||0,O.bv=P.bv||0,O.subMeshFaceId=P.faceId,O.faceId=P.faceId+X.data[P.subMeshId].indexStart/(-1!==this.getClassName().indexOf("LinesMesh")?2:3),O.subMeshId=P.subMeshId,O}return O}clone(D,j,W){return null}releaseSubMeshes(){if(this.xe)for(;this.xe.length;)this.xe[0].dispose();else this.xe=[];return this}dispose(D){let j,W=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const Q=this.va();for(this._scene.useMaterialMeshMap&&this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),Q.freeActiveMeshes(),Q.freeRenderingGroups(),Q.renderingManager.maintainStateBetweenFrames&&Q.renderingManager.restoreDispachedFlags(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.disposeWhenUnowned&&!this._scene.meshes.some((D=>D!==this&&D.actionManager===this.actionManager))&&this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),j=0;j<this._intersectionsInProgress.length;j++){const D=this._intersectionsInProgress[j],W=D._intersectionsInProgress.indexOf(this);D._intersectionsInProgress.splice(W,1)}this._intersectionsInProgress.length=0;Q.lights.forEach((D=>{let j=D.includedOnlyMeshes.indexOf(this);-1!==j&&D.includedOnlyMeshes.splice(j,1),j=D.excludedMeshes.indexOf(this),-1!==j&&D.excludedMeshes.splice(j,1);const W=D.getShadowGenerators();if(W){const D=W.values();for(let W=D.next();!0!==W.done;W=D.next()){const D=W.value.getShadowMap();D&&D.renderList&&(j=D.renderList.indexOf(this),-1!==j&&D.renderList.splice(j,1))}}})),"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes();const C=Q.getEngine();if(null!==this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,C.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),C.wipeCaches(),Q.De(this),this._parentContainer){const D=this._parentContainer.meshes.indexOf(this);D>-1&&this._parentContainer.meshes.splice(D,1),this._parentContainer=null}if(W&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!D)for(j=0;j<Q.te.length;j++)Q.te[j].k===this&&(Q.te[j].dispose(),j--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this._uniformBuffer.dispose(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),super.dispose(D,W)}_initFacetData(){const D=this._internalAbstractMeshDataInfo._facetData;D.facetNormals||(D.facetNormals=[]),D.facetPositions||(D.facetPositions=[]),D.facetPartitioning||(D.facetPartitioning=new Array),D.facetNb=this.Me().length/3|0,D.partitioningSubdivisions=D.partitioningSubdivisions?D.partitioningSubdivisions:10,D.partitioningBBoxRatio=D.partitioningBBoxRatio?D.partitioningBBoxRatio:1.01;for(let j=0;j<D.facetNb;j++)D.facetNormals[j]=k.j.Zero(),D.facetPositions[j]=k.j.Zero();return D.facetDataEnabled=!0,this}updateFacetData(){const D=this._internalAbstractMeshDataInfo._facetData;D.facetDataEnabled||this._initFacetData();const j=this.getVerticesData(M.f.PositionKind),W=this.Me(),Q=this.getVerticesData(M.f.NormalKind),C=this.getBoundingInfo();if(D.facetDepthSort&&!D.facetDepthSortEnabled){if(D.facetDepthSortEnabled=!0,W instanceof Uint16Array)D.depthSortedIndices=new Uint16Array(W);else if(W instanceof Uint32Array)D.depthSortedIndices=new Uint32Array(W);else{let j=!1;for(let D=0;D<W.length;D++)if(W[D]>65535){j=!0;break}D.depthSortedIndices=j?new Uint32Array(W):new Uint16Array(W)}if(D.facetDepthSortFunction=function(D,j){return j.sqDistance-D.sqDistance},!D.facetDepthSortFrom){const j=this.va().activeCamera;D.facetDepthSortFrom=j?j.position:k.j.Zero()}D.depthSortedFacets=[];for(let j=0;j<D.facetNb;j++){const W={ind:3*j,sqDistance:0};D.depthSortedFacets.push(W)}D.invertedMatrix=k.b.Identity(),D.facetDepthSortOrigin=k.j.Zero()}D.bbSize.x=C.maximum.x-C.minimum.x>V.c?C.maximum.x-C.minimum.x:V.c,D.bbSize.y=C.maximum.y-C.minimum.y>V.c?C.maximum.y-C.minimum.y:V.c,D.bbSize.z=C.maximum.z-C.minimum.z>V.c?C.maximum.z-C.minimum.z:V.c;let E=D.bbSize.x>D.bbSize.y?D.bbSize.x:D.bbSize.y;if(E=E>D.bbSize.z?E:D.bbSize.z,D.subDiv.max=D.partitioningSubdivisions,D.subDiv.X=Math.floor(D.subDiv.max*D.bbSize.x/E),D.subDiv.Y=Math.floor(D.subDiv.max*D.bbSize.y/E),D.subDiv.Z=Math.floor(D.subDiv.max*D.bbSize.z/E),D.subDiv.X=D.subDiv.X<1?1:D.subDiv.X,D.subDiv.Y=D.subDiv.Y<1?1:D.subDiv.Y,D.subDiv.Z=D.subDiv.Z<1?1:D.subDiv.Z,D.facetParameters.facetNormals=this.getFacetLocalNormals(),D.facetParameters.facetPositions=this.getFacetLocalPositions(),D.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),D.facetParameters.bInfo=C,D.facetParameters.bbSize=D.bbSize,D.facetParameters.subDiv=D.subDiv,D.facetParameters.ratio=this.partitioningBBoxRatio,D.facetParameters.depthSort=D.facetDepthSort,D.facetDepthSort&&D.facetDepthSortEnabled&&(this.Ge(!0),this._worldMatrix.invertToRef(D.invertedMatrix),k.j.TransformCoordinatesToRef(D.facetDepthSortFrom,D.invertedMatrix,D.facetDepthSortOrigin),D.facetParameters.distanceTo=D.facetDepthSortOrigin),D.facetParameters.depthSortedFacets=D.depthSortedFacets,Q&&O.b.ComputeNormals(j,W,Q,D.facetParameters),D.facetDepthSort&&D.facetDepthSortEnabled){D.depthSortedFacets.sort(D.facetDepthSortFunction);const j=D.depthSortedIndices.length/3|0;for(let Q=0;Q<j;Q++){const j=D.depthSortedFacets[Q].ind;D.depthSortedIndices[3*Q]=W[j],D.depthSortedIndices[3*Q+1]=W[j+1],D.depthSortedIndices[3*Q+2]=W[j+2]}this.updateIndices(D.depthSortedIndices,void 0,!0)}return this}getFacetLocalNormals(){const D=this._internalAbstractMeshDataInfo._facetData;return D.facetNormals||this.updateFacetData(),D.facetNormals}getFacetLocalPositions(){const D=this._internalAbstractMeshDataInfo._facetData;return D.facetPositions||this.updateFacetData(),D.facetPositions}getFacetLocalPartitioning(){const D=this._internalAbstractMeshDataInfo._facetData;return D.facetPartitioning||this.updateFacetData(),D.facetPartitioning}getFacetPosition(D){const j=k.j.Zero();return this.getFacetPositionToRef(D,j),j}getFacetPositionToRef(D,j){const W=this.getFacetLocalPositions()[D],Q=this.getWorldMatrix();return k.j.TransformCoordinatesToRef(W,Q,j),this}getFacetNormal(D){const j=k.j.Zero();return this.getFacetNormalToRef(D,j),j}getFacetNormalToRef(D,j){const W=this.getFacetLocalNormals()[D];return k.j.TransformNormalToRef(W,this.getWorldMatrix(),j),this}getFacetsAtLocalCoordinates(D,j,W){const Q=this.getBoundingInfo(),C=this._internalAbstractMeshDataInfo._facetData,k=Math.floor((D-Q.minimum.x*C.partitioningBBoxRatio)*C.subDiv.X*C.partitioningBBoxRatio/C.bbSize.x),M=Math.floor((j-Q.minimum.y*C.partitioningBBoxRatio)*C.subDiv.Y*C.partitioningBBoxRatio/C.bbSize.y),O=Math.floor((W-Q.minimum.z*C.partitioningBBoxRatio)*C.subDiv.Z*C.partitioningBBoxRatio/C.bbSize.z);return k<0||k>C.subDiv.max||M<0||M>C.subDiv.max||O<0||O>C.subDiv.max?null:C.facetPartitioning[k+C.subDiv.max*M+C.subDiv.max*C.subDiv.max*O]}getClosestFacetAtCoordinates(D,j,W,Q){let C=arguments.length>4&&void 0!==arguments[4]&&arguments[4],M=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const O=this.getWorldMatrix(),E=k.e.Matrix[5];O.invertToRef(E);const f=k.e.Kd[8];k.j.TransformCoordinatesFromFloatsToRef(D,j,W,E,f);const F=this.getClosestFacetAtLocalCoordinates(f.x,f.y,f.z,Q,C,M);return Q&&k.j.TransformCoordinatesFromFloatsToRef(Q.x,Q.y,Q.z,O,Q),F}getClosestFacetAtLocalCoordinates(D,j,W,Q){let C=arguments.length>4&&void 0!==arguments[4]&&arguments[4],k=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],M=null,O=0,E=0,f=0,F=0,Z=0,P=0,X=0,x=0;const R=this.getFacetLocalPositions(),V=this.getFacetLocalNormals(),U=this.getFacetsAtLocalCoordinates(D,j,W);if(!U)return null;let g,N,G,K=Number.MAX_VALUE,L=K;for(let e=0;e<U.length;e++)g=U[e],N=V[g],G=R[g],F=(D-G.x)*N.x+(j-G.y)*N.y+(W-G.z)*N.z,(!C||C&&k&&F>=0||C&&!k&&F<=0)&&(F=N.x*G.x+N.y*G.y+N.z*G.z,Z=-(N.x*D+N.y*j+N.z*W-F)/(N.x*N.x+N.y*N.y+N.z*N.z),P=D+N.x*Z,X=j+N.y*Z,x=W+N.z*Z,O=P-D,E=X-j,f=x-W,L=O*O+E*E+f*f,L<K&&(K=L,M=g,Q&&(Q.x=P,Q.y=X,Q.z=x)));return M}getFacetDataParameters(){return this._internalAbstractMeshDataInfo._facetData.facetParameters}disableFacetData(){const D=this._internalAbstractMeshDataInfo._facetData;return D.facetDataEnabled&&(D.facetDataEnabled=!1,D.facetPositions=[],D.facetNormals=[],D.facetPartitioning=new Array,D.facetParameters=null,D.depthSortedIndices=new Uint32Array(0)),this}updateIndices(D,j){return this}createNormals(D){const j=this.getVerticesData(M.f.PositionKind),W=this.Me();let Q;return Q=this.isVerticesDataPresent(M.f.NormalKind)?this.getVerticesData(M.f.NormalKind):[],O.b.ComputeNormals(j,W,Q,{useRightHandedSystem:this.va().useRightHandedSystem}),this.Ga(M.f.NormalKind,Q,D),this}alignWithNormal(D,j){j||(j=U.c.Y);const W=k.e.Kd[0],Q=k.e.Kd[1];return k.j.CrossToRef(j,D,Q),k.j.CrossToRef(D,Q,W),this.rotationQuaternion?k.d.RotationQuaternionFromAxisToRef(W,D,Q,this.rotationQuaternion):k.j.RotationFromAxisToRef(W,D,Q,this.rotation),this}_checkOcclusionQuery(){return!1}disableEdgesRendering(){throw(0,X.d)("EdgesRenderer")}enableEdgesRendering(D,j,W){throw(0,X.d)("EdgesRenderer")}Fj(){return this._scene.te.filter((D=>D.k===this))}}e.OCCLUSION_TYPE_NONE=0,e.OCCLUSION_TYPE_OPTIMISTIC=1,e.OCCLUSION_TYPE_STRICT=2,e.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,e.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,e.CULLINGSTRATEGY_STANDARD=0,e.aj=1,e.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,e.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,(0,Q.b)([N.h.filter((function(){for(var D=arguments.length,j=new Array(D),W=0;W<D;W++)j[W]=arguments[W];let[Q,C,k,M,O]=j;return!Array.isArray(Q)&&!Array.isArray(C)&&!Array.isArray(k)&&!Array.isArray(M)&&!Array.isArray(O)}))],e,"_ApplySkeleton",null),(0,g.c)("BABYLON.AbstractMesh",e)},12021:(D,j,W)=>{"use strict";W.d(j,{b:()=>V});var Q=W(966),C=W(1163),k=W(12016),M=W(1256),O=W(1347),E=W(12028),f=W(1357),F=W(1207),Z=W(1155),P=W(1373),X=W(991),x=W(1182),R=W(1083);class V{get boundingBias(){return this._boundingBias}set boundingBias(D){this._boundingBias?this._boundingBias.p(D):this._boundingBias=D.clone(),this.Ea(!0,null)}static CreateGeometryForMesh(D){const j=new V(V.RandomId(),D.va());return j.Ca(D),j}get meshes(){return this._meshes}constructor(D,j,W){let Q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this._positionsCache=[],this._parentContainer=null,this.useBoundingInfoFromGeometry=!1,this._scene=j||X.b.LastCreatedScene,this._scene&&(this.id=D,this.uniqueId=this._scene.getUniqueId(),this._engine=this._scene.getEngine(),this._meshes=[],this._vertexBuffers={},this._indices=[],this._updatable=Q,W?this.setAllVerticesData(W,Q):this._totalVertices=0,this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),C&&(this.Ca(C),C.Ge(!0)))}get extend(){return this._extend}va(){return this._scene}getEngine(){return this._engine}isReady(){return 1===this.delayLoadState||0===this.delayLoadState}get doNotSerialize(){for(let D=0;D<this._meshes.length;D++)if(!this._meshes[D].doNotSerialize)return!1;return!0}_rebuild(){this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer"));const D=new Set;for(const j in this._vertexBuffers)D.add(this._vertexBuffers[j].getWrapperBuffer());D.forEach((D=>{D._rebuild()}))}setAllVerticesData(D,j){D.applyToGeometry(this,j),this._notifyUpdate()}Ga(D,j){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Q=arguments.length>3?arguments[3]:void 0;W&&Array.isArray(j)&&(j=new Float32Array(j));const C=new M.f(this._engine,j,D,{updatable:W,postponeInternalCreation:0===this._meshes.length,stride:Q,label:"Geometry_"+this.id+"_"+D});this.setVerticesBuffer(C)}removeVerticesData(D){this._vertexBuffers[D]&&(this._vertexBuffers[D].dispose(),delete this._vertexBuffers[D]),this._vertexArrayObjects&&this._disposeVertexArrayObjects()}setVerticesBuffer(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const C=D.getKind();this._vertexBuffers[C]&&W&&this._vertexBuffers[C].dispose(),D._buffer&&D._buffer._increaseReferences(),this._vertexBuffers[C]=D;const k=this._meshes,O=k.length;if(C===M.f.PositionKind){this._totalVertices=j??D._maxVerticesCount,this._updateExtend(D.getFloatData(this._totalVertices)),this._resetPointsArrayCache();const W=this._extend&&this._extend.minimum||new Q.j(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),C=this._extend&&this._extend.maximum||new Q.j(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);for(let D=0;D<O;D++){const j=k[D];j.buildBoundingInfo(W,C),j._createGlobalSubMesh(j.isUnIndexed),j.Ge(!0),j.synchronizeInstances()}}this._notifyUpdate(C)}updateVerticesDataDirectly(D,j,W){let Q=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const C=this.getVertexBuffer(D);C&&(C.updateDirectly(j,W,Q),this._notifyUpdate(D))}updateVerticesData(D,j){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const Q=this.getVertexBuffer(D);Q&&(Q.update(j),D===M.f.PositionKind&&this.Ea(W,j),this._notifyUpdate(D))}Ea(D,j){if(D&&this._updateExtend(j),this._resetPointsArrayCache(),D){const D=this._meshes;for(const j of D){j.hasBoundingInfo?j.getBoundingInfo().reConstruct(this._extend.minimum,this._extend.maximum):j.buildBoundingInfo(this._extend.minimum,this._extend.maximum);const D=j.xe;for(const j of D)j.refreshBoundingInfo()}}}_bind(D,j,W,Q){if(!D)return;void 0===j&&(j=this._indexBuffer);const C=this.getVertexBuffers();if(!C)return;if(j!=this._indexBuffer||!this._vertexArrayObjects&&!Q)return void this._engine.bindBuffers(C,j,D,W);const k=Q||this._vertexArrayObjects,M=this._engine;k[D.key]||(k[D.key]=M.recordVertexArrayObject(C,j,D,W)),M.bindVertexArrayObject(k[D.key],j)}getTotalVertices(){return this.isReady()?this._totalVertices:0}getVerticesData(D,j,W){const Q=this.getVertexBuffer(D);return Q?Q.getFloatData(this._totalVertices,W||j&&1!==this._meshes.length):null}copyVerticesData(D,j){const W=this.getVertexBuffer(D);if(!W)return;j[D]||(j[D]=new Float32Array(this._totalVertices*W.getSize()));const Q=W.getData();Q&&function(D,j,W,Q,C,k,O,E){const f=j*M.f.GetTypeByteLength(W),F=O*j;if(E.length!==F)throw new Error("Output length is not valid");if(W===M.f.FLOAT&&C===f)if(D instanceof Array){const j=Q/4;E.set(D,j)}else if(D instanceof ArrayBuffer){const j=new Float32Array(D,Q,F);E.set(j)}else{const j=D.byteOffset+Q;if(j%4)return R.b.Warn("CopyFloatData: copied misaligned data."),void E.set(new Float32Array(D.buffer.slice(j,j+4*F)));const W=new Float32Array(D.buffer,j,F);E.set(W)}else M.f.ForEach(D,Q,C,j,W,F,k,((D,j)=>E[j]=D))}(Q,W.getSize(),W.type,W.byteOffset,W.byteStride,W.normalized,this._totalVertices,j[D])}isVertexBufferUpdatable(D){const j=this._vertexBuffers[D];return!!j&&j.isUpdatable()}getVertexBuffer(D){return this.isReady()?this._vertexBuffers[D]:null}getVertexBuffers(){return this.isReady()?this._vertexBuffers:null}isVerticesDataPresent(D){return this._vertexBuffers?void 0!==this._vertexBuffers[D]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(D)}getVerticesDataKinds(){const D=[];let j;if(!this._vertexBuffers&&this._delayInfo)for(j in this._delayInfo)D.push(j);else for(j in this._vertexBuffers)D.push(j);return D}updateIndices(D,j){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._indexBuffer)if(this._indexBufferIsUpdatable){const Q=D.length!==this._indices.length;if(W||(this._indices=D.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,D,j),Q)for(const D of this._meshes)D._createGlobalSubMesh(!0)}else this.setIndices(D,null,!0)}setIndexBuffer(D,j,W){this._indices=[],this._indexBufferIsUpdatable=!1,this._indexBuffer=D,this._totalVertices=j,this._totalIndices=W,D.is32Bits||(D.is32Bits=this._totalIndices>65535);for(const Q of this._meshes)Q._createGlobalSubMesh(!0),Q.synchronizeInstances();this._notifyUpdate()}setIndices(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Q=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=D,this._indexBufferIsUpdatable=W,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,W,"Geometry_"+this.id+"_IndexBuffer")),void 0!=j&&(this._totalVertices=j);for(const C of this._meshes)C._createGlobalSubMesh(!Q),C.synchronizeInstances();this._notifyUpdate()}getTotalIndices(){return this.isReady()?void 0!==this._totalIndices?this._totalIndices:this._indices.length:0}Me(D,j){if(!this.isReady())return null;const W=this._indices;return j||D&&1!==this._meshes.length?W.slice():W}getIndexBuffer(){return this.isReady()?this._indexBuffer:null}_releaseVertexArrayObject(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;D&&this._vertexArrayObjects&&this._vertexArrayObjects[D.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[D.key]),delete this._vertexArrayObjects[D.key])}releaseForMesh(D,j){const W=this._meshes,Q=W.indexOf(D);-1!==Q&&(W.splice(Q,1),this._vertexArrayObjects&&D._invalidateInstanceVertexArrayObject(),D._geometry=null,0===W.length&&j&&this.dispose())}Ca(D){if(D._geometry===this)return;const j=D._geometry;j&&j.releaseForMesh(D),this._vertexArrayObjects&&D._invalidateInstanceVertexArrayObject();const W=this._meshes;D._geometry=this,D._internalAbstractMeshDataInfo._positions=null,this._scene.pushGeometry(this),W.push(D),this.isReady()?this._applyToMesh(D):this._boundingInfo&&D.setBoundingInfo(this._boundingInfo)}_updateExtend(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.useBoundingInfoFromGeometry&&this._boundingInfo)this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()};else{if(!D&&(D=this.getVerticesData(M.f.PositionKind),!D))return;this._extend=(0,P.e)(D,0,this._totalVertices,this.boundingBias,3)}}_applyToMesh(D){const j=this._meshes.length;for(const W in this._vertexBuffers)1===j&&this._vertexBuffers[W].create(),W===M.f.PositionKind&&(this._extend||this._updateExtend(),D.buildBoundingInfo(this._extend.minimum,this._extend.maximum),D._createGlobalSubMesh(D.isUnIndexed),D.Ea());1===j&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer")),D._syncGeometryWithMorphTargetManager(),D.synchronizeInstances()}_notifyUpdate(D){this.onGeometryUpdated&&this.onGeometryUpdated(this,D),this._vertexArrayObjects&&this._disposeVertexArrayObjects();for(const j of this._meshes)j._markSubMeshesAsAttributesDirty()}load(D,j){2!==this.delayLoadState&&(this.isReady()?j&&j():(this.delayLoadState=2,this._queueLoad(D,j)))}_queueLoad(D,j){this.delayLoadingFile&&(D.addPendingData(this),D._loadFile(this.delayLoadingFile,(W=>{if(!this._delayLoadingFunction)return;this._delayLoadingFunction(JSON.parse(W),this),this.delayLoadState=1,this._delayInfo=[],D.removePendingData(this);const Q=this._meshes,C=Q.length;for(let D=0;D<C;D++)this._applyToMesh(Q[D]);j&&j()}),void 0,!0))}toLeftHanded(){const D=this.Me(!1);if(null!=D&&D.length>0){for(let j=0;j<D.length;j+=3){const W=D[j+0];D[j+0]=D[j+2],D[j+2]=W}this.setIndices(D)}const j=this.getVerticesData(M.f.PositionKind,!1);if(null!=j&&j.length>0){for(let D=0;D<j.length;D+=3)j[D+2]=-j[D+2];this.Ga(M.f.PositionKind,j,!1)}const W=this.getVerticesData(M.f.NormalKind,!1);if(null!=W&&W.length>0){for(let D=0;D<W.length;D+=3)W[D+2]=-W[D+2];this.Ga(M.f.NormalKind,W,!1)}}_resetPointsArrayCache(){this._positions=null}_generatePointsArray(){if(this._positions)return!0;const D=this.getVerticesData(M.f.PositionKind);if(!D||0===D.length)return!1;for(let j=3*this._positionsCache.length,W=this._positionsCache.length;j<D.length;j+=3,++W)this._positionsCache[W]=Q.j.Dd(D,j);for(let j=0,W=0;j<D.length;j+=3,++W)this._positionsCache[W].set(D[0+j],D[1+j],D[2+j]);return this._positionsCache.length=D.length/3,this._positions=this._positionsCache,!0}u(){return this._isDisposed}_disposeVertexArrayObjects(){if(this._vertexArrayObjects){for(const W in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[W]);this._vertexArrayObjects={};const D=this._meshes,j=D.length;for(let W=0;W<j;W++)D[W]._invalidateInstanceVertexArrayObject()}}dispose(){const D=this._meshes,j=D.length;let W;for(W=0;W<j;W++)this.releaseForMesh(D[W]);this._meshes.length=0,this._disposeVertexArrayObjects();for(const Q in this._vertexBuffers)this._vertexBuffers[Q].dispose();if(this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._parentContainer){const D=this._parentContainer.geometries.indexOf(this);D>-1&&this._parentContainer.geometries.splice(D,1),this._parentContainer=null}this._isDisposed=!0}j(D){const j=new k.b;j.indices=[];const W=this.Me();if(W)for(let k=0;k<W.length;k++)j.indices.push(W[k]);let Q,C=!1,M=!1;for(Q in this._vertexBuffers){const D=this.getVerticesData(Q);if(D&&(D instanceof Float32Array?j.set(new Float32Array(D),Q):j.set(D.slice(0),Q),!M)){const D=this.getVertexBuffer(Q);D&&(C=D.isUpdatable(),M=!C)}}const O=new V(D,this._scene,j,C);for(Q in O.delayLoadState=this.delayLoadState,O.delayLoadingFile=this.delayLoadingFile,O._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)O._delayInfo=O._delayInfo||[],O._delayInfo.push(Q);return O._boundingInfo=new f.d(this._extend.minimum,this._extend.maximum),O}serialize(){const D={};return D.id=this.id,D.uniqueId=this.uniqueId,D.updatable=this._updatable,Z.e&&Z.e.HasTags(this)&&(D.tags=Z.e.GetTags(this)),D}_toNumberArray(D){return Array.isArray(D)?D:Array.prototype.slice.call(D)}clearCachedData(){this._indices=[],this._resetPointsArrayCache();for(const D in this._vertexBuffers)Object.prototype.hasOwnProperty.call(this._vertexBuffers,D)&&(this._vertexBuffers[D]._buffer._data=null)}serializeVerticeData(){const D=this.serialize();return this.isVerticesDataPresent(M.f.PositionKind)&&(D.xa=this._toNumberArray(this.getVerticesData(M.f.PositionKind)),this.isVertexBufferUpdatable(M.f.PositionKind)&&(D.xa._updatable=!0)),this.isVerticesDataPresent(M.f.NormalKind)&&(D.ya=this._toNumberArray(this.getVerticesData(M.f.NormalKind)),this.isVertexBufferUpdatable(M.f.NormalKind)&&(D.ya._updatable=!0)),this.isVerticesDataPresent(M.f.TangentKind)&&(D.tangents=this._toNumberArray(this.getVerticesData(M.f.TangentKind)),this.isVertexBufferUpdatable(M.f.TangentKind)&&(D.tangents._updatable=!0)),this.isVerticesDataPresent(M.f.UVKind)&&(D.Aa=this._toNumberArray(this.getVerticesData(M.f.UVKind)),this.isVertexBufferUpdatable(M.f.UVKind)&&(D.Aa._updatable=!0)),this.isVerticesDataPresent(M.f.UV2Kind)&&(D.uvs2=this._toNumberArray(this.getVerticesData(M.f.UV2Kind)),this.isVertexBufferUpdatable(M.f.UV2Kind)&&(D.uvs2._updatable=!0)),this.isVerticesDataPresent(M.f.UV3Kind)&&(D.uvs3=this._toNumberArray(this.getVerticesData(M.f.UV3Kind)),this.isVertexBufferUpdatable(M.f.UV3Kind)&&(D.uvs3._updatable=!0)),this.isVerticesDataPresent(M.f.UV4Kind)&&(D.uvs4=this._toNumberArray(this.getVerticesData(M.f.UV4Kind)),this.isVertexBufferUpdatable(M.f.UV4Kind)&&(D.uvs4._updatable=!0)),this.isVerticesDataPresent(M.f.UV5Kind)&&(D.uvs5=this._toNumberArray(this.getVerticesData(M.f.UV5Kind)),this.isVertexBufferUpdatable(M.f.UV5Kind)&&(D.uvs5._updatable=!0)),this.isVerticesDataPresent(M.f.UV6Kind)&&(D.uvs6=this._toNumberArray(this.getVerticesData(M.f.UV6Kind)),this.isVertexBufferUpdatable(M.f.UV6Kind)&&(D.uvs6._updatable=!0)),this.isVerticesDataPresent(M.f.ColorKind)&&(D.za=this._toNumberArray(this.getVerticesData(M.f.ColorKind)),this.isVertexBufferUpdatable(M.f.ColorKind)&&(D.za._updatable=!0)),this.isVerticesDataPresent(M.f.MatricesIndicesKind)&&(D.matricesIndices=this._toNumberArray(this.getVerticesData(M.f.MatricesIndicesKind)),D.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(M.f.MatricesIndicesKind)&&(D.matricesIndices._updatable=!0)),this.isVerticesDataPresent(M.f.MatricesWeightsKind)&&(D.matricesWeights=this._toNumberArray(this.getVerticesData(M.f.MatricesWeightsKind)),this.isVertexBufferUpdatable(M.f.MatricesWeightsKind)&&(D.matricesWeights._updatable=!0)),D.indices=this._toNumberArray(this.Me()),D}static ExtractFromMesh(D,j){const W=D._geometry;return W?W.j(j):null}static RandomId(){return F.f.RandomId()}static _GetGeometryByLoadedUniqueId(D,j){for(let W=0;W<j.geometries.length;W++)if(j.geometries[W]._loadedUniqueId===D)return j.geometries[W];return null}static _ImportGeometry(D,j){const W=j.va(),Q=D.geometryUniqueId,k=D.geometryId;if(Q||k){const D=Q?this._GetGeometryByLoadedUniqueId(Q,W):W.getGeometryById(k);D&&D.Ca(j)}else if(D instanceof ArrayBuffer){const W=j._binaryInfo;if(W.positionsAttrDesc&&W.positionsAttrDesc.count>0){const Q=new Float32Array(D,W.positionsAttrDesc.offset,W.positionsAttrDesc.count);j.Ga(M.f.PositionKind,Q,!1)}if(W.normalsAttrDesc&&W.normalsAttrDesc.count>0){const Q=new Float32Array(D,W.normalsAttrDesc.offset,W.normalsAttrDesc.count);j.Ga(M.f.NormalKind,Q,!1)}if(W.tangetsAttrDesc&&W.tangetsAttrDesc.count>0){const Q=new Float32Array(D,W.tangetsAttrDesc.offset,W.tangetsAttrDesc.count);j.Ga(M.f.TangentKind,Q,!1)}if(W.uvsAttrDesc&&W.uvsAttrDesc.count>0){const Q=new Float32Array(D,W.uvsAttrDesc.offset,W.uvsAttrDesc.count);if(x.b)for(let D=1;D<Q.length;D+=2)Q[D]=1-Q[D];j.Ga(M.f.UVKind,Q,!1)}if(W.uvs2AttrDesc&&W.uvs2AttrDesc.count>0){const Q=new Float32Array(D,W.uvs2AttrDesc.offset,W.uvs2AttrDesc.count);if(x.b)for(let D=1;D<Q.length;D+=2)Q[D]=1-Q[D];j.Ga(M.f.UV2Kind,Q,!1)}if(W.uvs3AttrDesc&&W.uvs3AttrDesc.count>0){const Q=new Float32Array(D,W.uvs3AttrDesc.offset,W.uvs3AttrDesc.count);if(x.b)for(let D=1;D<Q.length;D+=2)Q[D]=1-Q[D];j.Ga(M.f.UV3Kind,Q,!1)}if(W.uvs4AttrDesc&&W.uvs4AttrDesc.count>0){const Q=new Float32Array(D,W.uvs4AttrDesc.offset,W.uvs4AttrDesc.count);if(x.b)for(let D=1;D<Q.length;D+=2)Q[D]=1-Q[D];j.Ga(M.f.UV4Kind,Q,!1)}if(W.uvs5AttrDesc&&W.uvs5AttrDesc.count>0){const Q=new Float32Array(D,W.uvs5AttrDesc.offset,W.uvs5AttrDesc.count);if(x.b)for(let D=1;D<Q.length;D+=2)Q[D]=1-Q[D];j.Ga(M.f.UV5Kind,Q,!1)}if(W.uvs6AttrDesc&&W.uvs6AttrDesc.count>0){const Q=new Float32Array(D,W.uvs6AttrDesc.offset,W.uvs6AttrDesc.count);if(x.b)for(let D=1;D<Q.length;D+=2)Q[D]=1-Q[D];j.Ga(M.f.UV6Kind,Q,!1)}if(W.colorsAttrDesc&&W.colorsAttrDesc.count>0){const Q=new Float32Array(D,W.colorsAttrDesc.offset,W.colorsAttrDesc.count);j.Ga(M.f.ColorKind,Q,!1,W.colorsAttrDesc.stride)}if(W.matricesIndicesAttrDesc&&W.matricesIndicesAttrDesc.count>0){const Q=new Int32Array(D,W.matricesIndicesAttrDesc.offset,W.matricesIndicesAttrDesc.count),C=[];for(let D=0;D<Q.length;D++){const j=Q[D];C.push(255&j),C.push((65280&j)>>8),C.push((16711680&j)>>16),C.push(j>>24&255)}j.Ga(M.f.MatricesIndicesKind,C,!1)}if(W.matricesIndicesExtraAttrDesc&&W.matricesIndicesExtraAttrDesc.count>0){const Q=new Int32Array(D,W.matricesIndicesExtraAttrDesc.offset,W.matricesIndicesExtraAttrDesc.count),C=[];for(let D=0;D<Q.length;D++){const j=Q[D];C.push(255&j),C.push((65280&j)>>8),C.push((16711680&j)>>16),C.push(j>>24&255)}j.Ga(M.f.MatricesIndicesExtraKind,C,!1)}if(W.matricesWeightsAttrDesc&&W.matricesWeightsAttrDesc.count>0){const Q=new Float32Array(D,W.matricesWeightsAttrDesc.offset,W.matricesWeightsAttrDesc.count);j.Ga(M.f.MatricesWeightsKind,Q,!1)}if(W.indicesAttrDesc&&W.indicesAttrDesc.count>0){const Q=new Int32Array(D,W.indicesAttrDesc.offset,W.indicesAttrDesc.count);j.setIndices(Q,null)}if(W.subMeshesAttrDesc&&W.subMeshesAttrDesc.count>0){const Q=new Int32Array(D,W.subMeshesAttrDesc.offset,5*W.subMeshesAttrDesc.count);j.xe=[];for(let D=0;D<W.subMeshesAttrDesc.count;D++){const W=Q[5*D+0],C=Q[5*D+1],k=Q[5*D+2],M=Q[5*D+3],E=Q[5*D+4];O.c.AddToMesh(W,C,k,M,E,j)}}}else if(D.xa&&D.ya&&D.indices){if(j.Ga(M.f.PositionKind,D.xa,D.xa._updatable),j.Ga(M.f.NormalKind,D.ya,D.ya._updatable),D.tangents&&j.Ga(M.f.TangentKind,D.tangents,D.tangents._updatable),D.Aa&&j.Ga(M.f.UVKind,D.Aa,D.Aa._updatable),D.uvs2&&j.Ga(M.f.UV2Kind,D.uvs2,D.uvs2._updatable),D.uvs3&&j.Ga(M.f.UV3Kind,D.uvs3,D.uvs3._updatable),D.uvs4&&j.Ga(M.f.UV4Kind,D.uvs4,D.uvs4._updatable),D.uvs5&&j.Ga(M.f.UV5Kind,D.uvs5,D.uvs5._updatable),D.uvs6&&j.Ga(M.f.UV6Kind,D.uvs6,D.uvs6._updatable),D.za&&j.Ga(M.f.ColorKind,C.h.CheckColors4(D.za,D.xa.length/3),D.za._updatable),D.matricesIndices)if(D.matricesIndices._isExpanded)delete D.matricesIndices._isExpanded,j.Ga(M.f.MatricesIndicesKind,D.matricesIndices,D.matricesIndices._updatable);else{const W=[];for(let j=0;j<D.matricesIndices.length;j++){const Q=D.matricesIndices[j];W.push(255&Q),W.push((65280&Q)>>8),W.push((16711680&Q)>>16),W.push(Q>>24&255)}j.Ga(M.f.MatricesIndicesKind,W,D.matricesIndices._updatable)}if(D.matricesIndicesExtra)if(D.matricesIndicesExtra._isExpanded)delete D.matricesIndices._isExpanded,j.Ga(M.f.MatricesIndicesExtraKind,D.matricesIndicesExtra,D.matricesIndicesExtra._updatable);else{const W=[];for(let j=0;j<D.matricesIndicesExtra.length;j++){const Q=D.matricesIndicesExtra[j];W.push(255&Q),W.push((65280&Q)>>8),W.push((16711680&Q)>>16),W.push(Q>>24&255)}j.Ga(M.f.MatricesIndicesExtraKind,W,D.matricesIndicesExtra._updatable)}D.matricesWeights&&(V._CleanMatricesWeights(D,j),j.Ga(M.f.MatricesWeightsKind,D.matricesWeights,D.matricesWeights._updatable)),D.matricesWeightsExtra&&j.Ga(M.f.MatricesWeightsExtraKind,D.matricesWeightsExtra,D.matricesWeights._updatable),j.setIndices(D.indices,null)}if(D.xe){j.xe=[];for(let W=0;W<D.xe.length;W++){const Q=D.xe[W];O.c.AddToMesh(Q.materialIndex,Q.verticesStart,Q.verticesCount,Q.indexStart,Q.indexCount,j)}}j._shouldGenerateFlatShading&&(j.convertToFlatShadedMesh(),j._shouldGenerateFlatShading=!1),j.Ge(!0),W.onMeshImportedObservable.notifyObservers(j)}static _CleanMatricesWeights(D,j){const W=.001;if(!E.c.CleanBoneMatrixWeights)return;let Q=0;if(!(D.skeletonId>-1))return;{const W=j.va().getLastSkeletonById(D.skeletonId);if(!W)return;Q=W.bones.length}const C=j.getVerticesData(M.f.MatricesIndicesKind),k=j.getVerticesData(M.f.MatricesIndicesExtraKind),O=D.matricesWeights,f=D.matricesWeightsExtra,F=D.numBoneInfluencer,Z=O.length;for(let M=0;M<Z;M+=4){let D=0,j=-1;for(let Q=0;Q<4;Q++){const C=O[M+Q];D+=C,C<W&&j<0&&(j=Q)}if(f)for(let Q=0;Q<4;Q++){const C=f[M+Q];D+=C,C<W&&j<0&&(j=Q+4)}if((j<0||j>F-1)&&(j=F-1),D>W){const j=1/D;for(let D=0;D<4;D++)O[M+D]*=j;if(f)for(let D=0;D<4;D++)f[M+D]*=j}else j>=4?(f[M+j-4]=1-D,k[M+j-4]=Q):(O[M+j]=1-D,C[M+j]=Q)}j.Ga(M.f.MatricesIndicesKind,C),D.matricesWeightsExtra&&j.Ga(M.f.MatricesIndicesExtraKind,k)}static Parse(D,j,W){const C=new V(D.id,j,void 0,D.updatable);return C._loadedUniqueId=D.uniqueId,Z.e&&Z.e.AddTagsTo(C,D.tags),D.delayLoadingFile?(C.delayLoadState=4,C.delayLoadingFile=W+D.delayLoadingFile,C._boundingInfo=new f.d(Q.j.Dd(D.boundingBoxMinimum),Q.j.Dd(D.boundingBoxMaximum)),C._delayInfo=[],D.hasUVs&&C._delayInfo.push(M.f.UVKind),D.hasUVs2&&C._delayInfo.push(M.f.UV2Kind),D.hasUVs3&&C._delayInfo.push(M.f.UV3Kind),D.hasUVs4&&C._delayInfo.push(M.f.UV4Kind),D.hasUVs5&&C._delayInfo.push(M.f.UV5Kind),D.hasUVs6&&C._delayInfo.push(M.f.UV6Kind),D.hasColors&&C._delayInfo.push(M.f.ColorKind),D.hasMatricesIndices&&C._delayInfo.push(M.f.MatricesIndicesKind),D.hasMatricesWeights&&C._delayInfo.push(M.f.MatricesWeightsKind),C._delayLoadingFunction=k.b.ImportVertexData):k.b.ImportVertexData(D,C),j.pushGeometry(C,!0),C}}},12707:(D,j,W)=>{"use strict";W.d(j,{e:()=>P});var Q=W(966),C=W(1083),k=W(12035),M=W(11994),O=W(1209),E=W(12037),f=W(1256),F=W(1207),Z=W(981);M.d._instancedMeshFactory=(D,j)=>{const W=new P(D,j);if(j.instancedBuffers){W.instancedBuffers={};for(const D in j.instancedBuffers)W.instancedBuffers[D]=j.instancedBuffers[D]}return W};class P extends k.c{constructor(D,j){super(D,j.va()),this._indexInSourceMeshInstanceArray=-1,this._distanceToCamera=0,j.Tj(this),this._sourceMesh=j,this._unIndexed=j._unIndexed,this.position.p(j.position),this.rotation.p(j.rotation),this.Pd.p(j.Pd),j.rotationQuaternion&&(this.rotationQuaternion=j.rotationQuaternion.clone()),this.animations=j.animations.slice();for(const W of j.getAnimationRanges())null!=W&&this.createAnimationRange(W.name,W.from,W.to);this.infiniteDistance=j.infiniteDistance,this.setPivotMatrix(j.getPivotMatrix()),this.refreshBoundingInfo(!0,!0),this._syncSubMeshes()}getClassName(){return"InstancedMesh"}get lightSources(){return this._sourceMesh._lightSources}_resyncLightSources(){}_resyncLightSource(){}_removeLightSource(){}get receiveShadows(){return this._sourceMesh.receiveShadows}set receiveShadows(D){var j;(null===(j=this._sourceMesh)||void 0===j?void 0:j.receiveShadows)!==D&&F.f.Warn("Setting receiveShadows on an instanced mesh has no effect")}get material(){return this._sourceMesh.material}set material(D){var j;(null===(j=this._sourceMesh)||void 0===j?void 0:j.material)!==D&&F.f.Warn("Setting material on an instanced mesh has no effect")}get visibility(){return this._sourceMesh.visibility}set visibility(D){var j;(null===(j=this._sourceMesh)||void 0===j?void 0:j.visibility)!==D&&F.f.Warn("Setting visibility on an instanced mesh has no effect")}get skeleton(){return this._sourceMesh.skeleton}set skeleton(D){var j;(null===(j=this._sourceMesh)||void 0===j?void 0:j.skeleton)!==D&&F.f.Warn("Setting skeleton on an instanced mesh has no effect")}get renderingGroupId(){return this._sourceMesh.renderingGroupId}set renderingGroupId(D){this._sourceMesh&&D!==this._sourceMesh.renderingGroupId&&C.b.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")}getTotalVertices(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0}getTotalIndices(){return this._sourceMesh.getTotalIndices()}get sourceMesh(){return this._sourceMesh}yb(D){return this._sourceMesh.yb(D)}isReady(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._sourceMesh.isReady(D,!0)}getVerticesData(D,j,W){return this._sourceMesh.getVerticesData(D,j,W)}copyVerticesData(D,j){this._sourceMesh.copyVerticesData(D,j)}Ga(D,j,W,Q){return this.sourceMesh&&this.sourceMesh.Ga(D,j,W,Q),this.sourceMesh}updateVerticesData(D,j,W,Q){return this.sourceMesh&&this.sourceMesh.updateVerticesData(D,j,W,Q),this.sourceMesh}setIndices(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.sourceMesh&&this.sourceMesh.setIndices(D,j),this.sourceMesh}isVerticesDataPresent(D){return this._sourceMesh.isVerticesDataPresent(D)}Me(){return this._sourceMesh.Me()}get _positions(){return this._sourceMesh._positions}refreshBoundingInfo(){let D,j=arguments.length>0&&void 0!==arguments[0]&&arguments[0],W=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;D="object"===typeof j?j:{applySkeleton:j,applyMorph:W};const Q=this._sourceMesh.Ie?this._sourceMesh.Ie.boundingBias:null;return this.Fa(this._sourceMesh._getData(D,null,f.f.PositionKind),Q),this}_preActivate(){return this._currentLOD&&this._currentLOD._preActivate(),this}_activate(D,j){if(super._activate(D,j),this._sourceMesh.xe||C.b.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!==this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,D),j){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1}_postActivate(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)}getWorldMatrix(){if(this._currentLOD&&this._currentLOD.billboardMode!==E.c.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new Q.b);const D=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,Q.e.Kd[7].p(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.p(this._currentLOD.Ge(!0)),this._currentLOD.position.p(Q.e.Kd[7]),this._currentLOD._masterMesh=D,this._billboardWorldMatrix}return super.getWorldMatrix()}get isAnInstance(){return!0}getLOD(D){if(!D)return this;const j=this.sourceMesh.getLODLevels();if(j&&0!==j.length){const j=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(D,j.boundingSphere)}else this._currentLOD=this.sourceMesh;return this._currentLOD}_preActivateForIntermediateRendering(D){return this.sourceMesh._preActivateForIntermediateRendering(D)}_syncSubMeshes(){if(this.releaseSubMeshes(),this._sourceMesh.xe)for(let D=0;D<this._sourceMesh.xe.length;D++)this._sourceMesh.xe[D].clone(this,this._sourceMesh);return this}_generatePointsArray(){return this._sourceMesh._generatePointsArray()}Ea(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}clone(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2?arguments[2]:void 0;const Q=((arguments.length>3?arguments[3]:void 0)||this._sourceMesh).yb(D);if(O.b.DeepCopy(this,Q,["name","xe","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","Ej","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo"],[]),this.refreshBoundingInfo(),j&&(Q.parent=j),!W)for(let C=0;C<this.va().meshes.length;C++){const D=this.va().meshes[C];D.parent===this&&D.clone(D.name,Q)}return Q.Ge(!0),this.onClonedObservable.notifyObservers(Q),Q}dispose(D){let j=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._sourceMesh.Sj(this),super.dispose(D,j)}_serializeAsParent(D){super._serializeAsParent(D),D.parentId=this._sourceMesh.uniqueId,D.parentInstanceIndex=this._indexInSourceMeshInstanceArray}instantiateHierarchy(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,j=arguments.length>1?arguments[1]:void 0,W=arguments.length>2?arguments[2]:void 0;const Q=this.clone("Clone of "+(this.name||this.id),D||this.parent,!0,j&&j.newSourcedMesh);Q&&W&&W(this,Q);for(const C of this.getChildTransformNodes(!0))C.instantiateHierarchy(Q,j,W);return Q}}M.d.prototype.registerInstancedBuffer=function(D,j){var W,Q;if(null===(W=this._userInstancedBuffersStorage)||void 0===W||null===(Q=W.vertexBuffers[D])||void 0===Q||Q.dispose(),!this.instancedBuffers){this.instancedBuffers={};for(const D of this.instances)D.instancedBuffers={}}this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this.instancedBuffers[D]=null,this._userInstancedBuffersStorage.strides[D]=j,this._userInstancedBuffersStorage.sizes[D]=32*j,this._userInstancedBuffersStorage.data[D]=new Float32Array(this._userInstancedBuffersStorage.sizes[D]),this._userInstancedBuffersStorage.vertexBuffers[D]=new f.f(this.getEngine(),this._userInstancedBuffersStorage.data[D],D,!0,!1,j,!0);for(const C of this.instances)C.instancedBuffers[D]=null;this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()},M.d.prototype._processInstancedBuffers=function(D,j){const W=D?D.length:0;for(const Q in this.instancedBuffers){let C=this._userInstancedBuffersStorage.sizes[Q];const k=this._userInstancedBuffersStorage.strides[Q],M=(W+1)*k;for(;C<M;)C*=2;this._userInstancedBuffersStorage.data[Q].length!=C&&(this._userInstancedBuffersStorage.data[Q]=new Float32Array(C),this._userInstancedBuffersStorage.sizes[Q]=C,this._userInstancedBuffersStorage.vertexBuffers[Q]&&(this._userInstancedBuffersStorage.vertexBuffers[Q].dispose(),this._userInstancedBuffersStorage.vertexBuffers[Q]=null));const O=this._userInstancedBuffersStorage.data[Q];let E=0;if(j){const D=this.instancedBuffers[Q];D.toArray?D.toArray(O,E):D.copyToArray?D.copyToArray(O,E):O[E]=D,E+=k}for(let j=0;j<W;j++){const W=D[j].instancedBuffers[Q];W.toArray?W.toArray(O,E):W.copyToArray?W.copyToArray(O,E):O[E]=W,E+=k}this._userInstancedBuffersStorage.vertexBuffers[Q]?this._userInstancedBuffersStorage.vertexBuffers[Q].updateDirectly(O,0):(this._userInstancedBuffersStorage.vertexBuffers[Q]=new f.f(this.getEngine(),this._userInstancedBuffersStorage.data[Q],Q,!0,!1,k,!0),this._invalidateInstanceVertexArrayObject())}},M.d.prototype._invalidateInstanceVertexArrayObject=function(){if(this._userInstancedBuffersStorage&&void 0!==this._userInstancedBuffersStorage.vertexArrayObjects){for(const D in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[D]);this._userInstancedBuffersStorage.vertexArrayObjects={}}},M.d.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(const D in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[D]&&this._userInstancedBuffersStorage.vertexBuffers[D].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}},(0,Z.c)("BABYLON.InstancedMesh",P)},11994:(D,j,W)=>{"use strict";W.d(j,{d:()=>y,g:()=>Y});var Q=W(961),C=W(1207),k=W(1209),M=W(1155),O=W(12002),E=W(12005),f=W(966),F=W(1163),Z=W(12011),P=W(1256),X=W(12016),x=W(12021),R=W(12035),V=W(1347),U=W(1344),g=W(12040),N=W(12028),G=W(1151),K=W(1083),L=W(981),e=W(1070),s=W(1281);class b{constructor(D,j){this.distanceOrScreenCoverage=D,this.mesh=j}}class Y{}class t{constructor(){this.visibleInstances={},this.batchCache=new c,this.batchCacheReplacementModeInFrozenMode=new c,this.instancesBufferSize=2048}}class c{constructor(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=[],this.hardwareInstancedRendering=[]}}class l{constructor(){this.instancesCount=0,this.matrixBuffer=null,this.previousMatrixBuffer=null,this.matrixBufferSize=512,this.matrixData=null,this.boundingVectors=[],this.worldMatrices=null}}class I{constructor(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._useLODScreenCoverage=!1,this._effectiveMaterial=null,this._forcedInstanceCount=0,this._overrideRenderingFillMode=null}}class y extends R.c{static _GetDefaultSideOrientation(D){return D||y.FRONTSIDE}get useLODScreenCoverage(){return this._internalMeshDataInfo._useLODScreenCoverage}set useLODScreenCoverage(D){this._internalMeshDataInfo._useLODScreenCoverage=D,this._sortLODLevels()}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(D){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==D&&(D&&this._internalMeshDataInfo._sourcePositions&&(this.Ga(P.f.PositionKind,this._internalMeshDataInfo._sourcePositions,!0),this._internalMeshDataInfo._sourceNormals&&this.Ga(P.f.NormalKind,this._internalMeshDataInfo._sourceNormals,!0),this._internalMeshDataInfo._sourcePositions=null,this._internalMeshDataInfo._sourceNormals=null),this._internalAbstractMeshDataInfo._computeBonesUsingShaders=D,this._markSubMeshesAsAttributesDirty())}get onBeforeRenderObservable(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new Q.d),this._internalMeshDataInfo._onBeforeRenderObservable}get onBeforeBindObservable(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new Q.d),this._internalMeshDataInfo._onBeforeBindObservable}get onAfterRenderObservable(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new Q.d),this._internalMeshDataInfo._onAfterRenderObservable}get onBetweenPassObservable(){return this._internalMeshDataInfo._onBetweenPassObservable||(this._internalMeshDataInfo._onBetweenPassObservable=new Q.d),this._internalMeshDataInfo._onBetweenPassObservable}get onBeforeDrawObservable(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new Q.d),this._internalMeshDataInfo._onBeforeDrawObservable}set onBeforeDraw(D){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(D)}get hasInstances(){return this.instances.length>0}get hasThinInstances(){return(this.forcedInstanceCount||this._thinInstanceDataStorage.instancesCount||0)>0}get forcedInstanceCount(){return this._internalMeshDataInfo._forcedInstanceCount}set forcedInstanceCount(D){this._internalMeshDataInfo._forcedInstanceCount=D}get sideOrientation(){return this._internalMeshDataInfo._sideOrientation}set sideOrientation(D){this._internalMeshDataInfo._sideOrientation=D,this._internalAbstractMeshDataInfo._sideOrientationHint=this._scene.useRightHandedSystem&&1===D||!this._scene.useRightHandedSystem&&0===D}get overrideMaterialSideOrientation(){return this.sideOrientation}set overrideMaterialSideOrientation(D){this.sideOrientation=D,this.material&&(this.material.sideOrientation=null)}get overrideRenderingFillMode(){return this._internalMeshDataInfo._overrideRenderingFillMode}set overrideRenderingFillMode(D){this._internalMeshDataInfo._overrideRenderingFillMode=D}get material(){return this._internalAbstractMeshDataInfo._material}set material(D){D&&(this.material&&null===this.material.sideOrientation||this._internalAbstractMeshDataInfo._sideOrientationHint)&&(D.sideOrientation=null),this._setMaterial(D)}get source(){return this._internalMeshDataInfo._source}get cloneMeshMap(){return this._internalMeshDataInfo.meshMap}get isUnIndexed(){return this._unIndexed}set isUnIndexed(D){this._unIndexed!==D&&(this._unIndexed=D,this._markSubMeshesAsAttributesDirty())}get worldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesData}get previousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesPreviousData}get manualUpdateOfWorldMatrixInstancedBuffer(){return this._instanceDataStorage.manualUpdate}set manualUpdateOfWorldMatrixInstancedBuffer(D){this._instanceDataStorage.manualUpdate=D}get manualUpdateOfPreviousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.previousManualUpdate}set manualUpdateOfPreviousWorldMatrixInstancedBuffer(D){this._instanceDataStorage.previousManualUpdate=D}get forceWorldMatrixInstancedBufferUpdate(){return this._instanceDataStorage.forceMatrixUpdates}set forceWorldMatrixInstancedBufferUpdate(D){this._instanceDataStorage.forceMatrixUpdates=D}_copySource(D,j){let W=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const Q=this.va();if(D._geometry&&D._geometry.Ca(this),k.b.DeepCopy(D,this,["name","material","skeleton","instances","parent","uniqueId","source","metadata","morphTargetManager","hasInstances","worldMatrixInstancedBuffer","previousWorldMatrixInstancedBuffer","hasLODLevels","Ie","isBlocked","areNormalsFrozen","facetNb","isFacetDataEnabled","lightSources","useBones","isAnInstance","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","Ej","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","cloneMeshMap","hasBoundingInfo","physicsBody","physicsImpostor"],["_poseMatrix"]),this._internalMeshDataInfo._source=D,Q.useClonedMeshMap&&(D._internalMeshDataInfo.meshMap||(D._internalMeshDataInfo.meshMap={}),D._internalMeshDataInfo.meshMap[this.uniqueId]=this),this._originalBuilderSideOrientation=D._originalBuilderSideOrientation,this._creationDataStorage=D._creationDataStorage,D._ranges){const j=D._ranges;for(const D in j)Object.prototype.hasOwnProperty.call(j,D)&&j[D]&&this.createAnimationRange(D,j[D].from,j[D].to)}if(D.metadata&&D.metadata.clone?this.metadata=D.metadata.clone():this.metadata=D.metadata,this._internalMetadata=D._internalMetadata,M.e&&M.e.HasTags(D)&&M.e.AddTagsTo(this,M.e.GetTags(D,!0)),this.Kg(D.isEnabled(!1)),this.parent=D.parent,this.setPivotMatrix(D.getPivotMatrix(),this._postMultiplyPivotMatrix),this.id=this.name+"."+D.id,this.material=D.material,!j){const j=D.getDescendants(!0);for(let D=0;D<j.length;D++){const W=j[D];W.clone&&W.clone(this.name+"."+W.name,this)}}if(D.morphTargetManager&&(this.morphTargetManager=D.morphTargetManager),Q.getPhysicsEngine){const j=Q.getPhysicsEngine();if(W&&j)if(1===j.getPluginVersion()){const W=j.getImpostorForPhysicsObject(D);W&&(this.physicsImpostor=W.clone(this))}else 2===j.getPluginVersion()&&D.physicsBody&&D.physicsBody.clone(this)}for(let C=0;C<Q.te.length;C++){const j=Q.te[C];j.k===D&&j.clone(j.name,this)}this.skeleton=D.skeleton,this.refreshBoundingInfo(!0,!0),this.Ge(!0)}constructor(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,k=arguments.length>4?arguments[4]:void 0,M=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];super(D,j),this._internalMeshDataInfo=new I,this.delayLoadState=0,this.instances=[],this._creationDataStorage=null,this._geometry=null,this._instanceDataStorage=new t,this._thinInstanceDataStorage=new l,this._shouldGenerateFlatShading=!1,this._originalBuilderSideOrientation=y.DEFAULTSIDE,this.ignoreCameraMaxZ=!1,j=this.va(),this._scene.useRightHandedSystem?this.sideOrientation=0:this.sideOrientation=1,this._onBeforeDraw=(D,j,W)=>{D&&W&&(this._uniformBuffer?this.transferToEffect(j):W.bindOnlyWorldMatrix(j))},C&&this._copySource(C,k,M),null!==W&&(this.parent=W),this._instanceDataStorage.hardwareInstancedRendering=this.getEngine().getCaps().instancedArrays,this._internalMeshDataInfo._onMeshReadyObserverAdded=D=>{D.unregisterOnNextCall=!0,this.isReady(!0)?this.onMeshReadyObservable.notifyObservers(this):this._internalMeshDataInfo._checkReadinessObserver||(this._internalMeshDataInfo._checkReadinessObserver=this._scene.onBeforeRenderObservable.add((()=>{this.isReady(!0)&&(this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),this._internalMeshDataInfo._checkReadinessObserver=null,this.onMeshReadyObservable.notifyObservers(this))})))},this.onMeshReadyObservable=new Q.d(this._internalMeshDataInfo._onMeshReadyObserverAdded),C&&C.onClonedObservable.notifyObservers(this)}instantiateHierarchy(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,j=arguments.length>1?arguments[1]:void 0,W=arguments.length>2?arguments[2]:void 0;const Q=0===this.getTotalVertices()||j&&j.doNotInstantiate&&(!0===j.doNotInstantiate||j.doNotInstantiate(this))?this.clone("Clone of "+(this.name||this.id),D||this.parent,!0):this.yb("instance of "+(this.name||this.id));Q.parent=D||this.parent,Q.position=this.position.clone(),Q.Pd=this.Pd.clone(),this.rotationQuaternion?Q.rotationQuaternion=this.rotationQuaternion.clone():Q.rotation=this.rotation.clone(),W&&W(this,Q);for(const C of this.getChildTransformNodes(!0))"InstancedMesh"===C.getClassName()&&"Mesh"===Q.getClassName()&&C.sourceMesh===this?C.instantiateHierarchy(Q,{doNotInstantiate:j&&j.doNotInstantiate||!1,newSourcedMesh:Q},W):C.instantiateHierarchy(Q,j,W);return Q}getClassName(){return"Mesh"}get _isMesh(){return!0}toString(D){let j=super.toString(D);if(j+=", n vertices: "+this.getTotalVertices(),j+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(let W=0;W<this.animations.length;W++)j+=", animation[0]: "+this.animations[W].toString(D);if(D)if(this._geometry){const D=this.Me(),W=this.getVerticesData(P.f.PositionKind);W&&D&&(j+=", flat shading: "+(W.length/3===D.length?"YES":"NO"))}else j+=", flat shading: UNKNOWN";return j}_unBindEffect(){super._unBindEffect();for(const D of this.instances)D._unBindEffect()}get hasLODLevels(){return this._internalMeshDataInfo._LODLevels.length>0}getLODLevels(){return this._internalMeshDataInfo._LODLevels}_sortLODLevels(){const D=this._internalMeshDataInfo._useLODScreenCoverage?-1:1;this._internalMeshDataInfo._LODLevels.sort(((j,W)=>j.distanceOrScreenCoverage<W.distanceOrScreenCoverage?D:j.distanceOrScreenCoverage>W.distanceOrScreenCoverage?-D:0))}addLODLevel(D,j){if(j&&j._masterMesh)return K.b.Warn("You cannot use a mesh as LOD level twice"),this;const W=new b(D,j);return this._internalMeshDataInfo._LODLevels.push(W),j&&(j._masterMesh=this),this._sortLODLevels(),this}getLODLevelAtDistance(D){const j=this._internalMeshDataInfo;for(let W=0;W<j._LODLevels.length;W++){const Q=j._LODLevels[W];if(Q.distanceOrScreenCoverage===D)return Q.mesh}return null}removeLODLevel(D){const j=this._internalMeshDataInfo;for(let W=0;W<j._LODLevels.length;W++)j._LODLevels[W].mesh===D&&(j._LODLevels.splice(W,1),D&&(D._masterMesh=null));return this._sortLODLevels(),this}getLOD(D,j){const W=this._internalMeshDataInfo;if(!W._LODLevels||0===W._LODLevels.length)return this;const Q=j||this.getBoundingInfo().boundingSphere,C=D.mode===E.d.ORTHOGRAPHIC_CAMERA?D.qj:Q.centerWorld.Qc(D.globalPosition).length();let k=C,M=1;if(W._useLODScreenCoverage){const j=D.screenArea;let W=Q.radiusWorld*D.qj/C;W=W*W*Math.PI,k=W/j,M=-1}if(M*W._LODLevels[W._LODLevels.length-1].distanceOrScreenCoverage>M*k)return this.onLODLevelSelection&&this.onLODLevelSelection(k,this,this),this;for(let O=0;O<W._LODLevels.length;O++){const D=W._LODLevels[O];if(M*D.distanceOrScreenCoverage<M*k){if(D.mesh){if(4===D.mesh.delayLoadState)return D.mesh._checkDelayState(),this;if(2===D.mesh.delayLoadState)return this;D.mesh._preActivate(),D.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)}return this.onLODLevelSelection&&this.onLODLevelSelection(k,this,D.mesh),D.mesh}}return this.onLODLevelSelection&&this.onLODLevelSelection(k,this,this),this}get Ie(){return this._geometry}getTotalVertices(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()}getVerticesData(D,j,W,Q){var C,k;if(!this._geometry)return null;let M=Q||null===(C=this._userInstancedBuffersStorage)||void 0===C||null===(k=C.vertexBuffers[D])||void 0===k?void 0:k.getFloatData(this.instances.length+1,W||j&&1!==this._geometry.meshes.length);return M||(M=this._geometry.getVerticesData(D,j,W)),M}copyVerticesData(D,j){this._geometry&&this._geometry.copyVerticesData(D,j)}getVertexBuffer(D,j){var W;return this._geometry?(j||null===(W=this._userInstancedBuffersStorage)||void 0===W?void 0:W.vertexBuffers[D])??this._geometry.getVertexBuffer(D):null}isVerticesDataPresent(D,j){var W;return this._geometry?!j&&void 0!==(null===(W=this._userInstancedBuffersStorage)||void 0===W?void 0:W.vertexBuffers[D])||this._geometry.isVerticesDataPresent(D):!!this._delayInfo&&-1!==this._delayInfo.indexOf(D)}isVertexBufferUpdatable(D,j){if(!this._geometry)return!!this._delayInfo&&-1!==this._delayInfo.indexOf(D);if(!j){var W;const j=null===(W=this._userInstancedBuffersStorage)||void 0===W?void 0:W.vertexBuffers[D];if(j)return j.isUpdatable()}return this._geometry.isVertexBufferUpdatable(D)}getVerticesDataKinds(D){if(!this._geometry){const D=[];return this._delayInfo&&this._delayInfo.forEach((function(j){D.push(j)})),D}const j=this._geometry.getVerticesDataKinds();if(!D&&this._userInstancedBuffersStorage)for(const W in this._userInstancedBuffersStorage.vertexBuffers)-1===j.indexOf(W)&&j.push(W);return j}getTotalIndices(){return this._geometry?this._geometry.getTotalIndices():0}Me(D,j){return this._geometry?this._geometry.Me(D,j):[]}get isBlocked(){return null!==this._masterMesh&&void 0!==this._masterMesh}isReady(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0],j=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(2===this.delayLoadState)return!1;if(!super.isReady(D))return!1;if(!this.xe||0===this.xe.length)return!0;if(!D)return!0;const W=this.getEngine(),Q=this.va(),C=j||W.getCaps().instancedArrays&&(this.instances.length>0||this.hasThinInstances);this.Ge();const k=this.material||Q.defaultMaterial;if(k)if(k._storeEffectOnSubMeshes)for(const P of this.xe){const D=P.Ha();if(D)if(D._storeEffectOnSubMeshes){if(!D.isReadyForSubMesh(this,P,C))return!1}else if(!D.isReady(this,C))return!1}else if(!k.isReady(this,C))return!1;const M=W.currentRenderPassId;for(const P of this.lightSources){const D=P.getShadowGenerators();if(!D)continue;const j=D.values();for(let Q=j.next();!0!==Q.done;Q=j.next()){var O,E,f,F;const D=Q.value;if(D&&(null===(O=D.getShadowMap())||void 0===O||!O.renderList||null!==(E=D.getShadowMap())&&void 0!==E&&E.renderList&&-1!==(null===(f=D.getShadowMap())||void 0===f||null===(F=f.renderList)||void 0===F?void 0:F.indexOf(this)))){const j=D.getShadowMap().renderPassIds??[W.currentRenderPassId];for(let Q=0;Q<j.length;++Q){W.currentRenderPassId=j[Q];for(const j of this.xe){var Z;if(!D.isReady(j,C,(null===(Z=j.Ha())||void 0===Z?void 0:Z.needAlphaBlendingForMesh(this))??!1))return W.currentRenderPassId=M,!1}}W.currentRenderPassId=M}}}for(const P of this._internalMeshDataInfo._LODLevels)if(P.mesh&&!P.mesh.isReady(C))return!1;return!0}get areNormalsFrozen(){return this._internalMeshDataInfo._areNormalsFrozen}mi(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this}unfreezeNormals(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this}set overridenInstanceCount(D){this._instanceDataStorage.overridenInstanceCount=D}_preActivate(){const D=this._internalMeshDataInfo,j=this.va().getRenderId();return D._preActivateId===j||(D._preActivateId=j,this._instanceDataStorage.visibleInstances=null),this}_preActivateForIntermediateRendering(D){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=D),this}_registerInstanceForRenderId(D,j){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:j,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[j]||(void 0!==this._instanceDataStorage.previousRenderId&&this._instanceDataStorage.isFrozen&&(this._instanceDataStorage.visibleInstances[this._instanceDataStorage.previousRenderId]=null),this._instanceDataStorage.previousRenderId=j,this._instanceDataStorage.visibleInstances[j]=new Array),this._instanceDataStorage.visibleInstances[j].push(D),this}_afterComputeWorldMatrix(){super._afterComputeWorldMatrix(),this.hasThinInstances&&(this.Da||this.thinInstanceRefreshBoundingInfo(!1))}_postActivate(){this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup&&(this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer),this.edgesRenderer.customInstances.push(this.getWorldMatrix()))}refreshBoundingInfo(){let D,j=arguments.length>0&&void 0!==arguments[0]&&arguments[0],W=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;D="object"===typeof j?j:{applySkeleton:j,applyMorph:W};const Q=this.Ie?this.Ie.boundingBias:null;return this.Fa(this._getData(D,null,P.f.PositionKind),Q),this}_createGlobalSubMesh(D){const j=this.getTotalVertices();if(!j||!this.Me())return null;if(this.xe&&this.xe.length>0){const W=this.Me();if(!W)return null;const Q=W.length;let C=!1;if(D)C=!0;else for(const D of this.xe){if(D.indexStart+D.indexCount>Q){C=!0;break}if(D.verticesStart+D.verticesCount>j){C=!0;break}}if(!C)return this.xe[0]}return this.releaseSubMeshes(),new V.c(0,0,j,0,this.getTotalIndices(),this)}subdivide(D){if(D<1)return;const j=this.getTotalIndices();let W=j/D|0,Q=0;for(;W%3!==0;)W++;this.releaseSubMeshes();for(let C=0;C<D&&!(Q>=j);C++)V.c.CreateFromIndices(0,Q,C===D-1?j-Q:W,this,void 0,!1),Q+=W;this.refreshBoundingInfo(),this.synchronizeInstances()}Ga(D,j){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Q=arguments.length>3?arguments[3]:void 0;if(this._geometry)this._geometry.Ga(D,j,W,Q);else{const Q=new X.b;Q.set(j,D);const C=this.va();new x.b(x.b.RandomId(),C,Q,W,this)}return this}removeVerticesData(D){this._geometry&&this._geometry.removeVerticesData(D)}markVerticesDataAsUpdatable(D){let j=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const W=this.getVertexBuffer(D);W&&W.isUpdatable()!==j&&this.Ga(D,this.getVerticesData(D),j)}setVerticesBuffer(D){let j=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._geometry||(this._geometry=x.b.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(D,null,j),this}updateVerticesData(D,j,W,Q){return this._geometry?(Q?(this.makeGeometryUnique(),this.updateVerticesData(D,j,W,!1)):this._geometry.updateVerticesData(D,j,W),this):this}updateMeshPositions(D){let j=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const W=this.getVerticesData(P.f.PositionKind);if(!W)return this;if(D(W),this.updateVerticesData(P.f.PositionKind,W,!1,!1),j){const D=this.Me(),j=this.getVerticesData(P.f.NormalKind);if(!j)return this;X.b.ComputeNormals(W,D,j),this.updateVerticesData(P.f.NormalKind,j,!1,!1)}return this}makeGeometryUnique(){if(!this._geometry)return this;if(1===this._geometry.meshes.length)return this;const D=this._geometry,j=this._geometry.j(x.b.RandomId());return D.releaseForMesh(this,!0),j.Ca(this),this}setIndexBuffer(D,j,W){let Q=this._geometry;Q||(Q=new x.b(x.b.RandomId(),this.va(),void 0,void 0,this)),Q.setIndexBuffer(D,j,W)}setIndices(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Q=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this._geometry)this._geometry.setIndices(D,j,W,Q);else{const j=new X.b;j.indices=D;const Q=this.va();new x.b(x.b.RandomId(),Q,j,W,this)}return this}updateIndices(D,j){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this._geometry?(this._geometry.updateIndices(D,j,W),this):this}toLeftHanded(){return this._geometry?(this._geometry.toLeftHanded(),this):this}_bind(D,j,W){let Q=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!this._geometry)return this;const C=this.va().getEngine();let k;if(this._unIndexed)if(this._getRenderingFillMode(W)===U.c.WireFrameFillMode)k=D._getLinesIndexBuffer(this.Me(),C);else k=null;else switch(this._getRenderingFillMode(W)){case U.c.PointFillMode:k=null;break;case U.c.WireFrameFillMode:k=D._getLinesIndexBuffer(this.Me(),C);break;default:case U.c.TriangleFillMode:k=this._geometry.getIndexBuffer()}return this._bindDirect(j,k,Q)}_bindDirect(D,j){let W=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this._geometry?(this.morphTargetManager&&this.morphTargetManager.isUsingTextureForTargets&&this.morphTargetManager._bind(D),W&&this._userInstancedBuffersStorage&&!this.hasThinInstances?this._geometry._bind(D,j,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects):this._geometry._bind(D,j),this):this}_draw(D,j,W){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);const Q=this.va().getEngine();return this._unIndexed&&j!==U.c.WireFrameFillMode||j==U.c.PointFillMode?Q.drawArraysType(j,D.verticesStart,D.verticesCount,this.forcedInstanceCount||W):j==U.c.WireFrameFillMode?Q.drawElementsType(j,0,D._linesIndexCount,this.forcedInstanceCount||W):Q.drawElementsType(j,D.indexStart,D.indexCount,this.forcedInstanceCount||W),this}registerBeforeRender(D){return this.onBeforeRenderObservable.add(D),this}unregisterBeforeRender(D){return this.onBeforeRenderObservable.removeCallback(D),this}registerAfterRender(D){return this.onAfterRenderObservable.add(D),this}unregisterAfterRender(D){return this.onAfterRenderObservable.removeCallback(D),this}_getInstancesRenderList(D){let j=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._instanceDataStorage.isFrozen){if(j)return this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.hardwareInstancedRendering[D]=!1,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.renderSelf[D]=!0,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode;if(this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch}const W=this.va(),Q=W._isInIntermediateRendering(),C=Q?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,k=this._instanceDataStorage.batchCache;if(k.mustReturn=!1,k.renderSelf[D]=j||!C&&this.isEnabled()&&this.isVisible,k.visibleInstances[D]=null,this._instanceDataStorage.visibleInstances&&!j){const j=this._instanceDataStorage.visibleInstances,C=W.getRenderId(),M=Q?j.intermediateDefaultRenderId:j.defaultRenderId;k.visibleInstances[D]=j[C],!k.visibleInstances[D]&&M&&(k.visibleInstances[D]=j[M])}return k.hardwareInstancedRendering[D]=!j&&this._instanceDataStorage.hardwareInstancedRendering&&null!==k.visibleInstances[D]&&void 0!==k.visibleInstances[D],this._instanceDataStorage.previousBatch=k,k}_renderWithInstances(D,j,W,Q,C){const k=W.visibleInstances[D._id],M=k?k.length:0,O=this._instanceDataStorage,E=O.instancesBufferSize;let F=O.instancesBuffer,Z=O.instancesPreviousBuffer;const X=16*(M+1)*4;for(;O.instancesBufferSize<X;)O.instancesBufferSize*=2;O.instancesData&&E==O.instancesBufferSize||(O.instancesData=new Float32Array(O.instancesBufferSize/4)),(this._scene.needsPreviousWorldMatrices&&!O.instancesPreviousData||E!=O.instancesBufferSize)&&(O.instancesPreviousData=new Float32Array(O.instancesBufferSize/4));let x=0,R=0;const V=W.renderSelf[D._id],U=!F||E!==O.instancesBufferSize||this._scene.needsPreviousWorldMatrices&&!O.instancesPreviousBuffer;if(this._instanceDataStorage.manualUpdate||O.isFrozen&&!U)R=(V?1:0)+M;else{const j=this.getWorldMatrix();if(V&&(this._scene.needsPreviousWorldMatrices&&(O.masterMeshPreviousWorldMatrix?(O.masterMeshPreviousWorldMatrix.copyToArray(O.instancesPreviousData,x),O.masterMeshPreviousWorldMatrix.p(j)):(O.masterMeshPreviousWorldMatrix=j.clone(),O.masterMeshPreviousWorldMatrix.copyToArray(O.instancesPreviousData,x))),j.copyToArray(O.instancesData,x),x+=16,R++),k){var g;if(y.INSTANCEDMESH_SORT_TRANSPARENT&&this._scene.activeCamera&&null!==(g=D.Ha())&&void 0!==g&&g.needAlphaBlendingForMesh(D.getRenderingMesh())){const D=this._scene.activeCamera.globalPosition;for(let j=0;j<k.length;j++){const W=k[j];W._distanceToCamera=f.j.Distance(W.getBoundingInfo().boundingSphere.centerWorld,D)}k.sort(((D,j)=>D._distanceToCamera>j._distanceToCamera?-1:D._distanceToCamera<j._distanceToCamera?1:0))}for(let D=0;D<k.length;D++){const j=k[D],W=j.getWorldMatrix();W.copyToArray(O.instancesData,x),this._scene.needsPreviousWorldMatrices&&(j._previousWorldMatrix?(j._previousWorldMatrix.copyToArray(O.instancesPreviousData,x),j._previousWorldMatrix.p(W)):(j._previousWorldMatrix=W.clone(),j._previousWorldMatrix.copyToArray(O.instancesPreviousData,x))),x+=16,R++}}}return U?(F&&F.dispose(),Z&&Z.dispose(),F=new P.b(C,O.instancesData,!0,16,!1,!0),O.instancesBuffer=F,this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this._userInstancedBuffersStorage.vertexBuffers.world0=F.createVertexBuffer("world0",0,4),this._userInstancedBuffersStorage.vertexBuffers.world1=F.createVertexBuffer("world1",4,4),this._userInstancedBuffersStorage.vertexBuffers.world2=F.createVertexBuffer("world2",8,4),this._userInstancedBuffersStorage.vertexBuffers.world3=F.createVertexBuffer("world3",12,4),this._scene.needsPreviousWorldMatrices&&(Z=new P.b(C,O.instancesPreviousData,!0,16,!1,!0),O.instancesPreviousBuffer=Z,this._userInstancedBuffersStorage.vertexBuffers.previousWorld0=Z.createVertexBuffer("previousWorld0",0,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld1=Z.createVertexBuffer("previousWorld1",4,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld2=Z.createVertexBuffer("previousWorld2",8,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld3=Z.createVertexBuffer("previousWorld3",12,4)),this._invalidateInstanceVertexArrayObject()):this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||(F.updateDirectly(O.instancesData,0,R),!this._scene.needsPreviousWorldMatrices||this._instanceDataStorage.manualUpdate&&!this._instanceDataStorage.previousManualUpdate||Z.updateDirectly(O.instancesPreviousData,0,R)),this._processInstancedBuffers(k,V),this.va()._activeIndices.addCount(D.indexCount*R,!1),C._currentDrawContext&&(C._currentDrawContext.useInstancing=!0),this._bind(D,Q,j),this._draw(D,j,R),!this._scene.needsPreviousWorldMatrices||U||!this._instanceDataStorage.manualUpdate||this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||this._instanceDataStorage.previousManualUpdate||Z.updateDirectly(O.instancesData,0,R),C.unbindInstanceAttributes(),this}_renderWithThinInstances(D,j,W,Q){var C;const k=(null===(C=this._thinInstanceDataStorage)||void 0===C?void 0:C.instancesCount)??0;this.va()._activeIndices.addCount(D.indexCount*k,!1),Q._currentDrawContext&&(Q._currentDrawContext.useInstancing=!0),this._bind(D,W,j),this._draw(D,j,k),this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&this._thinInstanceDataStorage.matrixData&&(this._thinInstanceDataStorage.previousMatrixBuffer?this._thinInstanceDataStorage.previousMatrixBuffer.updateDirectly(this._thinInstanceDataStorage.matrixData,0,k):this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.matrixData,!1)),Q.unbindInstanceAttributes()}_processInstancedBuffers(D,j){}_processRendering(D,j,W,Q,C,k,M,O){const E=this.va(),f=E.getEngine();if(Q=this._getRenderingFillMode(Q),k&&j.getRenderingMesh().hasThinInstances)return this._renderWithThinInstances(j,Q,W,f),this;if(k)this._renderWithInstances(j,Q,C,W,f);else{f._currentDrawContext&&(f._currentDrawContext.useInstancing=!1);let W=0;C.renderSelf[j._id]&&(M&&M(!1,D.getWorldMatrix(),O),W++,this._draw(j,Q,this._instanceDataStorage.overridenInstanceCount));const k=C.visibleInstances[j._id];if(k){const D=k.length;W+=D;for(let W=0;W<D;W++){const D=k[W].getWorldMatrix();M&&M(!0,D,O),this._draw(j,Q)}}E._activeIndices.addCount(j.indexCount*W,!1)}return this}_rebuild(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._instanceDataStorage.instancesBuffer&&(D&&this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),this._userInstancedBuffersStorage){for(const j in this._userInstancedBuffersStorage.vertexBuffers){const W=this._userInstancedBuffersStorage.vertexBuffers[j];W&&(D&&W.dispose(),this._userInstancedBuffersStorage.vertexBuffers[j]=null)}this._userInstancedBuffersStorage.vertexArrayObjects&&(this._userInstancedBuffersStorage.vertexArrayObjects={})}this._internalMeshDataInfo._effectiveMaterial=null,super._rebuild(D)}_freeze(){if(this.xe){for(let D=0;D<this.xe.length;D++)this._getInstancesRenderList(D);this._internalMeshDataInfo._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}}_unFreeze(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null}renderWithRenderPassId(D,j,W,Q){let C=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const k=this._scene.getEngine(),M=k.currentRenderPassId;if(void 0!==D&&(k.currentRenderPassId=D),Q)(!C||C&&Q.isInFrustum(this._scene._frustumPlanes))&&this.render(Q,!!j,W);else for(let O=0;O<this.xe.length;O++){const D=this.xe[O];(!C||C&&D.isInFrustum(this._scene._frustumPlanes))&&this.render(D,!!j,W)}return void 0!==D&&(k.currentRenderPassId=M),this}directRender(){if(!this.xe)return this;for(const D of this.xe)this.render(D,!1);return this}render(D,j,W){var Q,C,k;const M=this.va();this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1;const O=(null===(Q=M.activeCameras)||void 0===Q?void 0:Q.length)??0;if((O>1&&M.activeCamera===M.activeCameras[0]||O<=1)&&this._checkOcclusionQuery()&&!this._occlusionDataStorage.forceRenderingWhenOccluded)return this;const E=this._getInstancesRenderList(D._id,!!W);if(E.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const f=M.getEngine();let F=0,Z=null;this.ignoreCameraMaxZ&&M.activeCamera&&!M._isInIntermediateRendering()&&(F=M.activeCamera.maxZ,Z=M.activeCamera,M.activeCamera.maxZ=0,M.updateTransformMatrix(!0)),this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);const P=D.getRenderingMesh(),X=E.hardwareInstancedRendering[D._id]||P.hasThinInstances||!!this._userInstancedBuffersStorage&&!D.getMesh()._internalAbstractMeshDataInfo._actAsRegularMesh,x=this._instanceDataStorage,R=D.Ha();if(!R)return Z&&(Z.maxZ=F,M.updateTransformMatrix(!0)),this;if(x.isFrozen&&this._internalMeshDataInfo._effectiveMaterial&&this._internalMeshDataInfo._effectiveMaterial===R){if(R._storeEffectOnSubMeshes&&(null===(C=D._drawWrapper)||void 0===C||!C._wasPreviouslyReady)||!R._storeEffectOnSubMeshes&&!R._getDrawWrapper()._wasPreviouslyReady)return Z&&(Z.maxZ=F,M.updateTransformMatrix(!0)),this}else{if(R._storeEffectOnSubMeshes){if(!R.isReadyForSubMesh(this,D,X))return Z&&(Z.maxZ=F,M.updateTransformMatrix(!0)),this}else if(!R.isReady(this,X))return Z&&(Z.maxZ=F,M.updateTransformMatrix(!0)),this;this._internalMeshDataInfo._effectiveMaterial=R}let V;j&&f.setAlphaMode(this._internalMeshDataInfo._effectiveMaterial.alphaMode),V=this._internalMeshDataInfo._effectiveMaterial._storeEffectOnSubMeshes?D._drawWrapper:this._internalMeshDataInfo._effectiveMaterial._getDrawWrapper();const g=(null===(k=V)||void 0===k?void 0:k.effect)??null;for(const U of M._beforeRenderingMeshStage)U.action(this,D,E,g);if(!V||!g)return Z&&(Z.maxZ=F,M.updateTransformMatrix(!0)),this;const N=W||this;let G;if(x.isFrozen||!this._internalMeshDataInfo._effectiveMaterial.Se&&null===this._internalMeshDataInfo._effectiveMaterial.sideOrientation&&!this._internalMeshDataInfo._effectiveMaterial.twoSidedLighting)G=x.sideOrientation;else{const D=N._getWorldMatrixDeterminant();G=this._internalMeshDataInfo._effectiveMaterial._getEffectiveOrientation(this),D<0&&(G=G===U.c.ClockWiseSideOrientation?U.c.CounterClockWiseSideOrientation:U.c.ClockWiseSideOrientation),x.sideOrientation=G}const K=this._internalMeshDataInfo._effectiveMaterial._preBind(V,G);this._internalMeshDataInfo._effectiveMaterial.forceDepthWrite&&f.setDepthWrite(!0);const L=this._internalMeshDataInfo._effectiveMaterial,e=L.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),X||this._bind(D,g,e,!1);const s=N.getWorldMatrix();L._storeEffectOnSubMeshes?L.bindForSubMesh(s,this,D):L.bind(s,this),!L.Se&&L.separateCullingPass&&(f.setState(!0,L.zOffset,!1,!K,L.cullBackFaces,L.stencil,L.zOffsetUnits),this._processRendering(this,D,g,e,E,X,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),f.setState(!0,L.zOffset,!1,K,L.cullBackFaces,L.stencil,L.zOffsetUnits),this._internalMeshDataInfo._onBetweenPassObservable&&this._internalMeshDataInfo._onBetweenPassObservable.notifyObservers(D)),this._processRendering(this,D,g,e,E,X,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),this._internalMeshDataInfo._effectiveMaterial.unbind();for(const U of M._afterRenderingMeshStage)U.action(this,D,E,g);return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),Z&&(Z.maxZ=F,M.updateTransformMatrix(!0)),2!==M.performancePriority||x.isFrozen||this._freeze(),this}cleanMatrixWeights(){this.isVerticesDataPresent(P.f.MatricesWeightsKind)&&(this.isVerticesDataPresent(P.f.MatricesWeightsExtraKind)?this._normalizeSkinWeightsAndExtra():this._normalizeSkinFourWeights())}_normalizeSkinFourWeights(){const D=this.getVerticesData(P.f.MatricesWeightsKind),j=D.length;for(let W=0;W<j;W+=4){const j=D[W]+D[W+1]+D[W+2]+D[W+3];if(0===j)D[W]=1;else{const Q=1/j;D[W]*=Q,D[W+1]*=Q,D[W+2]*=Q,D[W+3]*=Q}}this.Ga(P.f.MatricesWeightsKind,D)}_normalizeSkinWeightsAndExtra(){const D=this.getVerticesData(P.f.MatricesWeightsExtraKind),j=this.getVerticesData(P.f.MatricesWeightsKind),W=j.length;for(let Q=0;Q<W;Q+=4){let W=j[Q]+j[Q+1]+j[Q+2]+j[Q+3];if(W+=D[Q]+D[Q+1]+D[Q+2]+D[Q+3],0===W)j[Q]=1;else{const C=1/W;j[Q]*=C,j[Q+1]*=C,j[Q+2]*=C,j[Q+3]*=C,D[Q]*=C,D[Q+1]*=C,D[Q+2]*=C,D[Q+3]*=C}}this.Ga(P.f.MatricesWeightsKind,j),this.Ga(P.f.MatricesWeightsKind,D)}validateSkinning(){const D=this.getVerticesData(P.f.MatricesWeightsExtraKind),j=this.getVerticesData(P.f.MatricesWeightsKind);if(null===j||null==this.skeleton)return{skinned:!1,valid:!0,Sd:"not skinned"};const W=j.length;let Q=0,C=0,k=0,M=0;const O=null===D?4:8,E=[];for(let P=0;P<=O;P++)E[P]=0;for(let P=0;P<W;P+=4){let W=j[P],f=W,F=0===f?0:1;for(let C=1;C<O;C++){const k=C<4?j[P+C]:D[P+C-4];k>W&&Q++,0!==k&&F++,f+=k,W=k}if(E[F]++,F>k&&(k=F),0===f)C++;else{const W=1/f;let Q=0;for(let C=0;C<O;C++)Q+=C<4?Math.abs(j[P+C]-j[P+C]*W):Math.abs(D[P+C-4]-D[P+C-4]*W);Q>.001&&M++}}const f=this.skeleton.bones.length,F=this.getVerticesData(P.f.MatricesIndicesKind),Z=this.getVerticesData(P.f.MatricesIndicesExtraKind);let X=0;for(let P=0;P<W;P+=4)for(let D=0;D<O;D++){const j=D<4?F[P+D]:Z[P+D-4];(j>=f||j<0)&&X++}return{skinned:!0,valid:0===C&&0===M&&0===X,Sd:"Number of Weights = "+W/4+"\nMaximum influences = "+k+"\nMissing Weights = "+C+"\nNot Sorted = "+Q+"\nNot Normalized = "+M+"\nWeightCounts = ["+E+"]\nNumber of bones = "+f+"\nBad Bone Indices = "+X}}_checkDelayState(){const D=this.va();return this._geometry?this._geometry.load(D):4===this.delayLoadState&&(this.delayLoadState=2,this._queueLoad(D)),this}_queueLoad(D){D.addPendingData(this);const j=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return C.f.LoadFile(this.delayLoadingFile,(j=>{j instanceof ArrayBuffer?this._delayLoadingFunction(j,this):this._delayLoadingFunction(JSON.parse(j),this),this.instances.forEach((D=>{D.refreshBoundingInfo(),D._syncSubMeshes()})),this.delayLoadState=1,D.removePendingData(this)}),(()=>{}),D.offlineProvider,j),this}isInFrustum(D){return 2!==this.delayLoadState&&(!!super.isInFrustum(D)&&(this._checkDelayState(),!0))}setMaterialById(D){const j=this.va().materials;let W;for(W=j.length-1;W>-1;W--)if(j[W].id===D)return this.material=j[W],this;const Q=this.va().multiMaterials;for(W=Q.length-1;W>-1;W--)if(Q[W].id===D)return this.material=Q[W],this;return this}getAnimatables(){const D=[];return this.material&&D.push(this.material),this.skeleton&&D.push(this.skeleton),D}bakeTransformIntoVertices(D){if(!this.isVerticesDataPresent(P.f.PositionKind))return this;const j=this.xe.splice(0);this._resetPointsArrayCache();let W=this.getVerticesData(P.f.PositionKind);const Q=f.j.Zero();let C;for(C=0;C<W.length;C+=3)f.j.TransformCoordinatesFromFloatsToRef(W[C],W[C+1],W[C+2],D,Q).toArray(W,C);if(this.Ga(P.f.PositionKind,W,this.getVertexBuffer(P.f.PositionKind).isUpdatable()),this.isVerticesDataPresent(P.f.NormalKind)){for(W=this.getVerticesData(P.f.NormalKind),C=0;C<W.length;C+=3)f.j.TransformNormalFromFloatsToRef(W[C],W[C+1],W[C+2],D,Q).normalize().toArray(W,C);this.Ga(P.f.NormalKind,W,this.getVertexBuffer(P.f.NormalKind).isUpdatable())}if(this.isVerticesDataPresent(P.f.TangentKind)){for(W=this.getVerticesData(P.f.TangentKind),C=0;C<W.length;C+=4)f.j.TransformNormalFromFloatsToRef(W[C],W[C+1],W[C+2],D,Q).normalize().toArray(W,C);this.Ga(P.f.TangentKind,W,this.getVertexBuffer(P.f.TangentKind).isUpdatable())}return D.determinant()<0&&this.flipFaces(),this.releaseSubMeshes(),this.xe=j,this}bakeCurrentTransformIntoVertices(){let D=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.bakeTransformIntoVertices(this.Ge(!0)),this.resetLocalMatrix(D),this}get _positions(){return this._internalAbstractMeshDataInfo._positions||this._geometry&&this._geometry._positions||null}_resetPointsArrayCache(){return this._geometry&&this._geometry._resetPointsArrayCache(),this}_generatePointsArray(){return!!this._geometry&&this._geometry._generatePointsArray()}clone(){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,j=arguments.length>2?arguments[2]:void 0,W=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return new y(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",this.va(),D,this,j,W)}dispose(D){let j=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);const W=this._internalMeshDataInfo;if(W._onBeforeDrawObservable&&W._onBeforeDrawObservable.clear(),W._onBeforeBindObservable&&W._onBeforeBindObservable.clear(),W._onBeforeRenderObservable&&W._onBeforeRenderObservable.clear(),W._onAfterRenderObservable&&W._onAfterRenderObservable.clear(),W._onBetweenPassObservable&&W._onBetweenPassObservable.clear(),this._scene.useClonedMeshMap){if(W.meshMap)for(const D in W.meshMap){const j=W.meshMap[D];j&&(j._internalMeshDataInfo._source=null,W.meshMap[D]=void 0)}W._source&&W._source._internalMeshDataInfo.meshMap&&(W._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else{const D=this.va().meshes;for(const j of D){const D=j;D._internalMeshDataInfo&&D._internalMeshDataInfo._source&&D._internalMeshDataInfo._source===this&&(D._internalMeshDataInfo._source=null)}}W._source=null,this._instanceDataStorage.visibleInstances={},this._disposeInstanceSpecificData(),this._disposeThinInstanceSpecificData(),this._internalMeshDataInfo._checkReadinessObserver&&this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),super.dispose(D,j)}_disposeInstanceSpecificData(){}_disposeThinInstanceSpecificData(){}_invalidateInstanceVertexArrayObject(){}applyDisplacementMap(D,j,W,Q,k,M){let O=arguments.length>6&&void 0!==arguments[6]&&arguments[6],E=arguments.length>7?arguments[7]:void 0;const f=this.va();return C.f.LoadImage(D,(D=>{const C=D.width,E=D.height,f=this.getEngine().createCanvas(C,E).getContext("2d");f.drawImage(D,0,0);const F=f.getImageData(0,0,C,E).data;this.applyDisplacementMapFromBuffer(F,C,E,j,W,k,M,O),Q&&Q(this)}),E||(()=>{}),f.offlineProvider),this}applyDisplacementMapFromBuffer(D,j,W,Q,C,k,M){let O=arguments.length>7&&void 0!==arguments[7]&&arguments[7];if(!this.isVerticesDataPresent(P.f.PositionKind)||!this.isVerticesDataPresent(P.f.NormalKind)||!this.isVerticesDataPresent(P.f.UVKind))return K.b.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;const E=this.getVerticesData(P.f.PositionKind,!0,!0),F=this.getVerticesData(P.f.NormalKind),Z=this.getVerticesData(P.f.UVKind);let x=f.j.Zero();const R=f.j.Zero(),V=f.f.Zero();k=k||f.f.Zero(),M=M||new f.f(1,1);for(let P=0;P<E.length;P+=3){f.j.FromArrayToRef(E,P,x),f.j.FromArrayToRef(F,P,R),f.f.FromArrayToRef(Z,P/3*2,V);const O=4*((Math.abs(V.x*M.x+k.x%1)*(j-1)%j|0)+(Math.abs(V.y*M.y+k.y%1)*(W-1)%W|0)*j),X=.3*(D[O]/255)+.59*(D[O+1]/255)+.11*(D[O+2]/255);R.normalize(),R.scaleInPlace(Q+(C-Q)*X),x=x.add(R),x.toArray(E,P)}return X.b.ComputeNormals(E,this.Me(),F),O?(this.Ga(P.f.PositionKind,E),this.Ga(P.f.NormalKind,F),this.Ga(P.f.UVKind,Z)):(this.updateVerticesData(P.f.PositionKind,E),this.updateVerticesData(P.f.NormalKind,F)),this}_getFlattenedNormals(D,j){const W=new Float32Array(3*D.length);let Q=0;const C=this.sideOrientation===(this._scene.useRightHandedSystem?1:0);for(let k=0;k<D.length;k+=3){const M=f.j.Dd(j,3*D[k]),O=f.j.Dd(j,3*D[k+1]),E=f.j.Dd(j,3*D[k+2]),F=M.Qc(O),Z=E.Qc(O),P=f.j.Normalize(f.j.Cross(F,Z));C&&P.scaleInPlace(-1);for(let D=0;D<3;D++)W[Q++]=P.x,W[Q++]=P.y,W[Q++]=P.z}return W}_convertToUnIndexedMesh(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const j=this.getVerticesDataKinds().filter((D=>{var j;return!(null!==(j=this.getVertexBuffer(D))&&void 0!==j&&j.getIsInstanced())})),W=this.Me(),Q={},C=(D,j)=>{const Q=new Float32Array(W.length*j);let C=0;for(let k=0;k<W.length;k++)for(let M=0;M<j;M++)Q[C++]=D[W[k]*j+M];return Q},k=this.getBoundingInfo(),M=this.Ie?this.xe.slice(0):[];for(const O of j)Q[O]=this.getVerticesData(O);for(const O of j){const j=this.getVertexBuffer(O),k=j.getSize();if(D&&O===P.f.NormalKind){const D=this._getFlattenedNormals(W,Q[P.f.PositionKind]);this.Ga(P.f.NormalKind,D,j.isUpdatable(),k)}else this.Ga(O,C(Q[O],k),j.isUpdatable(),k)}if(this.morphTargetManager){for(let j=0;j<this.morphTargetManager.numTargets;j++){const Q=this.morphTargetManager.getTarget(j),k=Q.getPositions();Q.setPositions(C(k,3));const M=Q.getNormals();M&&Q.setNormals(D?this._getFlattenedNormals(W,k):C(M,3));const O=Q.getTangents();O&&Q.setTangents(C(O,3));const E=Q.getUVs();E&&Q.setUVs(C(E,2))}this.morphTargetManager.synchronize()}for(let O=0;O<W.length;O++)W[O]=O;this.setIndices(W),this._unIndexed=!0,this.releaseSubMeshes();for(const O of M){const D=O.getBoundingInfo();V.c.AddToMesh(O.materialIndex,O.indexStart,O.indexCount,O.indexStart,O.indexCount,this).setBoundingInfo(D)}return this.setBoundingInfo(k),this.synchronizeInstances(),this}convertToFlatShadedMesh(){return this._convertToUnIndexedMesh(!0)}convertToUnIndexedMesh(){return this._convertToUnIndexedMesh()}flipFaces(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const j=X.b.ExtractFromMesh(this);let W;if(D&&this.isVerticesDataPresent(P.f.NormalKind)&&j.ya){for(W=0;W<j.ya.length;W++)j.ya[W]*=-1;this.Ga(P.f.NormalKind,j.ya,this.isVertexBufferUpdatable(P.f.NormalKind))}if(j.indices){let D;for(W=0;W<j.indices.length;W+=3)D=j.indices[W+1],j.indices[W+1]=j.indices[W+2],j.indices[W+2]=D;this.setIndices(j.indices,null,this.isVertexBufferUpdatable(P.f.PositionKind),!0)}return this}increaseVertices(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const j=X.b.ExtractFromMesh(this),W=j.indices&&!Array.isArray(j.indices)&&Array.from?Array.from(j.indices):j.indices,Q=j.xa&&!Array.isArray(j.xa)&&Array.from?Array.from(j.xa):j.xa,C=j.Aa&&!Array.isArray(j.Aa)&&Array.from?Array.from(j.Aa):j.Aa,k=j.ya&&!Array.isArray(j.ya)&&Array.from?Array.from(j.ya):j.ya;if(W&&Q){j.indices=W,j.xa=Q,C&&(j.Aa=C),k&&(j.ya=k);const M=D+1,O=new Array;for(let D=0;D<M+1;D++)O[D]=new Array;let E,F;const Z=new f.j(0,0,0),X=new f.j(0,0,0),x=new f.f(0,0),R=new Array,V=new Array,U=new Array;let g,N,G,K=Q.length;C&&(N=C.length),k&&(G=k.length);for(let D=0;D<W.length;D+=3){V[0]=W[D],V[1]=W[D+1],V[2]=W[D+2];for(let D=0;D<3;D++)if(E=V[D],F=V[(D+1)%3],void 0===U[E]&&void 0===U[F]?(U[E]=new Array,U[F]=new Array):(void 0===U[E]&&(U[E]=new Array),void 0===U[F]&&(U[F]=new Array)),void 0===U[E][F]&&void 0===U[F][E]){U[E][F]=[],Z.x=(Q[3*F]-Q[3*E])/M,Z.y=(Q[3*F+1]-Q[3*E+1])/M,Z.z=(Q[3*F+2]-Q[3*E+2])/M,k&&(X.x=(k[3*F]-k[3*E])/M,X.y=(k[3*F+1]-k[3*E+1])/M,X.z=(k[3*F+2]-k[3*E+2])/M),C&&(x.x=(C[2*F]-C[2*E])/M,x.y=(C[2*F+1]-C[2*E+1])/M),U[E][F].push(E);for(let D=1;D<M;D++)U[E][F].push(Q.length/3),Q[K++]=Q[3*E]+D*Z.x,Q[K++]=Q[3*E+1]+D*Z.y,Q[K++]=Q[3*E+2]+D*Z.z,k&&(k[G++]=k[3*E]+D*X.x,k[G++]=k[3*E+1]+D*X.y,k[G++]=k[3*E+2]+D*X.z),C&&(C[N++]=C[2*E]+D*x.x,C[N++]=C[2*E+1]+D*x.y);U[E][F].push(F),U[F][E]=new Array,g=U[E][F].length;for(let D=0;D<g;D++)U[F][E][D]=U[E][F][g-1-D]}O[0][0]=W[D],O[1][0]=U[W[D]][W[D+1]][1],O[1][1]=U[W[D]][W[D+2]][1];for(let j=2;j<M;j++){O[j][0]=U[W[D]][W[D+1]][j],O[j][j]=U[W[D]][W[D+2]][j],Z.x=(Q[3*O[j][j]]-Q[3*O[j][0]])/j,Z.y=(Q[3*O[j][j]+1]-Q[3*O[j][0]+1])/j,Z.z=(Q[3*O[j][j]+2]-Q[3*O[j][0]+2])/j,k&&(X.x=(k[3*O[j][j]]-k[3*O[j][0]])/j,X.y=(k[3*O[j][j]+1]-k[3*O[j][0]+1])/j,X.z=(k[3*O[j][j]+2]-k[3*O[j][0]+2])/j),C&&(x.x=(C[2*O[j][j]]-C[2*O[j][0]])/j,x.y=(C[2*O[j][j]+1]-C[2*O[j][0]+1])/j);for(let D=1;D<j;D++)O[j][D]=Q.length/3,Q[K++]=Q[3*O[j][0]]+D*Z.x,Q[K++]=Q[3*O[j][0]+1]+D*Z.y,Q[K++]=Q[3*O[j][0]+2]+D*Z.z,k&&(k[G++]=k[3*O[j][0]]+D*X.x,k[G++]=k[3*O[j][0]+1]+D*X.y,k[G++]=k[3*O[j][0]+2]+D*X.z),C&&(C[N++]=C[2*O[j][0]]+D*x.x,C[N++]=C[2*O[j][0]+1]+D*x.y)}O[M]=U[W[D+1]][W[D+2]],R.push(O[0][0],O[1][0],O[1][1]);for(let D=1;D<M;D++){let j;for(j=0;j<D;j++)R.push(O[D][j],O[D+1][j],O[D+1][j+1]),R.push(O[D][j],O[D+1][j+1],O[D][j+1]);R.push(O[D][j],O[D+1][j],O[D+1][j+1])}}j.indices=R,j.Ca(this,this.isVertexBufferUpdatable(P.f.PositionKind))}else K.b.Warn("Couldn't increase number of vertices : VertexData must contain at least indices and positions")}forceSharedVertices(){const D=X.b.ExtractFromMesh(this),j=D.Aa,W=D.indices,Q=D.xa,C=D.za,k=D.matricesIndices,M=D.matricesWeights,O=D.matricesIndicesExtra,E=D.matricesWeightsExtra;if(void 0===W||void 0===Q||null===W||null===Q)K.b.Warn("VertexData contains empty entries");else{const f=new Array,F=new Array,Z=new Array,x=new Array,R=new Array,V=new Array,U=new Array,g=new Array;let N=new Array,G=0;const K={};let L,e;for(let D=0;D<W.length;D+=3){e=[W[D],W[D+1],W[D+2]],N=[];for(let D=0;D<3;D++){N[D]="";for(let j=0;j<3;j++)Math.abs(Q[3*e[D]+j])<1e-8&&(Q[3*e[D]+j]=0),N[D]+=Q[3*e[D]+j]+"|"}if(N[0]!=N[1]&&N[0]!=N[2]&&N[1]!=N[2])for(let D=0;D<3;D++){if(L=K[N[D]],void 0===L){K[N[D]]=G,L=G++;for(let j=0;j<3;j++)f.push(Q[3*e[D]+j]);if(null!==C&&void 0!==C)for(let j=0;j<4;j++)x.push(C[4*e[D]+j]);if(null!==j&&void 0!==j)for(let W=0;W<2;W++)Z.push(j[2*e[D]+W]);if(null!==k&&void 0!==k)for(let j=0;j<4;j++)R.push(k[4*e[D]+j]);if(null!==M&&void 0!==M)for(let j=0;j<4;j++)V.push(M[4*e[D]+j]);if(null!==O&&void 0!==O)for(let j=0;j<4;j++)U.push(O[4*e[D]+j]);if(null!==E&&void 0!==E)for(let j=0;j<4;j++)g.push(E[4*e[D]+j])}F.push(L)}}const s=new Array;X.b.ComputeNormals(f,F,s),D.xa=f,D.indices=F,D.ya=s,null!==j&&void 0!==j&&(D.Aa=Z),null!==C&&void 0!==C&&(D.za=x),null!==k&&void 0!==k&&(D.matricesIndices=R),null!==M&&void 0!==M&&(D.matricesWeights=V),null!==O&&void 0!==O&&(D.matricesIndicesExtra=U),null!==M&&void 0!==M&&(D.matricesWeightsExtra=g),D.Ca(this,this.isVertexBufferUpdatable(P.f.PositionKind))}}static _instancedMeshFactory(D,j){throw(0,e.d)("InstancedMesh")}static _PhysicsImpostorParser(D,j,W){throw(0,e.d)("PhysicsImpostor")}yb(D){const j=y._instancedMeshFactory(D,this);return j.parent=this.parent,j}synchronizeInstances(){for(let D=0;D<this.instances.length;D++){this.instances[D]._syncSubMeshes()}return this}optimizeIndices(D){const j=this.Me(),W=this.getVerticesData(P.f.PositionKind);if(!W||!j)return this;const Q=[];for(let C=0;C<W.length;C+=3)Q.push(f.j.Dd(W,C));const k=[];return C.c.SyncAsyncForLoop(Q.length,40,(D=>{const j=Q.length-1-D,W=Q[j];for(let C=0;C<j;++C){const D=Q[C];if(W.equals(D)){k[j]=C;break}}}),(()=>{for(let D=0;D<j.length;++D)j[D]=k[j[D]]||j[D];const W=this.xe.slice(0);this.setIndices(j),this.xe=W,D&&D(this)})),this}serialize(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};D.name=this.name,D.id=this.id,D.uniqueId=this.uniqueId,D.type=this.getClassName(),M.e&&M.e.HasTags(this)&&(D.tags=M.e.GetTags(this)),D.position=this.position.Gd(),this.rotationQuaternion?D.rotationQuaternion=this.rotationQuaternion.Gd():this.rotation&&(D.rotation=this.rotation.Gd()),D.Pd=this.Pd.Gd(),this._postMultiplyPivotMatrix?D.pivotMatrix=this.getPivotMatrix().Gd():D.localMatrix=this.getPivotMatrix().Gd(),D.isEnabled=this.isEnabled(!1),D.isVisible=this.isVisible,D.infiniteDistance=this.infiniteDistance,D.pickable=this.he,D.receiveShadows=this.receiveShadows,D.billboardMode=this.billboardMode,D.visibility=this.visibility,D.He=this.He,D.checkCollisions=this.checkCollisions,D.ellipsoid=this.ellipsoid.Gd(),D.ellipsoidOffset=this.ellipsoidOffset.Gd(),D.Da=this.Da,D.isBlocker=this.isBlocker,D.sideOrientation=this.sideOrientation,this.parent&&this.parent._serializeAsParent(D),D.isUnIndexed=this.isUnIndexed;const j=this._geometry;if(j&&this.xe){D.geometryUniqueId=j.uniqueId,D.geometryId=j.id,D.xe=[];for(let j=0;j<this.xe.length;j++){const W=this.xe[j];D.xe.push({materialIndex:W.materialIndex,verticesStart:W.verticesStart,verticesCount:W.verticesCount,indexStart:W.indexStart,indexCount:W.indexCount})}}if(this.material?this.material.doNotSerialize||(D.materialUniqueId=this.material.uniqueId,D.materialId=this.material.id):(this.material=null,D.materialUniqueId=this._scene.defaultMaterial.uniqueId,D.materialId=this._scene.defaultMaterial.id),this.morphTargetManager&&(D.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(D.skeletonId=this.skeleton.id,D.numBoneInfluencers=this.numBoneInfluencers),this.va()._getComponent(s.d.NAME_PHYSICSENGINE)){const j=this.getPhysicsImpostor();j&&(D.physicsMass=j.getParam("mass"),D.physicsFriction=j.getParam("friction"),D.physicsRestitution=j.getParam("mass"),D.physicsImpostor=j.type)}this.metadata&&(D.metadata=this.metadata),D.instances=[];for(let W=0;W<this.instances.length;W++){const j=this.instances[W];if(j.doNotSerialize)continue;const Q={name:j.name,id:j.id,isEnabled:j.isEnabled(!1),isVisible:j.isVisible,he:j.he,checkCollisions:j.checkCollisions,position:j.position.Gd(),Pd:j.Pd.Gd()};if(j.parent&&j.parent._serializeAsParent(Q),j.rotationQuaternion?Q.rotationQuaternion=j.rotationQuaternion.Gd():j.rotation&&(Q.rotation=j.rotation.Gd()),this.va()._getComponent(s.d.NAME_PHYSICSENGINE)){const D=j.getPhysicsImpostor();D&&(Q.physicsMass=D.getParam("mass"),Q.physicsFriction=D.getParam("friction"),Q.physicsRestitution=D.getParam("mass"),Q.physicsImpostor=D.type)}j.metadata&&(Q.metadata=j.metadata),j.actionManager&&(Q.actions=j.actionManager.serialize(j.name)),D.instances.push(Q),G.d.AppendSerializedAnimations(j,Q),Q.ranges=j.serializeAnimationRanges()}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData&&(D.thinInstances={instancesCount:this._thinInstanceDataStorage.instancesCount,matrixData:Array.from(this._thinInstanceDataStorage.matrixData),matrixBufferSize:this._thinInstanceDataStorage.matrixBufferSize,enablePicking:this.thinInstanceEnablePicking},this._userThinInstanceBuffersStorage)){const j={data:{},sizes:{},strides:{}};for(const D in this._userThinInstanceBuffersStorage.data)j.data[D]=Array.from(this._userThinInstanceBuffersStorage.data[D]),j.sizes[D]=this._userThinInstanceBuffersStorage.sizes[D],j.strides[D]=this._userThinInstanceBuffersStorage.strides[D];D.thinInstances.userThinInstance=j}return G.d.AppendSerializedAnimations(this,D),D.ranges=this.serializeAnimationRanges(),D.layerMask=this.layerMask,D.alphaIndex=this.alphaIndex,D.hasVertexAlpha=this.hasVertexAlpha,D.overlayAlpha=this.overlayAlpha,D.overlayColor=this.overlayColor.Gd(),D.renderOverlay=this.renderOverlay,D.applyFog=this.applyFog,this.actionManager&&(D.actions=this.actionManager.serialize(this.name)),D}_syncGeometryWithMorphTargetManager(){if(!this.Ie)return;this._markSubMeshesAsAttributesDirty();const D=this._internalAbstractMeshDataInfo._morphTargetManager;if(D&&D.vertexCount){if(D.vertexCount!==this.getTotalVertices())return K.b.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);if(D.isUsingTextureForTargets)return;for(let j=0;j<D.numInfluencers;j++){const W=D.getActiveTarget(j),Q=W.getPositions();if(!Q)return void K.b.Error("Invalid morph target. Target must have positions.");this.Ie.Ga(P.f.PositionKind+j,Q,!1,3);const C=W.getNormals();C&&this.Ie.Ga(P.f.NormalKind+j,C,!1,3);const k=W.getTangents();k&&this.Ie.Ga(P.f.TangentKind+j,k,!1,3);const M=W.getUVs();M&&this.Ie.Ga(P.f.UVKind+"_"+j,M,!1,2)}}else{let D=0;for(;this.Ie.isVerticesDataPresent(P.f.PositionKind+D);)this.Ie.removeVerticesData(P.f.PositionKind+D),this.Ie.isVerticesDataPresent(P.f.NormalKind+D)&&this.Ie.removeVerticesData(P.f.NormalKind+D),this.Ie.isVerticesDataPresent(P.f.TangentKind+D)&&this.Ie.removeVerticesData(P.f.TangentKind+D),this.Ie.isVerticesDataPresent(P.f.UVKind+D)&&this.Ie.removeVerticesData(P.f.UVKind+"_"+D),D++}}static Parse(D,j,W){let Q;if(Q=D.type&&"LinesMesh"===D.type?y._LinesMeshParser(D,j):D.type&&"GroundMesh"===D.type?y._GroundMeshParser(D,j):D.type&&"GoldbergMesh"===D.type?y._GoldbergMeshParser(D,j):D.type&&"GreasedLineMesh"===D.type?y._GreasedLineMeshParser(D,j):D.type&&"TrailMesh"===D.type?y._TrailMeshParser(D,j):new y(D.name,j),Q.id=D.id,Q._waitingParsedUniqueId=D.uniqueId,M.e&&M.e.AddTagsTo(Q,D.tags),Q.position=f.j.Dd(D.position),void 0!==D.metadata&&(Q.metadata=D.metadata),D.rotationQuaternion?Q.rotationQuaternion=f.d.Dd(D.rotationQuaternion):D.rotation&&(Q.rotation=f.j.Dd(D.rotation)),Q.Pd=f.j.Dd(D.Pd),D.localMatrix?Q.setPreTransformMatrix(f.b.Dd(D.localMatrix)):D.pivotMatrix&&Q.setPivotMatrix(f.b.Dd(D.pivotMatrix)),Q.Kg(D.isEnabled),Q.isVisible=D.isVisible,Q.infiniteDistance=D.infiniteDistance,Q.He=!!D.He,Q.showBoundingBox=D.showBoundingBox,Q.showSubMeshesBoundingBox=D.showSubMeshesBoundingBox,void 0!==D.applyFog&&(Q.applyFog=D.applyFog),void 0!==D.pickable&&(Q.he=D.pickable),void 0!==D.alphaIndex&&(Q.alphaIndex=D.alphaIndex),Q.receiveShadows=D.receiveShadows,void 0!==D.billboardMode&&(Q.billboardMode=D.billboardMode),void 0!==D.visibility&&(Q.visibility=D.visibility),Q.checkCollisions=D.checkCollisions,Q.Da=!!D.Da,D.ellipsoid&&(Q.ellipsoid=f.j.Dd(D.ellipsoid)),D.ellipsoidOffset&&(Q.ellipsoidOffset=f.j.Dd(D.ellipsoidOffset)),null!=D.overrideMaterialSideOrientation&&(Q.sideOrientation=D.overrideMaterialSideOrientation),void 0!==D.sideOrientation&&(Q.sideOrientation=D.sideOrientation),void 0!==D.isBlocker&&(Q.isBlocker=D.isBlocker),Q._shouldGenerateFlatShading=D.useFlatShading,D.oi&&(Q._waitingData.oi=D.oi),void 0!==D.parentId&&(Q._waitingParentId=D.parentId),void 0!==D.parentInstanceIndex&&(Q._waitingParentInstanceIndex=D.parentInstanceIndex),void 0!==D.actions&&(Q._waitingData.actions=D.actions),void 0!==D.overlayAlpha&&(Q.overlayAlpha=D.overlayAlpha),void 0!==D.overlayColor&&(Q.overlayColor=F.d.Dd(D.overlayColor)),void 0!==D.renderOverlay&&(Q.renderOverlay=D.renderOverlay),Q.isUnIndexed=!!D.isUnIndexed,Q.hasVertexAlpha=D.hasVertexAlpha,D.delayLoadingFile?(Q.delayLoadState=4,Q.delayLoadingFile=W+D.delayLoadingFile,Q.buildBoundingInfo(f.j.Dd(D.boundingBoxMinimum),f.j.Dd(D.boundingBoxMaximum)),D._binaryInfo&&(Q._binaryInfo=D._binaryInfo),Q._delayInfo=[],D.hasUVs&&Q._delayInfo.push(P.f.UVKind),D.hasUVs2&&Q._delayInfo.push(P.f.UV2Kind),D.hasUVs3&&Q._delayInfo.push(P.f.UV3Kind),D.hasUVs4&&Q._delayInfo.push(P.f.UV4Kind),D.hasUVs5&&Q._delayInfo.push(P.f.UV5Kind),D.hasUVs6&&Q._delayInfo.push(P.f.UV6Kind),D.hasColors&&Q._delayInfo.push(P.f.ColorKind),D.hasMatricesIndices&&Q._delayInfo.push(P.f.MatricesIndicesKind),D.hasMatricesWeights&&Q._delayInfo.push(P.f.MatricesWeightsKind),Q._delayLoadingFunction=x.b._ImportGeometry,N.c.ForceFullSceneLoadingForIncremental&&Q._checkDelayState()):x.b._ImportGeometry(D,Q),D.materialUniqueId?Q._waitingMaterialId=D.materialUniqueId:D.materialId&&(Q._waitingMaterialId=D.materialId),D.morphTargetManagerId>-1&&(Q._waitingMorphTargetManagerId=D.morphTargetManagerId),void 0!==D.skeletonId&&null!==D.skeletonId&&(Q.skeleton=j.getLastSkeletonById(D.skeletonId),D.numBoneInfluencers&&(Q.numBoneInfluencers=D.numBoneInfluencers)),D.animations){for(let j=0;j<D.animations.length;j++){const W=D.animations[j],C=(0,L.b)("BABYLON.Animation");C&&Q.animations.push(C.Parse(W))}Z.e.ParseAnimationRanges(Q,D,j)}if(D.autoAnimate&&j.beginAnimation(Q,D.autoAnimateFrom,D.autoAnimateTo,D.autoAnimateLoop,D.autoAnimateSpeed||1),D.layerMask&&!isNaN(D.layerMask)?Q.layerMask=Math.abs(parseInt(D.layerMask)):Q.layerMask=268435455,D.physicsImpostor&&(Q.physicsImpostor=y._PhysicsImpostorParser(j,Q,D)),D.lodMeshIds&&(Q._waitingData.lods={ids:D.lodMeshIds,distances:D.lodDistances?D.lodDistances:null,coverages:D.lodCoverages?D.lodCoverages:null}),D.instances)for(let C=0;C<D.instances.length;C++){const W=D.instances[C],k=Q.yb(W.name);if(W.id&&(k.id=W.id),M.e&&(W.tags?M.e.AddTagsTo(k,W.tags):M.e.AddTagsTo(k,D.tags)),k.position=f.j.Dd(W.position),void 0!==W.metadata&&(k.metadata=W.metadata),void 0!==W.parentId&&(k._waitingParentId=W.parentId),void 0!==W.parentInstanceIndex&&(k._waitingParentInstanceIndex=W.parentInstanceIndex),void 0!==W.isEnabled&&null!==W.isEnabled&&k.Kg(W.isEnabled),void 0!==W.isVisible&&null!==W.isVisible&&(k.isVisible=W.isVisible),void 0!==W.he&&null!==W.he&&(k.he=W.he),W.rotationQuaternion?k.rotationQuaternion=f.d.Dd(W.rotationQuaternion):W.rotation&&(k.rotation=f.j.Dd(W.rotation)),k.Pd=f.j.Dd(W.Pd),void 0!=W.checkCollisions&&null!=W.checkCollisions&&(k.checkCollisions=W.checkCollisions),void 0!=W.pickable&&null!=W.pickable&&(k.he=W.pickable),void 0!=W.showBoundingBox&&null!=W.showBoundingBox&&(k.showBoundingBox=W.showBoundingBox),void 0!=W.showSubMeshesBoundingBox&&null!=W.showSubMeshesBoundingBox&&(k.showSubMeshesBoundingBox=W.showSubMeshesBoundingBox),void 0!=W.alphaIndex&&null!=W.showSubMeshesBoundingBox&&(k.alphaIndex=W.alphaIndex),W.physicsImpostor&&(k.physicsImpostor=y._PhysicsImpostorParser(j,k,W)),void 0!==W.actions&&(k._waitingData.actions=W.actions),W.animations){for(let D=0;D<W.animations.length;D++){const j=W.animations[D],Q=(0,L.b)("BABYLON.Animation");Q&&k.animations.push(Q.Parse(j))}Z.e.ParseAnimationRanges(k,W,j),W.autoAnimate&&j.beginAnimation(k,W.autoAnimateFrom,W.autoAnimateTo,W.autoAnimateLoop,W.autoAnimateSpeed||1)}}if(D.thinInstances){const j=D.thinInstances;if(Q.thinInstanceEnablePicking=!!j.enablePicking,j.matrixData?(Q.bk("matrix",new Float32Array(j.matrixData),16,!1),Q._thinInstanceDataStorage.matrixBufferSize=j.matrixBufferSize,Q._thinInstanceDataStorage.instancesCount=j.instancesCount):Q._thinInstanceDataStorage.matrixBufferSize=j.matrixBufferSize,D.thinInstances.userThinInstance){const j=D.thinInstances.userThinInstance;for(const D in j.data)Q.bk(D,new Float32Array(j.data[D]),j.strides[D],!1),Q._userThinInstanceBuffersStorage.sizes[D]=j.sizes[D]}}return Q}setPositionsForCPUSkinning(){const D=this._internalMeshDataInfo;if(!D._sourcePositions){const j=this.getVerticesData(P.f.PositionKind);if(!j)return D._sourcePositions;D._sourcePositions=new Float32Array(j),this.isVertexBufferUpdatable(P.f.PositionKind)||this.Ga(P.f.PositionKind,j,!0)}return D._sourcePositions}setNormalsForCPUSkinning(){const D=this._internalMeshDataInfo;if(!D._sourceNormals){const j=this.getVerticesData(P.f.NormalKind);if(!j)return D._sourceNormals;D._sourceNormals=new Float32Array(j),this.isVertexBufferUpdatable(P.f.NormalKind)||this.Ga(P.f.NormalKind,j,!0)}return D._sourceNormals}applySkeleton(D){if(!this.Ie)return this;if(this.Ie._softwareSkinningFrameId==this.va().getFrameId())return this;if(this.Ie._softwareSkinningFrameId=this.va().getFrameId(),!this.isVerticesDataPresent(P.f.PositionKind))return this;if(!this.isVerticesDataPresent(P.f.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(P.f.MatricesWeightsKind))return this;const j=this.isVerticesDataPresent(P.f.NormalKind),W=this._internalMeshDataInfo;if(!W._sourcePositions){const D=this.xe.slice();this.setPositionsForCPUSkinning(),this.xe=D}j&&!W._sourceNormals&&this.setNormalsForCPUSkinning();let Q=this.getVerticesData(P.f.PositionKind);if(!Q)return this;Q instanceof Float32Array||(Q=new Float32Array(Q));let C=this.getVerticesData(P.f.NormalKind);if(j){if(!C)return this;C instanceof Float32Array||(C=new Float32Array(C))}const k=this.getVerticesData(P.f.MatricesIndicesKind),M=this.getVerticesData(P.f.MatricesWeightsKind);if(!M||!k)return this;const O=this.numBoneInfluencers>4,E=O?this.getVerticesData(P.f.MatricesIndicesExtraKind):null,F=O?this.getVerticesData(P.f.MatricesWeightsExtraKind):null,Z=D.getTransformMatrices(this),X=f.j.Zero(),x=new f.b,R=new f.b;let V,U=0;for(let P=0;P<Q.length;P+=3,U+=4){let D;for(V=0;V<4;V++)D=M[U+V],D>0&&(f.b.FromFloat32ArrayToRefScaled(Z,Math.floor(16*k[U+V]),D,R),x.addToSelf(R));if(O)for(V=0;V<4;V++)D=F[U+V],D>0&&(f.b.FromFloat32ArrayToRefScaled(Z,Math.floor(16*E[U+V]),D,R),x.addToSelf(R));f.j.TransformCoordinatesFromFloatsToRef(W._sourcePositions[P],W._sourcePositions[P+1],W._sourcePositions[P+2],x,X),X.toArray(Q,P),j&&(f.j.TransformNormalFromFloatsToRef(W._sourceNormals[P],W._sourceNormals[P+1],W._sourceNormals[P+2],x,X),X.toArray(C,P)),x.reset()}return this.updateVerticesData(P.f.PositionKind,Q),j&&this.updateVerticesData(P.f.NormalKind,C),this}static MinMax(D){let j=null,W=null;return D.forEach((function(D){const Q=D.getBoundingInfo().boundingBox;j&&W?(j.minimizeInPlace(Q.minimumWorld),W.maximizeInPlace(Q.maximumWorld)):(j=Q.minimumWorld,W=Q.maximumWorld)})),j&&W?{min:j,max:W}:{min:f.j.Zero(),max:f.j.Zero()}}static Center(D){const j=D instanceof Array?y.MinMax(D):D;return f.j.Center(j.min,j.max)}static MergeMeshes(D){let j=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],W=arguments.length>2?arguments[2]:void 0,Q=arguments.length>3?arguments[3]:void 0,C=arguments.length>4?arguments[4]:void 0,k=arguments.length>5?arguments[5]:void 0;return(0,O.g)(y._MergeMeshesCoroutine(D,j,W,Q,C,k,!1))}static MergeMeshesAsync(D){let j=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],W=arguments.length>2?arguments[2]:void 0,Q=arguments.length>3?arguments[3]:void 0,C=arguments.length>4?arguments[4]:void 0,k=arguments.length>5?arguments[5]:void 0;return(0,O.f)(y._MergeMeshesCoroutine(D,j,W,Q,C,k,!0),(0,O.c)())}static*_MergeMeshesCoroutine(D){let j,W=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],Q=arguments.length>2?arguments[2]:void 0,C=arguments.length>3?arguments[3]:void 0,k=arguments.length>4?arguments[4]:void 0,M=arguments.length>5?arguments[5]:void 0,O=arguments.length>6?arguments[6]:void 0;if(0===(D=D.filter(Boolean)).length)return null;if(!Q){let W=0;for(j=0;j<D.length;j++)if(W+=D[j].getTotalVertices(),W>=65536)return K.b.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}M&&(k=!1);const E=new Array,f=new Array,F=new Array,Z=D[0].sideOrientation;for(j=0;j<D.length;j++){const W=D[j];if(W.isAnInstance)return K.b.Warn("Cannot merge instance meshes."),null;if(Z!==W.sideOrientation)return K.b.Warn("Cannot merge meshes with different sideOrientation values."),null;if(k&&F.push(W.getTotalIndices()),M)if(W.material){const D=W.material;if(D instanceof g.e){for(let j=0;j<D.Jg.length;j++)E.indexOf(D.Jg[j])<0&&E.push(D.Jg[j]);for(let j=0;j<W.xe.length;j++)f.push(E.indexOf(D.Jg[W.xe[j].materialIndex])),F.push(W.xe[j].indexCount)}else{E.indexOf(D)<0&&E.push(D);for(let j=0;j<W.xe.length;j++)f.push(E.indexOf(D)),F.push(W.xe[j].indexCount)}}else for(let D=0;D<W.xe.length;D++)f.push(0),F.push(W.xe[D].indexCount)}const P=D[0],x=D=>{const j=D.Ge(!0);return{vertexData:X.b.ExtractFromMesh(D,!1,!1),transform:j}},{vertexData:R,transform:U}=x(P);O&&(yield);const N=new Array(D.length-1);for(let X=1;X<D.length;X++)N[X-1]=x(D[X]),O&&(yield);const G=R._mergeCoroutine(U,N,Q,O,!W);let L=G.next();for(;!L.done;)O&&(yield),L=G.next();const e=L.value;C||(C=new y(P.name+"_merged",P.va()));const s=e._applyToCoroutine(C,void 0,O);let b=s.next();for(;!b.done;)O&&(yield),b=s.next();if(C.checkCollisions=P.checkCollisions,C.sideOrientation=P.sideOrientation,W)for(j=0;j<D.length;j++)D[j].dispose();if(k||M){C.releaseSubMeshes(),j=0;let D=0;for(;j<F.length;)V.c.CreateFromIndices(0,D,F[j],C,void 0,!1),D+=F[j],j++;for(const j of C.xe)j.refreshBoundingInfo();C.Ge(!0)}if(M){const D=new g.e(P.name+"_merged",P.va());D.Jg=E;for(let j=0;j<C.xe.length;j++)C.xe[j].materialIndex=f[j];C.material=D}else C.material=P.material;return C}Tj(D){D._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(D)}Sj(D){const j=D._indexInSourceMeshInstanceArray;if(-1!=j){if(j!==this.instances.length-1){const D=this.instances[this.instances.length-1];this.instances[j]=D,D._indexInSourceMeshInstanceArray=j}D._indexInSourceMeshInstanceArray=-1,this.instances.pop()}}_shouldConvertRHS(){return this._scene.useRightHandedSystem&&this.sideOrientation===U.c.CounterClockWiseSideOrientation}_getRenderingFillMode(D){const j=this.va();return j.forcePointsCloud?U.c.PointFillMode:j.forceWireframe?U.c.WireFrameFillMode:this.overrideRenderingFillMode??D}setMaterialByID(D){return this.setMaterialById(D)}static CreateRibbon(D,j,W,Q,C,k,M,O,E){throw new Error("Import MeshBuilder to populate this function")}static jb(D,j,W,Q,C,k){throw new Error("Import MeshBuilder to populate this function")}static CreateBox(D,j,W,Q,C){throw new Error("Import MeshBuilder to populate this function")}static CreateSphere(D,j,W,Q,C,k){throw new Error("Import MeshBuilder to populate this function")}static CreateHemisphere(D,j,W,Q){throw new Error("Import MeshBuilder to populate this function")}static CreateCylinder(D,j,W,Q,C,k,M,O,E){throw new Error("Import MeshBuilder to populate this function")}static CreateTorus(D,j,W,Q,C,k,M){throw new Error("Import MeshBuilder to populate this function")}static CreateTorusKnot(D,j,W,Q,C,k,M,O,E,f){throw new Error("Import MeshBuilder to populate this function")}static kb(D,j,W,Q,C){throw new Error("Import MeshBuilder to populate this function")}static CreateDashedLines(D,j,W,Q,C,k,M,O){throw new Error("Import MeshBuilder to populate this function")}static CreatePolygon(D,j,W,Q,C,k,M){throw new Error("Import MeshBuilder to populate this function")}static ExtrudePolygon(D,j,W,Q,C,k,M,O){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShape(D,j,W,Q,C,k,M,O,E,f){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShapeCustom(D,j,W,Q,C,k,M,O,E,f,F,Z){throw new Error("Import MeshBuilder to populate this function")}static CreateLathe(D,j,W,Q,C,k,M){throw new Error("Import MeshBuilder to populate this function")}static Lg(D,j,W,Q,C){throw new Error("Import MeshBuilder to populate this function")}static CreateGround(D,j,W,Q,C,k){throw new Error("Import MeshBuilder to populate this function")}static CreateTiledGround(D,j,W,Q,C,k,M,O,E){throw new Error("Import MeshBuilder to populate this function")}static CreateGroundFromHeightMap(D,j,W,Q,C,k,M,O,E,f,F){throw new Error("Import MeshBuilder to populate this function")}static CreateTube(D,j,W,Q,C,k,M,O,E,f){throw new Error("Import MeshBuilder to populate this function")}static CreatePolyhedron(D,j,W){throw new Error("Import MeshBuilder to populate this function")}static CreateIcoSphere(D,j,W){throw new Error("Import MeshBuilder to populate this function")}static CreateDecal(D,j,W,Q,C,k){throw new Error("Import MeshBuilder to populate this function")}static CreateCapsule(D,j,W){throw new Error("Import MeshBuilder to populate this function")}static ExtendToGoldberg(D){throw new Error("Import MeshBuilder to populate this function")}}y.FRONTSIDE=X.b.FRONTSIDE,y.BACKSIDE=X.b.BACKSIDE,y.DOUBLESIDE=X.b.DOUBLESIDE,y.DEFAULTSIDE=X.b.DEFAULTSIDE,y.NO_CAP=0,y.CAP_START=1,y.CAP_END=2,y.CAP_ALL=3,y.NO_FLIP=0,y.FLIP_TILE=1,y.ROTATE_TILE=2,y.FLIP_ROW=3,y.ROTATE_ROW=4,y.FLIP_N_ROTATE_TILE=5,y.FLIP_N_ROTATE_ROW=6,y.CENTER=0,y.LEFT=1,y.RIGHT=2,y.TOP=3,y.BOTTOM=4,y.INSTANCEDMESH_SORT_TRANSPARENT=!1,y._GroundMeshParser=(D,j)=>{throw(0,e.d)("GroundMesh")},y._GoldbergMeshParser=(D,j)=>{throw(0,e.d)("GoldbergMesh")},y._LinesMeshParser=(D,j)=>{throw(0,e.d)("LinesMesh")},y._GreasedLineMeshParser=(D,j)=>{throw(0,e.d)("GreasedLineMesh")},y._GreasedLineRibbonMeshParser=(D,j)=>{throw(0,e.d)("GreasedLineRibbonMesh")},y._TrailMeshParser=(D,j)=>{throw(0,e.d)("TrailMesh")},(0,L.c)("BABYLON.Mesh",y)},12016:(D,j,W)=>{"use strict";W.d(j,{b:()=>x});var Q=W(942),C=W(966),k=W(1256),M=W(1070),O=W(1163),E=W(1083),f=W(948),F=W(12002),Z=W(1044),P=W(1347);class X{}class x{constructor(){this.uniqueId=0,this.metadata={},this._applyTo=(0,F.e)(this._applyToCoroutine.bind(this)),this.uniqueId=x._UniqueIDGenerator,x._UniqueIDGenerator++}set(D,j){switch(D.length||E.b.Warn(`Setting vertex data kind '${j}' with an empty array`),j){case k.f.PositionKind:this.xa=D;break;case k.f.NormalKind:this.ya=D;break;case k.f.TangentKind:this.tangents=D;break;case k.f.UVKind:this.Aa=D;break;case k.f.UV2Kind:this.uvs2=D;break;case k.f.UV3Kind:this.uvs3=D;break;case k.f.UV4Kind:this.uvs4=D;break;case k.f.UV5Kind:this.uvs5=D;break;case k.f.UV6Kind:this.uvs6=D;break;case k.f.ColorKind:this.za=D;break;case k.f.MatricesIndicesKind:this.matricesIndices=D;break;case k.f.MatricesWeightsKind:this.matricesWeights=D;break;case k.f.MatricesIndicesExtraKind:this.matricesIndicesExtra=D;break;case k.f.MatricesWeightsExtraKind:this.matricesWeightsExtra=D}}Ca(D,j){return this._applyTo(D,j,!1),this}applyToGeometry(D,j){return this._applyTo(D,j,!1),this}updateMesh(D){return this._update(D),this}updateGeometry(D){return this._update(D),this}*_applyToCoroutine(D){let j=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2?arguments[2]:void 0;if(this.xa&&(D.Ga(k.f.PositionKind,this.xa,j),W&&(yield)),this.ya&&(D.Ga(k.f.NormalKind,this.ya,j),W&&(yield)),this.tangents&&(D.Ga(k.f.TangentKind,this.tangents,j),W&&(yield)),this.Aa&&(D.Ga(k.f.UVKind,this.Aa,j),W&&(yield)),this.uvs2&&(D.Ga(k.f.UV2Kind,this.uvs2,j),W&&(yield)),this.uvs3&&(D.Ga(k.f.UV3Kind,this.uvs3,j),W&&(yield)),this.uvs4&&(D.Ga(k.f.UV4Kind,this.uvs4,j),W&&(yield)),this.uvs5&&(D.Ga(k.f.UV5Kind,this.uvs5,j),W&&(yield)),this.uvs6&&(D.Ga(k.f.UV6Kind,this.uvs6,j),W&&(yield)),this.za&&(D.Ga(k.f.ColorKind,this.za,j),this.hasVertexAlpha&&void 0!==D.hasVertexAlpha&&(D.hasVertexAlpha=!0),W&&(yield)),this.matricesIndices&&(D.Ga(k.f.MatricesIndicesKind,this.matricesIndices,j),W&&(yield)),this.matricesWeights&&(D.Ga(k.f.MatricesWeightsKind,this.matricesWeights,j),W&&(yield)),this.matricesIndicesExtra&&(D.Ga(k.f.MatricesIndicesExtraKind,this.matricesIndicesExtra,j),W&&(yield)),this.matricesWeightsExtra&&(D.Ga(k.f.MatricesWeightsExtraKind,this.matricesWeightsExtra,j),W&&(yield)),this.indices?(D.setIndices(this.indices,null,j),W&&(yield)):D.setIndices([],null),D.xe&&this.materialInfos&&this.materialInfos.length>1){const j=D;j.xe=[];for(const D of this.materialInfos)new P.c(D.materialIndex,D.verticesStart,D.verticesCount,D.indexStart,D.indexCount,j)}return this}_update(D,j,W){return this.xa&&D.updateVerticesData(k.f.PositionKind,this.xa,j,W),this.ya&&D.updateVerticesData(k.f.NormalKind,this.ya,j,W),this.tangents&&D.updateVerticesData(k.f.TangentKind,this.tangents,j,W),this.Aa&&D.updateVerticesData(k.f.UVKind,this.Aa,j,W),this.uvs2&&D.updateVerticesData(k.f.UV2Kind,this.uvs2,j,W),this.uvs3&&D.updateVerticesData(k.f.UV3Kind,this.uvs3,j,W),this.uvs4&&D.updateVerticesData(k.f.UV4Kind,this.uvs4,j,W),this.uvs5&&D.updateVerticesData(k.f.UV5Kind,this.uvs5,j,W),this.uvs6&&D.updateVerticesData(k.f.UV6Kind,this.uvs6,j,W),this.za&&D.updateVerticesData(k.f.ColorKind,this.za,j,W),this.matricesIndices&&D.updateVerticesData(k.f.MatricesIndicesKind,this.matricesIndices,j,W),this.matricesWeights&&D.updateVerticesData(k.f.MatricesWeightsKind,this.matricesWeights,j,W),this.matricesIndicesExtra&&D.updateVerticesData(k.f.MatricesIndicesExtraKind,this.matricesIndicesExtra,j,W),this.matricesWeightsExtra&&D.updateVerticesData(k.f.MatricesWeightsExtraKind,this.matricesWeightsExtra,j,W),this.indices&&D.setIndices(this.indices,null),this}static _TransformVector3Coordinates(D,j){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:D.length;const k=C.e.Kd[0],M=C.e.Kd[1];for(let O=W;O<W+Q;O+=3)C.j.FromArrayToRef(D,O,k),C.j.TransformCoordinatesToRef(k,j,M),D[O]=M.x,D[O+1]=M.y,D[O+2]=M.z}static _TransformVector3Normals(D,j){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:D.length;const k=C.e.Kd[0],M=C.e.Kd[1];for(let O=W;O<W+Q;O+=3)C.j.FromArrayToRef(D,O,k),C.j.TransformNormalToRef(k,j,M),D[O]=M.x,D[O+1]=M.y,D[O+2]=M.z}static _TransformVector4Normals(D,j){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:D.length;const k=C.e.Vector4[0],M=C.e.Vector4[1];for(let O=W;O<W+Q;O+=4)C.m.FromArrayToRef(D,O,k),C.m.TransformNormalToRef(k,j,M),D[O]=M.x,D[O+1]=M.y,D[O+2]=M.z,D[O+3]=M.w}static _FlipFaces(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:D.length;for(let Q=j;Q<j+W;Q+=3){const j=D[Q+1];D[Q+1]=D[Q+2],D[Q+2]=j}}transform(D){const j=D.determinant()<0;return this.xa&&x._TransformVector3Coordinates(this.xa,D),this.ya&&x._TransformVector3Normals(this.ya,D),this.tangents&&x._TransformVector4Normals(this.tangents,D),j&&this.indices&&x._FlipFaces(this.indices),this}splitBasedOnMaterialID(){if(!this.materialInfos||this.materialInfos.length<2)return[this];const D=[];for(const j of this.materialInfos){const W=new x;if(this.xa&&(W.xa=this.xa.slice(3*j.verticesStart,3*(j.verticesCount+j.verticesStart))),this.ya&&(W.ya=this.ya.slice(3*j.verticesStart,3*(j.verticesCount+j.verticesStart))),this.tangents&&(W.tangents=this.tangents.slice(4*j.verticesStart,4*(j.verticesCount+j.verticesStart))),this.za&&(W.za=this.za.slice(4*j.verticesStart,4*(j.verticesCount+j.verticesStart))),this.Aa&&(W.Aa=this.Aa.slice(2*j.verticesStart,2*(j.verticesCount+j.verticesStart))),this.uvs2&&(W.uvs2=this.uvs2.slice(2*j.verticesStart,2*(j.verticesCount+j.verticesStart))),this.uvs3&&(W.uvs3=this.uvs3.slice(2*j.verticesStart,2*(j.verticesCount+j.verticesStart))),this.uvs4&&(W.uvs4=this.uvs4.slice(2*j.verticesStart,2*(j.verticesCount+j.verticesStart))),this.uvs5&&(W.uvs5=this.uvs5.slice(2*j.verticesStart,2*(j.verticesCount+j.verticesStart))),this.uvs6&&(W.uvs6=this.uvs6.slice(2*j.verticesStart,2*(j.verticesCount+j.verticesStart))),this.matricesIndices&&(W.matricesIndices=this.matricesIndices.slice(4*j.verticesStart,4*(j.verticesCount+j.verticesStart))),this.matricesIndicesExtra&&(W.matricesIndicesExtra=this.matricesIndicesExtra.slice(4*j.verticesStart,4*(j.verticesCount+j.verticesStart))),this.matricesWeights&&(W.matricesWeights=this.matricesWeights.slice(4*j.verticesStart,4*(j.verticesCount+j.verticesStart))),this.matricesWeightsExtra&&(W.matricesWeightsExtra=this.matricesWeightsExtra.slice(4*j.verticesStart,4*(j.verticesCount+j.verticesStart))),this.indices){W.indices=[];for(let D=j.indexStart;D<j.indexStart+j.indexCount;D++)W.indices.push(this.indices[D]-j.verticesStart)}const Q=new X;Q.indexStart=0,Q.indexCount=W.indices?W.indices.length:0,Q.materialIndex=j.materialIndex,Q.verticesStart=0,Q.verticesCount=(W.xa?W.xa.length:0)/3,W.materialInfos=[Q],D.push(W)}return D}merge(D){let j=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],C=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const k=Array.isArray(D)?D.map((D=>({vertexData:D}))):[{vertexData:D}];return(0,F.g)(this._mergeCoroutine(void 0,k,j,!1,W,Q,C))}*_mergeCoroutine(D,j){var W,Q;let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2],M=arguments.length>3?arguments[3]:void 0,O=arguments.length>4?arguments[4]:void 0,E=arguments.length>5&&void 0!==arguments[5]&&arguments[5],f=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this._validate();let F=j.map((D=>D.vertexData)),Z=this;if(f)for(const k of F)k&&(k._validate(),!this.ya&&k.ya&&(this.ya=new Float32Array(this.xa.length)),!this.tangents&&k.tangents&&(this.tangents=new Float32Array(this.xa.length/3*4)),!this.Aa&&k.Aa&&(this.Aa=new Float32Array(this.xa.length/3*2)),!this.uvs2&&k.uvs2&&(this.uvs2=new Float32Array(this.xa.length/3*2)),!this.uvs3&&k.uvs3&&(this.uvs3=new Float32Array(this.xa.length/3*2)),!this.uvs4&&k.uvs4&&(this.uvs4=new Float32Array(this.xa.length/3*2)),!this.uvs5&&k.uvs5&&(this.uvs5=new Float32Array(this.xa.length/3*2)),!this.uvs6&&k.uvs6&&(this.uvs6=new Float32Array(this.xa.length/3*2)),!this.za&&k.za&&(this.za=new Float32Array(this.xa.length/3*4),this.za.fill(1)),!this.matricesIndices&&k.matricesIndices&&(this.matricesIndices=new Float32Array(this.xa.length/3*4)),!this.matricesWeights&&k.matricesWeights&&(this.matricesWeights=new Float32Array(this.xa.length/3*4)),!this.matricesIndicesExtra&&k.matricesIndicesExtra&&(this.matricesIndicesExtra=new Float32Array(this.xa.length/3*4)),!this.matricesWeightsExtra&&k.matricesWeightsExtra&&(this.matricesWeightsExtra=new Float32Array(this.xa.length/3*4)));for(const k of F)if(k)if(f)this.ya&&!k.ya&&(k.ya=new Float32Array(k.xa.length)),this.tangents&&!k.tangents&&(k.tangents=new Float32Array(k.xa.length/3*4)),this.Aa&&!k.Aa&&(k.Aa=new Float32Array(k.xa.length/3*2)),this.uvs2&&!k.uvs2&&(k.uvs2=new Float32Array(k.xa.length/3*2)),this.uvs3&&!k.uvs3&&(k.uvs3=new Float32Array(k.xa.length/3*2)),this.uvs4&&!k.uvs4&&(k.uvs4=new Float32Array(k.xa.length/3*2)),this.uvs5&&!k.uvs5&&(k.uvs5=new Float32Array(k.xa.length/3*2)),this.uvs6&&!k.uvs6&&(k.uvs6=new Float32Array(k.xa.length/3*2)),this.za&&!k.za&&(k.za=new Float32Array(k.xa.length/3*4),k.za.fill(1)),this.matricesIndices&&!k.matricesIndices&&(k.matricesIndices=new Float32Array(k.xa.length/3*4)),this.matricesWeights&&!k.matricesWeights&&(k.matricesWeights=new Float32Array(k.xa.length/3*4)),this.matricesIndicesExtra&&!k.matricesIndicesExtra&&(k.matricesIndicesExtra=new Float32Array(k.xa.length/3*4)),this.matricesWeightsExtra&&!k.matricesWeightsExtra&&(k.matricesWeightsExtra=new Float32Array(k.xa.length/3*4));else if(k._validate(),!this.ya!==!k.ya||!this.tangents!==!k.tangents||!this.Aa!==!k.Aa||!this.uvs2!==!k.uvs2||!this.uvs3!==!k.uvs3||!this.uvs4!==!k.uvs4||!this.uvs5!==!k.uvs5||!this.uvs6!==!k.uvs6||!this.za!==!k.za||!this.matricesIndices!==!k.matricesIndices||!this.matricesWeights!==!k.matricesWeights||!this.matricesIndicesExtra!==!k.matricesIndicesExtra||!this.matricesWeightsExtra!==!k.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(E){let W=0,Q=0,C=0;const k=[];let M=null;const O=[];for(const j of this.splitBasedOnMaterialID())O.push({vertexData:j,transform:D});for(const D of j)if(D.vertexData)for(const j of D.vertexData.splitBasedOnMaterialID())O.push({vertexData:j,transform:D.transform});O.sort(((D,j)=>{const W=D.vertexData.materialInfos?D.vertexData.materialInfos[0].materialIndex:0,Q=j.vertexData.materialInfos?j.vertexData.materialInfos[0].materialIndex:0;return W>Q?1:W===Q?0:-1}));for(const D of O){const j=D.vertexData;if(W=j.materialInfos?j.materialInfos[0].materialIndex:0,M&&M.materialIndex===W)M.indexCount+=j.indices.length,M.verticesCount+=j.xa.length/3;else{const D=new X;D.materialIndex=W,D.indexStart=Q,D.indexCount=j.indices.length,D.verticesStart=C,D.verticesCount=j.xa.length/3,k.push(D),M=D}Q+=j.indices.length,C+=j.xa.length/3}const E=O.splice(0,1)[0];Z=E.vertexData,D=E.transform,F=O.map((D=>D.vertexData)),j=O,this.materialInfos=k}const P=F.reduce(((D,j)=>{var W;return D+((null===(W=j.indices)||void 0===W?void 0:W.length)??0)}),(null===(W=Z.indices)||void 0===W?void 0:W.length)??0);let R=O||F.some((D=>D.indices===Z.indices))?null===(Q=Z.indices)||void 0===Q?void 0:Q.slice():Z.indices;if(P>0){var V;let W=(null===(V=R)||void 0===V?void 0:V.length)??0;if(R||(R=new Array(P)),R.length!==P){if(Array.isArray(R))R.length=P;else{const D=C||R instanceof Uint32Array?new Uint32Array(P):new Uint16Array(P);D.set(R),R=D}D&&D.determinant()<0&&x._FlipFaces(R,0,W)}let Q=Z.xa?Z.xa.length/3:0;for(const{vertexData:D,transform:C}of j)if(D.indices){for(let j=0;j<D.indices.length;j++)R[W+j]=D.indices[j]+Q;C&&C.determinant()<0&&x._FlipFaces(R,W,D.indices.length),Q+=D.xa.length/3,W+=D.indices.length,M&&(yield)}}return this.indices=R,this.xa=x._MergeElement(k.f.PositionKind,Z.xa,D,j.map((D=>[D.vertexData.xa,D.transform]))),M&&(yield),Z.ya&&(this.ya=x._MergeElement(k.f.NormalKind,Z.ya,D,j.map((D=>[D.vertexData.ya,D.transform]))),M&&(yield)),Z.tangents&&(this.tangents=x._MergeElement(k.f.TangentKind,Z.tangents,D,j.map((D=>[D.vertexData.tangents,D.transform]))),M&&(yield)),Z.Aa&&(this.Aa=x._MergeElement(k.f.UVKind,Z.Aa,D,j.map((D=>[D.vertexData.Aa,D.transform]))),M&&(yield)),Z.uvs2&&(this.uvs2=x._MergeElement(k.f.UV2Kind,Z.uvs2,D,j.map((D=>[D.vertexData.uvs2,D.transform]))),M&&(yield)),Z.uvs3&&(this.uvs3=x._MergeElement(k.f.UV3Kind,Z.uvs3,D,j.map((D=>[D.vertexData.uvs3,D.transform]))),M&&(yield)),Z.uvs4&&(this.uvs4=x._MergeElement(k.f.UV4Kind,Z.uvs4,D,j.map((D=>[D.vertexData.uvs4,D.transform]))),M&&(yield)),Z.uvs5&&(this.uvs5=x._MergeElement(k.f.UV5Kind,Z.uvs5,D,j.map((D=>[D.vertexData.uvs5,D.transform]))),M&&(yield)),Z.uvs6&&(this.uvs6=x._MergeElement(k.f.UV6Kind,Z.uvs6,D,j.map((D=>[D.vertexData.uvs6,D.transform]))),M&&(yield)),Z.za&&(this.za=x._MergeElement(k.f.ColorKind,Z.za,D,j.map((D=>[D.vertexData.za,D.transform]))),(void 0!==Z.hasVertexAlpha||j.some((D=>void 0!==D.vertexData.hasVertexAlpha)))&&(this.hasVertexAlpha=Z.hasVertexAlpha||j.some((D=>D.vertexData.hasVertexAlpha))),M&&(yield)),Z.matricesIndices&&(this.matricesIndices=x._MergeElement(k.f.MatricesIndicesKind,Z.matricesIndices,D,j.map((D=>[D.vertexData.matricesIndices,D.transform]))),M&&(yield)),Z.matricesWeights&&(this.matricesWeights=x._MergeElement(k.f.MatricesWeightsKind,Z.matricesWeights,D,j.map((D=>[D.vertexData.matricesWeights,D.transform]))),M&&(yield)),Z.matricesIndicesExtra&&(this.matricesIndicesExtra=x._MergeElement(k.f.MatricesIndicesExtraKind,Z.matricesIndicesExtra,D,j.map((D=>[D.vertexData.matricesIndicesExtra,D.transform]))),M&&(yield)),Z.matricesWeightsExtra&&(this.matricesWeightsExtra=x._MergeElement(k.f.MatricesWeightsExtraKind,Z.matricesWeightsExtra,D,j.map((D=>[D.vertexData.matricesWeightsExtra,D.transform])))),this}static _MergeElement(D,j,W,Q){const C=Q.filter((D=>null!==D[0]&&void 0!==D[0]));if(!j&&0==C.length)return j;if(!j)return this._MergeElement(D,C[0][0],C[0][1],C.slice(1));const M=C.reduce(((D,j)=>D+j[0].length),j.length),O=D===k.f.PositionKind?x._TransformVector3Coordinates:D===k.f.NormalKind?x._TransformVector3Normals:D===k.f.TangentKind?x._TransformVector4Normals:()=>{};if(j instanceof Float32Array){const D=new Float32Array(M);D.set(j),W&&O(D,W,0,j.length);let Q=j.length;for(const[j,W]of C)D.set(j,Q),W&&O(D,W,Q,j.length),Q+=j.length;return D}{const D=new Array(M);for(let W=0;W<j.length;W++)D[W]=j[W];W&&O(D,W,0,j.length);let Q=j.length;for(const[j,W]of C){for(let W=0;W<j.length;W++)D[Q+W]=j[W];W&&O(D,W,Q,j.length),Q+=j.length}return D}}_validate(){if(!this.xa)throw new Z.i("Positions are required",Z.e.MeshInvalidPositionsError);const D=(D,j)=>{const W=k.f.DeduceStride(D);if(j.length%W!==0)throw new Error("The "+D+"s array count must be a multiple of "+W);return j.length/W},j=D(k.f.PositionKind,this.xa),W=(W,Q)=>{const C=D(W,Q);if(C!==j)throw new Error("The "+W+"s element count ("+C+") does not match the positions count ("+j+")")};this.ya&&W(k.f.NormalKind,this.ya),this.tangents&&W(k.f.TangentKind,this.tangents),this.Aa&&W(k.f.UVKind,this.Aa),this.uvs2&&W(k.f.UV2Kind,this.uvs2),this.uvs3&&W(k.f.UV3Kind,this.uvs3),this.uvs4&&W(k.f.UV4Kind,this.uvs4),this.uvs5&&W(k.f.UV5Kind,this.uvs5),this.uvs6&&W(k.f.UV6Kind,this.uvs6),this.za&&W(k.f.ColorKind,this.za),this.matricesIndices&&W(k.f.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&W(k.f.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&W(k.f.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&W(k.f.MatricesWeightsExtraKind,this.matricesWeightsExtra)}clone(){const D=this.serialize();return x.Parse(D)}serialize(){const D={};if(this.xa&&(D.xa=Array.from(this.xa)),this.ya&&(D.ya=Array.from(this.ya)),this.tangents&&(D.tangents=Array.from(this.tangents)),this.Aa&&(D.Aa=Array.from(this.Aa)),this.uvs2&&(D.uvs2=Array.from(this.uvs2)),this.uvs3&&(D.uvs3=Array.from(this.uvs3)),this.uvs4&&(D.uvs4=Array.from(this.uvs4)),this.uvs5&&(D.uvs5=Array.from(this.uvs5)),this.uvs6&&(D.uvs6=Array.from(this.uvs6)),this.za&&(D.za=Array.from(this.za),D.hasVertexAlpha=this.hasVertexAlpha),this.matricesIndices&&(D.matricesIndices=Array.from(this.matricesIndices),D.matricesIndices._isExpanded=!0),this.matricesWeights&&(D.matricesWeights=Array.from(this.matricesWeights)),this.matricesIndicesExtra&&(D.matricesIndicesExtra=Array.from(this.matricesIndicesExtra),D.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(D.matricesWeightsExtra=Array.from(this.matricesWeightsExtra)),D.indices=Array.from(this.indices),this.materialInfos){D.materialInfos=[];for(const j of this.materialInfos){const W={indexStart:j.indexStart,indexCount:j.indexCount,materialIndex:j.materialIndex,verticesStart:j.verticesStart,verticesCount:j.verticesCount};D.materialInfos.push(W)}}return D}static ExtractFromMesh(D,j,W){return x._ExtractFrom(D,j,W)}static ExtractFromGeometry(D,j,W){return x._ExtractFrom(D,j,W)}static _ExtractFrom(D,j,W){const Q=new x;if(D.isVerticesDataPresent(k.f.PositionKind)&&(Q.xa=D.getVerticesData(k.f.PositionKind,j,W)),D.isVerticesDataPresent(k.f.NormalKind)&&(Q.ya=D.getVerticesData(k.f.NormalKind,j,W)),D.isVerticesDataPresent(k.f.TangentKind)&&(Q.tangents=D.getVerticesData(k.f.TangentKind,j,W)),D.isVerticesDataPresent(k.f.UVKind)&&(Q.Aa=D.getVerticesData(k.f.UVKind,j,W)),D.isVerticesDataPresent(k.f.UV2Kind)&&(Q.uvs2=D.getVerticesData(k.f.UV2Kind,j,W)),D.isVerticesDataPresent(k.f.UV3Kind)&&(Q.uvs3=D.getVerticesData(k.f.UV3Kind,j,W)),D.isVerticesDataPresent(k.f.UV4Kind)&&(Q.uvs4=D.getVerticesData(k.f.UV4Kind,j,W)),D.isVerticesDataPresent(k.f.UV5Kind)&&(Q.uvs5=D.getVerticesData(k.f.UV5Kind,j,W)),D.isVerticesDataPresent(k.f.UV6Kind)&&(Q.uvs6=D.getVerticesData(k.f.UV6Kind,j,W)),D.isVerticesDataPresent(k.f.ColorKind)){const C=D.Ie||D,M=C.getVertexBuffer(k.f.ColorKind),O=C.getVerticesData(k.f.ColorKind,j,W);if(3===M.getSize()){const D=new Float32Array(4*O.length/3);for(let j=0,W=0;j<O.length;j+=3,W+=4)D[W]=O[j],D[W+1]=O[j+1],D[W+2]=O[j+2],D[W+3]=1;Q.za=D}else{if(4!==M.getSize())throw new Error(`Unexpected number of color components: ${M.getSize()}`);Q.za=O}}return D.isVerticesDataPresent(k.f.MatricesIndicesKind)&&(Q.matricesIndices=D.getVerticesData(k.f.MatricesIndicesKind,j,W)),D.isVerticesDataPresent(k.f.MatricesWeightsKind)&&(Q.matricesWeights=D.getVerticesData(k.f.MatricesWeightsKind,j,W)),D.isVerticesDataPresent(k.f.MatricesIndicesExtraKind)&&(Q.matricesIndicesExtra=D.getVerticesData(k.f.MatricesIndicesExtraKind,j,W)),D.isVerticesDataPresent(k.f.MatricesWeightsExtraKind)&&(Q.matricesWeightsExtra=D.getVerticesData(k.f.MatricesWeightsExtraKind,j,W)),Q.indices=D.Me(j,W),Q}static CreateRibbon(D){throw(0,M.d)("ribbonBuilder")}static CreateBox(D){throw(0,M.d)("boxBuilder")}static CreateTiledBox(D){throw(0,M.d)("tiledBoxBuilder")}static CreateTiledPlane(D){throw(0,M.d)("tiledPlaneBuilder")}static CreateSphere(D){throw(0,M.d)("sphereBuilder")}static CreateCylinder(D){throw(0,M.d)("cylinderBuilder")}static CreateTorus(D){throw(0,M.d)("torusBuilder")}static CreateLineSystem(D){throw(0,M.d)("linesBuilder")}static CreateDashedLines(D){throw(0,M.d)("linesBuilder")}static CreateGround(D){throw(0,M.d)("groundBuilder")}static CreateTiledGround(D){throw(0,M.d)("groundBuilder")}static CreateGroundFromHeightMap(D){throw(0,M.d)("groundBuilder")}static Lg(D){throw(0,M.d)("planeBuilder")}static jb(D){throw(0,M.d)("discBuilder")}static CreatePolygon(D,j,W,Q,C,k,O){throw(0,M.d)("polygonBuilder")}static CreateIcoSphere(D){throw(0,M.d)("icoSphereBuilder")}static CreatePolyhedron(D){throw(0,M.d)("polyhedronBuilder")}static CreateCapsule(){arguments.length>0&&void 0!==arguments[0]||C.j.Up();throw(0,M.d)("capsuleBuilder")}static CreateTorusKnot(D){throw(0,M.d)("torusKnotBuilder")}static ComputeNormals(D,j,W,Q){let k=0,M=0,O=0,E=0,f=0,F=0,Z=0,P=0,X=0,x=0,R=0,V=0,U=0,g=0,N=0,G=0,K=0,L=0,e=0,s=0,b=!1,Y=!1,t=!1,c=!1,l=1,I=0,y=null;Q&&(b=!!Q.facetNormals,Y=!!Q.facetPositions,t=!!Q.facetPartitioning,l=!0===Q.useRightHandedSystem?-1:1,I=Q.ratio||0,c=!!Q.depthSort,y=Q.distanceTo,c&&void 0===y&&(y=C.j.Zero()));let m=0,a=0,S=0,H=0;for(t&&Q&&Q.bbSize&&(m=Q.subDiv.X*I/Q.bbSize.x,a=Q.subDiv.Y*I/Q.bbSize.y,S=Q.subDiv.Z*I/Q.bbSize.z,H=Q.subDiv.max*Q.subDiv.max,Q.facetPartitioning.length=0),k=0;k<D.length;k++)W[k]=0;const z=j.length/3|0;for(k=0;k<z;k++){if(V=3*j[3*k],U=V+1,g=V+2,N=3*j[3*k+1],G=N+1,K=N+2,L=3*j[3*k+2],e=L+1,s=L+2,M=D[V]-D[N],O=D[U]-D[G],E=D[g]-D[K],f=D[L]-D[N],F=D[e]-D[G],Z=D[s]-D[K],P=l*(O*Z-E*F),X=l*(E*f-M*Z),x=l*(M*F-O*f),R=Math.sqrt(P*P+X*X+x*x),R=0===R?1:R,P/=R,X/=R,x/=R,b&&Q&&(Q.facetNormals[k].x=P,Q.facetNormals[k].y=X,Q.facetNormals[k].z=x),Y&&Q&&(Q.facetPositions[k].x=(D[V]+D[N]+D[L])/3,Q.facetPositions[k].y=(D[U]+D[G]+D[e])/3,Q.facetPositions[k].z=(D[g]+D[K]+D[s])/3),t&&Q){const j=Math.floor((Q.facetPositions[k].x-Q.bInfo.minimum.x*I)*m),W=Math.floor((Q.facetPositions[k].y-Q.bInfo.minimum.y*I)*a),C=Math.floor((Q.facetPositions[k].z-Q.bInfo.minimum.z*I)*S),M=Math.floor((D[V]-Q.bInfo.minimum.x*I)*m),O=Math.floor((D[U]-Q.bInfo.minimum.y*I)*a),E=Math.floor((D[g]-Q.bInfo.minimum.z*I)*S),f=Math.floor((D[N]-Q.bInfo.minimum.x*I)*m),F=Math.floor((D[G]-Q.bInfo.minimum.y*I)*a),Z=Math.floor((D[K]-Q.bInfo.minimum.z*I)*S),P=Math.floor((D[L]-Q.bInfo.minimum.x*I)*m),X=Math.floor((D[e]-Q.bInfo.minimum.y*I)*a),x=Math.floor((D[s]-Q.bInfo.minimum.z*I)*S),R=M+Q.subDiv.max*O+H*E,b=f+Q.subDiv.max*F+H*Z,Y=P+Q.subDiv.max*X+H*x,t=j+Q.subDiv.max*W+H*C;Q.facetPartitioning[t]=Q.facetPartitioning[t]?Q.facetPartitioning[t]:new Array,Q.facetPartitioning[R]=Q.facetPartitioning[R]?Q.facetPartitioning[R]:new Array,Q.facetPartitioning[b]=Q.facetPartitioning[b]?Q.facetPartitioning[b]:new Array,Q.facetPartitioning[Y]=Q.facetPartitioning[Y]?Q.facetPartitioning[Y]:new Array,Q.facetPartitioning[R].push(k),b!=R&&Q.facetPartitioning[b].push(k),Y!=b&&Y!=R&&Q.facetPartitioning[Y].push(k),t!=R&&t!=b&&t!=Y&&Q.facetPartitioning[t].push(k)}if(c&&Q&&Q.facetPositions){const D=Q.depthSortedFacets[k];D.ind=3*k,D.sqDistance=C.j.DistanceSquared(Q.facetPositions[k],y)}W[V]+=P,W[U]+=X,W[g]+=x,W[N]+=P,W[G]+=X,W[K]+=x,W[L]+=P,W[e]+=X,W[s]+=x}for(k=0;k<W.length/3;k++)P=W[3*k],X=W[3*k+1],x=W[3*k+2],R=Math.sqrt(P*P+X*X+x*x),R=0===R?1:R,P/=R,X/=R,x/=R,W[3*k]=P,W[3*k+1]=X,W[3*k+2]=x}static _ComputeSides(D,j,W,Q,k,M,O){const E=W.length,f=Q.length;let F,Z;switch(D=D||x.DEFAULTSIDE){case x.FRONTSIDE:break;case x.BACKSIDE:for(F=0;F<E;F+=3){const D=W[F];W[F]=W[F+2],W[F+2]=D}for(Z=0;Z<f;Z++)Q[Z]=-Q[Z];break;case x.DOUBLESIDE:{const D=j.length,P=D/3;for(let W=0;W<D;W++)j[D+W]=j[W];for(F=0;F<E;F+=3)W[F+E]=W[F+2]+P,W[F+1+E]=W[F+1]+P,W[F+2+E]=W[F]+P;for(Z=0;Z<f;Z++)Q[f+Z]=-Q[Z];const X=k.length;let x=0;for(x=0;x<X;x++)k[x+X]=k[x];for(M=M||new C.m(0,0,1,1),O=O||new C.m(0,0,1,1),x=0,F=0;F<X/2;F++)k[x]=M.x+(M.z-M.x)*k[x],k[x+1]=M.y+(M.w-M.y)*k[x+1],k[x+X]=O.x+(O.z-O.x)*k[x+X],k[x+X+1]=O.y+(O.w-O.y)*k[x+X+1],x+=2;break}}}static Parse(D){const j=new x,W=D.xa;W&&j.set(W,k.f.PositionKind);const Q=D.ya;Q&&j.set(Q,k.f.NormalKind);const C=D.tangents;C&&j.set(C,k.f.TangentKind);const M=D.Aa;M&&j.set(M,k.f.UVKind);const E=D.uvs2;E&&j.set(E,k.f.UV2Kind);const f=D.uvs3;f&&j.set(f,k.f.UV3Kind);const F=D.uvs4;F&&j.set(F,k.f.UV4Kind);const Z=D.uvs5;Z&&j.set(Z,k.f.UV5Kind);const P=D.uvs6;P&&j.set(P,k.f.UV6Kind);const R=D.za;R&&(j.set(O.h.CheckColors4(R,W.length/3),k.f.ColorKind),void 0!==D.hasVertexAlpha&&(j.hasVertexAlpha=D.hasVertexAlpha));const V=D.matricesIndices;V&&j.set(V,k.f.MatricesIndicesKind);const U=D.matricesWeights;U&&j.set(U,k.f.MatricesWeightsKind);const g=D.indices;g&&(j.indices=g);const N=D.materialInfos;if(N){j.materialInfos=[];for(const D of N){const W=new X;W.indexCount=D.indexCount,W.indexStart=D.indexStart,W.verticesCount=D.verticesCount,W.verticesStart=D.verticesStart,W.materialIndex=D.materialIndex,j.materialInfos.push(W)}}return j}static ImportVertexData(D,j){const W=x.Parse(D);j.setAllVerticesData(W,D.updatable)}}x.FRONTSIDE=0,x.BACKSIDE=1,x.DOUBLESIDE=2,x.DEFAULTSIDE=0,x._UniqueIDGenerator=0,(0,Q.b)([f.h.filter((function(){for(var D=arguments.length,j=new Array(D),W=0;W<D;W++)j[W]=arguments[W];let[Q]=j;return!Array.isArray(Q)}))],x,"_TransformVector3Coordinates",null),(0,Q.b)([f.h.filter((function(){for(var D=arguments.length,j=new Array(D),W=0;W<D;W++)j[W]=arguments[W];let[Q]=j;return!Array.isArray(Q)}))],x,"_TransformVector3Normals",null),(0,Q.b)([f.h.filter((function(){for(var D=arguments.length,j=new Array(D),W=0;W<D;W++)j[W]=arguments[W];let[Q]=j;return!Array.isArray(Q)}))],x,"_TransformVector4Normals",null),(0,Q.b)([f.h.filter((function(){for(var D=arguments.length,j=new Array(D),W=0;W<D;W++)j[W]=arguments[W];let[Q]=j;return!Array.isArray(Q)}))],x,"_FlipFaces",null)},13064:(D,j,W)=>{"use strict";W.d(j,{c:()=>RD});var Q=W(966),C=W(11994),k=W(1256),M=W(12016),O=W(1182);function E(D){let j=D.pathArray;const W=D.closeArray||!1,Q=D.closePath||!1,C=D.invertUV||!1,E=Math.floor(j[0].length/2);let f=D.offset||E;f=f>E?E:Math.floor(f);const F=0===D.sideOrientation?0:D.sideOrientation||M.b.DEFAULTSIDE,Z=D.Aa,P=D.za,X=[],x=[],R=[],V=[],U=[],g=[],N=[],G=[];let K;const L=[],e=[];let s,b,Y;if(j.length<2){const D=[],W=[];for(b=0;b<j[0].length-f;b++)D.push(j[0][b]),W.push(j[0][b+f]);j=[D,W]}let t=0;const c=Q?1:0,l=W?1:0;let I,y,m,a,S,H;for(K=j[0].length,s=0;s<j.length+l;s++){for(N[s]=0,U[s]=[0],I=s===j.length?j[0]:j[s],y=I.length,K=K<y?K:y,Y=0;Y<y;)X.push(I[Y].x,I[Y].y,I[Y].z),Y>0&&(m=I[Y].Qc(I[Y-1]).length(),a=m+N[s],U[s].push(a),N[s]=a),Y++;Q&&(Y--,X.push(I[0].x,I[0].y,I[0].z),m=I[Y].Qc(I[0]).length(),a=m+N[s],U[s].push(a),N[s]=a),L[s]=y+c,e[s]=t,t+=y+c}let z,i,p=null,T=null;for(b=0;b<K+c;b++)for(G[b]=0,g[b]=[0],s=0;s<j.length-1+l;s++)S=j[s],H=s===j.length-1?j[0]:j[s+1],b===K?(p=S[0],T=H[0]):(p=S[b],T=H[b]),m=T.Qc(p).length(),a=m+G[b],g[b].push(a),G[b]=a;if(Z)for(s=0;s<Z.length;s++)V.push(Z[s].x,O.b?1-Z[s].y:Z[s].y);else for(s=0;s<j.length+l;s++)for(b=0;b<K+c;b++)z=0!=N[s]?U[s][b]/N[s]:0,i=0!=G[b]?g[b][s]/G[b]:0,C?V.push(i,z):V.push(z,O.b?1-i:i);s=0;let A=0,w=L[s]-1,n=L[s+1]-1,u=w<n?w:n,q=e[1]-e[0];const o=L.length-1;for(;A<=u&&s<o;)x.push(A,A+q,A+1),x.push(A+q+1,A+1,A+q),A+=1,A===u&&(s++,q=e[s+1]-e[s],w=L[s]-1,n=L[s+1]-1,A=e[s],u=w<n?w+A:n+A);if(M.b.ComputeNormals(X,x,R),Q){let D=0,W=0;for(s=0;s<j.length;s++){D=3*e[s],W=s+1<j.length?3*(e[s+1]-1):R.length-3,R[D]=.5*(R[D]+R[W]),R[D+1]=.5*(R[D+1]+R[W+1]),R[D+2]=.5*(R[D+2]+R[W+2]);const Q=Math.sqrt(R[D]*R[D]+R[D+1]*R[D+1]+R[D+2]*R[D+2]);R[D]/=Q,R[D+1]/=Q,R[D+2]/=Q,R[W]=R[D],R[W+1]=R[D+1],R[W+2]=R[D+2]}}if(W){let D=3*e[0],W=3*e[j.length];for(b=0;b<K+c;b++){R[D]=.5*(R[D]+R[W]),R[D+1]=.5*(R[D+1]+R[W+1]),R[D+2]=.5*(R[D+2]+R[W+2]);const j=Math.sqrt(R[D]*R[D]+R[D+1]*R[D+1]+R[D+2]*R[D+2]);R[D]/=j,R[D+1]/=j,R[D+2]/=j,R[W]=R[D],R[W+1]=R[D+1],R[W+2]=R[D+2],D+=3,W+=3}}M.b._ComputeSides(F,X,x,R,V,D.frontUVs,D.backUVs);let J=null;if(P){J=new Float32Array(4*P.length);for(let D=0;D<P.length;D++)J[4*D]=P[D].r,J[4*D+1]=P[D].g,J[4*D+2]=P[D].b,J[4*D+3]=P[D].a}const h=new M.b,d=new Float32Array(X),v=new Float32Array(R),B=new Float32Array(V);return h.indices=x,h.xa=d,h.ya=v,h.Aa=B,J&&h.set(J,k.f.ColorKind),Q&&(h._idx=e),h}function f(D,j){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const f=j.pathArray,F=j.closeArray,Z=j.closePath,P=C.d._GetDefaultSideOrientation(j.sideOrientation),X=j.instance,x=j.updatable;if(X){const D=Q.e.Kd[0].Jd(Number.MAX_VALUE),W=Q.e.Kd[1].Jd(-Number.MAX_VALUE),E=j=>{let Q=f[0].length;const k=X;let M=0;const O=k._originalBuilderSideOrientation===C.d.DOUBLESIDE?2:1;for(let C=1;C<=O;++C)for(let O=0;O<f.length;++O){const C=f[O],E=C.length;Q=Q<E?Q:E;for(let k=0;k<Q;++k){const Q=C[k];j[M]=Q.x,j[M+1]=Q.y,j[M+2]=Q.z,D.minimizeInPlaceFromFloats(Q.x,Q.y,Q.z),W.maximizeInPlaceFromFloats(Q.x,Q.y,Q.z),M+=3}if(k._creationDataStorage&&k._creationDataStorage.closePath){const D=C[0];j[M]=D.x,j[M+1]=D.y,j[M+2]=D.z,M+=3}}},F=X.getVerticesData(k.f.PositionKind);if(E(F),X.hasBoundingInfo?X.getBoundingInfo().reConstruct(D,W,X._worldMatrix):X.buildBoundingInfo(D,W,X._worldMatrix),X.updateVerticesData(k.f.PositionKind,F,!1,!1),j.za){const D=X.getVerticesData(k.f.ColorKind);for(let W=0,Q=0;W<j.za.length;W++,Q+=4){const C=j.za[W];D[Q]=C.r,D[Q+1]=C.g,D[Q+2]=C.b,D[Q+3]=C.a}X.updateVerticesData(k.f.ColorKind,D,!1,!1)}if(j.Aa){const D=X.getVerticesData(k.f.UVKind);for(let W=0;W<j.Aa.length;W++)D[2*W]=j.Aa[W].x,D[2*W+1]=O.b?1-j.Aa[W].y:j.Aa[W].y;X.updateVerticesData(k.f.UVKind,D,!1,!1)}if(!X.areNormalsFrozen||X.isFacetDataEnabled){const D=X.Me(),j=X.getVerticesData(k.f.NormalKind),W=X.isFacetDataEnabled?X.getFacetDataParameters():null;if(M.b.ComputeNormals(F,D,j,W),X._creationDataStorage&&X._creationDataStorage.closePath){let D=0,W=0;for(let Q=0;Q<f.length;Q++)D=3*X._creationDataStorage.idx[Q],W=Q+1<f.length?3*(X._creationDataStorage.idx[Q+1]-1):j.length-3,j[D]=.5*(j[D]+j[W]),j[D+1]=.5*(j[D+1]+j[W+1]),j[D+2]=.5*(j[D+2]+j[W+2]),j[W]=j[D],j[W+1]=j[D+1],j[W+2]=j[D+2]}X.areNormalsFrozen||X.updateVerticesData(k.f.NormalKind,j,!1,!1)}return X}{const Q=new C.d(D,W);Q._originalBuilderSideOrientation=P,Q._creationDataStorage=new C.g;const k=E(j);return Z&&(Q._creationDataStorage.idx=k._idx),Q._creationDataStorage.closePath=Z,Q._creationDataStorage.closeArray=F,k.Ca(Q,x),Q}}M.b.CreateRibbon=E,C.d.CreateRibbon=function(D,j){return f(D,{pathArray:j,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var F=W(12176),Z=W(12049),P=W(1163);function X(D){const j=D.pattern||C.d.NO_FLIP,W=D.tileWidth||D.tileSize||1,Q=D.tileHeight||D.tileSize||1,k=D.alignHorizontal||0,O=D.alignVertical||0,E=D.width||D.size||1,f=Math.floor(E/W);let F=E-f*W;const Z=D.height||D.size||1,P=Math.floor(Z/Q);let X=Z-P*Q;const x=W*f/2,R=Q*P/2;let V=0,U=0,g=0,N=0,G=0,K=0;if(F>0||X>0){switch(g=-x,N=-R,G=x,K=R,k){case C.d.CENTER:F/=2,g-=F,G+=F;break;case C.d.LEFT:G+=F,V=-F/2;break;case C.d.RIGHT:g-=F,V=F/2}switch(O){case C.d.CENTER:X/=2,N-=X,K+=X;break;case C.d.BOTTOM:K+=X,U=-X/2;break;case C.d.TOP:N-=X,U=X/2}}const L=[],e=[],s=[];s[0]=[0,0,1,0,1,1,0,1],s[1]=[0,0,1,0,1,1,0,1],j!==C.d.ROTATE_TILE&&j!==C.d.ROTATE_ROW||(s[1]=[1,1,0,1,0,0,1,0]),j!==C.d.FLIP_TILE&&j!==C.d.FLIP_ROW||(s[1]=[1,0,0,0,0,1,1,1]),j!==C.d.FLIP_N_ROTATE_TILE&&j!==C.d.FLIP_N_ROTATE_ROW||(s[1]=[0,1,1,1,1,0,0,0]);let b=[];const Y=[],t=[];let c=0;for(let M=0;M<P;M++)for(let D=0;D<f;D++)L.push(D*W-x+V,M*Q-R+U,0),L.push((D+1)*W-x+V,M*Q-R+U,0),L.push((D+1)*W-x+V,(M+1)*Q-R+U,0),L.push(D*W-x+V,(M+1)*Q-R+U,0),t.push(c,c+1,c+3,c+1,c+2,c+3),b=j===C.d.FLIP_TILE||j===C.d.ROTATE_TILE||j===C.d.FLIP_N_ROTATE_TILE?b.concat(s[(D%2+M%2)%2]):j===C.d.FLIP_ROW||j===C.d.ROTATE_ROW||j===C.d.FLIP_N_ROTATE_ROW?b.concat(s[M%2]):b.concat(s[0]),Y.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),e.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),c+=4;if(F>0||X>0){const D=X>0&&(O===C.d.CENTER||O===C.d.TOP),M=X>0&&(O===C.d.CENTER||O===C.d.BOTTOM),E=F>0&&(k===C.d.CENTER||k===C.d.RIGHT),Z=F>0&&(k===C.d.CENTER||k===C.d.LEFT);let s,l,I,y,m=[];if(D&&E&&(L.push(g+V,N+U,0),L.push(-x+V,N+U,0),L.push(-x+V,N+X+U,0),L.push(g+V,N+X+U,0),t.push(c,c+1,c+3,c+1,c+2,c+3),c+=4,s=1-F/W,l=1-X/Q,I=1,y=1,m=[s,l,I,l,I,y,s,y],j===C.d.ROTATE_ROW&&(m=[1-s,1-l,1-I,1-l,1-I,1-y,1-s,1-y]),j===C.d.FLIP_ROW&&(m=[1-s,l,1-I,l,1-I,y,1-s,y]),j===C.d.FLIP_N_ROTATE_ROW&&(m=[s,1-l,I,1-l,I,1-y,s,1-y]),b=b.concat(m),Y.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),e.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),D&&Z&&(L.push(x+V,N+U,0),L.push(G+V,N+U,0),L.push(G+V,N+X+U,0),L.push(x+V,N+X+U,0),t.push(c,c+1,c+3,c+1,c+2,c+3),c+=4,s=0,l=1-X/Q,I=F/W,y=1,m=[s,l,I,l,I,y,s,y],(j===C.d.ROTATE_ROW||j===C.d.ROTATE_TILE&&f%2===0)&&(m=[1-s,1-l,1-I,1-l,1-I,1-y,1-s,1-y]),(j===C.d.FLIP_ROW||j===C.d.FLIP_TILE&&f%2===0)&&(m=[1-s,l,1-I,l,1-I,y,1-s,y]),(j===C.d.FLIP_N_ROTATE_ROW||j===C.d.FLIP_N_ROTATE_TILE&&f%2===0)&&(m=[s,1-l,I,1-l,I,1-y,s,1-y]),b=b.concat(m),Y.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),e.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),M&&E&&(L.push(g+V,R+U,0),L.push(-x+V,R+U,0),L.push(-x+V,K+U,0),L.push(g+V,K+U,0),t.push(c,c+1,c+3,c+1,c+2,c+3),c+=4,s=1-F/W,l=0,I=1,y=X/Q,m=[s,l,I,l,I,y,s,y],(j===C.d.ROTATE_ROW&&P%2===1||j===C.d.ROTATE_TILE&&P%1===0)&&(m=[1-s,1-l,1-I,1-l,1-I,1-y,1-s,1-y]),(j===C.d.FLIP_ROW&&P%2===1||j===C.d.FLIP_TILE&&P%2===0)&&(m=[1-s,l,1-I,l,1-I,y,1-s,y]),(j===C.d.FLIP_N_ROTATE_ROW&&P%2===1||j===C.d.FLIP_N_ROTATE_TILE&&P%2===0)&&(m=[s,1-l,I,1-l,I,1-y,s,1-y]),b=b.concat(m),Y.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),e.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),M&&Z&&(L.push(x+V,R+U,0),L.push(G+V,R+U,0),L.push(G+V,K+U,0),L.push(x+V,K+U,0),t.push(c,c+1,c+3,c+1,c+2,c+3),c+=4,s=0,l=0,I=F/W,y=X/Q,m=[s,l,I,l,I,y,s,y],(j===C.d.ROTATE_ROW&&P%2===1||j===C.d.ROTATE_TILE&&(P+f)%2===1)&&(m=[1-s,1-l,1-I,1-l,1-I,1-y,1-s,1-y]),(j===C.d.FLIP_ROW&&P%2===1||j===C.d.FLIP_TILE&&(P+f)%2===1)&&(m=[1-s,l,1-I,l,1-I,y,1-s,y]),(j===C.d.FLIP_N_ROTATE_ROW&&P%2===1||j===C.d.FLIP_N_ROTATE_TILE&&(P+f)%2===1)&&(m=[s,1-l,I,1-l,I,1-y,s,1-y]),b=b.concat(m),Y.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),e.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),D){const D=[];s=0,l=1-X/Q,I=1,y=1,D[0]=[s,l,I,l,I,y,s,y],D[1]=[s,l,I,l,I,y,s,y],j!==C.d.ROTATE_TILE&&j!==C.d.ROTATE_ROW||(D[1]=[1-s,1-l,1-I,1-l,1-I,1-y,1-s,1-y]),j!==C.d.FLIP_TILE&&j!==C.d.FLIP_ROW||(D[1]=[1-s,l,1-I,l,1-I,y,1-s,y]),j!==C.d.FLIP_N_ROTATE_TILE&&j!==C.d.FLIP_N_ROTATE_ROW||(D[1]=[s,1-l,I,1-l,I,1-y,s,1-y]);for(let Q=0;Q<f;Q++)L.push(Q*W-x+V,N+U,0),L.push((Q+1)*W-x+V,N+U,0),L.push((Q+1)*W-x+V,N+X+U,0),L.push(Q*W-x+V,N+X+U,0),t.push(c,c+1,c+3,c+1,c+2,c+3),c+=4,b=j===C.d.FLIP_TILE||j===C.d.ROTATE_TILE||j===C.d.FLIP_N_ROTATE_TILE?b.concat(D[(Q+1)%2]):j===C.d.FLIP_ROW||j===C.d.ROTATE_ROW||j===C.d.FLIP_N_ROTATE_ROW?b.concat(D[1]):b.concat(D[0]),Y.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),e.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(M){const D=[];s=0,l=0,I=1,y=X/Q,D[0]=[s,l,I,l,I,y,s,y],D[1]=[s,l,I,l,I,y,s,y],j!==C.d.ROTATE_TILE&&j!==C.d.ROTATE_ROW||(D[1]=[1-s,1-l,1-I,1-l,1-I,1-y,1-s,1-y]),j!==C.d.FLIP_TILE&&j!==C.d.FLIP_ROW||(D[1]=[1-s,l,1-I,l,1-I,y,1-s,y]),j!==C.d.FLIP_N_ROTATE_TILE&&j!==C.d.FLIP_N_ROTATE_ROW||(D[1]=[s,1-l,I,1-l,I,1-y,s,1-y]);for(let Q=0;Q<f;Q++)L.push(Q*W-x+V,K-X+U,0),L.push((Q+1)*W-x+V,K-X+U,0),L.push((Q+1)*W-x+V,K+U,0),L.push(Q*W-x+V,K+U,0),t.push(c,c+1,c+3,c+1,c+2,c+3),c+=4,b=j===C.d.FLIP_TILE||j===C.d.ROTATE_TILE||j===C.d.FLIP_N_ROTATE_TILE?b.concat(D[(Q+P)%2]):j===C.d.FLIP_ROW||j===C.d.ROTATE_ROW||j===C.d.FLIP_N_ROTATE_ROW?b.concat(D[P%2]):b.concat(D[0]),Y.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),e.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(E){const D=[];s=1-F/W,l=0,I=1,y=1,D[0]=[s,l,I,l,I,y,s,y],D[1]=[s,l,I,l,I,y,s,y],j!==C.d.ROTATE_TILE&&j!==C.d.ROTATE_ROW||(D[1]=[1-s,1-l,1-I,1-l,1-I,1-y,1-s,1-y]),j!==C.d.FLIP_TILE&&j!==C.d.FLIP_ROW||(D[1]=[1-s,l,1-I,l,1-I,y,1-s,y]),j!==C.d.FLIP_N_ROTATE_TILE&&j!==C.d.FLIP_N_ROTATE_ROW||(D[1]=[s,1-l,I,1-l,I,1-y,s,1-y]);for(let W=0;W<P;W++)L.push(g+V,W*Q-R+U,0),L.push(g+F+V,W*Q-R+U,0),L.push(g+F+V,(W+1)*Q-R+U,0),L.push(g+V,(W+1)*Q-R+U,0),t.push(c,c+1,c+3,c+1,c+2,c+3),c+=4,b=j===C.d.FLIP_TILE||j===C.d.ROTATE_TILE||j===C.d.FLIP_N_ROTATE_TILE?b.concat(D[(W+1)%2]):j===C.d.FLIP_ROW||j===C.d.ROTATE_ROW||j===C.d.FLIP_N_ROTATE_ROW?b.concat(D[W%2]):b.concat(D[0]),Y.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),e.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(Z){const D=[];s=0,l=0,I=F/Q,y=1,D[0]=[s,l,I,l,I,y,s,y],D[1]=[s,l,I,l,I,y,s,y],j!==C.d.ROTATE_TILE&&j!==C.d.ROTATE_ROW||(D[1]=[1-s,1-l,1-I,1-l,1-I,1-y,1-s,1-y]),j!==C.d.FLIP_TILE&&j!==C.d.FLIP_ROW||(D[1]=[1-s,l,1-I,l,1-I,y,1-s,y]),j!==C.d.FLIP_N_ROTATE_TILE&&j!==C.d.FLIP_N_ROTATE_ROW||(D[1]=[s,1-l,I,1-l,I,1-y,s,1-y]);for(let W=0;W<P;W++)L.push(G-F+V,W*Q-R+U,0),L.push(G+V,W*Q-R+U,0),L.push(G+V,(W+1)*Q-R+U,0),L.push(G-F+V,(W+1)*Q-R+U,0),t.push(c,c+1,c+3,c+1,c+2,c+3),c+=4,b=j===C.d.FLIP_TILE||j===C.d.ROTATE_TILE||j===C.d.FLIP_N_ROTATE_TILE?b.concat(D[(W+f)%2]):j===C.d.FLIP_ROW||j===C.d.ROTATE_ROW||j===C.d.FLIP_N_ROTATE_ROW?b.concat(D[W%2]):b.concat(D[0]),Y.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),e.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const l=0===D.sideOrientation?0:D.sideOrientation||M.b.DEFAULTSIDE;M.b._ComputeSides(l,L,t,e,b,D.frontUVs,D.backUVs);const I=new M.b;I.indices=t,I.xa=L,I.ya=e,I.Aa=b;const y=l===M.b.DOUBLESIDE?Y.concat(Y):Y;return I.za=y,I}function x(D,j){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=new C.d(D,W);j.sideOrientation=C.d._GetDefaultSideOrientation(j.sideOrientation),Q._originalBuilderSideOrientation=j.sideOrientation;return X(j).Ca(Q,j.updatable),Q}function R(D){const j=D.faceUV||new Array(6),W=D.faceColors,k=D.pattern||C.d.NO_FLIP,E=D.width||D.size||1,f=D.height||D.size||1,F=D.depth||D.size||1,Z=D.tileWidth||D.tileSize||1,x=D.tileHeight||D.tileSize||1,R=D.alignHorizontal||0,V=D.alignVertical||0,U=0===D.sideOrientation?0:D.sideOrientation||M.b.DEFAULTSIDE;for(let C=0;C<6;C++)void 0===j[C]&&(j[C]=new Q.m(0,0,1,1)),W&&void 0===W[C]&&(W[C]=new P.h(1,1,1,1));const g=E/2,N=f/2,G=F/2,K=[];for(let Q=0;Q<2;Q++)K[Q]=X({pattern:k,tileWidth:Z,tileHeight:x,width:E,height:f,alignVertical:V,alignHorizontal:R,sideOrientation:U});for(let Q=2;Q<4;Q++)K[Q]=X({pattern:k,tileWidth:Z,tileHeight:x,width:F,height:f,alignVertical:V,alignHorizontal:R,sideOrientation:U});let L=V;V===C.d.BOTTOM?L=C.d.TOP:V===C.d.TOP&&(L=C.d.BOTTOM);for(let Q=4;Q<6;Q++)K[Q]=X({pattern:k,tileWidth:Z,tileHeight:x,width:E,height:F,alignVertical:L,alignHorizontal:R,sideOrientation:U});let e=[],s=[],b=[],Y=[];const t=[],c=[],l=[],I=[];let y=0,m=0;for(let C=0;C<6;C++){const D=K[C].xa.length;c[C]=[],l[C]=[];for(let j=0;j<D/3;j++)c[C].push(new Q.j(K[C].xa[3*j],K[C].xa[3*j+1],K[C].xa[3*j+2])),l[C].push(new Q.j(K[C].ya[3*j],K[C].ya[3*j+1],K[C].ya[3*j+2]));y=K[C].Aa.length,I[C]=[];for(let W=0;W<y;W+=2)I[C][W]=j[C].x+(j[C].z-j[C].x)*K[C].Aa[W],I[C][W+1]=j[C].y+(j[C].w-j[C].y)*K[C].Aa[W+1],O.b&&(I[C][W+1]=1-I[C][W+1]);if(b=b.concat(I[C]),Y=Y.concat(K[C].indices.map((D=>D+m))),m+=c[C].length,W)for(let j=0;j<4;j++)t.push(W[C].r,W[C].g,W[C].b,W[C].a)}const a=new Q.j(0,0,G),S=Q.b.RotationY(Math.PI);e=c[0].map((D=>Q.j.TransformNormal(D,S).add(a))).map((D=>[D.x,D.y,D.z])).reduce(((D,j)=>D.concat(j)),[]),s=l[0].map((D=>Q.j.TransformNormal(D,S))).map((D=>[D.x,D.y,D.z])).reduce(((D,j)=>D.concat(j)),[]),e=e.concat(c[1].map((D=>D.Qc(a))).map((D=>[D.x,D.y,D.z])).reduce(((D,j)=>D.concat(j)),[])),s=s.concat(l[1].map((D=>[D.x,D.y,D.z])).reduce(((D,j)=>D.concat(j)),[]));const H=new Q.j(g,0,0),z=Q.b.RotationY(-Math.PI/2);e=e.concat(c[2].map((D=>Q.j.TransformNormal(D,z).add(H))).map((D=>[D.x,D.y,D.z])).reduce(((D,j)=>D.concat(j)),[])),s=s.concat(l[2].map((D=>Q.j.TransformNormal(D,z))).map((D=>[D.x,D.y,D.z])).reduce(((D,j)=>D.concat(j)),[]));const i=Q.b.RotationY(Math.PI/2);e=e.concat(c[3].map((D=>Q.j.TransformNormal(D,i).Qc(H))).map((D=>[D.x,D.y,D.z])).reduce(((D,j)=>D.concat(j)),[])),s=s.concat(l[3].map((D=>Q.j.TransformNormal(D,i))).map((D=>[D.x,D.y,D.z])).reduce(((D,j)=>D.concat(j)),[]));const p=new Q.j(0,N,0),T=Q.b.RotationX(Math.PI/2);e=e.concat(c[4].map((D=>Q.j.TransformNormal(D,T).add(p))).map((D=>[D.x,D.y,D.z])).reduce(((D,j)=>D.concat(j)),[])),s=s.concat(l[4].map((D=>Q.j.TransformNormal(D,T))).map((D=>[D.x,D.y,D.z])).reduce(((D,j)=>D.concat(j)),[]));const A=Q.b.RotationX(-Math.PI/2);e=e.concat(c[5].map((D=>Q.j.TransformNormal(D,A).Qc(p))).map((D=>[D.x,D.y,D.z])).reduce(((D,j)=>D.concat(j)),[])),s=s.concat(l[5].map((D=>Q.j.TransformNormal(D,A))).map((D=>[D.x,D.y,D.z])).reduce(((D,j)=>D.concat(j)),[])),M.b._ComputeSides(U,e,Y,s,b);const w=new M.b;if(w.indices=Y,w.xa=e,w.ya=s,w.Aa=b,W){const D=U===M.b.DOUBLESIDE?t.concat(t):t;w.za=D}return w}function V(D,j){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=new C.d(D,W);j.sideOrientation=C.d._GetDefaultSideOrientation(j.sideOrientation),Q._originalBuilderSideOrientation=j.sideOrientation;return R(j).Ca(Q,j.updatable),Q}M.b.CreateTiledPlane=X;M.b.CreateTiledBox=R;var U=W(12161),g=W(1199),N=W(1510);function G(D){const j=D.height||2;let W=0===D.diameterTop?0:D.diameterTop||D.diameter||1,k=0===D.diameterBottom?0:D.diameterBottom||D.diameter||1;W=W||1e-5,k=k||1e-5;const E=0|(D.dl||24),f=0|(D.subdivisions||1),F=!!D.hasRings,Z=!!D.enclose,X=0===D.cap?0:D.cap||C.d.CAP_ALL,x=D.arc&&(D.arc<=0||D.arc>1)?1:D.arc||1,R=0===D.sideOrientation?0:D.sideOrientation||M.b.DEFAULTSIDE,V=D.faceUV||new Array(3),U=D.faceColors,g=2+(1+(1!==x&&Z?2:0))*(F?f:1);let G;for(G=0;G<g;G++)U&&void 0===U[G]&&(U[G]=new P.h(1,1,1,1));for(G=0;G<g;G++)V&&void 0===V[G]&&(V[G]=new Q.m(0,0,1,1));const K=[],L=[],e=[],s=[],b=[],Y=2*Math.PI*x/E;let t,c,l;const I=(k-W)/2/j,y=Q.j.Zero(),m=Q.j.Zero(),a=Q.j.Zero(),S=Q.j.Zero(),H=Q.j.Zero(),z=N.c.Y;let i,p,T,A=1,w=1,n=0,u=0;for(i=0;i<=f;i++)for(c=i/f,l=(c*(W-k)+k)/2,A=F&&0!==i&&i!==f?2:1,T=0;T<A;T++){for(F&&(w+=T),Z&&(w+=2*T),p=0;p<=E;p++)t=p*Y,y.x=Math.cos(-t)*l,y.y=-j/2+c*j,y.z=Math.sin(-t)*l,0===W&&i===f?(m.x=e[e.length-3*(E+1)],m.y=e[e.length-3*(E+1)+1],m.z=e[e.length-3*(E+1)+2]):(m.x=y.x,m.z=y.z,m.y=Math.sqrt(m.x*m.x+m.z*m.z)*I,m.normalize()),0===p&&(a.p(y),S.p(m)),L.push(y.x,y.y,y.z),e.push(m.x,m.y,m.z),u=F?n!==w?V[w].y:V[w].w:V[w].y+(V[w].w-V[w].y)*c,s.push(V[w].x+(V[w].z-V[w].x)*p/E,O.b?1-u:u),U&&b.push(U[w].r,U[w].g,U[w].b,U[w].a);1!==x&&Z&&(L.push(y.x,y.y,y.z),L.push(0,y.y,0),L.push(0,y.y,0),L.push(a.x,a.y,a.z),Q.j.CrossToRef(z,m,H),H.normalize(),e.push(H.x,H.y,H.z,H.x,H.y,H.z),Q.j.CrossToRef(S,z,H),H.normalize(),e.push(H.x,H.y,H.z,H.x,H.y,H.z),u=F?n!==w?V[w+1].y:V[w+1].w:V[w+1].y+(V[w+1].w-V[w+1].y)*c,s.push(V[w+1].x,O.b?1-u:u),s.push(V[w+1].z,O.b?1-u:u),u=F?n!==w?V[w+2].y:V[w+2].w:V[w+2].y+(V[w+2].w-V[w+2].y)*c,s.push(V[w+2].x,O.b?1-u:u),s.push(V[w+2].z,O.b?1-u:u),U&&(b.push(U[w+1].r,U[w+1].g,U[w+1].b,U[w+1].a),b.push(U[w+1].r,U[w+1].g,U[w+1].b,U[w+1].a),b.push(U[w+2].r,U[w+2].g,U[w+2].b,U[w+2].a),b.push(U[w+2].r,U[w+2].g,U[w+2].b,U[w+2].a))),n!==w&&(n=w)}const q=1!==x&&Z?E+4:E;for(i=0,w=0;w<f;w++){let D=0,j=0,W=0,Q=0;for(p=0;p<E;p++)D=i*(q+1)+p,j=(i+1)*(q+1)+p,W=i*(q+1)+(p+1),Q=(i+1)*(q+1)+(p+1),K.push(D,j,W),K.push(Q,W,j);1!==x&&Z&&(K.push(D+2,j+2,W+2),K.push(Q+2,W+2,j+2),K.push(D+4,j+4,W+4),K.push(Q+4,W+4,j+4)),i=F?i+2:i+1}const o=D=>{const C=D?W/2:k/2;if(0===C)return;let M,f,F;const Z=D?V[g-1]:V[0];let P=null;U&&(P=D?U[g-1]:U[0]);const X=L.length/3,R=D?j/2:-j/2,N=new Q.j(0,R,0);L.push(N.x,N.y,N.z),e.push(0,D?1:-1,0);const G=Z.y+.5*(Z.w-Z.y);s.push(Z.x+.5*(Z.z-Z.x),O.b?1-G:G),P&&b.push(P.r,P.g,P.b,P.a);const Y=new Q.f(.5,.5);for(F=0;F<=E;F++){M=2*Math.PI*F*x/E;const j=Math.cos(-M),W=Math.sin(-M);f=new Q.j(j*C,R,W*C);const k=new Q.f(j*Y.x+.5,W*Y.y+.5);L.push(f.x,f.y,f.z),e.push(0,D?1:-1,0);const X=Z.y+(Z.w-Z.y)*k.y;s.push(Z.x+(Z.z-Z.x)*k.x,O.b?1-X:X),P&&b.push(P.r,P.g,P.b,P.a)}for(F=0;F<E;F++)D?(K.push(X),K.push(X+(F+2)),K.push(X+(F+1))):(K.push(X),K.push(X+(F+1)),K.push(X+(F+2)))};X!==C.d.CAP_START&&X!==C.d.CAP_ALL||o(!1),X!==C.d.CAP_END&&X!==C.d.CAP_ALL||o(!0),M.b._ComputeSides(R,L,K,e,s,D.frontUVs,D.backUVs);const J=new M.b;return J.indices=K,J.xa=L,J.ya=e,J.Aa=s,U&&(J.za=b),J}function K(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},W=arguments.length>2?arguments[2]:void 0;const Q=new C.d(D,W);j.sideOrientation=C.d._GetDefaultSideOrientation(j.sideOrientation),Q._originalBuilderSideOrientation=j.sideOrientation;return G(j).Ca(Q,j.updatable),Q}function L(D){const j=[],W=[],C=[],k=[],E=D.diameter||1,f=D.thickness||.5,F=0|(D.dl||16),Z=0===D.sideOrientation?0:D.sideOrientation||M.b.DEFAULTSIDE,P=F+1;for(let M=0;M<=F;M++){const D=M/F,Z=M*Math.PI*2/F-Math.PI/2,X=Q.b.Translation(E/2,0,0).multiply(Q.b.RotationY(Z));for(let E=0;E<=F;E++){const Z=1-E/F,x=E*Math.PI*2/F+Math.PI,R=Math.cos(x),V=Math.sin(x);let U=new Q.j(R,V,0),g=U.scale(f/2);const N=new Q.f(D,Z);g=Q.j.TransformCoordinates(g,X),U=Q.j.TransformNormal(U,X),W.push(g.x,g.y,g.z),C.push(U.x,U.y,U.z),k.push(N.x,O.b?1-N.y:N.y);const G=(M+1)%P,K=(E+1)%P;j.push(M*P+E),j.push(M*P+K),j.push(G*P+E),j.push(M*P+K),j.push(G*P+K),j.push(G*P+E)}}M.b._ComputeSides(Z,W,j,C,k,D.frontUVs,D.backUVs);const X=new M.b;return X.indices=j,X.xa=W,X.ya=C,X.Aa=k,X}function e(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},W=arguments.length>2?arguments[2]:void 0;const Q=new C.d(D,W);j.sideOrientation=C.d._GetDefaultSideOrientation(j.sideOrientation),Q._originalBuilderSideOrientation=j.sideOrientation;return L(j).Ca(Q,j.updatable),Q}M.b.CreateCylinder=G,C.d.CreateCylinder=(D,j,W,Q,k,M,O,E,f)=>{void 0!==O&&O instanceof g.b||(void 0!==O&&(f=E||C.d.DEFAULTSIDE,E=O),O=M,M=1);return K(D,{height:j,diameterTop:W,diameterBottom:Q,dl:k,subdivisions:M,sideOrientation:f,updatable:E},O)};function s(D){const j=[],W=[],C=[],k=[],E=D.i||2,f=D.tube||.5,F=D.radialSegments||32,Z=D.tubularSegments||32,P=D.p||2,X=D.q||3,x=0===D.sideOrientation?0:D.sideOrientation||M.b.DEFAULTSIDE,R=D=>{const j=Math.cos(D),W=Math.sin(D),C=X/P*D,k=Math.cos(C),M=E*(2+k)*.5*j,O=E*(2+k)*W*.5,f=E*Math.sin(C)*.5;return new Q.j(M,O,f)};let V,U;for(V=0;V<=F;V++){const D=V%F/F*2*P*Math.PI,j=R(D),C=R(D+.01),M=C.Qc(j);let E=C.add(j);const X=Q.j.Cross(M,E);for(E=Q.j.Cross(X,M),X.normalize(),E.normalize(),U=0;U<Z;U++){const D=U%Z/Z*2*Math.PI,Q=-f*Math.cos(D),C=f*Math.sin(D);W.push(j.x+Q*E.x+C*X.x),W.push(j.y+Q*E.y+C*X.y),W.push(j.z+Q*E.z+C*X.z),k.push(V/F),k.push(O.b?1-U/Z:U/Z)}}for(V=0;V<F;V++)for(U=0;U<Z;U++){const D=(U+1)%Z,W=V*Z+U,Q=(V+1)*Z+U,C=(V+1)*Z+D,k=V*Z+D;j.push(k),j.push(Q),j.push(W),j.push(k),j.push(C),j.push(Q)}M.b.ComputeNormals(W,j,C),M.b._ComputeSides(x,W,j,C,k,D.frontUVs,D.backUVs);const g=new M.b;return g.indices=j,g.xa=W,g.ya=C,g.Aa=k,g}function b(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},W=arguments.length>2?arguments[2]:void 0;const Q=new C.d(D,W);j.sideOrientation=C.d._GetDefaultSideOrientation(j.sideOrientation),Q._originalBuilderSideOrientation=j.sideOrientation;return s(j).Ca(Q,j.updatable),Q}M.b.CreateTorus=L,C.d.CreateTorus=(D,j,W,Q,C,k,M)=>e(D,{diameter:j,thickness:W,dl:Q,sideOrientation:M,updatable:k},C);M.b.CreateTorusKnot=s,C.d.CreateTorusKnot=(D,j,W,Q,C,k,M,O,E,f)=>b(D,{i:j,tube:W,radialSegments:Q,tubularSegments:C,p:k,q:M,sideOrientation:f,updatable:E},O);var Y=W(13069),t=W(1083),c=W(1517),l=W(971),I=W(991);class y extends Q.f{constructor(D,j){super(D.x,D.y),this.index=j}}class m{constructor(){this.elements=[]}add(D){const j=[];return D.forEach((D=>{const W=new y(D,this.elements.length);j.push(W),this.elements.push(W)})),j}computeBounds(){const D=new Q.f(this.elements[0].x,this.elements[0].y),j=new Q.f(this.elements[0].x,this.elements[0].y);return this.elements.forEach((W=>{W.x<D.x?D.x=W.x:W.x>j.x&&(j.x=W.x),W.y<D.y?D.y=W.y:W.y>j.y&&(j.y=W.y)})),{min:D,max:j,width:j.x-D.x,height:j.y-D.y}}}class a{_addToepoint(D){for(const j of D)this._epoints.push(j.x,j.y)}constructor(D,j,W){let Q,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;this._points=new m,this._outlinepoints=new m,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=C,this._name=D,this._scene=W||I.b.LastCreatedScene,Q=j instanceof c.f?j.getPoints():j,this._addToepoint(Q),this._points.add(Q),this._outlinepoints.add(Q),"undefined"===typeof this.bjsEarcut&&t.b.Warn("Earcut was not found, the polygon will not be built.")}addHole(D){this._points.add(D);const j=new m;return j.add(D),this._holes.push(j),this._eholes.push(this._epoints.length/2),this._addToepoint(D),this}build(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0],j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const Q=new C.d(this._name,this._scene),M=this.buildVertexData(j,W);return Q.Ga(k.f.PositionKind,M.xa,D),Q.Ga(k.f.NormalKind,M.ya,D),Q.Ga(k.f.UVKind,M.Aa,D),Q.setIndices(M.indices),Q}buildVertexData(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const W=new M.b,Q=[],C=[],k=[],O=this._points.computeBounds();this._points.elements.forEach((D=>{Q.push(0,1,0),C.push(D.x,0,D.y),k.push((D.x-O.min.x)/O.width,(D.y-O.min.y)/O.height)}));const E=[],f=this.bjsEarcut(this._epoints,this._eholes,2);for(let M=0;M<f.length;M++)E.push(f[M]);if(D>0){const W=C.length/3;this._points.elements.forEach((j=>{Q.push(0,-1,0),C.push(j.x,-D,j.y),k.push(1-(j.x-O.min.x)/O.width,1-(j.y-O.min.y)/O.height)}));const M=E.length;for(let D=0;D<M;D+=3){const j=E[D+0],Q=E[D+1],C=E[D+2];E.push(C+W),E.push(Q+W),E.push(j+W)}this._addSide(C,Q,k,E,O,this._outlinepoints,D,!1,j),this._holes.forEach((W=>{this._addSide(C,Q,k,E,O,W,D,!0,j)}))}return W.indices=E,W.xa=C,W.ya=Q,W.Aa=k,W}_addSide(D,j,W,C,k,M,O,E,f){let F=D.length/3,Z=0;for(let P=0;P<M.elements.length;P++){const X=M.elements[P],x=M.elements[(P+1)%M.elements.length];D.push(X.x,0,X.y),D.push(X.x,-O,X.y),D.push(x.x,0,x.y),D.push(x.x,-O,x.y);const R=M.elements[(P+M.elements.length-1)%M.elements.length],V=M.elements[(P+2)%M.elements.length];let U=new Q.j(-(x.y-X.y),0,x.x-X.x),g=new Q.j(-(X.y-R.y),0,X.x-R.x),N=new Q.j(-(V.y-x.y),0,V.x-x.x);E||(U=U.scale(-1),g=g.scale(-1),N=N.scale(-1));const G=U.normalizeToNew();let K=g.normalizeToNew(),L=N.normalizeToNew();const e=Q.j.Dot(K,G);K=e>f?e<l.c-1?new Q.j(X.x,0,X.y).Qc(new Q.j(x.x,0,x.y)).normalize():g.add(U).normalize():G;const s=Q.j.Dot(N,U);L=s>f?s<l.c-1?new Q.j(x.x,0,x.y).Qc(new Q.j(X.x,0,X.y)).normalize():N.add(U).normalize():G,W.push(Z/k.width,0),W.push(Z/k.width,1),Z+=U.length(),W.push(Z/k.width,0),W.push(Z/k.width,1),j.push(K.x,K.y,K.z),j.push(K.x,K.y,K.z),j.push(L.x,L.y,L.z),j.push(L.x,L.y,L.z),E?(C.push(F),C.push(F+2),C.push(F+1),C.push(F+1),C.push(F+2),C.push(F+3)):(C.push(F),C.push(F+1),C.push(F+2),C.push(F+1),C.push(F+3),C.push(F+2)),F+=4}}}function S(D,j,W,C,E,f,F){const Z=W||new Array(3),X=C,x=[],R=F||!1;for(let k=0;k<3;k++)void 0===Z[k]&&(Z[k]=new Q.m(0,0,1,1)),X&&void 0===X[k]&&(X[k]=new P.h(1,1,1,1));const V=D.getVerticesData(k.f.PositionKind),U=D.getVerticesData(k.f.NormalKind),g=D.getVerticesData(k.f.UVKind),N=D.Me(),G=V.length/9;let K=0,L=0,e=0,s=0,b=0;const Y=[0];if(R)for(let Q=G;Q<V.length/3;Q+=4)L=V[3*(Q+2)]-V[3*Q],e=V[3*(Q+2)+2]-V[3*Q+2],s=Math.sqrt(L*L+e*e),b+=s,Y.push(b);let t=0,c=0;for(let Q=0;Q<U.length;Q+=3)Math.abs(U[Q+1])<.001&&(c=1),Math.abs(U[Q+1]-1)<.001&&(c=0),Math.abs(U[Q+1]+1)<.001&&(c=2),t=Q/3,1===c?(K=t-G,g[2*t]=K%4<1.5?R?Z[c].x+(Z[c].z-Z[c].x)*Y[Math.floor(K/4)]/b:Z[c].x:R?Z[c].x+(Z[c].z-Z[c].x)*Y[Math.floor(K/4)+1]/b:Z[c].z,g[2*t+1]=K%2===0?O.b?1-Z[c].w:Z[c].w:O.b?1-Z[c].y:Z[c].y):(g[2*t]=(1-g[2*t])*Z[c].x+g[2*t]*Z[c].z,g[2*t+1]=(1-g[2*t+1])*Z[c].y+g[2*t+1]*Z[c].w,O.b&&(g[2*t+1]=1-g[2*t+1])),X&&x.push(X[c].r,X[c].g,X[c].b,X[c].a);M.b._ComputeSides(j,V,N,U,g,E,f);const l=new M.b;if(l.indices=N,l.xa=V,l.ya=U,l.Aa=g,X){const D=j===M.b.DOUBLESIDE?x.concat(x):x;l.za=D}return l}function H(D,j){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;j.sideOrientation=C.d._GetDefaultSideOrientation(j.sideOrientation);const M=j.shape,O=j.holes||[],E=j.depth||0,f=j.smoothingThreshold||2,F=[];let Z=[];for(let C=0;C<M.length;C++)F[C]=new Q.f(M[C].x,M[C].z);F[0].equalsWithEpsilon(F[F.length-1],1e-8)&&F.pop();const P=new a(D,F,W||I.b.LastCreatedScene,k);for(let C=0;C<O.length;C++){Z=[];for(let D=0;D<O[C].length;D++)Z.push(new Q.f(O[C][D].x,O[C][D].z));P.addHole(Z)}const X=P.build(!1,E,f);X._originalBuilderSideOrientation=j.sideOrientation;return S(X,j.sideOrientation,j.faceUV,j.faceColors,j.frontUVs,j.backUVs,j.wrap).Ca(X,j.updatable),X}function z(D,j){return H(D,j,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut)}function i(D,j){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=j.path,k=j.shape,M=j.scale||1,O=j.rotation||0,E=0===j.cap?0:j.cap||C.d.NO_CAP,f=j.updatable,F=C.d._GetDefaultSideOrientation(j.sideOrientation),Z=j.instance||null,P=j.invertUV||!1,X=j.closeShape||!1;return T(D,k,Q,M,O,null,null,j.closePath||!1,X,E,!1,W,!!f,F,Z,P,j.frontUVs||null,j.backUVs||null,j.firstNormal||null,!!j.adjustFrame)}function p(D,j){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=j.path,k=j.shape,M=j.scaleFunction||(()=>1),O=j.rotationFunction||(()=>0),E=j.closePath||j.ribbonCloseArray||!1,f=j.closeShape||j.ribbonClosePath||!1,F=0===j.cap?0:j.cap||C.d.NO_CAP,Z=j.updatable,P=j.firstNormal||null,X=j.adjustFrame||!1;return T(D,k,Q,null,null,M,O,E,f,F,!0,W,!!Z,C.d._GetDefaultSideOrientation(j.sideOrientation),j.instance||null,j.invertUV||!1,j.frontUVs||null,j.backUVs||null,P,X)}function T(D,j,W,k,M,O,E,F,Z,P,X,x,R,V,U,g,N,G,K,L){const e=(D,j,W,k,M,O,E,f,F,Z,P)=>{const X=W.getTangents(),x=W.getNormals(),R=W.getBinormals(),V=W.getDistances();if(P)for(let C=0;C<X.length;C++)if(0==X[C].x&&0==X[C].y&&0==X[C].z&&X[C].p(X[C-1]),0==x[C].x&&0==x[C].y&&0==x[C].z&&x[C].p(x[C-1]),0==R[C].x&&0==R[C].y&&0==R[C].z&&R[C].p(R[C-1]),C>0){let D=X[C-1];Q.j.Dot(D,X[C])<0&&X[C].scaleInPlace(-1),D=x[C-1],Q.j.Dot(D,x[C])<0&&x[C].scaleInPlace(-1),D=R[C-1],Q.j.Dot(D,R[C])<0&&R[C].scaleInPlace(-1)}let U=0;const g=Z&&f?f:()=>null!==O?O:0,N=Z&&E?E:()=>null!==M?M:1;let G=F===C.d.NO_CAP||F===C.d.CAP_END?0:2;const K=Q.e.Matrix[0];for(let C=0;C<j.length;C++){const W=[],M=g(C,V[C]),O=N(C,V[C]);Q.b.RotationAxisToRef(X[C],U,K);for(let k=0;k<D.length;k++){const M=X[C].scale(D[k].z).add(x[C].scale(D[k].x)).add(R[C].scale(D[k].y)),E=Q.j.Zero();Q.j.TransformCoordinatesToRef(M,K,E),E.scaleInPlace(O).addInPlace(j[C]),W[k]=E}k[G]=W,U+=M,G++}const L=D=>{const j=Array(),W=Q.j.Zero();let C;for(C=0;C<D.length;C++)W.addInPlace(D[C]);for(W.scaleInPlace(1/D.length),C=0;C<D.length;C++)j.push(W);return j};switch(F){case C.d.NO_CAP:break;case C.d.CAP_START:k[0]=L(k[2]),k[1]=k[2];break;case C.d.CAP_END:k[G]=k[G-1],k[G+1]=L(k[G-1]);break;case C.d.CAP_ALL:k[0]=L(k[2]),k[1]=k[2],k[G]=k[G-1],k[G+1]=L(k[G-1])}return k};let s,b;if(U){const D=U._creationDataStorage;return s=K?D.path3D.update(W,K):D.path3D.update(W),b=e(j,W,D.path3D,D.pathArray,k,M,O,E,D.cap,X,L),U=f("",{pathArray:b,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:U},x||void 0)}s=K?new c.g(W,K):new c.g(W);b=e(j,W,s,new Array,k,M,O,E,P=P<0||P>3?0:P,X,L);const Y=f(D,{pathArray:b,closeArray:F,closePath:Z,updatable:R,sideOrientation:V,invertUV:g,frontUVs:N||void 0,backUVs:G||void 0},x);return Y._creationDataStorage.pathArray=b,Y._creationDataStorage.path3D=s,Y._creationDataStorage.cap=P,Y}M.b.CreatePolygon=S,C.d.CreatePolygon=function(D,j,W,Q,C,k){return H(D,{shape:j,holes:Q,updatable:C,sideOrientation:k},W,arguments.length>6&&void 0!==arguments[6]?arguments[6]:earcut)},C.d.ExtrudePolygon=function(D,j,W,Q,C,k,M){return z(D,{shape:j,holes:C,depth:W,updatable:k,sideOrientation:M},Q,arguments.length>7&&void 0!==arguments[7]?arguments[7]:earcut)};function A(D,j){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const k=j.arc?j.arc<=0||j.arc>1?1:j.arc:1,M=void 0===j.closed||j.closed,O=j.shape,E=j.i||1,F=j.dl||64,Z=j.clip||0,P=j.updatable,X=C.d._GetDefaultSideOrientation(j.sideOrientation),x=j.cap||C.d.NO_CAP,R=2*Math.PI,V=[],U=j.invertUV||!1;let g=0,N=0;const G=R/F*k;let K,L;for(g=0;g<=F-Z;g++){for(L=[],x!=C.d.CAP_START&&x!=C.d.CAP_ALL||(L.push(new Q.j(0,O[0].y,0)),L.push(new Q.j(Math.cos(g*G)*O[0].x*E,O[0].y,Math.sin(g*G)*O[0].x*E))),N=0;N<O.length;N++)K=new Q.j(Math.cos(g*G)*O[N].x*E,O[N].y,Math.sin(g*G)*O[N].x*E),L.push(K);x!=C.d.CAP_END&&x!=C.d.CAP_ALL||(L.push(new Q.j(Math.cos(g*G)*O[O.length-1].x*E,O[O.length-1].y,Math.sin(g*G)*O[O.length-1].x*E)),L.push(new Q.j(0,O[O.length-1].y,0))),V.push(L)}return f(D,{pathArray:V,closeArray:M,sideOrientation:X,updatable:P,invertUV:U,frontUVs:j.frontUVs,backUVs:j.backUVs},W)}C.d.ExtrudeShape=function(D,j,W,Q,k,M){let O=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,E=arguments.length>7?arguments[7]:void 0,f=arguments.length>8?arguments[8]:void 0,F=arguments.length>9?arguments[9]:void 0;return i(D,{shape:j,path:W,scale:Q,rotation:k,cap:0===M?0:M||C.d.NO_CAP,sideOrientation:f,instance:F,updatable:E},O)},C.d.ExtrudeShapeCustom=(D,j,W,Q,k,M,O,E,f,F,Z,P)=>p(D,{shape:j,path:W,scaleFunction:Q,rotationFunction:k,ribbonCloseArray:M,ribbonClosePath:O,cap:0===E?0:E||C.d.NO_CAP,sideOrientation:Z,instance:P,updatable:F},f);C.d.CreateLathe=(D,j,W,Q,C,k,M)=>A(D,{shape:j,i:W,dl:Q,sideOrientation:M,updatable:k},C);var w=W(12107),n=W(12055);function u(D,j){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const k=j.path;let M=j.instance,O=1;void 0!==j.i?O=j.i:M&&(O=M._creationDataStorage.i);const E=j.dl||64,F=j.radiusFunction||null;let Z=j.cap||C.d.NO_CAP;const P=j.invertUV||!1,X=j.updatable,x=C.d._GetDefaultSideOrientation(j.sideOrientation);j.arc=j.arc&&(j.arc<=0||j.arc>1)?1:j.arc||1;const R=(D,j,W,k,M,O,E,f)=>{const F=j.getTangents(),Z=j.getNormals(),P=j.getDistances(),X=2*Math.PI/M*f,x=O||(()=>k);let R,V,U,g;const N=Q.e.Matrix[0];let G=E===C.d.NO_CAP||E===C.d.CAP_END?0:2;for(let C=0;C<D.length;C++){V=x(C,P[C]),R=Array(),U=Z[C];for(let j=0;j<M;j++)Q.b.RotationAxisToRef(F[C],X*j,N),g=R[j]?R[j]:Q.j.Zero(),Q.j.TransformCoordinatesToRef(U,N,g),g.scaleInPlace(V).addInPlace(D[C]),R[j]=g;W[G]=R,G++}const K=(j,W)=>{const Q=Array();for(let C=0;C<j;C++)Q.push(D[W]);return Q};switch(E){case C.d.NO_CAP:break;case C.d.CAP_START:W[0]=K(M,0),W[1]=W[2].slice(0);break;case C.d.CAP_END:W[G]=W[G-1].slice(0),W[G+1]=K(M,D.length-1);break;case C.d.CAP_ALL:W[0]=K(M,0),W[1]=W[2].slice(0),W[G]=W[G-1].slice(0),W[G+1]=K(M,D.length-1)}return W};let V,U;if(M){const D=M._creationDataStorage,W=j.arc||D.arc;return V=D.path3D.update(k),U=R(k,V,D.pathArray,O,D.dl,F,D.cap,W),M=f("",{pathArray:U,instance:M}),D.path3D=V,D.pathArray=U,D.arc=W,D.i=O,M}V=new c.g(k);Z=Z<0||Z>3?0:Z,U=R(k,V,new Array,O,E,F,Z,j.arc);const g=f(D,{pathArray:U,closePath:!0,closeArray:!1,updatable:X,sideOrientation:x,invertUV:P,frontUVs:j.frontUVs,backUVs:j.backUVs},W);return g._creationDataStorage.pathArray=U,g._creationDataStorage.path3D=V,g._creationDataStorage.dl=E,g._creationDataStorage.cap=Z,g._creationDataStorage.arc=j.arc,g._creationDataStorage.i=O,g}function q(D){const j=[];j[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},j[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},j[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},j[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},j[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},j[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},j[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},j[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},j[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},j[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},j[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},j[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},j[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},j[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},j[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const W=D.type&&(D.type<0||D.type>=j.length)?0:D.type||0,C=D.size,k=D.sizeX||C||1,E=D.sizeY||C||1,f=D.sizeZ||C||1,F=D.custom||j[W],Z=F.face.length,X=D.faceUV||new Array(Z),x=D.faceColors,R=void 0===D.flat||D.flat,V=0===D.sideOrientation?0:D.sideOrientation||M.b.DEFAULTSIDE,U=[],g=[],N=[],G=[],K=[];let L=0,e=0;const s=[];let b,Y,t,c,l,I,y=0,m=0;if(R)for(m=0;m<Z;m++)x&&void 0===x[m]&&(x[m]=new P.h(1,1,1,1)),X&&void 0===X[m]&&(X[m]=new Q.m(0,0,1,1));if(R)for(m=0;m<Z;m++){const D=F.face[m].length;for(t=2*Math.PI/D,c=.5*Math.tan(t/2),l=.5,y=0;y<D;y++)U.push(F.vertex[F.face[m][y]][0]*k,F.vertex[F.face[m][y]][1]*E,F.vertex[F.face[m][y]][2]*f),s.push(L),L++,b=X[m].x+(X[m].z-X[m].x)*(.5+c),Y=X[m].y+(X[m].w-X[m].y)*(l-.5),G.push(b,O.b?1-Y:Y),I=c*Math.cos(t)-l*Math.sin(t),l=c*Math.sin(t)+l*Math.cos(t),c=I,x&&K.push(x[m].r,x[m].g,x[m].b,x[m].a);for(y=0;y<D-2;y++)g.push(s[0+e],s[y+2+e],s[y+1+e]);e+=D}else{for(y=0;y<F.vertex.length;y++)U.push(F.vertex[y][0]*k,F.vertex[y][1]*E,F.vertex[y][2]*f),G.push(0,O.b?1:0);for(m=0;m<Z;m++)for(y=0;y<F.face[m].length-2;y++)g.push(F.face[m][0],F.face[m][y+2],F.face[m][y+1])}M.b.ComputeNormals(U,g,N),M.b._ComputeSides(V,U,g,N,G,D.frontUVs,D.backUVs);const a=new M.b;return a.xa=U,a.indices=g,a.ya=N,a.Aa=G,x&&R&&(a.za=K),a}function o(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=new C.d(D,W);j.sideOrientation=C.d._GetDefaultSideOrientation(j.sideOrientation),Q._originalBuilderSideOrientation=j.sideOrientation;return q(j).Ca(Q,j.updatable),Q}C.d.CreateTube=(D,j,W,Q,C,k,M,O,E,f)=>u(D,{path:j,i:W,dl:Q,radiusFunction:C,arc:1,cap:k,updatable:O,sideOrientation:E,instance:f},M);function J(D){const j=D.sideOrientation||M.b.DEFAULTSIDE,W=D.i||1,C=void 0===D.flat||D.flat,k=0|(D.subdivisions||4),E=D.radiusX||W,f=D.radiusY||W,F=D.radiusZ||W,Z=(1+Math.sqrt(5))/2,P=[-1,Z,-0,1,Z,0,-1,-Z,0,1,-Z,0,0,-1,-Z,0,1,-Z,0,-1,Z,0,1,Z,Z,0,1,Z,0,-1,-Z,0,1,-Z,0,-1],X=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],x=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],R=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],V=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],U=[],g=[],N=[],G=[];let K=0;const L=new Array(3),e=new Array(3);let s;for(s=0;s<3;s++)L[s]=Q.j.Zero(),e[s]=Q.f.Zero();for(let M=0;M<20;M++){for(s=0;s<3;s++){const D=X[3*M+s];L[s].Id(P[3*x[D]],P[3*x[D]+1],P[3*x[D]+2]),L[s].normalize(),e[s].Id(.134765625*R[2*D]+.05859375+-.0390625*V[M],.2333984375*R[2*D+1]+.025390625+.01953125*V[M])}const D=(D,j,W,M)=>{const Z=Q.j.Lerp(L[0],L[2],j/k),P=Q.j.Lerp(L[1],L[2],j/k),X=k===j?L[2]:Q.j.Lerp(Z,P,D/(k-j));let x;if(X.normalize(),C){const D=Q.j.Lerp(L[0],L[2],M/k),j=Q.j.Lerp(L[1],L[2],M/k);x=Q.j.Lerp(D,j,W/(k-M))}else x=new Q.j(X.x,X.y,X.z);x.x/=E,x.y/=f,x.z/=F,x.normalize();const R=Q.f.Lerp(e[0],e[2],j/k),V=Q.f.Lerp(e[1],e[2],j/k),s=k===j?e[2]:Q.f.Lerp(R,V,D/(k-j));g.push(X.x*E,X.y*f,X.z*F),N.push(x.x,x.y,x.z),G.push(s.x,O.b?1-s.y:s.y),U.push(K),K++};for(let j=0;j<k;j++)for(let W=0;W+j<k;W++)D(W,j,W+1/3,j+1/3),D(W+1,j,W+1/3,j+1/3),D(W,j+1,W+1/3,j+1/3),W+j+1<k&&(D(W+1,j,W+2/3,j+2/3),D(W+1,j+1,W+2/3,j+2/3),D(W,j+1,W+2/3,j+2/3))}M.b._ComputeSides(j,g,U,N,G,D.frontUVs,D.backUVs);const b=new M.b;return b.indices=U,b.xa=g,b.ya=N,b.Aa=G,b}function h(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=new C.d(D,W);j.sideOrientation=C.d._GetDefaultSideOrientation(j.sideOrientation),Q._originalBuilderSideOrientation=j.sideOrientation;return J(j).Ca(Q,j.updatable),Q}M.b.CreatePolyhedron=q,C.d.CreatePolyhedron=(D,j,W)=>o(D,j,W);M.b.CreateIcoSphere=J,C.d.CreateIcoSphere=(D,j,W)=>h(D,j,W);var d=W(1e3);const v=new Q.j(1,0,0),B=new Q.j(-1,0,0),r=new Q.j(0,1,0),DD=new Q.j(0,-1,0),jD=new Q.j(0,0,1),WD=new Q.j(0,0,-1);class QD{constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Q.j.Zero(),j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Q.j.Up(),W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Q.f.Zero(),C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,M=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,O=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,E=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,f=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=D,this.Md=j,this.uv=W,this.vertexIdx=C,this.vertexIdxForBones=k,this.localPositionOverride=M,this.localNormalOverride=O,this.matrixIndicesOverride=E,this.matrixWeightsOverride=f}clone(){var D,j,W,Q;return new QD(this.position.clone(),this.Md.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(D=this.localPositionOverride)||void 0===D?void 0:D.slice(),null===(j=this.localNormalOverride)||void 0===j?void 0:j.slice(),null===(W=this.matrixIndicesOverride)||void 0===W?void 0:W.slice(),null===(Q=this.matrixWeightsOverride)||void 0===Q?void 0:Q.slice())}}function CD(D,j,W){var E,f,F,Z;const P=!!j.skeleton,X=W.localMode||P,x=j.Me(),R=P?j.Vf(!0,!0):j.getVerticesData(k.f.PositionKind),V=P?j.getNormalsData(!0,!0):j.getVerticesData(k.f.NormalKind),U=X?P?j.getVerticesData(k.f.PositionKind):R:null,g=X?P?j.getVerticesData(k.f.NormalKind):V:null,N=j.getVerticesData(k.f.UVKind),G=P?j.getVerticesData(k.f.MatricesIndicesKind):null,K=P?j.getVerticesData(k.f.MatricesWeightsKind):null,L=P?j.getVerticesData(k.f.MatricesIndicesExtraKind):null,e=P?j.getVerticesData(k.f.MatricesWeightsExtraKind):null,s=W.position||Q.j.Zero();let b=W.Md||Q.j.Up();const Y=W.size||Q.j.One(),t=W.angle||0;if(!b){const D=new Q.j(0,0,1),W=j.va().activeCamera,C=Q.j.TransformCoordinates(D,W.getWorldMatrix());b=W.globalPosition.Qc(C)}const c=-Math.atan2(b.z,b.x)-Math.PI/2,l=Math.sqrt(b.x*b.x+b.z*b.z),I=Math.atan2(b.y,l),y=new M.b;y.indices=[],y.xa=[],y.ya=[],y.Aa=[],y.matricesIndices=P?[]:null,y.matricesWeights=P?[]:null,y.matricesIndicesExtra=L?[]:null,y.matricesWeightsExtra=e?[]:null;let m=0;const a=(D,j)=>{const C=new QD;if(!x||!R||!V)return C;const k=x[D];if(C.vertexIdx=3*k,C.vertexIdxForBones=4*k,C.position=new Q.j(R[3*k],R[3*k+1],R[3*k+2]),Q.j.TransformCoordinatesToRef(C.position,j,C.position),C.Md=new Q.j(V[3*k],V[3*k+1],V[3*k+2]),Q.j.TransformNormalToRef(C.Md,j,C.Md),W.captureUVS&&N){const D=N[2*k+1];C.uv=new Q.f(N[2*k],O.b?1-D:D)}return C},S=[0,0,0,0],H=(D,j)=>{if(0===D.length)return D;const W=.5*Math.abs(Q.j.Dot(Y,j)),C=(D,j,W,Q)=>{for(let C=0;C<Q;++C)if(D[W+C]===j)return W+C;return-1},k=(D,k)=>{const M=Q.j.GetClipFactor(D.position,k.position,j,W);let O=S,E=S;if(G&&K){const j=D.matrixIndicesOverride?0:D.vertexIdxForBones,W=D.matrixIndicesOverride??G,Q=D.matrixWeightsOverride??K,f=k.matrixIndicesOverride?0:k.vertexIdxForBones,F=k.matrixIndicesOverride??G,Z=k.matrixWeightsOverride??K;O=[0,0,0,0],E=[0,0,0,0];let P=0;for(let D=0;D<4;++D)if(Q[j+D]>0){const k=C(F,W[j+D],f,4);O[P]=W[j+D],E[P]=(0,d.o)(Q[j+D],k>=0?Z[k]:0,M),P++}for(let D=0;D<4&&P<4;++D){const Q=F[f+D];-1===C(W,Q,j,4)&&(O[P]=Q,E[P]=(0,d.o)(0,Z[f+D],M),P++)}const X=E[0]+E[1]+E[2]+E[3];E[0]/=X,E[1]/=X,E[2]/=X,E[3]/=X}const f=D.localPositionOverride?D.localPositionOverride[0]:(null===U||void 0===U?void 0:U[D.vertexIdx])??0,F=D.localPositionOverride?D.localPositionOverride[1]:(null===U||void 0===U?void 0:U[D.vertexIdx+1])??0,Z=D.localPositionOverride?D.localPositionOverride[2]:(null===U||void 0===U?void 0:U[D.vertexIdx+2])??0,P=k.localPositionOverride?k.localPositionOverride[0]:(null===U||void 0===U?void 0:U[k.vertexIdx])??0,X=k.localPositionOverride?k.localPositionOverride[1]:(null===U||void 0===U?void 0:U[k.vertexIdx+1])??0,x=k.localPositionOverride?k.localPositionOverride[2]:(null===U||void 0===U?void 0:U[k.vertexIdx+2])??0,R=D.localNormalOverride?D.localNormalOverride[0]:(null===g||void 0===g?void 0:g[D.vertexIdx])??0,V=D.localNormalOverride?D.localNormalOverride[1]:(null===g||void 0===g?void 0:g[D.vertexIdx+1])??0,N=D.localNormalOverride?D.localNormalOverride[2]:(null===g||void 0===g?void 0:g[D.vertexIdx+2])??0,L=R+((k.localNormalOverride?k.localNormalOverride[0]:(null===g||void 0===g?void 0:g[k.vertexIdx])??0)-R)*M,e=V+((k.localNormalOverride?k.localNormalOverride[1]:(null===g||void 0===g?void 0:g[k.vertexIdx+1])??0)-V)*M,s=N+((k.localNormalOverride?k.localNormalOverride[2]:(null===g||void 0===g?void 0:g[k.vertexIdx+2])??0)-N)*M,b=Math.sqrt(L*L+e*e+s*s);return new QD(Q.j.Lerp(D.position,k.position,M),Q.j.Lerp(D.Md,k.Md,M).normalize(),Q.f.Lerp(D.uv,k.uv,M),-1,-1,U?[f+(P-f)*M,F+(X-F)*M,Z+(x-Z)*M]:null,g?[L/b,e/b,s/b]:null,O,E)};let M=null;D.length>3&&(M=[]);for(let O=0;O<D.length;O+=3){let C=0,E=null,f=null,F=null,Z=null;const P=Q.j.Dot(D[O].position,j)-W>0,X=Q.j.Dot(D[O+1].position,j)-W>0,x=Q.j.Dot(D[O+2].position,j)-W>0;switch(C=(P?1:0)+(X?1:0)+(x?1:0),C){case 0:D.length>3?(M.push(D[O]),M.push(D[O+1]),M.push(D[O+2])):M=D;break;case 1:if(M=M??new Array,P&&(E=D[O+1],f=D[O+2],F=k(D[O],E),Z=k(D[O],f)),X){E=D[O],f=D[O+2],F=k(D[O+1],E),Z=k(D[O+1],f),M.push(F),M.push(f.clone()),M.push(E.clone()),M.push(f.clone()),M.push(F.clone()),M.push(Z);break}x&&(E=D[O],f=D[O+1],F=k(D[O+2],E),Z=k(D[O+2],f)),E&&f&&F&&Z&&(M.push(E.clone()),M.push(f.clone()),M.push(F),M.push(Z),M.push(F.clone()),M.push(f.clone()));break;case 2:M=M??new Array,P||(E=D[O].clone(),f=k(E,D[O+1]),F=k(E,D[O+2]),M.push(E),M.push(f),M.push(F)),X||(E=D[O+1].clone(),f=k(E,D[O+2]),F=k(E,D[O]),M.push(E),M.push(f),M.push(F)),x||(E=D[O+2].clone(),f=k(E,D[O]),F=k(E,D[O+1]),M.push(E),M.push(f),M.push(F))}}return M},z=j instanceof C.d?j:null,i=null===z||void 0===z?void 0:z._thinInstanceDataStorage.matrixData,p=(null===z||void 0===z?void 0:z.Zj)||1,T=Q.e.Matrix[0];T.p(Q.b.IdentityReadOnly);for(let C=0;C<p;++C){if(null!==z&&void 0!==z&&z.hasThinInstances&&i){const D=16*C;T.setRowFromFloats(0,i[D+0],i[D+1],i[D+2],i[D+3]),T.setRowFromFloats(1,i[D+4],i[D+5],i[D+6],i[D+7]),T.setRowFromFloats(2,i[D+8],i[D+9],i[D+10],i[D+11]),T.setRowFromFloats(3,i[D+12],i[D+13],i[D+14],i[D+15])}const D=Q.b.RotationYawPitchRoll(c,I,t).multiply(Q.b.Translation(s.x,s.y,s.z)),k=Q.b.Invert(D),M=j.getWorldMatrix(),E=T.multiply(M).multiply(k),f=new Array(3);for(let j=0;j<x.length;j+=3){let D=f;if(D[0]=a(j,E),D[1]=a(j+1,E),D[2]=a(j+2,E),!(W.cullBackFaces&&-D[0].Md.z<=0&&-D[1].Md.z<=0&&-D[2].Md.z<=0)&&(D=H(D,v),D&&(D=H(D,B),D&&(D=H(D,r),D&&(D=H(D,DD),D&&(D=H(D,jD),D&&(D=H(D,WD),D)))))))for(let j=0;j<D.length;j++){const Q=D[j];if(y.indices.push(m),X?(Q.localPositionOverride?(y.xa[3*m]=Q.localPositionOverride[0],y.xa[3*m+1]=Q.localPositionOverride[1],y.xa[3*m+2]=Q.localPositionOverride[2]):U&&(y.xa[3*m]=U[Q.vertexIdx],y.xa[3*m+1]=U[Q.vertexIdx+1],y.xa[3*m+2]=U[Q.vertexIdx+2]),Q.localNormalOverride?(y.ya[3*m]=Q.localNormalOverride[0],y.ya[3*m+1]=Q.localNormalOverride[1],y.ya[3*m+2]=Q.localNormalOverride[2]):g&&(y.ya[3*m]=g[Q.vertexIdx],y.ya[3*m+1]=g[Q.vertexIdx+1],y.ya[3*m+2]=g[Q.vertexIdx+2])):(Q.position.toArray(y.xa,3*m),Q.Md.toArray(y.ya,3*m)),y.matricesIndices&&y.matricesWeights&&(Q.matrixIndicesOverride?(y.matricesIndices[4*m]=Q.matrixIndicesOverride[0],y.matricesIndices[4*m+1]=Q.matrixIndicesOverride[1],y.matricesIndices[4*m+2]=Q.matrixIndicesOverride[2],y.matricesIndices[4*m+3]=Q.matrixIndicesOverride[3]):(G&&(y.matricesIndices[4*m]=G[Q.vertexIdxForBones],y.matricesIndices[4*m+1]=G[Q.vertexIdxForBones+1],y.matricesIndices[4*m+2]=G[Q.vertexIdxForBones+2],y.matricesIndices[4*m+3]=G[Q.vertexIdxForBones+3]),L&&y.matricesIndicesExtra&&(y.matricesIndicesExtra[4*m]=L[Q.vertexIdxForBones],y.matricesIndicesExtra[4*m+1]=L[Q.vertexIdxForBones+1],y.matricesIndicesExtra[4*m+2]=L[Q.vertexIdxForBones+2],y.matricesIndicesExtra[4*m+3]=L[Q.vertexIdxForBones+3])),Q.matrixWeightsOverride?(y.matricesWeights[4*m]=Q.matrixWeightsOverride[0],y.matricesWeights[4*m+1]=Q.matrixWeightsOverride[1],y.matricesWeights[4*m+2]=Q.matrixWeightsOverride[2],y.matricesWeights[4*m+3]=Q.matrixWeightsOverride[3]):(K&&(y.matricesWeights[4*m]=K[Q.vertexIdxForBones],y.matricesWeights[4*m+1]=K[Q.vertexIdxForBones+1],y.matricesWeights[4*m+2]=K[Q.vertexIdxForBones+2],y.matricesWeights[4*m+3]=K[Q.vertexIdxForBones+3]),e&&y.matricesWeightsExtra&&(y.matricesWeightsExtra[4*m]=e[Q.vertexIdxForBones],y.matricesWeightsExtra[4*m+1]=e[Q.vertexIdxForBones+1],y.matricesWeightsExtra[4*m+2]=e[Q.vertexIdxForBones+2],y.matricesWeightsExtra[4*m+3]=e[Q.vertexIdxForBones+3]))),W.captureUVS)Q.uv.toArray(y.Aa,2*m);else{y.Aa.push(.5+Q.position.x/Y.x);const D=.5+Q.position.y/Y.y;y.Aa.push(O.b?1-D:D)}m++}}}0===y.indices.length&&(y.indices=null),0===y.xa.length&&(y.xa=null),0===y.ya.length&&(y.ya=null),0===y.Aa.length&&(y.Aa=null),0===(null===(E=y.matricesIndices)||void 0===E?void 0:E.length)&&(y.matricesIndices=null),0===(null===(f=y.matricesWeights)||void 0===f?void 0:f.length)&&(y.matricesWeights=null),0===(null===(F=y.matricesIndicesExtra)||void 0===F?void 0:F.length)&&(y.matricesIndicesExtra=null),0===(null===(Z=y.matricesWeightsExtra)||void 0===Z?void 0:Z.length)&&(y.matricesWeightsExtra=null);const A=new C.d(D,j.va());return y.Ca(A),X?(A.skeleton=j.skeleton,A.parent=j):(A.position=s.clone(),A.rotation=new Q.j(I,c,t)),A.Ge(!0),A.refreshBoundingInfo(!0,!0),A}function kD(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,dl:16,height:1,i:.25,capSubdivisions:6};const j=0|Math.max(D.subdivisions?D.subdivisions:2,1),W=0|Math.max(D.dl?D.dl:16,3),C=Math.max(D.height?D.height:1,0),k=Math.max(D.i?D.i:.25,0),E=0|Math.max(D.capSubdivisions?D.capSubdivisions:6,1),f=W,F=j,Z=Math.max(D.radiusTop?D.radiusTop:k,0),P=Math.max(D.radiusBottom?D.radiusBottom:k,0),X=C-(Z+P),x=2*Math.PI,R=Math.max(D.topCapSubdivisions?D.topCapSubdivisions:E,1),V=Math.max(D.bottomCapSubdivisions?D.bottomCapSubdivisions:E,1),U=Math.acos((P-Z)/C);let g=[];const N=[],G=[],K=[];let L=0;const e=[],s=.5*X,b=.5*Math.PI;let Y,t;const c=Q.j.Zero(),l=Q.j.Zero(),I=Math.cos(U),y=Math.sin(U),m=new Q.f(Z*y,s+Z*I).Qc(new Q.f(P*y,P*I-s)).length(),a=Z*U+m+P*(b-U);let S=0;for(t=0;t<=R;t++){const D=[],j=b-U*(t/R);S+=Z*U/R;const W=Math.cos(j),Q=Math.sin(j),C=W*Z;for(Y=0;Y<=f;Y++){const j=Y/f,k=j*x+0,M=Math.sin(k),E=Math.cos(k);l.x=C*M,l.y=s+Q*Z,l.z=C*E,N.push(l.x,l.y,l.z),c.set(W*M,Q,W*E),G.push(c.x,c.y,c.z),K.push(j,O.b?S/a:1-S/a),D.push(L),L++}e.push(D)}const H=C-Z-P+I*Z-I*P,z=y*(P-Z)/H;for(t=1;t<=F;t++){const D=[];S+=m/F;const j=y*(t*(P-Z)/F+Z);for(Y=0;Y<=f;Y++){const W=Y/f,Q=W*x+0,C=Math.sin(Q),k=Math.cos(Q);l.x=j*C,l.y=s+I*Z-t*H/F,l.z=j*k,N.push(l.x,l.y,l.z),c.set(C,z,k).normalize(),G.push(c.x,c.y,c.z),K.push(W,O.b?S/a:1-S/a),D.push(L),L++}e.push(D)}for(t=1;t<=V;t++){const D=[],j=b-U-(Math.PI-U)*(t/V);S+=P*U/V;const W=Math.cos(j),Q=Math.sin(j),C=W*P;for(Y=0;Y<=f;Y++){const j=Y/f,k=j*x+0,M=Math.sin(k),E=Math.cos(k);l.x=C*M,l.y=Q*P-s,l.z=C*E,N.push(l.x,l.y,l.z),c.set(W*M,Q,W*E),G.push(c.x,c.y,c.z),K.push(j,O.b?S/a:1-S/a),D.push(L),L++}e.push(D)}for(Y=0;Y<f;Y++)for(t=0;t<R+F+V;t++){const D=e[t][Y],j=e[t+1][Y],W=e[t+1][Y+1],Q=e[t][Y+1];g.push(D),g.push(j),g.push(Q),g.push(j),g.push(W),g.push(Q)}if(g=g.reverse(),D.orientation&&!D.orientation.equals(Q.j.Up())){const j=new Q.b;D.orientation.clone().scale(.5*Math.PI).cross(Q.j.Up()).toQuaternion().toRotationMatrix(j);const W=Q.j.Zero();for(let D=0;D<N.length;D+=3)W.set(N[D],N[D+1],N[D+2]),Q.j.TransformCoordinatesToRef(W.clone(),j,W),N[D]=W.x,N[D+1]=W.y,N[D+2]=W.z}const i=new M.b;return i.xa=N,i.ya=G,i.Aa=K,i.indices=g,i}function MD(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:Q.j.Up(),subdivisions:2,dl:16,height:1,i:.25,capSubdivisions:6,updatable:!1},W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const k=new C.d(D,W);return kD(j).Ca(k,j.updatable),k}C.d.CreateDecal=(D,j,W,Q,C,k)=>CD(D,j,{position:W,Md:Q,size:C,angle:k});C.d.CreateCapsule=(D,j,W)=>MD(D,j,W),M.b.CreateCapsule=kD;class OD{constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=D,this.y=j,D!==Math.floor(D)&&(D=Math.floor(D),t.b.Warn("x is not an integer, floor(x) used")),j!==Math.floor(j)&&(j=Math.floor(j),t.b.Warn("y is not an integer, floor(y) used"))}clone(){return new OD(this.x,this.y)}rotate60About(D){const j=this.x;return this.x=D.x+D.y-this.y,this.y=j+this.y-D.x,this}rotateNeg60About(D){const j=this.x;return this.x=j+this.y-D.y,this.y=D.x+D.y-j,this}rotate120(D,j){D!==Math.floor(D)&&(D=Math.floor(D),t.b.Warn("m not an integer only floor(m) used")),j!==Math.floor(j)&&(j=Math.floor(j),t.b.Warn("n not an integer only floor(n) used"));const W=this.x;return this.x=D-W-this.y,this.y=j+W,this}rotateNeg120(D,j){D!==Math.floor(D)&&(D=Math.floor(D),t.b.Warn("m is not an integer, floor(m) used")),j!==Math.floor(j)&&(j=Math.floor(j),t.b.Warn("n is not an integer,   floor(n) used"));const W=this.x;return this.x=this.y-j,this.y=D+j-W-this.y,this}toCartesianOrigin(D,j){const W=Q.j.Zero();return W.x=D.x+2*this.x*j+this.y*j,W.y=D.y+Math.sqrt(3)*this.y*j,W}static Zero(){return new OD(0,0)}}class ED{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new fD("icosahedron","Regular",[[0,l.f,-1],[-l.f,1,0],[-1,0,-l.f],[1,0,-l.f],[l.f,1,0],[0,l.f,1],[-1,0,l.f],[-l.f,-1,0],[0,-l.f,-1],[l.f,-1,0],[1,0,l.f],[0,-l.f,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let D=12;const j={},W=this.m,Q=this.n;let C,k,M,O,E,f=W,F=1,Z=0;0!==Q&&(f=(0,d.j)(W,Q)),F=W/f,Z=Q/f;const P=OD.Zero(),X=new OD(W,Q),x=new OD(-Q,W+Q),R=OD.Zero(),V=OD.Zero(),U=OD.Zero();let g,N,G,K,L=[];const e=[],s=this.vertByDist,b=(W,Q,C,k)=>{g=W+"|"+C,N=Q+"|"+k,g in j||N in j?g in j&&!(N in j)?j[N]=j[g]:N in j&&!(g in j)&&(j[g]=j[N]):(j[g]=D,j[N]=D,D++),s[C][0]>2?e[j[g]]=[-s[C][0],s[C][1],j[g]]:e[j[g]]=[L[s[C][0]],s[C][1],j[g]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let Y=0;Y<20;Y++){if(L=this.IDATA.face[Y],M=L[2],O=L[1],E=L[0],G=P.x+"|"+P.y,g=Y+"|"+G,g in j||(j[g]=M,e[M]=[L[s[G][0]],s[G][1]]),G=X.x+"|"+X.y,g=Y+"|"+G,g in j||(j[g]=O,e[O]=[L[s[G][0]],s[G][1]]),G=x.x+"|"+x.y,g=Y+"|"+G,g in j||(j[g]=E,e[E]=[L[s[G][0]],s[G][1]]),C=this.IDATA.edgematch[Y][0],k=this.IDATA.edgematch[Y][1],"B"===k)for(let D=1;D<f;D++)V.x=W-D*(F+Z),V.y=Q+D*F,U.x=-D*Z,U.y=D*(F+Z),G=V.x+"|"+V.y,K=U.x+"|"+U.y,b(Y,C,G,K);if("O"===k)for(let D=1;D<f;D++)U.x=-D*Z,U.y=D*(F+Z),R.x=D*F,R.y=D*Z,G=U.x+"|"+U.y,K=R.x+"|"+R.y,b(Y,C,G,K);if(C=this.IDATA.edgematch[Y][2],k=this.IDATA.edgematch[Y][3],k&&"A"===k)for(let D=1;D<f;D++)R.x=D*F,R.y=D*Z,V.x=W-(f-D)*(F+Z),V.y=Q+(f-D)*F,G=R.x+"|"+R.y,K=V.x+"|"+V.y,b(Y,C,G,K);for(let W=0;W<this.vertices.length;W++)G=this.vertices[W].x+"|"+this.vertices[W].y,g=Y+"|"+G,g in j||(j[g]=D++,s[G][0]>2?e[j[g]]=[-s[G][0],s[G][1],j[g]]:e[j[g]]=[L[s[G][0]],s[G][1],j[g]])}this.closestTo=e,this.vecToidx=j}calcCoeffs(){const D=this.m,j=this.n,W=Math.sqrt(3)/3,Q=D*D+j*j+D*j;this.coau=(D+j)/Q,this.cobu=-j/Q,this.coav=-W*(D-j)/Q,this.cobv=W*(2*D+j)/Q}createInnerFacets(){const D=this.m,j=this.n;for(let W=0;W<j+D+1;W++)for(let D=this.min[W];D<this.max[W]+1;D++)D<this.max[W]&&D<this.max[W+1]+1&&this.innerFacets.push(["|"+D+"|"+W,"|"+D+"|"+(W+1),"|"+(D+1)+"|"+W]),W>0&&D<this.max[W-1]&&D+1<this.max[W]+1&&this.innerFacets.push(["|"+D+"|"+W,"|"+(D+1)+"|"+W,"|"+(D+1)+"|"+(W-1)])}edgeVecsABOB(){const D=this.m,j=this.n,W=new OD(-j,D+j);for(let Q=1;Q<D+j;Q++){const D=new OD(this.min[Q],Q),j=new OD(this.min[Q-1],Q-1),C=new OD(this.min[Q+1],Q+1),k=D.clone(),M=j.clone(),O=C.clone();k.rotate60About(W),M.rotate60About(W),O.rotate60About(W);const E=new OD(this.max[k.y],k.y),f=new OD(this.max[k.y-1],k.y-1),F=new OD(this.max[k.y-1]-1,k.y-1);k.x===E.x&&k.y===E.y||(k.x!==f.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([D,f,F]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([D,F,E])):k.y===O.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([D,j,f]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([D,f,C])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([D,j,f]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([D,f,E])))}}mapABOBtoOBOA(){const D=new OD(0,0);for(let j=0;j<this.isoVecsABOB.length;j++){const W=[];for(let Q=0;Q<3;Q++)D.x=this.isoVecsABOB[j][Q].x,D.y=this.isoVecsABOB[j][Q].y,0===this.vertexTypes[j][Q]&&D.rotateNeg120(this.m,this.n),W.push(D.clone());this.isoVecsOBOA.push(W)}}mapABOBtoBAOA(){const D=new OD(0,0);for(let j=0;j<this.isoVecsABOB.length;j++){const W=[];for(let Q=0;Q<3;Q++)D.x=this.isoVecsABOB[j][Q].x,D.y=this.isoVecsABOB[j][Q].y,1===this.vertexTypes[j][Q]&&D.rotate120(this.m,this.n),W.push(D.clone());this.isoVecsBAOA.push(W)}}MapToFace(D,j){const W=this.IDATA.face[D],C=W[2],k=W[1],M=W[0],O=Q.j.Dd(this.IDATA.vertex[C]),E=Q.j.Dd(this.IDATA.vertex[k]),f=Q.j.Dd(this.IDATA.vertex[M]),F=E.Qc(O),Z=f.Qc(O),P=F.scale(this.coau).add(Z.scale(this.cobu)),X=F.scale(this.coav).add(Z.scale(this.cobv)),x=[];let R,V=Q.e.Kd[0];for(let Q=0;Q<this.cartesian.length;Q++)V=P.scale(this.cartesian[Q].x).add(X.scale(this.cartesian[Q].y)).add(O),x[Q]=[V.x,V.y,V.z],R=D+"|"+this.vertices[Q].x+"|"+this.vertices[Q].y,j.vertex[this.vecToidx[R]]=[V.x,V.y,V.z]}build(D,j){const W=[],Q=OD.Zero(),C=new OD(D,j),k=new OD(-j,D+j);W.push(Q,C,k);for(let G=j;G<D+1;G++)for(let j=0;j<D+1-G;j++)W.push(new OD(j,G));if(j>0){const Q=(0,d.j)(D,j),C=D/Q,k=j/Q;for(let O=1;O<Q;O++)W.push(new OD(O*C,O*k)),W.push(new OD(-O*k,O*(C+k))),W.push(new OD(D-O*(C+k),j+O*C));const M=D/j;for(let O=1;O<j;O++)for(let Q=0;Q<O*M;Q++)W.push(new OD(Q,O)),W.push(new OD(Q,O).rotate120(D,j)),W.push(new OD(Q,O).rotateNeg120(D,j))}W.sort(((D,j)=>D.x-j.x)),W.sort(((D,j)=>D.y-j.y));const M=new Array(D+j+1),O=new Array(D+j+1);for(let G=0;G<M.length;G++)M[G]=1/0,O[G]=-1/0;let E=0,f=0;const F=W.length;for(let G=0;G<F;G++)f=W[G].x,E=W[G].y,M[E]=Math.min(f,M[E]),O[E]=Math.max(f,O[E]);const Z=(W,Q)=>{const C=W.clone();return"A"===Q&&C.rotateNeg120(D,j),"B"===Q&&C.rotate120(D,j),C.x<0?C.y:C.x+C.y},P=[],X=[],x=[],R=[],V={},U=[];let g=-1,N=-1;for(let G=0;G<F;G++)P[G]=W[G].toCartesianOrigin(new OD(0,0),.5),X[G]=Z(W[G],"O"),x[G]=Z(W[G],"A"),R[G]=Z(W[G],"B"),X[G]===x[G]&&x[G]===R[G]?(g=3,N=X[G]):X[G]===x[G]?(g=4,N=X[G]):x[G]===R[G]?(g=5,N=x[G]):R[G]===X[G]&&(g=6,N=X[G]),X[G]<x[G]&&X[G]<R[G]&&(g=2,N=X[G]),x[G]<X[G]&&x[G]<R[G]&&(g=1,N=x[G]),R[G]<x[G]&&R[G]<X[G]&&(g=0,N=R[G]),U.push([g,N,W[G].x,W[G].y]);U.sort(((D,j)=>D[2]-j[2])),U.sort(((D,j)=>D[3]-j[3])),U.sort(((D,j)=>D[1]-j[1])),U.sort(((D,j)=>D[0]-j[0]));for(let G=0;G<U.length;G++)V[U[G][2]+"|"+U[G][3]]=[U[G][0],U[G][1],G];return this.m=D,this.n=j,this.vertices=W,this.vertByDist=V,this.cartesian=P,this.min=M,this.max=O,this}}class fD{constructor(D,j,W,Q){this.name=D,this.category=j,this.vertex=W,this.face=Q}}class FD extends fD{innerToData(D,j){for(let W=0;W<j.innerFacets.length;W++)this.face.push(j.innerFacets[W].map((W=>j.vecToidx[D+W])))}mapABOBtoDATA(D,j){const W=j.IDATA.edgematch[D][0];for(let Q=0;Q<j.isoVecsABOB.length;Q++){const C=[];for(let k=0;k<3;k++)0===j.vertexTypes[Q][k]?C.push(D+"|"+j.isoVecsABOB[Q][k].x+"|"+j.isoVecsABOB[Q][k].y):C.push(W+"|"+j.isoVecsABOB[Q][k].x+"|"+j.isoVecsABOB[Q][k].y);this.face.push([j.vecToidx[C[0]],j.vecToidx[C[1]],j.vecToidx[C[2]]])}}mapOBOAtoDATA(D,j){const W=j.IDATA.edgematch[D][0];for(let Q=0;Q<j.isoVecsOBOA.length;Q++){const C=[];for(let k=0;k<3;k++)1===j.vertexTypes[Q][k]?C.push(D+"|"+j.isoVecsOBOA[Q][k].x+"|"+j.isoVecsOBOA[Q][k].y):C.push(W+"|"+j.isoVecsOBOA[Q][k].x+"|"+j.isoVecsOBOA[Q][k].y);this.face.push([j.vecToidx[C[0]],j.vecToidx[C[1]],j.vecToidx[C[2]]])}}mapBAOAtoDATA(D,j){const W=j.IDATA.edgematch[D][2];for(let Q=0;Q<j.isoVecsBAOA.length;Q++){const C=[];for(let k=0;k<3;k++)1===j.vertexTypes[Q][k]?C.push(D+"|"+j.isoVecsBAOA[Q][k].x+"|"+j.isoVecsBAOA[Q][k].y):C.push(W+"|"+j.isoVecsBAOA[Q][k].x+"|"+j.isoVecsBAOA[Q][k].y);this.face.push([j.vecToidx[C[0]],j.vecToidx[C[1]],j.vecToidx[C[2]]])}}orderData(D){const j=[];for(let k=0;k<13;k++)j[k]=[];const W=D.closestTo;for(let k=0;k<W.length;k++)W[k][0]>-1?W[k][1]>0&&j[W[k][0]].push([k,W[k][1]]):j[12].push([k,W[k][0]]);const Q=[];for(let k=0;k<12;k++)Q[k]=k;let C=12;for(let k=0;k<12;k++){j[k].sort(((D,j)=>D[1]-j[1]));for(let D=0;D<j[k].length;D++)Q[j[k][D][0]]=C++}for(let k=0;k<j[12].length;k++)Q[j[12][k][0]]=C++;for(let k=0;k<this.vertex.length;k++)this.vertex[k].push(Q[k]);this.vertex.sort(((D,j)=>D[3]-j[3]));for(let k=0;k<this.vertex.length;k++)this.vertex[k].pop();for(let k=0;k<this.face.length;k++)for(let D=0;D<this.face[k].length;D++)this.face[k][D]=Q[this.face[k][D]];this.sharedNodes=j[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(D,j){const W=[],Q=[];let C=j.pop();Q.push(C);let k=this.face[C].indexOf(D);k=(k+2)%3;let M=this.face[C][k];W.push(M);let O=0;for(;j.length>0;)C=j[O],this.face[C].indexOf(M)>-1?(k=(this.face[C].indexOf(M)+1)%3,M=this.face[C][k],W.push(M),Q.push(C),j.splice(O,1),O=0):O++;return this.adjacentFaces.push(W),Q}toGoldbergPolyhedronData(){const D=new fD("GeoDual","Goldberg",[],[]);D.name="GD dual";const j=this.vertex.length,W=new Array(j);for(let E=0;E<j;E++)W[E]=[];for(let E=0;E<this.face.length;E++)for(let D=0;D<3;D++)W[this.face[E][D]].push(E);let Q=0,C=0,k=0,M=[],O=[];this.adjacentFaces=[];for(let E=0;E<W.length;E++)D.face[E]=this.setOrder(E,W[E].concat([])),W[E].forEach((j=>{Q=0,C=0,k=0,M=this.face[j];for(let D=0;D<3;D++)O=this.vertex[M[D]],Q+=O[0],C+=O[1],k+=O[2];D.vertex[j]=[Q/3,C/3,k/3]}));return D}static BuildGeodesicData(D){const j=new FD("Geodesic-m-n","Geodesic",[[0,l.f,-1],[-l.f,1,0],[-1,0,-l.f],[1,0,-l.f],[l.f,1,0],[0,l.f,1],[-1,0,l.f],[-l.f,-1,0],[0,-l.f,-1],[l.f,-1,0],[1,0,l.f],[0,-l.f,1]],[]);D.setIndices(),D.calcCoeffs(),D.createInnerFacets(),D.edgeVecsABOB(),D.mapABOBtoOBOA(),D.mapABOBtoBAOA();for(let W=0;W<D.IDATA.face.length;W++)D.MapToFace(W,j),j.innerToData(W,D),"B"===D.IDATA.edgematch[W][1]&&j.mapABOBtoDATA(W,D),"O"===D.IDATA.edgematch[W][1]&&j.mapOBOAtoDATA(W,D),"A"===D.IDATA.edgematch[W][3]&&j.mapBAOAtoDATA(W,D);j.orderData(D);return j.vertex=j.vertex.map((function(D){const j=D[0],W=D[1],Q=D[2],C=Math.sqrt(j*j+W*W+Q*Q);return D[0]*=1/C,D[1]*=1/C,D[2]*=1/C,D})),j}}C.d._GoldbergMeshParser=(D,j)=>ZD.Parse(D,j);class ZD extends C.d{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(D,j){return void 0===j?(D>this.goldbergData.nbUnsharedFaces-1&&(t.b.Warn("Maximum number of unshared faces used"),D=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+D):(D>11&&(t.b.Warn("Last pole used"),D=11),j>this.goldbergData.nbFacesAtPole-1&&(t.b.Warn("Maximum number of faces at a pole used"),j=this.goldbergData.nbFacesAtPole-1),12+D*this.goldbergData.nbFacesAtPole+j)}_changeGoldbergFaceColors(D){for(let W=0;W<D.length;W++){const j=D[W][0],Q=D[W][1],C=D[W][2];for(let D=j;D<Q+1;D++)this.goldbergData.faceColors[D]=C}const j=[];for(let W=0;W<12;W++)for(let D=0;D<5;D++)j.push(this.goldbergData.faceColors[W].r,this.goldbergData.faceColors[W].g,this.goldbergData.faceColors[W].b,this.goldbergData.faceColors[W].a);for(let W=12;W<this.goldbergData.faceColors.length;W++)for(let D=0;D<6;D++)j.push(this.goldbergData.faceColors[W].r,this.goldbergData.faceColors[W].g,this.goldbergData.faceColors[W].b,this.goldbergData.faceColors[W].a);return j}setGoldbergFaceColors(D){const j=this._changeGoldbergFaceColors(D);this.Ga(k.f.ColorKind,j)}updateGoldbergFaceColors(D){const j=this._changeGoldbergFaceColors(D);this.updateVerticesData(k.f.ColorKind,j)}_changeGoldbergFaceUVs(D){const j=this.getVerticesData(k.f.UVKind);for(let W=0;W<D.length;W++){const Q=D[W][0],C=D[W][1],k=D[W][2],M=D[W][3],O=D[W][4],E=[],f=[];let F,Z;for(let D=0;D<5;D++)F=k.x+M*Math.cos(O+D*Math.PI/2.5),Z=k.y+M*Math.sin(O+D*Math.PI/2.5),F<0&&(F=0),F>1&&(F=1),E.push(F,Z);for(let D=0;D<6;D++)F=k.x+M*Math.cos(O+D*Math.PI/3),Z=k.y+M*Math.sin(O+D*Math.PI/3),F<0&&(F=0),F>1&&(F=1),f.push(F,Z);for(let D=Q;D<Math.min(12,C+1);D++)for(let W=0;W<5;W++)j[10*D+2*W]=E[2*W],j[10*D+2*W+1]=E[2*W+1];for(let D=Math.max(12,Q);D<C+1;D++)for(let W=0;W<6;W++)j[12*D-24+2*W]=f[2*W],j[12*D-23+2*W]=f[2*W+1]}return j}setGoldbergFaceUVs(D){const j=this._changeGoldbergFaceUVs(D);this.Ga(k.f.UVKind,j)}updateGoldbergFaceUVs(D){const j=this._changeGoldbergFaceUVs(D);this.updateVerticesData(k.f.UVKind,j)}placeOnGoldbergFaceAt(D,j,W){const C=Q.j.RotationFromAxis(this.goldbergData.faceXaxis[j],this.goldbergData.faceYaxis[j],this.goldbergData.faceZaxis[j]);D.rotation=C,D.position=this.goldbergData.faceCenters[j].add(this.goldbergData.faceXaxis[j].scale(W.x)).add(this.goldbergData.faceYaxis[j].scale(W.y)).add(this.goldbergData.faceZaxis[j].scale(W.z))}serialize(D){super.serialize(D),D.type="GoldbergMesh";const j={};if(j.adjacentFaces=this.goldbergData.adjacentFaces,j.nbSharedFaces=this.goldbergData.nbSharedFaces,j.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,j.nbFaces=this.goldbergData.nbFaces,j.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){j.faceColors=[];for(const D of this.goldbergData.faceColors)j.faceColors.push(D.Gd())}if(this.goldbergData.faceCenters){j.faceCenters=[];for(const D of this.goldbergData.faceCenters)j.faceCenters.push(D.Gd())}if(this.goldbergData.faceZaxis){j.faceZaxis=[];for(const D of this.goldbergData.faceZaxis)j.faceZaxis.push(D.Gd())}if(this.goldbergData.faceYaxis){j.faceYaxis=[];for(const D of this.goldbergData.faceYaxis)j.faceYaxis.push(D.Gd())}if(this.goldbergData.faceXaxis){j.faceXaxis=[];for(const D of this.goldbergData.faceXaxis)j.faceXaxis.push(D.Gd())}D.goldbergData=j}static Parse(D,j){const W=D.goldbergData;W.faceColors=W.faceColors.map((D=>P.h.Dd(D))),W.faceCenters=W.faceCenters.map((D=>Q.j.Dd(D))),W.faceZaxis=W.faceZaxis.map((D=>Q.j.Dd(D))),W.faceXaxis=W.faceXaxis.map((D=>Q.j.Dd(D))),W.faceYaxis=W.faceYaxis.map((D=>Q.j.Dd(D)));const C=new ZD(D.name,j);return C.goldbergData=W,C}}var PD=W(12037);class XD{constructor(D){this._paths=[],this._tempPaths=[],this._holes=[],this._resolution=D}moveTo(D,j){this._currentPath=new c.f(D,j),this._tempPaths.push(this._currentPath)}lineTo(D,j){this._currentPath.addLineTo(D,j)}quadraticCurveTo(D,j,W,Q){this._currentPath.addQuadraticCurveTo(D,j,W,Q,this._resolution)}bezierCurveTo(D,j,W,Q,C,k){this._currentPath.addBezierCurveTo(D,j,W,Q,C,k,this._resolution)}extractHoles(){for(const D of this._tempPaths)D.area()>0?this._holes.push(D):this._paths.push(D);if(!this._paths.length&&this._holes.length){const D=this._holes;this._holes=this._paths,this._paths=D}this._tempPaths.length=0}get paths(){return this._paths}get holes(){return this._holes}}function xD(D,j,W,Q,C,k){const M=k.glyphs[D]||k.glyphs["?"];if(!M)return null;const O=new XD(C);if(M.o){const D=M.o.split(" ");for(let C=0,k=D.length;C<k;){switch(D[C++]){case"m":{const k=parseInt(D[C++])*j+W,M=parseInt(D[C++])*j+Q;O.moveTo(k,M);break}case"l":{const k=parseInt(D[C++])*j+W,M=parseInt(D[C++])*j+Q;O.lineTo(k,M);break}case"q":{const k=parseInt(D[C++])*j+W,M=parseInt(D[C++])*j+Q,E=parseInt(D[C++])*j+W,f=parseInt(D[C++])*j+Q;O.quadraticCurveTo(E,f,k,M);break}case"b":{const k=parseInt(D[C++])*j+W,M=parseInt(D[C++])*j+Q,E=parseInt(D[C++])*j+W,f=parseInt(D[C++])*j+Q,F=parseInt(D[C++])*j+W,Z=parseInt(D[C++])*j+Q;O.bezierCurveTo(E,f,F,Z,k,M);break}}}}return O.extractHoles(),{offsetX:M.ha*j,shapePath:O}}const RD={CreateBox:Z.d,CreateTiledBox:V,CreateSphere:U.d,jb:F.b,CreateIcoSphere:h,CreateRibbon:f,CreateCylinder:K,CreateTorus:e,CreateTorusKnot:b,CreateLineSystem:Y.g,kb:Y.k,CreateDashedLines:Y.d,ExtrudeShape:i,ExtrudeShapeCustom:p,CreateLathe:A,CreateTiledPlane:x,Lg:w.c,CreateGround:n.g,CreateTiledGround:n.i,CreateGroundFromHeightMap:n.d,CreatePolygon:H,ExtrudePolygon:z,CreateTube:u,CreatePolyhedron:o,CreateGeodesic:function(D,j){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Q=j.m||1;Q!==Math.floor(Q)&&(Q=Math.floor(Q),t.b.Warn("m not an integer only floor(m) used"));let C=j.n||0;if(C!==Math.floor(C)&&(C=Math.floor(C),t.b.Warn("n not an integer only floor(n) used")),C>Q){const D=C;C=Q,Q=D,t.b.Warn("n > m therefore m and n swapped")}const k=new ED;return k.build(Q,C),o(D,{custom:FD.BuildGeodesicData(k),size:j.size,sizeX:j.sizeX,sizeY:j.sizeY,sizeZ:j.sizeZ,faceUV:j.faceUV,faceColors:j.faceColors,flat:j.flat,updatable:j.updatable,sideOrientation:j.sideOrientation,frontUVs:j.frontUVs,backUVs:j.backUVs},W)},CreateGoldberg:function(D,j){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const k=j.size,E=j.sizeX||k||1,f=j.sizeY||k||1,F=j.sizeZ||k||1;let Z=j.m||1;Z!==Math.floor(Z)&&(Z=Math.floor(Z),t.b.Warn("m not an integer only floor(m) used"));let X=j.n||0;if(X!==Math.floor(X)&&(X=Math.floor(X),t.b.Warn("n not an integer only floor(n) used")),X>Z){const D=X;X=Z,Z=D,t.b.Warn("n > m therefore m and n swapped")}const x=new ED;x.build(Z,X);const R=FD.BuildGeodesicData(x),V=R.toGoldbergPolyhedronData(),U=new ZD(D,W);j.sideOrientation=C.d._GetDefaultSideOrientation(j.sideOrientation),U._originalBuilderSideOrientation=j.sideOrientation;(function(D,j){const W=D.size,C=D.sizeX||W||1,k=D.sizeY||W||1,E=D.sizeZ||W||1,f=0===D.sideOrientation?0:D.sideOrientation||M.b.DEFAULTSIDE,F=[],Z=[],P=[],X=[];let x=1/0,R=-1/0,V=1/0,U=-1/0;for(let Q=0;Q<j.vertex.length;Q++)x=Math.min(x,j.vertex[Q][0]*C),R=Math.max(R,j.vertex[Q][0]*C),V=Math.min(V,j.vertex[Q][1]*k),U=Math.max(U,j.vertex[Q][1]*k);let g=0;for(let M=0;M<j.face.length;M++){const D=j.face[M],W=Q.j.Dd(j.vertex[D[0]]),f=Q.j.Dd(j.vertex[D[2]]),N=Q.j.Dd(j.vertex[D[1]]),G=f.Qc(W),K=N.Qc(W),L=Q.j.Cross(K,G).normalize();for(let Q=0;Q<D.length;Q++){P.push(L.x,L.y,L.z);const W=j.vertex[D[Q]];F.push(W[0]*C,W[1]*k,W[2]*E);const M=(W[1]*k-V)/(U-V);X.push((W[0]*C-x)/(R-x),O.b?1-M:M)}for(let j=0;j<D.length-2;j++)Z.push(g,g+j+2,g+j+1);g+=D.length}M.b._ComputeSides(f,F,Z,P,X);const N=new M.b;return N.xa=F,N.indices=Z,N.ya=P,N.Aa=X,N})(j,V).Ca(U,j.updatable),U.goldbergData.nbSharedFaces=R.sharedNodes,U.goldbergData.nbUnsharedFaces=R.poleNodes,U.goldbergData.adjacentFaces=R.adjacentFaces,U.goldbergData.nbFaces=U.goldbergData.nbSharedFaces+U.goldbergData.nbUnsharedFaces,U.goldbergData.nbFacesAtPole=(U.goldbergData.nbUnsharedFaces-12)/12;for(let C=0;C<R.vertex.length;C++)U.goldbergData.faceCenters.push(Q.j.Dd(R.vertex[C])),U.goldbergData.faceCenters[C].x*=E,U.goldbergData.faceCenters[C].y*=f,U.goldbergData.faceCenters[C].z*=F,U.goldbergData.faceColors.push(new P.h(1,1,1,1));for(let C=0;C<V.face.length;C++){const D=V.face[C],j=Q.j.Dd(V.vertex[D[0]]),W=Q.j.Dd(V.vertex[D[2]]),k=Q.j.Dd(V.vertex[D[1]]),M=W.Qc(j),O=k.Qc(j),E=Q.j.Cross(O,M).normalize(),f=Q.j.Cross(O,E).normalize();U.goldbergData.faceXaxis.push(O.normalize()),U.goldbergData.faceYaxis.push(E),U.goldbergData.faceZaxis.push(f)}return U},CreateDecal:CD,CreateCapsule:MD,CreateText:function(D,j,W){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{size:50,resolution:8,depth:1},M=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:earcut;const E=function(D,j,W,Q){const C=Array.from(D),k=j/Q.resolution,M=(Q.boundingBox.yMax-Q.boundingBox.yMin+Q.underlineThickness)*k,O=[];let E=0,f=0;for(let F=0;F<C.length;F++){const D=C[F];if("\n"===D)E=0,f-=M;else{const j=xD(D,k,E,f,W,Q);j&&(E+=j.offsetX,O.push(j.shapePath))}}return O}(j,k.size||50,k.resolution||8,W),f=[];let F=0;for(const x of E){if(!x.paths.length)continue;const j=x.holes.slice();for(const W of x.paths){var Z,P;const E=[],X=[],x=W.getPoints();for(const D of x)X.push(new Q.j(D.x,0,D.y));const R=j.slice();for(const D of R){const C=D.getPoints();let k=!1;for(const D of C)if(W.isPointInside(D)){k=!0;break}if(!k)continue;const M=[];for(const D of C)M.push(new Q.j(D.x,0,D.y));E.push(M),j.splice(j.indexOf(D),1)}if(!E.length&&j.length)for(const D of j){const j=D.getPoints(),W=[];for(const D of j)W.push(new Q.j(D.x,0,D.y));E.push(W)}const V=z(D,{shape:X,holes:E.length?E:void 0,depth:k.depth||1,faceUV:k.faceUV||(null===(Z=k.perLetterFaceUV)||void 0===Z?void 0:Z.call(k,F)),faceColors:k.faceColors||(null===(P=k.perLetterFaceColors)||void 0===P?void 0:P.call(k,F)),sideOrientation:C.d._GetDefaultSideOrientation(k.sideOrientation||C.d.DOUBLESIDE)},M,O);f.push(V),F++}}const X=C.d.MergeMeshes(f,!0,!0);if(X){const j=X.getBoundingInfo().boundingBox;X.position.x+=-(j.minimumWorld.x+j.maximumWorld.x)/2,X.position.y+=-(j.minimumWorld.y+j.maximumWorld.y)/2,X.position.z+=-(j.minimumWorld.z+j.maximumWorld.z)/2+j.extendSize.z,X.name=D;const W=new PD.c("pivot",M);W.rotation.x=-Math.PI/2,X.parent=W,X.bakeCurrentTransformIntoVertices(),X.parent=null,W.dispose()}return X}}},12741:(D,j,W)=>{"use strict";var Q=W(11994),C=W(1256),k=W(966),M=W(1083),O=W(1357);Q.d.prototype.thinInstanceAdd=function(D){let j=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.va().getEngine().getCaps().instancedArrays)return M.b.Error("Thin Instances are not supported on this device as Instanced Array extension not supported"),-1;this._thinInstanceUpdateBufferSize("matrix",Array.isArray(D)?D.length:1);const W=this._thinInstanceDataStorage.instancesCount;if(Array.isArray(D))for(let Q=0;Q<D.length;++Q)this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,D[Q],Q===D.length-1&&j);else this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,D,j);return W},Q.d.prototype.thinInstanceAddSelf=function(){let D=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.thinInstanceAdd(k.b.IdentityReadOnly,D)},Q.d.prototype.thinInstanceRegisterAttribute=function(D,j){D===C.f.ColorKind&&(D=C.f.ColorInstanceKind),this.removeVerticesData(D),this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.strides[D]=j,this._userThinInstanceBuffersStorage.sizes[D]=j*Math.max(32,this._thinInstanceDataStorage.instancesCount),this._userThinInstanceBuffersStorage.data[D]=new Float32Array(this._userThinInstanceBuffersStorage.sizes[D]),this._userThinInstanceBuffersStorage.vertexBuffers[D]=new C.f(this.getEngine(),this._userThinInstanceBuffersStorage.data[D],D,!0,!1,j,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[D])},Q.d.prototype.thinInstanceSetMatrixAt=function(D,j){let W=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!this._thinInstanceDataStorage.matrixData||D>=this._thinInstanceDataStorage.instancesCount)return!1;const Q=this._thinInstanceDataStorage.matrixData;return j.copyToArray(Q,16*D),this._thinInstanceDataStorage.worldMatrices&&(this._thinInstanceDataStorage.worldMatrices[D]=j),W&&(this.ak("matrix"),this.Da||this.thinInstanceRefreshBoundingInfo(!1)),!0},Q.d.prototype.thinInstanceSetAttributeAt=function(D,j,W){let Q=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return D===C.f.ColorKind&&(D=C.f.ColorInstanceKind),!(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.data[D]||j>=this._thinInstanceDataStorage.instancesCount)&&(this._thinInstanceUpdateBufferSize(D,0),this._userThinInstanceBuffersStorage.data[D].set(W,j*this._userThinInstanceBuffersStorage.strides[D]),Q&&this.ak(D),!0)},Object.defineProperty(Q.d.prototype,"Zj",{get:function(){return this._thinInstanceDataStorage.instancesCount},set:function(D){var j;const W=this._thinInstanceDataStorage.matrixData??(null===(j=this.source)||void 0===j?void 0:j._thinInstanceDataStorage.matrixData);D<=(W?W.length/16:0)&&(this._thinInstanceDataStorage.instancesCount=D)},enumerable:!0,configurable:!0}),Q.d.prototype._thinInstanceCreateMatrixBuffer=function(D,j){let W=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const Q=new C.b(this.getEngine(),j,!W,16,!1,!0);for(let C=0;C<4;C++)this.setVerticesBuffer(Q.createVertexBuffer(D+C,4*C,4));return Q},Q.d.prototype.bk=function(D,j){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,Q=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];var k;if(W=W||16,"matrix"===D)null===(k=this._thinInstanceDataStorage.matrixBuffer)||void 0===k||k.dispose(),this._thinInstanceDataStorage.matrixBuffer=null,this._thinInstanceDataStorage.matrixBufferSize=j?j.length:32*W,this._thinInstanceDataStorage.matrixData=j,this._thinInstanceDataStorage.worldMatrices=null,null!==j?(this._thinInstanceDataStorage.instancesCount=j.length/W,this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",j,Q),this.Da||this.thinInstanceRefreshBoundingInfo(!1)):(this._thinInstanceDataStorage.instancesCount=0,this.Da||this.refreshBoundingInfo());else if("previousMatrix"===D){var M;null===(M=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===M||M.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=null,this._thinInstanceDataStorage.previousMatrixData=j,null!==j&&(this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",j,Q))}else{var O;if(D===C.f.ColorKind&&(D=C.f.ColorInstanceKind),null===j)null!==(O=this._userThinInstanceBuffersStorage)&&void 0!==O&&O.data[D]&&(this.removeVerticesData(D),delete this._userThinInstanceBuffersStorage.data[D],delete this._userThinInstanceBuffersStorage.strides[D],delete this._userThinInstanceBuffersStorage.sizes[D],delete this._userThinInstanceBuffersStorage.vertexBuffers[D]);else this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.data[D]=j,this._userThinInstanceBuffersStorage.strides[D]=W,this._userThinInstanceBuffersStorage.sizes[D]=j.length,this._userThinInstanceBuffersStorage.vertexBuffers[D]=new C.f(this.getEngine(),j,D,!Q,!1,W,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[D])}},Q.d.prototype.ak=function(D){var j;if("matrix"===D)this.Yj&&this._thinInstanceDataStorage.matrixBuffer&&!this._thinInstanceDataStorage.matrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(D),null===(j=this._thinInstanceDataStorage.matrixBuffer)||void 0===j||j.updateDirectly(this._thinInstanceDataStorage.matrixData,0,this._thinInstanceDataStorage.instancesCount);else if("previousMatrix"===D){var W;this.Yj&&this._thinInstanceDataStorage.previousMatrixBuffer&&!this._thinInstanceDataStorage.previousMatrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(D),null===(W=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===W||W.updateDirectly(this._thinInstanceDataStorage.previousMatrixData,0,this._thinInstanceDataStorage.instancesCount)}else{var Q;D===C.f.ColorKind&&(D=C.f.ColorInstanceKind),null!==(Q=this._userThinInstanceBuffersStorage)&&void 0!==Q&&Q.vertexBuffers[D]&&(this.Yj&&!this._userThinInstanceBuffersStorage.vertexBuffers[D].isUpdatable()&&this._thinInstanceRecreateBuffer(D),this._userThinInstanceBuffersStorage.vertexBuffers[D].updateDirectly(this._userThinInstanceBuffersStorage.data[D],0))}},Q.d.prototype.thinInstancePartialBufferUpdate=function(D,j,W){var Q;"matrix"===D?this._thinInstanceDataStorage.matrixBuffer&&this._thinInstanceDataStorage.matrixBuffer.updateDirectly(j,W):(D===C.f.ColorKind&&(D=C.f.ColorInstanceKind),null!==(Q=this._userThinInstanceBuffersStorage)&&void 0!==Q&&Q.vertexBuffers[D]&&this._userThinInstanceBuffersStorage.vertexBuffers[D].updateDirectly(j,W))},Q.d.prototype.thinInstanceGetWorldMatrices=function(){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return[];const D=this._thinInstanceDataStorage.matrixData;if(!this._thinInstanceDataStorage.worldMatrices){this._thinInstanceDataStorage.worldMatrices=[];for(let j=0;j<this._thinInstanceDataStorage.instancesCount;++j)this._thinInstanceDataStorage.worldMatrices[j]=k.b.Dd(D,16*j)}return this._thinInstanceDataStorage.worldMatrices},Q.d.prototype.thinInstanceRefreshBoundingInfo=function(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0],j=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return;const Q=this._thinInstanceDataStorage.boundingVectors;if(D||!this.rawBoundingInfo){Q.length=0,this.refreshBoundingInfo(j,W);const D=this.getBoundingInfo();this.rawBoundingInfo=new O.d(D.minimum,D.maximum)}const C=this.getBoundingInfo(),M=this._thinInstanceDataStorage.matrixData;if(0===Q.length)for(let k=0;k<C.boundingBox.vectors.length;++k)Q.push(C.boundingBox.vectors[k].clone());k.e.Kd[0].Jd(Number.POSITIVE_INFINITY),k.e.Kd[1].Jd(Number.NEGATIVE_INFINITY);for(let O=0;O<this._thinInstanceDataStorage.instancesCount;++O){k.b.FromArrayToRef(M,16*O,k.e.Matrix[0]);for(let D=0;D<Q.length;++D)k.j.TransformCoordinatesToRef(Q[D],k.e.Matrix[0],k.e.Kd[2]),k.e.Kd[0].minimizeInPlace(k.e.Kd[2]),k.e.Kd[1].maximizeInPlace(k.e.Kd[2])}C.reConstruct(k.e.Kd[0],k.e.Kd[1]),this.Ea()},Q.d.prototype._thinInstanceRecreateBuffer=function(D){let j=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var W;if("matrix"===D)null===(W=this._thinInstanceDataStorage.matrixBuffer)||void 0===W||W.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",this._thinInstanceDataStorage.matrixData,j);else if("previousMatrix"===D){var Q;if(this._scene.needsPreviousWorldMatrices)null===(Q=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===Q||Q.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.previousMatrixData??this._thinInstanceDataStorage.matrixData,j)}else{var k;D===C.f.ColorKind&&(D=C.f.ColorInstanceKind),null===(k=this._userThinInstanceBuffersStorage.vertexBuffers[D])||void 0===k||k.dispose(),this._userThinInstanceBuffersStorage.vertexBuffers[D]=new C.f(this.getEngine(),this._userThinInstanceBuffersStorage.data[D],D,!j,!1,this._userThinInstanceBuffersStorage.strides[D],!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[D])}},Q.d.prototype._thinInstanceUpdateBufferSize=function(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;D===C.f.ColorKind&&(D=C.f.ColorInstanceKind);const W="matrix"===D;if(!W&&(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.strides[D]))return;const Q=W?16:this._userThinInstanceBuffersStorage.strides[D],k=W?this._thinInstanceDataStorage.matrixBufferSize:this._userThinInstanceBuffersStorage.sizes[D];let M=W?this._thinInstanceDataStorage.matrixData:this._userThinInstanceBuffersStorage.data[D];const O=(this._thinInstanceDataStorage.instancesCount+j)*Q;let E=k;for(;E<O;)E*=2;if(!M||k!=E){if(M){const D=new Float32Array(E);D.set(M,0),M=D}else M=new Float32Array(E);var f,F,Z;if(W){if(null===(f=this._thinInstanceDataStorage.matrixBuffer)||void 0===f||f.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",M,!1),this._thinInstanceDataStorage.matrixData=M,this._thinInstanceDataStorage.matrixBufferSize=E,this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData)null===(F=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===F||F.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",M,!1)}else null===(Z=this._userThinInstanceBuffersStorage.vertexBuffers[D])||void 0===Z||Z.dispose(),this._userThinInstanceBuffersStorage.data[D]=M,this._userThinInstanceBuffersStorage.sizes[D]=E,this._userThinInstanceBuffersStorage.vertexBuffers[D]=new C.f(this.getEngine(),M,D,!0,!1,Q,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[D])}},Q.d.prototype._thinInstanceInitializeUserStorage=function(){this._userThinInstanceBuffersStorage||(this._userThinInstanceBuffersStorage={data:{},sizes:{},vertexBuffers:{},strides:{}})},Q.d.prototype._disposeThinInstanceSpecificData=function(){var D;null!==(D=this._thinInstanceDataStorage)&&void 0!==D&&D.matrixBuffer&&(this._thinInstanceDataStorage.matrixBuffer.dispose(),this._thinInstanceDataStorage.matrixBuffer=null)}},12037:(D,j,W)=>{"use strict";W.d(j,{c:()=>Z});var Q=W(942),C=W(948),k=W(1151),M=W(961),O=W(966),E=W(12011),f=W(981);const F=O.b.Compose(O.j.One(),O.d.FromEulerAngles(0,Math.PI,0),O.j.Zero());class Z extends E.e{get billboardMode(){return this._billboardMode}set billboardMode(D){this._billboardMode!==D&&(this._billboardMode=D,this._cache.useBillboardPosition=0!==(this._billboardMode&Z.BILLBOARDMODE_USE_POSITION),this._computeUseBillboardPath())}get preserveParentRotationForBillboard(){return this._preserveParentRotationForBillboard}set preserveParentRotationForBillboard(D){D!==this._preserveParentRotationForBillboard&&(this._preserveParentRotationForBillboard=D,this._computeUseBillboardPath())}_computeUseBillboardPath(){this._cache.useBillboardPath=this._billboardMode!==Z.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}get infiniteDistance(){return this._infiniteDistance}set infiniteDistance(D){this._infiniteDistance!==D&&(this._infiniteDistance=D)}constructor(D){let j=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(D,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,!1),this._forward=new O.j(0,0,1),this._up=new O.j(0,1,0),this._right=new O.j(1,0,0),this._position=O.j.Zero(),this._rotation=O.j.Zero(),this._rotationQuaternion=null,this._scaling=O.j.One(),this._transformToBoneReferal=null,this._isAbsoluteSynced=!1,this._billboardMode=Z.BILLBOARDMODE_NONE,this._preserveParentRotationForBillboard=!1,this.scalingDeterminant=1,this._infiniteDistance=!1,this.ignoreNonUniformScaling=!1,this.reIntegrateRotationIntoRotationQuaternion=!1,this._poseMatrix=null,this._j=O.b.Zero(),this._usePivotMatrix=!1,this._absolutePosition=O.j.Zero(),this._absoluteScaling=O.j.Zero(),this._absoluteRotationQuaternion=O.d.Identity(),this._pivotMatrix=O.b.Identity(),this._postMultiplyPivotMatrix=!1,this._isWorldMatrixFrozen=!1,this._indexInSceneTransformNodesArray=-1,this.onAfterWorldMatrixUpdateObservable=new M.d,this._nonUniformScaling=!1,j&&this.va().addTransformNode(this)}getClassName(){return"mb"}get position(){return this._position}set position(D){this._position=D,this._markAsDirtyInternal()}isUsingPivotMatrix(){return this._usePivotMatrix}isUsingPostMultiplyPivotMatrix(){return this._postMultiplyPivotMatrix}get rotation(){return this._rotation}set rotation(D){this._rotation=D,this._rotationQuaternion=null,this._markAsDirtyInternal()}get Pd(){return this._scaling}set Pd(D){this._scaling=D,this._markAsDirtyInternal()}get rotationQuaternion(){return this._rotationQuaternion}set rotationQuaternion(D){this._rotationQuaternion=D,D&&this._rotation.Jd(0),this._markAsDirtyInternal()}_markAsDirtyInternal(){this._isDirty||(this._isDirty=!0,this.customMarkAsDirty&&this.customMarkAsDirty())}get forward(){return O.j.TransformNormalFromFloatsToRef(0,0,this.va().useRightHandedSystem?-1:1,this.getWorldMatrix(),this._forward),this._forward.normalize()}get up(){return O.j.TransformNormalFromFloatsToRef(0,1,0,this.getWorldMatrix(),this._up),this._up.normalize()}get right(){return O.j.TransformNormalFromFloatsToRef(this.va().useRightHandedSystem?-1:1,0,0,this.getWorldMatrix(),this._right),this._right.normalize()}updatePoseMatrix(D){return this._poseMatrix?(this._poseMatrix.p(D),this):(this._poseMatrix=D.clone(),this)}getPoseMatrix(){return this._poseMatrix||(this._poseMatrix=O.b.Identity()),this._poseMatrix}_isSynchronized(){const D=this._cache;return this._billboardMode===D.billboardMode&&this._billboardMode===Z.BILLBOARDMODE_NONE&&(!D.pivotMatrixUpdated&&(!this._infiniteDistance&&(!this._position._isDirty&&(!this._scaling._isDirty&&!(this._rotationQuaternion&&this._rotationQuaternion._isDirty||this._rotation._isDirty)))))}_initCache(){super._initCache();const D=this._cache;D.localMatrixUpdated=!1,D.billboardMode=-1,D.infiniteDistance=!1,D.useBillboardPosition=!1,D.useBillboardPath=!1}get absolutePosition(){return this.getAbsolutePosition()}get absoluteScaling(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling}get absoluteRotationQuaternion(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion}setPreTransformMatrix(D){return this.setPivotMatrix(D,!1)}setPivotMatrix(D){let j=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._pivotMatrix.p(D),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=j,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=O.b.Invert(this._pivotMatrix)),this}getPivotMatrix(){return this._pivotMatrix}instantiateHierarchy(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,j=arguments.length>1?arguments[1]:void 0,W=arguments.length>2?arguments[2]:void 0;const Q=this.clone("Clone of "+(this.name||this.id),D||this.parent,!0);Q&&W&&W(this,Q);for(const C of this.getChildTransformNodes(!0))C.instantiateHierarchy(Q,j,W);return Q}oi(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return D?arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(this._rotation.Jd(0),this._rotationQuaternion=this._rotationQuaternion||O.d.Identity(),D.decompose(this._scaling,this._rotationQuaternion,this._position),this.Ge(!0)):(this._worldMatrix=D,this._absolutePosition.Id(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._afterComputeWorldMatrix()):(this._isWorldMatrixFrozen=!1,this.Ge(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this}unfreezeWorldMatrix(){return this._isWorldMatrixFrozen=!1,this.Ge(!0),this}get Ej(){return this._isWorldMatrixFrozen}getAbsolutePosition(){return this.Ge(),this._absolutePosition}setAbsolutePosition(D){if(!D)return this;let j,W,Q;if(void 0===D.x){if(arguments.length<3)return this;j=arguments[0],W=arguments[1],Q=arguments[2]}else j=D.x,W=D.y,Q=D.z;if(this.parent){const D=O.e.Matrix[0];this.parent.getWorldMatrix().invertToRef(D),O.j.TransformCoordinatesFromFloatsToRef(j,W,Q,D,this.position)}else this.position.x=j,this.position.y=W,this.position.z=Q;return this._absolutePosition.p(D),this}setPositionWithLocalVector(D){return this.Ge(),this.position=O.j.TransformNormal(D,this._j),this}getPositionExpressedInLocalSpace(){this.Ge();const D=O.e.Matrix[0];return this._j.invertToRef(D),O.j.TransformNormal(this.position,D)}locallyTranslate(D){return this.Ge(!0),this.position=O.j.TransformCoordinates(D,this._j),this}lookAt(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const k=Z._LookAtVectorCache,M=0===C?this.position:this.getAbsolutePosition();if(D.subtractToRef(M,k),this.setDirection(k,j,W,Q),1===C&&this.parent)if(this.rotationQuaternion){const D=O.e.Matrix[0];this.rotationQuaternion.toRotationMatrix(D);const j=O.e.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(j),j.invert(),D.multiplyToRef(j,D),this.rotationQuaternion.fromRotationMatrix(D)}else{const D=O.e.Quaternion[0];O.d.FromEulerVectorToRef(this.rotation,D);const j=O.e.Matrix[0];D.toRotationMatrix(j);const W=O.e.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(W),W.invert(),j.multiplyToRef(W,j),D.fromRotationMatrix(j),D.toEulerAnglesToRef(this.rotation)}return this}ie(D){const j=O.j.Zero();return this.getDirectionToRef(D,j),j}getDirectionToRef(D,j){return O.j.TransformNormalToRef(D,this.getWorldMatrix(),j),this}setDirection(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const C=-Math.atan2(D.z,D.x)+Math.PI/2,k=Math.sqrt(D.x*D.x+D.z*D.z),M=-Math.atan2(D.y,k);return this.rotationQuaternion?O.d.RotationYawPitchRollToRef(C+j,M+W,Q,this.rotationQuaternion):(this.rotation.x=M+W,this.rotation.y=C+j,this.rotation.z=Q),this}setPivotPoint(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;0==this.va().getRenderId()&&this.Ge(!0);const W=this.getWorldMatrix();if(1==j){const j=O.e.Matrix[0];W.invertToRef(j),D=O.j.TransformCoordinates(D,j)}return this.setPivotMatrix(O.b.Translation(-D.x,-D.y,-D.z),!0)}getPivotPoint(){const D=O.j.Zero();return this.getPivotPointToRef(D),D}getPivotPointToRef(D){return D.x=-this._pivotMatrix.m[12],D.y=-this._pivotMatrix.m[13],D.z=-this._pivotMatrix.m[14],this}getAbsolutePivotPoint(){const D=O.j.Zero();return this.getAbsolutePivotPointToRef(D),D}getAbsolutePivotPointToRef(D){return this.getPivotPointToRef(D),O.j.TransformCoordinatesToRef(D,this.getWorldMatrix(),D),this}Le(D){if(this._isDirty)return this;if(this._children)for(const j of this._children)j.Le(D);return super.Le(D)}setParent(D){let j=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!D&&!this.parent)return this;const Q=O.e.Quaternion[0],C=O.e.Kd[0],k=O.e.Kd[1],M=O.e.Matrix[1];O.b.IdentityToRef(M);const E=O.e.Matrix[0];this.Ge(!0);let f=this.rotationQuaternion;return f||(f=Z._TmpRotation,O.d.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,f)),O.b.ComposeToRef(this.Pd,f,this.position,E),this.parent&&E.multiplyToRef(this.parent.Ge(!0),E),D&&(D.Ge(!0).invertToRef(M),E.multiplyToRef(M,E)),E.decompose(k,Q,C,j?this:void 0),this.rotationQuaternion?this.rotationQuaternion.p(Q):Q.toEulerAnglesToRef(this.rotation),this.Pd.p(k),this.position.p(C),this.parent=D,W&&this.setPivotMatrix(O.b.Identity()),this}addChild(D){let j=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return D.setParent(this,j),this}removeChild(D){let j=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return D.setParent(null,j),this}get nonUniformScaling(){return this._nonUniformScaling}_updateNonUniformScalingState(D){return this._nonUniformScaling!==D&&(this._nonUniformScaling=D,!0)}attachToBone(D,j){return this._currentParentWhenAttachingToBone=this.parent,this._transformToBoneReferal=j,this.parent=D,D.getSkeleton().prepare(!0),D.getFinalMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this}detachFromBone(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=D?this._currentParentWhenAttachingToBone:null,this):(D&&(this.parent=this._currentParentWhenAttachingToBone),this)}rotate(D,j,W){let Q;if(D.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.Jd(0)),W&&0!==W){if(this.parent){const W=this.parent.getWorldMatrix(),Q=O.e.Matrix[0];W.invertToRef(Q),D=O.j.TransformNormal(D,Q),W.determinant()<0&&(j*=-1)}Q=O.d.RotationAxisToRef(D,j,Z._RotationAxisCache),Q.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else Q=O.d.RotationAxisToRef(D,j,Z._RotationAxisCache),this.rotationQuaternion.multiplyToRef(Q,this.rotationQuaternion);return this}rotateAround(D,j,W){j.normalize(),this.rotationQuaternion||(this.rotationQuaternion=O.d.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.Jd(0));const Q=O.e.Kd[0],C=O.e.Kd[1],k=O.e.Kd[2],M=O.e.Quaternion[0],E=O.e.Matrix[0],f=O.e.Matrix[1],F=O.e.Matrix[2],Z=O.e.Matrix[3];return D.subtractToRef(this.position,Q),O.b.TranslationToRef(Q.x,Q.y,Q.z,E),O.b.TranslationToRef(-Q.x,-Q.y,-Q.z,f),O.b.RotationAxisToRef(j,W,F),f.multiplyToRef(F,Z),Z.multiplyToRef(E,Z),Z.decompose(C,M,k),this.position.addInPlace(k),M.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this}translate(D,j,W){const Q=D.scale(j);if(W&&0!==W)this.setAbsolutePosition(this.getAbsolutePosition().add(Q));else{const D=this.getPositionExpressedInLocalSpace().add(Q);this.setPositionWithLocalVector(D)}return this}addRotation(D,j,W){let Q;this.rotationQuaternion?Q=this.rotationQuaternion:(Q=O.e.Quaternion[1],O.d.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,Q));const C=O.e.Quaternion[0];return O.d.RotationYawPitchRollToRef(j,D,W,C),Q.multiplyInPlace(C),this.rotationQuaternion||Q.toEulerAnglesToRef(this.rotation),this}_getEffectiveParent(){return this.parent}isWorldMatrixCameraDependent(){return this._infiniteDistance&&!this.parent||this._billboardMode!==Z.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}Ge(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0],j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;const W=this.va().getRenderId();if(!this._isDirty&&!D&&(this._currentRenderId===W||this.isSynchronized()))return this._currentRenderId=W,this._worldMatrix;j=j||this.va().activeCamera,this._updateCache();const Q=this._cache;Q.pivotMatrixUpdated=!1,Q.billboardMode=this.billboardMode,Q.infiniteDistance=this.infiniteDistance,Q.parent=this._parentNode,this._currentRenderId=W,this._childUpdateId+=1,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;const C=this._getEffectiveParent(),k=Z._TmpScaling;let M,E=this._position;if(this._infiniteDistance&&!this.parent&&j){const D=j.getWorldMatrix(),W=new O.j(D.m[12],D.m[13],D.m[14]);E=Z._TmpTranslation,E.Id(this._position.x+W.x,this._position.y+W.y,this._position.z+W.z)}if(k.Id(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant),this._rotationQuaternion){if(this._rotationQuaternion._isDirty=!1,M=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion){this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(O.d.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.Id(0,0,0))}}else M=Z._TmpRotation,O.d.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,M);if(this._usePivotMatrix){const D=O.e.Matrix[1];O.b.ScalingToRef(k.x,k.y,k.z,D);const j=O.e.Matrix[0];M.toRotationMatrix(j),this._pivotMatrix.multiplyToRef(D,O.e.Matrix[4]),O.e.Matrix[4].multiplyToRef(j,this._j),this._postMultiplyPivotMatrix&&this._j.multiplyToRef(this._pivotMatrixInverse,this._j),this._j.addTranslationFromFloats(E.x,E.y,E.z)}else O.b.ComposeToRef(k,M,E,this._j);if(C&&C.getWorldMatrix){if(D&&C.Ge(D),Q.useBillboardPath){if(this._transformToBoneReferal){const D=this.parent;D.getSkeleton().prepare(),D.getFinalMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),O.e.Matrix[7])}else O.e.Matrix[7].p(C.getWorldMatrix());const D=O.e.Kd[5],j=O.e.Kd[6],W=O.e.Quaternion[0];O.e.Matrix[7].decompose(j,W,D),O.b.ScalingToRef(j.x,j.y,j.z,O.e.Matrix[7]),O.e.Matrix[7].setTranslation(D),Z.BillboardUseParentOrientation&&(this._position.applyRotationQuaternionToRef(W,D),this._j.setTranslation(D)),this._j.multiplyToRef(O.e.Matrix[7],this._worldMatrix)}else if(this._transformToBoneReferal){const D=this.parent;D.getSkeleton().prepare(),this._j.multiplyToRef(D.getFinalMatrix(),O.e.Matrix[6]),O.e.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)}else this._j.multiplyToRef(C.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.p(this._j);if(Q.useBillboardPath&&j&&this.billboardMode&&!Q.useBillboardPosition){const D=O.e.Kd[0];if(this._worldMatrix.getTranslationToRef(D),O.e.Matrix[1].p(j.getViewMatrix()),this._scene.useRightHandedSystem&&O.e.Matrix[1].multiplyToRef(F,O.e.Matrix[1]),O.e.Matrix[1].setTranslationFromFloats(0,0,0),O.e.Matrix[1].invertToRef(O.e.Matrix[0]),(this.billboardMode&Z.BILLBOARDMODE_ALL)!==Z.BILLBOARDMODE_ALL){O.e.Matrix[0].decompose(void 0,O.e.Quaternion[0],void 0);const D=O.e.Kd[1];O.e.Quaternion[0].toEulerAnglesToRef(D),(this.billboardMode&Z.BILLBOARDMODE_X)!==Z.BILLBOARDMODE_X&&(D.x=0),(this.billboardMode&Z.BILLBOARDMODE_Y)!==Z.BILLBOARDMODE_Y&&(D.y=0),(this.billboardMode&Z.BILLBOARDMODE_Z)!==Z.BILLBOARDMODE_Z&&(D.z=0),O.b.RotationYawPitchRollToRef(D.y,D.x,D.z,O.e.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(O.e.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(O.e.Kd[0])}else if(Q.useBillboardPath&&j&&Q.useBillboardPosition){const D=O.e.Kd[0];this._worldMatrix.getTranslationToRef(D);const W=j.globalPosition;this._worldMatrix.invertToRef(O.e.Matrix[1]);const Q=O.e.Kd[1];O.j.TransformCoordinatesToRef(W,O.e.Matrix[1],Q),Q.normalize();const C=-Math.atan2(Q.z,Q.x)+Math.PI/2,k=Math.sqrt(Q.x*Q.x+Q.z*Q.z),M=-Math.atan2(Q.y,k);if(O.d.RotationYawPitchRollToRef(C,M,0,O.e.Quaternion[0]),(this.billboardMode&Z.BILLBOARDMODE_ALL)!==Z.BILLBOARDMODE_ALL){const D=O.e.Kd[1];O.e.Quaternion[0].toEulerAnglesToRef(D),(this.billboardMode&Z.BILLBOARDMODE_X)!==Z.BILLBOARDMODE_X&&(D.x=0),(this.billboardMode&Z.BILLBOARDMODE_Y)!==Z.BILLBOARDMODE_Y&&(D.y=0),(this.billboardMode&Z.BILLBOARDMODE_Z)!==Z.BILLBOARDMODE_Z&&(D.z=0),O.b.RotationYawPitchRollToRef(D.y,D.x,D.z,O.e.Matrix[0])}else O.b.FromQuaternionToRef(O.e.Quaternion[0],O.e.Matrix[0]);this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(O.e.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(O.e.Kd[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):C&&C._nonUniformScaling?this._updateNonUniformScalingState(C._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.Id(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=O.b.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix}resetLocalMatrix(){let D=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.Ge(),D){const D=this.getChildren();for(let j=0;j<D.length;++j){const W=D[j];if(W){W.Ge();const D=O.e.Matrix[0];W._j.multiplyToRef(this._j,D);const j=O.e.Quaternion[0];D.decompose(W.Pd,j,W.position),W.rotationQuaternion?W.rotationQuaternion.p(j):j.toEulerAnglesToRef(W.rotation)}}}this.Pd.Id(1,1,1),this.position.Id(0,0,0),this.rotation.Id(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=O.d.Identity()),this._worldMatrix=O.b.Identity()}_afterComputeWorldMatrix(){}registerAfterWorldMatrixUpdate(D){return this.onAfterWorldMatrixUpdateObservable.add(D),this}unregisterAfterWorldMatrixUpdate(D){return this.onAfterWorldMatrixUpdateObservable.removeCallback(D),this}getPositionInCameraSpace(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return D||(D=this.va().activeCamera),O.j.TransformCoordinates(this.getAbsolutePosition(),D.getViewMatrix())}getDistanceToCamera(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return D||(D=this.va().activeCamera),this.getAbsolutePosition().Qc(D.globalPosition).length()}clone(D,j,W){const Q=k.d.Clone((()=>new Z(D,this.va())),this);if(Q.name=D,Q.id=D,j&&(Q.parent=j),!W){const j=this.getDescendants(!0);for(let W=0;W<j.length;W++){const C=j[W];C.clone&&C.clone(D+"."+C.name,Q)}}return Q}serialize(D){const j=k.d.Serialize(this,D);return j.type=this.getClassName(),j.uniqueId=this.uniqueId,this.parent&&this.parent._serializeAsParent(j),j.localMatrix=this.getPivotMatrix().Gd(),j.isEnabled=this.isEnabled(),k.d.AppendSerializedAnimations(this,j),j.ranges=this.serializeAnimationRanges(),j}static Parse(D,j,W){const Q=k.d.Parse((()=>new Z(D.name,j)),D,j,W);if(D.localMatrix?Q.setPreTransformMatrix(O.b.Dd(D.localMatrix)):D.pivotMatrix&&Q.setPivotMatrix(O.b.Dd(D.pivotMatrix)),Q.Kg(D.isEnabled),Q._waitingParsedUniqueId=D.uniqueId,void 0!==D.parentId&&(Q._waitingParentId=D.parentId),void 0!==D.parentInstanceIndex&&(Q._waitingParentInstanceIndex=D.parentInstanceIndex),D.animations){for(let j=0;j<D.animations.length;j++){const W=D.animations[j],C=(0,f.b)("BABYLON.Animation");C&&Q.animations.push(C.Parse(W))}E.e.ParseAnimationRanges(Q,D,j)}return D.autoAnimate&&j.beginAnimation(Q,D.autoAnimateFrom,D.autoAnimateTo,D.autoAnimateLoop,D.autoAnimateSpeed||1),Q}getChildTransformNodes(D,j){const W=[];return this._getDescendants(W,D,(D=>(!j||j(D))&&D instanceof Z)),W}dispose(D){let j=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.va().stopAnimation(this),this.va().removeTransformNode(this),this._parentContainer){const D=this._parentContainer.transformNodes.indexOf(this);D>-1&&this._parentContainer.transformNodes.splice(D,1),this._parentContainer=null}if(this.onAfterWorldMatrixUpdateObservable.clear(),D){const D=this.getChildTransformNodes(!0);for(const j of D)j.parent=null,j.Ge(!0)}super.dispose(D,j)}normalizeToUnitCube(){let D=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],j=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2?arguments[2]:void 0,Q=null,C=null;j&&(this.rotationQuaternion?(C=this.rotationQuaternion.clone(),this.rotationQuaternion.Id(0,0,0,1)):this.rotation&&(Q=this.rotation.clone(),this.rotation.Id(0,0,0)));const k=this.getHierarchyBoundingVectors(D,W),M=k.max.Qc(k.min),O=Math.max(M.x,M.y,M.z);if(0===O)return this;const E=1/O;return this.Pd.scaleInPlace(E),j&&(this.rotationQuaternion&&C?this.rotationQuaternion.p(C):this.rotation&&Q&&this.rotation.p(Q)),this}_syncAbsoluteScalingAndRotation(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)}}Z.BILLBOARDMODE_NONE=0,Z.BILLBOARDMODE_X=1,Z.BILLBOARDMODE_Y=2,Z.BILLBOARDMODE_Z=4,Z.BILLBOARDMODE_ALL=7,Z.BILLBOARDMODE_USE_POSITION=128,Z.BillboardUseParentOrientation=!1,Z._TmpRotation=O.d.Zero(),Z._TmpScaling=O.j.Zero(),Z._TmpTranslation=O.j.Zero(),Z._LookAtVectorCache=new O.j(0,0,0),Z._RotationAxisCache=new O.d,(0,Q.b)([(0,C.L)("position")],Z.prototype,"_position",void 0),(0,Q.b)([(0,C.L)("rotation")],Z.prototype,"_rotation",void 0),(0,Q.b)([(0,C.E)("rotationQuaternion")],Z.prototype,"_rotationQuaternion",void 0),(0,Q.b)([(0,C.L)("Pd")],Z.prototype,"_scaling",void 0),(0,Q.b)([(0,C.O)("billboardMode")],Z.prototype,"_billboardMode",void 0),(0,Q.b)([(0,C.O)()],Z.prototype,"scalingDeterminant",void 0),(0,Q.b)([(0,C.O)("infiniteDistance")],Z.prototype,"_infiniteDistance",void 0),(0,Q.b)([(0,C.O)()],Z.prototype,"ignoreNonUniformScaling",void 0),(0,Q.b)([(0,C.O)()],Z.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0)},12691:(D,j,W)=>{"use strict";W.d(j,{e:()=>M});var Q=W(936),C=W(10925);let k=0;const M=D=>{if(!D.environmentBRDFTexture){const j=D.useDelayedTextureLoading;D.useDelayedTextureLoading=!1;const W=D._blockEntityCollection;D._blockEntityCollection=!1;const M=Q.e.CreateFromBase64String("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR42u29yY5tWXIlZnbuiSaTbZFUkZRKrCKhElASQA0EoQABgn6hJvoXzfUP+gP9hWb6Bg00IgRoQJaKqUxmZmTEe8/v0uB2u7Fm2T7HIyIrnz88uPvt3f2a2WrMbOvf/u3PvvzP/sUf/N6//i8vf/lv/3v5H//d//Sb//Uq/5u8yf8hV/m/5Cp/L1f5hVzlG7nKJ7mKyJuIXN/hPwqXI/g++zq6rPI5u8z+WqfLre+zy7PrVv9L8brsMiGvk8XLmM/sdfHXal4e3ad6GXPdyu2ij8u/+uv/5cuf/OSLfdtEfvUr+dnf/d0X//t3H/7bf/hP//N/928h/0Yg/4VA/kogfyGQP5Wr/IFAvhbIlwK5CGQTPP+9z5uPeePJSW+yo2+s/GtN30Rnv1E+f5zxof9R/lSXv/nr//mrr3+i+5dfyX7ZZQP07Tffys//8R/l/9TtX7790T/7r/8G8pdy+/8XAvnnAvkzgfwzgfyxQP5AIL8vkJ8K5KsmMVzu1U7p5PA5AXxOAJ8TwPf7sX/51ZeXfcemqnp9w/W77/S7X/6T/vzf/7383RWCX3/z05/9i3/13/0PX//eX/2FyP8tIv+PiPy9iPy/IvIzEfm5iPxCRH4lIt/c/393//9BRD6KyKf7f488fP74/PH544dJAF9cLl98IZfLBZtuqterXr/7Dt9982v95S9+Lv+gF/3i7Spv/8lf/vnf/vGf/dF/JfKnIvLnIvLvReQ/NEngn0TklyLy6/v/34jIt00iGJOBlxAsdvv54/PH5493SQCXy9t2ueh2ueimKorrFbjq9eNH+fDtb+TXv/ol/vHyhX4Fxfbx7euPf/Lnf/PfiPyeiPyhiPxxkwB+fk8AvxzQgJcIrGTwFsiAEXH4/PH54/PHUgLY7whgu2C7bLqpQgHB2xvePn6SDx8+6G9+84384vKF/IPu8iVU9Y/+7C/+jWxffiHytYj8VER+X0T+oEEBvxqQwCMJeIngo5EI3goIwVMIPn98/vj8ESaAbbtu2ybbvl8u2ybbdtluSECA65u8ffqIDx8+6G++/VZ/efkV/sO261dQXP7wT/7kX8vl8qXIFyLylbySwe/dE0CLAr65B/9vGn0gQwRMMqgmhM/J4fPH548eAezbZd/lsm3YtssNAYiqiogAAkCvb5/k46cP8u2HD/rrb7+R/2/b9Wu9yJe//8d/9Ney6S5yEZFdRL68/38khG/uKOCnAwoYkcCoEXwkEgGDDq7CeQfyOTl8/vhd1QCum26ybZtu2yabbrKpQvXue1yvuF6v+vbpTT5+/CDffviAX1++1V9sO77WXb/66R/+4V/dgkbllQi+aBLBV/dE8LWRALwkYCWCNyMZXElkwLTMeMkga/P4/PH547ccAVwuctkvdxSw6bbdtYDbTfSZBN7e8PHTR/3u4wf55vKd/nL7DX6mu3791U9//5+/gkNFZGuSgZUQvnKowKgLWLTAQgRtEniTuEfwaELw0MJvf3LQzynud+53uG+X6y3gN9kul+2y6XVT1U27JCDAFVc8ksAn/e7jR/nN5YP+avtWfq6Xy9f7Vz/9w1dgRYngiyYhfNkkgzYBWHTg44AEMmqQUYQKOmDaiCIa8TmsfmzB+DnZDQjgcpGLbti2y3bZHjRAdRMVvb/dcYU8kcDbPQlsH/CrbddfbF98+RPZfvLFnAQeieCRDC5DMvju/vmD4JkEvjRQgKULeGggowdHkAHTYxihg89vu88I5UeGAPSOAFTlrgPopiqbKPSmCKreUoAAkCcSePukHz590m8vH+WbD9/JP335k6/+tA86KxFchv8jMvhiogE4JQm8XhfKqOAqx5qRPyeGzx8/cgSwbXcUoLJtim27C4Oi93+4v6VxQwKAvl2v+Hj9pB8+fZJvt4/yzfbF9lPdv/wJnsE2BogmyeCRED40tGFvksIXiSbgiYSRRpDNDZ6BDI6ghM+J4fPHeyKAO+zX7cb9t4tedMMNAQju5V+f1uAtBSiu1zsduMrHy5t8ePsk3376KN98sX/xE5FPAnm7/782o0DiUINXMkCXCB7/P94/e87AWUmARQWVvgMuKej9t1RLBp+Tw+ePgwngsutFFdu26WXbbl+rSvdfbnqAiuA23QcBgCugV1zl7e1NPm5v+LC96XfbJ/1W9y++fgXjA3bDYXV+MuhRwSPwL3JLMFYC+HS/LU8HYrGwIhwyNOF12SvgM4SgztdifP85MXz+KGsA2C6X7aJ6bXSAOwrY5OYIqGy3d5uq4P5GhABXuV6veLvRAf10fZMPb2/y3b7vX7+g+9v98/WOBq7GG7RNAlYy+Dgkhhb+Xxp0sE8IAC4SGAP/TbgVJK/PoJPBnAiwPKxsXfbbnRg+i3s/JAK4Q/4b9NfLtomBAqCickMBjy7BuywAUVyv8na94tMjCVzf9KNcLl/0SeA6oAEYb1i9g+FtSALb/bKL8/+t+wxXFMyswqiHoK4ToIgKqslgpg1qUC0QoYbvJZg/B/q5v4szHmPX7YEAsD0CX25OwEUVm9xag1+agKg+nxQArnKjAtDr9U0+Xd/k4/UqH7bL5YsewrcBBiMJZPRAp6TwQgWfjM9vgRbgUYGL8AvLWH2gqhesCokeUmCSwPsnhs8fP2YNYMO2XeSmAWxy2VQaXeDmDIhApf33rD4PTUCuV+DtCn27XuXT5ir8VmCJ2G5BpBM8/r/dEcJb8/0lEQMtJHA5TAlqNuLRhJChhEpSqFabH3di+G1AGj+W1/dyAR4IYJNNnuLf6+tWC9CHHiAtFhAIFLjK2/Uqn65X+SS67aK+3QeTDoy/IG2ogQ7fb/dAtz5vBgrYGqrwNtCHsVfgIvwK07OTQBURVNCBFpKCOjqCHn5L/67TgTN+fpySAC56nwSUi256kXsSuFGAVyLoUIDo8/Pz7fdoErr/v17lk162HbgHvFpIYDfoAJJfW4sGPjkU4VNAF8ZEcLmLhdc7kljdY1y1Dq9yLiI4IiRqcLujb138KIPn80ejATwRwIbtBvn1cqv+2J78/5EI5N4cJA8qIPcmwRsKAHDF9WYP6mV7VmrgLuTpxYTcMEW0LAmoQxFsuvAI8tv/a/C5fV2ZMMiKg++FCM7RDPRu8ebWY7VG6VJi+Bzk35MI2LsAckMAgwvQ0gC5DQjd3ABg2HQLAPpEAlZ1Bu7VV7MGHDFRAbo3VKsTbAY9sPWC/uvx86gBbDK3D1eEQS8pbAeSgSwmhepnJb6uBv/o/PzHLzxWA/X7TH77De5j6AGQi6o0CUGfCOD2X7cXAlCFQABtEsGLDtxuOyQB2UTQBKZe5GUPXgkUYCUAbZJRhBDeuq8xBf+bgwbehDm+BFQi2IJksOocvA8ysIMfxluVcRsY/eB3JzH8GFDAXQO48X/dcIf9jyDHptIigDsFkEe066tBSETQUYF7ElDdYEBytN4+rk9UcBPfrKaZqFHWcw3i4J8/X4ev2//bSXqAhwTay6OEIPLD2Ipt8OtAGzxkwLw9WVFRjTc/qC6H3+YK/b1oAA0KuOizHfieCLaHHiAb5NYTIC9EMEbZrVEQt1xwhVy1UfBh8PUOquMizwaap3tQXfY5B//tea/NZdfhsvbz+PURQTDSGWB87VX/7WSd4KxjUqrIgE0IUkoKGnhIvwvawpGf6eECXJ7tv4qbA7DJgwpsKthEmmYgfaAAffYF3HLxo0vwNjJ0SwRWMG4db4eh1gPNm18vQ+us/0eGmxDemu/fnM/X4evq/8342ksGHgLY5LyT/zg0wM8lcMjgGFXwqIOVFJBQw99eCvF9oZL9Mfl3QwAvIXDsBRC9R+fz8x0FPBLB0xJEpwUobrfAkARgIAF41h3wQgP6QAmX5E/7eI43IxGwwf/moIkRyWRJQIPgt9CA9b39nzt4bYUWjAlCjWDPgv8IEjgLJfzuaAsrv9VdVG4OwOXW/fdoA35qAdL0BDwvf6AAUVHd8LIEu94A3K+Q+2YxaB84MOH62P//qoo38fCRDERE2zf0JfmDa+MieElAjcDPKz+mRKCOtdgGtXaBjgNJ4H2owSpNeAW/rRH4CaHSpMwnBYYycjgSJwfie9CR6mPu20Uv8kABF206AvXlBMiIBPSlB9wjBW1fwEuSb94296VCqgMaGCt/G1BbExi3IG+r3a3J6P48Gv/J0YmEYoiGY7V/SxwFCwGoE/xa0AJ0CEiV9QPCJb1OJ5F1VTjEY2/MO9AEJvj1BJTQpqLfTlGwjABuzT962e4IoKnyrdh3+/6mzDVJ4PHOxj0JqGKoy20+wBMN6D1gLWi9NQHfVP5MEEPzjGYy8BMAOnTAJgEr8HUIejRo5xrA5xkR5AngmiSHs+zDDAmMgWzTg55GSJEmHE8IvWPAoYTfhWak/Wn/bQ0CGLSAjv83SUEfKp5q24LXuQICpzrjrgWoza8xVE00CQCORdhMJuTUT/rjuls0gO4Iby8BIEgK6gS7BsGuTtDrScH/fR68biUHNVGBnxjeNyHEvQe/ve3LZQqgG3rof6cEclsNflG9J4KtaQ8WHcVBHS1BtHE4QP9OBMS98mpbKTeDW7dJwRsnHpMBTFJpV4I+b0kY/NqInVFSyBLANbnMSgBM8F+Fqfxq/h657/Up+GaBnwV9hRqc9bZ/vA6vu+T9E8KPJWns94UfTeCj2QXwCHS9dNL8Xf3Ho/rfewSeFODGDV69AU0y6NFAE1DP3qK++rdB7/1HRxf86gT376zOr99T/h/ioBiXWQkgQgVeIrCC/WomhDmQK+hASI2ARQZKooHMLdCJwGEBBXC3+uERwg+VOHZ9ioAt9H80AI06wGgJ3nQA3BoCut6AhxYwgcPOFnxuFnrphk+NIKIGrWPQtgz3b0i7Y6D5rs1GKqTop0nQX52vmQC4BkjA+r4a7Kx9WLENGeegkhSETBCrNXIMdi/444Rw1n6E96ry7OPuj8UfLxtQ78NA2iSBbg7gIiIbdDLsb5agPhLC3RkYKv8NDbS2YGsatNRAG2oQwf9ZIOydgy1MAzBkAw8UwEEIDzSAqdPQ6za0PkeJAMH3Z0wXniUSZoHvBXU2mcjQgv56TedIKglCpIoQfgwCIjOytd8WgN0bfxoR8Fn9Gx0Aj5Zgq0lIZbsH/ibSJoFnS+C98g9ooHEELI3gliy25yONIiE6pb0NfBlyNEYyENoodkKwgl6I6s8kARgJ4ZoEfuYWHLEJa0LhSBXm7kImGeSfVdoJ1DO2G7WXsehAptupSOoyrCSF904k+6vt98X/ZcM98Hsd4JYIXhQAIg3/f9AAUYhsLQKAtkHVBnzjCKhOoYl2ym+iBtvzDzQ2DLXJ4PUmbJHAVnBQX4jkxfvHhNDqAdHXGQJgv0aSDGItgOseHIU+K9hXnIJzkoGlEKzNHagTdJ6VWEUH4iCKH4fd2AwDPaYBm4Wgng4gQ9V/CoGiuNmD04AQtNGMGzSAAQ2I2pzfogY9LRh7BrbOh4+D30sAencljFu2CUFrwY8UAWRfWwGvVOVfbx2uIILM0pwDv082dUTw8hYs8L+uIWiHGpWgClnAa1lMPJogovvvbePPs/q3Xr++kgCsfgB5oQF9WYKPJqEn6G+OE3i5AqouF59FQOmahQC8rlPLj38kg1c2f30vw+XaoIX24/pMGIgSBoZqoH3wo0sIIGlA9PWcCPrAtpPB8eBf6x1o6cHra+2+tpIFP4PgBfxZtZUJfo4qxELT948D9ucK8Mt9+ccjIQw6QJcEbrD/1g340ATuDgDkFfx6twSf1f9xvuBECYxq/7ythQQGm+5JDx6Brw4CkMGT3wgscCUoQ4sU2t6DR2ciBjTgtcpenQoZVX9NuL4Owc+dVaDursYVkVALX+shjSBKBuvCYDUZjE5BdNkxdHAUBexyHwB6NP7Iyw7sxUDViwge1t+mz8B/LAvVx/c3PeBBCToB8IUGOgqA3iV4yUg6UAOxaUFHDx6CYS8SorMOue0CCJGAf5YfRhoAI+A1CvwxqNkAY5yAIx2EQmkFfeWOXi+nEdSQQA0ZHMEItiagJArQxDXIrj8nCfQi4HZPAttrIahso9oPQ/2/JwV5JQU8zw+7I4D7/sBn4EO6rjw0FR+i3Z9fHtahzsFvJgM0X+tmVH5vaYiNDGAigewAz+gyNLThnjCURQFR1b9d3lZvnVqmj9mEPDKIUIC4KCCjBXywS4N+otp/Hk3QVthOkwEKlV9PQwXjT7s/zwF4Qf9toAAzFdjuaEB6S7D1//U5FIQu2MevO0rQQH8ZmoXE6B/IkgE60XCjVoq8gt2iCG0S8L5GdxkM1cGsfsCMArSCAnrr7dzAZxCEEpepvB8tqHJ/q+bmJGGts/AcAXFOMMeTwC7Pw0B6CtCtA2vWgonqBQJFSwH0JQK29OB2kvgj2HHXAoyeAIsCQO0kMNECAhFMqCBf8mElAkyBbX1tJQP2RJ/ha0gpAfS9l+/5n00CkrQpq0MZbOdAuxmMvHswog62jZj7BnYQe19b14kxNq2D/ehX/p68HEcF+x3yP7z/V/A/q/5DA3i5A/dzA5pdgbKp3v3/wQF4Bb70WkCTHGRAA6+KL0bFl6FJaFw0ImZwm6igSwbbwPn9RMBWf3sN2JgA/BVh/Rg0kQBgePf6HglAHLFQwqQQOwDjbdVxNZjR4iM6Qa3WxwvNxh0JFb3g/WzFQQS8b/ttKcDWoABtUMAd8j9hf0MB2uDXhzX4CHj03L9DBU3Qjz0C0l4mLSLQPicOOwZoVCB6P6dA7nDbGkVuxcNr8PU2JQO4wX5trEqmccZaHU4q8oCDFOpzAnOwqyMIMktNNNAHouDGxO37DgArQZzlmp/14W1QlqHTMaIIx7SCx0+5yza7AKJ3IXBrNAHVDcMZAU/BT/vgv/ULPOA+XiLggAREDF2g0ci6xNDRglegd7P7TWWH5oJfayliEg7bScQRBVgI4Ookg/F6rvpLWP29swREqA3CaG8/FpKqS8DTAV4TiBqIqtxfzaQRLys5I0XEFIFrPbZRQb+16Fgi2LvJv8EFUPW1gGfQv1T/F/d/HBnccP7rAwnIIyHI4ArgWeGbU4eHy6Tx/EeTZIb5bo/BsMBjmjBE08f/RB0PHYBd9eVRAGY7cHRwiBf8WeCPHY1bgBTa9xKTELzEkQX9CPtl0gJiqsAmCT7I8xbjivh3JGFI+D2nBcSJQJ8agDX+O9iBL7UfG4bzAkcaICrbtYHz1ycSmGmAjJfL3CMgT3tQpmrfB7gxSzC1DnvdhQMieG47u75+kTouKNkM8c/+vq/Q7ZYjO/hhVvRq8F/9gGfhP8aqE9EIdR6LTwJ1h0BItyDqB8iFwuNqASscRnYioxOg9ApvnYA35f8e9Ohbfe8J4rknoFkO0lmA2gmAG0YK0DkB4ieEjiLoMD8wBzom27ANZkzIoU8EMHk/uo1mzeVoEoRWKn8L/62EYAX/lsB7D/LXg74uAMr9oGivJ0CNJCGD6i9DhZdQF+gtOp4S+NODRzsDVbhdgv4BqTMNyIL9SCKwL9/FGPp5oQKxIf8A/UX6r231H7YIqLML0Ae2GtrADOvRQH5b/MPE9dt9BGLNG8jVTAQvIaK5TtvvvWQgDvyXIClUA78S9Nfg7VtIBlO7cbsEYkQDMot+ygQ7QwmOawTHnAM2XUSnJvPIYRYMmYPS+sv3J+cfP3d04JYIXsF/EwMbBKB9Q9AY+BiSwFj9mzrSXmcJhFPVHySTbgHJCPvRQ/z7G/SVUETsg0ZF+i3CRoCjhf7y1A9mOiDD7TwdwEoEXjLwAv+avLE2B7Jnb+OqDpBoAchoQJskxKnss0vu7Q2YhcDv4ySeLOg9GsCKiUIihP7yfW7zbTsBh0TQfN0iAWn9f72Z56/Ax9P7j5OAH/Qvv3/QxKfk0DgDuP+R3USg3bzBC7bO/QT9Eeh9QvDPG7glBQzJwK740lAFFgFk8P88CqDGAa223YckWYhr+c0BPdwetl2ocnsfzePAWcVnnAIp6gDVhDLyfV4nqFEDPxHsbWD3k4BDkN+pARqKMLYBPzYEvxp9xmCHQQdgWH/9EtH2TIFpu3AH/cdGydv1j0TQbRrq+D/mLcX3ZACZ15bF378CG0My6Kq/zoGOQwhASDFwFbxyNGBuSxbCEhQ/uEPe/6gAERWQObCVVfjPpQX+rexxYhYFxIkgpgX7Y/vPs+Pvxf9vwt8kAs7i32t3QCP+3SPaTwIytQXP38u0PESm+YER+o9B3vr8mETAUfDrEkPI80ck0FZ0dXh9U+HRbhey0cAc2H7A4y4egoD6y8JfkBiigLdFP8v2W00E8deT2IeAKujZ/QAVKpAtKI20gLWksHedfgPcb+0+NEHefd9vB9rayi8h7J91gBbaw20MsnWAF5xHkyDUCOoXp+yrOwwxcKj0aL6fFppaaKDv6OpHR5sgx5BAlK/+fYhuP1D196o8e7lFBaKqv5YIMnFQpd0FGVR35RJCnCDaABaXBtgbiSwtICMtalKC+1JQ6bx/PLcDPQL91QFodQNKpwOgF/9eqcBxBBqRcKAAVk+ArQOMx1RYGgB6naDhlK+uQQwJYx4meQbxtNnYQwMjt/d4f3M9ZE4UOld1LAh99fbfzOxiEkKFCkTJIUIMUeVnJ/9sDt8/e1NEJOi9oVHDGYhgnSLss9DX2IAqw1zALUncKcDr0FB5NP+0cBQNrEezDiyiADPkt9qGpwoPdL0AGPx/NOKeyf3b9WJNdfcFv6bKd2cLMJVfJ6Y3B6wB9WFUfWWEwKMfGiQL+3bz9XGQz2EHKhF41GCtZyDi/gUCsNhYoAr3UNJ58YidHKqnMb/6AB5J4N73/4L+t7mAkeeP3P+1LNSB/l0SkMEd8DcEuUlguEw6t2AU/PCE/q++Akw6QFf1u6SBrj1ZnnhG50AfkoGIdf7gJv1KcSfgzWWkQ9U33Z3tHXYASKJ9e/YhU90rvD+q9Ej69/wxYJVs506Eg/r3DkMDzEdDBRGgcZay49XihLA30P+l8N+hf1f57/0AoxbQbwYaan/rBMirE9Dk+sBzTkC8JNDEUlv5McB8PP19Y01Gayep+hC/2zvQ/2HGLAurowsNGlA1cnqGGzeH5weiYLZm7h3QQC4O2tXdhvMMk1ZS5ebpgI8eMrPvPGkwaxayk8Yc6PMOBPEdC1XZ+2UfbfOPtxLMQQAG9BcZFoF0gp/RKjxe7+oAw9T7ZPWhgedodgz0gf5KBtrtIZhQAZpAV1Bi36w6t98qVfH7hqGI318lLCjLCUFlxRHwqYEH9a2qb4XjWvDT7kBwfbZA5P0+PNuRuW1yf4yNQH3zzwv6b70QOJ0G9OT/dhoYRUGT15uQH/71MjQLtQlxfDuiCXrtM+SkA+icQdH6sU/xz7Ze7FlubV4TpoTQ2osdpaEjtqADmEU7OkBEFoLeC3IWFFeswJXKXzkboNL+wzcFHU8hTGKIboO7CLi1/P+5F+gydQhuvRbwEgxvtACmANikhLTbj0gCYk8KdlYgmj+4Ymaod7TwahwadICuX0Cm2fE5iNHPK0x/CDV66Kyg1MnqjNFBnhBoLQCgUULfaVe5nq/6EQWY67bXCszUb+7232fVPz51iGB12owK9peyP1T4raMFF/OEYJP792mgXYfZ04GHMAhBkCSmSj+dKqRPgVFGHbpLEGMiGFeQWfSgrY52VxaeDUPSNJI0P7NoisG729HHl78z6hxfs9rV3m4JjgM/lsui2qmThjCfDFSb+I9vwUqG5wwL55U7C+6ot8B+7N2o6r3q37T9trfpjgmTvv7PSQATLLeRAOZhIJHBQfDQQJPBdUwEbVW3+L08EcEE/9G4ANrCeWcnPKRHDupbNynMx5AA9IRYLmrc/YLSiD5EaEBS/s/TgnU9ILcH19n+CpHwegLejx7Mn/d25fdN+e9U/1vgb7bqf08MOtf8EXxaoh+GY8L6gDfhvs4i6HQ7seYI2sv1GchdMsBIG3xlvxcCRzdgCPTn+6q/TW00VE8Q9FaFv+R2VlOM1vm/hhjhDCdgNflVKME5B47I9xT8z0YgPAJ8myb/LqHy36j/Mwqw9AALxuO1JVjiuQAYLcFzIhiEPe05fk8tRjGw7yWQbsfuLAT2VqOId1osnr0F49VM8INACPHDoBz4B5mqqSnUgyh3ArjXxfQH5BbgUS8gP7aU+w0zHD9GGD0CGHf+P1p/DeivlhU4BbxR9a2kYFR58YaDZCUR2P0DMmgED2eg77puegy6PgDphEB0CwlG/i9d+/Hs34pBEQrBn0W51mqGnJAk3ACCHeiqkQ1XFQA5AlKH7Lk8yJKWY3/nym14h2C3JvxeMwD9ZVMz0BPMi1n1RbKl1cYhIVblF3G0ATsRiCMUvoK9//OgcwYMoe+ZKOLlC6/Xk50br9NFz9fanqA8UIYSpCwlBO4kHc4WLLBfBHVaKwKgLQjmP4Un61Vq+3s7Bsyi0WztmLjJwJwFeE0I2vD/1Q6MVwefxfUf32skCPbCnxQqf+QMPEUDHZ7vGeyj020JgkPXXwsldA7SYR1RE3h94NvNtugswcgxXEkIcBPCGZ1rmrgDC0A4K88nm2fn/eTnpQtWyZfybRoK8Dro4zYDIMGsf7saTBzvX0SMbkAD6o9CYbsfMK38cJKD9l2FJt9/VGs0h5Gib33pxMKWNsigFUh3G2un+/N1WUglI/EEx8fq27vUNnwsiOoKecL7kQS8VnWAGCFUgn6dBtQhv40CmIYggwK0uwDHRGAuBXVdfwzHUjZzATLMAoyJ4FmBhzaWBlrHld9CCWpPHRqofBqMReMGTJ78q9rDes1Tv7/0m0v0AFHXNR6P6g30SHivin7V1BOhh3iWPwvps/yE836L2XiwnUT8x2iHgfqhnwn667QHEE8oLQjEvtEW7GYBZDrDVkwNIO4G5GiBDf9fGoFM6n+vbEtzXwP6u9AduaWnGYSLAlVdl/AU+ikrSeEIKgwdaZ4AACAASURBVKj4/wtgHcHtdO2nWKcBkPfxcvnNQvsj2Me9f02r76T8q0IBn9OLKfz1HX8yVXQYGoAB/2UeBQ5/5kCL6+H/OGGoRnLSwdd3oH8r7KkGTbgIxEwVWvnF8KOpHnyzfF9Jod5Px+IF1h8owyitDw/XEgRb5bPqbt1uvn7qBIQ16vtS/u+DP3cR7CH0WWJgd5mTJKYgNzoGjQrfvu99NDBC+bnyW1x/qhTatv2OaMKgJWPvv5kwnMgxHYGFRtJW8VMl3uP+MgoqSZyWFKr7+KIDw1d6+IiOgZI4+d5iYL3imzbgyO+tph9t2oSBxOM3ugHtPoFZ1LM0hF4kXNEBssvVgPdjdXZWK7uKvyS3q1Xb1WQwtVDqSUggq+Vw3t56JA2cz7PXOwGNW1ecwxPhfe3QEUsDsFaAz8jg0nf+iZMAHNg/XSazDuC18Iq1HBRrOsAQ8NLB+16g614jmuSgs3bROxE55D+WDDQNA4ivdMJ9M1b309UqknaDU8ObV9/PwmMPATvTMAxpABLBzugUtV9bLdhNDQA+7B9tQJ06/7QNDHGSwtgZOCIA47InIoDdROQGtt0U1HI3GaoUnCnC/rzBMQJteN17+VaAzYNA7e+PFqHQUyXPUYB7iQYa5ZFjq1Zqpx8Uqu/XT7+6BWC1Xaj0GlBIwMoHu7UzcI/6/Acb8KIq+hzmGWmAYnADrIpvKP7TZeLaf0LAeQkGgebbq9FToI44p654F47tekKkI0L5PQNZPsDwPBpy/ni+wKMN76Vav4+2cFZFf8+JwAraMt0DFB7beA/u4Zz/a+RXx0M/ct4/jwaNAS8G17eSwmta0Fhx0VRxJkHMivso+onMXr+YwdWKbgioy1jp4x4AzIKg5lEA7wvHEYCRmdx11TAuT6lDLVl4KvXkAET9P4RT8H2u+lg9EPQIpw+/NpJ7RwE8HaDv/Mu4f3OdNkq/EfAiEiOANjEALvcWL9gfFV4NZbgbQc6qPky4Pm35QZxtH1f4j+P/jXuaYPcWwIEH/fmEPBoAO4m4LGxV3txOQqDU+dXgey+UwSzuqP++uImO/u/6ogCb7wTc1n61sL+vZi87rxnrNas+giTg6QLzaUCjIp6JfhwtGI7AjBBB9JjDY4ePYVR6ZPgN4owVv6Q2N5hhVHwNeYrM+w6dN6K1sMHZm/Ce7bHe3dzKr1xw1w4JrSQMZtgnoQHlr18fzunAszD4qurNUg/TDqzx/lfCaO6t4tACMUQ6P6htWjDPC1hCoZ8kpODzJ70MUR9AODcgwyqyPhmE+wfHYB/hvSqt6qeXUShhXH+d9SR8DzrDaZZdpSp/HxqLMQuATgDU/qDPRgOIeT8cvz/h/XC6BtE7ACLOWPE0KIS4UUjmZaJ2grBphiWgT41BUVWZfP3AnEIT6OrfoF122l2rMycBoU5i/OXoUZ4/aglsXwLzHNU++FVF3qikOj5HXm2PBitT1WuvJRAB+6O//W0/PY8vQH5IrAsMs/WuVmAdHBrQgrbOxJShXwRSsu08h8JMBpo0+aDTALwV4tbswgzHrftG/dJKIAQb5h9KCssWIMeto+GYqG12/HWGjx8kzqNJaa0noMWOr2KwW01AMwJoNvhMQda2/RKQP/3ecABM3g9uD6BY68Ntz9+nDOMb5iV+hIE+dP/Zs/wwJhJ9mgBnohBuStABUXjugF3hkXF9ZZJAjefKdHZCc389LoStKvIl7QIEb1d9RyciQgFDI9Cjyccc/23Aam7/PZJBhgDgin5CtQvbCzX8ip9YgIFtOAt+w0owp/hOiCWgEGbVHuYjRigPGR/YOnEoqPDoV5z5YqB3mRq2ox5ICmSSgAP1Ne+XV2NE+/vuFbCTRADxtS70VRBCjgBk2OyDUQiUgfl77b7DwaHm2rAZ7osRSOOUoHgKfNBSLI767+oDYrfwZvqChSpGfj3pFwZFsCJg2jeIQQBUiyI4WgD68ww4qO8khuWkkIuDrxWv2nv+UTBpJYiPd0KemTA8qqFiuUF1jWS3BoG6pADJq751JqBI0wvAVPyMQvjcX1zbELltKK+zBiXRFiRxG+b7q3M9xuLdzR8g0gCGNzSM5gNYfqGO9CBT8OHct6oB3KsSDBisUnwsFuISQaRHxDSv0vptt2oeLHMERfRn/FG/Cx01EpgIQG8LP+/i37PKw53xn6sYCM4/JwSRrCnIeB1ZkLsawDhaPKv/njU3wnZ/dBdGE8+YTHSG8+ofGgIjsC19YnwdM/KAnTSsqj6ig7uGgIPw3nYFzhhIIvriAxFP9CQd4HSlnzgxONIdrE7A8ZDPx9fjib8ifgegNIliRgdx95+E1T7+3nQVNNhEzDgGA3T2rEDLduwtPpuuouPcs8swwXFjdTaMKt+jA5gUAQPcf95KJQxYU0cYxEDvsBSmYuukp7AwnqniC9Afa5z8vboI68ImT0t26CvwBzSggkj447r9IojvCn7U92J/Hw0QSdwZKNNjxPCfSxRqnATkdwpOwh88oc4J8KTSm/wdbZjrc+4iFP8YO0/5JJDCfaijK5xVXevqfg6zGRrQf83chvX4aRfAE//6vv5+6490U4ADdO7QgM/5bcHP/n4OtCQhBEFeDWSvos8DPq8/IwzLzjpa8/U6MMSkBklDm8e0mn3QIY7XG1Om8wzN48y7HwhOK3P0/ZwUQHHv4psbdoVeb9VlAjChBCdtDDpOKTh9ZfcagOYq31RFjN4/gwBYzp8lAwYNwBELhZoxECeZxMlAzWGdCRV0fQWGHo8+8Kx+AAxnCIzowAxy9KvNepWfsfp4RR9kUrD88CPVTuXRybhqqTHcnxEGndsgub1Gdug8yz9fHt3Hpl57x/mfCOC29FOSQ7/noAZR5W3Ob24UMpuPYAYiQrQgk1gnFoUIKr4vKFpV15pHUJO3Y5rfH3UFHU4bGkU+NKJ9f2hJyOMxDBDpjAgwiYqvk5TqNl9EH2Arb6fA3yaA4cBtPWewhkEcIQJBlGzYp6zRmr1v+e3Fv27xpzvyI44NGDkCIi7CGNV9Dw0M8NtHC2vUwHINumCGNG8erxOwtQINsW88Tlwdoc+F85nI559ngEDpt2F/Uu3hiXYrkN/pBFS26hYDAkFgErMK67y9mGBA3L5ore5izf8b3n805MOq/t7XU4WHv1DUF/5gugCSOAIW/59uMwl6CHWAib8bvfxWl9/rBGEMTTwDfG+ezEYG4yk6FvRPuPwE+wvc39IRjENWM+/cm5b0W4Pf4WuKUnw/vD6eDbB1ETs5vl77Dhnm/51g6wPWwQAqxnivgQaeS3gy/u/1H4hpTPrIgHAN0mSgXUX13YP5PMIuQAfBr/f70cdeE+QoCX3i8nFMLcAjInBoAIYqt1LhC1WdtvmSab28AYffaeivCB+ohdYQgfUa/WS4ToMsNLHLc9nnvPZLwn1/EefPVf+U/xvnCVSEQEkEQEnEQJO7S7RvYDxNeNYKrG7DKMhtsQ8cMmhgPKKKj+F7CiHYFR5KIIPxOmg5IVAtu3ACQSPh7CzUQOgAej5CWEkIe3vgxz0ROGO//qYfz/dnLT+ZxDr4QW0eNCJBorCFOVC312Ec2TiY5Bk0cAaQmiA1VH1MOwDHQ0kHdEDDf+2UTWhS4Z8diQMicLx8MLBfverLcP/jQzF0P8EJj5+NGK9RCz755S6F/f1+X/gxeP+Wsedv+vF8/54aSPJYFjIQd624MDz/UDLQnr8HU3ztKHRf8Qeno1vyAQJBaLcMtTV3cvgP56COCqd/QP9xLgBkH4BxO13n4hNUDtACC6G1S3zqooZ6Ba4lp/zcAFb7iERKQwQcF39IFJjdXECGADw0IE4gg674pYAnk4HoHPx54tD5daO5vxrugSkMjgiiqc7TVKAT6AT8R4ckbHEQCYR/IZBxJgA+XZjsR7vaoRpIxWqeqfXuGC2CxwudicwePEB1kNkaZCuwyF0DuKv/4sz9mzP/Qxdg3BDkBTMC8Q+loD6UGBzx0Kz6eAX/KArOQTlPHFoI4vVtf4rNuLrca9edRn4xBP7k8w+9AgZCgBfEUZWfEs8iFNZ3UO7TqmkjCO/rWdgco/yIqHcQWaC2EGTzgz5y/iXQAvyx3riyxxV/JeBriaGB9OrTA5g9/eokM+37GszqfA/UZk9iW5UnCtBqBl3XoNN6Ag/+zy6A5evPAp+TIFDn15gQw9rjrOzFX0s2JBVAxa/nP1a6AsNWYGjPNGPLTQgBsNUFvOA3Ht9o/rGDN0tWOCcxJGp+f7++kkP7PxcGv1+GjkaLt/fawpwwerQxBJNW4b+PJsYEgiAYYdEAGIlDNaAbRkIgK3ut0jKByp+8yz23X6GttmBmjwDvChgiYLP5V/zhH6/110sGcKo5CkggCngxnIPoPja0j2B+1BRkiYJiviaLJqghDI63G2nAgAxMCuDdnoD0wIQm+urMB3VuAwbBrFGgGgnhAFqg9+ujKsLxB3qGCQNEEtPinIQlAj4WgIw7/iXc9V/x/yUWFs2KH504bAh4aYWf4TrTLGTy9YbftyLeVOWNfYNyt/ji29mQnqMAltU3ioTtbX343yv/1u0YPUBz6zB702tQucnX0gWaFh6DgPdmhXaapGotw0SFz1qDiTMdd8h45HfcqCPRUhA3+NmKz1l9teCPaMd4urGaewRitNBDdahR5c3AfQmDCFT9vmtQEwqAYXX4XI2n23Z9B/Yb1FL+LWox6wHGbZSo6FR1LzyG+3hriSZvWT6jfXhl2cmQZJDrAbuYAqAHo1GA/EOgD8eGcU7A8eDvH4fQBuAhBL/Zp/vamPTrRENDGLTV/7E1WEPLDlP/PwzU4YhusIMUgfIPAr6Dhv5R4y2r8ldFwiFoYHnmr8TAHbhRQSZOctH598ZYhqt6wP7q/ouqe77RJxvzFYaji/z4vna4v5cUMDXqDAJ5ytktqtBDckyjvJg04hl16LB0xFfyMfD77PZjErGQRRjYIfSvoAXntks0ok8MsUC4KARWnYPlJBeIgLeFrUgDOHYCag0/XNAbWgRwQuLAsaQwIhC1g7+jCNKuT38JfnYSyTi+QQEwwHeT4/dWHYxJPxfOj5oAnRQqgU3YgGZSOaDyK3n/qkDYBKptzR3oD6B4fyRKjp2AzSl80YR/3P+/1vBjX18Jbu+YsrMRgbqPP8zrDLTAaupphfeZtyPs9BPztpLSBZjowF3woYRwBwOWaqbev15b7X4RWsiqYiY6ZkFEIoUwUA2OrkeEQE8HYNyD/rl3m88jCGgO/nPW3xy8x4Q/HBcM1dYg5q8N+B/SBSYhtD0EY1PRGLDoKIBHF3yLz4H/gSYQJRETgqeB2d4vC8L2NVnQn4PoVJJAcP0inahAfdXVI8CFszjRagCTtRdV7Sr895NBpRKXIT64RMFw/iw5eChhEvmmyUIH+k+Qu3cLzOAN6ILlFvgWnx3YWFDz0f38ze9GlfP6UQ3ojEY0gtqRIEbA5/WgQFhsEuIeL75uTzvqHktAWfj/OD6sQXssROcGiRgFn0QVkld7OznMDT7CJKzhMIqxW9B+LCOQdH4uyxIcE49VTSeLj0wKjzcp2oDXQA8YoDEGBLMW0BJw+eAxXejPV/IXd59/tp5rVyYXDw5BlRetSpQAcvgfOwVM8ObzBq/AQ2wX4lwkQV3vNhYFfn2LFgaoDU1ogqsfqGkJYmrj9Tr22KQwBLzbLuzDeA9yzyJjVRfwegWq0H+FThDPA6ZhZwX2M2Kh4waovCzAWJTzD/qY00c+6PM8coz08VNqglzx54LfHuTJK7z2rwX35ABLg1DzsZ7Qv7l/f2yXDlbf4C/irg0MJ0aCuD0wP74MrxfdFlX7tq+vtRdCpvt599EG9Yz3V+P+Oj/n4zLruZHcJ7oMt/MNp9eD6HEeFb6/TMfbWo85Pb79HJo8t3371/PuIAZqMvjPC34nVV6ZB4hEuA7AzA5cfU0y2n6ux89D/35/n2/vWY5Bf0qwf3tPLISO1Tap9qzFB6eap/beqI94NCCbGwgqOItY3CGl446CaQ8i2Q9g0AvmgJOnBoAA0gu17tsKtKS7D4udgCYERy2QIceCX/P7mBW+g/7D9S6Mn50CS0eAoQPDcBjopIA5+EcxEjLweRjXq0UbLIjcBxsGx2IZvlf0ATjz/6qypAmY7bhrk4ahsIis6ccXKHdueAfUgk+RWPCLh42c6zEeKyJpRTdRAOqBbl/Wq/uT+q+Fx3FoTIuCzc6+hN8j4veGjuAnhSE5gKnco3A3XwYlq2sq+lmP4yEOpqEoG0M+mGDYuYT0pKCFHgLHKt3T7T9p8GcWH+n1UwGa8X6kQt2x4CeqPexegT6o/Z4Cr313PHdgrsS2ZReLfpKIf+IMFnmVmwxQ9AhithYT73+p2s+JIVfrjwiHnpAZrSsr9CMstQXP1+1+510N/q8E/YoekMN9OMFvi5LvkRDsy9rgFCOoPdpgaQIWBZjf5KCSQszZJ1ivTvLokpen6tsJAVND0NFqb6GUGg2Im4Dyx9Pn7/0dm4pADAslJzTv+dKNrAPQ0wyySm7bj1RQgbAXsRa4R+mBJzpaQmHLmy0BLoL+Nh2ZRca8uUc6P37k97n451fvTieAE8BdZ2ItqFEK6oOJIYPsiU4woo140Oh+H/UC++gatHYcOFT+2y3AYvD1rM/fpxdUcsAi70c0OxAEP45X/hymE9XeoC0zfYhbcqfbhs09HpwnKMDR6g0mmYyKth/UcLl9ITGQ8N1S6s+gA1HvQCc2pluPvN2Br8SyZyfyxPP/VhCi1L1HWX2CQCuAE8TIq/sBYdANZmTIwqq0sb0HIzhhugBeUpBZLFyA8y+EErsBUYDZHYN9QAAooQwOws+uQlhdESSSqk5Qsh8LSYI6LDS1AbmOvLlRBqQIeITvM36+TP63VfE5hFClCTr9zEyVFwS3STQBy66DMHB+PJWIrfgGnYBx2dTboPa2X49GaBVlePA7CFx4iaGi4ns0aLVjMGvtPTDtmO4XEE8E5Kb/8qYai+NHl60LgAICcUCoJPVeiYG6Pxw/X9VFNVbFn9FNPzXoIRDTyzcpREYB5Fm1EQQn3KRi9wKApR8Tz48SwxnV3qM0q7ZhpdKvr0zfY+gO4oQf+EGPFYW/Xf5hwWsUgxiBbShGoGIx+D2eH1h2EeR3UQMH4zMaUKr4033nzkSkfQADelFbLOQCalxdxvN8mInhPas9bxtGJw29Fx3Y8429MAS0fL33Oeo7qFZeiToCC3B/VSNYuU0fgDnkhxGgMFdxiYEY7MYel+OHPH30IMeVFK1C79l+QdXVpFqHlMAXEf3EYDyfkkGdNvJ8f3RAXU0jpgM7jMNA5yCrtfzOicKG/M9bgEkEjqqPPDEcDfqVwGZv6zcO9avDfOhf4OmLFd9OLBHHdxp51HvOBlnAoQksYjASA1xnIhPsapTCPjbsGB2YevpPpgM73EYeSYIftgPgte6CWesVBB9QEgfnWYMgoeC8ql69bWoRIqYHvSIv/u26bj/jdqZ9KSGk74JRo6QS9PuTiSHm6Z62kLUGH0UO4rwWrhtRETkR4iKRdI8giJ2D2nUCMjsA0TXiVDb98NAf/rCMlajA9wesWHZrAe1dlwRyVI2jx4KkyUHSx7YDe6YD4tOC6XW01puEdAJwaEJzf1uATHi6ZlSCpBQscsh6C1xRcWEG4bCFeKcAVhVlDu54JQIkTT21hptIT/Afk0kMcS9BKfjBJozcDXCrtgbWXxbMAw3INQIxtQJPAGwXmYaBbYh4SCsuKwLOAQ5awKskCMmRg8P3xwlBfbosQaDqyZqBkyQe1CLQACoTgN4qbyHsPwkTiF2pYaj6MAXBmUosQHnUEYCsBL3MW39SNKMJ5PfoBsT33DVJCEbFnBCMOkHfvj6Xq8uw+dgRIhGgAiUqf5QgKDFyhe8nnYrlqn9sG1GoAfirubygX4H+8IM1CmQrMFAJ5ExzKIp54nPoVU2Auh6eBShDlTV4u5c4HE/fVvjFrsII0Ik6QX+Iq68jB19ziLoKC27FYe0gC+j1RSS+BgB7AvAM3m8HLdy5fV60C8RMVuhD1ieQB32MCCq0QPJuvuw5IHF/geMKwOPdpmsxBwVEfGEOgeincJqNmuSFIPhPq/xM81CWIIi+gCFBqDX3QPYd2OcCRo6GZBoA3AM+00aesAOQ7/2Pe/vBCXoguD4OBD1WfPwClzcui12AuH+gC0gEwW72KfjBCQRBr05D0IQc7N8PzOCMehPWK384MPVDJQim7yDdoiRTItzzFV/ZOX9sYFetP0fsQzb6O7wOoFjxk89YoQXv+BmSN+yYHYO+BsDRAXHhuJXsEFbdIEGZQWUkNVNzGA9NZUVBIQL7jASR0AclE4Pb7JN3BO72mG92+o8UG3nybj+mASh0FsLKn9GPxDrEcS2Au35BzHO1BksriIJdpqWjKR1wlpR4fN977rZqI+XbYjYDgVDpcYQalOYKMiuQbB3G6Pu/HlMbi9a0EMkksXtjvvXTfgMKAEZRN/i/O7yD8Da2S2Bdh3ICWfp8yuMkYl5a4df4vVWt4UF0yyqEnaT6swYyWB8/j111Y1ERS9oB0SLMtBGDEBD1PEHwtdjUEAHnqmoHU4wCDAoAS+lHwtu9eQLUAgmxVvAuMB9cELMV3m8EUtcBYYI9nkNIEEJYrQeUHfnzzRyC39j8CgSkir/E0P2odnAmAqDnDIhqrtV9BDNS2POjv/0pwKr6z1h/PMz3uf9ykFYq9TtoAXSwpz0HljdvBCVAPY6t7osv6gFhMpkX13rcfXQMIpuTsfTibkfOPRAC2meLRipI4mDPwMD5x+v3+Ey+qEfACwoUEkKQSMZxYJDz9R68PyP43yvo2aYf881rNQbZgRU/jp80QnW/hdXqJxMvCFxXQSNHpE8QiF4XI+wFfQcw7VL2Md7RRajsKgh2D+6SLAKPF356+/7yXYBTUgFy/38StUjFHweD+iiHh8/LV/i/TSvGk4L5x7F6AsIKbgb4C0YjgdGRIToGUx7cgS3JKP8pRcgak95BJGQbjaJdBYQ1qHYnYHL8F45QgHx2gLMQ2cDxBD/4SeR0LSDi5XzPQNjM4ySE/HGG6g+ugltLNSARn281BPtNO72eJLjdX4ITSEgpQvJYFEUg24f1qAYQNQdxx6Q/RcB85j9f+03zf2QV33IDPHegNgPABTfqFR8cZK9TA7/ll0EQbUUHW8Gr1d+MSadia+LRHwhunv87yWoJ3h/pRDwJAbDNQQFd2P2mH4kP/wDT/ZeN3CK3+ZjvgVpw4r20AMafb58j4N1UMknuj6iCx883PU9g2VHVH5JX2eEcPghSgRBCKPzK0Q3fknwPN0Hk0CyC0zBkz//7duEetgFjVtypASDI4CsknYJgYDhqsBxxy29+eyxrAZX75EEf8f+CkOcijMDDHx4ASYGGu8WHgPwpHJc0qOG8FgFTuVk0cRZVePFwHEIUEu8xSHoL5qWg4I7/HgOKXe2dcnu2SSdCGIDTA+AcxY1zYL6Q6AAFu+/1GvjKPSeEoJV3NiM4Dz9C6oWkEav+NWjPWXNOIkKgNTi2I8LeBgaZHJxqrC4oNXoB9pzzMws/OW3ghSyQJgjbygOVEDhoj4nHLld8HPD6UUMFVLIgKrTL7cFoBRLQgEdXIseZ2/HhFPKbk4d5tYWwwR0nIFQSD2P5gQhs6meVfB+Bkyz2fOIvX/zxqsSODuAGIOLtPNnmIPCrv6Kqvgz3q4tCwNl9lWYfnsdHj2HTgQw5IBHwULmfSu1jEV3gDFSxTBmqSEVqiYK2IkWcRiAkwV/cyW9YhqHXDw9dkNQAcO6HFNJT7oChfrPUYc3KY17zAd+evAwF2w5SCKLV4EuCEKsKfjBVWHu9Q9Arh4CoBqEMWYBsNX7YgKP/69uC3M7/mOOz232QT+ox4iCyJGEFP4oBHd+GVvXBwX35nqp7qeIbV6L6tdZub3ueJ+gBIKgC6S5gOQFxDoGr+Bv2nzqbknd7ph/EmXzO0o+kZdc/wqvQkAOUffVMzKtYgx5Vob1/+HAfCdzHSiXHenX35/2JTr3KZ9Ruj2lYiMhLIFoNyMq9hFroeYMTE0bSLbhb4l3YlFPa6hMd2jk8dmrDgdQCnC4/+ANFlYTB6ATlx2GDGXP1rvL+SnWHw+cJes5/rRWt4H2pw9GklD4uSMpwasIQiaYR92gIyFX5S8dtRZt/nCAH48VXW3hRE/HKOsGquj8EM85Q9cfeAV4XwNGAlmIFIwPYrfLKuxV476RRetzcdeAsRSZhiHizCKEIOHn3EMOWy5X4uIJnXX6sFiBFLaBm/THOQAkVJK9j6TKwiSDTBWpwHkSPQJX7U959uAkoaTUuug6oQCBz1Zlxm0OJSIoIw04M+7zCGuYiznCfHww9AN6Ir+HXA7lfn2oBSJ2FOOh8SzINfmcAyITq8JX/sOMPx6A9LeYtVfwgCBZhdu25OB9/XmWWNPUEPD5dUuJ68wd1AqD2+w1PI9KxE9BW5t3z/igdYGWiL7L+wPv9jgVY8f0ZcbCKCuLAHN+c5wa69Zpr0J9t2KnpAGzyiAIPiFalJ8/xXrrA6Y+/8NoDnWCPNwFJzf5DpVkHte8hx76P+HU1+HEytEeSEIzAsu5r6wPJGu6oLz8VrKofXLce+ywIHhNa/Dmw8LrptWXZ4NKZm4pr/QQ7Qk8ehMrPtAF7PQCD309QgRgRZMKgAbFREAfBBXNalbHA9cEHMo4IgIUuPjjBWEUFEQpYTkhVO43eRiynJw9Jjj8TOUIlJExK+0wA4gWgQvcFBHAc7P4/u78/Ff4CC5ATB3P3oUwFClYgcALcxzp/B9Ez4DUV8RjBbsCBrMH4dLNwIDaCGhA6o3pXksdBvYBsktrXDgNJKAFy1Z+ZGIy5NXgXoBT8a3ZgVSPIUAMV6DjLxhsV8wX4n4ibbONObHNyCr8Z4FinNFjg8ziiF5zSV8A99u7Zdf5OisvVaAAAG3VJREFU/kIPAJLWX3hUIFD6o7MD4WkHIMXBk4IftSrPNBJVk0OoC7ice8HGS8XBKDoz/YFBLaQi392lGpCMJfhD9xVkx5Xbj73P9V4m1j0v73x9FjDDPlYvATkgFAVWcdNvJBamliOjAwRV0EpeRymAe717kMYRyy/j5FwFBX0fP7Dyx8gq8wn2ZXi8GfGYR+lFcGJSxa3Y84WgzBHetlU4cvKY44Ps4iP9fsgsPGEhQTAcHqwwGCj61SoPexKwasXFqtxq8qhD9SixoBBYcJEDNzmIoi3J7QkoJActVHocTVpPBCDhElAvMDK1PT/Sq3DwB/ygmyB9GNhYDH4so4Foy48kkPtZfZEv1PQTxYpyX0EI3Bu+/5krcN8fgwVdwWu2JNVNWAk+PcOOPMNdGFyAZ5Aj6gicgzNfwuHZg0HrLxBWfjSRl88fVCo/apX/IBrIvf65ZxtEoK9Bec4KZIPLe76osQns46NwW0pUPCPAyMc4A/KXOwZzFLGbAqD5xhhbgBcWfoJBAlarcCSQgdQJ+Movnih4gjZQTw51rz588y/ZgxVUEAQ8soCfX8OR26JwujCLGFAMsOjnwGrlPuQw9D/PPv8BYVR7pG/eeFtQpsLzR2KFI8SwKj9KlX++HeLOPuSBKrKeHBi7L4b+Kx184+ptAp4Trcscv69oARVYzWgaK01H1X0K3zNSmARKtxXYHvwJuT+8gLGGWgpHcWOmBeljFB2Ckg6wiAYOqfxEK3GMCAj6kIiTWdCBCXhkjUKMgJcLk271N9uLSbtvvK0S69OXAvoA5z94VsFubbmZvx4QAnXgBnJxENyQjy38wef81uPhxMpPJIQzr5ckuUTKe0wZyN57iFTWga8GvCwlh5UqvYgmaNV9XSxEVWs40kkosFwA70RgNOu8mLZfR6wDiwRa35y7j08NksqPQhcfkRBK/J8R75Iz+9C8gJpqzwiIeZII3QnYOkJWbVEI5jNuA+o2BwK82ifwnpSgHwaC+GNAdmW2VXfC+vPu6wR6lBj84C9WfvivZyUhZMJlJhjSukDlFJ3g4AvGJfC1iEpQJ/CaEd7G9wds7p71+odruKrHip/C7RdsxeVjzIxhoNkFGOW/+sk/YVAGtltfzZAIfzix8gcHhZCXpcGN2u69qWqD9OlRFAy7x2fQBhHUiETB+DocqvArYt98f+AEAXApsEmEcNLC0t2uPHCqPQIXwHYDfI4/9+8LMpchqr5HK39MJSrBXwnutNqjovjHFdq+fcHLp7YLR4mGgduW5hFpAXUoL4cTTuW5HJSkB5PC0S7A+8c+837DyoM1J9iv/po/o3BunlDqPjOSO/YbLFd+FGy9sxKFeT8b+nLNPrkAyD53FtT27yUS32yqUaEGTMBiASGcZ0FmK8nWxbvjC1q6WQC4VdWdAcBY8eFoAzIrC0b7Wt8wlPcIdE1FhUWeKU1Igv8Q/0dl4k/NnYSxdlDon8diUDeuQB4c8XVzcahRgyyZmNC+LAgeCfSVALde8/t1DCYawNoePGT83wlOpFUdOZKwxn89OsMEf0X8CxJCBN/dwKbFwkSMgx0ACJJDJD4iC1JEYh6XcEqVHpx4+J4I4UiAl26r5x64sttvSlAn3LBuQCz6edU8C+J5epBrC4YP52EFDgHrCw1B0eU9bOaTgh3wmYvQV3Oqqcf53XnVNXUBELX1xtSgFrirlII5d3HFulxBCNEfZx0h7K2f34XwdHpuYQcguN189Ow/nPXclaUcqMH5leCXjKOjbv3F0a7i2ZaRHmBe5zwnhA9S736ZC8AH8LHkg/T5znYgmES1dtuzGo92qwHIquiWX+4KgVLd8utv9Ml1BQNhEJW/FOgweiTguCUoQHkEwYhjfQIgm8eAzPKzHqAG5xGiiPyxeGRRaYetUpDVpHVC1T9bHGyaknb/TQTnuG7rDYwYCUT7/cMjtILzA+Go/FPw581F/mWeTkDuBsBCAK8ki+A29nMzPn4Rzjv6QV7xWW4fzQFUxb9jQQ1qc28kMi4mDl1NBr4usIsz5ltZqNm7AeJXfuTHd7nioLEyPBISU+8/tP1AC4Il/n+YGmjg2NiBRdl6yCw//zG5ph7bqaBuz8B4VMU/TqSsNPbwCeZA1cdxyG9SgKzRZPL+GXFOiH1/SFZ9wX8M3zUgvH8a4rMBjZj/h1W9MrwTiN6MlsCKiI4gycBzgV/xUaQGjGDHwHiYi0VIzeEAasCpNuL76AC7BIEl7i4AIxnAfoMxk35eJbZ68wWEUChs8IPz/EEE9BkUoNA4RCWSLJkY1h0Y/dG9bVCtUVPe7QRhtStXG4nOECDfUxc4Uw/Ik8JkA9o9+a83IrfHH11EdFUWc4phNgVFWkPsIHBnCvCCYBSgqEN9qtoXuwHhByYoJJA7BxIkkRwpDGgAHo+vQ3ZGOwCFJCJKUAx4MBpFZWvReeLgtBBkDDQu2OJxXa7SE/P4ZiUPHABjY1DsFIhPAaygWewiXK72hHjow/k8gCL6gKES8qcDZ7A+EhYlWCPGCX1wXIwzkQEKt8cP6iqkC0FEhFj/ZYtvXCtwuBLcDT5wXN+9H6ZEIkTwV/x/s78fXFX3siWHEKrC3tw7EFZ31Ll7ttknQyEMGgAqCaVe1bGk8r8nFWCQQR0h7CY0dsU/mIeIuA1AGCo02Q0YVXxub36sG1Qgfo0CBBUXxap+ECFEycQVyViBEBFPt14TK9rZHB9EwMG7DPXOv0OVHkdtx7OSCXfb3av4CFZGTwQBwT7/hKPHE4PzpJ4L4+FM9r1n8B+B+9R9I4Fu9brYUZgCunZWNxdQgIs8mASBQ4F8hJpEiaf4GPihk8FdAxin/kybjZjTj+mAQy6ihZ9whDvHAWB6BKrBXQr+5SBfqPaINwiz12UIwoTmbPACZY/fshBBBKNlW8ZCHwH/cVKSOZMm4Mxk4OwE9JeB+EFkn1IzcPQoiSB4vGgNeJSoik1A7m0TCmE/HrggB+/1M12C1Z18ACGoIeH1pH2IhAqFWgBq+kDFEWAvA3X8tpW0cnSD5WAOriOHhnYraF1eLTkS8P/QsHUBdtMPnOrMaANJE9AZiaKWII5Ue/8PTHn/UcCSTgIF2xN4zdmAQYIAKeBFl6FiO0aKfq5jcImHfPwTxcEdRmD3LcFoAva1Hdjm9UgGggI9YOoPkOBYLsT8HlG3nucMDGkOOJ8CkNOELdSO7D5qqAeJYBb2GpABgRi2gxLITgrOQ9C937HgB+0i7MeRx3gfPWCXLtgbLJAu/gCFBPzRX8eADJqCvA3FViC/BlOQC4LZyrBq8BdQAOUKoKjqR7v7EFfVFMojPgEoSlJesNIePyLHwW9NRgq7E6HvUN8A0yj0wyWDHRZ3J2A1jHdMyu3hCGwSDwdRir7h9VP7AKLgPoMCgKziOFLtrUm8aIFHlgxYfz8WBYUU55iAXauo+evJaIK/NTgRJM9sUcZRzcCnMdNKMJc7usnAyrpxHYkTRHK+n1HxS01LheAHqRWwKIDqLvQC0+PupHZgBawfVGsiniTVHwZHRqbUI/D4Cd+ftgyLAR1ehkIiqaKFw7MJEwUIuK5zsu4svoFYCFKgBJZACBuppOId2RDkPZas8H9kULcA9a0KTCQDGtpnzT+RMJiOGseHl4BQ1C29AWUXIIf/OIwwqoNEK3SCuA7FRiBrE9B4/PcrGJ1OQNj83F4Xbol/TgVHfMiIZLAdcaVkgh8sLrd+liNQH/FqsNTfj15m1J0X+ffZuq/gTY7QnvIfJz6UzBJLs83ItQpt3RfZz5iuGfNPajpngUm0R8DoA5jDlzsOTAwZjzsC3Jjxg7H914PjlcskGdghgx9HG4OOQH34uwQyzz61/0qiYNQjXxECuWYbGM/DrjtPH/Mw/K+gBLLSA+cEfPr4MroArzcDuybbr8Zc72i2UnzeHnTgzD4Ug78SzIvCoARVOQxaFFR3TzWnkkHUVFShEuqKxZnKz4p4YYcf8ZhYhuu8wFgSHcuuwCJagI4bgchJQK/qe9c/RT6nGcg6KGREJpb+MI0EY/b0jcsni3AJBeCQNsBOFVYoApcM2Aom4VFgIRdHpeIG8D3YaxBD+qCiQ+rBOSVnci8hzkAG1t/pgHA4uwDzmu8xFKkkkIqCfkIRs204r/hiDgutoAAcowBMZ9+KS0CcXVBOHCvJw2jMQSJyeoeExF2DuTuRcuWAo9sefyUQ6/oBaIjPtiRH1KvQKvygAHb171d+vc4GRMDPoxN/kL5pwlVh1mBQ1quQJAJ5j0TgOAis+h8d3mnC8xTKE34+8sDNjyVXE6nFMN+H39TQDmocHScENvN74LoGScGU4f7g6IG3n3C3qnG6JBS+Z5tHOOzRYQx+u7MZmAl0OSsRLAS/VIKfRAWU92+12aaVPksGDBWQuCMvgNy2M2Mt8EwqbjosZAec5xLEAmXmcFTHiOWARWglpNpjdEtBQRxJJU5VL5/7F1X86XntXgUK4q+KggsUoIIK8oA+kgy4+zLaACqQGTVOX6MBWdehL6BxHn+tlyBMDGAqufd7WOX5WTJwKYDfXJJP2GXDPk7Tj5Ed7BOG7DMFaBRAJgI/+H2Ngeb2SKb0zkoGlQBHkefDr7xMA5HZeJPtKIzyApI9gmnPgf1c3mulfhe0gFekDCdNFnrOwi4Gs6eTACNjB+Uegcgojog4V25P8bctRYY6RL8AJklE9ACFAGZdBEahd4d4CmghFhbzcwaXYH5qTlS6DY+KfNH5Avzjo2JJ0poDkSCMxLn73H/eB+ifvgvyIFCWAji7BWC8hd0qj0FziMdrS70BlVbgamIgcmotGZDNPwm0L9l5iHv7WRoAFx57ScFS2r2iwot8oKu8l+TOCOg2mZ2nFdjTgOFQENzKkJ8OjEnsE8f6AzyXwT6MNF3RDRnuj0Lwo6wTlBMDIyqaz6G+RiLJMg/KUrQV/rh9uH0tWduwoxmky0kSMQ+rnXxZsGadgnxfgk1pCnsIsGYltvfdzTOBIclIsN8MLAGcz5gBwj94AE8DuC9Molip/JGwB57nRyJiyD3pyk6q5ij+3TzRLohcqyqCEQBTepF15+WVmW8SEr5jMUUkx3oMIsrH3ndwAQganKzyMpOJNxMQooGBYwcByw7axIhgPRGEr6GSGJhkAELoQ1YRg+dPeD5IIRDIqq5PA2Jh0Rq0YcS8XBi0ghGRFpCtWTdum5+yLOsQf2EuYY8AfnbQZDgCjHxBSKwTGpt8QCIDVH3/4H5OwEvldhliINwAFLsEyyIfGKV+vm3eEehVqKTdNxtDiPoLHCRiuwTJxCECxMDqDjTvZ63KaPKvRgV2i/F3ohm88V8LN8hgJcXD5pVGIPPNn9EBqSQC0I4AMxBUcQNCkarkFgSn/oCs9GCVep4eUG5BRAOcQOCWlGSc3If0IFqRfURQGRrKewPKEJ9sLnIowKCcw+f48N6UHjqYtgInaCCkBbPSj8VEkCr2g8U43wY1xX/BNkwreQrzg+oaJghOCGTU8RBxuIp6VFOGoEXgEsBLIgV6gBgxoLSI5CgiYNT+GBHsU01GthrceiMUtv9KgAYktgVNeGrBbtiOQVi9x8WjiAW7UNUnm4Vet7WtsFgDCDYEwQ/EVL1PnQf/xCDLTowTh4c4HPRDoQaiwhKIAae4B7xgCBydI/CDPOrevK0FR4p6w3VfoXgQiB3T1N8Y1PCD0X19JqcHGfzB5WkQE4p/kdeXBcEVUXEIFqSij82lMyrWq/7c+LFHA7z5/dwOHHg8s/Y8C2CmhbmALtare+4UWLfb25BmXABKABTniC8gRAP2yvDAiUAsElnrxFzITQa/sAFecAOY7zPV/8jMQHSbWAiUPGkQNABhw85xrSCv+mMSzFR8+7mjw01A8f4F8S/td4jnDHYxpT8/OEyV3gz2+GTfdAeAszswfJNGlQhEIjB0Bls0BKn4Iw7WKu9f1gmSagmvqleEwJwnZwjO7npz1HdCJ1hS/mlBcRXyF3i/M7NxqJFoeH27z7nnJaBmpUZKHsTbGUc1ALEoIGsGYl9ixS50gjAT/VhB8IzvGTrBVfWEz1MzAkRFTtecW731VdjNQPukVdhdn0Y8d/a7WYH6i/TBPBzUFwAlHwtGHOQISrgb1AMUgDETTA3+THAdeRJhg59V/Ektofa9I8wxVICkC7QQSAd2O3cftzPzdMK6aA4iZI4ILfYRbb9RgqICt2AxVnYZ4kkBvHOBxT/zN9ybHx/f5Ql2fkGCX6ANm6F8WCfqAS+Eq5AGcHJd2IFHagTMHAAj+mWBnDXuc81CjhsAi5dL2K8QCYI1aJ/PJtSSxEFXASv7C2I3ZB9/a0j/7nDn/j1pHsz9Jr8fNpxPBUAUUYD4wz5GBlmyAiORjtAIGDFwzSUwqiNZ1d1tPiB7/Q9VeI9KeJU16/knkEeQJEALjY4rkp74fCZiMDSA/PgvT/aT2gYgp5E/P29AKBQAo6TRth5T4VesQFb0i4K7RA2MZpgyFXCEQHCOixuYMPgy2L7+45ezSSKt2oUkURlpXkEMOLSiXPuDQZjk63N5bmzOSxQdLHX7AhwUEA0BAeQPJIQzkAuFlOK/GtyLdiGDKEBdllQ7YouxV2Xdwza9So4Kp5Z0yAgUhTlJgFzSFrznIHYIwKcCu2/L3LsCg6UI1b1/CA+ApIV5/32HqOIjdQusE4azip5Wc1b0q/QGIAlaWEJbXP3r/L+AEipw/+BtkQVY9fIM2i/ZhgVEgJO6DZ1ksVtlYdoQAPhVO0oKmYBmnAYco4DRCRB3TwCziptaE0auER9/VzRqKNOEYINOQg2m1l9GpGNQAhh1v6UmxNQh2M4+LmlUzll0OTjYQOaGlZAEMCrdhmBphaMBwBADrSQQc3//He8KgFETT7p6BHnjj2X9EXsDjrgBS6ihoAmcSQVYmE4JgYWFpp1waAQRoqDzxDhU+HxSnZHz/9JEY6Y5MJA+cwoWrt99+U3Mc/9g/NQTFaigAEtwB1yBzwzucZSX7RZEILhR1d5GDCsBLVUdIQvsldZfEJt5i/MHx2hGJZFkVVyK242iFeh58oBUFqIQbkfp2DV2X0CkAYgv1sU+P+I/HmBu8nErugdRnUWhfp+A/ddlbEH3uQlBsNobUEMHasK1HOYn8BEEvCUaiuigXRIKj+sGOPA4KAWz9/s7WxcgB4+a6/fI2osEwv4yOENAiPf+wQhbc/5f0gGisWuQaRFmGoIqguARWsBQgTTocDLMT5OJUQnhqdCEig+/EShKSEgTVV0MBMnz04BcshPnLk/+OaV0/dwKzB4QUt1NB6uTDfGOP+cNm9mEsBAFiM7AQh9AKVEU75vy68jeOxrUC4mDEuYO0oLqoSdHaEF2eXYYSm0V+oEOwpLmYFOF3Z4CmAeBTIGueiIw2xoKPzDBJVBXQ5g5O8/twwA+QguIjJt3+g0NQEcDfUXgO5gsqlTBLkQLdl86K3CWneitQ8sg/5oWAUJP2C3V3RoEyji5n4b9lB4t9pz2CA+cAFn1Z9I/uzYsU/ELtEBOCHYQQqGcFejV+yeuRJX31zsKV5IGjway9z6PLDxKwNEPsBuOEiqw57jGgOtZ1Y++T50AuMFl7hPIbhskiOwsATtRoc7rS7dXrpcgrMCGJca6ELJo+Y0be0BW5ZKGcFz4y8W9BduwcDnK9iO5fagsKpp9ANnvDPxeP8THNyIVFo1AMas8Qk5v2Ytm0LCCYAXqn+wQsPTBh/5Bcnne14Os3uCQt28vsK1WUESJFviBgAW//3u9PLxusXchcCR2WsNzv/ImvgZzzkUByDUAIrjTvmSHAowpJBQE4SUlxMxnARlQbIqkArVAJ6pBBvELCCKlkyCDAP45BYfEPfcUpfMch3Vn4bheYK4E66BxAxHSVd5INgEPgU/NBCDfNQ8Ho1CoINAPQAW/QT8OCIZlNFCB84XhoDChFByHGjx35v9BLgyhmojqHYb5QYXnuAecvua0hZe6BV9f7v4ibvgvamrmAc1TmaEir0LQ9h97eYAYVoM/nWA60i8Q3Ifezha9BqaaL3zvqd6IAuwwLSCCuCLuJWch4h30giPtyiAphKEBcCu9BV5wwzkMxID8rhMwdwMhcSFgrBT3RUTQboAUg3+p+Qe1IGarOioVnazmefV3lHpwA0AcLWCahUiXwePHWJsP+GH1gnp/we5KfOhJAbsj0H/BIEb04TbrTPsAyb2LLu93KwfCvn5PLAwrOXAa72eEQRo1CNdw5IprsAZ3hApy9zlcITG2vpCihsRSYxNS+J4vdBZ6B52eqRcQ/QXmSjAWSfa/5GA5qEg4iJFtm624AqXLrSA2gx8p1Mdqcghv41S0lSp/xAYs9gakQc4Ie2RTUYwYgt748mV+FU1Xgp14eW3XYZ6cdqGTNHwHICTwEeTPl0jEZwIgP9gDEaogeg5IHWCF+1eoAhvEKPB/EAeTRsM/pSAP5wjWEUMM1/NJRhwJbpJSgK7S7zF3EOsI5jBQBK9DV80Z8Y0COzvmWzJXgDl40KEC6cqvqgi4OB5cpgLFYK/1CvDiItXqC6/S87wfAUfPtxqfGNzlYaOjlf1IsHPPvffHgDAoEeEST4ZLZUd/RSo91/BjXY5ggWgQ4In3fyj4mUqPrInHOCLKO3wUwRsfyXpt1nEIRLrqcWeTuk7bigsbid1zD4iDRQtnIdQsyIXnFCn1I9D7ADgxEhOvR5AJosoUbu1FkJyYCi9OhQERoIx+4AX/YqUXQhtYEwKN4Cy1HntLMmtaAQpqfrT/UCoLSxeswjA5UWPPi0mjajUWxMTdVusNvt/ChMdmILK5IRMFu90BMEzFYHdg2GAgeYVHMMJIBTA7EFTx/5fpgTFXz9w/en0ZjD8kCDoKPNGwlB01BmoWQbh+AxR689mBponGJOr9OwmMu3dtJ/ylW1Tik4ElUPmR9RqII+pVhD9ychABMQ51gOIZg+/G+5mGIzLB1JJC5WhzYjhJ7IWmLDpA8jzsAafUPkB2WnFBF4iSxkq1ty7f25rv/+EQLOxs2oUdTSA9HIR9swdBlCcFe9owPC3XWDDC0ISVzsEVbSCF/sWdA5Fu4HJqankp2SeQCYYrImNalfmhpVxYrGkUS4LeSUjg8dD7+D7w/ybIfy7vlB9/HJ978zr7/45Qgajzj+4EjIK/ULHPRAOlKr/aG0AFcqCyu0GcW45Igh6JMJmhA49/U+cEssHNJhtXDC1MOya3j/sAiAGcrEtqtgjBD6wEzSDc7D8o6C8rIqAZyPk+NQoNLAZ1hR64Yl1FBY648smUYKnSg1Xwk/0DyRyArByMUobyByhCcPnOaPyoegREFS4jNfYAw+IHCjdC1J2WDZBke/OyN85J24WiXwDYPoJyYuCD238ulvuzwt6KgHf0shWKsqCFFGjB/w8HU8eeTED9wAAAAABJRU5ErkJggg==","EnvironmentBRDFTexture"+k++,D,!0,!1,Q.e.BILINEAR_SAMPLINGMODE);D._blockEntityCollection=W;const O=D.getEngine().getLoadedTexturesCache(),E=O.indexOf(M.getInternalTexture());-1!==E&&O.splice(E,1),M.isRGBD=!0,M.wrapU=Q.e.CLAMP_ADDRESSMODE,M.wrapV=Q.e.CLAMP_ADDRESSMODE,D.environmentBRDFTexture=M,D.useDelayedTextureLoading=j,C.c.ExpandRGBDTexture(M);const f=D.getEngine().onContextRestoredObservable.add((()=>{M.isRGBD=!0;const j=D.onBeforeRenderObservable.add((()=>{M.isReady()&&(D.onBeforeRenderObservable.remove(j),C.c.ExpandRGBDTexture(M))}))}));D.Qd.add((()=>{D.getEngine().onContextRestoredObservable.remove(f)}))}return D.environmentBRDFTexture}},12002:(D,j,W)=>{"use strict";function Q(D,j,W){try{const Q=D.next();Q.done?j(Q):Q.value?Q.value.then((()=>{Q.value=void 0,j(Q)}),W):j(Q)}catch(Q){W(Q)}}function C(){let D,j=arguments.length>0&&void 0!==arguments[0]?arguments[0]:25;return(W,C,k)=>{const M=performance.now();void 0===D||M-D>j?(D=M,setTimeout((()=>{Q(W,C,k)}),0)):Q(W,C,k)}}function k(D,j,W,Q,C){const k=()=>{let M;const O=D=>{D.done?W(D.value):void 0===M?M=!0:k()};do{M=void 0,C&&C.aborted?Q(new Error("Aborted")):j(D,O,Q),void 0===M&&(M=!1)}while(M)};k()}function M(D,j){let W;return k(D,Q,(D=>W=D),(D=>{throw D}),j),W}function O(D,j,W){return new Promise(((Q,C)=>{k(D,j,Q,C,W)}))}function E(D,j){return function(){return M(D(...arguments),j)}}W.d(j,{c:()=>C,e:()=>E,f:()=>O,g:()=>M})},10959:(D,j,W)=>{"use strict";W.d(j,{e:()=>C});class Q{constructor(D){this._pendingActions=new Array,this._workerInfos=D.map((D=>({workerPromise:Promise.resolve(D),idle:!0})))}dispose(){for(const D of this._workerInfos)D.workerPromise.then((D=>{D.terminate()}));this._workerInfos.length=0,this._pendingActions.length=0}push(D){this._executeOnIdleWorker(D)||this._pendingActions.push(D)}_executeOnIdleWorker(D){for(const j of this._workerInfos)if(j.idle)return this._execute(j,D),!0;return!1}_execute(D,j){D.idle=!1,D.workerPromise.then((W=>{j(W,(()=>{const j=this._pendingActions.shift();j?this._execute(D,j):D.idle=!0}))}))}}class C extends Q{constructor(D,j){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:C.DefaultOptions;super([]),this._maxWorkers=D,this._createWorkerAsync=j,this._options=W}push(D){if(!this._executeOnIdleWorker(D))if(this._workerInfos.length<this._maxWorkers){const j={workerPromise:this._createWorkerAsync(),idle:!1};this._workerInfos.push(j),this._execute(j,D)}else this._pendingActions.push(D)}_execute(D,j){D.timeoutId&&(clearTimeout(D.timeoutId),delete D.timeoutId),super._execute(D,((W,Q)=>{j(W,(()=>{Q(),D.idle&&(D.timeoutId=setTimeout((()=>{D.workerPromise.then((D=>{D.terminate()}));const j=this._workerInfos.indexOf(D);-1!==j&&this._workerInfos.splice(j,1)}),this._options.idleTimeElapsedBeforeRelease))}))}))}}C.DefaultOptions={idleTimeElapsedBeforeRelease:1e3}},12150:(D,j,W)=>{"use strict";W.d(j,{d:()=>UD});var Q=W(966),C=W(1389);class k extends C.d{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var M=W(1163),O=(W(1479),W(981));class E{get noiseTexture(){return this._noiseTexture}set noiseTexture(D){this._noiseTexture!==D&&(this._noiseTexture=D,this._reset())}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(D){this._isAnimationSheetEnabled!=D&&(this._isAnimationSheetEnabled=D,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(D){this._useLogarithmicDepth=D&&this.va().getEngine().getCaps().fragmentDepthSupported}va(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:Q.j.Zero()}set direction1(D){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=D)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:Q.j.Zero()}set direction2(D){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=D)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:Q.j.Zero()}set minEmitBox(D){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=D)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:Q.j.Zero()}set maxEmitBox(D){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=D)}get billboardMode(){return this._billboardMode}set billboardMode(D){this._billboardMode!==D&&(this._billboardMode=D,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(D){this._isBillboardBased!==D&&(this._isBillboardBased=D,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(D){this._attachImageProcessingConfiguration(D)}_attachImageProcessingConfiguration(D){D!==this._imageProcessingConfiguration&&(!D&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=D)}_reset(){}_removeGradientAndTexture(D,j,W){if(!j)return this;let Q=0;for(const C of j){if(C.gradient===D){j.splice(Q,1);break}Q++}return W&&W.dispose(),this}constructor(D){this.animations=[],this.renderingGroupId=0,this.k=Q.j.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this.targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new Q.j(10,10,10),this.onAnimationEnd=null,this.blendMode=E.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new Q.f(0,0),this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.Eg=new Q.j(0,0,0),this._useLogarithmicDepth=!1,this.gravity=Q.j.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new M.h(1,1,1,1),this.color2=new M.h(1,1,1,1),this.colorDead=new M.h(0,0,0,1),this.textureMask=new M.h(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new k,this.id=D,this.name=D}createPointEmitter(D,j){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new Q.j(0,1,0),arguments.length>2&&void 0!==arguments[2]||new Q.j(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new Q.j(0,1,0),arguments.length>4&&void 0!==arguments[4]||new Q.j(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new Q.j(0,1,0),arguments.length>3&&void 0!==arguments[3]||new Q.j(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(D,j,W,Q){throw new Error("Method not implemented.")}}E.BLENDMODE_ONEONE=0,E.BLENDMODE_STANDARD=1,E.BLENDMODE_ADD=2,E.BLENDMODE_MULTIPLY=3,E.BLENDMODE_MULTIPLYADD=4,(0,O.c)("BABYLON.BaseParticleSystem",E);var f=W(1e3),F=W(1209);class Z{constructor(){this.direction1=new Q.j(0,1,0),this.direction2=new Q.j(0,1,0),this.minEmitBox=new Q.j(-.5,-.5,-.5),this.maxEmitBox=new Q.j(.5,.5,.5)}startDirectionFunction(D,j,W,C){const k=(0,f.v)(this.direction1.x,this.direction2.x),M=(0,f.v)(this.direction1.y,this.direction2.y),O=(0,f.v)(this.direction1.z,this.direction2.z);if(C)return j.x=k,j.y=M,void(j.z=O);Q.j.TransformNormalFromFloatsToRef(k,M,O,D,j)}startPositionFunction(D,j,W,C){const k=(0,f.v)(this.minEmitBox.x,this.maxEmitBox.x),M=(0,f.v)(this.minEmitBox.y,this.maxEmitBox.y),O=(0,f.v)(this.minEmitBox.z,this.maxEmitBox.z);if(C)return j.x=k,j.y=M,void(j.z=O);Q.j.TransformCoordinatesFromFloatsToRef(k,M,O,D,j)}clone(){const D=new Z;return F.b.DeepCopy(this,D),D}applyToShader(D){D.setVector3("direction1",this.direction1),D.setVector3("direction2",this.direction2),D.setVector3("minEmitBox",this.minEmitBox),D.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(D){D.addUniform("direction1",3),D.addUniform("direction2",3),D.addUniform("minEmitBox",3),D.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const D={};return D.type=this.getClassName(),D.direction1=this.direction1.Gd(),D.direction2=this.direction2.Gd(),D.minEmitBox=this.minEmitBox.Gd(),D.maxEmitBox=this.maxEmitBox.Gd(),D}parse(D){Q.j.FromArrayToRef(D.direction1,0,this.direction1),Q.j.FromArrayToRef(D.direction2,0,this.direction2),Q.j.FromArrayToRef(D.minEmitBox,0,this.minEmitBox),Q.j.FromArrayToRef(D.maxEmitBox,0,this.maxEmitBox)}}class P{get i(){return this._radius}set i(D){this._radius=D,this._buildHeight()}get angle(){return this._angle}set angle(D){this._angle=D,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=W,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=j,this.i=D}startDirectionFunction(D,j,W,C){C?Q.e.Kd[0].p(W.Hg).normalize():W.position.subtractToRef(D.getTranslation(),Q.e.Kd[0]).normalize();const k=(0,f.v)(0,this.directionRandomizer),M=(0,f.v)(0,this.directionRandomizer),O=(0,f.v)(0,this.directionRandomizer);j.x=Q.e.Kd[0].x+k,j.y=Q.e.Kd[0].y+M,j.z=Q.e.Kd[0].z+O,j.normalize()}startPositionFunction(D,j,W,C){const k=(0,f.v)(0,2*Math.PI);let M;this.emitFromSpawnPointOnly?M=1e-4:(M=(0,f.v)(0,this.heightRange),M=1-M*M);let O=this._radius-(0,f.v)(0,this._radius*this.radiusRange);O*=M;const E=O*Math.sin(k),F=O*Math.cos(k),Z=M*this._height;if(C)return j.x=E,j.y=Z,void(j.z=F);Q.j.TransformCoordinatesFromFloatsToRef(E,Z,F,D,j)}clone(){const D=new P(this._radius,this._angle,this.directionRandomizer);return F.b.DeepCopy(this,D),D}applyToShader(D){D.setFloat2("i",this._radius,this.radiusRange),D.setFloat("coneAngle",this._angle),D.setFloat2("height",this._height,this.heightRange),D.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(D){D.addUniform("i",2),D.addUniform("coneAngle",1),D.addUniform("height",2),D.addUniform("directionRandomizer",1)}getEffectDefines(){let D="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(D+="\n#define CONEEMITTERSPAWNPOINT"),D}getClassName(){return"ConeParticleEmitter"}serialize(){const D={};return D.type=this.getClassName(),D.i=this._radius,D.angle=this._angle,D.directionRandomizer=this.directionRandomizer,D.radiusRange=this.radiusRange,D.heightRange=this.heightRange,D.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,D}parse(D){this.i=D.i,this.angle=D.angle,this.directionRandomizer=D.directionRandomizer,this.radiusRange=void 0!==D.radiusRange?D.radiusRange:1,this.heightRange=void 0!==D.radiusRange?D.heightRange:1,this.emitFromSpawnPointOnly=void 0!==D.emitFromSpawnPointOnly&&D.emitFromSpawnPointOnly}}class X extends P{constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Q.j(0,1,0),C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Q.j(0,1,0);super(D,j),this.direction1=W,this.direction2=C}startDirectionFunction(D,j){const W=(0,f.v)(this.direction1.x,this.direction2.x),C=(0,f.v)(this.direction1.y,this.direction2.y),k=(0,f.v)(this.direction1.z,this.direction2.z);Q.j.TransformNormalFromFloatsToRef(W,C,k,D,j)}clone(){const D=new X(this.i,this.angle,this.direction1,this.direction2);return F.b.DeepCopy(this,D),D}applyToShader(D){D.setFloat("i",this.i),D.setFloat("radiusRange",this.radiusRange),D.setVector3("direction1",this.direction1),D.setVector3("direction2",this.direction2)}buildUniformLayout(D){D.addUniform("i",1),D.addUniform("radiusRange",1),D.addUniform("direction1",3),D.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const D=super.serialize();return D.direction1=this.direction1.Gd(),D.direction2=this.direction2.Gd(),D}parse(D){super.parse(D),this.direction1.p(D.direction1),this.direction2.p(D.direction2)}}class x{constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.i=D,this.height=j,this.radiusRange=W,this.directionRandomizer=C,this._tempVector=Q.j.Zero()}startDirectionFunction(D,j,W,C,k){W.position.subtractToRef(D.getTranslation(),this._tempVector),this._tempVector.normalize(),Q.j.TransformNormalToRef(this._tempVector,k,this._tempVector);const M=(0,f.v)(-this.directionRandomizer/2,this.directionRandomizer/2);let O=Math.atan2(this._tempVector.x,this._tempVector.z);O+=(0,f.v)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=M,this._tempVector.x=Math.sin(O),this._tempVector.z=Math.cos(O),this._tempVector.normalize(),C?j.p(this._tempVector):Q.j.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,D,j)}startPositionFunction(D,j,W,C){const k=(0,f.v)(-this.height/2,this.height/2),M=(0,f.v)(0,2*Math.PI),O=(0,f.v)((1-this.radiusRange)*(1-this.radiusRange),1),E=Math.sqrt(O)*this.i,F=E*Math.cos(M),Z=E*Math.sin(M);C?j.Id(F,k,Z):Q.j.TransformCoordinatesFromFloatsToRef(F,k,Z,D,j)}clone(){const D=new x(this.i,this.directionRandomizer);return F.b.DeepCopy(this,D),D}applyToShader(D){D.setFloat("i",this.i),D.setFloat("height",this.height),D.setFloat("radiusRange",this.radiusRange),D.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(D){D.addUniform("i",1),D.addUniform("height",1),D.addUniform("radiusRange",1),D.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const D={};return D.type=this.getClassName(),D.i=this.i,D.height=this.height,D.radiusRange=this.radiusRange,D.directionRandomizer=this.directionRandomizer,D}parse(D){this.i=D.i,this.height=D.height,this.radiusRange=D.radiusRange,this.directionRandomizer=D.directionRandomizer}}class R extends x{constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Q.j(0,1,0),k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Q.j(0,1,0);super(D,j,W),this.direction1=C,this.direction2=k}startDirectionFunction(D,j,W,C){const k=(0,f.v)(this.direction1.x,this.direction2.x),M=(0,f.v)(this.direction1.y,this.direction2.y),O=(0,f.v)(this.direction1.z,this.direction2.z);C?j.Id(k,M,O):Q.j.TransformNormalFromFloatsToRef(k,M,O,D,j)}clone(){const D=new R(this.i,this.height,this.radiusRange,this.direction1,this.direction2);return F.b.DeepCopy(this,D),D}applyToShader(D){D.setFloat("i",this.i),D.setFloat("height",this.height),D.setFloat("radiusRange",this.radiusRange),D.setVector3("direction1",this.direction1),D.setVector3("direction2",this.direction2)}buildUniformLayout(D){D.addUniform("i",1),D.addUniform("height",1),D.addUniform("radiusRange",1),D.addUniform("direction1",3),D.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const D=super.serialize();return D.direction1=this.direction1.Gd(),D.direction2=this.direction2.Gd(),D}parse(D){super.parse(D),Q.j.FromArrayToRef(D.direction1,0,this.direction1),Q.j.FromArrayToRef(D.direction2,0,this.direction2)}}class V{constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.i=D,this.radiusRange=j,this.directionRandomizer=W}startDirectionFunction(D,j,W,C){const k=W.position.Qc(D.getTranslation()).normalize(),M=(0,f.v)(0,this.directionRandomizer),O=(0,f.v)(0,this.directionRandomizer),E=(0,f.v)(0,this.directionRandomizer);k.x+=M,k.y+=O,k.z+=E,k.normalize(),C?j.p(k):Q.j.TransformNormalFromFloatsToRef(k.x,k.y,k.z,D,j)}startPositionFunction(D,j,W,C){const k=this.i-(0,f.v)(0,this.i*this.radiusRange),M=(0,f.v)(0,1),O=(0,f.v)(0,2*Math.PI),E=Math.acos(2*M-1),F=k*Math.cos(O)*Math.sin(E),Z=k*Math.cos(E),P=k*Math.sin(O)*Math.sin(E);C?j.Id(F,Math.abs(Z),P):Q.j.TransformCoordinatesFromFloatsToRef(F,Math.abs(Z),P,D,j)}clone(){const D=new V(this.i,this.directionRandomizer);return F.b.DeepCopy(this,D),D}applyToShader(D){D.setFloat("i",this.i),D.setFloat("radiusRange",this.radiusRange),D.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(D){D.addUniform("i",1),D.addUniform("radiusRange",1),D.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const D={};return D.type=this.getClassName(),D.i=this.i,D.radiusRange=this.radiusRange,D.directionRandomizer=this.directionRandomizer,D}parse(D){this.i=D.i,this.radiusRange=D.radiusRange,this.directionRandomizer=D.directionRandomizer}}class U{constructor(){this.direction1=new Q.j(0,1,0),this.direction2=new Q.j(0,1,0)}startDirectionFunction(D,j,W,C){const k=(0,f.v)(this.direction1.x,this.direction2.x),M=(0,f.v)(this.direction1.y,this.direction2.y),O=(0,f.v)(this.direction1.z,this.direction2.z);C?j.Id(k,M,O):Q.j.TransformNormalFromFloatsToRef(k,M,O,D,j)}startPositionFunction(D,j,W,C){C?j.Id(0,0,0):Q.j.TransformCoordinatesFromFloatsToRef(0,0,0,D,j)}clone(){const D=new U;return F.b.DeepCopy(this,D),D}applyToShader(D){D.setVector3("direction1",this.direction1),D.setVector3("direction2",this.direction2)}buildUniformLayout(D){D.addUniform("direction1",3),D.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const D={};return D.type=this.getClassName(),D.direction1=this.direction1.Gd(),D.direction2=this.direction2.Gd(),D}parse(D){Q.j.FromArrayToRef(D.direction1,0,this.direction1),Q.j.FromArrayToRef(D.direction2,0,this.direction2)}}class g{constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.i=D,this.radiusRange=j,this.directionRandomizer=W}startDirectionFunction(D,j,W,C){const k=W.position.Qc(D.getTranslation()).normalize(),M=(0,f.v)(0,this.directionRandomizer),O=(0,f.v)(0,this.directionRandomizer),E=(0,f.v)(0,this.directionRandomizer);k.x+=M,k.y+=O,k.z+=E,k.normalize(),C?j.p(k):Q.j.TransformNormalFromFloatsToRef(k.x,k.y,k.z,D,j)}startPositionFunction(D,j,W,C){const k=this.i-(0,f.v)(0,this.i*this.radiusRange),M=(0,f.v)(0,1),O=(0,f.v)(0,2*Math.PI),E=Math.acos(2*M-1),F=k*Math.cos(O)*Math.sin(E),Z=k*Math.cos(E),P=k*Math.sin(O)*Math.sin(E);C?j.Id(F,Z,P):Q.j.TransformCoordinatesFromFloatsToRef(F,Z,P,D,j)}clone(){const D=new g(this.i,this.directionRandomizer);return F.b.DeepCopy(this,D),D}applyToShader(D){D.setFloat("i",this.i),D.setFloat("radiusRange",this.radiusRange),D.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(D){D.addUniform("i",1),D.addUniform("radiusRange",1),D.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const D={};return D.type=this.getClassName(),D.i=this.i,D.radiusRange=this.radiusRange,D.directionRandomizer=this.directionRandomizer,D}parse(D){this.i=D.i,this.radiusRange=D.radiusRange,this.directionRandomizer=D.directionRandomizer}}class N extends g{constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Q.j(0,1,0),W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Q.j(0,1,0);super(D),this.direction1=j,this.direction2=W}startDirectionFunction(D,j){const W=(0,f.v)(this.direction1.x,this.direction2.x),C=(0,f.v)(this.direction1.y,this.direction2.y),k=(0,f.v)(this.direction1.z,this.direction2.z);Q.j.TransformNormalFromFloatsToRef(W,C,k,D,j)}clone(){const D=new N(this.i,this.direction1,this.direction2);return F.b.DeepCopy(this,D),D}applyToShader(D){D.setFloat("i",this.i),D.setFloat("radiusRange",this.radiusRange),D.setVector3("direction1",this.direction1),D.setVector3("direction2",this.direction2)}buildUniformLayout(D){D.addUniform("i",1),D.addUniform("radiusRange",1),D.addUniform("direction1",3),D.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const D=super.serialize();return D.direction1=this.direction1.Gd(),D.direction2=this.direction2.Gd(),D}parse(D){super.parse(D),this.direction1.p(D.direction1),this.direction2.p(D.direction2)}}class G{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{}}startDirectionFunction(D,j,W,C){const k=Q.e.Kd[0];if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,W,k);const D=Q.e.Kd[1];k.subtractToRef(W.position,D),D.scaleToRef(1/W.lifeTime,k)}else k.set(0,0,0);C?j.p(k):Q.j.TransformNormalToRef(k,D,j)}startPositionFunction(D,j,W,C){const k=Q.e.Kd[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,W,k):k.set(0,0,0),C?j.p(k):Q.j.TransformCoordinatesToRef(k,D,j)}clone(){const D=new G;return F.b.DeepCopy(this,D),D}applyToShader(D){}buildUniformLayout(D){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const D={};return D.type=this.getClassName(),D.particlePositionGenerator=this.particlePositionGenerator,D.particleDestinationGenerator=this.particleDestinationGenerator,D}parse(D){D.particlePositionGenerator&&(this.particlePositionGenerator=D.particlePositionGenerator),D.particleDestinationGenerator&&(this.particleDestinationGenerator=D.particleDestinationGenerator)}}var K=W(1256);class L{get mesh(){return this.Ue}set mesh(D){this.Ue!==D&&(this.Ue=D,D?(this._indices=D.Me(),this._positions=D.getVerticesData(K.f.PositionKind),this._normals=D.getVerticesData(K.f.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=Q.j.Zero(),this.Ue=null,this.direction1=new Q.j(0,1,0),this.direction2=new Q.j(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=D}startDirectionFunction(D,j,W,C){if(this.useMeshNormalsForDirection&&this._normals)return void Q.j.TransformNormalToRef(this._storedNormal,D,j);const k=(0,f.v)(this.direction1.x,this.direction2.x),M=(0,f.v)(this.direction1.y,this.direction2.y),O=(0,f.v)(this.direction1.z,this.direction2.z);C?j.Id(k,M,O):Q.j.TransformNormalFromFloatsToRef(k,M,O,D,j)}startPositionFunction(D,j,W,C){if(!this._indices||!this._positions)return;const k=3*Math.random()*(this._indices.length/3)|0,M=Math.random(),O=Math.random()*(1-M),E=1-M-O,f=this._indices[k],F=this._indices[k+1],Z=this._indices[k+2],P=Q.e.Kd[0],X=Q.e.Kd[1],x=Q.e.Kd[2],R=Q.e.Kd[3];Q.j.FromArrayToRef(this._positions,3*f,P),Q.j.FromArrayToRef(this._positions,3*F,X),Q.j.FromArrayToRef(this._positions,3*Z,x),R.x=M*P.x+O*X.x+E*x.x,R.y=M*P.y+O*X.y+E*x.y,R.z=M*P.z+O*X.z+E*x.z,C?j.Id(R.x,R.y,R.z):Q.j.TransformCoordinatesFromFloatsToRef(R.x,R.y,R.z,D,j),this.useMeshNormalsForDirection&&this._normals&&(Q.j.FromArrayToRef(this._normals,3*f,P),Q.j.FromArrayToRef(this._normals,3*F,X),Q.j.FromArrayToRef(this._normals,3*Z,x),this._storedNormal.x=M*P.x+O*X.x+E*x.x,this._storedNormal.y=M*P.y+O*X.y+E*x.y,this._storedNormal.z=M*P.z+O*X.z+E*x.z)}clone(){const D=new L(this.mesh);return F.b.DeepCopy(this,D),D}applyToShader(D){D.setVector3("direction1",this.direction1),D.setVector3("direction2",this.direction2)}buildUniformLayout(D){D.addUniform("direction1",3),D.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var D;const j={};return j.type=this.getClassName(),j.direction1=this.direction1.Gd(),j.direction2=this.direction2.Gd(),j.meshId=null===(D=this.mesh)||void 0===D?void 0:D.id,j.useMeshNormalsForDirection=this.useMeshNormalsForDirection,j}parse(D,j){Q.j.FromArrayToRef(D.direction1,0,this.direction1),Q.j.FromArrayToRef(D.direction2,0,this.direction2),D.meshId&&j&&(this.mesh=j.getLastMeshById(D.meshId)),this.useMeshNormalsForDirection=D.useMeshNormalsForDirection}}var e=W(1103);class s{_isUbo(D){return void 0!==D.addUniform}constructor(D){this._isUbo(D)?(this.setMatrix3x3=D.updateMatrix3x3.bind(D),this.setMatrix2x2=D.updateMatrix2x2.bind(D),this.setFloat=D.updateFloat.bind(D),this.setFloat2=D.updateFloat2.bind(D),this.setFloat3=D.updateFloat3.bind(D),this.setFloat4=D.updateFloat4.bind(D),this.setFloatArray=D.updateFloatArray.bind(D),this.setArray=D.updateArray.bind(D),this.setIntArray=D.updateIntArray.bind(D),this.setMatrix=D.de.bind(D),this.setMatrices=D.updateMatrices.bind(D),this.setVector3=D.updateVector3.bind(D),this.setVector4=D.updateVector4.bind(D),this.setColor3=D.updateColor3.bind(D),this.setColor4=D.updateColor4.bind(D),this.setDirectColor4=D.updateDirectColor4.bind(D),this.setInt=D.updateInt.bind(D),this.setInt2=D.updateInt2.bind(D),this.setInt3=D.updateInt3.bind(D),this.setInt4=D.updateInt4.bind(D)):(this.setMatrix3x3=D.setMatrix3x3.bind(D),this.setMatrix2x2=D.setMatrix2x2.bind(D),this.setFloat=D.setFloat.bind(D),this.setFloat2=D.setFloat2.bind(D),this.setFloat3=D.setFloat3.bind(D),this.setFloat4=D.setFloat4.bind(D),this.setFloatArray=D.setFloatArray.bind(D),this.setArray=D.setArray.bind(D),this.setIntArray=D.setIntArray.bind(D),this.setMatrix=D.setMatrix.bind(D),this.setMatrices=D.setMatrices.bind(D),this.setVector3=D.setVector3.bind(D),this.setVector4=D.setVector4.bind(D),this.setColor3=D.setColor3.bind(D),this.setColor4=D.setColor4.bind(D),this.setDirectColor4=D.setDirectColor4.bind(D),this.setInt=D.setInt.bind(D),this.setInt2=D.setInt2.bind(D),this.setInt3=D.setInt3.bind(D),this.setInt4=D.setInt4.bind(D))}}var b=W(1108);const Y="gpuUpdateParticlesPixelShader",t="#version 300 es\nvoid main() {discard;}\n";b.e.ShadersStore[Y]=t;const c="gpuUpdateParticlesVertexShader",l="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";b.e.ShadersStore[c]=l;(0,O.c)("BABYLON.WebGL2ParticleSystem",class{constructor(D,j){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=D,this._engine=j,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","i","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var D;return(null===(D=this._updateEffect)||void 0===D?void 0:D.isReady())??!1}createUpdateBuffer(D){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof G&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=D,this._updateEffect=new e.b("gpuUpdateParticles",this._updateEffectOptions,this._engine),new s(this._updateEffect)}createVertexBuffers(D,j){this._updateVAO.push(this._createUpdateVAO(D)),this._renderVAO.push(this._engine.recordVertexArrayObject(j,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=j}createParticleBuffer(D){return D}bindDrawBuffers(D,j,W){W?this._engine.bindBuffers(this._renderVertexBuffers,W,j):this._engine.bindVertexArrayObject(this._renderVAO[D],null)}preUpdateParticleBuffer(){const D=this._engine;if(this._engine.enableEffect(this._updateEffect),!D.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(D,j,W){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[D],null);const Q=this._engine;Q.bindTransformFeedbackBuffer(j.getBuffer()),Q.setRasterizerState(!1),Q.beginTransformFeedback(!0),Q.drawArraysType(3,0,W),Q.endTransformFeedback(),Q.setRasterizerState(!0),Q.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let D=0;D<this._updateVAO.length;D++)this._engine.releaseVertexArrayObject(this._updateVAO[D]);this._updateVAO.length=0;for(let D=0;D<this._renderVAO.length;D++)this._engine.releaseVertexArrayObject(this._renderVAO[D]);this._renderVAO.length=0}_createUpdateVAO(D){const j={};j.position=D.createVertexBuffer("position",0,3);let W=3;j.age=D.createVertexBuffer("age",W,1),W+=1,j.size=D.createVertexBuffer("size",W,3),W+=3,j.life=D.createVertexBuffer("life",W,1),W+=1,j.seed=D.createVertexBuffer("seed",W,4),W+=4,j.direction=D.createVertexBuffer("direction",W,3),W+=3,this._parent.particleEmitterType instanceof G&&(j.initialPosition=D.createVertexBuffer("initialPosition",W,3),W+=3),this._parent._colorGradientsTexture||(j.color=D.createVertexBuffer("color",W,4),W+=4),this._parent._isBillboardBased||(j.initialDirection=D.createVertexBuffer("initialDirection",W,3),W+=3),this._parent.noiseTexture&&(j.noiseCoordinates1=D.createVertexBuffer("noiseCoordinates1",W,3),W+=3,j.noiseCoordinates2=D.createVertexBuffer("noiseCoordinates2",W,3),W+=3),this._parent._angularSpeedGradientsTexture?(j.angle=D.createVertexBuffer("angle",W,1),W+=1):(j.angle=D.createVertexBuffer("angle",W,2),W+=2),this._parent._isAnimationSheetEnabled&&(j.cellIndex=D.createVertexBuffer("cellIndex",W,1),W+=1,this._parent.spriteRandomStartCell&&(j.cellStartOffset=D.createVertexBuffer("cellStartOffset",W,1),W+=1));const Q=this._engine.recordVertexArrayObject(j,null,this._updateEffect);return this._engine.bindArrayBuffer(null),Q}});class I{constructor(D,j){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,Q=arguments.length>3?arguments[3]:void 0;this._engine=D,this._label=Q,this._engine._storageBuffers.push(this),this._create(j,W)}_create(D,j){this._bufferSize=D,this._creationFlags=j,this._buffer=this._engine.createStorageBuffer(D,j,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(D,j,W){this._buffer&&this._engine.updateStorageBuffer(this._buffer,D,j,W)}read(D,j,W,Q){return this._engine.readFromStorageBuffer(this._buffer,D,j,W,Q)}dispose(){const D=this._engine._storageBuffers,j=D.indexOf(this);-1!==j&&(D[j]=D[D.length-1],D.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var y=W(942),m=W(948),a=W(1151),S=W(936),H=W(1330),z=W(1083),i=W(1134),p=W(1316);class T{constructor(){this._gpuTimeInFrameId=-1,this.counter=new p.b}_addDuration(D,j){D<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==D?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(j,!1),this._gpuTimeInFrameId=D):this.counter.addCount(j,!1))}}class A{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(D,j,W){let Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=D,this._engine=j,this.uniqueId=H.d.UniqueId,j.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new T),this._engine.getCaps().supportComputeShaders?Q.bindingsMapping?(this._context=j.createComputeContext(),this._shaderPath=W,this._options={bindingsMapping:{},defines:[],...Q}):z.b.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):z.b.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(D,j){let W=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const Q=this._bindings[D];this._bindings[D]={type:W?0:4,object:j,indexInGroupEntries:null===Q||void 0===Q?void 0:Q.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!Q||Q.object!==j||Q.type!==this._bindings[D].type)}setStorageTexture(D,j){const W=this._bindings[D];this._contextIsDirty||(this._contextIsDirty=!W||W.object!==j),this._bindings[D]={type:1,object:j,indexInGroupEntries:null===W||void 0===W?void 0:W.indexInGroupEntries}}setExternalTexture(D,j){const W=this._bindings[D];this._contextIsDirty||(this._contextIsDirty=!W||W.object!==j),this._bindings[D]={type:6,object:j,indexInGroupEntries:null===W||void 0===W?void 0:W.indexInGroupEntries}}setVideoTexture(D,j){return!!j.externalTexture&&(this.setExternalTexture(D,j.externalTexture),!0)}setUniformBuffer(D,j){const W=this._bindings[D];this._contextIsDirty||(this._contextIsDirty=!W||W.object!==j),this._bindings[D]={type:A._BufferIsDataBuffer(j)?7:2,object:j,indexInGroupEntries:null===W||void 0===W?void 0:W.indexInGroupEntries}}setStorageBuffer(D,j){const W=this._bindings[D];this._contextIsDirty||(this._contextIsDirty=!W||W.object!==j),this._bindings[D]={type:A._BufferIsDataBuffer(j)?7:3,object:j,indexInGroupEntries:null===W||void 0===W?void 0:W.indexInGroupEntries}}setTextureSampler(D,j){const W=this._bindings[D];this._contextIsDirty||(this._contextIsDirty=!W||!j.compareSampler(W.object)),this._bindings[D]={type:5,object:j,indexInGroupEntries:null===W||void 0===W?void 0:W.indexInGroupEntries}}isReady(){let D=this._effect;for(const C in this._bindings){const D=this._bindings[C],j=D.type,W=D.object;switch(j){case 0:case 4:case 1:if(!W.isReady())return!1;break;case 6:if(!W.isReady())return!1;break}}const j=[],W=this._shaderPath;if(this._options.defines)for(let C=0;C<this._options.defines.length;C++)j.push(this._options.defines[C]);const Q=j.join("\n");return this._cachedDefines!==Q&&(this._cachedDefines=Q,D=this._engine.createComputeEffect(W,{defines:Q,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=D),!!D.isReady()}dispatch(D,j,W){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,D,j,W,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const W=A._BufferIsDataBuffer(D)?D:D.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,W,j,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const j in this._bindings){const W=this._bindings[j];if(!this._options.bindingsMapping[j])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+j+"'");switch(W.type){case 0:{const Q=this._samplers[j],C=W.object;var D;if(!Q||!C._texture||!Q.compareSampler(C._texture))this._samplers[j]=(new i.b).setParameters(C.wrapU,C.wrapV,C.wrapR,C.anisotropicFilteringLevel,C._texture.samplingMode,null===(D=C._texture)||void 0===D?void 0:D._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const D=W.object;D.getBuffer()!==W.buffer&&(W.buffer=D.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}dispatchWhenReady(D,j,W){let Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return new Promise((C=>{const k=()=>{this.dispatch(D,j,W)?C():setTimeout(k,Q)};k()}))}serialize(){const D=a.d.Serialize(this);D.options=this._options,D.shaderPath=this._shaderPath,D.Lj={},D.textures={};for(const j in this._bindings){const W=this._bindings[j],Q=W.object;switch(W.type){case 0:case 4:case 1:{const C=Q.serialize();C&&(D.textures[j]=C,D.Lj[j]={type:W.type});break}}}return D}static Parse(D,j,W){const Q=a.d.Parse((()=>new A(D.name,j.getEngine(),D.shaderPath,D.options)),D,j,W);for(const C in D.textures){const k=D.Lj[C],M=S.e.Parse(D.textures[C],j,W);0===k.type?Q.setTexture(C,M):4===k.type?Q.setTexture(C,M,!1):Q.setStorageTexture(C,M)}return Q}static _BufferIsDataBuffer(D){return void 0!==D.underlyingResource}}(0,y.b)([(0,m.O)()],A.prototype,"name",void 0),(0,y.b)([(0,m.O)()],A.prototype,"fastMode",void 0),(0,O.c)("BABYLON.ComputeShader",A);var w=W(1239);const n="gpuUpdateParticlesComputeShader",u="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";b.e.ShadersStoreWGSL[n]=u;(0,O.c)("BABYLON.ComputeShaderParticleSystem",class{constructor(D,j){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=D,this._engine=j}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var D;return(null===(D=this._updateComputeShader)||void 0===D?void 0:D.isReady())??!1}createUpdateBuffer(D){var j;const W={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(W.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(W.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(W.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(W.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(W.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(W.noiseTexture={group:1,binding:11}),this._updateComputeShader=new A("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:W,defines:D.split("\n")}),null===(j=this._simParamsComputeShader)||void 0===j||j.dispose(),this._simParamsComputeShader=new w.e(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new s(this._simParamsComputeShader)}createVertexBuffers(D,j){this._renderVertexBuffers.push(j)}createParticleBuffer(D){const j=new I(this._engine,4*D.length,11,"ComputeShaderParticleSystemBuffer");return j.update(D),this._bufferComputeShader.push(j),j.getBuffer()}bindDrawBuffers(D,j,W){this._engine.bindBuffers(this._renderVertexBuffers[D],W,j)}preUpdateParticleBuffer(){}updateParticleBuffer(D,j,W){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[D]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^D]),this._updateComputeShader.dispatch(Math.ceil(W/64))}releaseBuffers(){var D;for(let j=0;j<this._bufferComputeShader.length;++j)this._bufferComputeShader[j].dispose();this._bufferComputeShader.length=0,null===(D=this._simParamsComputeShader)||void 0===D||D.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class q{constructor(D,j,W){this.gradient=D,this.color1=j,this.color2=W}getColorToRef(D){this.color2?M.h.LerpToRef(this.color1,this.color2,Math.random(),D):D.p(this.color1)}}class o{constructor(D,j){this.gradient=D,this.color=j}}class J{constructor(D,j,W){this.gradient=D,this.factor1=j,this.factor2=W}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class h{static GetCurrentGradient(D,j,W){if(j[0].gradient>D)return void W(j[0],j[0],1);for(let C=0;C<j.length-1;C++){const Q=j[C],k=j[C+1];if(D>=Q.gradient&&D<=k.gradient){return void W(Q,k,(D-Q.gradient)/(k.gradient-Q.gradient))}}const Q=j.length-1;W(j[Q],j[Q],1)}}var d=W(961),v=W(12158),B=W(991);class r{constructor(D){this.particleSystem=D,this.position=Q.j.Zero(),this.direction=Q.j.Zero(),this.color=new M.h(0,0,0,0),this.colorStep=new M.h(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new Q.f(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new M.h(0,0,0,0),this._currentColor2=new M.h(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=r._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let D=this.age,j=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===j?(j=1,D=this._randomCellOffset):D+=this._randomCellOffset);const W=this._initialEndSpriteCellID-this._initialStartSpriteCellID+1;let Q;Q=this._initialSpriteCellLoop?(0,f.e)(D*j%this.lifeTime/this.lifeTime):(0,f.e)(D*j/this.lifeTime),this.cellIndex=this._initialStartSpriteCellID+Q*W|0}_inheritParticleInfoToSubEmitter(D){if(D.particleSystem.k.position){const j=D.particleSystem.k;if(j.position.p(this.position),D.inheritDirection){const D=Q.e.Kd[0];this.direction.normalizeToRef(D),j.setDirection(D,0,Math.PI/2)}}else{D.particleSystem.k.p(this.position)}this.direction.scaleToRef(D.inheritedVelocityAmount/2,Q.e.Kd[0]),D.particleSystem._inheritedVelocityOffset.p(Q.e.Kd[0])}_inheritParticleInfoToSubEmitters(){this._attachedSubEmitters&&this._attachedSubEmitters.length>0&&this._attachedSubEmitters.forEach((D=>{this._inheritParticleInfoToSubEmitter(D)}))}_reset(){this.age=0,this.id=r._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(D){D.position.p(this.position),this._initialDirection?D._initialDirection?D._initialDirection.p(this._initialDirection):D._initialDirection=this._initialDirection.clone():D._initialDirection=null,D.direction.p(this.direction),this.Hg&&(D.Hg?D.Hg.p(this.Hg):D.Hg=this.Hg.clone()),D.color.p(this.color),D.colorStep.p(this.colorStep),D.lifeTime=this.lifeTime,D.age=this.age,D._randomCellOffset=this._randomCellOffset,D.size=this.size,D.scale.p(this.scale),D.angle=this.angle,D.angularSpeed=this.angularSpeed,D.particleSystem=this.particleSystem,D.cellIndex=this.cellIndex,D.id=this.id,D._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(D._currentColorGradient=this._currentColorGradient,D._currentColor1.p(this._currentColor1),D._currentColor2.p(this._currentColor2)),this._currentSizeGradient&&(D._currentSizeGradient=this._currentSizeGradient,D._currentSize1=this._currentSize1,D._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(D._currentAngularSpeedGradient=this._currentAngularSpeedGradient,D._currentAngularSpeed1=this._currentAngularSpeed1,D._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(D._currentVelocityGradient=this._currentVelocityGradient,D._currentVelocity1=this._currentVelocity1,D._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(D._currentLimitVelocityGradient=this._currentLimitVelocityGradient,D._currentLimitVelocity1=this._currentLimitVelocity1,D._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(D._currentDragGradient=this._currentDragGradient,D._currentDrag1=this._currentDrag1,D._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(D._initialStartSpriteCellID=this._initialStartSpriteCellID,D._initialEndSpriteCellID=this._initialEndSpriteCellID,D._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(D.remapData&&this.remapData?D.remapData.p(this.remapData):D.remapData=new Q.m(0,0,0,0)),this._randomNoiseCoordinates1&&(D._randomNoiseCoordinates1?(D._randomNoiseCoordinates1.p(this._randomNoiseCoordinates1),D._randomNoiseCoordinates2.p(this._randomNoiseCoordinates2)):(D._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),D._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}r._Count=0;var DD=W(1376),jD=(W(1471),W(1386)),WD=W(1382),QD=W(1231);class CD extends E{set onDispose(D){this._onDisposeObserver&&this.Qd.remove(this._onDisposeObserver),this._onDisposeObserver=this.Qd.add(D)}get useRampGradients(){return this._useRampGradients}set useRampGradients(D){this._useRampGradients!==D&&(this._useRampGradients=D,this._resetEffect())}get particles(){return this.Gj}get shaderLanguage(){return this._shaderLanguage}getActiveCount(){return this.Gj.length}getClassName(){return"Pe"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var D;let j=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(D=this._customWrappers[j])||void 0===D?void 0:D.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[D]??this._customWrappers[0]}setCustomEffect(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[j]=new DD.e(this._engine),this._customWrappers[j].effect=D,this._customWrappers[j].drawContext&&(this._customWrappers[j].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new d.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}constructor(D,j,W){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,k=arguments.length>4&&void 0!==arguments[4]&&arguments[4],O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01;super(D),this._emitterInverseWorldMatrix=Q.b.Identity(),this._inheritedVelocityOffset=new Q.j,this.Qd=new d.d,this.onStoppedObservable=new d.d,this.Gj=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new M.h(0,0,0,0),this._colorDiff=new M.h(0,0,0,0),this._scaledDirection=Q.j.Zero(),this._scaledGravity=Q.j.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this.isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=D=>{},this.recycleParticle=D=>{const j=this.Gj.pop();j!==D&&j.copyTo(D),this._stockParticles.push(j)},this._createParticle=()=>{let D;return 0!==this._stockParticles.length?(D=this._stockParticles.pop(),D._reset()):D=new r(this),this._prepareParticle(D),D},this._shadersLoaded=!1,this._capacity=j,this._epsilon=O,this._isAnimationSheetEnabled=k,W&&"Scene"!==W.getClassName()?(this._engine=W,this.defaultProjectionMatrix=Q.b.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=W||B.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.te.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._attachImageProcessingConfiguration(null),this._customWrappers={0:new DD.e(this._engine)},this._customWrappers[0].effect=C,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new Z;let E=null;this.updateFunction=D=>{let j=null;var W;this.noiseTexture&&(j=this.noiseTexture.getSize(),null===(W=this.noiseTexture.getContent())||void 0===W||W.then((D=>{E=D})));const C=D===this.Gj;for(let k=0;k<D.length;k++){const W=D[k];let O=this._scaledUpdateSpeed;const F=W.age;if(W.age+=O,W.age>W.lifeTime){const D=W.age-F;O=(W.lifeTime-F)*O/D,W.age=W.lifeTime}const Z=W.age/W.lifeTime;this._colorGradients&&this._colorGradients.length>0?h.GetCurrentGradient(Z,this._colorGradients,((D,j,Q)=>{D!==W._currentColorGradient&&(W._currentColor1.p(W._currentColor2),j.getColorToRef(W._currentColor2),W._currentColorGradient=D),M.h.LerpToRef(W._currentColor1,W._currentColor2,Q,W.color)})):(W.colorStep.scaleToRef(O,this._scaledColorStep),W.color.addInPlace(this._scaledColorStep),W.color.a<0&&(W.color.a=0)),this._angularSpeedGradients&&this._angularSpeedGradients.length>0&&h.GetCurrentGradient(Z,this._angularSpeedGradients,((D,j,Q)=>{D!==W._currentAngularSpeedGradient&&(W._currentAngularSpeed1=W._currentAngularSpeed2,W._currentAngularSpeed2=j.getFactor(),W._currentAngularSpeedGradient=D),W.angularSpeed=(0,f.o)(W._currentAngularSpeed1,W._currentAngularSpeed2,Q)})),W.angle+=W.angularSpeed*O;let P=O;if(this._velocityGradients&&this._velocityGradients.length>0&&h.GetCurrentGradient(Z,this._velocityGradients,((D,j,Q)=>{D!==W._currentVelocityGradient&&(W._currentVelocity1=W._currentVelocity2,W._currentVelocity2=j.getFactor(),W._currentVelocityGradient=D),P*=(0,f.o)(W._currentVelocity1,W._currentVelocity2,Q)})),W.direction.scaleToRef(P,this._scaledDirection),this._limitVelocityGradients&&this._limitVelocityGradients.length>0&&h.GetCurrentGradient(Z,this._limitVelocityGradients,((D,j,Q)=>{D!==W._currentLimitVelocityGradient&&(W._currentLimitVelocity1=W._currentLimitVelocity2,W._currentLimitVelocity2=j.getFactor(),W._currentLimitVelocityGradient=D);const C=(0,f.o)(W._currentLimitVelocity1,W._currentLimitVelocity2,Q);W.direction.length()>C&&W.direction.scaleInPlace(this.limitVelocityDamping)})),this._dragGradients&&this._dragGradients.length>0&&h.GetCurrentGradient(Z,this._dragGradients,((D,j,Q)=>{D!==W._currentDragGradient&&(W._currentDrag1=W._currentDrag2,W._currentDrag2=j.getFactor(),W._currentDragGradient=D);const C=(0,f.o)(W._currentDrag1,W._currentDrag2,Q);this._scaledDirection.scaleInPlace(1-C)})),this.isLocal&&W.Hg?(W.Hg.addInPlace(this._scaledDirection),Q.j.TransformCoordinatesToRef(W.Hg,this._emitterWorldMatrix,W.position)):W.position.addInPlace(this._scaledDirection),E&&j&&W._randomNoiseCoordinates1){const D=this._fetchR(W._randomNoiseCoordinates1.x,W._randomNoiseCoordinates1.y,j.width,j.height,E),C=this._fetchR(W._randomNoiseCoordinates1.z,W._randomNoiseCoordinates2.x,j.width,j.height,E),k=this._fetchR(W._randomNoiseCoordinates2.y,W._randomNoiseCoordinates2.z,j.width,j.height,E),M=Q.e.Kd[0],f=Q.e.Kd[1];M.Id((2*D-1)*this.noiseStrength.x,(2*C-1)*this.noiseStrength.y,(2*k-1)*this.noiseStrength.z),M.scaleToRef(O,f),W.direction.addInPlace(f)}this.gravity.scaleToRef(O,this._scaledGravity),W.direction.addInPlace(this._scaledGravity),this._sizeGradients&&this._sizeGradients.length>0&&h.GetCurrentGradient(Z,this._sizeGradients,((D,j,Q)=>{D!==W._currentSizeGradient&&(W._currentSize1=W._currentSize2,W._currentSize2=j.getFactor(),W._currentSizeGradient=D),W.size=(0,f.o)(W._currentSize1,W._currentSize2,Q)})),this._useRampGradients&&(this._colorRemapGradients&&this._colorRemapGradients.length>0&&h.GetCurrentGradient(Z,this._colorRemapGradients,((D,j,Q)=>{const C=(0,f.o)(D.factor1,j.factor1,Q),k=(0,f.o)(D.factor2,j.factor2,Q);W.remapData.x=C,W.remapData.y=k-C})),this._alphaRemapGradients&&this._alphaRemapGradients.length>0&&h.GetCurrentGradient(Z,this._alphaRemapGradients,((D,j,Q)=>{const C=(0,f.o)(D.factor1,j.factor1,Q),k=(0,f.o)(D.factor2,j.factor2,Q);W.remapData.z=C,W.remapData.w=k-C}))),this._isAnimationSheetEnabled&&W.updateCellIndex(),W._inheritParticleInfoToSubEmitters(),W.age>=W.lifeTime&&(this._emitFromParticle(W),W._attachedSubEmitters&&(W._attachedSubEmitters.forEach((D=>{D.particleSystem.disposeOnStop=!0,D.particleSystem.stop()})),W._attachedSubEmitters=null),this.recycleParticle(W),C&&k--)}}}serialize(D){throw new Error("Method not implemented.")}clone(D,j){throw new Error("Method not implemented.")}_addFactorGradient(D,j,W,Q){const C=new J(j,W,Q);D.push(C),D.sort(((D,j)=>D.gradient<j.gradient?-1:D.gradient>j.gradient?1:0))}_removeFactorGradient(D,j){if(!D)return;let W=0;for(const Q of D){if(Q.gradient===j){D.splice(W,1);break}W++}}addLifeTimeGradient(D,j,W){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,D,j,W),this}removeLifeTimeGradient(D){return this._removeFactorGradient(this._lifeTimeGradients,D),this}addSizeGradient(D,j,W){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,D,j,W),this}removeSizeGradient(D){return this._removeFactorGradient(this._sizeGradients,D),this}addColorRemapGradient(D,j,W){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,D,j,W),this}removeColorRemapGradient(D){return this._removeFactorGradient(this._colorRemapGradients,D),this}addAlphaRemapGradient(D,j,W){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,D,j,W),this}removeAlphaRemapGradient(D){return this._removeFactorGradient(this._alphaRemapGradients,D),this}addAngularSpeedGradient(D,j,W){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,D,j,W),this}removeAngularSpeedGradient(D){return this._removeFactorGradient(this._angularSpeedGradients,D),this}addVelocityGradient(D,j,W){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,D,j,W),this}removeVelocityGradient(D){return this._removeFactorGradient(this._velocityGradients,D),this}addLimitVelocityGradient(D,j,W){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,D,j,W),this}removeLimitVelocityGradient(D){return this._removeFactorGradient(this._limitVelocityGradients,D),this}addDragGradient(D,j,W){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,D,j,W),this}removeDragGradient(D){return this._removeFactorGradient(this._dragGradients,D),this}addEmitRateGradient(D,j,W){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,D,j,W),this}removeEmitRateGradient(D){return this._removeFactorGradient(this._emitRateGradients,D),this}addStartSizeGradient(D,j,W){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,D,j,W),this}removeStartSizeGradient(D){return this._removeFactorGradient(this._startSizeGradients,D),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const D=new Uint8Array(4*this._rawTextureWidth),j=M.l.Wd[0];for(let W=0;W<this._rawTextureWidth;W++){const Q=W/this._rawTextureWidth;h.GetCurrentGradient(Q,this._rampGradients,((Q,C,k)=>{M.d.LerpToRef(Q.color,C.color,k,j),D[4*W]=255*j.r,D[4*W+1]=255*j.g,D[4*W+2]=255*j.b,D[4*W+3]=255}))}this._rampGradientsTexture=v.d.CreateRGBATexture(D,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((D,j)=>D.gradient<j.gradient?-1:D.gradient>j.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(D,j){this._rampGradients||(this._rampGradients=[]);const W=new o(D,j);return this._rampGradients.push(W),this._syncRampGradientTexture(),this}removeRampGradient(D){return this._removeGradientAndTexture(D,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(D,j,W){this._colorGradients||(this._colorGradients=[]);const Q=new q(D,j,W);return this._colorGradients.push(Q),this._colorGradients.sort(((D,j)=>D.gradient<j.gradient?-1:D.gradient>j.gradient?1:0)),this}removeColorGradient(D){if(!this._colorGradients)return this;let j=0;for(const W of this._colorGradients){if(W.gradient===D){this._colorGradients.splice(j,1);break}j++}return this}resetDrawCache(){for(const D of this._drawWrappers)if(D)for(const j of D)null===j||void 0===j||j.dispose();this._drawWrappers=[]}_fetchR(D,j,W,Q,C){return C[4*(((D=.5*Math.abs(D)+.5)*W%W|0)+((j=.5*Math.abs(j)+.5)*Q%Q|0)*W)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const D=this._engine,j=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*j),this._vertexBuffer=new K.b(D,this._vertexData,!0,j);let W=0;const Q=this._vertexBuffer.createVertexBuffer(K.f.PositionKind,W,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[K.f.PositionKind]=Q,W+=3;const C=this._vertexBuffer.createVertexBuffer(K.f.ColorKind,W,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[K.f.ColorKind]=C,W+=4;const k=this._vertexBuffer.createVertexBuffer("angle",W,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=k,W+=1;const M=this._vertexBuffer.createVertexBuffer("size",W,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=M,W+=2,this._isAnimationSheetEnabled){const D=this._vertexBuffer.createVertexBuffer("cellIndex",W,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=D,W+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const D=this._vertexBuffer.createVertexBuffer("direction",W,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=D,W+=3}if(this._useRampGradients){const D=this._vertexBuffer.createVertexBuffer("remapData",W,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=D,W+=4}let O;if(this._useInstancing){const j=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new K.b(D,j,!1,2),O=this._spriteBuffer.createVertexBuffer("offset",0,2)}else O=this._vertexBuffer.createVertexBuffer("offset",W,2,this._vertexBufferSize,this._useInstancing),W+=2;this._vertexBuffers.offset=O,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const D=[],j=[];let W=0;for(let Q=0;Q<this._capacity;Q++)D.push(W),D.push(W+1),D.push(W+2),D.push(W),D.push(W+2),D.push(W+3),j.push(W,W+1,W+1,W+2,W+2,W+3,W+3,W,W,W+3),W+=4;this._indexBuffer=this._engine.createIndexBuffer(D),this._linesIndexBuffer=this._engine.createIndexBuffer(j)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(D)setTimeout((()=>{this.start(0)}),D);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var j;-1!==(null===(j=this.k)||void 0===j?void 0:j.getClassName().indexOf("Mesh"))&&this.k.Ge(!0);const D=this.noiseTexture;if(D&&D.onGeneratedObservable)D.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let j=0;j<this.preWarmCycles;j++)this.animate(!0),D.render()}))}));else for(let j=0;j<this.preWarmCycles;j++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop)}}stop(){let D=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(D))}_postStop(D){}reset(){this._stockParticles.length=0,this.Gj.length=0}_appendParticleVertex(D,j,W,C){let k=D*this._vertexBufferSize;if(this._vertexData[k++]=j.position.x+this.Eg.x,this._vertexData[k++]=j.position.y+this.Eg.y,this._vertexData[k++]=j.position.z+this.Eg.z,this._vertexData[k++]=j.color.r,this._vertexData[k++]=j.color.g,this._vertexData[k++]=j.color.b,this._vertexData[k++]=j.color.a,this._vertexData[k++]=j.angle,this._vertexData[k++]=j.scale.x*j.size,this._vertexData[k++]=j.scale.y*j.size,this._isAnimationSheetEnabled&&(this._vertexData[k++]=j.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[k++]=j.direction.x,this._vertexData[k++]=j.direction.y,this._vertexData[k++]=j.direction.z);else if(j._initialDirection){let D=j._initialDirection;this.isLocal&&(Q.j.TransformNormalToRef(D,this._emitterWorldMatrix,Q.e.Kd[0]),D=Q.e.Kd[0]),0===D.x&&0===D.z&&(D.x=.001),this._vertexData[k++]=D.x,this._vertexData[k++]=D.y,this._vertexData[k++]=D.z}else{let D=j.direction;this.isLocal&&(Q.j.TransformNormalToRef(D,this._emitterWorldMatrix,Q.e.Kd[0]),D=Q.e.Kd[0]),0===D.x&&0===D.z&&(D.x=.001),this._vertexData[k++]=D.x,this._vertexData[k++]=D.y,this._vertexData[k++]=D.z}this._useRampGradients&&j.remapData&&(this._vertexData[k++]=j.remapData.x,this._vertexData[k++]=j.remapData.y,this._vertexData[k++]=j.remapData.z,this._vertexData[k++]=j.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===W?W=this._epsilon:1===W&&(W=1-this._epsilon),0===C?C=this._epsilon:1===C&&(C=1-this._epsilon)),this._vertexData[k++]=W,this._vertexData[k++]=C)}_prepareParticle(D){}_update(D){if(this._alive=this.Gj.length>0,this.k.position){const D=this.k;this._emitterWorldMatrix=D.getWorldMatrix()}else{const D=this.k;this._emitterWorldMatrix=Q.b.Translation(D.x,D.y,D.z)}let j;this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.Gj);for(let W=0;W<D&&this.Gj.length!==this._capacity;W++){if(j=this._createParticle(),this.Gj.push(j),this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0){const D=(0,f.e)(this._actualFrame/this.targetStopDuration);h.GetCurrentGradient(D,this._lifeTimeGradients,((W,Q)=>{const C=W,k=Q,M=C.getFactor(),O=k.getFactor(),E=(D-C.gradient)/(k.gradient-C.gradient);j.lifeTime=(0,f.o)(M,O,E)}))}else j.lifeTime=(0,f.v)(this.minLifeTime,this.maxLifeTime);const D=(0,f.v)(this.minEmitPower,this.maxEmitPower);if(this.startPositionFunction?this.startPositionFunction(this._emitterWorldMatrix,j.position,j,this.isLocal):this.particleEmitterType.startPositionFunction(this._emitterWorldMatrix,j.position,j,this.isLocal),this.isLocal&&(j.Hg?j.Hg.p(j.position):j.Hg=j.position.clone(),Q.j.TransformCoordinatesToRef(j.Hg,this._emitterWorldMatrix,j.position)),this.startDirectionFunction?this.startDirectionFunction(this._emitterWorldMatrix,j.direction,j,this.isLocal):this.particleEmitterType.startDirectionFunction(this._emitterWorldMatrix,j.direction,j,this.isLocal,this._emitterInverseWorldMatrix),0===D?j._initialDirection?j._initialDirection.p(j.direction):j._initialDirection=j.direction.clone():j._initialDirection=null,j.direction.scaleInPlace(D),this._sizeGradients&&0!==this._sizeGradients.length?(j._currentSizeGradient=this._sizeGradients[0],j._currentSize1=j._currentSizeGradient.getFactor(),j.size=j._currentSize1,this._sizeGradients.length>1?j._currentSize2=this._sizeGradients[1].getFactor():j._currentSize2=j._currentSize1):j.size=(0,f.v)(this.minSize,this.maxSize),j.scale.Id((0,f.v)(this.minScaleX,this.maxScaleX),(0,f.v)(this.minScaleY,this.maxScaleY)),this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration){const D=this._actualFrame/this.targetStopDuration;h.GetCurrentGradient(D,this._startSizeGradients,((D,W,Q)=>{D!==this._currentStartSizeGradient&&(this._currentStartSize1=this._currentStartSize2,this._currentStartSize2=W.getFactor(),this._currentStartSizeGradient=D);const C=(0,f.o)(this._currentStartSize1,this._currentStartSize2,Q);j.scale.scaleInPlace(C)}))}if(this._angularSpeedGradients&&0!==this._angularSpeedGradients.length?(j._currentAngularSpeedGradient=this._angularSpeedGradients[0],j.angularSpeed=j._currentAngularSpeedGradient.getFactor(),j._currentAngularSpeed1=j.angularSpeed,this._angularSpeedGradients.length>1?j._currentAngularSpeed2=this._angularSpeedGradients[1].getFactor():j._currentAngularSpeed2=j._currentAngularSpeed1):j.angularSpeed=(0,f.v)(this.minAngularSpeed,this.maxAngularSpeed),j.angle=(0,f.v)(this.minInitialRotation,this.maxInitialRotation),this._velocityGradients&&this._velocityGradients.length>0&&(j._currentVelocityGradient=this._velocityGradients[0],j._currentVelocity1=j._currentVelocityGradient.getFactor(),this._velocityGradients.length>1?j._currentVelocity2=this._velocityGradients[1].getFactor():j._currentVelocity2=j._currentVelocity1),this._limitVelocityGradients&&this._limitVelocityGradients.length>0&&(j._currentLimitVelocityGradient=this._limitVelocityGradients[0],j._currentLimitVelocity1=j._currentLimitVelocityGradient.getFactor(),this._limitVelocityGradients.length>1?j._currentLimitVelocity2=this._limitVelocityGradients[1].getFactor():j._currentLimitVelocity2=j._currentLimitVelocity1),this._dragGradients&&this._dragGradients.length>0&&(j._currentDragGradient=this._dragGradients[0],j._currentDrag1=j._currentDragGradient.getFactor(),this._dragGradients.length>1?j._currentDrag2=this._dragGradients[1].getFactor():j._currentDrag2=j._currentDrag1),this._colorGradients&&0!==this._colorGradients.length)j._currentColorGradient=this._colorGradients[0],j._currentColorGradient.getColorToRef(j.color),j._currentColor1.p(j.color),this._colorGradients.length>1?this._colorGradients[1].getColorToRef(j._currentColor2):j._currentColor2.p(j.color);else{const D=(0,f.v)(0,1);M.h.LerpToRef(this.color1,this.color2,D,j.color),this.colorDead.subtractToRef(j.color,this._colorDiff),this._colorDiff.scaleToRef(1/j.lifeTime,j.colorStep)}this._isAnimationSheetEnabled&&(j._initialStartSpriteCellID=this.startSpriteCellID,j._initialEndSpriteCellID=this.endSpriteCellID,j._initialSpriteCellLoop=this.spriteCellLoop),j.direction.addInPlace(this._inheritedVelocityOffset),this._useRampGradients&&(j.remapData=new Q.m(0,1,0,1)),this.noiseTexture&&(j._randomNoiseCoordinates1?(j._randomNoiseCoordinates1.Id(Math.random(),Math.random(),Math.random()),j._randomNoiseCoordinates2.Id(Math.random(),Math.random(),Math.random())):(j._randomNoiseCoordinates1=new Q.j(Math.random(),Math.random(),Math.random()),j._randomNoiseCoordinates2=new Q.j(Math.random(),Math.random(),Math.random()))),j._inheritParticleInfoToSubEmitters()}}static _GetAttributeNamesOrOptions(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0],j=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const Q=[K.f.PositionKind,K.f.ColorKind,"angle","offset","size"];return D&&Q.push("cellIndex"),j||Q.push("direction"),W&&Q.push("remapData"),Q}static _GetEffectCreationOptions(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0],j=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const Q=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,jD.e)(Q),D&&Q.push("particlesInfos"),j&&Q.push("logarithmicDepthConstant"),W&&(Q.push("vFogInfos"),Q.push("vFogColor")),Q}fillDefines(D,j){let W=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,jD.n)(this,this._scene,D),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&D.push("#define FOG")),this._isAnimationSheetEnabled&&D.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&D.push("#define LOGARITHMICDEPTH"),j===E.BLENDMODE_MULTIPLY&&D.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&D.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(D.push("#define BILLBOARD"),this.billboardMode){case 2:D.push("#define BILLBOARDY");break;case 8:case 9:D.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&D.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:D.push("#define BILLBOARDMODE_ALL")}W&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),D.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(D,j,W){j.push(...CD._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),D.push(...CD._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),W.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,QD.h)(D,this._imageProcessingConfigurationDefines),(0,QD.d)(W,this._imageProcessingConfigurationDefines))}_getWrapper(D){const j=this._getCustomDrawWrapper(D);if(null!==j&&void 0!==j&&j.effect)return j;const W=[];this.fillDefines(W,D);const Q=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let C=this._drawWrappers[Q];C||(C=this._drawWrappers[Q]=[]);let k=C[D];k||(k=new DD.e(this._engine),k.drawContext&&(k.drawContext.useInstancing=this._useInstancing),C[D]=k);const M=W.join("\n");if(k.defines!==M){const D=[],j=[],W=[];this.fillUniformsAttributesAndSamplerNames(j,D,W),k.setEffect(this._engine.createEffect("particles",D,j,W,M,void 0,void 0,void 0,void 0,this._shaderLanguage),M)}return k}animate(){var D;let j,W=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started){if(!W&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(W?this.preWarmStepOffset:(null===(D=this._scene)||void 0===D?void 0:D.getAnimationRatio())||1),this.manualEmitCount>-1)j=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let D=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const j=this._actualFrame/this.targetStopDuration;h.GetCurrentGradient(j,this._emitRateGradients,((j,W,Q)=>{j!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=W.getFactor(),this._currentEmitRateGradient=j),D=(0,f.o)(this._currentEmitRate1,this._currentEmitRate2,Q)}))}j=D*this._scaledUpdateSpeed|0,this._newPartsExcess+=D*this._scaledUpdateSpeed-j}if(this._newPartsExcess>1&&(j+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?j=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(j),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!W){let D=0;for(let j=0;j<this.Gj.length;j++){const W=this.Gj[j];this._appendParticleVertices(D,W),D+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.Gj.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(D,j){this._appendParticleVertex(D++,j,0,0),this._useInstancing||(this._appendParticleVertex(D++,j,1,0),this._appendParticleVertex(D++,j,1,1),this._appendParticleVertex(D++,j,0,1))}rebuild(){var D;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(D=this._spriteBuffer)||void 0===D||D._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!CD.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(W.bind(W,12214)),Promise.resolve().then(W.bind(W,12205))])):await Promise.all([Promise.resolve().then(W.bind(W,12196)),Promise.resolve().then(W.bind(W,12187))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.k||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==E.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(E.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(E.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(D){const j=this._getWrapper(D),W=j.effect,C=this._engine;C.enableEffect(j);const k=this.defaultViewMatrix??this._scene.getViewMatrix();if(W.setTexture("diffuseSampler",this.particleTexture),W.setMatrix("view",k),W.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const D=this.particleTexture.getBaseSize();W.setFloat3("particlesInfos",this.spriteCellWidth/D.width,this.spriteCellHeight/D.height,this.spriteCellWidth/D.width)}if(W.setVector2("translationPivot",this.translationPivot),W.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const D=this._scene.activeCamera;W.setVector3("eyePosition",D.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),W.setTexture("rampSampler",this._rampGradientsTexture));const M=W.defines;var O,f,F,Z,P,X;(this._scene&&((0,jD.h)(W,this,this._scene),this.applyFog&&(0,WD.f)(this._scene,void 0,W)),M.indexOf("#define BILLBOARDMODE_ALL")>=0&&(k.invertToRef(Q.e.Matrix[0]),W.setMatrix("invView",Q.e.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(O=this._scene)&&void 0!==O&&O.forceWireframe?C.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,W):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,W)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(f=this._scene)&&void 0!==f&&f.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?C.bindBuffers(this._vertexBuffers,null!==(F=this._scene)&&void 0!==F&&F.forceWireframe?this._linesIndexBuffer:this._indexBuffer,W):C.bindBuffers(this._vertexBuffers,null!==(Z=this._scene)&&void 0!==Z&&Z.forceWireframe?this._linesIndexBufferUseInstancing:null,W);switch(this.useLogarithmicDepth&&this._scene&&(0,WD.l)(M,W,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(W),D){case E.BLENDMODE_ADD:C.setAlphaMode(1);break;case E.BLENDMODE_ONEONE:C.setAlphaMode(6);break;case E.BLENDMODE_STANDARD:C.setAlphaMode(2);break;case E.BLENDMODE_MULTIPLY:C.setAlphaMode(4)}(this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(W),this._useInstancing)?null!==(P=this._scene)&&void 0!==P&&P.forceWireframe?C.drawElementsType(6,0,10,this.Gj.length):C.drawArraysType(7,0,4,this.Gj.length):null!==(X=this._scene)&&void 0!==X&&X.forceWireframe?C.drawElementsType(1,0,10*this.Gj.length):C.drawElementsType(0,0,6*this.Gj.length);return this.Gj.length}render(){if(!this.isReady()||!this.Gj.length)return 0;const D=this._engine;D.setState&&(D.setState(!1),this.forceDepthWrite&&D.setDepthWrite(!0));let j=0;return j=this.blendMode===E.BLENDMODE_MULTIPLYADD?this._render(E.BLENDMODE_MULTIPLY)+this._render(E.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),j}_onDispose(){}dispose(){let D=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],j=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),D&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),D&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(j,W),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const D=this._scene.te.indexOf(this);D>-1&&this._scene.te.splice(D,1),this._scene._activeParticleSystems.dispose()}this.Qd.notifyObservers(this),this.Qd.clear(),this.onStoppedObservable.clear(),this.reset()}}CD.ForceGLSL=!1;var kD,MD=W(1070);!function(D){D[D.ATTACHED=0]="ATTACHED",D[D.END=1]="END"}(kD||(kD={}));class OD{constructor(D){if(this.particleSystem=D,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!D.k||!D.k.dispose){const j=(0,O.b)("BABYLON.AbstractMesh");D.k=new j("SubemitterSystemEmitter",D.va()),D._disposeEmitterOnDispose=!0}}clone(){let D=this.particleSystem.k;if(D){if(D instanceof Q.j)D=D.clone();else if(-1!==D.getClassName().indexOf("Mesh")){D=new((0,O.b)("BABYLON.Mesh"))("",D.va()),D.isVisible=!1}}else D=new Q.j;const j=new OD(this.particleSystem.clone(this.particleSystem.name,D));return j.particleSystem.name+="Clone",j.type=this.type,j.inheritDirection=this.inheritDirection,j.inheritedVelocityAmount=this.inheritedVelocityAmount,j.particleSystem._disposeEmitterOnDispose=!0,j.particleSystem.disposeOnStop=!0,j}serialize(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const j={};return j.type=this.type,j.inheritDirection=this.inheritDirection,j.inheritedVelocityAmount=this.inheritedVelocityAmount,j.particleSystem=this.particleSystem.serialize(D),j}static _ParseParticleSystem(D,j,W){throw(0,MD.d)("ParseParticle")}static Parse(D,j,W){const Q=D.particleSystem,C=new OD(OD._ParseParticleSystem(Q,j,W,!0));return C.type=D.type,C.inheritDirection=D.inheritDirection,C.inheritedVelocityAmount=D.inheritedVelocityAmount,C.particleSystem._isSubEmitter=!0,C}dispose(){this.particleSystem.dispose()}}var ED=W(1096);function fD(D,j){const W=new U;return W.direction1=D,W.direction2=j,W}function FD(){return new V(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function ZD(){return new g(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function PD(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Q.j(0,1,0),W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Q.j(0,1,0);return new N(D,j,W)}function XD(){return new x(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function xD(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Q.j(0,1,0),k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Q.j(0,1,0);return new R(D,j,W,C,k)}function RD(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new P(D,j)}function VD(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Q.j(0,1,0),C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Q.j(0,1,0);return new X(D,j,W,C)}class UD extends CD{constructor(){super(...arguments),this._disposeEmitterOnDispose=!1,this._emitFromParticle=D=>{if(!this._subEmitters||0===this._subEmitters.length)return;const j=Math.floor(Math.random()*this._subEmitters.length);this._subEmitters[j].forEach((j=>{if(1===j.type){const W=j.clone();D._inheritParticleInfoToSubEmitter(W),W.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(W.particleSystem),W.particleSystem.start()}}))}}createPointEmitter(D,j){const W=fD(D,j);return this.particleEmitterType=W,W}createHemisphericEmitter(){const D=FD(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=D,D}createSphereEmitter(){const D=ZD(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=D,D}createDirectedSphereEmitter(){const D=PD(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Q.j(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Q.j(0,1,0));return this.particleEmitterType=D,D}createCylinderEmitter(){const D=XD(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=D,D}createDirectedCylinderEmitter(){const D=xD(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Q.j(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Q.j(0,1,0));return this.particleEmitterType=D,D}createConeEmitter(){const D=RD(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=D,D}createDirectedConeEmitter(){const D=VD(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Q.j(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Q.j(0,1,0));return this.particleEmitterType=D,D}createBoxEmitter(D,j,W,Q){const C=new Z;return this.particleEmitterType=C,this.direction1=D,this.direction2=j,this.minEmitBox=W,this.maxEmitBox=Q,C}_prepareSubEmitterInternalArray(){this._subEmitters=new Array,this.subEmitters&&this.subEmitters.forEach((D=>{D instanceof UD?this._subEmitters.push([new OD(D)]):D instanceof OD?this._subEmitters.push([D]):D instanceof Array&&this._subEmitters.push(D)}))}_stopSubEmitters(){this.activeSubSystems&&(this.activeSubSystems.forEach((D=>{D.stop(!0)})),this.activeSubSystems=[])}_removeFromRoot(){if(!this._rootParticleSystem)return;const D=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==D&&this._rootParticleSystem.activeSubSystems.splice(D,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(D){D&&this._stopSubEmitters()}_prepareParticle(D){if(this._subEmitters&&this._subEmitters.length>0){const j=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];D._attachedSubEmitters=[],j.forEach((j=>{if(0===j.type){const W=j.clone();D._attachedSubEmitters.push(W),W.particleSystem.start()}}))}}_onDispose(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0],j=arguments.length>1&&void 0!==arguments[1]&&arguments[1];var W;(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),D)&&(null===(W=this.particles)||void 0===W||W.forEach((D=>{if(D._attachedSubEmitters)for(let j=D._attachedSubEmitters.length-1;j>=0;j-=1)D._attachedSubEmitters[j].dispose()})));if(j&&this.activeSubSystems)for(let Q=this.activeSubSystems.length-1;Q>=0;Q-=1)this.activeSubSystems[Q].dispose();if(this._subEmitters&&this._subEmitters.length){for(let D=0;D<this._subEmitters.length;D++)for(const j of this._subEmitters[D])j.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.k&&this.k.dispose&&this.k.dispose(!0)}static _Parse(D,j,W,C){let k;k=W instanceof ED.e?null:W;const E=(0,O.b)("BABYLON.Texture");if(E&&k&&(D.texture?j.particleTexture=E.Parse(D.texture,k,C):D.textureName&&(j.particleTexture=new E(C+D.textureName,k,!1,void 0===D.invertY||D.invertY),j.particleTexture.name=D.textureName)),D.emitterId||0===D.emitterId||void 0!==D.k?D.emitterId&&k?j.k=k.getLastMeshById(D.emitterId):j.k=Q.j.Dd(D.k):j.k=Q.j.Zero(),j.isLocal=!!D.isLocal,void 0!==D.renderingGroupId&&(j.renderingGroupId=D.renderingGroupId),void 0!==D.isBillboardBased&&(j.isBillboardBased=D.isBillboardBased),void 0!==D.billboardMode&&(j.billboardMode=D.billboardMode),void 0!==D.useLogarithmicDepth&&(j.useLogarithmicDepth=D.useLogarithmicDepth),D.animations){for(let W=0;W<D.animations.length;W++){const Q=D.animations[W],C=(0,O.b)("BABYLON.Animation");C&&j.animations.push(C.Parse(Q))}j.beginAnimationOnStart=D.beginAnimationOnStart,j.beginAnimationFrom=D.beginAnimationFrom,j.beginAnimationTo=D.beginAnimationTo,j.beginAnimationLoop=D.beginAnimationLoop}if(D.autoAnimate&&k&&k.beginAnimation(j,D.autoAnimateFrom,D.autoAnimateTo,D.autoAnimateLoop,D.autoAnimateSpeed||1),j.startDelay=0|D.startDelay,j.minAngularSpeed=D.minAngularSpeed,j.maxAngularSpeed=D.maxAngularSpeed,j.minSize=D.minSize,j.maxSize=D.maxSize,D.minScaleX&&(j.minScaleX=D.minScaleX,j.maxScaleX=D.maxScaleX,j.minScaleY=D.minScaleY,j.maxScaleY=D.maxScaleY),void 0!==D.preWarmCycles&&(j.preWarmCycles=D.preWarmCycles,j.preWarmStepOffset=D.preWarmStepOffset),void 0!==D.minInitialRotation&&(j.minInitialRotation=D.minInitialRotation,j.maxInitialRotation=D.maxInitialRotation),j.minLifeTime=D.minLifeTime,j.maxLifeTime=D.maxLifeTime,j.minEmitPower=D.minEmitPower,j.maxEmitPower=D.maxEmitPower,j.emitRate=D.emitRate,j.gravity=Q.j.Dd(D.gravity),D.noiseStrength&&(j.noiseStrength=Q.j.Dd(D.noiseStrength)),j.color1=M.h.Dd(D.color1),j.color2=M.h.Dd(D.color2),j.colorDead=M.h.Dd(D.colorDead),j.updateSpeed=D.updateSpeed,j.targetStopDuration=D.targetStopDuration,j.blendMode=D.blendMode,D.colorGradients)for(const Q of D.colorGradients)j.addColorGradient(Q.gradient,M.h.Dd(Q.color1),Q.color2?M.h.Dd(Q.color2):void 0);if(D.rampGradients){for(const W of D.rampGradients)j.addRampGradient(W.gradient,M.d.Dd(W.color));j.useRampGradients=D.useRampGradients}if(D.colorRemapGradients)for(const Q of D.colorRemapGradients)j.addColorRemapGradient(Q.gradient,void 0!==Q.factor1?Q.factor1:Q.factor,Q.factor2);if(D.alphaRemapGradients)for(const Q of D.alphaRemapGradients)j.addAlphaRemapGradient(Q.gradient,void 0!==Q.factor1?Q.factor1:Q.factor,Q.factor2);if(D.sizeGradients)for(const Q of D.sizeGradients)j.addSizeGradient(Q.gradient,void 0!==Q.factor1?Q.factor1:Q.factor,Q.factor2);if(D.angularSpeedGradients)for(const Q of D.angularSpeedGradients)j.addAngularSpeedGradient(Q.gradient,void 0!==Q.factor1?Q.factor1:Q.factor,Q.factor2);if(D.velocityGradients)for(const Q of D.velocityGradients)j.addVelocityGradient(Q.gradient,void 0!==Q.factor1?Q.factor1:Q.factor,Q.factor2);if(D.dragGradients)for(const Q of D.dragGradients)j.addDragGradient(Q.gradient,void 0!==Q.factor1?Q.factor1:Q.factor,Q.factor2);if(D.emitRateGradients)for(const Q of D.emitRateGradients)j.addEmitRateGradient(Q.gradient,void 0!==Q.factor1?Q.factor1:Q.factor,Q.factor2);if(D.startSizeGradients)for(const Q of D.startSizeGradients)j.addStartSizeGradient(Q.gradient,void 0!==Q.factor1?Q.factor1:Q.factor,Q.factor2);if(D.lifeTimeGradients)for(const Q of D.lifeTimeGradients)j.addLifeTimeGradient(Q.gradient,void 0!==Q.factor1?Q.factor1:Q.factor,Q.factor2);if(D.limitVelocityGradients){for(const W of D.limitVelocityGradients)j.addLimitVelocityGradient(W.gradient,void 0!==W.factor1?W.factor1:W.factor,W.factor2);j.limitVelocityDamping=D.limitVelocityDamping}if(D.noiseTexture&&k){const W=(0,O.b)("BABYLON.ProceduralTexture");j.noiseTexture=W.Parse(D.noiseTexture,k,C)}let f;if(D.particleEmitterType){switch(D.particleEmitterType.type){case"SphereParticleEmitter":f=new g;break;case"SphereDirectedParticleEmitter":f=new N;break;case"ConeEmitter":case"ConeParticleEmitter":f=new P;break;case"ConeDirectedParticleEmitter":f=new X;break;case"CylinderParticleEmitter":f=new x;break;case"CylinderDirectedParticleEmitter":f=new R;break;case"HemisphericParticleEmitter":f=new V;break;case"PointParticleEmitter":f=new U;break;case"MeshParticleEmitter":f=new L;break;case"CustomParticleEmitter":f=new G;break;default:f=new Z}f.parse(D.particleEmitterType,k)}else f=new Z,f.parse(D,k);j.particleEmitterType=f,j.startSpriteCellID=D.startSpriteCellID,j.endSpriteCellID=D.endSpriteCellID,j.spriteCellLoop=D.spriteCellLoop??!0,j.spriteCellWidth=D.spriteCellWidth,j.spriteCellHeight=D.spriteCellHeight,j.spriteCellChangeSpeed=D.spriteCellChangeSpeed,j.spriteRandomStartCell=D.spriteRandomStartCell,j.disposeOnStop=D.disposeOnStop??!1,j.manualEmitCount=D.manualEmitCount??-1}static Parse(D,j,W){let C=arguments.length>3&&void 0!==arguments[3]&&arguments[3],k=arguments.length>4?arguments[4]:void 0;const O=D.name;let E,f,F=null,Z=null;if(j instanceof ED.e?E=j:(f=j,E=f.getEngine()),D.customShader&&E.createEffectForParticles){Z=D.customShader;const j=Z.shaderOptions.defines.length>0?Z.shaderOptions.defines.join("\n"):"";F=E.createEffectForParticles(Z.shaderPath.fragmentElement,Z.shaderOptions.uniforms,Z.shaderOptions.samplers,j)}const P=new UD(O,k||D.Ne,j,F,D.isAnimationSheetEnabled);if(P.customShader=Z,P._rootUrl=W,D.id&&(P.id=D.id),D.subEmitters){P.subEmitters=[];for(const Q of D.subEmitters){const D=[];for(const C of Q)D.push(OD.Parse(C,j,W));P.subEmitters.push(D)}}return UD._Parse(D,P,j,W),D.textureMask&&(P.textureMask=M.h.Dd(D.textureMask)),D.Eg&&(P.Eg=Q.j.Dd(D.Eg)),D.preventAutoStart&&(P.preventAutoStart=D.preventAutoStart),C||P.preventAutoStart||P.start(),P}serialize(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const j={};if(UD._Serialize(j,this,D),j.textureMask=this.textureMask.Gd(),j.customShader=this.customShader,j.preventAutoStart=this.preventAutoStart,j.Eg=this.Eg.Gd(),this.subEmitters){j.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const W of this._subEmitters){const Q=[];for(const j of W)Q.push(j.serialize(D));j.subEmitters.push(Q)}}return j}static _Serialize(D,j,W){if(D.name=j.name,D.id=j.id,D.Ne=j.getCapacity(),D.disposeOnStop=j.disposeOnStop,D.manualEmitCount=j.manualEmitCount,j.k.position){const W=j.k;D.emitterId=W.id}else{const W=j.k;D.k=W.Gd()}j.particleEmitterType&&(D.particleEmitterType=j.particleEmitterType.serialize()),j.particleTexture&&(W?D.texture=j.particleTexture.serialize():(D.textureName=j.particleTexture.name,D.invertY=!!j.particleTexture._invertY)),D.isLocal=j.isLocal,a.d.AppendSerializedAnimations(j,D),D.beginAnimationOnStart=j.beginAnimationOnStart,D.beginAnimationFrom=j.beginAnimationFrom,D.beginAnimationTo=j.beginAnimationTo,D.beginAnimationLoop=j.beginAnimationLoop,D.startDelay=j.startDelay,D.renderingGroupId=j.renderingGroupId,D.isBillboardBased=j.isBillboardBased,D.billboardMode=j.billboardMode,D.minAngularSpeed=j.minAngularSpeed,D.maxAngularSpeed=j.maxAngularSpeed,D.minSize=j.minSize,D.maxSize=j.maxSize,D.minScaleX=j.minScaleX,D.maxScaleX=j.maxScaleX,D.minScaleY=j.minScaleY,D.maxScaleY=j.maxScaleY,D.minEmitPower=j.minEmitPower,D.maxEmitPower=j.maxEmitPower,D.minLifeTime=j.minLifeTime,D.maxLifeTime=j.maxLifeTime,D.emitRate=j.emitRate,D.gravity=j.gravity.Gd(),D.noiseStrength=j.noiseStrength.Gd(),D.color1=j.color1.Gd(),D.color2=j.color2.Gd(),D.colorDead=j.colorDead.Gd(),D.updateSpeed=j.updateSpeed,D.targetStopDuration=j.targetStopDuration,D.blendMode=j.blendMode,D.preWarmCycles=j.preWarmCycles,D.preWarmStepOffset=j.preWarmStepOffset,D.minInitialRotation=j.minInitialRotation,D.maxInitialRotation=j.maxInitialRotation,D.startSpriteCellID=j.startSpriteCellID,D.spriteCellLoop=j.spriteCellLoop,D.endSpriteCellID=j.endSpriteCellID,D.spriteCellChangeSpeed=j.spriteCellChangeSpeed,D.spriteCellWidth=j.spriteCellWidth,D.spriteCellHeight=j.spriteCellHeight,D.spriteRandomStartCell=j.spriteRandomStartCell,D.isAnimationSheetEnabled=j.isAnimationSheetEnabled,D.useLogarithmicDepth=j.useLogarithmicDepth;const Q=j.getColorGradients();if(Q){D.colorGradients=[];for(const j of Q){const W={gradient:j.gradient,color1:j.color1.Gd()};j.color2?W.color2=j.color2.Gd():W.color2=j.color1.Gd(),D.colorGradients.push(W)}}const C=j.getRampGradients();if(C){D.rampGradients=[];for(const j of C){const W={gradient:j.gradient,color:j.color.Gd()};D.rampGradients.push(W)}D.useRampGradients=j.useRampGradients}const k=j.getColorRemapGradients();if(k){D.colorRemapGradients=[];for(const j of k){const W={gradient:j.gradient,factor1:j.factor1};void 0!==j.factor2?W.factor2=j.factor2:W.factor2=j.factor1,D.colorRemapGradients.push(W)}}const M=j.getAlphaRemapGradients();if(M){D.alphaRemapGradients=[];for(const j of M){const W={gradient:j.gradient,factor1:j.factor1};void 0!==j.factor2?W.factor2=j.factor2:W.factor2=j.factor1,D.alphaRemapGradients.push(W)}}const O=j.getSizeGradients();if(O){D.sizeGradients=[];for(const j of O){const W={gradient:j.gradient,factor1:j.factor1};void 0!==j.factor2?W.factor2=j.factor2:W.factor2=j.factor1,D.sizeGradients.push(W)}}const E=j.getAngularSpeedGradients();if(E){D.angularSpeedGradients=[];for(const j of E){const W={gradient:j.gradient,factor1:j.factor1};void 0!==j.factor2?W.factor2=j.factor2:W.factor2=j.factor1,D.angularSpeedGradients.push(W)}}const f=j.getVelocityGradients();if(f){D.velocityGradients=[];for(const j of f){const W={gradient:j.gradient,factor1:j.factor1};void 0!==j.factor2?W.factor2=j.factor2:W.factor2=j.factor1,D.velocityGradients.push(W)}}const F=j.getDragGradients();if(F){D.dragGradients=[];for(const j of F){const W={gradient:j.gradient,factor1:j.factor1};void 0!==j.factor2?W.factor2=j.factor2:W.factor2=j.factor1,D.dragGradients.push(W)}}const Z=j.getEmitRateGradients();if(Z){D.emitRateGradients=[];for(const j of Z){const W={gradient:j.gradient,factor1:j.factor1};void 0!==j.factor2?W.factor2=j.factor2:W.factor2=j.factor1,D.emitRateGradients.push(W)}}const P=j.getStartSizeGradients();if(P){D.startSizeGradients=[];for(const j of P){const W={gradient:j.gradient,factor1:j.factor1};void 0!==j.factor2?W.factor2=j.factor2:W.factor2=j.factor1,D.startSizeGradients.push(W)}}const X=j.getLifeTimeGradients();if(X){D.lifeTimeGradients=[];for(const j of X){const W={gradient:j.gradient,factor1:j.factor1};void 0!==j.factor2?W.factor2=j.factor2:W.factor2=j.factor1,D.lifeTimeGradients.push(W)}}const x=j.getLimitVelocityGradients();if(x){D.limitVelocityGradients=[];for(const j of x){const W={gradient:j.gradient,factor1:j.factor1};void 0!==j.factor2?W.factor2=j.factor2:W.factor2=j.factor1,D.limitVelocityGradients.push(W)}D.limitVelocityDamping=j.limitVelocityDamping}j.noiseTexture&&(D.noiseTexture=j.noiseTexture.serialize())}clone(D,j){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const Q={...this._customWrappers};let C=null;const k=this._engine;if(k.createEffectForParticles&&null!=this.customShader){C=this.customShader;const D=C.shaderOptions.defines.length>0?C.shaderOptions.defines.join("\n"):"",j=k.createEffectForParticles(C.shaderPath.fragmentElement,C.shaderOptions.uniforms,C.shaderOptions.samplers,D);Q[0]?Q[0].effect=j:this.setCustomEffect(j,0)}const M=this.serialize(W),O=UD.Parse(M,this._scene||this._engine,this._rootUrl);return O.name=D,O.customShader=C,O._customWrappers=Q,void 0===j&&(j=this.k),this.noiseTexture&&(O.noiseTexture=this.noiseTexture.clone()),O.k=j,this.preventAutoStart||O.start(),O}}UD.BILLBOARDMODE_Y=2,UD.BILLBOARDMODE_ALL=7,UD.BILLBOARDMODE_STRETCHED=8,UD.BILLBOARDMODE_STRETCHED_LOCAL=9,OD._ParseParticleSystem=UD.Parse;var gD=W(1217),ND=W(1199),GD=W(1444);GD.e.prototype.createTransformFeedback=function(){const D=this._gl.createTransformFeedback();if(!D)throw new Error("Unable to create Transform Feedback");return D},GD.e.prototype.deleteTransformFeedback=function(D){this._gl.deleteTransformFeedback(D)},GD.e.prototype.bindTransformFeedback=function(D){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,D)},GD.e.prototype.beginTransformFeedback=function(){let D=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(D?this._gl.POINTS:this._gl.TRIANGLES)},GD.e.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},GD.e.prototype.setTranformFeedbackVaryings=function(D,j){this._gl.transformFeedbackVaryings(D,j,this._gl.INTERLEAVED_ATTRIBS)},GD.e.prototype.bindTransformFeedbackBuffer=function(D){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,D?D.underlyingResource:null)},GD.e.prototype.readTransformFeedbackBuffer=function(D){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,D)};const KD="clipPlaneFragmentDeclaration2",LD="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";b.e.IncludesShadersStore[KD]=LD;W(11558),W(11418),W(11322),W(11561),W(11579),W(11581),W(11606),W(11614);const eD="gpuRenderParticlesPixelShader",sD="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";b.e.ShadersStore[eD]=sD;const bD="clipPlaneVertexDeclaration2",YD="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";b.e.IncludesShadersStore[bD]=YD;W(11380),W(11479),W(11484),W(11497);const tD="gpuRenderParticlesVertexShader",cD="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";b.e.ShadersStore[tD]=cD;class lD extends E{static get IsSupported(){if(!B.b.LastCreatedEngine)return!1;const D=B.b.LastCreatedEngine.getCaps();return D.supportTransformFeedbacks||D.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(D){this._maxActiveParticleCount=Math.min(D,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(D){this.maxActiveParticleCount=D}createPointEmitter(D,j){const W=fD(D,j);return this.particleEmitterType=W,W}createHemisphericEmitter(){const D=FD(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=D,D}createSphereEmitter(){const D=ZD(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=D,D}createDirectedSphereEmitter(){const D=PD(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Q.j(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Q.j(0,1,0));return this.particleEmitterType=D,D}createCylinderEmitter(){const D=XD(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=D,D}createDirectedCylinderEmitter(){const D=xD(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Q.j(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Q.j(0,1,0));return this.particleEmitterType=D,D}createConeEmitter(){const D=RD(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=D,D}createDirectedConeEmitter(){const D=VD(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Q.j(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Q.j(0,1,0));return this.particleEmitterType=D,D}createBoxEmitter(D,j,W,Q){const C=new Z;return this.particleEmitterType=C,this.direction1=D,this.direction2=j,this.minEmitBox=W,this.maxEmitBox=Q,C}isReady(){if(!this.k||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==UD.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(UD.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(UD.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";D?setTimeout((()=>{this.start(0)}),D):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var D;let j=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(D=this._customWrappers[j])||void 0===D?void 0:D.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[D]??this._customWrappers[0]}setCustomEffect(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[j]=new DD.e(this._engine),this._customWrappers[j].effect=D}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new d.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(D,j,W){return super._removeGradientAndTexture(D,j,W),this._releaseBuffers(),this}addColorGradient(D,j){this._colorGradients||(this._colorGradients=[]);const W=new q(D,j);return this._colorGradients.push(W),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(D&&this._colorGradients.sort(((D,j)=>D.gradient<j.gradient?-1:D.gradient>j.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(D){return this._removeGradientAndTexture(D,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const j in this._drawWrappers){var D;null===(D=this._drawWrappers[j].drawContext)||void 0===D||D.reset()}}_addFactorGradient(D,j,W){const Q=new J(j,W);D.push(Q),this._releaseBuffers()}addSizeGradient(D,j){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,D,j),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(D){return this._removeGradientAndTexture(D,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(D,j){if(!D)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&D.sort(((D,j)=>D.gradient<j.gradient?-1:D.gradient>j.gradient?1:0));const W=this;W[j]&&(W[j].dispose(),W[j]=null)}addAngularSpeedGradient(D,j){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,D,j),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(D){return this._removeGradientAndTexture(D,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(D,j){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,D,j),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(D){return this._removeGradientAndTexture(D,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(D,j){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,D,j),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(D){return this._removeGradientAndTexture(D,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(D,j){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,D,j),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(D){return this._removeGradientAndTexture(D,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(D){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(D,j,W){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,k=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(D),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.Qd=new d.d,this.onStoppedObservable=new d.d,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._onBeforeDrawParticlesObservable=null,W&&"Scene"!==W.getClassName()?(this._engine=W,this.defaultProjectionMatrix=Q.b.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=W||B.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.te.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,O.b)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,O.b)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,O.b)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,O.b)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new DD.e(this._engine)},this._customWrappers[0].effect=C,this._drawWrappers={0:new DD.e(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(j=j??{}).randomTextureSize||delete j.randomTextureSize;const M={Ne:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...j},E=j;isFinite(E)&&(M.Ne=E),this._capacity=M.Ne,this._maxActiveParticleCount=M.Ne,this._currentActiveCount=0,this._isAnimationSheetEnabled=k,this.particleEmitterType=new Z;const f=Math.min(this._engine.getCaps().maxTextureSize,M.randomTextureSize);let F=[];for(let Q=0;Q<f;++Q)F.push(Math.random()),F.push(Math.random()),F.push(Math.random()),F.push(Math.random());this._randomTexture=new v.d(new Float32Array(F),f,1,5,W,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,F=[];for(let Q=0;Q<f;++Q)F.push(Math.random()),F.push(Math.random()),F.push(Math.random()),F.push(Math.random());this._randomTexture2=new v.d(new Float32Array(F),f,1,5,W,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=f}_reset(){this._releaseBuffers()}_createVertexBuffers(D,j,W){const Q={};Q.position=j.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let C=3;Q.age=j.createVertexBuffer("age",C,1,this._attributesStrideSize,!0),C+=1,Q.size=j.createVertexBuffer("size",C,3,this._attributesStrideSize,!0),C+=3,Q.life=j.createVertexBuffer("life",C,1,this._attributesStrideSize,!0),C+=1,C+=4,this.billboardMode===UD.BILLBOARDMODE_STRETCHED&&(Q.direction=j.createVertexBuffer("direction",C,3,this._attributesStrideSize,!0)),C+=3,this._platform.alignDataInBuffer&&(C+=1),this.particleEmitterType instanceof G&&(C+=3,this._platform.alignDataInBuffer&&(C+=1)),this._colorGradientsTexture||(Q.color=j.createVertexBuffer("color",C,4,this._attributesStrideSize,!0),C+=4),this._isBillboardBased||(Q.initialDirection=j.createVertexBuffer("initialDirection",C,3,this._attributesStrideSize,!0),C+=3,this._platform.alignDataInBuffer&&(C+=1)),this.noiseTexture&&(Q.noiseCoordinates1=j.createVertexBuffer("noiseCoordinates1",C,3,this._attributesStrideSize,!0),C+=3,this._platform.alignDataInBuffer&&(C+=1),Q.noiseCoordinates2=j.createVertexBuffer("noiseCoordinates2",C,3,this._attributesStrideSize,!0),C+=3,this._platform.alignDataInBuffer&&(C+=1)),Q.angle=j.createVertexBuffer("angle",C,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?C++:C+=2,this._isAnimationSheetEnabled&&(Q.cellIndex=j.createVertexBuffer("cellIndex",C,1,this._attributesStrideSize,!0),C+=1,this.spriteRandomStartCell&&(Q.cellStartOffset=j.createVertexBuffer("cellStartOffset",C,1,this._attributesStrideSize,!0),C+=1)),Q.offset=W.createVertexBuffer("offset",0,2),Q.uv=W.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(Q),this._platform.createVertexBuffers(D,Q),this.resetDrawCache()}_initialize(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!D)return;const j=this._engine,W=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof G&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const C=this.particleEmitterType instanceof G,k=Q.e.Kd[0];let M=0;for(let Q=0;Q<this._capacity;Q++)if(W.push(0),W.push(0),W.push(0),W.push(0),W.push(0),W.push(0),W.push(0),W.push(0),W.push(Math.random()),W.push(Math.random()),W.push(Math.random()),W.push(Math.random()),C?(this.particleEmitterType.particleDestinationGenerator(Q,null,k),W.push(k.x),W.push(k.y),W.push(k.z)):(W.push(0),W.push(0),W.push(0)),this._platform.alignDataInBuffer&&W.push(0),M+=16,C&&(this.particleEmitterType.particlePositionGenerator(Q,null,k),W.push(k.x),W.push(k.y),W.push(k.z),this._platform.alignDataInBuffer&&W.push(0),M+=4),this._colorGradientsTexture||(W.push(0),W.push(0),W.push(0),W.push(0),M+=4),this.isBillboardBased||(W.push(0),W.push(0),W.push(0),this._platform.alignDataInBuffer&&W.push(0),M+=4),this.noiseTexture&&(W.push(Math.random()),W.push(Math.random()),W.push(Math.random()),this._platform.alignDataInBuffer&&W.push(0),W.push(Math.random()),W.push(Math.random()),W.push(Math.random()),this._platform.alignDataInBuffer&&W.push(0),M+=8),W.push(0),M+=1,this._angularSpeedGradientsTexture||(W.push(0),M+=1),this._isAnimationSheetEnabled&&(W.push(0),M+=1,this.spriteRandomStartCell&&(W.push(0),M+=1)),this._platform.alignDataInBuffer){let D=3-(M+3&3);for(M+=D;D-- >0;)W.push(0)}const O=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),E=this._platform.createParticleBuffer(W),f=this._platform.createParticleBuffer(W);this._buffer0=new K.b(j,E,!1,this._attributesStrideSize),this._buffer1=new K.b(j,f,!1,this._attributesStrideSize),this._spriteBuffer=new K.b(j,O,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let D=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(D+="\n#define BILLBOARD"),this._colorGradientsTexture&&(D+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(D+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(D+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(D+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(D+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(D+="\n#define DRAGGRADIENTS"),this.isAnimationSheetEnabled&&(D+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(D+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(D+="\n#define NOISE"),this.isLocal&&(D+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===D||(this._cachedUpdateDefines=D,this._updateBuffer=this._platform.createUpdateBuffer(D)),this._platform.isUpdateBufferReady()}_getWrapper(D){const j=this._getCustomDrawWrapper(D);if(null!==j&&void 0!==j&&j.effect)return j;const W=[];this.fillDefines(W,D);let Q=this._drawWrappers[D];Q||(Q=new DD.e(this._engine),Q.drawContext&&(Q.drawContext.useInstancing=!0),this._drawWrappers[D]=Q);const C=W.join("\n");if(Q.defines!==C){const D=[],j=[],W=[];this.fillUniformsAttributesAndSamplerNames(j,D,W),Q.setEffect(this._engine.createEffect("gpuRenderParticles",D,j,W,C),C)}return Q}static _GetAttributeNamesOrOptions(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0],j=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Q=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const C=[K.f.PositionKind,"age","life","size","angle"];return D||C.push(K.f.ColorKind),j&&C.push("cellIndex"),W||C.push("initialDirection"),Q&&C.push("direction"),C.push("offset",K.f.UVKind),C}static _GetEffectCreationOptions(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0],j=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const Q=["emitterWM","Eg","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,jD.e)(Q),D&&Q.push("sheetInfos"),j&&Q.push("logarithmicDepthConstant"),W&&(Q.push("vFogInfos"),Q.push("vFogColor")),Q}fillDefines(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,jD.n)(this,this._scene,D),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==ND.b.FOGMODE_NONE&&D.push("#define FOG")),j===UD.BLENDMODE_MULTIPLY&&D.push("#define BLENDMULTIPLYMODE"),this.isLocal&&D.push("#define LOCAL"),this.useLogarithmicDepth&&D.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(D.push("#define BILLBOARD"),this.billboardMode){case UD.BILLBOARDMODE_Y:D.push("#define BILLBOARDY");break;case UD.BILLBOARDMODE_STRETCHED:D.push("#define BILLBOARDSTRETCHED");break;case UD.BILLBOARDMODE_ALL:D.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&D.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&D.push("#define ANIMATESHEET"),W&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),D.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(D,j,W){j.push(...lD._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===UD.BILLBOARDMODE_STRETCHED)),D.push(...lD._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),W.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(gD.c.PrepareUniforms(D,this._imageProcessingConfigurationDefines),gD.c.PrepareSamplers(W,this._imageProcessingConfigurationDefines))}animate(){var D;let j=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(j?this.preWarmStepOffset:(null===(D=this._scene)||void 0===D?void 0:D.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(D,j){const W=this[j];if(!D||!D.length||W)return;const Q=new Float32Array(this._rawTextureWidth);for(let C=0;C<this._rawTextureWidth;C++){const j=C/this._rawTextureWidth;h.GetCurrentGradient(j,D,((D,j,W)=>{Q[C]=(0,f.o)(D.factor1,j.factor1,W)}))}this[j]=v.d.CreateRTexture(Q,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[j].name=j.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const D=new Uint8Array(4*this._rawTextureWidth),j=M.l.Xd[0];for(let W=0;W<this._rawTextureWidth;W++){const Q=W/this._rawTextureWidth;h.GetCurrentGradient(Q,this._colorGradients,((Q,C,k)=>{M.h.LerpToRef(Q.color1,C.color1,k,j),D[4*W]=255*j.r,D[4*W+1]=255*j.g,D[4*W+2]=255*j.b,D[4*W+3]=255*j.a}))}this._colorGradientsTexture=v.d.CreateRGBATexture(D,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(D,j){var W,C,k,M;const O=this._getWrapper(D),E=O.effect;this._engine.enableEffect(O);const f=(null===(W=this._scene)||void 0===W?void 0:W.getViewMatrix())||Q.b.IdentityReadOnly;if(E.setMatrix("view",f),E.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),E.setTexture("diffuseSampler",this.particleTexture),E.setVector2("translationPivot",this.translationPivot),E.setVector3("Eg",this.Eg),this.isLocal&&E.setMatrix("emitterWM",j),this._colorGradientsTexture?E.setTexture("colorGradientSampler",this._colorGradientsTexture):E.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const D=this.particleTexture.getBaseSize();E.setFloat3("sheetInfos",this.spriteCellWidth/D.width,this.spriteCellHeight/D.height,D.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const D=this._scene.activeCamera;E.setVector3("eyePosition",D.globalPosition)}const F=E.defines;if(this._scene&&((0,jD.h)(E,this,this._scene),this.applyFog&&(0,WD.f)(this._scene,void 0,E)),F.indexOf("#define BILLBOARDMODE_ALL")>=0){const D=f.clone();D.invert(),E.setMatrix("invView",D)}switch(this.useLogarithmicDepth&&this._scene&&(0,WD.l)(F,E,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(E),D){case UD.BLENDMODE_ADD:this._engine.setAlphaMode(1);break;case UD.BLENDMODE_ONEONE:this._engine.setAlphaMode(6);break;case UD.BLENDMODE_STANDARD:this._engine.setAlphaMode(2);break;case UD.BLENDMODE_MULTIPLY:this._engine.setAlphaMode(4)}return this._platform.bindDrawBuffers(this._targetIndex,E,null!==(C=this._scene)&&void 0!==C&&C.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(E),null!==(k=this._scene)&&void 0!==k&&k.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(M=this._scene)&&void 0!==M&&M.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(D){if(!this.k||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!D)if(this.k.position){D=this.k.getWorldMatrix()}else{const j=this.k;D=Q.e.Matrix[0],Q.b.TranslationToRef(j.x,j.y,j.z,D)}this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this.isLocal||this._updateBuffer.setMatrix("emitterWM",D),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const j=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=j}render(){let D,j=arguments.length>0&&void 0!==arguments[0]&&arguments[0],W=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!j&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let D=0;D<this.preWarmCycles;D++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>1){const D=0|this._accumulatedCount;this._accumulatedCount-=D,this._currentActiveCount+=D}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.k.position){D=this.k.getWorldMatrix()}else{const j=this.k;D=Q.e.Matrix[0],Q.b.TranslationToRef(j.x,j.y,j.z,D)}const C=this._engine;this.updateInAnimate||this._update(D);let k=0;return j||W||(C.setState(!1),this.forceDepthWrite&&C.setDepthWrite(!0),k=this.blendMode===UD.BLENDMODE_MULTIPLYADD?this._render(UD.BLENDMODE_MULTIPLY,D)+this._render(UD.BLENDMODE_ADD,D):this._render(this.blendMode,D),this._engine.setAlphaMode(0)),k}rebuild(){const D=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(D,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,D()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let D=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const j in this._drawWrappers){this._drawWrappers[j].dispose()}if(this._drawWrappers={},this._scene){const D=this._scene.te.indexOf(this);D>-1&&this._scene.te.splice(D,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let j=0;j<this._renderVertexBuffers.length;++j){const D=this._renderVertexBuffers[j];for(const j in D)D[j].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),D&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),D&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.Qd.notifyObservers(this),this.Qd.clear()}clone(D,j){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const Q={...this._customWrappers};let C=null;const k=this._engine;if(k.createEffectForParticles&&null!=this.customShader){C=this.customShader;const D=C.shaderOptions.defines.length>0?C.shaderOptions.defines.join("\n"):"";Q[0]=k.createEffectForParticles(C.shaderPath.fragmentElement,C.shaderOptions.uniforms,C.shaderOptions.samplers,D,void 0,void 0,void 0,this)}const M=this.serialize(W),O=lD.Parse(M,this._scene||this._engine,this._rootUrl);return O.name=D,O.customShader=C,O._customWrappers=Q,void 0===j&&(j=this.k),this.noiseTexture&&(O.noiseTexture=this.noiseTexture.clone()),O.k=j,O}serialize(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const j={};return UD._Serialize(j,this,D),j.activeParticleCount=this.activeParticleCount,j.randomTextureSize=this._randomTextureSize,j.customShader=this.customShader,j}static Parse(D,j,W){let Q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],C=arguments.length>4?arguments[4]:void 0;const k=D.name;let M,O;j instanceof ED.e?M=j:(O=j,M=O.getEngine());const E=new lD(k,{Ne:C||D.Ne,randomTextureSize:D.randomTextureSize},j,null,D.isAnimationSheetEnabled);if(E._rootUrl=W,D.customShader&&M.createEffectForParticles){const j=D.customShader,W=j.shaderOptions.defines.length>0?j.shaderOptions.defines.join("\n"):"",Q=M.createEffectForParticles(j.shaderPath.fragmentElement,j.shaderOptions.uniforms,j.shaderOptions.samplers,W,void 0,void 0,void 0,E);E.setCustomEffect(Q,0),E.customShader=j}return D.id&&(E.id=D.id),D.activeParticleCount&&(E.activeParticleCount=D.activeParticleCount),UD._Parse(D,E,j,W),D.preventAutoStart&&(E.preventAutoStart=D.preventAutoStart),Q||E.preventAutoStart||E.start(),E}}var ID=W(1207),yD=W(12161),mD=W(1186);class aD{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(D){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const j of this.systems)j.k=D;this._emitterNode=D}setEmitterAsSphere(D,j,W){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:D,renderingGroupId:j};const Q=(0,yD.d)("emitterSphere",{diameter:D.diameter,segments:D.segments},W);Q.renderingGroupId=j;const C=new mD.b("emitterSphereMaterial",W);C.emissiveColor=D.color,Q.material=C;for(const k of this.systems)k.k=Q;this._emitterNode=Q}start(D){for(const j of this.systems)D&&(j.k=D),j.start()}dispose(){for(const D of this.systems)D.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const j={systems:[]};for(const W of this.systems)j.systems.push(W.serialize(D));return this._emitterNode&&(j.k=this._emitterCreationOptions),j}static Parse(D,j){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Q=arguments.length>3?arguments[3]:void 0;const C=new aD,k=this.BaseAssetsUrl+"/textures/";j=j||B.b.LastCreatedScene;for(const M of D.systems)C.systems.push(W?lD.Parse(M,j,k,!0,Q):UD.Parse(M,j,k,!0,Q));if(D.k){const W=D.k.options;if("Sphere"===D.k.kind)C.setEmitterAsSphere({diameter:W.diameter,segments:W.segments,color:M.d.Dd(W.color)},D.k.renderingGroupId,j)}return C}}aD.BaseAssetsUrl="https://assets.babylonjs.com/particles";var SD=W(1028);class HD{static CreateDefault(D){let j,W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,Q=arguments.length>2?arguments[2]:void 0;return j=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new lD("default system",{Ne:W},Q):new UD("default system",W,Q),j.k=D,j.particleTexture=new S.e("https://assets.babylonjs.com/textures/flare.png",j.va()),j.createConeEmitter(.1,Math.PI/4),j.color1=new M.h(1,1,1,1),j.color2=new M.h(1,1,1,1),j.colorDead=new M.h(1,1,1,0),j.minSize=.1,j.maxSize=.1,j.minEmitPower=2,j.maxEmitPower=2,j.updateSpeed=1/60,j.emitRate=30,j}static CreateAsync(D,j){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Q=arguments.length>3?arguments[3]:void 0;j||(j=B.b.LastCreatedScene);const C={};return j.addPendingData(C),new Promise(((k,M)=>{if(W&&!lD.IsSupported)return j.removePendingData(C),M("Particle system with GPU is not supported.");ID.f.LoadFile(`${HD.BaseAssetsUrl}/systems/${D}.json`,(D=>{j.removePendingData(C);const M=JSON.parse(D.toString());return k(aD.Parse(M,j,W,Q))}),void 0,void 0,void 0,(()=>(j.removePendingData(C),M(`An error occurred with the creation of your particle system. Check if your type '${D}' exists.`))))}))}static ExportSet(D){const j=new aD;for(const W of D)j.systems.push(W);return j}static ParseFromFileAsync(D,j,W){let Q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",k=arguments.length>5?arguments[5]:void 0;return new Promise(((M,O)=>{const E=new SD.e;E.addEventListener("readystatechange",(()=>{if(4==E.readyState)if(200==E.status){const j=JSON.parse(E.responseText);let O;O=Q?lD.Parse(j,W,C,!1,k):UD.Parse(j,W,C,!1,k),D&&(O.name=D),M(O)}else O("Unable to load the particle system")})),E.open("GET",j),E.send()}))}static ParseFromSnippetAsync(D,j){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",C=arguments.length>4?arguments[4]:void 0;if("_BLANK"===D){const D=this.CreateDefault(null);return D.start(),Promise.resolve(D)}return new Promise(((k,M)=>{const O=new SD.e;O.addEventListener("readystatechange",(()=>{if(4==O.readyState)if(200==O.status){const M=JSON.parse(JSON.parse(O.responseText).jsonPayload),E=JSON.parse(M.particleSystem);let f;f=W?lD.Parse(E,j,Q,!1,C):UD.Parse(E,j,Q,!1,C),f.snippetId=D,k(f)}else M("Unable to load the snippet "+D)})),O.open("GET",this.SnippetUrl+"/"+D.replace(/#/g,"/")),O.send()}))}}HD.BaseAssetsUrl=aD.BaseAssetsUrl,HD.SnippetUrl="https://snippet.babylonjs.com",HD.CreateFromSnippetAsync=HD.ParseFromSnippetAsync;var zD=W(11994),iD=W(1281),pD=W(12167);(0,pD.g)(iD.d.NAME_PARTICLESYSTEM,((D,j,W,Q)=>{const C=(0,pD.k)(iD.d.NAME_PARTICLESYSTEM);if(C&&void 0!==D.te&&null!==D.te)for(let k=0,M=D.te.length;k<M;k++){const M=D.te[k];W.te.push(C(M,j,Q))}})),(0,pD.e)(iD.d.NAME_PARTICLESYSTEM,((D,j,W)=>{if(D.activeParticleCount){return lD.Parse(D,j,W)}return UD.Parse(D,j,W)})),ED.e.prototype.createEffectForParticles=function(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",k=arguments.length>4?arguments[4]:void 0,M=arguments.length>5?arguments[5]:void 0,O=arguments.length>6?arguments[6]:void 0,E=arguments.length>7?arguments[7]:void 0,f=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,F=[],Z=[];const P=[];return E?E.fillUniformsAttributesAndSamplerNames(Z,F,P):(F=UD._GetAttributeNamesOrOptions(),Z=UD._GetEffectCreationOptions()),-1===C.indexOf(" BILLBOARD")&&(C+="\n#define BILLBOARD\n"),null!==E&&void 0!==E&&E.isAnimationSheetEnabled&&-1===C.indexOf(" ANIMATESHEET")&&(C+="\n#define ANIMATESHEET\n"),-1===Q.indexOf("diffuseSampler")&&Q.push("diffuseSampler"),this.createEffect({vertex:(null===E||void 0===E?void 0:E.vertexShaderName)??"particles",fragmentElement:D},F,Z.concat(j),P.concat(Q),C,k,M,O,void 0,f,(async()=>{0===f?await Promise.resolve().then(W.bind(W,12196)):await Promise.resolve().then(W.bind(W,12214))}))},zD.d.prototype.getEmittedParticleSystems=function(){const D=[];for(let j=0;j<this.va().te.length;j++){const W=this.va().te[j];W.k===this&&D.push(W)}return D},zD.d.prototype.getHierarchyEmittedParticleSystems=function(){const D=[],j=this.getDescendants();j.push(this);for(let W=0;W<this.va().te.length;W++){const Q=this.va().te[W],C=Q.k;C.position&&-1!==j.indexOf(C)&&D.push(Q)}return D};W(1357),W(1370),W(12035);W(12016),W(12176),W(1510),W(1347),W(12040);W(1508);var TD;W(12180),W(1009);!function(D){D[D.Color=2]="Color",D[D.UV=1]="UV",D[D.Random=0]="Random",D[D.Stated=3]="Stated"}(TD||(TD={}));W(12187),W(12196),W(12205),W(12214)},11247:(D,j,W)=>{"use strict";const Q="clipPlaneFragment",C="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";W(1108).e.IncludesShadersStoreWGSL[Q]=C},11234:(D,j,W)=>{"use strict";const Q="clipPlaneFragmentDeclaration",C="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";W(1108).e.IncludesShadersStoreWGSL[Q]=C},11143:(D,j,W)=>{"use strict";const Q="clipPlaneVertex",C="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";W(1108).e.IncludesShadersStoreWGSL[Q]=C},11060:(D,j,W)=>{"use strict";const Q="clipPlaneVertexDeclaration",C="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";W(1108).e.IncludesShadersStoreWGSL[Q]=C},11286:(D,j,W)=>{"use strict";const Q="fogFragment",C="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";W(1108).e.IncludesShadersStoreWGSL[Q]=C},11243:(D,j,W)=>{"use strict";const Q="fogFragmentDeclaration",C="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";W(1108).e.IncludesShadersStoreWGSL[Q]=C},11150:(D,j,W)=>{"use strict";const Q="fogVertex",C="#ifdef FOG\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#endif\n";W(1108).e.IncludesShadersStoreWGSL[Q]=C},11067:(D,j,W)=>{"use strict";const Q="fogVertexDeclaration",C="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";W(1108).e.IncludesShadersStoreWGSL[Q]=C},11011:(D,j,W)=>{"use strict";const Q="helperFunctions",C="const PI: f32=3.1415926535897932384626433832795;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3<f32>=vec3<f32> (0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(0.0),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);} \nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3<f32>=inMatrix[0];let i1: vec3<f32>=inMatrix[1];let i2: vec3<f32>=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3<f32>)->vec3<f32>\n{let nearZeroSection: vec3<f32>=0.0773993808*color;let remainingSection: vec3<f32>=pow(0.947867299*(color+vec3<f32>(0.055)),vec3<f32>(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3<f32>(0.04045)));}\nfn toGammaSpaceExact(color: vec3<f32>)->vec3<f32>\n{let nearZeroSection: vec3<f32>=12.92*color;let remainingSection: vec3<f32>=1.055*pow(color,vec3<f32>(0.41666))-vec3<f32>(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3<f32>(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3<f32>)->vec3<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3<f32>(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3<f32>(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3<f32>)->vec3<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3<f32>(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3<f32>)->vec3<f32>\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3<f32>)->f32\n{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3<f32>)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3<f32> =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(clamp(rgb,vec3<f32>(0.,0.,0.),vec3<f32>(1.,1.,1.)),D); }\nfn fromRGBD(rgbd: vec4<f32>)->vec3<f32> {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3<f32>,origVec: vec3<f32>,cubeSize: vec3<f32>,cubePos: vec3<f32>)->vec3<f32> {let invOrigVec: vec3<f32>=vec3<f32>(1.0,1.0,1.0)/origVec;let halfSize: vec3<f32>=cubeSize*0.5;let intersecAtMaxPlane: vec3<f32>=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3<f32>=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3<f32>=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3<f32>=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\n";W(1108).e.IncludesShadersStoreWGSL[Q]=C},11216:(D,j,W)=>{"use strict";const Q="imageProcessingDeclaration",C="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";W(1108).e.IncludesShadersStoreWGSL[Q]=C},11218:(D,j,W)=>{"use strict";const Q="imageProcessingFunctions",C="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";W(1108).e.IncludesShadersStoreWGSL[Q]=C},11091:(D,j,W)=>{"use strict";const Q="logDepthDeclaration",C="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";W(1108).e.IncludesShadersStoreWGSL[Q]=C},11283:(D,j,W)=>{"use strict";const Q="logDepthFragment",C="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";W(1108).e.IncludesShadersStoreWGSL[Q]=C},11171:(D,j,W)=>{"use strict";const Q="logDepthVertex",C="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";W(1108).e.IncludesShadersStoreWGSL[Q]=C},12205:(D,j,W)=>{"use strict";W.r(j),W.d(j,{particlesPixelShaderWGSL:()=>M});var Q=W(1108);W(11234),W(11216),W(11091),W(11011),W(11218),W(11243),W(11247),W(11283),W(11286);const C="particlesPixelShader",k="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";Q.e.ShadersStoreWGSL[C]=k;const M={name:C,shader:k}},12214:(D,j,W)=>{"use strict";W.r(j),W.d(j,{particlesVertexShaderWGSL:()=>M});var Q=W(1108);W(11060),W(11067),W(11091),W(11143),W(11150),W(11171);const C="particlesVertexShader",k="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return input.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";Q.e.ShadersStoreWGSL[C]=k;const M={name:C,shader:k}},11581:(D,j,W)=>{"use strict";const Q="clipPlaneFragment",C="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";W(1108).e.IncludesShadersStore[Q]=C},11577:(D,j,W)=>{"use strict";const Q="clipPlaneFragmentDeclaration",C="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";W(1108).e.IncludesShadersStore[Q]=C},11479:(D,j,W)=>{"use strict";const Q="clipPlaneVertex",C="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";W(1108).e.IncludesShadersStore[Q]=C},11377:(D,j,W)=>{"use strict";const Q="clipPlaneVertexDeclaration",C="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";W(1108).e.IncludesShadersStore[Q]=C},11614:(D,j,W)=>{"use strict";const Q="fogFragment",C="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";W(1108).e.IncludesShadersStore[Q]=C},11579:(D,j,W)=>{"use strict";const Q="fogFragmentDeclaration",C="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";W(1108).e.IncludesShadersStore[Q]=C},11484:(D,j,W)=>{"use strict";const Q="fogVertex",C="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";W(1108).e.IncludesShadersStore[Q]=C},11380:(D,j,W)=>{"use strict";const Q="fogVertexDeclaration",C="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";W(1108).e.IncludesShadersStore[Q]=C},11322:(D,j,W)=>{"use strict";const Q="helperFunctions",C="const float PI=3.1415926535897932384626433832795;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.0;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(clamp(rgb,0.,1.),D); }\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.0,1.0,1.0)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\n";W(1108).e.IncludesShadersStore[Q]=C},11558:(D,j,W)=>{"use strict";const Q="imageProcessingDeclaration",C="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";W(1108).e.IncludesShadersStore[Q]=C},11561:(D,j,W)=>{"use strict";const Q="imageProcessingFunctions",C="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";W(1108).e.IncludesShadersStore[Q]=C},11418:(D,j,W)=>{"use strict";const Q="logDepthDeclaration",C="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";W(1108).e.IncludesShadersStore[Q]=C},11606:(D,j,W)=>{"use strict";const Q="logDepthFragment",C="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";W(1108).e.IncludesShadersStore[Q]=C},11497:(D,j,W)=>{"use strict";const Q="logDepthVertex",C="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";W(1108).e.IncludesShadersStore[Q]=C},12187:(D,j,W)=>{"use strict";W.r(j),W.d(j,{particlesPixelShader:()=>M});var Q=W(1108);W(11577),W(11558),W(11418),W(11322),W(11561),W(11579),W(11581),W(11606),W(11614);const C="particlesPixelShader",k="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";Q.e.ShadersStore[C]=k;const M={name:C,shader:k}},12196:(D,j,W)=>{"use strict";W.r(j),W.d(j,{particlesVertexShader:()=>M});var Q=W(1108);W(11377),W(11380),W(11418),W(11479),W(11484),W(11497);const C="particlesVertexShader",k="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";Q.e.ShadersStore[C]=k;const M={name:C,shader:k}},12011:(D,j,W)=>{"use strict";W.d(j,{e:()=>Z});var Q=W(942),C=W(966),k=W(948),M=W(961),O=W(991),E=W(1070),f=W(1151);class F{constructor(){this._doNotSerialize=!1,this._isDisposed=!1,this._sceneRootNodesIndex=-1,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._onEnabledStateChangedObservable=new M.d,this._onClonedObservable=new M.d}}class Z{static AddNodeConstructor(D,j){this._NodeConstructors[D]=j}static Construct(D,j,W,Q){const C=this._NodeConstructors[D];return C?C(j,W,Q):null}set accessibilityTag(D){this._accessibilityTag=D,this.onAccessibilityTagChangedObservable.notifyObservers(D)}get accessibilityTag(){return this._accessibilityTag}get doNotSerialize(){return!!this._nodeDataStorage._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize}set doNotSerialize(D){this._nodeDataStorage._doNotSerialize=D}u(){return this._nodeDataStorage._isDisposed}set parent(D){if(this._parentNode===D)return;const j=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){const j=this._parentNode._children.indexOf(this);-1!==j&&this._parentNode._children.splice(j,1),D||this._nodeDataStorage._isDisposed||this._addToSceneRootNodes()}this._parentNode=D,this._isDirty=!0,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),j||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}get parent(){return this._parentNode}_serializeAsParent(D){D.parentId=this.uniqueId}_addToSceneRootNodes(){-1===this._nodeDataStorage._sceneRootNodesIndex&&(this._nodeDataStorage._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))}_removeFromSceneRootNodes(){if(-1!==this._nodeDataStorage._sceneRootNodesIndex){const D=this._scene.rootNodes,j=D.length-1;D[this._nodeDataStorage._sceneRootNodesIndex]=D[j],D[this._nodeDataStorage._sceneRootNodesIndex]._nodeDataStorage._sceneRootNodesIndex=this._nodeDataStorage._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._nodeDataStorage._sceneRootNodesIndex=-1}}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(D){this._animationPropertiesOverride=D}getClassName(){return"Node"}set onDispose(D){this._onDisposeObserver&&this.Qd.remove(this._onDisposeObserver),this._onDisposeObserver=this.Qd.add(D)}get onEnabledStateChangedObservable(){return this._nodeDataStorage._onEnabledStateChangedObservable}get onClonedObservable(){return this._nodeDataStorage._onClonedObservable}constructor(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._isDirty=!1,this._nodeDataStorage=new F,this.state="",this.metadata=null,this.reservedDataStore=null,this._accessibilityTag=null,this.onAccessibilityTagChangedObservable=new M.d,this._parentContainer=null,this.animations=[],this._ranges={},this.onReady=null,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._waitingParentInstanceIndex=null,this._waitingParsedUniqueId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=C.b.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._animationPropertiesOverride=null,this._isNode=!0,this.Qd=new M.d,this._onDisposeObserver=null,this._behaviors=new Array,this.name=D,this.id=D,this._scene=j||O.b.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache(),W&&this._addToSceneRootNodes()}va(){return this._scene}getEngine(){return this._scene.getEngine()}addBehavior(D){let j=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return-1!==this._behaviors.indexOf(D)||(D.init(),this._scene.isLoading&&!j?this._scene.onDataLoadedObservable.addOnce((()=>{D.attach(this)})):D.attach(this),this._behaviors.push(D)),this}removeBehavior(D){const j=this._behaviors.indexOf(D);return-1===j||(this._behaviors[j].detach(),this._behaviors.splice(j,1)),this}get behaviors(){return this._behaviors}getBehaviorByName(D){for(const j of this._behaviors)if(j.name===D)return j;return null}getWorldMatrix(){return this._currentRenderId!==this._scene.getRenderId()&&this.Ge(),this._worldMatrix}_getWorldMatrixDeterminant(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant}get worldMatrixFromCache(){return this._worldMatrix}_initCache(){this._cache={}}updateCache(D){!D&&this.isSynchronized()||this._updateCache()}_getActionManagerForTrigger(D){return this.parent?this.parent._getActionManagerForTrigger(D,!1):null}_updateCache(D){}_isSynchronized(){return!0}_markSyncedWithParent(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)}isSynchronizedWithParent(){return!this._parentNode||!this._parentNode._isDirty&&this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()}isSynchronized(){return!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()}isReady(){return this._nodeDataStorage._isReady}Le(D){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}isEnabled(){return!1===(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])?this._nodeDataStorage._isEnabled:!!this._nodeDataStorage._isEnabled&&this._nodeDataStorage._isParentEnabled}_syncParentEnabledState(){this._nodeDataStorage._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children&&this._children.forEach((D=>{D._syncParentEnabledState()}))}Kg(D){this._nodeDataStorage._isEnabled!==D&&(this._nodeDataStorage._isEnabled=D,this._syncParentEnabledState(),this._nodeDataStorage._onEnabledStateChangedObservable.notifyObservers(D))}isDescendantOf(D){return!!this.parent&&(this.parent===D||this.parent.isDescendantOf(D))}_getDescendants(D){let j=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2?arguments[2]:void 0;if(this._children)for(let Q=0;Q<this._children.length;Q++){const C=this._children[Q];W&&!W(C)||D.push(C),j||C._getDescendants(D,!1,W)}}getDescendants(D,j){const W=[];return this._getDescendants(W,D,j),W}getChildMeshes(D,j){const W=[];return this._getDescendants(W,D,(D=>(!j||j(D))&&void 0!==D.We)),W}getChildren(D){let j=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.getDescendants(j,D)}_setReady(D){D!==this._nodeDataStorage._isReady&&(D?(this.onReady&&this.onReady(this),this._nodeDataStorage._isReady=!0):this._nodeDataStorage._isReady=!1)}getAnimationByName(D){for(let j=0;j<this.animations.length;j++){const W=this.animations[j];if(W.name===D)return W}return null}createAnimationRange(D,j,W){if(!this._ranges[D]){this._ranges[D]=Z._AnimationRangeFactory(D,j,W);for(let Q=0,C=this.animations.length;Q<C;Q++)this.animations[Q]&&this.animations[Q].createRange(D,j,W)}}deleteAnimationRange(D){let j=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let W=0,Q=this.animations.length;W<Q;W++)this.animations[W]&&this.animations[W].deleteRange(D,j);this._ranges[D]=null}getAnimationRange(D){return this._ranges[D]||null}clone(D,j,W){const Q=f.d.Clone((()=>new Z(D,this.va())),this);if(j&&(Q.parent=j),!W){const j=this.getDescendants(!0);for(let W=0;W<j.length;W++){const C=j[W];C.clone(D+"."+C.name,Q)}}return Q}getAnimationRanges(){const D=[];let j;for(j in this._ranges)D.push(this._ranges[j]);return D}beginAnimation(D,j,W,Q){const C=this.getAnimationRange(D);return C?this._scene.beginAnimation(this,C.from,C.to,j,W,Q):null}serializeAnimationRanges(){const D=[];for(const j in this._ranges){const W=this._ranges[j];if(!W)continue;const Q={};Q.name=j,Q.from=W.from,Q.to=W.to,D.push(Q)}return D}Ge(D){return this._worldMatrix||(this._worldMatrix=C.b.Identity()),this._worldMatrix}dispose(D){let j=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._nodeDataStorage._isDisposed=!0,!D){const W=this.getDescendants(!0);for(const Q of W)Q.dispose(D,j)}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.Qd.notifyObservers(this),this.Qd.clear(),this.onEnabledStateChangedObservable.clear(),this.onClonedObservable.clear();for(const W of this._behaviors)W.detach();this._behaviors.length=0,this.metadata=null}static ParseAnimationRanges(D,j,W){if(j.ranges)for(let Q=0;Q<j.ranges.length;Q++){const W=j.ranges[Q];D.createAnimationRange(W.name,W.from,W.to)}}getHierarchyBoundingVectors(){let D,j,W=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.va().incrementRenderId(),this.Ge(!0);const k=this;if(k.getBoundingInfo&&k.xe){const W=k.getBoundingInfo();D=W.boundingBox.minimumWorld.clone(),j=W.boundingBox.maximumWorld.clone()}else D=new C.j(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),j=new C.j(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(W){const W=this.getDescendants(!1);for(const k of W){const W=k;if(W.Ge(!0),Q&&!Q(W))continue;if(!W.getBoundingInfo||0===W.getTotalVertices())continue;const M=W.getBoundingInfo().boundingBox,O=M.minimumWorld,E=M.maximumWorld;C.j.CheckExtends(O,D,j),C.j.CheckExtends(E,D,j)}}return{min:D,max:j}}}Z._AnimationRangeFactory=(D,j,W)=>{throw(0,E.d)("AnimationRange")},Z._NodeConstructors={},(0,Q.b)([(0,k.O)()],Z.prototype,"name",void 0),(0,Q.b)([(0,k.O)()],Z.prototype,"id",void 0),(0,Q.b)([(0,k.O)()],Z.prototype,"uniqueId",void 0),(0,Q.b)([(0,k.O)()],Z.prototype,"state",void 0),(0,Q.b)([(0,k.O)()],Z.prototype,"metadata",void 0)},12659:(D,j,W)=>{"use strict";class Q{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((D,j)=>{this._resolve=D,this._reject=j}))}}var C=W(966),k=W(1163),M=W(1207),O=W(12005),E=W(12667),f=W(12673),F=W(961),Z=W(12158),P=W(12682),X=W(12685),x=W(991),R=W(1083),V=W(1209);class U{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(D){this._useTextureToStoreBoneMatrices=D,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(D){this._animationPropertiesOverride=D}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(D,j,W){this.name=D,this.id=j,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=C.b.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new F.d,this.bones=[],this._scene=W||x.b.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const Q=this._scene.getEngine().getCaps();this._canUseTextureForBones=Q.textureFloat&&Q.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((D=>!D.getParent()))}getTransformMatrices(D){if(this.needInitialSkinMatrix){if(!D)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return D._bonesTransformMatrices||this.prepare(!0),D._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(D){return this.needInitialSkinMatrix&&D._transformMatrixTexture?D._transformMatrixTexture:this._transformMatrixTexture}va(){return this._scene}toString(D){let j=`Name: ${this.name}, nBones: ${this.bones.length}`;if(j+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,D){j+=", Ranges: {";let D=!0;for(const W in this._ranges)D&&(j+=", ",D=!1),j+=W;j+="}"}return j}getBoneIndexByName(D){for(let j=0,W=this.bones.length;j<W;j++)if(this.bones[j].name===D)return j;return-1}createAnimationRange(D,j,W){if(!this._ranges[D]){this._ranges[D]=new X.e(D,j,W);for(let Q=0,C=this.bones.length;Q<C;Q++)this.bones[Q].animations[0]&&this.bones[Q].animations[0].createRange(D,j,W)}}deleteAnimationRange(D){let j=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let W=0,Q=this.bones.length;W<Q;W++)this.bones[W].animations[0]&&this.bones[W].animations[0].deleteRange(D,j);this._ranges[D]=null}getAnimationRange(D){return this._ranges[D]||null}getAnimationRanges(){const D=[];let j;for(j in this._ranges)D.push(this._ranges[j]);return D}copyAnimationRange(D,j){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[j]||!D.getAnimationRange(j))return!1;let Q=!0;const C=this._getHighestAnimationFrame()+1,k={},M=D.bones;let O,E;for(E=0,O=M.length;E<O;E++)k[M[E].name]=M[E];this.bones.length!==M.length&&(R.b.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${M.length}`),Q=!1);const f=W&&this.dimensionsAtRest&&D.dimensionsAtRest?this.dimensionsAtRest.divide(D.dimensionsAtRest):null;for(E=0,O=this.bones.length;E<O;E++){const D=this.bones[E].name,M=k[D];M?Q=Q&&this.bones[E].copyAnimationRange(M,j,C,W,f):(R.b.Warn("copyAnimationRange: not same rig, missing source bone "+D),Q=!1)}const F=D.getAnimationRange(j);return F&&(this._ranges[j]=new X.e(j,F.from+C,F.to+C)),Q}returnToRest(){for(const D of this.bones)-1!==D._index&&D.returnToRest()}_getHighestAnimationFrame(){let D=0;for(let j=0,W=this.bones.length;j<W;j++)if(this.bones[j].animations[0]){const W=this.bones[j].animations[0].getHighestFrame();D<W&&(D=W)}return D}beginAnimation(D,j,W,Q){const C=this.getAnimationRange(D);return C?this._scene.beginAnimation(this,C.from,C.to,j,W,Q):null}static MakeAnimationAdditive(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2?arguments[2]:void 0;const Q=D.getAnimationRange(W);if(!Q)return null;const C=D._scene.getAllAnimatablesByTarget(D);let k=null;for(let O=0;O<C.length;O++){const D=C[O];if(D.fromFrame===(null===Q||void 0===Q?void 0:Q.from)&&D.toFrame===(null===Q||void 0===Q?void 0:Q.to)){k=D;break}}const M=D.getAnimatables();for(let O=0;O<M.length;O++){const D=M[O].animations;if(D)for(let Q=0;Q<D.length;Q++)P.c.MakeAnimationAdditive(D[Q],j,W)}return k&&(k.isAdditive=!0),D}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(D){this._meshesWithPoseMatrix.push(D)}_unregisterMeshWithPoseMatrix(D){const j=this._meshesWithPoseMatrix.indexOf(D);j>-1&&this._meshesWithPoseMatrix.splice(j,1)}_computeTransformMatrices(D,j){this.onBeforeComputeObservable.notifyObservers(this);for(let W=0;W<this.bones.length;W++){const Q=this.bones[W];Q._childUpdateId++;const C=Q.getParent();if(C?Q.getLocalMatrix().multiplyToRef(C.getFinalMatrix(),Q.getFinalMatrix()):j?Q.getLocalMatrix().multiplyToRef(j,Q.getFinalMatrix()):Q.getFinalMatrix().p(Q.getLocalMatrix()),-1!==Q._index){const j=null===Q._index?W:Q._index;Q.getAbsoluteInverseBindMatrix().multiplyToArray(Q.getFinalMatrix(),D,16*j)}}this._identity.copyToArray(D,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const D=this.va().getRenderId();if(this._currentRenderId===D)return;this._currentRenderId=D}if(this._numBonesWithLinkedTransformNode>0)for(const D of this.bones)if(D._linkedTransformNode){const j=D._linkedTransformNode;D.position=j.position,j.rotationQuaternion?D.rotationQuaternion=j.rotationQuaternion:D.rotation=j.rotation,D.Pd=j.Pd}if(this.needInitialSkinMatrix)for(const D of this._meshesWithPoseMatrix){const j=D.getPoseMatrix();let W=this._isDirty;if(D._bonesTransformMatrices&&D._bonesTransformMatrices.length===16*(this.bones.length+1)||(D._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),W=!0),W){if(this._synchronizedWithMesh!==D){this._synchronizedWithMesh=D;for(const D of this.bones)if(!D.getParent()){D.getBindMatrix().multiplyToRef(j,C.e.Matrix[1]),D._updateAbsoluteBindMatrices(C.e.Matrix[1])}if(this.isUsingTextureForMatrices){const j=4*(this.bones.length+1);D._transformMatrixTexture&&D._transformMatrixTexture.getSize().width===j||(D._transformMatrixTexture&&D._transformMatrixTexture.dispose(),D._transformMatrixTexture=Z.d.CreateRGBATexture(D._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(D._bonesTransformMatrices,j),this.isUsingTextureForMatrices&&D._transformMatrixTexture&&D._transformMatrixTexture.update(D._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=Z.d.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let D=0;D<this.bones.length;D++)this._animatables.push(this.bones[D])}return this._animatables}clone(D,j){const W=new U(D,j||D,this._scene);W.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let Q=0;Q<this.bones.length;Q++){const D=this.bones[Q];let j=null;const C=D.getParent();if(C){const D=this.bones.indexOf(C);j=W.bones[D]}const k=new f.e(D.name,W,j,D.getBindMatrix().clone(),D.getRestMatrix().clone());k._index=D._index,D._linkedTransformNode&&k.linkTransformNode(D._linkedTransformNode),V.b.DeepCopy(D.animations,k.animations)}if(this._ranges){W._ranges={};for(const D in this._ranges){const j=this._ranges[D];j&&(W._ranges[D]=j.clone())}}return this._isDirty=!0,W.prepare(!0),W}enableBlending(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;this.bones.forEach((j=>{j.animations.forEach((j=>{j.enableBlending=!0,j.blendingSpeed=D}))}))}dispose(){if(this._meshesWithPoseMatrix.length=0,this.va().stopAnimation(this),this.va().removeSkeleton(this),this._parentContainer){const D=this._parentContainer.skeletons.indexOf(this);D>-1&&this._parentContainer.skeletons.splice(D,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const D={};D.name=this.name,D.id=this.id,this.dimensionsAtRest&&(D.dimensionsAtRest=this.dimensionsAtRest.Gd()),D.bones=[],D.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let W=0;W<this.bones.length;W++){var j;const Q=this.bones[W],C=Q.getParent(),k={parentBoneIndex:C?this.bones.indexOf(C):-1,index:Q.getIndex(),name:Q.name,id:Q.id,matrix:Q.getBindMatrix().Gd(),rest:Q.getRestMatrix().Gd(),linkedTransformNodeId:null===(j=Q.getTransformNode())||void 0===j?void 0:j.id};D.bones.push(k),Q.length&&(k.length=Q.length),Q.metadata&&(k.metadata=Q.metadata),Q.animations&&Q.animations.length>0&&(k.animation=Q.animations[0].serialize()),D.ranges=[];for(const j in this._ranges){const W=this._ranges[j];if(!W)continue;const Q={};Q.name=j,Q.from=W.from,Q.to=W.to,D.ranges.push(Q)}}return D}static Parse(D,j){const W=new U(D.name,D.id,j);let Q;for(D.dimensionsAtRest&&(W.dimensionsAtRest=C.j.Dd(D.dimensionsAtRest)),W.needInitialSkinMatrix=D.needInitialSkinMatrix,Q=0;Q<D.bones.length;Q++){const j=D.bones[Q],k=D.bones[Q].index;let M=null;j.parentBoneIndex>-1&&(M=W.bones[j.parentBoneIndex]);const O=j.rest?C.b.Dd(j.rest):null,E=new f.e(j.name,W,M,C.b.Dd(j.matrix),O,null,k);void 0!==j.id&&null!==j.id&&(E.id=j.id),j.length&&(E.length=j.length),j.metadata&&(E.metadata=j.metadata),j.animation&&E.animations.push(P.c.Parse(j.animation)),void 0!==j.linkedTransformNodeId&&null!==j.linkedTransformNodeId&&(W._hasWaitingData=!0,E._waitingTransformNodeId=j.linkedTransformNodeId)}if(D.ranges)for(Q=0;Q<D.ranges.length;Q++){const j=D.ranges[Q];W.createAnimationRange(j.name,j.from,j.to)}return W}computeAbsoluteMatrices(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||D)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(D)}getPoseMatrix(){let D=null;return this._meshesWithPoseMatrix.length>0&&(D=this._meshesWithPoseMatrix[0].getPoseMatrix()),D}sortBones(){const D=[],j=new Array(this.bones.length);for(let W=0;W<this.bones.length;W++)this._sortBones(W,D,j);this.bones=D}_sortBones(D,j,W){if(W[D])return;W[D]=!0;const Q=this.bones[D];if(!Q)return;void 0===Q._index&&(Q._index=D);const C=Q.getParent();C&&this._sortBones(this.bones.indexOf(C),j,W),j.push(Q)}setCurrentPoseAsRest(){this.bones.forEach((D=>{D.setCurrentPoseAsRest()}))}}var g=W(1344),N=W(942),G=W(948),K=W(12691),L=W(12698),e=W(981),s=W(1151);class b extends L.d{get refractionTexture(){return this.subSurface.refractionTexture}set refractionTexture(D){this.subSurface.refractionTexture=D,D?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)}get indexOfRefraction(){return this.subSurface.indexOfRefraction}set indexOfRefraction(D){this.subSurface.indexOfRefraction=D}get invertRefractionY(){return this.subSurface.invertRefractionY}set invertRefractionY(D){this.subSurface.invertRefractionY=D}get linkRefractionWithTransparency(){return this.subSurface.linkRefractionWithTransparency}set linkRefractionWithTransparency(D){this.subSurface.linkRefractionWithTransparency=D,D&&(this.subSurface.isRefractionEnabled=!0)}get usePhysicalLightFalloff(){return this._lightFalloff===L.d.LIGHTFALLOFF_PHYSICAL}set usePhysicalLightFalloff(D){D!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=D?L.d.LIGHTFALLOFF_PHYSICAL:L.d.LIGHTFALLOFF_STANDARD)}get useGLTFLightFalloff(){return this._lightFalloff===L.d.LIGHTFALLOFF_GLTF}set useGLTFLightFalloff(D){D!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=D?L.d.LIGHTFALLOFF_GLTF:L.d.LIGHTFALLOFF_STANDARD)}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(D){this._attachImageProcessingConfiguration(D),this._markAllSubMeshesAsTexturesDirty()}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(D){this.imageProcessingConfiguration.colorCurvesEnabled=D}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(D){this.imageProcessingConfiguration.colorGradingEnabled=D}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(D){this._imageProcessingConfiguration.toneMappingEnabled=D}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(D){this._imageProcessingConfiguration.exposure=D}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(D){this._imageProcessingConfiguration.contrast=D}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(D){this._imageProcessingConfiguration.colorGradingTexture=D}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(D){this._imageProcessingConfiguration.colorCurves=D}constructor(D,j){super(D,j,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.directIntensity=1,this.emissiveIntensity=1,this.environmentIntensity=1,this.specularIntensity=1,this.disableBumpMap=!1,this.ambientTextureStrength=1,this.ambientTextureImpactOnAnalyticalLights=b.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this.metallicF0Factor=1,this.metallicReflectanceColor=k.d.White(),this.useOnlyMetallicFromMetallicReflectanceTexture=!1,this.ambientColor=new k.d(0,0,0),this.albedoColor=new k.d(1,1,1),this.reflectivityColor=new k.d(1,1,1),this.reflectionColor=new k.d(1,1,1),this.emissiveColor=new k.d(0,0,0),this.microSurface=1,this.useLightmapAsShadowmap=!1,this.useAlphaFromAlbedoTexture=!1,this.forceAlphaTest=!1,this.alphaCutOff=.4,this.useSpecularOverAlpha=!0,this.useMicroSurfaceFromReflectivityMapAlpha=!1,this.useRoughnessFromMetallicTextureAlpha=!0,this.useRoughnessFromMetallicTextureGreen=!1,this.useMetallnessFromMetallicTextureBlue=!1,this.useAmbientOcclusionFromMetallicTextureRed=!1,this.useAmbientInGrayScale=!1,this.useAutoMicroSurfaceFromReflectivityMap=!1,this.useRadianceOverAlpha=!0,this.useObjectSpaceNormalMap=!1,this.useParallax=!1,this.useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this.disableLighting=!1,this.forceIrradianceInFragment=!1,this.maxSimultaneousLights=4,this.invertNormalMapX=!1,this.invertNormalMapY=!1,this.twoSidedLighting=!1,this.useAlphaFresnel=!1,this.useLinearAlphaFresnel=!1,this.environmentBRDFTexture=null,this.forceNormalForward=!1,this.enableSpecularAntiAliasing=!1,this.useHorizonOcclusion=!0,this.useRadianceOcclusion=!0,this.unlit=!1,this.applyDecalMapAfterDetailMap=!1,this._environmentBRDFTexture=(0,K.e)(this.va())}getClassName(){return"PBRMaterial"}clone(D){let j=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const Q=s.d.Clone((()=>new b(D,this.va())),this,{cloneTexturesOnlyOnce:j});return Q.id=D,Q.name=D,this.stencil.copyTo(Q.stencil),this._clonePlugins(Q,W),Q}serialize(){const D=super.serialize();return D.customType="BABYLON.PBRMaterial",D}static Parse(D,j,W){const Q=s.d.Parse((()=>new b(D.name,j)),D,j,W);return D.stencil&&Q.stencil.parse(D.stencil,j,W),g.c._ParsePlugins(D,Q,j,W),D.clearCoat&&Q.clearCoat.parse(D.clearCoat,j,W),D.anisotropy&&Q.anisotropy.parse(D.anisotropy,j,W),D.brdf&&Q.brdf.parse(D.brdf,j,W),D.sheen&&Q.sheen.parse(D.sheen,j,W),D.subSurface&&Q.subSurface.parse(D.subSurface,j,W),D.iridescence&&Q.iridescence.parse(D.iridescence,j,W),Q}}b.PBRMATERIAL_OPAQUE=L.d.PBRMATERIAL_OPAQUE,b.PBRMATERIAL_ALPHATEST=L.d.PBRMATERIAL_ALPHATEST,b.PBRMATERIAL_ALPHABLEND=L.d.PBRMATERIAL_ALPHABLEND,b.PBRMATERIAL_ALPHATESTANDBLEND=L.d.PBRMATERIAL_ALPHATESTANDBLEND,b.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=L.d.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,(0,N.b)([(0,G.O)(),(0,G.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"directIntensity",void 0),(0,N.b)([(0,G.O)(),(0,G.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"emissiveIntensity",void 0),(0,N.b)([(0,G.O)(),(0,G.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"environmentIntensity",void 0),(0,N.b)([(0,G.O)(),(0,G.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"specularIntensity",void 0),(0,N.b)([(0,G.O)(),(0,G.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"disableBumpMap",void 0),(0,N.b)([(0,G.I)(),(0,G.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"albedoTexture",void 0),(0,N.b)([(0,G.I)(),(0,G.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"ambientTexture",void 0),(0,N.b)([(0,G.O)(),(0,G.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"ambientTextureStrength",void 0),(0,N.b)([(0,G.O)(),(0,G.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),(0,N.b)([(0,G.I)(),(0,G.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],b.prototype,"opacityTexture",void 0),(0,N.b)([(0,G.I)(),(0,G.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"reflectionTexture",void 0),(0,N.b)([(0,G.I)(),(0,G.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"emissiveTexture",void 0),(0,N.b)([(0,G.I)(),(0,G.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"reflectivityTexture",void 0),(0,N.b)([(0,G.I)(),(0,G.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"metallicTexture",void 0),(0,N.b)([(0,G.O)(),(0,G.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"metallic",void 0),(0,N.b)([(0,G.O)(),(0,G.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"roughness",void 0),(0,N.b)([(0,G.O)(),(0,G.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"metallicF0Factor",void 0),(0,N.b)([(0,G.n)(),(0,G.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"metallicReflectanceColor",void 0),(0,N.b)([(0,G.O)(),(0,G.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"useOnlyMetallicFromMetallicReflectanceTexture",void 0),(0,N.b)([(0,G.I)(),(0,G.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"metallicReflectanceTexture",void 0),(0,N.b)([(0,G.I)(),(0,G.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"reflectanceTexture",void 0),(0,N.b)([(0,G.I)(),(0,G.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"microSurfaceTexture",void 0),(0,N.b)([(0,G.I)(),(0,G.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"bumpTexture",void 0),(0,N.b)([(0,G.I)(),(0,G.e)("_markAllSubMeshesAsTexturesDirty",null)],b.prototype,"lightmapTexture",void 0),(0,N.b)([(0,G.n)("ambient"),(0,G.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"ambientColor",void 0),(0,N.b)([(0,G.n)("albedo"),(0,G.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"albedoColor",void 0),(0,N.b)([(0,G.n)("reflectivity"),(0,G.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"reflectivityColor",void 0),(0,N.b)([(0,G.n)("reflection"),(0,G.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"reflectionColor",void 0),(0,N.b)([(0,G.n)("emissive"),(0,G.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"emissiveColor",void 0),(0,N.b)([(0,G.O)(),(0,G.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"microSurface",void 0),(0,N.b)([(0,G.O)(),(0,G.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"useLightmapAsShadowmap",void 0),(0,N.b)([(0,G.O)(),(0,G.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],b.prototype,"useAlphaFromAlbedoTexture",void 0),(0,N.b)([(0,G.O)(),(0,G.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],b.prototype,"forceAlphaTest",void 0),(0,N.b)([(0,G.O)(),(0,G.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],b.prototype,"alphaCutOff",void 0),(0,N.b)([(0,G.O)(),(0,G.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"useSpecularOverAlpha",void 0),(0,N.b)([(0,G.O)(),(0,G.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),(0,N.b)([(0,G.O)(),(0,G.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),(0,N.b)([(0,G.O)(),(0,G.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"useRoughnessFromMetallicTextureGreen",void 0),(0,N.b)([(0,G.O)(),(0,G.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"useMetallnessFromMetallicTextureBlue",void 0),(0,N.b)([(0,G.O)(),(0,G.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),(0,N.b)([(0,G.O)(),(0,G.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"useAmbientInGrayScale",void 0),(0,N.b)([(0,G.O)(),(0,G.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),(0,N.b)([(0,G.O)()],b.prototype,"usePhysicalLightFalloff",null),(0,N.b)([(0,G.O)()],b.prototype,"useGLTFLightFalloff",null),(0,N.b)([(0,G.O)(),(0,G.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"useRadianceOverAlpha",void 0),(0,N.b)([(0,G.O)(),(0,G.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"useObjectSpaceNormalMap",void 0),(0,N.b)([(0,G.O)(),(0,G.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"useParallax",void 0),(0,N.b)([(0,G.O)(),(0,G.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"useParallaxOcclusion",void 0),(0,N.b)([(0,G.O)(),(0,G.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"parallaxScaleBias",void 0),(0,N.b)([(0,G.O)(),(0,G.e)("_markAllSubMeshesAsLightsDirty")],b.prototype,"disableLighting",void 0),(0,N.b)([(0,G.O)(),(0,G.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"forceIrradianceInFragment",void 0),(0,N.b)([(0,G.O)(),(0,G.e)("_markAllSubMeshesAsLightsDirty")],b.prototype,"maxSimultaneousLights",void 0),(0,N.b)([(0,G.O)(),(0,G.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"invertNormalMapX",void 0),(0,N.b)([(0,G.O)(),(0,G.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"invertNormalMapY",void 0),(0,N.b)([(0,G.O)(),(0,G.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"twoSidedLighting",void 0),(0,N.b)([(0,G.O)(),(0,G.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"useAlphaFresnel",void 0),(0,N.b)([(0,G.O)(),(0,G.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"useLinearAlphaFresnel",void 0),(0,N.b)([(0,G.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"environmentBRDFTexture",void 0),(0,N.b)([(0,G.O)(),(0,G.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"forceNormalForward",void 0),(0,N.b)([(0,G.O)(),(0,G.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"enableSpecularAntiAliasing",void 0),(0,N.b)([(0,G.O)(),(0,G.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"useHorizonOcclusion",void 0),(0,N.b)([(0,G.O)(),(0,G.e)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"useRadianceOcclusion",void 0),(0,N.b)([(0,G.O)(),(0,G.e)("_markAllSubMeshesAsMiscDirty")],b.prototype,"unlit",void 0),(0,N.b)([(0,G.O)(),(0,G.e)("_markAllSubMeshesAsMiscDirty")],b.prototype,"applyDecalMapAfterDetailMap",void 0),(0,e.c)("BABYLON.PBRMaterial",b);var Y=W(936),t=W(12037),c=W(1256),l=W(12021),I=W(12035),y=W(11994);class m{get influence(){return this._influence}set influence(D){if(this._influence===D)return;const j=this._influence;this._influence=D,this.onInfluenceChanged.hasObservers()&&this.onInfluenceChanged.notifyObservers(0===j||0===D)}get animationPropertiesOverride(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride}set animationPropertiesOverride(D){this._animationPropertiesOverride=D}constructor(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.name=D,this.animations=[],this._positions=null,this._normals=null,this._tangents=null,this._uvs=null,this._uniqueId=0,this.onInfluenceChanged=new F.d,this._onDataLayoutChanged=new F.d,this._animationPropertiesOverride=null,this.id=D,this._scene=W||x.b.LastCreatedScene,this.influence=j,this._scene&&(this._uniqueId=this._scene.getUniqueId())}get uniqueId(){return this._uniqueId}get hasPositions(){return!!this._positions}get hasNormals(){return!!this._normals}get hasTangents(){return!!this._tangents}get hasUVs(){return!!this._uvs}setPositions(D){const j=this.hasPositions;this._positions=D,j!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)}getPositions(){return this._positions}setNormals(D){const j=this.hasNormals;this._normals=D,j!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)}getNormals(){return this._normals}setTangents(D){const j=this.hasTangents;this._tangents=D,j!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)}getTangents(){return this._tangents}setUVs(D){const j=this.hasUVs;this._uvs=D,j!==this.hasUVs&&this._onDataLayoutChanged.notifyObservers(void 0)}getUVs(){return this._uvs}clone(){const D=s.d.Clone((()=>new m(this.name,this.influence,this._scene)),this);return D._positions=this._positions,D._normals=this._normals,D._tangents=this._tangents,D._uvs=this._uvs,D}serialize(){const D={};return D.name=this.name,D.influence=this.influence,D.xa=Array.prototype.slice.call(this.getPositions()),null!=this.id&&(D.id=this.id),this.hasNormals&&(D.ya=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(D.tangents=Array.prototype.slice.call(this.getTangents())),this.hasUVs&&(D.Aa=Array.prototype.slice.call(this.getUVs())),s.d.AppendSerializedAnimations(this,D),D}getClassName(){return"MorphTarget"}static Parse(D,j){const W=new m(D.name,D.influence);if(W.setPositions(D.xa),null!=D.id&&(W.id=D.id),D.ya&&W.setNormals(D.ya),D.tangents&&W.setTangents(D.tangents),D.Aa&&W.setUVs(D.Aa),D.animations){for(let j=0;j<D.animations.length;j++){const Q=D.animations[j],C=(0,e.b)("BABYLON.Animation");C&&W.animations.push(C.Parse(Q))}D.autoAnimate&&j&&j.beginAnimation(W,D.autoAnimateFrom,D.autoAnimateTo,D.autoAnimateLoop,D.autoAnimateSpeed||1)}return W}static FromMesh(D,j,W){j||(j=D.name);const Q=new m(j,W,D.va());return Q.setPositions(D.getVerticesData(c.f.PositionKind)),D.isVerticesDataPresent(c.f.NormalKind)&&Q.setNormals(D.getVerticesData(c.f.NormalKind)),D.isVerticesDataPresent(c.f.TangentKind)&&Q.setTangents(D.getVerticesData(c.f.TangentKind)),D.isVerticesDataPresent(c.f.UVKind)&&Q.setUVs(D.getVerticesData(c.f.UVKind)),Q}}(0,N.b)([(0,G.O)()],m.prototype,"id",void 0);var a=W(1191),S=W(1576);class H{set areUpdatesFrozen(D){D?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(!0)))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new a.i(16),this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,D||(D=x.b.LastCreatedScene),this._scene=D,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const D=this._scene.getEngine().getCaps();this._canUseTextureForTargets=D.canUseGLVertexID&&D.textureFloat&&D.maxVertexTextureImageUnits>0&&D.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return this._numMaxInfluencers}set numMaxInfluencers(D){this._numMaxInfluencers!==D&&(this._numMaxInfluencers=D,this._syncActiveTargets(!0))}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(D){this._useTextureToStoreTargets=D}get isUsingTextureForTargets(){var D;return H.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(D=this._scene)&&void 0!==D&&D.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(D){return this._activeTargets.data[D]}getTarget(D){return this._targets[D]}getTargetByName(D){for(const j of this._targets)if(j.name===D)return j;return null}addTarget(D){this._targets.push(D),this._targetInfluenceChangedObservers.push(D.onInfluenceChanged.add((D=>{this._syncActiveTargets(D)}))),this._targetDataLayoutChangedObservers.push(D._onDataLayoutChanged.add((()=>{this._syncActiveTargets(!0)}))),this._syncActiveTargets(!0)}removeTarget(D){const j=this._targets.indexOf(D);j>=0&&(this._targets.splice(j,1),D.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(j,1)[0]),D._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(j,1)[0]),this._syncActiveTargets(!0)),this._scene&&this._scene.stopAnimation(D)}_bind(D){D.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),D.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),D.setTexture("morphTargets",this._targetStoreTexture),D.setInt("morphTargetCount",this.numInfluencers)}clone(){const D=new H(this._scene);for(const j of this._targets)D.addTarget(j.clone());return D.enableNormalMorphing=this.enableNormalMorphing,D.enableTangentMorphing=this.enableTangentMorphing,D.enableUVMorphing=this.enableUVMorphing,D}serialize(){const D={};D.id=this.uniqueId,D.targets=[];for(const j of this._targets)D.targets.push(j.serialize());return D}_syncActiveTargets(D){if(this.areUpdatesFrozen)return;let j=0;this._activeTargets.reset(),this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._vertexCount=0,this._scene&&this._targets.length>this._scene.getEngine().getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let W=-1;for(const Q of this._targets){if(W++,0===Q.influence&&this.optimizeInfluencers)continue;if(this._activeTargets.length>=H.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(Q),this._morphTargetTextureIndices[j]=W,this._tempInfluences[j++]=Q.influence,this._supportsNormals=this._supportsNormals&&Q.hasNormals,this._supportsTangents=this._supportsTangents&&Q.hasTangents,this._supportsUVs=this._supportsUVs&&Q.hasUVs;const D=Q.getPositions();if(D){const j=D.length/3;if(0===this._vertexCount)this._vertexCount=j;else if(this._vertexCount!==j)return void R.b.Error("Incompatible target. Targets must all have the same vertices count.")}}this._morphTargetTextureIndices.length!==j&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,j)),this._influences&&this._influences.length===j||(this._influences=new Float32Array(j));for(let Q=0;Q<j;Q++)this._influences[Q]=this._tempInfluences[Q];D&&this.synchronize()}synchronize(){if(this._scene&&!this.areUpdatesFrozen){if(this.isUsingTextureForTargets&&(this._vertexCount||this.numMaxInfluencers>0)){this._textureVertexStride=1,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const D=this._scene.getEngine().getCaps().maxTextureSize;this._textureWidth>D&&(this._textureHeight=Math.ceil(this._textureWidth/D),this._textureWidth=D);let j=!0;if(this._targetStoreTexture){const D=this._targetStoreTexture.getSize();D.width===this._textureWidth&&D.height===this._textureHeight&&this._targetStoreTexture.depth===this._targets.length&&(j=!1)}if(j){this._targetStoreTexture&&this._targetStoreTexture.dispose();const D=this._targets.length,j=new Float32Array(D*this._textureWidth*this._textureHeight*4);let W=0;for(let Q=0;Q<D;Q++){const D=this._targets[Q],C=D.getPositions(),k=D.getNormals(),M=D.getUVs(),O=D.getTangents();if(!C)return void(0===Q&&R.b.Error("Invalid morph target. Target must have positions."));W=Q*this._textureWidth*this._textureHeight*4;for(let Q=0;Q<this._vertexCount;Q++)j[W]=C[3*Q],j[W+1]=C[3*Q+1],j[W+2]=C[3*Q+2],W+=4,this._supportsNormals&&k&&(j[W]=k[3*Q],j[W+1]=k[3*Q+1],j[W+2]=k[3*Q+2],W+=4),this._supportsUVs&&M&&(j[W]=M[2*Q],j[W+1]=M[2*Q+1],W+=4),this._supportsTangents&&O&&(j[W]=O[3*Q],j[W+1]=O[3*Q+1],j[W+2]=O[3*Q+2],W+=4)}this._targetStoreTexture=S.d.CreateRGBATexture(j,this._textureWidth,this._textureHeight,D,this._scene,!1,!1,1,1)}}for(const D of this._scene.meshes)D.morphTargetManager===this&&D._syncGeometryWithMorphTargetManager()}}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const D=this._parentContainer.morphTargetManagers.indexOf(this);D>-1&&this._parentContainer.morphTargetManagers.splice(D,1),this._parentContainer=null}for(const D of this._targets)this._scene.stopAnimation(D)}}static Parse(D,j){const W=new H(j);for(const Q of D.targets)W.addTarget(m.Parse(Q,j));return W}}H.EnableTextureStorage=!0,H.MaxActiveMorphTargetsInVertexAttributeMode=8;var z=W(12701),i=W(1019),p=W(1357);function T(D,j,W,Q){return C.j.Dd(j,W).scaleInPlace(Q)}class A{constructor(D,j,W,Q){this.type=D,this.name=j,this.getValue=W,this.getStride=Q}_buildAnimation(D,j,W){const Q=new P.c(D,this.name,j,this.type);return Q.setKeys(W),Q}}class w extends A{buildAnimations(D,j,W,Q,C){C(D._babylonTransformNode,this._buildAnimation(j,W,Q))}}const n={translation:[new w(P.c.ANIMATIONTYPE_VECTOR3,"position",T,(()=>3))],rotation:[new w(P.c.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",(function(D,j,W,Q){return C.d.Dd(j,W).scaleInPlace(Q)}),(()=>4))],scale:[new w(P.c.ANIMATIONTYPE_VECTOR3,"Pd",T,(()=>3))],weights:[new class extends A{buildAnimations(D,j,W,Q,C){if(D._numMorphTargets)for(let k=0;k<D._numMorphTargets;k++){const M=new P.c(`${j}_${k}`,this.name,W,this.type);if(M.setKeys(Q.map((D=>({frame:D.frame,inTangent:D.inTangent?D.inTangent[k]:void 0,value:D.value[k],outTangent:D.outTangent?D.outTangent[k]:void 0,interpolation:D.interpolation})))),D._primitiveBabylonMeshes)for(const j of D._primitiveBabylonMeshes)if(j.morphTargetManager){const D=j.morphTargetManager.getTarget(k),W=M.clone();D.animations.push(W),C(D,W)}}}}(P.c.ANIMATIONTYPE_FLOAT,"influence",(function(D,j,W,Q){const C=new Array(D._numMorphTargets);for(let k=0;k<C.length;k++)C[k]=j[W++]*Q;return C}),(D=>D._numMorphTargets))]},u=new Map,q=u;function o(D,j,W){J(D)&&R.b.Warn(`Extension with the name '${D}' already exists`),u.set(D,{isGLTFExtension:j,factory:W})}function J(D){return u.delete(D)}function h(){const D=D=>D&&"object"===typeof D;for(var j=arguments.length,W=new Array(j),Q=0;Q<j;Q++)W[Q]=arguments[Q];return W.reduce(((j,W)=>(Object.keys(W).forEach((Q=>{const C=j[Q],k=W[Q];Array.isArray(C)&&Array.isArray(k)?j[Q]=C.concat(...k):D(C)&&D(k)?j[Q]=h(C,k):j[Q]=k})),j)),{})}class d{static Get(D,j,W){if(!j||void 0==W||!j[W])throw new Error(`${D}: Failed to find index (${W})`);return j[W]}static TryGet(D,j){return D&&void 0!=j&&D[j]?D[j]:null}static Assign(D){if(D)for(let j=0;j<D.length;j++)D[j].index=j}}class v{static RegisterExtension(D,j){o(D,!1,j)}static UnregisterExtension(D){return J(D)}get kj(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(D){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=D}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((D=>D.dispose&&D.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}importMeshAsync(D,j,W,Q,C,k){let M=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return Promise.resolve().then((()=>{this._babylonScene=j,this._assetContainer=W,this._loadData(Q);let k=null;if(D){const j={};if(this._gltf.nodes)for(const D of this._gltf.nodes)D.name&&(j[D.name]=D.index);k=(D instanceof Array?D:[D]).map((D=>{const W=j[D];if(void 0===W)throw new Error(`Failed to find node '${D}'`);return W}))}return this._loadAsync(C,M,k,(()=>({meshes:this._getMeshes(),te:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}loadAsync(D,j,W,Q){let C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return Promise.resolve().then((()=>(this._babylonScene=D,this._loadData(j),this._loadAsync(W,C,null,(()=>{})))))}_loadAsync(D,j,W,Q){return Promise.resolve().then((async()=>{this._rootUrl=D,this._uniqueRootUrl=!D.startsWith("file:")&&j?D:`${D}${Date.now()}/`,this._fileName=j,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const C=`${z.h[z.h.LOADING]} => ${z.h[z.h.READY]}`,k=`${z.h[z.h.LOADING]} => ${z.h[z.h.COMPLETE]}`;this._parent._startPerformanceCounter(C),this._parent._startPerformanceCounter(k),this._parent._setState(z.h.LOADING),this._extensionsOnLoading();const O=new Array;if(!this.parent.loadOnlyMaterials)if(W)O.push(this.loadSceneAsync("/nodes",{nodes:W,index:-1}));else if(void 0!=this._gltf.Be||this._gltf.scenes&&this._gltf.scenes[0]){const D=d.Get("/scene",this._gltf.scenes,this._gltf.Be||0);O.push(this.loadSceneAsync(`/scenes/${D.index}`,D))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let D=0;D<this._gltf.materials.length;++D){const j=this._gltf.materials[D],W="/materials/"+D,Q=g.c.TriangleFillMode;O.push(this._loadMaterialAsync(W,j,null,Q,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&O.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&O.push(this._compileShadowGeneratorsAsync());return Promise.all(O).then((()=>(this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.Kg(!0),this._extensionsOnReady(),this._parent._setState(z.h.READY),this._startAnimations(),Q()))).then((D=>(this._parent._endPerformanceCounter(C),M.f.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(k),this._parent._setState(z.h.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(D=>{this._parent.onErrorObservable.notifyObservers(D),this._parent.onErrorObservable.clear(),this.dispose()}))})),D)))})).catch((D=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(D),this._parent.onErrorObservable.clear(),this.dispose()),D}))}_loadData(D){if(this._gltf=D.json,this._setupData(),D.bin){const j=this._gltf.buffers;if(j&&j[0]&&!j[0].uri){const W=j[0];(W.byteLength<D.bin.byteLength-3||W.byteLength>D.bin.byteLength)&&R.b.Warn(`Binary buffer length (${W.byteLength}) from JSON does not match chunk length (${D.bin.byteLength})`),this._bin=D.bin}else R.b.Warn("Unexpected BIN chunk")}}_setupData(){if(d.Assign(this._gltf.accessors),d.Assign(this._gltf.animations),d.Assign(this._gltf.buffers),d.Assign(this._gltf.bufferViews),d.Assign(this._gltf.cameras),d.Assign(this._gltf.images),d.Assign(this._gltf.materials),d.Assign(this._gltf.meshes),d.Assign(this._gltf.nodes),d.Assign(this._gltf.samplers),d.Assign(this._gltf.scenes),d.Assign(this._gltf.skins),d.Assign(this._gltf.textures),this._gltf.nodes){const D={};for(const W of this._gltf.nodes)if(W.children)for(const j of W.children)D[j]=W.index;const j=this._createRootNode();for(const W of this._gltf.nodes){const Q=D[W.index];W.parent=void 0===Q?j:this._gltf.nodes[Q]}}}async _loadExtensionsAsync(){const D=[];if(q.forEach(((j,W)=>{var Q;!1===(null===(Q=this.parent.extensionOptions[W])||void 0===Q?void 0:Q.enabled)?j.isGLTFExtension&&this.isExtensionUsed(W)&&R.b.Warn(`Extension ${W} is used but has been explicitly disabled.`):j.isGLTFExtension&&!this.isExtensionUsed(W)||D.push((async()=>{const D=await j.factory(this);return D.name!==W&&R.b.Warn(`The name of the glTF loader extension instance does not match the registered name: ${D.name} !== ${W}`),this._parent.onExtensionLoadedObservable.notifyObservers(D),D})())})),this._extensions.push(...await Promise.all(D)),this._extensions.sort(((D,j)=>(D.order||Number.MAX_VALUE)-(j.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const W of this._gltf.extensionsRequired){if(!this._extensions.some((D=>D.name===W&&D.enabled))){var j;if(!1===(null===(j=this.parent.extensionOptions[W])||void 0===j?void 0:j.enabled))throw new Error(`Required extension ${W} is disabled`);throw new Error(`Required extension ${W} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const D=new y.d("__root__",this._babylonScene);this._rootBabylonMesh=D,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.Kg(!1);const j={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case z.f.AUTO:this._babylonScene.useRightHandedSystem||(j.rotation=[0,1,0,0],j.scale=[1,1,-1],v._LoadTransform(j,this._rootBabylonMesh));break;case z.f.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(D),j}loadSceneAsync(D,j){const W=this._extensionsLoadSceneAsync(D,j);if(W)return W;const Q=new Array;if(this.logOpen(`${D} ${j.name||""}`),j.nodes)for(const C of j.nodes){const j=d.Get(`${D}/nodes/${C}`,this._gltf.nodes,C);Q.push(this.loadNodeAsync(`/nodes/${j.index}`,j,(D=>{D.parent=this._rootBabylonMesh})))}for(const C of this._postSceneLoadActions)C();return Q.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(Q).then((()=>{}))}_forEachPrimitive(D,j){if(D._primitiveBabylonMeshes)for(const W of D._primitiveBabylonMeshes)j(W)}_getGeometries(){const D=[],j=this._gltf.nodes;if(j)for(const W of j)this._forEachPrimitive(W,(j=>{const W=j.Ie;W&&-1===D.indexOf(W)&&D.push(W)}));return D}_getMeshes(){const D=[];this._rootBabylonMesh instanceof I.c&&D.push(this._rootBabylonMesh);const j=this._gltf.nodes;if(j)for(const W of j)this._forEachPrimitive(W,(j=>{D.push(j)}));return D}_getTransformNodes(){const D=[],j=this._gltf.nodes;if(j)for(const W of j)W._babylonTransformNode&&"mb"===W._babylonTransformNode.getClassName()&&D.push(W._babylonTransformNode),W._babylonTransformNodeForSkin&&D.push(W._babylonTransformNodeForSkin);return D}_getSkeletons(){const D=[],j=this._gltf.skins;if(j)for(const W of j)W._data&&D.push(W._data.babylonSkeleton);return D}_getAnimationGroups(){const D=[],j=this._gltf.animations;if(j)for(const W of j)W._babylonAnimationGroup&&D.push(W._babylonAnimationGroup);return D}_startAnimations(){switch(this._parent.animationStartMode){case z.e.NONE:break;case z.e.FIRST:{const D=this._getAnimationGroups();0!==D.length&&D[0].start(!0);break}case z.e.ALL:{const D=this._getAnimationGroups();for(const j of D)j.start(!0);break}default:return void R.b.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(D,j){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const Q=this._extensionsLoadNodeAsync(D,j,W);if(Q)return Q;if(j._babylonTransformNode)throw new Error(`${D}: Invalid recursive node hierarchy`);const C=new Array;this.logOpen(`${D} ${j.name||""}`);const k=Q=>{if(v.AddPointerMetadata(Q,D),v._LoadTransform(j,Q),void 0!=j.camera){const W=d.Get(`${D}/camera`,this._gltf.cameras,j.camera);C.push(this.loadCameraAsync(`/cameras/${W.index}`,W,(D=>{D.parent=Q})))}if(j.children)for(const W of j.children){const j=d.Get(`${D}/children/${W}`,this._gltf.nodes,W);C.push(this.loadNodeAsync(`/nodes/${j.index}`,j,(D=>{D.parent=Q})))}W(Q)},M=void 0!=j.mesh,O=this._parent.loadSkins&&void 0!=j.skin;if(!M||O){const D=j.name||`node${j.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const W=new t.c(D,this._babylonScene);W._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==j.mesh?j._babylonTransformNode=W:j._babylonTransformNodeForSkin=W,k(W)}if(M)if(O){const W=d.Get(`${D}/mesh`,this._gltf.meshes,j.mesh);C.push(this._loadMeshAsync(`/meshes/${W.index}`,j,W,(W=>{const Q=j._babylonTransformNodeForSkin;W.metadata=h(Q.metadata,W.metadata||{});const k=d.Get(`${D}/skin`,this._gltf.skins,j.skin);C.push(this._loadSkinAsync(`/skins/${k.index}`,j,k,(D=>{this._forEachPrimitive(j,(j=>{j.skeleton=D})),this._postSceneLoadActions.push((()=>{if(void 0!=k.skeleton){const D=d.Get(`/skins/${k.index}/skeleton`,this._gltf.nodes,k.skeleton).parent;j.index===D.index?W.parent=Q.parent:W.parent=D._babylonTransformNode}else W.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:Q,skinnedNode:W})}))})))})))}else{const W=d.Get(`${D}/mesh`,this._gltf.meshes,j.mesh);C.push(this._loadMeshAsync(`/meshes/${W.index}`,j,W,k))}return this.logClose(),Promise.all(C).then((()=>(this._forEachPrimitive(j,(D=>{D.Ie&&D.Ie.useBoundingInfoFromGeometry?D.Ea():D.refreshBoundingInfo(!0,!0)})),j._babylonTransformNode)))}_loadMeshAsync(D,j,W,Q){const C=W.primitives;if(!C||!C.length)throw new Error(`${D}: Primitives are missing`);void 0==C[0].index&&d.Assign(C);const k=new Array;this.logOpen(`${D} ${W.name||""}`);const M=j.name||`node${j.index}`;if(1===C.length){const Q=W.primitives[0];k.push(this._loadMeshPrimitiveAsync(`${D}/primitives/${Q.index}`,M,j,W,Q,(D=>{j._babylonTransformNode=D,j._primitiveBabylonMeshes=[D]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,j._babylonTransformNode=new t.c(M,this._babylonScene),j._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,j._primitiveBabylonMeshes=[];for(const Q of C)k.push(this._loadMeshPrimitiveAsync(`${D}/primitives/${Q.index}`,`${M}_primitive${Q.index}`,j,W,Q,(D=>{D.parent=j._babylonTransformNode,j._primitiveBabylonMeshes.push(D)})))}return Q(j._babylonTransformNode),this.logClose(),Promise.all(k).then((()=>j._babylonTransformNode))}_loadMeshPrimitiveAsync(D,j,W,Q,C,k){const M=this._extensionsLoadMeshPrimitiveAsync(D,j,W,Q,C,k);if(M)return M;this.logOpen(`${D}`);const O=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==W.skin&&!Q.primitives[0].targets;let E,f;if(O&&C._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,E=C._instanceData.babylonSourceMesh.yb(j),E._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,f=C._instanceData.promise;else{const k=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const M=new y.d(j,this._babylonScene);M._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,M.sideOrientation=this._babylonScene.useRightHandedSystem?g.c.CounterClockWiseSideOrientation:g.c.ClockWiseSideOrientation,this._createMorphTargets(D,W,Q,C,M),k.push(this._loadVertexDataAsync(D,C,M).then((j=>this._loadMorphTargetsAsync(D,C,M,j).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,j.Ca(M),j._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const F=v._GetDrawMode(D,C.mode);if(void 0==C.material){let D=this._defaultBabylonMaterialData[F];D||(D=this._createDefaultMaterial("__GLTFLoader._default",F),this._parent.onMaterialLoadedObservable.notifyObservers(D),this._defaultBabylonMaterialData[F]=D),M.material=D}else if(!this.parent.skipMaterials){const j=d.Get(`${D}/material`,this._gltf.materials,C.material);k.push(this._loadMaterialAsync(`/materials/${j.index}`,j,M,F,(D=>{M.material=D})))}f=Promise.all(k),O&&(C._instanceData={babylonSourceMesh:M,promise:f}),E=M}return v.AddPointerMetadata(E,D),this._parent.onMeshLoadedObservable.notifyObservers(E),k(E),this.logClose(),f.then((()=>E))}_loadVertexDataAsync(D,j,W){const Q=this._extensionsLoadVertexDataAsync(D,j,W);if(Q)return Q;const k=j.attributes;if(!k)throw new Error(`${D}: Attributes are missing`);const M=new Array,O=new l.b(W.name,this._babylonScene);if(void 0==j.indices)W.isUnIndexed=!0;else{const W=d.Get(`${D}/indices`,this._gltf.accessors,j.indices);M.push(this._loadIndicesAccessorAsync(`/accessors/${W.index}`,W).then((D=>{O.setIndices(D)})))}const E=(j,Q,E)=>{if(void 0==k[j])return;W._delayInfo=W._delayInfo||[],-1===W._delayInfo.indexOf(Q)&&W._delayInfo.push(Q);const f=d.Get(`${D}/attributes/${j}`,this._gltf.accessors,k[j]);M.push(this._loadVertexAccessorAsync(`/accessors/${f.index}`,f,Q).then((D=>{if(D.getKind()===c.f.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!W.skeleton&&f.min&&f.max){const D=C.e.Kd[0].Id(...f.min),j=C.e.Kd[1].Id(...f.max);if(f.normalized&&5126!==f.componentType){let W=1;switch(f.componentType){case 5120:W=127;break;case 5121:W=255;break;case 5122:W=32767;break;case 5123:W=65535}const Q=1/W;D.scaleInPlace(Q),j.scaleInPlace(Q)}O._boundingInfo=new p.d(D,j),O.useBoundingInfoFromGeometry=!0}O.setVerticesBuffer(D,f.count)}))),Q==c.f.MatricesIndicesExtraKind&&(W.numBoneInfluencers=8),E&&E(f)};return E("POSITION",c.f.PositionKind),E("NORMAL",c.f.NormalKind),E("TANGENT",c.f.TangentKind),E("TEXCOORD_0",c.f.UVKind),E("TEXCOORD_1",c.f.UV2Kind),E("TEXCOORD_2",c.f.UV3Kind),E("TEXCOORD_3",c.f.UV4Kind),E("TEXCOORD_4",c.f.UV5Kind),E("TEXCOORD_5",c.f.UV6Kind),E("JOINTS_0",c.f.MatricesIndicesKind),E("WEIGHTS_0",c.f.MatricesWeightsKind),E("JOINTS_1",c.f.MatricesIndicesExtraKind),E("WEIGHTS_1",c.f.MatricesWeightsExtraKind),E("COLOR_0",c.f.ColorKind,(D=>{"VEC4"===D.type&&(W.hasVertexAlpha=!0)})),Promise.all(M).then((()=>O))}_createMorphTargets(D,j,W,Q,C){if(!Q.targets||!this._parent.loadMorphTargets)return;if(void 0==j._numMorphTargets)j._numMorphTargets=Q.targets.length;else if(Q.targets.length!==j._numMorphTargets)throw new Error(`${D}: Primitives do not have the same number of targets`);const k=W.extras?W.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,C.morphTargetManager=new H(this._babylonScene),C.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,C.morphTargetManager.areUpdatesFrozen=!0;for(let M=0;M<Q.targets.length;M++){const D=j.weights?j.weights[M]:W.weights?W.weights[M]:0,Q=k?k[M]:`morphTarget${M}`;C.morphTargetManager.addTarget(new m(Q,D,C.va()))}}_loadMorphTargetsAsync(D,j,W,Q){if(!j.targets||!this._parent.loadMorphTargets)return Promise.resolve();const C=new Array,k=W.morphTargetManager;for(let M=0;M<k.numTargets;M++){const W=k.getTarget(M);C.push(this._loadMorphTargetVertexDataAsync(`${D}/targets/${M}`,Q,j.targets[M],W))}return Promise.all(C).then((()=>{k.areUpdatesFrozen=!1}))}_loadMorphTargetVertexDataAsync(D,j,W,Q){const C=new Array,k=(Q,k,M)=>{if(void 0==W[Q])return;const O=j.getVertexBuffer(k);if(!O)return;const E=d.Get(`${D}/${Q}`,this._gltf.accessors,W[Q]);C.push(this._loadFloatAccessorAsync(`/accessors/${E.index}`,E).then((D=>{M(O,D)})))};return k("POSITION",c.f.PositionKind,((D,j)=>{const W=new Float32Array(j.length);D.forEach(j.length,((D,Q)=>{W[Q]=j[Q]+D})),Q.setPositions(W)})),k("NORMAL",c.f.NormalKind,((D,j)=>{const W=new Float32Array(j.length);D.forEach(W.length,((D,Q)=>{W[Q]=j[Q]+D})),Q.setNormals(W)})),k("TANGENT",c.f.TangentKind,((D,j)=>{const W=new Float32Array(j.length/3*4);let C=0;D.forEach(j.length/3*4,((D,Q)=>{(Q+1)%4!==0&&(W[C]=j[C]+D,C++)})),Q.setTangents(W)})),Promise.all(C).then((()=>{}))}static _LoadTransform(D,j){if(void 0!=D.skin)return;let W=C.j.Zero(),Q=C.d.Identity(),k=C.j.One();if(D.matrix){C.b.Dd(D.matrix).decompose(k,Q,W)}else D.translation&&(W=C.j.Dd(D.translation)),D.rotation&&(Q=C.d.Dd(D.rotation)),D.scale&&(k=C.j.Dd(D.scale));j.position=W,j.rotationQuaternion=Q,j.Pd=k}_loadSkinAsync(D,j,W,Q){if(!this._parent.loadSkins)return Promise.resolve();const C=this._extensionsLoadSkinAsync(D,j,W);if(C)return C;if(W._data)return Q(W._data.babylonSkeleton),W._data.promise;const k=`skeleton${W.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const M=new U(W.name||k,k,this._babylonScene);M._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(D,W,M);const O=this._loadSkinInverseBindMatricesDataAsync(D,W).then((D=>{this._updateBoneMatrices(M,D)}));return W._data={babylonSkeleton:M,promise:O},Q(M),O}_loadBones(D,j,W){if(void 0==j.skeleton||this._parent.alwaysComputeSkeletonRootNode){const W=this._findSkeletonRootNode(`${D}/joints`,j.joints);if(W)if(void 0===j.skeleton)j.skeleton=W.index;else{const Q=(D,j)=>{for(;j.parent;j=j.parent)if(j.parent===D)return!0;return!1},C=d.Get(`${D}/skeleton`,this._gltf.nodes,j.skeleton);C===W||Q(C,W)||(R.b.Warn(`${D}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),j.skeleton=W.index)}else R.b.Warn(`${D}: Failed to find common root`)}const Q={};for(const C of j.joints){const k=d.Get(`${D}/joints/${C}`,this._gltf.nodes,C);this._loadBone(k,j,W,Q)}}_findSkeletonRootNode(D,j){if(0===j.length)return null;const W={};for(const C of j){const j=[];let Q=d.Get(`${D}/${C}`,this._gltf.nodes,C);for(;-1!==Q.index;)j.unshift(Q),Q=Q.parent;W[C]=j}let Q=null;for(let C=0;;++C){let D=W[j[0]];if(C>=D.length)return Q;const k=D[C];for(let M=1;M<j.length;++M)if(D=W[j[M]],C>=D.length||k!==D[C])return Q;Q=k}}_loadBone(D,j,W,Q){D._isJoint=!0;let C=Q[D.index];if(C)return C;let k=null;D.index!==j.skeleton&&(D.parent&&-1!==D.parent.index?k=this._loadBone(D.parent,j,W,Q):void 0!==j.skeleton&&R.b.Warn(`/skins/${j.index}/skeleton: Skeleton node is not a common root`));const M=j.joints.indexOf(D.index);return C=new f.e(D.name||`joint${D.index}`,W,k,this._getNodeMatrix(D),null,null,M),Q[D.index]=C,this._postSceneLoadActions.push((()=>{C.linkTransformNode(D._babylonTransformNode)})),C}_loadSkinInverseBindMatricesDataAsync(D,j){if(void 0==j.inverseBindMatrices)return Promise.resolve(null);const W=d.Get(`${D}/inverseBindMatrices`,this._gltf.accessors,j.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${W.index}`,W)}_updateBoneMatrices(D,j){for(const W of D.bones){const D=C.b.Identity(),Q=W._index;j&&-1!==Q&&(C.b.FromArrayToRef(j,16*Q,D),D.invertToRef(D));const k=W.getParent();k&&D.multiplyToRef(k.getAbsoluteInverseBindMatrix(),D),W.de(D,!1,!1),W._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(D){return D.matrix?C.b.Dd(D.matrix):C.b.Compose(D.scale?C.j.Dd(D.scale):C.j.One(),D.rotation?C.d.Dd(D.rotation):C.d.Identity(),D.translation?C.j.Dd(D.translation):C.j.Zero())}loadCameraAsync(D,j){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const Q=this._extensionsLoadCameraAsync(D,j,W);if(Q)return Q;const k=new Array;this.logOpen(`${D} ${j.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const M=new E.c(j.name||`camera${j.index}`,C.j.Zero(),this._babylonScene,!1);switch(M._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,M.ignoreParentScaling=!0,j._babylonCamera=M,M.rotation.set(0,Math.PI,0),j.type){case"perspective":{const W=j.perspective;if(!W)throw new Error(`${D}: Camera perspective properties are missing`);M.fov=W.yfov,M.qj=W.znear,M.maxZ=W.zfar||0;break}case"orthographic":if(!j.orthographic)throw new Error(`${D}: Camera orthographic properties are missing`);M.mode=O.d.ORTHOGRAPHIC_CAMERA,M.orthoLeft=-j.orthographic.xmag,M.orthoRight=j.orthographic.xmag,M.orthoBottom=-j.orthographic.ymag,M.orthoTop=j.orthographic.ymag,M.qj=j.orthographic.znear,M.maxZ=j.orthographic.zfar;break;default:throw new Error(`${D}: Invalid camera type (${j.type})`)}return v.AddPointerMetadata(M,D),this._parent.onCameraLoadedObservable.notifyObservers(M),W(M),this.logClose(),Promise.all(k).then((()=>M))}_loadAnimationsAsync(){const D=this._gltf.animations;if(!D)return Promise.resolve();const j=new Array;for(let W=0;W<D.length;W++){const Q=D[W];j.push(this.loadAnimationAsync(`/animations/${Q.index}`,Q).then((D=>{0===D.targetedAnimations.length&&D.dispose()})))}return Promise.all(j).then((()=>{}))}loadAnimationAsync(D,j){const Q=this._extensionsLoadAnimationAsync(D,j);return Q||W.e(43).then(W.bind(W,13377)).then((W=>{let{AnimationGroup:Q}=W;this._babylonScene._blockEntityCollection=!!this._assetContainer;const C=new Q(j.name||`animation${j.index}`,this._babylonScene);C._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,j._babylonAnimationGroup=C;const k=new Array;d.Assign(j.channels),d.Assign(j.samplers);for(const M of j.channels)k.push(this._loadAnimationChannelAsync(`${D}/channels/${M.index}`,D,j,M,((D,j)=>{D.animations=D.animations||[],D.animations.push(j),C.addTargetedAnimation(j,D)})));return Promise.all(k).then((()=>(C.normalize(0),C)))}))}_loadAnimationChannelAsync(D,j,W,Q,C){const k=this._extensionsLoadAnimationChannelAsync(D,j,W,Q,C);if(k)return k;if(void 0==Q.target.node)return Promise.resolve();const M=d.Get(`${D}/target/node`,this._gltf.nodes,Q.target.node),O=Q.target.path,E="weights"===O;if(E&&!M._numMorphTargets||!E&&!M._babylonTransformNode)return Promise.resolve();if(!this._parent.loadNodeAnimations&&!E&&!M._isJoint)return Promise.resolve();let f;switch(O){case"translation":f=n.translation;break;case"rotation":f=n.rotation;break;case"scale":f=n.scale;break;case"weights":f=n.weights;break;default:throw new Error(`${D}/target/path: Invalid value (${Q.target.path})`)}const F={object:M,info:f};return this._loadAnimationChannelFromTargetInfoAsync(D,j,W,Q,F,C)}_loadAnimationChannelFromTargetInfoAsync(D,j,W,Q,C,k){const M=this.parent.targetFps,O=1/M,E=d.Get(`${D}/sampler`,W.samplers,Q.sampler);return this._loadAnimationSamplerAsync(`${j}/samplers/${Q.sampler}`,E).then((D=>{let j=0;const E=C.object,f=C.info;for(const C of f){const f=C.getStride(E),F=D.input,Z=D.output,P=new Array(F.length);let X=0;switch(D.interpolation){case"STEP":for(let D=0;D<F.length;D++){const j=C.getValue(E,Z,X,1);X+=f,P[D]={frame:F[D]*M,value:j,interpolation:1}}break;case"CUBICSPLINE":for(let D=0;D<F.length;D++){const j=C.getValue(E,Z,X,O);X+=f;const W=C.getValue(E,Z,X,1);X+=f;const Q=C.getValue(E,Z,X,O);X+=f,P[D]={frame:F[D]*M,inTangent:j,value:W,outTangent:Q}}break;case"LINEAR":for(let D=0;D<F.length;D++){const j=C.getValue(E,Z,X,1);X+=f,P[D]={frame:F[D]*M,value:j}}}if(X>0){const D=`${W.name||`animation${W.index}`}_channel${Q.index}_${j}`;C.buildAnimations(E,D,M,P,((D,W)=>{++j,k(D,W)}))}}}))}_loadAnimationSamplerAsync(D,j){if(j._data)return j._data;const W=j.interpolation||"LINEAR";switch(W){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${D}/interpolation: Invalid value (${j.interpolation})`)}const Q=d.Get(`${D}/input`,this._gltf.accessors,j.input),C=d.Get(`${D}/output`,this._gltf.accessors,j.output);return j._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${Q.index}`,Q),this._loadFloatAccessorAsync(`/accessors/${C.index}`,C)]).then((D=>{let[j,Q]=D;return{input:j,interpolation:W,output:Q}})),j._data}loadBufferAsync(D,j,W,Q){const C=this._extensionsLoadBufferAsync(D,j,W,Q);if(C)return C;if(!j._data)if(j.uri)j._data=this.loadUriAsync(`${D}/uri`,j,j.uri);else{if(!this._bin)throw new Error(`${D}: Uri is missing or the binary glTF is missing its binary chunk`);j._data=this._bin.readAsync(0,j.byteLength)}return j._data.then((j=>{try{return new Uint8Array(j.buffer,j.byteOffset+W,Q)}catch(C){throw new Error(`${D}: ${C.message}`)}}))}loadBufferViewAsync(D,j){const W=this._extensionsLoadBufferViewAsync(D,j);if(W)return W;if(j._data)return j._data;const Q=d.Get(`${D}/buffer`,this._gltf.buffers,j.buffer);return j._data=this.loadBufferAsync(`/buffers/${Q.index}`,Q,j.byteOffset||0,j.byteLength),j._data}_loadAccessorAsync(D,j,W){if(j._data)return j._data;const Q=v._GetNumComponents(D,j.type),C=Q*c.f.GetTypeByteLength(j.componentType),k=Q*j.count;if(void 0==j.bufferView)j._data=Promise.resolve(new W(k));else{const M=d.Get(`${D}/bufferView`,this._gltf.bufferViews,j.bufferView);j._data=this.loadBufferViewAsync(`/bufferViews/${M.index}`,M).then((O=>{if(5126!==j.componentType||j.normalized||M.byteStride&&M.byteStride!==C){const D=new W(k);return c.f.ForEach(O,j.byteOffset||0,M.byteStride||C,Q,j.componentType,D.length,j.normalized||!1,((j,W)=>{D[W]=j})),D}return v._GetTypedArray(D,j.componentType,O,j.byteOffset,k)}))}if(j.sparse){const k=j.sparse;j._data=j._data.then((M=>{const O=M,E=d.Get(`${D}/sparse/indices/bufferView`,this._gltf.bufferViews,k.indices.bufferView),f=d.Get(`${D}/sparse/values/bufferView`,this._gltf.bufferViews,k.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${E.index}`,E),this.loadBufferViewAsync(`/bufferViews/${f.index}`,f)]).then((M=>{let[E,f]=M;const F=v._GetTypedArray(`${D}/sparse/indices`,k.indices.componentType,E,k.indices.byteOffset,k.count),Z=Q*k.count;let P;if(5126!==j.componentType||j.normalized){const M=v._GetTypedArray(`${D}/sparse/values`,j.componentType,f,k.values.byteOffset,Z);P=new W(Z),c.f.ForEach(M,0,C,Q,j.componentType,P.length,j.normalized||!1,((D,j)=>{P[j]=D}))}else P=v._GetTypedArray(`${D}/sparse/values`,j.componentType,f,k.values.byteOffset,Z);let X=0;for(let D=0;D<F.length;D++){let j=F[D]*Q;for(let D=0;D<Q;D++)O[j++]=P[X++]}return O}))}))}return j._data}_loadFloatAccessorAsync(D,j){return this._loadAccessorAsync(D,j,Float32Array)}_loadIndicesAccessorAsync(D,j){if("SCALAR"!==j.type)throw new Error(`${D}/type: Invalid value ${j.type}`);if(5121!==j.componentType&&5123!==j.componentType&&5125!==j.componentType)throw new Error(`${D}/componentType: Invalid value ${j.componentType}`);if(j._data)return j._data;if(j.sparse){const W=v._GetTypedArrayConstructor(`${D}/componentType`,j.componentType);j._data=this._loadAccessorAsync(D,j,W)}else{const W=d.Get(`${D}/bufferView`,this._gltf.bufferViews,j.bufferView);j._data=this.loadBufferViewAsync(`/bufferViews/${W.index}`,W).then((W=>v._GetTypedArray(D,j.componentType,W,j.byteOffset,j.count)))}return j._data}_loadVertexBufferViewAsync(D){if(D._babylonBuffer)return D._babylonBuffer;const j=this._babylonScene.getEngine();return D._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${D.index}`,D).then((D=>new c.b(j,D,!1))),D._babylonBuffer}_loadVertexAccessorAsync(D,j,W){var Q;if(null!==(Q=j._babylonVertexBuffer)&&void 0!==Q&&Q[W])return j._babylonVertexBuffer[W];j._babylonVertexBuffer||(j._babylonVertexBuffer={});const C=this._babylonScene.getEngine();if(j.sparse||void 0==j.bufferView)j._babylonVertexBuffer[W]=this._loadFloatAccessorAsync(D,j).then((D=>new c.f(C,D,W,!1)));else{const Q=d.Get(`${D}/bufferView`,this._gltf.bufferViews,j.bufferView);j._babylonVertexBuffer[W]=this._loadVertexBufferViewAsync(Q).then((k=>{const M=v._GetNumComponents(D,j.type);return new c.f(C,k,W,!1,void 0,Q.byteStride,void 0,j.byteOffset,M,j.componentType,j.normalized,!0,void 0,!0)}))}return j._babylonVertexBuffer[W]}_loadMaterialMetallicRoughnessPropertiesAsync(D,j,W){if(!(W instanceof b))throw new Error(`${D}: Material type not supported`);const Q=new Array;return j&&(j.baseColorFactor?(W.albedoColor=k.d.Dd(j.baseColorFactor),W.alpha=j.baseColorFactor[3]):W.albedoColor=k.d.White(),W.metallic=void 0==j.metallicFactor?1:j.metallicFactor,W.roughness=void 0==j.roughnessFactor?1:j.roughnessFactor,j.baseColorTexture&&Q.push(this.loadTextureInfoAsync(`${D}/baseColorTexture`,j.baseColorTexture,(D=>{D.name=`${W.name} (Base Color)`,W.albedoTexture=D}))),j.metallicRoughnessTexture&&(j.metallicRoughnessTexture.nonColorData=!0,Q.push(this.loadTextureInfoAsync(`${D}/metallicRoughnessTexture`,j.metallicRoughnessTexture,(D=>{D.name=`${W.name} (Metallic Roughness)`,W.metallicTexture=D}))),W.useMetallnessFromMetallicTextureBlue=!0,W.useRoughnessFromMetallicTextureGreen=!0,W.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(Q).then((()=>{}))}_loadMaterialAsync(D,j,W,Q){let C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const k=this._extensionsLoadMaterialAsync(D,j,W,Q,C);if(k)return k;j._data=j._data||{};let M=j._data[Q];if(!M){this.logOpen(`${D} ${j.name||""}`);const W=this.createMaterial(D,j,Q);M={babylonMaterial:W,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(D,j,W)},j._data[Q]=M,v.AddPointerMetadata(W,D),this._parent.onMaterialLoadedObservable.notifyObservers(W),this.logClose()}return W&&(M.babylonMeshes.push(W),W.Qd.addOnce((()=>{const D=M.babylonMeshes.indexOf(W);-1!==D&&M.babylonMeshes.splice(D,1)}))),C(M.babylonMaterial),M.promise.then((()=>M.babylonMaterial))}_createDefaultMaterial(D,j){this._babylonScene._blockEntityCollection=!!this._assetContainer;const W=new b(D,this._babylonScene);return W._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,W.fillMode=j,W.enableSpecularAntiAliasing=!0,W.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,W.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,W.transparencyMode=b.PBRMATERIAL_OPAQUE,W.metallic=1,W.roughness=1,W}createMaterial(D,j,W){const Q=this._extensionsCreateMaterial(D,j,W);if(Q)return Q;const C=j.name||`material${j.index}`;return this._createDefaultMaterial(C,W)}loadMaterialPropertiesAsync(D,j,W){const Q=this._extensionsLoadMaterialPropertiesAsync(D,j,W);if(Q)return Q;const C=new Array;return C.push(this.loadMaterialBasePropertiesAsync(D,j,W)),j.pbrMetallicRoughness&&C.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${D}/pbrMetallicRoughness`,j.pbrMetallicRoughness,W)),this.loadMaterialAlphaProperties(D,j,W),Promise.all(C).then((()=>{}))}loadMaterialBasePropertiesAsync(D,j,W){if(!(W instanceof b))throw new Error(`${D}: Material type not supported`);const Q=new Array;return W.emissiveColor=j.emissiveFactor?k.d.Dd(j.emissiveFactor):new k.d(0,0,0),j.doubleSided&&(W.Se=!1,W.twoSidedLighting=!0),j.normalTexture&&(j.normalTexture.nonColorData=!0,Q.push(this.loadTextureInfoAsync(`${D}/normalTexture`,j.normalTexture,(D=>{D.name=`${W.name} (Normal)`,W.bumpTexture=D}))),W.invertNormalMapX=!this._babylonScene.useRightHandedSystem,W.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=j.normalTexture.scale&&W.bumpTexture&&(W.bumpTexture.level=j.normalTexture.scale),W.forceIrradianceInFragment=!0),j.occlusionTexture&&(j.occlusionTexture.nonColorData=!0,Q.push(this.loadTextureInfoAsync(`${D}/occlusionTexture`,j.occlusionTexture,(D=>{D.name=`${W.name} (Occlusion)`,W.ambientTexture=D}))),W.useAmbientInGrayScale=!0,void 0!=j.occlusionTexture.strength&&(W.ambientTextureStrength=j.occlusionTexture.strength)),j.emissiveTexture&&Q.push(this.loadTextureInfoAsync(`${D}/emissiveTexture`,j.emissiveTexture,(D=>{D.name=`${W.name} (Emissive)`,W.emissiveTexture=D}))),Promise.all(Q).then((()=>{}))}loadMaterialAlphaProperties(D,j,W){if(!(W instanceof b))throw new Error(`${D}: Material type not supported`);switch(j.alphaMode||"OPAQUE"){case"OPAQUE":W.transparencyMode=b.PBRMATERIAL_OPAQUE,W.alpha=1;break;case"MASK":W.transparencyMode=b.PBRMATERIAL_ALPHATEST,W.alphaCutOff=void 0==j.alphaCutoff?.5:j.alphaCutoff,W.albedoTexture&&(W.albedoTexture.td=!0);break;case"BLEND":W.transparencyMode=b.PBRMATERIAL_ALPHABLEND,W.albedoTexture&&(W.albedoTexture.td=!0,W.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${D}/alphaMode: Invalid value (${j.alphaMode})`)}}loadTextureInfoAsync(D,j){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const Q=this._extensionsLoadTextureInfoAsync(D,j,W);if(Q)return Q;if(this.logOpen(`${D}`),j.texCoord>=6)throw new Error(`${D}/texCoord: Invalid value (${j.texCoord})`);const C=d.Get(`${D}/index`,this._gltf.textures,j.index);C._textureInfo=j;const k=this._loadTextureAsync(`/textures/${j.index}`,C,(Q=>{Q.coordinatesIndex=j.texCoord||0,v.AddPointerMetadata(Q,D),this._parent.onTextureLoadedObservable.notifyObservers(Q),W(Q)}));return this.logClose(),k}_loadTextureAsync(D,j){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const Q=this._extensionsLoadTextureAsync(D,j,W);if(Q)return Q;this.logOpen(`${D} ${j.name||""}`);const C=void 0==j.sampler?v.DefaultSampler:d.Get(`${D}/sampler`,this._gltf.samplers,j.sampler),k=d.Get(`${D}/source`,this._gltf.images,j.source),M=this._createTextureAsync(D,C,k,W,void 0,!j._textureInfo.nonColorData);return this.logClose(),M}_createTextureAsync(D,j,W){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},k=arguments.length>4?arguments[4]:void 0,M=arguments.length>5?arguments[5]:void 0;const O=this._loadSampler(`/samplers/${j.index}`,j),E=new Array,f=new Q;this._babylonScene._blockEntityCollection=!!this._assetContainer;const F={noMipmap:O.noMipMaps,invertY:!1,samplingMode:O.samplingMode,X:()=>{this._disposed||f.resolve()},onError:(j,W)=>{this._disposed||f.reject(new Error(`${D}: ${W&&W.message?W.message:j||"Failed to load texture"}`))},mimeType:W.mimeType,loaderOptions:k,useSRGBBuffer:!!M&&this._parent.useSRGBBuffers},Z=new Y.e(null,this._babylonScene,F);return Z._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,E.push(f.promise),E.push(this.loadImageAsync(`/images/${W.index}`,W).then((D=>{const j=W.uri||`${this._fileName}#image${W.index}`,Q=`data:${this._uniqueRootUrl}${j}`;Z.updateURL(Q,D);const C=Z.getInternalTexture();C&&(C.label=W.name)}))),Z.wrapU=O.wrapU,Z.wrapV=O.wrapV,C(Z),this._parent.useGltfTextureNames&&(Z.name=W.name||W.uri||`image${W.index}`),Promise.all(E).then((()=>Z))}_loadSampler(D,j){return j._data||(j._data={noMipMaps:9728===j.minFilter||9729===j.minFilter,samplingMode:v._GetTextureSamplingMode(D,j),wrapU:v._GetTextureWrapMode(`${D}/wrapS`,j.wrapS),wrapV:v._GetTextureWrapMode(`${D}/wrapT`,j.wrapT)}),j._data}loadImageAsync(D,j){if(!j._data){if(this.logOpen(`${D} ${j.name||""}`),j.uri)j._data=this.loadUriAsync(`${D}/uri`,j,j.uri);else{const W=d.Get(`${D}/bufferView`,this._gltf.bufferViews,j.bufferView);j._data=this.loadBufferViewAsync(`/bufferViews/${W.index}`,W)}this.logClose()}return j._data}loadUriAsync(D,j,W){const Q=this._extensionsLoadUriAsync(D,j,W);if(Q)return Q;if(!v._ValidateUri(W))throw new Error(`${D}: '${W}' is invalid`);if((0,i.j)(W)){const j=new Uint8Array((0,i.d)(W));return this.log(`${D}: Decoded ${W.substring(0,64)}... (${j.length} bytes)`),Promise.resolve(j)}return this.log(`${D}: Loading ${W}`),this._parent.preprocessUrlAsync(this._rootUrl+W).then((j=>new Promise(((Q,C)=>{this._parent._loadFile(this._babylonScene,j,(j=>{this._disposed||(this.log(`${D}: Loaded ${W} (${j.byteLength} bytes)`),Q(new Uint8Array(j)))}),!0,(j=>{C(new i.k(`${D}: Failed to load '${W}'${j?": "+j.status+" "+j.statusText:""}`,j))}))}))))}static AddPointerMetadata(D,j){D.metadata=D.metadata||{};const W=D._internalMetadata=D._internalMetadata||{},Q=W.kj=W.kj||{};(Q.pointers=Q.pointers||[]).push(j)}static _GetTextureWrapMode(D,j){switch(j=void 0==j?10497:j){case 33071:return Y.e.CLAMP_ADDRESSMODE;case 33648:return Y.e.MIRROR_ADDRESSMODE;case 10497:return Y.e.WRAP_ADDRESSMODE;default:return R.b.Warn(`${D}: Invalid value (${j})`),Y.e.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(D,j){const W=void 0==j.magFilter?9729:j.magFilter,Q=void 0==j.minFilter?9987:j.minFilter;if(9729===W)switch(Q){case 9728:return Y.e.LINEAR_NEAREST;case 9729:return Y.e.LINEAR_LINEAR;case 9984:return Y.e.LINEAR_NEAREST_MIPNEAREST;case 9985:return Y.e.LINEAR_LINEAR_MIPNEAREST;case 9986:return Y.e.LINEAR_NEAREST_MIPLINEAR;case 9987:return Y.e.LINEAR_LINEAR_MIPLINEAR;default:return R.b.Warn(`${D}/minFilter: Invalid value (${Q})`),Y.e.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==W&&R.b.Warn(`${D}/magFilter: Invalid value (${W})`),Q){case 9728:return Y.e.NEAREST_NEAREST;case 9729:return Y.e.NEAREST_LINEAR;case 9984:return Y.e.NEAREST_NEAREST_MIPNEAREST;case 9985:return Y.e.NEAREST_LINEAR_MIPNEAREST;case 9986:return Y.e.NEAREST_NEAREST_MIPLINEAR;case 9987:return Y.e.NEAREST_LINEAR_MIPLINEAR;default:return R.b.Warn(`${D}/minFilter: Invalid value (${Q})`),Y.e.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(D,j){switch(j){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`${D}: Invalid component type ${j}`)}}static _GetTypedArray(D,j,W,Q,C){const k=W.buffer;Q=W.byteOffset+(Q||0);const M=v._GetTypedArrayConstructor(`${D}/componentType`,j),O=c.f.GetTypeByteLength(j);return Q%O!==0?(R.b.Warn(`${D}: Copying buffer as byte offset (${Q}) is not a multiple of component type byte length (${O})`),new M(k.slice(Q,Q+C*O),0)):new M(k,Q,C)}static _GetNumComponents(D,j){switch(j){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${D}: Invalid type (${j})`)}static _ValidateUri(D){return M.f.IsBase64(D)||-1===D.indexOf("..")}static _GetDrawMode(D,j){switch(void 0==j&&(j=4),j){case 0:return g.c.PointListDrawMode;case 1:return g.c.LineListDrawMode;case 2:return g.c.LineLoopDrawMode;case 3:return g.c.LineStripDrawMode;case 4:return g.c.TriangleFillMode;case 5:return g.c.TriangleStripDrawMode;case 6:return g.c.TriangleFanDrawMode}throw new Error(`${D}: Invalid mesh primitive mode (${j})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const D=new Array;if(this._gltf.materials)for(const j of this._gltf.materials)if(j._data)for(const W in j._data){const Q=j._data[W];for(const j of Q.babylonMeshes){j.Ge(!0);const W=Q.babylonMaterial;D.push(W.forceCompilationAsync(j)),D.push(W.forceCompilationAsync(j,{useInstances:!0})),this._parent.useClipPlane&&(D.push(W.forceCompilationAsync(j,{clipPlane:!0})),D.push(W.forceCompilationAsync(j,{clipPlane:!0,useInstances:!0})))}}return Promise.all(D).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const D=new Array,j=this._babylonScene.lights;for(const W of j){const j=W.getShadowGenerator();j&&D.push(j.forceCompilationAsync())}return Promise.all(D).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(D){for(const j of this._extensions)j.enabled&&D(j)}_applyExtensions(D,j,W){for(const Q of this._extensions)if(Q.enabled){const C=`${Q.name}.${j}`,k=D;k._activeLoaderExtensionFunctions=k._activeLoaderExtensionFunctions||{};const M=k._activeLoaderExtensionFunctions;if(!M[C]){M[C]=!0;try{const D=W(Q);if(D)return D}finally{delete M[C]}}}return null}_extensionsOnLoading(){this._forEachExtensions((D=>D.onLoading&&D.onLoading()))}_extensionsOnReady(){this._forEachExtensions((D=>D.onReady&&D.onReady()))}_extensionsLoadSceneAsync(D,j){return this._applyExtensions(j,"loadScene",(W=>W.loadSceneAsync&&W.loadSceneAsync(D,j)))}_extensionsLoadNodeAsync(D,j,W){return this._applyExtensions(j,"loadNode",(Q=>Q.loadNodeAsync&&Q.loadNodeAsync(D,j,W)))}_extensionsLoadCameraAsync(D,j,W){return this._applyExtensions(j,"loadCamera",(Q=>Q.loadCameraAsync&&Q.loadCameraAsync(D,j,W)))}_extensionsLoadVertexDataAsync(D,j,W){return this._applyExtensions(j,"loadVertexData",(Q=>Q._loadVertexDataAsync&&Q._loadVertexDataAsync(D,j,W)))}_extensionsLoadMeshPrimitiveAsync(D,j,W,Q,C,k){return this._applyExtensions(C,"loadMeshPrimitive",(M=>M._loadMeshPrimitiveAsync&&M._loadMeshPrimitiveAsync(D,j,W,Q,C,k)))}_extensionsLoadMaterialAsync(D,j,W,Q,C){return this._applyExtensions(j,"loadMaterial",(k=>k._loadMaterialAsync&&k._loadMaterialAsync(D,j,W,Q,C)))}_extensionsCreateMaterial(D,j,W){return this._applyExtensions(j,"createMaterial",(Q=>Q.createMaterial&&Q.createMaterial(D,j,W)))}_extensionsLoadMaterialPropertiesAsync(D,j,W){return this._applyExtensions(j,"loadMaterialProperties",(Q=>Q.loadMaterialPropertiesAsync&&Q.loadMaterialPropertiesAsync(D,j,W)))}_extensionsLoadTextureInfoAsync(D,j,W){return this._applyExtensions(j,"loadTextureInfo",(Q=>Q.loadTextureInfoAsync&&Q.loadTextureInfoAsync(D,j,W)))}_extensionsLoadTextureAsync(D,j,W){return this._applyExtensions(j,"loadTexture",(Q=>Q._loadTextureAsync&&Q._loadTextureAsync(D,j,W)))}_extensionsLoadAnimationAsync(D,j){return this._applyExtensions(j,"loadAnimation",(W=>W.loadAnimationAsync&&W.loadAnimationAsync(D,j)))}_extensionsLoadAnimationChannelAsync(D,j,W,Q,C){return this._applyExtensions(W,"loadAnimationChannel",(k=>k._loadAnimationChannelAsync&&k._loadAnimationChannelAsync(D,j,W,Q,C)))}_extensionsLoadSkinAsync(D,j,W){return this._applyExtensions(W,"loadSkin",(Q=>Q._loadSkinAsync&&Q._loadSkinAsync(D,j,W)))}_extensionsLoadUriAsync(D,j,W){return this._applyExtensions(j,"loadUri",(Q=>Q._loadUriAsync&&Q._loadUriAsync(D,j,W)))}_extensionsLoadBufferViewAsync(D,j){return this._applyExtensions(j,"loadBufferView",(W=>W.loadBufferViewAsync&&W.loadBufferViewAsync(D,j)))}_extensionsLoadBufferAsync(D,j,W,Q){return this._applyExtensions(j,"loadBuffer",(C=>C.loadBufferAsync&&C.loadBufferAsync(D,j,W,Q)))}static LoadExtensionAsync(D,j,W,Q){if(!j.extensions)return null;const C=j.extensions[W];return C?Q(`${D}/extensions/${W}`,C):null}static LoadExtraAsync(D,j,W,Q){if(!j.extras)return null;const C=j.extras[W];return C?Q(`${D}/extras/${W}`,C):null}isExtensionUsed(D){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(D)}logOpen(D){this._parent._logOpen(D)}logClose(){this._parent._logClose()}log(D){this._parent._log(D)}startPerformanceCounter(D){this._parent._startPerformanceCounter(D)}endPerformanceCounter(D){this._parent._endPerformanceCounter(D)}}v.DefaultSampler={index:-1},z.d._CreateGLTF2Loader=D=>new v(D);var B=W(1503),r=W(10918),DD=W(12733);class jD extends DD.c{constructor(D,j,W){let Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,k=arguments.length>5&&void 0!==arguments[5]&&arguments[5],M=arguments.length>6&&void 0!==arguments[6]&&arguments[6],O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,E=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",D),this._texture=D.getEngine().createRawCubeTexture(j,W,Q,C,k,M,O,E)}update(D,j,W,Q){let C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,D,j,W,Q,C)}updateRGBDAsync(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,r.k)(this._texture,D,j,W,Q).then((()=>{}))}clone(){return s.d.Clone((()=>{const D=this.va(),j=this._texture,W=new jD(D,j._bufferViewArray,j.width,j.format,j.type,j.generateMipMaps,j.invertY,j.samplingMode,j._compression);return 13===j.source&&W.updateRGBDAsync(j._bufferViewArrayArray,j._sphericalPolynomial,j._lodGenerationScale,j._lodGenerationOffset),W}),this)}}const WD="EXT_lights_image_based";class QD{constructor(D){this.name=WD,this._loader=D,this.enabled=this._loader.isExtensionUsed(WD)}dispose(){this._loader=null,delete this._lights}onLoading(){const D=this._loader.kj.extensions;if(D&&D[this.name]){const j=D[this.name];this._lights=j.lights}}loadSceneAsync(D,j){return v.LoadExtensionAsync(D,j,this.name,((W,Q)=>{this._loader._allMaterialsDirtyRequired=!0;const C=new Array;C.push(this._loader.loadSceneAsync(D,j)),this._loader.logOpen(`${W}`);const k=d.Get(`${W}/light`,this._lights,Q.eb);return C.push(this._loadLightAsync(`/extensions/${this.name}/lights/${Q.eb}`,k).then((D=>{this._loader.babylonScene.environmentTexture=D}))),this._loader.logClose(),Promise.all(C).then((()=>{}))}))}_loadLightAsync(D,j){if(!j._loaded){const W=new Array;this._loader.logOpen(`${D}`);const Q=new Array(j.specularImages.length);for(let C=0;C<j.specularImages.length;C++){const k=j.specularImages[C];Q[C]=new Array(k.length);for(let j=0;j<k.length;j++){const M=`${D}/specularImages/${C}/${j}`;this._loader.logOpen(`${M}`);const O=k[j],E=d.Get(M,this._loader.kj.images,O);W.push(this._loader.loadImageAsync(`/images/${O}`,E).then((D=>{Q[C][j]=D}))),this._loader.logClose()}}this._loader.logClose(),j._loaded=Promise.all(W).then((()=>{const W=new jD(this._loader.babylonScene,null,j.specularImageSize);if(W.name=j.name||"environment",j._babylonTexture=W,void 0!=j.uj&&(W.level=j.uj),j.rotation){let D=C.d.Dd(j.rotation);this._loader.babylonScene.useRightHandedSystem||(D=C.d.Inverse(D)),C.b.FromQuaternionToRef(D,W.getReflectionTextureMatrix())}if(!j.irradianceCoefficients)throw new Error(`${D}: Irradiance coefficients are missing`);const k=B.e.Dd(j.irradianceCoefficients);k.scaleInPlace(j.uj),k.convertIrradianceToLambertianRadiance();const M=B.h.FromHarmonics(k),O=(Q.length-1)/Math.log2(j.specularImageSize);return W.updateRGBDAsync(Q,M,O)}))}return j._loaded.then((()=>j._babylonTexture))}}J(WD),o(WD,!0,(D=>new QD(D)));W(12741);const CD="EXT_mesh_gpu_instancing";class kD{constructor(D){this.name=CD,this._loader=D,this.enabled=this._loader.isExtensionUsed(CD)}dispose(){this._loader=null}loadNodeAsync(D,j,W){return v.LoadExtensionAsync(D,j,this.name,((D,Q)=>{this._loader._disableInstancedMesh++;const k=this._loader.loadNodeAsync(`/nodes/${j.index}`,j,W);if(this._loader._disableInstancedMesh--,!j._primitiveBabylonMeshes)return k;const M=new Array;let O=0;const E=j=>{if(void 0==Q.attributes[j])return void M.push(Promise.resolve(null));const W=d.Get(`${D}/attributes/${j}`,this._loader.kj.accessors,Q.attributes[j]);if(M.push(this._loader._loadFloatAccessorAsync(`/accessors/${W.bufferView}`,W)),0===O)O=W.count;else if(O!==W.count)throw new Error(`${D}/attributes: Instance buffer accessors do not have the same count.`)};return E("TRANSLATION"),E("ROTATION"),E("SCALE"),k.then((D=>Promise.all(M).then((W=>{let[Q,k,M]=W;const E=new Float32Array(16*O);C.e.Kd[0].Id(0,0,0),C.e.Quaternion[0].Id(0,0,0,1),C.e.Kd[1].Id(1,1,1);for(let D=0;D<O;++D)Q&&C.j.FromArrayToRef(Q,3*D,C.e.Kd[0]),k&&C.d.FromArrayToRef(k,4*D,C.e.Quaternion[0]),M&&C.j.FromArrayToRef(M,3*D,C.e.Kd[1]),C.b.ComposeToRef(C.e.Kd[1],C.e.Quaternion[0],C.e.Kd[0],C.e.Matrix[0]),C.e.Matrix[0].copyToArray(E,16*D);for(const D of j._primitiveBabylonMeshes)D.bk("matrix",E,16,!0);return D}))))}))}}J(CD),o(CD,!0,(D=>new kD(D)));class MD{static get Default(){return MD._Default||(MD._Default=new MD),MD._Default}constructor(){const D=MD.Configuration.decoder;this._decoderModulePromise=M.f.LoadBabylonScriptAsync(D.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}decodeGltfBufferAsync(D,j,W,Q,C){return this._decoderModulePromise.then((async()=>{MeshoptDecoder.useWorkers(1);const k=await MeshoptDecoder.decodeGltfBufferAsync(j,W,D,Q,C);return MeshoptDecoder.useWorkers(0),k}))}}MD.Configuration={decoder:{url:`${M.f._DefaultCdnUrl}/meshopt_decoder.js`}},MD._Default=null;const OD="EXT_meshopt_compression";class ED{constructor(D){this.name=OD,this.enabled=D.isExtensionUsed(OD),this._loader=D}dispose(){this._loader=null}loadBufferViewAsync(D,j){return v.LoadExtensionAsync(D,j,this.name,((W,Q)=>{const C=j;if(C._meshOptData)return C._meshOptData;const k=d.Get(`${D}/buffer`,this._loader.kj.buffers,Q.buffer);return C._meshOptData=this._loader.loadBufferAsync(`/buffers/${k.index}`,k,Q.byteOffset||0,Q.byteLength).then((D=>MD.Default.decodeGltfBufferAsync(D,Q.count,Q.byteStride,Q.mode,Q.filter))),C._meshOptData}))}}J(OD),o(OD,!0,(D=>new ED(D)));const fD="EXT_texture_webp";class FD{constructor(D){this.name=fD,this._loader=D,this.enabled=D.isExtensionUsed(fD)}dispose(){this._loader=null}_loadTextureAsync(D,j,W){return v.LoadExtensionAsync(D,j,this.name,((Q,C)=>{const k=void 0==j.sampler?v.DefaultSampler:d.Get(`${D}/sampler`,this._loader.kj.samplers,j.sampler),M=d.Get(`${Q}/source`,this._loader.kj.images,C.source);return this._loader._createTextureAsync(D,k,M,(D=>{W(D)}),void 0,!j._textureInfo.nonColorData)}))}}J(fD),o(fD,!0,(D=>new FD(D)));const ZD="EXT_texture_avif";class PD{constructor(D){this.name=ZD,this._loader=D,this.enabled=D.isExtensionUsed(ZD)}dispose(){this._loader=null}_loadTextureAsync(D,j,W){return v.LoadExtensionAsync(D,j,this.name,((Q,C)=>{const k=void 0==j.sampler?v.DefaultSampler:d.Get(`${D}/sampler`,this._loader.kj.samplers,j.sampler),M=d.Get(`${Q}/source`,this._loader.kj.images,C.source);return this._loader._createTextureAsync(D,k,M,(D=>{W(D)}),void 0,!j._textureInfo.nonColorData)}))}}J(ZD),o(ZD,!0,(D=>new PD(D)));var XD=W(12746);const xD="KHR_draco_mesh_compression";class RD{constructor(D){this.name=xD,this.useNormalizedFlagFromAccessor=!0,this._loader=D,this.enabled=XD.e.DecoderAvailable&&this._loader.isExtensionUsed(xD)}dispose(){delete this.dracoCompression,this._loader=null}_loadVertexDataAsync(D,j,W){return v.LoadExtensionAsync(D,j,this.name,((Q,C)=>{if(void 0!=j.mode&&4!==j.mode&&5!==j.mode)throw new Error(`${D}: Unsupported mode ${j.mode}`);const k={},M={},O=(D,Q)=>{const O=C.attributes[D];if(void 0!=O&&(W._delayInfo=W._delayInfo||[],-1===W._delayInfo.indexOf(Q)&&W._delayInfo.push(Q),k[Q]=O,this.useNormalizedFlagFromAccessor)){const W=d.TryGet(this._loader.kj.accessors,j.attributes[D]);W&&(M[Q]=W.normalized||!1)}};O("POSITION",c.f.PositionKind),O("NORMAL",c.f.NormalKind),O("TANGENT",c.f.TangentKind),O("TEXCOORD_0",c.f.UVKind),O("TEXCOORD_1",c.f.UV2Kind),O("TEXCOORD_2",c.f.UV3Kind),O("TEXCOORD_3",c.f.UV4Kind),O("TEXCOORD_4",c.f.UV5Kind),O("TEXCOORD_5",c.f.UV6Kind),O("JOINTS_0",c.f.MatricesIndicesKind),O("WEIGHTS_0",c.f.MatricesWeightsKind),O("COLOR_0",c.f.ColorKind);const E=d.Get(Q,this._loader.kj.bufferViews,C.bufferView);return E._dracoBabylonGeometry||(E._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${E.index}`,E).then((j=>(this.dracoCompression||XD.e.Default)._decodeMeshToGeometryForGltfAsync(W.name,this._loader.babylonScene,j,k,M).catch((j=>{throw new Error(`${D}: ${j.message}`)}))))),E._dracoBabylonGeometry}))}}J(xD),o(xD,!0,(D=>new RD(D)));var VD=W(12754),UD=W(12011),gD=W(12716),ND=W(12758);UD.e.AddNodeConstructor("Light_Type_0",((D,j)=>()=>new GD(D,C.j.Zero(),j)));class GD extends ND.b{get shadowAngle(){return this._shadowAngle}set shadowAngle(D){this._shadowAngle=D,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(D){const j=this.needCube();if(this._direction=D,this.needCube()!==j&&this._shadowGenerators){const D=this._shadowGenerators.values();for(let j=D.next();!0!==j.done;j=D.next()){j.value.recreateShadowMap()}}}constructor(D,j,W){super(D,W),this._shadowAngle=Math.PI/2,this.position=j}getClassName(){return"PointLight"}getTypeID(){return gD.d.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(D){if(this.direction)return super.getShadowDirection(D);switch(D){case 0:return new C.j(1,0,0);case 1:return new C.j(-1,0,0);case 2:return new C.j(0,-1,0);case 3:return new C.j(0,1,0);case 4:return new C.j(0,0,1);case 5:return new C.j(0,0,-1)}return C.j.Zero()}_setDefaultShadowProjectionMatrix(D,j,W){const Q=this.va().activeCamera;if(!Q)return;const k=void 0!==this.shadowMinZ?this.shadowMinZ:Q.qj,M=void 0!==this.shadowMaxZ?this.shadowMaxZ:Q.maxZ,O=this.va().getEngine().useReverseDepthBuffer;C.b.PerspectiveFovLHToRef(this.shadowAngle,1,O?M:k,O?k:M,D,!0,this._scene.getEngine().isNDCHalfZRange,void 0,O)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(D,j){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,j):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,j),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,j),this}transferToNodeMaterialEffect(D,j){return this.computeTransformedInformation()?D.setFloat3(j,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):D.setFloat3(j,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(D,j){D["POINTLIGHT"+j]=!0}}(0,N.b)([(0,G.O)()],GD.prototype,"shadowAngle",null),(0,e.c)("BABYLON.PointLight",GD),UD.e.AddNodeConstructor("Light_Type_2",((D,j)=>()=>new KD(D,C.j.Zero(),C.j.Zero(),0,0,j)));class KD extends ND.b{get angle(){return this._angle}set angle(D){this._angle=D,this._cosHalfAngle=Math.cos(.5*D),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(D){this._innerAngle=D,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(D){this._shadowAngleScale=D,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(D){this._projectionTextureLightNear=D,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(D){this._projectionTextureLightFar=D,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(D){this._projectionTextureUpDirection=D,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(D){this._projectionTexture!==D&&(this._projectionTexture=D,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(KD._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):KD._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(D){return void 0!==D.onGeneratedObservable}static _IsTexture(D){return void 0!==D.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(D){this._projectionTextureProjectionLightMatrix=D,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(D,j,W,Q,k,M){super(D,M),this._innerAngle=0,this._projectionTextureMatrix=C.b.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=C.j.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=C.j.Zero(),this._projectionTextureViewLightMatrix=C.b.Zero(),this._projectionTextureProjectionLightMatrix=C.b.Zero(),this._projectionTextureScalingMatrix=C.b.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=j,this.direction=W,this.angle=Q,this.exponent=k}getClassName(){return"SpotLight"}getTypeID(){return gD.d.LIGHTTYPEID_SPOTLIGHT}_setDirection(D){super._setDirection(D),this._projectionTextureViewLightDirty=!0}_setPosition(D){super._setPosition(D),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(D,j,W){const Q=this.va().activeCamera;if(!Q)return;this._shadowAngleScale=this._shadowAngleScale||1;const k=this._shadowAngleScale*this._angle,M=void 0!==this.shadowMinZ?this.shadowMinZ:Q.qj,O=void 0!==this.shadowMaxZ?this.shadowMaxZ:Q.maxZ,E=this.va().getEngine().useReverseDepthBuffer;C.b.PerspectiveFovLHToRef(k,1,E?O:M,E?M:O,D,!0,this._scene.getEngine().isNDCHalfZRange,void 0,E)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),C.b.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const D=this.projectionTextureLightFar,j=this.projectionTextureLightNear,W=D/(D-j),Q=-W*j,k=1/Math.tan(this._angle/2);C.b.FromValuesToRef(k/1,0,0,0,0,k,0,0,0,0,W,1,0,0,Q,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof Y.e){const D=this._projectionTexture.uScale/2,j=this._projectionTexture.vScale/2;C.b.FromValuesToRef(D,0,0,0,0,j,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(D,j){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),D.setMatrix("textureProjectionMatrix"+j,this._projectionTextureMatrix),D.setTexture("projectionLightTexture"+j,this.projectionTexture)),this}transferToEffect(D,j){let W;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,j),W=C.j.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,j),W=C.j.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",W.x,W.y,W.z,this._cosHalfAngle,j),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,j),this}transferToNodeMaterialEffect(D,j){let W;return W=this.computeTransformedInformation()?C.j.Normalize(this.transformedDirection):C.j.Normalize(this.direction),this.va().useRightHandedSystem?D.setFloat3(j,-W.x,-W.y,-W.z):D.setFloat3(j,W.x,W.y,W.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose()}getDepthMinZ(D){const j=this._scene.getEngine(),W=void 0!==this.shadowMinZ?this.shadowMinZ:D.qj;return j.useReverseDepthBuffer&&j.isNDCHalfZRange?W:this._scene.getEngine().isNDCHalfZRange?0:W}getDepthMaxZ(D){const j=this._scene.getEngine(),W=void 0!==this.shadowMaxZ?this.shadowMaxZ:D.maxZ;return j.useReverseDepthBuffer&&j.isNDCHalfZRange?0:W}prepareLightSpecificDefines(D,j){D["SPOTLIGHT"+j]=!0,D["PROJECTEDLIGHTTEXTURE"+j]=!(!this.projectionTexture||!this.projectionTexture.isReady())}}(0,N.b)([(0,G.O)()],KD.prototype,"angle",null),(0,N.b)([(0,G.O)()],KD.prototype,"innerAngle",null),(0,N.b)([(0,G.O)()],KD.prototype,"shadowAngleScale",null),(0,N.b)([(0,G.O)()],KD.prototype,"exponent",void 0),(0,N.b)([(0,G.O)()],KD.prototype,"projectionTextureLightNear",null),(0,N.b)([(0,G.O)()],KD.prototype,"projectionTextureLightFar",null),(0,N.b)([(0,G.O)()],KD.prototype,"projectionTextureUpDirection",null),(0,N.b)([(0,G.I)("projectedLightTexture")],KD.prototype,"_projectionTexture",void 0),(0,e.c)("BABYLON.SpotLight",KD);const LD="KHR_lights_punctual";class eD{constructor(D){this.name=LD,this._loader=D,this.enabled=this._loader.isExtensionUsed(LD)}dispose(){this._loader=null,delete this._lights}onLoading(){const D=this._loader.kj.extensions;if(D&&D[this.name]){const j=D[this.name];this._lights=j.lights,d.Assign(this._lights)}}loadNodeAsync(D,j,W){return v.LoadExtensionAsync(D,j,this.name,((Q,M)=>(this._loader._allMaterialsDirtyRequired=!0,this._loader.loadNodeAsync(D,j,(D=>{let j;const O=d.Get(Q,this._lights,M.eb),E=O.name||D.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,O.type){case"directional":{const D=new VD.e(E,C.j.Backward(),this._loader.babylonScene);D.position.Jd(0),j=D;break}case"point":j=new GD(E,C.j.Zero(),this._loader.babylonScene);break;case"spot":{const D=new KD(E,C.j.Zero(),C.j.Backward(),0,1,this._loader.babylonScene);D.angle=2*(O.spot&&O.spot.outerConeAngle||Math.PI/4),D.innerAngle=2*(O.spot&&O.spot.innerConeAngle||0),j=D;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${Q}: Invalid light type (${O.type})`)}j._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,O._babylonLight=j,j.falloffType=gD.d.FALLOFF_GLTF,j.bi=O.color?k.d.Dd(O.color):k.d.White(),j.uj=void 0==O.uj?1:O.uj,j.range=void 0==O.range?Number.MAX_VALUE:O.range,j.parent=D,this._loader._babylonLights.push(j),v.AddPointerMetadata(j,Q),W(D)})))))}}J(LD),o(LD,!0,(D=>new eD(D)));const sD="KHR_materials_pbrSpecularGlossiness";class bD{constructor(D){this.name=sD,this.order=200,this._loader=D,this.enabled=this._loader.isExtensionUsed(sD)}dispose(){this._loader=null}loadMaterialPropertiesAsync(D,j,W){return v.LoadExtensionAsync(D,j,this.name,((Q,C)=>{const k=new Array;return k.push(this._loader.loadMaterialBasePropertiesAsync(D,j,W)),k.push(this._loadSpecularGlossinessPropertiesAsync(Q,C,W)),this._loader.loadMaterialAlphaProperties(D,j,W),Promise.all(k).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(D,j,W){if(!(W instanceof b))throw new Error(`${D}: Material type not supported`);const Q=new Array;return W.metallic=null,W.roughness=null,j.diffuseFactor?(W.albedoColor=k.d.Dd(j.diffuseFactor),W.alpha=j.diffuseFactor[3]):W.albedoColor=k.d.White(),W.reflectivityColor=j.specularFactor?k.d.Dd(j.specularFactor):k.d.White(),W.microSurface=void 0==j.glossinessFactor?1:j.glossinessFactor,j.diffuseTexture&&Q.push(this._loader.loadTextureInfoAsync(`${D}/diffuseTexture`,j.diffuseTexture,(D=>{D.name=`${W.name} (Diffuse)`,W.albedoTexture=D}))),j.specularGlossinessTexture&&(Q.push(this._loader.loadTextureInfoAsync(`${D}/specularGlossinessTexture`,j.specularGlossinessTexture,(D=>{D.name=`${W.name} (Specular Glossiness)`,W.reflectivityTexture=D,W.reflectivityTexture.td=!0}))),W.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(Q).then((()=>{}))}}J(sD),o(sD,!0,(D=>new bD(D)));const YD="KHR_materials_unlit";class tD{constructor(D){this.name=YD,this.order=210,this._loader=D,this.enabled=this._loader.isExtensionUsed(YD)}dispose(){this._loader=null}loadMaterialPropertiesAsync(D,j,W){return v.LoadExtensionAsync(D,j,this.name,(()=>this._loadUnlitPropertiesAsync(D,j,W)))}_loadUnlitPropertiesAsync(D,j,W){if(!(W instanceof b))throw new Error(`${D}: Material type not supported`);const Q=new Array;W.unlit=!0;const C=j.pbrMetallicRoughness;return C&&(C.baseColorFactor?(W.albedoColor=k.d.Dd(C.baseColorFactor),W.alpha=C.baseColorFactor[3]):W.albedoColor=k.d.White(),C.baseColorTexture&&Q.push(this._loader.loadTextureInfoAsync(`${D}/baseColorTexture`,C.baseColorTexture,(D=>{D.name=`${W.name} (Base Color)`,W.albedoTexture=D})))),j.doubleSided&&(W.Se=!1,W.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(D,j,W),Promise.all(Q).then((()=>{}))}}J(YD),o(YD,!0,(D=>new tD(D)));const cD="KHR_materials_clearcoat";class lD{constructor(D){this.name=cD,this.order=190,this._loader=D,this.enabled=this._loader.isExtensionUsed(cD)}dispose(){this._loader=null}loadMaterialPropertiesAsync(D,j,W){return v.LoadExtensionAsync(D,j,this.name,((Q,C)=>{const k=new Array;return k.push(this._loader.loadMaterialPropertiesAsync(D,j,W)),k.push(this._loadClearCoatPropertiesAsync(Q,C,W)),Promise.all(k).then((()=>{}))}))}_loadClearCoatPropertiesAsync(D,j,W){if(!(W instanceof b))throw new Error(`${D}: Material type not supported`);const Q=new Array;return W.clearCoat.isEnabled=!0,W.clearCoat.useRoughnessFromMainTexture=!1,W.clearCoat.remapF0OnInterfaceChange=!1,void 0!=j.clearcoatFactor?W.clearCoat.uj=j.clearcoatFactor:W.clearCoat.uj=0,j.clearcoatTexture&&Q.push(this._loader.loadTextureInfoAsync(`${D}/clearcoatTexture`,j.clearcoatTexture,(D=>{D.name=`${W.name} (ClearCoat)`,W.clearCoat.texture=D}))),void 0!=j.clearcoatRoughnessFactor?W.clearCoat.roughness=j.clearcoatRoughnessFactor:W.clearCoat.roughness=0,j.clearcoatRoughnessTexture&&(j.clearcoatRoughnessTexture.nonColorData=!0,Q.push(this._loader.loadTextureInfoAsync(`${D}/clearcoatRoughnessTexture`,j.clearcoatRoughnessTexture,(D=>{D.name=`${W.name} (ClearCoat Roughness)`,W.clearCoat.textureRoughness=D})))),j.clearcoatNormalTexture&&(j.clearcoatNormalTexture.nonColorData=!0,Q.push(this._loader.loadTextureInfoAsync(`${D}/clearcoatNormalTexture`,j.clearcoatNormalTexture,(D=>{D.name=`${W.name} (ClearCoat Normal)`,W.clearCoat.bumpTexture=D}))),W.invertNormalMapX=!W.va().useRightHandedSystem,W.invertNormalMapY=W.va().useRightHandedSystem,void 0!=j.clearcoatNormalTexture.scale&&(W.clearCoat.bumpTexture.level=j.clearcoatNormalTexture.scale)),Promise.all(Q).then((()=>{}))}}J(cD),o(cD,!0,(D=>new lD(D)));const ID="KHR_materials_iridescence";class yD{constructor(D){this.name=ID,this.order=195,this._loader=D,this.enabled=this._loader.isExtensionUsed(ID)}dispose(){this._loader=null}loadMaterialPropertiesAsync(D,j,W){return v.LoadExtensionAsync(D,j,this.name,((Q,C)=>{const k=new Array;return k.push(this._loader.loadMaterialPropertiesAsync(D,j,W)),k.push(this._loadIridescencePropertiesAsync(Q,C,W)),Promise.all(k).then((()=>{}))}))}_loadIridescencePropertiesAsync(D,j,W){if(!(W instanceof b))throw new Error(`${D}: Material type not supported`);const Q=new Array;return W.iridescence.isEnabled=!0,W.iridescence.uj=j.iridescenceFactor??0,W.iridescence.indexOfRefraction=j.iridescenceIor??j.iridescenceIOR??1.3,W.iridescence.minimumThickness=j.iridescenceThicknessMinimum??100,W.iridescence.maximumThickness=j.iridescenceThicknessMaximum??400,j.iridescenceTexture&&Q.push(this._loader.loadTextureInfoAsync(`${D}/iridescenceTexture`,j.iridescenceTexture,(D=>{D.name=`${W.name} (Iridescence)`,W.iridescence.texture=D}))),j.iridescenceThicknessTexture&&Q.push(this._loader.loadTextureInfoAsync(`${D}/iridescenceThicknessTexture`,j.iridescenceThicknessTexture,(D=>{D.name=`${W.name} (Iridescence Thickness)`,W.iridescence.thicknessTexture=D}))),Promise.all(Q).then((()=>{}))}}J(ID),o(ID,!0,(D=>new yD(D)));const mD="KHR_materials_anisotropy";class aD{constructor(D){this.name=mD,this.order=195,this._loader=D,this.enabled=this._loader.isExtensionUsed(mD)}dispose(){this._loader=null}loadMaterialPropertiesAsync(D,j,W){return v.LoadExtensionAsync(D,j,this.name,((Q,C)=>{const k=new Array;return k.push(this._loader.loadMaterialPropertiesAsync(D,j,W)),k.push(this._loadIridescencePropertiesAsync(Q,C,W)),Promise.all(k).then((()=>{}))}))}_loadIridescencePropertiesAsync(D,j,W){if(!(W instanceof b))throw new Error(`${D}: Material type not supported`);const Q=new Array;return W.anisotropy.isEnabled=!0,W.anisotropy.uj=j.anisotropyStrength??0,W.anisotropy.angle=j.anisotropyRotation??0,j.anisotropyTexture&&(j.anisotropyTexture.nonColorData=!0,Q.push(this._loader.loadTextureInfoAsync(`${D}/anisotropyTexture`,j.anisotropyTexture,(D=>{D.name=`${W.name} (Anisotropy Intensity)`,W.anisotropy.texture=D})))),Promise.all(Q).then((()=>{}))}}J(mD),o(mD,!0,(D=>new aD(D)));const SD="KHR_materials_emissive_strength";class HD{constructor(D){this.name=SD,this.order=170,this._loader=D,this.enabled=this._loader.isExtensionUsed(SD)}dispose(){this._loader=null}loadMaterialPropertiesAsync(D,j,W){return v.LoadExtensionAsync(D,j,this.name,((Q,C)=>this._loader.loadMaterialPropertiesAsync(D,j,W).then((()=>{this._loadEmissiveProperties(Q,C,W)}))))}_loadEmissiveProperties(D,j,W){if(!(W instanceof b))throw new Error(`${D}: Material type not supported`);void 0!==j.emissiveStrength&&(W.emissiveIntensity=j.emissiveStrength)}}J(SD),o(SD,!0,(D=>new HD(D)));const zD="KHR_materials_sheen";class iD{constructor(D){this.name=zD,this.order=190,this._loader=D,this.enabled=this._loader.isExtensionUsed(zD)}dispose(){this._loader=null}loadMaterialPropertiesAsync(D,j,W){return v.LoadExtensionAsync(D,j,this.name,((Q,C)=>{const k=new Array;return k.push(this._loader.loadMaterialPropertiesAsync(D,j,W)),k.push(this._loadSheenPropertiesAsync(Q,C,W)),Promise.all(k).then((()=>{}))}))}_loadSheenPropertiesAsync(D,j,W){if(!(W instanceof b))throw new Error(`${D}: Material type not supported`);const Q=new Array;return W.sheen.isEnabled=!0,W.sheen.uj=1,void 0!=j.sheenColorFactor?W.sheen.color=k.d.Dd(j.sheenColorFactor):W.sheen.color=k.d.Black(),j.sheenColorTexture&&Q.push(this._loader.loadTextureInfoAsync(`${D}/sheenColorTexture`,j.sheenColorTexture,(D=>{D.name=`${W.name} (Sheen Color)`,W.sheen.texture=D}))),void 0!==j.sheenRoughnessFactor?W.sheen.roughness=j.sheenRoughnessFactor:W.sheen.roughness=0,j.sheenRoughnessTexture&&(j.sheenRoughnessTexture.nonColorData=!0,Q.push(this._loader.loadTextureInfoAsync(`${D}/sheenRoughnessTexture`,j.sheenRoughnessTexture,(D=>{D.name=`${W.name} (Sheen Roughness)`,W.sheen.textureRoughness=D})))),W.sheen.albedoScaling=!0,W.sheen.useRoughnessFromMainTexture=!1,Promise.all(Q).then((()=>{}))}}J(zD),o(zD,!0,(D=>new iD(D)));const pD="KHR_materials_specular";class TD{constructor(D){this.name=pD,this.order=190,this._loader=D,this.enabled=this._loader.isExtensionUsed(pD)}dispose(){this._loader=null}loadMaterialPropertiesAsync(D,j,W){return v.LoadExtensionAsync(D,j,this.name,((Q,C)=>{const k=new Array;return k.push(this._loader.loadMaterialPropertiesAsync(D,j,W)),k.push(this._loadSpecularPropertiesAsync(Q,C,W)),Promise.all(k).then((()=>{}))}))}_loadSpecularPropertiesAsync(D,j,W){if(!(W instanceof b))throw new Error(`${D}: Material type not supported`);const Q=new Array;return void 0!==j.specularFactor&&(W.metallicF0Factor=j.specularFactor),void 0!==j.specularColorFactor&&(W.metallicReflectanceColor=k.d.Dd(j.specularColorFactor)),j.specularTexture&&(j.specularTexture.nonColorData=!0,Q.push(this._loader.loadTextureInfoAsync(`${D}/specularTexture`,j.specularTexture,(D=>{D.name=`${W.name} (Specular)`,W.metallicReflectanceTexture=D,W.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),j.specularColorTexture&&Q.push(this._loader.loadTextureInfoAsync(`${D}/specularColorTexture`,j.specularColorTexture,(D=>{D.name=`${W.name} (Specular Color)`,W.reflectanceTexture=D}))),Promise.all(Q).then((()=>{}))}}J(pD),o(pD,!0,(D=>new TD(D)));const AD="KHR_materials_ior";class wD{constructor(D){this.name=AD,this.order=180,this._loader=D,this.enabled=this._loader.isExtensionUsed(AD)}dispose(){this._loader=null}loadMaterialPropertiesAsync(D,j,W){return v.LoadExtensionAsync(D,j,this.name,((Q,C)=>{const k=new Array;return k.push(this._loader.loadMaterialPropertiesAsync(D,j,W)),k.push(this._loadIorPropertiesAsync(Q,C,W)),Promise.all(k).then((()=>{}))}))}_loadIorPropertiesAsync(D,j,W){if(!(W instanceof b))throw new Error(`${D}: Material type not supported`);return void 0!==j.ior?W.indexOfRefraction=j.ior:W.indexOfRefraction=wD._DEFAULT_IOR,Promise.resolve()}}wD._DEFAULT_IOR=1.5,J(AD),o(AD,!0,(D=>new wD(D)));const nD="KHR_materials_variants";class uD{constructor(D){this.name=nD,this._loader=D,this.enabled=this._loader.isExtensionUsed(nD)}dispose(){this._loader=null}static GetAvailableVariants(D){const j=this._GetExtensionMetadata(D);return j?Object.keys(j.variants):[]}getAvailableVariants(D){return uD.GetAvailableVariants(D)}static SelectVariant(D,j){const W=this._GetExtensionMetadata(D);if(!W)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${nD} extension`);const Q=D=>{const j=W.variants[D];if(j)for(const W of j)W.mesh.material=W.material};if(j instanceof Array)for(const C of j)Q(C);else Q(j);W.lastSelected=j}selectVariant(D,j){uD.SelectVariant(D,j)}static Reset(D){const j=this._GetExtensionMetadata(D);if(!j)throw new Error(`Cannot reset on a glTF mesh that does not have the ${nD} extension`);for(const W of j.original)W.mesh.material=W.material;j.lastSelected=null}reset(D){uD.Reset(D)}static GetLastSelectedVariant(D){const j=this._GetExtensionMetadata(D);if(!j)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${nD} extension`);return j.lastSelected}getLastSelectedVariant(D){return uD.GetLastSelectedVariant(D)}static _GetExtensionMetadata(D){var j,W;return(null===D||void 0===D||null===(j=D._internalMetadata)||void 0===j||null===(W=j.kj)||void 0===W?void 0:W[nD])||null}onLoading(){const D=this._loader.kj.extensions;if(D&&D[this.name]){const j=D[this.name];this._variants=j.variants}}_loadMeshPrimitiveAsync(D,j,W,Q,C,k){return v.LoadExtensionAsync(D,C,this.name,((M,O)=>{const E=new Array;return E.push(this._loader._loadMeshPrimitiveAsync(D,j,W,Q,C,(j=>{if(k(j),j instanceof y.d){const W=v._GetDrawMode(D,C.mode),Q=this._loader.rootBabylonMesh,k=Q?Q._internalMetadata=Q._internalMetadata||{}:{},f=k.kj=k.kj||{},F=f[nD]=f[nD]||{lastSelected:null,original:[],variants:{}};F.original.push({mesh:j,material:j.material});for(let D=0;D<O.mappings.length;++D){const C=O.mappings[D],k=d.Get(`${M}/mappings/${D}/material`,this._loader.kj.materials,C.material);E.push(this._loader._loadMaterialAsync(`#/materials/${C.material}`,k,j,W,(D=>{for(let W=0;W<C.variants.length;++W){const k=C.variants[W],M=d.Get(`/extensions/${nD}/variants/${k}`,this._variants,k);F.variants[M.name]=F.variants[M.name]||[],F.variants[M.name].push({mesh:j,material:D}),j.onClonedObservable.add((D=>{const W=D;let C=null,k=W;do{if(k=k.parent,!k)return;C=uD._GetExtensionMetadata(k)}while(null===C);if(Q&&C===uD._GetExtensionMetadata(Q)){k._internalMetadata={};for(const D in Q._internalMetadata)k._internalMetadata[D]=Q._internalMetadata[D];k._internalMetadata.kj=[];for(const D in Q._internalMetadata.kj)k._internalMetadata.kj[D]=Q._internalMetadata.kj[D];k._internalMetadata.kj[nD]={lastSelected:null,original:[],variants:{}};for(const D of C.original)k._internalMetadata.kj[nD].original.push({mesh:D.mesh,material:D.material});for(const D in C.variants)if(Object.prototype.hasOwnProperty.call(C.variants,D)){k._internalMetadata.kj[nD].variants[D]=[];for(const j of C.variants[D])k._internalMetadata.kj[nD].variants[D].push({mesh:j.mesh,material:j.material})}C=k._internalMetadata.kj[nD]}for(const Q of C.original)Q.mesh===j&&(Q.mesh=W);for(const Q of C.variants[M.name])Q.mesh===j&&(Q.mesh=W)}))}})))}}}))),Promise.all(E).then((D=>{let[j]=D;return j}))}))}}J(nD),o(nD,!0,(D=>new uD(D)));var qD=W(1549);class oD{}oD.AUTOSAMPLERSUFFIX="Sampler",oD.DISABLEUA="#define DISABLE_UNIFORMITY_ANALYSIS",oD.ALPHA_DISABLE=0,oD.ALPHA_ADD=1,oD.ALPHA_COMBINE=2,oD.ALPHA_SUBTRACT=3,oD.ALPHA_MULTIPLY=4,oD.ALPHA_MAXIMIZED=5,oD.ALPHA_ONEONE=6,oD.ALPHA_PREMULTIPLIED=7,oD.ALPHA_PREMULTIPLIED_PORTERDUFF=8,oD.ALPHA_INTERPOLATE=9,oD.ALPHA_SCREENMODE=10,oD.ALPHA_ONEONE_ONEONE=11,oD.ALPHA_ALPHATOCOLOR=12,oD.ALPHA_REVERSEONEMINUS=13,oD.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,oD.ALPHA_ONEONE_ONEZERO=15,oD.ALPHA_EXCLUSION=16,oD.ALPHA_LAYER_ACCUMULATE=17,oD.ALPHA_EQUATION_ADD=0,oD.ALPHA_EQUATION_SUBSTRACT=1,oD.ALPHA_EQUATION_REVERSE_SUBTRACT=2,oD.ALPHA_EQUATION_MAX=3,oD.ALPHA_EQUATION_MIN=4,oD.ALPHA_EQUATION_DARKEN=5,oD.DELAYLOADSTATE_NONE=0,oD.DELAYLOADSTATE_LOADED=1,oD.DELAYLOADSTATE_LOADING=2,oD.DELAYLOADSTATE_NOTLOADED=4,oD.NEVER=512,oD.ALWAYS=519,oD.LESS=513,oD.EQUAL=514,oD.LEQUAL=515,oD.GREATER=516,oD.GEQUAL=518,oD.NOTEQUAL=517,oD.KEEP=7680,oD.ZERO=0,oD.REPLACE=7681,oD.INCR=7682,oD.DECR=7683,oD.INVERT=5386,oD.INCR_WRAP=34055,oD.DECR_WRAP=34056,oD.TEXTURE_CLAMP_ADDRESSMODE=0,oD.TEXTURE_WRAP_ADDRESSMODE=1,oD.TEXTURE_MIRROR_ADDRESSMODE=2,oD.TEXTURE_CREATIONFLAG_STORAGE=1,oD.TEXTUREFORMAT_ALPHA=0,oD.TEXTUREFORMAT_LUMINANCE=1,oD.TEXTUREFORMAT_LUMINANCE_ALPHA=2,oD.TEXTUREFORMAT_RGB=4,oD.TEXTUREFORMAT_RGBA=5,oD.TEXTUREFORMAT_RED=6,oD.TEXTUREFORMAT_R=6,oD.TEXTUREFORMAT_RG=7,oD.TEXTUREFORMAT_RED_INTEGER=8,oD.TEXTUREFORMAT_R_INTEGER=8,oD.TEXTUREFORMAT_RG_INTEGER=9,oD.TEXTUREFORMAT_RGB_INTEGER=10,oD.TEXTUREFORMAT_RGBA_INTEGER=11,oD.TEXTUREFORMAT_BGRA=12,oD.TEXTUREFORMAT_DEPTH24_STENCIL8=13,oD.TEXTUREFORMAT_DEPTH32_FLOAT=14,oD.TEXTUREFORMAT_DEPTH16=15,oD.TEXTUREFORMAT_DEPTH24=16,oD.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17,oD.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18,oD.TEXTUREFORMAT_STENCIL8=19,oD.TEXTUREFORMAT_UNDEFINED=4294967295,oD.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492,oD.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493,oD.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495,oD.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494,oD.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779,oD.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919,oD.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778,oD.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918,oD.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777,oD.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776,oD.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917,oD.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916,oD.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808,oD.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840,oD.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196,oD.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492,oD.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493,oD.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494,oD.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495,oD.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496,oD.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497,oD.TEXTURETYPE_UNSIGNED_BYTE=0,oD.TEXTURETYPE_UNSIGNED_INT=0,oD.TEXTURETYPE_FLOAT=1,oD.TEXTURETYPE_HALF_FLOAT=2,oD.TEXTURETYPE_BYTE=3,oD.TEXTURETYPE_SHORT=4,oD.TEXTURETYPE_UNSIGNED_SHORT=5,oD.TEXTURETYPE_INT=6,oD.TEXTURETYPE_UNSIGNED_INTEGER=7,oD.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,oD.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,oD.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,oD.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,oD.TEXTURETYPE_UNSIGNED_INT_24_8=12,oD.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,oD.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,oD.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,oD.TEXTURETYPE_UNDEFINED=16,oD.TEXTURE_2D=3553,oD.TEXTURE_2D_ARRAY=35866,oD.TEXTURE_CUBE_MAP=34067,oD.TEXTURE_CUBE_MAP_ARRAY=3735928559,oD.TEXTURE_3D=32879,oD.TEXTURE_NEAREST_SAMPLINGMODE=1,oD.TEXTURE_NEAREST_NEAREST=1,oD.TEXTURE_BILINEAR_SAMPLINGMODE=2,oD.TEXTURE_LINEAR_LINEAR=2,oD.TEXTURE_TRILINEAR_SAMPLINGMODE=3,oD.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,oD.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,oD.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,oD.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,oD.TEXTURE_NEAREST_LINEAR=7,oD.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,oD.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,oD.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,oD.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,oD.TEXTURE_LINEAR_NEAREST=12,oD.TEXTURE_EXPLICIT_MODE=0,oD.TEXTURE_SPHERICAL_MODE=1,oD.TEXTURE_PLANAR_MODE=2,oD.TEXTURE_CUBIC_MODE=3,oD.TEXTURE_PROJECTION_MODE=4,oD.TEXTURE_SKYBOX_MODE=5,oD.TEXTURE_INVCUBIC_MODE=6,oD.TEXTURE_EQUIRECTANGULAR_MODE=7,oD.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,oD.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,oD.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,oD.TEXTURE_FILTERING_QUALITY_HIGH=64,oD.TEXTURE_FILTERING_QUALITY_MEDIUM=16,oD.TEXTURE_FILTERING_QUALITY_LOW=8,oD.SCALEMODE_FLOOR=1,oD.SCALEMODE_NEAREST=2,oD.SCALEMODE_CEILING=3,oD.MATERIAL_TextureDirtyFlag=1,oD.MATERIAL_LightDirtyFlag=2,oD.MATERIAL_FresnelDirtyFlag=4,oD.MATERIAL_AttributesDirtyFlag=8,oD.MATERIAL_MiscDirtyFlag=16,oD.MATERIAL_PrePassDirtyFlag=32,oD.MATERIAL_AllDirtyFlag=63,oD.MATERIAL_TriangleFillMode=0,oD.MATERIAL_WireFrameFillMode=1,oD.MATERIAL_PointFillMode=2,oD.MATERIAL_PointListDrawMode=3,oD.MATERIAL_LineListDrawMode=4,oD.MATERIAL_LineLoopDrawMode=5,oD.MATERIAL_LineStripDrawMode=6,oD.MATERIAL_TriangleStripDrawMode=7,oD.MATERIAL_TriangleFanDrawMode=8,oD.MATERIAL_ClockWiseSideOrientation=0,oD.MATERIAL_CounterClockWiseSideOrientation=1,oD.ACTION_NothingTrigger=0,oD.ACTION_OnPickTrigger=1,oD.ACTION_OnLeftPickTrigger=2,oD.ACTION_OnRightPickTrigger=3,oD.ACTION_OnCenterPickTrigger=4,oD.ACTION_OnPickDownTrigger=5,oD.ACTION_OnDoublePickTrigger=6,oD.ACTION_OnPickUpTrigger=7,oD.ACTION_OnPickOutTrigger=16,oD.ACTION_OnLongPressTrigger=8,oD.ACTION_OnPointerOverTrigger=9,oD.ACTION_OnPointerOutTrigger=10,oD.ACTION_OnEveryFrameTrigger=11,oD.ACTION_OnIntersectionEnterTrigger=12,oD.ACTION_OnIntersectionExitTrigger=13,oD.ACTION_OnKeyDownTrigger=14,oD.ACTION_OnKeyUpTrigger=15,oD.PARTICLES_BILLBOARDMODE_Y=2,oD.PARTICLES_BILLBOARDMODE_ALL=7,oD.PARTICLES_BILLBOARDMODE_STRETCHED=8,oD.PARTICLES_BILLBOARDMODE_STRETCHED_LOCAL=9,oD.MESHES_CULLINGSTRATEGY_STANDARD=0,oD.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,oD.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,oD.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,oD.SCENELOADER_NO_LOGGING=0,oD.SCENELOADER_MINIMAL_LOGGING=1,oD.SCENELOADER_SUMMARY_LOGGING=2,oD.SCENELOADER_DETAILED_LOGGING=3,oD.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,oD.PREPASS_POSITION_TEXTURE_TYPE=1,oD.PREPASS_VELOCITY_TEXTURE_TYPE=2,oD.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,oD.PREPASS_COLOR_TEXTURE_TYPE=4,oD.PREPASS_DEPTH_TEXTURE_TYPE=5,oD.PREPASS_NORMAL_TEXTURE_TYPE=6,oD.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7,oD.PREPASS_WORLD_NORMAL_TEXTURE_TYPE=8,oD.PREPASS_LOCAL_POSITION_TEXTURE_TYPE=9,oD.PREPASS_SCREENSPACE_DEPTH_TEXTURE_TYPE=10,oD.PREPASS_VELOCITY_LINEAR_TEXTURE_TYPE=11,oD.PREPASS_ALBEDO_TEXTURE_TYPE=12,oD.BUFFER_CREATIONFLAG_READ=1,oD.BUFFER_CREATIONFLAG_WRITE=2,oD.BUFFER_CREATIONFLAG_READWRITE=3,oD.BUFFER_CREATIONFLAG_UNIFORM=4,oD.BUFFER_CREATIONFLAG_VERTEX=8,oD.BUFFER_CREATIONFLAG_INDEX=16,oD.BUFFER_CREATIONFLAG_STORAGE=32,oD.BUFFER_CREATIONFLAG_INDIRECT=64,oD.RENDERPASS_MAIN=0,oD.INPUT_ALT_KEY=18,oD.INPUT_CTRL_KEY=17,oD.INPUT_META_KEY1=91,oD.INPUT_META_KEY2=92,oD.INPUT_META_KEY3=93,oD.INPUT_SHIFT_KEY=16,oD.SNAPSHOTRENDERING_STANDARD=0,oD.SNAPSHOTRENDERING_FAST=1,oD.PERSPECTIVE_CAMERA=0,oD.ORTHOGRAPHIC_CAMERA=1,oD.FOVMODE_VERTICAL_FIXED=0,oD.FOVMODE_HORIZONTAL_FIXED=1,oD.RIG_MODE_NONE=0,oD.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,oD.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,oD.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,oD.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,oD.RIG_MODE_STEREOSCOPIC_INTERLACED=14,oD.RIG_MODE_VR=20,oD.RIG_MODE_CUSTOM=22,oD.MAX_SUPPORTED_UV_SETS=6,oD.GL_ALPHA_EQUATION_ADD=32774,oD.GL_ALPHA_EQUATION_MIN=32775,oD.GL_ALPHA_EQUATION_MAX=32776,oD.GL_ALPHA_EQUATION_SUBTRACT=32778,oD.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779,oD.GL_ALPHA_FUNCTION_SRC=768,oD.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769,oD.GL_ALPHA_FUNCTION_SRC_ALPHA=770,oD.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771,oD.GL_ALPHA_FUNCTION_DST_ALPHA=772,oD.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773,oD.GL_ALPHA_FUNCTION_DST_COLOR=774,oD.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775,oD.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776,oD.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769,oD.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770,oD.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771,oD.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772,oD.GL_ALPHA_FUNCTION_SRC1_COLOR=35065,oD.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_COLOR=35066,oD.GL_ALPHA_FUNCTION_SRC1_ALPHA=34185,oD.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_ALPHA=35067,oD.SnippetUrl="https://snippet.babylonjs.com",oD.FOGMODE_NONE=0,oD.FOGMODE_EXP=1,oD.FOGMODE_EXP2=2,oD.FOGMODE_LINEAR=3,oD.BYTE=5120,oD.UNSIGNED_BYTE=5121,oD.SHORT=5122,oD.UNSIGNED_SHORT=5123,oD.INT=5124,oD.UNSIGNED_INT=5125,oD.FLOAT=5126,oD.PositionKind="position",oD.NormalKind="Md",oD.TangentKind="tangent",oD.UVKind="uv",oD.UV2Kind="uv2",oD.UV3Kind="uv3",oD.UV4Kind="uv4",oD.UV5Kind="uv5",oD.UV6Kind="uv6",oD.ColorKind="color",oD.ColorInstanceKind="instanceColor",oD.MatricesIndicesKind="matricesIndices",oD.MatricesWeightsKind="matricesWeights",oD.MatricesIndicesExtraKind="matricesIndicesExtra",oD.MatricesWeightsExtraKind="matricesWeightsExtra";class JD{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:oD.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(D,j){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...JD._GetDefaultOptions(),...D},this._scene=j,this._scene._transmissionHelper=this,this.onErrorObservable=new F.d,this._scene.Qd.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(D){if(!Object.keys(D).filter((j=>this._options[j]!==D[j])).length)return;const j={...this._options,...D},W=this._options;this._options=j,j.renderSize===W.renderSize&&j.renderTargetTextureType===W.renderTargetTextureType&&j.generateMipmaps===W.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=j.samples,this._opaqueRenderTarget.lodGenerationScale=j.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=j.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(D){return!!D&&!!(D instanceof b&&D.subSurface.isRefractionEnabled)}_addMesh(D){this._materialObservers[D.uniqueId]=D.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),M.f.SetImmediate((()=>{this._shouldRenderAsTransmission(D.material)?(D.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(D)&&this._transparentMeshesCache.push(D)):-1===this._opaqueMeshesCache.indexOf(D)&&this._opaqueMeshesCache.push(D)}))}_removeMesh(D){D.onMaterialChangedObservable.remove(this._materialObservers[D.uniqueId]),delete this._materialObservers[D.uniqueId];let j=this._transparentMeshesCache.indexOf(D);-1!==j&&this._transparentMeshesCache.splice(j,1),j=this._opaqueMeshesCache.indexOf(D),-1!==j&&this._opaqueMeshesCache.splice(j,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(D){const j=this._transparentMeshesCache.indexOf(D),W=this._opaqueMeshesCache.indexOf(D);this._shouldRenderAsTransmission(D.material)?(D.material instanceof b&&(D.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==W?(this._opaqueMeshesCache.splice(W,1),this._transparentMeshesCache.push(D)):-1===j&&this._transparentMeshesCache.push(D)):-1!==j?(this._transparentMeshesCache.splice(j,1),this._opaqueMeshesCache.push(D)):-1===W&&this._opaqueMeshesCache.push(D)}_isRenderTargetValid(){var D;return null!==(null===(D=this._opaqueRenderTarget)||void 0===D?void 0:D.getInternalTexture())}_setupRenderTargets(){var D;let j,W;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new qD.c("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(D=this._options.clearColor)||void 0===D?void 0:D.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((D=>{W=this._scene.environmentIntensity,this._scene.environmentIntensity=1,j=this._scene.imageProcessingConfiguration.applyByPostProcess,this._options.clearColor?D.clearColor.p(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(D.clearColor,this._scene.getEngine().useExactSrgbConversions),this._scene.imageProcessingConfiguration._applyByPostProcess=!0})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=W,this._scene.imageProcessingConfiguration._applyByPostProcess=j})),this._transparentMeshesCache.forEach((D=>{this._shouldRenderAsTransmission(D.material)&&(D.material.refractionTexture=this._opaqueRenderTarget)}))}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const hD="KHR_materials_transmission";class dD{constructor(D){this.name=hD,this.order=175,this._loader=D,this.enabled=this._loader.isExtensionUsed(hD),this.enabled&&(D.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(D,j,W){return v.LoadExtensionAsync(D,j,this.name,((Q,C)=>{const k=new Array;return k.push(this._loader.loadMaterialPropertiesAsync(D,j,W)),k.push(this._loadTransparentPropertiesAsync(Q,j,W,C)),Promise.all(k).then((()=>{}))}))}_loadTransparentPropertiesAsync(D,j,W,Q){if(!(W instanceof b))throw new Error(`${D}: Material type not supported`);const C=W;if(C.subSurface.isRefractionEnabled=!0,C.subSurface.volumeIndexOfRefraction=1,C.subSurface.useAlbedoToTintRefraction=!0,void 0===Q.transmissionFactor)return C.subSurface.refractionIntensity=0,C.subSurface.isRefractionEnabled=!1,Promise.resolve();{var k;C.subSurface.refractionIntensity=Q.transmissionFactor;const D=C.va();if(C.subSurface.refractionIntensity&&!D._transmissionHelper)new JD({},C.va());else if(C.subSurface.refractionIntensity&&(null===(k=D._transmissionHelper)||void 0===k||!k._isRenderTargetValid())){var M;null===(M=D._transmissionHelper)||void 0===M||M._setupRenderTargets()}}return C.subSurface.minimumThickness=0,C.subSurface.maximumThickness=0,Q.transmissionTexture?(Q.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${D}/transmissionTexture`,Q.transmissionTexture,void 0).then((D=>{D.name=`${W.name} (Transmission)`,C.subSurface.refractionIntensityTexture=D,C.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}J(hD),o(hD,!0,(D=>new dD(D)));const vD="KHR_materials_diffuse_transmission";class BD{constructor(D){this.name=vD,this.order=174,this._loader=D,this.enabled=this._loader.isExtensionUsed(vD),this.enabled&&(D.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(D,j,W){return v.LoadExtensionAsync(D,j,this.name,((Q,C)=>{const k=new Array;return k.push(this._loader.loadMaterialPropertiesAsync(D,j,W)),k.push(this._loadTranslucentPropertiesAsync(Q,j,W,C)),Promise.all(k).then((()=>{}))}))}_loadTranslucentPropertiesAsync(D,j,W,Q){if(!(W instanceof b))throw new Error(`${D}: Material type not supported`);const C=W;if(C.subSurface.isTranslucencyEnabled=!0,C.subSurface.volumeIndexOfRefraction=1,C.subSurface.minimumThickness=0,C.subSurface.maximumThickness=0,C.subSurface.useAlbedoToTintTranslucency=!1,void 0===Q.diffuseTransmissionFactor)return C.subSurface.translucencyIntensity=0,C.subSurface.isTranslucencyEnabled=!1,Promise.resolve();C.subSurface.translucencyIntensity=Q.diffuseTransmissionFactor;const M=new Array;return C.subSurface.useGltfStyleTextures=!0,Q.diffuseTransmissionTexture&&(Q.diffuseTransmissionTexture.nonColorData=!0,M.push(this._loader.loadTextureInfoAsync(`${D}/diffuseTransmissionTexture`,Q.diffuseTransmissionTexture).then((D=>{D.name=`${W.name} (Diffuse Transmission)`,C.subSurface.translucencyIntensityTexture=D})))),void 0!==Q.diffuseTransmissionColorFactor?C.subSurface.translucencyColor=k.d.Dd(Q.diffuseTransmissionColorFactor):C.subSurface.translucencyColor=k.d.White(),Q.diffuseTransmissionColorTexture&&M.push(this._loader.loadTextureInfoAsync(`${D}/diffuseTransmissionColorTexture`,Q.diffuseTransmissionColorTexture).then((D=>{D.name=`${W.name} (Diffuse Transmission Color)`,C.subSurface.translucencyColorTexture=D}))),Promise.all(M).then((()=>{}))}}J(vD),o(vD,!0,(D=>new BD(D)));const rD="KHR_materials_volume";class Dj{constructor(D){this.name=rD,this.order=173,this._loader=D,this.enabled=this._loader.isExtensionUsed(rD),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(D,j,W){return v.LoadExtensionAsync(D,j,this.name,((Q,C)=>{const k=new Array;return k.push(this._loader.loadMaterialPropertiesAsync(D,j,W)),k.push(this._loadVolumePropertiesAsync(Q,j,W,C)),Promise.all(k).then((()=>{}))}))}_loadVolumePropertiesAsync(D,j,W,Q){if(!(W instanceof b))throw new Error(`${D}: Material type not supported`);if(!W.subSurface.isRefractionEnabled&&!W.subSurface.isTranslucencyEnabled||!Q.thicknessFactor)return Promise.resolve();W.subSurface.volumeIndexOfRefraction=W.indexOfRefraction;const C=void 0!==Q.attenuationDistance?Q.attenuationDistance:Number.MAX_VALUE;return W.subSurface.tintColorAtDistance=C,void 0!==Q.attenuationColor&&3==Q.attenuationColor.length&&W.subSurface.tintColor.Id(Q.attenuationColor[0],Q.attenuationColor[1],Q.attenuationColor[2]),W.subSurface.minimumThickness=0,W.subSurface.maximumThickness=Q.thicknessFactor,W.subSurface.useThicknessAsDepth=!0,Q.thicknessTexture?(Q.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${D}/thicknessTexture`,Q.thicknessTexture).then((D=>{D.name=`${W.name} (Thickness)`,W.subSurface.thicknessTexture=D,W.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}J(rD),o(rD,!0,(D=>new Dj(D)));const jj="KHR_materials_dispersion";class Wj{constructor(D){this.name=jj,this.order=174,this._loader=D,this.enabled=this._loader.isExtensionUsed(jj)}dispose(){this._loader=null}loadMaterialPropertiesAsync(D,j,W){return v.LoadExtensionAsync(D,j,this.name,((Q,C)=>{const k=new Array;return k.push(this._loader.loadMaterialPropertiesAsync(D,j,W)),k.push(this._loadDispersionPropertiesAsync(Q,j,W,C)),Promise.all(k).then((()=>{}))}))}_loadDispersionPropertiesAsync(D,j,W,Q){if(!(W instanceof b))throw new Error(`${D}: Material type not supported`);return W.subSurface.isRefractionEnabled&&Q.dispersion?(W.subSurface.isDispersionEnabled=!0,W.subSurface.dispersion=Q.dispersion,Promise.resolve()):Promise.resolve()}}J(jj),o(jj,!0,(D=>new Wj(D)));const Qj="KHR_mesh_quantization";class Cj{constructor(D){this.name=Qj,this.enabled=D.isExtensionUsed(Qj)}dispose(){}}J(Qj),o(Qj,!0,(D=>new Cj(D)));const kj="KHR_texture_basisu";class Mj{constructor(D){this.name=kj,this._loader=D,this.enabled=D.isExtensionUsed(kj)}dispose(){this._loader=null}_loadTextureAsync(D,j,W){return v.LoadExtensionAsync(D,j,this.name,((Q,C)=>{const k=void 0==j.sampler?v.DefaultSampler:d.Get(`${D}/sampler`,this._loader.kj.samplers,j.sampler),M=d.Get(`${Q}/source`,this._loader.kj.images,C.source);return this._loader._createTextureAsync(D,k,M,(D=>{W(D)}),j._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!j._textureInfo.nonColorData)}))}}J(kj),o(kj,!0,(D=>new Mj(D)));const Oj="KHR_texture_transform";class Ej{constructor(D){this.name=Oj,this._loader=D,this.enabled=this._loader.isExtensionUsed(Oj)}dispose(){this._loader=null}loadTextureInfoAsync(D,j,W){return v.LoadExtensionAsync(D,j,this.name,((Q,C)=>this._loader.loadTextureInfoAsync(D,j,(D=>{if(!(D instanceof Y.e))throw new Error(`${Q}: Texture type not supported`);C.offset&&(D.uOffset=C.offset[0],D.vOffset=C.offset[1]),D.uRotationCenter=0,D.vRotationCenter=0,C.rotation&&(D.wAng=-C.rotation),C.scale&&(D.uScale=C.scale[0],D.vScale=C.scale[1]),void 0!=C.texCoord&&(D.coordinatesIndex=C.texCoord),W(D)}))))}}J(Oj),o(Oj,!0,(D=>new Ej(D)));const fj="KHR_xmp_json_ld";class Fj{constructor(D){this.name=fj,this.order=100,this._loader=D,this.enabled=this._loader.isExtensionUsed(fj)}dispose(){this._loader=null}onLoading(){var D,j,W;if(null===this._loader.rootBabylonMesh)return;const Q=null===(D=this._loader.kj.extensions)||void 0===D?void 0:D.KHR_xmp_json_ld,C=null===(j=this._loader.kj.asset)||void 0===j||null===(W=j.extensions)||void 0===W?void 0:W.KHR_xmp_json_ld;if(Q&&C){const D=+C.packet;Q.packets&&D<Q.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=Q.packets[D])}}}function Zj(D,j,W,Q){return k.d.Dd(j,W).scale(Q)}function Pj(D,j,W,Q){return j[W]*Q}function Xj(D,j,W,Q){return-j[W]*Q}function xj(D,j,W,Q){return j[W+1]*Q}function Rj(D,j,W,Q){return j[W]*Q*2}function Vj(D){return{scale:[new gj(P.c.ANIMATIONTYPE_FLOAT,`${D}.uScale`,Pj,(()=>2)),new gj(P.c.ANIMATIONTYPE_FLOAT,`${D}.vScale`,xj,(()=>2))],offset:[new gj(P.c.ANIMATIONTYPE_FLOAT,`${D}.uOffset`,Pj,(()=>2)),new gj(P.c.ANIMATIONTYPE_FLOAT,`${D}.vOffset`,xj,(()=>2))],rotation:[new gj(P.c.ANIMATIONTYPE_FLOAT,`${D}.wAng`,Xj,(()=>1))]}}J(fj),o(fj,!0,(D=>new Fj(D)));class Uj extends A{buildAnimations(D,j,W,Q,C){C(D._babylonCamera,this._buildAnimation(j,W,Q))}}class gj extends A{buildAnimations(D,j,W,Q,C){for(const k in D._data)C(D._data[k].babylonMaterial,this._buildAnimation(j,W,Q))}}class Nj extends A{buildAnimations(D,j,W,Q,C){C(D._babylonLight,this._buildAnimation(j,W,Q))}}const Gj={__array__:{__target__:!0,...n}},Kj={__array__:{__target__:!0,orthographic:{xmag:[new Uj(P.c.ANIMATIONTYPE_FLOAT,"orthoLeft",Xj,(()=>1)),new Uj(P.c.ANIMATIONTYPE_FLOAT,"orthoRight",xj,(()=>1))],ymag:[new Uj(P.c.ANIMATIONTYPE_FLOAT,"orthoBottom",Xj,(()=>1)),new Uj(P.c.ANIMATIONTYPE_FLOAT,"orthoTop",xj,(()=>1))],zfar:[new Uj(P.c.ANIMATIONTYPE_FLOAT,"maxZ",Pj,(()=>1))],znear:[new Uj(P.c.ANIMATIONTYPE_FLOAT,"qj",Pj,(()=>1))]},perspective:{yfov:[new Uj(P.c.ANIMATIONTYPE_FLOAT,"fov",Pj,(()=>1))],zfar:[new Uj(P.c.ANIMATIONTYPE_FLOAT,"maxZ",Pj,(()=>1))],znear:[new Uj(P.c.ANIMATIONTYPE_FLOAT,"qj",Pj,(()=>1))]}}},Lj={nodes:Gj,materials:{__array__:{__target__:!0,pbrMetallicRoughness:{baseColorFactor:[new gj(P.c.ANIMATIONTYPE_COLOR3,"albedoColor",Zj,(()=>4)),new gj(P.c.ANIMATIONTYPE_FLOAT,"alpha",(function(D,j,W,Q){return j[W+3]*Q}),(()=>4))],metallicFactor:[new gj(P.c.ANIMATIONTYPE_FLOAT,"metallic",Pj,(()=>1))],roughnessFactor:[new gj(P.c.ANIMATIONTYPE_FLOAT,"roughness",Pj,(()=>1))],baseColorTexture:{extensions:{KHR_texture_transform:Vj("albedoTexture")}},metallicRoughnessTexture:{extensions:{KHR_texture_transform:Vj("metallicTexture")}}},emissiveFactor:[new gj(P.c.ANIMATIONTYPE_COLOR3,"emissiveColor",Zj,(()=>3))],normalTexture:{scale:[new gj(P.c.ANIMATIONTYPE_FLOAT,"bumpTexture.level",Pj,(()=>1))],extensions:{KHR_texture_transform:Vj("bumpTexture")}},occlusionTexture:{strength:[new gj(P.c.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",Pj,(()=>1))],extensions:{KHR_texture_transform:Vj("ambientTexture")}},emissiveTexture:{extensions:{KHR_texture_transform:Vj("emissiveTexture")}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:[new gj(P.c.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",Pj,(()=>1))],anisotropyRotation:[new gj(P.c.ANIMATIONTYPE_FLOAT,"anisotropy.angle",Pj,(()=>1))],anisotropyTexture:{extensions:{KHR_texture_transform:Vj("anisotropy.texture")}}},KHR_materials_clearcoat:{clearcoatFactor:[new gj(P.c.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",Pj,(()=>1))],clearcoatRoughnessFactor:[new gj(P.c.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",Pj,(()=>1))],clearcoatTexture:{extensions:{KHR_texture_transform:Vj("clearCoat.texture")}},clearcoatNormalTexture:{scale:[new gj(P.c.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",Pj,(()=>1))],extensions:{KHR_texture_transform:Vj("clearCoat.bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:Vj("clearCoat.textureRoughness")}}},KHR_materials_dispersion:{dispersion:[new gj(P.c.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",Pj,(()=>1))]},KHR_materials_emissive_strength:{emissiveStrength:[new gj(P.c.ANIMATIONTYPE_FLOAT,"emissiveIntensity",Pj,(()=>1))]},KHR_materials_ior:{ior:[new gj(P.c.ANIMATIONTYPE_FLOAT,"indexOfRefraction",Pj,(()=>1))]},KHR_materials_iridescence:{iridescenceFactor:[new gj(P.c.ANIMATIONTYPE_FLOAT,"iridescence.intensity",Pj,(()=>1))],iridescenceIor:[new gj(P.c.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",Pj,(()=>1))],iridescenceThicknessMinimum:[new gj(P.c.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",Pj,(()=>1))],iridescenceThicknessMaximum:[new gj(P.c.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",Pj,(()=>1))],iridescenceTexture:{extensions:{KHR_texture_transform:Vj("iridescence.texture")}},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:Vj("iridescence.thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:[new gj(P.c.ANIMATIONTYPE_COLOR3,"sheen.color",Zj,(()=>3))],sheenRoughnessFactor:[new gj(P.c.ANIMATIONTYPE_FLOAT,"sheen.roughness",Pj,(()=>1))],sheenColorTexture:{extensions:{KHR_texture_transform:Vj("sheen.texture")}},sheenRoughnessTexture:{extensions:{KHR_texture_transform:Vj("sheen.textureRoughness")}}},KHR_materials_specular:{specularFactor:[new gj(P.c.ANIMATIONTYPE_FLOAT,"metallicF0Factor",Pj,(()=>1))],specularColorFactor:[new gj(P.c.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",Zj,(()=>3))],specularTexture:{extensions:{KHR_texture_transform:Vj("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:Vj("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:[new gj(P.c.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",Pj,(()=>1))],transmissionTexture:{extensions:{KHR_texture_transform:Vj("subSurface.refractionIntensityTexture")}}},KHR_materials_volume:{attenuationColor:[new gj(P.c.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",Zj,(()=>3))],attenuationDistance:[new gj(P.c.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",Pj,(()=>1))],thicknessFactor:[new gj(P.c.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",Pj,(()=>1))],thicknessTexture:{extensions:{KHR_texture_transform:Vj("subSurface.thicknessTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:[new gj(P.c.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",Pj,(()=>1))],diffuseTransmissionTexture:{extensions:{KHR_texture_transform:Vj("subSurface.translucencyIntensityTexture")}},diffuseTransmissionColorFactor:[new gj(P.c.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",Zj,(()=>3))],diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:Vj("subSurface.translucencyColorTexture")}}}}}},cameras:Kj,extensions:{KHR_lights_punctual:{lights:{__array__:{__target__:!0,color:[new Nj(P.c.ANIMATIONTYPE_COLOR3,"diffuse",Zj,(()=>3))],uj:[new Nj(P.c.ANIMATIONTYPE_FLOAT,"intensity",Pj,(()=>1))],range:[new Nj(P.c.ANIMATIONTYPE_FLOAT,"range",Pj,(()=>1))],spot:{innerConeAngle:[new Nj(P.c.ANIMATIONTYPE_FLOAT,"innerAngle",Rj,(()=>1))],outerConeAngle:[new Nj(P.c.ANIMATIONTYPE_FLOAT,"angle",Rj,(()=>1))]}}}}}};class ej{constructor(D,j){this._gltf=D,this._infoTree=j}convert(D){let j,W=this._gltf,Q=this._infoTree;if(!D.startsWith("/"))throw new Error("Path must start with a /");const C=D.split("/");C.shift();for(const k of C){if(Q.__array__)Q=Q.__array__;else if(Q=Q[k],!Q)throw new Error(`Path ${D} is invalid`);if(void 0===W)throw new Error(`Path ${D} is invalid`);W=W[k],Q.__target__&&(j=W)}return{object:j,info:Q}}}const sj="KHR_animation_pointer";class bj extends ej{constructor(D){super(D,Lj)}}class Yj{constructor(D){this.name=sj,this._loader=D,this._pathToObjectConverter=new bj(this._loader.kj)}get enabled(){return this._loader.isExtensionUsed(sj)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(D,j,W,Q,C){var k;const M=null===(k=Q.target.extensions)||void 0===k?void 0:k.KHR_animation_pointer;if(!M||!this._pathToObjectConverter)return null;"pointer"!==Q.target.path&&R.b.Warn(`${D}/target/path: Value (${Q.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=Q.target.node&&R.b.Warn(`${D}/target/node: Value (${Q.target.node}) must not be present when using the ${this.name} extension`);const O=`${D}/extensions/${this.name}`,E=M.pointer;if(!E)throw new Error(`${O}: Pointer is missing`);try{const k=this._pathToObjectConverter.convert(E);return this._loader._loadAnimationChannelFromTargetInfoAsync(D,j,W,Q,k,C)}catch(f){return R.b.Warn(`${O}/pointer: Invalid pointer (${E}) skipped`),null}}}J(sj),o(sj,!0,(D=>new Yj(D)));class tj{constructor(D,j,W){this.frame=D,this.action=j,this.onlyOnce=W,this.isDone=!1}_clone(){return new tj(this.frame,this.action,this.onlyOnce)}}var cj=W(1070),lj=W(1096);class Ij{get loop(){return this._loop}set loop(D){D!==this._loop&&(this._loop=D,this.updateOptions({loop:D}))}get currentTime(){var D;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(D=lj.e.audioEngine)&&void 0!==D&&D.audioContext&&(this.isPlaying||this.isPaused)){const D=this.isPaused?0:lj.e.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+D}return 0}get spatialSound(){return this._spatialSound}set spatialSound(D){if(D==this._spatialSound)return;const j=this.isPlaying;this.pause(),D?(this._spatialSound=D,this._updateSpatialParameters()):this._disableSpatialSound(),j&&this.play()}constructor(D,j,W){var Q;let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,O=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new F.d,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=C.j.Zero(),this._localDirection=new C.j(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=D,W=W||x.b.LastCreatedScene)if(this._scene=W,Ij._SceneComponentInitialization(W),this._readyToPlayCallback=k,this._customAttenuationFunction=(D,j,W,Q,C)=>j<W?D*(1-j/W):0,O&&(this.autoplay=O.autoplay||!1,this._loop=O.loop||!1,void 0!==O.volume&&(this._volume=O.volume),this._spatialSound=O.spatialSound??!1,this.maxDistance=O.maxDistance??100,this.useCustomAttenuation=O.useCustomAttenuation??!1,this.rolloffFactor=O.rolloffFactor||1,this.refDistance=O.refDistance||1,this.distanceModel=O.distanceModel||"linear",this._playbackRate=O.playbackRate||1,this._streaming=O.streaming??!1,this._length=O.length,this._offset=O.offset),null!==(Q=lj.e.audioEngine)&&void 0!==Q&&Q.canUseWebAudio&&lj.e.audioEngine.audioContext){this._soundGain=lj.e.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let D=!0;if(j)try{"string"===typeof j?(this._urlType="String",this._url=j):j instanceof ArrayBuffer?this._urlType="ArrayBuffer":j instanceof HTMLMediaElement?this._urlType="MediaElement":j instanceof MediaStream?this._urlType="MediaStream":j instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(j)&&(this._urlType="Array");let W=[],Q=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=lj.e.audioEngine.audioContext.createMediaElementSource(j),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=lj.e.audioEngine.audioContext.createMediaStreamSource(j),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":j.byteLength>0&&(Q=!0,this._soundLoaded(j));break;case"AudioBuffer":this._audioBufferLoaded(j);break;case"String":W.push(j);case"Array":0===W.length&&(W=j);for(let D=0;D<W.length;D++){const j=W[D];if(Q=O&&O.skipCodecCheck||-1!==j.indexOf(".mp3",j.length-4)&&lj.e.audioEngine.isMP3supported||-1!==j.indexOf(".ogg",j.length-4)&&lj.e.audioEngine.isOGGsupported||-1!==j.indexOf(".wav",j.length-4)||-1!==j.indexOf(".m4a",j.length-4)||-1!==j.indexOf(".mp4",j.length-4)||-1!==j.indexOf("blob:"),Q){this._streaming?(this._htmlAudioElement=new Audio(j),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,M.f.SetCorsBehavior(j,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(j,(D=>{this._soundLoaded(D)}),void 0,!0,!0,(D=>{D&&R.b.Error("XHR "+D.status+" error on: "+j+"."),R.b.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:D=!1}D?Q||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):R.b.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(E){R.b.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),lj.e.audioEngine&&!lj.e.audioEngine.WarnedWebAudioUnsupported&&(R.b.Error("Web Audio is not supported by your browser."),lj.e.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var D;null!==(D=lj.e.audioEngine)&&void 0!==D&&D.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(D){var j;null!==(j=lj.e.audioEngine)&&void 0!==j&&j.audioContext&&(this._audioBuffer=D,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(D){var j;null!==(j=lj.e.audioEngine)&&void 0!==j&&j.audioContext&&lj.e.audioEngine.audioContext.decodeAudioData(D,(D=>{this._audioBufferLoaded(D)}),(D=>{R.b.Error("Error while decoding audio data for: "+this.name+" / Error: "+D)}))}setAudioBuffer(D){var j;null!==(j=lj.e.audioEngine)&&void 0!==j&&j.canUseWebAudio&&(this._audioBuffer=D,this._isReadyToPlay=!0)}updateOptions(D){D&&(this.loop=D.loop??this.loop,this.maxDistance=D.maxDistance??this.maxDistance,this.useCustomAttenuation=D.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=D.rolloffFactor??this.rolloffFactor,this.refDistance=D.refDistance??this.refDistance,this.distanceModel=D.distanceModel??this.distanceModel,this._playbackRate=D.playbackRate??this._playbackRate,this._length=D.length??void 0,this.spatialSound=D.spatialSound??this._spatialSound,this._setOffset(D.offset??void 0),this.setVolume(D.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var D;null!==(D=lj.e.audioEngine)&&void 0!==D&&D.canUseWebAudio&&lj.e.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??lj.e.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var D;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(D=this._soundPanner)||void 0===D||D.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var D;null!==(D=lj.e.audioEngine)&&void 0!==D&&D.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(D){var j;null!==(j=lj.e.audioEngine)&&void 0!==j&&j.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(D),this._isOutputConnected=!0)}setDirectionalCone(D,j,W){j<D?R.b.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=D,this._coneOuterAngle=j,this._coneOuterGain=W,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(D){if(D!=this._coneInnerAngle){var j;if(this._coneOuterAngle<D)return void R.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=D,null!==(j=lj.e.audioEngine)&&void 0!==j&&j.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(D){if(D!=this._coneOuterAngle){var j;if(D<this._coneInnerAngle)return void R.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=D,null!==(j=lj.e.audioEngine)&&void 0!==j&&j.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(D){var j;D.equals(this._position)||(this._position.p(D),null!==(j=lj.e.audioEngine)&&void 0!==j&&j.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(D){var j;this._localDirection=D,null!==(j=lj.e.audioEngine)&&void 0!==j&&j.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const D=this._connectedTransformNode.getWorldMatrix(),j=C.j.TransformNormal(this._localDirection,D);j.normalize(),this._soundPanner.orientationX.value=j.x,this._soundPanner.orientationY.value=j.y,this._soundPanner.orientationZ.value=j.z}updateDistanceFromListener(){var D;if(null!==(D=lj.e.audioEngine)&&void 0!==D&&D.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const D=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.Qc(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,D,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(D){this._customAttenuationFunction=D}play(D,j,W){var Q;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(Q=lj.e.audioEngine)&&void 0!==Q&&Q.audioContext)try{var C,k;this._clearTimeoutsAndObservers();let Q=D?(null===(C=lj.e.audioEngine)||void 0===C?void 0:C.audioContext.currentTime)+D:null===(k=lj.e.audioEngine)||void 0===k?void 0:k.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=lj.e.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const D=()=>{var W;if(null!==(W=lj.e.audioEngine)&&void 0!==W&&W.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=j??0;const W=this._htmlAudioElement.play();void 0!==W&&W.catch((()=>{var j,W;(null===(j=lj.e.audioEngine)||void 0===j||j.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(W=lj.e.audioEngine)||void 0===W?void 0:W.onAudioUnlockedObservable.addOnce((()=>{D()})))}))}else{var Q;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(Q=lj.e.audioEngine)||void 0===Q?void 0:Q.onAudioUnlockedObservable.addOnce((()=>{D()}))}};D()}}else{var M;const C=()=>{var C;if(null!==(C=lj.e.audioEngine)&&void 0!==C&&C.audioContext){var k;if(W=W||this._length,void 0!==j&&this._setOffset(j),this._soundSource){const D=this._soundSource;D.onended=()=>{D.disconnect()}}if(this._soundSource=null===(k=lj.e.audioEngine)||void 0===k?void 0:k.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var M;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==j&&(this._soundSource.loopStart=j),void 0!==W&&(this._soundSource.loopEnd=(0|j)+W),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},Q=D?(null===(M=lj.e.audioEngine)||void 0===M?void 0:M.audioContext.currentTime)+D:lj.e.audioEngine.audioContext.currentTime;const C=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(Q,C,this.loop?void 0:W)}}};"suspended"===(null===(M=lj.e.audioEngine)||void 0===M?void 0:M.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var D;"suspended"===(null===(D=lj.e.audioEngine)||void 0===D?void 0:D.audioContext.state)?(lj.e.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=lj.e.audioEngine.onAudioUnlockedObservable.addOnce((()=>{C()})))):C()}),500):C()}this._startTime=Q,this.isPlaying=!0,this.isPaused=!1}catch(O){R.b.Error("Error while trying to play audio: "+this.name+", "+O.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(D){var j;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var W;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(W=this._streamingSource)||void 0===W||W.disconnect();this.isPlaying=!1}else if(null!==(j=lj.e.audioEngine)&&void 0!==j&&j.audioContext&&this._soundSource){const j=D?lj.e.audioEngine.audioContext.currentTime+D:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(j)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var D;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var j;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(j=this._streamingSource)||void 0===j||j.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(D=lj.e.audioEngine)&&void 0!==D&&D.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=lj.e.audioEngine.audioContext.currentTime-this._startTime)}setVolume(D,j){var W;null!==(W=lj.e.audioEngine)&&void 0!==W&&W.canUseWebAudio&&this._soundGain&&(j&&lj.e.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(lj.e.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,lj.e.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(D,lj.e.audioEngine.audioContext.currentTime+j)):this._soundGain.gain.value=D),this._volume=D}setPlaybackRate(D){this._playbackRate=D,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(D){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=D,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=D=>this._onRegisterAfterWorldMatrixUpdate(D),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(D){var j;if(D.getBoundingInfo){const j=D.getBoundingInfo();this.setPosition(j.boundingSphere.centerWorld)}else this.setPosition(D.absolutePosition);null!==(j=lj.e.audioEngine)&&void 0!==j&&j.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const D=()=>{this._isReadyToPlay?(W._audioBuffer=this.getAudioBuffer(),W._isReadyToPlay=!0,W.autoplay&&W.play(0,this._offset,this._length)):setTimeout(D,300)},j={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},W=new Ij(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,j);return this.useCustomAttenuation&&W.setAttenuationFunction(this._customAttenuationFunction),W.setPosition(this._position),W.setPlaybackRate(this._playbackRate),D(),W}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const D={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(D.connectedMeshId=this._connectedTransformNode.id),D.position=this._position.Gd(),D.refDistance=this.refDistance,D.distanceModel=this.distanceModel,D.isDirectional=this._isDirectional,D.localDirectionToMesh=this._localDirection.Gd(),D.coneInnerAngle=this._coneInnerAngle,D.coneOuterAngle=this._coneOuterAngle,D.coneOuterGain=this._coneOuterGain),D}static Parse(D,j,W,Q){const k=D.name;let M;M=D.url?W+D.url:W+k;const O={autoplay:D.autoplay,loop:D.loop,volume:D.volume,spatialSound:D.spatialSound,maxDistance:D.maxDistance,rolloffFactor:D.rolloffFactor,refDistance:D.refDistance,distanceModel:D.distanceModel,playbackRate:D.playbackRate};let E;if(Q){const D=()=>{Q._isReadyToPlay?(E._audioBuffer=Q.getAudioBuffer(),E._isReadyToPlay=!0,E.autoplay&&E.play(0,E._offset,E._length)):setTimeout(D,300)};E=new Ij(k,new ArrayBuffer(0),j,null,O),D()}else E=new Ij(k,M,j,(()=>{j.removePendingData(E)}),O),j.addPendingData(E);if(D.position){const j=C.j.Dd(D.position);E.setPosition(j)}if(D.isDirectional&&(E.setDirectionalCone(D.coneInnerAngle||360,D.coneOuterAngle||360,D.coneOuterGain||0),D.localDirectionToMesh)){const j=C.j.Dd(D.localDirectionToMesh);E.setLocalDirectionToMesh(j)}if(D.connectedMeshId){const W=j.getMeshById(D.connectedMeshId);W&&E.attachToMesh(W)}return D.metadata&&(E.metadata=D.metadata),E}_setOffset(D){this._offset!==D&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=D)}_clearTimeoutsAndObservers(){var D;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(D=lj.e.audioEngine)||void 0===D||D.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}Ij._SceneComponentInitialization=D=>{throw(0,cj.d)("AudioSceneComponent")},(0,e.c)("BABYLON.Sound",Ij);class yj{constructor(D,j,W){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],j.length!==W.length)throw new Error("Sounds length does not equal weights length");this.loop=D,this._weights=W;let Q=0;for(const k of W)Q+=k;const C=Q>0?1/Q:0;for(let k=0;k<this._weights.length;k++)this._weights[k]*=C;this._sounds=j;for(const k of this._sounds)k.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(D){if(D!==this._coneInnerAngle){if(this._coneOuterAngle<D)return void R.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=D;for(const j of this._sounds)j.directionalConeInnerAngle=D}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(D){if(D!==this._coneOuterAngle){if(D<this._coneInnerAngle)return void R.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=D;for(const j of this._sounds)j.directionalConeOuterAngle=D}}get volume(){return this._volume}set volume(D){if(D!==this._volume)for(const j of this._sounds)j.setVolume(D)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(D){if(!this.isPaused){this.stop();const D=Math.random();let j=0;for(let W=0;W<this._weights.length;W++)if(j+=this._weights[W],D<=j){this._currentIndex=W;break}}const j=this._sounds[this._currentIndex??0];j.isReady()?j.play(0,this.isPaused?void 0:D):j.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class mj{constructor(D){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(D=D||x.b.LastCreatedScene)&&(this._scene=D,this.soundCollection=[],this._options=j,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var D;null!==(D=lj.e.audioEngine)&&void 0!==D&&D.canUseWebAudio&&lj.e.audioEngine.audioContext&&(this._outputAudioNode=lj.e.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(lj.e.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(lj.e.audioEngine&&lj.e.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(D){var j;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(j=lj.e.audioEngine)&&void 0!==j&&j.canUseWebAudio&&this._outputAudioNode&&D.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==D.soundTrackId&&(-1===D.soundTrackId?this._scene.mainSoundTrack.removeSound(D):this._scene.soundTracks&&this._scene.soundTracks[D.soundTrackId].removeSound(D)),this.soundCollection.push(D),D.soundTrackId=this.id}removeSound(D){const j=this.soundCollection.indexOf(D);-1!==j&&this.soundCollection.splice(j,1)}setVolume(D){var j;null!==(j=lj.e.audioEngine)&&void 0!==j&&j.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=D)}switchPanningModelToHRTF(){var D;if(null!==(D=lj.e.audioEngine)&&void 0!==D&&D.canUseWebAudio)for(let j=0;j<this.soundCollection.length;j++)this.soundCollection[j].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var D;if(null!==(D=lj.e.audioEngine)&&void 0!==D&&D.canUseWebAudio)for(let j=0;j<this.soundCollection.length;j++)this.soundCollection[j].switchPanningModelToEqualPower()}connectToAnalyser(D){var j;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=D,null!==(j=lj.e.audioEngine)&&void 0!==j&&j.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,lj.e.audioEngine.masterGain))}}var aj=W(1281),Sj=W(1199),Hj=(W(1568),W(1122));(0,W(12167).g)(aj.d.NAME_AUDIO,((D,j,W,Q)=>{let C,k=[];if(W.ve=W.ve||[],void 0!==D.ve&&null!==D.ve)for(let O=0,E=D.ve.length;O<E;O++){var M;const E=D.ve[O];null!==(M=lj.e.audioEngine)&&void 0!==M&&M.canUseWebAudio?(E.url||(E.url=E.name),k[E.url]?W.ve.push(Ij.Parse(E,j,Q,k[E.url])):(C=Ij.Parse(E,j,Q),k[E.url]=C,W.ve.push(C))):W.ve.push(new Ij(E.name,null,j))}k=[]})),Object.defineProperty(Sj.b.prototype,"mainSoundTrack",{get:function(){let D=this._getComponent(aj.d.NAME_AUDIO);return D||(D=new zj(this),this.re(D)),this._mainSoundTrack||(this._mainSoundTrack=new mj(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),Sj.b.prototype.getSoundByName=function(D){let j;for(j=0;j<this.mainSoundTrack.soundCollection.length;j++)if(this.mainSoundTrack.soundCollection[j].name===D)return this.mainSoundTrack.soundCollection[j];if(this.soundTracks)for(let W=0;W<this.soundTracks.length;W++)for(j=0;j<this.soundTracks[W].soundCollection.length;j++)if(this.soundTracks[W].soundCollection[j].name===D)return this.soundTracks[W].soundCollection[j];return null},Object.defineProperty(Sj.b.prototype,"audioEnabled",{get:function(){let D=this._getComponent(aj.d.NAME_AUDIO);return D||(D=new zj(this),this.re(D)),D.audioEnabled},set:function(D){let j=this._getComponent(aj.d.NAME_AUDIO);j||(j=new zj(this),this.re(j)),D?j.enableAudio():j.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(Sj.b.prototype,"headphone",{get:function(){let D=this._getComponent(aj.d.NAME_AUDIO);return D||(D=new zj(this),this.re(D)),D.headphone},set:function(D){let j=this._getComponent(aj.d.NAME_AUDIO);j||(j=new zj(this),this.re(j)),D?j.switchAudioModeForHeadphones():j.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(Sj.b.prototype,"audioListenerPositionProvider",{get:function(){let D=this._getComponent(aj.d.NAME_AUDIO);return D||(D=new zj(this),this.re(D)),D.audioListenerPositionProvider},set:function(D){let j=this._getComponent(aj.d.NAME_AUDIO);if(j||(j=new zj(this),this.re(j)),D&&"function"!==typeof D)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");j.audioListenerPositionProvider=D},enumerable:!0,configurable:!0}),Object.defineProperty(Sj.b.prototype,"audioListenerRotationProvider",{get:function(){let D=this._getComponent(aj.d.NAME_AUDIO);return D||(D=new zj(this),this.re(D)),D.audioListenerRotationProvider},set:function(D){let j=this._getComponent(aj.d.NAME_AUDIO);if(j||(j=new zj(this),this.re(j)),D&&"function"!==typeof D)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");j.audioListenerRotationProvider=D},enumerable:!0,configurable:!0}),Object.defineProperty(Sj.b.prototype,"audioPositioningRefreshRate",{get:function(){let D=this._getComponent(aj.d.NAME_AUDIO);return D||(D=new zj(this),this.re(D)),D.audioPositioningRefreshRate},set:function(D){let j=this._getComponent(aj.d.NAME_AUDIO);j||(j=new zj(this),this.re(j)),j.audioPositioningRefreshRate=D},enumerable:!0,configurable:!0});class zj{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(D){this.name=aj.d.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new C.j,this._cachedCameraPosition=new C.j,this._lastCheck=0,this._invertMatrixTemp=new C.b,this._cameraDirectionTemp=new C.j,(D=D||x.b.LastCreatedScene)&&(this.Be=D,D.soundTracks=[],D.ve=[])}register(){this.Be._afterRenderStage.registerStep(aj.d.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(D){if(D.ve=[],this.Be.soundTracks)for(let j=0;j<this.Be.soundTracks.length;j++){const W=this.Be.soundTracks[j];for(let j=0;j<W.soundCollection.length;j++)D.ve.push(W.soundCollection[j].serialize())}}addFromContainer(D){D.ve&&D.ve.forEach((D=>{D.play(),D.autoplay=!0,this.Be.mainSoundTrack.addSound(D)}))}removeFromContainer(D){let j=arguments.length>1&&void 0!==arguments[1]&&arguments[1];D.ve&&D.ve.forEach((D=>{D.stop(),D.autoplay=!1,this.Be.mainSoundTrack.removeSound(D),j&&D.dispose()}))}dispose(){const D=this.Be;if(D._mainSoundTrack&&D.mainSoundTrack.dispose(),D.soundTracks)for(let j=0;j<D.soundTracks.length;j++)D.soundTracks[j].dispose()}disableAudio(){const D=this.Be;let j;for(this._audioEnabled=!1,lj.e.audioEngine&&lj.e.audioEngine.audioContext&&lj.e.audioEngine.audioContext.suspend(),j=0;j<D.mainSoundTrack.soundCollection.length;j++)D.mainSoundTrack.soundCollection[j].pause();if(D.soundTracks)for(j=0;j<D.soundTracks.length;j++)for(let W=0;W<D.soundTracks[j].soundCollection.length;W++)D.soundTracks[j].soundCollection[W].pause()}enableAudio(){const D=this.Be;let j;for(this._audioEnabled=!0,lj.e.audioEngine&&lj.e.audioEngine.audioContext&&lj.e.audioEngine.audioContext.resume(),j=0;j<D.mainSoundTrack.soundCollection.length;j++)D.mainSoundTrack.soundCollection[j].isPaused&&D.mainSoundTrack.soundCollection[j].play();if(D.soundTracks)for(j=0;j<D.soundTracks.length;j++)for(let W=0;W<D.soundTracks[j].soundCollection.length;W++)D.soundTracks[j].soundCollection[W].isPaused&&D.soundTracks[j].soundCollection[W].play()}switchAudioModeForHeadphones(){const D=this.Be;if(this._headphone=!0,D.mainSoundTrack.switchPanningModelToHRTF(),D.soundTracks)for(let j=0;j<D.soundTracks.length;j++)D.soundTracks[j].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const D=this.Be;if(this._headphone=!1,D.mainSoundTrack.switchPanningModelToEqualPower(),D.soundTracks)for(let j=0;j<D.soundTracks.length;j++)D.soundTracks[j].switchPanningModelToEqualPower()}_afterRender(){const D=Hj.b.Now;if(this._lastCheck&&D-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=D;const j=this.Be;if(!this._audioEnabled||!j._mainSoundTrack||!j.soundTracks||0===j._mainSoundTrack.soundCollection.length&&1===j.soundTracks.length)return;const W=lj.e.audioEngine;if(W&&W.audioContext){let D,Q=j.activeCamera;if(j.activeCameras&&j.activeCameras.length>0&&(Q=j.activeCameras[0]),this.audioListenerPositionProvider){const D=this.audioListenerPositionProvider();W.audioContext.listener.setPosition(D.x||0,D.y||0,D.z||0)}else Q?this._cachedCameraPosition.equals(Q.globalPosition)||(this._cachedCameraPosition.p(Q.globalPosition),W.audioContext.listener.setPosition(Q.globalPosition.x,Q.globalPosition.y,Q.globalPosition.z)):W.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const D=this.audioListenerRotationProvider();W.audioContext.listener.setOrientation(D.x||0,D.y||0,D.z||0,0,1,0)}else Q?(Q.rigCameras&&Q.rigCameras.length>0&&(Q=Q.rigCameras[0]),Q.getViewMatrix().invertToRef(this._invertMatrixTemp),C.j.TransformNormalToRef(zj._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.p(this._cameraDirectionTemp),W.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):W.audioContext.listener.setOrientation(0,0,0,0,1,0);for(D=0;D<j.mainSoundTrack.soundCollection.length;D++){const W=j.mainSoundTrack.soundCollection[D];W.useCustomAttenuation&&W.updateDistanceFromListener()}if(j.soundTracks)for(D=0;D<j.soundTracks.length;D++)for(let W=0;W<j.soundTracks[D].soundCollection.length;W++){const Q=j.soundTracks[D].soundCollection[W];Q.useCustomAttenuation&&Q.updateDistanceFromListener()}}}}zj._CameraDirection=new C.j(0,0,-1),Ij._SceneComponentInitialization=D=>{let j=D._getComponent(aj.d.NAME_AUDIO);j||(j=new zj(D),D.re(j))};const ij="MSFT_audio_emitter";class pj{constructor(D){this.name=ij,this._loader=D,this.enabled=this._loader.isExtensionUsed(ij)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const D=this._loader.kj.extensions;if(D&&D[this.name]){const j=D[this.name];this._clips=j.clips,this._emitters=j.emitters,d.Assign(this._clips),d.Assign(this._emitters)}}loadSceneAsync(D,j){return v.LoadExtensionAsync(D,j,this.name,((W,Q)=>{const C=new Array;C.push(this._loader.loadSceneAsync(D,j));for(const D of Q.emitters){const j=d.Get(`${W}/emitters`,this._emitters,D);if(void 0!=j.refDistance||void 0!=j.maxDistance||void 0!=j.rolloffFactor||void 0!=j.distanceModel||void 0!=j.innerAngle||void 0!=j.outerAngle)throw new Error(`${W}: Direction or Distance properties are not allowed on emitters attached to a scene`);C.push(this._loadEmitterAsync(`${W}/emitters/${j.index}`,j))}return Promise.all(C).then((()=>{}))}))}loadNodeAsync(D,j,W){return v.LoadExtensionAsync(D,j,this.name,((D,Q)=>{const k=new Array;return this._loader.loadNodeAsync(D,j,(j=>{for(const W of Q.emitters){const Q=d.Get(`${D}/emitters`,this._emitters,W);k.push(this._loadEmitterAsync(`${D}/emitters/${Q.index}`,Q).then((()=>{for(const D of Q._babylonSounds)D.attachToMesh(j),void 0==Q.innerAngle&&void 0==Q.outerAngle||(D.setLocalDirectionToMesh(C.j.Forward()),D.setDirectionalCone(2*M.f.ToDegrees(void 0==Q.innerAngle?Math.PI:Q.innerAngle),2*M.f.ToDegrees(void 0==Q.outerAngle?Math.PI:Q.outerAngle),0))})))}W(j)})).then((D=>Promise.all(k).then((()=>D))))}))}loadAnimationAsync(D,j){return v.LoadExtensionAsync(D,j,this.name,((W,Q)=>this._loader.loadAnimationAsync(D,j).then((C=>{const k=new Array;d.Assign(Q.events);for(const M of Q.events)k.push(this._loadAnimationEventAsync(`${W}/events/${M.index}`,D,j,M,C));return Promise.all(k).then((()=>C))}))))}_loadClipAsync(D,j){if(j._objectURL)return j._objectURL;let W;if(j.uri)W=this._loader.loadUriAsync(D,j,j.uri);else{const Q=d.Get(`${D}/bufferView`,this._loader.kj.bufferViews,j.bufferView);W=this._loader.loadBufferViewAsync(`/bufferViews/${Q.index}`,Q)}return j._objectURL=W.then((D=>URL.createObjectURL(new Blob([D],{type:j.mimeType})))),j._objectURL}_loadEmitterAsync(D,j){if(j._babylonSounds=j._babylonSounds||[],!j._babylonData){const D=new Array,W=j.name||`emitter${j.index}`,Q={loop:!1,autoplay:!1,volume:void 0==j.volume?1:j.volume};for(let k=0;k<j.clips.length;k++){const C=`/extensions/${this.name}/clips`,M=d.Get(C,this._clips,j.clips[k].clip);D.push(this._loadClipAsync(`${C}/${j.clips[k].clip}`,M).then((D=>{const C=j._babylonSounds[k]=new Ij(W,D,this._loader.babylonScene,null,Q);C.refDistance=j.refDistance||1,C.maxDistance=j.maxDistance||256,C.rolloffFactor=j.rolloffFactor||1,C.distanceModel=j.distanceModel||"exponential"})))}const C=Promise.all(D).then((()=>{const D=j.clips.map((D=>D.weight||1)),W=new yj(j.loop||!1,j._babylonSounds,D);j.innerAngle&&(W.directionalConeInnerAngle=2*M.f.ToDegrees(j.innerAngle)),j.outerAngle&&(W.directionalConeOuterAngle=2*M.f.ToDegrees(j.outerAngle)),j.volume&&(W.volume=j.volume),j._babylonData.sound=W}));j._babylonData={loaded:C}}return j._babylonData.loaded}_getEventAction(D,j,W,Q,C){switch(W){case"play":return D=>{const W=(C||0)+(D-Q);j.play(W)};case"stop":return()=>{j.stop()};case"pause":return()=>{j.pause()};default:throw new Error(`${D}: Unsupported action ${W}`)}}_loadAnimationEventAsync(D,j,W,Q,C){if(0==C.targetedAnimations.length)return Promise.resolve();const k=C.targetedAnimations[0],M=Q.k,O=d.Get(`/extensions/${this.name}/emitters`,this._emitters,M);return this._loadEmitterAsync(D,O).then((()=>{const j=O._babylonData.sound;if(j){const W=new tj(Q.time,this._getEventAction(D,j,Q.action,Q.time,Q.startOffset));k.animation.addEvent(W),C.onAnimationGroupEndObservable.add((()=>{j.stop()})),C.onAnimationGroupPauseObservable.add((()=>{j.pause()}))}}))}}J(ij),o(ij,!0,(D=>new pj(D)));const Tj="MSFT_lod";class Aj{constructor(D){var j;this.name=Tj,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new F.d,this.onMaterialLODsLoadedObservable=new F.d,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=D,this.maxLODsToLoad=(null===(j=this._loader.parent.extensionOptions[Tj])||void 0===j?void 0:j.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(Tj)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let D=0;D<this._nodePromiseLODs.length;D++){const j=Promise.all(this._nodePromiseLODs[D]).then((()=>{0!==D&&(this._loader.endPerformanceCounter(`Node LOD ${D}`),this._loader.log(`Loaded node LOD ${D}`)),this.onNodeLODsLoadedObservable.notifyObservers(D),D!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${D+1}`),this._loadBufferLOD(this._nodeBufferLODs,D+1),this._nodeSignalLODs[D]&&this._nodeSignalLODs[D].resolve())}));this._loader._completePromises.push(j)}for(let D=0;D<this._materialPromiseLODs.length;D++){const j=Promise.all(this._materialPromiseLODs[D]).then((()=>{0!==D&&(this._loader.endPerformanceCounter(`Material LOD ${D}`),this._loader.log(`Loaded material LOD ${D}`)),this.onMaterialLODsLoadedObservable.notifyObservers(D),D!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${D+1}`),this._loadBufferLOD(this._materialBufferLODs,D+1),this._materialSignalLODs[D]&&this._materialSignalLODs[D].resolve())}));this._loader._completePromises.push(j)}}loadSceneAsync(D,j){const W=this._loader.loadSceneAsync(D,j);return this._loadBufferLOD(this._bufferLODs,0),W}loadNodeAsync(D,j,W){return v.LoadExtensionAsync(D,j,this.name,((D,C)=>{let k;const M=this._getLODs(D,j,this._loader.kj.nodes,C.ids);this._loader.logOpen(`${D}`);for(let j=0;j<M.length;j++){const D=M[j];0!==j&&(this._nodeIndexLOD=j,this._nodeSignalLODs[j]=this._nodeSignalLODs[j]||new Q);const C=D=>{W(D),D.Kg(!1)},O=this._loader.loadNodeAsync(`/nodes/${D.index}`,D,C).then((D=>{if(0!==j){const D=M[j-1];D._babylonTransformNode&&(this._disposeTransformNode(D._babylonTransformNode),delete D._babylonTransformNode)}return D.Kg(!0),D}));this._nodePromiseLODs[j]=this._nodePromiseLODs[j]||[],0===j?k=O:(this._nodeIndexLOD=null,this._nodePromiseLODs[j].push(O))}return this._loader.logClose(),k}))}_loadMaterialAsync(D,j,W,Q,C){return this._nodeIndexLOD?null:v.LoadExtensionAsync(D,j,this.name,((D,k)=>{let M;const O=this._getLODs(D,j,this._loader.kj.materials,k.ids);this._loader.logOpen(`${D}`);for(let j=0;j<O.length;j++){const D=O[j];0!==j&&(this._materialIndexLOD=j);const k=this._loader._loadMaterialAsync(`/materials/${D.index}`,D,W,Q,(D=>{0===j&&C(D)})).then((D=>{if(0!==j){C(D);const W=O[j-1]._data;W[Q]&&(this._disposeMaterials([W[Q].babylonMaterial]),delete W[Q])}return D}));this._materialPromiseLODs[j]=this._materialPromiseLODs[j]||[],0===j?M=k:(this._materialIndexLOD=null,this._materialPromiseLODs[j].push(k))}return this._loader.logClose(),M}))}_loadUriAsync(D,j,W){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const C=this._nodeIndexLOD-1;return this._nodeSignalLODs[C]=this._nodeSignalLODs[C]||new Q,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((()=>this._loader.loadUriAsync(D,j,W)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const C=this._materialIndexLOD-1;return this._materialSignalLODs[C]=this._materialSignalLODs[C]||new Q,this._materialSignalLODs[C].promise.then((()=>this._loader.loadUriAsync(D,j,W)))}return null}loadBufferAsync(D,j,W,C){if(this._loader.parent.useRangeRequests&&!j.uri){if(!this._loader.bin)throw new Error(`${D}: Uri is missing or the binary glTF is missing its binary chunk`);const j=(D,j)=>{const k=W,M=k+C-1;let O=D[j];return O?(O.start=Math.min(O.start,k),O.end=Math.max(O.end,M)):(O={start:k,end:M,loaded:new Q},D[j]=O),O.loaded.promise.then((D=>new Uint8Array(D.buffer,D.byteOffset+W-O.start,C)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?j(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?j(this._materialBufferLODs,this._materialIndexLOD):j(this._bufferLODs,0)}return null}_loadBufferLOD(D,j){const W=D[j];W&&(this._loader.log(`Loading buffer range [${W.start}-${W.end}]`),this._loader.bin.readAsync(W.start,W.end-W.start+1).then((D=>{W.loaded.resolve(D)}),(D=>{W.loaded.reject(D)})))}_getLODs(D,j,W,Q){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const C=[];for(let k=Q.length-1;k>=0;k--)if(C.push(d.Get(`${D}/ids/${Q[k]}`,W,Q[k])),C.length===this.maxLODsToLoad)return C;return C.push(j),C}_disposeTransformNode(D){const j=[],W=D.material;W&&j.push(W);for(const C of D.getChildMeshes())C.material&&j.push(C.material);D.dispose();const Q=j.filter((D=>this._loader.babylonScene.meshes.every((j=>j.material!=D))));this._disposeMaterials(Q)}_disposeMaterials(D){const j={};for(const W of D){for(const D of W.getActiveTextures())j[D.uniqueId]=D;W.dispose()}for(const W in j)for(const D of this._loader.babylonScene.materials)D.hasTexture(j[W])&&delete j[W];for(const W in j)j[W].dispose()}}J(Tj),o(Tj,!0,(D=>new Aj(D)));const wj="MSFT_minecraftMesh";class nj{constructor(D){this.name=wj,this._loader=D,this.enabled=this._loader.isExtensionUsed(wj)}dispose(){this._loader=null}loadMaterialPropertiesAsync(D,j,W){return v.LoadExtraAsync(D,j,this.name,((Q,C)=>{if(C){if(!(W instanceof b))throw new Error(`${Q}: Material type not supported`);const C=this._loader.loadMaterialPropertiesAsync(D,j,W);return W.needAlphaBlending()&&(W.forceDepthWrite=!0,W.separateCullingPass=!0),W.Se=W.forceDepthWrite,W.twoSidedLighting=!0,C}return null}))}}J(wj),o(wj,!0,(D=>new nj(D)));const uj="MSFT_sRGBFactors";class qj{constructor(D){this.name=uj,this._loader=D,this.enabled=this._loader.isExtensionUsed(uj)}dispose(){this._loader=null}loadMaterialPropertiesAsync(D,j,W){return v.LoadExtraAsync(D,j,this.name,((Q,C)=>{if(C){if(!(W instanceof b))throw new Error(`${Q}: Material type not supported`);const C=this._loader.loadMaterialPropertiesAsync(D,j,W),k=W.va().getEngine().useExactSrgbConversions;return W.albedoTexture||W.albedoColor.toLinearSpaceToRef(W.albedoColor,k),W.reflectivityTexture||W.reflectivityColor.toLinearSpaceToRef(W.reflectivityColor,k),C}return null}))}}J(uj),o(uj,!0,(D=>new qj(D)));var oj,Jj=W(1013);!function(D){D[D.Input=0]="Input",D[D.Output=1]="Output"}(oj||(oj={}));class hj{constructor(D,j,W){this._ownerBlock=W,this._connectedPoint=[],this.uniqueId=(0,Jj.c)(),this.connectedPointIds=[],this.name=D,this._connectionType=j}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(D){if(this._connectionType===D._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||D._isSingularConnection()&&D._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(D),D._connectedPoint.push(this)}serialize(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};D.uniqueId=this.uniqueId,D.name=this.name,D._connectionType=this._connectionType,D.connectedPointIds=[],D.className=this.getClassName();for(const j of this._connectedPoint)D.connectedPointIds.push(j.uniqueId)}getClassName(){return"FGConnection"}deserialize(D){this.uniqueId=D.uniqueId,this.name=D.name,this._connectionType=D._connectionType,this.connectedPointIds=D.connectedPointIds}static Parse(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},j=arguments.length>1?arguments[1]:void 0;const W=new(M.f.Instantiate(D.className))(D.name,D._connectionType,j);return W.deserialize(D),W}}class dj{constructor(D){this.value=this._toInt(D)}_toInt(D){return 0|D}add(D){return new dj(this.value+D.value)}Qc(D){return new dj(this.value-D.value)}multiply(D){return new dj(Math.imul(this.value,D.value))}divide(D){return new dj(this.value/D.value)}getClassName(){return dj.ClassName}equals(D){return this.value===D.value}static Parse(D){return new dj(D.value)}}dj.ClassName="FlowGraphInteger",(0,e.c)("FlowGraphInteger",dj);class vj{constructor(D,j){this.typeName=D,this.defaultValue=j}serialize(D){D.typeName=this.typeName,D.defaultValue=this.defaultValue}static Parse(D){return new vj(D.typeName,D.defaultValue)}}const Bj=new vj("any",void 0),rj=(new vj("string",""),new vj("number",0)),DW=new vj("boolean",!1),jW=new vj("Vector2",C.f.Zero()),WW=new vj("Kd",C.j.Zero()),QW=(new vj("Vector4",C.m.Zero()),new vj("Matrix",C.b.Identity())),CW=(new vj("Wd",k.d.Black()),new vj("Xd",new k.h(0,0,0,0)),new vj("Quaternion",C.d.Identity()),new vj("FlowGraphInteger",new dj(0)));class kW extends hj{constructor(D,j,W,Q){super(D,j,W),this.richType=Q}_isSingularConnection(){return 0===this.connectionType}setValue(D,j){j._setConnectionValue(this,D)}connectTo(D){super.connectTo(D)}_getValueOrDefault(D){return D._hasConnectionValue(this)?D._getConnectionValue(this):this.richType.defaultValue}getValue(D){return 1===this.connectionType?(D._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(D),this._getValueOrDefault(D)):this.isConnected()?this._connectedPoint[0].getValue(D):this._getValueOrDefault(D)}getClassName(){return"FGDataConnection"}serialize(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(D),D.richType={},this.richType.serialize(D.richType)}static Parse(D,j){const W=hj.Parse(D,j);return W.richType=vj.Parse(D.richType),W}}function MW(D){return"Mesh"===D||"AbstractMesh"===D||"GroundMesh"===D||"InstanceMesh"===D||"LinesMesh"===D||"GoldbergMesh"===D||"GreasedLineMesh"===D||"TrailMesh"===D}function OW(D){return"Vector2"===D||"Kd"===D||"Vector4"===D||"Quaternion"===D||"Wd"===D||"Xd"===D}function EW(D,j,W){var Q;const C=(null===j||void 0===j||null===(Q=j.getClassName)||void 0===Q?void 0:Q.call(j))??"";MW(C)?W[D]={name:j.name,className:C}:OW(C)?W[D]={value:j.Gd(),className:C}:W[D]=j}function fW(D,j,W){const Q=j[D];let M;const O=null===Q||void 0===Q?void 0:Q.className;return M=MW(O)?W.getMeshByName(Q.name):OW(O)?function(D,j){if("Vector2"===D)return C.f.Dd(j);if("Kd"===D)return C.j.Dd(j);if("Vector4"===D)return C.m.Dd(j);if("Quaternion"===D)return C.d.Dd(j);if("Wd"===D)return new k.d(j[0],j[1],j[2]);if("Xd"===D)return new k.h(j[0],j[1],j[2],j[3]);throw new Error(`Unknown vector class name ${D}`)}(O,Q.value):"Matrix"===O?C.b.Dd(Q.value):O===dj.ClassName?dj.Parse(Q):Q&&void 0!==Q.value?Q.value:Q,M}(0,e.c)("FGDataConnection",kW);class FW{constructor(D){var j;this.config=D,this.uniqueId=(0,Jj.c)(),this.name=(null===(j=this.config)||void 0===j?void 0:j.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(D){}registerDataInput(D,j){const W=new kW(D,0,this,j);return this.dataInputs.push(W),W}registerDataOutput(D,j){const W=new kW(D,1,this,j);return this.dataOutputs.push(W),W}getDataInput(D){return this.dataInputs.find((j=>j.name===D))}getDataOutput(D){return this.dataOutputs.find((j=>j.name===D))}serialize(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};D.uniqueId=this.uniqueId,D.config={},this.config&&(D.config.name=this.config.name),D.dataInputs=[],D.dataOutputs=[],D.className=this.getClassName();for(const j of this.dataInputs){const W={};j.serialize(W),D.dataInputs.push(W)}for(const j of this.dataOutputs){const W={};j.serialize(W),D.dataOutputs.push(W)}}getClassName(){return"FGBlock"}static Parse(D,j){const W=M.f.Instantiate(D.className),Q={},C=j.valueParseFunction??fW;if(D.config)for(const M in D.config)Q[M]=C(M,D.config,j.Be);var k;("FGSetPropertyBlock"===(k=D.className)||"FGGetPropertyBlock"===k||"FGPlayAnimationBlock"===k||"FGMeshPickEventBlock"===k)&&(Q.pathConverter=j.pathConverter);const O=new W(Q);O.uniqueId=D.uniqueId;for(let M=0;M<D.dataInputs.length;M++){const j=O.getDataInput(D.dataInputs[M].name);if(!j)throw new Error("Could not find data input with name "+D.dataInputs[M].name+" in block "+D.className);j.deserialize(D.dataInputs[M])}for(let M=0;M<D.dataOutputs.length;M++){const j=O.getDataOutput(D.dataOutputs[M].name);if(!j)throw new Error("Could not find data output with name "+D.dataOutputs[M].name+" in block "+D.className);j.deserialize(D.dataOutputs[M])}return O.metadata=D.metadata,O.deserialize&&O.deserialize(D),O}}class ZW extends hj{_isSingularConnection(){return 1===this.connectionType}_activateSignal(D){var j;0===this.connectionType?(D._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(D,this),D._increaseExecutionId()):null===(j=this._connectedPoint[0])||void 0===j||j._activateSignal(D)}}(0,e.c)("FlowGraphSignalConnection",ZW);class PW extends FW{constructor(D){super(D),this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in")}_registerSignalInput(D){const j=new ZW(D,0,this);return this.signalInputs.push(j),j}_registerSignalOutput(D){const j=new ZW(D,1,this);return this.signalOutputs.push(j),j}getSignalInput(D){return this.signalInputs.find((j=>j.name===D))}getSignalOutput(D){return this.signalOutputs.find((j=>j.name===D))}serialize(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(D),D.signalInputs=[],D.signalOutputs=[];for(const j of this.signalInputs){const W={};j.serialize(W),D.signalInputs.push(W)}for(const j of this.signalOutputs){const W={};j.serialize(W),D.signalOutputs.push(W)}}deserialize(D){for(let j=0;j<D.signalInputs.length;j++){const W=this.getSignalInput(D.signalInputs[j].name);if(!W)throw new Error("Could not find signal input with name "+D.signalInputs[j].name+" in block "+D.className);W.deserialize(D.signalInputs[j])}for(let j=0;j<D.signalOutputs.length;j++){const W=this.getSignalOutput(D.signalOutputs[j].name);if(!W)throw new Error("Could not find signal output with name "+D.signalOutputs[j].name+" in block "+D.className);W.deserialize(D.signalOutputs[j])}}getClassName(){return"FGExecutionBlock"}}class XW extends PW{constructor(D){super(D),this.out=this._registerSignalOutput("out"),this.done=this._registerSignalOutput("done")}_startPendingTasks(D){this._preparePendingTasks(D),D._addPendingBlock(this)}}class xW extends XW{_execute(D){D._notifyExecuteNode(this),this.out._activateSignal(D)}}class RW{constructor(D){this.uniqueId=(0,Jj.c)(),this._userVariables={},this._executionVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new F.d,this._configuration=D}hasVariable(D){return D in this._userVariables}setVariable(D,j){this._userVariables[D]=j}getVariable(D){return this._userVariables[D]}get userVariables(){return this._userVariables}_getUniqueIdPrefixedName(D,j){return`${D.uniqueId}_${j}`}_setExecutionVariable(D,j,W){this._executionVariables[this._getUniqueIdPrefixedName(D,j)]=W}_getExecutionVariable(D,j,W){return this._hasExecutionVariable(D,j)?this._executionVariables[this._getUniqueIdPrefixedName(D,j)]:W}_deleteExecutionVariable(D,j){delete this._executionVariables[this._getUniqueIdPrefixedName(D,j)]}_hasExecutionVariable(D,j){return this._getUniqueIdPrefixedName(D,j)in this._executionVariables}_hasConnectionValue(D){return D.uniqueId in this._connectionValues}_setConnectionValue(D,j){this._connectionValues[D.uniqueId]=j}_getConnectionValue(D){return this._connectionValues[D.uniqueId]}get configuration(){return this._configuration}_addPendingBlock(D){this._pendingBlocks.push(D)}_removePendingBlock(D){const j=this._pendingBlocks.indexOf(D);-1!==j&&this._pendingBlocks.splice(j,1)}_clearPendingBlocks(){for(const D of this._pendingBlocks)D._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(D){this.onNodeExecutedObservable.notifyObservers(D)}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:EW;D.uniqueId=this.uniqueId,D._userVariables={};for(const W in this._userVariables)j(W,this._userVariables[W],D._userVariables);D._connectionValues={};for(const W in this._connectionValues)j(W,this._connectionValues[W],D._connectionValues)}getClassName(){return"FGContext"}static Parse(D,j){const W=j.graph.createContext(),Q=j.valueParseFunction??fW;W.uniqueId=D.uniqueId;for(const C in D._userVariables){const j=Q(C,D._userVariables,W._configuration.Be);W._userVariables[C]=j}for(const C in D._connectionValues){const j=Q(C,D._connectionValues,W._configuration.Be);W._connectionValues[C]=j}return W}}(0,N.b)([(0,G.O)()],RW.prototype,"uniqueId",void 0);var VW,UW,gW=W(1283);function NW(D,j){return!(!D.parent||D.parent!==j&&!NW(D.parent,j))}class GW extends xW{constructor(D){super(D),this.config=D}_getReferencedMesh(){const D=this.config.pathConverter.convert(this.config.path),j=D.info.getObject(D.object);if(!j||!(j instanceof I.c))throw new Error("Mesh pick event block requires a valid mesh");return j}_preparePendingTasks(D){let j=D._getExecutionVariable(this,"meshPickObserver");if(!j){const W=this._getReferencedMesh();D._setExecutionVariable(this,"mesh",W),j=W.va().onPointerObservable.add((j=>{var Q,C,k;j.type===gW.d.POINTERPICK&&null!==(Q=j.pickInfo)&&void 0!==Q&&Q.pickedMesh&&((null===(C=j.pickInfo)||void 0===C?void 0:C.pickedMesh)===W||NW(null===(k=j.pickInfo)||void 0===k?void 0:k.pickedMesh,W))&&this._execute(D)}));const Q=W.Qd.add((()=>this._onDispose));D._setExecutionVariable(this,"meshPickObserver",j),D._setExecutionVariable(this,"meshDisposeObserver",Q)}}_onDispose(D){this._cancelPendingTasks(D),D._removePendingBlock(this)}_cancelPendingTasks(D){const j=D._getExecutionVariable(this,"mesh"),W=D._getExecutionVariable(this,"meshPickObserver"),Q=D._getExecutionVariable(this,"meshDisposeObserver");j.va().onPointerObservable.remove(W),j.Qd.remove(Q),D._deleteExecutionVariable(this,"mesh"),D._deleteExecutionVariable(this,"meshPickObserver"),D._deleteExecutionVariable(this,"meshDisposeObserver")}getClassName(){return GW.ClassName}serialize(D){super.serialize(D),D.config.path=this.config.path}}GW.ClassName="FGMeshPickEventBlock",(0,e.c)(GW.ClassName,GW),function(D){D[D.Stopped=0]="Stopped",D[D.Started=1]="Started"}(VW||(VW={}));class KW{constructor(D){this._eventBlocks=[],this._executionContexts=[],this.state=0,this._scene=D.Be,this._coordinator=D.coordinator,this._sceneDisposeObserver=this._scene.Qd.add((()=>this.dispose()))}createContext(){const D=new RW({Be:this._scene,coordinator:this._coordinator});return this._executionContexts.push(D),D}getContext(D){return this._executionContexts[D]}addEventBlock(D){this._eventBlocks.push(D)}start(){if(1!==this.state){this.state=1,0===this._executionContexts.length&&this.createContext();for(const D of this._executionContexts){const j=this._getContextualOrder();for(const W of j)W._startPendingTasks(D)}}}_getContextualOrder(){const D=[];for(const j of this._eventBlocks)if(j.getClassName()===GW.ClassName){const W=j._getReferencedMesh();let Q=0;for(;Q<D.length;Q++){const j=D[Q]._getReferencedMesh();if(W&&j&&NW(W,j))break}D.splice(Q,0,j)}else D.push(j);return D}dispose(){if(0!==this.state){this.state=0;for(const D of this._executionContexts)D._clearPendingBlocks();this._executionContexts.length=0,this._eventBlocks.length=0,this._scene.Qd.remove(this._sceneDisposeObserver),this._sceneDisposeObserver=null}}visitAllBlocks(D){const j=[],W=new Set;for(const Q of this._eventBlocks)j.push(Q),W.add(Q.uniqueId);for(;j.length>0;){const Q=j.pop();D(Q);for(const D of Q.dataInputs)for(const Q of D._connectedPoint)W.has(Q._ownerBlock.uniqueId)||(j.push(Q._ownerBlock),W.add(Q._ownerBlock.uniqueId));if(Q instanceof PW)for(const D of Q.signalOutputs)for(const Q of D._connectedPoint)W.has(Q._ownerBlock.uniqueId)||(j.push(Q._ownerBlock),W.add(Q._ownerBlock.uniqueId))}}serialize(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},j=arguments.length>1?arguments[1]:void 0;D.allBlocks=[],this.visitAllBlocks((j=>{const W={};j.serialize(W),D.allBlocks.push(W)})),D.executionContexts=[];for(const W of this._executionContexts){const Q={};W.serialize(Q,j),D.executionContexts.push(Q)}}static GetDataOutConnectionByUniqueId(D,j){for(const W of D)for(const D of W.dataOutputs)if(D.uniqueId===j)return D;throw new Error("Could not find data out connection with unique id "+j)}static GetSignalInConnectionByUniqueId(D,j){for(const W of D)if(W instanceof PW)for(const D of W.signalInputs)if(D.uniqueId===j)return D;throw new Error("Could not find signal in connection with unique id "+j)}static Parse(D,j){const W=j.coordinator.createGraph(),Q=[],C=j.valueParseFunction??fW;for(const k of D.allBlocks){const D=FW.Parse(k,{Be:j.coordinator.config.Be,pathConverter:j.pathConverter,valueParseFunction:C});Q.push(D),D instanceof xW&&W.addEventBlock(D)}for(const k of Q){for(const D of k.dataInputs)for(const j of D.connectedPointIds){const W=KW.GetDataOutConnectionByUniqueId(Q,j);D.connectTo(W)}if(k instanceof PW)for(const D of k.signalOutputs)for(const j of D.connectedPointIds){const W=KW.GetSignalInConnectionByUniqueId(Q,j);D.connectTo(W)}}for(const k of D.executionContexts)RW.Parse(k,{graph:W,valueParseFunction:C});return W}}class LW{constructor(D){this.config=D,this._flowGraphs=[],this._customEventsMap=new Map,this.config.Be.Qd.add((()=>{this.dispose()}));(LW.SceneCoordinators.get(this.config.Be)??[]).push(this)}createGraph(){const D=new KW({Be:this.config.Be,coordinator:this});return this._flowGraphs.push(D),D}removeGraph(D){const j=this._flowGraphs.indexOf(D);-1!==j&&(D.dispose(),this._flowGraphs.splice(j,1))}start(){this._flowGraphs.forEach((D=>D.start()))}dispose(){this._flowGraphs.forEach((D=>D.dispose())),this._flowGraphs.length=0;const D=LW.SceneCoordinators.get(this.config.Be)??[],j=D.indexOf(this);-1!==j&&D.splice(j,1)}serialize(D,j){D._flowGraphs=[],this._flowGraphs.forEach((W=>{const Q={};W.serialize(Q,j),D._flowGraphs.push(Q)}))}static Parse(D,j){var W;const Q=j.valueParseFunction??fW,C=new LW({Be:j.Be});return null===(W=D._flowGraphs)||void 0===W||W.forEach((D=>{KW.Parse(D,{coordinator:C,valueParseFunction:Q,pathConverter:j.pathConverter})})),C}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(D){let j=this._customEventsMap.get(D);return j||(j=new F.d,this._customEventsMap.set(D,j)),j}notifyCustomEvent(D,j){const W=this._customEventsMap.get(D);W&&W.notifyObservers(j)}}LW.SceneCoordinators=new Map;class eW extends xW{_preparePendingTasks(D){if(!D._getExecutionVariable(this,"sceneReadyObserver")){const j=D.configuration.Be.onReadyObservable.add((()=>{this._execute(D)}));D._setExecutionVariable(this,"sceneReadyObserver",j)}}_cancelPendingTasks(D){const j=D._getExecutionVariable(this,"sceneReadyObserver");D.configuration.Be.onReadyObservable.remove(j),D._deleteExecutionVariable(this,"sceneReadyObserver")}getClassName(){return eW.ClassName}}eW.ClassName="FGSceneReadyEventBlock",(0,e.c)("FGSceneReadyEventBlock",eW);class sW extends xW{_preparePendingTasks(D){if(!D._getExecutionVariable(this,"sceneBeforeRender")){const j=D.configuration.Be.onBeforeRenderObservable.add((()=>{this._execute(D)}));D._setExecutionVariable(this,"sceneBeforeRender",j)}}_cancelPendingTasks(D){const j=D._getExecutionVariable(this,"sceneBeforeRender");D.configuration.Be.onBeforeRenderObservable.remove(j),D._deleteExecutionVariable(this,"sceneBeforeRender")}getClassName(){return sW.ClassName}}sW.ClassName="FGSceneTickEventBlock",(0,e.c)(sW.ClassName,sW);class bW extends PW{constructor(D){super(D),this.out=this._registerSignalOutput("out")}}class YW extends bW{constructor(D){super(D),this.message=this.registerDataInput("message",Bj)}_execute(D){const j=this.message.getValue(D);R.b.Log(j),this.out._activateSignal(D)}getClassName(){return YW.ClassName}}YW.ClassName="FGConsoleLogBlock",(0,e.c)(YW.ClassName,YW),function(D){D[D.INIT=0]="INIT",D[D.STARTED=1]="STARTED",D[D.ENDED=2]="ENDED"}(UW||(UW={}));class tW{constructor(D){this.onEachCountObservable=new F.d,this.onTimerAbortedObservable=new F.d,this.onTimerEndedObservable=new F.d,this.onStateChangedObservable=new F.d,this._observer=null,this._breakOnNextTick=!1,this._tick=D=>{const j=Date.now();this._timer=j-this._startTime;const W={startTime:this._startTime,currentTime:j,deltaTime:this._timer,completeRate:this._timer/this._timeToEnd,payload:D},Q=this._breakOnNextTick||this._breakCondition(W);Q||this._timer>=this._timeToEnd?this._stop(W,Q):this.onEachCountObservable.notifyObservers(W)},this._setState(0),this._contextObservable=D.contextObservable,this._observableParameters=D.observableParameters??{},this._breakCondition=D.breakCondition??(()=>!1),this._timeToEnd=D.timeout,D.onEnded&&this.onTimerEndedObservable.add(D.onEnded),D.Ei&&this.onEachCountObservable.add(D.Ei),D.onAborted&&this.onTimerAbortedObservable.add(D.onAborted)}set breakCondition(D){this._breakCondition=D}clearObservables(){this.onEachCountObservable.clear(),this.onTimerAbortedObservable.clear(),this.onTimerEndedObservable.clear(),this.onStateChangedObservable.clear()}start(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._timeToEnd;if(1===this._state)throw new Error("Timer already started. Please stop it before starting again");this._timeToEnd=D,this._startTime=Date.now(),this._timer=0,this._observer=this._contextObservable.add(this._tick,this._observableParameters.mask,this._observableParameters.insertFirst,this._observableParameters.scope),this._setState(1)}stop(){1===this._state&&(this._breakOnNextTick=!0)}dispose(){this._observer&&this._contextObservable.remove(this._observer),this.clearObservables()}_setState(D){this._state=D,this.onStateChangedObservable.notifyObservers(this._state)}_stop(D){let j=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._contextObservable.remove(this._observer),this._setState(2),j?this.onTimerAbortedObservable.notifyObservers(D):this.onTimerEndedObservable.notifyObservers(D)}}class cW extends XW{constructor(D){super(D),this.timeout=this.registerDataInput("timeout",rj)}_preparePendingTasks(D){const j=this.timeout.getValue(D);if(void 0!==j&&j>=0){const W=D._getExecutionVariable(this,"runningTimers")||[],Q=D.configuration.Be,C=new tW({timeout:j,contextObservable:Q.onBeforeRenderObservable,onEnded:()=>this._onEnded(C,D)});C.start(),W.push(C),D._setExecutionVariable(this,"runningTimers",W)}}_execute(D){this._startPendingTasks(D),this.out._activateSignal(D)}_onEnded(D,j){const W=j._getExecutionVariable(this,"runningTimers")||[],Q=W.indexOf(D);-1!==Q?W.splice(Q,1):M.f.Warn("FlowGraphTimerBlock: Timer ended but was not found in the running timers list"),j._removePendingBlock(this),this.done._activateSignal(j)}_cancelPendingTasks(D){const j=D._getExecutionVariable(this,"runningTimers")||[];for(const W of j)W.dispose();D._deleteExecutionVariable(this,"runningTimers")}getClassName(){return cW.ClassName}}cW.ClassName="FGTimerBlock",(0,e.c)("FGTimerBlock",cW);class lW extends bW{constructor(D){super(D),this.config=D;for(let j=0;j<this.config.eventData.length;j++){const D=this.config.eventData[j];this.registerDataInput(D,Bj)}}_execute(D){const j=this.config.eventId,W=this.dataInputs.map((j=>j.getValue(D)));D.configuration.coordinator.notifyCustomEvent(j,W),this.out._activateSignal(D)}getClassName(){return lW.ClassName}}lW.ClassName="FGSendCustomEventBlock",(0,e.c)("FGSendCustomEventBlock",lW);class IW extends xW{constructor(D){super(D),this.config=D;for(let j=0;j<this.config.eventData.length;j++){const D=this.config.eventData[j];this.registerDataOutput(D,Bj)}}_preparePendingTasks(D){const j=D.configuration.coordinator.getCustomEventObservable(this.config.eventId);this._eventObserver=j.add((j=>{for(let W=0;W<j.length;W++)this.dataOutputs[W].setValue(j[W],D);this._execute(D)}))}_cancelPendingTasks(D){const j=D.configuration.coordinator.getCustomEventObservable(this.config.eventId);j?j.remove(this._eventObserver):M.f.Warn(`FlowGraphReceiveCustomEventBlock: Missing observable for event ${this.config.eventId}`)}getClassName(){return IW.ClassName}serialize(D){super.serialize(D),D.eventId=this.config.eventId,D.eventData=this.config.eventData}}IW.ClassName="FGReceiveCustomEventBlock",(0,e.c)(IW.ClassName,IW);class yW extends PW{constructor(D){super(D),this.config=D,this.outFlows=[];for(let j=0;j<this.config.numberOutputFlows;j++)this.outFlows.push(this._registerSignalOutput(`${j}`))}_execute(D){for(let j=0;j<this.config.numberOutputFlows;j++)this.outFlows[j]._activateSignal(D)}getClassName(){return yW.ClassName}}yW.ClassName="FGSequenceBlock",(0,e.c)(yW.ClassName,yW);const mW=new RegExp(/\{(\w+)\}/g);class aW{constructor(D,j){this.path=D,this.ownerBlock=j,this.templatedInputs=[];let W=mW.exec(D);for(;W;){const[,Q]=W;this.templatedInputs.push(j.registerDataInput(Q,CW)),W=mW.exec(D)}}getAccessor(D,j){let W=this.path;for(const Q of this.templatedInputs){const D=Q.getValue(j).value;W=W.replace(`{${Q.name}}`,D.toString())}return D.convert(W)}}class SW extends FW{constructor(D){super(D),this.config=D,this.value=this.registerDataOutput("value",Bj),this.templateComponent=new aW(D.path,this)}_updateOutputs(D){const j=this.templateComponent.getAccessor(this.config.pathConverter,D),W=j.info.get(j.object);this.value.setValue(W,D)}getClassName(){return SW.ClassName}serialize(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(D),D.config.path=this.config.path}}SW.ClassName="FGGetPropertyBlock",(0,e.c)(SW.ClassName,SW);class HW extends bW{constructor(D){super(D),this.config=D,this.a=this.registerDataInput("a",Bj),this.templateComponent=new aW(D.path,this)}_execute(D){const j=this.a.getValue(D),W=this.templateComponent.getAccessor(this.config.pathConverter,D);W.info.set(j,W.object),this.out._activateSignal(D)}serialize(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(D),D.config.path=this.config.path}getClassName(){return HW.ClassName}}HW.ClassName="FGSetPropertyBlock",(0,e.c)("FGSetPropertyBlock",HW);const zW="cachedOperationValue",iW="cachedExecutionId";class pW extends FW{constructor(D,j){super(j),this.value=this.registerDataOutput("value",D)}_updateOutputs(D){const j=D._getExecutionVariable(this,iW),W=D._getExecutionVariable(this,zW);if(void 0!==W&&j===D.executionId)this.value.setValue(W,D);else{const j=this._doOperation(D);D._setExecutionVariable(this,zW,j),D._setExecutionVariable(this,iW,D.executionId),this.value.setValue(j,D)}}}class TW extends pW{constructor(D,j,W,Q,C,k){super(W,k),this._operation=Q,this._className=C,this.a=this.registerDataInput("a",D),this.b=this.registerDataInput("b",j)}_doOperation(D){return this._operation(this.a.getValue(D),this.b.getValue(D))}getClassName(){return this._className}}class AW extends pW{constructor(D,j,W,Q){super(D,Q),this._operation=j,this._className=W}_doOperation(D){return this._operation()}getClassName(){return this._className}}class wW extends pW{constructor(D,j,W,Q,C){super(j,C),this._operation=W,this._className=Q,this.a=this.registerDataInput("a",D)}_doOperation(D){return this._operation(this.a.getValue(D))}getClassName(){return this._className}}class nW extends pW{constructor(D,j,W,Q,C,k,M){super(Q,M),this._operation=C,this._className=k,this.a=this.registerDataInput("a",D),this.b=this.registerDataInput("b",j),this.c=this.registerDataInput("c",W)}_doOperation(D){return this._operation(this.a.getValue(D),this.b.getValue(D),this.c.getValue(D))}getClassName(){return this._className}}function uW(D){return D.getClassName?D.getClassName():""}function qW(D,j){return"Vector2"===D&&"Vector2"===j||"Kd"===D&&"Kd"===j||"Vector4"===D&&"Vector4"===j}function oW(D,j){return"Matrix"===D&&"Matrix"===j}function JW(D,j){return"FlowGraphInteger"===D&&"FlowGraphInteger"===j}class hW extends TW{constructor(D){super(Bj,Bj,Bj,((D,j)=>this._polymorphicAdd(D,j)),hW.ClassName,D)}_polymorphicAdd(D,j){const W=uW(D),Q=uW(j);return qW(W,Q)||oW(W,Q)||JW(W,Q)?D.add(j):D+j}}hW.ClassName="FGAddBlock",(0,e.c)(hW.ClassName,hW);class dW extends TW{constructor(D){super(Bj,Bj,Bj,((D,j)=>this._polymorphicAdd(D,j)),dW.ClassName,D)}_polymorphicAdd(D,j){const W=uW(D),Q=uW(j);return qW(W,Q)||JW(W,Q)?D.Qc(j):oW(W,Q)?D.add(j.scale(-1)):D-j}}dW.ClassName="FGSubBlock",(0,e.c)(dW.ClassName,dW);class vW extends TW{constructor(D){super(Bj,Bj,Bj,((D,j)=>this._polymorphicMultiply(D,j)),vW.ClassName,D)}_polymorphicMultiply(D,j){const W=uW(D),Q=uW(j);return qW(W,Q)||JW(W,Q)?D.multiply(j):oW(W,Q)?C.b.FromValues(D.m[0]*j.m[0],D.m[4]*j.m[4],D.m[8]*j.m[8],D.m[12]*j.m[12],D.m[1]*j.m[1],D.m[5]*j.m[5],D.m[9]*j.m[9],D.m[13]*j.m[13],D.m[2]*j.m[2],D.m[6]*j.m[6],D.m[10]*j.m[10],D.m[14]*j.m[14],D.m[3]*j.m[3],D.m[7]*j.m[7],D.m[11]*j.m[11],D.m[15]*j.m[15]):D*j}}vW.ClassName="FGMultiplyBlock",(0,e.c)(vW.ClassName,vW);class BW extends TW{constructor(D){super(Bj,Bj,Bj,((D,j)=>this._polymorphicDivide(D,j)),BW.ClassName,D)}_polymorphicDivide(D,j){const W=uW(D),Q=uW(j);return qW(W,Q)||JW(W,Q)?D.divide(j):oW(W,Q)?C.b.FromValues(D.m[0]/j.m[0],D.m[4]/j.m[4],D.m[8]/j.m[8],D.m[12]/j.m[12],D.m[1]/j.m[1],D.m[5]/j.m[5],D.m[9]/j.m[9],D.m[13]/j.m[13],D.m[2]/j.m[2],D.m[6]/j.m[6],D.m[10]/j.m[10],D.m[14]/j.m[14],D.m[3]/j.m[3],D.m[7]/j.m[7],D.m[11]/j.m[11],D.m[15]/j.m[15]):D/j}}BW.ClassName="FGDivideBlock",(0,e.c)(BW.ClassName,BW);class rW extends AW{constructor(D){super(rj,(()=>Math.random()),rW.ClassName,D)}}rW.ClassName="FGRandomBlock",(0,e.c)(rW.ClassName,rW);class DQ extends TW{constructor(D){super(Bj,Bj,rj,((D,j)=>this._polymorphicDot(D,j)),DQ.ClassName,D)}_polymorphicDot(D,j){switch(uW(D)){case"Vector2":return C.f.Dot(D,j);case"Kd":return C.j.Dot(D,j);case"Vector4":return C.m.Dot(D,j);default:throw new Error(`Cannot get dot product of ${D} and ${j}`)}}}DQ.ClassName="FGDotBlock",(0,e.c)(DQ.ClassName,DQ);class jQ extends AW{constructor(D){super(rj,(()=>Math.E),jQ.ClassName,D)}}jQ.ClassName="FGEBlock",(0,e.c)(jQ.ClassName,jQ);class WQ extends AW{constructor(D){super(rj,(()=>Math.PI),WQ.ClassName,D)}}WQ.ClassName="FGPIBlock",(0,e.c)(WQ.ClassName,WQ);class QQ extends AW{constructor(D){super(rj,(()=>Number.POSITIVE_INFINITY),QQ.ClassName,D)}}QQ.ClassName="FGInfBlock",(0,e.c)(QQ.ClassName,QQ);class CQ extends AW{constructor(D){super(rj,(()=>Number.NaN),CQ.ClassName,D)}}function kQ(D,j){switch(uW(D)){case"FlowGraphInteger":return new dj(j(D.value));case"Vector2":return new C.f(j(D.x),j(D.y));case"Kd":return new C.j(j(D.x),j(D.y),j(D.z));case"Vector4":return new C.m(j(D.x),j(D.y),j(D.z),j(D.w));case"Matrix":return C.b.FromValues(j(D.m[0]),j(D.m[4]),j(D.m[8]),j(D.m[12]),j(D.m[1]),j(D.m[5]),j(D.m[9]),j(D.m[13]),j(D.m[2]),j(D.m[6]),j(D.m[10]),j(D.m[14]),j(D.m[3]),j(D.m[7]),j(D.m[11]),j(D.m[15]));default:return j(D)}}CQ.ClassName="FGNaNBlock",(0,e.c)(CQ.ClassName,CQ);class MQ extends wW{constructor(D){super(Bj,Bj,(D=>this._polymorphicAbs(D)),MQ.ClassName,D)}_polymorphicAbs(D){return kQ(D,Math.abs)}}MQ.ClassName="FGAbsBlock",(0,e.c)(MQ.ClassName,MQ);class OQ extends wW{constructor(D){super(Bj,Bj,(D=>this._polymorphicSign(D)),OQ.ClassName,D)}_polymorphicSign(D){return kQ(D,Math.sign)}}OQ.ClassName="FGSignBlock",(0,e.c)(OQ.ClassName,OQ);class EQ extends wW{constructor(D){super(Bj,Bj,(D=>this._polymorphicTrunc(D)),EQ.ClassName,D)}_polymorphicTrunc(D){return kQ(D,Math.trunc)}}EQ.ClassName="FGTruncBlock",(0,e.c)(EQ.ClassName,EQ);class fQ extends wW{constructor(D){super(Bj,Bj,(D=>this._polymorphicFloor(D)),fQ.ClassName,D)}_polymorphicFloor(D){return kQ(D,Math.floor)}}fQ.ClassName="FGFloorBlock",(0,e.c)(fQ.ClassName,fQ);class FQ extends wW{constructor(D){super(Bj,Bj,(D=>this._polymorphicCeiling(D)),FQ.ClassName,D)}_polymorphicCeiling(D){return kQ(D,Math.ceil)}}FQ.ClassName="FGCeilBlock",(0,e.c)(FQ.ClassName,FQ);class ZQ extends wW{constructor(D){super(Bj,Bj,(D=>this._polymorphicFract(D)),ZQ.ClassName,D)}_polymorphicFract(D){return kQ(D,(D=>D-Math.floor(D)))}}ZQ.ClassName="FGFractBlock",(0,e.c)(ZQ.ClassName,ZQ);class PQ extends wW{constructor(D){super(Bj,Bj,(D=>this._polymorphicNeg(D)),PQ.ClassName,D)}_polymorphicNeg(D){return kQ(D,(D=>-D))}}function XQ(D,j,W){switch(uW(D)){case"FlowGraphInteger":return new dj(W(D.value,j.value));case"Vector2":return new C.f(W(D.x,j.x),W(D.y,j.y));case"Kd":return new C.j(W(D.x,j.x),W(D.y,j.y),W(D.z,j.z));case"Vector4":return new C.m(W(D.x,j.x),W(D.y,j.y),W(D.z,j.z),W(D.w,j.w));case"Matrix":return C.b.FromValues(W(D.m[0],j.m[0]),W(D.m[4],j.m[4]),W(D.m[8],j.m[8]),W(D.m[12],j.m[12]),W(D.m[1],j.m[1]),W(D.m[5],j.m[5]),W(D.m[9],j.m[9]),W(D.m[13],j.m[13]),W(D.m[2],j.m[2]),W(D.m[6],j.m[6]),W(D.m[10],j.m[10]),W(D.m[14],j.m[14]),W(D.m[3],j.m[3]),W(D.m[7],j.m[7]),W(D.m[11],j.m[11]),W(D.m[15],j.m[15]));default:return W(D,j)}}PQ.ClassName="FGNegBlock",(0,e.c)(PQ.ClassName,PQ);class xQ extends TW{constructor(D){super(Bj,Bj,Bj,((D,j)=>this._polymorphicRemainder(D,j)),xQ.ClassName,D)}_polymorphicRemainder(D,j){return XQ(D,j,((D,j)=>D%j))}}xQ.ClassName="FGRemainderBlock",(0,e.c)(xQ.ClassName,xQ);class RQ extends TW{constructor(D){super(Bj,Bj,Bj,((D,j)=>this._polymorphicMin(D,j)),RQ.ClassName,D)}_polymorphicMin(D,j){return XQ(D,j,Math.min)}}RQ.ClassName="FGMinBlock",(0,e.c)(RQ.ClassName,RQ);class VQ extends TW{constructor(D){super(Bj,Bj,Bj,((D,j)=>this._polymorphicMax(D,j)),VQ.ClassName,D)}_polymorphicMax(D,j){return XQ(D,j,Math.max)}}function UQ(D,j,W){return Math.min(Math.max(D,Math.min(j,W)),Math.max(j,W))}function gQ(D,j,W,Q){switch(uW(D)){case"FlowGraphInteger":return new dj(Q(D.value,j.value,W.value));case"Vector2":return new C.f(Q(D.x,j.x,W.x),Q(D.y,j.y,W.y));case"Kd":return new C.j(Q(D.x,j.x,W.x),Q(D.y,j.y,W.y),Q(D.z,j.z,W.z));case"Vector4":return new C.m(Q(D.x,j.x,W.x),Q(D.y,j.y,W.y),Q(D.z,j.z,W.z),Q(D.w,j.w,W.w));case"Matrix":return C.b.FromValues(Q(D.m[0],j.m[0],W.m[0]),Q(D.m[4],j.m[4],W.m[4]),Q(D.m[8],j.m[8],W.m[8]),Q(D.m[12],j.m[12],W.m[12]),Q(D.m[1],j.m[1],W.m[1]),Q(D.m[5],j.m[5],W.m[5]),Q(D.m[9],j.m[9],W.m[9]),Q(D.m[13],j.m[13],W.m[13]),Q(D.m[2],j.m[2],W.m[2]),Q(D.m[6],j.m[6],W.m[6]),Q(D.m[10],j.m[10],W.m[10]),Q(D.m[14],j.m[14],W.m[14]),Q(D.m[3],j.m[3],W.m[3]),Q(D.m[7],j.m[7],W.m[7]),Q(D.m[11],j.m[11],W.m[11]),Q(D.m[15],j.m[15],W.m[15]));default:return Q(D,j,W)}}VQ.ClassName="FGMaxBlock",(0,e.c)(VQ.ClassName,VQ);class NQ extends nW{constructor(D){super(Bj,Bj,Bj,Bj,((D,j,W)=>this._polymorphicClamp(D,j,W)),NQ.ClassName,D)}_polymorphicClamp(D,j,W){return gQ(D,j,W,UQ)}}function GQ(D){return Math.min(Math.max(D,0),1)}NQ.ClassName="FGClampBlock",(0,e.c)(NQ.ClassName,NQ);class KQ extends wW{constructor(D){super(Bj,Bj,(D=>this._polymorphicSaturate(D)),KQ.ClassName,D)}_polymorphicSaturate(D){return kQ(D,GQ)}}KQ.ClassName="FGSaturateBlock",(0,e.c)(KQ.ClassName,KQ);class LQ extends nW{constructor(D){super(Bj,Bj,Bj,Bj,((D,j,W)=>this._polymorphicInterpolate(D,j,W)),LQ.ClassName,D)}_interpolate(D,j,W){return(1-W)*D+W*j}_polymorphicInterpolate(D,j,W){return gQ(D,j,W,this._interpolate)}}LQ.ClassName="FGInterpolateBlock",(0,e.c)(LQ.ClassName,LQ);class eQ extends TW{constructor(D){super(Bj,Bj,DW,((D,j)=>this._polymorphicEq(D,j)),eQ.ClassName,D)}_polymorphicEq(D,j){const W=uW(D),Q=uW(j);return qW(W,Q)||oW(W,Q)||JW(W,Q)?D.equals(j):D===j}}function sQ(D,j,W){const Q=uW(D);if(Q===uW(j)){if(""===Q)return W(D,j);if("FlowGraphInteger"===Q)return W(D.value,j.value);throw new Error(`Cannot compare ${D} and ${j}`)}throw new Error(`${D} and ${j} are of different types.`)}eQ.ClassName="FGEqBlock",(0,e.c)(eQ.ClassName,eQ);class bQ extends TW{constructor(D){super(Bj,Bj,DW,((D,j)=>this._polymorphicLessThan(D,j)),bQ.ClassName,D)}_polymorphicLessThan(D,j){return sQ(D,j,((D,j)=>D<j))}}bQ.ClassName="FGLessThanBlock",(0,e.c)(bQ.ClassName,bQ);class YQ extends TW{constructor(D){super(Bj,Bj,DW,((D,j)=>this._polymorphicLessThanOrEqual(D,j)),YQ.ClassName,D)}_polymorphicLessThanOrEqual(D,j){return sQ(D,j,((D,j)=>D<=j))}}YQ.ClassName="FGLessThanOrEqualBlock";class tQ extends TW{constructor(D){super(Bj,Bj,DW,((D,j)=>this._polymorphicGreaterThan(D,j)),tQ.ClassName,D)}_polymorphicGreaterThan(D,j){return sQ(D,j,((D,j)=>D>j))}}tQ.ClassName="FGGreaterThanBlock",(0,e.c)(tQ.ClassName,tQ);class cQ extends TW{constructor(D){super(Bj,Bj,DW,((D,j)=>this._polymorphicGreaterThanOrEqual(D,j)),cQ.ClassName,D)}_polymorphicGreaterThanOrEqual(D,j){return sQ(D,j,((D,j)=>D>=j))}}cQ.ClassName="FGGreaterThanOrEqualBlock",(0,e.c)(cQ.ClassName,cQ);class lQ extends wW{constructor(D){super(Bj,DW,(D=>this._polymorphicIsNan(D)),lQ.ClassName,D)}_polymorphicIsNan(D){const j=uW(D);if(""===j)return isNaN(D);if("FlowGraphInteger"===j)return isNaN(D.value);throw new Error(`Cannot get NaN of ${D}`)}}lQ.ClassName="FGIsNanBlock",(0,e.c)(lQ.ClassName,lQ);class IQ extends wW{constructor(D){super(Bj,DW,(D=>this._polymorphicIsInf(D)),IQ.ClassName,D)}_polymorphicIsInf(D){const j=uW(D);if(""===j)return!isFinite(D);if("FlowGraphInteger"===j)return!isFinite(D.value);throw new Error(`Cannot get isInf of ${D}`)}}IQ.ClassName="FGIsInfBlock";class yQ extends wW{constructor(D){super(Bj,Bj,(D=>this._polymorphicDegToRad(D)),yQ.ClassName,D)}_degToRad(D){return D*Math.PI/180}_polymorphicDegToRad(D){return kQ(D,this._degToRad)}}yQ.ClassName="FGDegToRadBlock",(0,e.c)(yQ.ClassName,yQ);class mQ extends wW{constructor(D){super(Bj,Bj,(D=>this._polymorphicRadToDeg(D)),mQ.ClassName,D)}_radToDeg(D){return 180*D/Math.PI}_polymorphicRadToDeg(D){return kQ(D,this._radToDeg)}}mQ.ClassName="FGRadToDegBlock",(0,e.c)(mQ.ClassName,mQ);class aQ extends wW{constructor(D){super(Bj,Bj,(D=>this._polymorphicSin(D)),aQ.ClassName,D)}_polymorphicSin(D){return kQ(D,Math.sin)}}aQ.ClassName="FGSinBlock",(0,e.c)(aQ.ClassName,aQ);class SQ extends wW{constructor(D){super(Bj,Bj,(D=>this._polymorphicCos(D)),SQ.ClassName,D)}_polymorphicCos(D){return kQ(D,Math.cos)}}SQ.ClassName="FGCosBlock",(0,e.c)(SQ.ClassName,SQ);class HQ extends wW{constructor(D){super(Bj,Bj,(D=>this._polymorphicTan(D)),HQ.ClassName,D)}_polymorphicTan(D){return kQ(D,Math.tan)}}HQ.ClassName="FGTanBlock",(0,e.c)(HQ.ClassName,HQ);class zQ extends wW{constructor(D){super(Bj,Bj,(D=>this._polymorphicAsin(D)),zQ.ClassName,D)}_polymorphicAsin(D){return kQ(D,Math.asin)}}zQ.ClassName="FGAsinBlock",(0,e.c)(zQ.ClassName,zQ);class iQ extends wW{constructor(D){super(Bj,Bj,(D=>this._polymorphicAcos(D)),iQ.ClassName,D)}_polymorphicAcos(D){return kQ(D,Math.acos)}}iQ.ClassName="FGAcosBlock",(0,e.c)(iQ.ClassName,iQ);class pQ extends wW{constructor(D){super(Bj,Bj,(D=>this._polymorphicAtan(D)),pQ.ClassName,D)}_polymorphicAtan(D){return kQ(D,Math.atan)}}pQ.ClassName="FGAtanBlock",(0,e.c)(pQ.ClassName,pQ);class TQ extends TW{constructor(D){super(Bj,Bj,Bj,((D,j)=>this._polymorphicAtan2(D,j)),TQ.ClassName,D)}_polymorphicAtan2(D,j){return XQ(D,j,Math.atan2)}}TQ.ClassName="FGAtan2Block",(0,e.c)(TQ.ClassName,TQ);class AQ extends wW{constructor(D){super(Bj,Bj,(D=>this._polymorphicSinh(D)),AQ.ClassName,D)}_polymorphicSinh(D){return kQ(D,Math.sinh)}}AQ.ClassName="FGSinhBlock",(0,e.c)(AQ.ClassName,AQ);class wQ extends wW{constructor(D){super(Bj,Bj,(D=>this._polymorphicCosh(D)),wQ.ClassName,D)}_polymorphicCosh(D){return kQ(D,Math.cosh)}}wQ.ClassName="FGCoshBlock",(0,e.c)(wQ.ClassName,wQ);class nQ extends wW{constructor(D){super(Bj,Bj,(D=>this._polymorphicTanh(D)),nQ.ClassName,D)}_polymorphicTanh(D){return kQ(D,Math.tanh)}}nQ.ClassName="FGTanhBlock",(0,e.c)(nQ.ClassName,nQ);class uQ extends wW{constructor(D){super(Bj,rj,(D=>this._polymorphicAsinh(D)),uQ.ClassName,D)}_polymorphicAsinh(D){return kQ(D,Math.asinh)}}uQ.ClassName="FGAsinhBlock",(0,e.c)(uQ.ClassName,uQ);class qQ extends wW{constructor(D){super(Bj,rj,(D=>this._polymorphicAcosh(D)),qQ.ClassName,D)}_polymorphicAcosh(D){return kQ(D,Math.acosh)}}qQ.ClassName="FGAcoshBlock",(0,e.c)(qQ.ClassName,qQ);class oQ extends wW{constructor(D){super(Bj,rj,(D=>this._polymorphicAtanh(D)),oQ.ClassName,D)}_polymorphicAtanh(D){return kQ(D,Math.atanh)}}oQ.ClassName="FGAtanhBlock",(0,e.c)(oQ.ClassName,oQ);class JQ extends wW{constructor(D){super(Bj,rj,(D=>this._polymorphicExp(D)),JQ.ClassName,D)}_polymorphicExp(D){return kQ(D,Math.exp)}}JQ.ClassName="FGExpBlock",(0,e.c)(JQ.ClassName,JQ);class hQ extends wW{constructor(D){super(Bj,rj,(D=>this._polymorphicLog(D)),hQ.ClassName,D)}_polymorphicLog(D){return kQ(D,Math.log)}}hQ.ClassName="FGLogBlock",(0,e.c)(hQ.ClassName,hQ);class dQ extends wW{constructor(D){super(Bj,rj,(D=>this._polymorphicLog2(D)),dQ.ClassName,D)}_polymorphicLog2(D){return kQ(D,Math.log2)}}dQ.ClassName="FGLog2Block",(0,e.c)(dQ.ClassName,dQ);class vQ extends wW{constructor(D){super(Bj,rj,(D=>this._polymorphicLog10(D)),vQ.ClassName,D)}_polymorphicLog10(D){return kQ(D,Math.log10)}}vQ.ClassName="FGLog10Block",(0,e.c)(vQ.ClassName,vQ);class BQ extends wW{constructor(D){super(Bj,rj,(D=>this._polymorphicSqrt(D)),BQ.ClassName,D)}_polymorphicSqrt(D){return kQ(D,Math.sqrt)}}BQ.ClassName="FGSqrtBlock",(0,e.c)(BQ.ClassName,BQ);class rQ extends wW{constructor(D){super(Bj,rj,(D=>this._polymorphicCubeRoot(D)),rQ.ClassName,D)}_polymorphicCubeRoot(D){return kQ(D,Math.cbrt)}}rQ.ClassName="FGCubeRootBlock",(0,e.c)(rQ.ClassName,rQ);class DC extends TW{constructor(D){super(Bj,rj,rj,((D,j)=>this._polymorphicPow(D,j)),DC.ClassName,D)}_polymorphicPow(D,j){return XQ(D,j,Math.pow)}}DC.ClassName="FGPowBlock",(0,e.c)(DC.ClassName,DC);class jC extends wW{constructor(D){super(Bj,rj,(D=>this._polymorphicLength(D)),jC.ClassName,D)}_polymorphicLength(D){switch(uW(D)){case"Vector2":case"Kd":case"Vector4":return D.length();default:throw new Error(`Cannot compute length of value ${D}`)}}}jC.ClassName="FGLengthBlock",(0,e.c)(jC.ClassName,jC);class WC extends wW{constructor(D){super(Bj,Bj,(D=>this._polymorphicNormalize(D)),WC.ClassName,D)}_polymorphicNormalize(D){switch(uW(D)){case"Vector2":case"Kd":case"Vector4":return D.normalize();default:throw new Error(`Cannot normalize value ${D}`)}}}WC.ClassName="FGNormalizeBlock",(0,e.c)(WC.ClassName,WC);class QC extends TW{constructor(D){super(WW,WW,WW,((D,j)=>C.j.Cross(D,j)),QC.ClassName,D)}}QC.ClassName="FGCrossBlock",(0,e.c)(QC.ClassName,QC);class CC extends TW{constructor(D){super(jW,rj,jW,((D,j)=>C.f.Transform(D,C.b.RotationZ(j))),CC.ClassName,D)}}CC.ClassName="FGRotate2DBlock",(0,e.c)(CC.ClassName,CC);class kC extends nW{constructor(D){super(WW,WW,rj,WW,((D,j,W)=>C.j.TransformCoordinates(D,C.b.RotationAxis(j,W))),kC.ClassName,D)}}kC.ClassName="FGRotate3DBlock",(0,e.c)(kC.ClassName,kC);class MC extends wW{constructor(D){super(QW,QW,(D=>C.b.Transpose(D)),MC.ClassName,D)}}MC.ClassName="FGTransposeBlock",(0,e.c)(MC.ClassName,MC);class OC extends wW{constructor(D){super(QW,rj,(D=>D.determinant()),OC.ClassName,D)}}OC.ClassName="FGDeterminantBlock",(0,e.c)(OC.ClassName,OC);class EC extends wW{constructor(D){super(QW,QW,(D=>C.b.Invert(D)),EC.ClassName,D)}}EC.ClassName="FGInvertMatrixBlock",(0,e.c)(EC.ClassName,EC);class fC extends TW{constructor(D){super(QW,QW,QW,((D,j)=>j.multiply(D)),fC.ClassName,D)}}fC.ClassName="FGMatMulBlock",(0,e.c)(fC.ClassName,fC);class FC extends wW{constructor(D){super(CW,CW,(D=>new dj(~D.value)),FC.ClassName,D)}}FC.ClassName="FGBitwiseNotBlock",(0,e.c)(FC.ClassName,FC);class ZC extends TW{constructor(D){super(CW,CW,CW,((D,j)=>new dj(D.value&j.value)),ZC.ClassName,D)}}ZC.ClassName="FGBitwiseAndBlock",(0,e.c)(ZC.ClassName,ZC);class PC extends TW{constructor(D){super(CW,CW,CW,((D,j)=>new dj(D.value|j.value)),PC.ClassName,D)}}PC.ClassName="FGBitwiseOrBlock",(0,e.c)(PC.ClassName,PC);class XC extends TW{constructor(D){super(CW,CW,CW,((D,j)=>new dj(D.value^j.value)),XC.ClassName,D)}}XC.ClassName="FGBitwiseXorBlock",(0,e.c)(XC.ClassName,XC);class xC extends TW{constructor(D){super(CW,CW,CW,((D,j)=>new dj(D.value<<j.value)),xC.ClassName,D)}}xC.ClassName="FGBitwiseLeftShiftBlock",(0,e.c)(xC.ClassName,xC);class RC extends TW{constructor(D){super(CW,CW,CW,((D,j)=>new dj(D.value>>j.value)),RC.ClassName,D)}}RC.ClassName="FGBitwiseRightShiftBlock",(0,e.c)(RC.ClassName,RC);class VC extends wW{constructor(D){super(CW,CW,(D=>new dj(Math.clz32(D.value))),VC.ClassName,D)}}VC.ClassName="FGCountLeadingZerosBlock",(0,e.c)(VC.ClassName,VC);class UC extends wW{constructor(D){super(CW,CW,(D=>new dj(D.value?31-Math.clz32(D.value&-D.value):32)),UC.ClassName,D)}}UC.ClassName="FGCountTrailingZerosBlock",(0,e.c)(UC.ClassName,UC);class gC extends wW{constructor(D){super(CW,CW,(D=>new dj(function(D){let j=0;for(;D;)j+=1&D,D>>=1;return j}(D.value))),gC.ClassName,D)}}gC.ClassName="FGCountOneBitsBlock",(0,e.c)(gC.ClassName,gC);class NC extends bW{constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{startIndex:new dj(0)};super(D),this.config=D,this.reset=this._registerSignalInput("reset"),this.n=this.registerDataInput("n",CW),this.value=this.registerDataOutput("value",CW)}_execute(D,j){if(j===this.reset)this.value.setValue(this.config.startIndex,D);else{const j=this.value.getValue(D);j.value<this.n.getValue(D).value&&(this.value.setValue(new dj(j.value+1),D),this.out._activateSignal(D))}}getClassName(){return NC.ClassName}}NC.ClassName="FGDoNBlock",(0,e.c)(NC.ClassName,NC);class GC extends FW{constructor(D){super(D),this.config=D,this.output=this.registerDataOutput(D.variableName,Bj)}_updateOutputs(D){const j=this.config.variableName;D.hasVariable(j)&&this.output.setValue(D.getVariable(j),D)}getClassName(){return GC.ClassName}serialize(D){super.serialize(D),D.config.variableName=this.config.variableName}}GC.ClassName="FGGetVariableBlock",(0,e.c)(GC.ClassName,GC);class KC extends bW{constructor(D){super(D),this.config=D,this.input=this.registerDataInput(D.variableName,Bj)}_execute(D){const j=this.config.variableName,W=this.input.getValue(D);D.setVariable(j,W),this.out._activateSignal(D)}getClassName(){return KC.ClassName}}KC.ClassName="FGSetVariableBlock",(0,e.c)(KC.ClassName,KC);class LC extends bW{constructor(D){super(D),this.config=D,this.condition=this.registerDataInput("condition",DW),this.loopBody=this._registerSignalOutput("loopBody")}_execute(D,j){var W;let Q=this.condition.getValue(D);for(null!==(W=this.config)&&void 0!==W&&W.isDo&&!Q&&this.loopBody._activateSignal(D);Q;)this.loopBody._activateSignal(D),Q=this.condition.getValue(D);this.out._activateSignal(D)}getClassName(){return LC.ClassName}serialize(D){var j;super.serialize(D),D.isDo=null===(j=this.config)||void 0===j?void 0:j.isDo}}LC.ClassName="FGWhileLoopBlock",(0,e.c)(LC.ClassName,LC);const eC={"lifecycle/onStart":eW.ClassName,"lifecycle/onTick":sW.ClassName,log:YW.ClassName,"flow/delay":cW.ClassName,"customEvent/send":lW.ClassName,"customEvent/receive":IW.ClassName,"flow/sequence":yW.ClassName,"world/get":SW.ClassName,"world/set":HW.ClassName,"flow/doN":NC.ClassName,"variable/get":GC.ClassName,"variable/set":KC.ClassName,"flow/whileLoop":LC.ClassName,"math/random":rW.ClassName,"math/e":jQ.ClassName,"math/pi":WQ.ClassName,"math/inf":QQ.ClassName,"math/nan":CQ.ClassName,"math/abs":MQ.ClassName,"math/sign":OQ.ClassName,"math/trunc":EQ.ClassName,"math/floor":fQ.ClassName,"math/ceil":FQ.ClassName,"math/fract":ZQ.ClassName,"math/neg":PQ.ClassName,"math/add":hW.ClassName,"math/sub":dW.ClassName,"math/mul":vW.ClassName,"math/div":BW.ClassName,"math/rem":xQ.ClassName,"math/min":RQ.ClassName,"math/max":VQ.ClassName,"math/clamp":NQ.ClassName,"math/saturate":KQ.ClassName,"math/mix":LQ.ClassName,"math/eq":eQ.ClassName,"math/lt":bQ.ClassName,"math/le":YQ.ClassName,"math/gt":tQ.ClassName,"math/ge":cQ.ClassName,"math/isnan":lQ.ClassName,"math/isinf":IQ.ClassName,"math/rad":yQ.ClassName,"math/deg":mQ.ClassName,"math/sin":aQ.ClassName,"math/cos":SQ.ClassName,"math/tan":HQ.ClassName,"math/asin":zQ.ClassName,"math/acos":iQ.ClassName,"math/atan":pQ.ClassName,"math/atan2":TQ.ClassName,"math/sinh":AQ.ClassName,"math/cosh":wQ.ClassName,"math/tanh":nQ.ClassName,"math/asinh":uQ.ClassName,"math/acosh":qQ.ClassName,"math/atanh":oQ.ClassName,"math/exp":JQ.ClassName,"math/log":hQ.ClassName,"math/log2":dQ.ClassName,"math/log10":vQ.ClassName,"math/sqrt":BQ.ClassName,"math/cbrt":rQ.ClassName,"math/pow":DC.ClassName,"math/length":jC.ClassName,"math/normalize":WC.ClassName,"math/dot":DQ.ClassName,"math/cross":QC.ClassName,"math/rotate2d":CC.ClassName,"math/rotate3d":kC.ClassName,"math/transpose":MC.ClassName,"math/determinant":OC.ClassName,"math/inverse":EC.ClassName,"math/matmul":fC.ClassName,"math/not":FC.ClassName,"math/and":ZC.ClassName,"math/or":PC.ClassName,"math/xor":XC.ClassName,"math/asr":RC.ClassName,"math/lsl":xC.ClassName,"math/clz":VC.ClassName,"math/ctz":UC.ClassName,"math/popcnt":gC.ClassName},sC={float2:"Vector2",float3:"Kd",float4:"Vector4",float4x4:"Matrix",int:"FlowGraphInteger"};function bC(D,j,W){if(void 0!==D.type){const Q=j.types&&j.types[D.type];if(!Q)throw new Error(`${W}: Unknown type: ${D.type}`);const C=Q.signature;if(!C)throw new Error(`${W}: Type ${D.type} has no signature`);const k=sC[C];return{value:D.value,className:k}}return D.value}function YC(D,j,W){const Q=eC[j.type];if(!Q)throw new Error(`/extensions/KHR_interactivity/nodes/${D}: Unknown block type: ${j.type}`);const C=D.toString(),k=function(D,j,W){const Q={},C=D.configuration??[];for(const k of C)if("customEvent"===k.id){const D=j.customEvents&&j.customEvents[k.value];if(!D)throw new Error(`/extensions/KHR_interactivity/nodes/${W}: Unknown custom event: ${k.value}`);Q.eventId=D.id,Q.eventData=D.values.map((D=>D.id))}else if("variable"===k.id){const D=j.variables&&j.variables[k.value];if(!D)throw new Error(`/extensions/KHR_interactivity/nodes/${W}: Unknown variable: ${k.value}`);Q.variableName=D.id}else if("path"===k.id){const D=k.value;Q.path=D}else Q[k.id]=bC(k,j,`/extensions/KHR_interactivity/nodes/${W}`);return Q}(j,W,C);return{className:Q,config:k,uniqueId:C,metadata:j.metadata,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[]}}class tC extends ej{constructor(D){super(D,lC)}}const cC={__array__:{__target__:!0,translation:{type:"Kd",get:D=>D._babylonTransformNode.position,set:(D,j)=>{j._babylonTransformNode.position=D},getObject:D=>D._babylonTransformNode}}},lC={nodes:cC},IC="KHR_interactivity";class yC{constructor(D){this._loader=D,this.name=IC,this.enabled=this._loader.isExtensionUsed(IC),this._pathConverter=new tC(this._loader.kj)}dispose(){this._loader=null,delete this._pathConverter}onReady(){var D;if(!this._loader.babylonScene||!this._pathConverter)return;const j=this._loader.babylonScene,W=function(D){const j={uniqueId:(0,Jj.c)(),_userVariables:{},_connectionValues:{}},W=[j],Q=[];for(let k=0;k<D.nodes.length;k++){const j=YC(k,D.nodes[k],D);Q.push(j)}for(let k=0;k<D.nodes.length;k++){const W=D.nodes[k],C=Q[k],M=W.flows??[];for(const D of M){const j=D.id,W={uniqueId:(0,Jj.c)(),name:j,_connectionType:1,connectedPointIds:[]};C.signalOutputs.push(W);const M=D.node,O=D.socket,E=Q[M];if(!E)throw new Error(`/extensions/KHR_interactivity/nodes/${k}: Could not find node with id ${M} that connects its input with with node ${k}'s output ${j}`);let f=E.signalInputs.find((D=>D.name===O));f||(f={uniqueId:(0,Jj.c)(),name:O,_connectionType:0,connectedPointIds:[]},E.signalInputs.push(f)),f.connectedPointIds.push(W.uniqueId),W.connectedPointIds.push(f.uniqueId)}const O=W.values??[];for(const E of O){const W=E.id,M={uniqueId:(0,Jj.c)(),name:W,_connectionType:0,connectedPointIds:[]};if(C.dataInputs.push(M),void 0!==E.value){const W=bC(E,D,`/extensions/KHR_interactivity/nodes/${k}`);j._connectionValues[M.uniqueId]=W}else{if(void 0===E.node||void 0===E.socket)throw new Error(`/extensions/KHR_interactivity/nodes/${k}: Invalid socket ${W} in node ${k}`);{const D=E.node,j=E.socket,C=Q[D];if(!C)throw new Error(`/extensions/KHR_interactivity/nodes/${k}: Could not find node with id ${D} that connects its output with node${k}'s input ${W}`);let O=C.dataOutputs.find((D=>D.name===j));O||(O={uniqueId:(0,Jj.c)(),name:j,_connectionType:1,connectedPointIds:[]},C.dataOutputs.push(O)),M.connectedPointIds.push(O.uniqueId),O.connectedPointIds.push(M.uniqueId)}}}}const C=D.variables??[];for(let k=0;k<C.length;k++){const W=C[k],Q=W.id;j._userVariables[Q]=bC(W,D,`/extensions/KHR_interactivity/variables/${k}`)}return{allBlocks:Q,executionContexts:W}}(null===(D=this._loader.kj.extensions)||void 0===D?void 0:D.KHR_interactivity),Q=new LW({Be:j});KW.Parse(W,{coordinator:Q,pathConverter:this._pathConverter}),Q.start()}}J(IC),o(IC,!0,(D=>new yC(D)));const mC="KHR_node_visibility";class aC{constructor(D){this.name=mC,this._loader=D,this.enabled=D.isExtensionUsed(mC)}async onReady(){var D;null===(D=this._loader.kj.nodes)||void 0===D||D.forEach((D=>{var j,W,Q,C;(null===(j=D._primitiveBabylonMeshes)||void 0===j||j.forEach((D=>{D.inheritVisibility=!0})),null!==(W=D.extensions)&&void 0!==W&&W.KHR_node_visibility)&&(!1===(null===(Q=D.extensions)||void 0===Q?void 0:Q.KHR_node_visibility.visible)&&(D._babylonTransformNode&&(D._babylonTransformNode.isVisible=!1),null===(C=D._primitiveBabylonMeshes)||void 0===C||C.forEach((D=>{D.isVisible=!1}))))}))}dispose(){this._loader=null}}J(mC),o(mC,!0,(D=>new aC(D)));const SC="ExtrasAsMetadata";class HC{_assignExtras(D,j){if(j.extras&&Object.keys(j.extras).length>0){const W=D.metadata=D.metadata||{};(W.kj=W.kj||{}).extras=j.extras}}constructor(D){this.name=SC,this.enabled=!0,this._loader=D}dispose(){this._loader=null}loadNodeAsync(D,j,W){return this._loader.loadNodeAsync(D,j,(D=>{this._assignExtras(D,j),W(D)}))}loadCameraAsync(D,j,W){return this._loader.loadCameraAsync(D,j,(D=>{this._assignExtras(D,j),W(D)}))}createMaterial(D,j,W){const Q=this._loader.createMaterial(D,j,W);return this._assignExtras(Q,j),Q}}J(SC),o(SC,!1,(D=>new HC(D)))},12701:(D,j,W)=>{"use strict";W.d(j,{d:()=>I,e:()=>s,f:()=>e,h:()=>b});var Q=W(961),C=W(1207),k=W(12102),M=W(11994),O=W(12037),E=W(12035),f=W(1083),F=W(991),Z=W(12707),P=W(12716),X=W(12005);class x{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.te=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.ve=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(D){this._environmentTexture=D}getNodes(){let D=[];return D=D.concat(this.meshes),D=D.concat(this.lights),D=D.concat(this.cameras),D=D.concat(this.transformNodes),this.skeletons.forEach((j=>D=D.concat(j.bones))),D}}class R extends x{}class V{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){this.rootNodes.slice(0).forEach((D=>{D.dispose()})),this.rootNodes.length=0,this.skeletons.slice(0).forEach((D=>{D.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((D=>{D.dispose()})),this.animationGroups.length=0}}class U extends x{constructor(D){super(),this._wasAddedToScene=!1,(D=D||F.b.LastCreatedScene)&&(this.Be=D,this.proceduralTextures=[],D.Qd.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=D.getEngine().onContextRestoredObservable.add((()=>{for(const D of this.geometries)D._rebuild();for(const D of this.meshes)D._rebuild();for(const D of this.te)D.rebuild();for(const D of this.textures)D._rebuild()})))}_topologicalSort(D){const j=new Map;for(const M of D)j.set(M.uniqueId,M);const W={dependsOn:new Map,dependedBy:new Map};for(const M of D){const D=M.uniqueId;W.dependsOn.set(D,new Set),W.dependedBy.set(D,new Set)}for(const M of D){const D=M.uniqueId,Q=W.dependsOn.get(D);if(M instanceof Z.e){const C=M.sourceMesh;j.has(C.uniqueId)&&(Q.add(C.uniqueId),W.dependedBy.get(C.uniqueId).add(D))}const C=W.dependedBy.get(D);for(const k of M.getDescendants()){const Q=k.uniqueId;if(j.has(Q)){C.add(Q);W.dependsOn.get(Q).add(D)}}}const Q=[],C=[];for(const M of D){const D=M.uniqueId;0===W.dependsOn.get(D).size&&(C.push(M),j.delete(D))}const k=C;for(;k.length>0;){const D=k.shift();Q.push(D);const C=W.dependedBy.get(D.uniqueId);for(const Q of Array.from(C.values())){const C=W.dependsOn.get(Q);C.delete(D.uniqueId),0===C.size&&j.get(Q)&&(k.push(j.get(Q)),j.delete(Q))}}return j.size>0&&(f.b.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),j.forEach((D=>f.b.Error(D.name)))),Q}_addNodeAndDescendantsToList(D,j,W,Q){if(W&&(!Q||Q(W))&&!j.has(W.uniqueId)){D.push(W),j.add(W.uniqueId);for(const C of W.getDescendants(!0))this._addNodeAndDescendantsToList(D,j,C,Q)}}_isNodeInContainer(D){return D instanceof E.c&&-1!==this.meshes.indexOf(D)||(D instanceof O.c&&-1!==this.transformNodes.indexOf(D)||(D instanceof P.d&&-1!==this.lights.indexOf(D)||D instanceof X.d&&-1!==this.cameras.indexOf(D)))}_isValidHierarchy(){for(const D of this.meshes)if(D.parent&&!this._isNodeInContainer(D.parent))return f.b.Warn(`Node ${D.name} has a parent that is not in the container.`),!1;for(const D of this.transformNodes)if(D.parent&&!this._isNodeInContainer(D.parent))return f.b.Warn(`Node ${D.name} has a parent that is not in the container.`),!1;for(const D of this.lights)if(D.parent&&!this._isNodeInContainer(D.parent))return f.b.Warn(`Node ${D.name} has a parent that is not in the container.`),!1;for(const D of this.cameras)if(D.parent&&!this._isNodeInContainer(D.parent))return f.b.Warn(`Node ${D.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(D){let j=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||C.f.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const Q={},k={},O=new V,E=[],f=[],F={doNotInstantiate:!0,...W},Z=[],P=new Set;for(const C of this.transformNodes)null===C.parent&&this._addNodeAndDescendantsToList(Z,P,C,F.predicate);for(const C of this.meshes)null===C.parent&&this._addNodeAndDescendantsToList(Z,P,C,F.predicate);const X=this._topologicalSort(Z),x=(W,C)=>{if(((j,W)=>{if(Q[j.uniqueId]=W.uniqueId,k[W.uniqueId]=W,D&&(W.name=D(j.name)),W instanceof M.d){const D=W;if(D.morphTargetManager){const W=j.morphTargetManager;D.morphTargetManager=W.clone();for(let j=0;j<W.numTargets;j++){const C=W.getTarget(j),M=D.morphTargetManager.getTarget(j);Q[C.uniqueId]=M.uniqueId,k[M.uniqueId]=M}}}})(W,C),W.parent){const D=Q[W.parent.uniqueId],j=k[D];C.parent=j||W.parent}if(C.position&&W.position&&C.position.p(W.position),C.rotationQuaternion&&W.rotationQuaternion&&C.rotationQuaternion.p(W.rotationQuaternion),C.rotation&&W.rotation&&C.rotation.p(W.rotation),C.Pd&&W.Pd&&C.Pd.p(W.Pd),C.material){const M=C;if(M.material)if(j){const j=W.material;if(-1===f.indexOf(j)){let W=j.clone(D?D(j.name):"Clone of "+j.name);if(f.push(j),Q[j.uniqueId]=W.uniqueId,k[W.uniqueId]=W,"MultiMaterial"===j.getClassName()){const C=j;for(const j of C.Jg)j&&(W=j.clone(D?D(j.name):"Clone of "+j.name),f.push(j),Q[j.uniqueId]=W.uniqueId,k[W.uniqueId]=W);C.Jg=C.Jg.map((D=>D&&k[Q[D.uniqueId]]))}}"InstancedMesh"!==M.getClassName()&&(M.material=k[Q[j.uniqueId]])}else"MultiMaterial"===M.material.getClassName()?-1===this.Be.multiMaterials.indexOf(M.material)&&this.Be.addMultiMaterial(M.material):-1===this.Be.materials.indexOf(M.material)&&this.Be.addMaterial(M.material)}null===C.parent&&O.rootNodes.push(C)};return X.forEach((D=>{if("InstancedMesh"===D.getClassName()){const j=D,W=j.sourceMesh,C=Q[W.uniqueId],M=("number"===typeof C?k[C]:W).yb(j.name);x(j,M)}else{let j=!0;"mb"===D.getClassName()||"Node"===D.getClassName()||D.skeleton||!D.getTotalVertices||0===D.getTotalVertices()?j=!1:F.doNotInstantiate&&(j="function"===typeof F.doNotInstantiate?!F.doNotInstantiate(D):!F.doNotInstantiate);const W=j?D.yb(`instance of ${D.name}`):D.clone(`Clone of ${D.name}`,null,!0);if(!W)throw new Error(`Could not clone or instantiate node on Asset Container ${D.name}`);x(D,W)}})),this.skeletons.forEach((j=>{if(F.predicate&&!F.predicate(j))return;const W=j.clone(D?D(j.name):"Clone of "+j.name);for(const D of this.meshes)if(D.skeleton===j&&!D.isAnInstance){const j=k[Q[D.uniqueId]];if(!j||j.isAnInstance)continue;if(j.skeleton=W,-1!==E.indexOf(W))continue;E.push(W);for(const D of W.bones)D._linkedTransformNode&&(D._linkedTransformNode=k[Q[D._linkedTransformNode.uniqueId]])}O.skeletons.push(W)})),this.animationGroups.forEach((j=>{if(F.predicate&&!F.predicate(j))return;const W=j.clone(D?D(j.name):"Clone of "+j.name,(D=>k[Q[D.uniqueId]]||D));O.animationGroups.push(W)})),O}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||C.f.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.Be.environmentTexture=this.environmentTexture);for(const D of this.Be._serializableComponents)D.addFromContainer(this);this.Be.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const j=[];this.cameras.forEach((W=>{D&&!D(W)||(this.Be.addCamera(W),j.push(W))})),this.lights.forEach((W=>{D&&!D(W)||(this.Be.addLight(W),j.push(W))})),this.meshes.forEach((W=>{D&&!D(W)||(this.Be.Ce(W),j.push(W))})),this.skeletons.forEach((j=>{D&&!D(j)||this.Be.addSkeleton(j)})),this.animations.forEach((j=>{D&&!D(j)||this.Be.addAnimation(j)})),this.animationGroups.forEach((j=>{D&&!D(j)||this.Be.addAnimationGroup(j)})),this.multiMaterials.forEach((j=>{D&&!D(j)||this.Be.addMultiMaterial(j)})),this.materials.forEach((j=>{D&&!D(j)||this.Be.addMaterial(j)})),this.morphTargetManagers.forEach((j=>{D&&!D(j)||this.Be.addMorphTargetManager(j)})),this.geometries.forEach((j=>{D&&!D(j)||this.Be.addGeometry(j)})),this.transformNodes.forEach((W=>{D&&!D(W)||(this.Be.addTransformNode(W),j.push(W))})),this.actionManagers.forEach((j=>{D&&!D(j)||this.Be.addActionManager(j)})),this.textures.forEach((j=>{D&&!D(j)||this.Be.addTexture(j)})),this.reflectionProbes.forEach((j=>{D&&!D(j)||this.Be.addReflectionProbe(j)}));for(const W of j)W.parent&&-1===this.Be.getNodes().indexOf(W.parent)&&(W.setParent?W.setParent(null):W.parent=null)}removeAllFromScene(){this._isValidHierarchy()||C.f.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.Be.environmentTexture&&(this.Be.environmentTexture=null);for(const D of this.Be._serializableComponents)D.removeFromContainer(this)}removeFromScene(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.cameras.forEach((j=>{D&&!D(j)||this.Be.removeCamera(j)})),this.lights.forEach((j=>{D&&!D(j)||this.Be.removeLight(j)})),this.meshes.forEach((j=>{D&&!D(j)||this.Be.De(j,!0)})),this.skeletons.forEach((j=>{D&&!D(j)||this.Be.removeSkeleton(j)})),this.animations.forEach((j=>{D&&!D(j)||this.Be.removeAnimation(j)})),this.animationGroups.forEach((j=>{D&&!D(j)||this.Be.removeAnimationGroup(j)})),this.multiMaterials.forEach((j=>{D&&!D(j)||this.Be.removeMultiMaterial(j)})),this.materials.forEach((j=>{D&&!D(j)||this.Be.removeMaterial(j)})),this.morphTargetManagers.forEach((j=>{D&&!D(j)||this.Be.removeMorphTargetManager(j)})),this.geometries.forEach((j=>{D&&!D(j)||this.Be.removeGeometry(j)})),this.transformNodes.forEach((j=>{D&&!D(j)||this.Be.removeTransformNode(j)})),this.actionManagers.forEach((j=>{D&&!D(j)||this.Be.removeActionManager(j)})),this.textures.forEach((j=>{D&&!D(j)||this.Be.removeTexture(j)})),this.reflectionProbes.forEach((j=>{D&&!D(j)||this.Be.removeReflectionProbe(j)}))}dispose(){this.cameras.slice(0).forEach((D=>{D.dispose()})),this.cameras.length=0,this.lights.slice(0).forEach((D=>{D.dispose()})),this.lights.length=0,this.meshes.slice(0).forEach((D=>{D.dispose()})),this.meshes.length=0,this.skeletons.slice(0).forEach((D=>{D.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((D=>{D.dispose()})),this.animationGroups.length=0,this.multiMaterials.slice(0).forEach((D=>{D.dispose()})),this.multiMaterials.length=0,this.materials.slice(0).forEach((D=>{D.dispose()})),this.materials.length=0,this.geometries.slice(0).forEach((D=>{D.dispose()})),this.geometries.length=0,this.transformNodes.slice(0).forEach((D=>{D.dispose()})),this.transformNodes.length=0,this.actionManagers.slice(0).forEach((D=>{D.dispose()})),this.actionManagers.length=0,this.textures.slice(0).forEach((D=>{D.dispose()})),this.textures.length=0,this.reflectionProbes.slice(0).forEach((D=>{D.dispose()})),this.reflectionProbes.length=0,this.morphTargetManagers.slice(0).forEach((D=>{D.dispose()})),this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const D of this.Be._serializableComponents)D.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.Be.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(D,j,W){if(D&&j)for(const Q of D){let D=!0;if(W)for(const j of W)if(Q===j){D=!1;break}D&&(j.push(Q),Q._parentContainer=this)}}moveAllFromScene(D){this._wasAddedToScene=!1,void 0===D&&(D=new R);for(const j in this)Object.prototype.hasOwnProperty.call(this,j)&&(this[j]=this[j]||("_environmentTexture"===j?null:[]),this._moveAssets(this.Be[j],this[j],D[j]));this.environmentTexture=this.Be.environmentTexture,this.removeAllFromScene()}createRootMesh(){const D=new M.d("assetContainerRootMesh",this.Be);return this.meshes.forEach((j=>{j.parent||D.addChild(j)})),this.meshes.unshift(D),D}mergeAnimationsTo(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F.b.LastCreatedScene,j=arguments.length>1?arguments[1]:void 0,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!D)return f.b.Error("No scene available to merge animations to"),[];const Q=W||(j=>{let W=null;const Q=j.animations.length?j.animations[0].targetProperty:"",C=j.name.split(".").join("").split("_primitive")[0];switch(Q){case"position":case"rotationQuaternion":W=D.getTransformNodeByName(j.name)||D.getTransformNodeByName(C);break;case"influence":W=D.getMorphTargetByName(j.name)||D.getMorphTargetByName(C);break;default:W=D.getNodeByName(j.name)||D.getNodeByName(C)}return W});this.getNodes().forEach((D=>{const j=Q(D);if(null!==j){for(const W of D.animations){const D=j.animations.filter((D=>D.targetProperty===W.targetProperty));for(const W of D){const D=j.animations.indexOf(W,0);D>-1&&j.animations.splice(D,1)}}j.animations=j.animations.concat(D.animations)}}));const C=[];return this.animationGroups.slice().forEach((D=>{C.push(D.clone(D.name,Q)),D.animatables.forEach((D=>{D.stop()}))})),j.forEach((j=>{const W=Q(j.target);W&&(D.beginAnimation(W,j.fromFrame,j.toFrame,j.loopAnimation,j.speedRatio,j.onAnimationEnd?j.onAnimationEnd:void 0,void 0,!0,void 0,j.onAnimationLoop?j.onAnimationLoop:void 0),D.stopAnimation(j.target))})),C}populateRootNodes(){this.rootNodes.length=0,this.meshes.forEach((D=>{D.parent||-1!==this.rootNodes.indexOf(D)||this.rootNodes.push(D)})),this.transformNodes.forEach((D=>{D.parent||-1!==this.rootNodes.indexOf(D)||this.rootNodes.push(D)})),this.lights.forEach((D=>{D.parent||-1!==this.rootNodes.indexOf(D)||this.rootNodes.push(D)})),this.cameras.forEach((D=>{D.parent||-1!==this.rootNodes.indexOf(D)||this.rootNodes.push(D)}))}addAllAssetsToContainer(D){if(!D)return;const j=[],W=new Set;for(j.push(D);j.length>0;){const D=j.pop();if(D instanceof M.d?(D.Ie&&-1===this.geometries.indexOf(D.Ie)&&this.geometries.push(D.Ie),this.meshes.push(D)):D instanceof O.c?this.transformNodes.push(D):D instanceof P.d?this.lights.push(D):D instanceof X.d&&this.cameras.push(D),D instanceof E.c){if(D.material&&-1===this.materials.indexOf(D.material)){this.materials.push(D.material);for(const j of D.material.getActiveTextures())-1===this.textures.indexOf(j)&&this.textures.push(j)}D.skeleton&&-1===this.skeletons.indexOf(D.skeleton)&&this.skeletons.push(D.skeleton),D.morphTargetManager&&-1===this.morphTargetManagers.indexOf(D.morphTargetManager)&&this.morphTargetManagers.push(D.morphTargetManager)}for(const Q of D.getChildren())W.has(Q)||j.push(Q);W.add(D)}this.populateRootNodes()}}var g=W(1053);class N{constructor(D){this.byteOffset=0,this.buffer=D}loadAsync(D){return this.buffer.readAsync(this.byteOffset,D).then((D=>{this._dataView=new DataView(D.buffer,D.byteOffset,D.byteLength),this._dataByteOffset=0}))}readUint32(){const D=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,D}readUint8Array(D){const j=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,D);return this._dataByteOffset+=D,this.byteOffset+=D,j}readString(D){return(0,g.g)(this.readUint8Array(D))}skipBytes(D){this._dataByteOffset+=D,this.byteOffset+=D}}var G=W(12725);const K="Z2xURg",L={name:"kj",extensions:{".gltf":{isBinary:!1},".glb":{isBinary:!0}},canDirectLoad:D=>-1!==D.indexOf("asset")&&-1!==D.indexOf("version")||D.startsWith("data:base64,"+K)||D.startsWith("data:;base64,"+K)||D.startsWith("data:application/octet-stream;base64,"+K)||D.startsWith("data:model/gltf-binary;base64,"+K)};var e,s,b,Y=W(1019),t=W(1044);function c(D,j,W){try{return Promise.resolve(new Uint8Array(D,j,W))}catch(Q){return Promise.reject(Q)}}!function(D){D[D.AUTO=0]="AUTO",D[D.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(e||(e={})),function(D){D[D.NONE=0]="NONE",D[D.FIRST=1]="FIRST",D[D.ALL=2]="ALL"}(s||(s={})),function(D){D[D.LOADING=0]="LOADING",D[D.READY=1]="READY",D[D.COMPLETE=2]="COMPLETE"}(b||(b={}));class l{constructor(){this.coordinateSystemMode=e.AUTO,this.animationStartMode=s.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=D=>Promise.resolve(D),this.extensionOptions={}}p(D){D&&(this.onParsed=D.onParsed,this.coordinateSystemMode=D.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=D.animationStartMode??this.animationStartMode,this.loadNodeAnimations=D.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=D.loadSkins??this.loadSkins,this.loadMorphTargets=D.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=D.compileMaterials??this.compileMaterials,this.useClipPlane=D.useClipPlane??this.useClipPlane,this.compileShadowGenerators=D.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=D.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=D.useRangeRequests??this.useRangeRequests,this.createInstances=D.createInstances??this.createInstances,this.alwaysComputeBoundingBox=D.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=D.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=D.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=D.skipMaterials??this.skipMaterials,this.useSRGBBuffers=D.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=D.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=D.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=D.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=D.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=D.customRootNode,this.onMeshLoaded=D.onMeshLoaded,this.onSkinLoaded=D.onSkinLoaded,this.onTextureLoaded=D.onTextureLoaded,this.onMaterialLoaded=D.onMaterialLoaded,this.onCameraLoaded=D.onCameraLoaded,this.extensionOptions=D.extensionOptions??this.extensionOptions)}}class I extends l{constructor(D){super(),this.onParsedObservable=new Q.d,this.onMeshLoadedObservable=new Q.d,this.onSkinLoadedObservable=new Q.d,this.onTextureLoadedObservable=new Q.d,this.onMaterialLoadedObservable=new Q.d,this.onCameraLoadedObservable=new Q.d,this.onCompleteObservable=new Q.d,this.onErrorObservable=new Q.d,this.Qd=new Q.d,this.onExtensionLoadedObservable=new Q.d,this.validate=!1,this.onValidatedObservable=new Q.d,this._loader=null,this._state=null,this._requests=new Array,this.name=L.name,this.extensions=L.extensions,this.onLoaderStateChangedObservable=new Q.d,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.p(D)}set onParsed(D){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),D&&(this._onParsedObserver=this.onParsedObservable.add(D))}set onMeshLoaded(D){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),D&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(D))}set onSkinLoaded(D){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),D&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((j=>D(j.node,j.skinnedNode))))}set onTextureLoaded(D){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),D&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(D))}set onMaterialLoaded(D){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),D&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(D))}set onCameraLoaded(D){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),D&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(D))}set onComplete(D){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(D)}set onError(D){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(D)}set onDispose(D){this._onDisposeObserver&&this.Qd.remove(this._onDisposeObserver),this._onDisposeObserver=this.Qd.add(D)}set onExtensionLoaded(D){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(D)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(D){this._loggingEnabled!==D&&(this._loggingEnabled=D,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(D){this._capturePerformanceCounters!==D&&(this._capturePerformanceCounters=D,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(D){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(D)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const D of this._requests)D.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=D=>Promise.resolve(D),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.Qd.notifyObservers(void 0),this.Qd.clear()}loadFile(D,j,W,k,M,O,E,F){if(ArrayBuffer.isView(j))return this._loadBinary(D,j,W,k,E,F),null;this._progressCallback=M;const Z=j.name||C.f.GetFilename(j);if(O){if(this.useRangeRequests){this.validate&&f.b.Warn("glTF validation is not supported when range requests are enabled");const W={abort:()=>{},onCompleteObservable:new Q.d},C={readAsync:(W,Q)=>new Promise(((C,k)=>{this._loadFile(D,j,(D=>{C(new Uint8Array(D))}),!0,(D=>{k(D)}),(D=>{D.setRequestHeader("Range",`bytes=${W}-${W+Q-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new N(C)).then((D=>{W.onCompleteObservable.notifyObservers(W),k(D)}),E?D=>E(void 0,D):void 0),W}return this._loadFile(D,j,(j=>{this._validate(D,new Uint8Array(j,0,j.byteLength),W,Z),this._unpackBinaryAsync(new N({readAsync:(D,W)=>c(j,D,W),byteLength:j.byteLength})).then((D=>{k(D)}),E?D=>E(void 0,D):void 0)}),!0,E)}return this._loadFile(D,j,(j=>{try{this._validate(D,j,W,Z),k({json:this._parseJson(j)})}catch{E&&E()}}),!1,E)}_loadBinary(D,j,W,Q,C,k){this._validate(D,new Uint8Array(j.buffer,j.byteOffset,j.byteLength),W,k),this._unpackBinaryAsync(new N({readAsync:(D,W)=>function(D,j,W){try{if(j<0||j>=D.byteLength)throw new RangeError("Offset is out of range.");if(j+W>D.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(D.buffer,D.byteOffset+j,W))}catch(Q){return Promise.reject(Q)}}(j,D,W),byteLength:j.byteLength})).then((D=>{Q(D)}),C?D=>C(void 0,D):void 0)}importMeshAsync(D,j,W,Q,C,k){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(W),this.onParsedObservable.clear(),this._log(`Loading ${k||""}`),this._loader=this._getLoader(W),this._loader.importMeshAsync(D,j,null,W,Q,C,k))))}loadAsync(D,j,W,Q,C){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(j),this.onParsedObservable.clear(),this._log(`Loading ${C||""}`),this._loader=this._getLoader(j),this._loader.loadAsync(D,j,W,Q,C))))}loadAssetContainerAsync(D,j,W,Q,C){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(j),this.onParsedObservable.clear(),this._log(`Loading ${C||""}`),this._loader=this._getLoader(j);const k=new U(D),M=[];this.onMaterialLoadedObservable.add((D=>{M.push(D)}));const O=[];this.onTextureLoadedObservable.add((D=>{O.push(D)}));const E=[];this.onCameraLoadedObservable.add((D=>{E.push(D)}));const f=[];return this.onMeshLoadedObservable.add((D=>{D.morphTargetManager&&f.push(D.morphTargetManager)})),this._loader.importMeshAsync(null,D,k,j,W,Q,C).then((D=>(Array.prototype.push.apply(k.geometries,D.geometries),Array.prototype.push.apply(k.meshes,D.meshes),Array.prototype.push.apply(k.te,D.te),Array.prototype.push.apply(k.skeletons,D.skeletons),Array.prototype.push.apply(k.animationGroups,D.animationGroups),Array.prototype.push.apply(k.materials,M),Array.prototype.push.apply(k.textures,O),Array.prototype.push.apply(k.lights,D.lights),Array.prototype.push.apply(k.transformNodes,D.transformNodes),Array.prototype.push.apply(k.cameras,E),Array.prototype.push.apply(k.morphTargetManagers,f),k)))}))}canDirectLoad(D){return L.canDirectLoad(D)}directLoad(D,j){if(j.startsWith("base64,"+K)||j.startsWith(";base64,"+K)||j.startsWith("application/octet-stream;base64,"+K)||j.startsWith("model/gltf-binary;base64,"+K)){const W=(0,Y.d)(j);return this._validate(D,new Uint8Array(W,0,W.byteLength)),this._unpackBinaryAsync(new N({readAsync:(D,j)=>c(W,D,j),byteLength:W.byteLength}))}return this._validate(D,j),Promise.resolve({json:this._parseJson(j)})}createPlugin(D){return new I(D[L.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((D,j)=>{this.onCompleteObservable.addOnce((()=>{D()})),this.onErrorObservable.addOnce((D=>{j(D)}))}))}_setState(D){this._state!==D&&(this._state=D,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(b[this._state]))}_loadFile(D,j,W,Q,C,k){const M=D._loadFile(j,W,(D=>{this._onProgress(D,M)}),!0,Q,C,k);return M.onCompleteObservable.add((()=>{M._lengthComputable=!0,M._total=M._loaded})),this._requests.push(M),M}_onProgress(D,j){if(!this._progressCallback)return;j._lengthComputable=D.lengthComputable,j._loaded=D.loaded,j._total=D.total;let W=!0,Q=0,C=0;for(const k of this._requests){if(void 0===k._lengthComputable||void 0===k._loaded||void 0===k._total)return;W=W&&k._lengthComputable,Q+=k._loaded,C+=k._total}this._progressCallback({lengthComputable:W,loaded:Q,total:W?C:0})}_validate(D,j){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),G.c.ValidateAsync(j,W,Q,(j=>this.preprocessUrlAsync(W+j).then((j=>D._loadFileAsync(j,void 0,!0,!0).then((D=>new Uint8Array(D,0,D.byteLength))))))).then((D=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(D),this.onValidatedObservable.clear()}),(D=>{this._endPerformanceCounter("Validate JSON"),C.f.Warn(`Failed to validate: ${D.message}`),this.onValidatedObservable.clear()})))}_getLoader(D){const j=D.json.asset||{};this._log(`Asset version: ${j.version}`),j.minVersion&&this._log(`Asset minimum version: ${j.minVersion}`),j.generator&&this._log(`Asset generator: ${j.generator}`);const W=I._parseVersion(j.version);if(!W)throw new Error("Invalid version: "+j.version);if(void 0!==j.minVersion){const D=I._parseVersion(j.minVersion);if(!D)throw new Error("Invalid minimum version: "+j.minVersion);if(I._compareVersion(D,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+j.minVersion)}const Q={1:I._CreateGLTF1Loader,2:I._CreateGLTF2Loader}[W.major];if(!Q)throw new Error("Unsupported version: "+j.version);return Q(this)}_parseJson(D){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${D.length}`);const j=JSON.parse(D);return this._endPerformanceCounter("Parse JSON"),j}_unpackBinaryAsync(D){return this._startPerformanceCounter("Unpack Binary"),D.loadAsync(20).then((()=>{const j=D.readUint32();if(1179937895!==j)throw new t.i("Unexpected magic: "+j,t.e.GLTFLoaderUnexpectedMagicError);const W=D.readUint32();this.loggingEnabled&&this._log(`Binary version: ${W}`);const Q=D.readUint32();let C;switch(this.useRangeRequests||Q===D.buffer.byteLength||f.b.Warn(`Length in header does not match actual data length: ${Q} != ${D.buffer.byteLength}`),W){case 1:C=this._unpackBinaryV1Async(D,Q);break;case 2:C=this._unpackBinaryV2Async(D,Q);break;default:throw new Error("Unsupported version: "+W)}return this._endPerformanceCounter("Unpack Binary"),C}))}_unpackBinaryV1Async(D,j){const W=D.readUint32(),Q=D.readUint32();if(0!==Q)throw new Error(`Unexpected content format: ${Q}`);const C=j-D.byteOffset,k={json:this._parseJson(D.readString(W)),bin:null};if(0!==C){const j=D.byteOffset;k.bin={readAsync:(W,Q)=>D.buffer.readAsync(j+W,Q),byteLength:C}}return Promise.resolve(k)}_unpackBinaryV2Async(D,j){const W=1313821514,Q=5130562,C=D.readUint32();if(D.readUint32()!==W)throw new Error("First chunk format is not JSON");return D.byteOffset+C===j?D.loadAsync(C).then((()=>({json:this._parseJson(D.readString(C)),bin:null}))):D.loadAsync(C+8).then((()=>{const k={json:this._parseJson(D.readString(C)),bin:null},M=()=>{const C=D.readUint32();switch(D.readUint32()){case W:throw new Error("Unexpected JSON chunk");case Q:{const j=D.byteOffset;k.bin={readAsync:(W,Q)=>D.buffer.readAsync(j+W,Q),byteLength:C},D.skipBytes(C);break}default:D.skipBytes(C)}return D.byteOffset!==j?D.loadAsync(8).then(M):Promise.resolve(k)};return M()}))}static _parseVersion(D){if("1.0"===D||"1.0.1"===D)return{major:1,minor:0};const j=(D+"").match(/^(\d+)\.(\d+)/);return j?{major:parseInt(j[1]),minor:parseInt(j[2])}:null}static _compareVersion(D,j){return D.major>j.major?1:D.major<j.major?-1:D.minor>j.minor?1:D.minor<j.minor?-1:0}_logOpen(D){this._log(D),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(D){const j=I._logSpaces.substring(0,2*this._logIndentLevel);f.b.Log(`${j}${D}`)}_logDisabled(D){}_startPerformanceCounterEnabled(D){C.f.StartPerformanceCounter(D)}_startPerformanceCounterDisabled(D){}_endPerformanceCounterEnabled(D){C.f.EndPerformanceCounter(D)}_endPerformanceCounterDisabled(D){}}I.IncrementalLoading=!0,I.HomogeneousCoordinates=!1,I._logSpaces="                                ",(0,k.f)(new I)},12725:(D,j,W)=>{"use strict";W.d(j,{c:()=>M});var Q=W(1207);function C(D,j,W,Q){const C={externalResourceFunction:Q};return W&&(C.uri="file:"===j?W:j+W),ArrayBuffer.isView(D)?GLTFValidator.validateBytes(D,C):GLTFValidator.validateString(D,C)}function k(){const D=[];onmessage=j=>{const W=j.data;switch(W.id){case"init":importScripts(W.url);break;case"validate":C(W.data,W.rootUrl,W.fileName,(j=>new Promise(((W,Q)=>{const C=D.length;D.push({resolve:W,reject:Q}),postMessage({id:"getExternalResource",index:C,uri:j})})))).then((D=>{postMessage({id:"validate.resolve",value:D})}),(D=>{postMessage({id:"validate.reject",reason:D})}));break;case"getExternalResource.resolve":D[W.index].resolve(W.value);break;case"getExternalResource.reject":D[W.index].reject(W.reason)}}}class M{static ValidateAsync(D,j,W,M){return"function"===typeof Worker?new Promise(((O,E)=>{const f=`${C}(${k})()`,F=URL.createObjectURL(new Blob([f],{type:"application/javascript"})),Z=new Worker(F),P=D=>{Z.removeEventListener("error",P),Z.removeEventListener("message",X),E(D)},X=D=>{const j=D.data;switch(j.id){case"getExternalResource":M(j.uri).then((D=>{Z.postMessage({id:"getExternalResource.resolve",index:j.index,value:D},[D.buffer])}),(D=>{Z.postMessage({id:"getExternalResource.reject",index:j.index,reason:D})}));break;case"validate.resolve":Z.removeEventListener("error",P),Z.removeEventListener("message",X),O(j.value),Z.terminate();break;case"validate.reject":Z.removeEventListener("error",P),Z.removeEventListener("message",X),E(j.reason),Z.terminate()}};if(Z.addEventListener("error",P),Z.addEventListener("message",X),Z.postMessage({id:"init",url:Q.f.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(D)){const Q=D.slice();Z.postMessage({id:"validate",data:Q,rootUrl:j,fileName:W},[Q.buffer])}else Z.postMessage({id:"validate",data:D,rootUrl:j,fileName:W})})):(this._LoadScriptPromise||(this._LoadScriptPromise=Q.f.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>C(D,j,W,M))))}}M.Configuration={url:`${Q.f._DefaultCdnUrl}/gltf_validator.js`}},13083:(D,j,W)=>{"use strict";W.d(j,{c:()=>e});var Q=W(942),C=W(948),k=W(1151),M=W(966),O=W(1389),E=W(1396),f=W(1256),F=W(1199),Z=W(981),P=W(1108);W(11577),W(11418),W(11579),W(11322),W(11581),W(11606),W(11614);const X="imageProcessingCompatibility",x="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";P.e.IncludesShadersStore[X]=x;const R="skyPixelShader",V="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";P.e.ShadersStore[R]=V;W(11377),W(11380),W(11479),W(11497),W(11484);const U="skyVertexShader",g="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";P.e.ShadersStore[U]=g;var N=W(1408),G=W(1386),K=W(1382);class L extends O.d{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class e extends E.d{constructor(D,j){super(D,j),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new M.j(0,100,0),this.useSunPosition=!1,this.cameraOffset=M.j.Zero(),this.up=M.j.Up(),this.dithering=!1,this._cameraPosition=M.j.Zero(),this._skyOrientation=new M.d}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(D,j){const W=j._drawWrapper;if(this.isFrozen&&W.effect&&W._wasPreviouslyReady)return!0;j.materialDefines||(j.materialDefines=new L);const Q=j.materialDefines,C=this.va();if(this._isReadyForSubMesh(j))return!0;if((0,K.R)(D,C,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,Q),(0,K.G)(D,Q,!0,!1),Q.IMAGEPROCESSINGPOSTPROCESS!==C.imageProcessingConfiguration.applyByPostProcess&&Q.markAsMiscDirty(),Q.DITHER!==this.dithering&&Q.markAsMiscDirty(),Q.isDirty){Q.markAsProcessed(),C.resetCachedMaterial();const D=new N.d;Q.FOG&&D.addFallback(1,"FOG"),Q.IMAGEPROCESSINGPOSTPROCESS=C.imageProcessingConfiguration.applyByPostProcess,Q.DITHER=this.dithering;const W=[f.f.PositionKind];Q.VERTEXCOLOR&&W.push(f.f.ColorKind);const k="sky",M=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,G.e)(M);const O=Q.toString();j.setEffect(C.getEngine().createEffect(k,W,M,[],O,D,this.onCompiled,this.onError),Q,this._materialContext)}return!(!j.effect||!j.effect.isReady())&&(Q._renderId=C.getRenderId(),W._wasPreviouslyReady=!0,!0)}bindForSubMesh(D,j,W){const Q=this.va(),C=W.materialDefines;if(!C)return;const k=W.effect;if(!k)return;this._activeEffect=k,this.bindOnlyWorldMatrix(D),this._activeEffect.setMatrix("viewProjection",Q.getTransformMatrix()),this._mustRebind(Q,k,W)&&((0,G.h)(k,this,Q),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,K.l)(C,k,Q)),Q.fogEnabled&&j.applyFog&&Q.fogMode!==F.b.FOGMODE_NONE&&this._activeEffect.setMatrix("view",Q.getViewMatrix()),(0,K.f)(Q,j,this._activeEffect);const O=Q.activeCamera;if(O){const D=O.getWorldMatrix();this._cameraPosition.x=D.m[12],this._cameraPosition.y=D.m[13],this._cameraPosition.z=D.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const D=Math.PI*(this.inclination-.5),j=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(j)*Math.cos(D),this.sunPosition.y=this.distance*Math.sin(-D),this.sunPosition.z=this.distance*Math.sin(j)*Math.cos(D),M.d.FromUnitVectorsToRef(M.j.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(j,this._activeEffect,W)}getAnimatables(){return[]}dispose(D){super.dispose(D)}clone(D){return k.d.Clone((()=>new e(D,this.va())),this)}serialize(){const D=super.serialize();return D.customType="BABYLON.SkyMaterial",D}getClassName(){return"SkyMaterial"}static Parse(D,j,W){return k.d.Parse((()=>new e(D.name,j)),D,j,W)}}(0,Q.b)([(0,C.O)()],e.prototype,"luminance",void 0),(0,Q.b)([(0,C.O)()],e.prototype,"turbidity",void 0),(0,Q.b)([(0,C.O)()],e.prototype,"rayleigh",void 0),(0,Q.b)([(0,C.O)()],e.prototype,"mieCoefficient",void 0),(0,Q.b)([(0,C.O)()],e.prototype,"mieDirectionalG",void 0),(0,Q.b)([(0,C.O)()],e.prototype,"distance",void 0),(0,Q.b)([(0,C.O)()],e.prototype,"inclination",void 0),(0,Q.b)([(0,C.O)()],e.prototype,"azimuth",void 0),(0,Q.b)([(0,C.L)()],e.prototype,"sunPosition",void 0),(0,Q.b)([(0,C.O)()],e.prototype,"useSunPosition",void 0),(0,Q.b)([(0,C.L)()],e.prototype,"cameraOffset",void 0),(0,Q.b)([(0,C.L)()],e.prototype,"up",void 0),(0,Q.b)([(0,C.O)()],e.prototype,"dithering",void 0),(0,Z.c)("BABYLON.SkyMaterial",e)},11725:(D,j,W)=>{"use strict";function Q(D,j){j.headers=D.headers||{},j.statusMessage=D.statusText,j.statusCode=D.status,j.data=D.response}function C(D,j,W){return new Promise((function(C,k){W=W||{};var M,O,E,f=new XMLHttpRequest,F=W.body,Z=W.headers||{};for(M in W.timeout&&(f.timeout=W.timeout),f.ontimeout=f.onerror=function(D){D.timeout="timeout"==D.type,k(D)},f.open(D,j.href||j),f.onload=function(){for(E=f.getAllResponseHeaders().trim().split(/[\r\n]+/),Q(f,f);O=E.shift();)O=O.split(": "),f.headers[O.shift().toLowerCase()]=O.join(": ");if((O=f.headers["content-type"])&&~O.indexOf("application/json"))try{f.data=JSON.parse(f.data,W.reviver)}catch(D){return Q(f,D),k(D)}(f.status>=400?k:C)(f)},typeof FormData<"u"&&F instanceof FormData||F&&"object"==typeof F&&(Z["content-type"]="application/json",F=JSON.stringify(F)),f.withCredentials=!!W.withCredentials,Z)f.setRequestHeader(M,Z[M]);f.send(F)}))}W.r(j),W.d(j,{del:()=>E,get:()=>k,patch:()=>O,post:()=>M,put:()=>f,send:()=>C});var k=C.bind(C,"GET"),M=C.bind(C,"POST"),O=C.bind(C,"PATCH"),E=C.bind(C,"DELETE"),f=C.bind(C,"PUT")},13207:(D,j,W)=>{"use strict";W.d(j,{b:()=>Z});const Q=.5*(Math.sqrt(3)-1),C=(3-Math.sqrt(3))/6,k=1/3,M=1/6,O=(Math.sqrt(5)-1)/4,E=(5-Math.sqrt(5))/20,f=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),F=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const Z=class{constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const j="function"==typeof D?D:function(D){let j=0,W=0,Q=0,C=1;const k=function(){let D=4022871197;return function(j){j=j.toString();for(let W=0;W<j.length;W++){D+=j.charCodeAt(W);let Q=.02519603282416938*D;D=Q>>>0,Q-=D,Q*=D,D=Q>>>0,Q-=D,D+=4294967296*Q}return 2.3283064365386963e-10*(D>>>0)}}();j=k(" "),W=k(" "),Q=k(" "),j-=k(D),j<0&&(j+=1);W-=k(D),W<0&&(W+=1);Q-=k(D),Q<0&&(Q+=1);return function(){const D=2091639*j+2.3283064365386963e-10*C;return j=W,W=Q,Q=D-(C=0|D)}}(D);this.p=function(D){const j=new Uint8Array(256);for(let W=0;W<256;W++)j[W]=W;for(let W=0;W<255;W++){const Q=W+~~(D()*(256-W)),C=j[W];j[W]=j[Q],j[Q]=C}return j}(j),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let W=0;W<512;W++)this.perm[W]=this.p[255&W],this.permMod12[W]=this.perm[W]%12}noise2D(D,j){const W=this.permMod12,k=this.perm;let M=0,O=0,E=0;const F=(D+j)*Q,Z=Math.floor(D+F),P=Math.floor(j+F),X=(Z+P)*C,x=D-(Z-X),R=j-(P-X);let V,U;x>R?(V=1,U=0):(V=0,U=1);const g=x-V+C,N=R-U+C,G=x-1+2*C,K=R-1+2*C,L=255&Z,e=255&P;let s=.5-x*x-R*R;if(s>=0){const D=3*W[L+k[e]];s*=s,M=s*s*(f[D]*x+f[D+1]*R)}let b=.5-g*g-N*N;if(b>=0){const D=3*W[L+V+k[e+U]];b*=b,O=b*b*(f[D]*g+f[D+1]*N)}let Y=.5-G*G-K*K;if(Y>=0){const D=3*W[L+1+k[e+1]];Y*=Y,E=Y*Y*(f[D]*G+f[D+1]*K)}return 70*(M+O+E)}noise3D(D,j,W){const Q=this.permMod12,C=this.perm;let O,E,F,Z;const P=(D+j+W)*k,X=Math.floor(D+P),x=Math.floor(j+P),R=Math.floor(W+P),V=(X+x+R)*M,U=D-(X-V),g=j-(x-V),N=W-(R-V);let G,K,L,e,s,b;U>=g?g>=N?(G=1,K=0,L=0,e=1,s=1,b=0):U>=N?(G=1,K=0,L=0,e=1,s=0,b=1):(G=0,K=0,L=1,e=1,s=0,b=1):g<N?(G=0,K=0,L=1,e=0,s=1,b=1):U<N?(G=0,K=1,L=0,e=0,s=1,b=1):(G=0,K=1,L=0,e=1,s=1,b=0);const Y=U-G+M,t=g-K+M,c=N-L+M,l=U-e+2*M,I=g-s+2*M,y=N-b+2*M,m=U-1+.5,a=g-1+.5,S=N-1+.5,H=255&X,z=255&x,i=255&R;let p=.6-U*U-g*g-N*N;if(p<0)O=0;else{const D=3*Q[H+C[z+C[i]]];p*=p,O=p*p*(f[D]*U+f[D+1]*g+f[D+2]*N)}let T=.6-Y*Y-t*t-c*c;if(T<0)E=0;else{const D=3*Q[H+G+C[z+K+C[i+L]]];T*=T,E=T*T*(f[D]*Y+f[D+1]*t+f[D+2]*c)}let A=.6-l*l-I*I-y*y;if(A<0)F=0;else{const D=3*Q[H+e+C[z+s+C[i+b]]];A*=A,F=A*A*(f[D]*l+f[D+1]*I+f[D+2]*y)}let w=.6-m*m-a*a-S*S;if(w<0)Z=0;else{const D=3*Q[H+1+C[z+1+C[i+1]]];w*=w,Z=w*w*(f[D]*m+f[D+1]*a+f[D+2]*S)}return 32*(O+E+F+Z)}noise4D(D,j,W,Q){const C=this.perm;let k,M,f,Z,P;const X=(D+j+W+Q)*O,x=Math.floor(D+X),R=Math.floor(j+X),V=Math.floor(W+X),U=Math.floor(Q+X),g=(x+R+V+U)*E,N=D-(x-g),G=j-(R-g),K=W-(V-g),L=Q-(U-g);let e=0,s=0,b=0,Y=0;N>G?e++:s++,N>K?e++:b++,N>L?e++:Y++,G>K?s++:b++,G>L?s++:Y++,K>L?b++:Y++;const t=e>=3?1:0,c=s>=3?1:0,l=b>=3?1:0,I=Y>=3?1:0,y=e>=2?1:0,m=s>=2?1:0,a=b>=2?1:0,S=Y>=2?1:0,H=e>=1?1:0,z=s>=1?1:0,i=b>=1?1:0,p=Y>=1?1:0,T=N-t+E,A=G-c+E,w=K-l+E,n=L-I+E,u=N-y+2*E,q=G-m+2*E,o=K-a+2*E,J=L-S+2*E,h=N-H+3*E,d=G-z+3*E,v=K-i+3*E,B=L-p+3*E,r=N-1+4*E,DD=G-1+4*E,jD=K-1+4*E,WD=L-1+4*E,QD=255&x,CD=255&R,kD=255&V,MD=255&U;let OD=.6-N*N-G*G-K*K-L*L;if(OD<0)k=0;else{const D=C[QD+C[CD+C[kD+C[MD]]]]%32*4;OD*=OD,k=OD*OD*(F[D]*N+F[D+1]*G+F[D+2]*K+F[D+3]*L)}let ED=.6-T*T-A*A-w*w-n*n;if(ED<0)M=0;else{const D=C[QD+t+C[CD+c+C[kD+l+C[MD+I]]]]%32*4;ED*=ED,M=ED*ED*(F[D]*T+F[D+1]*A+F[D+2]*w+F[D+3]*n)}let fD=.6-u*u-q*q-o*o-J*J;if(fD<0)f=0;else{const D=C[QD+y+C[CD+m+C[kD+a+C[MD+S]]]]%32*4;fD*=fD,f=fD*fD*(F[D]*u+F[D+1]*q+F[D+2]*o+F[D+3]*J)}let FD=.6-h*h-d*d-v*v-B*B;if(FD<0)Z=0;else{const D=C[QD+H+C[CD+z+C[kD+i+C[MD+p]]]]%32*4;FD*=FD,Z=FD*FD*(F[D]*h+F[D+1]*d+F[D+2]*v+F[D+3]*B)}let ZD=.6-r*r-DD*DD-jD*jD-WD*WD;if(ZD<0)P=0;else{const D=C[QD+1+C[CD+1+C[kD+1+C[MD+1]]]]%32*4;ZD*=ZD,P=ZD*ZD*(F[D]*r+F[D+1]*DD+F[D+2]*jD+F[D+3]*WD)}return 27*(k+M+f+Z+P)}}}}]);