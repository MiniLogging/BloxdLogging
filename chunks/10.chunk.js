/*! For license information please see dz0gws.10.9b2912b5.chunk.js.LICENSE.txt */
(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[10],{12034:(q,X,Q)=>{"use strict";var y=Q(12037),x=Q(12041),u=Q(12043);Q.g.__TYPEDARRAY_POOL||(Q.g.__TYPEDARRAY_POOL={UINT8:x([32,0]),UINT16:x([32,0]),UINT32:x([32,0]),INT8:x([32,0]),INT16:x([32,0]),INT32:x([32,0]),FLOAT:x([32,0]),DOUBLE:x([32,0]),DATA:x([32,0]),UINT8C:x([32,0]),BUFFER:x([32,0])});var H="undefined"!==typeof Uint8ClampedArray,b=Q.g.__TYPEDARRAY_POOL;b.UINT8C||(b.UINT8C=x([32,0])),b.BUFFER||(b.BUFFER=x([32,0]));var D=b.DATA,a=b.BUFFER;function R(q){if(q){var X=q.length||q.byteLength,Q=y.log2(X);D[Q].push(q)}}function L(q){q=y.nextPow2(q);var X=y.log2(q),Q=D[X];return Q.length>0?Q.pop():new ArrayBuffer(q)}function f(q){return new Uint8Array(L(q),0,q)}function k(q){return new Uint16Array(L(2*q),0,q)}function j(q){return new Uint32Array(L(4*q),0,q)}function I(q){return new Int8Array(L(q),0,q)}function d(q){return new Int16Array(L(2*q),0,q)}function e(q){return new Int32Array(L(4*q),0,q)}function i(q){return new Float32Array(L(4*q),0,q)}function A(q){return new Float64Array(L(8*q),0,q)}function B(q){return H?new Uint8ClampedArray(L(q),0,q):f(q)}function w(q){return new DataView(L(q),0,q)}X.free=function(q){if(u(q))a[y.log2(q.length)].push(q);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(q)&&(q=q.buffer),!q)return;var X=q.length||q.byteLength,Q=0|y.log2(X);D[Q].push(q)}},X.freeUint8=X.freeUint16=X.freeUint32=X.freeInt8=X.freeInt16=X.freeInt32=X.freeFloat32=X.freeFloat=X.freeFloat64=X.freeDouble=X.freeUint8Clamped=X.freeDataView=function(q){R(q.buffer)},X.freeArrayBuffer=R,X.freeBuffer=function(q){a[y.log2(q.length)].push(q)},X.malloc=function(q,X){if(void 0===X||"arraybuffer"===X)return L(q);switch(X){case"uint8":return f(q);case"uint16":return k(q);case"uint32":return j(q);case"int8":return I(q);case"int16":return d(q);case"int32":return e(q);case"float":case"float32":return i(q);case"double":case"float64":return A(q);case"uint8_clamped":return B(q);case"buffer":throw"Buffer not supported";case"data":case"dataview":return w(q);default:return null}return null},X.mallocArrayBuffer=L,X.mallocUint8=f,X.mallocUint16=k,X.mallocUint32=j,X.mallocInt8=I,X.mallocInt16=d,X.mallocInt32=e,X.mallocFloat32=X.mallocFloat=i,X.mallocFloat64=X.mallocDouble=A,X.mallocUint8Clamped=B,X.mallocDataView=w,X.clearCache=function(){for(var q=0;q<32;++q)b.UINT8[q].length=0,b.UINT16[q].length=0,b.UINT32[q].length=0,b.INT8[q].length=0,b.INT16[q].length=0,b.INT32[q].length=0,b.FLOAT[q].length=0,b.DOUBLE[q].length=0,b.UINT8C[q].length=0,D[q].length=0,a[q].length=0}},12120:(q,X,Q)=>{q.exports=x;var y=Q(11590);function x(q,X){if(!(this instanceof x))return new x(q,X);var Q=y.create();y.add(Q,q,X),this.Hd=y.min(y.create(),q,Q),this.ph=y.clone(X),this.max=y.max(y.create(),q,Q),this.mag=y.length(this.ph)}var u=x.prototype;u.width=function(){return this.ph[0]},u.height=function(){return this.ph[1]},u.depth=function(){return this.ph[2]},u.x0=function(){return this.Hd[0]},u.y0=function(){return this.Hd[1]},u.z0=function(){return this.Hd[2]},u.x1=function(){return this.max[0]},u.y1=function(){return this.max[1]},u.z1=function(){return this.max[2]},u.translate=function(q){return y.add(this.max,this.max,q),y.add(this.Hd,this.Hd,q),this},u.setPosition=function(q){return y.add(this.max,q,this.ph),y.j(this.Hd,q),this},u.expand=function(q){var X=y.create(),Q=y.create();return y.max(X,q.max,this.max),y.min(Q,q.Hd,this.Hd),y.Sc(X,X,Q),new x(Q,X)},u.intersects=function(q){return!(q.Hd[0]>this.max[0])&&(!(q.Hd[1]>this.max[1])&&(!(q.Hd[2]>this.max[2])&&(!(q.max[0]<this.Hd[0])&&(!(q.max[1]<this.Hd[1])&&!(q.max[2]<this.Hd[2])))))},u.touches=function(q){var X=this.union(q);return null!==X&&(0==X.width()||0==X.height()||0==X.depth())},u.union=function(q){if(!this.intersects(q))return null;var X=Math.max(q.Hd[0],this.Hd[0]),Q=Math.max(q.Hd[1],this.Hd[1]),y=Math.max(q.Hd[2],this.Hd[2]);return new x([X,Q,y],[Math.min(q.max[0],this.max[0])-X,Math.min(q.max[1],this.max[1])-Q,Math.min(q.max[2],this.max[2])-y])}},12037:(q,X)=>{"use strict";function Q(q){var X=32;return(q&=-q)&&X--,65535&q&&(X-=16),16711935&q&&(X-=8),252645135&q&&(X-=4),858993459&q&&(X-=2),1431655765&q&&(X-=1),X}X.INT_BITS=32,X.INT_MAX=2147483647,X.INT_MIN=-1<<31,X.sign=function(q){return(q>0)-(q<0)},X.abs=function(q){var X=q>>31;return(q^X)-X},X.min=function(q,X){return X^(q^X)&-(q<X)},X.max=function(q,X){return q^(q^X)&-(q<X)},X.isPow2=function(q){return!(q&q-1)&&!!q},X.log2=function(q){var X,Q;return X=(q>65535)<<4,X|=Q=((q>>>=X)>255)<<3,X|=Q=((q>>>=Q)>15)<<2,(X|=Q=((q>>>=Q)>3)<<1)|(q>>>=Q)>>1},X.log10=function(q){return q>=1e9?9:q>=1e8?8:q>=1e7?7:q>=1e6?6:q>=1e5?5:q>=1e4?4:q>=1e3?3:q>=100?2:q>=10?1:0},X.popCount=function(q){return 16843009*((q=(858993459&(q-=q>>>1&1431655765))+(q>>>2&858993459))+(q>>>4)&252645135)>>>24},X.countTrailingZeros=Q,X.nextPow2=function(q){return q+=0===q,--q,q|=q>>>1,q|=q>>>2,q|=q>>>4,q|=q>>>8,(q|=q>>>16)+1},X.prevPow2=function(q){return q|=q>>>1,q|=q>>>2,q|=q>>>4,q|=q>>>8,(q|=q>>>16)-(q>>>1)},X.parity=function(q){return q^=q>>>16,q^=q>>>8,q^=q>>>4,27030>>>(q&=15)&1};var y=new Array(256);!function(q){for(var X=0;X<256;++X){var Q=X,y=X,x=7;for(Q>>>=1;Q;Q>>>=1)y<<=1,y|=1&Q,--x;q[X]=y<<x&255}}(y),X.reverse=function(q){return y[255&q]<<24|y[q>>>8&255]<<16|y[q>>>16&255]<<8|y[q>>>24&255]},X.interleave2=function(q,X){return(q=1431655765&((q=858993459&((q=252645135&((q=16711935&((q&=65535)|q<<8))|q<<4))|q<<2))|q<<1))|(X=1431655765&((X=858993459&((X=252645135&((X=16711935&((X&=65535)|X<<8))|X<<4))|X<<2))|X<<1))<<1},X.deinterleave2=function(q,X){return(q=65535&((q=16711935&((q=252645135&((q=858993459&((q=q>>>X&1431655765)|q>>>1))|q>>>2))|q>>>4))|q>>>16))<<16>>16},X.interleave3=function(q,X,Q){return q=1227133513&((q=3272356035&((q=251719695&((q=4278190335&((q&=1023)|q<<16))|q<<8))|q<<4))|q<<2),(q|=(X=1227133513&((X=3272356035&((X=251719695&((X=4278190335&((X&=1023)|X<<16))|X<<8))|X<<4))|X<<2))<<1)|(Q=1227133513&((Q=3272356035&((Q=251719695&((Q=4278190335&((Q&=1023)|Q<<16))|Q<<8))|Q<<4))|Q<<2))<<2},X.deinterleave3=function(q,X){return(q=1023&((q=4278190335&((q=251719695&((q=3272356035&((q=q>>>X&1227133513)|q>>>2))|q>>>4))|q>>>8))|q>>>16))<<22>>22},X.nextCombination=function(q){var X=q|q-1;return X+1|(~X&-~X)-1>>>Q(q)+1}},12030:(q,X,Q)=>{"use strict";q.exports=function(q,X,Q){switch(arguments.length){case 1:return y=[],a(x=q,x,R,!0),y;case 2:return"function"===typeof X?a(q,q,X,!0):function(q,X){return y=[],a(q,X,R,!1),y}(q,X);case 3:return a(q,X,Q,!1);default:throw new Error("box-intersect: Invalid arguments")}var x};var y,x=Q(12034),u=Q(12051),H=Q(12060);function b(q,X){for(var Q=0;Q<q;++Q)if(!(X[Q]<=X[Q+q]))return!0;return!1}function D(q,X,Q,y){for(var x=0,u=0,H=0,D=q.length;H<D;++H){var a=q[H];if(!b(X,a)){for(var R=0;R<2*X;++R)Q[x++]=a[R];y[u++]=H}}return u}function a(q,X,Q,y){var b=q.length,a=X.length;if(!(b<=0||a<=0)){var R=q[0].length>>>1;if(!(R<=0)){var L,f=x.mallocDouble(2*R*b),k=x.mallocInt32(b);if((b=D(q,R,f,k))>0){if(1===R&&y)u.init(b),L=u.sweepComplete(R,Q,0,b,f,k,0,b,f,k);else{var j=x.mallocDouble(2*R*a),I=x.mallocInt32(a);(a=D(X,R,j,I))>0&&(u.init(b+a),L=1===R?u.sweepBipartite(R,Q,0,b,f,k,0,a,j,I):H(R,Q,y,b,f,k,a,j,I),x.free(j),x.free(I))}x.free(f),x.free(k)}return L}}}function R(q,X){y.push([q,X])}},12068:(q,X)=>{"use strict";var Q="d",y="ax",x="fp",u="es",H="rs",b="re",D="rb",a="bs",R="be",L="bb",f=[Q,y,"vv",H,b,D,"ri",a,R,L,"bi"];function k(q){var X="bruteForce"+(q?"Full":"Partial"),y=[],H=f.slice();q||H.splice(3,0,x);var b=["function "+X+"("+H.join()+"){"];function D(X,x){var H=function(q,X,y){var x="bruteForce"+(q?"Red":"Blue")+(X?"Flip":"")+(y?"Full":""),H=["function ",x,"(",f.join(),"){","var ",u,"=2*",Q,";"],b="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",D="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(y?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return q?H.push(b,"Q",":",D):H.push(D,"Q",":",b),y?H.push("if(y1<x0||x1<y0)continue;"):X?H.push("if(y0<=x0||x1<y0)continue;"):H.push("if(y0<x0||x1<y0)continue;"),H.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),X?H.push("yi,xi"):H.push("xi,yi"),H.push(");if(rv!==void 0)return rv;}}}"),{name:x,code:H.join("")}}(X,x,q);y.push(H.code),b.push("return "+H.name+"("+f.join()+");")}b.push("if(re-rs>be-bs){"),q?(D(!0,!1),b.push("}else{"),D(!1,!1)):(b.push("if(fp){"),D(!0,!0),b.push("}else{"),D(!0,!1),b.push("}}else{if(fp){"),D(!1,!0),b.push("}else{"),D(!1,!1),b.push("}")),b.push("}}return "+X);var a=y.join("")+b.join("");return new Function(a)()}X.partial=k(!1),X.full=k(!0)},12060:(q,X,Q)=>{"use strict";q.exports=function(q,X,Q,u,R,O,g,P,F){!function(q,X){var Q=8*x.log2(X+1)*(q+1)|0,u=x.nextPow2(B*Q);V.length<u&&(y.free(V),V=y.mallocInt32(u));var H=x.nextPow2(w*Q);W.length<H&&(y.free(W),W=y.mallocDouble(H))}(q,u+g);var l,m=0,M=2*q;v(m++,0,0,u,0,g,Q?16:0,-1/0,1/0),Q||v(m++,0,0,g,0,u,1,-1/0,1/0);for(;m>0;){var o=(m-=1)*B,Y=V[o],N=V[o+1],S=V[o+2],c=V[o+3],p=V[o+4],t=V[o+5],z=m*w,K=W[z],h=W[z+1],G=1&t,C=!!(16&t),E=R,J=O,n=P,r=F;if(G&&(E=P,J=F,n=R,r=O),!(2&t&&N>=(S=d(q,Y,N,S,E,J,h)))&&!(4&t&&(N=e(q,Y,N,S,E,J,K))>=S)){var s=S-N,T=p-c;if(C){if(q*s*(s+T)<k){if(void 0!==(l=D.scanComplete(q,Y,X,N,S,E,J,c,p,n,r)))return l;continue}}else{if(q*Math.min(s,T)<L){if(void 0!==(l=H(q,Y,X,G,N,S,E,J,c,p,n,r)))return l;continue}if(q*s*T<f){if(void 0!==(l=D.scanBipartite(q,Y,X,G,N,S,E,J,c,p,n,r)))return l;continue}}var qq=j(q,Y,N,S,E,J,K,h);if(N<qq)if(q*(qq-N)<L){if(void 0!==(l=b(q,Y+1,X,N,qq,E,J,c,p,n,r)))return l}else if(Y===q-2){if(void 0!==(l=G?D.sweepBipartite(q,X,c,p,n,r,N,qq,E,J):D.sweepBipartite(q,X,N,qq,E,J,c,p,n,r)))return l}else v(m++,Y+1,N,qq,c,p,G,-1/0,1/0),v(m++,Y+1,c,p,N,qq,1^G,-1/0,1/0);if(qq<S){var Xq=a(q,Y,c,p,n,r),Qq=n[M*Xq+Y],yq=I(q,Y,Xq,p,n,r,Qq);if(yq<p&&v(m++,Y,qq,S,yq,p,(4|G)+(C?16:0),Qq,h),c<Xq&&v(m++,Y,qq,S,c,Xq,(2|G)+(C?16:0),K,Qq),Xq+1===yq){if(void 0!==(l=C?U(q,Y,X,qq,S,E,J,Xq,n,r[Xq]):Z(q,Y,X,G,qq,S,E,J,Xq,n,r[Xq])))return l}else if(Xq<yq){var xq;if(C){if(qq<(xq=i(q,Y,qq,S,E,J,Qq))){var uq=I(q,Y,qq,xq,E,J,Qq);if(Y===q-2){if(qq<uq&&void 0!==(l=D.sweepComplete(q,X,qq,uq,E,J,Xq,yq,n,r)))return l;if(uq<xq&&void 0!==(l=D.sweepBipartite(q,X,uq,xq,E,J,Xq,yq,n,r)))return l}else qq<uq&&v(m++,Y+1,qq,uq,Xq,yq,16,-1/0,1/0),uq<xq&&(v(m++,Y+1,uq,xq,Xq,yq,0,-1/0,1/0),v(m++,Y+1,Xq,yq,uq,xq,1,-1/0,1/0))}}else qq<(xq=G?A(q,Y,qq,S,E,J,Qq):i(q,Y,qq,S,E,J,Qq))&&(Y===q-2?l=G?D.sweepBipartite(q,X,Xq,yq,n,r,qq,xq,E,J):D.sweepBipartite(q,X,qq,xq,E,J,Xq,yq,n,r):(v(m++,Y+1,qq,xq,Xq,yq,G,-1/0,1/0),v(m++,Y+1,Xq,yq,qq,xq,1^G,-1/0,1/0)))}}}}};var y=Q(12034),x=Q(12037),u=Q(12068),H=u.partial,b=u.full,D=Q(12051),a=Q(12075),R=Q(12079),L=128,f=1<<22,k=1<<22,j=R("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),I=R("lo===p0",["p0"]),d=R("lo<p0",["p0"]),e=R("hi<=p0",["p0"]),i=R("lo<=p0&&p0<=hi",["p0"]),A=R("lo<p0&&p0<=hi",["p0"]),B=6,w=2,V=y.mallocInt32(1024),W=y.mallocDouble(1024);function v(q,X,Q,y,x,u,H,b,D){var a=B*q;V[a]=X,V[a+1]=Q,V[a+2]=y,V[a+3]=x,V[a+4]=u,V[a+5]=H;var R=w*q;W[R]=b,W[R+1]=D}function Z(q,X,Q,y,x,u,H,b,D,a,R){var L=2*q,f=D*L,k=a[f+X];q:for(var j=x,I=x*L;j<u;++j,I+=L){var d=H[I+X],e=H[I+X+q];if(!(k<d||e<k)&&(!y||k!==d)){for(var i,A=b[j],B=X+1;B<q;++B){d=H[I+B],e=H[I+B+q];var w=a[f+B],V=a[f+B+q];if(e<w||V<d)continue q}if(void 0!==(i=y?Q(R,A):Q(A,R)))return i}}}function U(q,X,Q,y,x,u,H,b,D,a){var R=2*q,L=b*R,f=D[L+X];q:for(var k=y,j=y*R;k<x;++k,j+=R){var I=H[k];if(I!==a){var d=u[j+X],e=u[j+X+q];if(!(f<d||e<f)){for(var i=X+1;i<q;++i){d=u[j+i],e=u[j+i+q];var A=D[L+i],B=D[L+i+q];if(e<A||B<d)continue q}var w=Q(I,a);if(void 0!==w)return w}}}}},12075:(q,X,Q)=>{"use strict";q.exports=function(q,X,Q,H,b,D){if(H<=Q+1)return Q;var a=Q,R=H,L=H+Q>>>1,f=2*q,k=L,j=b[f*L+X];for(;a<R;){if(R-a<x){u(q,X,a,R,b,D),j=b[f*L+X];break}var I=R-a,d=Math.random()*I+a|0,e=b[f*d+X],i=Math.random()*I+a|0,A=b[f*i+X],B=Math.random()*I+a|0,w=b[f*B+X];e<=A?w>=A?(k=i,j=A):e>=w?(k=d,j=e):(k=B,j=w):A>=w?(k=i,j=A):w>=e?(k=d,j=e):(k=B,j=w);for(var V=f*(R-1),W=f*k,v=0;v<f;++v,++V,++W){var Z=b[V];b[V]=b[W],b[W]=Z}var U=D[R-1];D[R-1]=D[k],D[k]=U;for(V=f*(R-1),W=f*(k=y(q,X,a,R-1,b,D,j)),v=0;v<f;++v,++V,++W){Z=b[V];b[V]=b[W],b[W]=Z}U=D[R-1];if(D[R-1]=D[k],D[k]=U,L<k){for(R=k-1;a<R&&b[f*(R-1)+X]===j;)R-=1;R+=1}else{if(!(k<L))break;for(a=k+1;a<R&&b[f*a+X]===j;)a+=1}}return y(q,X,Q,L,b,D,b[f*L+X])};var y=Q(12079)("lo<p0",["p0"]),x=8;function u(q,X,Q,y,x,u){for(var H=2*q,b=H*(Q+1)+X,D=Q+1;D<y;++D,b+=H)for(var a=x[b],R=D,L=H*(D-1);R>Q&&x[L+X]>a;--R,L-=H){for(var f=L,k=L+H,j=0;j<H;++j,++f,++k){var I=x[f];x[f]=x[k],x[k]=I}var d=u[R];u[R]=u[R-1],u[R-1]=d}}},12079:q=>{"use strict";q.exports=function(q,Q){var y="abcdef".split("").concat(Q),x=[];q.indexOf("lo")>=0&&x.push("lo=e[k+n]");q.indexOf("hi")>=0&&x.push("hi=e[k+o]");return y.push(X.replace("_",x.join()).replace("$",q)),Function.apply(void 0,y)};var X="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},12058:q=>{"use strict";q.exports=function(q,y){y<=4*X?Q(0,y-1,q):a(0,y-1,q)};var X=32;function Q(q,X,Q){for(var y=2*(q+1),x=q+1;x<=X;++x){for(var u=Q[y++],H=Q[y++],b=x,D=y-2;b-- >q;){var a=Q[D-2],R=Q[D-1];if(a<u)break;if(a===u&&R<H)break;Q[D]=a,Q[D+1]=R,D-=2}Q[D]=u,Q[D+1]=H}}function y(q,X,Q){X*=2;var y=Q[q*=2],x=Q[q+1];Q[q]=Q[X],Q[q+1]=Q[X+1],Q[X]=y,Q[X+1]=x}function x(q,X,Q){X*=2,Q[q*=2]=Q[X],Q[q+1]=Q[X+1]}function u(q,X,Q,y){X*=2,Q*=2;var x=y[q*=2],u=y[q+1];y[q]=y[X],y[q+1]=y[X+1],y[X]=y[Q],y[X+1]=y[Q+1],y[Q]=x,y[Q+1]=u}function H(q,X,Q,y,x){X*=2,x[q*=2]=x[X],x[X]=Q,x[q+1]=x[X+1],x[X+1]=y}function b(q,X,Q){X*=2;var y=Q[q*=2],x=Q[X];return!(y<x)&&(y!==x||Q[q+1]>Q[X+1])}function D(q,X,Q,y){var x=y[q*=2];return x<X||x===X&&y[q+1]<Q}function a(q,R,L){var f=(R-q+1)/6|0,k=q+f,j=R-f,I=q+R>>1,d=I-f,e=I+f,i=k,A=d,B=I,w=e,V=j,W=q+1,v=R-1,Z=0;b(i,A,L)&&(Z=i,i=A,A=Z),b(w,V,L)&&(Z=w,w=V,V=Z),b(i,B,L)&&(Z=i,i=B,B=Z),b(A,B,L)&&(Z=A,A=B,B=Z),b(i,w,L)&&(Z=i,i=w,w=Z),b(B,w,L)&&(Z=B,B=w,w=Z),b(A,V,L)&&(Z=A,A=V,V=Z),b(A,B,L)&&(Z=A,A=B,B=Z),b(w,V,L)&&(Z=w,w=V,V=Z);for(var U=L[2*A],O=L[2*A+1],g=L[2*w],P=L[2*w+1],F=2*i,l=2*B,m=2*V,M=2*k,o=2*I,Y=2*j,N=0;N<2;++N){var S=L[F+N],c=L[l+N],p=L[m+N];L[M+N]=S,L[o+N]=c,L[Y+N]=p}x(d,q,L),x(e,R,L);for(var t=W;t<=v;++t)if(D(t,U,O,L))t!==W&&y(t,W,L),++W;else if(!D(t,g,P,L))for(;;){if(D(v,g,P,L)){D(v,U,O,L)?(u(t,W,v,L),++W,--v):(y(t,v,L),--v);break}if(--v<t)break}H(q,W-1,U,O,L),H(R,v+1,g,P,L),W-2-q<=X?Q(q,W-2,L):a(q,W-2,L),R-(v+2)<=X?Q(v+2,R,L):a(v+2,R,L),v-W<=X?Q(W,v,L):a(W,v,L)}},12051:(q,X,Q)=>{"use strict";q.exports={init:function(q){var X=x.nextPow2(q);D.length<X&&(y.free(D),D=y.mallocInt32(X));a.length<X&&(y.free(a),a=y.mallocInt32(X));R.length<X&&(y.free(R),R=y.mallocInt32(X));L.length<X&&(y.free(L),L=y.mallocInt32(X));f.length<X&&(y.free(f),f=y.mallocInt32(X));k.length<X&&(y.free(k),k=y.mallocInt32(X));var Q=8*X;j.length<Q&&(y.free(j),j=y.mallocDouble(Q))},sweepBipartite:function(q,X,Q,y,x,b,f,k,e,i){for(var A=0,B=2*q,w=q-1,V=B-1,W=Q;W<y;++W){var v=b[W],Z=B*W;j[A++]=x[Z+w],j[A++]=-(v+1),j[A++]=x[Z+V],j[A++]=v}for(W=f;W<k;++W){v=i[W]+H;var U=B*W;j[A++]=e[U+w],j[A++]=-v,j[A++]=e[U+V],j[A++]=v}var O=A>>>1;u(j,O);var g=0,P=0;for(W=0;W<O;++W){var F=0|j[2*W+1];if(F>=H)I(R,L,P--,F=F-H|0);else if(F>=0)I(D,a,g--,F);else if(F<=-H){F=-F-H|0;for(var l=0;l<g;++l){if(void 0!==(m=X(D[l],F)))return m}d(R,L,P++,F)}else{F=-F-1|0;for(l=0;l<P;++l){var m;if(void 0!==(m=X(F,R[l])))return m}d(D,a,g++,F)}}},sweepComplete:function(q,X,Q,y,x,H,b,e,i,A){for(var B=0,w=2*q,V=q-1,W=w-1,v=Q;v<y;++v){var Z=H[v]+1<<1,U=w*v;j[B++]=x[U+V],j[B++]=-Z,j[B++]=x[U+W],j[B++]=Z}for(v=b;v<e;++v){Z=A[v]+1<<1;var O=w*v;j[B++]=i[O+V],j[B++]=1|-Z,j[B++]=i[O+W],j[B++]=1|Z}var g=B>>>1;u(j,g);var P=0,F=0,l=0;for(v=0;v<g;++v){var m=0|j[2*v+1],M=1&m;if(v<g-1&&m>>1===j[2*v+3]>>1&&(M=2,v+=1),m<0){for(var o=-(m>>1)-1,Y=0;Y<l;++Y){if(void 0!==(N=X(f[Y],o)))return N}if(0!==M)for(Y=0;Y<P;++Y){if(void 0!==(N=X(D[Y],o)))return N}if(1!==M)for(Y=0;Y<F;++Y){var N;if(void 0!==(N=X(R[Y],o)))return N}0===M?d(D,a,P++,o):1===M?d(R,L,F++,o):2===M&&d(f,k,l++,o)}else{o=(m>>1)-1;0===M?I(D,a,P--,o):1===M?I(R,L,F--,o):2===M&&I(f,k,l--,o)}}},scanBipartite:function(q,X,Q,y,x,b,R,L,f,k,e,i){var A=0,B=2*q,w=X,V=X+q,W=1,v=1;y?v=H:W=H;for(var Z=x;Z<b;++Z){var U=Z+W,O=B*Z;j[A++]=R[O+w],j[A++]=-U,j[A++]=R[O+V],j[A++]=U}for(Z=f;Z<k;++Z){U=Z+v;var g=B*Z;j[A++]=e[g+w],j[A++]=-U}var P=A>>>1;u(j,P);var F=0;for(Z=0;Z<P;++Z){var l=0|j[2*Z+1];if(l<0){var m=!1;if((U=-l)>=H?(m=!y,U-=H):(m=!!y,U-=1),m)d(D,a,F++,U);else{var M=i[U],o=B*U,Y=e[o+X+1],N=e[o+X+1+q];q:for(var S=0;S<F;++S){var c=D[S],p=B*c;if(!(N<R[p+X+1]||R[p+X+1+q]<Y)){for(var t=X+2;t<q;++t)if(e[o+t+q]<R[p+t]||R[p+t+q]<e[o+t])continue q;var z,K=L[c];if(void 0!==(z=y?Q(M,K):Q(K,M)))return z}}}}else I(D,a,F--,l-W)}},scanComplete:function(q,X,Q,y,x,b,a,R,L,f,k){for(var I=0,d=2*q,e=X,i=X+q,A=y;A<x;++A){var B=A+H,w=d*A;j[I++]=b[w+e],j[I++]=-B,j[I++]=b[w+i],j[I++]=B}for(A=R;A<L;++A){B=A+1;var V=d*A;j[I++]=f[V+e],j[I++]=-B}var W=I>>>1;u(j,W);var v=0;for(A=0;A<W;++A){var Z=0|j[2*A+1];if(Z<0){if((B=-Z)>=H)D[v++]=B-H;else{var U=k[B-=1],O=d*B,g=f[O+X+1],P=f[O+X+1+q];q:for(var F=0;F<v;++F){var l=D[F],m=a[l];if(m===U)break;var M=d*l;if(!(P<b[M+X+1]||b[M+X+1+q]<g)){for(var o=X+2;o<q;++o)if(f[O+o+q]<b[M+o]||b[M+o+q]<f[O+o])continue q;var Y=Q(m,U);if(void 0!==Y)return Y}}}}else{for(B=Z-H,F=v-1;F>=0;--F)if(D[F]===B){for(o=F+1;o<v;++o)D[o-1]=D[o];break}--v}}}};var y=Q(12034),x=Q(12037),u=Q(12058),H=1<<28,b=1024,D=y.mallocInt32(b),a=y.mallocInt32(b),R=y.mallocInt32(b),L=y.mallocInt32(b),f=y.mallocInt32(b),k=y.mallocInt32(b),j=y.mallocDouble(8192);function I(q,X,Q,y){var x=X[y],u=q[Q-1];q[x]=u,X[u]=x}function d(q,X,Q,y){q[Q]=y,X[y]=Q}},12041:q=>{"use strict";function X(q,Q,y){var x=0|q[y];if(x<=0)return[];var u,H=new Array(x);if(y===q.length-1)for(u=0;u<x;++u)H[u]=Q;else for(u=0;u<x;++u)H[u]=X(q,Q,y+1);return H}q.exports=function(q,Q){switch("undefined"===typeof Q&&(Q=0),typeof q){case"number":if(q>0)return function(q,X){var Q,y;for(Q=new Array(q),y=0;y<q;++y)Q[y]=X;return Q}(0|q,Q);break;case"object":if("number"===typeof q.length)return X(q,Q,0)}return[]}},12003:(q,X,Q)=>{q.exports=function(){var q=this;this.components={},this.comps=this.components;var X=this.components,Q=1,x={},u=[],H=[],b={timeout:!1,removals:[],multiComps:[]};function D(q,Q){var y=X[Q],u=x[Q],H=u.hash[q];H&&(u.remove(q),y.ab&&(y.multi?(H.forEach((X=>{X&&y.ab(q,X)})),H.length=0):y.ab(q,H)),b.removals.push(u),a())}function a(){b.timeout||(b.timeout=!0,setTimeout(R,1))}function R(){b.timeout=!1,L()}function L(){b.multiComps.length&&function(q){for(var X=0;X<q.length;X++){var{entID:Q,data:y}=q[X],x=y.hash[Q];if(x){for(var u=0;u<x.length;u++)x[u]||(x.splice(u,1),u--);0===x.length&&(y.remove(Q),b.removals.push(y))}}q.length=0}(b.multiComps),b.removals.length&&function(q){for(var X=0;X<q.length;X++){q[X].flush()}q.length=0}(b.removals)}this.Li=x,this._systems=u,this._renderSystems=H,this.sh=function(X){var y=Q++;return Array.isArray(X)&&X.forEach((X=>q.pf(y,X))),y},this.deleteEntity=function(X){return Object.keys(x).forEach((q=>{x[q].hash[X]&&D(X,q)})),q},this.Qh=function(q){if(!q)throw new Error("Missing component definition");var Q=q.name;if(!Q)throw new Error("Component definition must have a name property.");if("string"!==typeof Q)throw new Error("Component name must be a string.");if(""===Q)throw new Error("Component name must be a non-empty string.");if(x[Q])throw new Error(`Component ${Q} already exists.`);var b={};return b.name=Q,b.multi=!!q.multi,b.order=isNaN(q.order)?99:q.order,b.stateConstructor=q.stateConstructor||null,b.state=q.state||{},b.Af=q.Af||null,b.ab=q.ab||null,b.system=q.system||null,b.Kg=q.Kg||null,X[Q]=b,x[Q]=new y,x[Q]._pendingMultiCleanup=!1,x[Q]._multiCleanupIDs=b.multi?[]:null,b.system&&(u.push(Q),u.sort(((q,Q)=>X[q].order-X[Q].order))),b.Kg&&(H.push(Q),H.sort(((q,Q)=>X[q].order-X[Q].order))),Q},this.overwriteComponent=function(q,Q){var y=X[q];if(!y)throw new Error(`Unknown component: ${q}`);if(!Q)throw new Error("Missing component definition");if(y.name!==Q.name)throw new Error("Overwriting component must use the same name property.");var b={};b.name=q,b.multi=!!Q.multi,b.order=isNaN(Q.order)?99:Q.order,b.state=Q.state||{},b.Af=Q.Af||null,b.ab=Q.ab||null,b.system=Q.system||null,b.Kg=Q.Kg||null,X[q]=b,x[q]._pendingMultiCleanup=!1,x[q]._multiCleanupIDs=b.multi?[]:null;var D=u.indexOf(q);b.system&&D<0&&u.push(q),!b.system&&D>=0&&u.splice(D,1),u.sort(((q,Q)=>X[q].order-X[Q].order));var a=H.indexOf(q);b.Kg&&a<0&&H.push(q),!b.Kg&&a>=0&&H.splice(a,1),H.sort(((q,Q)=>X[q].order-X[Q].order));var R=b.state;return this.Qg(q).forEach((q=>{for(var X in R)X in q||(q[X]=R[X]);b.Af&&b.Af(q.Jg,q)})),q},this.deleteComponent=function(Q){var y=x[Q];if(!y)throw new Error(`Unknown component: ${Q}`);y.flush(),y.list.forEach((q=>{q&&D(q.Jg||q[0].Jg,Q)}));var b=u.indexOf(Q),a=H.indexOf(Q);return b>-1&&u.splice(b,1),a>-1&&H.splice(a,1),x[Q].dispose(),delete x[Q],delete X[Q],q},this.pf=function(q,Q,y){var u,H=X[Q],b=x[Q];if(!b)throw new Error(`Unknown component: ${Q}.`);if(b.hash[q]&&!H.multi)throw new Error(`Entity ${q} already has component: ${Q}.`);if(H.stateConstructor){if(!(u=new H.stateConstructor).hasOwnProperty("Jg"))throw new Error(`Component ${H.name} stateConstructor type does not have property __id`)}else u=Object.assign({},{Jg:q},H.state,y);if(u.Jg=q,H.multi){var D=b.hash[q];D||(D=[],b.add(q,D)),D.push(u)}else b.add(q,u);return H.Af&&H.Af(q,u),this},this.Gf=function(q,X){var Q=x[X];if(!Q)throw new Error(`Unknown component: ${X}.`);return!!Q.hash[q]},this.tf=function(X,Q){if(!x[Q])throw new Error(`Unknown component: ${Q}.`);return D(X,Q),q},this.getState=function(q,X){var Q=x[X];if(!Q)throw new Error(`Unknown component: ${X}.`);return Q.hash[q]},this.Qg=function(q){var X=x[q];if(!X)throw new Error(`Unknown component: ${q}.`);return L(),X.list},this.sk=function(q){if(!x[q])throw new Error(`Unknown component: ${q}.`);var X=x[q].hash;return q=>X[q]},this.vk=function(q){if(!x[q])throw new Error(`Unknown component: ${q}.`);var X=x[q].hash;return q=>!!X[q]},this.cf=function(Q){L();for(var y=0;y<u.length;y++){var H=u[y],b=X[H],D=x[H];b.system(Q,D.list),L()}return q},this.render=function(Q){L();for(var y=0;y<H.length;y++){var u=H[y],b=X[u],D=x[u];b.Kg(Q,D.list),L()}return q},this.removeMultiComponent=function(Q,y,u){var H=X[y],D=x[y];if(!D)throw new Error(`Unknown component: ${y}.`);if(!H.multi)throw new Error("removeMultiComponent called on non-multi component");return function(q,X,Q,y){var x=Q.hash[q];if(x){var u=x[y];u&&(x[y]=null,X.ab&&X.ab(q,u),b.multiComps.push({entID:q,data:Q}),a())}}(Q,H,D,u),q}};var y=Q(12005)},12005:q=>{function X(q,X){var Q=q._map[X];if(delete q.hash[X],delete q._map[X],Q===q.list.length-1)q.list.pop();else{var y=q.list.pop();if(q.list[Q]=y,null===y||null===y[0]){var x=q.list.length;for(var u in q._map)if(q._map[u]===x)return void(q._map[u]=Q)}else{var H=y.Jg||y[0].Jg;q._map[H]=Q}}}q.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(q,X){if("number"===typeof this._map[q]){var Q=this._map[q];this.hash[q]=X,this.list[Q]=X}else this._map[q]=this.list.length,this.hash[q]=X,this.list.push(X)}remove(q){var X=this._map[q];this.hash[q]=null,this.list[X]=null,this._pendingRemovals.push(q)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var q=0;q<this._pendingRemovals.length;q++){var Q=this._pendingRemovals[q];null===this.hash[Q]&&X(this,Q)}this._pendingRemovals.length=0}}},11971:q=>{"use strict";var X,Q="object"===typeof Reflect?Reflect:null,y=function(q,X,Q){return Function.prototype.apply.call(q,X,Q)};X=Q&&"function"===typeof Q.ownKeys?Q.ownKeys:Object.getOwnPropertySymbols?function(q){return Object.getOwnPropertyNames(q).concat(Object.getOwnPropertySymbols(q))}:function(q){return Object.getOwnPropertyNames(q)};var x=Number.isNaN||function(q){return q!==q};function u(){u.init.call(this)}q.exports=u,q.exports.once=function(q,X){return new Promise((function(Q,y){function x(Q){q.removeListener(X,u),y(Q)}function u(){"function"===typeof q.removeListener&&q.removeListener("error",x),Q([].slice.call(arguments))}I(q,X,u,{once:!0}),"error"!==X&&function(q,X,Q){"function"===typeof q.on&&I(q,"error",X,Q)}(q,x,{once:!0})}))},u.EventEmitter=u,u.prototype._events=void 0,u.prototype._eventsCount=0,u.prototype._maxListeners=void 0;var H=10;function b(q){if("function"!==typeof q)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof q)}function D(q){return void 0===q._maxListeners?u.defaultMaxListeners:q._maxListeners}function a(q,X,Q,y){var x,u,H,a;if(b(Q),void 0===(u=q._events)?(u=q._events=Object.create(null),q._eventsCount=0):(void 0!==u.newListener&&(q.emit("newListener",X,Q.listener?Q.listener:Q),u=q._events),H=u[X]),void 0===H)H=u[X]=Q,++q._eventsCount;else if("function"===typeof H?H=u[X]=y?[Q,H]:[H,Q]:y?H.unshift(Q):H.push(Q),(x=D(q))>0&&H.length>x&&!H.warned){H.warned=!0;var R=new Error("Possible EventEmitter memory leak detected. "+H.length+" "+String(X)+" listeners added. Use emitter.setMaxListeners() to increase limit");R.name="MaxListenersExceededWarning",R.k=q,R.type=X,R.count=H.length,a=R,console&&console.warn&&console.warn(a)}return q}function R(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function L(q,X,Q){var y={fired:!1,wrapFn:void 0,target:q,type:X,listener:Q},x=R.bind(y);return x.listener=Q,y.wrapFn=x,x}function f(q,X,Q){var y=q._events;if(void 0===y)return[];var x=y[X];return void 0===x?[]:"function"===typeof x?Q?[x.listener||x]:[x]:Q?function(q){for(var X=new Array(q.length),Q=0;Q<X.length;++Q)X[Q]=q[Q].listener||q[Q];return X}(x):j(x,x.length)}function k(q){var X=this._events;if(void 0!==X){var Q=X[q];if("function"===typeof Q)return 1;if(void 0!==Q)return Q.length}return 0}function j(q,X){for(var Q=new Array(X),y=0;y<X;++y)Q[y]=q[y];return Q}function I(q,X,Q,y){if("function"===typeof q.on)y.once?q.once(X,Q):q.on(X,Q);else{if("function"!==typeof q.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof q);q.addEventListener(X,(function x(u){y.once&&q.removeEventListener(X,x),Q(u)}))}}Object.defineProperty(u,"defaultMaxListeners",{enumerable:!0,get:function(){return H},set:function(q){if("number"!==typeof q||q<0||x(q))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+q+".");H=q}}),u.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},u.prototype.setMaxListeners=function(q){if("number"!==typeof q||q<0||x(q))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+q+".");return this._maxListeners=q,this},u.prototype.getMaxListeners=function(){return D(this)},u.prototype.emit=function(q){for(var X=[],Q=1;Q<arguments.length;Q++)X.push(arguments[Q]);var x="error"===q,u=this._events;if(void 0!==u)x=x&&void 0===u.error;else if(!x)return!1;if(x){var H;if(X.length>0&&(H=X[0]),H instanceof Error)throw H;var b=new Error("Unhandled error."+(H?" ("+H.message+")":""));throw b.context=H,b}var D=u[q];if(void 0===D)return!1;if("function"===typeof D)y(D,this,X);else{var a=D.length,R=j(D,a);for(Q=0;Q<a;++Q)y(R[Q],this,X)}return!0},u.prototype.addListener=function(q,X){return a(this,q,X,!1)},u.prototype.on=u.prototype.addListener,u.prototype.prependListener=function(q,X){return a(this,q,X,!0)},u.prototype.once=function(q,X){return b(X),this.on(q,L(this,q,X)),this},u.prototype.prependOnceListener=function(q,X){return b(X),this.prependListener(q,L(this,q,X)),this},u.prototype.removeListener=function(q,X){var Q,y,x,u,H;if(b(X),void 0===(y=this._events))return this;if(void 0===(Q=y[q]))return this;if(Q===X||Q.listener===X)0===--this._eventsCount?this._events=Object.create(null):(delete y[q],y.removeListener&&this.emit("removeListener",q,Q.listener||X));else if("function"!==typeof Q){for(x=-1,u=Q.length-1;u>=0;u--)if(Q[u]===X||Q[u].listener===X){H=Q[u].listener,x=u;break}if(x<0)return this;0===x?Q.shift():function(q,X){for(;X+1<q.length;X++)q[X]=q[X+1];q.pop()}(Q,x),1===Q.length&&(y[q]=Q[0]),void 0!==y.removeListener&&this.emit("removeListener",q,H||X)}return this},u.prototype.off=u.prototype.removeListener,u.prototype.removeAllListeners=function(q){var X,Q,y;if(void 0===(Q=this._events))return this;if(void 0===Q.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==Q[q]&&(0===--this._eventsCount?this._events=Object.create(null):delete Q[q]),this;if(0===arguments.length){var x,u=Object.keys(Q);for(y=0;y<u.length;++y)"removeListener"!==(x=u[y])&&this.removeAllListeners(x);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(X=Q[q]))this.removeListener(q,X);else if(void 0!==X)for(y=X.length-1;y>=0;y--)this.removeListener(q,X[y]);return this},u.prototype.listeners=function(q){return f(this,q,!0)},u.prototype.rawListeners=function(q){return f(this,q,!1)},u.listenerCount=function(q,X){return"function"===typeof q.listenerCount?q.listenerCount(X):k.call(q,X)},u.prototype.listenerCount=k,u.prototype.eventNames=function(){return this._eventsCount>0?X(this._events):[]}},12256:q=>{"use strict";q.exports=function(q,X,Q,y,x,u){var H=+X[0],b=+X[1],D=+X[2],a=+Q[0],R=+Q[1],L=+Q[2],f=Math.sqrt(a*a+R*R+L*L);if(0===f)throw new Error("Can't raycast along a zero vector");return function(q,X,Q,y,x,u,H,b,D,a){for(var R=0,L=Math.floor,f=0|L(X),k=0|L(Q),j=0|L(y),I=x>0?1:-1,d=u>0?1:-1,e=H>0?1:-1,i=Math.abs(1/x),A=Math.abs(1/u),B=Math.abs(1/H),w=i<1/0?i*(I>0?f+1-X:X-f):1/0,V=A<1/0?A*(d>0?k+1-Q:Q-k):1/0,W=B<1/0?B*(e>0?j+1-y:y-j):1/0,v=-1;R<=b;){var Z=q(f,k,j);if(Z)return D&&(D[0]=X+R*x,D[1]=Q+R*u,D[2]=y+R*H),a&&(a[0]=a[1]=a[2]=0,0===v&&(a[0]=-I),1===v&&(a[1]=-d),2===v&&(a[2]=-e)),Z;w<V?w<W?(f+=I,R=w,w+=i,v=0):(j+=e,R=W,W+=B,v=2):V<W?(k+=d,R=V,V+=A,v=1):(j+=e,R=W,W+=B,v=2)}return D&&(D[0]=X+R*x,D[1]=Q+R*u,D[2]=y+R*H),a&&(a[0]=a[1]=a[2]=0),0}(q,H,b,D,a/=f,R/=f,L/=f,y="undefined"===typeof y?64:+y,x,u)}},12295:(q,X,Q)=>{"use strict";Q.d(X,{b:()=>u});var y=Q(11971);function x(){this.sj=!1,this.stopPropagation=!1,this.tj=!1,this.disabled=!1}class u{constructor(q,X){this.version="0.7.0";var Q=Object.assign({},new x,X||{});this.element=q||document,this.sj=!!Q.sj,this.stopPropagation=!!Q.stopPropagation,this.tj=!!Q.tj,this.disabled=!!Q.disabled,this.filterEvents=(q,X)=>!0,this.down=new y.EventEmitter,this.up=new y.EventEmitter,this.state={},this.Cg={dx:0,dy:0,ik:0,Bg:0,jk:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?b(this):document.addEventListener("DOMContentLoaded",(q=>{b(this)}),{once:!0})}bind(q){for(var X=arguments.length,Q=new Array(X>1?X-1:0),y=1;y<X;y++)Q[y-1]=arguments[y];Q.forEach((X=>{var Q=this._keyBindmap[X]||[];Q.includes(q)||(Q.push(q),this._keyBindmap[X]=Q)})),this.state[q]=!!this.state[q],this.pressCount[q]=this.pressCount[q]||0,this.releaseCount[q]=this.releaseCount[q]||0}unbind(q){for(var X in this._keyBindmap){var Q=this._keyBindmap[X],y=Q.indexOf(q);y>-1&&Q.splice(y,1)}}getBindings(){var q={};for(var X in this._keyBindmap){this._keyBindmap[X].forEach((Q=>{q[Q]=q[Q]||[],q[Q].push(X)}))}return q}cf(){H(this.Cg),H(this.pressCount),H(this.releaseCount)}}function H(q){for(var X in q)q[X]=0}function b(q){window.addEventListener("keydown",j.bind(null,q,!0),!1),window.addEventListener("keyup",j.bind(null,q,!1),!1);var X={passive:!0};q.element.addEventListener("touchstart",L.bind(void 0,q),{passive:!1}),q.element.addEventListener("touchend",k.bind(void 0,q),X),q.element.addEventListener("mousedown",I.bind(null,q,!0),X),window.document.addEventListener("mouseup",I.bind(null,q,!1),X),q.element.addEventListener("touchmove",d.bind(null,q),X),q.element.addEventListener("mousemove",d.bind(null,q),X),window.PointerEvent,q.element.addEventListener("wheel",e.bind(null,q),X),q.element.addEventListener("contextmenu",i.bind(null,q),!1),window.addEventListener("blur",A.bind(null,q),!1)}var D=0,a=0,R=null;function L(q,X){X.preventDefault(),f(X)}function f(q){let X=!1;for(let Q=0;Q<q.touches.length;++Q)if(q.touches[Q].identifier===R){X=!0;break}if(!X){const X=q.changedTouches[0];D=X.clientX,a=X.clientY,R=X.identifier}}function k(q,X){for(var Q=X.changedTouches,y=0;y<Q.length;++y)Q[y].identifier===R&&(R=null)}function j(q,X,Q){B(Q.code,X,q,Q)}function I(q,X,Q){if("pointerId"in Q)if(X){if(null!==q._touches.currID)return;q._touches.currID=Q.pointerId}else{if(q._touches.currID!==Q.pointerId)return;q._touches.currID=null}return B("Mouse"+("button"in Q?Q.button+1:1),X,q,Q),!1}function d(q,X){var Q=X.movementX||X.mozMovementX||0,y=X.movementY||X.mozMovementY||0;if(X.touches&&0===(Q|y)){var x=function(q){f(q);for(let X=0;X<q.changedTouches.length;++X)if(q.changedTouches[X].identifier==R){const Q=q.changedTouches[X],y=[Q.clientX-D,Q.clientY-a];return D=Q.clientX,a=Q.clientY,y}return console.error(`Did not find touch id ${R}`),[0,0]}(X);Q=x[0],y=x[1]}q.Cg.dx+=Q,q.Cg.dy+=y}function e(q,X){var Q=1;switch(X.deltaMode){case 0:Q=1;break;case 1:Q=12;break;case 2:Q=q.element.clientHeight||window.innerHeight}q.Cg.ik+=(X.deltaX||0)*Q,q.Cg.Bg+=(X.deltaY||0)*Q,q.Cg.jk+=(X.deltaZ||0)*Q}function i(q,X){if(!q.tj)return X.preventDefault(),!1}function A(q){for(var X in q._keyStates)q._keyStates[X]&&(/^Mouse\d/.test(X)||B(X,!1,q,{code:X,note:"This is a mocked KeyboardEvent made by the 'game-inputs' module",preventDefault:()=>{},stopPropagation:()=>{}}))}function B(q,X,Q,y){var x=Q._keyBindmap[q];x&&(w(Q._keyStates[q],X)&&(Q._keyStates[q]=X,x.forEach((q=>{(!Q.filterEvents||Q.filterEvents(y,q))&&function(q,X,Q,y){var x=X?Q.pressCount:Q.releaseCount;x[q]=(x[q]||0)+1;var u=Q._bindPressCount[q]||0;(u+=X?1:-1)<0&&(u=0);Q._bindPressCount[q]=u;var H=Q.state[q];if(w(H,u)){Q.state[q]=u>0;var b=X?Q.down:Q.up;Q.disabled||b.emit(q,y)}}(q,X,Q,y)}))),"button"in y||(Q.sj&&!y.defaultPrevented&&y.preventDefault(),Q.stopPropagation&&y.stopPropagation()))}function w(q,X){return q?!X:X}},11660:q=>{q.exports=function(q,X,Q){return q[0]=X[0]+Q[0],q[1]=X[1]+Q[1],q[2]=X[2]+Q[2],q}},11612:(q,X,Q)=>{q.exports=function(q,X){var Q=y(q[0],q[1],q[2]),H=y(X[0],X[1],X[2]);x(Q,Q),x(H,H);var b=u(Q,H);return b>1?0:Math.acos(b)};var y=Q(11619),x=Q(11621),u=Q(11630)},11714:q=>{q.exports=function(q,X){return q[0]=Math.ceil(X[0]),q[1]=Math.ceil(X[1]),q[2]=Math.ceil(X[2]),q}},11606:q=>{q.exports=function(q){var X=new Float32Array(3);return X[0]=q[0],X[1]=q[1],X[2]=q[2],X}},11638:q=>{q.exports=function(q,X){return q[0]=X[0],q[1]=X[1],q[2]=X[2],q}},11604:q=>{q.exports=function(){var q=new Float32Array(3);return q[0]=0,q[1]=0,q[2]=0,q}},11797:q=>{q.exports=function(q,X,Q){var y=X[0],x=X[1],u=X[2],H=Q[0],b=Q[1],D=Q[2];return q[0]=x*D-u*b,q[1]=u*H-y*D,q[2]=y*b-x*H,q}},11750:(q,X,Q)=>{q.exports=Q(11743)},11743:q=>{q.exports=function(q,X){var Q=X[0]-q[0],y=X[1]-q[1],x=X[2]-q[2];return Math.sqrt(Q*Q+y*y+x*x)}},11694:(q,X,Q)=>{q.exports=Q(11689)},11689:q=>{q.exports=function(q,X,Q){return q[0]=X[0]/Q[0],q[1]=X[1]/Q[1],q[2]=X[2]/Q[2],q}},11630:q=>{q.exports=function(q,X){return q[0]*X[0]+q[1]*X[1]+q[2]*X[2]}},11597:q=>{q.exports=1e-6},11651:(q,X,Q)=>{q.exports=function(q,X){var Q=q[0],x=q[1],u=q[2],H=X[0],b=X[1],D=X[2];return Math.abs(Q-H)<=y*Math.max(1,Math.abs(Q),Math.abs(H))&&Math.abs(x-b)<=y*Math.max(1,Math.abs(x),Math.abs(b))&&Math.abs(u-D)<=y*Math.max(1,Math.abs(u),Math.abs(D))};var y=Q(11597)},11657:q=>{q.exports=function(q,X){return q[0]===X[0]&&q[1]===X[1]&&q[2]===X[2]}},11712:q=>{q.exports=function(q,X){return q[0]=Math.floor(X[0]),q[1]=Math.floor(X[1]),q[2]=Math.floor(X[2]),q}},11842:(q,X,Q)=>{q.exports=function(q,X,Q,x,u,H){var b,D;X||(X=3);Q||(Q=0);D=x?Math.min(x*X+Q,q.length):q.length;for(b=Q;b<D;b+=X)y[0]=q[b],y[1]=q[b+1],y[2]=q[b+2],u(y,y,H),q[b]=y[0],q[b+1]=y[1],q[b+2]=y[2];return q};var y=Q(11604)()},11619:q=>{q.exports=function(q,X,Q){var y=new Float32Array(3);return y[0]=q,y[1]=X,y[2]=Q,y}},11590:(q,X,Q)=>{q.exports={EPSILON:Q(11597),create:Q(11604),clone:Q(11606),angle:Q(11612),qd:Q(11619),j:Q(11638),set:Q(11645),equals:Q(11651),exactEquals:Q(11657),add:Q(11660),Sc:Q(11664),sub:Q(11673),multiply:Q(11678),mul:Q(11684),divide:Q(11689),div:Q(11694),min:Q(11702),max:Q(11705),floor:Q(11712),ceil:Q(11714),round:Q(11723),scale:Q(11730),td:Q(11738),distance:Q(11743),dist:Q(11750),vd:Q(11755),sqrDist:Q(11763),length:Q(11765),len:Q(11774),squaredLength:Q(11780),wd:Q(11787),negate:Q(11793),inverse:Q(11795),normalize:Q(11621),dot:Q(11630),cross:Q(11797),gd:Q(11800),random:Q(11808),transformMat4:Q(11810),transformMat3:Q(11814),transformQuat:Q(11818),xd:Q(11825),Cd:Q(11829),Dd:Q(11837),forEach:Q(11842)}},11795:q=>{q.exports=function(q,X){return q[0]=1/X[0],q[1]=1/X[1],q[2]=1/X[2],q}},11774:(q,X,Q)=>{q.exports=Q(11765)},11765:q=>{q.exports=function(q){var X=q[0],Q=q[1],y=q[2];return Math.sqrt(X*X+Q*Q+y*y)}},11800:q=>{q.exports=function(q,X,Q,y){var x=X[0],u=X[1],H=X[2];return q[0]=x+y*(Q[0]-x),q[1]=u+y*(Q[1]-u),q[2]=H+y*(Q[2]-H),q}},11705:q=>{q.exports=function(q,X,Q){return q[0]=Math.max(X[0],Q[0]),q[1]=Math.max(X[1],Q[1]),q[2]=Math.max(X[2],Q[2]),q}},11702:q=>{q.exports=function(q,X,Q){return q[0]=Math.min(X[0],Q[0]),q[1]=Math.min(X[1],Q[1]),q[2]=Math.min(X[2],Q[2]),q}},11684:(q,X,Q)=>{q.exports=Q(11678)},11678:q=>{q.exports=function(q,X,Q){return q[0]=X[0]*Q[0],q[1]=X[1]*Q[1],q[2]=X[2]*Q[2],q}},11793:q=>{q.exports=function(q,X){return q[0]=-X[0],q[1]=-X[1],q[2]=-X[2],q}},11621:q=>{q.exports=function(q,X){var Q=X[0],y=X[1],x=X[2],u=Q*Q+y*y+x*x;u>0&&(u=1/Math.sqrt(u),q[0]=X[0]*u,q[1]=X[1]*u,q[2]=X[2]*u);return q}},11808:q=>{q.exports=function(q,X){X=X||1;var Q=2*Math.random()*Math.PI,y=2*Math.random()-1,x=Math.sqrt(1-y*y)*X;return q[0]=Math.cos(Q)*x,q[1]=Math.sin(Q)*x,q[2]=y*X,q}},11825:q=>{q.exports=function(q,X,Q,y){var x=Q[1],u=Q[2],H=X[1]-x,b=X[2]-u,D=Math.sin(y),a=Math.cos(y);return q[0]=X[0],q[1]=x+H*a-b*D,q[2]=u+H*D+b*a,q}},11829:q=>{q.exports=function(q,X,Q,y){var x=Q[0],u=Q[2],H=X[0]-x,b=X[2]-u,D=Math.sin(y),a=Math.cos(y);return q[0]=x+b*D+H*a,q[1]=X[1],q[2]=u+b*a-H*D,q}},11837:q=>{q.exports=function(q,X,Q,y){var x=Q[0],u=Q[1],H=X[0]-x,b=X[1]-u,D=Math.sin(y),a=Math.cos(y);return q[0]=x+H*a-b*D,q[1]=u+H*D+b*a,q[2]=X[2],q}},11723:q=>{q.exports=function(q,X){return q[0]=Math.round(X[0]),q[1]=Math.round(X[1]),q[2]=Math.round(X[2]),q}},11730:q=>{q.exports=function(q,X,Q){return q[0]=X[0]*Q,q[1]=X[1]*Q,q[2]=X[2]*Q,q}},11738:q=>{q.exports=function(q,X,Q,y){return q[0]=X[0]+Q[0]*y,q[1]=X[1]+Q[1]*y,q[2]=X[2]+Q[2]*y,q}},11645:q=>{q.exports=function(q,X,Q,y){return q[0]=X,q[1]=Q,q[2]=y,q}},11763:(q,X,Q)=>{q.exports=Q(11755)},11787:(q,X,Q)=>{q.exports=Q(11780)},11755:q=>{q.exports=function(q,X){var Q=X[0]-q[0],y=X[1]-q[1],x=X[2]-q[2];return Q*Q+y*y+x*x}},11780:q=>{q.exports=function(q){var X=q[0],Q=q[1],y=q[2];return X*X+Q*Q+y*y}},11673:(q,X,Q)=>{q.exports=Q(11664)},11664:q=>{q.exports=function(q,X,Q){return q[0]=X[0]-Q[0],q[1]=X[1]-Q[1],q[2]=X[2]-Q[2],q}},11814:q=>{q.exports=function(q,X,Q){var y=X[0],x=X[1],u=X[2];return q[0]=y*Q[0]+x*Q[3]+u*Q[6],q[1]=y*Q[1]+x*Q[4]+u*Q[7],q[2]=y*Q[2]+x*Q[5]+u*Q[8],q}},11810:q=>{q.exports=function(q,X,Q){var y=X[0],x=X[1],u=X[2],H=Q[3]*y+Q[7]*x+Q[11]*u+Q[15];return H=H||1,q[0]=(Q[0]*y+Q[4]*x+Q[8]*u+Q[12])/H,q[1]=(Q[1]*y+Q[5]*x+Q[9]*u+Q[13])/H,q[2]=(Q[2]*y+Q[6]*x+Q[10]*u+Q[14])/H,q}},11818:q=>{q.exports=function(q,X,Q){var y=X[0],x=X[1],u=X[2],H=Q[0],b=Q[1],D=Q[2],a=Q[3],R=a*y+b*u-D*x,L=a*x+D*y-H*u,f=a*u+H*x-b*y,k=-H*y-b*x-D*u;return q[0]=R*a+k*-H+L*-D-f*-b,q[1]=L*a+k*-b+f*-H-R*-D,q[2]=f*a+k*-D+R*-b-L*-H,q}},11990:q=>{"use strict";q.exports=function(q){for(var X=new Array(q),Q=0;Q<q;++Q)X[Q]=Q;return X}},12043:q=>{q.exports=function(q){return null!=q&&null!=q.constructor&&"function"===typeof q.constructor.isBuffer&&q.constructor.isBuffer(q)}},12261:(q,X,Q)=>{"use strict";Q.d(X,{c:()=>y});class y{constructor(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.ki=!1,this.li=!1,this.ii=30,this.ji=0,this.ti=!1,this.fullscreen=!1,this.ni=function(q){},this.oi=function(){},this.ri=function(){},this.bb=function(){},this.pi=function(q){},this.onFullscreenChanged=function(q){},a((()=>{!function(q,X){q._nowObject=performance||Date,q._lastTick=0,q._renderAccum=0,q._rt=0,q._frameCB=b.bind(null,q),requestAnimationFrame(q._frameCB),X>0&&(q._intervalCB=H.bind(null,q),q._interval=setInterval(q._intervalCB,Math.max(X,1e3/q.ii/2)))}(this,X),function(q,X){if(!X)return;var Q=!1,y=!1;document.addEventListener("pointerlockchange",(y=>{Q=document.pointerLockElement===X,q.pi(Q)})),document.addEventListener("fullscreenchange",(Q=>{y=document.fullscreenElement===X,q.onFullscreenChanged(y)})),Object.defineProperty(q,"ti",{get:()=>Q,set:q=>{q&&!Q?D(X):Q&&!q&&function(q){q.exitPointerLock&&q.exitPointerLock()}(document)}}),Object.defineProperty(q,"fullscreen",{get:()=>y,set:q=>{q&&!y?X.requestFullscreen():y&&!q&&document.exitFullscreen()}}),X.addEventListener("click",(x=>{q.ki&&!Q&&D(X),q.li&&!y&&X.requestFullscreen()}));var x=()=>q.bb();if(window.ResizeObserver){new ResizeObserver(x).observe(X)}else window.addEventListener("resize",x)}(this,q),this.ri()}))}}var x=3,u=20;function H(q){for(var X=1e3/q.ii,Q=q._nowObject.now()+u,y=0;q._nowObject.now()>=q._lastTick+X&&q._nowObject.now()<Q&&++y<=x;)q.ni(X),q._lastTick+=X;var H=5*(X+5),b=q._nowObject.now();if(b-q._lastTick>H)for(;b>=q._lastTick+X;)q._lastTick+=X}function b(q){requestAnimationFrame(q._frameCB),H(q);var X=q._nowObject.now(),Q=X-q._rt;if(q._rt=X,q.ji>0){q._renderAccum+=Q;var y=1e3/q.ji;if(q._renderAccum<y)return;q._renderAccum=Math.min(q._renderAccum-y,y)}var x=1e3/q.ii,u=(X-q._lastTick)/x;q.oi(Q,u,x)}function D(q){q.requestPointerLock&&q.requestPointerLock()}var a=q=>{if("loading"===document.readyState){var X=()=>{document.removeEventListener("readystatechange",X),q()};document.addEventListener("readystatechange",X)}else setTimeout(q,1)}},11981:(q,X,Q)=>{var y=Q(11990),x=Q(11996),u="undefined"!==typeof Float64Array;function H(q,X){return q[0]-X[0]}function b(){var q,X=this.stride,Q=new Array(X.length);for(q=0;q<Q.length;++q)Q[q]=[Math.abs(X[q]),q];Q.sort(H);var y=new Array(Q.length);for(q=0;q<y.length;++q)y[q]=Q[q][1];return y}function D(q,X){var Q=["View",X,"d",q].join("");X<0&&(Q="View_Nil"+q);var x="generic"===q;if(-1===X){var u="function "+Q+"(a){this.data=a;};var proto="+Q+".prototype;proto.dtype='"+q+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+Q+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+Q+"(a){return new "+Q+"(a);}";return new Function(u)()}if(0===X){u="function "+Q+"(a,d) {this.data = a;this.offset = d};var proto="+Q+".prototype;proto.dtype='"+q+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+Q+"_copy() {return new "+Q+"(this.data,this.offset)};proto.pick=function "+Q+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+Q+"_get(){return "+(x?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+Q+"_set(v){return "+(x?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+Q+"(a,b,c,d){return new "+Q+"(a,d)}";return new Function("TrivialArray",u)(a[q][0])}u=["'use strict'"];var H=y(X),D=H.map((function(q){return"i"+q})),R="this.offset+"+H.map((function(q){return"this.stride["+q+"]*i"+q})).join("+"),L=H.map((function(q){return"b"+q})).join(","),f=H.map((function(q){return"c"+q})).join(",");u.push("function "+Q+"(a,"+L+","+f+",d){this.data=a","this.shape=["+L+"]","this.stride=["+f+"]","this.offset=d|0}","var proto="+Q+".prototype","proto.dtype='"+q+"'","proto.dimension="+X),u.push("Object.defineProperty(proto,'size',{get:function "+Q+"_size(){return "+H.map((function(q){return"this.shape["+q+"]"})).join("*"),"}})"),1===X?u.push("proto.order=[0]"):(u.push("Object.defineProperty(proto,'order',{get:"),X<4?(u.push("function "+Q+"_order(){"),2===X?u.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===X&&u.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):u.push("ORDER})")),u.push("proto.set=function "+Q+"_set("+D.join(",")+",v){"),x?u.push("return this.data.set("+R+",v)}"):u.push("return this.data["+R+"]=v}"),u.push("proto.get=function "+Q+"_get("+D.join(",")+"){"),x?u.push("return this.data.get("+R+")}"):u.push("return this.data["+R+"]}"),u.push("proto.index=function "+Q+"_index(",D.join(),"){return "+R+"}"),u.push("proto.hi=function "+Q+"_hi("+D.join(",")+"){return new "+Q+"(this.data,"+H.map((function(q){return["(typeof i",q,"!=='number'||i",q,"<0)?this.shape[",q,"]:i",q,"|0"].join("")})).join(",")+","+H.map((function(q){return"this.stride["+q+"]"})).join(",")+",this.offset)}");var k=H.map((function(q){return"a"+q+"=this.shape["+q+"]"})),j=H.map((function(q){return"c"+q+"=this.stride["+q+"]"}));u.push("proto.lo=function "+Q+"_lo("+D.join(",")+"){var b=this.offset,d=0,"+k.join(",")+","+j.join(","));for(var I=0;I<X;++I)u.push("if(typeof i"+I+"==='number'&&i"+I+">=0){d=i"+I+"|0;b+=c"+I+"*d;a"+I+"-=d}");u.push("return new "+Q+"(this.data,"+H.map((function(q){return"a"+q})).join(",")+","+H.map((function(q){return"c"+q})).join(",")+",b)}"),u.push("proto.step=function "+Q+"_step("+D.join(",")+"){var "+H.map((function(q){return"a"+q+"=this.shape["+q+"]"})).join(",")+","+H.map((function(q){return"b"+q+"=this.stride["+q+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(I=0;I<X;++I)u.push("if(typeof i"+I+"==='number'){d=i"+I+"|0;if(d<0){c+=b"+I+"*(a"+I+"-1);a"+I+"=ceil(-a"+I+"/d)}else{a"+I+"=ceil(a"+I+"/d)}b"+I+"*=d}");u.push("return new "+Q+"(this.data,"+H.map((function(q){return"a"+q})).join(",")+","+H.map((function(q){return"b"+q})).join(",")+",c)}");var d=new Array(X),e=new Array(X);for(I=0;I<X;++I)d[I]="a[i"+I+"]",e[I]="b[i"+I+"]";u.push("proto.transpose=function "+Q+"_transpose("+D+"){"+D.map((function(q,X){return q+"=("+q+"===undefined?"+X+":"+q+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+Q+"(this.data,"+d.join(",")+","+e.join(",")+",this.offset)}"),u.push("proto.pick=function "+Q+"_pick("+D+"){var a=[],b=[],c=this.offset");for(I=0;I<X;++I)u.push("if(typeof i"+I+"==='number'&&i"+I+">=0){c=(c+this.stride["+I+"]*i"+I+")|0}else{a.push(this.shape["+I+"]);b.push(this.stride["+I+"])}");return u.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),u.push("return function construct_"+Q+"(data,shape,stride,offset){return new "+Q+"(data,"+H.map((function(q){return"shape["+q+"]"})).join(",")+","+H.map((function(q){return"stride["+q+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",u.join("\n"))(a[q],b)}var a={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};q.exports=function(q,X,Q,y){if(void 0===q)return(0,a.array[0])([]);"number"===typeof q&&(q=[q]),void 0===X&&(X=[q.length]);var H=X.length;if(void 0===Q){Q=new Array(H);for(var b=H-1,R=1;b>=0;--b)Q[b]=R,R*=X[b]}if(void 0===y){y=0;for(b=0;b<H;++b)Q[b]<0&&(y-=(X[b]-1)*Q[b])}for(var L=function(q){if(x(q))return"buffer";if(u)switch(Object.prototype.toString.call(q)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(q)?"array":"generic"}(q),f=a[L];f.length<=H+1;)f.push(D(L,f.length-1));return(0,f[H+1])(q,X,Q,y)}},11996:q=>{function X(q){return!!q.constructor&&"function"===typeof q.constructor.isBuffer&&q.constructor.isBuffer(q)}q.exports=function(q){return null!=q&&(X(q)||function(q){return"function"===typeof q.readFloatLE&&"function"===typeof q.slice&&X(q.slice(0,0))}(q)||!!q._isBuffer)}},12125:q=>{"use strict";var X=[],Q=[],y=[],x=[],u=[],H=[],b=[],D=[],a=[],R=[],L=[],f=[];q.exports=function(q,k,j,I,d,e){for(var i=b,A=a,B=R,w=f,V=0;V<3;V++)i[V]=+j[V],B[V]=+k.max[V],A[V]=+k.Hd[V];e||(e=1e-10);var W=function(q,b,a,R,f,k){var j=X,I=Q,d=y,e=x,i=u,A=H,B=D,w=Math.floor,V=0,W=0,v=0,Z=0,U=0;if(O(),0===v)return 0;for(Z=F();W<=v;){if(g(Z)&&P())return V;Z=F()}for(V+=v,U=0;U<3;U++)R[U]+=a[U],f[U]+=a[U];return V;function O(){if(W=0,0!==(v=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2])))for(var q=0;q<3;q++){var X=a[q]>=0;e[q]=X?1:-1;var Q=X?f[q]:R[q];j[q]=X?R[q]:f[q],I[q]=l(Q,e[q]),d[q]=m(j[q],e[q]),B[q]=a[q]/v,i[q]=Math.abs(1/B[q]);var y=X?I[q]+1-Q:Q-I[q];A[q]=i[q]<1/0?i[q]*y:1/0}}function g(X){for(var Q=e[0],y=0===X?I[0]:d[0],x=I[0]+Q,u=e[1],H=1===X?I[1]:d[1],b=I[1]+u,D=e[2],a=2===X?I[2]:d[2],R=I[2]+D,L=y;L!=x;L+=Q)for(var f=H;f!=b;f+=u)for(var k=a;k!=R;k+=D)if(q(L,f,k))return!0;return!1}function P(){V+=W;var q=e[Z],X=W/v,Q=L;for(U=0;U<3;U++){var y=a[U]*X;R[U]+=y,f[U]+=y,Q[U]=a[U]-y}if(q>0?f[Z]=Math.round(f[Z]):R[Z]=Math.round(R[Z]),b(V,Z,q,Q))return!0;for(U=0;U<3;U++)a[U]=Q[U];return O(),0===v}function F(){var q=A[0]<A[1]?A[0]<A[2]?0:2:A[1]<A[2]?1:2,X=A[q]-W;for(W=A[q],I[q]+=e[q],A[q]+=i[q],U=0;U<3;U++)j[U]+=X*B[U],d[U]=m(j[U],e[U]);return q}function l(q,X){return w(q-X*k)}function m(q,X){return w(q+X*k)}}(q,I,i,A,B,e);if(!d){for(V=0;V<3;V++)w[V]=j[V]>0?B[V]-k.max[V]:A[V]-k.Hd[V];k.translate(w)}return W}},12303:(q,X,Q)=>{"use strict";Q.d(X,{b:()=>L});var y=Q(12120),x=Q(11590);class u{constructor(q,X,Q,u,H,b,D){this.Og=new y(q.Hd,q.ph),this.mass=X,this.friction=Q,this.restitution=u,this.Vc=H,this.Dk=b,this.Xc=!!D,this.nh=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.pl=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.gg=x.create(),this.Ig=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=x.create(),this._impulses=x.create(),this._sleepFrameCount=10}loadFromCopy(q){x.j(this.Og.Hd,q.Og.Hd),x.j(this.Og.ph,q.Og.ph),x.j(this.Og.max,q.Og.max),this.Og.mag=q.Og.mag,this.mass=q.mass,this.friction=q.friction,this.restitution=q.restitution,this.Vc=q.Vc,this.Dk=q.Dk,this.Xc=q.Xc,this.nh=q.nh,this.fluidDrag=q.fluidDrag,this.pl=q.pl,this.preventFallOffEdge=q.preventFallOffEdge,this.rolledBackLastTick=q.rolledBackLastTick,x.j(this.gg,q.gg),x.j(this.Ig,q.Ig),this.inFluid=q.inFluid,this._ratioInFluid=q._ratioInFluid,x.j(this._forces,q._forces),x.j(this._impulses,q._impulses),this._sleepFrameCount=q._sleepFrameCount}setPosition(q){H(q),x.Sc(q,q,this.Og.Hd),this.Og.translate(q),this.kg()}cb(){return x.clone(this.Og.Hd)}applyForce(q){H(q),x.add(this._forces,this._forces,q),this.kg()}applyImpulse(q){H(q),x.add(this._impulses,this._impulses,q),this.kg()}kg(){this._sleepFrameCount=10}atRestX(){return this.Ig[0]}atRestY(){return this.Ig[1]}atRestZ(){return this.Ig[2]}}var H=q=>{};var b=Q(12120),D=Q(11590),a=Q(12125);function R(){this.nh=.1,this.fluidDrag=.4,this.fd=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function L(q,X,Q){q=Object.assign(new R,q),this.gravity=q.gravity||[0,-10,0],this.nh=q.nh||.1,this.fd=q.fd||2,this.fluidDrag=q.fluidDrag||.4,this.minBounceImpulse=q.minBounceImpulse,this.bodies=[],this.$j=q.$j,this.testSolid=X,this.testFluid=Q}L.prototype.Kk=function(q,X,Q,y,x,H){q=q||new b([0,0,0],[1,1,1]),"undefined"==typeof X&&(X=1),"undefined"==typeof Q&&(Q=1),"undefined"==typeof y&&(y=0),"undefined"==typeof x&&(x=1);var D=new u(q,X,Q,y,x,H);return this.bodies.push(D),D},L.prototype.Lk=function(q){var X=this.bodies.indexOf(q);X<0||(this.bodies.splice(X,1),q.Og=q.Dk=null)};var f=D.create(),k=D.create(),j=D.create(),I=D.create(),d=D.create(),e=D.create(),i=D.create(),A=new b([0,0,0],[1,1,1]),B=new u(A,1,1,0,1,(()=>{}),!1);function w(q,X,Q){return X=Q,X*=1-(1-q.ratioInFluid)**2}L.prototype.cf=function(q){q/=1e3;var X=S(0,D.squaredLength(this.gravity));this.bodies.forEach((Q=>function(q,X,Q,y){D.j(d,X.Ig),q.$j&&B.loadFromCopy(X);if(X.mass<=0)return D.set(X.gg,0,0,0),D.set(X._forces,0,0,0),void D.set(X._impulses,0,0,0);var x=y||0===X.Vc;if(function(q,X,Q,y){if(X._sleepFrameCount>0)return!1;if(y)return!0;var x=!1,u=.5*Q*Q*X.Vc;return D.scale(N,q.gravity,u),a(q.testSolid,X.Og,N,(function(){return x=!0,!0}),!0),x}(q,X,Q,x))return;X._sleepFrameCount--,function(q,X){var Q=X.Og,y=Math.floor(Q.Hd[0]),x=Math.floor(Q.Hd[2]),u=Math.floor(Q.Hd[1]),H=Math.floor(Q.max[1]);if(!q.testFluid(y,u,x))return X.inFluid=!1,void(X.ratioInFluid=0);var b=1,a=u+1;for(;a<=H&&q.testFluid(y,a,x);)b++,a++;var R=(u+b-Q.Hd[1])/Q.ph[1];R>1&&(R=1);var L=Q.ph[0]*Q.ph[1]*Q.ph[2]*R,f=W;D.scale(f,q.gravity,-q.fd*L*X.Vc),X.applyForce(f),X.inFluid=!0,X.ratioInFluid=R}(q,X),p(X._forces),p(X._impulses),p(X.gg),p(X.Ig),D.scale(f,X._forces,1/X.mass),D.td(f,f,q.gravity,X.Vc),D.scale(k,X._impulses,1/X.mass),D.td(k,k,f,Q),D.add(X.gg,X.gg,k),X.friction&&(v(q,0,X,k,Q),v(q,1,X,k,Q),v(q,2,X,k,Q));var u=X.fluidDrag>=0?X.fluidDrag:q.fluidDrag,H=X.nh>=0?X.nh:q.nh,b=H,R=H;X.inFluid&&(b=w(X,b,X.fluidDragHoriz>=0?X.fluidDragHoriz:u),R=w(X,R,X.fluidDragVert>=0?X.fluidDragVert:u));b=Math.max(1-b*Q/X.mass,0),R=Math.max(1-R*Q/X.mass,0),D.set(V,b,R,b),D.multiply(X.gg,X.gg,V),D.scale(j,X.gg,Q),D.set(X._forces,0,0,0),D.set(X._impulses,0,0,0),X.Xc&&c(O,X.Og);D.j(e,j),D.set(i,0,0,0),X.preventFallOffEdge&&function(q,X,Q,y){if(!X.Ig[1]||Q[1]>0)return;var x=M;c(x,X.Og);for(var u=0;u<3;u+=2){D.set(m,0,0,0),m[u]=Q[u];var H=!0;(H=(H=(H=(H=H&&!Y(q,x.Hd[0]+m[0]+1e-5,x.Hd[1],x.Hd[2]+m[2]+1e-5))&&!Y(q,x.max[0]+m[0]-1e-5,x.Hd[1],x.Hd[2]+m[2]+1e-5))&&!Y(q,x.Hd[0]+m[0]+1e-5,x.Hd[1],x.max[2]+m[2]-1e-5))&&!Y(q,x.max[0]+m[0]-1e-5,x.Hd[1],x.max[2]+m[2]-1e-5))?(y[u]=Q[u]>0?1:-1,Q[u]=0):0===u&&(D.set(o,Q[0],0,0),U(q,x,o,y,X.slideOnCollision))}}(q,X,j,i);U(q,X.Og,j,X.Ig,X.slideOnCollision),X.Xc&&function(q,X,Q,y){if(X.Ig[1]>=0&&!X.inFluid)return;var x=0!==X.Ig[0],u=0!==X.Ig[2];if(!x&&!u)return;var H=Math.abs(y[0]/y[2]),b=4;if(!x&&H>b)return;if(!u&&H<1/b)return;D.add(P,Q.Hd,y);var R=q.testSolid;a(R,Q,y,(function(q,X,Q,y){if(1!==X)return!0;y[X]=0}));var L=Q.Hd[1],f=X.inFluid?1.951:1.001,k=Math.floor(L+f)-L;D.set(F,0,k,0);var j=!1;if(a(R,Q,F,(function(q,X,Q,y){return j=!0,!0})),j)return;D.Sc(l,P,Q.Hd),l[1]=0,U(q,Q,l,g,!0);var I=S(Q.Hd[0],P[0]),d=S(Q.Hd[2],P[2]);if(x&&!I&&(!d||!u))return;if(u&&(!I||!x)&&!d)return;var e=!0;if(e=e&&!Y(q,Q.Hd[0]+1e-5,Q.Hd[1],Q.Hd[2]+1e-5),e=e&&!Y(q,Q.max[0]-1e-5,Q.Hd[1],Q.Hd[2]+1e-5),e=e&&!Y(q,Q.Hd[0]+1e-5,Q.Hd[1],Q.max[2]-1e-5),e=e&&!Y(q,Q.max[0]-1e-5,Q.Hd[1],Q.max[2]-1e-5),e)return;c(X.Og,Q),X.Ig[0]=g[0],X.Ig[2]=g[2],X.pl&&X.pl()}(q,X,O,e);for(var L=0;L<3;++L)X.Ig[L]=X.Ig[L]||i[L],I[L]=0,X.Ig[L]&&(d[L]||(I[L]=-X.gg[L]),X.gg[L]=0);var A=D.length(I);A>.001&&(D.scale(I,I,X.mass),X.Dk&&X.Dk(I),X.restitution>0&&A>q.minBounceImpulse&&(D.scale(I,I,X.restitution),X.applyImpulse(I)));var Z=D.squaredLength(X.gg);Z>1e-5&&X.kg();q.$j&&q.$j(X)?(X.loadFromCopy(B),X.rolledBackLastTick=!0):X.rolledBackLastTick=!1}(this,Q,q,X)))};var V=D.create([0,0,0]);var W=D.create();function v(q,X,Q,y,x){var u=Q.Ig[X],H=y[X];if(!Q.alwaysApplyHorizFriction||1!==X){if(0===u)return;if(u*H<=0)return}D.j(Z,Q.gg),Z[X]=0;var b=D.length(Z);if(!S(b,0)){var a=Math.abs(Q.friction*q.gravity[X]*x),R=b>a?(b-a)/b:0;Q.gg[(X+1)%3]*=R,Q.gg[(X+2)%3]*=R}}var Z=D.create();function U(q,X,Q,y,x){return D.set(y,0,0,0),a(q.testSolid,X,Q,(function(q,X,Q,u){y[X]=Q,u[X]=0,x||(u[0]=0,u[1]=0,u[2]=0)}))}var O=new b([],[]),g=D.create(),P=D.create(),F=D.create(),l=D.create();var m=D.create(),M=new b([],[]),o=D.create();function Y(q,X,Q,y){return q.testSolid(Math.floor(X),Math.floor(Q-1),Math.floor(y))}var N=D.create();function S(q,X){return Math.abs(q-X)<1e-5}function c(q,X){for(var Q=0;Q<3;Q++)q.Hd[Q]=X.Hd[Q],q.max[Q]=X.max[Q],q.ph[Q]=X.ph[Q]}var p=function(q){}},11065:function(q,X){!function(q){"use strict";var X=function(q,Q){return X=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(q,X){q.__proto__=X}||function(q,X){for(var Q in X)Object.prototype.hasOwnProperty.call(X,Q)&&(q[Q]=X[Q])},X(q,Q)};function Q(q,Q){if("function"!==typeof Q&&null!==Q)throw new TypeError("Class extends value "+String(Q)+" is not a constructor or null");function y(){this.constructor=q}X(q,Q),q.prototype=null===Q?Object.create(Q):(y.prototype=Q.prototype,new y)}function y(q,X,Q,y){var x,u=arguments.length,H=u<3?X:null===y?y=Object.getOwnPropertyDescriptor(X,Q):y;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)H=Reflect.decorate(q,X,Q,y);else for(var b=q.length-1;b>=0;b--)(x=q[b])&&(H=(u<3?x(H):u>3?x(X,Q,H):x(X,Q))||H);return u>3&&H&&Object.defineProperty(X,Q,H),H}function x(q,X,Q){if(Q||2===arguments.length)for(var y,x=0,u=X.length;x<u;x++)!y&&x in X||(y||(y=Array.prototype.slice.call(X,0,x)),y[x]=X[x]);return q.concat(y||Array.prototype.slice.call(X))}var u,H=255,b=213;q.OPERATION=void 0,(u=q.OPERATION||(q.OPERATION={}))[u.ADD=128]="ADD",u[u.REPLACE=0]="REPLACE",u[u.DELETE=64]="DELETE",u[u.DELETE_AND_ADD=192]="DELETE_AND_ADD",u[u.TOUCH=1]="TOUCH",u[u.CLEAR=10]="CLEAR";var D=function(){function X(q,X,Q){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=q,this.setParent(X,Q)}return X.prototype.setParent=function(q,X,Q){var y=this;if(this.indexes||(this.indexes=this.ref instanceof lq?this.ref._definition.indexes:{}),this.parent=q,this.parentIndex=Q,X)if(this.root=X,this.ref instanceof lq){var x=this.ref._definition;for(var u in x.schema){var H=this.ref[u];if(H&&H.$changes){var b=x.indexes[u];H.$changes.setParent(this.ref,X,b)}}}else"object"===typeof this.ref&&this.ref.forEach((function(q,X){if(q instanceof lq){var Q=q.$changes,x=y.ref.$changes.indexes[X];Q.setParent(y.ref,y.root,x)}}))},X.prototype.operation=function(q){this.changes.set(--this.currentCustomOperation,q)},X.prototype.change=function(X,Q){void 0===Q&&(Q=q.OPERATION.ADD);var y="number"===typeof X?X:this.indexes[X];this.assertValidIndex(y,X);var x=this.changes.get(y);x&&x.op!==q.OPERATION.DELETE&&x.op!==q.OPERATION.TOUCH||this.changes.set(y,{op:x&&x.op===q.OPERATION.DELETE?q.OPERATION.DELETE_AND_ADD:Q,index:y}),this.allChanges.add(y),this.changed=!0,this.touchParents()},X.prototype.touch=function(X){var Q="number"===typeof X?X:this.indexes[X];this.assertValidIndex(Q,X),this.changes.has(Q)||this.changes.set(Q,{op:q.OPERATION.TOUCH,index:Q}),this.allChanges.add(Q),this.touchParents()},X.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},X.prototype.getType=function(q){if(this.ref._definition)return(X=this.ref._definition).schema[X.fieldsByIndex[q]];var X,Q=(X=this.parent._definition).schema[X.fieldsByIndex[this.parentIndex]];return Object.values(Q)[0]},X.prototype.getChildrenFilter=function(){var q=this.parent._definition.childFilters;return q&&q[this.parentIndex]},X.prototype.getValue=function(q){return this.ref.getByIndex(q)},X.prototype.delete=function(X){var Q="number"===typeof X?X:this.indexes[X];if(void 0!==Q){var y=this.getValue(Q);this.changes.set(Q,{op:q.OPERATION.DELETE,index:Q}),this.allChanges.delete(Q),delete this.caches[Q],y&&y.$changes&&(y.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(X," (").concat(Q,")"))},X.prototype.discard=function(X,Q){var y=this;void 0===X&&(X=!1),void 0===Q&&(Q=!1),this.ref instanceof lq||this.changes.forEach((function(X){if(X.op===q.OPERATION.DELETE){var Q=y.ref.getIndex(X.index);delete y.indexes[Q]}})),this.changes.clear(),this.changed=X,Q&&this.allChanges.clear(),this.currentCustomOperation=0},X.prototype.discardAll=function(){var q=this;this.changes.forEach((function(X){var Q=q.getValue(X.index);Q&&Q.$changes&&Q.$changes.discardAll()})),this.discard()},X.prototype.cache=function(q,X){this.caches[q]=X},X.prototype.clone=function(){return new X(this.ref,this.parent,this.root)},X.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},X.prototype.assertValidIndex=function(q,X){if(void 0===q)throw new Error('ChangeTree: missing index for field "'.concat(X,'"'))},X}();function a(q,X,Q,y){return q[X]||(q[X]=[]),q[X].push(Q),null===y||void 0===y||y.forEach((function(q,X){return Q(q,X)})),function(){return L(q[X],q[X].indexOf(Q))}}function R(X){var Q=this,y="string"!==typeof this.$changes.getType();this.$items.forEach((function(x,u){X.push({refId:Q.$changes.refId,op:q.OPERATION.DELETE,field:u,value:void 0,previousValue:x}),y&&Q.$changes.root.removeRef(x.$changes.refId)}))}function L(q,X){if(-1===X||X>=q.length)return!1;for(var Q=q.length-1,y=X;y<Q;y++)q[y]=q[y+1];return q.length=Q,!0}var f=function(q,X){var Q=q.toString(),y=X.toString();return Q<y?-1:Q>y?1:0};function k(q){return q.$proxy=!0,q=new Proxy(q,{get:function(q,X){return"symbol"===typeof X||isNaN(X)?q[X]:q.at(X)},set:function(q,X,Q){if("symbol"===typeof X||isNaN(X))q[X]=Q;else{var y=Array.from(q.$items.keys()),x=parseInt(y[X]||X);void 0===Q||null===Q?q.deleteAt(x):q.setAt(x,Q)}return!0},deleteProperty:function(q,X){return"number"===typeof X?q.deleteAt(X):delete q[X],!0}})}var j=function(){function X(){for(var q=[],X=0;X<arguments.length;X++)q[X]=arguments[X];this.$changes=new D(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,q)}return X.prototype.Af=function(X,Q){return void 0===Q&&(Q=!0),a(this.$callbacks||(this.$callbacks=[]),q.OPERATION.ADD,X,Q?this.$items:void 0)},X.prototype.ab=function(X){return a(this.$callbacks||(this.$callbacks=[]),q.OPERATION.DELETE,X)},X.prototype.onChange=function(X){return a(this.$callbacks||(this.$callbacks=[]),q.OPERATION.REPLACE,X)},X.is=function(q){return Array.isArray(q)||void 0!==q.array},Object.defineProperty(X.prototype,"length",{get:function(){return this.$items.size},set:function(q){0===q?this.clear():this.splice(q,this.length-q)},enumerable:!1,configurable:!0}),X.prototype.push=function(){for(var q,X=this,Q=[],y=0;y<arguments.length;y++)Q[y]=arguments[y];return Q.forEach((function(Q){q=X.$refId++,X.setAt(q,Q)})),q},X.prototype.pop=function(){var q=Array.from(this.$indexes.values()).pop();if(void 0!==q){this.$changes.delete(q),this.$indexes.delete(q);var X=this.$items.get(q);return this.$items.delete(q),X}},X.prototype.at=function(q){var X=Array.from(this.$items.keys())[q];return this.$items.get(X)},X.prototype.setAt=function(X,Q){var y,x;if(void 0!==Q&&null!==Q){if(this.$items.get(X)!==Q){void 0!==Q.$changes&&Q.$changes.setParent(this,this.$changes.root,X);var u=null!==(x=null===(y=this.$changes.indexes[X])||void 0===y?void 0:y.op)&&void 0!==x?x:q.OPERATION.ADD;this.$changes.indexes[X]=X,this.$indexes.set(X,X),this.$items.set(X,Q),this.$changes.change(X,u)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},X.prototype.deleteAt=function(q){var X=Array.from(this.$items.keys())[q];return void 0!==X&&this.$deleteAt(X)},X.prototype.$deleteAt=function(q){return this.$changes.delete(q),this.$indexes.delete(q),this.$items.delete(q)},X.prototype.clear=function(X){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),X&&R.call(this,X),this.$items.clear(),this.$changes.operation({index:0,op:q.OPERATION.CLEAR}),this.$changes.touchParents()},X.prototype.concat=function(){for(var q,Q=[],y=0;y<arguments.length;y++)Q[y]=arguments[y];return new(X.bind.apply(X,x([void 0],(q=Array.from(this.$items.values())).concat.apply(q,Q),!1)))},X.prototype.join=function(q){return Array.from(this.$items.values()).join(q)},X.prototype.reverse=function(){var q=this,X=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(Q,y){q.setAt(X[y],Q)})),this},X.prototype.shift=function(){var q=Array.from(this.$items.keys()).shift();if(void 0!==q){var X=this.$items.get(q);return this.$deleteAt(q),X}},X.prototype.slice=function(q,Q){var y=new X;return y.push.apply(y,Array.from(this.$items.values()).slice(q,Q)),y},X.prototype.sort=function(q){var X=this;void 0===q&&(q=f);var Q=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(q).forEach((function(q,y){X.setAt(Q[y],q)})),this},X.prototype.splice=function(q,X){void 0===X&&(X=this.length-q);for(var Q=Array.from(this.$items.keys()),y=[],x=q;x<q+X;x++)y.push(this.$items.get(Q[x])),this.$deleteAt(Q[x]);return y},X.prototype.unshift=function(){for(var q=this,X=[],Q=0;Q<arguments.length;Q++)X[Q]=arguments[Q];var y=this.length,x=X.length,u=Array.from(this.$items.values());return X.forEach((function(X,Q){q.setAt(Q,X)})),u.forEach((function(X,Q){q.setAt(x+Q,X)})),y+x},X.prototype.indexOf=function(q,X){return Array.from(this.$items.values()).indexOf(q,X)},X.prototype.lastIndexOf=function(q,X){return void 0===X&&(X=this.length-1),Array.from(this.$items.values()).lastIndexOf(q,X)},X.prototype.every=function(q,X){return Array.from(this.$items.values()).every(q,X)},X.prototype.some=function(q,X){return Array.from(this.$items.values()).some(q,X)},X.prototype.forEach=function(q,X){Array.from(this.$items.values()).forEach(q,X)},X.prototype.map=function(q,X){return Array.from(this.$items.values()).map(q,X)},X.prototype.filter=function(q,X){return Array.from(this.$items.values()).filter(q,X)},X.prototype.reduce=function(q,X){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},X.prototype.reduceRight=function(q,X){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},X.prototype.find=function(q,X){return Array.from(this.$items.values()).find(q,X)},X.prototype.findIndex=function(q,X){return Array.from(this.$items.values()).findIndex(q,X)},X.prototype.fill=function(q,X,Q){throw new Error("ArraySchema#fill() not implemented")},X.prototype.copyWithin=function(q,X,Q){throw new Error("ArraySchema#copyWithin() not implemented")},X.prototype.toString=function(){return this.$items.toString()},X.prototype.toLocaleString=function(){return this.$items.toLocaleString()},X.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(X,Symbol.species,{get:function(){return X},enumerable:!1,configurable:!0}),X.prototype.entries=function(){return this.$items.entries()},X.prototype.keys=function(){return this.$items.keys()},X.prototype.values=function(){return this.$items.values()},X.prototype.includes=function(q,X){return Array.from(this.$items.values()).includes(q,X)},X.prototype.flatMap=function(q,X){throw new Error("ArraySchema#flatMap() is not supported.")},X.prototype.flat=function(q){throw new Error("ArraySchema#flat() is not supported.")},X.prototype.findLast=function(){var q=Array.from(this.$items.values());return q.findLast.apply(q,arguments)},X.prototype.findLastIndex=function(){var q=Array.from(this.$items.values());return q.findLastIndex.apply(q,arguments)},X.prototype.setIndex=function(q,X){this.$indexes.set(q,X)},X.prototype.getIndex=function(q){return this.$indexes.get(q)},X.prototype.getByIndex=function(q){return this.$items.get(this.$indexes.get(q))},X.prototype.deleteByIndex=function(q){var X=this.$indexes.get(q);this.$items.delete(X),this.$indexes.delete(q)},X.prototype.toArray=function(){return Array.from(this.$items.values())},X.prototype.toJSON=function(){return this.toArray().map((function(q){return"function"===typeof q.toJSON?q.toJSON():q}))},X.prototype.clone=function(q){return q?new(X.bind.apply(X,x([void 0],Array.from(this.$items.values()),!1))):new(X.bind.apply(X,x([void 0],this.map((function(q){return q.$changes?q.clone():q})),!1)))},X}();function I(q){return q.$proxy=!0,q=new Proxy(q,{get:function(q,X){return"symbol"!==typeof X&&"undefined"===typeof q[X]?q.get(X):q[X]},set:function(q,X,Q){return"symbol"!==typeof X&&-1===X.indexOf("$")&&"Af"!==X&&"ab"!==X&&"onChange"!==X?q.set(X,Q):q[X]=Q,!0},deleteProperty:function(q,X){return q.delete(X),!0}})}var d=function(){function X(q){var Q=this;if(this.$changes=new D(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,q)if(q instanceof Map||q instanceof X)q.forEach((function(q,X){return Q.set(X,q)}));else for(var y in q)this.set(y,q[y])}return X.prototype.Af=function(X,Q){return void 0===Q&&(Q=!0),a(this.$callbacks||(this.$callbacks=[]),q.OPERATION.ADD,X,Q?this.$items:void 0)},X.prototype.ab=function(X){return a(this.$callbacks||(this.$callbacks=[]),q.OPERATION.DELETE,X)},X.prototype.onChange=function(X){return a(this.$callbacks||(this.$callbacks=[]),q.OPERATION.REPLACE,X)},X.is=function(q){return void 0!==q.map},X.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(X.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(X,Symbol.species,{get:function(){return X},enumerable:!1,configurable:!0}),X.prototype.set=function(X,Q){if(void 0===Q||null===Q)throw new Error("MapSchema#set('".concat(X,"', ").concat(Q,"): trying to set ").concat(Q," value on '").concat(X,"'."));X=X.toString();var y="undefined"!==typeof this.$changes.indexes[X],x=y?this.$changes.indexes[X]:this.$refId++,u=y?q.OPERATION.REPLACE:q.OPERATION.ADD,H=void 0!==Q.$changes;if(H&&Q.$changes.setParent(this,this.$changes.root,x),y){if(!H&&this.$items.get(X)===Q)return;H&&this.$items.get(X)!==Q&&(u=q.OPERATION.ADD)}else this.$changes.indexes[X]=x,this.$indexes.set(x,X);return this.$items.set(X,Q),this.$changes.change(X,u),this},X.prototype.get=function(q){return this.$items.get(q)},X.prototype.delete=function(q){return this.$changes.delete(q),this.$items.delete(q)},X.prototype.clear=function(X){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),X&&R.call(this,X),this.$items.clear(),this.$changes.operation({index:0,op:q.OPERATION.CLEAR}),this.$changes.touchParents()},X.prototype.has=function(q){return this.$items.has(q)},X.prototype.forEach=function(q){this.$items.forEach(q)},X.prototype.entries=function(){return this.$items.entries()},X.prototype.keys=function(){return this.$items.keys()},X.prototype.values=function(){return this.$items.values()},Object.defineProperty(X.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),X.prototype.setIndex=function(q,X){this.$indexes.set(q,X)},X.prototype.getIndex=function(q){return this.$indexes.get(q)},X.prototype.getByIndex=function(q){return this.$items.get(this.$indexes.get(q))},X.prototype.deleteByIndex=function(q){var X=this.$indexes.get(q);this.$items.delete(X),this.$indexes.delete(q)},X.prototype.toJSON=function(){var q={};return this.forEach((function(X,Q){q[Q]="function"===typeof X.toJSON?X.toJSON():X})),q},X.prototype.clone=function(q){var Q;return q?Q=Object.assign(new X,this):(Q=new X,this.forEach((function(q,X){q.$changes?Q.set(X,q.clone()):Q.set(X,q)}))),Q},X}(),e={};function i(q,X){e[q]=X}function A(q){return e[q]}var B=function(){function q(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return q.create=function(X){var Q=new q;return Q.schema=Object.assign({},X&&X.schema||{}),Q.indexes=Object.assign({},X&&X.indexes||{}),Q.fieldsByIndex=Object.assign({},X&&X.fieldsByIndex||{}),Q.descriptors=Object.assign({},X&&X.descriptors||{}),Q.deprecated=Object.assign({},X&&X.deprecated||{}),Q},q.prototype.addField=function(q,X){var Q=this.getNextFieldIndex();this.fieldsByIndex[Q]=q,this.indexes[q]=Q,this.schema[q]=Array.isArray(X)?{array:X[0]}:X},q.prototype.hasField=function(q){return void 0!==this.indexes[q]},q.prototype.addFilter=function(q,X){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[q]]=X,this.indexesWithFilters.push(this.indexes[q]),!0},q.prototype.addChildrenFilter=function(q,X){var Q=this.indexes[q],y=this.schema[q];if(A(Object.keys(y)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[Q]=X,!0;console.warn("@filterChildren: field '".concat(q,"' can't have children. Ignoring filter."))},q.prototype.getChildrenFilter=function(q){return this.childFilters&&this.childFilters[this.indexes[q]]},q.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},q}();function w(q){return q._context&&q._context.useFilters}var V=function(){function q(){this.types={},this.schemas=new Map,this.useFilters=!1}return q.prototype.has=function(q){return this.schemas.has(q)},q.prototype.get=function(q){return this.types[q]},q.prototype.add=function(q,X){void 0===X&&(X=this.schemas.size),q._definition=B.create(q._definition),q._typeid=X,this.types[X]=q,this.schemas.set(q,X)},q.create=function(X){return void 0===X&&(X={}),function(Q){return X.context||(X.context=new q),v(Q,X)}},q}(),W=new V;function v(q,X){return void 0===X&&(X={}),function(Q,y){var u=X.context||W,H=Q.constructor;if(H._context=u,!q)throw new Error("".concat(H.name,': @type() reference provided for "').concat(y,"\" is undefined. Make sure you don't have any circular dependencies."));u.has(H)||u.add(H);var b=H._definition;if(b.addField(y,q),b.descriptors[y]){if(b.deprecated[y])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(y,"' definition on '").concat(H.name,"'.\nCheck @type() annotation"))}catch(e){var D=e.stack.split("\n")[4].trim();throw new Error("".concat(e.message," ").concat(D))}}var a=j.is(q),R=!a&&d.is(q);if("string"!==typeof q&&!lq.is(q)){var L=Object.values(q)[0];"string"===typeof L||u.has(L)||u.add(L)}if(X.manual)b.descriptors[y]={enumerable:!0,configurable:!0,writable:!0};else{var f="_".concat(y);b.descriptors[f]={enumerable:!1,configurable:!1,writable:!0},b.descriptors[y]={get:function(){return this[f]},set:function(q){q!==this[f]&&(void 0!==q&&null!==q?(!a||q instanceof j||(q=new(j.bind.apply(j,x([void 0],q,!1)))),!R||q instanceof d||(q=new d(q)),void 0===q.$proxy&&(R?q=I(q):a&&(q=k(q))),this.$changes.change(y),q.$changes&&q.$changes.setParent(this,this.$changes.root,this._definition.indexes[y])):this[f]&&this.$changes.delete(y),this[f]=q)},enumerable:!0,configurable:!0}}}}function Z(q){return function(X,Q){var y=X.constructor;y._definition.addFilter(Q,q)&&(y._context.useFilters=!0)}}function U(q){return function(X,Q){var y=X.constructor;y._definition.addChildrenFilter(Q,q)&&(y._context.useFilters=!0)}}function O(q){return void 0===q&&(q=!0),function(X,Q){var y=X.constructor._definition;y.deprecated[Q]=!0,q&&(y.descriptors[Q]={get:function(){throw new Error("".concat(Q," is deprecated."))},set:function(q){},enumerable:!1,configurable:!0})}}function g(q,X,Q){for(var y in void 0===Q&&(Q={}),Q.context||(Q.context=q._context||Q.context||W),X)v(X[y],Q)(q.prototype,y);return q}function P(q){for(var X=0,Q=0,y=0,x=q.length;y<x;y++)(X=q.charCodeAt(y))<128?Q+=1:X<2048?Q+=2:X<55296||X>=57344?Q+=3:(y++,Q+=4);return Q}function F(q,X,Q){for(var y=0,x=0,u=Q.length;x<u;x++)(y=Q.charCodeAt(x))<128?q[X++]=y:y<2048?(q[X++]=192|y>>6,q[X++]=128|63&y):y<55296||y>=57344?(q[X++]=224|y>>12,q[X++]=128|y>>6&63,q[X++]=128|63&y):(x++,y=65536+((1023&y)<<10|1023&Q.charCodeAt(x)),q[X++]=240|y>>18,q[X++]=128|y>>12&63,q[X++]=128|y>>6&63,q[X++]=128|63&y)}function l(q,X){q.push(255&X)}function m(q,X){q.push(255&X)}function M(q,X){q.push(255&X),q.push(X>>8&255)}function o(q,X){q.push(255&X),q.push(X>>8&255)}function Y(q,X){q.push(255&X),q.push(X>>8&255),q.push(X>>16&255),q.push(X>>24&255)}function N(q,X){var Q=X>>24,y=X>>16,x=X>>8,u=X;q.push(255&u),q.push(255&x),q.push(255&y),q.push(255&Q)}function S(q,X){var Q=Math.floor(X/Math.pow(2,32));N(q,X>>>0),N(q,Q)}function c(q,X){var Q=X/Math.pow(2,32)|0;N(q,X>>>0),N(q,Q)}function p(q,X){G(q,X)}function t(q,X){C(q,X)}var z=new Int32Array(2),K=new Float32Array(z.buffer),h=new Float64Array(z.buffer);function G(q,X){K[0]=X,Y(q,z[0])}function C(q,X){h[0]=X,Y(q,z[0]),Y(q,z[1])}function E(q,X){return m(q,X?1:0)}function J(q,X){X||(X="");var Q=P(X),y=0;if(Q<32)q.push(160|Q),y=1;else if(Q<256)q.push(217),m(q,Q),y=2;else if(Q<65536)q.push(218),o(q,Q),y=3;else{if(!(Q<4294967296))throw new Error("String too long");q.push(219),N(q,Q),y=5}return F(q,q.length,X),y+Q}function n(q,X){return isNaN(X)?n(q,0):isFinite(X)?X!==(0|X)?(q.push(203),C(q,X),9):X>=0?X<128?(m(q,X),1):X<256?(q.push(204),m(q,X),2):X<65536?(q.push(205),o(q,X),3):X<4294967296?(q.push(206),N(q,X),5):(q.push(207),c(q,X),9):X>=-32?(q.push(224|X+32),1):X>=-128?(q.push(208),l(q,X),2):X>=-32768?(q.push(209),M(q,X),3):X>=-2147483648?(q.push(210),Y(q,X),5):(q.push(211),S(q,X),9):n(q,X>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var r=Object.freeze({__proto__:null,utf8Write:F,int8:l,uint8:m,int16:M,uint16:o,int32:Y,uint32:N,int64:S,uint64:c,float32:p,float64:t,writeFloat32:G,writeFloat64:C,boolean:E,string:J,number:n});function s(q,X,Q){for(var y="",x=0,u=X,H=X+Q;u<H;u++){var b=q[u];0!==(128&b)?192!==(224&b)?224!==(240&b)?240!==(248&b)?console.error("Invalid byte "+b.toString(16)):(x=(7&b)<<18|(63&q[++u])<<12|(63&q[++u])<<6|63&q[++u])>=65536?(x-=65536,y+=String.fromCharCode(55296+(x>>>10),56320+(1023&x))):y+=String.fromCharCode(x):y+=String.fromCharCode((15&b)<<12|(63&q[++u])<<6|63&q[++u]):y+=String.fromCharCode((31&b)<<6|63&q[++u]):y+=String.fromCharCode(b)}return y}function T(q,X){return qq(q,X)<<24>>24}function qq(q,X){return q[X.offset++]}function Xq(q,X){return Qq(q,X)<<16>>16}function Qq(q,X){return q[X.offset++]|q[X.offset++]<<8}function yq(q,X){return q[X.offset++]|q[X.offset++]<<8|q[X.offset++]<<16|q[X.offset++]<<24}function xq(q,X){return yq(q,X)>>>0}function uq(q,X){return fq(q,X)}function Hq(q,X){return kq(q,X)}function bq(q,X){var Q=xq(q,X);return yq(q,X)*Math.pow(2,32)+Q}function Dq(q,X){var Q=xq(q,X);return xq(q,X)*Math.pow(2,32)+Q}var aq=new Int32Array(2),Rq=new Float32Array(aq.buffer),Lq=new Float64Array(aq.buffer);function fq(q,X){return aq[0]=yq(q,X),Rq[0]}function kq(q,X){return aq[0]=yq(q,X),aq[1]=yq(q,X),Lq[0]}function jq(q,X){return qq(q,X)>0}function Iq(q,X){var Q,y=q[X.offset++];y<192?Q=31&y:217===y?Q=qq(q,X):218===y?Q=Qq(q,X):219===y&&(Q=xq(q,X));var x=s(q,X.offset,Q);return X.offset+=Q,x}function dq(q,X){var Q=q[X.offset];return Q<192&&Q>160||217===Q||218===Q||219===Q}function eq(q,X){var Q=q[X.offset++];return Q<128?Q:202===Q?fq(q,X):203===Q?kq(q,X):204===Q?qq(q,X):205===Q?Qq(q,X):206===Q?xq(q,X):207===Q?Dq(q,X):208===Q?T(q,X):209===Q?Xq(q,X):210===Q?yq(q,X):211===Q?bq(q,X):Q>223?-1*(255-Q+1):void 0}function iq(q,X){var Q=q[X.offset];return Q<128||Q>=202&&Q<=211}function Aq(q,X){return q[X.offset]<160}function Bq(q,X){return q[X.offset-1]===H&&(q[X.offset]<128||q[X.offset]>=202&&q[X.offset]<=211)}var wq=Object.freeze({__proto__:null,int8:T,uint8:qq,int16:Xq,uint16:Qq,int32:yq,uint32:xq,float32:uq,float64:Hq,int64:bq,uint64:Dq,readFloat32:fq,readFloat64:kq,boolean:jq,string:Iq,stringCheck:dq,number:eq,numberCheck:iq,arrayCheck:Aq,switchStructureCheck:Bq}),Vq=function(){function X(q){var X=this;this.$changes=new D(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,q&&q.forEach((function(q){return X.add(q)}))}return X.prototype.Af=function(X,Q){return void 0===Q&&(Q=!0),a(this.$callbacks||(this.$callbacks=[]),q.OPERATION.ADD,X,Q?this.$items:void 0)},X.prototype.ab=function(X){return a(this.$callbacks||(this.$callbacks=[]),q.OPERATION.DELETE,X)},X.prototype.onChange=function(X){return a(this.$callbacks||(this.$callbacks=[]),q.OPERATION.REPLACE,X)},X.is=function(q){return void 0!==q.collection},X.prototype.add=function(q){var X=this.$refId++;return void 0!==q.$changes&&q.$changes.setParent(this,this.$changes.root,X),this.$changes.indexes[X]=X,this.$indexes.set(X,X),this.$items.set(X,q),this.$changes.change(X),X},X.prototype.at=function(q){var X=Array.from(this.$items.keys())[q];return this.$items.get(X)},X.prototype.entries=function(){return this.$items.entries()},X.prototype.delete=function(q){for(var X,Q,y=this.$items.entries();(Q=y.next())&&!Q.done;)if(q===Q.value[1]){X=Q.value[0];break}return void 0!==X&&(this.$changes.delete(X),this.$indexes.delete(X),this.$items.delete(X))},X.prototype.clear=function(X){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),X&&R.call(this,X),this.$items.clear(),this.$changes.operation({index:0,op:q.OPERATION.CLEAR}),this.$changes.touchParents()},X.prototype.has=function(q){return Array.from(this.$items.values()).some((function(X){return X===q}))},X.prototype.forEach=function(q){var X=this;this.$items.forEach((function(Q,y,x){return q(Q,y,X)}))},X.prototype.values=function(){return this.$items.values()},Object.defineProperty(X.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),X.prototype.setIndex=function(q,X){this.$indexes.set(q,X)},X.prototype.getIndex=function(q){return this.$indexes.get(q)},X.prototype.getByIndex=function(q){return this.$items.get(this.$indexes.get(q))},X.prototype.deleteByIndex=function(q){var X=this.$indexes.get(q);this.$items.delete(X),this.$indexes.delete(q)},X.prototype.toArray=function(){return Array.from(this.$items.values())},X.prototype.toJSON=function(){var q=[];return this.forEach((function(X,Q){q.push("function"===typeof X.toJSON?X.toJSON():X)})),q},X.prototype.clone=function(q){var Q;return q?Q=Object.assign(new X,this):(Q=new X,this.forEach((function(q){q.$changes?Q.add(q.clone()):Q.add(q)}))),Q},X}(),Wq=function(){function X(q){var X=this;this.$changes=new D(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,q&&q.forEach((function(q){return X.add(q)}))}return X.prototype.Af=function(X,Q){return void 0===Q&&(Q=!0),a(this.$callbacks||(this.$callbacks=[]),q.OPERATION.ADD,X,Q?this.$items:void 0)},X.prototype.ab=function(X){return a(this.$callbacks||(this.$callbacks=[]),q.OPERATION.DELETE,X)},X.prototype.onChange=function(X){return a(this.$callbacks||(this.$callbacks=[]),q.OPERATION.REPLACE,X)},X.is=function(q){return void 0!==q.set},X.prototype.add=function(X){var Q,y;if(this.has(X))return!1;var x=this.$refId++;void 0!==X.$changes&&X.$changes.setParent(this,this.$changes.root,x);var u=null!==(y=null===(Q=this.$changes.indexes[x])||void 0===Q?void 0:Q.op)&&void 0!==y?y:q.OPERATION.ADD;return this.$changes.indexes[x]=x,this.$indexes.set(x,x),this.$items.set(x,X),this.$changes.change(x,u),x},X.prototype.entries=function(){return this.$items.entries()},X.prototype.delete=function(q){for(var X,Q,y=this.$items.entries();(Q=y.next())&&!Q.done;)if(q===Q.value[1]){X=Q.value[0];break}return void 0!==X&&(this.$changes.delete(X),this.$indexes.delete(X),this.$items.delete(X))},X.prototype.clear=function(X){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),X&&R.call(this,X),this.$items.clear(),this.$changes.operation({index:0,op:q.OPERATION.CLEAR}),this.$changes.touchParents()},X.prototype.has=function(q){for(var X,Q=this.$items.values(),y=!1;(X=Q.next())&&!X.done;)if(q===X.value){y=!0;break}return y},X.prototype.forEach=function(q){var X=this;this.$items.forEach((function(Q,y,x){return q(Q,y,X)}))},X.prototype.values=function(){return this.$items.values()},Object.defineProperty(X.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),X.prototype.setIndex=function(q,X){this.$indexes.set(q,X)},X.prototype.getIndex=function(q){return this.$indexes.get(q)},X.prototype.getByIndex=function(q){return this.$items.get(this.$indexes.get(q))},X.prototype.deleteByIndex=function(q){var X=this.$indexes.get(q);this.$items.delete(X),this.$indexes.delete(q)},X.prototype.toArray=function(){return Array.from(this.$items.values())},X.prototype.toJSON=function(){var q=[];return this.forEach((function(X,Q){q.push("function"===typeof X.toJSON?X.toJSON():X)})),q},X.prototype.clone=function(q){var Q;return q?Q=Object.assign(new X,this):(Q=new X,this.forEach((function(q){q.$changes?Q.add(q.clone()):Q.add(q)}))),Q},X}(),vq=function(){function q(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return q.prototype.addRefId=function(q){this.refIds.has(q)||(this.refIds.add(q),this.containerIndexes.set(q,new Set))},q.get=function(X){return void 0===X.$filterState&&(X.$filterState=new q),X.$filterState},q}(),Zq=function(){function q(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return q.prototype.getNextUniqueId=function(){return this.nextUniqueId++},q.prototype.addRef=function(q,X,Q){void 0===Q&&(Q=!0),this.refs.set(q,X),Q&&(this.refCounts[q]=(this.refCounts[q]||0)+1)},q.prototype.removeRef=function(q){this.refCounts[q]=this.refCounts[q]-1,this.deletedRefs.add(q)},q.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},q.prototype.garbageCollectDeletedRefs=function(){var q=this;this.deletedRefs.forEach((function(X){if(!(q.refCounts[X]>0)){var Q=q.refs.get(X);if(Q instanceof lq)for(var y in Q._definition.schema)"string"!==typeof Q._definition.schema[y]&&Q[y]&&Q[y].$changes&&q.removeRef(Q[y].$changes.refId);else{var x=Q.$changes.parent._definition,u=x.schema[x.fieldsByIndex[Q.$changes.parentIndex]];"function"===typeof Object.values(u)[0]&&Array.from(Q.values()).forEach((function(X){return q.removeRef(X.$changes.refId)}))}q.refs.delete(X),delete q.refCounts[X]}})),this.deletedRefs.clear()},q}(),Uq=function(q){function X(){return null!==q&&q.apply(this,arguments)||this}return Q(X,q),X}(Error);function Oq(q,X,Q,y){var x,u=!1;switch(X){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":x="number",isNaN(q)&&console.log('trying to encode "NaN" in '.concat(Q.constructor.name,"#").concat(y));break;case"string":x="string",u=!0;break;case"boolean":return}if(typeof q!==x&&(!u||u&&null!==q)){var H="'".concat(JSON.stringify(q),"'").concat(q&&q.constructor&&" (".concat(q.constructor.name,")")||"");throw new Uq("a '".concat(x,"' was expected, but ").concat(H," was provided in ").concat(Q.constructor.name,"#").concat(y))}}function gq(q,X,Q,y){if(!(q instanceof X))throw new Uq("a '".concat(X.name,"' was expected, but '").concat(q.constructor.name,"' was provided in ").concat(Q.constructor.name,"#").concat(y))}function Pq(q,X,Q,y,x){Oq(Q,q,y,x);var u=r[q];if(!u)throw new Uq("a '".concat(q,"' was expected, but ").concat(Q," was provided in ").concat(y.constructor.name,"#").concat(x));u(X,Q)}function Fq(q,X,Q){return wq[q](X,Q)}var lq=function(){function X(){for(var q=[],X=0;X<arguments.length;X++)q[X]=arguments[X];Object.defineProperties(this,{$changes:{value:new D(this,void 0,new Zq),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var Q=this._definition.descriptors;Q&&Object.defineProperties(this,Q),q[0]&&this.assign(q[0])}return X.onError=function(q){console.error(q)},X.is=function(q){return q._definition&&void 0!==q._definition.schema},X.prototype.onChange=function(X){return a(this.$callbacks||(this.$callbacks=[]),q.OPERATION.REPLACE,X)},X.prototype.ab=function(X){return a(this.$callbacks||(this.$callbacks=[]),q.OPERATION.DELETE,X)},X.prototype.assign=function(q){return Object.assign(this,q),this},Object.defineProperty(X.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),X.prototype.setDirty=function(q,X){this.$changes.change(q,X)},X.prototype.listen=function(q,X,Q){var y=this;return void 0===Q&&(Q=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[q]||(this.$callbacks[q]=[]),this.$callbacks[q].push(X),Q&&void 0!==this[q]&&X(this[q],void 0),function(){return L(y.$callbacks[q],y.$callbacks[q].indexOf(X))}},X.prototype.decode=function(Q,y,x){var u;void 0===y&&(y={offset:0}),void 0===x&&(x=this);var b=[],D=this.$changes.root,a=Q.length,R=0;for(D.refs.set(R,this);y.offset<a;){var L=Q[y.offset++];if(L!=H){var f=x.$changes,k=void 0!==x._definition,I=k?L>>6<<6:L;if(I!==q.OPERATION.CLEAR){var e=k?L%(I||255):eq(Q,y),i=k?x._definition.fieldsByIndex[e]:"",B=f.getType(e),w=void 0,V=void 0,W=void 0;if(k?V=x["_".concat(i)]:(V=x.getByIndex(e),(I&q.OPERATION.ADD)===q.OPERATION.ADD?(W=x instanceof d?Iq(Q,y):e,x.setIndex(e,W)):W=x.getIndex(e)),(I&q.OPERATION.DELETE)===q.OPERATION.DELETE&&(I!==q.OPERATION.DELETE_AND_ADD&&x.deleteByIndex(e),V&&V.$changes&&D.removeRef(V.$changes.refId),w=null),void 0!==i){if(I===q.OPERATION.DELETE);else if(X.is(B)){var v=eq(Q,y);if(w=D.refs.get(v),I!==q.OPERATION.REPLACE){var Z=this.getSchemaType(Q,y,B);w||((w=this.createTypeInstance(Z)).$changes.refId=v,V&&(w.$callbacks=V.$callbacks,V.$changes.refId&&v!==V.$changes.refId&&D.removeRef(V.$changes.refId))),D.addRef(v,w,w!==V)}}else if("string"===typeof B)w=Fq(B,Q,y);else{var U=A(Object.keys(B)[0]),O=eq(Q,y),g=D.refs.has(O)?V||D.refs.get(O):new U.constructor;if((w=g.clone(!0)).$changes.refId=O,V&&(w.$callbacks=V.$callbacks,V.$changes.refId&&O!==V.$changes.refId)){D.removeRef(V.$changes.refId);for(var P=V.entries(),F=void 0;(F=P.next())&&!F.done;){var l=(u=F.value)[0],m=u[1];b.push({refId:O,op:q.OPERATION.DELETE,field:l,value:void 0,previousValue:m})}}D.addRef(O,w,g!==V)}if(null!==w&&void 0!==w)if(w.$changes&&w.$changes.setParent(f.ref,f.root,e),x instanceof X)x[i]=w;else if(x instanceof d)l=W,x.$items.set(l,w),x.$changes.allChanges.add(e);else if(x instanceof j)x.setAt(e,w);else if(x instanceof Vq){var M=x.add(w);x.setIndex(e,M)}else x instanceof Wq&&!1!==(M=x.add(w))&&x.setIndex(e,M);V!==w&&b.push({refId:R,op:I,field:i,dynamicIndex:W,value:w,previousValue:V})}else{console.warn("@colyseus/schema: definition mismatch");for(var o={offset:y.offset};y.offset<a&&(!Bq(Q,y)||(o.offset=y.offset+1,!D.refs.has(eq(Q,o))));)y.offset++}}else x.clear(b)}else{R=eq(Q,y);var Y=D.refs.get(R);if(!Y)throw new Error('"refId" not found: '.concat(R));x=Y}}return this._triggerChanges(b),D.garbageCollectDeletedRefs(),b},X.prototype.encode=function(Q,y,x){void 0===Q&&(Q=!1),void 0===y&&(y=[]),void 0===x&&(x=!1);for(var u=this.$changes,b=new WeakSet,D=[u],a=1,R=0;R<a;R++){var L=D[R],f=L.ref,k=f instanceof X;L.ensureRefId(),b.add(L),L!==u&&(L.changed||Q)&&(m(y,H),n(y,L.refId));for(var j=Q?Array.from(L.allChanges):Array.from(L.changes.values()),I=0,e=j.length;I<e;I++){var i=Q?{op:q.OPERATION.ADD,index:j[I]}:j[I],B=i.index,w=k?f._definition.fieldsByIndex&&f._definition.fieldsByIndex[B]:B,V=y.length;if(i.op!==q.OPERATION.TOUCH)if(k)m(y,B|i.op);else{if(m(y,i.op),i.op===q.OPERATION.CLEAR)continue;n(y,B)}if(k||(i.op&q.OPERATION.ADD)!=q.OPERATION.ADD||f instanceof d&&J(y,L.ref.$indexes.get(B)),i.op!==q.OPERATION.DELETE){var W=L.getType(B),v=L.getValue(B);if(v&&v.$changes&&!b.has(v.$changes)&&(D.push(v.$changes),v.$changes.ensureRefId(),a++),i.op!==q.OPERATION.TOUCH){if(X.is(W))gq(v,W,f,w),n(y,v.$changes.refId),(i.op&q.OPERATION.ADD)===q.OPERATION.ADD&&this.tryEncodeTypeId(y,W,v.constructor);else if("string"===typeof W)Pq(W,y,v,f,w);else{var Z=A(Object.keys(W)[0]);gq(f["_".concat(w)],Z.constructor,f,w),n(y,v.$changes.refId)}x&&L.cache(B,y.slice(V))}}}Q||x||L.discard()}return y},X.prototype.encodeAll=function(q){return this.encode(!0,[],q)},X.prototype.applyFilters=function(Q,y){var x,u;void 0===y&&(y=!1);for(var b=this,D=new Set,a=vq.get(Q),R=[this.$changes],L=1,f=[],k=function(k){var j=R[k];if(D.has(j.refId))return"continue";var I=j.ref,e=I instanceof X;m(f,H),n(f,j.refId);var i=a.refIds.has(j),A=y||!i;a.addRefId(j);var B=a.containerIndexes.get(j),w=A?Array.from(j.allChanges):Array.from(j.changes.values());!y&&e&&I._definition.indexesWithFilters&&I._definition.indexesWithFilters.forEach((function(X){!B.has(X)&&j.allChanges.has(X)&&(A?w.push(X):w.push({op:q.OPERATION.ADD,index:X}))}));for(var V=0,W=w.length;V<W;V++){var v=A?{op:q.OPERATION.ADD,index:w[V]}:w[V];if(v.op!==q.OPERATION.CLEAR){var Z=v.index;if(v.op!==q.OPERATION.DELETE){var U=j.getValue(Z),O=j.getType(Z);if(e){if((g=I._definition.filters&&I._definition.filters[Z])&&!g.call(I,Q,U,b)){U&&U.$changes&&D.add(U.$changes.refId);continue}}else{var g,P=j.parent;if((g=j.getChildrenFilter())&&!g.call(P,Q,I.$indexes.get(Z),U,b)){U&&U.$changes&&D.add(U.$changes.refId);continue}}if(U.$changes&&(R.push(U.$changes),L++),v.op!==q.OPERATION.TOUCH)if(v.op===q.OPERATION.ADD||e)f.push.apply(f,null!==(x=j.caches[Z])&&void 0!==x?x:[]),B.add(Z);else if(B.has(Z))f.push.apply(f,null!==(u=j.caches[Z])&&void 0!==u?u:[]);else{if(B.add(Z),m(f,q.OPERATION.ADD),n(f,Z),I instanceof d){var F=j.ref.$indexes.get(Z);J(f,F)}U.$changes?n(f,U.$changes.refId):r[O](f,U)}else U.$changes&&!e&&(m(f,q.OPERATION.ADD),n(f,Z),I instanceof d&&(F=j.ref.$indexes.get(Z),J(f,F)),n(f,U.$changes.refId))}else e?m(f,v.op|Z):(m(f,v.op),n(f,Z))}else m(f,v.op)}},j=0;j<L;j++)k(j);return f},X.prototype.clone=function(){var q,X=new this.constructor,Q=this._definition.schema;for(var y in Q)"object"===typeof this[y]&&"function"===typeof(null===(q=this[y])||void 0===q?void 0:q.clone)?X[y]=this[y].clone():X[y]=this[y];return X},X.prototype.toJSON=function(){var q=this._definition.schema,X=this._definition.deprecated,Q={};for(var y in q)X[y]||null===this[y]||"undefined"===typeof this[y]||(Q[y]="function"===typeof this[y].toJSON?this[y].toJSON():this["_".concat(y)]);return Q},X.prototype.discardAllChanges=function(){this.$changes.discardAll()},X.prototype.getByIndex=function(q){return this[this._definition.fieldsByIndex[q]]},X.prototype.deleteByIndex=function(q){this[this._definition.fieldsByIndex[q]]=void 0},X.prototype.tryEncodeTypeId=function(q,X,Q){X._typeid!==Q._typeid&&(m(q,b),n(q,Q._typeid))},X.prototype.getSchemaType=function(q,X,Q){var y;return q[X.offset]===b&&(X.offset++,y=this.constructor._context.get(eq(q,X))),y||Q},X.prototype.createTypeInstance=function(q){var X=new q;return X.$changes.root=this.$changes.root,X},X.prototype._triggerChanges=function(Q){for(var y,x,u,H,b,D,a,R,L,f=new Set,k=this.$changes.root.refs,j=function(j){var I=Q[j],d=I.refId,e=k.get(d),i=e.$callbacks;if((I.op&q.OPERATION.DELETE)===q.OPERATION.DELETE&&I.previousValue instanceof X&&(null===(x=null===(y=I.previousValue.$callbacks)||void 0===y?void 0:y[q.OPERATION.DELETE])||void 0===x||x.forEach((function(q){return q()}))),!i)return"continue";if(e instanceof X){if(!f.has(d))try{null===(u=null===i||void 0===i?void 0:i[q.OPERATION.REPLACE])||void 0===u||u.forEach((function(q){return q()}))}catch(A){X.onError(A)}try{i.hasOwnProperty(I.field)&&(null===(H=i[I.field])||void 0===H||H.forEach((function(q){return q(I.value,I.previousValue)})))}catch(A){X.onError(A)}}else I.op===q.OPERATION.ADD&&void 0===I.previousValue?null===(b=i[q.OPERATION.ADD])||void 0===b||b.forEach((function(q){var X;return q(I.value,null!==(X=I.dynamicIndex)&&void 0!==X?X:I.field)})):I.op===q.OPERATION.DELETE?void 0!==I.previousValue&&(null===(D=i[q.OPERATION.DELETE])||void 0===D||D.forEach((function(q){var X;return q(I.previousValue,null!==(X=I.dynamicIndex)&&void 0!==X?X:I.field)}))):I.op===q.OPERATION.DELETE_AND_ADD&&(void 0!==I.previousValue&&(null===(a=i[q.OPERATION.DELETE])||void 0===a||a.forEach((function(q){var X;return q(I.previousValue,null!==(X=I.dynamicIndex)&&void 0!==X?X:I.field)}))),null===(R=i[q.OPERATION.ADD])||void 0===R||R.forEach((function(q){var X;return q(I.value,null!==(X=I.dynamicIndex)&&void 0!==X?X:I.field)}))),I.value!==I.previousValue&&(null===(L=i[q.OPERATION.REPLACE])||void 0===L||L.forEach((function(q){var X;return q(I.value,null!==(X=I.dynamicIndex)&&void 0!==X?X:I.field)})));f.add(d)},I=0;I<Q.length;I++)j(I)},X._definition=B.create(),X}();function mq(q){for(var X=[q.$changes],Q=1,y={},x=y,u=function(q){var Q=X[q];Q.changes.forEach((function(q){var X=Q.ref,y=q.index,u=X._definition?X._definition.fieldsByIndex[y]:X.$indexes.get(y);x[u]=Q.getValue(y)}))},H=0;H<Q;H++)u(H);return y}var Mq={context:new V},oq=function(q){function X(){return null!==q&&q.apply(this,arguments)||this}return Q(X,q),y([v("string",Mq)],X.prototype,"name",void 0),y([v("string",Mq)],X.prototype,"type",void 0),y([v("number",Mq)],X.prototype,"referencedType",void 0),X}(lq),Yq=function(q){function X(){var X=null!==q&&q.apply(this,arguments)||this;return X.fields=new j,X}return Q(X,q),y([v("number",Mq)],X.prototype,"id",void 0),y([v([oq],Mq)],X.prototype,"fields",void 0),X}(lq),Nq=function(q){function X(){var X=null!==q&&q.apply(this,arguments)||this;return X.types=new j,X}return Q(X,q),X.encode=function(q){var Q=q.constructor,y=new X;y.rootType=Q._typeid;var x=function(q,X){for(var Q in X){var x=new oq;x.name=Q;var u=void 0;if("string"===typeof X[Q])u=X[Q];else{var H=X[Q],b=void 0;lq.is(H)?(u="ref",b=X[Q]):"string"===typeof H[u=Object.keys(H)[0]]?u+=":"+H[u]:b=H[u],x.referencedType=b?b._typeid:-1}x.type=u,q.fields.push(x)}y.types.push(q)},u=Q._context.types;for(var H in u){var b=new Yq;b.id=Number(H),x(b,u[H]._definition.schema)}return y.encodeAll()},X.decode=function(q,y){var x=new V,u=new X;u.decode(q,y);var H=u.types.reduce((function(q,X){var y=function(q){function X(){return null!==q&&q.apply(this,arguments)||this}return Q(X,q),X}(lq),u=X.id;return q[u]=y,x.add(y,u),q}),{});u.types.forEach((function(q){var X=H[q.id];q.fields.forEach((function(q){var Q;if(void 0!==q.referencedType){var y=q.type,u=H[q.referencedType];if(!u){var b=q.type.split(":");y=b[0],u=b[1]}"ref"===y?v(u,{context:x})(X.prototype,q.name):v(((Q={})[y]=u,Q),{context:x})(X.prototype,q.name)}else v(q.type,{context:x})(X.prototype,q.name)}))}));var b=H[u.rootType],D=new b;for(var a in b._definition.schema){var R=b._definition.schema[a];"string"!==typeof R&&(D[a]="function"===typeof R?new R:new(A(Object.keys(R)[0]).constructor))}return D},y([v([Yq],Mq)],X.prototype,"types",void 0),y([v("number",Mq)],X.prototype,"rootType",void 0),X}(lq);i("map",{constructor:d}),i("array",{constructor:j}),i("set",{constructor:Wq}),i("collection",{constructor:Vq}),q.ArraySchema=j,q.CollectionSchema=Vq,q.Context=V,q.MapSchema=d,q.Reflection=Nq,q.ReflectionField=oq,q.ReflectionType=Yq,q.Schema=lq,q.SchemaDefinition=B,q.SetSchema=Wq,q.decode=wq,q.defineTypes=g,q.deprecated=O,q.dumpChanges=mq,q.encode=r,q.filter=Z,q.filterChildren=U,q.hasFilter=w,q.registerType=i,q.type=v,Object.defineProperty(q,"__esModule",{value:!0})}(X)},12166:q=>{"use strict";q.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12163:(q,X,Q)=>{var y=Q(12166),x=Q(12173),u=Object.hasOwnProperty,H=Object.create(null);for(var b in y)u.call(y,b)&&(H[y[b]]=b);var D=q.exports={to:{},get:{}};function a(q,X,Q){return Math.min(Math.max(X,q),Q)}function R(q){var X=Math.round(q).toString(16).toUpperCase();return X.length<2?"0"+X:X}D.get=function(q){var X,Q;switch(q.substring(0,3).toLowerCase()){case"hsl":X=D.get.hsl(q),Q="hsl";break;case"hwb":X=D.get.hwb(q),Q="hwb";break;default:X=D.get.rgb(q),Q="rgb"}return X?{model:Q,value:X}:null},D.get.rgb=function(q){if(!q)return null;var X,Q,x,H=[0,0,0,1];if(X=q.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(x=X[2],X=X[1],Q=0;Q<3;Q++){var b=2*Q;H[Q]=parseInt(X.slice(b,b+2),16)}x&&(H[3]=parseInt(x,16)/255)}else if(X=q.match(/^#([a-f0-9]{3,4})$/i)){for(x=(X=X[1])[3],Q=0;Q<3;Q++)H[Q]=parseInt(X[Q]+X[Q],16);x&&(H[3]=parseInt(x+x,16)/255)}else if(X=q.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(Q=0;Q<3;Q++)H[Q]=parseInt(X[Q+1],0);X[4]&&(X[5]?H[3]=.01*parseFloat(X[4]):H[3]=parseFloat(X[4]))}else{if(!(X=q.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(X=q.match(/^(\w+)$/))?"transparent"===X[1]?[0,0,0,0]:u.call(y,X[1])?((H=y[X[1]])[3]=1,H):null:null;for(Q=0;Q<3;Q++)H[Q]=Math.round(2.55*parseFloat(X[Q+1]));X[4]&&(X[5]?H[3]=.01*parseFloat(X[4]):H[3]=parseFloat(X[4]))}for(Q=0;Q<3;Q++)H[Q]=a(H[Q],0,255);return H[3]=a(H[3],0,1),H},D.get.hsl=function(q){if(!q)return null;var X=q.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(X){var Q=parseFloat(X[4]);return[(parseFloat(X[1])%360+360)%360,a(parseFloat(X[2]),0,100),a(parseFloat(X[3]),0,100),a(isNaN(Q)?1:Q,0,1)]}return null},D.get.hwb=function(q){if(!q)return null;var X=q.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(X){var Q=parseFloat(X[4]);return[(parseFloat(X[1])%360+360)%360,a(parseFloat(X[2]),0,100),a(parseFloat(X[3]),0,100),a(isNaN(Q)?1:Q,0,1)]}return null},D.to.hex=function(){var q=x(arguments);return"#"+R(q[0])+R(q[1])+R(q[2])+(q[3]<1?R(Math.round(255*q[3])):"")},D.to.rgb=function(){var q=x(arguments);return q.length<4||1===q[3]?"rgb("+Math.round(q[0])+", "+Math.round(q[1])+", "+Math.round(q[2])+")":"rgba("+Math.round(q[0])+", "+Math.round(q[1])+", "+Math.round(q[2])+", "+q[3]+")"},D.to.rgb.percent=function(){var q=x(arguments),X=Math.round(q[0]/255*100),Q=Math.round(q[1]/255*100),y=Math.round(q[2]/255*100);return q.length<4||1===q[3]?"rgb("+X+"%, "+Q+"%, "+y+"%)":"rgba("+X+"%, "+Q+"%, "+y+"%, "+q[3]+")"},D.to.hsl=function(){var q=x(arguments);return q.length<4||1===q[3]?"hsl("+q[0]+", "+q[1]+"%, "+q[2]+"%)":"hsla("+q[0]+", "+q[1]+"%, "+q[2]+"%, "+q[3]+")"},D.to.hwb=function(){var q=x(arguments),X="";return q.length>=4&&1!==q[3]&&(X=", "+q[3]),"hwb("+q[0]+", "+q[1]+"%, "+q[2]+"%"+X+")"},D.to.keyword=function(q){return H[q.slice(0,3)]}},12157:(q,X,Q)=>{const y=Q(12163),x=Q(12190),u=["keyword","gray","hex"],H={};for(const k of Object.keys(x))H[[...x[k].labels].sort().join("")]=k;const b={};function D(q,X){if(!(this instanceof D))return new D(q,X);if(X&&X in u&&(X=null),X&&!(X in x))throw new Error("Unknown model: "+X);let Q,a;if(null==q)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(q instanceof D)this.model=q.model,this.color=[...q.color],this.valpha=q.valpha;else if("string"===typeof q){const X=y.get(q);if(null===X)throw new Error("Unable to parse color from string: "+q);this.model=X.model,a=x[this.model].channels,this.color=X.value.slice(0,a),this.valpha="number"===typeof X.value[a]?X.value[a]:1}else if(q.length>0){this.model=X||"rgb",a=x[this.model].channels;const Q=Array.prototype.slice.call(q,0,a);this.color=f(Q,a),this.valpha="number"===typeof q[a]?q[a]:1}else if("number"===typeof q)this.model="rgb",this.color=[q>>16&255,q>>8&255,255&q],this.valpha=1;else{this.valpha=1;const X=Object.keys(q);"alpha"in q&&(X.splice(X.indexOf("alpha"),1),this.valpha="number"===typeof q.alpha?q.alpha:0);const y=X.sort().join("");if(!(y in H))throw new Error("Unable to parse color from object: "+JSON.stringify(q));this.model=H[y];const{labels:u}=x[this.model],b=[];for(Q=0;Q<u.length;Q++)b.push(q[u[Q]]);this.color=f(b)}if(b[this.model])for(a=x[this.model].channels,Q=0;Q<a;Q++){const q=b[this.model][Q];q&&(this.color[Q]=q(this.color[Q]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}D.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(q){let X=this.model in y.to?this:this.rgb();X=X.round("number"===typeof q?q:1);const Q=1===X.valpha?X.color:[...X.color,this.valpha];return y.to[X.model](Q)},percentString(q){const X=this.rgb().round("number"===typeof q?q:1),Q=1===X.valpha?X.color:[...X.color,this.valpha];return y.to.rgb.percent(Q)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const q={},{channels:X}=x[this.model],{labels:Q}=x[this.model];for(let y=0;y<X;y++)q[Q[y]]=this.color[y];return 1!==this.valpha&&(q.alpha=this.valpha),q},unitArray(){const q=this.rgb().color;return q[0]/=255,q[1]/=255,q[2]/=255,1!==this.valpha&&q.push(this.valpha),q},unitObject(){const q=this.rgb().object();return q.r/=255,q.g/=255,q.b/=255,1!==this.valpha&&(q.alpha=this.valpha),q},round(q){return q=Math.max(q||0,0),new D([...this.color.map(a(q)),this.valpha],this.model)},alpha(q){return void 0!==q?new D([...this.color,Math.max(0,Math.min(1,q))],this.model):this.valpha},red:R("rgb",0,L(255)),green:R("rgb",1,L(255)),blue:R("rgb",2,L(255)),hue:R(["hsl","hsv","hsl","hwb","hcg"],0,(q=>(q%360+360)%360)),saturationl:R("hsl",1,L(100)),lightness:R("hsl",2,L(100)),saturationv:R("hsv",1,L(100)),value:R("hsv",2,L(100)),chroma:R("hcg",1,L(100)),gray:R("hcg",2,L(100)),white:R("hwb",1,L(100)),wblack:R("hwb",2,L(100)),cyan:R("cmyk",0,L(100)),magenta:R("cmyk",1,L(100)),yellow:R("cmyk",2,L(100)),black:R("cmyk",3,L(100)),x:R("xyz",0,L(95.047)),y:R("xyz",1,L(100)),z:R("xyz",2,L(108.833)),l:R("lab",0,L(100)),a:R("lab",1),b:R("lab",2),keyword(q){return void 0!==q?new D(q):x[this.model].keyword(this.color)},hex(q){return void 0!==q?new D(q):y.to.hex(this.rgb().round().color)},hexa(q){if(void 0!==q)return new D(q);const X=this.rgb().round().color;let Q=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===Q.length&&(Q="0"+Q),y.to.hex(X)+Q},rgbNumber(){const q=this.rgb().color;return(255&q[0])<<16|(255&q[1])<<8|255&q[2]},luminosity(){const q=this.rgb().color,X=[];for(const[Q,y]of q.entries()){const q=y/255;X[Q]=q<=.04045?q/12.92:((q+.055)/1.055)**2.4}return.2126*X[0]+.7152*X[1]+.0722*X[2]},contrast(q){const X=this.luminosity(),Q=q.luminosity();return X>Q?(X+.05)/(Q+.05):(Q+.05)/(X+.05)},level(q){const X=this.contrast(q);return X>=7?"AAA":X>=4.5?"AA":""},isDark(){const q=this.rgb().color;return(2126*q[0]+7152*q[1]+722*q[2])/1e4<128},isLight(){return!this.isDark()},negate(){const q=this.rgb();for(let X=0;X<3;X++)q.color[X]=255-q.color[X];return q},lighten(q){const X=this.hsl();return X.color[2]+=X.color[2]*q,X},darken(q){const X=this.hsl();return X.color[2]-=X.color[2]*q,X},saturate(q){const X=this.hsl();return X.color[1]+=X.color[1]*q,X},desaturate(q){const X=this.hsl();return X.color[1]-=X.color[1]*q,X},whiten(q){const X=this.hwb();return X.color[1]+=X.color[1]*q,X},blacken(q){const X=this.hwb();return X.color[2]+=X.color[2]*q,X},grayscale(){const q=this.rgb().color,X=.3*q[0]+.59*q[1]+.11*q[2];return D.rgb(X,X,X)},fade(q){return this.alpha(this.valpha-this.valpha*q)},opaquer(q){return this.alpha(this.valpha+this.valpha*q)},rotate(q){const X=this.hsl();let Q=X.color[0];return Q=(Q+q)%360,Q=Q<0?360+Q:Q,X.color[0]=Q,X},mix(q,X){if(!q||!q.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof q);const Q=q.rgb(),y=this.rgb(),x=void 0===X?.5:X,u=2*x-1,H=Q.alpha()-y.alpha(),b=((u*H===-1?u:(u+H)/(1+u*H))+1)/2,a=1-b;return D.rgb(b*Q.red()+a*y.red(),b*Q.green()+a*y.green(),b*Q.blue()+a*y.blue(),Q.alpha()*x+y.alpha()*(1-x))}};for(const k of Object.keys(x)){if(u.includes(k))continue;const{channels:q}=x[k];D.prototype[k]=function(){if(this.model===k)return new D(this);for(var q=arguments.length,X=new Array(q),Q=0;Q<q;Q++)X[Q]=arguments[Q];return X.length>0?new D(X,k):new D([...(y=x[this.model][k].raw(this.color),Array.isArray(y)?y:[y]),this.valpha],k);var y},D[k]=function(){for(var X=arguments.length,Q=new Array(X),y=0;y<X;y++)Q[y]=arguments[y];let x=Q[0];return"number"===typeof x&&(x=f(Q,q)),new D(x,k)}}function a(q){return function(X){return function(q,X){return Number(q.toFixed(X))}(X,q)}}function R(q,X,Q){q=Array.isArray(q)?q:[q];for(const y of q)(b[y]||(b[y]=[]))[X]=Q;return q=q[0],function(y){let x;return void 0!==y?(Q&&(y=Q(y)),x=this[q](),x.color[X]=y,x):(x=this[q]().color[X],Q&&(x=Q(x)),x)}}function L(q){return function(X){return Math.max(0,Math.min(q,X))}}function f(q,X){for(let Q=0;Q<X;Q++)"number"!==typeof q[Q]&&(q[Q]=0);return q}q.exports=D},12192:(q,X,Q)=>{const y=Q(12198),x={};for(const H of Object.keys(y))x[y[H]]=H;const u={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};q.exports=u;for(const H of Object.keys(u)){if(!("channels"in u[H]))throw new Error("missing channels property: "+H);if(!("labels"in u[H]))throw new Error("missing channel labels property: "+H);if(u[H].labels.length!==u[H].channels)throw new Error("channel and label counts mismatch: "+H);const{channels:q,labels:X}=u[H];delete u[H].channels,delete u[H].labels,Object.defineProperty(u[H],"channels",{value:q}),Object.defineProperty(u[H],"labels",{value:X})}u.rgb.hsl=function(q){const X=q[0]/255,Q=q[1]/255,y=q[2]/255,x=Math.min(X,Q,y),u=Math.max(X,Q,y),H=u-x;let b,D;u===x?b=0:X===u?b=(Q-y)/H:Q===u?b=2+(y-X)/H:y===u&&(b=4+(X-Q)/H),b=Math.min(60*b,360),b<0&&(b+=360);const a=(x+u)/2;return D=u===x?0:a<=.5?H/(u+x):H/(2-u-x),[b,100*D,100*a]},u.rgb.hsv=function(q){let X,Q,y,x,u;const H=q[0]/255,b=q[1]/255,D=q[2]/255,a=Math.max(H,b,D),R=a-Math.min(H,b,D),L=function(q){return(a-q)/6/R+.5};return 0===R?(x=0,u=0):(u=R/a,X=L(H),Q=L(b),y=L(D),H===a?x=y-Q:b===a?x=1/3+X-y:D===a&&(x=2/3+Q-X),x<0?x+=1:x>1&&(x-=1)),[360*x,100*u,100*a]},u.rgb.hwb=function(q){const X=q[0],Q=q[1];let y=q[2];const x=u.rgb.hsl(q)[0],H=1/255*Math.min(X,Math.min(Q,y));return y=1-1/255*Math.max(X,Math.max(Q,y)),[x,100*H,100*y]},u.rgb.cmyk=function(q){const X=q[0]/255,Q=q[1]/255,y=q[2]/255,x=Math.min(1-X,1-Q,1-y);return[100*((1-X-x)/(1-x)||0),100*((1-Q-x)/(1-x)||0),100*((1-y-x)/(1-x)||0),100*x]},u.rgb.keyword=function(q){const X=x[q];if(X)return X;let Q,u=1/0;for(const x of Object.keys(y)){const X=y[x],D=(b=X,((H=q)[0]-b[0])**2+(H[1]-b[1])**2+(H[2]-b[2])**2);D<u&&(u=D,Q=x)}var H,b;return Q},u.keyword.rgb=function(q){return y[q]},u.rgb.xyz=function(q){let X=q[0]/255,Q=q[1]/255,y=q[2]/255;X=X>.04045?((X+.055)/1.055)**2.4:X/12.92,Q=Q>.04045?((Q+.055)/1.055)**2.4:Q/12.92,y=y>.04045?((y+.055)/1.055)**2.4:y/12.92;return[100*(.4124*X+.3576*Q+.1805*y),100*(.2126*X+.7152*Q+.0722*y),100*(.0193*X+.1192*Q+.9505*y)]},u.rgb.lab=function(q){const X=u.rgb.xyz(q);let Q=X[0],y=X[1],x=X[2];Q/=95.047,y/=100,x/=108.883,Q=Q>.008856?Q**(1/3):7.787*Q+16/116,y=y>.008856?y**(1/3):7.787*y+16/116,x=x>.008856?x**(1/3):7.787*x+16/116;return[116*y-16,500*(Q-y),200*(y-x)]},u.hsl.rgb=function(q){const X=q[0]/360,Q=q[1]/100,y=q[2]/100;let x,u,H;if(0===Q)return H=255*y,[H,H,H];x=y<.5?y*(1+Q):y+Q-y*Q;const b=2*y-x,D=[0,0,0];for(let a=0;a<3;a++)u=X+1/3*-(a-1),u<0&&u++,u>1&&u--,H=6*u<1?b+6*(x-b)*u:2*u<1?x:3*u<2?b+(x-b)*(2/3-u)*6:b,D[a]=255*H;return D},u.hsl.hsv=function(q){const X=q[0];let Q=q[1]/100,y=q[2]/100,x=Q;const u=Math.max(y,.01);y*=2,Q*=y<=1?y:2-y,x*=u<=1?u:2-u;return[X,100*(0===y?2*x/(u+x):2*Q/(y+Q)),100*((y+Q)/2)]},u.hsv.rgb=function(q){const X=q[0]/60,Q=q[1]/100;let y=q[2]/100;const x=Math.floor(X)%6,u=X-Math.floor(X),H=255*y*(1-Q),b=255*y*(1-Q*u),D=255*y*(1-Q*(1-u));switch(y*=255,x){case 0:return[y,D,H];case 1:return[b,y,H];case 2:return[H,y,D];case 3:return[H,b,y];case 4:return[D,H,y];case 5:return[y,H,b]}},u.hsv.hsl=function(q){const X=q[0],Q=q[1]/100,y=q[2]/100,x=Math.max(y,.01);let u,H;H=(2-Q)*y;const b=(2-Q)*x;return u=Q*x,u/=b<=1?b:2-b,u=u||0,H/=2,[X,100*u,100*H]},u.hwb.rgb=function(q){const X=q[0]/360;let Q=q[1]/100,y=q[2]/100;const x=Q+y;let u;x>1&&(Q/=x,y/=x);const H=Math.floor(6*X),b=1-y;u=6*X-H,0!==(1&H)&&(u=1-u);const D=Q+u*(b-Q);let a,R,L;switch(H){default:case 6:case 0:a=b,R=D,L=Q;break;case 1:a=D,R=b,L=Q;break;case 2:a=Q,R=b,L=D;break;case 3:a=Q,R=D,L=b;break;case 4:a=D,R=Q,L=b;break;case 5:a=b,R=Q,L=D}return[255*a,255*R,255*L]},u.cmyk.rgb=function(q){const X=q[0]/100,Q=q[1]/100,y=q[2]/100,x=q[3]/100;return[255*(1-Math.min(1,X*(1-x)+x)),255*(1-Math.min(1,Q*(1-x)+x)),255*(1-Math.min(1,y*(1-x)+x))]},u.xyz.rgb=function(q){const X=q[0]/100,Q=q[1]/100,y=q[2]/100;let x,u,H;return x=3.2406*X+-1.5372*Q+-.4986*y,u=-.9689*X+1.8758*Q+.0415*y,H=.0557*X+-.204*Q+1.057*y,x=x>.0031308?1.055*x**(1/2.4)-.055:12.92*x,u=u>.0031308?1.055*u**(1/2.4)-.055:12.92*u,H=H>.0031308?1.055*H**(1/2.4)-.055:12.92*H,x=Math.min(Math.max(0,x),1),u=Math.min(Math.max(0,u),1),H=Math.min(Math.max(0,H),1),[255*x,255*u,255*H]},u.xyz.lab=function(q){let X=q[0],Q=q[1],y=q[2];X/=95.047,Q/=100,y/=108.883,X=X>.008856?X**(1/3):7.787*X+16/116,Q=Q>.008856?Q**(1/3):7.787*Q+16/116,y=y>.008856?y**(1/3):7.787*y+16/116;return[116*Q-16,500*(X-Q),200*(Q-y)]},u.lab.xyz=function(q){let X,Q,y;Q=(q[0]+16)/116,X=q[1]/500+Q,y=Q-q[2]/200;const x=Q**3,u=X**3,H=y**3;return Q=x>.008856?x:(Q-16/116)/7.787,X=u>.008856?u:(X-16/116)/7.787,y=H>.008856?H:(y-16/116)/7.787,X*=95.047,Q*=100,y*=108.883,[X,Q,y]},u.lab.lch=function(q){const X=q[0],Q=q[1],y=q[2];let x;x=360*Math.atan2(y,Q)/2/Math.PI,x<0&&(x+=360);return[X,Math.sqrt(Q*Q+y*y),x]},u.lch.lab=function(q){const X=q[0],Q=q[1],y=q[2]/360*2*Math.PI;return[X,Q*Math.cos(y),Q*Math.sin(y)]},u.rgb.ansi16=function(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[Q,y,x]=q;let H=null===X?u.rgb.hsv(q)[2]:X;if(H=Math.round(H/50),0===H)return 30;let b=30+(Math.round(x/255)<<2|Math.round(y/255)<<1|Math.round(Q/255));return 2===H&&(b+=60),b},u.hsv.ansi16=function(q){return u.rgb.ansi16(u.hsv.rgb(q),q[2])},u.rgb.ansi256=function(q){const X=q[0],Q=q[1],y=q[2];if(X===Q&&Q===y)return X<8?16:X>248?231:Math.round((X-8)/247*24)+232;return 16+36*Math.round(X/255*5)+6*Math.round(Q/255*5)+Math.round(y/255*5)},u.ansi16.rgb=function(q){let X=q%10;if(0===X||7===X)return q>50&&(X+=3.5),X=X/10.5*255,[X,X,X];const Q=.5*(1+~~(q>50));return[(1&X)*Q*255,(X>>1&1)*Q*255,(X>>2&1)*Q*255]},u.ansi256.rgb=function(q){if(q>=232){const X=10*(q-232)+8;return[X,X,X]}let X;q-=16;return[Math.floor(q/36)/5*255,Math.floor((X=q%36)/6)/5*255,X%6/5*255]},u.rgb.hex=function(q){const X=(((255&Math.round(q[0]))<<16)+((255&Math.round(q[1]))<<8)+(255&Math.round(q[2]))).toString(16).toUpperCase();return"000000".substring(X.length)+X},u.hex.rgb=function(q){const X=q.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!X)return[0,0,0];let Q=X[0];3===X[0].length&&(Q=Q.split("").map((q=>q+q)).join(""));const y=parseInt(Q,16);return[y>>16&255,y>>8&255,255&y]},u.rgb.hcg=function(q){const X=q[0]/255,Q=q[1]/255,y=q[2]/255,x=Math.max(Math.max(X,Q),y),u=Math.min(Math.min(X,Q),y),H=x-u;let b,D;return b=H<1?u/(1-H):0,D=H<=0?0:x===X?(Q-y)/H%6:x===Q?2+(y-X)/H:4+(X-Q)/H,D/=6,D%=1,[360*D,100*H,100*b]},u.hsl.hcg=function(q){const X=q[1]/100,Q=q[2]/100,y=Q<.5?2*X*Q:2*X*(1-Q);let x=0;return y<1&&(x=(Q-.5*y)/(1-y)),[q[0],100*y,100*x]},u.hsv.hcg=function(q){const X=q[1]/100,Q=q[2]/100,y=X*Q;let x=0;return y<1&&(x=(Q-y)/(1-y)),[q[0],100*y,100*x]},u.hcg.rgb=function(q){const X=q[0]/360,Q=q[1]/100,y=q[2]/100;if(0===Q)return[255*y,255*y,255*y];const x=[0,0,0],u=X%1*6,H=u%1,b=1-H;let D=0;switch(Math.floor(u)){case 0:x[0]=1,x[1]=H,x[2]=0;break;case 1:x[0]=b,x[1]=1,x[2]=0;break;case 2:x[0]=0,x[1]=1,x[2]=H;break;case 3:x[0]=0,x[1]=b,x[2]=1;break;case 4:x[0]=H,x[1]=0,x[2]=1;break;default:x[0]=1,x[1]=0,x[2]=b}return D=(1-Q)*y,[255*(Q*x[0]+D),255*(Q*x[1]+D),255*(Q*x[2]+D)]},u.hcg.hsv=function(q){const X=q[1]/100,Q=X+q[2]/100*(1-X);let y=0;return Q>0&&(y=X/Q),[q[0],100*y,100*Q]},u.hcg.hsl=function(q){const X=q[1]/100,Q=q[2]/100*(1-X)+.5*X;let y=0;return Q>0&&Q<.5?y=X/(2*Q):Q>=.5&&Q<1&&(y=X/(2*(1-Q))),[q[0],100*y,100*Q]},u.hcg.hwb=function(q){const X=q[1]/100,Q=X+q[2]/100*(1-X);return[q[0],100*(Q-X),100*(1-Q)]},u.hwb.hcg=function(q){const X=q[1]/100,Q=1-q[2]/100,y=Q-X;let x=0;return y<1&&(x=(Q-y)/(1-y)),[q[0],100*y,100*x]},u.apple.rgb=function(q){return[q[0]/65535*255,q[1]/65535*255,q[2]/65535*255]},u.rgb.apple=function(q){return[q[0]/255*65535,q[1]/255*65535,q[2]/255*65535]},u.gray.rgb=function(q){return[q[0]/100*255,q[0]/100*255,q[0]/100*255]},u.gray.hsl=function(q){return[0,0,q[0]]},u.gray.hsv=u.gray.hsl,u.gray.hwb=function(q){return[0,100,q[0]]},u.gray.cmyk=function(q){return[0,0,0,q[0]]},u.gray.lab=function(q){return[q[0],0,0]},u.gray.hex=function(q){const X=255&Math.round(q[0]/100*255),Q=((X<<16)+(X<<8)+X).toString(16).toUpperCase();return"000000".substring(Q.length)+Q},u.rgb.gray=function(q){return[(q[0]+q[1]+q[2])/3/255*100]}},12190:(q,X,Q)=>{const y=Q(12192),x=Q(12207),u={};Object.keys(y).forEach((q=>{u[q]={},Object.defineProperty(u[q],"channels",{value:y[q].channels}),Object.defineProperty(u[q],"labels",{value:y[q].labels});const X=x(q);Object.keys(X).forEach((Q=>{const y=X[Q];u[q][Q]=function(q){const X=function(){for(var X=arguments.length,Q=new Array(X),y=0;y<X;y++)Q[y]=arguments[y];const x=Q[0];if(void 0===x||null===x)return x;x.length>1&&(Q=x);const u=q(Q);if("object"===typeof u)for(let q=u.length,H=0;H<q;H++)u[H]=Math.round(u[H]);return u};return"conversion"in q&&(X.conversion=q.conversion),X}(y),u[q][Q].raw=function(q){const X=function(){for(var X=arguments.length,Q=new Array(X),y=0;y<X;y++)Q[y]=arguments[y];const x=Q[0];return void 0===x||null===x?x:(x.length>1&&(Q=x),q(Q))};return"conversion"in q&&(X.conversion=q.conversion),X}(y)}))})),q.exports=u},12207:(q,X,Q)=>{const y=Q(12192);function x(q){const X=function(){const q={},X=Object.keys(y);for(let Q=X.length,y=0;y<Q;y++)q[X[y]]={distance:-1,parent:null};return q}(),Q=[q];for(X[q].distance=0;Q.length;){const q=Q.pop(),x=Object.keys(y[q]);for(let y=x.length,u=0;u<y;u++){const y=x[u],H=X[y];-1===H.distance&&(H.distance=X[q].distance+1,H.parent=q,Q.unshift(y))}}return X}function u(q,X){return function(Q){return X(q(Q))}}function H(q,X){const Q=[X[q].parent,q];let x=y[X[q].parent][q],H=X[q].parent;for(;X[H].parent;)Q.unshift(X[H].parent),x=u(y[X[H].parent][H],x),H=X[H].parent;return x.conversion=Q,x}q.exports=function(q){const X=x(q),Q={},y=Object.keys(X);for(let x=y.length,u=0;u<x;u++){const q=y[u];null!==X[q].parent&&(Q[q]=H(q,X))}return Q}},12198:q=>{"use strict";q.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},11070:function(q,X,Q){"use strict";var y=this&&this.__createBinding||(Object.create?function(q,X,Q,y){void 0===y&&(y=Q);var x=Object.getOwnPropertyDescriptor(X,Q);x&&!("get"in x?!X.__esModule:x.writable||x.configurable)||(x={enumerable:!0,get:function(){return X[Q]}}),Object.defineProperty(q,y,x)}:function(q,X,Q,y){void 0===y&&(y=Q),q[y]=X[Q]}),x=this&&this.__setModuleDefault||(Object.create?function(q,X){Object.defineProperty(q,"default",{enumerable:!0,value:X})}:function(q,X){q.default=X}),u=this&&this.__importStar||function(q){if(q&&q.__esModule)return q;var X={};if(null!=q)for(var Q in q)"default"!==Q&&Object.prototype.hasOwnProperty.call(q,Q)&&y(X,q,Q);return x(X,q),X},H=this&&this.__awaiter||function(q,X,Q,y){return new(Q||(Q=Promise))((function(x,u){function H(q){try{D(y.next(q))}catch(X){u(X)}}function b(q){try{D(y.throw(q))}catch(X){u(X)}}function D(q){var X;q.done?x(q.value):(X=q.value,X instanceof Q?X:new Q((function(q){q(X)}))).then(H,b)}D((y=y.apply(q,X||[])).next())}))};Object.defineProperty(X,"__esModule",{value:!0}),X.Auth=X.Platform=void 0;const b=u(Q(11014)),D=Q(11076),a="colyseus-auth-token";!function(q){q.ios="ios",q.android="android"}(X.Platform||(X.Platform={}));X.Auth=class{constructor(q){this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=q.replace("ws","http"),(0,D.getItem)(a,(q=>this.token=q))}get hasToken(){return!!this.token}login(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return H(this,void 0,void 0,(function*(){const X=Object.assign({},q);this.hasToken&&(X.token=this.token);const Q=yield this.request("post","/auth",X);this.token=Q.token,(0,D.setItem)(a,this.token);for(let q in Q)this.hasOwnProperty(q)&&(this[q]=Q[q]);return this.registerPingService(),this}))}save(){return H(this,void 0,void 0,(function*(){return yield this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone}),this}))}getFriends(){return H(this,void 0,void 0,(function*(){return yield this.request("get","/friends/all")}))}getOnlineFriends(){return H(this,void 0,void 0,(function*(){return yield this.request("get","/friends/online")}))}getFriendRequests(){return H(this,void 0,void 0,(function*(){return yield this.request("get","/friends/requests")}))}sendFriendRequest(q){return H(this,void 0,void 0,(function*(){return yield this.request("post","/friends/requests",{userId:q})}))}acceptFriendRequest(q){return H(this,void 0,void 0,(function*(){return yield this.request("put","/friends/requests",{userId:q})}))}declineFriendRequest(q){return H(this,void 0,void 0,(function*(){return yield this.request("del","/friends/requests",{userId:q})}))}blockUser(q){return H(this,void 0,void 0,(function*(){return yield this.request("post","/friends/block",{userId:q})}))}unblockUser(q){return H(this,void 0,void 0,(function*(){return yield this.request("put","/friends/block",{userId:q})}))}request(q,X){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},y=arguments.length>3?arguments[3]:void 0,x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return H(this,void 0,void 0,(function*(){x.Accept="application/json",this.hasToken&&(x.Authorization="Bearer "+this.token);const u=[];for(const q in Q)u.push(`${q}=${Q[q]}`);const H=u.length>0?`?${u.join("&")}`:"",D={headers:x};return y&&(D.body=y),(yield b[q](`${this.endpoint}${X}${H}`,D)).data}))}logout(){this.token=void 0,(0,D.removeItem)(a),this.unregisterPingService()}registerPingService(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;this.unregisterPingService(),this.keepOnlineInterval=setInterval((()=>this.request("get","/auth")),q)}unregisterPingService(){clearInterval(this.keepOnlineInterval)}}},11007:function(q,X,Q){"use strict";var y,x=this&&this.__awaiter||function(q,X,Q,y){return new(Q||(Q=Promise))((function(x,u){function H(q){try{D(y.next(q))}catch(X){u(X)}}function b(q){try{D(y.throw(q))}catch(X){u(X)}}function D(q){var X;q.done?x(q.value):(X=q.value,X instanceof Q?X:new Q((function(q){q(X)}))).then(H,b)}D((y=y.apply(q,X||[])).next())}))};Object.defineProperty(X,"__esModule",{value:!0}),X.Client=X.MatchMakeError=void 0;const u=Q(11014),H=Q(11020),b=Q(11026);class D extends Error{constructor(q,X){super(q),this.code=X,Object.setPrototypeOf(this,D.prototype)}}X.MatchMakeError=D;const a="undefined"!==typeof window&&"undefined"!==typeof(null===(y=null===window||void 0===window?void 0:window.location)||void 0===y?void 0:y.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";X.Client=class{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a;if("string"===typeof q){const X=new URL(q),Q="https:"===X.protocol||"wss:"===X.protocol,y=Number(X.port||(Q?443:80));this.settings={hostname:X.hostname,pathname:"/"!==X.pathname?X.pathname:"",port:y,secure:Q}}else void 0===q.port&&(q.port=q.secure?443:80),void 0===q.pathname&&(q.pathname=""),this.settings=q}joinOrCreate(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Q=arguments.length>2?arguments[2]:void 0;return x(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",q,X,Q)}))}create(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Q=arguments.length>2?arguments[2]:void 0;return x(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",q,X,Q)}))}join(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Q=arguments.length>2?arguments[2]:void 0;return x(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",q,X,Q)}))}joinById(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Q=arguments.length>2?arguments[2]:void 0;return x(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",q,X,Q)}))}reconnect(q,X){return x(this,void 0,void 0,(function*(){if("string"===typeof q&&"string"===typeof X)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[Q,y]=q.split(":");return yield this.createMatchMakeRequest("reconnect",Q,{reconnectionToken:y},X)}))}getAvailableRooms(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return x(this,void 0,void 0,(function*(){return(yield(0,u.get)(this.getHttpEndpoint(`${q}`),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(q,X,Q){return x(this,void 0,void 0,(function*(){const y=this.createRoom(q.room.name,X);y.roomId=q.room.roomId,y.sessionId=q.sessionId;const u={sessionId:y.sessionId};q.reconnectionToken&&(u.reconnectionToken=q.reconnectionToken);const b=Q||y;return y.connect(this.buildEndpoint(q.room,u),q.devMode&&(()=>x(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${y.roomId}'...`);let Q=0;const u=()=>x(this,void 0,void 0,(function*(){Q++;try{yield this.consumeSeatReservation(q,X,b),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${y.roomId}'`)}catch(x){Q<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${Q} out of 8)`),setTimeout(u,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(u,2e3)}))),b),new Promise(((q,X)=>{const Q=(q,Q)=>X(new H.ServerError(q,Q));b.onError.once(Q),b.onJoin.once((()=>{b.onError.remove(Q),q(b)}))}))}))}createMatchMakeRequest(q,X){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},y=arguments.length>3?arguments[3]:void 0,H=arguments.length>4?arguments[4]:void 0;return x(this,void 0,void 0,(function*(){const x=(yield(0,u.post)(this.getHttpEndpoint(`${q}/${X}`),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(Q)})).data;if(x.error)throw new D(x.error,x.code);return"reconnect"===q&&(x.reconnectionToken=Q.reconnectionToken),yield this.consumeSeatReservation(x,y,H)}))}createRoom(q,X){return new b.Room(q,X)}buildEndpoint(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const Q=[];for(const x in X)X.hasOwnProperty(x)&&Q.push(`${x}=${X[x]}`);let y=this.settings.secure?"wss://":"ws://";return q.publicAddress?y+=`${q.publicAddress}`:y+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`,`${y}/${q.processId}/${q.roomId}?${Q.join("&")}`}getHttpEndpoint(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}/matchmake/${q}`}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},11031:(q,X,Q)=>{"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.Connection=void 0;const y=Q(11039);X.Connection=class{constructor(){this.events={},this.transport=new y.WebSocketTransport(this.events)}send(q){this.transport.send(q)}connect(q){this.transport.connect(q)}close(q,X){this.transport.close(q,X)}get isOpen(){return this.transport.isOpen}}},11050:(q,X)=>{"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.utf8Length=X.utf8Read=X.ErrorCode=X.Protocol=void 0,function(q){q[q.HANDSHAKE=9]="HANDSHAKE",q[q.JOIN_ROOM=10]="JOIN_ROOM",q[q.ERROR=11]="ERROR",q[q.LEAVE_ROOM=12]="LEAVE_ROOM",q[q.ROOM_DATA=13]="ROOM_DATA",q[q.ROOM_STATE=14]="ROOM_STATE",q[q.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",q[q.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",q[q.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(X.Protocol||(X.Protocol={})),function(q){q[q.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",q[q.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",q[q.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",q[q.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",q[q.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",q[q.AUTH_FAILED=4215]="AUTH_FAILED",q[q.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(X.ErrorCode||(X.ErrorCode={})),X.utf8Read=function(q,X){const Q=q[X++];for(var y="",x=0,u=X,H=X+Q;u<H;u++){var b=q[u];if(0!==(128&b))if(192!==(224&b))if(224!==(240&b)){if(240!==(248&b))throw new Error("Invalid byte "+b.toString(16));(x=(7&b)<<18|(63&q[++u])<<12|(63&q[++u])<<6|63&q[++u])>=65536?(x-=65536,y+=String.fromCharCode(55296+(x>>>10),56320+(1023&x))):y+=String.fromCharCode(x)}else y+=String.fromCharCode((15&b)<<12|(63&q[++u])<<6|63&q[++u]);else y+=String.fromCharCode((31&b)<<6|63&q[++u]);else y+=String.fromCharCode(b)}return y},X.utf8Length=function(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",X=0,Q=0;for(let y=0,x=q.length;y<x;y++)X=q.charCodeAt(y),X<128?Q+=1:X<2048?Q+=2:X<55296||X>=57344?Q+=3:(y++,Q+=4);return Q+1}},11026:function(q,X,Q){"use strict";var y=this&&this.__createBinding||(Object.create?function(q,X,Q,y){void 0===y&&(y=Q);var x=Object.getOwnPropertyDescriptor(X,Q);x&&!("get"in x?!X.__esModule:x.writable||x.configurable)||(x={enumerable:!0,get:function(){return X[Q]}}),Object.defineProperty(q,y,x)}:function(q,X,Q,y){void 0===y&&(y=Q),q[y]=X[Q]}),x=this&&this.__setModuleDefault||(Object.create?function(q,X){Object.defineProperty(q,"default",{enumerable:!0,value:X})}:function(q,X){q.default=X}),u=this&&this.__importStar||function(q){if(q&&q.__esModule)return q;var X={};if(null!=q)for(var Q in q)"default"!==Q&&Object.prototype.hasOwnProperty.call(q,Q)&&y(X,q,Q);return x(X,q),X};Object.defineProperty(X,"__esModule",{value:!0}),X.Room=void 0;const H=u(Q(11028)),b=Q(11031),D=Q(11050),a=Q(11052),R=Q(11055),L=Q(11060),f=Q(11065),k=Q(11020);class j{constructor(q,X){this.onStateChange=(0,L.createSignal)(),this.onError=(0,L.createSignal)(),this.onLeave=(0,L.createSignal)(),this.onJoin=(0,L.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,R.createNanoEvents)(),this.roomId=null,this.name=q,X&&(this.serializer=new((0,a.getSerializer)("schema")),this.rootSchema=X,this.serializer.state=new X),this.onError(((q,X)=>{var Q;return null===(Q=console.warn)||void 0===Q?void 0:Q.call(console,`colyseus.js - onError => (${q}) ${X}`)})),this.onLeave((()=>this.removeAllListeners()))}get id(){return this.roomId}connect(q,X){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;const y=new b.Connection;Q.connection=y,y.events.onmessage=j.prototype.onMessageCallback.bind(Q),y.events.onclose=function(q){var y;if(!Q.hasJoined)return null===(y=console.warn)||void 0===y||y.call(console,`Room connection was closed unexpectedly (${q.code}): ${q.reason}`),void Q.onError.invoke(q.code,q.reason);q.code===k.CloseCode.DEVMODE_RESTART&&X?X():(Q.onLeave.invoke(q.code),Q.destroy())},y.events.onerror=function(q){var X;null===(X=console.warn)||void 0===X||X.call(console,`Room, onError (${q.code}): ${q.reason}`),Q.onError.invoke(q.code,q.reason)},y.connect(q)}leave(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((X=>{this.onLeave((q=>X(q))),this.connection?q?this.connection.send([D.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(k.CloseCode.CONSENTED)}))}onMessage(q,X){return this.onMessageHandlers.on(this.getMessageHandlerKey(q),X)}send(q,X){const Q=[D.Protocol.ROOM_DATA];let y;if("string"===typeof q?f.encode.string(Q,q):f.encode.number(Q,q),void 0!==X){const q=H.encode(X);y=new Uint8Array(Q.length+q.byteLength),y.set(new Uint8Array(Q),0),y.set(new Uint8Array(q),Q.length)}else y=new Uint8Array(Q);this.connection.send(y.buffer)}sendBytes(q,X){const Q=[D.Protocol.ROOM_DATA_BYTES];let y;"string"===typeof q?f.encode.string(Q,q):f.encode.number(Q,q),y=new Uint8Array(Q.length+(X.byteLength||X.length)),y.set(new Uint8Array(Q),0),y.set(new Uint8Array(X),Q.length),this.connection.send(y.buffer)}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(q){const X=Array.from(new Uint8Array(q.data)),Q=X[0];if(Q===D.Protocol.JOIN_ROOM){let q=1;const Q=(0,D.utf8Read)(X,q);if(q+=(0,D.utf8Length)(Q),this.serializerId=(0,D.utf8Read)(X,q),q+=(0,D.utf8Length)(this.serializerId),!this.serializer){const q=(0,a.getSerializer)(this.serializerId);this.serializer=new q}X.length>q&&this.serializer.handshake&&this.serializer.handshake(X,{offset:q}),this.reconnectionToken=`${this.roomId}:${Q}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([D.Protocol.JOIN_ROOM])}else if(Q===D.Protocol.ERROR){const q={offset:1},Q=f.decode.number(X,q),y=f.decode.string(X,q);this.onError.invoke(Q,y)}else if(Q===D.Protocol.LEAVE_ROOM)this.leave();else if(Q===D.Protocol.ROOM_DATA_SCHEMA){const q={offset:1},Q=this.serializer.getState().constructor._context.get(f.decode.number(X,q)),y=new Q;y.decode(X,q),this.dispatchMessage(Q,y)}else if(Q===D.Protocol.ROOM_STATE)X.shift(),this.setState(X);else if(Q===D.Protocol.ROOM_STATE_PATCH)X.shift(),this.patch(X);else if(Q===D.Protocol.ROOM_DATA){const Q={offset:1},y=f.decode.stringCheck(X,Q)?f.decode.string(X,Q):f.decode.number(X,Q),x=X.length>Q.offset?H.decode(q.data,Q.offset):void 0;this.dispatchMessage(y,x)}else if(Q===D.Protocol.ROOM_DATA_BYTES){const q={offset:1},Q=f.decode.stringCheck(X,q)?f.decode.string(X,q):f.decode.number(X,q);this.dispatchMessage(Q,new Uint8Array(X.slice(q.offset)))}}setState(q){this.serializer.setState(q),this.onStateChange.invoke(this.serializer.getState())}patch(q){this.serializer.patch(q),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(q,X){var Q;const y=this.getMessageHandlerKey(q);this.onMessageHandlers.events[y]?this.onMessageHandlers.emit(y,X):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",q,X):null===(Q=console.warn)||void 0===Q||Q.call(console,`colyseus.js: onMessage() not registered for type '${q}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(q){switch(typeof q){case"function":return`$${q._typeid}`;case"string":return q;case"number":return`i${q}`;default:throw new Error("invalid message type.")}}}X.Room=j},11076:(q,X)=>{"use strict";let Q;function y(){return Q||(Q="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!==typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(q,X){this.cache[q]=X},getItem:function(q){this.cache[q]},removeItem:function(q){delete this.cache[q]}}),Q}Object.defineProperty(X,"__esModule",{value:!0}),X.getItem=X.removeItem=X.setItem=void 0,X.setItem=function(q,X){y().setItem(q,X)},X.removeItem=function(q){y().removeItem(q)},X.getItem=function(q,X){const Q=y().getItem(q);"undefined"!==typeof Promise&&Q instanceof Promise?Q.then((q=>X(q))):X(Q)}},11055:(q,X)=>{"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.createNanoEvents=void 0;X.createNanoEvents=()=>({emit(q){let X=this.events[q]||[];for(var Q=arguments.length,y=new Array(Q>1?Q-1:0),x=1;x<Q;x++)y[x-1]=arguments[x];for(let u=0,H=X.length;u<H;u++)X[u](...y)},events:{},on(q,X){var Q;return(null===(Q=this.events[q])||void 0===Q?void 0:Q.push(X))||(this.events[q]=[X]),()=>{var Q;this.events[q]=null===(Q=this.events[q])||void 0===Q?void 0:Q.filter((q=>X!==q))}}})},11060:(q,X)=>{"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.createSignal=X.EventEmitter=void 0;class Q{constructor(){this.handlers=[]}register(q){return this.handlers.push(q),this}invoke(){for(var q=arguments.length,X=new Array(q),Q=0;Q<q;Q++)X[Q]=arguments[Q];this.handlers.forEach((q=>q.apply(this,X)))}invokeAsync(){for(var q=arguments.length,X=new Array(q),Q=0;Q<q;Q++)X[Q]=arguments[Q];return Promise.all(this.handlers.map((q=>q.apply(this,X))))}remove(q){const X=this.handlers.indexOf(q);this.handlers[X]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}X.EventEmitter=Q,X.createSignal=function(){const q=new Q;function X(X){return q.register(X,null===this)}return X.once=X=>{const Q=function(){for(var y=arguments.length,x=new Array(y),u=0;u<y;u++)x[u]=arguments[u];X.apply(this,x),q.remove(Q)};q.register(Q)},X.remove=X=>q.remove(X),X.invoke=function(){return q.invoke(...arguments)},X.invokeAsync=function(){return q.invokeAsync(...arguments)},X.clear=()=>q.clear(),X}},11020:(q,X)=>{"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.ServerError=X.CloseCode=void 0,function(q){q[q.CONSENTED=4e3]="CONSENTED",q[q.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(X.CloseCode||(X.CloseCode={}));class Q extends Error{constructor(q,X){super(X),this.name="ServerError",this.code=q}}X.ServerError=Q},11001:(q,X,Q)=>{"use strict";X.b=void 0,Q(11004);var y=Q(11007);Object.defineProperty(X,"b",{enumerable:!0,get:function(){return y.Client}});var x=Q(11050);var u=Q(11026);var H=Q(11070);const b=Q(11081);const D=Q(11088),a=Q(11052);(0,a.registerSerializer)("schema",b.SchemaSerializer),(0,a.registerSerializer)("none",D.NoneSerializer)},11004:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=q=>null!==q&&"object"===typeof q&&q.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},11028:(q,X)=>{"use strict";function Q(q,X){if(this._offset=X,q instanceof ArrayBuffer)this._buffer=q,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(q))throw new Error("Invalid argument");this._buffer=q.buffer,this._view=new DataView(this._buffer,q.byteOffset,q.byteLength)}}Object.defineProperty(X,"__esModule",{value:!0}),X.decode=X.encode=void 0,Q.prototype._array=function(q){for(var X=new Array(q),Q=0;Q<q;Q++)X[Q]=this._parse();return X},Q.prototype._map=function(q){for(var X={},Q=0;Q<q;Q++)X[this._parse()]=this._parse();return X},Q.prototype._str=function(q){var X=function(q,X,Q){for(var y="",x=0,u=X,H=X+Q;u<H;u++){var b=q.getUint8(u);if(0!==(128&b))if(192!==(224&b))if(224!==(240&b)){if(240!==(248&b))throw new Error("Invalid byte "+b.toString(16));(x=(7&b)<<18|(63&q.getUint8(++u))<<12|(63&q.getUint8(++u))<<6|63&q.getUint8(++u))>=65536?(x-=65536,y+=String.fromCharCode(55296+(x>>>10),56320+(1023&x))):y+=String.fromCharCode(x)}else y+=String.fromCharCode((15&b)<<12|(63&q.getUint8(++u))<<6|63&q.getUint8(++u));else y+=String.fromCharCode((31&b)<<6|63&q.getUint8(++u));else y+=String.fromCharCode(b)}return y}(this._view,this._offset,q);return this._offset+=q,X},Q.prototype._bin=function(q){var X=this._buffer.slice(this._offset,this._offset+q);return this._offset+=q,X},Q.prototype._parse=function(){var q,X=this._view.getUint8(this._offset++),Q=0,y=0,x=0,u=0;if(X<192)return X<128?X:X<144?this._map(15&X):X<160?this._array(15&X):this._str(31&X);if(X>223)return-1*(255-X+1);switch(X){case 192:return null;case 194:return!1;case 195:return!0;case 196:return Q=this._view.getUint8(this._offset),this._offset+=1,this._bin(Q);case 197:return Q=this._view.getUint16(this._offset),this._offset+=2,this._bin(Q);case 198:return Q=this._view.getUint32(this._offset),this._offset+=4,this._bin(Q);case 199:if(Q=this._view.getUint8(this._offset),y=this._view.getInt8(this._offset+1),this._offset+=2,-1===y){var H=this._view.getUint32(this._offset);return x=this._view.getInt32(this._offset+4),u=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*x+u)+H/1e6)}return[y,this._bin(Q)];case 200:return Q=this._view.getUint16(this._offset),y=this._view.getInt8(this._offset+2),this._offset+=3,[y,this._bin(Q)];case 201:return Q=this._view.getUint32(this._offset),y=this._view.getInt8(this._offset+4),this._offset+=5,[y,this._bin(Q)];case 202:return q=this._view.getFloat32(this._offset),this._offset+=4,q;case 203:return q=this._view.getFloat64(this._offset),this._offset+=8,q;case 204:return q=this._view.getUint8(this._offset),this._offset+=1,q;case 205:return q=this._view.getUint16(this._offset),this._offset+=2,q;case 206:return q=this._view.getUint32(this._offset),this._offset+=4,q;case 207:return x=this._view.getUint32(this._offset)*Math.pow(2,32),u=this._view.getUint32(this._offset+4),this._offset+=8,x+u;case 208:return q=this._view.getInt8(this._offset),this._offset+=1,q;case 209:return q=this._view.getInt16(this._offset),this._offset+=2,q;case 210:return q=this._view.getInt32(this._offset),this._offset+=4,q;case 211:return x=this._view.getInt32(this._offset)*Math.pow(2,32),u=this._view.getUint32(this._offset+4),this._offset+=8,x+u;case 212:return y=this._view.getInt8(this._offset),this._offset+=1,0===y?void(this._offset+=1):[y,this._bin(1)];case 213:return y=this._view.getInt8(this._offset),this._offset+=1,[y,this._bin(2)];case 214:return y=this._view.getInt8(this._offset),this._offset+=1,-1===y?(q=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*q)):[y,this._bin(4)];case 215:return y=this._view.getInt8(this._offset),this._offset+=1,0===y?(x=this._view.getInt32(this._offset)*Math.pow(2,32),u=this._view.getUint32(this._offset+4),this._offset+=8,new Date(x+u)):-1===y?(x=this._view.getUint32(this._offset),u=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&x)+u)+(x>>>2)/1e6)):[y,this._bin(8)];case 216:return y=this._view.getInt8(this._offset),this._offset+=1,[y,this._bin(16)];case 217:return Q=this._view.getUint8(this._offset),this._offset+=1,this._str(Q);case 218:return Q=this._view.getUint16(this._offset),this._offset+=2,this._str(Q);case 219:return Q=this._view.getUint32(this._offset),this._offset+=4,this._str(Q);case 220:return Q=this._view.getUint16(this._offset),this._offset+=2,this._array(Q);case 221:return Q=this._view.getUint32(this._offset),this._offset+=4,this._array(Q);case 222:return Q=this._view.getUint16(this._offset),this._offset+=2,this._map(Q);case 223:return Q=this._view.getUint32(this._offset),this._offset+=4,this._map(Q)}throw new Error("Could not parse")},X.decode=function(q){var X=new Q(q,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),y=X._parse();if(X._offset!==q.byteLength)throw new Error(q.byteLength-X._offset+" trailing bytes");return y};function y(q,X,Q){for(var y=0,x=0,u=Q.length;x<u;x++)(y=Q.charCodeAt(x))<128?q.setUint8(X++,y):y<2048?(q.setUint8(X++,192|y>>6),q.setUint8(X++,128|63&y)):y<55296||y>=57344?(q.setUint8(X++,224|y>>12),q.setUint8(X++,128|y>>6&63),q.setUint8(X++,128|63&y)):(x++,y=65536+((1023&y)<<10|1023&Q.charCodeAt(x)),q.setUint8(X++,240|y>>18),q.setUint8(X++,128|y>>12&63),q.setUint8(X++,128|y>>6&63),q.setUint8(X++,128|63&y))}function x(q,X,Q){var y=typeof Q,u=0,H=0,b=0,D=0,a=0,R=0;if("string"===y){if(a=function(q){for(var X=0,Q=0,y=0,x=q.length;y<x;y++)(X=q.charCodeAt(y))<128?Q+=1:X<2048?Q+=2:X<55296||X>=57344?Q+=3:(y++,Q+=4);return Q}(Q),a<32)q.push(160|a),R=1;else if(a<256)q.push(217,a),R=2;else if(a<65536)q.push(218,a>>8,a),R=3;else{if(!(a<4294967296))throw new Error("String too long");q.push(219,a>>24,a>>16,a>>8,a),R=5}return X.push({_str:Q,_length:a,_offset:q.length}),R+a}if("number"===y)return Math.floor(Q)===Q&&isFinite(Q)?Q>=0?Q<128?(q.push(Q),1):Q<256?(q.push(204,Q),2):Q<65536?(q.push(205,Q>>8,Q),3):Q<4294967296?(q.push(206,Q>>24,Q>>16,Q>>8,Q),5):(b=Q/Math.pow(2,32)|0,D=Q>>>0,q.push(207,b>>24,b>>16,b>>8,b,D>>24,D>>16,D>>8,D),9):Q>=-32?(q.push(Q),1):Q>=-128?(q.push(208,Q),2):Q>=-32768?(q.push(209,Q>>8,Q),3):Q>=-2147483648?(q.push(210,Q>>24,Q>>16,Q>>8,Q),5):(b=Math.floor(Q/Math.pow(2,32)),D=Q>>>0,q.push(211,b>>24,b>>16,b>>8,b,D>>24,D>>16,D>>8,D),9):(q.push(203),X.push({_float:Q,_length:8,_offset:q.length}),9);if("object"===y){if(null===Q)return q.push(192),1;if(Array.isArray(Q)){if((a=Q.length)<16)q.push(144|a),R=1;else if(a<65536)q.push(220,a>>8,a),R=3;else{if(!(a<4294967296))throw new Error("Array too large");q.push(221,a>>24,a>>16,a>>8,a),R=5}for(u=0;u<a;u++)R+=x(q,X,Q[u]);return R}if(Q instanceof Date){var L=Q.getTime(),f=Math.floor(L/1e3),k=1e6*(L-1e3*f);return f>=0&&k>=0&&f<=17179869183?0===k&&f<=4294967295?(q.push(214,255,f>>24,f>>16,f>>8,f),6):(b=f/4294967296,D=4294967295&f,q.push(215,255,k>>22,k>>14,k>>6,b,D>>24,D>>16,D>>8,D),10):(b=Math.floor(f/4294967296),D=f>>>0,q.push(199,12,255,k>>24,k>>16,k>>8,k,b>>24,b>>16,b>>8,b,D>>24,D>>16,D>>8,D),15)}if(Q instanceof ArrayBuffer){if((a=Q.byteLength)<256)q.push(196,a),R=2;else if(a<65536)q.push(197,a>>8,a),R=3;else{if(!(a<4294967296))throw new Error("Buffer too large");q.push(198,a>>24,a>>16,a>>8,a),R=5}return X.push({_bin:Q,_length:a,_offset:q.length}),R+a}if("function"===typeof Q.toJSON)return x(q,X,Q.toJSON());var j=[],I="",d=Object.keys(Q);for(u=0,H=d.length;u<H;u++)void 0!==Q[I=d[u]]&&"function"!==typeof Q[I]&&j.push(I);if((a=j.length)<16)q.push(128|a),R=1;else if(a<65536)q.push(222,a>>8,a),R=3;else{if(!(a<4294967296))throw new Error("Object too large");q.push(223,a>>24,a>>16,a>>8,a),R=5}for(u=0;u<a;u++)R+=x(q,X,I=j[u]),R+=x(q,X,Q[I]);return R}if("boolean"===y)return q.push(Q?195:194),1;if("undefined"===y)return q.push(192),1;if("function"===typeof Q.toJSON)return x(q,X,Q.toJSON());throw new Error("Could not encode")}X.encode=function(q){var X=[],Q=[],u=x(X,Q,q),H=new ArrayBuffer(u),b=new DataView(H),D=0,a=0,R=-1;Q.length>0&&(R=Q[0]._offset);for(var L,f=0,k=0,j=0,I=X.length;j<I;j++)if(b.setUint8(a+j,X[j]),j+1===R){if(f=(L=Q[D])._length,k=a+R,L._bin)for(var d=new Uint8Array(L._bin),e=0;e<f;e++)b.setUint8(k+e,d[e]);else L._str?y(b,k,L._str):void 0!==L._float&&b.setFloat64(k,L._float);a+=f,Q[++D]&&(R=Q[D]._offset)}return H}},11088:(q,X)=>{"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.NoneSerializer=void 0;X.NoneSerializer=class{setState(q){}getState(){return null}patch(q){}teardown(){}handshake(q){}}},11081:(q,X,Q)=>{"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.SchemaSerializer=void 0;const y=Q(11065);X.SchemaSerializer=class{setState(q){return this.state.decode(q)}getState(){return this.state}patch(q){return this.state.decode(q)}teardown(){var q,X;null===(X=null===(q=this.state)||void 0===q?void 0:q.$changes)||void 0===X||X.root.clearRefs()}handshake(q,X){if(this.state){(new y.Reflection).decode(q,X)}else this.state=y.Reflection.decode(q,X)}}},11052:(q,X)=>{"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.getSerializer=X.registerSerializer=void 0;const Q={};X.registerSerializer=function(q,X){Q[q]=X},X.getSerializer=function(q){const X=Q[q];if(!X)throw new Error("missing serializer: "+q);return X}},11039:function(q,X,Q){"use strict";var y=this&&this.__importDefault||function(q){return q&&q.__esModule?q:{default:q}};Object.defineProperty(X,"__esModule",{value:!0}),X.WebSocketTransport=void 0;const x=y(Q(11043)),u=globalThis.WebSocket||x.default;X.WebSocketTransport=class{constructor(q){this.events=q}send(q){q instanceof ArrayBuffer?this.ws.send(q):Array.isArray(q)&&this.ws.send(new Uint8Array(q).buffer)}connect(q){this.ws=new u(q,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(q,X){this.ws.close(q,X)}get isOpen(){return this.ws.readyState===u.OPEN}}},11043:q=>{"use strict";q.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},11141:q=>{"use strict";q.exports=function(q){for(var X=new Array(q),Q=0;Q<q;++Q)X[Q]=Q;return X}},11147:q=>{function X(q){return!!q.constructor&&"function"===typeof q.constructor.isBuffer&&q.constructor.isBuffer(q)}q.exports=function(q){return null!=q&&(X(q)||function(q){return"function"===typeof q.readFloatLE&&"function"===typeof q.slice&&X(q.slice(0,0))}(q)||!!q._isBuffer)}},11138:(q,X,Q)=>{var y=Q(11141),x=Q(11147),u="undefined"!==typeof Float64Array;function H(q,X){return q[0]-X[0]}function b(){var q,X=this.stride,Q=new Array(X.length);for(q=0;q<Q.length;++q)Q[q]=[Math.abs(X[q]),q];Q.sort(H);var y=new Array(Q.length);for(q=0;q<y.length;++q)y[q]=Q[q][1];return y}function D(q,X){var Q=["View",X,"d",q].join("");X<0&&(Q="View_Nil"+q);var x="generic"===q;if(-1===X){var u="function "+Q+"(a){this.data=a;};var proto="+Q+".prototype;proto.dtype='"+q+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+Q+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+Q+"(a){return new "+Q+"(a);}";return new Function(u)()}if(0===X){u="function "+Q+"(a,d) {this.data = a;this.offset = d};var proto="+Q+".prototype;proto.dtype='"+q+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+Q+"_copy() {return new "+Q+"(this.data,this.offset)};proto.pick=function "+Q+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+Q+"_get(){return "+(x?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+Q+"_set(v){return "+(x?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+Q+"(a,b,c,d){return new "+Q+"(a,d)}";return new Function("TrivialArray",u)(a[q][0])}u=["'use strict'"];var H=y(X),D=H.map((function(q){return"i"+q})),R="this.offset+"+H.map((function(q){return"this.stride["+q+"]*i"+q})).join("+"),L=H.map((function(q){return"b"+q})).join(","),f=H.map((function(q){return"c"+q})).join(",");u.push("function "+Q+"(a,"+L+","+f+",d){this.data=a","this.shape=["+L+"]","this.stride=["+f+"]","this.offset=d|0}","var proto="+Q+".prototype","proto.dtype='"+q+"'","proto.dimension="+X),u.push("Object.defineProperty(proto,'size',{get:function "+Q+"_size(){return "+H.map((function(q){return"this.shape["+q+"]"})).join("*"),"}})"),1===X?u.push("proto.order=[0]"):(u.push("Object.defineProperty(proto,'order',{get:"),X<4?(u.push("function "+Q+"_order(){"),2===X?u.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===X&&u.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):u.push("ORDER})")),u.push("proto.set=function "+Q+"_set("+D.join(",")+",v){"),x?u.push("return this.data.set("+R+",v)}"):u.push("return this.data["+R+"]=v}"),u.push("proto.get=function "+Q+"_get("+D.join(",")+"){"),x?u.push("return this.data.get("+R+")}"):u.push("return this.data["+R+"]}"),u.push("proto.index=function "+Q+"_index(",D.join(),"){return "+R+"}"),u.push("proto.hi=function "+Q+"_hi("+D.join(",")+"){return new "+Q+"(this.data,"+H.map((function(q){return["(typeof i",q,"!=='number'||i",q,"<0)?this.shape[",q,"]:i",q,"|0"].join("")})).join(",")+","+H.map((function(q){return"this.stride["+q+"]"})).join(",")+",this.offset)}");var k=H.map((function(q){return"a"+q+"=this.shape["+q+"]"})),j=H.map((function(q){return"c"+q+"=this.stride["+q+"]"}));u.push("proto.lo=function "+Q+"_lo("+D.join(",")+"){var b=this.offset,d=0,"+k.join(",")+","+j.join(","));for(var I=0;I<X;++I)u.push("if(typeof i"+I+"==='number'&&i"+I+">=0){d=i"+I+"|0;b+=c"+I+"*d;a"+I+"-=d}");u.push("return new "+Q+"(this.data,"+H.map((function(q){return"a"+q})).join(",")+","+H.map((function(q){return"c"+q})).join(",")+",b)}"),u.push("proto.step=function "+Q+"_step("+D.join(",")+"){var "+H.map((function(q){return"a"+q+"=this.shape["+q+"]"})).join(",")+","+H.map((function(q){return"b"+q+"=this.stride["+q+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(I=0;I<X;++I)u.push("if(typeof i"+I+"==='number'){d=i"+I+"|0;if(d<0){c+=b"+I+"*(a"+I+"-1);a"+I+"=ceil(-a"+I+"/d)}else{a"+I+"=ceil(a"+I+"/d)}b"+I+"*=d}");u.push("return new "+Q+"(this.data,"+H.map((function(q){return"a"+q})).join(",")+","+H.map((function(q){return"b"+q})).join(",")+",c)}");var d=new Array(X),e=new Array(X);for(I=0;I<X;++I)d[I]="a[i"+I+"]",e[I]="b[i"+I+"]";u.push("proto.transpose=function "+Q+"_transpose("+D+"){"+D.map((function(q,X){return q+"=("+q+"===undefined?"+X+":"+q+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+Q+"(this.data,"+d.join(",")+","+e.join(",")+",this.offset)}"),u.push("proto.pick=function "+Q+"_pick("+D+"){var a=[],b=[],c=this.offset");for(I=0;I<X;++I)u.push("if(typeof i"+I+"==='number'&&i"+I+">=0){c=(c+this.stride["+I+"]*i"+I+")|0}else{a.push(this.shape["+I+"]);b.push(this.stride["+I+"])}");return u.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),u.push("return function construct_"+Q+"(data,shape,stride,offset){return new "+Q+"(data,"+H.map((function(q){return"shape["+q+"]"})).join(",")+","+H.map((function(q){return"stride["+q+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",u.join("\n"))(a[q],b)}var a={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};q.exports=function(q,X,Q,y){if(void 0===q)return(0,a.array[0])([]);"number"===typeof q&&(q=[q]),void 0===X&&(X=[q.length]);var H=X.length;if(void 0===Q){Q=new Array(H);for(var b=H-1,R=1;b>=0;--b)Q[b]=R,R*=X[b]}if(void 0===y){y=0;for(b=0;b<H;++b)Q[b]<0&&(y-=(X[b]-1)*Q[b])}for(var L=function(q){if(x(q))return"buffer";if(u)switch(Object.prototype.toString.call(q)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(q)?"array":"generic"}(q),f=a[L];f.length<=H+1;)f.push(D(L,f.length-1));return(0,f[H+1])(q,X,Q,y)}},11106:q=>{var X;self,X=()=>(()=>{"use strict";var q={d:(X,Q)=>{for(var y in Q)q.o(Q,y)&&!q.o(X,y)&&Object.defineProperty(X,y,{enumerable:!0,get:Q[y]})},o:(q,X)=>Object.prototype.hasOwnProperty.call(q,X)},X={};q.d(X,{default:()=>m});var Q,y=function(q,X){var Q=X.x-q.x,y=X.y-q.y;return Math.sqrt(Q*Q+y*y)},x=function(q){return q*(Math.PI/180)},u=new Map,H=function(q){u.has(q)&&clearTimeout(u.get(q)),u.set(q,setTimeout(q,100))},b=function(q,X,Q){for(var y,x=X.split(/[ ,]+/g),u=0;u<x.length;u+=1)y=x[u],q.addEventListener?q.addEventListener(y,Q,!1):q.attachEvent&&q.attachEvent(y,Q)},D=function(q,X,Q){for(var y,x=X.split(/[ ,]+/g),u=0;u<x.length;u+=1)y=x[u],q.removeEventListener?q.removeEventListener(y,Q):q.detachEvent&&q.detachEvent(y,Q)},a=function(q){return q.preventDefault(),q.type.match(/^touch/)?q.changedTouches:q},R=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},L=function(q,X){X.top||X.right||X.bottom||X.left?(q.style.top=X.top,q.style.right=X.right,q.style.bottom=X.bottom,q.style.left=X.left):(q.style.left=X.x+"px",q.style.top=X.y+"px")},f=function(q,X,Q){var y=k(q);for(var x in y)if(y.hasOwnProperty(x))if("string"==typeof X)y[x]=X+" "+Q;else{for(var u="",H=0,b=X.length;H<b;H+=1)u+=X[H]+" "+Q+", ";y[x]=u.slice(0,-2)}return y},k=function(q){var X={};return X[q]="",["webkit","Moz","o"].forEach((function(Q){X[Q+q.charAt(0).toUpperCase()+q.slice(1)]=""})),X},j=function(q,X){for(var Q in X)X.hasOwnProperty(Q)&&(q[Q]=X[Q]);return q},I=function(q,X){if(q.length)for(var Q=0,y=q.length;Q<y;Q+=1)X(q[Q]);else X(q)},d="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,e=window.matchMedia("(any-hover: none)").matches,i=!!("ontouchstart"in window),A=!!window.PointerEvent,B=!!window.MSPointerEvent,w={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},V={start:"mousedown",move:"mousemove",end:"mouseup"},W={};function v(){}d&&!e?Q=w:A?Q={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:B?Q={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:i?(Q=w,W=V):Q=V,v.prototype.on=function(q,X){var Q,y=this,x=q.split(/[ ,]+/g);y._handlers_=y._handlers_||{};for(var u=0;u<x.length;u+=1)Q=x[u],y._handlers_[Q]=y._handlers_[Q]||[],y._handlers_[Q].push(X);return y},v.prototype.off=function(q,X){var Q=this;return Q._handlers_=Q._handlers_||{},void 0===q?Q._handlers_={}:void 0===X?Q._handlers_[q]=null:Q._handlers_[q]&&Q._handlers_[q].indexOf(X)>=0&&Q._handlers_[q].splice(Q._handlers_[q].indexOf(X),1),Q},v.prototype.trigger=function(q,X){var Q,y=this,x=q.split(/[ ,]+/g);y._handlers_=y._handlers_||{};for(var u=0;u<x.length;u+=1)Q=x[u],y._handlers_[Q]&&y._handlers_[Q].length&&y._handlers_[Q].forEach((function(q){q.call(y,{type:Q,target:y},X)}))},v.prototype.config=function(q){var X=this;X.options=X.defaults||{},q&&(X.options=function(q,X){var Q={};for(var y in q)q.hasOwnProperty(y)&&X.hasOwnProperty(y)?Q[y]=X[y]:q.hasOwnProperty(y)&&(Q[y]=q[y]);return Q}(X.options,q))},v.prototype.bindEvt=function(q,X){var y=this;return y._domHandlers_=y._domHandlers_||{},y._domHandlers_[X]=function(){"function"==typeof y["on"+X]?y["on"+X].apply(y,arguments):console.warn('[WARNING] : Missing "on'+X+'" handler.')},b(q,Q[X],y._domHandlers_[X]),W[X]&&b(q,W[X],y._domHandlers_[X]),y},v.prototype.unbindEvt=function(q,X){var y=this;return y._domHandlers_=y._domHandlers_||{},D(q,Q[X],y._domHandlers_[X]),W[X]&&D(q,W[X],y._domHandlers_[X]),delete y._domHandlers_[X],this};const Z=v;function U(q,X){return this.identifier=X.identifier,this.position=X.position,this.frontPosition=X.frontPosition,this.collection=q,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(X),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=U.id,U.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}U.prototype=new Z,U.constructor=U,U.id=0,U.prototype.buildEl=function(q){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},U.prototype.stylize=function(){if(this.options.dataOnly)return this;var q=this.options.fadeTime+"ms",X=function(){var q=k("borderRadius");for(var X in q)q.hasOwnProperty(X)&&(q[X]="50%");return q}(),Q=f("transition","opacity",q),y={};return y.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},y.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},y.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},j(y.el,Q),"circle"===this.options.shape&&j(y.back,X),j(y.front,X),this.applyStyles(y),this},U.prototype.applyStyles=function(q){for(var X in this.ui)if(this.ui.hasOwnProperty(X))for(var Q in q[X])this.ui[X].style[Q]=q[X][Q];return this},U.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},U.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},U.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},U.prototype.show=function(q){var X=this;return X.options.dataOnly||(clearTimeout(X.removeTimeout),clearTimeout(X.showTimeout),clearTimeout(X.restTimeout),X.addToDom(),X.restCallback(),setTimeout((function(){X.ui.el.style.opacity=1}),0),X.showTimeout=setTimeout((function(){X.trigger("shown",X.instance),"function"==typeof q&&q.call(this)}),X.options.fadeTime)),X},U.prototype.hide=function(q){var X=this;if(X.options.dataOnly)return X;if(X.ui.el.style.opacity=X.options.restOpacity,clearTimeout(X.removeTimeout),clearTimeout(X.showTimeout),clearTimeout(X.restTimeout),X.removeTimeout=setTimeout((function(){var Q="dynamic"===X.options.mode?"none":"block";X.ui.el.style.display=Q,"function"==typeof q&&q.call(X),X.trigger("hidden",X.instance)}),X.options.fadeTime),X.options.restJoystick){var Q=X.options.restJoystick,y={};y.x=!0===Q||!1!==Q.x?0:X.instance.frontPosition.x,y.y=!0===Q||!1!==Q.y?0:X.instance.frontPosition.y,X.setPosition(q,y)}return X},U.prototype.setPosition=function(q,X){var Q=this;Q.frontPosition={x:X.x,y:X.y};var y=Q.options.fadeTime+"ms",x={};x.front=f("transition",["transform"],y);var u={front:{}};u.front={transform:"translate("+Q.frontPosition.x+"px,"+Q.frontPosition.y+"px)"},Q.applyStyles(x),Q.applyStyles(u),Q.restTimeout=setTimeout((function(){"function"==typeof q&&q.call(Q),Q.restCallback()}),Q.options.fadeTime)},U.prototype.restCallback=function(){var q=this,X={};X.front=f("transition","none",""),q.applyStyles(X),q.trigger("rested",q.instance)},U.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},U.prototype.computeDirection=function(q){var X,Q,y,x=q.angle.radian,u=Math.PI/4,H=Math.PI/2;if(x>u&&x<3*u&&!q.lockX?X="up":x>-u&&x<=u&&!q.lockY?X="left":x>3*-u&&x<=-u&&!q.lockX?X="down":q.lockY||(X="right"),q.lockY||(Q=x>-H&&x<H?"left":"right"),q.lockX||(y=x>0?"up":"down"),q.force>this.options.threshold){var b,D={};for(b in this.direction)this.direction.hasOwnProperty(b)&&(D[b]=this.direction[b]);var a={};for(b in this.direction={x:Q,y:y,angle:X},q.direction=this.direction,D)D[b]===this.direction[b]&&(a[b]=!0);if(a.x&&a.y&&a.angle)return q;a.x&&a.y||this.trigger("plain",q),a.x||this.trigger("plain:"+Q,q),a.y||this.trigger("plain:"+y,q),a.angle||this.trigger("dir dir:"+X,q)}else this.resetDirection();return q};const O=U;function g(q,X){var Q=this;Q.nipples=[],Q.idles=[],Q.actives=[],Q.ids=[],Q.pressureIntervals={},Q.manager=q,Q.id=g.id,g.id+=1,Q.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},Q.config(X),"static"!==Q.options.mode&&"semi"!==Q.options.mode||(Q.options.multitouch=!1),Q.options.multitouch||(Q.options.maxNumberOfNipples=1);var y=getComputedStyle(Q.options.zone.parentElement);return y&&"flex"===y.display&&(Q.parentIsFlex=!0),Q.updateBox(),Q.prepareNipples(),Q.uj(),Q.begin(),Q.nipples}g.prototype=new Z,g.constructor=g,g.id=0,g.prototype.prepareNipples=function(){var q=this,X=q.nipples;X.on=q.on.bind(q),X.off=q.off.bind(q),X.options=q.options,X.destroy=q.destroy.bind(q),X.ids=q.ids,X.id=q.id,X.processOnMove=q.processOnMove.bind(q),X.processOnEnd=q.processOnEnd.bind(q),X.get=function(q){if(void 0===q)return X[0];for(var Q=0,y=X.length;Q<y;Q+=1)if(X[Q].identifier===q)return X[Q];return!1}},g.prototype.uj=function(){var q=this;q.bindEvt(q.options.zone,"start"),q.options.zone.style.touchAction="none",q.options.zone.style.msTouchAction="none"},g.prototype.begin=function(){var q=this,X=q.options;if("static"===X.mode){var Q=q.createNipple(X.position,q.manager.getIdentifier());Q.add(),q.idles.push(Q)}},g.prototype.createNipple=function(q,X){var Q=this,y=Q.manager.scroll,x={},u=Q.options,H=Q.parentIsFlex?y.x:y.x+Q.box.left,b=Q.parentIsFlex?y.y:y.y+Q.box.top;if(q.x&&q.y)x={x:q.x-H,y:q.y-b};else if(q.top||q.right||q.bottom||q.left){var D=document.createElement("DIV");D.style.display="hidden",D.style.top=q.top,D.style.right=q.right,D.style.bottom=q.bottom,D.style.left=q.left,D.style.position="absolute",u.zone.appendChild(D);var a=D.getBoundingClientRect();u.zone.removeChild(D),x=q,q={x:a.left+y.x,y:a.top+y.y}}var R=new O(Q,{color:u.color,size:u.size,threshold:u.threshold,fadeTime:u.fadeTime,dataOnly:u.dataOnly,restJoystick:u.restJoystick,restOpacity:u.restOpacity,mode:u.mode,identifier:X,position:q,zone:u.zone,frontPosition:{x:0,y:0},shape:u.shape});return u.dataOnly||(L(R.ui.el,x),L(R.ui.front,R.frontPosition)),Q.nipples.push(R),Q.trigger("added "+R.identifier+":added",R),Q.manager.trigger("added "+R.identifier+":added",R),Q.bindNipple(R),R},g.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},g.prototype.bindNipple=function(q){var X,Q=this,y=function(q,y){X=q.type+" "+y.id+":"+q.type,Q.trigger(X,y)};q.on("destroyed",Q.onDestroyed.bind(Q)),q.on("shown hidden rested dir plain",y),q.on("dir:up dir:right dir:down dir:left",y),q.on("plain:up plain:right plain:down plain:left",y)},g.prototype.pressureFn=function(q,X,Q){var y=this,x=0;clearInterval(y.pressureIntervals[Q]),y.pressureIntervals[Q]=setInterval(function(){var Q=q.force||q.pressure||q.webkitForce||0;Q!==x&&(X.trigger("pressure",Q),y.trigger("pressure "+X.identifier+":pressure",Q),x=Q)}.bind(y),100)},g.prototype.onstart=function(q){var X=this,Q=X.options,y=q;return q=a(q),X.updateBox(),I(q,(function(x){X.actives.length<Q.maxNumberOfNipples?X.processOnStart(x):y.type.match(/^touch/)&&(Object.keys(X.manager.ids).forEach((function(Q){if(Object.values(y.touches).findIndex((function(q){return q.identifier===Q}))<0){var x=[q[0]];x.identifier=Q,X.processOnEnd(x)}})),X.actives.length<Q.maxNumberOfNipples&&X.processOnStart(x))})),X.manager.bindDocument(),!1},g.prototype.processOnStart=function(q){var X,Q=this,x=Q.options,u=Q.manager.getIdentifier(q),H=q.force||q.pressure||q.webkitForce||0,b={x:q.pageX,y:q.pageY},D=Q.getOrCreate(u,b);D.identifier!==u&&Q.manager.removeIdentifier(D.identifier),D.identifier=u;var a=function(X){X.trigger("start",X),Q.trigger("start "+X.id+":start",X),X.show(),H>0&&Q.pressureFn(q,X,X.identifier),Q.processOnMove(q)};if((X=Q.idles.indexOf(D))>=0&&Q.idles.splice(X,1),Q.actives.push(D),Q.ids.push(D.identifier),"semi"!==x.mode)a(D);else{if(!(y(b,D.position)<=x.catchDistance))return D.destroy(),void Q.processOnStart(q);a(D)}return D},g.prototype.getOrCreate=function(q,X){var Q,y=this,x=y.options;return/(semi|static)/.test(x.mode)?(Q=y.idles[0])?(y.idles.splice(0,1),Q):"semi"===x.mode?y.createNipple(X,q):(console.warn("Coudln't find the needed nipple."),!1):Q=y.createNipple(X,q)},g.prototype.processOnMove=function(q){var X=this,Q=X.options,u=X.manager.getIdentifier(q),H=X.nipples.get(u),b=X.manager.scroll;if(function(q){return isNaN(q.buttons)?0!==q.pressure:0!==q.buttons}(q)){if(!H)return console.error("Found zombie joystick with ID "+u),void X.manager.removeIdentifier(u);if(Q.dynamicPage){var D=H.el.getBoundingClientRect();H.position={x:b.x+D.left,y:b.y+D.top}}H.identifier=u;var a=H.options.size/2,R={x:q.pageX,y:q.pageY};Q.lockX&&(R.y=H.position.y),Q.lockY&&(R.x=H.position.x);var L,f,k,j,I,d,e,i,A,B,w=y(R,H.position),V=(L=R,k=(f=H.position).x-L.x,j=f.y-L.y,function(q){return q*(180/Math.PI)}(Math.atan2(j,k))),W=x(V),v=w/a,Z={distance:w,position:R};if("circle"===H.options.shape?(I=Math.min(w,a),e=H.position,i=I,B={x:0,y:0},A=x(A=V),B.x=e.x-i*Math.cos(A),B.y=e.y-i*Math.sin(A),d=B):(d=function(q,X,Q){return{x:Math.min(Math.max(q.x,X.x-Q),X.x+Q),y:Math.min(Math.max(q.y,X.y-Q),X.y+Q)}}(R,H.position,a),I=y(d,H.position)),Q.follow){if(w>a){var U=R.x-d.x,O=R.y-d.y;H.position.x+=U,H.position.y+=O,H.el.style.top=H.position.y-(X.box.top+b.y)+"px",H.el.style.left=H.position.x-(X.box.left+b.x)+"px",w=y(R,H.position)}}else R=d,w=I;var g=R.x-H.position.x,P=R.y-H.position.y;H.frontPosition={x:g,y:P},Q.dataOnly||(H.ui.front.style.transform="translate("+g+"px,"+P+"px)");var F={identifier:H.identifier,position:R,force:v,pressure:q.force||q.pressure||q.webkitForce||0,distance:w,angle:{radian:W,degree:V},vector:{x:g/a,y:-P/a},raw:Z,instance:H,lockX:Q.lockX,lockY:Q.lockY};(F=H.computeDirection(F)).angle={radian:x(180-V),degree:180-V},H.trigger("move",F),X.trigger("move "+H.id+":move",F)}else this.processOnEnd(q)},g.prototype.processOnEnd=function(q){var X=this,Q=X.options,y=X.manager.getIdentifier(q),x=X.nipples.get(y),u=X.manager.removeIdentifier(x.identifier);x&&(Q.dataOnly||x.hide((function(){"dynamic"===Q.mode&&(x.trigger("removed",x),X.trigger("removed "+x.id+":removed",x),X.manager.trigger("removed "+x.id+":removed",x),x.destroy())})),clearInterval(X.pressureIntervals[x.identifier]),x.resetDirection(),x.trigger("end",x),X.trigger("end "+x.id+":end",x),X.ids.indexOf(x.identifier)>=0&&X.ids.splice(X.ids.indexOf(x.identifier),1),X.actives.indexOf(x)>=0&&X.actives.splice(X.actives.indexOf(x),1),/(semi|static)/.test(Q.mode)?X.idles.push(x):X.nipples.indexOf(x)>=0&&X.nipples.splice(X.nipples.indexOf(x),1),X.manager.unbindDocument(),/(semi|static)/.test(Q.mode)&&(X.manager.ids[u.id]=u.identifier))},g.prototype.onDestroyed=function(q,X){var Q=this;Q.nipples.indexOf(X)>=0&&Q.nipples.splice(Q.nipples.indexOf(X),1),Q.actives.indexOf(X)>=0&&Q.actives.splice(Q.actives.indexOf(X),1),Q.idles.indexOf(X)>=0&&Q.idles.splice(Q.idles.indexOf(X),1),Q.ids.indexOf(X.identifier)>=0&&Q.ids.splice(Q.ids.indexOf(X.identifier),1),Q.manager.removeIdentifier(X.identifier),Q.manager.unbindDocument()},g.prototype.destroy=function(){var q=this;for(var X in q.unbindEvt(q.options.zone,"start"),q.nipples.forEach((function(q){q.destroy()})),q.pressureIntervals)q.pressureIntervals.hasOwnProperty(X)&&clearInterval(q.pressureIntervals[X]);q.trigger("destroyed",q.nipples),q.manager.unbindDocument(),q.off()};const P=g;function F(q){var X=this;X.ids={},X.index=0,X.collections=[],X.scroll=R(),X.config(q),X.prepareCollections();var Q=function(){var q;X.collections.forEach((function(Q){Q.forEach((function(Q){q=Q.el.getBoundingClientRect(),Q.position={x:X.scroll.x+q.left,y:X.scroll.y+q.top}}))}))};b(window,"resize",(function(){H(Q)}));var y=function(){X.scroll=R()};return b(window,"scroll",(function(){H(y)})),X.collections}F.prototype=new Z,F.constructor=F,F.prototype.prepareCollections=function(){var q=this;q.collections.create=q.create.bind(q),q.collections.on=q.on.bind(q),q.collections.off=q.off.bind(q),q.collections.destroy=q.destroy.bind(q),q.collections.get=function(X){var Q;return q.collections.every((function(q){return!(Q=q.get(X))})),Q}},F.prototype.create=function(q){return this.createCollection(q)},F.prototype.createCollection=function(q){var X=this,Q=new P(X,q);return X.bindCollection(Q),X.collections.push(Q),Q},F.prototype.bindCollection=function(q){var X,Q=this,y=function(q,y){X=q.type+" "+y.id+":"+q.type,Q.trigger(X,y)};q.on("destroyed",Q.onDestroyed.bind(Q)),q.on("shown hidden rested dir plain",y),q.on("dir:up dir:right dir:down dir:left",y),q.on("plain:up plain:right plain:down plain:left",y)},F.prototype.bindDocument=function(){var q=this;q.binded||(q.bindEvt(document,"move").bindEvt(document,"end"),q.binded=!0)},F.prototype.unbindDocument=function(q){var X=this;Object.keys(X.ids).length&&!0!==q||(X.unbindEvt(document,"move").unbindEvt(document,"end"),X.binded=!1)},F.prototype.getIdentifier=function(q){var X;return q?void 0===(X=void 0===q.identifier?q.pointerId:q.identifier)&&(X=this.latest||0):X=this.index,void 0===this.ids[X]&&(this.ids[X]=this.index,this.index+=1),this.latest=X,this.ids[X]},F.prototype.removeIdentifier=function(q){var X={};for(var Q in this.ids)if(this.ids[Q]===q){X.id=Q,X.identifier=this.ids[Q],delete this.ids[Q];break}return X},F.prototype.onmove=function(q){return this.onAny("move",q),!1},F.prototype.onend=function(q){return this.onAny("end",q),!1},F.prototype.oncancel=function(q){return this.onAny("end",q),!1},F.prototype.onAny=function(q,X){var Q,y=this,x="processOn"+q.charAt(0).toUpperCase()+q.slice(1);X=a(X);var u=function(q,X,Q){Q.ids.indexOf(X)>=0&&(Q[x](q),q._found_=!0)};return I(X,(function(q){Q=y.getIdentifier(q),I(y.collections,u.bind(null,q,Q)),q._found_||y.removeIdentifier(Q)})),!1},F.prototype.destroy=function(){var q=this;q.unbindDocument(!0),q.ids={},q.index=0,q.collections.forEach((function(q){q.destroy()})),q.off()},F.prototype.onDestroyed=function(q,X){var Q=this;if(Q.collections.indexOf(X)<0)return!1;Q.collections.splice(Q.collections.indexOf(X),1)};var l=new F;const m={create:function(q){return l.create(q)},factory:l};return X.default})(),q.exports=X()},11154:(q,X,Q)=>{"use strict";const{Deflate:y,deflate:x,deflateRaw:u,gzip:H}=Q(11161),{Inflate:b,inflate:D,inflateRaw:a,ungzip:R}=Q(11210),L=Q(11188);q.exports.Deflate=y,q.exports.deflate=x,q.exports.deflateRaw=u,q.exports.gzip=H,q.exports.Inflate=b,q.exports.inflate=D,q.exports.inflateRaw=a,q.exports.ungzip=R,q.exports.constants=L},11161:(q,X,Q)=>{"use strict";const y=Q(11166),x=Q(11191),u=Q(11200),H=Q(11181),b=Q(11208),D=Object.prototype.toString,{Z_NO_FLUSH:a,Z_SYNC_FLUSH:R,Z_FULL_FLUSH:L,Z_FINISH:f,Z_OK:k,Z_STREAM_END:j,Z_DEFAULT_COMPRESSION:I,Z_DEFAULT_STRATEGY:d,Z_DEFLATED:e}=Q(11188);function i(q){this.options=x.assign({level:I,method:e,Ja:16384,windowBits:15,memLevel:8,strategy:d},q||{});let X=this.options;X.raw&&X.windowBits>0?X.windowBits=-X.windowBits:X.gzip&&X.windowBits>0&&X.windowBits<16&&(X.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new b,this.strm.avail_out=0;let Q=y.deflateInit2(this.strm,X.level,X.method,X.windowBits,X.memLevel,X.strategy);if(Q!==k)throw new Error(H[Q]);if(X.header&&y.deflateSetHeader(this.strm,X.header),X.dictionary){let q;if(q="string"===typeof X.dictionary?u.string2buf(X.dictionary):"[object ArrayBuffer]"===D.call(X.dictionary)?new Uint8Array(X.dictionary):X.dictionary,Q=y.deflateSetDictionary(this.strm,q),Q!==k)throw new Error(H[Q]);this._dict_set=!0}}function A(q,X){const Q=new i(X);if(Q.push(q,!0),Q.err)throw Q.msg||H[Q.err];return Q.result}i.prototype.push=function(q,X){const Q=this.strm,x=this.options.Ja;let H,b;if(this.ended)return!1;for(b=X===~~X?X:!0===X?f:a,"string"===typeof q?Q.input=u.string2buf(q):"[object ArrayBuffer]"===D.call(q)?Q.input=new Uint8Array(q):Q.input=q,Q.next_in=0,Q.avail_in=Q.input.length;;)if(0===Q.avail_out&&(Q.output=new Uint8Array(x),Q.next_out=0,Q.avail_out=x),(b===R||b===L)&&Q.avail_out<=6)this.onData(Q.output.subarray(0,Q.next_out)),Q.avail_out=0;else{if(H=y.deflate(Q,b),H===j)return Q.next_out>0&&this.onData(Q.output.subarray(0,Q.next_out)),H=y.deflateEnd(this.strm),this.onEnd(H),this.ended=!0,H===k;if(0!==Q.avail_out){if(b>0&&Q.next_out>0)this.onData(Q.output.subarray(0,Q.next_out)),Q.avail_out=0;else if(0===Q.avail_in)break}else this.onData(Q.output)}return!0},i.prototype.onData=function(q){this.chunks.push(q)},i.prototype.onEnd=function(q){q===k&&(this.result=x.flattenChunks(this.chunks)),this.chunks=[],this.err=q,this.msg=this.strm.msg},q.exports.Deflate=i,q.exports.deflate=A,q.exports.deflateRaw=function(q,X){return(X=X||{}).raw=!0,A(q,X)},q.exports.gzip=function(q,X){return(X=X||{}).gzip=!0,A(q,X)},q.exports.constants=Q(11188)},11210:(q,X,Q)=>{"use strict";const y=Q(11217),x=Q(11191),u=Q(11200),H=Q(11181),b=Q(11208),D=Q(11227),a=Object.prototype.toString,{Z_NO_FLUSH:R,Z_FINISH:L,Z_OK:f,Z_STREAM_END:k,Z_NEED_DICT:j,Z_STREAM_ERROR:I,Z_DATA_ERROR:d,Z_MEM_ERROR:e}=Q(11188);function i(q){this.options=x.assign({Ja:65536,windowBits:15,to:""},q||{});const X=this.options;X.raw&&X.windowBits>=0&&X.windowBits<16&&(X.windowBits=-X.windowBits,0===X.windowBits&&(X.windowBits=-15)),!(X.windowBits>=0&&X.windowBits<16)||q&&q.windowBits||(X.windowBits+=32),X.windowBits>15&&X.windowBits<48&&0===(15&X.windowBits)&&(X.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new b,this.strm.avail_out=0;let Q=y.inflateInit2(this.strm,X.windowBits);if(Q!==f)throw new Error(H[Q]);if(this.header=new D,y.inflateGetHeader(this.strm,this.header),X.dictionary&&("string"===typeof X.dictionary?X.dictionary=u.string2buf(X.dictionary):"[object ArrayBuffer]"===a.call(X.dictionary)&&(X.dictionary=new Uint8Array(X.dictionary)),X.raw&&(Q=y.inflateSetDictionary(this.strm,X.dictionary),Q!==f)))throw new Error(H[Q])}function A(q,X){const Q=new i(X);if(Q.push(q),Q.err)throw Q.msg||H[Q.err];return Q.result}i.prototype.push=function(q,X){const Q=this.strm,x=this.options.Ja,H=this.options.dictionary;let b,D,i;if(this.ended)return!1;for(D=X===~~X?X:!0===X?L:R,"[object ArrayBuffer]"===a.call(q)?Q.input=new Uint8Array(q):Q.input=q,Q.next_in=0,Q.avail_in=Q.input.length;;){for(0===Q.avail_out&&(Q.output=new Uint8Array(x),Q.next_out=0,Q.avail_out=x),b=y.inflate(Q,D),b===j&&H&&(b=y.inflateSetDictionary(Q,H),b===f?b=y.inflate(Q,D):b===d&&(b=j));Q.avail_in>0&&b===k&&Q.state.wrap>0&&0!==q[Q.next_in];)y.inflateReset(Q),b=y.inflate(Q,D);switch(b){case I:case d:case j:case e:return this.onEnd(b),this.ended=!0,!1}if(i=Q.avail_out,Q.next_out&&(0===Q.avail_out||b===k))if("string"===this.options.to){let q=u.utf8border(Q.output,Q.next_out),X=Q.next_out-q,y=u.buf2string(Q.output,q);Q.next_out=X,Q.avail_out=x-X,X&&Q.output.set(Q.output.subarray(q,q+X),0),this.onData(y)}else this.onData(Q.output.length===Q.next_out?Q.output:Q.output.subarray(0,Q.next_out));if(b!==f||0!==i){if(b===k)return b=y.inflateEnd(this.strm),this.onEnd(b),this.ended=!0,!0;if(0===Q.avail_in)break}}return!0},i.prototype.onData=function(q){this.chunks.push(q)},i.prototype.onEnd=function(q){q===f&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=x.flattenChunks(this.chunks)),this.chunks=[],this.err=q,this.msg=this.strm.msg},q.exports.Inflate=i,q.exports.inflate=A,q.exports.inflateRaw=function(q,X){return(X=X||{}).raw=!0,A(q,X)},q.exports.ungzip=A,q.exports.constants=Q(11188)},11191:q=>{"use strict";const X=(q,X)=>Object.prototype.hasOwnProperty.call(q,X);q.exports.assign=function(q){const Q=Array.prototype.slice.call(arguments,1);for(;Q.length;){const y=Q.shift();if(y){if("object"!==typeof y)throw new TypeError(y+"must be non-object");for(const Q in y)X(y,Q)&&(q[Q]=y[Q])}}return q},q.exports.flattenChunks=q=>{let X=0;for(let y=0,x=q.length;y<x;y++)X+=q[y].length;const Q=new Uint8Array(X);for(let y=0,x=0,u=q.length;y<u;y++){let X=q[y];Q.set(X,x),x+=X.length}return Q}},11200:q=>{"use strict";let X=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(y){X=!1}const Q=new Uint8Array(256);for(let x=0;x<256;x++)Q[x]=x>=252?6:x>=248?5:x>=240?4:x>=224?3:x>=192?2:1;Q[254]=Q[254]=1,q.exports.string2buf=q=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(q);let X,Q,y,x,u,H=q.length,b=0;for(x=0;x<H;x++)Q=q.charCodeAt(x),55296===(64512&Q)&&x+1<H&&(y=q.charCodeAt(x+1),56320===(64512&y)&&(Q=65536+(Q-55296<<10)+(y-56320),x++)),b+=Q<128?1:Q<2048?2:Q<65536?3:4;for(X=new Uint8Array(b),u=0,x=0;u<b;x++)Q=q.charCodeAt(x),55296===(64512&Q)&&x+1<H&&(y=q.charCodeAt(x+1),56320===(64512&y)&&(Q=65536+(Q-55296<<10)+(y-56320),x++)),Q<128?X[u++]=Q:Q<2048?(X[u++]=192|Q>>>6,X[u++]=128|63&Q):Q<65536?(X[u++]=224|Q>>>12,X[u++]=128|Q>>>6&63,X[u++]=128|63&Q):(X[u++]=240|Q>>>18,X[u++]=128|Q>>>12&63,X[u++]=128|Q>>>6&63,X[u++]=128|63&Q);return X};q.exports.buf2string=(q,y)=>{const x=y||q.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(q.subarray(0,y));let u,H;const b=new Array(2*x);for(H=0,u=0;u<x;){let X=q[u++];if(X<128){b[H++]=X;continue}let y=Q[X];if(y>4)b[H++]=65533,u+=y-1;else{for(X&=2===y?31:3===y?15:7;y>1&&u<x;)X=X<<6|63&q[u++],y--;y>1?b[H++]=65533:X<65536?b[H++]=X:(X-=65536,b[H++]=55296|X>>10&1023,b[H++]=56320|1023&X)}}return((q,Q)=>{if(Q<65534&&q.subarray&&X)return String.fromCharCode.apply(null,q.length===Q?q:q.subarray(0,Q));let y="";for(let X=0;X<Q;X++)y+=String.fromCharCode(q[X]);return y})(b,H)},q.exports.utf8border=(q,X)=>{(X=X||q.length)>q.length&&(X=q.length);let y=X-1;for(;y>=0&&128===(192&q[y]);)y--;return y<0||0===y?X:y+Q[q[y]]>X?y:X}},11175:q=>{"use strict";q.exports=(q,X,Q,y)=>{let x=65535&q,u=q>>>16&65535,H=0;for(;0!==Q;){H=Q>2e3?2e3:Q,Q-=H;do{x=x+X[y++]|0,u=u+x|0}while(--H);x%=65521,u%=65521}return x|u<<16}},11188:q=>{"use strict";q.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},11179:q=>{"use strict";const X=new Uint32Array((()=>{let q,X=[];for(var Q=0;Q<256;Q++){q=Q;for(var y=0;y<8;y++)q=1&q?3988292384^q>>>1:q>>>1;X[Q]=q}return X})());q.exports=(q,Q,y,x)=>{const u=X,H=x+y;q^=-1;for(let X=x;X<H;X++)q=q>>>8^u[255&(q^Q[X])];return~q}},11166:(q,X,Q)=>{"use strict";const{_tr_init:y,_tr_stored_block:x,_tr_flush_block:u,_tr_tally:H,_tr_align:b}=Q(11169),D=Q(11175),a=Q(11179),R=Q(11181),{Z_NO_FLUSH:L,Z_PARTIAL_FLUSH:f,Z_FULL_FLUSH:k,Z_FINISH:j,Z_BLOCK:I,Z_OK:d,Z_STREAM_END:e,Z_STREAM_ERROR:i,Z_DATA_ERROR:A,Z_BUF_ERROR:B,Z_DEFAULT_COMPRESSION:w,Z_FILTERED:V,Z_HUFFMAN_ONLY:W,Z_RLE:v,Z_FIXED:Z,Z_DEFAULT_STRATEGY:U,Z_UNKNOWN:O,Z_DEFLATED:g}=Q(11188),P=258,F=262,l=103,m=113,M=666,o=(q,X)=>(q.msg=R[X],X),Y=q=>(q<<1)-(q>4?9:0),N=q=>{let X=q.length;for(;--X>=0;)q[X]=0};let S=(q,X,Q)=>(X<<q.hash_shift^Q)&q.hash_mask;const c=q=>{const X=q.state;let Q=X.pending;Q>q.avail_out&&(Q=q.avail_out),0!==Q&&(q.output.set(X.pending_buf.subarray(X.pending_out,X.pending_out+Q),q.next_out),q.next_out+=Q,X.pending_out+=Q,q.total_out+=Q,q.avail_out-=Q,X.pending-=Q,0===X.pending&&(X.pending_out=0))},p=(q,X)=>{u(q,q.block_start>=0?q.block_start:-1,q.strstart-q.block_start,X),q.block_start=q.strstart,c(q.strm)},t=(q,X)=>{q.pending_buf[q.pending++]=X},z=(q,X)=>{q.pending_buf[q.pending++]=X>>>8&255,q.pending_buf[q.pending++]=255&X},K=(q,X,Q,y)=>{let x=q.avail_in;return x>y&&(x=y),0===x?0:(q.avail_in-=x,X.set(q.input.subarray(q.next_in,q.next_in+x),Q),1===q.state.wrap?q.adler=D(q.adler,X,x,Q):2===q.state.wrap&&(q.adler=a(q.adler,X,x,Q)),q.next_in+=x,q.total_in+=x,x)},h=(q,X)=>{let Q,y,x=q.max_chain_length,u=q.strstart,H=q.prev_length,b=q.nice_match;const D=q.strstart>q.w_size-F?q.strstart-(q.w_size-F):0,a=q.window,R=q.w_mask,L=q.prev,f=q.strstart+P;let k=a[u+H-1],j=a[u+H];q.prev_length>=q.good_match&&(x>>=2),b>q.lookahead&&(b=q.lookahead);do{if(Q=X,a[Q+H]===j&&a[Q+H-1]===k&&a[Q]===a[u]&&a[++Q]===a[u+1]){u+=2,Q++;do{}while(a[++u]===a[++Q]&&a[++u]===a[++Q]&&a[++u]===a[++Q]&&a[++u]===a[++Q]&&a[++u]===a[++Q]&&a[++u]===a[++Q]&&a[++u]===a[++Q]&&a[++u]===a[++Q]&&u<f);if(y=P-(f-u),u=f-P,y>H){if(q.match_start=X,H=y,y>=b)break;k=a[u+H-1],j=a[u+H]}}}while((X=L[X&R])>D&&0!==--x);return H<=q.lookahead?H:q.lookahead},G=q=>{const X=q.w_size;let Q,y,x,u,H;do{if(u=q.window_size-q.lookahead-q.strstart,q.strstart>=X+(X-F)){q.window.set(q.window.subarray(X,X+X),0),q.match_start-=X,q.strstart-=X,q.block_start-=X,y=q.hash_size,Q=y;do{x=q.head[--Q],q.head[Q]=x>=X?x-X:0}while(--y);y=X,Q=y;do{x=q.prev[--Q],q.prev[Q]=x>=X?x-X:0}while(--y);u+=X}if(0===q.strm.avail_in)break;if(y=K(q.strm,q.window,q.strstart+q.lookahead,u),q.lookahead+=y,q.lookahead+q.insert>=3)for(H=q.strstart-q.insert,q.ins_h=q.window[H],q.ins_h=S(q,q.ins_h,q.window[H+1]);q.insert&&(q.ins_h=S(q,q.ins_h,q.window[H+3-1]),q.prev[H&q.w_mask]=q.head[q.ins_h],q.head[q.ins_h]=H,H++,q.insert--,!(q.lookahead+q.insert<3)););}while(q.lookahead<F&&0!==q.strm.avail_in)},C=(q,X)=>{let Q,y;for(;;){if(q.lookahead<F){if(G(q),q.lookahead<F&&X===L)return 1;if(0===q.lookahead)break}if(Q=0,q.lookahead>=3&&(q.ins_h=S(q,q.ins_h,q.window[q.strstart+3-1]),Q=q.prev[q.strstart&q.w_mask]=q.head[q.ins_h],q.head[q.ins_h]=q.strstart),0!==Q&&q.strstart-Q<=q.w_size-F&&(q.match_length=h(q,Q)),q.match_length>=3)if(y=H(q,q.strstart-q.match_start,q.match_length-3),q.lookahead-=q.match_length,q.match_length<=q.max_lazy_match&&q.lookahead>=3){q.match_length--;do{q.strstart++,q.ins_h=S(q,q.ins_h,q.window[q.strstart+3-1]),Q=q.prev[q.strstart&q.w_mask]=q.head[q.ins_h],q.head[q.ins_h]=q.strstart}while(0!==--q.match_length);q.strstart++}else q.strstart+=q.match_length,q.match_length=0,q.ins_h=q.window[q.strstart],q.ins_h=S(q,q.ins_h,q.window[q.strstart+1]);else y=H(q,0,q.window[q.strstart]),q.lookahead--,q.strstart++;if(y&&(p(q,!1),0===q.strm.avail_out))return 1}return q.insert=q.strstart<2?q.strstart:2,X===j?(p(q,!0),0===q.strm.avail_out?3:4):q.last_lit&&(p(q,!1),0===q.strm.avail_out)?1:2},E=(q,X)=>{let Q,y,x;for(;;){if(q.lookahead<F){if(G(q),q.lookahead<F&&X===L)return 1;if(0===q.lookahead)break}if(Q=0,q.lookahead>=3&&(q.ins_h=S(q,q.ins_h,q.window[q.strstart+3-1]),Q=q.prev[q.strstart&q.w_mask]=q.head[q.ins_h],q.head[q.ins_h]=q.strstart),q.prev_length=q.match_length,q.prev_match=q.match_start,q.match_length=2,0!==Q&&q.prev_length<q.max_lazy_match&&q.strstart-Q<=q.w_size-F&&(q.match_length=h(q,Q),q.match_length<=5&&(q.strategy===V||3===q.match_length&&q.strstart-q.match_start>4096)&&(q.match_length=2)),q.prev_length>=3&&q.match_length<=q.prev_length){x=q.strstart+q.lookahead-3,y=H(q,q.strstart-1-q.prev_match,q.prev_length-3),q.lookahead-=q.prev_length-1,q.prev_length-=2;do{++q.strstart<=x&&(q.ins_h=S(q,q.ins_h,q.window[q.strstart+3-1]),Q=q.prev[q.strstart&q.w_mask]=q.head[q.ins_h],q.head[q.ins_h]=q.strstart)}while(0!==--q.prev_length);if(q.match_available=0,q.match_length=2,q.strstart++,y&&(p(q,!1),0===q.strm.avail_out))return 1}else if(q.match_available){if(y=H(q,0,q.window[q.strstart-1]),y&&p(q,!1),q.strstart++,q.lookahead--,0===q.strm.avail_out)return 1}else q.match_available=1,q.strstart++,q.lookahead--}return q.match_available&&(y=H(q,0,q.window[q.strstart-1]),q.match_available=0),q.insert=q.strstart<2?q.strstart:2,X===j?(p(q,!0),0===q.strm.avail_out?3:4):q.last_lit&&(p(q,!1),0===q.strm.avail_out)?1:2};function J(q,X,Q,y,x){this.good_length=q,this.max_lazy=X,this.nice_length=Q,this.max_chain=y,this.func=x}const n=[new J(0,0,0,0,((q,X)=>{let Q=65535;for(Q>q.pending_buf_size-5&&(Q=q.pending_buf_size-5);;){if(q.lookahead<=1){if(G(q),0===q.lookahead&&X===L)return 1;if(0===q.lookahead)break}q.strstart+=q.lookahead,q.lookahead=0;const y=q.block_start+Q;if((0===q.strstart||q.strstart>=y)&&(q.lookahead=q.strstart-y,q.strstart=y,p(q,!1),0===q.strm.avail_out))return 1;if(q.strstart-q.block_start>=q.w_size-F&&(p(q,!1),0===q.strm.avail_out))return 1}return q.insert=0,X===j?(p(q,!0),0===q.strm.avail_out?3:4):(q.strstart>q.block_start&&(p(q,!1),q.strm.avail_out),1)})),new J(4,4,8,4,C),new J(4,5,16,8,C),new J(4,6,32,32,C),new J(4,4,16,16,E),new J(8,16,32,32,E),new J(8,16,128,128,E),new J(8,32,128,256,E),new J(32,128,258,1024,E),new J(32,258,258,4096,E)];function r(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=g,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),N(this.dyn_ltree),N(this.dyn_dtree),N(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),N(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),N(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const s=q=>{if(!q||!q.state)return o(q,i);q.total_in=q.total_out=0,q.data_type=O;const X=q.state;return X.pending=0,X.pending_out=0,X.wrap<0&&(X.wrap=-X.wrap),X.status=X.wrap?42:m,q.adler=2===X.wrap?0:1,X.last_flush=L,y(X),d},T=q=>{const X=s(q);var Q;return X===d&&((Q=q.state).window_size=2*Q.w_size,N(Q.head),Q.max_lazy_match=n[Q.level].max_lazy,Q.good_match=n[Q.level].good_length,Q.nice_match=n[Q.level].nice_length,Q.max_chain_length=n[Q.level].max_chain,Q.strstart=0,Q.block_start=0,Q.lookahead=0,Q.insert=0,Q.match_length=Q.prev_length=2,Q.match_available=0,Q.ins_h=0),X},qq=(q,X,Q,y,x,u)=>{if(!q)return i;let H=1;if(X===w&&(X=6),y<0?(H=0,y=-y):y>15&&(H=2,y-=16),x<1||x>9||Q!==g||y<8||y>15||X<0||X>9||u<0||u>Z)return o(q,i);8===y&&(y=9);const b=new r;return q.state=b,b.strm=q,b.wrap=H,b.gzhead=null,b.w_bits=y,b.w_size=1<<b.w_bits,b.w_mask=b.w_size-1,b.hash_bits=x+7,b.hash_size=1<<b.hash_bits,b.hash_mask=b.hash_size-1,b.hash_shift=~~((b.hash_bits+3-1)/3),b.window=new Uint8Array(2*b.w_size),b.head=new Uint16Array(b.hash_size),b.prev=new Uint16Array(b.w_size),b.lit_bufsize=1<<x+6,b.pending_buf_size=4*b.lit_bufsize,b.pending_buf=new Uint8Array(b.pending_buf_size),b.d_buf=1*b.lit_bufsize,b.l_buf=3*b.lit_bufsize,b.level=X,b.strategy=u,b.method=Q,T(q)};q.exports.deflateInit=(q,X)=>qq(q,X,g,15,8,U),q.exports.deflateInit2=qq,q.exports.deflateReset=T,q.exports.deflateResetKeep=s,q.exports.deflateSetHeader=(q,X)=>q&&q.state?2!==q.state.wrap?i:(q.state.gzhead=X,d):i,q.exports.deflate=(q,X)=>{let Q,y;if(!q||!q.state||X>I||X<0)return q?o(q,i):i;const u=q.state;if(!q.output||!q.input&&0!==q.avail_in||u.status===M&&X!==j)return o(q,0===q.avail_out?B:i);u.strm=q;const D=u.last_flush;if(u.last_flush=X,42===u.status)if(2===u.wrap)q.adler=0,t(u,31),t(u,139),t(u,8),u.gzhead?(t(u,(u.gzhead.text?1:0)+(u.gzhead.hcrc?2:0)+(u.gzhead.extra?4:0)+(u.gzhead.name?8:0)+(u.gzhead.comment?16:0)),t(u,255&u.gzhead.time),t(u,u.gzhead.time>>8&255),t(u,u.gzhead.time>>16&255),t(u,u.gzhead.time>>24&255),t(u,9===u.level?2:u.strategy>=W||u.level<2?4:0),t(u,255&u.gzhead.os),u.gzhead.extra&&u.gzhead.extra.length&&(t(u,255&u.gzhead.extra.length),t(u,u.gzhead.extra.length>>8&255)),u.gzhead.hcrc&&(q.adler=a(q.adler,u.pending_buf,u.pending,0)),u.gzindex=0,u.status=69):(t(u,0),t(u,0),t(u,0),t(u,0),t(u,0),t(u,9===u.level?2:u.strategy>=W||u.level<2?4:0),t(u,3),u.status=m);else{let X=g+(u.w_bits-8<<4)<<8,Q=-1;Q=u.strategy>=W||u.level<2?0:u.level<6?1:6===u.level?2:3,X|=Q<<6,0!==u.strstart&&(X|=32),X+=31-X%31,u.status=m,z(u,X),0!==u.strstart&&(z(u,q.adler>>>16),z(u,65535&q.adler)),q.adler=1}if(69===u.status)if(u.gzhead.extra){for(Q=u.pending;u.gzindex<(65535&u.gzhead.extra.length)&&(u.pending!==u.pending_buf_size||(u.gzhead.hcrc&&u.pending>Q&&(q.adler=a(q.adler,u.pending_buf,u.pending-Q,Q)),c(q),Q=u.pending,u.pending!==u.pending_buf_size));)t(u,255&u.gzhead.extra[u.gzindex]),u.gzindex++;u.gzhead.hcrc&&u.pending>Q&&(q.adler=a(q.adler,u.pending_buf,u.pending-Q,Q)),u.gzindex===u.gzhead.extra.length&&(u.gzindex=0,u.status=73)}else u.status=73;if(73===u.status)if(u.gzhead.name){Q=u.pending;do{if(u.pending===u.pending_buf_size&&(u.gzhead.hcrc&&u.pending>Q&&(q.adler=a(q.adler,u.pending_buf,u.pending-Q,Q)),c(q),Q=u.pending,u.pending===u.pending_buf_size)){y=1;break}y=u.gzindex<u.gzhead.name.length?255&u.gzhead.name.charCodeAt(u.gzindex++):0,t(u,y)}while(0!==y);u.gzhead.hcrc&&u.pending>Q&&(q.adler=a(q.adler,u.pending_buf,u.pending-Q,Q)),0===y&&(u.gzindex=0,u.status=91)}else u.status=91;if(91===u.status)if(u.gzhead.comment){Q=u.pending;do{if(u.pending===u.pending_buf_size&&(u.gzhead.hcrc&&u.pending>Q&&(q.adler=a(q.adler,u.pending_buf,u.pending-Q,Q)),c(q),Q=u.pending,u.pending===u.pending_buf_size)){y=1;break}y=u.gzindex<u.gzhead.comment.length?255&u.gzhead.comment.charCodeAt(u.gzindex++):0,t(u,y)}while(0!==y);u.gzhead.hcrc&&u.pending>Q&&(q.adler=a(q.adler,u.pending_buf,u.pending-Q,Q)),0===y&&(u.status=l)}else u.status=l;if(u.status===l&&(u.gzhead.hcrc?(u.pending+2>u.pending_buf_size&&c(q),u.pending+2<=u.pending_buf_size&&(t(u,255&q.adler),t(u,q.adler>>8&255),q.adler=0,u.status=m)):u.status=m),0!==u.pending){if(c(q),0===q.avail_out)return u.last_flush=-1,d}else if(0===q.avail_in&&Y(X)<=Y(D)&&X!==j)return o(q,B);if(u.status===M&&0!==q.avail_in)return o(q,B);if(0!==q.avail_in||0!==u.lookahead||X!==L&&u.status!==M){let Q=u.strategy===W?((q,X)=>{let Q;for(;;){if(0===q.lookahead&&(G(q),0===q.lookahead)){if(X===L)return 1;break}if(q.match_length=0,Q=H(q,0,q.window[q.strstart]),q.lookahead--,q.strstart++,Q&&(p(q,!1),0===q.strm.avail_out))return 1}return q.insert=0,X===j?(p(q,!0),0===q.strm.avail_out?3:4):q.last_lit&&(p(q,!1),0===q.strm.avail_out)?1:2})(u,X):u.strategy===v?((q,X)=>{let Q,y,x,u;const b=q.window;for(;;){if(q.lookahead<=P){if(G(q),q.lookahead<=P&&X===L)return 1;if(0===q.lookahead)break}if(q.match_length=0,q.lookahead>=3&&q.strstart>0&&(x=q.strstart-1,y=b[x],y===b[++x]&&y===b[++x]&&y===b[++x])){u=q.strstart+P;do{}while(y===b[++x]&&y===b[++x]&&y===b[++x]&&y===b[++x]&&y===b[++x]&&y===b[++x]&&y===b[++x]&&y===b[++x]&&x<u);q.match_length=P-(u-x),q.match_length>q.lookahead&&(q.match_length=q.lookahead)}if(q.match_length>=3?(Q=H(q,1,q.match_length-3),q.lookahead-=q.match_length,q.strstart+=q.match_length,q.match_length=0):(Q=H(q,0,q.window[q.strstart]),q.lookahead--,q.strstart++),Q&&(p(q,!1),0===q.strm.avail_out))return 1}return q.insert=0,X===j?(p(q,!0),0===q.strm.avail_out?3:4):q.last_lit&&(p(q,!1),0===q.strm.avail_out)?1:2})(u,X):n[u.level].func(u,X);if(3!==Q&&4!==Q||(u.status=M),1===Q||3===Q)return 0===q.avail_out&&(u.last_flush=-1),d;if(2===Q&&(X===f?b(u):X!==I&&(x(u,0,0,!1),X===k&&(N(u.head),0===u.lookahead&&(u.strstart=0,u.block_start=0,u.insert=0))),c(q),0===q.avail_out))return u.last_flush=-1,d}return X!==j?d:u.wrap<=0?e:(2===u.wrap?(t(u,255&q.adler),t(u,q.adler>>8&255),t(u,q.adler>>16&255),t(u,q.adler>>24&255),t(u,255&q.total_in),t(u,q.total_in>>8&255),t(u,q.total_in>>16&255),t(u,q.total_in>>24&255)):(z(u,q.adler>>>16),z(u,65535&q.adler)),c(q),u.wrap>0&&(u.wrap=-u.wrap),0!==u.pending?d:e)},q.exports.deflateEnd=q=>{if(!q||!q.state)return i;const X=q.state.status;return 42!==X&&69!==X&&73!==X&&91!==X&&X!==l&&X!==m&&X!==M?o(q,i):(q.state=null,X===m?o(q,A):d)},q.exports.deflateSetDictionary=(q,X)=>{let Q=X.length;if(!q||!q.state)return i;const y=q.state,x=y.wrap;if(2===x||1===x&&42!==y.status||y.lookahead)return i;if(1===x&&(q.adler=D(q.adler,X,Q,0)),y.wrap=0,Q>=y.w_size){0===x&&(N(y.head),y.strstart=0,y.block_start=0,y.insert=0);let q=new Uint8Array(y.w_size);q.set(X.subarray(Q-y.w_size,Q),0),X=q,Q=y.w_size}const u=q.avail_in,H=q.next_in,b=q.input;for(q.avail_in=Q,q.next_in=0,q.input=X,G(y);y.lookahead>=3;){let q=y.strstart,X=y.lookahead-2;do{y.ins_h=S(y,y.ins_h,y.window[q+3-1]),y.prev[q&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=q,q++}while(--X);y.strstart=q,y.lookahead=2,G(y)}return y.strstart+=y.lookahead,y.block_start=y.strstart,y.insert=y.lookahead,y.lookahead=0,y.match_length=y.prev_length=2,y.match_available=0,q.next_in=H,q.input=b,q.avail_in=u,y.wrap=x,d},q.exports.deflateInfo="pako deflate (from Nodeca project)"},11227:q=>{"use strict";q.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},11220:q=>{"use strict";q.exports=function(q,X){let Q,y,x,u,H,b,D,a,R,L,f,k,j,I,d,e,i,A,B,w,V,W,v,Z;const U=q.state;Q=q.next_in,v=q.input,y=Q+(q.avail_in-5),x=q.next_out,Z=q.output,u=x-(X-q.avail_out),H=x+(q.avail_out-257),b=U.dmax,D=U.wsize,a=U.whave,R=U.wnext,L=U.window,f=U.hold,k=U.bits,j=U.lencode,I=U.distcode,d=(1<<U.lenbits)-1,e=(1<<U.distbits)-1;q:do{k<15&&(f+=v[Q++]<<k,k+=8,f+=v[Q++]<<k,k+=8),i=j[f&d];X:for(;;){if(A=i>>>24,f>>>=A,k-=A,A=i>>>16&255,0===A)Z[x++]=65535&i;else{if(!(16&A)){if(0===(64&A)){i=j[(65535&i)+(f&(1<<A)-1)];continue X}if(32&A){U.mode=12;break q}q.msg="invalid literal/length code",U.mode=30;break q}B=65535&i,A&=15,A&&(k<A&&(f+=v[Q++]<<k,k+=8),B+=f&(1<<A)-1,f>>>=A,k-=A),k<15&&(f+=v[Q++]<<k,k+=8,f+=v[Q++]<<k,k+=8),i=I[f&e];Q:for(;;){if(A=i>>>24,f>>>=A,k-=A,A=i>>>16&255,!(16&A)){if(0===(64&A)){i=I[(65535&i)+(f&(1<<A)-1)];continue Q}q.msg="invalid distance code",U.mode=30;break q}if(w=65535&i,A&=15,k<A&&(f+=v[Q++]<<k,k+=8,k<A&&(f+=v[Q++]<<k,k+=8)),w+=f&(1<<A)-1,w>b){q.msg="invalid distance too far back",U.mode=30;break q}if(f>>>=A,k-=A,A=x-u,w>A){if(A=w-A,A>a&&U.sane){q.msg="invalid distance too far back",U.mode=30;break q}if(V=0,W=L,0===R){if(V+=D-A,A<B){B-=A;do{Z[x++]=L[V++]}while(--A);V=x-w,W=Z}}else if(R<A){if(V+=D+R-A,A-=R,A<B){B-=A;do{Z[x++]=L[V++]}while(--A);if(V=0,R<B){A=R,B-=A;do{Z[x++]=L[V++]}while(--A);V=x-w,W=Z}}}else if(V+=R-A,A<B){B-=A;do{Z[x++]=L[V++]}while(--A);V=x-w,W=Z}for(;B>2;)Z[x++]=W[V++],Z[x++]=W[V++],Z[x++]=W[V++],B-=3;B&&(Z[x++]=W[V++],B>1&&(Z[x++]=W[V++]))}else{V=x-w;do{Z[x++]=Z[V++],Z[x++]=Z[V++],Z[x++]=Z[V++],B-=3}while(B>2);B&&(Z[x++]=Z[V++],B>1&&(Z[x++]=Z[V++]))}break}}break}}while(Q<y&&x<H);B=k>>3,Q-=B,k-=B<<3,f&=(1<<k)-1,q.next_in=Q,q.next_out=x,q.avail_in=Q<y?y-Q+5:5-(Q-y),q.avail_out=x<H?H-x+257:257-(x-H),U.hold=f,U.bits=k}},11217:(q,X,Q)=>{"use strict";const y=Q(11175),x=Q(11179),u=Q(11220),H=Q(11222),{Z_FINISH:b,Z_BLOCK:D,Z_TREES:a,Z_OK:R,Z_STREAM_END:L,Z_NEED_DICT:f,Z_STREAM_ERROR:k,Z_DATA_ERROR:j,Z_MEM_ERROR:I,Z_BUF_ERROR:d,Z_DEFLATED:e}=Q(11188),i=12,A=30,B=q=>(q>>>24&255)+(q>>>8&65280)+((65280&q)<<8)+((255&q)<<24);function w(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const V=q=>{if(!q||!q.state)return k;const X=q.state;return q.total_in=q.total_out=X.total=0,q.msg="",X.wrap&&(q.adler=1&X.wrap),X.mode=1,X.last=0,X.havedict=0,X.dmax=32768,X.head=null,X.hold=0,X.bits=0,X.lencode=X.lendyn=new Int32Array(852),X.distcode=X.distdyn=new Int32Array(592),X.sane=1,X.back=-1,R},W=q=>{if(!q||!q.state)return k;const X=q.state;return X.wsize=0,X.whave=0,X.wnext=0,V(q)},v=(q,X)=>{let Q;if(!q||!q.state)return k;const y=q.state;return X<0?(Q=0,X=-X):(Q=1+(X>>4),X<48&&(X&=15)),X&&(X<8||X>15)?k:(null!==y.window&&y.wbits!==X&&(y.window=null),y.wrap=Q,y.wbits=X,W(q))},Z=(q,X)=>{if(!q)return k;const Q=new w;q.state=Q,Q.window=null;const y=v(q,X);return y!==R&&(q.state=null),y};let U,O,g=!0;const P=q=>{if(g){U=new Int32Array(512),O=new Int32Array(32);let X=0;for(;X<144;)q.lens[X++]=8;for(;X<256;)q.lens[X++]=9;for(;X<280;)q.lens[X++]=7;for(;X<288;)q.lens[X++]=8;for(H(1,q.lens,0,288,U,0,q.work,{bits:9}),X=0;X<32;)q.lens[X++]=5;H(2,q.lens,0,32,O,0,q.work,{bits:5}),g=!1}q.lencode=U,q.lenbits=9,q.distcode=O,q.distbits=5},F=(q,X,Q,y)=>{let x;const u=q.state;return null===u.window&&(u.wsize=1<<u.wbits,u.wnext=0,u.whave=0,u.window=new Uint8Array(u.wsize)),y>=u.wsize?(u.window.set(X.subarray(Q-u.wsize,Q),0),u.wnext=0,u.whave=u.wsize):(x=u.wsize-u.wnext,x>y&&(x=y),u.window.set(X.subarray(Q-y,Q-y+x),u.wnext),(y-=x)?(u.window.set(X.subarray(Q-y,Q),0),u.wnext=y,u.whave=u.wsize):(u.wnext+=x,u.wnext===u.wsize&&(u.wnext=0),u.whave<u.wsize&&(u.whave+=x))),0};q.exports.inflateReset=W,q.exports.inflateReset2=v,q.exports.inflateResetKeep=V,q.exports.inflateInit=q=>Z(q,15),q.exports.inflateInit2=Z,q.exports.inflate=(q,X)=>{let Q,w,V,W,v,Z,U,O,g,l,m,M,o,Y,N,S,c,p,t,z,K,h,G=0;const C=new Uint8Array(4);let E,J;const n=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!q||!q.state||!q.output||!q.input&&0!==q.avail_in)return k;Q=q.state,Q.mode===i&&(Q.mode=13),v=q.next_out,V=q.output,U=q.avail_out,W=q.next_in,w=q.input,Z=q.avail_in,O=Q.hold,g=Q.bits,l=Z,m=U,h=R;q:for(;;)switch(Q.mode){case 1:if(0===Q.wrap){Q.mode=13;break}for(;g<16;){if(0===Z)break q;Z--,O+=w[W++]<<g,g+=8}if(2&Q.wrap&&35615===O){Q.check=0,C[0]=255&O,C[1]=O>>>8&255,Q.check=x(Q.check,C,2,0),O=0,g=0,Q.mode=2;break}if(Q.flags=0,Q.head&&(Q.head.done=!1),!(1&Q.wrap)||(((255&O)<<8)+(O>>8))%31){q.msg="incorrect header check",Q.mode=A;break}if((15&O)!==e){q.msg="unknown compression method",Q.mode=A;break}if(O>>>=4,g-=4,K=8+(15&O),0===Q.wbits)Q.wbits=K;else if(K>Q.wbits){q.msg="invalid window size",Q.mode=A;break}Q.dmax=1<<Q.wbits,q.adler=Q.check=1,Q.mode=512&O?10:i,O=0,g=0;break;case 2:for(;g<16;){if(0===Z)break q;Z--,O+=w[W++]<<g,g+=8}if(Q.flags=O,(255&Q.flags)!==e){q.msg="unknown compression method",Q.mode=A;break}if(57344&Q.flags){q.msg="unknown header flags set",Q.mode=A;break}Q.head&&(Q.head.text=O>>8&1),512&Q.flags&&(C[0]=255&O,C[1]=O>>>8&255,Q.check=x(Q.check,C,2,0)),O=0,g=0,Q.mode=3;case 3:for(;g<32;){if(0===Z)break q;Z--,O+=w[W++]<<g,g+=8}Q.head&&(Q.head.time=O),512&Q.flags&&(C[0]=255&O,C[1]=O>>>8&255,C[2]=O>>>16&255,C[3]=O>>>24&255,Q.check=x(Q.check,C,4,0)),O=0,g=0,Q.mode=4;case 4:for(;g<16;){if(0===Z)break q;Z--,O+=w[W++]<<g,g+=8}Q.head&&(Q.head.xflags=255&O,Q.head.os=O>>8),512&Q.flags&&(C[0]=255&O,C[1]=O>>>8&255,Q.check=x(Q.check,C,2,0)),O=0,g=0,Q.mode=5;case 5:if(1024&Q.flags){for(;g<16;){if(0===Z)break q;Z--,O+=w[W++]<<g,g+=8}Q.length=O,Q.head&&(Q.head.extra_len=O),512&Q.flags&&(C[0]=255&O,C[1]=O>>>8&255,Q.check=x(Q.check,C,2,0)),O=0,g=0}else Q.head&&(Q.head.extra=null);Q.mode=6;case 6:if(1024&Q.flags&&(M=Q.length,M>Z&&(M=Z),M&&(Q.head&&(K=Q.head.extra_len-Q.length,Q.head.extra||(Q.head.extra=new Uint8Array(Q.head.extra_len)),Q.head.extra.set(w.subarray(W,W+M),K)),512&Q.flags&&(Q.check=x(Q.check,w,M,W)),Z-=M,W+=M,Q.length-=M),Q.length))break q;Q.length=0,Q.mode=7;case 7:if(2048&Q.flags){if(0===Z)break q;M=0;do{K=w[W+M++],Q.head&&K&&Q.length<65536&&(Q.head.name+=String.fromCharCode(K))}while(K&&M<Z);if(512&Q.flags&&(Q.check=x(Q.check,w,M,W)),Z-=M,W+=M,K)break q}else Q.head&&(Q.head.name=null);Q.length=0,Q.mode=8;case 8:if(4096&Q.flags){if(0===Z)break q;M=0;do{K=w[W+M++],Q.head&&K&&Q.length<65536&&(Q.head.comment+=String.fromCharCode(K))}while(K&&M<Z);if(512&Q.flags&&(Q.check=x(Q.check,w,M,W)),Z-=M,W+=M,K)break q}else Q.head&&(Q.head.comment=null);Q.mode=9;case 9:if(512&Q.flags){for(;g<16;){if(0===Z)break q;Z--,O+=w[W++]<<g,g+=8}if(O!==(65535&Q.check)){q.msg="header crc mismatch",Q.mode=A;break}O=0,g=0}Q.head&&(Q.head.hcrc=Q.flags>>9&1,Q.head.done=!0),q.adler=Q.check=0,Q.mode=i;break;case 10:for(;g<32;){if(0===Z)break q;Z--,O+=w[W++]<<g,g+=8}q.adler=Q.check=B(O),O=0,g=0,Q.mode=11;case 11:if(0===Q.havedict)return q.next_out=v,q.avail_out=U,q.next_in=W,q.avail_in=Z,Q.hold=O,Q.bits=g,f;q.adler=Q.check=1,Q.mode=i;case i:if(X===D||X===a)break q;case 13:if(Q.last){O>>>=7&g,g-=7&g,Q.mode=27;break}for(;g<3;){if(0===Z)break q;Z--,O+=w[W++]<<g,g+=8}switch(Q.last=1&O,O>>>=1,g-=1,3&O){case 0:Q.mode=14;break;case 1:if(P(Q),Q.mode=20,X===a){O>>>=2,g-=2;break q}break;case 2:Q.mode=17;break;case 3:q.msg="invalid block type",Q.mode=A}O>>>=2,g-=2;break;case 14:for(O>>>=7&g,g-=7&g;g<32;){if(0===Z)break q;Z--,O+=w[W++]<<g,g+=8}if((65535&O)!==(O>>>16^65535)){q.msg="invalid stored block lengths",Q.mode=A;break}if(Q.length=65535&O,O=0,g=0,Q.mode=15,X===a)break q;case 15:Q.mode=16;case 16:if(M=Q.length,M){if(M>Z&&(M=Z),M>U&&(M=U),0===M)break q;V.set(w.subarray(W,W+M),v),Z-=M,W+=M,U-=M,v+=M,Q.length-=M;break}Q.mode=i;break;case 17:for(;g<14;){if(0===Z)break q;Z--,O+=w[W++]<<g,g+=8}if(Q.nlen=257+(31&O),O>>>=5,g-=5,Q.ndist=1+(31&O),O>>>=5,g-=5,Q.ncode=4+(15&O),O>>>=4,g-=4,Q.nlen>286||Q.ndist>30){q.msg="too many length or distance symbols",Q.mode=A;break}Q.have=0,Q.mode=18;case 18:for(;Q.have<Q.ncode;){for(;g<3;){if(0===Z)break q;Z--,O+=w[W++]<<g,g+=8}Q.lens[n[Q.have++]]=7&O,O>>>=3,g-=3}for(;Q.have<19;)Q.lens[n[Q.have++]]=0;if(Q.lencode=Q.lendyn,Q.lenbits=7,E={bits:Q.lenbits},h=H(0,Q.lens,0,19,Q.lencode,0,Q.work,E),Q.lenbits=E.bits,h){q.msg="invalid code lengths set",Q.mode=A;break}Q.have=0,Q.mode=19;case 19:for(;Q.have<Q.nlen+Q.ndist;){for(;G=Q.lencode[O&(1<<Q.lenbits)-1],N=G>>>24,S=G>>>16&255,c=65535&G,!(N<=g);){if(0===Z)break q;Z--,O+=w[W++]<<g,g+=8}if(c<16)O>>>=N,g-=N,Q.lens[Q.have++]=c;else{if(16===c){for(J=N+2;g<J;){if(0===Z)break q;Z--,O+=w[W++]<<g,g+=8}if(O>>>=N,g-=N,0===Q.have){q.msg="invalid bit length repeat",Q.mode=A;break}K=Q.lens[Q.have-1],M=3+(3&O),O>>>=2,g-=2}else if(17===c){for(J=N+3;g<J;){if(0===Z)break q;Z--,O+=w[W++]<<g,g+=8}O>>>=N,g-=N,K=0,M=3+(7&O),O>>>=3,g-=3}else{for(J=N+7;g<J;){if(0===Z)break q;Z--,O+=w[W++]<<g,g+=8}O>>>=N,g-=N,K=0,M=11+(127&O),O>>>=7,g-=7}if(Q.have+M>Q.nlen+Q.ndist){q.msg="invalid bit length repeat",Q.mode=A;break}for(;M--;)Q.lens[Q.have++]=K}}if(Q.mode===A)break;if(0===Q.lens[256]){q.msg="invalid code -- missing end-of-block",Q.mode=A;break}if(Q.lenbits=9,E={bits:Q.lenbits},h=H(1,Q.lens,0,Q.nlen,Q.lencode,0,Q.work,E),Q.lenbits=E.bits,h){q.msg="invalid literal/lengths set",Q.mode=A;break}if(Q.distbits=6,Q.distcode=Q.distdyn,E={bits:Q.distbits},h=H(2,Q.lens,Q.nlen,Q.ndist,Q.distcode,0,Q.work,E),Q.distbits=E.bits,h){q.msg="invalid distances set",Q.mode=A;break}if(Q.mode=20,X===a)break q;case 20:Q.mode=21;case 21:if(Z>=6&&U>=258){q.next_out=v,q.avail_out=U,q.next_in=W,q.avail_in=Z,Q.hold=O,Q.bits=g,u(q,m),v=q.next_out,V=q.output,U=q.avail_out,W=q.next_in,w=q.input,Z=q.avail_in,O=Q.hold,g=Q.bits,Q.mode===i&&(Q.back=-1);break}for(Q.back=0;G=Q.lencode[O&(1<<Q.lenbits)-1],N=G>>>24,S=G>>>16&255,c=65535&G,!(N<=g);){if(0===Z)break q;Z--,O+=w[W++]<<g,g+=8}if(S&&0===(240&S)){for(p=N,t=S,z=c;G=Q.lencode[z+((O&(1<<p+t)-1)>>p)],N=G>>>24,S=G>>>16&255,c=65535&G,!(p+N<=g);){if(0===Z)break q;Z--,O+=w[W++]<<g,g+=8}O>>>=p,g-=p,Q.back+=p}if(O>>>=N,g-=N,Q.back+=N,Q.length=c,0===S){Q.mode=26;break}if(32&S){Q.back=-1,Q.mode=i;break}if(64&S){q.msg="invalid literal/length code",Q.mode=A;break}Q.extra=15&S,Q.mode=22;case 22:if(Q.extra){for(J=Q.extra;g<J;){if(0===Z)break q;Z--,O+=w[W++]<<g,g+=8}Q.length+=O&(1<<Q.extra)-1,O>>>=Q.extra,g-=Q.extra,Q.back+=Q.extra}Q.was=Q.length,Q.mode=23;case 23:for(;G=Q.distcode[O&(1<<Q.distbits)-1],N=G>>>24,S=G>>>16&255,c=65535&G,!(N<=g);){if(0===Z)break q;Z--,O+=w[W++]<<g,g+=8}if(0===(240&S)){for(p=N,t=S,z=c;G=Q.distcode[z+((O&(1<<p+t)-1)>>p)],N=G>>>24,S=G>>>16&255,c=65535&G,!(p+N<=g);){if(0===Z)break q;Z--,O+=w[W++]<<g,g+=8}O>>>=p,g-=p,Q.back+=p}if(O>>>=N,g-=N,Q.back+=N,64&S){q.msg="invalid distance code",Q.mode=A;break}Q.offset=c,Q.extra=15&S,Q.mode=24;case 24:if(Q.extra){for(J=Q.extra;g<J;){if(0===Z)break q;Z--,O+=w[W++]<<g,g+=8}Q.offset+=O&(1<<Q.extra)-1,O>>>=Q.extra,g-=Q.extra,Q.back+=Q.extra}if(Q.offset>Q.dmax){q.msg="invalid distance too far back",Q.mode=A;break}Q.mode=25;case 25:if(0===U)break q;if(M=m-U,Q.offset>M){if(M=Q.offset-M,M>Q.whave&&Q.sane){q.msg="invalid distance too far back",Q.mode=A;break}M>Q.wnext?(M-=Q.wnext,o=Q.wsize-M):o=Q.wnext-M,M>Q.length&&(M=Q.length),Y=Q.window}else Y=V,o=v-Q.offset,M=Q.length;M>U&&(M=U),U-=M,Q.length-=M;do{V[v++]=Y[o++]}while(--M);0===Q.length&&(Q.mode=21);break;case 26:if(0===U)break q;V[v++]=Q.length,U--,Q.mode=21;break;case 27:if(Q.wrap){for(;g<32;){if(0===Z)break q;Z--,O|=w[W++]<<g,g+=8}if(m-=U,q.total_out+=m,Q.total+=m,m&&(q.adler=Q.check=Q.flags?x(Q.check,V,m,v-m):y(Q.check,V,m,v-m)),m=U,(Q.flags?O:B(O))!==Q.check){q.msg="incorrect data check",Q.mode=A;break}O=0,g=0}Q.mode=28;case 28:if(Q.wrap&&Q.flags){for(;g<32;){if(0===Z)break q;Z--,O+=w[W++]<<g,g+=8}if(O!==(4294967295&Q.total)){q.msg="incorrect length check",Q.mode=A;break}O=0,g=0}Q.mode=29;case 29:h=L;break q;case A:h=j;break q;case 31:return I;default:return k}return q.next_out=v,q.avail_out=U,q.next_in=W,q.avail_in=Z,Q.hold=O,Q.bits=g,(Q.wsize||m!==q.avail_out&&Q.mode<A&&(Q.mode<27||X!==b))&&F(q,q.output,q.next_out,m-q.avail_out)?(Q.mode=31,I):(l-=q.avail_in,m-=q.avail_out,q.total_in+=l,q.total_out+=m,Q.total+=m,Q.wrap&&m&&(q.adler=Q.check=Q.flags?x(Q.check,V,m,q.next_out-m):y(Q.check,V,m,q.next_out-m)),q.data_type=Q.bits+(Q.last?64:0)+(Q.mode===i?128:0)+(20===Q.mode||15===Q.mode?256:0),(0===l&&0===m||X===b)&&h===R&&(h=d),h)},q.exports.inflateEnd=q=>{if(!q||!q.state)return k;let X=q.state;return X.window&&(X.window=null),q.state=null,R},q.exports.inflateGetHeader=(q,X)=>{if(!q||!q.state)return k;const Q=q.state;return 0===(2&Q.wrap)?k:(Q.head=X,X.done=!1,R)},q.exports.inflateSetDictionary=(q,X)=>{const Q=X.length;let x,u,H;return q&&q.state?(x=q.state,0!==x.wrap&&11!==x.mode?k:11===x.mode&&(u=1,u=y(u,X,Q,0),u!==x.check)?j:(H=F(q,X,Q,Q),H?(x.mode=31,I):(x.havedict=1,R))):k},q.exports.inflateInfo="pako inflate (from Nodeca project)"},11222:q=>{"use strict";const X=15,Q=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),y=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),x=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),u=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);q.exports=(q,H,b,D,a,R,L,f)=>{const k=f.bits;let j,I,d,e,i,A,B=0,w=0,V=0,W=0,v=0,Z=0,U=0,O=0,g=0,P=0,F=null,l=0;const m=new Uint16Array(16),M=new Uint16Array(16);let o,Y,N,S=null,c=0;for(B=0;B<=X;B++)m[B]=0;for(w=0;w<D;w++)m[H[b+w]]++;for(v=k,W=X;W>=1&&0===m[W];W--);if(v>W&&(v=W),0===W)return a[R++]=20971520,a[R++]=20971520,f.bits=1,0;for(V=1;V<W&&0===m[V];V++);for(v<V&&(v=V),O=1,B=1;B<=X;B++)if(O<<=1,O-=m[B],O<0)return-1;if(O>0&&(0===q||1!==W))return-1;for(M[1]=0,B=1;B<X;B++)M[B+1]=M[B]+m[B];for(w=0;w<D;w++)0!==H[b+w]&&(L[M[H[b+w]]++]=w);if(0===q?(F=S=L,A=19):1===q?(F=Q,l-=257,S=y,c-=257,A=256):(F=x,S=u,A=-1),P=0,w=0,B=V,i=R,Z=v,U=0,d=-1,g=1<<v,e=g-1,1===q&&g>852||2===q&&g>592)return 1;for(;;){o=B-U,L[w]<A?(Y=0,N=L[w]):L[w]>A?(Y=S[c+L[w]],N=F[l+L[w]]):(Y=96,N=0),j=1<<B-U,I=1<<Z,V=I;do{I-=j,a[i+(P>>U)+I]=o<<24|Y<<16|N}while(0!==I);for(j=1<<B-1;P&j;)j>>=1;if(0!==j?(P&=j-1,P+=j):P=0,w++,0===--m[B]){if(B===W)break;B=H[b+L[w]]}if(B>v&&(P&e)!==d){for(0===U&&(U=v),i+=V,Z=B-U,O=1<<Z;Z+U<W&&(O-=m[Z+U],!(O<=0));)Z++,O<<=1;if(g+=1<<Z,1===q&&g>852||2===q&&g>592)return 1;d=P&e,a[d]=v<<24|Z<<16|i-R}}return 0!==P&&(a[i+P]=B-U<<24|64<<16),f.bits=v,0}},11181:q=>{"use strict";q.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},11169:q=>{"use strict";function X(q){let X=q.length;for(;--X>=0;)q[X]=0}const Q=256,y=286,x=30,u=15,H=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),b=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),D=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),a=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),R=new Array(576);X(R);const L=new Array(60);X(L);const f=new Array(512);X(f);const k=new Array(256);X(k);const j=new Array(29);X(j);const I=new Array(x);function d(q,X,Q,y,x){this.static_tree=q,this.extra_bits=X,this.extra_base=Q,this.elems=y,this.max_length=x,this.has_stree=q&&q.length}let e,i,A;function B(q,X){this.dyn_tree=q,this.max_code=0,this.stat_desc=X}X(I);const w=q=>q<256?f[q]:f[256+(q>>>7)],V=(q,X)=>{q.pending_buf[q.pending++]=255&X,q.pending_buf[q.pending++]=X>>>8&255},W=(q,X,Q)=>{q.bi_valid>16-Q?(q.bi_buf|=X<<q.bi_valid&65535,V(q,q.bi_buf),q.bi_buf=X>>16-q.bi_valid,q.bi_valid+=Q-16):(q.bi_buf|=X<<q.bi_valid&65535,q.bi_valid+=Q)},v=(q,X,Q)=>{W(q,Q[2*X],Q[2*X+1])},Z=(q,X)=>{let Q=0;do{Q|=1&q,q>>>=1,Q<<=1}while(--X>0);return Q>>>1},U=(q,X,Q)=>{const y=new Array(16);let x,H,b=0;for(x=1;x<=u;x++)y[x]=b=b+Q[x-1]<<1;for(H=0;H<=X;H++){let X=q[2*H+1];0!==X&&(q[2*H]=Z(y[X]++,X))}},O=q=>{let X;for(X=0;X<y;X++)q.dyn_ltree[2*X]=0;for(X=0;X<x;X++)q.dyn_dtree[2*X]=0;for(X=0;X<19;X++)q.bl_tree[2*X]=0;q.dyn_ltree[512]=1,q.opt_len=q.static_len=0,q.last_lit=q.matches=0},g=q=>{q.bi_valid>8?V(q,q.bi_buf):q.bi_valid>0&&(q.pending_buf[q.pending++]=q.bi_buf),q.bi_buf=0,q.bi_valid=0},P=(q,X,Q,y)=>{const x=2*X,u=2*Q;return q[x]<q[u]||q[x]===q[u]&&y[X]<=y[Q]},F=(q,X,Q)=>{const y=q.heap[Q];let x=Q<<1;for(;x<=q.heap_len&&(x<q.heap_len&&P(X,q.heap[x+1],q.heap[x],q.depth)&&x++,!P(X,y,q.heap[x],q.depth));)q.heap[Q]=q.heap[x],Q=x,x<<=1;q.heap[Q]=y},l=(q,X,y)=>{let x,u,D,a,R=0;if(0!==q.last_lit)do{x=q.pending_buf[q.d_buf+2*R]<<8|q.pending_buf[q.d_buf+2*R+1],u=q.pending_buf[q.l_buf+R],R++,0===x?v(q,u,X):(D=k[u],v(q,D+Q+1,X),a=H[D],0!==a&&(u-=j[D],W(q,u,a)),x--,D=w(x),v(q,D,y),a=b[D],0!==a&&(x-=I[D],W(q,x,a)))}while(R<q.last_lit);v(q,256,X)},m=(q,X)=>{const Q=X.dyn_tree,y=X.stat_desc.static_tree,x=X.stat_desc.has_stree,H=X.stat_desc.elems;let b,D,a,R=-1;for(q.heap_len=0,q.heap_max=573,b=0;b<H;b++)0!==Q[2*b]?(q.heap[++q.heap_len]=R=b,q.depth[b]=0):Q[2*b+1]=0;for(;q.heap_len<2;)a=q.heap[++q.heap_len]=R<2?++R:0,Q[2*a]=1,q.depth[a]=0,q.opt_len--,x&&(q.static_len-=y[2*a+1]);for(X.max_code=R,b=q.heap_len>>1;b>=1;b--)F(q,Q,b);a=H;do{b=q.heap[1],q.heap[1]=q.heap[q.heap_len--],F(q,Q,1),D=q.heap[1],q.heap[--q.heap_max]=b,q.heap[--q.heap_max]=D,Q[2*a]=Q[2*b]+Q[2*D],q.depth[a]=(q.depth[b]>=q.depth[D]?q.depth[b]:q.depth[D])+1,Q[2*b+1]=Q[2*D+1]=a,q.heap[1]=a++,F(q,Q,1)}while(q.heap_len>=2);q.heap[--q.heap_max]=q.heap[1],((q,X)=>{const Q=X.dyn_tree,y=X.max_code,x=X.stat_desc.static_tree,H=X.stat_desc.has_stree,b=X.stat_desc.extra_bits,D=X.stat_desc.extra_base,a=X.stat_desc.max_length;let R,L,f,k,j,I,d=0;for(k=0;k<=u;k++)q.bl_count[k]=0;for(Q[2*q.heap[q.heap_max]+1]=0,R=q.heap_max+1;R<573;R++)L=q.heap[R],k=Q[2*Q[2*L+1]+1]+1,k>a&&(k=a,d++),Q[2*L+1]=k,L>y||(q.bl_count[k]++,j=0,L>=D&&(j=b[L-D]),I=Q[2*L],q.opt_len+=I*(k+j),H&&(q.static_len+=I*(x[2*L+1]+j)));if(0!==d){do{for(k=a-1;0===q.bl_count[k];)k--;q.bl_count[k]--,q.bl_count[k+1]+=2,q.bl_count[a]--,d-=2}while(d>0);for(k=a;0!==k;k--)for(L=q.bl_count[k];0!==L;)f=q.heap[--R],f>y||(Q[2*f+1]!==k&&(q.opt_len+=(k-Q[2*f+1])*Q[2*f],Q[2*f+1]=k),L--)}})(q,X),U(Q,R,q.bl_count)},M=(q,X,Q)=>{let y,x,u=-1,H=X[1],b=0,D=7,a=4;for(0===H&&(D=138,a=3),X[2*(Q+1)+1]=65535,y=0;y<=Q;y++)x=H,H=X[2*(y+1)+1],++b<D&&x===H||(b<a?q.bl_tree[2*x]+=b:0!==x?(x!==u&&q.bl_tree[2*x]++,q.bl_tree[32]++):b<=10?q.bl_tree[34]++:q.bl_tree[36]++,b=0,u=x,0===H?(D=138,a=3):x===H?(D=6,a=3):(D=7,a=4))},o=(q,X,Q)=>{let y,x,u=-1,H=X[1],b=0,D=7,a=4;for(0===H&&(D=138,a=3),y=0;y<=Q;y++)if(x=H,H=X[2*(y+1)+1],!(++b<D&&x===H)){if(b<a)do{v(q,x,q.bl_tree)}while(0!==--b);else 0!==x?(x!==u&&(v(q,x,q.bl_tree),b--),v(q,16,q.bl_tree),W(q,b-3,2)):b<=10?(v(q,17,q.bl_tree),W(q,b-3,3)):(v(q,18,q.bl_tree),W(q,b-11,7));b=0,u=x,0===H?(D=138,a=3):x===H?(D=6,a=3):(D=7,a=4)}};let Y=!1;const N=(q,X,Q,y)=>{W(q,0+(y?1:0),3),((q,X,Q,y)=>{g(q),y&&(V(q,Q),V(q,~Q)),q.pending_buf.set(q.window.subarray(X,X+Q),q.pending),q.pending+=Q})(q,X,Q,!0)};q.exports._tr_init=q=>{Y||((()=>{let q,X,Q,a,B;const w=new Array(16);for(Q=0,a=0;a<28;a++)for(j[a]=Q,q=0;q<1<<H[a];q++)k[Q++]=a;for(k[Q-1]=a,B=0,a=0;a<16;a++)for(I[a]=B,q=0;q<1<<b[a];q++)f[B++]=a;for(B>>=7;a<x;a++)for(I[a]=B<<7,q=0;q<1<<b[a]-7;q++)f[256+B++]=a;for(X=0;X<=u;X++)w[X]=0;for(q=0;q<=143;)R[2*q+1]=8,q++,w[8]++;for(;q<=255;)R[2*q+1]=9,q++,w[9]++;for(;q<=279;)R[2*q+1]=7,q++,w[7]++;for(;q<=287;)R[2*q+1]=8,q++,w[8]++;for(U(R,287,w),q=0;q<x;q++)L[2*q+1]=5,L[2*q]=Z(q,5);e=new d(R,H,257,y,u),i=new d(L,b,0,x,u),A=new d(new Array(0),D,0,19,7)})(),Y=!0),q.l_desc=new B(q.dyn_ltree,e),q.d_desc=new B(q.dyn_dtree,i),q.bl_desc=new B(q.bl_tree,A),q.bi_buf=0,q.bi_valid=0,O(q)},q.exports._tr_stored_block=N,q.exports._tr_flush_block=(q,X,y,x)=>{let u,H,b=0;q.level>0?(2===q.strm.data_type&&(q.strm.data_type=(q=>{let X,y=4093624447;for(X=0;X<=31;X++,y>>>=1)if(1&y&&0!==q.dyn_ltree[2*X])return 0;if(0!==q.dyn_ltree[18]||0!==q.dyn_ltree[20]||0!==q.dyn_ltree[26])return 1;for(X=32;X<Q;X++)if(0!==q.dyn_ltree[2*X])return 1;return 0})(q)),m(q,q.l_desc),m(q,q.d_desc),b=(q=>{let X;for(M(q,q.dyn_ltree,q.l_desc.max_code),M(q,q.dyn_dtree,q.d_desc.max_code),m(q,q.bl_desc),X=18;X>=3&&0===q.bl_tree[2*a[X]+1];X--);return q.opt_len+=3*(X+1)+5+5+4,X})(q),u=q.opt_len+3+7>>>3,H=q.static_len+3+7>>>3,H<=u&&(u=H)):u=H=y+5,y+4<=u&&-1!==X?N(q,X,y,x):4===q.strategy||H===u?(W(q,2+(x?1:0),3),l(q,R,L)):(W(q,4+(x?1:0),3),((q,X,Q,y)=>{let x;for(W(q,X-257,5),W(q,Q-1,5),W(q,y-4,4),x=0;x<y;x++)W(q,q.bl_tree[2*a[x]+1],3);o(q,q.dyn_ltree,X-1),o(q,q.dyn_dtree,Q-1)})(q,q.l_desc.max_code+1,q.d_desc.max_code+1,b+1),l(q,q.dyn_ltree,q.dyn_dtree)),O(q),x&&g(q)},q.exports._tr_tally=(q,X,y)=>(q.pending_buf[q.d_buf+2*q.last_lit]=X>>>8&255,q.pending_buf[q.d_buf+2*q.last_lit+1]=255&X,q.pending_buf[q.l_buf+q.last_lit]=255&y,q.last_lit++,0===X?q.dyn_ltree[2*y]++:(q.matches++,X--,q.dyn_ltree[2*(k[y]+Q+1)]++,q.dyn_dtree[2*w(X)]++),q.last_lit===q.lit_bufsize-1),q.exports._tr_align=q=>{W(q,2,3),v(q,256,R),(q=>{16===q.bi_valid?(V(q,q.bi_buf),q.bi_buf=0,q.bi_valid=0):q.bi_valid>=8&&(q.pending_buf[q.pending++]=255&q.bi_buf,q.bi_buf>>=8,q.bi_valid-=8)})(q)}},11208:q=>{"use strict";q.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},11575:q=>{function X(q,X,Q){for(var y=q.length,x=-1/0,u=1/0,H=0;H<y;H++){var b=(Q[0][H]-q[H])/X[H],D=(Q[1][H]-q[H])/X[H];if(b>D){var a=b;b=D,D=a}if(D<x||b>u)return 1/0;b>x&&(x=b),D<u&&(u=D)}return x>u?1/0:x}q.exports=function(q,Q,y,x){var u=X(Q,y,x);if(u===1/0)q=null;else{q=q||[];for(var H=0;H<Q.length;H++)q[H]=Q[H]+y[H]*u}return q},q.exports.distance=X},12215:(q,X,Q)=>{"use strict";Q.d(X,{b:()=>u});var y=Q(32),x=Q(2443),u=function(q){var X=(0,x.e)(q);(0,y.useEffect)((function(){var q=function(q){var Q;if(null!=X.current&&(Q=X.current(q)),q.defaultPrevented&&(q.returnValue=""),"string"===typeof Q)return q.returnValue=Q,Q};return window.addEventListener("beforeunload",q),function(){window.removeEventListener("beforeunload",q)}}),[])}},12173:(q,X,Q)=>{"use strict";var y=Q(12181),x=Array.prototype.concat,u=Array.prototype.slice,H=q.exports=function(q){for(var X=[],Q=0,H=q.length;Q<H;Q++){var b=q[Q];y(b)?X=x.call(X,u.call(b)):X.push(b)}return X};H.wrap=function(q){return function(){return q(H(arguments))}}},12181:q=>{q.exports=function(q){return!(!q||"string"===typeof q)&&(q instanceof Array||Array.isArray(q)||q.length>=0&&(q.splice instanceof Function||Object.getOwnPropertyDescriptor(q,q.length-1)&&"String"!==q.constructor.name))}},11123:(q,X,Q)=>{var y=Q(11130);function x(q){for(var X,Q,x=0,u=q.length,H=0;H<q.length;){for(X=q[H],Q=0;H<u&&q[H]===X;)++H,++Q;x+=y.log2(Q)/7|0,x+=y.log2(X>>>0)/7|0,x+=2}return x}X.size=x,X.encode=function(q,X){X||(X=new Uint8Array(x(q)));for(var Q,y,u=0,H=X.length,b=0;b<q.length;){for(Q=q[b],y=0;b<q.length&&q[b]===Q;)++b,++y;for(;u<H&&y>=128;)X[u++]=128+(127&y),y>>>=7;if(u>=H)throw new Error("RLE buffer overflow");for(X[u++]=y,Q>>>=0;u<H&&Q>=128;)X[u++]=128+(127&Q),Q>>>=7;if(u>=H)throw new Error("RLE buffer overflow");X[u++]=Q}return X},X.decode=function(q,X){for(var Q,y,x,u,H=X.length,b=q.length,D=0,a=0;a<b;){for(Q=0,y=0;a<b&&q[a]>=128;)Q+=(127&q[a++])<<y,y+=7;if(Q+=q[a++]<<y,a>=b)throw new Error("RLE buffer underrun");if(D+Q>H)throw new Error("Chunk buffer overflow");for(x=0,y=0;a<b&&q[a]>=128;)x+=(127&q[a++])<<y,y+=7;if(a>=b)throw new Error("RLE buffer underrun");for(x+=q[a++]<<y,u=0;u<Q;++u)X[D++]=x}return X}},11130:(q,X)=>{"use strict";function Q(q){var X=32;return(q&=-q)&&X--,65535&q&&(X-=16),16711935&q&&(X-=8),252645135&q&&(X-=4),858993459&q&&(X-=2),1431655765&q&&(X-=1),X}X.INT_BITS=32,X.INT_MAX=2147483647,X.INT_MIN=-1<<31,X.sign=function(q){return(q>0)-(q<0)},X.abs=function(q){var X=q>>31;return(q^X)-X},X.min=function(q,X){return X^(q^X)&-(q<X)},X.max=function(q,X){return q^(q^X)&-(q<X)},X.isPow2=function(q){return!(q&q-1)&&!!q},X.log2=function(q){var X,Q;return X=(q>65535)<<4,X|=Q=((q>>>=X)>255)<<3,X|=Q=((q>>>=Q)>15)<<2,(X|=Q=((q>>>=Q)>3)<<1)|(q>>>=Q)>>1},X.log10=function(q){return q>=1e9?9:q>=1e8?8:q>=1e7?7:q>=1e6?6:q>=1e5?5:q>=1e4?4:q>=1e3?3:q>=100?2:q>=10?1:0},X.popCount=function(q){return 16843009*((q=(858993459&(q-=q>>>1&1431655765))+(q>>>2&858993459))+(q>>>4)&252645135)>>>24},X.countTrailingZeros=Q,X.nextPow2=function(q){return q+=0===q,--q,q|=q>>>1,q|=q>>>2,q|=q>>>4,q|=q>>>8,(q|=q>>>16)+1},X.prevPow2=function(q){return q|=q>>>1,q|=q>>>2,q|=q>>>4,q|=q>>>8,(q|=q>>>16)-(q>>>1)},X.parity=function(q){return q^=q>>>16,q^=q>>>8,q^=q>>>4,27030>>>(q&=15)&1};var y=new Array(256);!function(q){for(var X=0;X<256;++X){var Q=X,y=X,x=7;for(Q>>>=1;Q;Q>>>=1)y<<=1,y|=1&Q,--x;q[X]=y<<x&255}}(y),X.reverse=function(q){return y[255&q]<<24|y[q>>>8&255]<<16|y[q>>>16&255]<<8|y[q>>>24&255]},X.interleave2=function(q,X){return(q=1431655765&((q=858993459&((q=252645135&((q=16711935&((q&=65535)|q<<8))|q<<4))|q<<2))|q<<1))|(X=1431655765&((X=858993459&((X=252645135&((X=16711935&((X&=65535)|X<<8))|X<<4))|X<<2))|X<<1))<<1},X.deinterleave2=function(q,X){return(q=65535&((q=16711935&((q=252645135&((q=858993459&((q=q>>>X&1431655765)|q>>>1))|q>>>2))|q>>>4))|q>>>16))<<16>>16},X.interleave3=function(q,X,Q){return q=1227133513&((q=3272356035&((q=251719695&((q=4278190335&((q&=1023)|q<<16))|q<<8))|q<<4))|q<<2),(q|=(X=1227133513&((X=3272356035&((X=251719695&((X=4278190335&((X&=1023)|X<<16))|X<<8))|X<<4))|X<<2))<<1)|(Q=1227133513&((Q=3272356035&((Q=251719695&((Q=4278190335&((Q&=1023)|Q<<16))|Q<<8))|Q<<4))|Q<<2))<<2},X.deinterleave3=function(q,X){return(q=1023&((q=4278190335&((q=251719695&((q=3272356035&((q=q>>>X&1227133513)|q>>>2))|q>>>4))|q>>>8))|q>>>16))<<22>>22},X.nextCombination=function(q){var X=q|q-1;return X+1|(~X&-~X)-1>>>Q(q)+1}},11151:q=>{"use strict";q.exports=function(q,X,Q,y){var x=self||window;try{try{var u;try{u=new x.Blob([q])}catch(a){(u=new(x.BlobBuilder||x.WebKitBlobBuilder||x.MozBlobBuilder||x.MSBlobBuilder)).append(q),u=u.getBlob()}var H=x.URL||x.webkitURL,b=H.createObjectURL(u),D=new x[X](b,Q);return H.revokeObjectURL(b),D}catch(a){return new x[X]("data:application/javascript,".concat(encodeURIComponent(q)),Q)}}catch(a){if(!y)throw Error("Inline worker is not supported");return new x[X](y,Q)}}},11556:(q,X,Q)=>{"use strict";function y(q,X,Q,y,x){var u={};return Object.keys(y).forEach((function(q){u[q]=y[q]})),u.enumerable=!!u.enumerable,u.configurable=!!u.configurable,("value"in u||u.initializer)&&(u.writable=!0),u=Q.slice().reverse().reduce((function(Q,y){return y(q,X,Q)||Q}),u),x&&void 0!==u.initializer&&(u.value=u.initializer?u.initializer.call(x):void 0,u.initializer=void 0),void 0===u.initializer&&(Object.defineProperty(q,X,u),u=null),u}Q.d(X,{d:()=>y})},11550:(q,X,Q)=>{"use strict";function y(q,X,Q,y){Q&&Object.defineProperty(q,X,{enumerable:Q.enumerable,configurable:Q.configurable,writable:Q.writable,value:Q.initializer?Q.initializer.call(y):void 0})}Q.d(X,{d:()=>y})},11882:(q,X,Q)=>{"use strict";Q.d(X,{e:()=>A,g:()=>d,h:()=>e,i:()=>f,k:()=>I,n:()=>j,r:()=>k});var y=Q(1002),x=Q(1182),u=Q(1032),H=Q(1015),b=Q(11887),D=Q(11270),a=Q(1166),R=Q(1059),L=Q(1173);const f=Object.freeze(new y.d(0,0,0,0)),k=Object.freeze(y.n.Zero()),j=Object.freeze(y.k.Zero()),I=Object.freeze(a.d.Zero()),d=Object.freeze(x.b.Black()),e=Object.freeze(new x.c(0,0,0,0)),i={key:0,repeatCount:0,loopMode:2};class A{static _PrepareAnimation(q,X,Q,u,H,b,D,R){let L;if(!isNaN(parseFloat(H))&&isFinite(H)?L=A.ANIMATIONTYPE_FLOAT:H instanceof y.d?L=A.ANIMATIONTYPE_QUATERNION:H instanceof y.n?L=A.ANIMATIONTYPE_VECTOR3:H instanceof y.k?L=A.ANIMATIONTYPE_VECTOR2:H instanceof x.b?L=A.ANIMATIONTYPE_COLOR3:H instanceof x.c?L=A.ANIMATIONTYPE_COLOR4:H instanceof a.d&&(L=A.ANIMATIONTYPE_SIZE),void 0==L)return null;const f=new A(q,X,Q,L,D),k=[{frame:0,value:H},{frame:u,value:b}];return f.setKeys(k),void 0!==R&&f.setEasingFunction(R),f}static CreateAnimation(q,X,Q,y){const x=new A(q+"Animation",q,Q,X,A.ANIMATIONLOOPMODE_CONSTANT);return x.setEasingFunction(y),x}static CreateAndStartAnimation(q,X,Q,y,x,u,H,b,D,a,R){const L=A._PrepareAnimation(q,Q,y,x,u,H,b,D);return L?(X.va&&(R=X.va()),R?R.beginDirectAnimation(X,[L],0,x,1===L.loopMode,1,a):null):null}static CreateAndStartHierarchyAnimation(q,X,Q,y,x,u,H,b,D,a,R){const L=A._PrepareAnimation(q,y,x,u,H,b,D,a);if(!L)return null;return X.va().beginDirectHierarchyAnimation(X,Q,[L],0,u,1===L.loopMode,1,R)}static CreateMergeAndStartAnimation(q,X,Q,y,x,u,H,b,D,a){const R=A._PrepareAnimation(q,Q,y,x,u,H,b,D);return R?(X.animations.push(R),X.va().beginAnimation(X,0,x,1===R.loopMode,1,a)):null}static MakeAnimationAdditive(q,X,Q){let x;x="object"===typeof X?X:{referenceFrame:X??0,range:Q,cloneOriginalAnimation:arguments.length>3&&void 0!==arguments[3]&&arguments[3],clonedAnimationName:arguments.length>4?arguments[4]:void 0};let u=q;if(x.cloneOriginalAnimation&&(u=q.clone(),u.name=x.clonedAnimationName||u.name),!u._keys.length)return u;const H=x.referenceFrame&&x.referenceFrame>=0?x.referenceFrame:0;let b=0;const D=u._keys[0];let a=u._keys.length-1;const R=u._keys[a],L={referenceValue:D.value,referencePosition:y.h.Od[0],referenceQuaternion:y.h.Quaternion[0],referenceScaling:y.h.Od[1],keyPosition:y.h.Od[2],keyQuaternion:y.h.Quaternion[1],keyScaling:y.h.Od[3]};let f=D.frame,k=R.frame;if(x.range){const q=u.getRange(x.range);q&&(f=q.from,k=q.to)}else f=x.fromFrame??f,k=x.toFrame??k;if(f!==D.frame&&(b=u.createKeyForFrame(f)),k!==R.frame&&(a=u.createKeyForFrame(k)),1===u._keys.length){const q=u._getKeyValue(u._keys[0]);L.referenceValue=q.clone?q.clone():q}else if(H<=D.frame){const q=u._getKeyValue(D.value);L.referenceValue=q.clone?q.clone():q}else if(H>=R.frame){const q=u._getKeyValue(R.value);L.referenceValue=q.clone?q.clone():q}else{i.key=0;const q=u._interpolate(H,i);L.referenceValue=q.clone?q.clone():q}u.dataType===A.ANIMATIONTYPE_QUATERNION?L.referenceValue.normalize().conjugateInPlace():u.dataType===A.ANIMATIONTYPE_MATRIX&&(L.referenceValue.decompose(L.referenceScaling,L.referenceQuaternion,L.referencePosition),L.referenceQuaternion.normalize().conjugateInPlace());let j=Number.MAX_VALUE;const I=x.clipKeys?[]:null;for(let d=b;d<=a;d++){let q=u._keys[d];if((I||x.cloneOriginalAnimation)&&(q={frame:q.frame,value:q.value.clone?q.value.clone():q.value,inTangent:q.inTangent,outTangent:q.outTangent,interpolation:q.interpolation,lockedTangent:q.lockedTangent},I&&(j===Number.MAX_VALUE&&(j=q.frame),q.frame-=j,I.push(q))),!d||u.dataType===A.ANIMATIONTYPE_FLOAT||q.value!==D.value)switch(u.dataType){case A.ANIMATIONTYPE_MATRIX:q.value.decompose(L.keyScaling,L.keyQuaternion,L.keyPosition),L.keyPosition.Ud(L.referencePosition),L.keyScaling.divideInPlace(L.referenceScaling),L.referenceQuaternion.multiplyToRef(L.keyQuaternion,L.keyQuaternion),y.b.ComposeToRef(L.keyScaling,L.keyQuaternion,L.keyPosition,q.value);break;case A.ANIMATIONTYPE_QUATERNION:L.referenceValue.multiplyToRef(q.value,q.value);break;case A.ANIMATIONTYPE_VECTOR2:case A.ANIMATIONTYPE_VECTOR3:case A.ANIMATIONTYPE_COLOR3:case A.ANIMATIONTYPE_COLOR4:q.value.subtractToRef(L.referenceValue,q.value);break;case A.ANIMATIONTYPE_SIZE:q.value.width-=L.referenceValue.width,q.value.height-=L.referenceValue.height;break;default:q.value-=L.referenceValue}}return I&&u.setKeys(I,!0),u}static TransitionTo(q,X,Q,y,x,u,H){let b=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;if(H<=0)return Q[q]=X,b&&b(),null;const D=x*(H/1e3);u.setKeys([{frame:0,value:Q[q].clone?Q[q].clone():Q[q]},{frame:D,value:X}]),Q.animations||(Q.animations=[]),Q.animations.push(u);const a=y.beginAnimation(Q,0,D,!1);return a.onAnimationEnd=b,a}get runtimeAnimations(){return this._runtimeAnimations}get hasRunningRuntimeAnimations(){for(const q of this._runtimeAnimations)if(!q.isStopped())return!0;return!1}constructor(q,X,Q,y,x,u){this.name=q,this.targetProperty=X,this.framePerSecond=Q,this.dataType=y,this.loopMode=x,this.enableBlending=u,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=X.split("."),this.dataType=y,this.loopMode=void 0===x?A.ANIMATIONLOOPMODE_CYCLE:x,this.uniqueId=A._UniqueIdGenerator++}toString(q){let X="Name: "+this.name+", property: "+this.targetProperty;if(X+=", datatype: "+["Float","Od","Quaternion","Matrix","Fe","Vector2"][this.dataType],X+=", nKeys: "+(this._keys?this._keys.length:"none"),X+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),q){X+=", Ranges: {";let q=!0;for(const Q in this._ranges)q&&(X+=", ",q=!1),X+=Q;X+="}"}return X}addEvent(q){this._events.push(q),this._events.sort(((q,X)=>q.frame-X.frame))}removeEvents(q){for(let X=0;X<this._events.length;X++)this._events[X].frame===q&&(this._events.splice(X,1),X--)}getEvents(){return this._events}createRange(q,X,Q){this._ranges[q]||(this._ranges[q]=new b.b(q,X,Q))}deleteRange(q){let X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const Q=this._ranges[q];if(Q){if(X){const q=Q.from,X=Q.to;for(let Q=this._keys.length-1;Q>=0;Q--)this._keys[Q].frame>=q&&this._keys[Q].frame<=X&&this._keys.splice(Q,1)}this._ranges[q]=null}}getRange(q){return this._ranges[q]}getKeys(){return this._keys}getHighestFrame(){let q=0;for(let X=0,Q=this._keys.length;X<Q;X++)q<this._keys[X].frame&&(q=this._keys[X].frame);return q}getEasingFunction(){return this._easingFunction}setEasingFunction(q){this._easingFunction=q}floatInterpolateFunction(q,X,Q){return(0,u.n)(q,X,Q)}floatInterpolateFunctionWithTangents(q,X,Q,y,x){return(0,u.h)(q,X,Q,y,x)}quaternionInterpolateFunction(q,X,Q){return y.d.Slerp(q,X,Q)}quaternionInterpolateFunctionWithTangents(q,X,Q,x,u){return y.d.Hermite(q,X,Q,x,u).normalize()}vector3InterpolateFunction(q,X,Q){return y.n.Lerp(q,X,Q)}vector3InterpolateFunctionWithTangents(q,X,Q,x,u){return y.n.Hermite(q,X,Q,x,u)}vector2InterpolateFunction(q,X,Q){return y.k.Lerp(q,X,Q)}vector2InterpolateFunctionWithTangents(q,X,Q,x,u){return y.k.Hermite(q,X,Q,x,u)}sizeInterpolateFunction(q,X,Q){return a.d.Lerp(q,X,Q)}color3InterpolateFunction(q,X,Q){return x.b.Lerp(q,X,Q)}color3InterpolateFunctionWithTangents(q,X,Q,y,u){return x.b.Hermite(q,X,Q,y,u)}color4InterpolateFunction(q,X,Q){return x.c.Lerp(q,X,Q)}color4InterpolateFunctionWithTangents(q,X,Q,y,u){return x.c.Hermite(q,X,Q,y,u)}_getKeyValue(q){return"function"===typeof q?q():q}evaluate(q){return i.key=0,this._interpolate(q,i)}_interpolate(q,X){let Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(X.loopMode===A.ANIMATIONLOOPMODE_CONSTANT&&X.repeatCount>0)return X.highLimitValue.clone?X.highLimitValue.clone():X.highLimitValue;const y=this._keys,x=y.length;let u=X.key;for(;u>=0&&q<y[u].frame;)--u;for(;u+1<=x-1&&q>=y[u+1].frame;)++u;if(X.key=u,u<0)return Q?void 0:this._getKeyValue(y[0].value);if(u+1>x-1)return Q?void 0:this._getKeyValue(y[x-1].value);const H=y[u],b=y[u+1];if(Q&&(q===H.frame||q===b.frame))return;const D=this._getKeyValue(H.value),a=this._getKeyValue(b.value);if(1===H.interpolation)return b.frame>q?D:a;const R=void 0!==H.outTangent&&void 0!==b.inTangent,L=b.frame-H.frame;let i=(q-H.frame)/L;const B=H.easingFunction||this.getEasingFunction();switch(null!==B&&(i=B.ease(i)),this.dataType){case A.ANIMATIONTYPE_FLOAT:{const q=R?this.floatInterpolateFunctionWithTangents(D,H.outTangent*L,a,b.inTangent*L,i):this.floatInterpolateFunction(D,a,i);switch(X.loopMode){case A.ANIMATIONLOOPMODE_CYCLE:case A.ANIMATIONLOOPMODE_CONSTANT:case A.ANIMATIONLOOPMODE_YOYO:return q;case A.ANIMATIONLOOPMODE_RELATIVE:case A.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return(X.offsetValue??0)*X.repeatCount+q}break}case A.ANIMATIONTYPE_QUATERNION:{const q=R?this.quaternionInterpolateFunctionWithTangents(D,H.outTangent.scale(L),a,b.inTangent.scale(L),i):this.quaternionInterpolateFunction(D,a,i);switch(X.loopMode){case A.ANIMATIONLOOPMODE_CYCLE:case A.ANIMATIONLOOPMODE_CONSTANT:case A.ANIMATIONLOOPMODE_YOYO:return q;case A.ANIMATIONLOOPMODE_RELATIVE:case A.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return q.addInPlace((X.offsetValue||f).scale(X.repeatCount))}return q}case A.ANIMATIONTYPE_VECTOR3:{const q=R?this.vector3InterpolateFunctionWithTangents(D,H.outTangent.scale(L),a,b.inTangent.scale(L),i):this.vector3InterpolateFunction(D,a,i);switch(X.loopMode){case A.ANIMATIONLOOPMODE_CYCLE:case A.ANIMATIONLOOPMODE_CONSTANT:case A.ANIMATIONLOOPMODE_YOYO:return q;case A.ANIMATIONLOOPMODE_RELATIVE:case A.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return q.add((X.offsetValue||k).scale(X.repeatCount))}break}case A.ANIMATIONTYPE_VECTOR2:{const q=R?this.vector2InterpolateFunctionWithTangents(D,H.outTangent.scale(L),a,b.inTangent.scale(L),i):this.vector2InterpolateFunction(D,a,i);switch(X.loopMode){case A.ANIMATIONLOOPMODE_CYCLE:case A.ANIMATIONLOOPMODE_CONSTANT:case A.ANIMATIONLOOPMODE_YOYO:return q;case A.ANIMATIONLOOPMODE_RELATIVE:case A.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return q.add((X.offsetValue||j).scale(X.repeatCount))}break}case A.ANIMATIONTYPE_SIZE:switch(X.loopMode){case A.ANIMATIONLOOPMODE_CYCLE:case A.ANIMATIONLOOPMODE_CONSTANT:case A.ANIMATIONLOOPMODE_YOYO:return this.sizeInterpolateFunction(D,a,i);case A.ANIMATIONLOOPMODE_RELATIVE:case A.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return this.sizeInterpolateFunction(D,a,i).add((X.offsetValue||I).scale(X.repeatCount))}break;case A.ANIMATIONTYPE_COLOR3:{const q=R?this.color3InterpolateFunctionWithTangents(D,H.outTangent.scale(L),a,b.inTangent.scale(L),i):this.color3InterpolateFunction(D,a,i);switch(X.loopMode){case A.ANIMATIONLOOPMODE_CYCLE:case A.ANIMATIONLOOPMODE_CONSTANT:case A.ANIMATIONLOOPMODE_YOYO:return q;case A.ANIMATIONLOOPMODE_RELATIVE:case A.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return q.add((X.offsetValue||d).scale(X.repeatCount))}break}case A.ANIMATIONTYPE_COLOR4:{const q=R?this.color4InterpolateFunctionWithTangents(D,H.outTangent.scale(L),a,b.inTangent.scale(L),i):this.color4InterpolateFunction(D,a,i);switch(X.loopMode){case A.ANIMATIONLOOPMODE_CYCLE:case A.ANIMATIONLOOPMODE_CONSTANT:case A.ANIMATIONLOOPMODE_YOYO:return q;case A.ANIMATIONLOOPMODE_RELATIVE:case A.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return q.add((X.offsetValue||e).scale(X.repeatCount))}break}case A.ANIMATIONTYPE_MATRIX:switch(X.loopMode){case A.ANIMATIONLOOPMODE_CYCLE:case A.ANIMATIONLOOPMODE_CONSTANT:case A.ANIMATIONLOOPMODE_YOYO:return A.AllowMatricesInterpolation?this.matrixInterpolateFunction(D,a,i,X.workValue):D;case A.ANIMATIONLOOPMODE_RELATIVE:case A.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return D}}return 0}matrixInterpolateFunction(q,X,Q,x){return A.AllowMatrixDecomposeForInterpolation?x?(y.b.DecomposeLerpToRef(q,X,Q,x),x):y.b.DecomposeLerp(q,X,Q):x?(y.b.LerpToRef(q,X,Q,x),x):y.b.Lerp(q,X,Q)}clone(){const q=new A(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(q.enableBlending=this.enableBlending,q.blendingSpeed=this.blendingSpeed,this._keys&&q.setKeys(this._keys),this._ranges){q._ranges={};for(const X in this._ranges){const Q=this._ranges[X];Q&&(q._ranges[X]=Q.clone())}}return q}setKeys(q){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._keys=X?q:q.slice(0)}createKeyForFrame(q){i.key=0;const X=this._interpolate(q,i,!0);if(!X)return this._keys[i.key].frame===q?i.key:i.key+1;const Q={frame:q,value:X.clone?X.clone():X};return this._keys.splice(i.key+1,0,Q),i.key+1}serialize(){const q={};q.name=this.name,q.property=this.targetProperty,q.framePerSecond=this.framePerSecond,q.dataType=this.dataType,q.loopBehavior=this.loopMode,q.enableBlending=this.enableBlending,q.blendingSpeed=this.blendingSpeed;const X=this.dataType;q.keys=[];const Q=this.getKeys();for(let y=0;y<Q.length;y++){const x=Q[y],u={};switch(u.frame=x.frame,X){case A.ANIMATIONTYPE_FLOAT:u.values=[x.value],void 0!==x.inTangent&&u.values.push(x.inTangent),void 0!==x.outTangent&&(void 0===x.inTangent&&u.values.push(void 0),u.values.push(x.outTangent)),void 0!==x.interpolation&&(void 0===x.inTangent&&u.values.push(void 0),void 0===x.outTangent&&u.values.push(void 0),u.values.push(x.interpolation));break;case A.ANIMATIONTYPE_QUATERNION:case A.ANIMATIONTYPE_MATRIX:case A.ANIMATIONTYPE_VECTOR3:case A.ANIMATIONTYPE_COLOR3:case A.ANIMATIONTYPE_COLOR4:u.values=x.value.ee(),void 0!=x.inTangent&&u.values.push(x.inTangent.ee()),void 0!=x.outTangent&&(void 0===x.inTangent&&u.values.push(void 0),u.values.push(x.outTangent.ee())),void 0!==x.interpolation&&(void 0===x.inTangent&&u.values.push(void 0),void 0===x.outTangent&&u.values.push(void 0),u.values.push(x.interpolation))}q.keys.push(u)}q.ranges=[];for(const y in this._ranges){const X=this._ranges[y];if(!X)continue;const Q={};Q.name=y,Q.from=X.from,Q.to=X.to,q.ranges.push(Q)}return q}static _UniversalLerp(q,X,Q){const y=q.constructor;return y.Lerp?y.Lerp(q,X,Q):y.Slerp?y.Slerp(q,X,Q):q.toFixed?q*(1-Q)+Q*X:X}static Parse(q){const X=new A(q.name,q.property,q.framePerSecond,q.dataType,q.loopBehavior),Q=q.dataType,u=[];let H,b;for(q.enableBlending&&(X.enableBlending=q.enableBlending),q.blendingSpeed&&(X.blendingSpeed=q.blendingSpeed),b=0;b<q.keys.length;b++){const X=q.keys[b];let D,a,R;switch(Q){case A.ANIMATIONTYPE_FLOAT:H=X.values[0],X.values.length>=2&&(D=X.values[1]),X.values.length>=3&&(a=X.values[2]),X.values.length>=4&&(R=X.values[3]);break;case A.ANIMATIONTYPE_QUATERNION:if(H=y.d.Rd(X.values),X.values.length>=8){const q=y.d.Rd(X.values.slice(4,8));q.equals(y.d.Zero())||(D=q)}if(X.values.length>=12){const q=y.d.Rd(X.values.slice(8,12));q.equals(y.d.Zero())||(a=q)}X.values.length>=13&&(R=X.values[12]);break;case A.ANIMATIONTYPE_MATRIX:H=y.b.Rd(X.values),X.values.length>=17&&(R=X.values[16]);break;case A.ANIMATIONTYPE_COLOR3:H=x.b.Rd(X.values),X.values[3]&&(D=x.b.Rd(X.values[3])),X.values[4]&&(a=x.b.Rd(X.values[4])),X.values[5]&&(R=X.values[5]);break;case A.ANIMATIONTYPE_COLOR4:H=x.c.Rd(X.values),X.values[4]&&(D=x.c.Rd(X.values[4])),X.values[5]&&(a=x.c.Rd(X.values[5])),X.values[6]&&(R=x.c.Rd(X.values[6]));break;case A.ANIMATIONTYPE_VECTOR3:default:H=y.n.Rd(X.values),X.values[3]&&(D=y.n.Rd(X.values[3])),X.values[4]&&(a=y.n.Rd(X.values[4])),X.values[5]&&(R=X.values[5])}const L={};L.frame=X.frame,L.value=H,void 0!=D&&(L.inTangent=D),void 0!=a&&(L.outTangent=a),void 0!=R&&(L.interpolation=R),u.push(L)}if(X.setKeys(u),q.ranges)for(b=0;b<q.ranges.length;b++)H=q.ranges[b],X.createRange(H.name,H.from,H.to);return X}static AppendSerializedAnimations(q,X){L.c.AppendSerializedAnimations(q,X)}static ParseFromFileAsync(q,X){return new Promise(((Q,y)=>{const x=new R.c;x.addEventListener("readystatechange",(()=>{if(4==x.readyState)if(200==x.status){let X=JSON.parse(x.responseText);if(X.animations&&(X=X.animations),X.length){const q=[];for(const Q of X)q.push(this.Parse(Q));Q(q)}else{const y=this.Parse(X);q&&(y.name=q),Q(y)}}else y("Unable to load the animation")})),x.open("GET",X),x.send()}))}static ParseFromSnippetAsync(q){return new Promise(((X,Q)=>{const y=new R.c;y.addEventListener("readystatechange",(()=>{if(4==y.readyState)if(200==y.status){const Q=JSON.parse(JSON.parse(y.responseText).jsonPayload);if(Q.animations){const y=JSON.parse(Q.animations),x=[];for(const X of y.animations){const Q=this.Parse(X);Q.snippetId=q,x.push(Q)}X(x)}else{const y=JSON.parse(Q.animation),x=this.Parse(y);x.snippetId=q,X(x)}}else Q("Unable to load the snippet "+q)})),y.open("GET",this.SnippetUrl+"/"+q.replace(/#/g,"/")),y.send()}))}}A._UniqueIdGenerator=0,A.AllowMatricesInterpolation=!1,A.AllowMatrixDecomposeForInterpolation=!0,A.SnippetUrl="https://snippet.babylonjs.com",A.ANIMATIONTYPE_FLOAT=0,A.ANIMATIONTYPE_VECTOR3=1,A.ANIMATIONTYPE_QUATERNION=2,A.ANIMATIONTYPE_MATRIX=3,A.ANIMATIONTYPE_COLOR3=4,A.ANIMATIONTYPE_COLOR4=7,A.ANIMATIONTYPE_VECTOR2=5,A.ANIMATIONTYPE_SIZE=6,A.ANIMATIONLOOPMODE_RELATIVE=0,A.ANIMATIONLOOPMODE_CYCLE=1,A.ANIMATIONLOOPMODE_CONSTANT=2,A.ANIMATIONLOOPMODE_YOYO=4,A.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT=5,A.CreateFromSnippetAsync=A.ParseFromSnippetAsync,(0,H.h)("BABYLON.Animation",A),D.d._AnimationRangeFactory=(q,X,Q)=>new b.b(q,X,Q)},11887:(q,X,Q)=>{"use strict";Q.d(X,{b:()=>y});class y{constructor(q,X,Q){this.name=q,this.from=X,this.to=Q}clone(){return new y(this.name,this.from,this.to)}}},11877:(q,X,Q)=>{"use strict";Q.d(X,{e:()=>H});var y=Q(1002),x=Q(1012),u=Q(11270);class H extends u.d{get _matrix(){return this._compose(),this.Kj}set _matrix(q){(q.updateFlag!==this.Kj.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.Kj.p(q),this._markAsDirtyAndDecompose())}constructor(q,X){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,H=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,b=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(q,X.va(),!1),this.name=q,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=X,this.Kj=(null===x||void 0===x?void 0:x.clone())??y.b.Identity(),this._restMatrix=u??this.Kj.clone(),this._bindMatrix=H??this.Kj.clone(),this._index=b,this._absoluteMatrix=new y.b,this._absoluteBindMatrix=new y.b,this._absoluteInverseBindMatrix=new y.b,this._finalMatrix=new y.b,X.bones.push(this),this.setParent(Q,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(q){this.setParent(q)}setParent(q){let X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==q){if(this.parent){const q=this.parent.children.indexOf(this);-1!==q&&this.parent.children.splice(q,1)}this._parentNode=q,this.parent&&this.parent.children.push(this),X&&this._updateAbsoluteBindMatrices(),this.te()}}getLocalMatrix(){return this._compose(),this.Kj}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(q){this._restMatrix.p(q)}setRestPose(q){this.setRestMatrix(q)}getBindPose(){return this.getBindMatrix()}setBindMatrix(q){this.Ae(q)}setBindPose(q){this.setBindMatrix(q)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const q=y.h.Od[0],X=y.h.Quaternion[0],Q=y.h.Od[1];this.getRestMatrix().decompose(q,X,Q),this._linkedTransformNode.position.p(Q),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??y.d.Identity(),this._linkedTransformNode.rotationQuaternion.p(X),this._linkedTransformNode.He.p(q)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(q){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=q,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.qg}set position(q){this._decompose(),this.qg.p(q),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(q){this.setRotation(q)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(q){this.setRotationQuaternion(q)}get He(){return this.getScale()}set He(q){this.setScale(q)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=y.n.Zero(),this._localRotation=y.d.Zero(),this.qg=y.n.Zero()),this.Kj.decompose(this._localScaling,this._localRotation,this.qg))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,y.b.ComposeToRef(this._localScaling,this._localRotation,this.qg,this.Kj)):this._needToCompose=!1)}Ae(q){let X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],Q=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.p(q),X&&this._updateAbsoluteBindMatrices(),Q?this._matrix=q:this.te()}_updateAbsoluteBindMatrices(q){let X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(q||(q=this._bindMatrix),this.parent?q.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.p(q),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),X)for(let Q=0;Q<this.children.length;Q++)this.children[Q]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}te(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.te(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.te(),this._needToDecompose=!0}_updatePosition(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Q=arguments.length>2?arguments[2]:void 0,x=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const u=this.getLocalMatrix();if(0==X)x?(u.addAtIndex(12,q.x),u.addAtIndex(13,q.y),u.addAtIndex(14,q.z)):u.setTranslationFromFloats(q.x,q.y,q.z);else{let X=null;Q&&(X=Q.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const b=H._TmpMats[0],D=H._TmpVecs[0];this.parent?Q&&X?(b.p(this.parent.getAbsoluteMatrix()),b.multiplyToRef(X,b)):b.p(this.parent.getAbsoluteMatrix()):y.b.IdentityToRef(b),x&&b.setTranslationFromFloats(0,0,0),b.invert(),y.n.TransformCoordinatesToRef(q,b,D),x?(u.addAtIndex(12,D.x),u.addAtIndex(13,D.y),u.addAtIndex(14,D.z)):u.setTranslationFromFloats(D.x,D.y,D.z)}this._markAsDirtyAndDecompose()}translate(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Q=arguments.length>2?arguments[2]:void 0;this._updatePosition(q,X,Q,!0)}setPosition(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Q=arguments.length>2?arguments[2]:void 0;this._updatePosition(q,X,Q,!1)}setAbsolutePosition(q,X){this.setPosition(q,1,X)}scale(q,X,Q){let x=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const u=this.getLocalMatrix(),b=H._TmpMats[0];y.b.ScalingToRef(q,X,Q,b),b.multiplyToRef(u,u),b.invert();for(const y of this.children){const x=y.getLocalMatrix();x.multiplyToRef(b,x),x.multiplyAtIndex(12,q),x.multiplyAtIndex(13,X),x.multiplyAtIndex(14,Q),y._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),x)for(const y of this.children)y.scale(q,X,Q,x)}setScale(q){this._decompose(),this._localScaling.p(q),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(q){this._decompose(),q.p(this._localScaling)}setYawPitchRoll(q,X,Q){let x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,u=arguments.length>4?arguments[4]:void 0;if(0===x){const b=H._TmpQuat;return y.d.RotationYawPitchRollToRef(q,X,Q,b),void this.setRotationQuaternion(b,x,u)}const b=H._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(b,u))return;const D=H._TmpMats[1];y.b.RotationYawPitchRollToRef(q,X,Q,D),b.multiplyToRef(D,D),this._rotateWithMatrix(D,x,u)}rotate(q,X){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,x=arguments.length>3?arguments[3]:void 0;const u=H._TmpMats[0];u.setTranslationFromFloats(0,0,0),y.b.RotationAxisToRef(q,X,u),this._rotateWithMatrix(u,Q,x)}setAxisAngle(q,X){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,x=arguments.length>3?arguments[3]:void 0;if(0===Q){const u=H._TmpQuat;return y.d.RotationAxisToRef(q,X,u),void this.setRotationQuaternion(u,Q,x)}const u=H._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(u,x))return;const b=H._TmpMats[1];y.b.RotationAxisToRef(q,X,b),u.multiplyToRef(b,b),this._rotateWithMatrix(b,Q,x)}setRotation(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Q=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(q.y,q.x,q.z,X,Q)}setRotationQuaternion(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Q=arguments.length>2?arguments[2]:void 0;if(0===X)return this._decompose(),this._localRotation.p(q),void this._markAsDirtyAndCompose();const x=H._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(x,Q))return;const u=H._TmpMats[1];y.b.FromQuaternionToRef(q,u),x.multiplyToRef(u,u),this._rotateWithMatrix(u,X,Q)}setRotationMatrix(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Q=arguments.length>2?arguments[2]:void 0;if(0===X){const x=H._TmpQuat;return y.d.FromRotationMatrixToRef(q,x),void this.setRotationQuaternion(x,X,Q)}const x=H._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(x,Q))return;const u=H._TmpMats[1];u.p(q),x.multiplyToRef(q,u),this._rotateWithMatrix(u,X,Q)}_rotateWithMatrix(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Q=arguments.length>2?arguments[2]:void 0;const y=this.getLocalMatrix(),x=y.m[12],u=y.m[13],b=y.m[14],D=this.getParent(),a=H._TmpMats[3],R=H._TmpMats[4];D&&1==X?(Q?(a.p(Q.getWorldMatrix()),D.getAbsoluteMatrix().multiplyToRef(a,a)):a.p(D.getAbsoluteMatrix()),R.p(a),R.invert(),y.multiplyToRef(a,y),y.multiplyToRef(q,y),y.multiplyToRef(R,y)):1==X&&Q?(a.p(Q.getWorldMatrix()),R.p(a),R.invert(),y.multiplyToRef(a,y),y.multiplyToRef(q,y),y.multiplyToRef(R,y)):y.multiplyToRef(q,y),y.setTranslationFromFloats(x,u,b),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(q,X){const Q=H._TmpMats[2];return q.p(this.getAbsoluteMatrix()),X?(q.multiplyToRef(X.getWorldMatrix(),q),y.b.ScalingToRef(X.He.x,X.He.y,X.He.z,Q)):y.b.IdentityToRef(Q),q.invert(),!isNaN(q.m[0])&&(Q.multiplyAtIndex(0,this._scalingDeterminant),q.multiplyToRef(Q,q),!0)}cb(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Q=y.n.Zero();return this.getPositionToRef(q,X,Q),Q}getPositionToRef(){let q=arguments.length>1?arguments[1]:void 0,X=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const q=this.getLocalMatrix();X.x=q.m[12],X.y=q.m[13],X.z=q.m[14]}else{let Q=null;q&&(Q=q.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let y=H._TmpMats[0];q&&Q?(y.p(this.getAbsoluteMatrix()),y.multiplyToRef(Q,y)):y=this.getAbsoluteMatrix(),X.x=y.m[12],X.y=y.m[13],X.z=y.m[14]}}getAbsolutePosition(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const X=y.n.Zero();return this.getPositionToRef(1,q,X),X}getAbsolutePositionToRef(q,X){this.getPositionToRef(1,q,X)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.Kj.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.p(this.Kj);const q=this._skeleton.getPoseMatrix();q&&this._absoluteMatrix.multiplyToRef(q,this._absoluteMatrix)}const q=this.children,X=q.length;for(let Q=0;Q<X;Q++)q[Q].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}ef(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Q=y.n.Zero();return this.getDirectionToRef(q,X,Q),Q}getDirectionToRef(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Q=arguments.length>2?arguments[2]:void 0,x=null;X&&(x=X.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const u=H._TmpMats[0];u.p(this.getAbsoluteMatrix()),X&&x&&u.multiplyToRef(x,u),y.n.TransformNormalToRef(q,u,Q),Q.normalize()}getRotation(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Q=y.n.Zero();return this.getRotationToRef(q,X,Q),Q}getRotationToRef(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Q=arguments.length>2?arguments[2]:void 0;const y=H._TmpQuat;this.getRotationQuaternionToRef(q,X,y),y.toEulerAnglesToRef(Q)}getRotationQuaternion(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Q=y.d.Identity();return this.getRotationQuaternionToRef(q,X,Q),Q}getRotationQuaternionToRef(){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,X=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),X.p(this._localRotation);else{const Q=H._TmpMats[0],y=this.getAbsoluteMatrix();q?y.multiplyToRef(q.getWorldMatrix(),Q):Q.p(y),Q.multiplyAtIndex(0,this._scalingDeterminant),Q.multiplyAtIndex(1,this._scalingDeterminant),Q.multiplyAtIndex(2,this._scalingDeterminant),Q.decompose(void 0,X,void 0)}}getRotationMatrix(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,X=arguments.length>1?arguments[1]:void 0;const Q=y.b.Identity();return this.getRotationMatrixToRef(q,X,Q),Q}getRotationMatrixToRef(){let q=arguments.length>1?arguments[1]:void 0,X=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(X);else{const Q=H._TmpMats[0],y=this.getAbsoluteMatrix();q?y.multiplyToRef(q.getWorldMatrix(),Q):Q.p(y),Q.multiplyAtIndex(0,this._scalingDeterminant),Q.multiplyAtIndex(1,this._scalingDeterminant),Q.multiplyAtIndex(2,this._scalingDeterminant),Q.getRotationMatrixToRef(X)}}getAbsolutePositionFromLocal(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Q=y.n.Zero();return this.getAbsolutePositionFromLocalToRef(q,X,Q),Q}getAbsolutePositionFromLocalToRef(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Q=arguments.length>2?arguments[2]:void 0,x=null;X&&(x=X.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const u=H._TmpMats[0];u.p(this.getAbsoluteMatrix()),X&&x&&u.multiplyToRef(x,u),y.n.TransformCoordinatesToRef(q,u,Q)}getLocalPositionFromAbsolute(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Q=y.n.Zero();return this.getLocalPositionFromAbsoluteToRef(q,X,Q),Q}getLocalPositionFromAbsoluteToRef(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Q=arguments.length>2?arguments[2]:void 0,x=null;X&&(x=X.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const u=H._TmpMats[0];u.p(this.getAbsoluteMatrix()),X&&x&&u.multiplyToRef(x,u),u.invert(),y.n.TransformCoordinatesToRef(q,u,Q)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}}H._TmpVecs=(0,x.d)(2,y.n.Zero),H._TmpQuat=y.d.Identity(),H._TmpMats=(0,x.d)(5,y.b.Identity)},12210:(q,X,Q)=>{"use strict";Q.d(X,{c:()=>l});var y=Q(975),x=Q(984),u=Q(998),H=Q(1002),b=Q(11270),D=Q(11253),a=Q(1288),R=Q(1141),L=Q(1004);class f{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(q){this._zoomStopsAnimation=q}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(q){this._idleRotationSpeed=q}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(q){this._idleRotationWaitTime=q}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(q){this._idleRotationSpinupTime=q}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(q){this._attachedCamera=q;const X=this._attachedCamera.va();this._onPrePointerObservableObserver=X.onPrePointerObservable.add((q=>{q.type!==a.c.POINTERDOWN?q.type===a.c.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=q.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const q=R.e.Now;let X=0;null!=this._lastFrameTime&&(X=q-this._lastFrameTime),this._lastFrameTime=q,this._applyUserInteraction();const Q=q-this._lastInteractionTime-this._idleRotationWaitTime,y=Math.max(Math.min(Q/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*y,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(X/1e3))}))}detach(){if(!this._attachedCamera)return;const q=this._attachedCamera.va();this._onPrePointerObservableObserver&&q.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(q){this._lastInteractionTime=q??R.e.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<L.b}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let q=!1;return this._lastFrameRadius===this._attachedCamera.i&&0!==this._attachedCamera.inertialRadiusOffset&&(q=!0),this._lastFrameRadius=this._attachedCamera.i,this._zoomStopsAnimation?q:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=R.e.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}Q(1502);class k{constructor(){this._easingMode=k.EASINGMODE_EASEIN}setEasingMode(q){const X=Math.min(Math.max(q,0),2);this._easingMode=X}getEasingMode(){return this._easingMode}easeInCore(q){throw new Error("You must implement this method")}ease(q){switch(this._easingMode){case k.EASINGMODE_EASEIN:return this.easeInCore(q);case k.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-q)}return q>=.5?.5*(1-this.easeInCore(2*(1-q)))+.5:.5*this.easeInCore(2*q)}}k.EASINGMODE_EASEIN=0,k.EASINGMODE_EASEOUT=1,k.EASINGMODE_EASEINOUT=2;var j=Q(11882);class I{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(q){if(this._autoTransitionRange===q)return;this._autoTransitionRange=q;const X=this._attachedCamera;X&&(q?this._onMeshTargetChangedObserver=X.onMeshTargetChangedObservable.add((q=>{if(q&&(q.le(!0),q.getBoundingInfo)){const X=q.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*X,this.upperRadiusTransitionRange=.05*X}})):this._onMeshTargetChangedObserver&&X.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(q){this._attachedCamera=q,this._onAfterCheckInputsObserver=q.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(q){return!!this._attachedCamera&&(this._attachedCamera.i===q&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(q){if(!this._attachedCamera)return;this._radiusBounceTransition||(I.EasingFunction.setEasingMode(I.EasingMode),this._radiusBounceTransition=j.e.CreateAnimation("i",j.e.ANIMATIONTYPE_FLOAT,60,I.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const X=j.e.TransitionTo("i",this._attachedCamera.i+q,this._attachedCamera,this._attachedCamera.va(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));X&&this._animatables.push(X)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}I.EasingFunction=new class extends k{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=q}easeInCore(q){const X=Math.max(0,this.amplitude);return Math.pow(q,3)-q*X*Math.sin(3.141592653589793*q)}}(.3),I.EasingMode=k.EASINGMODE_EASEOUT;class d{constructor(){this.onTargetFramingAnimationEndObservable=new u.c,this._mode=d.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(q){this._mode=q}get mode(){return this._mode}set radiusScale(q){this._radiusScale=q}get radiusScale(){return this._radiusScale}set positionScale(q){this._positionScale=q}get positionScale(){return this._positionScale}set defaultElevation(q){this._defaultElevation=q}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(q){this._elevationReturnTime=q}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(q){this._elevationReturnWaitTime=q}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(q){this._zoomStopsAnimation=q}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(q){this._framingTime=q}get framingTime(){return this._framingTime}init(){}attach(q){this._attachedCamera=q;const X=this._attachedCamera.va();d.EasingFunction.setEasingMode(d.EasingMode),this._onPrePointerObservableObserver=X.onPrePointerObservable.add((q=>{q.type!==a.c.POINTERDOWN?q.type===a.c.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=q.onMeshTargetChangedObservable.add((q=>{q&&q.getBoundingInfo&&this.zoomOnMesh(q,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=q.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const q=this._attachedCamera.va();this._onPrePointerObservableObserver&&q.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(q){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;q.le(!0);const y=q.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(y.minimumWorld,y.maximumWorld,X,Q)}zoomOnMeshHierarchy(q){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;q.le(!0);const y=q.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(y.min,y.max,X,Q)}zoomOnMeshesHierarchy(q){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const y=new H.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),x=new H.n(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let u=0;u<q.length;u++){const X=q[u].getHierarchyBoundingVectors(!0);H.n.CheckExtends(X.min,y,x),H.n.CheckExtends(X.max,y,x)}this.zoomOnBoundingInfo(y,x,X,Q)}zoomOnBoundingInfo(q,X){let Q,y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const u=q.y,b=u+(X.y-u)*this._positionScale,D=X.Sc(q).scale(.5);if(y)Q=new H.n(0,b,0);else{const X=q.add(D);Q=new H.n(X.x,b,X.z)}this._vectorTransition||(this._vectorTransition=j.e.CreateAnimation("target",j.e.ANIMATIONTYPE_VECTOR3,60,d.EasingFunction)),this._betaIsAnimating=!0;let a=j.e.TransitionTo("target",Q,this._attachedCamera,this._attachedCamera.va(),60,this._vectorTransition,this._framingTime);a&&this._animatables.push(a);let R=0;if(this._mode===d.FitFrustumSidesMode){const Q=this._calculateLowerRadiusFromModelBoundingSphere(q,X);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=D.length()+this._attachedCamera._i),R=Q}else this._mode===d.IgnoreBoundsSizeMode&&(R=this._calculateLowerRadiusFromModelBoundingSphere(q,X),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera._i));if(this.autoCorrectCameraLimitsAndSensibility){const Q=X.Sc(q).length();this._attachedCamera.panningSensibility=5e3/Q,this._attachedCamera.wheelPrecision=100/R}return this._radiusTransition||(this._radiusTransition=j.e.CreateAnimation("i",j.e.ANIMATIONTYPE_FLOAT,60,d.EasingFunction)),a=j.e.TransitionTo("i",R,this._attachedCamera,this._attachedCamera.va(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),x&&x(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),a&&this._animatables.push(a),!0}_calculateLowerRadiusFromModelBoundingSphere(q,X){const Q=this._attachedCamera;if(!Q)return 0;let y=Q._calculateLowerRadiusFromModelBoundingSphere(q,X,this._radiusScale);return Q.lowerRadiusLimit&&this._mode===d.IgnoreBoundsSizeMode&&(y=y<Q.lowerRadiusLimit?Q.lowerRadiusLimit:y),Q.upperRadiusLimit&&(y=y>Q.upperRadiusLimit?Q.upperRadiusLimit:y),y}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const q=R.e.Now-this._lastInteractionTime,X=.5*Math.PI-this._defaultElevation,Q=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>Q&&q>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=j.e.CreateAnimation("beta",j.e.ANIMATIONTYPE_FLOAT,60,d.EasingFunction));const q=j.e.TransitionTo("beta",X,this._attachedCamera,this._attachedCamera.va(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));q&&this._animatables.push(q)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=R.e.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}d.EasingFunction=new class extends k{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=q}easeInCore(q){return this.exponent<=0?q:(Math.exp(this.exponent*q)-1)/(Math.exp(this.exponent)-1)}},d.EasingMode=k.EASINGMODE_EASEINOUT,d.IgnoreBoundsSizeMode=0,d.FitFrustumSidesMode=1;var e=Q(11265),i=Q(11865),A=Q(11869),B=Q(1215);class w{constructor(){this._currentActiveButton=-1,this.buttons=[0,1,2]}attachControl(q){q=B.f.BackCompatCameraNoPreventDefault(arguments);const X=this.camera.getEngine(),Q=X.getInputElement();let y=0,x=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=u=>{var H,b;const D=u.event,R="touch"===D.pointerType;if(u.type!==a.c.POINTERMOVE&&-1===this.buttons.indexOf(D.button))return;const L=D.target;if(this._altKey=D.altKey,this._ctrlKey=D.ctrlKey,this._metaKey=D.metaKey,this._shiftKey=D.shiftKey,this._buttonsPressed=D.buttons,X.isPointerLock){const q=D.movementX,X=D.movementY;this.onTouch(null,q,X),this._pointA=null,this._pointB=null}else{if(u.type!==a.c.POINTERDOWN&&u.type!==a.c.POINTERDOUBLETAP&&R&&(null===(H=this._pointA)||void 0===H?void 0:H.pointerId)!==D.pointerId&&(null===(b=this._pointB)||void 0===b?void 0:b.pointerId)!==D.pointerId)return;if(u.type!==a.c.POINTERDOWN||-1!==this._currentActiveButton&&!R)if(u.type===a.c.POINTERDOUBLETAP)this.onDoubleTap(D.pointerType);else if(u.type!==a.c.POINTERUP||this._currentActiveButton!==D.button&&!R){if(u.type===a.c.POINTERMOVE)if(q||D.preventDefault(),this._pointA&&null===this._pointB){const q=D.clientX-this._pointA.x,X=D.clientY-this._pointA.y;this._pointA.x=D.clientX,this._pointA.y=D.clientY,this.onTouch(this._pointA,q,X)}else if(this._pointA&&this._pointB){const q=this._pointA.pointerId===D.pointerId?this._pointA:this._pointB;q.x=D.clientX,q.y=D.clientY;const X=this._pointA.x-this._pointB.x,Q=this._pointA.y-this._pointB.y,H=X*X+Q*Q,b={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:D.pointerId,type:u.type};this.onMultiTouch(this._pointA,this._pointB,y,H,x,b),x=b,y=H}}else{try{null===L||void 0===L||L.releasePointerCapture(D.pointerId)}catch(f){}R||(this._pointB=null),X._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==D.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==D.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==y||x)&&(this.onMultiTouch(this._pointA,this._pointB,y,0,x,null),y=0,x=null),this._currentActiveButton=-1,this.onButtonUp(D),q||D.preventDefault()}else{try{null===L||void 0===L||L.setPointerCapture(D.pointerId)}catch(f){}if(null===this._pointA)this._pointA={x:D.clientX,y:D.clientY,pointerId:D.pointerId,type:D.pointerType};else{if(null!==this._pointB)return;this._pointB={x:D.clientX,y:D.clientY,pointerId:D.pointerId,type:D.pointerType}}-1!==this._currentActiveButton||R||(this._currentActiveButton=D.button),this.onButtonDown(D),q||(D.preventDefault(),Q&&Q.focus())}}},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,a.c.POINTERDOWN|a.c.POINTERUP|a.c.POINTERMOVE|a.c.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,y=0,x=null,this.onLostFocus()},this._contextMenuBind=q=>this.onContextMenu(q),Q&&Q.addEventListener("contextmenu",this._contextMenuBind,!1);const u=this.camera.va().getEngine().getHostWindow();u&&B.f.RegisterTopRootEvents(u,[{name:"blur",handler:this._onLostFocus}])}Oe(){if(this._onLostFocus){const q=this.camera.va().getEngine().getHostWindow();q&&B.f.UnregisterTopRootEvents(q,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const q=this.camera.va().getEngine().getInputElement();q&&q.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentActiveButton=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(q){}onTouch(q,X,Q){}onMultiTouch(q,X,Q,y,x,u){}onContextMenu(q){q.preventDefault()}onButtonDown(q){}onButtonUp(q){}onLostFocus(){}}(0,y.b)([(0,x.J)()],w.prototype,"buttons",void 0);class V extends w{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(q,X){if(0!==this.panningSensibility&&q&&X){const Q=X.x-q.x,y=X.y-q.y;this.camera.inertialPanningX+=-Q/this.panningSensibility,this.camera.inertialPanningY+=y/this.panningSensibility}}_computePinchZoom(q,X){const Q=this.camera.i||V.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.i=Q*Math.sqrt(q)/Math.sqrt(X):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(X-q)*Q*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(X-q)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(q,X,Q){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-X/this.panningSensibility,this.camera.inertialPanningY+=Q/this.panningSensibility):(this.camera.inertialAlphaOffset-=X/this.angularSensibilityX,this.camera.inertialBetaOffset-=Q/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(q,X,Q,y,x,u){0===Q&&null===x||0===y&&null===u||(this.multiTouchPanAndZoom?(this._computePinchZoom(Q,y),this._computeMultiTouchPanning(x,u)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(y)-Math.sqrt(Q))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(Q,y),this._isPinching=!0):this._computeMultiTouchPanning(x,u)):this.multiTouchPanning?this._computeMultiTouchPanning(x,u):this.pinchZoom&&this._computePinchZoom(Q,y))}onButtonDown(q){this._isPanClick=q.button===this.camera._panningMouseButton}onButtonUp(q){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}V.MinimumRadiusForPinch=.001,(0,y.b)([(0,x.J)()],V.prototype,"buttons",void 0),(0,y.b)([(0,x.J)()],V.prototype,"angularSensibilityX",void 0),(0,y.b)([(0,x.J)()],V.prototype,"angularSensibilityY",void 0),(0,y.b)([(0,x.J)()],V.prototype,"pinchPrecision",void 0),(0,y.b)([(0,x.J)()],V.prototype,"pinchDeltaPercentage",void 0),(0,y.b)([(0,x.J)()],V.prototype,"useNaturalPinchZoom",void 0),(0,y.b)([(0,x.J)()],V.prototype,"pinchZoom",void 0),(0,y.b)([(0,x.J)()],V.prototype,"panningSensibility",void 0),(0,y.b)([(0,x.J)()],V.prototype,"multiTouchPanning",void 0),(0,y.b)([(0,x.J)()],V.prototype,"multiTouchPanAndZoom",void 0),A.c.ArcRotateCameraPointersInput=V;var W=Q(1295);class v{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(q){q=B.f.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((X=>{const Q=X.event;if(!Q.metaKey)if(X.type===W.e.KEYDOWN){if(this._ctrlPressed=Q.ctrlKey,this._altPressed=Q.altKey,-1!==this.keysUp.indexOf(Q.keyCode)||-1!==this.keysDown.indexOf(Q.keyCode)||-1!==this.keysLeft.indexOf(Q.keyCode)||-1!==this.keysRight.indexOf(Q.keyCode)||-1!==this.keysReset.indexOf(Q.keyCode)){-1===this._keys.indexOf(Q.keyCode)&&this._keys.push(Q.keyCode),Q.preventDefault&&(q||Q.preventDefault())}}else if(-1!==this.keysUp.indexOf(Q.keyCode)||-1!==this.keysDown.indexOf(Q.keyCode)||-1!==this.keysLeft.indexOf(Q.keyCode)||-1!==this.keysRight.indexOf(Q.keyCode)||-1!==this.keysReset.indexOf(Q.keyCode)){const X=this._keys.indexOf(Q.keyCode);X>=0&&this._keys.splice(X,1),Q.preventDefault&&(q||Q.preventDefault())}})))}Oe(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const q=this.camera;for(let X=0;X<this._keys.length;X++){const Q=this._keys[X];-1!==this.keysLeft.indexOf(Q)?this._ctrlPressed&&this.camera._useCtrlForPanning?q.inertialPanningX-=1/this.panningSensibility:q.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(Q)?this._ctrlPressed&&this.camera._useCtrlForPanning?q.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?q.inertialRadiusOffset+=1/this.zoomingSensibility:q.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(Q)?this._ctrlPressed&&this.camera._useCtrlForPanning?q.inertialPanningX+=1/this.panningSensibility:q.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(Q)?this._ctrlPressed&&this.camera._useCtrlForPanning?q.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?q.inertialRadiusOffset-=1/this.zoomingSensibility:q.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(Q)&&q.useInputToRestoreState&&q.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,y.b)([(0,x.J)()],v.prototype,"keysUp",void 0),(0,y.b)([(0,x.J)()],v.prototype,"keysDown",void 0),(0,y.b)([(0,x.J)()],v.prototype,"keysLeft",void 0),(0,y.b)([(0,x.J)()],v.prototype,"keysRight",void 0),(0,y.b)([(0,x.J)()],v.prototype,"keysReset",void 0),(0,y.b)([(0,x.J)()],v.prototype,"panningSensibility",void 0),(0,y.b)([(0,x.J)()],v.prototype,"zoomingSensibility",void 0),(0,y.b)([(0,x.J)()],v.prototype,"useAltToZoom",void 0),(0,y.b)([(0,x.J)()],v.prototype,"angularSpeed",void 0),A.c.ArcRotateCameraKeyboardMoveInput=v;var Z=Q(1192),U=Q(1297),O=Q(1032);class g{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new H.n(0,0,0),this._globalOffset=new H.n(0,0,0),this._inertialPanning=H.n.Zero()}_computeDeltaFromMouseWheelLegacyEvent(q,X){let Q=0;const y=.01*q*this.wheelDeltaPercentage*X;return Q=q>0?y/(1+this.wheelDeltaPercentage):y*(1+this.wheelDeltaPercentage),Q}attachControl(q){q=B.f.BackCompatCameraNoPreventDefault(arguments),this._wheel=X=>{if(X.type!==a.c.POINTERWHEEL)return;const Q=X.event;let y=0;const x=Q.deltaMode===U.d.DOM_DELTA_LINE?40:1,u=-Q.deltaY*x;if(this.customComputeDeltaFromMouseWheel)y=this.customComputeDeltaFromMouseWheel(u,this,Q);else if(this.wheelDeltaPercentage){if(y=this._computeDeltaFromMouseWheelLegacyEvent(u,this.camera.i),y>0){let q=this.camera.i,X=this.camera.inertialRadiusOffset+y;for(let Q=0;Q<20&&Math.abs(X)>.001;Q++)q-=X,X*=this.camera.inertia;q=(0,O.d)(q,0,Number.MAX_VALUE),y=this._computeDeltaFromMouseWheelLegacyEvent(u,q)}}else y=u/(40*this.wheelPrecision);y&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(y)):this.camera.inertialRadiusOffset+=y),Q.preventDefault&&(q||Q.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,a.c.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.Td(0)}Oe(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const q=this.camera;0+q.inertialAlphaOffset+q.inertialBetaOffset+q.inertialRadiusOffset&&(this._updateHitPlane(),q.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(q.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const q=this.camera,X=q.target.Sc(q.position);this._hitPlane=Z.e.FromPositionAndNormal(q.target,X)}_getPosition(){const q=this.camera,X=q.va(),Q=X.createPickingRay(X.pointerX,X.pointerY,H.b.Identity(),q,!1);0===q.targetScreenOffset.x&&0===q.targetScreenOffset.y||(this._viewOffset.set(q.targetScreenOffset.x,q.targetScreenOffset.y,0),q.getViewMatrix().invertToRef(q._cameraTransformMatrix),this._globalOffset=H.n.TransformNormal(this._viewOffset,q._cameraTransformMatrix),Q.origin.addInPlace(this._globalOffset));let y=0;return this._hitPlane&&(y=Q.intersectsPlane(this._hitPlane)??0),Q.origin.addInPlace(Q.direction.scaleInPlace(y))}_zoomToMouse(q){const X=this.camera,Q=1-X.inertia;if(X.lowerRadiusLimit){const y=X.lowerRadiusLimit??0;X.i-(X.inertialRadiusOffset+q)/Q<y&&(q=(X.i-y)*Q-X.inertialRadiusOffset)}if(X.upperRadiusLimit){const y=X.upperRadiusLimit??0;X.i-(X.inertialRadiusOffset+q)/Q>y&&(q=(X.i-y)*Q-X.inertialRadiusOffset)}const y=q/Q/X.i,x=this._getPosition(),u=H.h.Od[6];x.subtractToRef(X.target,u),u.scaleInPlace(y),u.scaleInPlace(Q),this._inertialPanning.addInPlace(u),X.inertialRadiusOffset+=q}_zeroIfClose(q){Math.abs(q.x)<L.b&&(q.x=0),Math.abs(q.y)<L.b&&(q.y=0),Math.abs(q.z)<L.b&&(q.z=0)}}(0,y.b)([(0,x.J)()],g.prototype,"wheelPrecision",void 0),(0,y.b)([(0,x.J)()],g.prototype,"zoomToMouseLocation",void 0),(0,y.b)([(0,x.J)()],g.prototype,"wheelDeltaPercentage",void 0),A.c.ArcRotateCameraMouseWheelInput=g;class P extends A.d{constructor(q){super(q)}addMouseWheel(){return this.add(new g),this}addPointers(){return this.add(new V),this}addKeyboard(){return this.add(new v),this}}var F=Q(1015);b.d.AddNodeConstructor("ArcRotateCamera",((q,X)=>()=>new l(q,0,0,1,H.n.Zero(),X)));class l extends i.c{get target(){return this._target}set target(q){this.setTarget(q)}get targetHost(){return this._targetHost}set targetHost(q){q&&this.setTarget(q)}getTarget(){return this.target}get position(){return this._position}set position(q){this.setPosition(q)}set upVector(q){this._upToYMatrix||(this._yToUpMatrix=new H.b,this._upToYMatrix=new H.b,this._upVector=H.n.Zero()),q.normalize(),this._upVector.p(q),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){H.b.RotationAlignToRef(H.n.UpReadOnly,this._upVector,this._yToUpMatrix),H.b.RotationAlignToRef(this._upVector,H.n.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const q=this.inputs.attached.pointers;return q?q.angularSensibilityX:0}set angularSensibilityX(q){const X=this.inputs.attached.pointers;X&&(X.angularSensibilityX=q)}get angularSensibilityY(){const q=this.inputs.attached.pointers;return q?q.angularSensibilityY:0}set angularSensibilityY(q){const X=this.inputs.attached.pointers;X&&(X.angularSensibilityY=q)}get pinchPrecision(){const q=this.inputs.attached.pointers;return q?q.pinchPrecision:0}set pinchPrecision(q){const X=this.inputs.attached.pointers;X&&(X.pinchPrecision=q)}get pinchDeltaPercentage(){const q=this.inputs.attached.pointers;return q?q.pinchDeltaPercentage:0}set pinchDeltaPercentage(q){const X=this.inputs.attached.pointers;X&&(X.pinchDeltaPercentage=q)}get useNaturalPinchZoom(){const q=this.inputs.attached.pointers;return!!q&&q.useNaturalPinchZoom}set useNaturalPinchZoom(q){const X=this.inputs.attached.pointers;X&&(X.useNaturalPinchZoom=q)}get panningSensibility(){const q=this.inputs.attached.pointers;return q?q.panningSensibility:0}set panningSensibility(q){const X=this.inputs.attached.pointers;X&&(X.panningSensibility=q)}get keysUp(){const q=this.inputs.attached.keyboard;return q?q.keysUp:[]}set keysUp(q){const X=this.inputs.attached.keyboard;X&&(X.keysUp=q)}get keysDown(){const q=this.inputs.attached.keyboard;return q?q.keysDown:[]}set keysDown(q){const X=this.inputs.attached.keyboard;X&&(X.keysDown=q)}get keysLeft(){const q=this.inputs.attached.keyboard;return q?q.keysLeft:[]}set keysLeft(q){const X=this.inputs.attached.keyboard;X&&(X.keysLeft=q)}get keysRight(){const q=this.inputs.attached.keyboard;return q?q.keysRight:[]}set keysRight(q){const X=this.inputs.attached.keyboard;X&&(X.keysRight=q)}get wheelPrecision(){const q=this.inputs.attached.mousewheel;return q?q.wheelPrecision:0}set wheelPrecision(q){const X=this.inputs.attached.mousewheel;X&&(X.wheelPrecision=q)}get zoomToMouseLocation(){const q=this.inputs.attached.mousewheel;return!!q&&q.zoomToMouseLocation}set zoomToMouseLocation(q){const X=this.inputs.attached.mousewheel;X&&(X.zoomToMouseLocation=q)}get wheelDeltaPercentage(){const q=this.inputs.attached.mousewheel;return q?q.wheelDeltaPercentage:0}set wheelDeltaPercentage(q){const X=this.inputs.attached.mousewheel;X&&(X.wheelDeltaPercentage=q)}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(q){q!==this.useBouncingBehavior&&(q?(this._bouncingBehavior=new I,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(q){q!==this.useFramingBehavior&&(q?(this._framingBehavior=new d,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(q){q!==this.useAutoRotationBehavior&&(q?(this._autoRotationBehavior=new f,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(q,X,Q,y,x,b){var D;let a=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(q,H.n.Zero(),b,a),D=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=H.n.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=H.k.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._viewMatrix=new H.b,this.panningAxis=new H.n(1,1,0),this._transformedDirection=new H.n,this.mapPanning=!1,this._progressiveRestore=!1,this.onMeshTargetChangedObservable=new u.c,this.checkCollisions=!1,this.collisionRadius=new H.n(.5,.5,.5),this._previousPosition=H.n.Zero(),this._collisionVelocity=H.n.Zero(),this._newPosition=H.n.Zero(),this._computationVector=H.n.Zero(),this._onCollisionPositionChange=function(q,X){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Q?(D.setPosition(X),D.Dk&&D.Dk(Q)):D._previousPosition.p(D._position);const y=Math.cos(D.alpha),x=Math.sin(D.alpha),u=Math.cos(D.beta);let H=Math.sin(D.beta);0===H&&(H=1e-4);const b=D._getTargetPosition();D._computationVector.Pd(D.i*y*H,D.i*u,D.i*x*H),b.addToRef(D._computationVector,D._newPosition),D._position.p(D._newPosition);let a=D.upVector;D.allowUpsideDown&&D.beta<0&&(a=a.clone(),a=a.negate()),D._computeViewMatrix(D._position,b,a),D._viewMatrix.addAtIndex(12,D.targetScreenOffset.x),D._viewMatrix.addAtIndex(13,D.targetScreenOffset.y),D._collisionTriggered=!1},this._target=H.n.Zero(),x&&this.setTarget(x),this.alpha=X,this.beta=Q,this.i=y,this.getViewMatrix(),this.inputs=new P(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new H.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.i=void 0,this._cache.targetScreenOffset=H.k.Zero()}_updateCache(q){q||super._updateCache(),this._cache._target.p(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.i=this.i,this._cache.targetScreenOffset.p(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const q=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?q.addToRef(this._targetBoundingCenter,this._target):this._target.p(q)}const q=this._getLockedTargetPosition();return q||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.i,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>L.b&&this.restoreStateInterpolationFactor<1?(this._progressiveRestore=!0,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.i=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.i===this.i&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(q,X){let Q=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const x=arguments;X=B.f.BackCompatCameraNoPreventDefault(x),this._useCtrlForPanning=Q,this._panningMouseButton=y,"boolean"===typeof x[0]&&(x.length>1&&(this._useCtrlForPanning=x[1]),x.length>2&&(this._panningMouseButton=x[2])),this.inputs.attachElement(X),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}Oe(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),this._progressiveRestore){const q=this._scene.getEngine().getDeltaTime()/1e3,X=1-Math.pow(2,-q/this.restoreStateInterpolationFactor);this.setTarget(H.n.Lerp(this.getTarget(),this._storedTarget,X)),H.d.RotationAlphaBetaGammaToRef(this._storedAlpha,this._storedBeta,0,H.h.Quaternion[0]),H.d.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,H.h.Quaternion[1]),H.d.SlerpToRef(H.h.Quaternion[1],H.h.Quaternion[0],X,H.h.Quaternion[2]),H.h.Quaternion[2].normalize(),H.h.Quaternion[2].toAlphaBetaGammaToRef(H.h.Od[0]),this.alpha=H.h.Od[0].x,this.beta=H.h.Od[0].y,this.i+=(this._storedRadius-this.i)*X,H.k.LerpToRef(this.targetScreenOffset,this._storedTargetScreenOffset,X,this.targetScreenOffset),(H.n.DistanceSquared(this.getTarget(),this._storedTarget)<L.b&&H.h.Quaternion[2].equalsWithEpsilon(H.h.Quaternion[0])&&Math.pow(this._storedRadius-this.i,2)<L.b&&H.k.Distance(this.targetScreenOffset,this._storedTargetScreenOffset)<L.b||0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset||0!==this.inertialPanningX||0!==this.inertialPanningY)&&(this._progressiveRestore=!1)}if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){const q=this.invertRotation?-1:1,X=this._calculateHandednessMultiplier();let Q=this.inertialAlphaOffset*X;this.beta<0&&(Q*=-1),this.alpha+=Q*q,this.beta+=this.inertialBetaOffset*q,this.i-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<L.b&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<L.b&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*L.b&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){const q=new H.n(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),q.multiplyInPlace(this.panningAxis),H.n.TransformNormalToRef(q,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const q=this.upVector,X=H.n.CrossToRef(this._transformedDirection,q,this._transformedDirection);H.n.CrossToRef(q,X,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);H.n.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.p(this._transformedDirection)}else{if(this.parent){const q=H.h.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(q),q.transposeToRef(q),H.n.TransformCoordinatesToRef(this._transformedDirection,q,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*L.b&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*L.b&&(this.inertialPanningY=0)}this._checkLimits(),super._checkInputs()}}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.i<this.lowerRadiusLimit&&(this.i=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.i>this.upperRadiusLimit&&(this.i=this.upperRadiusLimit,this.inertialRadiusOffset=0)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||H.n.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.i=this._computationVector.length(),0===this.i&&(this.i=1e-4);const q=this.alpha;0===this._computationVector.x&&0===this._computationVector.z?this.alpha=Math.PI/2:this.alpha=Math.acos(this._computationVector.x/Math.sqrt(Math.pow(this._computationVector.x,2)+Math.pow(this._computationVector.z,2))),this._computationVector.z<0&&(this.alpha=2*Math.PI-this.alpha);const X=Math.round((q-this.alpha)/(2*Math.PI));this.alpha+=2*X*Math.PI,this.beta=Math.acos(this._computationVector.y/this.i),this._checkLimits()}setPosition(q){this._position.equals(q)||(this._position.p(q),this.rebuildAnglesAndRadius())}setTarget(q){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2],y=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(y=this.overrideCloneAlphaBetaRadius??y,q.le)X&&q.getBoundingInfo?this._targetBoundingCenter=q.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,q.le(),this._targetHost=q,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const X=q,y=this._getTargetPosition();if(y&&!Q&&y.equals(X))return;this._targetHost=null,this._target=X,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}y||this.rebuildAnglesAndRadius()}_getViewMatrix(){const q=Math.cos(this.alpha),X=Math.sin(this.alpha),Q=Math.cos(this.beta);let y=Math.sin(this.beta);0===y&&(y=1e-4),0===this.i&&(this.i=1e-4);const x=this._getTargetPosition();if(this._computationVector.Pd(this.i*q*y,this.i*Q,this.i*X*y),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||H.n.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),x.addToRef(this._computationVector,this._newPosition),this.va().collisionsEnabled&&this.checkCollisions){const q=this.va().collisionCoordinator;this._collider||(this._collider=q.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,q.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.p(this._newPosition);let q=this.upVector;this.allowUpsideDown&&y<0&&(q=q.negate()),this._computeViewMatrix(this._position,x,q),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget=x,this._viewMatrix}zoomOn(q){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1];q=q||this.va().meshes;const Q=D.b.MinMax(q);let y=this._calculateLowerRadiusFromModelBoundingSphere(Q.min,Q.max);y=Math.max(Math.min(y,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.i=y*this.zoomOnFactor,this.focusOn({min:Q.min,max:Q.max,distance:y},X)}focusOn(q){let X,Q,y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===q.min){const y=q||this.va().meshes;X=D.b.MinMax(y),Q=H.n.Distance(X.min,X.max)}else{X=q,Q=q.distance}this._target=D.b.Center(X),y||(this.maxZ=2*Q)}createRigCamera(q,X){let Q=0;switch(this.cameraRigMode){case e.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case e.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case e.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case e.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case e.c.RIG_MODE_VR:Q=this._cameraRigParams.stereoHalfAngle*(0===X?1:-1);break;case e.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:Q=this._cameraRigParams.stereoHalfAngle*(0===X?-1:1)}const y=new l(q,this.alpha+Q,this.beta,this.i,this._target,this.va());return y._cameraRigParams={},y.isRigCamera=!0,y.rigParent=this,y.upVector=this.upVector,y.mode=this.mode,y.orthoLeft=this.orthoLeft,y.orthoRight=this.orthoRight,y.orthoBottom=this.orthoBottom,y.orthoTop=this.orthoTop,y}_updateRigCameras(){const q=this._rigCameras[0],X=this._rigCameras[1];switch(q.beta=X.beta=this.beta,this.cameraRigMode){case e.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case e.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case e.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case e.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case e.c.RIG_MODE_VR:q.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,X.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case e.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:q.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,X.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(q,X){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const y=H.n.Distance(q,X),x=this.va().getEngine().getAspectRatio(this),u=Math.tan(this.fov/2),b=u*x,D=.5*y*Q,a=D*Math.sqrt(1+1/(b*b)),R=D*Math.sqrt(1+1/(u*u));return Math.max(a,R)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,y.b)([(0,x.J)()],l.prototype,"alpha",void 0),(0,y.b)([(0,x.J)()],l.prototype,"beta",void 0),(0,y.b)([(0,x.J)()],l.prototype,"i",void 0),(0,y.b)([(0,x.J)()],l.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,y.b)([(0,x.F)("target")],l.prototype,"_target",void 0),(0,y.b)([(0,x.y)("targetHost")],l.prototype,"_targetHost",void 0),(0,y.b)([(0,x.J)()],l.prototype,"inertialAlphaOffset",void 0),(0,y.b)([(0,x.J)()],l.prototype,"inertialBetaOffset",void 0),(0,y.b)([(0,x.J)()],l.prototype,"inertialRadiusOffset",void 0),(0,y.b)([(0,x.J)()],l.prototype,"lowerAlphaLimit",void 0),(0,y.b)([(0,x.J)()],l.prototype,"upperAlphaLimit",void 0),(0,y.b)([(0,x.J)()],l.prototype,"lowerBetaLimit",void 0),(0,y.b)([(0,x.J)()],l.prototype,"upperBetaLimit",void 0),(0,y.b)([(0,x.J)()],l.prototype,"lowerRadiusLimit",void 0),(0,y.b)([(0,x.J)()],l.prototype,"upperRadiusLimit",void 0),(0,y.b)([(0,x.J)()],l.prototype,"inertialPanningX",void 0),(0,y.b)([(0,x.J)()],l.prototype,"inertialPanningY",void 0),(0,y.b)([(0,x.J)()],l.prototype,"pinchToPanMaxDistance",void 0),(0,y.b)([(0,x.J)()],l.prototype,"panningDistanceLimit",void 0),(0,y.b)([(0,x.F)()],l.prototype,"panningOriginTarget",void 0),(0,y.b)([(0,x.J)()],l.prototype,"panningInertia",void 0),(0,y.b)([(0,x.J)()],l.prototype,"zoomToMouseLocation",null),(0,y.b)([(0,x.J)()],l.prototype,"zoomOnFactor",void 0),(0,y.b)([(0,x.E)()],l.prototype,"targetScreenOffset",void 0),(0,y.b)([(0,x.J)()],l.prototype,"allowUpsideDown",void 0),(0,y.b)([(0,x.J)()],l.prototype,"useInputToRestoreState",void 0),(0,y.b)([(0,x.J)()],l.prototype,"restoreStateInterpolationFactor",void 0),(0,F.h)("BABYLON.ArcRotateCamera",l)},11265:(q,X,Q)=>{"use strict";Q.d(X,{c:()=>d});var y=Q(975),x=Q(984),u=Q(1199),H=Q(1215),b=Q(998),D=Q(1002),a=Q(11270),R=Q(1099),L=Q(1015),f=Q(1081),k=Q(1508),j=Q(1307),I=Q(1173);class d extends a.d{get position(){return this._position}set position(q){this._position=q}set upVector(q){this._upVector=q}get upVector(){return this._upVector}get screenArea(){let q=0,X=0;if(this.mode===d.PERSPECTIVE_CAMERA)this.fovMode===d.FOVMODE_VERTICAL_FIXED?(X=2*this._i*Math.tan(this.fov/2),q=this.getEngine().getAspectRatio(this)*X):(q=2*this._i*Math.tan(this.fov/2),X=q/this.getEngine().getAspectRatio(this));else{const Q=this.getEngine().getRenderWidth()/2,y=this.getEngine().getRenderHeight()/2;q=(this.orthoRight??Q)-(this.orthoLeft??-Q),X=(this.orthoTop??y)-(this.orthoBottom??-y)}return q*X}set orthoLeft(q){this._orthoLeft=q;for(const X of this._rigCameras)X.orthoLeft=q}get orthoLeft(){return this._orthoLeft}set orthoRight(q){this._orthoRight=q;for(const X of this._rigCameras)X.orthoRight=q}get orthoRight(){return this._orthoRight}set orthoBottom(q){this._orthoBottom=q;for(const X of this._rigCameras)X.orthoBottom=q}get orthoBottom(){return this._orthoBottom}set orthoTop(q){this._orthoTop=q;for(const X of this._rigCameras)X.orthoTop=q}get orthoTop(){return this._orthoTop}set mode(q){this._mode=q;for(const X of this._rigCameras)X.mode=q}get mode(){return this._mode}get hasMoved(){return this._hasMoved}constructor(q,X,Q){let y=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];super(q,Q,!1),this._position=D.n.Zero(),this._upVector=D.n.Up(),this.oblique=null,this._orthoLeft=null,this._orthoRight=null,this._orthoBottom=null,this._orthoTop=null,this.fov=.8,this.projectionPlaneTilt=0,this._i=1,this.maxZ=1e4,this.inertia=.9,this._mode=d.PERSPECTIVE_CAMERA,this.isIntermediate=!1,this.viewport=new k.e(0,0,1,1),this.layerMask=268435455,this.fovMode=d.FOVMODE_VERTICAL_FIXED,this.cameraRigMode=d.RIG_MODE_NONE,this.customRenderTargets=[],this.outputRenderTarget=null,this.onViewMatrixChangedObservable=new b.c,this.onProjectionMatrixChangedObservable=new b.c,this.onAfterCheckInputsObservable=new b.c,this.onRestoreStateObservable=new b.c,this.isRigCamera=!1,this._hasMoved=!1,this._rigCameras=new Array,this._skipRendering=!1,this._projectionMatrix=new D.b,this._postProcesses=new Array,this._activeMeshes=new u.g(256),this._globalPosition=D.n.Zero(),this._computedViewMatrix=D.b.Identity(),this._doNotComputeProjectionMatrix=!1,this._transformMatrix=D.b.Zero(),this._refreshFrustumPlanes=!0,this._absoluteRotation=D.d.Identity(),this._isCamera=!0,this._isLeftCamera=!1,this._isRightCamera=!1,this.va().addCamera(this),y&&!this.va().activeCamera&&(this.va().activeCamera=this),this.position=X,this.renderPassId=this.va().getEngine().createRenderPassId(`Camera ${q}`)}storeState(){return this._stateStored=!0,this._storedFov=this.fov,this}hasStateStored(){return!!this._stateStored}_restoreStateValues(){return!!this._stateStored&&(this.fov=this._storedFov,!0)}restoreState(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)}getClassName(){return"Eh"}toString(q){let X="Name: "+this.name;if(X+=", type: "+this.getClassName(),this.animations)for(let Q=0;Q<this.animations.length;Q++)X+=", animation[0]: "+this.animations[Q].toString(q);return X}applyVerticalCorrection(){const q=this.absoluteRotation.toEulerAngles();this.projectionPlaneTilt=this._scene.useRightHandedSystem?-q.x:q.x}get globalPosition(){return this._globalPosition}getActiveMeshes(){return this._activeMeshes}isActiveMesh(q){return-1!==this._activeMeshes.indexOf(q)}isReady(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(q)for(const X of this._postProcesses)if(X&&!X.isReady())return!1;return super.isReady(q)}_initCache(){super._initCache(),this._cache.position=new D.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new D.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache._i=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.obliqueAngle=void 0,this._cache.obliqueLength=void 0,this._cache.obliqueOffset=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0}_updateCache(q){q||super._updateCache(),this._cache.position.p(this.position),this._cache.upVector.p(this.upVector)}_isSynchronized(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()}_isSynchronizedViewMatrix(){return!!super._isSynchronized()&&(this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent())}_isSynchronizedProjectionMatrix(){let q=this._cache.mode===this.mode&&this._cache._i===this._i&&this._cache.maxZ===this.maxZ;if(!q)return!1;const X=this.getEngine();return this.mode===d.PERSPECTIVE_CAMERA?q=this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===X.getAspectRatio(this)&&this._cache.projectionPlaneTilt===this.projectionPlaneTilt:(q=this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===X.getRenderWidth()&&this._cache.renderHeight===X.getRenderHeight(),this.oblique&&(q=q&&this._cache.obliqueAngle===this.oblique.angle&&this._cache.obliqueLength===this.oblique.length&&this._cache.obliqueOffset===this.oblique.offset)),q}attachControl(q,X){}Oe(q){}update(){this._hasMoved=!1,this._checkInputs(),this.cameraRigMode!==d.RIG_MODE_NONE&&this._updateRigCameras(),this.getViewMatrix(),this.getProjectionMatrix()}_checkInputs(){this.onAfterCheckInputsObservable.notifyObservers(this)}get rigCameras(){return this._rigCameras}get rigPostProcess(){return this._rigPostProcess}_getFirstPostProcess(){for(let q=0;q<this._postProcesses.length;q++)if(null!==this._postProcesses[q])return this._postProcesses[q];return null}_cascadePostProcessesToRigCams(){const q=this._getFirstPostProcess();q&&q.markTextureDirty();for(let X=0,Q=this._rigCameras.length;X<Q;X++){const q=this._rigCameras[X],Q=q._rigPostProcess;if(Q){"pass"===Q.getEffectName()&&(q.isIntermediate=0===this._postProcesses.length),q._postProcesses=this._postProcesses.slice(0).concat(Q),Q.markTextureDirty()}else q._postProcesses=this._postProcesses.slice(0)}}attachPostProcess(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return!q.isReusable()&&this._postProcesses.indexOf(q)>-1?(R.b.Error("You're trying to reuse a post process not defined as reusable."),0):(null==X||X<0?this._postProcesses.push(q):null===this._postProcesses[X]?this._postProcesses[X]=q:this._postProcesses.splice(X,0,q),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.te(),this._postProcesses.indexOf(q))}detachPostProcess(q){const X=this._postProcesses.indexOf(q);-1!==X&&(this._postProcesses[X]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.te(),this._cascadePostProcessesToRigCams()}getWorldMatrix(){return this._isSynchronizedViewMatrix()||this.getViewMatrix(),this._worldMatrix}_getViewMatrix(){return D.b.Identity()}getViewMatrix(q){return!q&&this._isSynchronizedViewMatrix()||(this._hasMoved=!0,this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.va().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix)),this._computedViewMatrix}freezeProjectionMatrix(q){this._doNotComputeProjectionMatrix=!0,void 0!==q&&(this._projectionMatrix=q)}unfreezeProjectionMatrix(){this._doNotComputeProjectionMatrix=!1}getProjectionMatrix(q){if(this._doNotComputeProjectionMatrix||!q&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache._i=this._i,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;const X=this.getEngine(),Q=this.va(),y=X.useReverseDepthBuffer;if(this.mode===d.PERSPECTIVE_CAMERA){let q;this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=X.getAspectRatio(this),this._cache.projectionPlaneTilt=this.projectionPlaneTilt,this._i<=0&&(this._i=.1),q=Q.useRightHandedSystem?D.b.PerspectiveFovRHToRef:D.b.PerspectiveFovLHToRef,q(this.fov,X.getAspectRatio(this),y?this.maxZ:this._i,y?this._i:this.maxZ,this._projectionMatrix,this.fovMode===d.FOVMODE_VERTICAL_FIXED,X.isNDCHalfZRange,this.projectionPlaneTilt,y)}else{var x,u,H;const q=X.getRenderWidth()/2,b=X.getRenderHeight()/2;Q.useRightHandedSystem?this.oblique?D.b.ObliqueOffCenterRHToRef(this.orthoLeft??-q,this.orthoRight??q,this.orthoBottom??-b,this.orthoTop??b,y?this.maxZ:this._i,y?this._i:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,X.isNDCHalfZRange):D.b.OrthoOffCenterRHToRef(this.orthoLeft??-q,this.orthoRight??q,this.orthoBottom??-b,this.orthoTop??b,y?this.maxZ:this._i,y?this._i:this.maxZ,this._projectionMatrix,X.isNDCHalfZRange):this.oblique?D.b.ObliqueOffCenterLHToRef(this.orthoLeft??-q,this.orthoRight??q,this.orthoBottom??-b,this.orthoTop??b,y?this.maxZ:this._i,y?this._i:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,X.isNDCHalfZRange):D.b.OrthoOffCenterLHToRef(this.orthoLeft??-q,this.orthoRight??q,this.orthoBottom??-b,this.orthoTop??b,y?this.maxZ:this._i,y?this._i:this.maxZ,this._projectionMatrix,X.isNDCHalfZRange),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.obliqueAngle=null===(x=this.oblique)||void 0===x?void 0:x.angle,this._cache.obliqueLength=null===(u=this.oblique)||void 0===u?void 0:u.length,this._cache.obliqueOffset=null===(H=this.oblique)||void 0===H?void 0:H.offset,this._cache.renderWidth=X.getRenderWidth(),this._cache.renderHeight=X.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix}getTransformationMatrix(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix}_computeObliqueDistance(q){return(this.i||(this.target?D.n.Distance(this.position,this.target):this.position.length()))+q}_updateFrustumPlanes(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?j.c.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=j.c.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)}isInFrustum(q){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._updateFrustumPlanes(),X&&this.rigCameras.length>0){let X=!1;return this.rigCameras.forEach((Q=>{Q._updateFrustumPlanes(),X=X||q.isInFrustum(Q._frustumPlanes)})),X}return q.isInFrustum(this._frustumPlanes)}isCompletelyInFrustum(q){return this._updateFrustumPlanes(),q.isCompletelyInFrustum(this._frustumPlanes)}getForwardRay(){throw(0,f.c)("Ray")}getForwardRayToRef(q){throw(0,f.c)("Ray")}dispose(q){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.va().stopAnimation(this),this.va().removeCamera(this);this._rigCameras.length>0;){const q=this._rigCameras.pop();q&&q.dispose()}if(this._parentContainer){const q=this._parentContainer.cameras.indexOf(this);q>-1&&this._parentContainer.cameras.splice(q,1),this._parentContainer=null}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses.length=0;else if(this.cameraRigMode!==d.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses.length=0;else{let q=this._postProcesses.length;for(;--q>=0;){const X=this._postProcesses[q];X&&X.dispose(this)}}let Q=this.customRenderTargets.length;for(;--Q>=0;)this.customRenderTargets[Q].dispose();this.customRenderTargets.length=0,this._activeMeshes.dispose(),this.va().getEngine().releaseRenderPassId(this.renderPassId),super.dispose(q,X)}get isLeftCamera(){return this._isLeftCamera}get isRightCamera(){return this._isRightCamera}get leftCamera(){return this._rigCameras.length<1?null:this._rigCameras[0]}get rightCamera(){return this._rigCameras.length<2?null:this._rigCameras[1]}getLeftTarget(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()}getRightTarget(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()}setCameraRigMode(q,X){if(this.cameraRigMode!==q){for(;this._rigCameras.length>0;){const q=this._rigCameras.pop();q&&q.dispose()}if(this.cameraRigMode=q,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=X.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=H.f.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==d.RIG_MODE_NONE){const q=this.createRigCamera(this.name+"_L",0);q&&(q._isLeftCamera=!0);const X=this.createRigCamera(this.name+"_R",1);X&&(X._isRightCamera=!0),q&&X&&(this._rigCameras.push(q),this._rigCameras.push(X))}this._setRigMode(X),this._cascadePostProcessesToRigCams(),this.update()}}_setRigMode(q){}_getVRProjectionMatrix(){return D.b.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this._i,this.maxZ,this._cameraRigParams.vrWorkMatrix,!0,this.getEngine().isNDCHalfZRange),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix}setCameraRigParameter(q,X){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[q]=X,"interaxialDistance"===q&&(this._cameraRigParams.stereoHalfAngle=H.f.ToRadians(X/.0637))}createRigCamera(q,X){return null}_updateRigCameras(){for(let q=0;q<this._rigCameras.length;q++)this._rigCameras[q]._i=this._i,this._rigCameras[q].maxZ=this.maxZ,this._rigCameras[q].fov=this.fov,this._rigCameras[q].upVector.p(this.upVector);this.cameraRigMode===d.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)}_setupInputs(){}serialize(){const q=I.c.Serialize(this);return q.uniqueId=this.uniqueId,q.type=this.getClassName(),this.parent&&this.parent._serializeAsParent(q),this.inputs&&this.inputs.serialize(q),I.c.AppendSerializedAnimations(this,q),q.ranges=this.serializeAnimationRanges(),q.isEnabled=this.isEnabled(),q}clone(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Q=I.c.Clone(d.GetConstructorFromName(this.getClassName(),q,this.va(),this.interaxialDistance,this.isStereoscopicSideBySide),this);return Q.name=q,Q.parent=X,this.onClonedObservable.notifyObservers(Q),Q}ef(q){const X=D.n.Zero();return this.getDirectionToRef(q,X),X}get absoluteRotation(){return this.getWorldMatrix().decompose(void 0,this._absoluteRotation),this._absoluteRotation}getDirectionToRef(q,X){D.n.TransformNormalToRef(q,this.getWorldMatrix(),X)}static GetConstructorFromName(q,X,Q){let y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,x=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const u=a.d.Construct(q,X,Q,{interaxial_distance:y,isStereoscopicSideBySide:x});return u||(()=>d._CreateDefaultParsedCamera(X,Q))}le(){return this.getWorldMatrix()}static Parse(q,X){const Q=q.type,y=d.GetConstructorFromName(Q,q.name,X,q.interaxial_distance,q.isStereoscopicSideBySide),x=I.c.Parse(y,q,X);if(void 0!==q.parentId&&(x._waitingParentId=q.parentId),void 0!==q.parentInstanceIndex&&(x._waitingParentInstanceIndex=q.parentInstanceIndex),x.inputs&&(x.inputs.parse(q),x._setupInputs()),q.upVector&&(x.upVector=D.n.Rd(q.upVector)),x.setPosition&&(x.position.Pd(0,0,0),x.setPosition(D.n.Rd(q.position))),q.target&&x.setTarget&&x.setTarget(D.n.Rd(q.target)),q.cameraRigMode){const X=q.interaxial_distance?{interaxialDistance:q.interaxial_distance}:{};x.setCameraRigMode(q.cameraRigMode,X)}if(q.animations){for(let X=0;X<q.animations.length;X++){const Q=q.animations[X],y=(0,L.d)("BABYLON.Animation");y&&x.animations.push(y.Parse(Q))}a.d.ParseAnimationRanges(x,q,X)}return q.autoAnimate&&X.beginAnimation(x,q.autoAnimateFrom,q.autoAnimateTo,q.autoAnimateLoop,q.autoAnimateSpeed||1),void 0!==q.isEnabled&&x.tg(q.isEnabled),x}_calculateHandednessMultiplier(){let q=this.va().useRightHandedSystem?-1:1;return this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(q*=-1),q}}d._CreateDefaultParsedCamera=(q,X)=>{throw(0,f.c)("UniversalCamera")},d.PERSPECTIVE_CAMERA=0,d.ORTHOGRAPHIC_CAMERA=1,d.FOVMODE_VERTICAL_FIXED=0,d.FOVMODE_HORIZONTAL_FIXED=1,d.RIG_MODE_NONE=0,d.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,d.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,d.RIG_MODE_STEREOSCOPIC_INTERLACED=14,d.RIG_MODE_VR=20,d.RIG_MODE_CUSTOM=22,d.ForceAttachControlToAlwaysPreventDefault=!1,(0,y.b)([(0,x.F)("position")],d.prototype,"_position",void 0),(0,y.b)([(0,x.F)("upVector")],d.prototype,"_upVector",void 0),(0,y.b)([(0,x.J)()],d.prototype,"orthoLeft",null),(0,y.b)([(0,x.J)()],d.prototype,"orthoRight",null),(0,y.b)([(0,x.J)()],d.prototype,"orthoBottom",null),(0,y.b)([(0,x.J)()],d.prototype,"orthoTop",null),(0,y.b)([(0,x.J)()],d.prototype,"fov",void 0),(0,y.b)([(0,x.J)()],d.prototype,"projectionPlaneTilt",void 0),(0,y.b)([(0,x.J)()],d.prototype,"_i",void 0),(0,y.b)([(0,x.J)()],d.prototype,"maxZ",void 0),(0,y.b)([(0,x.J)()],d.prototype,"inertia",void 0),(0,y.b)([(0,x.J)()],d.prototype,"mode",null),(0,y.b)([(0,x.J)()],d.prototype,"layerMask",void 0),(0,y.b)([(0,x.J)()],d.prototype,"fovMode",void 0),(0,y.b)([(0,x.J)()],d.prototype,"cameraRigMode",void 0),(0,y.b)([(0,x.J)()],d.prototype,"interaxialDistance",void 0),(0,y.b)([(0,x.J)()],d.prototype,"isStereoscopicSideBySide",void 0)},11869:(q,X,Q)=>{"use strict";Q.d(X,{c:()=>H,d:()=>b});var y=Q(1099),x=Q(1173),u=Q(11265),H={};class b{constructor(q){this.attachedToElement=!1,this.attached={},this.camera=q,this.checkInputs=()=>{}}add(q){const X=q.getSimpleName();this.attached[X]?y.b.Warn("camera input of type "+X+" already exists on camera"):(this.attached[X]=q,q.camera=this.camera,q.checkInputs&&(this.checkInputs=this._addCheckInputs(q.checkInputs.bind(q))),this.attachedToElement&&q.attachControl(this.noPreventDefault))}remove(q){for(const X in this.attached){const Q=this.attached[X];if(Q===q)return Q.Oe(),Q.camera=null,delete this.attached[X],void this.rebuildInputCheck()}}removeByType(q){for(const X in this.attached){const Q=this.attached[X];Q.getClassName()===q&&(Q.Oe(),Q.camera=null,delete this.attached[X],this.rebuildInputCheck())}}_addCheckInputs(q){const X=this.checkInputs;return()=>{X(),q()}}attachInput(q){this.attachedToElement&&q.attachControl(this.noPreventDefault)}attachElement(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){q=!u.c.ForceAttachControlToAlwaysPreventDefault&&q,this.attachedToElement=!0,this.noPreventDefault=q;for(const X in this.attached)this.attached[X].attachControl(q)}}detachElement(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const X in this.attached)this.attached[X].Oe(),q&&(this.attached[X].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const q in this.attached){const X=this.attached[q];X.checkInputs&&(this.checkInputs=this._addCheckInputs(X.checkInputs.bind(X)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(q){const X={};for(const Q in this.attached){const q=this.attached[Q],y=x.c.Serialize(q);X[q.getClassName()]=y}q.inputsmgr=X}parse(q){const X=q.inputsmgr;if(X){this.clear();for(const q in X){const Q=H[q];if(Q){const y=X[q],u=x.c.Parse((()=>new Q),y,null);this.add(u)}}}else for(const Q in this.attached){const X=H[this.attached[Q].getClassName()];if(X){const y=x.c.Parse((()=>new X),q,null);this.remove(this.attached[Q]),this.add(y)}}}}},11859:(q,X,Q)=>{"use strict";Q.d(X,{b:()=>V});var y=Q(975),x=Q(984),u=Q(1002),H=Q(11865),b=Q(11869),D=Q(1295),a=Q(1215);class R{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(q){q=a.f.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((X=>{const Q=X.event;if(!Q.metaKey)if(X.type===D.e.KEYDOWN){if(-1!==this.keysUp.indexOf(Q.keyCode)||-1!==this.keysDown.indexOf(Q.keyCode)||-1!==this.keysLeft.indexOf(Q.keyCode)||-1!==this.keysRight.indexOf(Q.keyCode)||-1!==this.keysUpward.indexOf(Q.keyCode)||-1!==this.keysDownward.indexOf(Q.keyCode)||-1!==this.keysRotateLeft.indexOf(Q.keyCode)||-1!==this.keysRotateRight.indexOf(Q.keyCode)||-1!==this.keysRotateUp.indexOf(Q.keyCode)||-1!==this.keysRotateDown.indexOf(Q.keyCode)){-1===this._keys.indexOf(Q.keyCode)&&this._keys.push(Q.keyCode),q||Q.preventDefault()}}else if(-1!==this.keysUp.indexOf(Q.keyCode)||-1!==this.keysDown.indexOf(Q.keyCode)||-1!==this.keysLeft.indexOf(Q.keyCode)||-1!==this.keysRight.indexOf(Q.keyCode)||-1!==this.keysUpward.indexOf(Q.keyCode)||-1!==this.keysDownward.indexOf(Q.keyCode)||-1!==this.keysRotateLeft.indexOf(Q.keyCode)||-1!==this.keysRotateRight.indexOf(Q.keyCode)||-1!==this.keysRotateUp.indexOf(Q.keyCode)||-1!==this.keysRotateDown.indexOf(Q.keyCode)){const X=this._keys.indexOf(Q.keyCode);X>=0&&this._keys.splice(X,1),q||Q.preventDefault()}})))}Oe(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const q=this.camera;for(let X=0;X<this._keys.length;X++){const Q=this._keys[X],y=q._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(Q)?q._localDirection.Pd(-y,0,0):-1!==this.keysUp.indexOf(Q)?q._localDirection.Pd(0,0,y):-1!==this.keysRight.indexOf(Q)?q._localDirection.Pd(y,0,0):-1!==this.keysDown.indexOf(Q)?q._localDirection.Pd(0,0,-y):-1!==this.keysUpward.indexOf(Q)?q._localDirection.Pd(0,y,0):-1!==this.keysDownward.indexOf(Q)?q._localDirection.Pd(0,-y,0):-1!==this.keysRotateLeft.indexOf(Q)?(q._localDirection.Pd(0,0,0),q.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(Q)?(q._localDirection.Pd(0,0,0),q.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(Q)?(q._localDirection.Pd(0,0,0),q.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(Q)&&(q._localDirection.Pd(0,0,0),q.cameraRotation.x+=this._getLocalRotation()),q.va().useRightHandedSystem&&(q._localDirection.z*=-1),q.getViewMatrix().invertToRef(q._cameraTransformMatrix),u.n.TransformNormalToRef(q._localDirection,q._cameraTransformMatrix,q._transformedDirection),q.cameraDirection.addInPlace(q._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const q=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*q}}(0,y.b)([(0,x.J)()],R.prototype,"keysUp",void 0),(0,y.b)([(0,x.J)()],R.prototype,"keysUpward",void 0),(0,y.b)([(0,x.J)()],R.prototype,"keysDown",void 0),(0,y.b)([(0,x.J)()],R.prototype,"keysDownward",void 0),(0,y.b)([(0,x.J)()],R.prototype,"keysLeft",void 0),(0,y.b)([(0,x.J)()],R.prototype,"keysRight",void 0),(0,y.b)([(0,x.J)()],R.prototype,"rotationSpeed",void 0),(0,y.b)([(0,x.J)()],R.prototype,"keysRotateLeft",void 0),(0,y.b)([(0,x.J)()],R.prototype,"keysRotateRight",void 0),(0,y.b)([(0,x.J)()],R.prototype,"keysRotateUp",void 0),(0,y.b)([(0,x.J)()],R.prototype,"keysRotateDown",void 0),b.c.FreeCameraKeyboardMoveInput=R;var L=Q(998),f=Q(1288);class k{constructor(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=q,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new L.c,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(q){q=a.f.BackCompatCameraNoPreventDefault(arguments);const X=this.camera.getEngine(),Q=X.getInputElement();this._pointerInput||(this._pointerInput=y=>{const x=y.event,u="touch"===x.pointerType;if(!this.touchEnabled&&u)return;if(y.type!==f.c.POINTERMOVE&&-1===this.buttons.indexOf(x.button))return;const H=x.target;if(y.type===f.c.POINTERDOWN){if(u&&-1!==this._activePointerId||!u&&-1!==this._currentActiveButton)return;this._activePointerId=x.pointerId;try{null===H||void 0===H||H.setPointerCapture(x.pointerId)}catch(b){}-1===this._currentActiveButton&&(this._currentActiveButton=x.button),this._previousPosition={x:x.clientX,y:x.clientY},q||(x.preventDefault(),Q&&Q.focus()),X.isPointerLock&&this._onMouseMove&&this._onMouseMove(y.event)}else if(y.type===f.c.POINTERUP){if(u&&this._activePointerId!==x.pointerId||!u&&this._currentActiveButton!==x.button)return;try{null===H||void 0===H||H.releasePointerCapture(x.pointerId)}catch(b){}this._currentActiveButton=-1,this._previousPosition=null,q||x.preventDefault(),this._activePointerId=-1}else if(y.type===f.c.POINTERMOVE&&(this._activePointerId===x.pointerId||!u))if(X.isPointerLock&&this._onMouseMove)this._onMouseMove(y.event);else if(this._previousPosition){const X=this.camera._calculateHandednessMultiplier(),Q=(x.clientX-this._previousPosition.x)*X,y=x.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=Q/this.angularSensibility,this.camera.cameraRotation.x+=y/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:Q,offsetY:y}),this._previousPosition={x:x.clientX,y:x.clientY},q||x.preventDefault()}}),this._onMouseMove=Q=>{if(!X.isPointerLock)return;const y=this.camera._calculateHandednessMultiplier(),x=Q.movementX*y;this.camera.cameraRotation.y+=x/this.angularSensibility;const u=Q.movementY;this.camera.cameraRotation.x+=u/this.angularSensibility,this._previousPosition=null,q||Q.preventDefault()},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,f.c.POINTERDOWN|f.c.POINTERUP|f.c.POINTERMOVE),Q&&(this._contextMenuBind=q=>this.onContextMenu(q),Q.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(q){q.preventDefault()}Oe(){if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const q=this.camera.getEngine().getInputElement();q&&q.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,y.b)([(0,x.J)()],k.prototype,"buttons",void 0),(0,y.b)([(0,x.J)()],k.prototype,"angularSensibility",void 0),b.c.FreeCameraMouseInput=k;var j,I=Q(1297);class d{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new L.c,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(q){q=a.f.BackCompatCameraNoPreventDefault(arguments),this._wheel=X=>{if(X.type!==f.c.POINTERWHEEL)return;const Q=X.event,y=Q.deltaMode===I.d.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*y*Q.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*y*Q.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*y*Q.deltaZ/this._normalize,Q.preventDefault&&(q||Q.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,f.c.POINTERWHEEL)}Oe(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,y.b)([(0,x.J)()],d.prototype,"wheelPrecisionX",void 0),(0,y.b)([(0,x.J)()],d.prototype,"wheelPrecisionY",void 0),(0,y.b)([(0,x.J)()],d.prototype,"wheelPrecisionZ",void 0),function(q){q[q.MoveRelative=0]="MoveRelative",q[q.RotateRelative=1]="RotateRelative",q[q.MoveScene=2]="MoveScene"}(j||(j={}));class e extends d{constructor(){super(...arguments),this._moveRelative=u.n.Zero(),this._rotateRelative=u.n.Zero(),this._moveScene=u.n.Zero(),this._wheelXAction=j.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=j.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(q){null===q&&this._wheelXAction!==j.MoveRelative||(this._wheelXAction=j.MoveRelative,this._wheelXActionCoordinate=q)}get wheelXMoveRelative(){return this._wheelXAction!==j.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(q){null===q&&this._wheelYAction!==j.MoveRelative||(this._wheelYAction=j.MoveRelative,this._wheelYActionCoordinate=q)}get wheelYMoveRelative(){return this._wheelYAction!==j.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(q){null===q&&this._wheelZAction!==j.MoveRelative||(this._wheelZAction=j.MoveRelative,this._wheelZActionCoordinate=q)}get wheelZMoveRelative(){return this._wheelZAction!==j.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(q){null===q&&this._wheelXAction!==j.RotateRelative||(this._wheelXAction=j.RotateRelative,this._wheelXActionCoordinate=q)}get wheelXRotateRelative(){return this._wheelXAction!==j.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(q){null===q&&this._wheelYAction!==j.RotateRelative||(this._wheelYAction=j.RotateRelative,this._wheelYActionCoordinate=q)}get wheelYRotateRelative(){return this._wheelYAction!==j.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(q){null===q&&this._wheelZAction!==j.RotateRelative||(this._wheelZAction=j.RotateRelative,this._wheelZActionCoordinate=q)}get wheelZRotateRelative(){return this._wheelZAction!==j.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(q){null===q&&this._wheelXAction!==j.MoveScene||(this._wheelXAction=j.MoveScene,this._wheelXActionCoordinate=q)}get wheelXMoveScene(){return this._wheelXAction!==j.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(q){null===q&&this._wheelYAction!==j.MoveScene||(this._wheelYAction=j.MoveScene,this._wheelYActionCoordinate=q)}get wheelYMoveScene(){return this._wheelYAction!==j.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(q){null===q&&this._wheelZAction!==j.MoveScene||(this._wheelZAction=j.MoveScene,this._wheelZActionCoordinate=q)}get wheelZMoveScene(){return this._wheelZAction!==j.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.Td(0),this._rotateRelative.Td(0),this._moveScene.Td(0),this._updateCamera(),this.camera.va().useRightHandedSystem&&(this._moveRelative.z*=-1);const q=u.b.Zero();this.camera.getViewMatrix().invertToRef(q);const X=u.n.Zero();u.n.TransformNormalToRef(this._moveRelative,q,X),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(X),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(q,X,Q){if(0===q)return;if(null===X||null===Q)return;let y=null;switch(X){case j.MoveRelative:y=this._moveRelative;break;case j.RotateRelative:y=this._rotateRelative;break;case j.MoveScene:y=this._moveScene}switch(Q){case 0:y.set(q,0,0);break;case 1:y.set(0,q,0);break;case 2:y.set(0,0,q)}}}(0,y.b)([(0,x.J)()],e.prototype,"wheelXMoveRelative",null),(0,y.b)([(0,x.J)()],e.prototype,"wheelYMoveRelative",null),(0,y.b)([(0,x.J)()],e.prototype,"wheelZMoveRelative",null),(0,y.b)([(0,x.J)()],e.prototype,"wheelXRotateRelative",null),(0,y.b)([(0,x.J)()],e.prototype,"wheelYRotateRelative",null),(0,y.b)([(0,x.J)()],e.prototype,"wheelZRotateRelative",null),(0,y.b)([(0,x.J)()],e.prototype,"wheelXMoveScene",null),(0,y.b)([(0,x.J)()],e.prototype,"wheelYMoveScene",null),(0,y.b)([(0,x.J)()],e.prototype,"wheelZMoveScene",null),b.c.FreeCameraMouseWheelInput=e;class i{constructor(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=q,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=a.f.IsSafari()}attachControl(q){q=a.f.BackCompatCameraNoPreventDefault(arguments);let X=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=Q=>{const y=Q.event,x="mouse"===y.pointerType||this._isSafari&&"undefined"===typeof y.pointerType;if(this.allowMouse||!x)if(Q.type===f.c.POINTERDOWN){if(q||y.preventDefault(),this._pointerPressed.push(y.pointerId),1!==this._pointerPressed.length)return;X={x:y.clientX,y:y.clientY}}else if(Q.type===f.c.POINTERUP){q||y.preventDefault();const Q=this._pointerPressed.indexOf(y.pointerId);if(-1===Q)return;if(this._pointerPressed.splice(Q,1),0!=Q)return;X=null,this._offsetX=null,this._offsetY=null}else if(Q.type===f.c.POINTERMOVE){if(q||y.preventDefault(),!X)return;if(0!=this._pointerPressed.indexOf(y.pointerId))return;this._offsetX=y.clientX-X.x,this._offsetY=-(y.clientY-X.y)}}),this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,f.c.POINTERDOWN|f.c.POINTERUP|f.c.POINTERMOVE),this._onLostFocus){const q=this.camera.getEngine().getInputElement();q&&q.addEventListener("blur",this._onLostFocus)}}Oe(){if(this._pointerInput){if(this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const q=this.camera.getEngine().getInputElement();q&&q.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const q=this.camera,X=q._calculateHandednessMultiplier();q.cameraRotation.y=X*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)q.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const X=q._computeLocalCameraSpeed(),Q=new u.n(0,0,0!==this.touchMoveSensibility?X*this._offsetY/this.touchMoveSensibility:0);u.b.RotationYawPitchRollToRef(q.rotation.y,q.rotation.x,0,q._cameraRotationMatrix),q.cameraDirection.addInPlace(u.n.TransformCoordinates(Q,q._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,y.b)([(0,x.J)()],i.prototype,"touchAngularSensibility",void 0),(0,y.b)([(0,x.J)()],i.prototype,"touchMoveSensibility",void 0),b.c.FreeCameraTouchInput=i;class A extends b.d{constructor(q){super(q),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new R),this}addMouse(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new k(q),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new e,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new i),this}clear(){super.clear(),this._mouseInput=null}}var B=Q(1015),w=Q(1105);class V extends H.c{get angularSensibility(){const q=this.inputs.attached.mouse;return q?q.angularSensibility:0}set angularSensibility(q){const X=this.inputs.attached.mouse;X&&(X.angularSensibility=q)}get keysUp(){const q=this.inputs.attached.keyboard;return q?q.keysUp:[]}set keysUp(q){const X=this.inputs.attached.keyboard;X&&(X.keysUp=q)}get keysUpward(){const q=this.inputs.attached.keyboard;return q?q.keysUpward:[]}set keysUpward(q){const X=this.inputs.attached.keyboard;X&&(X.keysUpward=q)}get keysDown(){const q=this.inputs.attached.keyboard;return q?q.keysDown:[]}set keysDown(q){const X=this.inputs.attached.keyboard;X&&(X.keysDown=q)}get keysDownward(){const q=this.inputs.attached.keyboard;return q?q.keysDownward:[]}set keysDownward(q){const X=this.inputs.attached.keyboard;X&&(X.keysDownward=q)}get keysLeft(){const q=this.inputs.attached.keyboard;return q?q.keysLeft:[]}set keysLeft(q){const X=this.inputs.attached.keyboard;X&&(X.keysLeft=q)}get keysRight(){const q=this.inputs.attached.keyboard;return q?q.keysRight:[]}set keysRight(q){const X=this.inputs.attached.keyboard;X&&(X.keysRight=q)}get keysRotateLeft(){const q=this.inputs.attached.keyboard;return q?q.keysRotateLeft:[]}set keysRotateLeft(q){const X=this.inputs.attached.keyboard;X&&(X.keysRotateLeft=q)}get keysRotateRight(){const q=this.inputs.attached.keyboard;return q?q.keysRotateRight:[]}set keysRotateRight(q){const X=this.inputs.attached.keyboard;X&&(X.keysRotateRight=q)}get keysRotateUp(){const q=this.inputs.attached.keyboard;return q?q.keysRotateUp:[]}set keysRotateUp(q){const X=this.inputs.attached.keyboard;X&&(X.keysRotateUp=q)}get keysRotateDown(){const q=this.inputs.attached.keyboard;return q?q.keysRotateDown:[]}set keysRotateDown(q){const X=this.inputs.attached.keyboard;X&&(X.keysRotateDown=q)}constructor(q,X,Q){var y;super(q,X,Q,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),y=this,this.ellipsoid=new u.n(.5,1,.5),this.ellipsoidOffset=new u.n(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=u.n.Zero(),this._diffPosition=u.n.Zero(),this._newPosition=u.n.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(q,X){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;y._newPosition.p(X),y._newPosition.subtractToRef(y._oldPosition,y._diffPosition),y._diffPosition.length()>w.e.CollisionsEpsilon&&(y.position.addToRef(y._diffPosition,y._deferredPositionUpdate),y._deferOnly?y._deferredUpdated=!0:y.position.p(y._deferredPositionUpdate),y.Dk&&Q&&y.Dk(Q))},this.inputs=new A(this),this.inputs.addKeyboard().addMouse()}attachControl(q,X){X=a.f.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(X)}Oe(){this.inputs.detachElement(),this.cameraDirection=new u.n(0,0,0),this.cameraRotation=new u.k(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(q){this._collisionMask=isNaN(q)?-1:q}_collideWithWorld(q){let X;X=this.parent?u.n.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,X.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const Q=this.va().collisionCoordinator;this._collider||(this._collider=Q.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let y=q;this.applyGravity&&(y=q.add(this.va().gravity)),Q.getNewPosition(this._oldPosition,y,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=u.n.Zero(),this._transformedDirection=u.n.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(q){this._needMoveForGravity=q}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.va().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"fb"}}(0,y.b)([(0,x.F)()],V.prototype,"ellipsoid",void 0),(0,y.b)([(0,x.F)()],V.prototype,"ellipsoidOffset",void 0),(0,y.b)([(0,x.J)()],V.prototype,"checkCollisions",void 0),(0,y.b)([(0,x.J)()],V.prototype,"applyGravity",void 0),(0,B.h)("BABYLON.FreeCamera",V)},11865:(q,X,Q)=>{"use strict";Q.d(X,{c:()=>a});var y=Q(975),x=Q(984),u=Q(11265),H=Q(1002),b=Q(1004),D=Q(1497);Q(11270).d.AddNodeConstructor("TargetCamera",((q,X)=>()=>new a(q,H.n.Zero(),X)));class a extends u.c{constructor(q,X,Q){super(q,X,Q,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),this._tmpUpVector=H.n.Zero(),this._tmpTargetVector=H.n.Zero(),this.cameraDirection=new H.n(0,0,0),this.cameraRotation=new H.k(0,0),this.ignoreParentScaling=!1,this.updateUpVectorFromRotation=!1,this._tmpQuaternion=new H.d,this.rotation=new H.n(0,0,0),this.speed=2,this.noRotationConstraint=!1,this.invertRotation=!1,this.inverseRotationSpeed=.2,this.lockedTarget=null,this._currentTarget=H.n.Zero(),this._initialFocalDistance=1,this._viewMatrix=H.b.Zero(),this._camMatrix=H.b.Zero(),this._cameraTransformMatrix=H.b.Zero(),this._cameraRotationMatrix=H.b.Zero(),this._referencePoint=new H.n(0,0,1),this._transformedReferencePoint=H.n.Zero(),this._deferredPositionUpdate=new H.n,this._deferredRotationQuaternionUpdate=new H.d,this._deferredRotationUpdate=new H.n,this._deferredUpdated=!1,this._deferOnly=!1,this._defaultUp=H.n.Up(),this._cachedRotationZ=0,this._cachedQuaternionRotationZ=0}getFrontPosition(q){this.getWorldMatrix();const X=this.getTarget().Sc(this.position);return X.normalize(),X.scaleInPlace(q),this.globalPosition.add(X)}_getLockedTargetPosition(){if(!this.lockedTarget)return null;if(this.lockedTarget.absolutePosition){const q=this.lockedTarget;q.le().getTranslationToRef(q.absolutePosition)}return this.lockedTarget.absolutePosition||this.lockedTarget}storeState(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),super.storeState()}_restoreStateValues(){return!!super._restoreStateValues()&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.Pd(0,0,0),this.cameraRotation.Pd(0,0),!0)}_initCache(){super._initCache(),this._cache.lockedTarget=new H.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new H.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new H.d(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}_updateCache(q){q||super._updateCache();const X=this._getLockedTargetPosition();X?this._cache.lockedTarget?this._cache.lockedTarget.p(X):this._cache.lockedTarget=X.clone():this._cache.lockedTarget=null,this._cache.rotation.p(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.p(this.rotationQuaternion)}_isSynchronizedViewMatrix(){if(!super._isSynchronizedViewMatrix())return!1;const q=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(q):!q)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))}_computeLocalCameraSpeed(){const q=this.getEngine();return this.speed*Math.sqrt(q.getDeltaTime()/(100*q.getFps()))}setTarget(q){this.upVector.normalize(),this._initialFocalDistance=q.Sc(this.position).length(),this.position.z===q.z&&(this.position.z+=b.b),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),H.b.LookAtLHToRef(this.position,q,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);const X=q.Sc(this.position);X.x>=0?this.rotation.y=-Math.atan(X.z/X.x)+Math.PI/2:this.rotation.y=-Math.atan(X.z/X.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&H.d.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)}get target(){return this.getTarget()}set target(q){this.setTarget(q)}getTarget(){return this._currentTarget}_decideIfNeedsToMove(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(H.h.Matrix[0]),H.n.TransformNormalToRef(this.cameraDirection,H.h.Matrix[0],H.h.Od[0]),this._deferredPositionUpdate.addInPlace(H.h.Od[0]),void(this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate));this._deferredPositionUpdate.addInPlace(this.cameraDirection),this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate)}_checkInputs(){const q=this.invertRotation?-this.inverseRotationSpeed:1,X=this._decideIfNeedsToMove(),Q=this.cameraRotation.x||this.cameraRotation.y;if(this._deferredUpdated=!1,this._deferredRotationUpdate.p(this.rotation),this._deferredPositionUpdate.p(this.position),this.rotationQuaternion&&this._deferredRotationQuaternionUpdate.p(this.rotationQuaternion),X&&this._updatePosition(),Q){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this._deferredRotationUpdate),this._deferredRotationUpdate.x+=this.cameraRotation.x*q,this._deferredRotationUpdate.y+=this.cameraRotation.y*q,!this.noRotationConstraint){const q=1.570796;this._deferredRotationUpdate.x>q&&(this._deferredRotationUpdate.x=q),this._deferredRotationUpdate.x<-q&&(this._deferredRotationUpdate.x=-q)}if(this._deferOnly?this._deferredUpdated=!0:this.rotation.p(this._deferredRotationUpdate),this.rotationQuaternion){this._deferredRotationUpdate.lengthSquared()&&(H.d.RotationYawPitchRollToRef(this._deferredRotationUpdate.y,this._deferredRotationUpdate.x,this._deferredRotationUpdate.z,this._deferredRotationQuaternionUpdate),this._deferOnly?this._deferredUpdated=!0:this.rotationQuaternion.p(this._deferredRotationQuaternionUpdate))}}X&&(Math.abs(this.cameraDirection.x)<this.speed*b.b&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*b.b&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*b.b&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),Q&&(Math.abs(this.cameraRotation.x)<this.speed*b.b&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*b.b&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),super._checkInputs()}_updateCameraRotationMatrix(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):H.b.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)}_rotateUpVectorWithCameraRotationMatrix(){return H.n.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this}_getViewMatrix(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),H.n.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?D.c.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(H.d.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),D.c.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix}_computeViewMatrix(q,X,Q){if(this.ignoreParentScaling){if(this.parent){const y=this.parent.getWorldMatrix();H.n.TransformCoordinatesToRef(q,y,this._globalPosition),H.n.TransformCoordinatesToRef(X,y,this._tmpTargetVector),H.n.TransformNormalToRef(Q,y,this._tmpUpVector),this._markSyncedWithParent()}else this._globalPosition.p(q),this._tmpTargetVector.p(X),this._tmpUpVector.p(Q);this.va().useRightHandedSystem?H.b.LookAtRHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix):H.b.LookAtLHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix)}else if(this.va().useRightHandedSystem?H.b.LookAtRHToRef(q,X,Q,this._viewMatrix):H.b.LookAtLHToRef(q,X,Q,this._viewMatrix),this.parent){const q=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(q,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.p(q)}createRigCamera(q,X){if(this.cameraRigMode!==u.c.RIG_MODE_NONE){const X=new a(q,this.position.clone(),this.va());return X.isRigCamera=!0,X.rigParent=this,this.cameraRigMode===u.c.RIG_MODE_VR&&(this.rotationQuaternion||(this.rotationQuaternion=new H.d),X._cameraRigParams={},X.rotationQuaternion=new H.d),X.mode=this.mode,X.orthoLeft=this.orthoLeft,X.orthoRight=this.orthoRight,X.orthoTop=this.orthoTop,X.orthoBottom=this.orthoBottom,X}return null}_updateRigCameras(){const q=this._rigCameras[0],X=this._rigCameras[1];switch(this.le(),this.cameraRigMode){case u.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case u.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case u.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case u.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case u.c.RIG_MODE_STEREOSCOPIC_INTERLACED:{const Q=this.cameraRigMode===u.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,y=this.cameraRigMode===u.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*Q,q),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*y,X);break}case u.c.RIG_MODE_VR:q.rotationQuaternion?(q.rotationQuaternion.p(this.rotationQuaternion),X.rotationQuaternion.p(this.rotationQuaternion)):(q.rotation.p(this.rotation),X.rotation.p(this.rotation)),q.position.p(this.position),X.position.p(this.position)}super._updateRigCameras()}_getRigCamPositionAndTarget(q,X){this.getTarget().subtractToRef(this.position,a._TargetFocalPoint),a._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);const Q=a._TargetFocalPoint.addInPlace(this.position);H.b.TranslationToRef(-Q.x,-Q.y,-Q.z,a._TargetTransformMatrix),a._TargetTransformMatrix.multiplyToRef(H.b.RotationAxis(X.upVector,q),a._RigCamTransformMatrix),H.b.TranslationToRef(Q.x,Q.y,Q.z,a._TargetTransformMatrix),a._RigCamTransformMatrix.multiplyToRef(a._TargetTransformMatrix,a._RigCamTransformMatrix),H.n.TransformCoordinatesToRef(this.position,a._RigCamTransformMatrix,X.position),X.setTarget(Q)}getClassName(){return"TargetCamera"}}a._RigCamTransformMatrix=new H.b,a._TargetTransformMatrix=new H.b,a._TargetFocalPoint=new H.n,(0,y.b)([(0,x.F)()],a.prototype,"rotation",void 0),(0,y.b)([(0,x.J)()],a.prototype,"speed",void 0),(0,y.b)([(0,x.y)("lockedTargetId")],a.prototype,"lockedTarget",void 0)},12267:(q,X,Q)=>{"use strict";Q.d(X,{c:()=>u});var y=Q(1199),x=Q(12272);class u{constructor(q,X){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=Q,this.xi=[],this._maxBlockCapacity=X||64,this._selectionContent=new y.e(1024),this._creationFunc=q}update(q,X,Q){x.d._CreateBlocks(q,X,Q,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}Ve(q){for(let X=0;X<this.Oh.length;X++){this.Oh[X].addEntry(q)}}Xe(q){for(let X=0;X<this.Oh.length;X++){this.Oh[X].removeEntry(q)}}select(q,X){this._selectionContent.reset();for(let Q=0;Q<this.Oh.length;Q++){this.Oh[Q].select(q,this._selectionContent,X)}return X?this._selectionContent.concat(this.xi):this._selectionContent.concatWithNoDuplicate(this.xi),this._selectionContent}intersects(q,X,Q){this._selectionContent.reset();for(let y=0;y<this.Oh.length;y++){this.Oh[y].intersects(q,X,this._selectionContent,Q)}return Q?this._selectionContent.concat(this.xi):this._selectionContent.concatWithNoDuplicate(this.xi),this._selectionContent}intersectsRay(q){this._selectionContent.reset();for(let X=0;X<this.Oh.length;X++){this.Oh[X].intersectsRay(q,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.xi),this._selectionContent}}u.CreationFuncForMeshes=(q,X)=>{const Q=q.getBoundingInfo();!q.isBlocked&&Q.boundingBox.intersectsMinMax(X.Bi,X.Ci)&&X.entries.push(q)},u.CreationFuncForSubMeshes=(q,X)=>{q.getBoundingInfo().boundingBox.intersectsMinMax(X.Bi,X.Ci)&&X.entries.push(q)}},12272:(q,X,Q)=>{"use strict";Q.d(X,{d:()=>u});var y=Q(1002),x=Q(1353);class u{constructor(q,X,Q,y,x,u){this.entries=[],this.Di=new Array,this._capacity=Q,this._depth=y,this._maxDepth=x,this._creationFunc=u,this._minPoint=q,this._maxPoint=X,this.Di.push(q.clone()),this.Di.push(X.clone()),this.Di.push(q.clone()),this.Di[2].x=X.x,this.Di.push(q.clone()),this.Di[3].y=X.y,this.Di.push(q.clone()),this.Di[4].z=X.z,this.Di.push(X.clone()),this.Di[5].z=q.z,this.Di.push(X.clone()),this.Di[6].x=q.x,this.Di.push(X.clone()),this.Di[7].y=q.y}get Ld(){return this._capacity}get Bi(){return this._minPoint}get Ci(){return this._maxPoint}addEntry(q){if(this.Oh)for(let X=0;X<this.Oh.length;X++){this.Oh[X].addEntry(q)}else this._creationFunc(q,this),this.entries.length>this.Ld&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(q){if(this.Oh){for(let X=0;X<this.Oh.length;X++){this.Oh[X].removeEntry(q)}return}const X=this.entries.indexOf(q);X>-1&&this.entries.splice(X,1)}addEntries(q){for(let X=0;X<q.length;X++){const Q=q[X];this.addEntry(Q)}}select(q,X,Q){if(x.e.IsInFrustum(this.Di,q)){if(this.Oh){for(let y=0;y<this.Oh.length;y++){this.Oh[y].select(q,X,Q)}return}Q?X.concat(this.entries):X.concatWithNoDuplicate(this.entries)}}intersects(q,X,Q,y){if(x.e.IntersectsSphere(this._minPoint,this._maxPoint,q,X)){if(this.Oh){for(let x=0;x<this.Oh.length;x++){this.Oh[x].intersects(q,X,Q,y)}return}y?Q.concat(this.entries):Q.concatWithNoDuplicate(this.entries)}}intersectsRay(q,X){if(q.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.Oh){for(let Q=0;Q<this.Oh.length;Q++){this.Oh[Q].intersectsRay(q,X)}return}X.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){u._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(q,X,Q,x,H,b,D,a){D.Oh=new Array;const R=new y.n((X.x-q.x)/2,(X.y-q.y)/2,(X.z-q.z)/2);for(let y=0;y<2;y++)for(let X=0;X<2;X++)for(let L=0;L<2;L++){const f=q.add(R.multiplyByFloats(y,X,L)),k=q.add(R.multiplyByFloats(y+1,X+1,L+1)),j=new u(f,k,x,H+1,b,a);j.addEntries(Q),D.Oh.push(j)}}}},12281:(q,X,Q)=>{"use strict";Q.d(X,{d:()=>R});var y=Q(1206),x=Q(1002),u=Q(11291),H=Q(11425),b=Q(1285),D=Q(12267),a=Q(1028);y.d.prototype.createOrUpdateSelectionOctree=function(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,Q=this._getComponent(b.c.NAME_OCTREE);Q||(Q=new R(this),this.Se(Q)),this.ui||(this.ui=new D.c(D.c.CreationFuncForMeshes,q,X));const y=this.getWorldExtends();return this.ui.update(y.min,y.max,this.meshes),this.ui},Object.defineProperty(y.d.prototype,"selectionOctree",{get:function(){return this.ui},enumerable:!0,configurable:!0}),u.c.prototype.createOrUpdateSubmeshesOctree=function(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const Q=this.va();let y=Q._getComponent(b.c.NAME_OCTREE);y||(y=new R(Q),Q.Se(y)),this._submeshesOctree||(this._submeshesOctree=new D.c(D.c.CreationFuncForSubMeshes,q,X)),this.le(!0);const x=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(x.minimumWorld,x.maximumWorld,this.be),this._submeshesOctree};class R{constructor(q){this.name=b.c.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new H.d(x.n.Zero(),new x.n(1,1,1)),(q=q||a.c.LastCreatedScene)&&(this.Le=q,this.Le.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.Le.getActiveSubMeshCandidates=q=>this.getActiveSubMeshCandidates(q),this.Le.getCollidingSubMeshCandidates=(q,X)=>this.getCollidingSubMeshCandidates(q,X),this.Le.getIntersectingSubMeshCandidates=(q,X)=>this.getIntersectingSubMeshCandidates(q,X))}register(){this.Le.onMeshRemovedObservable.add((q=>{const X=this.Le.selectionOctree;if(void 0!==X&&null!==X){const Q=X.xi.indexOf(q);-1!==Q&&X.xi.splice(Q,1)}})),this.Le.onMeshImportedObservable.add((q=>{const X=this.Le.selectionOctree;void 0!==X&&null!==X&&X.Ve(q)}))}getActiveMeshCandidates(){var q;return(null===(q=this.Le.ui)||void 0===q?void 0:q.select(this.Le.frustumPlanes))||this.Le._getDefaultMeshCandidates()}getActiveSubMeshCandidates(q){if(q._submeshesOctree&&q.useOctreeForRenderingSelection){return q._submeshesOctree.select(this.Le.frustumPlanes)}return this.Le._getDefaultSubMeshCandidates(q)}getIntersectingSubMeshCandidates(q,X){if(q._submeshesOctree&&q.useOctreeForPicking){H.d.TransformToRef(X,q.getWorldMatrix(),this._tempRay);return q._submeshesOctree.intersectsRay(this._tempRay)}return this.Le._getDefaultSubMeshCandidates(q)}getCollidingSubMeshCandidates(q,X){if(q._submeshesOctree&&q.useOctreeForCollisions){const Q=X._velocityWorldLength+Math.max(X._radius.x,X._radius.y,X._radius.z);return q._submeshesOctree.intersects(X._basePointWorld,Q)}return this.Le._getDefaultSubMeshCandidates(q)}rebuild(){}dispose(){}}},11425:(q,X,Q)=>{"use strict";Q.d(X,{d:()=>k});var y=Q(1206),x=Q(11265),u=Q(1004),H=Q(1002),b=Q(1012),D=Q(1339),a=Q(1258),R=Q(1028),L=Q(1301);const f={internalPickerForMesh:void 0};class k{constructor(q,X){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:u.b;this.origin=q,this.direction=X,this.length=Q,this.epsilon=y}clone(){return new k(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(q,X){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const y=k._TmpVector3[0].Pd(q.x-Q,q.y-Q,q.z-Q),x=k._TmpVector3[1].Pd(X.x+Q,X.y+Q,X.z+Q);let u,H,b,D,a=0,R=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<y.x||this.origin.x>x.x)return!1}else if(u=1/this.direction.x,H=(y.x-this.origin.x)*u,b=(x.x-this.origin.x)*u,b===-1/0&&(b=1/0),H>b&&(D=H,H=b,b=D),a=Math.max(H,a),R=Math.min(b,R),a>R)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<y.y||this.origin.y>x.y)return!1}else if(u=1/this.direction.y,H=(y.y-this.origin.y)*u,b=(x.y-this.origin.y)*u,b===-1/0&&(b=1/0),H>b&&(D=H,H=b,b=D),a=Math.max(H,a),R=Math.min(b,R),a>R)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<y.z||this.origin.z>x.z)return!1}else if(u=1/this.direction.z,H=(y.z-this.origin.z)*u,b=(x.z-this.origin.z)*u,b===-1/0&&(b=1/0),H>b&&(D=H,H=b,b=D),a=Math.max(H,a),R=Math.min(b,R),a>R)return!1;return!0}intersectsBox(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(q.minimum,q.maximum,X)}intersectsSphere(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const Q=q.center.x-this.origin.x,y=q.center.y-this.origin.y,x=q.center.z-this.origin.z,u=Q*Q+y*y+x*x,H=q.i+X,b=H*H;if(u<=b)return!0;const D=Q*this.direction.x+y*this.direction.y+x*this.direction.z;if(D<0)return!1;return u-D*D<=b}intersectsTriangle(q,X,Q){const y=k._TmpVector3[0],x=k._TmpVector3[1],u=k._TmpVector3[2],b=k._TmpVector3[3],a=k._TmpVector3[4];X.subtractToRef(q,y),Q.subtractToRef(q,x),H.n.CrossToRef(this.direction,x,u);const R=H.n.Dot(y,u);if(0===R)return null;const L=1/R;this.origin.subtractToRef(q,b);const f=H.n.Dot(b,u)*L;if(f<-this.epsilon||f>1+this.epsilon)return null;H.n.CrossToRef(b,y,a);const j=H.n.Dot(this.direction,a)*L;if(j<-this.epsilon||f+j>1+this.epsilon)return null;const I=H.n.Dot(x,a)*L;return I>this.length?null:new D.d(1-f-j,f,I)}intersectsPlane(q){let X;const Q=H.n.Dot(q.qe,this.direction);if(Math.abs(Q)<9.99999997475243e-7)return null;{const y=H.n.Dot(q.qe,this.origin);return X=(-q.d-y)/Q,X<0?X<-9.99999997475243e-7?null:0:X}}intersectsAxis(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(q){case"y":{const q=(this.origin.y-X)/this.direction.y;return q>0?null:new H.n(this.origin.x+this.direction.x*-q,X,this.origin.z+this.direction.z*-q)}case"x":{const q=(this.origin.x-X)/this.direction.x;return q>0?null:new H.n(X,this.origin.y+this.direction.y*-q,this.origin.z+this.direction.z*-q)}case"z":{const q=(this.origin.z-X)/this.direction.z;return q>0?null:new H.n(this.origin.x+this.direction.x*-q,this.origin.y+this.direction.y*-q,X)}default:return null}}intersectsMesh(q,X,Q){let y=arguments.length>3&&void 0!==arguments[3]&&arguments[3],x=arguments.length>4?arguments[4]:void 0,u=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const b=H.h.Matrix[0];return q.getWorldMatrix().invertToRef(b),this._tmpRay?k.TransformToRef(this,b,this._tmpRay):this._tmpRay=k.Transform(this,b),q.intersects(this._tmpRay,X,Q,y,x,u)}intersectsMeshes(q,X,Q){Q?Q.length=0:Q=[];for(let y=0;y<q.length;y++){const x=this.intersectsMesh(q[y],X);x.hit&&Q.push(x)}return Q.sort(this._comparePickingInfo),Q}_comparePickingInfo(q,X){return q.distance<X.distance?-1:q.distance>X.distance?1:0}intersectionSegment(q,X,Q){const y=this.origin,x=H.h.Od[0],u=H.h.Od[1],b=H.h.Od[2],D=H.h.Od[3];X.subtractToRef(q,x),this.direction.scaleToRef(k._Rayl,b),y.addToRef(b,u),q.subtractToRef(y,D);const a=H.n.Dot(x,x),R=H.n.Dot(x,b),L=H.n.Dot(b,b),f=H.n.Dot(x,D),j=H.n.Dot(b,D),I=a*L-R*R;let d,e,i=I,A=I;I<k._Smallnum?(d=0,i=1,e=j,A=L):(d=R*j-L*f,e=a*j-R*f,d<0?(d=0,e=j,A=L):d>i&&(d=i,e=j+R,A=L)),e<0?(e=0,-f<0?d=0:-f>a?d=i:(d=-f,i=a)):e>A&&(e=A,-f+R<0?d=0:-f+R>a?d=i:(d=-f+R,i=a));const B=Math.abs(d)<k._Smallnum?0:d/i,w=Math.abs(e)<k._Smallnum?0:e/A,V=H.h.Od[4];b.scaleToRef(w,V);const W=H.h.Od[5];x.scaleToRef(B,W),W.addInPlace(D);const v=H.h.Od[6];W.subtractToRef(V,v);return w>0&&w<=this.length&&v.lengthSquared()<Q*Q?W.length():-1}update(q,X,Q,y,x,u,b){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){k._RayDistant||(k._RayDistant=k.Zero()),k._RayDistant.unprojectRayToRef(q,X,Q,y,H.b.IdentityReadOnly,u,b);const D=H.h.Matrix[0];x.invertToRef(D),k.TransformToRef(k._RayDistant,D,this)}else this.unprojectRayToRef(q,X,Q,y,x,u,b);return this}static Zero(){return new k(H.n.Zero(),H.n.Zero())}static CreateNew(q,X,Q,y,x,u,H){return k.Zero().update(q,X,Q,y,x,u,H)}static CreateNewFromTo(q,X){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:H.b.IdentityReadOnly;const y=new k(new H.n(0,0,0),new H.n(0,0,0));return k.CreateFromToToRef(q,X,y,Q)}static CreateFromToToRef(q,X,Q){let y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:H.b.IdentityReadOnly;Q.origin.p(q);const x=X.subtractToRef(q,Q.direction),u=Math.sqrt(x.x*x.x+x.y*x.y+x.z*x.z);return Q.length=u,Q.direction.normalize(),k.TransformToRef(Q,y,Q)}static Transform(q,X){const Q=new k(new H.n(0,0,0),new H.n(0,0,0));return k.TransformToRef(q,X,Q),Q}static TransformToRef(q,X,Q){H.n.TransformCoordinatesToRef(q.origin,X,Q.origin),H.n.TransformNormalToRef(q.direction,X,Q.direction),Q.length=q.length,Q.epsilon=q.epsilon;const y=Q.direction,x=y.length();if(0!==x&&1!==x){const q=1/x;y.x*=q,y.y*=q,y.z*=q,Q.length*=x}return Q}unprojectRayToRef(q,X,Q,y,x,u,b){const D=H.h.Matrix[0];x.multiplyToRef(u,D),D.multiplyToRef(b,D),D.invert();const a=R.c.LastCreatedEngine,L=H.h.Od[0];L.x=q/Q*2-1,L.y=-(X/y*2-1),L.z=null!==a&&void 0!==a&&a.useReverseDepthBuffer?1:null!==a&&void 0!==a&&a.isNDCHalfZRange?0:-1;const f=H.h.Od[1].Pd(L.x,L.y,1-1e-8),k=H.h.Od[2],j=H.h.Od[3];H.n._UnprojectFromInvertedMatrixToRef(L,D,k),H.n._UnprojectFromInvertedMatrixToRef(f,D,j),this.origin.p(k),j.subtractToRef(k,this.direction),this.direction.normalize()}}function j(q,X,Q,y,x){let u=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const H=k.Zero();return I(q,X,Q,y,H,x,u),H}function I(q,X,Q,y,x,u){let b=arguments.length>6&&void 0!==arguments[6]&&arguments[6],D=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const a=q.getEngine();if(!u&&!(u=q.activeCamera))return q;const R=u.viewport,L=a.getRenderHeight(),{x:f,y:k,width:j,height:I}=R.toGlobal(a.getRenderWidth(),L),d=1/a.getHardwareScalingLevel();return X=X*d-f,Q=Q*d-(L-k-I),x.update(X,Q,j,I,y||H.b.IdentityReadOnly,b?H.b.IdentityReadOnly:u.getViewMatrix(),u.getProjectionMatrix(),D),q}function d(q,X,Q,y,x){if(!a.c)return q;const u=q.getEngine();if(!x&&!(x=q.activeCamera))throw new Error("Active camera not set");const b=x.viewport,D=u.getRenderHeight(),{x:R,y:L,width:f,height:k}=b.toGlobal(u.getRenderWidth(),D),j=H.b.Identity(),I=1/u.getHardwareScalingLevel();return X=X*I-R,Q=Q*I-(D-L-k),y.update(X,Q,f,k,j,j,x.getProjectionMatrix()),q}function e(q,X,Q,y,x,u,H,b){const D=X(y,Q.enableDistantPicking),a=Q.intersects(D,x,H,u,y,b);return a&&a.hit?!x&&null!=q&&a.distance>=q.distance?null:a:null}function i(q,X,Q,y,x,u){let b=null;const D=!!(q.activeCameras&&q.activeCameras.length>1&&q.cameraToUseForPointers!==q.activeCamera),R=q.cameraToUseForPointers||q.activeCamera,L=f.internalPickerForMesh||e;for(let a=0;a<q.meshes.length;a++){const f=q.meshes[a];if(Q){if(!Q(f,-1))continue}else if(!f.isEnabled()||!f.isVisible||!f.Ne)continue;const k=D&&f.isWorldMatrixCameraDependent(),j=f.le(k,R);if(f.hasThinInstances&&f.thinInstanceEnablePicking){const q=L(b,X,f,j,!0,!0,u);if(q){if(x)return q;const D=H.h.Matrix[1],a=f.thinInstanceGetWorldMatrices();for(let q=0;q<a.length;q++){if(Q&&!Q(f,q))continue;a[q].multiplyToRef(j,D);const H=L(b,X,f,D,y,x,u,!0);if(H&&(b=H,b.thinInstanceIndex=q,y))return b}}}else{const q=L(b,X,f,j,y,x,u);if(q&&(b=q,y))return b}}return b||new a.c}function A(q,X,Q,y){if(!a.c)return null;const x=[],u=!!(q.activeCameras&&q.activeCameras.length>1&&q.cameraToUseForPointers!==q.activeCamera),b=q.cameraToUseForPointers||q.activeCamera,D=f.internalPickerForMesh||e;for(let a=0;a<q.meshes.length;a++){const R=q.meshes[a];if(Q){if(!Q(R,-1))continue}else if(!R.isEnabled()||!R.isVisible||!R.Ne)continue;const L=u&&R.isWorldMatrixCameraDependent(),f=R.le(L,b);if(R.hasThinInstances&&R.thinInstanceEnablePicking){if(D(null,X,R,f,!0,!0,y)){const q=H.h.Matrix[1],u=R.thinInstanceGetWorldMatrices();for(let H=0;H<u.length;H++){if(Q&&!Q(R,H))continue;u[H].multiplyToRef(f,q);const b=D(null,X,R,q,!1,!1,y,!0);b&&(b.thinInstanceIndex=H,x.push(b))}}}else{const q=D(null,X,R,f,!1,!1,y);q&&x.push(q)}}return x}function B(q,X){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,y=arguments.length>3?arguments[3]:void 0,x=arguments.length>4?arguments[4]:void 0;y||(y=q.getWorldMatrix()),X.length=Q,x?X.origin.p(x):X.origin.p(q.position);const u=H.h.Od[2];u.set(0,0,q._scene.useRightHandedSystem?-1:1);const b=H.h.Od[3];return H.n.TransformNormalToRef(u,y,b),H.n.NormalizeToRef(b,X.direction),X}var w,V;k._TmpVector3=(0,b.d)(6,H.n.Zero),k._RayDistant=k.Zero(),k._Smallnum=1e-8,k._Rayl=1e9,w=y.d,(V=x.c)&&(V.prototype.getForwardRay=function(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,X=arguments.length>1?arguments[1]:void 0,Q=arguments.length>2?arguments[2]:void 0;return B(this,new k(H.n.Zero(),H.n.Zero(),q),q,X,Q)},V.prototype.getForwardRayToRef=function(q){return B(this,q,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),w&&(L.c._IsPickingAvailable=!0,w.prototype.createPickingRay=function(q,X,Q,y){return j(this,q,X,Q,y,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),y.d.prototype.createPickingRayToRef=function(q,X,Q,y,x){return I(this,q,X,Q,y,x,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},y.d.prototype.createPickingRayInCameraSpace=function(q,X,Q){return function(q,X,Q,y){const x=k.Zero();return d(q,X,Q,x,y),x}(this,q,X,Q)},y.d.prototype.createPickingRayInCameraSpaceToRef=function(q,X,Q,y){return d(this,q,X,Q,y)},y.d.prototype.pickWithBoundingInfo=function(q,X,Q,y,x){return function(q,X,Q,y,x,u){if(!a.c)return null;const b=i(q,(y=>(q._tempPickingRay||(q._tempPickingRay=k.Zero()),I(q,X,Q,y,q._tempPickingRay,u||null),q._tempPickingRay)),y,x,!0);return b&&(b.ray=j(q,X,Q,H.b.Identity(),u||null)),b}(this,q,X,Q,y,x)},y.d.prototype.Rc=function(q,X,Q,y,x,u){return function(q,X,Q,y,x,u,b){const D=i(q,((y,x)=>(q._tempPickingRay||(q._tempPickingRay=k.Zero()),I(q,X,Q,y,q._tempPickingRay,u||null,!1,x),q._tempPickingRay)),y,x,!1,b);return D&&(D.ray=j(q,X,Q,H.b.Identity(),u||null)),D}(this,q,X,Q,y,x,u)},y.d.prototype.pickWithRay=function(q,X,Q,y){return function(q,X,Q,y,x){const u=i(q,(Q=>(q._pickWithRayInverseMatrix||(q._pickWithRayInverseMatrix=H.b.Identity()),Q.invertToRef(q._pickWithRayInverseMatrix),q._cachedRayForTransform||(q._cachedRayForTransform=k.Zero()),k.TransformToRef(X,q._pickWithRayInverseMatrix,q._cachedRayForTransform),q._cachedRayForTransform)),Q,y,!1,x);return u&&(u.ray=X),u}(this,q,X,Q,y)},y.d.prototype.multiPick=function(q,X,Q,y,x){return function(q,X,Q,y,x,u){return A(q,(y=>j(q,X,Q,y,x||null)),y,u)}(this,q,X,Q,y,x)},y.d.prototype.multiPickWithRay=function(q,X,Q){return function(q,X,Q,y){return A(q,(Q=>(q._pickWithRayInverseMatrix||(q._pickWithRayInverseMatrix=H.b.Identity()),Q.invertToRef(q._pickWithRayInverseMatrix),q._cachedRayForTransform||(q._cachedRayForTransform=k.Zero()),k.TransformToRef(X,q._pickWithRayInverseMatrix,q._cachedRayForTransform),q._cachedRayForTransform)),Q,y)}(this,q,X,Q)}},12288:(q,X,Q)=>{"use strict";Q(1099);var y=Q(1430);Q(1143),Q(1270),Q(1019),Q(1475),Q(1442);y.e},11149:(q,X,Q)=>{"use strict";Q.r(X),Q.d(X,{SceneInstrumentation:()=>u});var y=Q(1215),x=Q(1303);class u{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(q){q!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=q,q?(this._onBeforeActiveMeshesEvaluationObserver=this.Le.onBeforeActiveMeshesEvaluationObservable.add((()=>{y.f.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.Le.onAfterActiveMeshesEvaluationObservable.add((()=>{y.f.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.Le.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Le.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(q){q!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=q,q?(this._onBeforeRenderTargetsRenderObserver=this.Le.onBeforeRenderTargetsRenderObservable.add((()=>{y.f.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.Le.onAfterRenderTargetsRenderObservable.add((()=>{y.f.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.Le.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Le.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(q){q!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=q,q?(this._onBeforeParticlesRenderingObserver=this.Le.onBeforeParticlesRenderingObservable.add((()=>{y.f.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.Le.onAfterParticlesRenderingObservable.add((()=>{y.f.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.Le.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Le.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(q){q!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=q,this.Le.spriteManagers&&(q?(this._onBeforeSpritesRenderingObserver=this.Le.onBeforeSpritesRenderingObservable.add((()=>{y.f.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.Le.onAfterSpritesRenderingObservable.add((()=>{y.f.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.Le.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.Le.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(q){q!==this._capturePhysicsTime&&this.Le.onBeforePhysicsObservable&&(this._capturePhysicsTime=q,q?(this._onBeforePhysicsObserver=this.Le.onBeforePhysicsObservable.add((()=>{y.f.StartPerformanceCounter("gb"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.Le.onAfterPhysicsObservable.add((()=>{y.f.EndPerformanceCounter("gb"),this._physicsTime.endMonitoring()}))):(this.Le.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.Le.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(q){q!==this._captureAnimationsTime&&(this._captureAnimationsTime=q,q?this._onAfterAnimationsObserver=this.Le.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.Le.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(q){this._captureFrameTime=q}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(q){this._captureInterFrameTime=q}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(q){q!==this._captureRenderTime&&(this._captureRenderTime=q,q?(this._onBeforeDrawPhaseObserver=this.Le.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),y.f.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.Le.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),y.f.EndPerformanceCounter("Main render")}))):(this.Le.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Le.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(q){q!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=q,q?(this._onBeforeCameraRenderObserver=this.Le.onBeforeCameraRenderObservable.add((q=>{this._cameraRenderTime.beginMonitoring(),y.f.StartPerformanceCounter(`Rendering camera ${q.name}`)})),this._onAfterCameraRenderObserver=this.Le.onAfterCameraRenderObservable.add((q=>{this._cameraRenderTime.endMonitoring(!1),y.f.EndPerformanceCounter(`Rendering camera ${q.name}`)}))):(this.Le.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Le.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.Le.getEngine()._drawCalls}constructor(q){this.Le=q,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new x.e,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new x.e,this._captureFrameTime=!1,this._frameTime=new x.e,this._captureRenderTime=!1,this._renderTime=new x.e,this._captureInterFrameTime=!1,this._interFrameTime=new x.e,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new x.e,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new x.e,this._capturePhysicsTime=!1,this._physicsTime=new x.e,this._captureAnimationsTime=!1,this._animationsTime=new x.e,this._captureCameraRenderTime=!1,this._cameraRenderTime=new x.e,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._onBeforeAnimationsObserver=q.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(y.f.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.Le.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=q.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(y.f.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.Xd(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.Xd(),this._captureParticlesRenderTime&&this._particlesRenderTime.Xd(),this._captureSpritesRenderTime&&this._spritesRenderTime.Xd(),this._captureRenderTime&&this._renderTime.Xd(),this._captureCameraRenderTime&&this._cameraRenderTime.Xd()}))}dispose(){this.Le.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.Le.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Le.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.Le.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Le.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.Le.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.Le.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Le.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.Le.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.Le.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.Le.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Le.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.Le.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.Le.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.Le.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.Le.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Le.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.Le=null}}},11934:(q,X,Q)=>{"use strict";Q.d(X,{c:()=>R});var y=Q(975),x=Q(984),u=Q(1002),H=Q(11270),b=Q(11911),D=Q(11939),a=Q(1015);H.d.AddNodeConstructor("Light_Type_1",((q,X)=>()=>new R(q,u.n.Zero(),X)));class R extends D.d{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(q){this._shadowFrustumSize=q,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(q){this._shadowOrthoScale=q,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(q){this._orthoLeft=q}get orthoRight(){return this._orthoRight}set orthoRight(q){this._orthoRight=q}get orthoTop(){return this._orthoTop}set orthoTop(q){this._orthoTop=q}get orthoBottom(){return this._orthoBottom}set orthoBottom(q){this._orthoBottom=q}constructor(q,X,Q){super(q,Q),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=X.scale(-1),this.direction=X}getClassName(){return"hb"}getTypeID(){return b.b.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(q,X,Q){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(q):this._setDefaultAutoExtendShadowProjectionMatrix(q,X,Q)}_setDefaultFixedFrustumShadowProjectionMatrix(q){const X=this.va().activeCamera;X&&u.b.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:X._i,void 0!==this.shadowMaxZ?this.shadowMaxZ:X.maxZ,q,this.va().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(q,X,Q){const y=this.va().activeCamera;if(!y)return;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const q=u.n.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let y=Number.MAX_VALUE,x=-Number.MAX_VALUE;for(let H=0;H<Q.length;H++){const b=Q[H];if(!b)continue;const D=b.getBoundingInfo().boundingBox;for(let Q=0;Q<D.vectorsWorld.length;Q++)u.n.TransformCoordinatesToRef(D.vectorsWorld[Q],X,q),q.x<this._orthoLeft&&(this._orthoLeft=q.x),q.y<this._orthoBottom&&(this._orthoBottom=q.y),q.x>this._orthoRight&&(this._orthoRight=q.x),q.y>this._orthoTop&&(this._orthoTop=q.y),this.autoCalcShadowZBounds&&(q.z<y&&(y=q.z),q.z>x&&(x=q.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=y,this._shadowMaxZ=x)}const x=this._orthoRight-this._orthoLeft,H=this._orthoTop-this._orthoBottom,b=void 0!==this.shadowMinZ?this.shadowMinZ:y._i,D=void 0!==this.shadowMaxZ?this.shadowMaxZ:y.maxZ,a=this.va().getEngine().useReverseDepthBuffer;u.b.OrthoOffCenterLHToRef(this._orthoLeft-x*this.shadowOrthoScale,this._orthoRight+x*this.shadowOrthoScale,this._orthoBottom-H*this.shadowOrthoScale,this._orthoTop+H*this.shadowOrthoScale,a?D:b,a?b:D,q,this.va().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(q,X){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,X),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,X),this)}transferToNodeMaterialEffect(q,X){return this.computeTransformedInformation()?(q.setFloat3(X,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(q.setFloat3(X,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(q){const X=this._scene.getEngine();return!X.useReverseDepthBuffer&&X.isNDCHalfZRange?0:1}getDepthMaxZ(q){const X=this._scene.getEngine();return X.useReverseDepthBuffer&&X.isNDCHalfZRange?0:1}prepareLightSpecificDefines(q,X){q["DIRLIGHT"+X]=!0}}(0,y.b)([(0,x.J)()],R.prototype,"shadowFrustumSize",null),(0,y.b)([(0,x.J)()],R.prototype,"shadowOrthoScale",null),(0,y.b)([(0,x.J)()],R.prototype,"autoUpdateExtends",void 0),(0,y.b)([(0,x.J)()],R.prototype,"autoCalcShadowZBounds",void 0),(0,y.b)([(0,x.J)("orthoLeft")],R.prototype,"_orthoLeft",void 0),(0,y.b)([(0,x.J)("orthoRight")],R.prototype,"_orthoRight",void 0),(0,y.b)([(0,x.J)("orthoTop")],R.prototype,"_orthoTop",void 0),(0,y.b)([(0,x.J)("orthoBottom")],R.prototype,"_orthoBottom",void 0),(0,a.h)("BABYLON.DirectionalLight",R)},12212:(q,X,Q)=>{"use strict";Q.d(X,{c:()=>R});var y=Q(975),x=Q(984),u=Q(1002),H=Q(1182),b=Q(11270),D=Q(11911),a=Q(1015);b.d.AddNodeConstructor("Light_Type_3",((q,X)=>()=>new R(q,u.n.Zero(),X)));class R extends D.b{constructor(q,X,Q){super(q,Q),this.groundColor=new H.b(0,0,0),this.direction=X||u.n.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"mb"}setDirectionToTarget(q){return this.direction=u.n.Normalize(q.Sc(u.n.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(q,X){const Q=u.n.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",Q.x,Q.y,Q.z,0,X),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.dj),X),this}transferToNodeMaterialEffect(q,X){const Q=u.n.Normalize(this.direction);return q.setFloat3(X,Q.x,Q.y,Q.z),this}le(){return this._worldMatrix||(this._worldMatrix=u.b.Identity()),this._worldMatrix}getTypeID(){return D.b.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(q,X){q["HEMILIGHT"+X]=!0}}(0,y.b)([(0,x.o)()],R.prototype,"groundColor",void 0),(0,y.b)([(0,x.F)()],R.prototype,"direction",void 0),(0,a.h)("BABYLON.HemisphericLight",R)},11911:(q,X,Q)=>{"use strict";Q.d(X,{b:()=>f});var y=Q(975),x=Q(984),u=Q(1002),H=Q(1182),b=Q(11270),D=Q(1256),a=Q(1015),R=Q(1317),L=Q(1173);class f extends b.d{get range(){return this._range}set range(q){this._range=q,this._inverseSquaredRange=1/(this.range*this.range)}get intensityMode(){return this._intensityMode}set intensityMode(q){this._intensityMode=q,this._computePhotometricScale()}get i(){return this._radius}set i(q){this._radius=q,this._computePhotometricScale()}get shadowEnabled(){return this._shadowEnabled}set shadowEnabled(q){this._shadowEnabled!==q&&(this._shadowEnabled=q,this._markMeshesAsLightDirty())}get includedOnlyMeshes(){return this._includedOnlyMeshes}set includedOnlyMeshes(q){this._includedOnlyMeshes=q,this._hookArrayForIncludedOnly(q)}get excludedMeshes(){return this._excludedMeshes}set excludedMeshes(q){this._excludedMeshes=q,this._hookArrayForExcluded(q)}get excludeWithLayerMask(){return this._excludeWithLayerMask}set excludeWithLayerMask(q){this._excludeWithLayerMask=q,this._resyncMeshes()}get includeOnlyWithLayerMask(){return this._includeOnlyWithLayerMask}set includeOnlyWithLayerMask(q){this._includeOnlyWithLayerMask=q,this._resyncMeshes()}get lightmapMode(){return this._lightmapMode}set lightmapMode(q){this._lightmapMode!==q&&(this._lightmapMode=q,this._markMeshesAsLightDirty())}getViewMatrix(q){return null}getProjectionMatrix(q,X){return null}constructor(q,X){super(q,X,!1),this.Jh=new H.b(1,1,1),this.Ce=new H.b(1,1,1),this.falloffType=f.FALLOFF_DEFAULT,this.dj=1,this._range=Number.MAX_VALUE,this._inverseSquaredRange=0,this._photometricScale=1,this._intensityMode=f.INTENSITYMODE_AUTOMATIC,this._radius=1e-5,this.renderPriority=0,this._shadowEnabled=!0,this._excludeWithLayerMask=0,this._includeOnlyWithLayerMask=0,this._lightmapMode=0,this._shadowGenerators=null,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,this._isLight=!0,this.va().addLight(this),this._uniformBuffer=new D.c(this.va().getEngine(),void 0,void 0,q),this._buildUniformLayout(),this.includedOnlyMeshes=[],this.excludedMeshes=[],this._resyncMeshes()}transferTexturesToEffect(q,X){return this}_bindLight(q,X,Q,y){let x=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const u=q.toString();let b=!1;if(this._uniformBuffer.bindToEffect(Q,"Light"+u),this._renderId!==X.getRenderId()||this._lastUseSpecular!==y||!this._uniformBuffer.useUbo){this._renderId=X.getRenderId(),this._lastUseSpecular=y;const q=this.getScaledIntensity();this.transferToEffect(Q,u),this.Jh.scaleToRef(q,H.g.Fe[0]),this._uniformBuffer.updateColor4("vLightDiffuse",H.g.Fe[0],this.range,u),y&&(this.Ce.scaleToRef(q,H.g.Fe[1]),this._uniformBuffer.updateColor4("vLightSpecular",H.g.Fe[1],this.i,u)),b=!0}if(this.transferTexturesToEffect(Q,u),X.shadowsEnabled&&this.shadowEnabled&&x){const q=this.getShadowGenerator(X.activeCamera)??this.getShadowGenerator();q&&(q.bindShadowLight(u,Q),b=!0)}b?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()}getClassName(){return"Light"}toString(q){let X="Name: "+this.name;if(X+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(let Q=0;Q<this.animations.length;Q++)X+=", animation[0]: "+this.animations[Q].toString(q);return X}_syncParentEnabledState(){super._syncParentEnabledState(),this.u()||this._resyncMeshes()}tg(q){super.tg(q),this._resyncMeshes()}getShadowGenerator(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===this._shadowGenerators?null:this._shadowGenerators.get(q)??null}getShadowGenerators(){return this._shadowGenerators}getAbsolutePosition(){return u.n.Zero()}canAffectMesh(q){return!q||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(q))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(q))&&((0===this.includeOnlyWithLayerMask||0!==(this.includeOnlyWithLayerMask&q.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&q.layerMask)))}dispose(q){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._shadowGenerators){const q=this._shadowGenerators.values();for(let X=q.next();!0!==X.done;X=q.next()){X.value.dispose()}this._shadowGenerators=null}if(this.va().stopAnimation(this),this._parentContainer){const q=this._parentContainer.lights.indexOf(this);q>-1&&this._parentContainer.lights.splice(q,1),this._parentContainer=null}for(const Q of this.va().meshes)Q._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.va().removeLight(this),super.dispose(q,X)}getTypeID(){return 0}getScaledIntensity(){return this._photometricScale*this.dj}clone(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Q=f.GetConstructorFromName(this.getTypeID(),q,this.va());if(!Q)return null;const y=L.c.Clone(Q,this);return q&&(y.name=q),X&&(y.parent=X),y.tg(this.isEnabled()),this.onClonedObservable.notifyObservers(y),y}serialize(){const q=L.c.Serialize(this);return q.uniqueId=this.uniqueId,q.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(q),this.excludedMeshes.length>0&&(q.excludedMeshesIds=[],this.excludedMeshes.forEach((X=>{q.excludedMeshesIds.push(X.id)}))),this.includedOnlyMeshes.length>0&&(q.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach((X=>{q.includedOnlyMeshesIds.push(X.id)}))),L.c.AppendSerializedAnimations(this,q),q.ranges=this.serializeAnimationRanges(),q.isEnabled=this.isEnabled(),q}static GetConstructorFromName(q,X,Q){const y=b.d.Construct("Light_Type_"+q,X,Q);return y||null}static Parse(q,X){const Q=f.GetConstructorFromName(q.type,q.name,X);if(!Q)return null;const y=L.c.Parse(Q,q,X);if(q.excludedMeshesIds&&(y._excludedMeshesIds=q.excludedMeshesIds),q.includedOnlyMeshesIds&&(y._includedOnlyMeshesIds=q.includedOnlyMeshesIds),void 0!==q.parentId&&(y._waitingParentId=q.parentId),void 0!==q.parentInstanceIndex&&(y._waitingParentInstanceIndex=q.parentInstanceIndex),void 0!==q.falloffType&&(y.falloffType=q.falloffType),void 0!==q.lightmapMode&&(y.lightmapMode=q.lightmapMode),q.animations){for(let X=0;X<q.animations.length;X++){const Q=q.animations[X],x=(0,a.d)("BABYLON.Animation");x&&y.animations.push(x.Parse(Q))}b.d.ParseAnimationRanges(y,q,X)}return q.autoAnimate&&X.beginAnimation(y,q.autoAnimateFrom,q.autoAnimateTo,q.autoAnimateLoop,q.autoAnimateSpeed||1),void 0!==q.isEnabled&&y.tg(q.isEnabled),y}_hookArrayForExcluded(q){var X=this;const Q=q.push;q.push=function(){for(var y=arguments.length,x=new Array(y),u=0;u<y;u++)x[u]=arguments[u];const H=Q.apply(q,x);for(const q of x)q._resyncLightSource(X);return H};const y=q.splice;q.splice=(X,Q)=>{const x=y.apply(q,[X,Q]);for(const q of x)q._resyncLightSource(this);return x};for(const x of q)x._resyncLightSource(this)}_hookArrayForIncludedOnly(q){var X=this;const Q=q.push;q.push=function(){for(var y=arguments.length,x=new Array(y),u=0;u<y;u++)x[u]=arguments[u];const H=Q.apply(q,x);return X._resyncMeshes(),H};const y=q.splice;q.splice=(X,Q)=>{const x=y.apply(q,[X,Q]);return this._resyncMeshes(),x},this._resyncMeshes()}_resyncMeshes(){for(const q of this.va().meshes)q._resyncLightSource(this)}_markMeshesAsLightDirty(){for(const q of this.va().meshes)-1!==q.lightSources.indexOf(this)&&q._markSubMeshesAsLightDirty()}_computePhotometricScale(){this._photometricScale=this._getPhotometricScale(),this.va().resetCachedMaterial()}_getPhotometricScale(){let q=0;const X=this.getTypeID();let Q=this.intensityMode;switch(Q===f.INTENSITYMODE_AUTOMATIC&&(Q=X===f.LIGHTTYPEID_DIRECTIONALLIGHT?f.INTENSITYMODE_ILLUMINANCE:f.INTENSITYMODE_LUMINOUSINTENSITY),X){case f.LIGHTTYPEID_POINTLIGHT:case f.LIGHTTYPEID_SPOTLIGHT:switch(Q){case f.INTENSITYMODE_LUMINOUSPOWER:q=1/(4*Math.PI);break;case f.INTENSITYMODE_LUMINOUSINTENSITY:q=1;break;case f.INTENSITYMODE_LUMINANCE:q=this.i*this.i}break;case f.LIGHTTYPEID_DIRECTIONALLIGHT:switch(Q){case f.INTENSITYMODE_ILLUMINANCE:q=1;break;case f.INTENSITYMODE_LUMINANCE:{let X=this.i;X=Math.max(X,.001);q=2*Math.PI*(1-Math.cos(X));break}}break;case f.LIGHTTYPEID_HEMISPHERICLIGHT:q=1}return q}_reorderLightsInScene(){const q=this.va();0!=this._renderPriority&&(q.requireLightSorting=!0),this.va().sortLightsByPriority()}}f.FALLOFF_DEFAULT=R.e.FALLOFF_DEFAULT,f.FALLOFF_PHYSICAL=R.e.FALLOFF_PHYSICAL,f.FALLOFF_GLTF=R.e.FALLOFF_GLTF,f.FALLOFF_STANDARD=R.e.FALLOFF_STANDARD,f.LIGHTMAP_DEFAULT=R.e.LIGHTMAP_DEFAULT,f.LIGHTMAP_SPECULAR=R.e.LIGHTMAP_SPECULAR,f.LIGHTMAP_SHADOWSONLY=R.e.LIGHTMAP_SHADOWSONLY,f.INTENSITYMODE_AUTOMATIC=R.e.INTENSITYMODE_AUTOMATIC,f.INTENSITYMODE_LUMINOUSPOWER=R.e.INTENSITYMODE_LUMINOUSPOWER,f.INTENSITYMODE_LUMINOUSINTENSITY=R.e.INTENSITYMODE_LUMINOUSINTENSITY,f.INTENSITYMODE_ILLUMINANCE=R.e.INTENSITYMODE_ILLUMINANCE,f.INTENSITYMODE_LUMINANCE=R.e.INTENSITYMODE_LUMINANCE,f.LIGHTTYPEID_POINTLIGHT=R.e.LIGHTTYPEID_POINTLIGHT,f.LIGHTTYPEID_DIRECTIONALLIGHT=R.e.LIGHTTYPEID_DIRECTIONALLIGHT,f.LIGHTTYPEID_SPOTLIGHT=R.e.LIGHTTYPEID_SPOTLIGHT,f.LIGHTTYPEID_HEMISPHERICLIGHT=R.e.LIGHTTYPEID_HEMISPHERICLIGHT,(0,y.b)([(0,x.o)()],f.prototype,"diffuse",void 0),(0,y.b)([(0,x.o)()],f.prototype,"specular",void 0),(0,y.b)([(0,x.J)()],f.prototype,"falloffType",void 0),(0,y.b)([(0,x.J)()],f.prototype,"intensity",void 0),(0,y.b)([(0,x.J)()],f.prototype,"range",null),(0,y.b)([(0,x.J)()],f.prototype,"intensityMode",null),(0,y.b)([(0,x.J)()],f.prototype,"i",null),(0,y.b)([(0,x.J)()],f.prototype,"_renderPriority",void 0),(0,y.b)([(0,x.d)("_reorderLightsInScene")],f.prototype,"renderPriority",void 0),(0,y.b)([(0,x.J)("shadowEnabled")],f.prototype,"_shadowEnabled",void 0),(0,y.b)([(0,x.J)("excludeWithLayerMask")],f.prototype,"_excludeWithLayerMask",void 0),(0,y.b)([(0,x.J)("includeOnlyWithLayerMask")],f.prototype,"_includeOnlyWithLayerMask",void 0),(0,y.b)([(0,x.J)("lightmapMode")],f.prototype,"_lightmapMode",void 0)},11939:(q,X,Q)=>{"use strict";Q.d(X,{d:()=>D});var y=Q(975),x=Q(984),u=Q(1002),H=Q(11911),b=Q(1497);class D extends H.b{constructor(){super(...arguments),this._needProjectionMatrixCompute=!0,this._viewMatrix=u.b.Identity(),this._projectionMatrix=u.b.Identity()}_setPosition(q){this._position=q}get position(){return this._position}set position(q){this._setPosition(q)}_setDirection(q){this._direction=q}get direction(){return this._direction}set direction(q){this._setDirection(q)}get shadowMinZ(){return this._shadowMinZ}set shadowMinZ(q){this._shadowMinZ=q,this.forceProjectionMatrixCompute()}get shadowMaxZ(){return this._shadowMaxZ}set shadowMaxZ(q){this._shadowMaxZ=q,this.forceProjectionMatrixCompute()}computeTransformedInformation(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=u.n.Zero()),u.n.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=u.n.Zero()),u.n.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)}getDepthScale(){return 50}getShadowDirection(q){return this.transformedDirection?this.transformedDirection:this.direction}getAbsolutePosition(){return this.transformedPosition?this.transformedPosition:this.position}setDirectionToTarget(q){return this.direction=u.n.Normalize(q.Sc(this.position)),this.direction}getRotation(){this.direction.normalize();const q=u.n.Cross(this.direction,b.c.Y),X=u.n.Cross(q,this.direction);return u.n.RotationFromAxis(q,X,this.direction)}needCube(){return!1}needProjectionMatrixCompute(){return this._needProjectionMatrixCompute}forceProjectionMatrixCompute(){this._needProjectionMatrixCompute=!0}_initCache(){super._initCache(),this._cache.position=u.n.Zero()}_isSynchronized(){return!!this._cache.position.equals(this.position)}le(q){return!q&&this.isSynchronized()?(this._currentRenderId=this.va().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.p(this.position),this._worldMatrix||(this._worldMatrix=u.b.Identity()),u.b.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)}getDepthMinZ(q){return void 0!==this.shadowMinZ?this.shadowMinZ:q._i}getDepthMaxZ(q){return void 0!==this.shadowMaxZ?this.shadowMaxZ:q.maxZ}setShadowProjectionMatrix(q,X,Q){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(X,Q,q):this._setDefaultShadowProjectionMatrix(q,X,Q),this}_syncParentEnabledState(){super._syncParentEnabledState(),this.parent&&this.parent.getWorldMatrix||(this.transformedPosition=null,this.transformedDirection=null)}getViewMatrix(q){const X=u.h.Od[0];let Q=this.position;this.computeTransformedInformation()&&(Q=this.transformedPosition),u.n.NormalizeToRef(this.getShadowDirection(q),X),1===Math.abs(u.n.Dot(X,u.n.Up()))&&(X.z=1e-13);const y=u.h.Od[1];return Q.addToRef(X,y),u.b.LookAtLHToRef(Q,y,u.n.Up(),this._viewMatrix),this._viewMatrix}getProjectionMatrix(q,X){return this.setShadowProjectionMatrix(this._projectionMatrix,q??this._viewMatrix,X??[]),this._projectionMatrix}}(0,y.b)([(0,x.F)()],D.prototype,"position",null),(0,y.b)([(0,x.F)()],D.prototype,"direction",null),(0,y.b)([(0,x.J)()],D.prototype,"shadowMinZ",null),(0,y.b)([(0,x.J)()],D.prototype,"shadowMaxZ",null)},11418:(q,X,Q)=>{"use strict";Q.d(X,{d:()=>H,f:()=>u,h:()=>b});const y={},x={};function u(q,X){y[q]=X}function H(q,X){x[q]=X}function b(q){return x[q]?x[q]:null}},11364:(q,X,Q)=>{"use strict";Q.d(X,{e:()=>m,g:()=>V});var y,x=Q(1215),u=Q(998),H=Q(1206),b=Q(1028),D=Q(1099),a=Q(11284),R=Q(1055),L=Q(1065),f=Q(1047),k=Q(1105);!function(q){q[q.Clean=0]="Clean",q[q.Stop=1]="Stop",q[q.Sync=2]="Sync",q[q.NoSync=3]="NoSync"}(y||(y={}));const j=new u.c,I={};let d=!1;function e(){return I[".babylon"]}function i(q){const X=I[q];return X||(D.b.Warn("Unable to find a plugin to load "+q+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),e())}function A(q,X,Q){let y="Unable to load from "+(q.rawData?"binary data":q.url);return X?y+=`: ${X}`:Q&&(y+=`: ${Q}`),y}function B(q,X,Q,y,x,u,H,b,D){var a;const L="data:"===(f=q.url).substring(0,5)?f.substring(5):null;var f;if(q.rawData&&!H)throw"When using ArrayBufferView to load data the file extension must be provided.";const d=H?i(H):L?function(q){for(const X in I){const Q=I[X].plugin;if(Q.canDirectLoad&&Q.canDirectLoad(q))return I[X]}return e()}(q.url):function(q){const X=q.indexOf("?");-1!==X&&(q=q.substring(0,X));const Q=q.lastIndexOf(".");return i(q.substring(Q,q.length).toLowerCase())}(q.url);if(!d)throw new Error(`No plugin or fallback for ${H??q.url}`);if(!1===(null===D||void 0===D||null===(a=D[d.plugin.name])||void 0===a?void 0:a.enabled))throw new Error(`The '${d.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(q.rawData&&!d.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(q=>{if(d.plugin.createPlugin){const X=d.plugin.createPlugin(D??{});return X instanceof Promise?(X.then(q).catch((q=>{x("Error instantiating plugin.",q)})),null):(q(X),X)}return q(d.plugin),d.plugin})((D=>{var a;if(!D)throw`The loader plugin corresponding to the '${H}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(j.notifyObservers(D),L&&(D.canDirectLoad&&D.canDirectLoad(q.url)||!(0,R.j)(q.url))){if(D.directLoad){const q=D.directLoad(X,L);q instanceof Promise?q.then((q=>{Q(D,q)})).catch((q=>{x("Error in directLoad of _loadData: "+q,q)})):Q(D,q)}else Q(D,L);return}const f=d.isBinary,I=(q,y)=>{X.u?x("Scene has been disposed"):Q(D,q,y)};let e=null,i=!1;null===(a=D._d)||void 0===a||a.add((()=>{i=!0,e&&(e.abort(),e=null),u()}));const A=()=>{if(i)return;const Q=(q,X)=>{x(null===q||void 0===q?void 0:q.statusText,X)};if(!D.loadFile&&q.rawData)throw"Plugin does not support loading ArrayBufferView.";e=D.loadFile?D.loadFile(X,q.rawData||q.file||q.url,q.rootUrl,I,y,f,Q,b):X._loadFile(q.file||q.url,I,y,!0,f,Q)},B=X.getEngine();let w=B.enableOfflineSupport;if(w){let Q=!1;for(const y of X.disableOfflineSupportExceptionRules)if(y.test(q.url)){Q=!0;break}w=!Q}w&&k.e.OfflineProviderFactory?X.offlineProvider=k.e.OfflineProviderFactory(q.url,A,B.disableManifestCheck):A()}))}function w(q,X){let Q,y,u=null,H=null;if(X)if(X.name)Q=`file:${X.name}`,y=X.name,u=X;else if(ArrayBuffer.isView(X))Q="",y=(0,f.d)(),H=X;else if(X.startsWith("data:"))Q=X,y="";else if(q){const u=X;if("/"===u.substring(0,1))return x.f.Error("Wrong sceneFilename parameter"),null;Q=q+u,y=u}else Q=X,y=x.f.GetFilename(X),q=x.f.GetFolderPath(X);else Q=q,y=x.f.GetFilename(q),q=x.f.GetFolderPath(q);return{url:Q,rootUrl:q,name:y,file:u,rawData:H}}function V(q){if("string"===typeof q.extensions){const X=q.extensions;I[X.toLowerCase()]={plugin:q,isBinary:!1}}else{const X=q.extensions;Object.keys(X).forEach((Q=>{I[Q.toLowerCase()]={plugin:q,isBinary:X[Q].isBinary}}))}}function W(q,X){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:b.c.LastCreatedScene,x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,H=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,R=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",f=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!y)return D.b.Error("No scene available to import mesh to"),null;const k=w(X,Q);if(!k)return null;const j={};y.addPendingData(j);const I=()=>{y.removePendingData(j)},d=(q,X)=>{const Q=A(k,q,X);H?H(y,Q,new L.f(Q,L.e.SceneLoaderError,X)):D.b.Error(Q),I()},e=u?q=>{try{u(q)}catch(X){d("Error in onProgress callback: "+X,X)}}:void 0,i=(q,X,Q,u,H,b,D,a)=>{if(y.importedMeshesFiles.push(k.url),x)try{x(q,X,Q,u,H,b,D,a)}catch(R){d("Error in onSuccess callback: "+R,R)}y.removePendingData(j)};return B(k,y,((X,Q,x)=>{if(X.rewriteRootURL&&(k.rootUrl=X.rewriteRootURL(k.rootUrl,x)),X.importMesh){const x=[],u=[],H=[];if(!X.importMesh(q,y,Q,k.rootUrl,x,u,H,d))return;y.loadingPluginName=X.name,i(x,u,H,[],[],[],[],[])}else{X.importMeshAsync(q,y,Q,k.rootUrl,e,k.name).then((q=>{y.loadingPluginName=X.name,i(q.meshes,q.je,q.skeletons,q.animationGroups,q.transformNodes,q.geometries,q.lights,q.spriteManagers)})).catch((q=>{d(q.message,q)}))}}),e,d,I,a,R,f)}function v(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:b.c.LastCreatedEngine,y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,D=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,R=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",L=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};return Q?U(q,X,new H.d(Q),y,u,D,a,R,L):(x.f.Error("No engine available"),null)}function Z(q,X,Q,y,x,u,H){return new Promise(((b,D)=>{v(q,X,Q,(q=>{b(q)}),y,((q,X,Q)=>{D(Q||new Error(X))}),x,u,H)}))}function U(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:b.c.LastCreatedScene,y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,H=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,R=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",f=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!Q)return D.b.Error("No scene available to append to"),null;const k=w(q,X);if(!k)return null;const j={};Q.addPendingData(j);const I=()=>{Q.removePendingData(j)};a.c.ShowLoadingScreen&&!d&&(d=!0,Q.getEngine().displayLoadingUI(),Q.executeWhenReady((()=>{Q.getEngine().hideLoadingUI(),d=!1})));const e=(q,X)=>{const y=A(k,q,X);u?u(Q,y,new L.f(y,L.e.SceneLoaderError,X)):D.b.Error(y),I()},i=x?q=>{try{x(q)}catch(X){e("Error in onProgress callback",X)}}:void 0,V=()=>{if(y)try{y(Q)}catch(q){e("Error in onSuccess callback",q)}Q.removePendingData(j)};return B(k,Q,((q,X)=>{if(q.load){if(!q.load(Q,X,k.rootUrl,e))return;Q.loadingPluginName=q.name,V()}else{q.loadAsync(Q,X,k.rootUrl,i,k.name).then((()=>{Q.loadingPluginName=q.name,V()})).catch((q=>{e(q.message,q)}))}}),i,e,I,H,R,f)}function O(q,X,Q,y,x,u,H){return new Promise(((b,D)=>{U(q,X,Q,(q=>{b(q)}),y,((q,X,Q)=>{D(Q||new Error(X))}),x,u,H)}))}function g(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:b.c.LastCreatedScene,y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,H=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",R=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!Q)return D.b.Error("No scene available to load asset container to"),null;const f=w(q,X);if(!f)return null;const k={};Q.addPendingData(k);const j=()=>{Q.removePendingData(k)},I=(q,X)=>{const y=A(f,q,X);u?u(Q,y,new L.f(y,L.e.SceneLoaderError,X)):D.b.Error(y),j()},d=x?q=>{try{x(q)}catch(X){I("Error in onProgress callback",X)}}:void 0,e=q=>{if(y)try{y(q)}catch(X){I("Error in onSuccess callback",X)}Q.removePendingData(k)};return B(f,Q,((q,X)=>{if(q.loadAssetContainer){const y=q.loadAssetContainer(Q,X,f.rootUrl,I);if(!y)return;y.populateRootNodes(),Q.loadingPluginName=q.name,e(y)}else if(q.loadAssetContainerAsync){q.loadAssetContainerAsync(Q,X,f.rootUrl,d,f.name).then((X=>{X.populateRootNodes(),Q.loadingPluginName=q.name,e(X)})).catch((q=>{I(q.message,q)}))}else I("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),d,I,j,H,a,R)}function P(q,X,Q,y,x,u,H){return new Promise(((b,D)=>{g(q,X,Q,(q=>{b(q)}),y,((q,X,Q)=>{D(Q||new Error(X))}),x,u,H)}))}function F(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:b.c.LastCreatedScene,y=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,H=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,R=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,L=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,f=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",k=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!Q)return void D.b.Error("No scene available to load animations to");if(y){for(const q of Q.animatables)q.reset();Q.stopAllAnimations(),Q.animationGroups.slice().forEach((q=>{q.dispose()}));Q.getNodes().forEach((q=>{q.animations&&(q.animations=[])}))}else switch(x){case 0:Q.animationGroups.slice().forEach((q=>{q.dispose()}));break;case 1:Q.animationGroups.forEach((q=>{q.stop()}));break;case 2:Q.animationGroups.forEach((q=>{q.reset(),q.restart()}));break;case 3:break;default:return void D.b.Error("Unknown animation group loading mode value '"+x+"'")}const j=Q.animatables.length;g(q,X,Q,(q=>{q.mergeAnimationsTo(Q,Q.animatables.slice(j),u),q.dispose(),Q.onAnimationFileImportedObservable.notifyObservers(Q),H&&H(Q)}),a,R,L,f,k)}function l(q,X,Q,y,x,u,H,b,D,a){return new Promise(((R,L)=>{F(q,X,Q,y,x,u,(q=>{R(q)}),H,((q,X,Q)=>{L(Q||new Error(X))}),b,D,a)}))}class m{static get ForceFullSceneLoadingForIncremental(){return a.c.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(q){a.c.ForceFullSceneLoadingForIncremental=q}static get ShowLoadingScreen(){return a.c.ShowLoadingScreen}static set ShowLoadingScreen(q){a.c.ShowLoadingScreen=q}static get loggingLevel(){return a.c.loggingLevel}static set loggingLevel(q){a.c.loggingLevel=q}static get CleanBoneMatrixWeights(){return a.c.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(q){a.c.CleanBoneMatrixWeights=q}static GetDefaultPlugin(){return e()}static GetPluginForExtension(q){var X;return null===(X=i(q))||void 0===X?void 0:X.plugin}static IsPluginForExtensionAvailable(q){return function(q){return!!I[q]}(q)}static RegisterPlugin(q){V(q)}static ImportMesh(q,X,Q,y,x,u,H,b,D){return W(q,X,Q,y,x,u,H,b,D)}static ImportMeshAsync(q,X,Q,y,x,u,H){return function(q,X,Q,y,x,u,H,b){return new Promise(((D,a)=>{W(q,X,Q,y,((q,X,Q,y,x,u,H,b)=>{D({meshes:q,je:X,skeletons:Q,animationGroups:y,transformNodes:x,geometries:u,lights:H,spriteManagers:b})}),x,((q,X,Q)=>{a(Q||new Error(X))}),u,H,b)}))}(q,X,Q,y,x,u,H)}static Load(q,X,Q,y,x,u,H,b){return v(q,X,Q,y,x,u,H,b)}static LoadAsync(q,X,Q,y,x,u){return Z(q,X,Q,y,x,u)}static Append(q,X,Q,y,x,u,H,b){return U(q,X,Q,y,x,u,H,b)}static AppendAsync(q,X,Q,y,x,u){return O(q,X,Q,y,x,u)}static LoadAssetContainer(q,X,Q,y,x,u,H,b){return g(q,X,Q,y,x,u,H,b)}static LoadAssetContainerAsync(q,X,Q,y,x,u){return P(q,X,Q,y,x,u)}static ImportAnimations(q,X,Q,y,x,u,H,b,D,a,R){F(q,X,Q,y,x,u,H,b,D,a,R)}static ImportAnimationsAsync(q,X,Q,y,x,u,H,b,D,a,R){return l(q,X,Q,y,x,u,b,a,R)}}m.NO_LOGGING=0,m.MINIMAL_LOGGING=1,m.SUMMARY_LOGGING=2,m.DETAILED_LOGGING=3,m.OnPluginActivatedObservable=j},11284:(q,X,Q)=>{"use strict";Q.d(X,{c:()=>y});class y{static get ForceFullSceneLoadingForIncremental(){return y._ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(q){y._ForceFullSceneLoadingForIncremental=q}static get ShowLoadingScreen(){return y._ShowLoadingScreen}static set ShowLoadingScreen(q){y._ShowLoadingScreen=q}static get loggingLevel(){return y._LoggingLevel}static set loggingLevel(q){y._LoggingLevel=q}static get CleanBoneMatrixWeights(){return y._CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(q){y._CleanBoneMatrixWeights=q}}y._ForceFullSceneLoadingForIncremental=!1,y._ShowLoadingScreen=!0,y._CleanBoneMatrixWeights=!1,y._LoggingLevel=0},11899:(q,X,Q)=>{"use strict";Q.d(X,{d:()=>p});var y=Q(975),x=Q(984),u=Q(1099),H=Q(1199),b=Q(11893),D=Q(1206),a=Q(1002),R=Q(1261),L=Q(1384),f=Q(1408);class k extends L.c{constructor(){super(...arguments),this.BRDF_V_HEIGHT_CORRELATED=!1,this.MS_BRDF_ENERGY_CONSERVATION=!1,this.SPHERICAL_HARMONICS=!1,this.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1}}class j extends f.c{_markAllSubMeshesAsMiscDirty(){this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(q){let X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(q,"PBRBRDF",90,new k,X),this._useEnergyConservation=j.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=j.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=j.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=j.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=j.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=j.DEFAULT_USE_SPHERICAL_HARMONICS,this._useSpecularGlossinessInputEnergyConservation=j.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this.useSpecularGlossinessInputEnergyConservation=j.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this._internalMarkAllSubMeshesAsMiscDirty=q._dirtyCallbacks[16],this._enable(!0)}prepareDefines(q){q.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,q.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,q.SPHERICAL_HARMONICS=this._useSphericalHarmonics,q.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation}getClassName(){return"PBRBRDFConfiguration"}}j.DEFAULT_USE_ENERGY_CONSERVATION=!0,j.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,j.DEFAULT_USE_SPHERICAL_HARMONICS=!0,j.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0,(0,y.b)([(0,x.J)(),(0,x.d)("_markAllSubMeshesAsMiscDirty")],j.prototype,"useEnergyConservation",void 0),(0,y.b)([(0,x.J)(),(0,x.d)("_markAllSubMeshesAsMiscDirty")],j.prototype,"useSmithVisibilityHeightCorrelated",void 0),(0,y.b)([(0,x.J)(),(0,x.d)("_markAllSubMeshesAsMiscDirty")],j.prototype,"useSphericalHarmonics",void 0),(0,y.b)([(0,x.J)(),(0,x.d)("_markAllSubMeshesAsMiscDirty")],j.prototype,"useSpecularGlossinessInputEnergyConservation",void 0);var I=Q(1322),d=Q(1182),e=Q(1234),i=Q(1331),A=Q(1390),B=Q(972),w=Q(1397),V=(Q(10237),Q(1400)),W=Q(1374);class v extends L.c{constructor(){super(...arguments),this.CLEARCOAT=!1,this.CLEARCOAT_DEFAULTIOR=!1,this.CLEARCOAT_TEXTURE=!1,this.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this.CLEARCOAT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,this.CLEARCOAT_BUMP=!1,this.CLEARCOAT_BUMPDIRECTUV=0,this.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,this.CLEARCOAT_REMAP_F0=!1,this.CLEARCOAT_TINT=!1,this.CLEARCOAT_TINT_TEXTURE=!1,this.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TINT_GAMMATEXTURE=!1}}class Z extends f.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(q){let X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(q,"PBRClearCoat",100,new v,X),this._isEnabled=!1,this.isEnabled=!1,this.dj=1,this.roughness=0,this._indexOfRefraction=Z._DefaultIndexOfRefraction,this.indexOfRefraction=Z._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._textureRoughness=null,this.textureRoughness=null,this._remapF0OnInterfaceChange=!0,this.remapF0OnInterfaceChange=!0,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=d.b.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=q._dirtyCallbacks[1]}isReadyForSubMesh(q,X,Q){if(!this._isEnabled)return!0;const y=this._material._disableBumpMap;if(q._areTexturesDirty&&X.texturesEnabled){if(this._texture&&w.b.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&w.b.ClearCoatTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1;if(Q.getCaps().standardDerivatives&&this._bumpTexture&&w.b.ClearCoatBumpTextureEnabled&&!y&&!this._bumpTexture.isReady())return!1;if(this._isTintEnabled&&this._tintTexture&&w.b.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(q,X){this._isEnabled?(q.CLEARCOAT=!0,q.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,q.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange,q._areTexturesDirty&&X.texturesEnabled&&(this._texture&&w.b.ClearCoatTextureEnabled?(0,W.U)(this._texture,q,"CLEARCOAT_TEXTURE"):q.CLEARCOAT_TEXTURE=!1,this._textureRoughness&&w.b.ClearCoatTextureEnabled?(0,W.U)(this._textureRoughness,q,"CLEARCOAT_TEXTURE_ROUGHNESS"):q.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this._bumpTexture&&w.b.ClearCoatBumpTextureEnabled?(0,W.U)(this._bumpTexture,q,"CLEARCOAT_BUMP"):q.CLEARCOAT_BUMP=!1,q.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===Z._DefaultIndexOfRefraction,this._isTintEnabled?(q.CLEARCOAT_TINT=!0,this._tintTexture&&w.b.ClearCoatTintTextureEnabled?((0,W.U)(this._tintTexture,q,"CLEARCOAT_TINT_TEXTURE"),q.CLEARCOAT_TINT_GAMMATEXTURE=this._tintTexture.gammaSpace):q.CLEARCOAT_TINT_TEXTURE=!1):(q.CLEARCOAT_TINT=!1,q.CLEARCOAT_TINT_TEXTURE=!1))):(q.CLEARCOAT=!1,q.CLEARCOAT_TEXTURE=!1,q.CLEARCOAT_TEXTURE_ROUGHNESS=!1,q.CLEARCOAT_BUMP=!1,q.CLEARCOAT_TINT=!1,q.CLEARCOAT_TINT_TEXTURE=!1,q.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,q.CLEARCOAT_DEFAULTIOR=!1,q.CLEARCOAT_TEXTUREDIRECTUV=0,q.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,q.CLEARCOAT_BUMPDIRECTUV=0,q.CLEARCOAT_REMAP_F0=!1,q.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,q.CLEARCOAT_TINT_GAMMATEXTURE=!1)}bindForSubMesh(q,X,Q,y){if(!this._isEnabled)return;const x=y.materialDefines,u=this._material.isFrozen,H=this._material._disableBumpMap,b=this._material._invertNormalMapX,D=this._material._invertNormalMapY;if(!q.useUbo||!u||!q.isSync){var a,R,L,f;if((this._texture||this._textureRoughness)&&w.b.ClearCoatTextureEnabled)q.updateFloat4("vClearCoatInfos",(null===(a=this._texture)||void 0===a?void 0:a.coordinatesIndex)??0,(null===(R=this._texture)||void 0===R?void 0:R.level)??0,(null===(L=this._textureRoughness)||void 0===L?void 0:L.coordinatesIndex)??0,(null===(f=this._textureRoughness)||void 0===f?void 0:f.level)??0),this._texture&&(0,W.t)(this._texture,q,"clearCoat"),this._textureRoughness&&!x.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,W.t)(this._textureRoughness,q,"clearCoatRoughness");this._bumpTexture&&Q.getCaps().standardDerivatives&&w.b.ClearCoatTextureEnabled&&!H&&(q.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),(0,W.t)(this._bumpTexture,q,"clearCoatBump"),X._mirroredCameraPosition?q.updateFloat2("vClearCoatTangentSpaceParams",b?1:-1,D?1:-1):q.updateFloat2("vClearCoatTangentSpaceParams",b?-1:1,D?-1:1)),this._tintTexture&&w.b.ClearCoatTintTextureEnabled&&(q.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),(0,W.t)(this._tintTexture,q,"clearCoatTint")),q.updateFloat2("vClearCoatParams",this.dj,this.roughness);const y=1-this._indexOfRefraction,u=1+this._indexOfRefraction,k=Math.pow(-y/u,2),j=1/this._indexOfRefraction;q.updateFloat4("vClearCoatRefractionParams",k,j,y,u),this._isTintEnabled&&(q.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),q.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}X.texturesEnabled&&(this._texture&&w.b.ClearCoatTextureEnabled&&q.setTexture("clearCoatSampler",this._texture),this._textureRoughness&&!x.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&w.b.ClearCoatTextureEnabled&&q.setTexture("clearCoatRoughnessSampler",this._textureRoughness),this._bumpTexture&&Q.getCaps().standardDerivatives&&w.b.ClearCoatBumpTextureEnabled&&!H&&q.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&w.b.ClearCoatTintTextureEnabled&&q.setTexture("clearCoatTintSampler",this._tintTexture))}hasTexture(q){return this._texture===q||(this._textureRoughness===q||(this._bumpTexture===q||this._tintTexture===q))}getActiveTextures(q){this._texture&&q.push(this._texture),this._textureRoughness&&q.push(this._textureRoughness),this._bumpTexture&&q.push(this._bumpTexture),this._tintTexture&&q.push(this._tintTexture)}getAnimatables(q){this._texture&&this._texture.animations&&this._texture.animations.length>0&&q.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&q.push(this._textureRoughness),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&q.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&q.push(this._tintTexture)}dispose(q){var X,Q,y,x;q&&(null===(X=this._texture)||void 0===X||X.dispose(),null===(Q=this._textureRoughness)||void 0===Q||Q.dispose(),null===(y=this._bumpTexture)||void 0===y||y.dispose(),null===(x=this._tintTexture)||void 0===x||x.dispose())}getClassName(){return"PBRClearCoatConfiguration"}addFallbacks(q,X,Q){return q.CLEARCOAT_BUMP&&X.addFallback(Q++,"CLEARCOAT_BUMP"),q.CLEARCOAT_TINT&&X.addFallback(Q++,"CLEARCOAT_TINT"),q.CLEARCOAT&&X.addFallback(Q++,"CLEARCOAT"),Q}getSamplers(q){q.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler")}getUniforms(){return{ubo:[{name:"vClearCoatParams",size:2,type:"vec2"},{name:"vClearCoatRefractionParams",size:4,type:"vec4"},{name:"vClearCoatInfos",size:4,type:"vec4"},{name:"clearCoatMatrix",size:16,type:"mat4"},{name:"clearCoatRoughnessMatrix",size:16,type:"mat4"},{name:"vClearCoatBumpInfos",size:2,type:"vec2"},{name:"vClearCoatTangentSpaceParams",size:2,type:"vec2"},{name:"clearCoatBumpMatrix",size:16,type:"mat4"},{name:"vClearCoatTintParams",size:4,type:"vec4"},{name:"clearCoatColorAtDistance",size:1,type:"float"},{name:"vClearCoatTintInfos",size:2,type:"vec2"},{name:"clearCoatTintMatrix",size:16,type:"mat4"}]}}}Z._DefaultIndexOfRefraction=1.5,(0,y.b)([(0,x.J)(),(0,x.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"isEnabled",void 0),(0,y.b)([(0,x.J)()],Z.prototype,"intensity",void 0),(0,y.b)([(0,x.J)()],Z.prototype,"roughness",void 0),(0,y.b)([(0,x.J)(),(0,x.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"indexOfRefraction",void 0),(0,y.b)([(0,x.B)(),(0,x.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"texture",void 0),(0,y.b)([(0,x.J)(),(0,x.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"useRoughnessFromMainTexture",void 0),(0,y.b)([(0,x.B)(),(0,x.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"textureRoughness",void 0),(0,y.b)([(0,x.J)(),(0,x.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"remapF0OnInterfaceChange",void 0),(0,y.b)([(0,x.B)(),(0,x.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"bumpTexture",void 0),(0,y.b)([(0,x.J)(),(0,x.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"isTintEnabled",void 0),(0,y.b)([(0,x.o)()],Z.prototype,"tintColor",void 0),(0,y.b)([(0,x.J)()],Z.prototype,"tintColorAtDistance",void 0),(0,y.b)([(0,x.J)()],Z.prototype,"tintThickness",void 0),(0,y.b)([(0,x.B)(),(0,x.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"tintTexture",void 0);class U extends L.c{constructor(){super(...arguments),this.IRIDESCENCE=!1,this.IRIDESCENCE_TEXTURE=!1,this.IRIDESCENCE_TEXTUREDIRECTUV=0,this.IRIDESCENCE_THICKNESS_TEXTURE=!1,this.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0}}class O extends f.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(q){let X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(q,"PBRIridescence",110,new U,X),this._isEnabled=!1,this.isEnabled=!1,this.dj=1,this.minimumThickness=O._DefaultMinimumThickness,this.maximumThickness=O._DefaultMaximumThickness,this.indexOfRefraction=O._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._thicknessTexture=null,this.thicknessTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=q._dirtyCallbacks[1]}isReadyForSubMesh(q,X){if(!this._isEnabled)return!0;if(q._areTexturesDirty&&X.texturesEnabled){if(this._texture&&w.b.IridescenceTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._thicknessTexture&&w.b.IridescenceTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(q,X){this._isEnabled?(q.IRIDESCENCE=!0,q._areTexturesDirty&&X.texturesEnabled&&(this._texture&&w.b.IridescenceTextureEnabled?(0,W.U)(this._texture,q,"IRIDESCENCE_TEXTURE"):q.IRIDESCENCE_TEXTURE=!1,this._thicknessTexture&&w.b.IridescenceTextureEnabled?(0,W.U)(this._thicknessTexture,q,"IRIDESCENCE_THICKNESS_TEXTURE"):q.IRIDESCENCE_THICKNESS_TEXTURE=!1)):(q.IRIDESCENCE=!1,q.IRIDESCENCE_TEXTURE=!1,q.IRIDESCENCE_THICKNESS_TEXTURE=!1,q.IRIDESCENCE_TEXTUREDIRECTUV=0,q.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0)}bindForSubMesh(q,X){if(!this._isEnabled)return;const Q=this._material.isFrozen;if(!q.useUbo||!Q||!q.isSync){var y,x,u,H;if((this._texture||this._thicknessTexture)&&w.b.IridescenceTextureEnabled)q.updateFloat4("vIridescenceInfos",(null===(y=this._texture)||void 0===y?void 0:y.coordinatesIndex)??0,(null===(x=this._texture)||void 0===x?void 0:x.level)??0,(null===(u=this._thicknessTexture)||void 0===u?void 0:u.coordinatesIndex)??0,(null===(H=this._thicknessTexture)||void 0===H?void 0:H.level)??0),this._texture&&(0,W.t)(this._texture,q,"iridescence"),this._thicknessTexture&&(0,W.t)(this._thicknessTexture,q,"iridescenceThickness");q.updateFloat4("vIridescenceParams",this.dj,this.indexOfRefraction,this.minimumThickness,this.maximumThickness)}X.texturesEnabled&&(this._texture&&w.b.IridescenceTextureEnabled&&q.setTexture("iridescenceSampler",this._texture),this._thicknessTexture&&w.b.IridescenceTextureEnabled&&q.setTexture("iridescenceThicknessSampler",this._thicknessTexture))}hasTexture(q){return this._texture===q||this._thicknessTexture===q}getActiveTextures(q){this._texture&&q.push(this._texture),this._thicknessTexture&&q.push(this._thicknessTexture)}getAnimatables(q){this._texture&&this._texture.animations&&this._texture.animations.length>0&&q.push(this._texture),this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&q.push(this._thicknessTexture)}dispose(q){var X,Q;q&&(null===(X=this._texture)||void 0===X||X.dispose(),null===(Q=this._thicknessTexture)||void 0===Q||Q.dispose())}getClassName(){return"PBRIridescenceConfiguration"}addFallbacks(q,X,Q){return q.IRIDESCENCE&&X.addFallback(Q++,"IRIDESCENCE"),Q}getSamplers(q){q.push("iridescenceSampler","iridescenceThicknessSampler")}getUniforms(){return{ubo:[{name:"vIridescenceParams",size:4,type:"vec4"},{name:"vIridescenceInfos",size:4,type:"vec4"},{name:"iridescenceMatrix",size:16,type:"mat4"},{name:"iridescenceThicknessMatrix",size:16,type:"mat4"}]}}}O._DefaultMinimumThickness=100,O._DefaultMaximumThickness=400,O._DefaultIndexOfRefraction=1.3,(0,y.b)([(0,x.J)(),(0,x.d)("_markAllSubMeshesAsTexturesDirty")],O.prototype,"isEnabled",void 0),(0,y.b)([(0,x.J)()],O.prototype,"intensity",void 0),(0,y.b)([(0,x.J)()],O.prototype,"minimumThickness",void 0),(0,y.b)([(0,x.J)()],O.prototype,"maximumThickness",void 0),(0,y.b)([(0,x.J)()],O.prototype,"indexOfRefraction",void 0),(0,y.b)([(0,x.B)(),(0,x.d)("_markAllSubMeshesAsTexturesDirty")],O.prototype,"texture",void 0),(0,y.b)([(0,x.B)(),(0,x.d)("_markAllSubMeshesAsTexturesDirty")],O.prototype,"thicknessTexture",void 0);class g extends L.c{constructor(){super(...arguments),this.ANISOTROPIC=!1,this.ANISOTROPIC_TEXTURE=!1,this.ANISOTROPIC_TEXTUREDIRECTUV=0,this.ANISOTROPIC_LEGACY=!1,this.MAINUV1=!1}}class P extends f.c{set angle(q){this.direction.x=Math.cos(q),this.direction.y=Math.sin(q)}get angle(){return Math.atan2(this.direction.y,this.direction.x)}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markAllSubMeshesAsMiscDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(q){let X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(q,"PBRAnisotropic",110,new g,X),this._isEnabled=!1,this.isEnabled=!1,this.dj=1,this.direction=new a.k(1,0),this._texture=null,this.texture=null,this._legacy=!1,this.legacy=!1,this._internalMarkAllSubMeshesAsTexturesDirty=q._dirtyCallbacks[1],this._internalMarkAllSubMeshesAsMiscDirty=q._dirtyCallbacks[16]}isReadyForSubMesh(q,X){return!this._isEnabled||!(q._areTexturesDirty&&X.texturesEnabled&&this._texture&&w.b.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())}prepareDefinesBeforeAttributes(q,X,Q){this._isEnabled?(q.ANISOTROPIC=this._isEnabled,this._isEnabled&&!Q.isVerticesDataPresent(R.c.TangentKind)&&(q._needUVs=!0,q.MAINUV1=!0),q._areTexturesDirty&&X.texturesEnabled&&(this._texture&&w.b.AnisotropicTextureEnabled?(0,W.U)(this._texture,q,"ANISOTROPIC_TEXTURE"):q.ANISOTROPIC_TEXTURE=!1),q._areMiscDirty&&(q.ANISOTROPIC_LEGACY=this._legacy)):(q.ANISOTROPIC=!1,q.ANISOTROPIC_TEXTURE=!1,q.ANISOTROPIC_TEXTUREDIRECTUV=0,q.ANISOTROPIC_LEGACY=!1)}bindForSubMesh(q,X){if(!this._isEnabled)return;const Q=this._material.isFrozen;q.useUbo&&Q&&q.isSync||(this._texture&&w.b.AnisotropicTextureEnabled&&(q.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),(0,W.t)(this._texture,q,"anisotropy")),q.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.dj)),X.texturesEnabled&&this._texture&&w.b.AnisotropicTextureEnabled&&q.setTexture("anisotropySampler",this._texture)}hasTexture(q){return this._texture===q}getActiveTextures(q){this._texture&&q.push(this._texture)}getAnimatables(q){this._texture&&this._texture.animations&&this._texture.animations.length>0&&q.push(this._texture)}dispose(q){q&&this._texture&&this._texture.dispose()}getClassName(){return"PBRAnisotropicConfiguration"}addFallbacks(q,X,Q){return q.ANISOTROPIC&&X.addFallback(Q++,"ANISOTROPIC"),Q}getSamplers(q){q.push("anisotropySampler")}getUniforms(){return{ubo:[{name:"vAnisotropy",size:3,type:"vec3"},{name:"vAnisotropyInfos",size:2,type:"vec2"},{name:"anisotropyMatrix",size:16,type:"mat4"}]}}parse(q,X,Q){super.parse(q,X,Q),void 0===q.legacy&&(this.legacy=!0)}}(0,y.b)([(0,x.J)(),(0,x.d)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"isEnabled",void 0),(0,y.b)([(0,x.J)()],P.prototype,"intensity",void 0),(0,y.b)([(0,x.E)()],P.prototype,"direction",void 0),(0,y.b)([(0,x.B)(),(0,x.d)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"texture",void 0),(0,y.b)([(0,x.J)(),(0,x.d)("_markAllSubMeshesAsMiscDirty")],P.prototype,"legacy",void 0);class F extends L.c{constructor(){super(...arguments),this.SHEEN=!1,this.SHEEN_TEXTURE=!1,this.SHEEN_GAMMATEXTURE=!1,this.SHEEN_TEXTURE_ROUGHNESS=!1,this.SHEEN_TEXTUREDIRECTUV=0,this.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0,this.SHEEN_LINKWITHALBEDO=!1,this.SHEEN_ROUGHNESS=!1,this.SHEEN_ALBEDOSCALING=!1,this.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1}}class l extends f.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(q){let X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(q,"Sheen",120,new F,X),this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.dj=1,this.color=d.b.White(),this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._roughness=null,this.roughness=null,this._textureRoughness=null,this.textureRoughness=null,this._albedoScaling=!1,this.albedoScaling=!1,this._internalMarkAllSubMeshesAsTexturesDirty=q._dirtyCallbacks[1]}isReadyForSubMesh(q,X){if(!this._isEnabled)return!0;if(q._areTexturesDirty&&X.texturesEnabled){if(this._texture&&w.b.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&w.b.SheenTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(q,X){this._isEnabled?(q.SHEEN=!0,q.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,q.SHEEN_ROUGHNESS=null!==this._roughness,q.SHEEN_ALBEDOSCALING=this._albedoScaling,q.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,q._areTexturesDirty&&X.texturesEnabled&&(this._texture&&w.b.SheenTextureEnabled?((0,W.U)(this._texture,q,"SHEEN_TEXTURE"),q.SHEEN_GAMMATEXTURE=this._texture.gammaSpace):q.SHEEN_TEXTURE=!1,this._textureRoughness&&w.b.SheenTextureEnabled?(0,W.U)(this._textureRoughness,q,"SHEEN_TEXTURE_ROUGHNESS"):q.SHEEN_TEXTURE_ROUGHNESS=!1)):(q.SHEEN=!1,q.SHEEN_TEXTURE=!1,q.SHEEN_TEXTURE_ROUGHNESS=!1,q.SHEEN_LINKWITHALBEDO=!1,q.SHEEN_ROUGHNESS=!1,q.SHEEN_ALBEDOSCALING=!1,q.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,q.SHEEN_GAMMATEXTURE=!1,q.SHEEN_TEXTUREDIRECTUV=0,q.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0)}bindForSubMesh(q,X,Q,y){if(!this._isEnabled)return;const x=y.materialDefines,u=this._material.isFrozen;if(!q.useUbo||!u||!q.isSync){var H,b,D,a;if((this._texture||this._textureRoughness)&&w.b.SheenTextureEnabled)q.updateFloat4("vSheenInfos",(null===(H=this._texture)||void 0===H?void 0:H.coordinatesIndex)??0,(null===(b=this._texture)||void 0===b?void 0:b.level)??0,(null===(D=this._textureRoughness)||void 0===D?void 0:D.coordinatesIndex)??0,(null===(a=this._textureRoughness)||void 0===a?void 0:a.level)??0),this._texture&&(0,W.t)(this._texture,q,"sheen"),this._textureRoughness&&!x.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,W.t)(this._textureRoughness,q,"sheenRoughness");q.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.dj),null!==this._roughness&&q.updateFloat("vSheenRoughness",this._roughness)}X.texturesEnabled&&(this._texture&&w.b.SheenTextureEnabled&&q.setTexture("sheenSampler",this._texture),this._textureRoughness&&!x.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&w.b.SheenTextureEnabled&&q.setTexture("sheenRoughnessSampler",this._textureRoughness))}hasTexture(q){return this._texture===q||this._textureRoughness===q}getActiveTextures(q){this._texture&&q.push(this._texture),this._textureRoughness&&q.push(this._textureRoughness)}getAnimatables(q){this._texture&&this._texture.animations&&this._texture.animations.length>0&&q.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&q.push(this._textureRoughness)}dispose(q){var X,Q;q&&(null===(X=this._texture)||void 0===X||X.dispose(),null===(Q=this._textureRoughness)||void 0===Q||Q.dispose())}getClassName(){return"PBRSheenConfiguration"}addFallbacks(q,X,Q){return q.SHEEN&&X.addFallback(Q++,"SHEEN"),Q}getSamplers(q){q.push("sheenSampler","sheenRoughnessSampler")}getUniforms(){return{ubo:[{name:"vSheenColor",size:4,type:"vec4"},{name:"vSheenRoughness",size:1,type:"float"},{name:"vSheenInfos",size:4,type:"vec4"},{name:"sheenMatrix",size:16,type:"mat4"},{name:"sheenRoughnessMatrix",size:16,type:"mat4"}]}}}(0,y.b)([(0,x.J)(),(0,x.d)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"isEnabled",void 0),(0,y.b)([(0,x.J)(),(0,x.d)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"linkSheenWithAlbedo",void 0),(0,y.b)([(0,x.J)()],l.prototype,"intensity",void 0),(0,y.b)([(0,x.o)()],l.prototype,"color",void 0),(0,y.b)([(0,x.B)(),(0,x.d)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"texture",void 0),(0,y.b)([(0,x.J)(),(0,x.d)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"useRoughnessFromMainTexture",void 0),(0,y.b)([(0,x.J)(),(0,x.d)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"roughness",void 0),(0,y.b)([(0,x.B)(),(0,x.d)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"textureRoughness",void 0),(0,y.b)([(0,x.J)(),(0,x.d)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"albedoScaling",void 0);class m extends L.c{constructor(){super(...arguments),this.SUBSURFACE=!1,this.SS_REFRACTION=!1,this.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_TRANSLUCENCY=!1,this.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_SCATTERING=!1,this.SS_DISPERSION=!1,this.SS_THICKNESSANDMASK_TEXTURE=!1,this.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,this.SS_HAS_THICKNESS=!1,this.SS_REFRACTIONINTENSITY_TEXTURE=!1,this.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,this.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,this.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,this.SS_REFRACTIONMAP_3D=!1,this.SS_REFRACTIONMAP_OPPOSITEZ=!1,this.SS_LODINREFRACTIONALPHA=!1,this.SS_GAMMAREFRACTION=!1,this.SS_RGBDREFRACTION=!1,this.SS_LINEARSPECULARREFRACTION=!1,this.SS_LINKREFRACTIONTOTRANSPARENCY=!1,this.SS_ALBEDOFORREFRACTIONTINT=!1,this.SS_ALBEDOFORTRANSLUCENCYTINT=!1,this.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.SS_USE_THICKNESS_AS_DEPTH=!1,this.SS_USE_GLTF_TEXTURES=!1}}class M extends f.c{get scatteringDiffusionProfile(){return this._scene.subSurfaceConfiguration?this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex]:null}set scatteringDiffusionProfile(q){this._scene.enableSubSurfaceForPrePass()&&q&&(this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(q))}get volumeIndexOfRefraction(){return this._volumeIndexOfRefraction>=1?this._volumeIndexOfRefraction:this._indexOfRefraction}set volumeIndexOfRefraction(q){this._volumeIndexOfRefraction=q>=1?q:-1}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markScenePrePassDirty(){this._internalMarkAllSubMeshesAsTexturesDirty(),this._internalMarkScenePrePassDirty()}isCompatible(){return!0}constructor(q){let X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(q,"PBRSubSurface",130,new m,X),this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isDispersionEnabled=!1,this.isDispersionEnabled=!1,this._isScatteringEnabled=!1,this.isScatteringEnabled=!1,this._scatteringDiffusionProfileIndex=0,this.refractionIntensity=1,this.translucencyIntensity=1,this.useAlbedoToTintRefraction=!1,this.useAlbedoToTintTranslucency=!1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1.5,this.indexOfRefraction=1.5,this._volumeIndexOfRefraction=-1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.useThicknessAsDepth=!1,this.tintColor=d.b.White(),this.tintColorAtDistance=1,this.dispersion=0,this.diffusionDistance=d.b.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._refractionIntensityTexture=null,this.refractionIntensityTexture=null,this._translucencyIntensityTexture=null,this.translucencyIntensityTexture=null,this.translucencyColor=null,this._translucencyColorTexture=null,this.translucencyColorTexture=null,this._useGltfStyleTextures=!0,this.useGltfStyleTextures=!0,this._scene=q.va(),this.registerForExtraEvents=!0,this._internalMarkAllSubMeshesAsTexturesDirty=q._dirtyCallbacks[1],this._internalMarkScenePrePassDirty=q._dirtyCallbacks[32]}isReadyForSubMesh(q,X){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return!0;if(q._areTexturesDirty&&X.texturesEnabled){if(this._thicknessTexture&&w.b.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;if(this._translucencyColorTexture&&w.b.TranslucencyColorTextureEnabled&&!this._translucencyColorTexture.isReadyOrNotBlocking())return!1;if(this._translucencyIntensityTexture&&w.b.TranslucencyIntensityTextureEnabled&&!this._translucencyIntensityTexture.isReadyOrNotBlocking())return!1;const q=this._getRefractionTexture(X);if(q&&w.b.RefractionTextureEnabled&&!q.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(q,X){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return q.SUBSURFACE=!1,q.SS_DISPERSION=!1,q.SS_TRANSLUCENCY=!1,q.SS_SCATTERING=!1,q.SS_REFRACTION=!1,q.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,q.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,q.SS_THICKNESSANDMASK_TEXTURE=!1,q.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,q.SS_HAS_THICKNESS=!1,q.SS_REFRACTIONINTENSITY_TEXTURE=!1,q.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,q.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,q.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,q.SS_REFRACTIONMAP_3D=!1,q.SS_REFRACTIONMAP_OPPOSITEZ=!1,q.SS_LODINREFRACTIONALPHA=!1,q.SS_GAMMAREFRACTION=!1,q.SS_RGBDREFRACTION=!1,q.SS_LINEARSPECULARREFRACTION=!1,q.SS_LINKREFRACTIONTOTRANSPARENCY=!1,q.SS_ALBEDOFORREFRACTIONTINT=!1,q.SS_ALBEDOFORTRANSLUCENCYTINT=!1,q.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,q.SS_USE_THICKNESS_AS_DEPTH=!1,q.SS_USE_GLTF_TEXTURES=!1,q.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,void(q.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0);if(q._areTexturesDirty){if(q.SUBSURFACE=!0,q.SS_DISPERSION=this._isDispersionEnabled,q.SS_TRANSLUCENCY=this._isTranslucencyEnabled,q.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,q.SS_SCATTERING=this._isScatteringEnabled,q.SS_THICKNESSANDMASK_TEXTURE=!1,q.SS_REFRACTIONINTENSITY_TEXTURE=!1,q.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,q.SS_HAS_THICKNESS=!1,q.SS_USE_GLTF_TEXTURES=!1,q.SS_REFRACTION=!1,q.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,q.SS_REFRACTIONMAP_3D=!1,q.SS_GAMMAREFRACTION=!1,q.SS_RGBDREFRACTION=!1,q.SS_LINEARSPECULARREFRACTION=!1,q.SS_REFRACTIONMAP_OPPOSITEZ=!1,q.SS_LODINREFRACTIONALPHA=!1,q.SS_LINKREFRACTIONTOTRANSPARENCY=!1,q.SS_ALBEDOFORREFRACTIONTINT=!1,q.SS_ALBEDOFORTRANSLUCENCYTINT=!1,q.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,q.SS_USE_THICKNESS_AS_DEPTH=!1,q.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,q._areTexturesDirty&&X.texturesEnabled&&(this._thicknessTexture&&w.b.ThicknessTextureEnabled&&(0,W.U)(this._thicknessTexture,q,"SS_THICKNESSANDMASK_TEXTURE"),this._refractionIntensityTexture&&w.b.RefractionIntensityTextureEnabled&&(0,W.U)(this._refractionIntensityTexture,q,"SS_REFRACTIONINTENSITY_TEXTURE"),this._translucencyIntensityTexture&&w.b.TranslucencyIntensityTextureEnabled&&(0,W.U)(this._translucencyIntensityTexture,q,"SS_TRANSLUCENCYINTENSITY_TEXTURE"),this._translucencyColorTexture&&w.b.TranslucencyColorTextureEnabled&&(0,W.U)(this._translucencyColorTexture,q,"SS_TRANSLUCENCYCOLOR_TEXTURE")),q.SS_HAS_THICKNESS=this.maximumThickness-this.minimumThickness!==0,q.SS_USE_GLTF_TEXTURES=this._useGltfStyleTextures,q.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._refractionIntensityTexture,q.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._translucencyIntensityTexture,this._isRefractionEnabled&&X.texturesEnabled){const Q=this._getRefractionTexture(X);Q&&w.b.RefractionTextureEnabled&&(q.SS_REFRACTION=!0,q.SS_REFRACTIONMAP_3D=Q.isCube,q.SS_GAMMAREFRACTION=Q.gammaSpace,q.SS_RGBDREFRACTION=Q.isRGBD,q.SS_LINEARSPECULARREFRACTION=Q.linearSpecularLOD,q.SS_REFRACTIONMAP_OPPOSITEZ=this._scene.useRightHandedSystem&&Q.isCube?!Q.invertZ:Q.invertZ,q.SS_LODINREFRACTIONALPHA=Q.lodLevelInAlpha,q.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency,q.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction,q.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=Q.isCube&&Q.boundingBoxSize,q.SS_USE_THICKNESS_AS_DEPTH=this.useThicknessAsDepth)}this._isTranslucencyEnabled&&(q.SS_ALBEDOFORTRANSLUCENCYTINT=this.useAlbedoToTintTranslucency)}}hardBindForSubMesh(q,X,Q,y){if(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled)if(0===this.maximumThickness&&0===this.minimumThickness)q.updateFloat2("vThicknessParam",0,0);else{y.getRenderingMesh().getWorldMatrix().decompose(a.h.Od[0]);const X=Math.max(Math.abs(a.h.Od[0].x),Math.abs(a.h.Od[0].y),Math.abs(a.h.Od[0].z));q.updateFloat2("vThicknessParam",this.minimumThickness*X,(this.maximumThickness-this.minimumThickness)*X)}}bindForSubMesh(q,X,Q,y){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return;const x=y.materialDefines,u=this._material.isFrozen,H=this._material.realTimeFiltering,b=x.LODBASEDMICROSFURACE,D=this._getRefractionTexture(X);if(!q.useUbo||!u||!q.isSync){if(this._thicknessTexture&&w.b.ThicknessTextureEnabled&&(q.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),(0,W.t)(this._thicknessTexture,q,"thickness")),this._refractionIntensityTexture&&w.b.RefractionIntensityTextureEnabled&&x.SS_REFRACTIONINTENSITY_TEXTURE&&(q.updateFloat2("vRefractionIntensityInfos",this._refractionIntensityTexture.coordinatesIndex,this._refractionIntensityTexture.level),(0,W.t)(this._refractionIntensityTexture,q,"refractionIntensity")),this._translucencyColorTexture&&w.b.TranslucencyColorTextureEnabled&&x.SS_TRANSLUCENCYCOLOR_TEXTURE&&(q.updateFloat2("vTranslucencyColorInfos",this._translucencyColorTexture.coordinatesIndex,this._translucencyColorTexture.level),(0,W.t)(this._translucencyColorTexture,q,"translucencyColor")),this._translucencyIntensityTexture&&w.b.TranslucencyIntensityTextureEnabled&&x.SS_TRANSLUCENCYINTENSITY_TEXTURE&&(q.updateFloat2("vTranslucencyIntensityInfos",this._translucencyIntensityTexture.coordinatesIndex,this._translucencyIntensityTexture.level),(0,W.t)(this._translucencyIntensityTexture,q,"translucencyIntensity")),D&&w.b.RefractionTextureEnabled){q.Ae("refractionMatrix",D.getRefractionTextureMatrix());let X=1;D.isCube||D.depth&&(X=D.depth);const Q=D.getSize().width,y=this.volumeIndexOfRefraction;if(q.updateFloat4("vRefractionInfos",D.level,1/y,X,this._invertRefractionY?-1:1),q.updateFloat4("vRefractionMicrosurfaceInfos",Q,D.lodGenerationScale,D.lodGenerationOffset,1/this.indexOfRefraction),H&&q.updateFloat2("vRefractionFilteringInfo",Q,Math.log2(Q)),D.boundingBoxSize){const X=D;q.updateVector3("vRefractionPosition",X.boundingBoxPosition),q.updateVector3("vRefractionSize",X.boundingBoxSize)}}this._isScatteringEnabled&&q.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex),q.updateColor3("vDiffusionDistance",this.diffusionDistance),q.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintColorAtDistance)),q.updateColor4("vTranslucencyColor",this.translucencyColor??this.tintColor,0),q.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0),q.updateFloat("dispersion",this.dispersion)}X.texturesEnabled&&(this._thicknessTexture&&w.b.ThicknessTextureEnabled&&q.setTexture("thicknessSampler",this._thicknessTexture),this._refractionIntensityTexture&&w.b.RefractionIntensityTextureEnabled&&x.SS_REFRACTIONINTENSITY_TEXTURE&&q.setTexture("refractionIntensitySampler",this._refractionIntensityTexture),this._translucencyIntensityTexture&&w.b.TranslucencyIntensityTextureEnabled&&x.SS_TRANSLUCENCYINTENSITY_TEXTURE&&q.setTexture("translucencyIntensitySampler",this._translucencyIntensityTexture),this._translucencyColorTexture&&w.b.TranslucencyColorTextureEnabled&&x.SS_TRANSLUCENCYCOLOR_TEXTURE&&q.setTexture("translucencyColorSampler",this._translucencyColorTexture),D&&w.b.RefractionTextureEnabled&&(b?q.setTexture("refractionSampler",D):(q.setTexture("refractionSampler",D._lodTextureMid||D),q.setTexture("refractionSamplerLow",D._lodTextureLow||D),q.setTexture("refractionSamplerHigh",D._lodTextureHigh||D))))}_getRefractionTexture(q){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?q.environmentTexture:null}get disableAlphaBlending(){return this._isRefractionEnabled&&this._linkRefractionWithTransparency}fillRenderTargetTextures(q){w.b.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&q.push(this._refractionTexture)}hasTexture(q){return this._thicknessTexture===q||(this._refractionTexture===q||(this._refractionIntensityTexture===q||(this._translucencyIntensityTexture===q||this._translucencyColorTexture===q)))}hasRenderTargetTextures(){return!!(w.b.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)}getActiveTextures(q){this._thicknessTexture&&q.push(this._thicknessTexture),this._refractionTexture&&q.push(this._refractionTexture),this._translucencyColorTexture&&q.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&q.push(this._translucencyIntensityTexture)}getAnimatables(q){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&q.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&q.push(this._refractionTexture),this._translucencyColorTexture&&this._translucencyColorTexture.animations&&this._translucencyColorTexture.animations.length>0&&q.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.animations&&this._translucencyIntensityTexture.animations.length>0&&q.push(this._translucencyIntensityTexture)}dispose(q){q&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose(),this._translucencyColorTexture&&this._translucencyColorTexture.dispose(),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.dispose())}getClassName(){return"PBRSubSurfaceConfiguration"}addFallbacks(q,X,Q){return q.SS_SCATTERING&&X.addFallback(Q++,"SS_SCATTERING"),q.SS_TRANSLUCENCY&&X.addFallback(Q++,"SS_TRANSLUCENCY"),Q}getSamplers(q){q.push("thicknessSampler","refractionIntensitySampler","translucencyIntensitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh","translucencyColorSampler")}getUniforms(){return{ubo:[{name:"vRefractionMicrosurfaceInfos",size:4,type:"vec4"},{name:"vRefractionFilteringInfo",size:2,type:"vec2"},{name:"vTranslucencyIntensityInfos",size:2,type:"vec2"},{name:"vRefractionInfos",size:4,type:"vec4"},{name:"refractionMatrix",size:16,type:"mat4"},{name:"vThicknessInfos",size:2,type:"vec2"},{name:"vRefractionIntensityInfos",size:2,type:"vec2"},{name:"thicknessMatrix",size:16,type:"mat4"},{name:"refractionIntensityMatrix",size:16,type:"mat4"},{name:"translucencyIntensityMatrix",size:16,type:"mat4"},{name:"vThicknessParam",size:2,type:"vec2"},{name:"vDiffusionDistance",size:3,type:"vec3"},{name:"vTintColor",size:4,type:"vec4"},{name:"vSubSurfaceIntensity",size:3,type:"vec3"},{name:"vRefractionPosition",size:3,type:"vec3"},{name:"vRefractionSize",size:3,type:"vec3"},{name:"scatteringDiffusionProfile",size:1,type:"float"},{name:"dispersion",size:1,type:"float"},{name:"vTranslucencyColor",size:4,type:"vec4"},{name:"vTranslucencyColorInfos",size:2,type:"vec2"},{name:"translucencyColorMatrix",size:16,type:"mat4"}]}}}(0,y.b)([(0,x.J)(),(0,x.d)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"isRefractionEnabled",void 0),(0,y.b)([(0,x.J)(),(0,x.d)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"isTranslucencyEnabled",void 0),(0,y.b)([(0,x.J)(),(0,x.d)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"isDispersionEnabled",void 0),(0,y.b)([(0,x.J)(),(0,x.d)("_markScenePrePassDirty")],M.prototype,"isScatteringEnabled",void 0),(0,y.b)([(0,x.J)()],M.prototype,"_scatteringDiffusionProfileIndex",void 0),(0,y.b)([(0,x.J)()],M.prototype,"refractionIntensity",void 0),(0,y.b)([(0,x.J)()],M.prototype,"translucencyIntensity",void 0),(0,y.b)([(0,x.J)()],M.prototype,"useAlbedoToTintRefraction",void 0),(0,y.b)([(0,x.J)()],M.prototype,"useAlbedoToTintTranslucency",void 0),(0,y.b)([(0,x.B)(),(0,x.d)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"thicknessTexture",void 0),(0,y.b)([(0,x.B)(),(0,x.d)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"refractionTexture",void 0),(0,y.b)([(0,x.J)(),(0,x.d)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"indexOfRefraction",void 0),(0,y.b)([(0,x.J)()],M.prototype,"_volumeIndexOfRefraction",void 0),(0,y.b)([(0,x.d)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"volumeIndexOfRefraction",null),(0,y.b)([(0,x.J)(),(0,x.d)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"invertRefractionY",void 0),(0,y.b)([(0,x.J)(),(0,x.d)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"linkRefractionWithTransparency",void 0),(0,y.b)([(0,x.J)()],M.prototype,"minimumThickness",void 0),(0,y.b)([(0,x.J)()],M.prototype,"maximumThickness",void 0),(0,y.b)([(0,x.J)()],M.prototype,"useThicknessAsDepth",void 0),(0,y.b)([(0,x.o)()],M.prototype,"tintColor",void 0),(0,y.b)([(0,x.J)()],M.prototype,"tintColorAtDistance",void 0),(0,y.b)([(0,x.J)()],M.prototype,"dispersion",void 0),(0,y.b)([(0,x.o)()],M.prototype,"diffusionDistance",void 0),(0,y.b)([(0,x.J)(),(0,x.d)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useMaskFromThicknessTexture",void 0),(0,y.b)([(0,x.B)(),(0,x.d)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"refractionIntensityTexture",void 0),(0,y.b)([(0,x.B)(),(0,x.d)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"translucencyIntensityTexture",void 0),(0,y.b)([(0,x.o)()],M.prototype,"translucencyColor",void 0),(0,y.b)([(0,x.B)(),(0,x.d)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"translucencyColorTexture",void 0),(0,y.b)([(0,x.J)(),(0,x.d)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useGltfStyleTextures",void 0);var o=Q(1406),Y=Q(1378),N=Q(1417);const S={effect:null,subMesh:null};class c extends L.c{constructor(q){super(q),this.PBR=!0,this.NUM_SAMPLES="0",this.REALTIME_FILTERING=!1,this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.ALBEDO=!1,this.GAMMAALBEDO=!1,this.ALBEDODIRECTUV=0,this.VERTEXCOLOR=!1,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.AMBIENTINGRAYSCALE=!1,this.OPACITY=!1,this.VERTEXALPHA=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHABLEND=!1,this.ALPHAFROMALBEDO=!1,this.ALPHATESTVALUE="0.5",this.SPECULAROVERALPHA=!1,this.RADIANCEOVERALPHA=!1,this.ALPHAFRESNEL=!1,this.LINEARALPHAFRESNEL=!1,this.PREMULTIPLYALPHA=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.GAMMAEMISSIVE=!1,this.REFLECTIVITY=!1,this.REFLECTIVITY_GAMMA=!1,this.REFLECTIVITYDIRECTUV=0,this.SPECULARTERM=!1,this.MICROSURFACEFROMREFLECTIVITYMAP=!1,this.MICROSURFACEAUTOMATIC=!1,this.LODBASEDMICROSFURACE=!1,this.MICROSURFACEMAP=!1,this.MICROSURFACEMAPDIRECTUV=0,this.METALLICWORKFLOW=!1,this.ROUGHNESSSTOREINMETALMAPALPHA=!1,this.ROUGHNESSSTOREINMETALMAPGREEN=!1,this.METALLNESSSTOREINMETALMAPBLUE=!1,this.AOSTOREINMETALMAPRED=!1,this.METALLIC_REFLECTANCE=!1,this.METALLIC_REFLECTANCE_GAMMA=!1,this.METALLIC_REFLECTANCEDIRECTUV=0,this.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=!1,this.REFLECTANCE=!1,this.REFLECTANCE_GAMMA=!1,this.REFLECTANCEDIRECTUV=0,this.ENVIRONMENTBRDF=!1,this.ENVIRONMENTBRDF_RGBD=!1,this.NORMAL=!1,this.TANGENT=!1,this.BUMP=!1,this.BUMPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.NORMALXYSCALE=!0,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.USELIGHTMAPASSHADOWMAP=!1,this.GAMMALIGHTMAP=!1,this.RGBDLIGHTMAP=!1,this.REFLECTION=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.INVERTCUBICMAP=!1,this.USESPHERICALFROMREFLECTIONMAP=!1,this.USEIRRADIANCEMAP=!1,this.USESPHERICALINVERTEX=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.LODINREFLECTIONALPHA=!1,this.GAMMAREFLECTION=!1,this.RGBDREFLECTION=!1,this.LINEARSPECULARREFLECTION=!1,this.RADIANCEOCCLUSION=!1,this.HORIZONOCCLUSION=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.NONUNIFORMSCALING=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.EXPOSURE=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.USEPHYSICALLIGHTFALLOFF=!1,this.USEGLTFLIGHTFALLOFF=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.LOGARITHMICDEPTH=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.FORCENORMALFORWARD=!1,this.SPECULARAA=!1,this.UNLIT=!1,this.DECAL_AFTER_DETAIL=!1,this.DEBUGMODE=0,this.rebuild()}reset(){super.reset(),this.ALPHATESTVALUE="0.5",this.PBR=!0,this.NORMALXYSCALE=!0}}class p extends A.e{get realTimeFiltering(){return this._realTimeFiltering}set realTimeFiltering(q){this._realTimeFiltering=q,this.te(1)}get realTimeFilteringQuality(){return this._realTimeFilteringQuality}set realTimeFilteringQuality(q){this._realTimeFilteringQuality=q,this.te(1)}get canRenderToMRT(){return!0}_attachImageProcessingConfiguration(q){q!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=q||this.va().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}constructor(q,X){super(q,X,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||p.ForceGLSL),this._directIntensity=1,this._emissiveIntensity=1,this._environmentIntensity=1,this._specularIntensity=1,this._lightingInfos=new a.q(this._directIntensity,this._emissiveIntensity,this._environmentIntensity,this._specularIntensity),this._disableBumpMap=!1,this._albedoTexture=null,this._ambientTexture=null,this._ambientTextureStrength=1,this._ambientTextureImpactOnAnalyticalLights=p.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._reflectivityTexture=null,this._metallicTexture=null,this._metallic=null,this._roughness=null,this._metallicF0Factor=1,this._metallicReflectanceColor=d.b.White(),this._useOnlyMetallicFromMetallicReflectanceTexture=!1,this._metallicReflectanceTexture=null,this._reflectanceTexture=null,this._microSurfaceTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._ambientColor=new d.b(0,0,0),this._albedoColor=new d.b(1,1,1),this._reflectivityColor=new d.b(1,1,1),this._reflectionColor=new d.b(1,1,1),this._emissiveColor=new d.b(0,0,0),this._microSurface=.9,this._useLightmapAsShadowmap=!1,this._useHorizonOcclusion=!0,this._useRadianceOcclusion=!0,this._useAlphaFromAlbedoTexture=!1,this._useSpecularOverAlpha=!0,this._useMicroSurfaceFromReflectivityMapAlpha=!1,this._useRoughnessFromMetallicTextureAlpha=!0,this._useRoughnessFromMetallicTextureGreen=!1,this._useMetallnessFromMetallicTextureBlue=!1,this._useAmbientOcclusionFromMetallicTextureRed=!1,this._useAmbientInGrayScale=!1,this._useAutoMicroSurfaceFromReflectivityMap=!1,this._lightFalloff=p.LIGHTFALLOFF_PHYSICAL,this._useRadianceOverAlpha=!0,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this._parallaxScaleBias=.05,this._disableLighting=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._alphaCutOff=.4,this._forceAlphaTest=!1,this._useAlphaFresnel=!1,this._useLinearAlphaFresnel=!1,this._environmentBRDFTexture=null,this._forceIrradianceInFragment=!1,this._realTimeFiltering=!1,this._realTimeFilteringQuality=8,this._forceNormalForward=!1,this._enableSpecularAntiAliasing=!1,this._imageProcessingObserver=null,this._renderTargets=new H.g(16),this._globalAmbientColor=new d.b(0,0,0),this._unlit=!1,this._applyDecalMapAfterDetailMap=!1,this._debugMode=0,this._shadersLoaded=!1,this._breakShaderLoadedCheck=!1,this.debugMode=0,this.debugLimit=-1,this.debugFactor=1,this._cacheHasRenderTargetTextures=!1,this.brdf=new j(this),this.clearCoat=new Z(this),this.iridescence=new O(this),this.anisotropy=new P(this),this.sheen=new l(this),this.subSurface=new M(this),this.detailMap=new o.b(this),this._attachImageProcessingConfiguration(null),this.getRenderTargetTextures=()=>(this._renderTargets.reset(),w.b.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets),this._environmentBRDFTexture=(0,b.d)(this.va()),this.prePassConfiguration=new I.b}get hasRenderTargetTextures(){return!!(w.b.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures}get isPrePassCapable(){return!this.disableDepthWrite}getClassName(){return"PBRBaseMaterial"}get _disableAlphaBlending(){var q;return this._transparencyMode===p.PBRMATERIAL_OPAQUE||this._transparencyMode===p.PBRMATERIAL_ALPHATEST||(null===(q=this.subSurface)||void 0===q?void 0:q.disableAlphaBlending)}needAlphaBlending(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())}needAlphaTesting(){var q;return!!this._forceAlphaTest||(null===(q=this.subSurface)||void 0===q||!q.disableAlphaBlending)&&(this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===p.PBRMATERIAL_ALPHATEST))}_shouldUseAlphaFromAlbedoTexture(){return null!=this._albedoTexture&&this._albedoTexture.fc&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==p.PBRMATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._albedoTexture&&this._albedoTexture.fc||null!=this._opacityTexture}getAlphaTestTexture(){return this._albedoTexture}isReadyForSubMesh(q,X,Q){this._uniformBufferLayoutBuilt||this.buildUniformLayout();const y=X._drawWrapper;if(y.effect&&this.isFrozen&&y._wasPreviouslyReady&&y._wasPreviouslyUsingInstances===Q)return!0;X.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),X.materialDefines=new c(this._eventInfo.defineNames));const x=X.materialDefines;if(this._isReadyForSubMesh(X))return!0;const H=this.va(),b=H.getEngine();if(x._areTexturesDirty&&(this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,H.texturesEnabled)){if(this._albedoTexture&&w.b.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&w.b.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&w.b.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;const q=this._getReflectionTexture();if(q&&w.b.ReflectionTextureEnabled){if(!q.isReadyOrNotBlocking())return!1;var D;if(q.irradianceTexture){if(!q.irradianceTexture.isReadyOrNotBlocking())return!1}else if(!q.sphericalPolynomial&&null!==(D=q.getInternalTexture())&&void 0!==D&&D._sphericalPolynomialPromise)return!1}if(this._lightmapTexture&&w.b.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&w.b.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(w.b.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._metallicReflectanceTexture&&!this._metallicReflectanceTexture.isReadyOrNotBlocking())return!1;if(this._reflectanceTexture&&!this._reflectanceTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(b.getCaps().standardDerivatives&&this._bumpTexture&&w.b.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;if(this._environmentBRDFTexture&&w.b.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=x,this._eventInfo.subMesh=X,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(x._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;b.getCaps().standardDerivatives||q.isVerticesDataPresent(R.c.NormalKind)||(q.createNormals(!0),u.b.Warn("PBRMaterial: Normals have been created for the mesh: "+q.name));const a=X.effect,L=x._areLightsDisposed;let f=this._prepareEffect(q,x,this.onCompiled,this.onError,Q,null,X.getRenderingMesh().hasThinInstances),k=!1;if(f)if(this._onEffectCreatedObservable&&(S.effect=f,S.subMesh=X,this._onEffectCreatedObservable.notifyObservers(S)),this.allowShaderHotSwapping&&a&&!f.isReady()){if(f=a,x.markAsUnprocessed(),k=this.isFrozen,L)return x._areLightsDisposed=!0,!1}else H.resetCachedMaterial(),X.setEffect(f,x,this._materialContext);return!(!X.effect||!X.effect.isReady())&&(x._renderId=H.getRenderId(),y._wasPreviouslyReady=!k,y._wasPreviouslyUsingInstances=!!Q,this._checkScenePerformancePriority(),!0)}isMetallicWorkflow(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)}_prepareEffect(q,X){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,H=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,b=arguments.length>6?arguments[6]:void 0;if(this._prepareDefines(q,X,u,H,b),!X.isDirty)return null;X.markAsProcessed();const D=this.va().getEngine(),a=new V.e;let L=0;X.USESPHERICALINVERTEX&&a.addFallback(L++,"USESPHERICALINVERTEX"),X.FOG&&a.addFallback(L,"FOG"),X.SPECULARAA&&a.addFallback(L,"SPECULARAA"),X.POINTSIZE&&a.addFallback(L,"POINTSIZE"),X.LOGARITHMICDEPTH&&a.addFallback(L,"LOGARITHMICDEPTH"),X.PARALLAX&&a.addFallback(L,"PARALLAX"),X.PARALLAX_RHS&&a.addFallback(L,"PARALLAX_RHS"),X.PARALLAXOCCLUSION&&a.addFallback(L++,"PARALLAXOCCLUSION"),X.ENVIRONMENTBRDF&&a.addFallback(L++,"ENVIRONMENTBRDF"),X.TANGENT&&a.addFallback(L++,"TANGENT"),X.BUMP&&a.addFallback(L++,"BUMP"),L=(0,W.w)(X,a,this._maxSimultaneousLights,L++),X.SPECULARTERM&&a.addFallback(L++,"SPECULARTERM"),X.USESPHERICALFROMREFLECTIONMAP&&a.addFallback(L++,"USESPHERICALFROMREFLECTIONMAP"),X.USEIRRADIANCEMAP&&a.addFallback(L++,"USEIRRADIANCEMAP"),X.LIGHTMAP&&a.addFallback(L++,"LIGHTMAP"),X.NORMAL&&a.addFallback(L++,"NORMAL"),X.AMBIENT&&a.addFallback(L++,"AMBIENT"),X.EMISSIVE&&a.addFallback(L++,"EMISSIVE"),X.VERTEXCOLOR&&a.addFallback(L++,"VERTEXCOLOR"),X.MORPHTARGETS&&a.addFallback(L++,"MORPHTARGETS"),X.MULTIVIEW&&a.addFallback(0,"MULTIVIEW");const f=[R.c.PositionKind];X.NORMAL&&f.push(R.c.NormalKind),X.TANGENT&&f.push(R.c.TangentKind);for(let Q=1;Q<=6;++Q)X["UV"+Q]&&f.push(`uv${1===Q?"":Q}`);X.VERTEXCOLOR&&f.push(R.c.ColorKind),(0,W.D)(f,q,X,a),(0,W.H)(f,X),(0,W.J)(f,q,X),(0,W.z)(f,q,X);let k="pbr";const j=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vReflectionFilteringInfo","vMetallicReflectanceInfos","vReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","albedoMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","reflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vTangentSpaceParams","boneTextureWidth","vDebugMode","morphTargetTextureInfo","morphTargetTextureIndices"],d=["albedoSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler","reflectanceSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],i=["Material","Scene","Mesh"],A={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:X.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=a,this._eventInfo.fallbackRank=L,this._eventInfo.defines=X,this._eventInfo.uniforms=j,this._eventInfo.attributes=f,this._eventInfo.samplers=d,this._eventInfo.uniformBuffersNames=i,this._eventInfo.customCode=void 0,this._eventInfo.mesh=q,this._eventInfo.indexParameters=A,this._callbackPluginEventGeneric(128,this._eventInfo),N.d.AddUniformsAndSamplers(j,d),I.b.AddUniforms(j),I.b.AddSamplers(d),(0,Y.e)(j),e.b&&(e.b.PrepareUniforms(j,X),e.b.PrepareSamplers(d,X)),(0,W.ib)({uniformsNames:j,uniformBuffersNames:i,samplers:d,defines:X,maxSimultaneousLights:this._maxSimultaneousLights});const B={};this.customShaderNameResolve&&(k=this.customShaderNameResolve(k,j,i,d,X,f,B));const w=X.toString(),v=D.createEffect(k,{attributes:f,uniformsNames:j,uniformBuffersNames:i,samplers:d,defines:w,fallbacks:a,onCompiled:y,onError:x,indexParameters:A,processFinalCode:B.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:X.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this.shaderLanguage?await Promise.all([Promise.all([Q.e(15),Q.e(44)]).then(Q.bind(Q,12539)),Promise.all([Q.e(16),Q.e(45)]).then(Q.bind(Q,12548))]):await Promise.all([Promise.all([Q.e(21),Q.e(46)]).then(Q.bind(Q,12550)),Promise.all([Q.e(23),Q.e(47)]).then(Q.bind(Q,12566))]),this._shadersLoaded=!0}},D);return this._eventInfo.customCode=void 0,v}_prepareDefines(q,X){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,x=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const u=this.va(),H=u.getEngine();(0,W.R)(u,q,X,!0,this._maxSimultaneousLights,this._disableLighting),X._needNormals=!0,(0,W._)(u,X);const b=this.needAlphaBlendingForMesh(q)&&this.va().useOrderIndependentTransparency;if((0,W.eb)(u,X,this.canRenderToMRT&&!b),(0,W.bb)(u,X,b),N.d.PrepareDefines(H.currentRenderPassId,q,X),X.METALLICWORKFLOW=this.isMetallicWorkflow(),X._areTexturesDirty){X._needUVs=!1;for(let q=1;q<=6;++q)X["MAINUV"+q]=!1;if(u.texturesEnabled){X.ALBEDODIRECTUV=0,X.AMBIENTDIRECTUV=0,X.OPACITYDIRECTUV=0,X.EMISSIVEDIRECTUV=0,X.REFLECTIVITYDIRECTUV=0,X.MICROSURFACEMAPDIRECTUV=0,X.METALLIC_REFLECTANCEDIRECTUV=0,X.REFLECTANCEDIRECTUV=0,X.BUMPDIRECTUV=0,X.LIGHTMAPDIRECTUV=0,H.getCaps().textureLOD&&(X.LODBASEDMICROSFURACE=!0),this._albedoTexture&&w.b.DiffuseTextureEnabled?((0,W.U)(this._albedoTexture,X,"ALBEDO"),X.GAMMAALBEDO=this._albedoTexture.gammaSpace):X.ALBEDO=!1,this._ambientTexture&&w.b.AmbientTextureEnabled?((0,W.U)(this._ambientTexture,X,"AMBIENT"),X.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):X.AMBIENT=!1,this._opacityTexture&&w.b.OpacityTextureEnabled?((0,W.U)(this._opacityTexture,X,"OPACITY"),X.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):X.OPACITY=!1;const q=this._getReflectionTexture();if(q&&w.b.ReflectionTextureEnabled){switch(X.REFLECTION=!0,X.GAMMAREFLECTION=q.gammaSpace,X.RGBDREFLECTION=q.isRGBD,X.LODINREFLECTIONALPHA=q.lodLevelInAlpha,X.LINEARSPECULARREFLECTION=q.linearSpecularLOD,this.realTimeFiltering&&this.realTimeFilteringQuality>0?(X.NUM_SAMPLES=""+this.realTimeFilteringQuality,H._features.needTypeSuffixInShaderConstants&&(X.NUM_SAMPLES=X.NUM_SAMPLES+"u"),X.REALTIME_FILTERING=!0):X.REALTIME_FILTERING=!1,X.INVERTCUBICMAP=q.coordinatesMode===B.d.INVCUBIC_MODE,X.REFLECTIONMAP_3D=q.isCube,X.REFLECTIONMAP_OPPOSITEZ=X.REFLECTIONMAP_3D&&this.va().useRightHandedSystem?!q.invertZ:q.invertZ,X.REFLECTIONMAP_CUBIC=!1,X.REFLECTIONMAP_EXPLICIT=!1,X.REFLECTIONMAP_PLANAR=!1,X.REFLECTIONMAP_PROJECTION=!1,X.REFLECTIONMAP_SKYBOX=!1,X.REFLECTIONMAP_SPHERICAL=!1,X.REFLECTIONMAP_EQUIRECTANGULAR=!1,X.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,X.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,q.coordinatesMode){case B.d.EXPLICIT_MODE:X.REFLECTIONMAP_EXPLICIT=!0;break;case B.d.PLANAR_MODE:X.REFLECTIONMAP_PLANAR=!0;break;case B.d.PROJECTION_MODE:X.REFLECTIONMAP_PROJECTION=!0;break;case B.d.SKYBOX_MODE:X.REFLECTIONMAP_SKYBOX=!0;break;case B.d.SPHERICAL_MODE:X.REFLECTIONMAP_SPHERICAL=!0;break;case B.d.EQUIRECTANGULAR_MODE:X.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case B.d.FIXED_EQUIRECTANGULAR_MODE:X.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case B.d.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:X.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case B.d.CUBIC_MODE:case B.d.INVCUBIC_MODE:default:X.REFLECTIONMAP_CUBIC=!0,X.USE_LOCAL_REFLECTIONMAP_CUBIC=!!q.boundingBoxSize}q.coordinatesMode!==B.d.SKYBOX_MODE&&(q.irradianceTexture?(X.USEIRRADIANCEMAP=!0,X.USESPHERICALFROMREFLECTIONMAP=!1):q.isCube&&(X.USESPHERICALFROMREFLECTIONMAP=!0,X.USEIRRADIANCEMAP=!1,this._forceIrradianceInFragment||this.realTimeFiltering||this._twoSidedLighting||H.getCaps().maxVaryingVectors<=8?X.USESPHERICALINVERTEX=!1:X.USESPHERICALINVERTEX=!0))}else X.REFLECTION=!1,X.REFLECTIONMAP_3D=!1,X.REFLECTIONMAP_SPHERICAL=!1,X.REFLECTIONMAP_PLANAR=!1,X.REFLECTIONMAP_CUBIC=!1,X.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,X.REFLECTIONMAP_PROJECTION=!1,X.REFLECTIONMAP_SKYBOX=!1,X.REFLECTIONMAP_EXPLICIT=!1,X.REFLECTIONMAP_EQUIRECTANGULAR=!1,X.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,X.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,X.INVERTCUBICMAP=!1,X.USESPHERICALFROMREFLECTIONMAP=!1,X.USEIRRADIANCEMAP=!1,X.USESPHERICALINVERTEX=!1,X.REFLECTIONMAP_OPPOSITEZ=!1,X.LODINREFLECTIONALPHA=!1,X.GAMMAREFLECTION=!1,X.RGBDREFLECTION=!1,X.LINEARSPECULARREFLECTION=!1;this._lightmapTexture&&w.b.LightmapTextureEnabled?((0,W.U)(this._lightmapTexture,X,"LIGHTMAP"),X.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,X.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,X.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):X.LIGHTMAP=!1,this._emissiveTexture&&w.b.EmissiveTextureEnabled?((0,W.U)(this._emissiveTexture,X,"EMISSIVE"),X.GAMMAEMISSIVE=this._emissiveTexture.gammaSpace):X.EMISSIVE=!1,w.b.SpecularTextureEnabled?(this._metallicTexture?((0,W.U)(this._metallicTexture,X,"REFLECTIVITY"),X.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,X.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,X.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,X.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed,X.REFLECTIVITY_GAMMA=!1):this._reflectivityTexture?((0,W.U)(this._reflectivityTexture,X,"REFLECTIVITY"),X.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,X.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap,X.REFLECTIVITY_GAMMA=this._reflectivityTexture.gammaSpace):X.REFLECTIVITY=!1,this._metallicReflectanceTexture||this._reflectanceTexture?(X.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=this._useOnlyMetallicFromMetallicReflectanceTexture,this._metallicReflectanceTexture?((0,W.U)(this._metallicReflectanceTexture,X,"METALLIC_REFLECTANCE"),X.METALLIC_REFLECTANCE_GAMMA=this._metallicReflectanceTexture.gammaSpace):X.METALLIC_REFLECTANCE=!1,this._reflectanceTexture&&(!this._metallicReflectanceTexture||this._metallicReflectanceTexture&&this._useOnlyMetallicFromMetallicReflectanceTexture)?((0,W.U)(this._reflectanceTexture,X,"REFLECTANCE"),X.REFLECTANCE_GAMMA=this._reflectanceTexture.gammaSpace):X.REFLECTANCE=!1):(X.METALLIC_REFLECTANCE=!1,X.REFLECTANCE=!1),this._microSurfaceTexture?(0,W.U)(this._microSurfaceTexture,X,"MICROSURFACEMAP"):X.MICROSURFACEMAP=!1):(X.REFLECTIVITY=!1,X.MICROSURFACEMAP=!1),H.getCaps().standardDerivatives&&this._bumpTexture&&w.b.BumpTextureEnabled&&!this._disableBumpMap?((0,W.U)(this._bumpTexture,X,"BUMP"),this._useParallax&&this._albedoTexture&&w.b.DiffuseTextureEnabled?(X.PARALLAX=!0,X.PARALLAX_RHS=u.useRightHandedSystem,X.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):X.PARALLAX=!1,X.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):(X.BUMP=!1,X.PARALLAX=!1,X.PARALLAX_RHS=!1,X.PARALLAXOCCLUSION=!1,X.OBJECTSPACE_NORMALMAP=!1),this._environmentBRDFTexture&&w.b.ReflectionTextureEnabled?(X.ENVIRONMENTBRDF=!0,X.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(X.ENVIRONMENTBRDF=!1,X.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?X.ALPHAFROMALBEDO=!0:X.ALPHAFROMALBEDO=!1}X.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===p.LIGHTFALLOFF_STANDARD?(X.USEPHYSICALLIGHTFALLOFF=!1,X.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===p.LIGHTFALLOFF_GLTF?(X.USEPHYSICALLIGHTFALLOFF=!1,X.USEGLTFLIGHTFALLOFF=!0):(X.USEPHYSICALLIGHTFALLOFF=!0,X.USEGLTFLIGHTFALLOFF=!1),X.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.ue&&this._twoSidedLighting?X.TWOSIDEDLIGHTING=!0:X.TWOSIDEDLIGHTING=!1,X.SPECULARAA=H.getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(X._areTexturesDirty||X._areMiscDirty)&&(X.ALPHATESTVALUE=`${this._alphaCutOff}${this._alphaCutOff%1===0?".":""}`,X.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,X.ALPHABLEND=this.needAlphaBlendingForMesh(q),X.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,X.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),X._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(X),X.FORCENORMALFORWARD=this._forceNormalForward,X.RADIANCEOCCLUSION=this._useRadianceOcclusion,X.HORIZONOCCLUSION=this._useHorizonOcclusion,X._areMiscDirty&&((0,W.Y)(q,u,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(q)||this._forceAlphaTest,X,this._applyDecalMapAfterDetailMap),X.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!q.isVerticesDataPresent(R.c.NormalKind),X.DEBUGMODE=this._debugMode),(0,W.P)(u,H,this,X,!!Q,y,x),this._eventInfo.defines=X,this._eventInfo.mesh=q,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,W.M)(q,X,!0,!0,!0,this._transparencyMode!==p.PBRMATERIAL_OPAQUE),this._callbackPluginEventPrepareDefines(this._eventInfo)}forceCompilation(q,X,Q){const y={clipPlane:!1,useInstances:!1,...Q};this._uniformBufferLayoutBuilt||this.buildUniformLayout(),this._callbackPluginEventGeneric(4,this._eventInfo);(()=>{if(this._breakShaderLoadedCheck)return;const Q=new c(this._eventInfo.defineNames),x=this._prepareEffect(q,Q,void 0,void 0,y.useInstances,y.clipPlane,q.hasThinInstances);this._onEffectCreatedObservable&&(S.effect=x,S.subMesh=null,this._onEffectCreatedObservable.notifyObservers(S)),x.isReady()?X&&X(this):x.onCompileObservable.add((()=>{X&&X(this)}))})()}buildUniformLayout(){const q=this._uniformBuffer;q.addUniform("vAlbedoInfos",2),q.addUniform("vAmbientInfos",4),q.addUniform("vOpacityInfos",2),q.addUniform("vEmissiveInfos",2),q.addUniform("vLightmapInfos",2),q.addUniform("vReflectivityInfos",3),q.addUniform("vMicroSurfaceSamplerInfos",2),q.addUniform("vReflectionInfos",2),q.addUniform("vReflectionFilteringInfo",2),q.addUniform("vReflectionPosition",3),q.addUniform("vReflectionSize",3),q.addUniform("vBumpInfos",3),q.addUniform("albedoMatrix",16),q.addUniform("ambientMatrix",16),q.addUniform("opacityMatrix",16),q.addUniform("emissiveMatrix",16),q.addUniform("lightmapMatrix",16),q.addUniform("reflectivityMatrix",16),q.addUniform("microSurfaceSamplerMatrix",16),q.addUniform("bumpMatrix",16),q.addUniform("vTangentSpaceParams",2),q.addUniform("reflectionMatrix",16),q.addUniform("vReflectionColor",3),q.addUniform("vAlbedoColor",4),q.addUniform("vLightingIntensity",4),q.addUniform("vReflectionMicrosurfaceInfos",3),q.addUniform("pointSize",1),q.addUniform("vReflectivityColor",4),q.addUniform("vEmissiveColor",3),q.addUniform("vAmbientColor",3),q.addUniform("vDebugMode",2),q.addUniform("vMetallicReflectanceFactors",4),q.addUniform("vMetallicReflectanceInfos",2),q.addUniform("metallicReflectanceMatrix",16),q.addUniform("vReflectanceInfos",2),q.addUniform("reflectanceMatrix",16),q.addUniform("vSphericalL00",3),q.addUniform("vSphericalL1_1",3),q.addUniform("vSphericalL10",3),q.addUniform("vSphericalL11",3),q.addUniform("vSphericalL2_2",3),q.addUniform("vSphericalL2_1",3),q.addUniform("vSphericalL20",3),q.addUniform("vSphericalL21",3),q.addUniform("vSphericalL22",3),q.addUniform("vSphericalX",3),q.addUniform("vSphericalY",3),q.addUniform("vSphericalZ",3),q.addUniform("vSphericalXX_ZZ",3),q.addUniform("vSphericalYY_ZZ",3),q.addUniform("vSphericalZZ",3),q.addUniform("vSphericalXY",3),q.addUniform("vSphericalYZ",3),q.addUniform("vSphericalZX",3),super.buildUniformLayout()}bindForSubMesh(q,X,Q){const y=this.va(),x=Q.materialDefines;if(!x)return;const u=Q.effect;if(!u)return;this._activeEffect=u,X.getMeshUniformBuffer().bindToEffect(u,"Mesh"),X.transferToEffect(q);const H=y.getEngine();this._uniformBuffer.bindToEffect(u,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,y,X,q,this.isFrozen),N.d.Bind(H.currentRenderPassId,this._activeEffect,X,q),this._eventInfo.subMesh=Q,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),x.OBJECTSPACE_NORMALMAP&&(q.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const b=this._mustRebind(y,u,Q,X.visibility);(0,W.e)(X,this._activeEffect,this.prePassConfiguration);let a=null;const R=this._uniformBuffer;if(b){if(this.bindViewProjection(u),a=this._getReflectionTexture(),!R.useUbo||!this.isFrozen||!R.isSync||Q._drawWrapper._forceRebindOnNextCall){var L;if(y.texturesEnabled){if(this._albedoTexture&&w.b.DiffuseTextureEnabled&&(R.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),(0,W.t)(this._albedoTexture,R,"albedo")),this._ambientTexture&&w.b.AmbientTextureEnabled&&(R.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),(0,W.t)(this._ambientTexture,R,"ambient")),this._opacityTexture&&w.b.OpacityTextureEnabled&&(R.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,W.t)(this._opacityTexture,R,"opacity")),a&&w.b.ReflectionTextureEnabled){if(R.Ae("reflectionMatrix",a.getReflectionTextureMatrix()),R.updateFloat2("vReflectionInfos",a.level,0),a.boundingBoxSize){const q=a;R.updateVector3("vReflectionPosition",q.boundingBoxPosition),R.updateVector3("vReflectionSize",q.boundingBoxSize)}if(this.realTimeFiltering){const q=a.getSize().width;R.updateFloat2("vReflectionFilteringInfo",q,Math.log2(q))}if(!x.USEIRRADIANCEMAP){const q=a.sphericalPolynomial;if(x.USESPHERICALFROMREFLECTIONMAP&&q)if(x.SPHERICAL_HARMONICS){const X=q.preScaledHarmonics;R.updateVector3("vSphericalL00",X.l00),R.updateVector3("vSphericalL1_1",X.l1_1),R.updateVector3("vSphericalL10",X.l10),R.updateVector3("vSphericalL11",X.l11),R.updateVector3("vSphericalL2_2",X.l2_2),R.updateVector3("vSphericalL2_1",X.l2_1),R.updateVector3("vSphericalL20",X.l20),R.updateVector3("vSphericalL21",X.l21),R.updateVector3("vSphericalL22",X.l22)}else R.updateFloat3("vSphericalX",q.x.x,q.x.y,q.x.z),R.updateFloat3("vSphericalY",q.y.x,q.y.y,q.y.z),R.updateFloat3("vSphericalZ",q.z.x,q.z.y,q.z.z),R.updateFloat3("vSphericalXX_ZZ",q.xx.x-q.zz.x,q.xx.y-q.zz.y,q.xx.z-q.zz.z),R.updateFloat3("vSphericalYY_ZZ",q.yy.x-q.zz.x,q.yy.y-q.zz.y,q.yy.z-q.zz.z),R.updateFloat3("vSphericalZZ",q.zz.x,q.zz.y,q.zz.z),R.updateFloat3("vSphericalXY",q.xy.x,q.xy.y,q.xy.z),R.updateFloat3("vSphericalYZ",q.yz.x,q.yz.y,q.yz.z),R.updateFloat3("vSphericalZX",q.zx.x,q.zx.y,q.zx.z)}R.updateFloat3("vReflectionMicrosurfaceInfos",a.getSize().width,a.lodGenerationScale,a.lodGenerationOffset)}this._emissiveTexture&&w.b.EmissiveTextureEnabled&&(R.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,W.t)(this._emissiveTexture,R,"emissive")),this._lightmapTexture&&w.b.LightmapTextureEnabled&&(R.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,W.t)(this._lightmapTexture,R,"lightmap")),w.b.SpecularTextureEnabled&&(this._metallicTexture?(R.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),(0,W.t)(this._metallicTexture,R,"reflectivity")):this._reflectivityTexture&&(R.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),(0,W.t)(this._reflectivityTexture,R,"reflectivity")),this._metallicReflectanceTexture&&(R.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level),(0,W.t)(this._metallicReflectanceTexture,R,"metallicReflectance")),this._reflectanceTexture&&x.REFLECTANCE&&(R.updateFloat2("vReflectanceInfos",this._reflectanceTexture.coordinatesIndex,this._reflectanceTexture.level),(0,W.t)(this._reflectanceTexture,R,"reflectance")),this._microSurfaceTexture&&(R.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),(0,W.t)(this._microSurfaceTexture,R,"microSurfaceSampler"))),this._bumpTexture&&H.getCaps().standardDerivatives&&w.b.BumpTextureEnabled&&!this._disableBumpMap&&(R.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),(0,W.t)(this._bumpTexture,R,"bump"),y._mirroredCameraPosition?R.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):R.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&R.updateFloat("pointSize",this.pointSize),x.METALLICWORKFLOW){var f;d.g.Fe[0].r=void 0===this._metallic||null===this._metallic?1:this._metallic,d.g.Fe[0].g=void 0===this._roughness||null===this._roughness?1:this._roughness,R.updateColor4("vReflectivityColor",d.g.Fe[0],1);const q=(null===(f=this.subSurface)||void 0===f?void 0:f._indexOfRefraction)??1.5,X=1,Q=Math.pow((q-X)/(q+X),2);this._metallicReflectanceColor.scaleToRef(Q*this._metallicF0Factor,d.g.Fe[0]);const y=this._metallicF0Factor;R.updateColor4("vMetallicReflectanceFactors",d.g.Fe[0],y)}else R.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);R.updateColor3("vEmissiveColor",w.b.EmissiveTextureEnabled?this._emissiveColor:d.b.BlackReadOnly),R.updateColor3("vReflectionColor",this._reflectionColor),!x.SS_REFRACTION&&null!==(L=this.subSurface)&&void 0!==L&&L._linkRefractionWithTransparency?R.updateColor4("vAlbedoColor",this._albedoColor,1):R.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*y.environmentIntensity,this._lightingInfos.w=this._specularIntensity,R.updateVector4("vLightingIntensity",this._lightingInfos),y.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor),R.updateColor3("vAmbientColor",this._globalAmbientColor),R.updateFloat2("vDebugMode",this.debugLimit,this.debugFactor)}y.texturesEnabled&&(this._albedoTexture&&w.b.DiffuseTextureEnabled&&R.setTexture("albedoSampler",this._albedoTexture),this._ambientTexture&&w.b.AmbientTextureEnabled&&R.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&w.b.OpacityTextureEnabled&&R.setTexture("opacitySampler",this._opacityTexture),a&&w.b.ReflectionTextureEnabled&&(x.LODBASEDMICROSFURACE?R.setTexture("reflectionSampler",a):(R.setTexture("reflectionSampler",a._lodTextureMid||a),R.setTexture("reflectionSamplerLow",a._lodTextureLow||a),R.setTexture("reflectionSamplerHigh",a._lodTextureHigh||a)),x.USEIRRADIANCEMAP&&R.setTexture("irradianceSampler",a.irradianceTexture)),x.ENVIRONMENTBRDF&&R.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&w.b.EmissiveTextureEnabled&&R.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&w.b.LightmapTextureEnabled&&R.setTexture("lightmapSampler",this._lightmapTexture),w.b.SpecularTextureEnabled&&(this._metallicTexture?R.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&R.setTexture("reflectivitySampler",this._reflectivityTexture),this._metallicReflectanceTexture&&R.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture),this._reflectanceTexture&&x.REFLECTANCE&&R.setTexture("reflectanceSampler",this._reflectanceTexture),this._microSurfaceTexture&&R.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&H.getCaps().standardDerivatives&&w.b.BumpTextureEnabled&&!this._disableBumpMap&&R.setTexture("bumpSampler",this._bumpTexture)),this.va().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(X)&&this.va().depthPeelingRenderer.bind(u),this._eventInfo.subMesh=Q,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,Y.g)(this._activeEffect,this,y),this.bindEyePosition(u)}else y.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(b||!this.isFrozen){var k;if(y.lightsEnabled&&!this._disableLighting&&(0,W.h)(y,X,this._activeEffect,x,this._maxSimultaneousLights),(y.fogEnabled&&X.applyFog&&y.fogMode!==D.d.FOGMODE_NONE||a||this.subSurface.refractionTexture||X.receiveShadows||x.PREPASS)&&this.bindView(u),(0,W.g)(y,X,this._activeEffect,!0),x.NUM_MORPH_INFLUENCERS&&(0,W.o)(X,this._activeEffect),x.BAKED_VERTEX_ANIMATION_TEXTURE)null===(k=X.bakedVertexAnimationManager)||void 0===k||k.bind(u,x.INSTANCES);this._imageProcessingConfiguration.bind(this._activeEffect),(0,W.l)(x,this._activeEffect,y)}this._afterBind(X,this._activeEffect,Q),R.update()}getAnimatables(){const q=super.getAnimatables();return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&q.push(this._albedoTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&q.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&q.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&q.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&q.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?q.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&q.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&q.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&q.push(this._lightmapTexture),this._metallicReflectanceTexture&&this._metallicReflectanceTexture.animations&&this._metallicReflectanceTexture.animations.length>0&&q.push(this._metallicReflectanceTexture),this._reflectanceTexture&&this._reflectanceTexture.animations&&this._reflectanceTexture.animations.length>0&&q.push(this._reflectanceTexture),this._microSurfaceTexture&&this._microSurfaceTexture.animations&&this._microSurfaceTexture.animations.length>0&&q.push(this._microSurfaceTexture),q}_getReflectionTexture(){return this._reflectionTexture?this._reflectionTexture:this.va().environmentTexture}getActiveTextures(){const q=super.getActiveTextures();return this._albedoTexture&&q.push(this._albedoTexture),this._ambientTexture&&q.push(this._ambientTexture),this._opacityTexture&&q.push(this._opacityTexture),this._reflectionTexture&&q.push(this._reflectionTexture),this._emissiveTexture&&q.push(this._emissiveTexture),this._reflectivityTexture&&q.push(this._reflectivityTexture),this._metallicTexture&&q.push(this._metallicTexture),this._metallicReflectanceTexture&&q.push(this._metallicReflectanceTexture),this._reflectanceTexture&&q.push(this._reflectanceTexture),this._microSurfaceTexture&&q.push(this._microSurfaceTexture),this._bumpTexture&&q.push(this._bumpTexture),this._lightmapTexture&&q.push(this._lightmapTexture),q}hasTexture(q){return!!super.hasTexture(q)||(this._albedoTexture===q||(this._ambientTexture===q||(this._opacityTexture===q||(this._reflectionTexture===q||(this._emissiveTexture===q||(this._reflectivityTexture===q||(this._metallicTexture===q||(this._metallicReflectanceTexture===q||(this._reflectanceTexture===q||(this._microSurfaceTexture===q||(this._bumpTexture===q||this._lightmapTexture===q)))))))))))}setPrePassRenderer(){var q;if(null===(q=this.subSurface)||void 0===q||!q.isScatteringEnabled)return!1;const X=this.va().enableSubSurfaceForPrePass();return X&&(X.enabled=!0),!0}dispose(q,X){var Q,y,x,u,H,b,D,a,R,L,f,k;(this._breakShaderLoadedCheck=!0,X)&&(this._environmentBRDFTexture&&this.va().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),null===(Q=this._albedoTexture)||void 0===Q||Q.dispose(),null===(y=this._ambientTexture)||void 0===y||y.dispose(),null===(x=this._opacityTexture)||void 0===x||x.dispose(),null===(u=this._reflectionTexture)||void 0===u||u.dispose(),null===(H=this._emissiveTexture)||void 0===H||H.dispose(),null===(b=this._metallicTexture)||void 0===b||b.dispose(),null===(D=this._reflectivityTexture)||void 0===D||D.dispose(),null===(a=this._bumpTexture)||void 0===a||a.dispose(),null===(R=this._lightmapTexture)||void 0===R||R.dispose(),null===(L=this._metallicReflectanceTexture)||void 0===L||L.dispose(),null===(f=this._reflectanceTexture)||void 0===f||f.dispose(),null===(k=this._microSurfaceTexture)||void 0===k||k.dispose());this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(q,X)}}p.PBRMATERIAL_OPAQUE=i.b.MATERIAL_OPAQUE,p.PBRMATERIAL_ALPHATEST=i.b.MATERIAL_ALPHATEST,p.PBRMATERIAL_ALPHABLEND=i.b.MATERIAL_ALPHABLEND,p.PBRMATERIAL_ALPHATESTANDBLEND=i.b.MATERIAL_ALPHATESTANDBLEND,p.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,p.LIGHTFALLOFF_PHYSICAL=0,p.LIGHTFALLOFF_GLTF=1,p.LIGHTFALLOFF_STANDARD=2,p.ForceGLSL=!1,(0,y.b)([(0,x.v)()],p.prototype,"_imageProcessingConfiguration",void 0),(0,y.b)([(0,x.d)("_markAllSubMeshesAsMiscDirty")],p.prototype,"debugMode",void 0)},11920:(q,X,Q)=>{"use strict";Q.d(X,{e:()=>f});var y=Q(975),x=Q(984),u=Q(1215),H=Q(1002),b=Q(1039),D=Q(972),a=Q(1015),R=Q(998),L=Q(1173);Q(1553);class f extends b.c{set boundingBoxSize(q){if(this._boundingBoxSize&&this._boundingBoxSize.equals(q))return;this._boundingBoxSize=q;const X=this.va();X&&X.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(q){this._rotationY=q,this.setReflectionTextureMatrix(H.b.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(q,X,Q){let y="";return q.forEach((q=>y+=q)),new f(y,X,null,Q,q)}static CreateFromPrefilteredData(q,X){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,y=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const x=X.useDelayedTextureLoading;X.useDelayedTextureLoading=!1;const u=new f(q,X,null,!1,null,null,null,void 0,!0,Q,y);return X.useDelayedTextureLoading=x,u}constructor(q,X){var Q;let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,x=arguments.length>3&&void 0!==arguments[3]&&arguments[3],u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,L=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,f=arguments.length>8&&void 0!==arguments[8]&&arguments[8],k=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,j=arguments.length>10&&void 0!==arguments[10]&&arguments[10],I=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,d=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,e=arguments.length>13?arguments[13]:void 0,i=arguments.length>14?arguments[14]:void 0;super(X),this.onLoadObservable=new R.c,this.boundingBoxPosition=H.n.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new H.b,this._buffer=null,this.name=q,this.url=q,this._noMipmap=x,this.fc=!1,this.isCube=!0,this._textureMatrix=H.b.Identity(),this.coordinatesMode=D.d.CUBIC_MODE;let A=null,B=null;null===y||Array.isArray(y)?(this._noMipmap=x,this._format=L,this._createPolynomials=j,A=y,this._loaderOptions=e,this._useSRGBBuffer=i,this._lodScale=I,this._lodOffset=d):(A=y.extensions??null,this._noMipmap=y.noMipmap??!1,u=y.files??null,B=y.buffer??null,this._format=y.format??5,f=y.prefiltered??!1,k=y.forcedExtension??null,this._createPolynomials=y.createPolynomials??!1,this._lodScale=y.lodScale??.8,this._lodOffset=y.lodOffset??0,this._loaderOptions=y.loaderOptions,this._useSRGBBuffer=y.useSRGBBuffer,b=y.X??null,a=y.onError??null),(q||u)&&this.updateURL(q,k,b,f,a,A,null===(Q=this.va())||void 0===Q?void 0:Q.useDelayedTextureLoading,u,B)}getClassName(){return"CubeTexture"}updateURL(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,y=arguments.length>3&&void 0!==arguments[3]&&arguments[3],x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,H=arguments.length>6&&void 0!==arguments[6]&&arguments[6],b=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,D=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=q),this.url=q,X&&(this._forcedExtension=X);const a=q.lastIndexOf("."),R=X||(a>-1?q.substring(a).toLowerCase():""),L=0===R.indexOf(".dds"),f=0===R.indexOf(".env"),k=0===R.indexOf(".basis");if(f?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=y,y&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),b)this._files=b;else if(k||f||L||u||(u=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,u){for(let X=0;X<u.length;X++)this._files.push(q+u[X]);this._extensions=u}this._buffer=D,H?(this.delayLoadState=4,this._delayedOnLoad=Q,this._delayedOnError=x):this._loadTexture(Q,x)}delayLoad(q){4===this.delayLoadState&&(q&&(this._forcedExtension=q),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(q){var X,Q;if(q.updateFlag===this._textureMatrix.updateFlag)return;q.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(Q=this.va())||void 0===Q||Q.markAllMaterialsAsDirty(1,(q=>-1!==q.getActiveTextures().indexOf(this))));if(this._textureMatrix=q,null===(X=this.va())||void 0===X||!X.useRightHandedSystem)return;const y=H.h.Od[0],x=H.h.Quaternion[0],u=H.h.Od[1];this._textureMatrix.decompose(y,x,u),x.z*=-1,x.w*=-1,H.b.ComposeToRef(y,x,u,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var q;return null!==(q=this.va())&&void 0!==q&&q.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Q=this.va(),y=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const x=()=>{var X;(this.onLoadObservable.notifyObservers(this),y)&&(y.dispose(),null===(X=this.va())||void 0===X||X.markAllMaterialsAsDirty(1));q&&q()},H=(q,Q)=>{this._loadingError=!0,this._errorObject={message:q,exception:Q},X&&X(q,Q),D.d.OnTextureLoadErrorObservable.notifyObservers(this)};var b;this._texture?this._texture.isReady?u.f.SetImmediate((()=>x())):this._texture.onLoadedObservable.add((()=>x())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,Q,this._lodScale,this._lodOffset,q,H,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,Q,this._files,this._noMipmap,q,H,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(b=this._texture)||void 0===b||b.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(q,X,Q){const y=L.c.Parse((()=>{let y=!1;return q.prefiltered&&(y=q.prefiltered),new f(Q+(q.url??q.name),X,q.extensions,!1,q.files||null,null,null,void 0,y,q.forcedExtension)}),q,X);if(q.boundingBoxPosition&&(y.boundingBoxPosition=H.n.Rd(q.boundingBoxPosition)),q.boundingBoxSize&&(y.boundingBoxSize=H.n.Rd(q.boundingBoxSize)),q.animations)for(let x=0;x<q.animations.length;x++){const X=q.animations[x],Q=(0,a.d)("BABYLON.Animation");Q&&y.animations.push(Q.Parse(X))}return y}clone(){let q=0;const X=L.c.Clone((()=>{const X=new f(this.url,this.va()||this._getEngine(),this._extensions,this._noMipmap,this._files);return q=X.uniqueId,X}),this);return X.uniqueId=q,X}}(0,y.b)([(0,x.J)()],f.prototype,"url",void 0),(0,y.b)([(0,x.F)()],f.prototype,"boundingBoxPosition",void 0),(0,y.b)([(0,x.F)()],f.prototype,"boundingBoxSize",null),(0,y.b)([(0,x.J)("rotationY")],f.prototype,"rotationY",null),(0,y.b)([(0,x.J)("files")],f.prototype,"_files",void 0),(0,y.b)([(0,x.J)("forcedExtension")],f.prototype,"_forcedExtension",void 0),(0,y.b)([(0,x.J)("extensions")],f.prototype,"_extensions",void 0),(0,y.b)([(0,x.x)("textureMatrix")],f.prototype,"_textureMatrix",void 0),(0,y.b)([(0,x.x)("textureMatrixRefraction")],f.prototype,"_textureMatrixRefraction",void 0),D.d._CubeTextureParser=f.Parse,(0,a.h)("BABYLON.CubeTexture",f)},12229:(q,X,Q)=>{"use strict";Q.d(X,{e:()=>D});var y=Q(1099),x=Q(972),u=Q(1225),H=Q(1435),b=Q(1143);H.ThinEngine.prototype.createDynamicTexture=function(q,X,Q,y){const x=new b.c(this,4);return x.baseWidth=q,x.baseHeight=X,Q&&(q=this.needPOTTextures?(0,u.e)(q,this._caps.maxTextureSize):q,X=this.needPOTTextures?(0,u.e)(X,this._caps.maxTextureSize):X),x.width=q,x.height=X,x.isReady=!1,x.generateMipMaps=Q,x.samplingMode=y,this.updateTextureSamplingMode(y,x),this._internalTexturesCache.push(x),x},H.ThinEngine.prototype.updateDynamicTexture=function(q,X,Q){let y=arguments.length>3&&void 0!==arguments[3]&&arguments[3],x=arguments.length>4?arguments[4]:void 0,u=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!q)return;const H=this._gl,b=H.TEXTURE_2D,D=this._bindTextureDirectly(b,q,!0,u);this._unpackFlipY(void 0===Q?q.invertY:Q),y&&H.pixelStorei(H.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const a=this._getWebGLTextureType(q.type),R=this._getInternalFormat(x||q.format),L=this._getRGBABufferInternalSizedFormat(q.type,R);H.texImage2D(b,0,L,R,a,X),q.generateMipMaps&&H.generateMipmap(b),D||this._bindTextureDirectly(b,null),y&&H.pixelStorei(H.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),x&&(q.format=x),q._dynamicTextureSource=X,q._premulAlpha=y,q.invertY=Q||!1,q.isReady=!0};class D extends x.d{constructor(q,X,Q){let y=arguments.length>3&&void 0!==arguments[3]&&arguments[3],u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,H=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,b=arguments.length>6?arguments[6]:void 0;const D=!Q||Q._isScene;super(null,D?Q:null===Q||void 0===Q?void 0:Q.Le,D?!y:Q,b,u,void 0,void 0,void 0,void 0,H),this.name=q,this.wrapU=x.d.CLAMP_ADDRESSMODE,this.wrapV=x.d.CLAMP_ADDRESSMODE,this._generateMipMaps=y;const a=this._getEngine();if(!a)return;if(X.getContext)this._canvas=X,this._ownCanvas=!1,this._texture=a.createDynamicTexture(this._canvas.width,this._canvas.height,y,u);else{this._canvas=a.createCanvas(1,1),this._ownCanvas=!0;const q=X;q.width||0===q.width?this._texture=a.createDynamicTexture(q.width,q.height,y,u):this._texture=a.createDynamicTexture(X,X,y,u)}const R=this.getSize();this._canvas.width!==R.width&&(this._canvas.width=R.width),this._canvas.height!==R.height&&(this._canvas.height=R.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(q){this._canvas.width=q.width,this._canvas.height=q.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(q.width,q.height,this._generateMipMaps,this.samplingMode)}scale(q){const X=this.getSize();X.width*=q,X.height*=q,this._recreate(X)}scaleTo(q,X){const Q=this.getSize();Q.width=q,Q.height=X,this._recreate(Q)}getContext(){return this._context}clear(q){const X=this.getSize();q&&(this._context.fillStyle=q),this._context.clearRect(0,0,X.width,X.height)}update(q){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===q||q,X,this._format||void 0,void 0,Q)}drawText(q,X,Q,y,x,u,H){let b=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const D=this.getSize();if(u&&(this._context.fillStyle=u,this._context.fillRect(0,0,D.width,D.height)),this._context.font=y,null===X||void 0===X){const Q=this._context.measureText(q);X=(D.width-Q.width)/2}if(null===Q||void 0===Q){const q=parseInt(y.replace(/\D/g,""));Q=D.height/2+q/3.65}this._context.fillStyle=x||"",this._context.fillText(q,X,Q),b&&this.update(H)}dispose(){var q,X;(super.dispose(),this._ownCanvas)&&(null===(q=this._canvas)||void 0===q||null===(X=q.remove)||void 0===X||X.call(q));this._canvas=null,this._context=null}clone(){const q=this.va();if(!q)return this;const X=this.getSize(),Q=new D(this.name,X,q,this._generateMipMaps);return Q.fc=this.fc,Q.level=this.level,Q.wrapU=this.wrapU,Q.wrapV=this.wrapV,Q}serialize(){const q=this.va();q&&!q.isReady()&&y.b.Warn("The scene must be ready before serializing the dynamic texture");const X=super.serialize();return D._IsCanvasElement(this._canvas)&&(X.base64String=this._canvas.toDataURL()),X.invertY=this._invertY,X.samplingMode=this.samplingMode,X}static _IsCanvasElement(q){return void 0!==q.toDataURL}_rebuild(){this.update()}}},11408:(q,X,Q)=>{"use strict";Q.d(X,{c:()=>x});var y=Q(972);class x extends y.d{constructor(q,X,Q,x,u){let H=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],b=arguments.length>6&&void 0!==arguments[6]&&arguments[6],D=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,a=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,R=arguments.length>9?arguments[9]:void 0,L=arguments.length>10?arguments[10]:void 0;super(null,u,!H,b,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,R),this.format=x,this._engine&&(this._engine._caps.textureFloatLinearFiltering||1!==a||(D=1),this._engine._caps.textureHalfFloatLinearFiltering||2!==a||(D=1),this._texture=this._engine.createRawTexture(q,X,Q,x,H,b,D,null,a,R??0,L??!1),this.wrapU=y.d.CLAMP_ADDRESSMODE,this.wrapV=y.d.CLAMP_ADDRESSMODE)}update(q){this._getEngine().updateRawTexture(this._texture,q,this._texture.format,this._texture.invertY,null,this._texture.type,this._texture._useSRGBBuffer)}clone(){if(!this._texture)return super.clone();const q=new x(null,this.getSize().width,this.getSize().height,this.format,this.va(),this._texture.generateMipMaps,this._invertY,this.samplingMode,this._texture.type,this._texture._creationFlags,this._useSRGBBuffer);return q._texture=this._texture,this._texture.incrementReferences(),q}static CreateLuminanceTexture(q,X,Q,y){return new x(q,X,Q,1,y,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateLuminanceAlphaTexture(q,X,Q,y){return new x(q,X,Q,2,y,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateAlphaTexture(q,X,Q,y){return new x(q,X,Q,0,y,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateRGBTexture(q,X,Q,y){return new x(q,X,Q,4,y,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBATexture(q,X,Q,y){return new x(q,X,Q,5,y,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBAStorageTexture(q,X,Q,y){return new x(q,X,Q,5,y,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,1,arguments.length>8&&void 0!==arguments[8]&&arguments[8])}static CreateRTexture(q,X,Q,u){let H=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],b=arguments.length>5&&void 0!==arguments[5]&&arguments[5],D=arguments.length>6&&void 0!==arguments[6]?arguments[6]:y.d.TRILINEAR_SAMPLINGMODE;return new x(q,X,Q,6,u,H,b,D,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1)}static CreateRStorageTexture(q,X,Q,u){let H=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],b=arguments.length>5&&void 0!==arguments[5]&&arguments[5],D=arguments.length>6&&void 0!==arguments[6]?arguments[6]:y.d.TRILINEAR_SAMPLINGMODE;return new x(q,X,Q,6,u,H,b,D,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,1)}}},11307:(q,X,Q)=>{"use strict";Q.d(X,{b:()=>H});var y=Q(1331),x=Q(1175),u=Q(1015);class H extends y.b{get sg(){return this._subMaterials}set sg(q){this._subMaterials=q,this._hookArray(q)}getChildren(){return this.sg}constructor(q,X){super(q,X,!0),this._waitingSubMaterialsUniqueIds=[],this.va().addMultiMaterial(this),this.sg=[],this._storeEffectOnSubMeshes=!0}_hookArray(q){var X=this;const Q=q.push;q.push=function(){for(var y=arguments.length,x=new Array(y),u=0;u<y;u++)x[u]=arguments[u];const H=Q.apply(q,x);return X._markAllSubMeshesAsTexturesDirty(),H};const y=q.splice;q.splice=(X,Q)=>{const x=y.apply(q,[X,Q]);return this._markAllSubMeshesAsTexturesDirty(),x}}getSubMaterial(q){return q<0||q>=this.sg.length?this.va().defaultMaterial:this.sg[q]}getActiveTextures(){return super.getActiveTextures().concat(...this.sg.map((q=>q?q.getActiveTextures():[])))}hasTexture(q){if(super.hasTexture(q))return!0;for(let Q=0;Q<this.sg.length;Q++){var X;if(null!==(X=this.sg[Q])&&void 0!==X&&X.hasTexture(q))return!0}return!1}getClassName(){return"MultiMaterial"}isReadyForSubMesh(q,X,Q){for(let y=0;y<this.sg.length;y++){const x=this.sg[y];if(x){if(x._storeEffectOnSubMeshes){if(!x.isReadyForSubMesh(q,X,Q))return!1;continue}if(!x.isReady(q))return!1}}return!0}clone(q,X){const Q=new H(q,this.va());for(let y=0;y<this.sg.length;y++){let x=null;const u=this.sg[y];x=X&&u?u.clone(q+"-"+u.name):this.sg[y],Q.sg.push(x)}return Q}serialize(){const q={};q.name=this.name,q.id=this.id,q.uniqueId=this.uniqueId,x.d&&(q.tags=x.d.GetTags(this)),q.materialsUniqueIds=[],q.materials=[];for(let X=0;X<this.sg.length;X++){const Q=this.sg[X];Q?(q.materialsUniqueIds.push(Q.uniqueId),q.materials.push(Q.id)):(q.materialsUniqueIds.push(null),q.materials.push(null))}return q}dispose(q,X,Q){const y=this.va();if(!y)return;if(Q)for(let u=0;u<this.sg.length;u++){const Q=this.sg[u];Q&&Q.dispose(q,X)}const x=y.multiMaterials.indexOf(this);x>=0&&y.multiMaterials.splice(x,1),super.dispose(q,X)}static ParseMultiMaterial(q,X){const Q=new H(q.name,X);return Q.id=q.id,Q._loadedUniqueId=q.uniqueId,x.d&&x.d.AddTagsTo(Q,q.tags),q.materialsUniqueIds?Q._waitingSubMaterialsUniqueIds=q.materialsUniqueIds:q.materials.forEach((q=>Q.sg.push(X.getLastMaterialById(q)))),Q}}(0,u.h)("BABYLON.MultiMaterial",H)},11311:(q,X,Q)=>{"use strict";Q.d(X,{c:()=>R,e:()=>a});var y=Q(1002),x=Q(1182),u=Q(11253),H=Q(11276),b=Q(1195);Q(11315);function D(q){let X=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const Q=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],u=[];let D=[];const a=q.width||q.size||1,R=q.height||q.size||1,L=q.depth||q.size||1,f=q.wrap||!1;let k=void 0===q.topBaseAt?1:q.topBaseAt,j=void 0===q.bottomBaseAt?0:q.bottomBaseAt;k=(k+4)%4,j=(j+4)%4;let I=[2,0,3,1][k],d=[2,0,1,3][j],e=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(f){X=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],e=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let q=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],Q=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const y=[17,18,19,16],x=[22,23,20,21];for(;I>0;)q.unshift(q.pop()),y.unshift(y.pop()),I--;for(;d>0;)Q.unshift(Q.pop()),x.unshift(x.pop()),d--;q=q.flat(),Q=Q.flat(),e=e.concat(q).concat(Q),X.push(y[0],y[2],y[3],y[0],y[1],y[2]),X.push(x[0],x[2],x[3],x[0],x[1],x[2])}const i=[a/2,R/2,L/2];D=e.reduce(((q,X,Q)=>q.concat(X*i[Q%3])),[]);const A=0===q.sideOrientation?0:q.sideOrientation||H.d.DEFAULTSIDE,B=q.faceUV||new Array(6),w=q.faceColors,V=[];for(let H=0;H<6;H++)void 0===B[H]&&(B[H]=new y.q(0,0,1,1)),w&&void 0===w[H]&&(w[H]=new x.c(1,1,1,1));for(let y=0;y<6;y++)if(u.push(B[y].z,b.c?1-B[y].w:B[y].w),u.push(B[y].x,b.c?1-B[y].w:B[y].w),u.push(B[y].x,b.c?1-B[y].y:B[y].y),u.push(B[y].z,b.c?1-B[y].y:B[y].y),w)for(let q=0;q<4;q++)V.push(w[y].r,w[y].g,w[y].b,w[y].a);H.d._ComputeSides(A,D,X,Q,u,q.frontUVs,q.backUVs);const W=new H.d;if(W.indices=X,W.xa=D,W.ya=Q,W.Aa=u,w){const q=A===H.d.DOUBLESIDE?V.concat(V):V;W.za=q}return W}function a(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const y=new u.b(q,Q);X.sideOrientation=u.b._GetDefaultSideOrientation(X.sideOrientation),y._originalBuilderSideOrientation=X.sideOrientation;return D(X).Ca(y,X.updatable),y}const R={CreateBox:a};H.d.CreateBox=D,u.b.CreateBox=function(q,X){return a(q,{size:X,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},11421:(q,X,Q)=>{"use strict";Q.d(X,{b:()=>b});var y=Q(11253),x=Q(11276),u=Q(1195);function H(q){const X=[],Q=[],y=[],H=[],b=q.i||.5,D=q.Ok||64,a=q.arc&&(q.arc<=0||q.arc>1)?1:q.arc||1,R=0===q.sideOrientation?0:q.sideOrientation||x.d.DEFAULTSIDE;X.push(0,0,0),H.push(.5,.5);const L=2*Math.PI*a,f=1===a?L/D:L/(D-1);let k=0;for(let x=0;x<D;x++){const q=Math.cos(k),Q=Math.sin(k),y=(q+1)/2,x=(1-Q)/2;X.push(b*q,b*Q,0),H.push(y,u.c?1-x:x),k+=f}1===a&&(X.push(X[3],X[4],X[5]),H.push(H[2],u.c?1-H[3]:H[3]));const j=X.length/3;for(let x=1;x<j-1;x++)Q.push(x+1,0,x);x.d.ComputeNormals(X,Q,y),x.d._ComputeSides(R,X,Q,y,H,q.frontUVs,q.backUVs);const I=new x.d;return I.indices=Q,I.xa=X,I.ya=y,I.Aa=H,I}function b(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const x=new y.b(q,Q);X.sideOrientation=y.b._GetDefaultSideOrientation(X.sideOrientation),x._originalBuilderSideOrientation=X.sideOrientation;return H(X).Ca(x,X.updatable),x}x.d.nb=H,y.b.nb=function(q,X,Q){return b(q,{i:X,Ok:Q,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},11315:(q,X,Q)=>{"use strict";Q.d(X,{i:()=>d,e:()=>i,k:()=>e});var y=Q(1002),x=Q(1182),u=Q(11253),H=Q(11276),b=Q(1261);u.b._GroundMeshParser=(q,X)=>D.Parse(q,X);class D extends u.b{constructor(q,X){super(q,X),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=q,this._subdivisionsY=q,this.subdivide(q);const Q=this;Q.createOrUpdateSubmeshesOctree&&Q.createOrUpdateSubmeshesOctree(X)}getHeightAtCoordinates(q,X){const Q=this.getWorldMatrix(),x=y.h.Matrix[5];Q.invertToRef(x);const u=y.h.Od[8];if(y.n.TransformCoordinatesFromFloatsToRef(q,0,X,x,u),q=u.x,X=u.z,q<this._minX||q>=this._maxX||X<=this._minZ||X>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const H=this._getFacetAt(q,X),b=-(H.x*q+H.z*X+H.w)/H.y;return y.n.TransformCoordinatesFromFloatsToRef(0,b,0,Q,u),u.y}getNormalAtCoordinates(q,X){const Q=new y.n(0,1,0);return this.getNormalAtCoordinatesToRef(q,X,Q),Q}getNormalAtCoordinatesToRef(q,X,Q){const x=this.getWorldMatrix(),u=y.h.Matrix[5];x.invertToRef(u);const H=y.h.Od[8];if(y.n.TransformCoordinatesFromFloatsToRef(q,0,X,u,H),q=H.x,X=H.z,q<this._minX||q>this._maxX||X<this._minZ||X>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const b=this._getFacetAt(q,X);return y.n.TransformNormalFromFloatsToRef(b.x,b.y,b.z,x,Q),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(q,X){const Q=Math.floor((q+this._maxX)*this._subdivisionsX/this._width),y=Math.floor(-(X+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),x=this._heightQuads[y*this._subdivisionsX+Q];let u;return u=X<x.slope.x*q+x.slope.y?x.facet1:x.facet2,u}_initHeightQuads(){const q=this._subdivisionsX,X=this._subdivisionsY;this._heightQuads=new Array;for(let Q=0;Q<X;Q++)for(let X=0;X<q;X++){const x={slope:y.k.Zero(),facet1:new y.q(0,0,0,0),facet2:new y.q(0,0,0,0)};this._heightQuads[Q*q+X]=x}return this}_computeHeightQuads(){const q=this.getVerticesData(b.c.PositionKind);if(!q)return this;const X=y.h.Od[3],Q=y.h.Od[2],x=y.h.Od[1],u=y.h.Od[0],H=y.h.Od[4],D=y.h.Od[5],a=y.h.Od[6],R=y.h.Od[7],L=y.h.Od[8];let f=0,k=0,j=0,I=0,d=0,e=0,i=0;const A=this._subdivisionsX,B=this._subdivisionsY;for(let b=0;b<B;b++)for(let B=0;B<A;B++){f=3*B,k=b*(A+1)*3,j=(b+1)*(A+1)*3,X.x=q[k+f],X.y=q[k+f+1],X.z=q[k+f+2],Q.x=q[k+f+3],Q.y=q[k+f+4],Q.z=q[k+f+5],x.x=q[j+f],x.y=q[j+f+1],x.z=q[j+f+2],u.x=q[j+f+3],u.y=q[j+f+4],u.z=q[j+f+5],I=(u.z-X.z)/(u.x-X.x),d=X.z-I*X.x,Q.subtractToRef(X,H),x.subtractToRef(X,D),u.subtractToRef(X,a),y.n.CrossToRef(a,D,R),y.n.CrossToRef(H,a,L),R.normalize(),L.normalize(),e=-(R.x*X.x+R.y*X.y+R.z*X.z),i=-(L.x*Q.x+L.y*Q.y+L.z*Q.z);const w=this._heightQuads[b*A+B];w.slope.Pd(I,d),w.facet1.Pd(R.x,R.y,R.z,e),w.facet2.Pd(L.x,L.y,L.z,i)}return this}serialize(q){super.serialize(q),q.subdivisionsX=this._subdivisionsX,q.subdivisionsY=this._subdivisionsY,q.minX=this._minX,q.maxX=this._maxX,q._i=this._minZ,q.maxZ=this._maxZ,q.width=this._width,q.height=this._height}static Parse(q,X){const Q=new D(q.name,X);return Q._subdivisionsX=q.subdivisionsX||1,Q._subdivisionsY=q.subdivisionsY||1,Q._minX=q.minX,Q._maxX=q.maxX,Q._minZ=q._i,Q._maxZ=q.maxZ,Q._width=q.width,Q._height=q.height,Q}}var a=Q(1215),R=Q(1028),L=Q(1004),f=Q(1195);function k(q){const X=[],Q=[],x=[],u=[];let b,D;const a=q.width||q.size||1,R=q.height||q.size||1,L=0|(q.subdivisionsX||q.subdivisions||1),k=0|(q.subdivisionsY||q.subdivisions||1);for(b=0;b<=k;b++)for(D=0;D<=L;D++){const q=new y.n(D*a/L-a/2,0,(k-b)*R/k-R/2),X=new y.n(0,1,0);Q.push(q.x,q.y,q.z),x.push(X.x,X.y,X.z),u.push(D/L,f.c?b/k:1-b/k)}for(b=0;b<k;b++)for(D=0;D<L;D++)X.push(D+1+(b+1)*(L+1)),X.push(D+1+b*(L+1)),X.push(D+b*(L+1)),X.push(D+(b+1)*(L+1)),X.push(D+1+(b+1)*(L+1)),X.push(D+b*(L+1));const j=new H.d;return j.indices=X,j.xa=Q,j.ya=x,j.Aa=u,j}function j(q){const X=void 0!==q.xmin&&null!==q.xmin?q.xmin:-1,Q=void 0!==q.zmin&&null!==q.zmin?q.zmin:-1,x=void 0!==q.xmax&&null!==q.xmax?q.xmax:1,u=void 0!==q.zmax&&null!==q.zmax?q.zmax:1,b=q.subdivisions||{w:1,h:1},D=q.precision||{w:1,h:1},a=[],R=[],L=[],f=[];let k,j,I,d;b.h=b.h<1?1:b.h,b.w=b.w<1?1:b.w,D.w=D.w<1?1:D.w,D.h=D.h<1?1:D.h;const e=(x-X)/b.w,i=(u-Q)/b.h;function A(q,X,Q,x){const u=R.length/3,H=D.w+1;for(k=0;k<D.h;k++)for(j=0;j<D.w;j++){const q=[u+j+k*H,u+(j+1)+k*H,u+(j+1)+(k+1)*H,u+j+(k+1)*H];a.push(q[1]),a.push(q[2]),a.push(q[3]),a.push(q[0]),a.push(q[1]),a.push(q[3])}const b=y.n.Zero(),I=new y.n(0,1,0);for(k=0;k<=D.h;k++)for(b.z=k*(x-X)/D.h+X,j=0;j<=D.w;j++)b.x=j*(Q-q)/D.w+q,b.y=0,R.push(b.x,b.y,b.z),L.push(I.x,I.y,I.z),f.push(j/D.w,k/D.h)}for(I=0;I<b.h;I++)for(d=0;d<b.w;d++)A(X+d*e,Q+I*i,X+(d+1)*e,Q+(I+1)*i);const B=new H.d;return B.indices=a,B.xa=R,B.ya=L,B.Aa=f,B}function I(q){const X=[],Q=[],u=[],b=[];let D,a;const R=q.colorFilter||new x.b(.3,.59,.11),f=q.alphaFilter||0;let k=!1;if(q.minHeight>q.maxHeight){k=!0;const X=q.maxHeight;q.maxHeight=q.minHeight,q.minHeight=X}for(D=0;D<=q.subdivisions;D++)for(a=0;a<=q.subdivisions;a++){const X=new y.n(a*q.width/q.subdivisions-q.width/2,0,(q.subdivisions-D)*q.height/q.subdivisions-q.height/2),x=4*(((X.x+q.width/2)/q.width*(q.bufferWidth-1)|0)+((1-(X.z+q.height/2)/q.height)*(q.bufferHeight-1)|0)*q.bufferWidth);let H=q.buffer[x]/255,j=q.buffer[x+1]/255,I=q.buffer[x+2]/255;const d=q.buffer[x+3]/255;k&&(H=1-H,j=1-j,I=1-I);const e=H*R.r+j*R.g+I*R.b;X.y=d>=f?q.minHeight+(q.maxHeight-q.minHeight)*e:q.minHeight-L.b,q.heightBuffer&&(q.heightBuffer[D*(q.subdivisions+1)+a]=X.y),Q.push(X.x,X.y,X.z),u.push(0,0,0),b.push(a/q.subdivisions,1-D/q.subdivisions)}for(D=0;D<q.subdivisions;D++)for(a=0;a<q.subdivisions;a++){const y=a+1+(D+1)*(q.subdivisions+1),x=a+1+D*(q.subdivisions+1),u=a+D*(q.subdivisions+1),H=a+(D+1)*(q.subdivisions+1),b=Q[3*y+1]>=q.minHeight,R=Q[3*x+1]>=q.minHeight,L=Q[3*u+1]>=q.minHeight;b&&R&&L&&(X.push(y),X.push(x),X.push(u));Q[3*H+1]>=q.minHeight&&b&&L&&(X.push(H),X.push(y),X.push(u))}H.d.ComputeNormals(Q,X,u);const j=new H.d;return j.indices=X,j.xa=Q,j.ya=u,j.Aa=b,j}function d(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const Q=new D(q,arguments.length>2?arguments[2]:void 0);Q._setReady(!1),Q._subdivisionsX=X.subdivisionsX||X.subdivisions||1,Q._subdivisionsY=X.subdivisionsY||X.subdivisions||1,Q._width=X.width||1,Q._height=X.height||1,Q._maxX=Q._width/2,Q._maxZ=Q._height/2,Q._minX=-Q._maxX,Q._minZ=-Q._maxZ;return k(X).Ca(Q,X.updatable),Q._setReady(!0),Q}function e(q,X){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const y=new u.b(q,Q);return j(X).Ca(y,X.updatable),y}function i(q,X){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const u=Q.width||10,H=Q.height||10,b=Q.subdivisions||1,L=Q.minHeight||0,f=Q.maxHeight||1,k=Q.colorFilter||new x.b(.3,.59,.11),j=Q.alphaFilter||0,d=Q.updatable,e=Q.onReady;y=y||R.c.LastCreatedScene;const i=new D(q,y);let A;i._subdivisionsX=b,i._subdivisionsY=b,i._width=u,i._height=H,i._maxX=i._width/2,i._maxZ=i._height/2,i._minX=-i._maxX,i._minZ=-i._maxZ,i._setReady(!1),Q.passHeightBufferInCallback&&(A=new Float32Array((b+1)*(b+1)));const B=(q,X,Q)=>{I({width:u,height:H,subdivisions:b,minHeight:L,maxHeight:f,colorFilter:k,buffer:q,bufferWidth:X,bufferHeight:Q,alphaFilter:j,heightBuffer:A}).Ca(i,d),e&&e(i,A),i._setReady(!0)};if("string"===typeof X){const q=q=>{var X;const Q=q.width,x=q.height;if(y.u)return;const u=null===(X=y)||void 0===X?void 0:X.getEngine().resizeImageBitmap(q,Q,x);B(u,Q,x)};a.f.LoadImage(X,q,Q.onError?Q.onError:()=>{},y.offlineProvider)}else B(X.data,X.width,X.height);return i}H.d.CreateGround=k,H.d.CreateTiledGround=j,H.d.CreateGroundFromHeightMap=I,u.b.CreateGround=(q,X,Q,y,x,u)=>d(q,{width:X,height:Q,subdivisions:y,updatable:u},x),u.b.CreateTiledGround=(q,X,Q,y,x,u,H,b,D)=>e(q,{xmin:X,zmin:Q,xmax:y,zmax:x,subdivisions:u,precision:H,updatable:D},b),u.b.CreateGroundFromHeightMap=(q,X,Q,y,x,u,H,b,D,a,R)=>i(q,X,{width:Q,height:y,subdivisions:x,minHeight:u,maxHeight:H,updatable:D,onReady:a,alphaFilter:R},b)},12224:(q,X,Q)=>{"use strict";Q.d(X,{c:()=>P,e:()=>O,i:()=>g});var y=Q(1002),x=Q(11253),u=Q(11276),H=Q(1182),b=Q(1261),D=Q(11907),a=Q(1331),R=Q(1173),L=Q(1206),f=Q(972),k=Q(1015),j=Q(1400),I=Q(1059),d=Q(1390),e=Q(1028),i=Q(1378),A=Q(1374);const B={effect:null,subMesh:null};class w extends d.e{constructor(q,X,Q){let x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(q,X,!(arguments.length>4&&void 0!==arguments[4])||arguments[4]),this._textures={},this._textureArrays={},this._externalTextures={},this._floats={},this._ints={},this._uints={},this._floatsArrays={},this._colors3={},this._colors3Arrays={},this._colors4={},this._colors4Arrays={},this._vectors2={},this._vectors3={},this._vectors4={},this._quaternions={},this._quaternionsArrays={},this._matrices={},this._matrixArrays={},this._matrices3x3={},this._matrices2x2={},this._vectors2Arrays={},this._vectors3Arrays={},this._vectors4Arrays={},this._uniformBuffers={},this._textureSamplers={},this._storageBuffers={},this._cachedWorldViewMatrix=new y.b,this._cachedWorldViewProjectionMatrix=new y.b,this._multiview=!1,this._materialHelperNeedsPreviousMatrices=!1,this._shaderPath=Q,this._options={needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","qe","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],externalTextures:[],samplerObjects:[],storageBuffers:[],defines:[],useClipPlane:!1,...x}}get shaderPath(){return this._shaderPath}set shaderPath(q){this._shaderPath=q}get options(){return this._options}get isMultiview(){return this._multiview}getClassName(){return"ShaderMaterial"}needAlphaBlending(){return this.alpha<1||this._options.needAlphaBlending}needAlphaTesting(){return this._options.needAlphaTesting}_checkUniform(q){-1===this._options.uniforms.indexOf(q)&&this._options.uniforms.push(q)}setTexture(q,X){return-1===this._options.samplers.indexOf(q)&&this._options.samplers.push(q),this._textures[q]=X,this}removeTexture(q){delete this._textures[q]}setTextureArray(q,X){return-1===this._options.samplers.indexOf(q)&&this._options.samplers.push(q),this._checkUniform(q),this._textureArrays[q]=X,this}setExternalTexture(q,X){return-1===this._options.externalTextures.indexOf(q)&&this._options.externalTextures.push(q),this._externalTextures[q]=X,this}setFloat(q,X){return this._checkUniform(q),this._floats[q]=X,this}setInt(q,X){return this._checkUniform(q),this._ints[q]=X,this}setUInt(q,X){return this._checkUniform(q),this._uints[q]=X,this}setFloats(q,X){return this._checkUniform(q),this._floatsArrays[q]=X,this}setColor3(q,X){return this._checkUniform(q),this._colors3[q]=X,this}setColor3Array(q,X){return this._checkUniform(q),this._colors3Arrays[q]=X.reduce(((q,X)=>(X.toArray(q,q.length),q)),[]),this}setColor4(q,X){return this._checkUniform(q),this._colors4[q]=X,this}setColor4Array(q,X){return this._checkUniform(q),this._colors4Arrays[q]=X.reduce(((q,X)=>(X.toArray(q,q.length),q)),[]),this}setVector2(q,X){return this._checkUniform(q),this._vectors2[q]=X,this}setVector3(q,X){return this._checkUniform(q),this._vectors3[q]=X,this}setVector4(q,X){return this._checkUniform(q),this._vectors4[q]=X,this}setQuaternion(q,X){return this._checkUniform(q),this._quaternions[q]=X,this}setQuaternionArray(q,X){return this._checkUniform(q),this._quaternionsArrays[q]=X.reduce(((q,X)=>(X.toArray(q,q.length),q)),[]),this}setMatrix(q,X){return this._checkUniform(q),this._matrices[q]=X,this}setMatrices(q,X){this._checkUniform(q);const Q=new Float32Array(16*X.length);for(let y=0;y<X.length;y++){X[y].copyToArray(Q,16*y)}return this._matrixArrays[q]=Q,this}setMatrix3x3(q,X){return this._checkUniform(q),this._matrices3x3[q]=X,this}setMatrix2x2(q,X){return this._checkUniform(q),this._matrices2x2[q]=X,this}setArray2(q,X){return this._checkUniform(q),this._vectors2Arrays[q]=X,this}setArray3(q,X){return this._checkUniform(q),this._vectors3Arrays[q]=X,this}setArray4(q,X){return this._checkUniform(q),this._vectors4Arrays[q]=X,this}setUniformBuffer(q,X){return-1===this._options.uniformBuffers.indexOf(q)&&this._options.uniformBuffers.push(q),this._uniformBuffers[q]=X,this}setTextureSampler(q,X){return-1===this._options.samplerObjects.indexOf(q)&&this._options.samplerObjects.push(q),this._textureSamplers[q]=X,this}setStorageBuffer(q,X){return-1===this._options.storageBuffers.indexOf(q)&&this._options.storageBuffers.push(q),this._storageBuffers[q]=X,this}setDefine(q,X){const Q=q.trimEnd()+" ",y=this.options.defines.findIndex((X=>X===q||X.startsWith(Q)));return y>=0&&this.options.defines.splice(y,1),("boolean"!==typeof X||X)&&this.options.defines.push(Q+X),this}isReadyForSubMesh(q,X,Q){return this.isReady(q,Q,X)}isReady(q,X,Q){var y;const x=Q&&this._storeEffectOnSubMeshes;if(this.isFrozen){const q=x?Q._drawWrapper:this._drawWrapper;if(q.effect&&q._wasPreviouslyReady&&q._wasPreviouslyUsingInstances===X)return!0}const u=this.va(),H=u.getEngine(),D=[],a=[],R=new j.e;let f=this._shaderPath,k=this._options.uniforms,I=this._options.uniformBuffers,d=this._options.samplers;H.getCaps().multiview&&u.activeCamera&&u.activeCamera.outputRenderTarget&&u.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,D.push("#define MULTIVIEW"),-1!==k.indexOf("viewProjection")&&-1===k.indexOf("viewProjectionR")&&k.push("viewProjectionR"));for(let b=0;b<this._options.defines.length;b++){const q=0===this._options.defines[b].indexOf("#define")?this._options.defines[b]:`#define ${this._options.defines[b]}`;D.push(q)}for(let b=0;b<this._options.attributes.length;b++)a.push(this._options.attributes[b]);if(q&&q.isVerticesDataPresent(b.c.ColorKind)&&(-1===a.indexOf(b.c.ColorKind)&&a.push(b.c.ColorKind),D.push("#define VERTEXCOLOR")),X&&(D.push("#define INSTANCES"),(0,A.kb)(a,this._materialHelperNeedsPreviousMatrices),null!==q&&void 0!==q&&q.hasThinInstances&&(D.push("#define THIN_INSTANCES"),q&&q.isVerticesDataPresent(b.c.ColorInstanceKind)&&(a.push(b.c.ColorInstanceKind),D.push("#define INSTANCESCOLOR")))),q&&q.useBones&&q.computeBonesUsingShaders&&q.skeleton){a.push(b.c.MatricesIndicesKind),a.push(b.c.MatricesWeightsKind),q.numBoneInfluencers>4&&(a.push(b.c.MatricesIndicesExtraKind),a.push(b.c.MatricesWeightsExtraKind));const X=q.skeleton;D.push("#define NUM_BONE_INFLUENCERS "+q.numBoneInfluencers),R.addCPUSkinningFallback(0,q),X.isUsingTextureForMatrices?(D.push("#define BONETEXTURE"),-1===k.indexOf("boneTextureWidth")&&k.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(D.push("#define BonesPerMesh "+(X.bones.length+1)),-1===k.indexOf("mBones")&&k.push("mBones"))}else D.push("#define NUM_BONE_INFLUENCERS 0");let e=0;const w=q?q.morphTargetManager:null;if(w){const q=w.supportsUVs&&-1!==D.indexOf("#define UV1"),X=w.supportsTangents&&-1!==D.indexOf("#define TANGENT"),Q=w.supportsNormals&&-1!==D.indexOf("#define NORMAL");e=w.numMaxInfluencers||w.numInfluencers,q&&D.push("#define MORPHTARGETS_UV"),X&&D.push("#define MORPHTARGETS_TANGENT"),Q&&D.push("#define MORPHTARGETS_NORMAL"),e>0&&D.push("#define MORPHTARGETS"),w.isUsingTextureForTargets&&(D.push("#define MORPHTARGETS_TEXTURE"),-1===k.indexOf("morphTargetTextureIndices")&&k.push("morphTargetTextureIndices"),-1===this._options.samplers.indexOf("morphTargets")&&this._options.samplers.push("morphTargets")),D.push("#define NUM_MORPH_INFLUENCERS "+e);for(let y=0;y<e;y++)a.push(b.c.PositionKind+y),Q&&a.push(b.c.NormalKind+y),X&&a.push(b.c.TangentKind+y),q&&a.push(b.c.UVKind+"_"+y);e>0&&(k=k.slice(),k.push("morphTargetInfluences"),k.push("morphTargetCount"),k.push("morphTargetTextureInfo"),k.push("morphTargetTextureIndices"))}else D.push("#define NUM_MORPH_INFLUENCERS 0");if(q){const X=q.bakedVertexAnimationManager;X&&X.isEnabled&&(D.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),-1===k.indexOf("bakedVertexAnimationSettings")&&k.push("bakedVertexAnimationSettings"),-1===k.indexOf("bakedVertexAnimationTextureSizeInverted")&&k.push("bakedVertexAnimationTextureSizeInverted"),-1===k.indexOf("bakedVertexAnimationTime")&&k.push("bakedVertexAnimationTime"),-1===this._options.samplers.indexOf("bakedVertexAnimationTexture")&&this._options.samplers.push("bakedVertexAnimationTexture")),(0,A.z)(a,q,D)}for(const b in this._textures)if(!this._textures[b].isReady())return!1;q&&this._shouldTurnAlphaTestOn(q)&&D.push("#define ALPHATEST"),!1!==this._options.useClipPlane&&((0,i.e)(k),(0,i.j)(this,u,D)),u.fogEnabled&&null!==q&&void 0!==q&&q.applyFog&&u.fogMode!==L.d.FOGMODE_NONE&&(D.push("#define FOG"),-1===k.indexOf("view")&&k.push("view"),-1===k.indexOf("vFogInfos")&&k.push("vFogInfos"),-1===k.indexOf("vFogColor")&&k.push("vFogColor")),this._useLogarithmicDepth&&(D.push("#define LOGARITHMICDEPTH"),-1===k.indexOf("logarithmicDepthConstant")&&k.push("logarithmicDepthConstant")),this.customShaderNameResolve&&(k=k.slice(),I=I.slice(),d=d.slice(),f=this.customShaderNameResolve(this.name,k,I,d,D,a));const V=x?Q._getDrawWrapper(void 0,!0):this._drawWrapper,W=(null===V||void 0===V?void 0:V.effect)??null,v=(null===V||void 0===V?void 0:V.defines)??null,Z=D.join("\n");let U=W;return v!==Z&&(U=H.createEffect(f,{attributes:a,uniformsNames:k,uniformBuffersNames:I,samplers:d,defines:Z,fallbacks:R,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousMorphTargets:e},shaderLanguage:this._options.shaderLanguage,extraInitializationsAsync:this._options.extraInitializationsAsync},H),x?Q.setEffect(U,Z,this._materialContext):V&&V.setEffect(U,Z),this._onEffectCreatedObservable&&(B.effect=U,B.subMesh=Q??(null===q||void 0===q?void 0:q.be[0])??null,this._onEffectCreatedObservable.notifyObservers(B))),V._wasPreviouslyUsingInstances=!!X,!((null===(y=U)||void 0===y||!y.isReady())??1)&&(W!==U&&u.resetCachedMaterial(),V._wasPreviouslyReady=!0,!0)}bindOnlyWorldMatrix(q,X){const Q=this.va(),y=X??this.getEffect();y&&(-1!==this._options.uniforms.indexOf("world")&&y.setMatrix("world",q),-1!==this._options.uniforms.indexOf("worldView")&&(q.multiplyToRef(Q.getViewMatrix(),this._cachedWorldViewMatrix),y.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==this._options.uniforms.indexOf("worldViewProjection")&&(q.multiplyToRef(Q.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),y.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)),-1!==this._options.uniforms.indexOf("view")&&y.setMatrix("view",Q.getViewMatrix()))}bindForSubMesh(q,X,Q){var y;this.bind(q,X,null===(y=Q._drawWrapperOverride)||void 0===y?void 0:y.effect,Q)}bind(q,X,Q,y){const x=y&&this._storeEffectOnSubMeshes,u=Q??(x?y.effect:this.getEffect());if(!u)return;const H=this.va();this._activeEffect=u,this.bindOnlyWorldMatrix(q,Q);const b=this._options.uniformBuffers;let D=!1;if(u&&b&&b.length>0&&H.getEngine().supportsUniformBuffers)for(let L=0;L<b.length;++L){switch(b[L]){case"Mesh":X&&(X.getMeshUniformBuffer().bindToEffect(u,"Mesh"),X.transferToEffect(q));break;case"Scene":(0,A.p)(u,H.getSceneUniformBuffer()),H.finalizeSceneUbo(),D=!0}}const a=X&&x?this._mustRebind(H,u,y,X.visibility):H.getCachedMaterial()!==this;if(u&&a){let q;for(q in D||-1===this._options.uniforms.indexOf("view")||u.setMatrix("view",H.getViewMatrix()),D||-1===this._options.uniforms.indexOf("projection")||u.setMatrix("projection",H.getProjectionMatrix()),D||-1===this._options.uniforms.indexOf("viewProjection")||(u.setMatrix("viewProjection",H.getTransformMatrix()),this._multiview&&u.setMatrix("viewProjectionR",H._transformMatrixR)),H.activeCamera&&-1!==this._options.uniforms.indexOf("cameraPosition")&&u.setVector3("cameraPosition",H.activeCamera.globalPosition),(0,A.e)(X,u),(0,i.g)(u,this,H),this._useLogarithmicDepth&&(0,A.l)(x?y.materialDefines:u.defines,u,H),X&&(0,A.g)(H,X,u),this._textures)u.setTexture(q,this._textures[q]);for(q in this._textureArrays)u.setTextureArray(q,this._textureArrays[q]);for(q in this._ints)u.setInt(q,this._ints[q]);for(q in this._uints)u.setUInt(q,this._uints[q]);for(q in this._floats)u.setFloat(q,this._floats[q]);for(q in this._floatsArrays)u.setArray(q,this._floatsArrays[q]);for(q in this._colors3)u.setColor3(q,this._colors3[q]);for(q in this._colors3Arrays)u.setArray3(q,this._colors3Arrays[q]);for(q in this._colors4){const X=this._colors4[q];u.setFloat4(q,X.r,X.g,X.b,X.a)}for(q in this._colors4Arrays)u.setArray4(q,this._colors4Arrays[q]);for(q in this._vectors2)u.setVector2(q,this._vectors2[q]);for(q in this._vectors3)u.setVector3(q,this._vectors3[q]);for(q in this._vectors4)u.setVector4(q,this._vectors4[q]);for(q in this._quaternions)u.setQuaternion(q,this._quaternions[q]);for(q in this._matrices)u.setMatrix(q,this._matrices[q]);for(q in this._matrixArrays)u.setMatrices(q,this._matrixArrays[q]);for(q in this._matrices3x3)u.setMatrix3x3(q,this._matrices3x3[q]);for(q in this._matrices2x2)u.setMatrix2x2(q,this._matrices2x2[q]);for(q in this._vectors2Arrays)u.setArray2(q,this._vectors2Arrays[q]);for(q in this._vectors3Arrays)u.setArray3(q,this._vectors3Arrays[q]);for(q in this._vectors4Arrays)u.setArray4(q,this._vectors4Arrays[q]);for(q in this._quaternionsArrays)u.setArray4(q,this._quaternionsArrays[q]);for(q in this._uniformBuffers){const X=this._uniformBuffers[q].getBuffer();X&&u.bindUniformBuffer(X,q)}const Q=H.getEngine(),b=Q.setExternalTexture;if(b)for(q in this._externalTextures)b.call(Q,q,this._externalTextures[q]);const a=Q.setTextureSampler;if(a)for(q in this._textureSamplers)a.call(Q,q,this._textureSamplers[q]);const R=Q.setStorageBuffer;if(R)for(q in this._storageBuffers)R.call(Q,q,this._storageBuffers[q])}if(u&&X&&(a||!this.isFrozen)){const q=X.morphTargetManager;q&&q.numInfluencers>0&&(0,A.o)(X,u);const Q=X.bakedVertexAnimationManager;if(Q&&Q.isEnabled){var R;const q=x?y._drawWrapper:this._drawWrapper;null===(R=X.bakedVertexAnimationManager)||void 0===R||R.bind(u,!!q._wasPreviouslyUsingInstances)}}this._afterBind(X,u,y)}getActiveTextures(){const q=super.getActiveTextures();for(const X in this._textures)q.push(this._textures[X]);for(const X in this._textureArrays){const Q=this._textureArrays[X];for(let X=0;X<Q.length;X++)q.push(Q[X])}return q}hasTexture(q){if(super.hasTexture(q))return!0;for(const X in this._textures)if(this._textures[X]===q)return!0;for(const X in this._textureArrays){const Q=this._textureArrays[X];for(let X=0;X<Q.length;X++)if(Q[X]===q)return!0}return!1}clone(q){const X=R.c.Clone((()=>new w(q,this.va(),this._shaderPath,this._options,this._storeEffectOnSubMeshes)),this);X.name=q,X.id=q,"object"===typeof X._shaderPath&&(X._shaderPath={...X._shaderPath}),this._options={...this._options},Object.keys(this._options).forEach((q=>{const X=this._options[q];Array.isArray(X)&&(this._options[q]=X.slice(0))})),this.stencil.copyTo(X.stencil);for(const Q in this._textures)X.setTexture(Q,this._textures[Q]);for(const Q in this._textureArrays)X.setTextureArray(Q,this._textureArrays[Q]);for(const Q in this._externalTextures)X.setExternalTexture(Q,this._externalTextures[Q]);for(const Q in this._ints)X.setInt(Q,this._ints[Q]);for(const Q in this._uints)X.setUInt(Q,this._uints[Q]);for(const Q in this._floats)X.setFloat(Q,this._floats[Q]);for(const Q in this._floatsArrays)X.setFloats(Q,this._floatsArrays[Q]);for(const Q in this._colors3)X.setColor3(Q,this._colors3[Q]);for(const Q in this._colors3Arrays)X._colors3Arrays[Q]=this._colors3Arrays[Q];for(const Q in this._colors4)X.setColor4(Q,this._colors4[Q]);for(const Q in this._colors4Arrays)X._colors4Arrays[Q]=this._colors4Arrays[Q];for(const Q in this._vectors2)X.setVector2(Q,this._vectors2[Q]);for(const Q in this._vectors3)X.setVector3(Q,this._vectors3[Q]);for(const Q in this._vectors4)X.setVector4(Q,this._vectors4[Q]);for(const Q in this._quaternions)X.setQuaternion(Q,this._quaternions[Q]);for(const Q in this._quaternionsArrays)X._quaternionsArrays[Q]=this._quaternionsArrays[Q];for(const Q in this._matrices)X.setMatrix(Q,this._matrices[Q]);for(const Q in this._matrixArrays)X._matrixArrays[Q]=this._matrixArrays[Q].slice();for(const Q in this._matrices3x3)X.setMatrix3x3(Q,this._matrices3x3[Q]);for(const Q in this._matrices2x2)X.setMatrix2x2(Q,this._matrices2x2[Q]);for(const Q in this._vectors2Arrays)X.setArray2(Q,this._vectors2Arrays[Q]);for(const Q in this._vectors3Arrays)X.setArray3(Q,this._vectors3Arrays[Q]);for(const Q in this._vectors4Arrays)X.setArray4(Q,this._vectors4Arrays[Q]);for(const Q in this._uniformBuffers)X.setUniformBuffer(Q,this._uniformBuffers[Q]);for(const Q in this._textureSamplers)X.setTextureSampler(Q,this._textureSamplers[Q]);for(const Q in this._storageBuffers)X.setStorageBuffer(Q,this._storageBuffers[Q]);return X}dispose(q,X,Q){if(X){let q;for(q in this._textures)this._textures[q].dispose();for(q in this._textureArrays){const X=this._textureArrays[q];for(let q=0;q<X.length;q++)X[q].dispose()}}this._textures={},super.dispose(q,X,Q)}serialize(){const q=R.c.Serialize(this);let X;for(X in q.customType="BABYLON.ShaderMaterial",q.uniqueId=this.uniqueId,q.options=this._options,q.shaderPath=this._shaderPath,q.storeEffectOnSubMeshes=this._storeEffectOnSubMeshes,q.stencil=this.stencil.serialize(),q.textures={},this._textures)q.textures[X]=this._textures[X].serialize();for(X in q.textureArrays={},this._textureArrays){q.textureArrays[X]=[];const Q=this._textureArrays[X];for(let y=0;y<Q.length;y++)q.textureArrays[X].push(Q[y].serialize())}for(X in q.ints={},this._ints)q.ints[X]=this._ints[X];for(X in q.uints={},this._uints)q.uints[X]=this._uints[X];for(X in q.floats={},this._floats)q.floats[X]=this._floats[X];for(X in q.floatsArrays={},this._floatsArrays)q.floatsArrays[X]=this._floatsArrays[X];for(X in q.colors3={},this._colors3)q.colors3[X]=this._colors3[X].ee();for(X in q.colors3Arrays={},this._colors3Arrays)q.colors3Arrays[X]=this._colors3Arrays[X];for(X in q.colors4={},this._colors4)q.colors4[X]=this._colors4[X].ee();for(X in q.colors4Arrays={},this._colors4Arrays)q.colors4Arrays[X]=this._colors4Arrays[X];for(X in q.vectors2={},this._vectors2)q.vectors2[X]=this._vectors2[X].ee();for(X in q.vectors3={},this._vectors3)q.vectors3[X]=this._vectors3[X].ee();for(X in q.vectors4={},this._vectors4)q.vectors4[X]=this._vectors4[X].ee();for(X in q.quaternions={},this._quaternions)q.quaternions[X]=this._quaternions[X].ee();for(X in q.matrices={},this._matrices)q.matrices[X]=this._matrices[X].ee();for(X in q.matrixArray={},this._matrixArrays)q.matrixArray[X]=this._matrixArrays[X];for(X in q.matrices3x3={},this._matrices3x3)q.matrices3x3[X]=this._matrices3x3[X];for(X in q.matrices2x2={},this._matrices2x2)q.matrices2x2[X]=this._matrices2x2[X];for(X in q.vectors2Arrays={},this._vectors2Arrays)q.vectors2Arrays[X]=this._vectors2Arrays[X];for(X in q.vectors3Arrays={},this._vectors3Arrays)q.vectors3Arrays[X]=this._vectors3Arrays[X];for(X in q.vectors4Arrays={},this._vectors4Arrays)q.vectors4Arrays[X]=this._vectors4Arrays[X];for(X in q.quaternionsArrays={},this._quaternionsArrays)q.quaternionsArrays[X]=this._quaternionsArrays[X];return q}static Parse(q,X,Q){const x=R.c.Parse((()=>new w(q.name,X,q.shaderPath,q.options,q.storeEffectOnSubMeshes)),q,X,Q);let u;for(u in q.stencil&&x.stencil.parse(q.stencil,X,Q),q.textures)x.setTexture(u,f.d.Parse(q.textures[u],X,Q));for(u in q.textureArrays){const y=q.textureArrays[u],H=[];for(let q=0;q<y.length;q++)H.push(f.d.Parse(y[q],X,Q));x.setTextureArray(u,H)}for(u in q.ints)x.setInt(u,q.ints[u]);for(u in q.uints)x.setUInt(u,q.uints[u]);for(u in q.floats)x.setFloat(u,q.floats[u]);for(u in q.floatsArrays)x.setFloats(u,q.floatsArrays[u]);for(u in q.colors3)x.setColor3(u,H.b.Rd(q.colors3[u]));for(u in q.colors3Arrays){const X=q.colors3Arrays[u].reduce(((q,X,Q)=>(Q%3===0?q.push([X]):q[q.length-1].push(X),q)),[]).map((q=>H.b.Rd(q)));x.setColor3Array(u,X)}for(u in q.colors4)x.setColor4(u,H.c.Rd(q.colors4[u]));for(u in q.colors4Arrays){const X=q.colors4Arrays[u].reduce(((q,X,Q)=>(Q%4===0?q.push([X]):q[q.length-1].push(X),q)),[]).map((q=>H.c.Rd(q)));x.setColor4Array(u,X)}for(u in q.vectors2)x.setVector2(u,y.k.Rd(q.vectors2[u]));for(u in q.vectors3)x.setVector3(u,y.n.Rd(q.vectors3[u]));for(u in q.vectors4)x.setVector4(u,y.q.Rd(q.vectors4[u]));for(u in q.quaternions)x.setQuaternion(u,y.d.Rd(q.quaternions[u]));for(u in q.matrices)x.setMatrix(u,y.b.Rd(q.matrices[u]));for(u in q.matrixArray)x._matrixArrays[u]=new Float32Array(q.matrixArray[u]);for(u in q.matrices3x3)x.setMatrix3x3(u,q.matrices3x3[u]);for(u in q.matrices2x2)x.setMatrix2x2(u,q.matrices2x2[u]);for(u in q.vectors2Arrays)x.setArray2(u,q.vectors2Arrays[u]);for(u in q.vectors3Arrays)x.setArray3(u,q.vectors3Arrays[u]);for(u in q.vectors4Arrays)x.setArray4(u,q.vectors4Arrays[u]);for(u in q.quaternionsArrays)x.setArray4(u,q.quaternionsArrays[u]);return x}static ParseFromFileAsync(q,X,Q){let y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return new Promise(((x,u)=>{const H=new I.c;H.addEventListener("readystatechange",(()=>{if(4==H.readyState)if(200==H.status){const X=JSON.parse(H.responseText),u=this.Parse(X,Q||e.c.LastCreatedScene,y);q&&(u.name=q),x(u)}else u("Unable to load the ShaderMaterial")})),H.open("GET",X),H.send()}))}static ParseFromSnippetAsync(q,X){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Promise(((y,x)=>{const u=new I.c;u.addEventListener("readystatechange",(()=>{if(4==u.readyState)if(200==u.status){const x=JSON.parse(JSON.parse(u.responseText).jsonPayload),H=JSON.parse(x.shaderMaterial),b=this.Parse(H,X||e.c.LastCreatedScene,Q);b.snippetId=q,y(b)}else x("Unable to load the snippet "+q)})),u.open("GET",this.SnippetUrl+"/"+q.replace(/#/g,"/")),u.send()}))}}w.SnippetUrl="https://snippet.babylonjs.com",w.CreateFromSnippetAsync=w.ParseFromSnippetAsync,(0,k.h)("BABYLON.ShaderMaterial",w),x.b._LinesMeshParser=(q,X)=>V.Parse(q,X);class V extends x.b{_isShaderMaterial(q){return"ShaderMaterial"===q.getClassName()}constructor(q){let X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,y=arguments.length>5?arguments[5]:void 0,x=arguments.length>6?arguments[6]:void 0,u=arguments.length>7?arguments[7]:void 0;super(q,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,X,arguments.length>4?arguments[4]:void 0),this.useVertexColor=y,this.useVertexAlpha=x,this.color=new H.b(1,1,1),this.alpha=1,this._shaderLanguage=0,X&&(this.color=X.color.clone(),this.alpha=X.alpha,this.useVertexColor=X.useVertexColor,this.useVertexAlpha=X.useVertexAlpha),this.intersectionThreshold=.1;const D={attributes:[b.c.PositionKind],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:[],useClipPlane:null,shaderLanguage:0};if(!1===x?D.needAlphaBlending=!1:D.defines.push("#define VERTEXALPHA"),y?(D.defines.push("#define VERTEXCOLOR"),D.attributes.push(b.c.ColorKind)):(D.uniforms.push("color"),this._color4=new H.c),u)this.material=u;else{this.va().getEngine().isWebGPU&&!V.ForceGLSL&&(this._shaderLanguage=1),D.shaderLanguage=this._shaderLanguage,D.extraInitializationsAsync=async()=>{1===this._shaderLanguage?await Promise.all([Q.e(19).then(Q.bind(Q,12568)),Q.e(48).then(Q.bind(Q,12575))]):await Promise.all([Q.e(26).then(Q.bind(Q,12583)),Q.e(49).then(Q.bind(Q,12585))])},this.material=new w("colorShader",this.va(),"color",D,!1),this.material.doNotSerialize=!0}}isReady(){return!!this._lineMaterial.isReady(this,!!this._userInstancedBuffersStorage||this.hasThinInstances)&&super.isReady()}getClassName(){return"LinesMesh"}get material(){return this._lineMaterial}set material(q){this._lineMaterial=q,this._lineMaterial.fillMode=a.b.LineListDrawMode}get checkCollisions(){return!1}set checkCollisions(q){}_bind(q,X){if(!this._geometry)return this;const Q=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(!this._userInstancedBuffersStorage||this.hasThinInstances?this._geometry._bind(X,Q):this._geometry._bind(X,Q,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects),!this.useVertexColor&&this._isShaderMaterial(this._lineMaterial)){const{r:q,g:X,b:Q}=this.color;this._color4.set(q,X,Q,this.alpha),this._lineMaterial.setColor4("color",this._color4)}return this}_draw(q,X,Q){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const y=this.va().getEngine();return this._unIndexed?y.drawArraysType(a.b.LineListDrawMode,q.verticesStart,q.verticesCount,Q):y.drawElementsType(a.b.LineListDrawMode,q.indexStart,q.indexCount,Q),this}dispose(q){(arguments.length>2?arguments[2]:void 0)||this._lineMaterial.dispose(!1,!1,!0),super.dispose(q)}clone(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Q=arguments.length>2?arguments[2]:void 0;return new V(q,this.va(),X,this,Q)}kd(q){const X=new W(q,this);if(this.instancedBuffers){X.instancedBuffers={};for(const q in this.instancedBuffers)X.instancedBuffers[q]=this.instancedBuffers[q]}return X}serialize(q){super.serialize(q),q.color=this.color.ee(),q.alpha=this.alpha}static Parse(q,X){const Q=new V(q.name,X);return Q.color=H.b.Rd(q.color),Q.alpha=q.alpha,Q}}V.ForceGLSL=!1;class W extends D.d{constructor(q,X){super(q,X),this.intersectionThreshold=X.intersectionThreshold}getClassName(){return"InstancedLinesMesh"}}var v=Q(1099);function Z(q){const X=[],Q=[],y=q.lines,x=q.za,H=[];let b=0;for(let u=0;u<y.length;u++){const q=y[u];for(let y=0;y<q.length;y++){const{x:D,y:a,z:R}=q[y];if(Q.push(D,a,R),x){const q=x[u],{r:X,g:Q,b:b,a:D}=q[y];H.push(X,Q,b,D)}y>0&&(X.push(b-1),X.push(b)),b++}}const D=new u.d;return D.indices=X,D.xa=Q,x&&(D.za=H),D}function U(q){const X=q.dashSize||3,Q=q.gapSize||1,x=q.dashNb||200,H=q.points,b=[],D=[],a=y.n.Zero();let R=0,L=0,f=0,k=0,j=0,I=0,d=0;for(d=0;d<H.length-1;d++)H[d+1].subtractToRef(H[d],a),R+=a.length();for(f=R/x,k=X*f/(X+Q),d=0;d<H.length-1;d++){H[d+1].subtractToRef(H[d],a),L=Math.floor(a.length()/f),a.normalize();for(let q=0;q<L;q++)j=f*q,b.push(H[d].x+j*a.x,H[d].y+j*a.y,H[d].z+j*a.z),b.push(H[d].x+(j+k)*a.x,H[d].y+(j+k)*a.y,H[d].z+(j+k)*a.z),D.push(I,I+1),I+=2}const e=new u.d;return e.xa=b,e.indices=D,e}function O(q,X){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const y=X.instance,x=X.lines,u=X.za;if(y){const q=y.getVerticesData(b.c.PositionKind);let X,Q;u&&(X=y.getVerticesData(b.c.ColorKind));let H=0,D=0;for(let y=0;y<x.length;y++){const b=x[y];for(let x=0;x<b.length;x++)q[H]=b[x].x,q[H+1]=b[x].y,q[H+2]=b[x].z,u&&X&&(Q=u[y],X[D]=Q[x].r,X[D+1]=Q[x].g,X[D+2]=Q[x].b,X[D+3]=Q[x].a,D+=4),H+=3}return y.updateVerticesData(b.c.PositionKind,q,!1,!1),u&&X&&y.updateVerticesData(b.c.ColorKind,X,!1,!1),y.refreshBoundingInfo(),y}const H=new V(q,Q,null,void 0,void 0,!!u,X.useVertexAlpha,X.material);return Z(X).Ca(H,X.updatable),H}function g(q,X){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const y=X.za?[X.za]:null;return O(q,{lines:[X.points],updatable:X.updatable,instance:X.instance,za:y,useVertexAlpha:X.useVertexAlpha,material:X.material},Q)}function P(q,X){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const u=X.points,H=X.instance,b=X.gapSize||1,D=X.dashSize||3;if(H){const q=q=>{const X=y.n.Zero(),Q=q.length/6;let x=0,b=0,D=0,a=0,R=0,L=0,f=0,k=0;for(f=0;f<u.length-1;f++)u[f+1].subtractToRef(u[f],X),x+=X.length();D=x/Q;const j=H._creationDataStorage.dashSize;for(a=j*D/(j+H._creationDataStorage.gapSize),f=0;f<u.length-1;f++)for(u[f+1].subtractToRef(u[f],X),b=Math.floor(X.length()/D),X.normalize(),k=0;k<b&&L<q.length;)R=D*k,q[L]=u[f].x+R*X.x,q[L+1]=u[f].y+R*X.y,q[L+2]=u[f].z+R*X.z,q[L+3]=u[f].x+(R+a)*X.x,q[L+4]=u[f].y+(R+a)*X.y,q[L+5]=u[f].z+(R+a)*X.z,L+=6,k++;for(;L<q.length;)q[L]=u[f].x,q[L+1]=u[f].y,q[L+2]=u[f].z,L+=3};return(X.dashNb||X.dashSize||X.gapSize||X.useVertexAlpha||X.material)&&v.b.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),H.updateMeshPositions(q,!1),H}const a=new V(q,Q,null,void 0,void 0,void 0,X.useVertexAlpha,X.material);return U(X).Ca(a,X.updatable),a._creationDataStorage=new x.c,a._creationDataStorage.dashSize=D,a._creationDataStorage.gapSize=b,a}u.d.CreateLineSystem=Z,u.d.CreateDashedLines=U,x.b.pb=function(q,X){return g(q,{points:X,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},x.b.CreateDashedLines=function(q,X,Q,y,x){return P(q,{points:X,dashSize:Q,gapSize:y,dashNb:x,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},11370:(q,X,Q)=>{"use strict";Q.d(X,{e:()=>b,h:()=>D});var y=Q(11253),x=Q(11276),u=Q(1195);function H(q){const X=[],Q=[],y=[],H=[],b=q.width||q.size||1,D=q.height||q.size||1,a=0===q.sideOrientation?0:q.sideOrientation||x.d.DEFAULTSIDE,R=b/2,L=D/2;Q.push(-R,-L,0),y.push(0,0,-1),H.push(0,u.c?1:0),Q.push(R,-L,0),y.push(0,0,-1),H.push(1,u.c?1:0),Q.push(R,L,0),y.push(0,0,-1),H.push(1,u.c?0:1),Q.push(-R,L,0),y.push(0,0,-1),H.push(0,u.c?0:1),X.push(0),X.push(1),X.push(2),X.push(0),X.push(2),X.push(3),x.d._ComputeSides(a,Q,X,y,H,q.frontUVs,q.backUVs);const f=new x.d;return f.indices=X,f.xa=Q,f.ya=y,f.Aa=H,f}function b(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const x=new y.b(q,Q);X.sideOrientation=y.b._GetDefaultSideOrientation(X.sideOrientation),x._originalBuilderSideOrientation=X.sideOrientation;return H(X).Ca(x,X.updatable),X.sourcePlane&&(x.translate(X.sourcePlane.qe,-X.sourcePlane.d),x.setDirection(X.sourcePlane.qe.scale(-1))),x}const D={ug:b};x.d.ug=H,y.b.ug=(q,X,Q,y,x)=>b(q,{size:X,width:X,height:X,sideOrientation:x,updatable:y},Q)},11412:(q,X,Q)=>{"use strict";Q.d(X,{c:()=>D});var y=Q(1002),x=Q(11253),u=Q(11276),H=Q(1195);function b(q){const X=0|(q.segments||32),Q=q.diameterX||q.diameter||1,x=q.diameterY||q.diameter||1,b=q.diameterZ||q.diameter||1,D=q.arc&&(q.arc<=0||q.arc>1)?1:q.arc||1,a=q.slice&&q.slice<=0?1:q.slice||1,R=0===q.sideOrientation?0:q.sideOrientation||u.d.DEFAULTSIDE,L=!!q.dedupTopBottomIndices,f=new y.n(Q/2,x/2,b/2),k=2+X,j=2*k,I=[],d=[],e=[],i=[];for(let u=0;u<=k;u++){const q=u/k,X=q*Math.PI*a;for(let Q=0;Q<=j;Q++){const x=Q/j,u=x*Math.PI*2*D,b=y.b.RotationZ(-X),a=y.b.RotationY(u),R=y.n.TransformCoordinates(y.n.Up(),b),L=y.n.TransformCoordinates(R,a),k=L.multiply(f),I=L.divide(f).normalize();d.push(k.x,k.y,k.z),e.push(I.x,I.y,I.z),i.push(x,H.c?1-q:q)}if(u>0){const q=d.length/3;for(let X=q-2*(j+1);X+j+2<q;X++)L?(u>1&&(I.push(X),I.push(X+1),I.push(X+j+1)),(u<k||a<1)&&(I.push(X+j+1),I.push(X+1),I.push(X+j+2))):(I.push(X),I.push(X+1),I.push(X+j+1),I.push(X+j+1),I.push(X+1),I.push(X+j+2))}}u.d._ComputeSides(R,d,I,e,i,q.frontUVs,q.backUVs);const A=new u.d;return A.indices=I,A.xa=d,A.ya=e,A.Aa=i,A}function D(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const y=new x.b(q,Q);X.sideOrientation=x.b._GetDefaultSideOrientation(X.sideOrientation),y._originalBuilderSideOrientation=X.sideOrientation;return b(X).Ca(y,X.updatable),y}u.d.CreateSphere=b,x.b.CreateSphere=(q,X,Q,y,x,u)=>D(q,{segments:X,diameterX:Q,diameterY:Q,diameterZ:Q,sideOrientation:u,updatable:x},y)},11931:(q,X,Q)=>{"use strict";Q.d(X,{b:()=>L});var y=Q(1215),x=Q(10257),u=Q(11279),H=Q(1261),b=Q(11276),D=Q(1099);function a(q,X,Q,y,x){let u=null,H=null,b=null;try{let D;u=new q.Decoder,H=new q.DecoderBuffer,H.Init(X,X.byteLength);const a=u.GetEncodedGeometryType(H);switch(a){case q.TRIANGULAR_MESH:{const X=new q.Mesh;if(D=u.DecodeBufferToMesh(H,X),!D.ok()||0===X.ptr)throw new Error(D.error_msg());const Q=3*X.num_faces(),x=4*Q,a=q._malloc(x);try{u.GetTrianglesUInt32Array(X,x,a);const H=new Uint32Array(Q);H.set(new Uint32Array(q.HEAPF32.buffer,a,Q)),y(H)}finally{q._free(a)}b=X;break}case q.POINT_CLOUD:{const X=new q.PointCloud;if(D=u.DecodeBufferToPointCloud(H,X),!D.ok()||!X.ptr)throw new Error(D.error_msg());b=X;break}default:throw new Error(`Invalid geometry type ${a}`)}const R=b.num_points(),L=(X,Q,y,u)=>{const H=u.data_type(),b=u.num_components(),D=u.normalized(),a=u.byte_stride(),L=u.byte_offset(),f={[q.DT_FLOAT32]:{typedArrayConstructor:Float32Array,heap:q.HEAPF32},[q.DT_INT8]:{typedArrayConstructor:Int8Array,heap:q.HEAP8},[q.DT_INT16]:{typedArrayConstructor:Int16Array,heap:q.HEAP16},[q.DT_INT32]:{typedArrayConstructor:Int32Array,heap:q.HEAP32},[q.DT_UINT8]:{typedArrayConstructor:Uint8Array,heap:q.HEAPU8},[q.DT_UINT16]:{typedArrayConstructor:Uint16Array,heap:q.HEAPU16},[q.DT_UINT32]:{typedArrayConstructor:Uint32Array,heap:q.HEAPU32}}[H];if(!f)throw new Error(`Invalid data type ${H}`);const k=R*b,j=k*f.typedArrayConstructor.BYTES_PER_ELEMENT,I=q._malloc(j);try{X.GetAttributeDataArrayForAllPoints(Q,u,H,j,I);const q=new f.typedArrayConstructor(f.heap.buffer,I,k);x(y,q.slice(),b,L,a,D)}finally{q._free(I)}};if(Q)for(const q in Q){const X=Q[q],y=u.GetAttributeByUniqueId(b,X);L(u,b,q,y)}else{const X={position:q.POSITION,qe:q.NORMAL,color:q.COLOR,uv:q.TEX_COORD};for(const q in X){const Q=u.GetAttributeId(b,X[q]);if(-1!==Q){const X=u.GetAttribute(b,Q);L(u,b,q,X)}}}return R}finally{b&&q.destroy(b),H&&q.destroy(H),u&&q.destroy(u)}}function R(){let q;onmessage=X=>{const Q=X.data;switch(Q.id){case"init":{const X=Q.decoder;X.url&&importScripts(X.url);const y=X.wasmBinary?{wasmBinary:X.wasmBinary}:{};q=DracoDecoderModule(y),postMessage({id:"initDone"});break}case"decodeMesh":if(!q)throw new Error("Draco decoder module is not available");q.then((q=>{const X=a(q,Q.dataView,Q.attributes,(q=>{postMessage({id:"indices",data:q},[q.buffer])}),((q,X,Q,y,x,u)=>{postMessage({id:"attribute",kind:q,data:X,size:Q,byteOffset:y,byteStride:x,normalized:u},[X.buffer])}));postMessage({id:"decodeMeshDone",totalVertices:X})}))}}}class L{static get DecoderAvailable(){const q=L.Configuration.decoder;return!!(q.wasmUrl&&q.wasmBinaryUrl&&"object"===typeof WebAssembly||q.fallbackUrl)}static GetDefaultNumWorkers(){return"object"===typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1}static get Default(){return L._Default||(L._Default=new L),L._Default}static ResetDefault(q){L._Default&&(q||L._Default.dispose(),L._Default=null)}constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:L.DefaultNumWorkers;const X=L.Configuration.decoder;if(X.workerPool||"object"===typeof q&&q.workerPool)this._workerPoolPromise=Promise.resolve(X.workerPool||q.workerPool);else{const Q=X.wasmBinary||"object"===typeof q&&q.wasmBinary,u="number"===typeof q?q:q.numWorkers,H=u&&"function"===typeof Worker&&"function"===typeof URL,b=H||!H&&!X.jsModule,D=X.wasmUrl&&X.wasmBinaryUrl&&"object"===typeof WebAssembly?{url:b?y.f.GetBabylonScriptURL(X.wasmUrl,!0):"",wasmBinaryPromise:Q?Promise.resolve(Q):y.f.LoadFileAsync(y.f.GetBabylonScriptURL(X.wasmBinaryUrl,!0))}:{url:b?y.f.GetBabylonScriptURL(X.fallbackUrl):"",wasmBinaryPromise:Promise.resolve(void 0)};H?this._workerPoolPromise=D.wasmBinaryPromise.then((q=>{const X=`${a}(${R})()`,Q=URL.createObjectURL(new Blob([X],{type:"application/javascript"}));return new x.d(u,(()=>function(q,X,Q){return new Promise(((y,x)=>{const u=X=>{q.removeEventListener("error",u),q.removeEventListener("message",H),x(X)},H=X=>{"initDone"===X.data.id&&(q.removeEventListener("error",u),q.removeEventListener("message",H),y(q))};if(q.addEventListener("error",u),q.addEventListener("message",H),X){const y=X.slice(0);q.postMessage({id:"init",decoder:{url:Q,wasmBinary:y}},[y])}else q.postMessage({id:"init",decoder:{url:Q}})}))}(new Worker(Q),q,D.url)))})):this._decoderModulePromise=D.wasmBinaryPromise.then((async q=>{if("undefined"===typeof DracoDecoderModule&&!X.jsModule){if(!D.url)throw new Error("Draco decoder module is not available");await y.f.LoadBabylonScriptAsync(D.url)}return await(Q=q,x=X.jsModule,new Promise((q=>{(x||DracoDecoderModule)({wasmBinary:Q}).then((X=>{q({module:X})}))})));var Q,x}))}}dispose(){this._workerPoolPromise&&this._workerPoolPromise.then((q=>{q.dispose()})),delete this._workerPoolPromise,delete this._decoderModulePromise}async whenReadyAsync(){this._workerPoolPromise?await this._workerPoolPromise:this._decoderModulePromise&&await this._decoderModulePromise}decodeMeshToMeshDataAsync(q,X,Q){const y=q instanceof ArrayBuffer?new Int8Array(q):new Int8Array(q.buffer,q.byteOffset,q.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((q=>new Promise(((x,u)=>{q.push(((q,H)=>{let b=null;const a=[],R=X=>{q.removeEventListener("error",R),q.removeEventListener("message",L),u(X),H()},L=X=>{const y=X.data;switch(y.id){case"decodeMeshDone":q.removeEventListener("error",R),q.removeEventListener("message",L),x({indices:b,attributes:a,totalVertices:y.totalVertices}),H();break;case"indices":b=y.data;break;case"attribute":a.push({kind:y.kind,data:y.data,size:y.size,byteOffset:y.byteOffset,byteStride:y.byteStride,normalized:(u=y.kind,f=y.normalized,Q&&void 0!==Q[u]?(f!==Q[u]&&D.b.Warn(`Normalized flag from Draco data (${f}) does not match normalized flag from glTF accessor (${Q[u]}). Using flag from glTF accessor.`),Q[u]):f)})}var u,f};q.addEventListener("error",R),q.addEventListener("message",L);const f=y.slice();q.postMessage({id:"decodeMesh",dataView:f,attributes:X},[f.buffer])}))}))));if(this._decoderModulePromise)return this._decoderModulePromise.then((q=>{let Q=null;const x=[],u=a(q.module,y,X,(q=>{Q=q}),((q,X,Q,y,u,H)=>{x.push({kind:q,data:X,size:Q,byteOffset:y,byteStride:u,normalized:H})}));return{indices:Q,attributes:x,totalVertices:u}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(q,X,Q,y){const x=await this.decodeMeshToMeshDataAsync(Q,y),b=new u.d(q,X);x.indices&&b.setIndices(x.indices);for(const u of x.attributes)b.setVerticesBuffer(new H.c(X.getEngine(),u.data,u.kind,!1,void 0,u.byteStride,void 0,u.byteOffset,u.size,void 0,u.normalized,!0),x.totalVertices);return b}async _decodeMeshToGeometryForGltfAsync(q,X,Q,y,x){const b=await this.decodeMeshToMeshDataAsync(Q,y,x),D=new u.d(q,X);b.indices&&D.setIndices(b.indices);for(const u of b.attributes)D.setVerticesBuffer(new H.c(X.getEngine(),u.data,u.kind,!1,void 0,u.byteStride,void 0,u.byteOffset,u.size,void 0,u.normalized,!0),b.totalVertices);return D}async decodeMeshAsync(q,X){const Q=await this.decodeMeshToMeshDataAsync(q,X),y=new b.d;Q.indices&&(y.indices=Q.indices);for(const x of Q.attributes){const q=H.c.GetFloatData(x.data,x.size,H.c.GetDataType(x.data),x.byteOffset,x.byteStride,x.normalized,Q.totalVertices);y.set(q,x.kind)}return y}}L.Configuration={decoder:{wasmUrl:`${y.f._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${y.f._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${y.f._DefaultCdnUrl}/draco_decoder_gltf.js`}},L.DefaultNumWorkers=L.GetDefaultNumWorkers(),L._Default=null},11291:(q,X,Q)=>{"use strict";Q.d(X,{c:()=>W});var y=Q(975),x=Q(998),u=Q(1002),H=Q(1261),b=Q(11276),D=Q(11298),a=Q(1258),R=Q(1347),L=Q(1256);class f{constructor(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new u.n(0,0,0),this._diffPositionForCollisions=new u.n(0,0,0),this._collisionResponse=!0}}var k=Q(1081),j=Q(1366),I=Q(1182),d=Q(1004),e=Q(1497),i=Q(1015),A=Q(984),B=Q(1105);class w{constructor(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=u.n.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1}}class V{constructor(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new w,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=null,this._currentLODIsUpToDate=!1,this._collisionRetryCount=3,this._morphTargetManager=null,this._renderingGroupId=0,this._bakedVertexAnimationManager=null,this._material=null,this._positions=null,this._pointerOverDisableMeshTesting=!1,this._meshCollisionData=new f,this._enableDistantPicking=!1,this._rawBoundingInfo=null,this._sideOrientationHint=!1,this._inheritVisibility=!1}}class W extends D.c{static get BILLBOARDMODE_NONE(){return D.c.BILLBOARDMODE_NONE}static get BILLBOARDMODE_X(){return D.c.BILLBOARDMODE_X}static get BILLBOARDMODE_Y(){return D.c.BILLBOARDMODE_Y}static get BILLBOARDMODE_Z(){return D.c.BILLBOARDMODE_Z}static get BILLBOARDMODE_ALL(){return D.c.BILLBOARDMODE_ALL}static get BILLBOARDMODE_USE_POSITION(){return D.c.BILLBOARDMODE_USE_POSITION}get facetNb(){return this._internalAbstractMeshDataInfo._facetData.facetNb}get partitioningSubdivisions(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions}set partitioningSubdivisions(q){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=q}get partitioningBBoxRatio(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio}set partitioningBBoxRatio(q){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=q}get mustDepthSortFacets(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort}set mustDepthSortFacets(q){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=q}get facetDepthSortFrom(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom}set facetDepthSortFrom(q){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=q}get collisionRetryCount(){return this._internalAbstractMeshDataInfo._collisionRetryCount}set collisionRetryCount(q){this._internalAbstractMeshDataInfo._collisionRetryCount=q}get isFacetDataEnabled(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled}get morphTargetManager(){return this._internalAbstractMeshDataInfo._morphTargetManager}set morphTargetManager(q){this._internalAbstractMeshDataInfo._morphTargetManager!==q&&(this._internalAbstractMeshDataInfo._morphTargetManager=q,this._syncGeometryWithMorphTargetManager())}get bakedVertexAnimationManager(){return this._internalAbstractMeshDataInfo._bakedVertexAnimationManager}set bakedVertexAnimationManager(q){this._internalAbstractMeshDataInfo._bakedVertexAnimationManager!==q&&(this._internalAbstractMeshDataInfo._bakedVertexAnimationManager=q,this._markSubMeshesAsAttributesDirty())}_syncGeometryWithMorphTargetManager(){}_updateNonUniformScalingState(q){return!!super._updateNonUniformScalingState(q)&&(this._markSubMeshesAsMiscDirty(),!0)}get rawBoundingInfo(){return this._internalAbstractMeshDataInfo._rawBoundingInfo}set rawBoundingInfo(q){this._internalAbstractMeshDataInfo._rawBoundingInfo=q}set Dk(q){this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver=this.onCollideObservable.add(q)}set onCollisionPositionChange(q){this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(q)}get visibility(){return this._internalAbstractMeshDataInfo._visibility}set visibility(q){if(this._internalAbstractMeshDataInfo._visibility===q)return;const X=this._internalAbstractMeshDataInfo._visibility;this._internalAbstractMeshDataInfo._visibility=q,(1===X&&1!==q||1!==X&&1===q)&&this._markSubMeshesAsDirty((q=>{q.markAsMiscDirty(),q.markAsPrePassDirty()}))}get inheritVisibility(){return this._internalAbstractMeshDataInfo._inheritVisibility}set inheritVisibility(q){this._internalAbstractMeshDataInfo._inheritVisibility=q}get isVisible(){if(!this._isVisible||!this.inheritVisibility||!this._parentNode)return this._isVisible;if(this._isVisible){let q=this._parentNode;for(;q;){const X=q.isVisible;if("undefined"!==typeof X)return X;q=q.parent}}return this._isVisible}set isVisible(q){this._isVisible=q}get pointerOverDisableMeshTesting(){return this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting}set pointerOverDisableMeshTesting(q){this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting=q}get renderingGroupId(){return this._internalAbstractMeshDataInfo._renderingGroupId}set renderingGroupId(q){this._internalAbstractMeshDataInfo._renderingGroupId=q}get material(){return this._internalAbstractMeshDataInfo._material}set material(q){this._setMaterial(q)}_setMaterial(q){this._internalAbstractMeshDataInfo._material!==q&&(this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._material=q,q&&q.meshMap&&(q.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.be&&(this.resetDrawCache(),this._unBindEffect()))}getMaterialForRenderPass(q){var X;return null===(X=this._internalAbstractMeshDataInfo._materialForRenderPass)||void 0===X?void 0:X[q]}setMaterialForRenderPass(q,X){this.resetDrawCache(q),this._internalAbstractMeshDataInfo._materialForRenderPass||(this._internalAbstractMeshDataInfo._materialForRenderPass=[]),this._internalAbstractMeshDataInfo._materialForRenderPass[q]=X}get receiveShadows(){return this._internalAbstractMeshDataInfo._receiveShadows}set receiveShadows(q){this._internalAbstractMeshDataInfo._receiveShadows!==q&&(this._internalAbstractMeshDataInfo._receiveShadows=q,this._markSubMeshesAsLightDirty())}get hasVertexAlpha(){return this._internalAbstractMeshDataInfo._hasVertexAlpha}set hasVertexAlpha(q){this._internalAbstractMeshDataInfo._hasVertexAlpha!==q&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=q,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())}get useVertexColors(){return this._internalAbstractMeshDataInfo._useVertexColors}set useVertexColors(q){this._internalAbstractMeshDataInfo._useVertexColors!==q&&(this._internalAbstractMeshDataInfo._useVertexColors=q,this._markSubMeshesAsAttributesDirty())}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(q){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==q&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=q,this._markSubMeshesAsAttributesDirty())}get numBoneInfluencers(){return this._internalAbstractMeshDataInfo._numBoneInfluencers}set numBoneInfluencers(q){this._internalAbstractMeshDataInfo._numBoneInfluencers!==q&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=q,this._markSubMeshesAsAttributesDirty())}get applyFog(){return this._internalAbstractMeshDataInfo._applyFog}set applyFog(q){this._internalAbstractMeshDataInfo._applyFog!==q&&(this._internalAbstractMeshDataInfo._applyFog=q,this._markSubMeshesAsMiscDirty())}get enableDistantPicking(){return this._internalAbstractMeshDataInfo._enableDistantPicking}set enableDistantPicking(q){this._internalAbstractMeshDataInfo._enableDistantPicking=q}get layerMask(){return this._internalAbstractMeshDataInfo._layerMask}set layerMask(q){q!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=q,this._resyncLightSources())}get collisionMask(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask}set collisionMask(q){this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask=isNaN(q)?-1:q}get collisionResponse(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse}set collisionResponse(q){this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse=q}get collisionGroup(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup}set collisionGroup(q){this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup=isNaN(q)?-1:q}get surroundingMeshes(){return this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes}set surroundingMeshes(q){this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes=q}get lightSources(){return this._lightSources}set skeleton(q){const X=this._internalAbstractMeshDataInfo._skeleton;X&&X.needInitialSkinMatrix&&X._unregisterMeshWithPoseMatrix(this),q&&q.needInitialSkinMatrix&&q._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=q,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()}get skeleton(){return this._internalAbstractMeshDataInfo._skeleton}constructor(q){var X;let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;switch(super(q,Q,!1),X=this,this._internalAbstractMeshDataInfo=new V,this._waitingMaterialId=null,this._waitingMorphTargetManagerId=null,this.Je=W.Mi,this.onCollideObservable=new x.c,this.onCollisionPositionChangeObservable=new x.c,this.onMaterialChangedObservable=new x.c,this.definedFacingForward=!0,this._occlusionQuery=null,this._renderingGroup=null,this.alphaIndex=Number.MAX_VALUE,this._isVisible=!0,this.Ne=!0,this.isNearPickable=!1,this.isNearGrabbable=!1,this.showSubMeshesBoundingBox=!1,this.isBlocker=!1,this.enablePointerMoveEvents=!1,this.outlineColor=I.b.Red(),this.outlineWidth=.02,this.overlayColor=I.b.Red(),this.overlayAlpha=.5,this.useOctreeForRenderingSelection=!0,this.useOctreeForPicking=!0,this.useOctreeForCollisions=!0,this.Ze=!1,this.Da=!1,this.actionManager=null,this.ellipsoid=new u.n(.5,1,.5),this.ellipsoidOffset=new u.n(0,0,0),this.edgesWidth=1,this.edgesColor=new I.c(1,0,0,1),this._edgesRenderer=null,this._masterMesh=null,this._boundingInfo=null,this._boundingInfoIsDirty=!0,this._renderId=0,this._intersectionsInProgress=new Array,this._unIndexed=!1,this._lightSources=new Array,this._waitingData={lods:null,actions:null,$h:null},this._bonesTransformMatrices=null,this._transformMatrixTexture=null,this.onRebuildObservable=new x.c,this._onCollisionPositionChange=function(q,Q){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Q.subtractToRef(X._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,X._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),X._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions.length()>B.e.CollisionsEpsilon&&X.position.addInPlace(X._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),y&&X.onCollideObservable.notifyObservers(y),X.onCollisionPositionChangeObservable.notifyObservers(X.position)},Q=this.va(),Q.Ve(this),this._resyncLightSources(),this._uniformBuffer=new L.c(this.va().getEngine(),void 0,void 0,q,!this.va().getEngine().isWebGPU),this._buildUniformLayout(),Q.performancePriority){case 2:this.Da=!0;case 1:this.Ze=!0,this.Ne=!1}}_buildUniformLayout(){this._uniformBuffer.addUniform("world",16),this._uniformBuffer.addUniform("visibility",1),this._uniformBuffer.create()}transferToEffect(q){const X=this._uniformBuffer;X.Ae("world",q),X.updateFloat("visibility",this._internalAbstractMeshDataInfo._visibility),X.update()}getMeshUniformBuffer(){return this._uniformBuffer}getClassName(){return"AbstractMesh"}toString(q){let X="Name: "+this.name+", isInstance: "+("InstancedMesh"!==this.getClassName()?"YES":"NO");X+=", # of submeshes: "+(this.be?this.be.length:0);const Q=this._internalAbstractMeshDataInfo._skeleton;return Q&&(X+=", skeleton: "+Q.name),q&&(X+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],X+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.$h?"YES":"NO")),X}_getEffectiveParent(){return this._masterMesh&&this.billboardMode!==D.c.BILLBOARDMODE_NONE?this._masterMesh:super._getEffectiveParent()}_getActionManagerForTrigger(q){let X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.actionManager&&(X||this.actionManager.isRecursive)){if(!q)return this.actionManager;if(this.actionManager.hasSpecificTrigger(q))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(q,!1):null}_rebuild(){if(this.onRebuildObservable.notifyObservers(this),null!==this._occlusionQuery&&(this._occlusionQuery=null),this.be){for(const q of this.be)q._rebuild();this.resetDrawCache()}}_resyncLightSources(){this._lightSources.length=0;for(const q of this.va().lights)q.isEnabled()&&q.canAffectMesh(this)&&this._lightSources.push(q);this._markSubMeshesAsLightDirty()}_resyncLightSource(q){const X=q.isEnabled()&&q.canAffectMesh(this),Q=this._lightSources.indexOf(q);let y=!1;if(-1===Q){if(!X)return;this._lightSources.push(q)}else{if(X)return;y=!0,this._lightSources.splice(Q,1)}this._markSubMeshesAsLightDirty(y)}_unBindEffect(){for(const q of this.be)q.setEffect(null)}_removeLightSource(q,X){const Q=this._lightSources.indexOf(q);-1!==Q&&(this._lightSources.splice(Q,1),this._markSubMeshesAsLightDirty(X))}_markSubMeshesAsDirty(q){if(this.be)for(const X of this.be)for(let Q=0;Q<X._drawWrappers.length;++Q){const y=X._drawWrappers[Q];y&&y.defines&&y.defines.markAllAsDirty&&q(y.defines)}}_markSubMeshesAsLightDirty(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._markSubMeshesAsDirty((X=>X.markAsLightDirty(q)))}_markSubMeshesAsAttributesDirty(){this._markSubMeshesAsDirty((q=>q.markAsAttributesDirty()))}_markSubMeshesAsMiscDirty(){this._markSubMeshesAsDirty((q=>q.markAsMiscDirty()))}te(q){return this._currentRenderId=Number.MAX_VALUE,super.te(q),this._isDirty=!0,this}resetDrawCache(q){if(this.be)for(const X of this.be)X.resetDrawCache(q)}get isBlocked(){return!1}getLOD(q){return this}getTotalVertices(){return 0}getTotalIndices(){return 0}Nd(){return null}getVerticesData(q){return null}Ga(q,X,Q,y){return this}updateVerticesData(q,X,Q,y){return this}setIndices(q,X){return this}isVerticesDataPresent(q){return!1}getBoundingInfo(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfoIsDirty&&(this._boundingInfoIsDirty=!1,this.Ea()),this._boundingInfo)}getRawBoundingInfo(){return this.rawBoundingInfo??this.getBoundingInfo()}setBoundingInfo(q){return this._boundingInfo=q,this}get hasBoundingInfo(){return null!==this._boundingInfo}buildBoundingInfo(q,X,Q){return this._boundingInfo=new R.e(q,X,Q),this._boundingInfo}normalizeToUnitCube(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Q=arguments.length>2?arguments[2]:void 0;return super.normalizeToUnitCube(q,X,Q)}get useBones(){return this.skeleton&&this.va().skeletonsEnabled&&this.isVerticesDataPresent(H.c.MatricesIndicesKind)&&this.isVerticesDataPresent(H.c.MatricesWeightsKind)}_preActivate(){}_preActivateForIntermediateRendering(q){}_activate(q,X){return this._renderId=q,!0}_postActivate(){}_freeze(){}_unFreeze(){}getWorldMatrix(){return this._masterMesh&&this.billboardMode===D.c.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():super.getWorldMatrix()}_getWorldMatrixDeterminant(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():super._getWorldMatrixDeterminant()}get isAnInstance(){return!1}get hasInstances(){return!1}get hasThinInstances(){return!1}movePOV(q,X,Q){return this.position.addInPlace(this.calcMovePOV(q,X,Q)),this}calcMovePOV(q,X,Q){const y=new u.b;(this.rotationQuaternion?this.rotationQuaternion:u.d.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(y);const x=u.n.Zero(),H=this.definedFacingForward?-1:1;return u.n.TransformCoordinatesFromFloatsToRef(q*H,X,Q*H,y,x),x}rotatePOV(q,X,Q){return this.rotation.addInPlace(this.calcRotatePOV(q,X,Q)),this}calcRotatePOV(q,X,Q){const y=this.definedFacingForward?1:-1;return new u.n(q*y,X,Q*y)}Fa(q,X){if(q){const Q=(0,j.g)(q,0,this.getTotalVertices(),X);this._boundingInfo?this._boundingInfo.reConstruct(Q.minimum,Q.maximum):this._boundingInfo=new R.e(Q.minimum,Q.maximum)}if(this.be)for(let Q=0;Q<this.be.length;Q++)this.be[Q].refreshBoundingInfo(q);this.Ea()}_refreshBoundingInfoDirect(q){if(this._boundingInfo?this._boundingInfo.reConstruct(q.minimum,q.maximum):this._boundingInfo=new R.e(q.minimum,q.maximum),this.be)for(let X=0;X<this.be.length;X++)this.be[X].refreshBoundingInfo(null);this.Ea()}static _ApplySkeleton(q,X,Q,y,x,b,D){!function(q,X,Q,y,x,b,D){const a=u.h.Od[0],R=u.h.Matrix[0],L=u.h.Matrix[1],f=X===H.c.NormalKind?u.n.TransformNormalFromFloatsToRef:u.n.TransformCoordinatesFromFloatsToRef;for(let H=0,k=0;H<q.length;H+=3,k+=4){let X,j;for(R.reset(),X=0;X<4;X++)j=x[k+X],j>0&&(u.b.FromFloat32ArrayToRefScaled(Q,Math.floor(16*y[k+X]),j,L),R.addToSelf(L));if(b&&D)for(X=0;X<4;X++)j=D[k+X],j>0&&(u.b.FromFloat32ArrayToRefScaled(Q,Math.floor(16*b[k+X]),j,L),R.addToSelf(L));f(q[H],q[H+1],q[H+2],R,a),a.toArray(q,H)}}(q,X,Q,y,x,b,D)}_getData(q,X){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:H.c.PositionKind;const y=q.cache,x=q=>{if(y){const X=y._vertexData||(y._vertexData={});return X[q]||this.copyVerticesData(q,X),X[q]}return this.getVerticesData(q)};if(X||(X=x(Q)),!X)return null;if(y?(y._outputData?y._outputData.set(X):y._outputData=new Float32Array(X),X=y._outputData):(q.applyMorph&&this.morphTargetManager||q.applySkeleton&&this.skeleton)&&(X=X.slice()),q.applyMorph&&this.morphTargetManager&&function(q,X,Q){let y=null;switch(X){case H.c.PositionKind:y=q=>q.getPositions();break;case H.c.NormalKind:y=q=>q.getNormals();break;case H.c.TangentKind:y=q=>q.getTangents();break;case H.c.UVKind:y=q=>q.getUVs();break;default:return}for(let x=0;x<q.length;x++){let X=q[x];for(let u=0;u<Q.numTargets;u++){const H=Q.getTarget(u),b=H.influence;if(0!==b){const Q=y(H);Q&&(X+=(Q[x]-q[x])*b)}}q[x]=X}}(X,Q,this.morphTargetManager),q.applySkeleton&&this.skeleton){const q=x(H.c.MatricesIndicesKind),y=x(H.c.MatricesWeightsKind);if(y&&q){const u=this.numBoneInfluencers>4,b=u?x(H.c.MatricesIndicesExtraKind):null,D=u?x(H.c.MatricesWeightsExtraKind):null,a=this.skeleton.getTransformMatrices(this);W._ApplySkeleton(X,Q,a,q,y,b,D)}}if(!1!==q.updatePositionsArray&&Q===H.c.PositionKind){const q=this._internalAbstractMeshDataInfo._positions||[],Q=q.length;if(q.length=X.length/3,Q<q.length)for(let X=Q;X<q.length;X++)q[X]=new u.n;for(let y=0,x=0;y<q.length;y++,x+=3)q[y].Pd(X[x],X[x+1],X[x+2]);this._internalAbstractMeshDataInfo._positions=q}return X}getNormalsData(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],X=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getData({applySkeleton:q,applyMorph:X,updatePositionsArray:!1},null,H.c.NormalKind)}Ef(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this._getData({applySkeleton:q,applyMorph:X,updatePositionsArray:!1},Q,H.c.PositionKind)}Ea(){return this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=new R.e(u.n.Zero(),u.n.Zero(),this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}_updateSubMeshesBoundingInfo(q){if(!this.be)return this;const X=this.be.length;for(let Q=0;Q<X;Q++){const y=this.be[Q];(X>1||!y.IsGlobal)&&y.updateBoundingInfo(q)}return this}_afterComputeWorldMatrix(){this.Da||(this._boundingInfoIsDirty=!0)}isInFrustum(q){return this.getBoundingInfo().isInFrustum(q,this.Je)}isCompletelyInFrustum(q){return this.getBoundingInfo().isCompletelyInFrustum(q)}intersectsMesh(q){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Q=arguments.length>2?arguments[2]:void 0;const y=this.getBoundingInfo(),x=q.getBoundingInfo();if(y.intersects(x,X))return!0;if(Q)for(const u of this.getChildMeshes())if(u.intersectsMesh(q,X,!0))return!0;return!1}intersectsPoint(q){return this.getBoundingInfo().intersectsPoint(q)}get checkCollisions(){return this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions}set checkCollisions(q){this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions=q}get collider(){return this._internalAbstractMeshDataInfo._meshCollisionData._collider}moveWithCollisions(q){this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions);const X=this.va().collisionCoordinator;return this._internalAbstractMeshDataInfo._meshCollisionData._collider||(this._internalAbstractMeshDataInfo._meshCollisionData._collider=X.createCollider()),this._internalAbstractMeshDataInfo._meshCollisionData._collider._radius=this.ellipsoid,X.getNewPosition(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,q,this._internalAbstractMeshDataInfo._meshCollisionData._collider,this.collisionRetryCount,this,this._onCollisionPositionChange,this.uniqueId),this}_collideForSubMesh(q,X,Q){var y;if(this._generatePointsArray(),!this._positions)return this;if(!q._lastColliderWorldVertices||!q._lastColliderTransformMatrix.equals(X)){q._lastColliderTransformMatrix=X.clone(),q._lastColliderWorldVertices=[],q._trianglePlanes=[];const Q=q.verticesStart,y=q.verticesStart+q.verticesCount;for(let x=Q;x<y;x++)q._lastColliderWorldVertices.push(u.n.TransformCoordinates(this._positions[x],X))}return Q._collide(q._trianglePlanes,q._lastColliderWorldVertices,this.Nd(),q.indexStart,q.indexStart+q.indexCount,q.verticesStart,!!q.Ha(),this,this._shouldConvertRHS(),7===(null===(y=q.Ha())||void 0===y?void 0:y.fillMode)),this}_processCollisionsForSubMeshes(q,X){const Q=this._scene.getCollidingSubMeshCandidates(this,q),y=Q.length;for(let x=0;x<y;x++){const u=Q.data[x];y>1&&!u._checkCollision(q)||this._collideForSubMesh(u,X,q)}return this}_shouldConvertRHS(){return!1}_checkCollision(q){if(!this.getBoundingInfo()._checkCollision(q))return this;const X=u.h.Matrix[0],Q=u.h.Matrix[1];return u.b.ScalingToRef(1/q._radius.x,1/q._radius.y,1/q._radius.z,X),this.worldMatrixFromCache.multiplyToRef(X,Q),this._processCollisionsForSubMeshes(q,Q),this}_generatePointsArray(){return!1}intersects(q,X,Q){let y=arguments.length>3&&void 0!==arguments[3]&&arguments[3],x=arguments.length>4?arguments[4]:void 0,H=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const b=new a.c,D=this.getClassName(),R="InstancedLinesMesh"===D||"LinesMesh"===D||"GreasedLineMesh"===D?this.intersectionThreshold:0,L=this.getBoundingInfo();if(!this.be)return b;if(!H&&(!q.intersectsSphere(L.boundingSphere,R)||!q.intersectsBox(L.boundingBox,R)))return b;if(y)return b.hit=!H,b.pickedMesh=H?null:this,b.distance=H?0:u.n.Distance(q.origin,L.boundingSphere.center),b.subMeshId=0,b;if(!this._generatePointsArray())return b;let f=null;const k=this._scene.getIntersectingSubMeshCandidates(this,q),j=k.length;let I=!1;for(let u=0;u<j;u++){const q=k.data[u].Ha();if(q&&(7==q.fillMode||0==q.fillMode||1==q.fillMode||2==q.fillMode||4==q.fillMode)){I=!0;break}}if(!I)return b.hit=!0,b.pickedMesh=this,b.distance=u.n.Distance(q.origin,L.boundingSphere.center),b.subMeshId=-1,b;for(let u=0;u<j;u++){const y=k.data[u];if(j>1&&!H&&!y.canIntersects(q))continue;const x=y.intersects(q,this._positions,this.Nd(),X,Q);if(x&&(X||!f||x.distance<f.distance)&&(f=x,f.subMeshId=u,X))break}if(f){const X=x??this.getWorldMatrix(),Q=u.h.Od[0],y=u.h.Od[1];u.n.TransformCoordinatesToRef(q.origin,X,Q),q.direction.scaleToRef(f.distance,y);const H=u.n.TransformNormal(y,X).addInPlace(Q);return b.hit=!0,b.distance=u.n.Distance(Q,H),b.pickedPoint=H,b.pickedMesh=this,b.bu=f.bu||0,b.bv=f.bv||0,b.subMeshFaceId=f.faceId,b.faceId=f.faceId+k.data[f.subMeshId].indexStart/(-1!==this.getClassName().indexOf("LinesMesh")?2:3),b.subMeshId=f.subMeshId,b}return b}clone(q,X,Q){return null}releaseSubMeshes(){if(this.be)for(;this.be.length;)this.be[0].dispose();else this.be=[];return this}dispose(q){let X,Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const y=this.va();for(this._scene.useMaterialMeshMap&&this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),y.freeActiveMeshes(),y.freeRenderingGroups(),y.renderingManager.maintainStateBetweenFrames&&y.renderingManager.restoreDispachedFlags(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.disposeWhenUnowned&&!this._scene.meshes.some((q=>q!==this&&q.actionManager===this.actionManager))&&this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),X=0;X<this._intersectionsInProgress.length;X++){const q=this._intersectionsInProgress[X],Q=q._intersectionsInProgress.indexOf(this);q._intersectionsInProgress.splice(Q,1)}this._intersectionsInProgress.length=0;y.lights.forEach((q=>{let X=q.includedOnlyMeshes.indexOf(this);-1!==X&&q.includedOnlyMeshes.splice(X,1),X=q.excludedMeshes.indexOf(this),-1!==X&&q.excludedMeshes.splice(X,1);const Q=q.getShadowGenerators();if(Q){const q=Q.values();for(let Q=q.next();!0!==Q.done;Q=q.next()){const q=Q.value.getShadowMap();q&&q.renderList&&(X=q.renderList.indexOf(this),-1!==X&&q.renderList.splice(X,1))}}})),"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes();const x=y.getEngine();if(null!==this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,x.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),x.wipeCaches(),y.Xe(this),this._parentContainer){const q=this._parentContainer.meshes.indexOf(this);q>-1&&this._parentContainer.meshes.splice(q,1),this._parentContainer=null}if(Q&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!q)for(X=0;X<y.je.length;X++)y.je[X].k===this&&(y.je[X].dispose(),X--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this._uniformBuffer.dispose(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),super.dispose(q,Q)}_initFacetData(){const q=this._internalAbstractMeshDataInfo._facetData;q.facetNormals||(q.facetNormals=[]),q.facetPositions||(q.facetPositions=[]),q.facetPartitioning||(q.facetPartitioning=new Array),q.facetNb=this.Nd().length/3|0,q.partitioningSubdivisions=q.partitioningSubdivisions?q.partitioningSubdivisions:10,q.partitioningBBoxRatio=q.partitioningBBoxRatio?q.partitioningBBoxRatio:1.01;for(let X=0;X<q.facetNb;X++)q.facetNormals[X]=u.n.Zero(),q.facetPositions[X]=u.n.Zero();return q.facetDataEnabled=!0,this}updateFacetData(){const q=this._internalAbstractMeshDataInfo._facetData;q.facetDataEnabled||this._initFacetData();const X=this.getVerticesData(H.c.PositionKind),Q=this.Nd(),y=this.getVerticesData(H.c.NormalKind),x=this.getBoundingInfo();if(q.facetDepthSort&&!q.facetDepthSortEnabled){if(q.facetDepthSortEnabled=!0,Q instanceof Uint16Array)q.depthSortedIndices=new Uint16Array(Q);else if(Q instanceof Uint32Array)q.depthSortedIndices=new Uint32Array(Q);else{let X=!1;for(let q=0;q<Q.length;q++)if(Q[q]>65535){X=!0;break}q.depthSortedIndices=X?new Uint32Array(Q):new Uint16Array(Q)}if(q.facetDepthSortFunction=function(q,X){return X.sqDistance-q.sqDistance},!q.facetDepthSortFrom){const X=this.va().activeCamera;q.facetDepthSortFrom=X?X.position:u.n.Zero()}q.depthSortedFacets=[];for(let X=0;X<q.facetNb;X++){const Q={ind:3*X,sqDistance:0};q.depthSortedFacets.push(Q)}q.invertedMatrix=u.b.Identity(),q.facetDepthSortOrigin=u.n.Zero()}q.bbSize.x=x.maximum.x-x.minimum.x>d.b?x.maximum.x-x.minimum.x:d.b,q.bbSize.y=x.maximum.y-x.minimum.y>d.b?x.maximum.y-x.minimum.y:d.b,q.bbSize.z=x.maximum.z-x.minimum.z>d.b?x.maximum.z-x.minimum.z:d.b;let D=q.bbSize.x>q.bbSize.y?q.bbSize.x:q.bbSize.y;if(D=D>q.bbSize.z?D:q.bbSize.z,q.subDiv.max=q.partitioningSubdivisions,q.subDiv.X=Math.floor(q.subDiv.max*q.bbSize.x/D),q.subDiv.Y=Math.floor(q.subDiv.max*q.bbSize.y/D),q.subDiv.Z=Math.floor(q.subDiv.max*q.bbSize.z/D),q.subDiv.X=q.subDiv.X<1?1:q.subDiv.X,q.subDiv.Y=q.subDiv.Y<1?1:q.subDiv.Y,q.subDiv.Z=q.subDiv.Z<1?1:q.subDiv.Z,q.facetParameters.facetNormals=this.getFacetLocalNormals(),q.facetParameters.facetPositions=this.getFacetLocalPositions(),q.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),q.facetParameters.bInfo=x,q.facetParameters.bbSize=q.bbSize,q.facetParameters.subDiv=q.subDiv,q.facetParameters.ratio=this.partitioningBBoxRatio,q.facetParameters.depthSort=q.facetDepthSort,q.facetDepthSort&&q.facetDepthSortEnabled&&(this.le(!0),this._worldMatrix.invertToRef(q.invertedMatrix),u.n.TransformCoordinatesToRef(q.facetDepthSortFrom,q.invertedMatrix,q.facetDepthSortOrigin),q.facetParameters.distanceTo=q.facetDepthSortOrigin),q.facetParameters.depthSortedFacets=q.depthSortedFacets,y&&b.d.ComputeNormals(X,Q,y,q.facetParameters),q.facetDepthSort&&q.facetDepthSortEnabled){q.depthSortedFacets.sort(q.facetDepthSortFunction);const X=q.depthSortedIndices.length/3|0;for(let y=0;y<X;y++){const X=q.depthSortedFacets[y].ind;q.depthSortedIndices[3*y]=Q[X],q.depthSortedIndices[3*y+1]=Q[X+1],q.depthSortedIndices[3*y+2]=Q[X+2]}this.updateIndices(q.depthSortedIndices,void 0,!0)}return this}getFacetLocalNormals(){const q=this._internalAbstractMeshDataInfo._facetData;return q.facetNormals||this.updateFacetData(),q.facetNormals}getFacetLocalPositions(){const q=this._internalAbstractMeshDataInfo._facetData;return q.facetPositions||this.updateFacetData(),q.facetPositions}getFacetLocalPartitioning(){const q=this._internalAbstractMeshDataInfo._facetData;return q.facetPartitioning||this.updateFacetData(),q.facetPartitioning}getFacetPosition(q){const X=u.n.Zero();return this.getFacetPositionToRef(q,X),X}getFacetPositionToRef(q,X){const Q=this.getFacetLocalPositions()[q],y=this.getWorldMatrix();return u.n.TransformCoordinatesToRef(Q,y,X),this}getFacetNormal(q){const X=u.n.Zero();return this.getFacetNormalToRef(q,X),X}getFacetNormalToRef(q,X){const Q=this.getFacetLocalNormals()[q];return u.n.TransformNormalToRef(Q,this.getWorldMatrix(),X),this}getFacetsAtLocalCoordinates(q,X,Q){const y=this.getBoundingInfo(),x=this._internalAbstractMeshDataInfo._facetData,u=Math.floor((q-y.minimum.x*x.partitioningBBoxRatio)*x.subDiv.X*x.partitioningBBoxRatio/x.bbSize.x),H=Math.floor((X-y.minimum.y*x.partitioningBBoxRatio)*x.subDiv.Y*x.partitioningBBoxRatio/x.bbSize.y),b=Math.floor((Q-y.minimum.z*x.partitioningBBoxRatio)*x.subDiv.Z*x.partitioningBBoxRatio/x.bbSize.z);return u<0||u>x.subDiv.max||H<0||H>x.subDiv.max||b<0||b>x.subDiv.max?null:x.facetPartitioning[u+x.subDiv.max*H+x.subDiv.max*x.subDiv.max*b]}getClosestFacetAtCoordinates(q,X,Q,y){let x=arguments.length>4&&void 0!==arguments[4]&&arguments[4],H=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const b=this.getWorldMatrix(),D=u.h.Matrix[5];b.invertToRef(D);const a=u.h.Od[8];u.n.TransformCoordinatesFromFloatsToRef(q,X,Q,D,a);const R=this.getClosestFacetAtLocalCoordinates(a.x,a.y,a.z,y,x,H);return y&&u.n.TransformCoordinatesFromFloatsToRef(y.x,y.y,y.z,b,y),R}getClosestFacetAtLocalCoordinates(q,X,Q,y){let x=arguments.length>4&&void 0!==arguments[4]&&arguments[4],u=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],H=null,b=0,D=0,a=0,R=0,L=0,f=0,k=0,j=0;const I=this.getFacetLocalPositions(),d=this.getFacetLocalNormals(),e=this.getFacetsAtLocalCoordinates(q,X,Q);if(!e)return null;let i,A,B,w=Number.MAX_VALUE,V=w;for(let W=0;W<e.length;W++)i=e[W],A=d[i],B=I[i],R=(q-B.x)*A.x+(X-B.y)*A.y+(Q-B.z)*A.z,(!x||x&&u&&R>=0||x&&!u&&R<=0)&&(R=A.x*B.x+A.y*B.y+A.z*B.z,L=-(A.x*q+A.y*X+A.z*Q-R)/(A.x*A.x+A.y*A.y+A.z*A.z),f=q+A.x*L,k=X+A.y*L,j=Q+A.z*L,b=f-q,D=k-X,a=j-Q,V=b*b+D*D+a*a,V<w&&(w=V,H=i,y&&(y.x=f,y.y=k,y.z=j)));return H}getFacetDataParameters(){return this._internalAbstractMeshDataInfo._facetData.facetParameters}disableFacetData(){const q=this._internalAbstractMeshDataInfo._facetData;return q.facetDataEnabled&&(q.facetDataEnabled=!1,q.facetPositions=[],q.facetNormals=[],q.facetPartitioning=new Array,q.facetParameters=null,q.depthSortedIndices=new Uint32Array(0)),this}updateIndices(q,X){return this}createNormals(q){const X=this.getVerticesData(H.c.PositionKind),Q=this.Nd();let y;return y=this.isVerticesDataPresent(H.c.NormalKind)?this.getVerticesData(H.c.NormalKind):[],b.d.ComputeNormals(X,Q,y,{useRightHandedSystem:this.va().useRightHandedSystem}),this.Ga(H.c.NormalKind,y,q),this}alignWithNormal(q,X){X||(X=e.c.Y);const Q=u.h.Od[0],y=u.h.Od[1];return u.n.CrossToRef(X,q,y),u.n.CrossToRef(q,y,Q),this.rotationQuaternion?u.d.RotationQuaternionFromAxisToRef(Q,q,y,this.rotationQuaternion):u.n.RotationFromAxisToRef(Q,q,y,this.rotation),this}_checkOcclusionQuery(){return!1}disableEdgesRendering(){throw(0,k.c)("EdgesRenderer")}enableEdgesRendering(q,X,Q){throw(0,k.c)("EdgesRenderer")}oj(){return this._scene.je.filter((q=>q.k===this))}}W.OCCLUSION_TYPE_NONE=0,W.OCCLUSION_TYPE_OPTIMISTIC=1,W.OCCLUSION_TYPE_STRICT=2,W.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,W.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,W.CULLINGSTRATEGY_STANDARD=0,W.Mi=1,W.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,W.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,(0,y.b)([A.g.filter((function(){for(var q=arguments.length,X=new Array(q),Q=0;Q<q;Q++)X[Q]=arguments[Q];let[y,x,u,H,b]=X;return!Array.isArray(y)&&!Array.isArray(x)&&!Array.isArray(u)&&!Array.isArray(H)&&!Array.isArray(b)}))],W,"_ApplySkeleton",null),(0,i.h)("BABYLON.AbstractMesh",W)},11279:(q,X,Q)=>{"use strict";Q.d(X,{d:()=>d});var y=Q(1002),x=Q(1182),u=Q(11276),H=Q(1261),b=Q(1337),D=Q(11284),a=Q(1347),R=Q(1215),L=Q(1175),f=Q(1366),k=Q(1028),j=Q(1195),I=Q(1099);class d{get boundingBias(){return this._boundingBias}set boundingBias(q){this._boundingBias?this._boundingBias.p(q):this._boundingBias=q.clone(),this.Ea(!0,null)}static CreateGeometryForMesh(q){const X=new d(d.RandomId(),q.va());return X.Ca(q),X}get meshes(){return this._meshes}constructor(q,X,Q){let y=arguments.length>3&&void 0!==arguments[3]&&arguments[3],x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this._positionsCache=[],this._parentContainer=null,this.useBoundingInfoFromGeometry=!1,this._scene=X||k.c.LastCreatedScene,this._scene&&(this.id=q,this.uniqueId=this._scene.getUniqueId(),this._engine=this._scene.getEngine(),this._meshes=[],this._vertexBuffers={},this._indices=[],this._updatable=y,Q?this.setAllVerticesData(Q,y):this._totalVertices=0,this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),x&&(this.Ca(x),x.le(!0)))}get extend(){return this._extend}va(){return this._scene}getEngine(){return this._engine}isReady(){return 1===this.delayLoadState||0===this.delayLoadState}get doNotSerialize(){for(let q=0;q<this._meshes.length;q++)if(!this._meshes[q].doNotSerialize)return!1;return!0}_rebuild(){this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer"));const q=new Set;for(const X in this._vertexBuffers)q.add(this._vertexBuffers[X].getWrapperBuffer());q.forEach((q=>{q._rebuild()}))}setAllVerticesData(q,X){q.applyToGeometry(this,X),this._notifyUpdate()}Ga(q,X){let Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2],y=arguments.length>3?arguments[3]:void 0;Q&&Array.isArray(X)&&(X=new Float32Array(X));const x=new H.c(this._engine,X,q,{updatable:Q,postponeInternalCreation:0===this._meshes.length,stride:y,label:"Geometry_"+this.id+"_"+q});this.setVerticesBuffer(x)}removeVerticesData(q){this._vertexBuffers[q]&&(this._vertexBuffers[q].dispose(),delete this._vertexBuffers[q]),this._vertexArrayObjects&&this._disposeVertexArrayObjects()}setVerticesBuffer(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Q=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const x=q.getKind();this._vertexBuffers[x]&&Q&&this._vertexBuffers[x].dispose(),q._buffer&&q._buffer._increaseReferences(),this._vertexBuffers[x]=q;const u=this._meshes,b=u.length;if(x===H.c.PositionKind){this._totalVertices=X??q._maxVerticesCount,this._updateExtend(q.getFloatData(this._totalVertices)),this._resetPointsArrayCache();const Q=this._extend&&this._extend.minimum||new y.n(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),x=this._extend&&this._extend.maximum||new y.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);for(let q=0;q<b;q++){const X=u[q];X.buildBoundingInfo(Q,x),X._createGlobalSubMesh(X.isUnIndexed),X.le(!0),X.synchronizeInstances()}}this._notifyUpdate(x)}updateVerticesDataDirectly(q,X,Q){let y=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const x=this.getVertexBuffer(q);x&&(x.updateDirectly(X,Q,y),this._notifyUpdate(q))}updateVerticesData(q,X){let Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const y=this.getVertexBuffer(q);y&&(y.update(X),q===H.c.PositionKind&&this.Ea(Q,X),this._notifyUpdate(q))}Ea(q,X){if(q&&this._updateExtend(X),this._resetPointsArrayCache(),q){const q=this._meshes;for(const X of q){X.hasBoundingInfo?X.getBoundingInfo().reConstruct(this._extend.minimum,this._extend.maximum):X.buildBoundingInfo(this._extend.minimum,this._extend.maximum);const q=X.be;for(const X of q)X.refreshBoundingInfo()}}}_bind(q,X,Q,y){if(!q)return;void 0===X&&(X=this._indexBuffer);const x=this.getVertexBuffers();if(!x)return;if(X!=this._indexBuffer||!this._vertexArrayObjects&&!y)return void this._engine.bindBuffers(x,X,q,Q);const u=y||this._vertexArrayObjects,H=this._engine;u[q.key]||(u[q.key]=H.recordVertexArrayObject(x,X,q,Q)),H.bindVertexArrayObject(u[q.key],X)}getTotalVertices(){return this.isReady()?this._totalVertices:0}getVerticesData(q,X,Q){const y=this.getVertexBuffer(q);return y?y.getFloatData(this._totalVertices,Q||X&&1!==this._meshes.length):null}copyVerticesData(q,X){const Q=this.getVertexBuffer(q);if(!Q)return;X[q]||(X[q]=new Float32Array(this._totalVertices*Q.getSize()));const y=Q.getData();y&&function(q,X,Q,y,x,u,b,D){const a=X*H.c.GetTypeByteLength(Q),R=b*X;if(D.length!==R)throw new Error("Output length is not valid");if(Q===H.c.FLOAT&&x===a)if(q instanceof Array){const X=y/4;D.set(q,X)}else if(q instanceof ArrayBuffer){const X=new Float32Array(q,y,R);D.set(X)}else{const X=q.byteOffset+y;if(X%4)return I.b.Warn("CopyFloatData: copied misaligned data."),void D.set(new Float32Array(q.buffer.slice(X,X+4*R)));const Q=new Float32Array(q.buffer,X,R);D.set(Q)}else H.c.ForEach(q,y,x,X,Q,R,u,((q,X)=>D[X]=q))}(y,Q.getSize(),Q.type,Q.byteOffset,Q.byteStride,Q.normalized,this._totalVertices,X[q])}isVertexBufferUpdatable(q){const X=this._vertexBuffers[q];return!!X&&X.isUpdatable()}getVertexBuffer(q){return this.isReady()?this._vertexBuffers[q]:null}getVertexBuffers(){return this.isReady()?this._vertexBuffers:null}isVerticesDataPresent(q){return this._vertexBuffers?void 0!==this._vertexBuffers[q]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(q)}getVerticesDataKinds(){const q=[];let X;if(!this._vertexBuffers&&this._delayInfo)for(X in this._delayInfo)q.push(X);else for(X in this._vertexBuffers)q.push(X);return q}updateIndices(q,X){let Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._indexBuffer)if(this._indexBufferIsUpdatable){const y=q.length!==this._indices.length;if(Q||(this._indices=q.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,q,X),y)for(const q of this._meshes)q._createGlobalSubMesh(!0)}else this.setIndices(q,null,!0)}setIndexBuffer(q,X,Q){this._indices=[],this._indexBufferIsUpdatable=!1,this._indexBuffer=q,this._totalVertices=X,this._totalIndices=Q,q.is32Bits||(q.is32Bits=this._totalIndices>65535);for(const y of this._meshes)y._createGlobalSubMesh(!0),y.synchronizeInstances();this._notifyUpdate()}setIndices(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2],y=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=q,this._indexBufferIsUpdatable=Q,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,Q,"Geometry_"+this.id+"_IndexBuffer")),void 0!=X&&(this._totalVertices=X);for(const x of this._meshes)x._createGlobalSubMesh(!y),x.synchronizeInstances();this._notifyUpdate()}getTotalIndices(){return this.isReady()?void 0!==this._totalIndices?this._totalIndices:this._indices.length:0}Nd(q,X){if(!this.isReady())return null;const Q=this._indices;return X||q&&1!==this._meshes.length?Q.slice():Q}getIndexBuffer(){return this.isReady()?this._indexBuffer:null}_releaseVertexArrayObject(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;q&&this._vertexArrayObjects&&this._vertexArrayObjects[q.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[q.key]),delete this._vertexArrayObjects[q.key])}releaseForMesh(q,X){const Q=this._meshes,y=Q.indexOf(q);-1!==y&&(Q.splice(y,1),this._vertexArrayObjects&&q._invalidateInstanceVertexArrayObject(),q._geometry=null,0===Q.length&&X&&this.dispose())}Ca(q){if(q._geometry===this)return;const X=q._geometry;X&&X.releaseForMesh(q),this._vertexArrayObjects&&q._invalidateInstanceVertexArrayObject();const Q=this._meshes;q._geometry=this,q._internalAbstractMeshDataInfo._positions=null,this._scene.pushGeometry(this),Q.push(q),this.isReady()?this._applyToMesh(q):this._boundingInfo&&q.setBoundingInfo(this._boundingInfo)}_updateExtend(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.useBoundingInfoFromGeometry&&this._boundingInfo)this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()};else{if(!q&&(q=this.getVerticesData(H.c.PositionKind),!q))return;this._extend=(0,f.g)(q,0,this._totalVertices,this.boundingBias,3)}}_applyToMesh(q){const X=this._meshes.length;for(const Q in this._vertexBuffers)1===X&&this._vertexBuffers[Q].create(),Q===H.c.PositionKind&&(this._extend||this._updateExtend(),q.buildBoundingInfo(this._extend.minimum,this._extend.maximum),q._createGlobalSubMesh(q.isUnIndexed),q.Ea());1===X&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer")),q._syncGeometryWithMorphTargetManager(),q.synchronizeInstances()}_notifyUpdate(q){this.onGeometryUpdated&&this.onGeometryUpdated(this,q),this._vertexArrayObjects&&this._disposeVertexArrayObjects();for(const X of this._meshes)X._markSubMeshesAsAttributesDirty()}load(q,X){2!==this.delayLoadState&&(this.isReady()?X&&X():(this.delayLoadState=2,this._queueLoad(q,X)))}_queueLoad(q,X){this.delayLoadingFile&&(q.addPendingData(this),q._loadFile(this.delayLoadingFile,(Q=>{if(!this._delayLoadingFunction)return;this._delayLoadingFunction(JSON.parse(Q),this),this.delayLoadState=1,this._delayInfo=[],q.removePendingData(this);const y=this._meshes,x=y.length;for(let q=0;q<x;q++)this._applyToMesh(y[q]);X&&X()}),void 0,!0))}toLeftHanded(){const q=this.Nd(!1);if(null!=q&&q.length>0){for(let X=0;X<q.length;X+=3){const Q=q[X+0];q[X+0]=q[X+2],q[X+2]=Q}this.setIndices(q)}const X=this.getVerticesData(H.c.PositionKind,!1);if(null!=X&&X.length>0){for(let q=0;q<X.length;q+=3)X[q+2]=-X[q+2];this.Ga(H.c.PositionKind,X,!1)}const Q=this.getVerticesData(H.c.NormalKind,!1);if(null!=Q&&Q.length>0){for(let q=0;q<Q.length;q+=3)Q[q+2]=-Q[q+2];this.Ga(H.c.NormalKind,Q,!1)}}_resetPointsArrayCache(){this._positions=null}_generatePointsArray(){if(this._positions)return!0;const q=this.getVerticesData(H.c.PositionKind);if(!q||0===q.length)return!1;for(let X=3*this._positionsCache.length,Q=this._positionsCache.length;X<q.length;X+=3,++Q)this._positionsCache[Q]=y.n.Rd(q,X);for(let X=0,Q=0;X<q.length;X+=3,++Q)this._positionsCache[Q].set(q[0+X],q[1+X],q[2+X]);return this._positionsCache.length=q.length/3,this._positions=this._positionsCache,!0}u(){return this._isDisposed}_disposeVertexArrayObjects(){if(this._vertexArrayObjects){for(const Q in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[Q]);this._vertexArrayObjects={};const q=this._meshes,X=q.length;for(let Q=0;Q<X;Q++)q[Q]._invalidateInstanceVertexArrayObject()}}dispose(){const q=this._meshes,X=q.length;let Q;for(Q=0;Q<X;Q++)this.releaseForMesh(q[Q]);this._meshes.length=0,this._disposeVertexArrayObjects();for(const y in this._vertexBuffers)this._vertexBuffers[y].dispose();if(this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._parentContainer){const q=this._parentContainer.geometries.indexOf(this);q>-1&&this._parentContainer.geometries.splice(q,1),this._parentContainer=null}this._isDisposed=!0}j(q){const X=new u.d;X.indices=[];const Q=this.Nd();if(Q)for(let u=0;u<Q.length;u++)X.indices.push(Q[u]);let y,x=!1,H=!1;for(y in this._vertexBuffers){const q=this.getVerticesData(y);if(q&&(q instanceof Float32Array?X.set(new Float32Array(q),y):X.set(q.slice(0),y),!H)){const q=this.getVertexBuffer(y);q&&(x=q.isUpdatable(),H=!x)}}const b=new d(q,this._scene,X,x);for(y in b.delayLoadState=this.delayLoadState,b.delayLoadingFile=this.delayLoadingFile,b._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)b._delayInfo=b._delayInfo||[],b._delayInfo.push(y);return b._boundingInfo=new a.e(this._extend.minimum,this._extend.maximum),b}serialize(){const q={};return q.id=this.id,q.uniqueId=this.uniqueId,q.updatable=this._updatable,L.d&&L.d.HasTags(this)&&(q.tags=L.d.GetTags(this)),q}_toNumberArray(q){return Array.isArray(q)?q:Array.prototype.slice.call(q)}clearCachedData(){this._indices=[],this._resetPointsArrayCache();for(const q in this._vertexBuffers)Object.prototype.hasOwnProperty.call(this._vertexBuffers,q)&&(this._vertexBuffers[q]._buffer._data=null)}serializeVerticeData(){const q=this.serialize();return this.isVerticesDataPresent(H.c.PositionKind)&&(q.xa=this._toNumberArray(this.getVerticesData(H.c.PositionKind)),this.isVertexBufferUpdatable(H.c.PositionKind)&&(q.xa._updatable=!0)),this.isVerticesDataPresent(H.c.NormalKind)&&(q.ya=this._toNumberArray(this.getVerticesData(H.c.NormalKind)),this.isVertexBufferUpdatable(H.c.NormalKind)&&(q.ya._updatable=!0)),this.isVerticesDataPresent(H.c.TangentKind)&&(q.tangents=this._toNumberArray(this.getVerticesData(H.c.TangentKind)),this.isVertexBufferUpdatable(H.c.TangentKind)&&(q.tangents._updatable=!0)),this.isVerticesDataPresent(H.c.UVKind)&&(q.Aa=this._toNumberArray(this.getVerticesData(H.c.UVKind)),this.isVertexBufferUpdatable(H.c.UVKind)&&(q.Aa._updatable=!0)),this.isVerticesDataPresent(H.c.UV2Kind)&&(q.uvs2=this._toNumberArray(this.getVerticesData(H.c.UV2Kind)),this.isVertexBufferUpdatable(H.c.UV2Kind)&&(q.uvs2._updatable=!0)),this.isVerticesDataPresent(H.c.UV3Kind)&&(q.uvs3=this._toNumberArray(this.getVerticesData(H.c.UV3Kind)),this.isVertexBufferUpdatable(H.c.UV3Kind)&&(q.uvs3._updatable=!0)),this.isVerticesDataPresent(H.c.UV4Kind)&&(q.uvs4=this._toNumberArray(this.getVerticesData(H.c.UV4Kind)),this.isVertexBufferUpdatable(H.c.UV4Kind)&&(q.uvs4._updatable=!0)),this.isVerticesDataPresent(H.c.UV5Kind)&&(q.uvs5=this._toNumberArray(this.getVerticesData(H.c.UV5Kind)),this.isVertexBufferUpdatable(H.c.UV5Kind)&&(q.uvs5._updatable=!0)),this.isVerticesDataPresent(H.c.UV6Kind)&&(q.uvs6=this._toNumberArray(this.getVerticesData(H.c.UV6Kind)),this.isVertexBufferUpdatable(H.c.UV6Kind)&&(q.uvs6._updatable=!0)),this.isVerticesDataPresent(H.c.ColorKind)&&(q.za=this._toNumberArray(this.getVerticesData(H.c.ColorKind)),this.isVertexBufferUpdatable(H.c.ColorKind)&&(q.za._updatable=!0)),this.isVerticesDataPresent(H.c.MatricesIndicesKind)&&(q.matricesIndices=this._toNumberArray(this.getVerticesData(H.c.MatricesIndicesKind)),q.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(H.c.MatricesIndicesKind)&&(q.matricesIndices._updatable=!0)),this.isVerticesDataPresent(H.c.MatricesWeightsKind)&&(q.matricesWeights=this._toNumberArray(this.getVerticesData(H.c.MatricesWeightsKind)),this.isVertexBufferUpdatable(H.c.MatricesWeightsKind)&&(q.matricesWeights._updatable=!0)),q.indices=this._toNumberArray(this.Nd()),q}static ExtractFromMesh(q,X){const Q=q._geometry;return Q?Q.j(X):null}static RandomId(){return R.f.RandomId()}static _GetGeometryByLoadedUniqueId(q,X){for(let Q=0;Q<X.geometries.length;Q++)if(X.geometries[Q]._loadedUniqueId===q)return X.geometries[Q];return null}static _ImportGeometry(q,X){const Q=X.va(),y=q.geometryUniqueId,u=q.geometryId;if(y||u){const q=y?this._GetGeometryByLoadedUniqueId(y,Q):Q.getGeometryById(u);q&&q.Ca(X)}else if(q instanceof ArrayBuffer){const Q=X._binaryInfo;if(Q.positionsAttrDesc&&Q.positionsAttrDesc.count>0){const y=new Float32Array(q,Q.positionsAttrDesc.offset,Q.positionsAttrDesc.count);X.Ga(H.c.PositionKind,y,!1)}if(Q.normalsAttrDesc&&Q.normalsAttrDesc.count>0){const y=new Float32Array(q,Q.normalsAttrDesc.offset,Q.normalsAttrDesc.count);X.Ga(H.c.NormalKind,y,!1)}if(Q.tangetsAttrDesc&&Q.tangetsAttrDesc.count>0){const y=new Float32Array(q,Q.tangetsAttrDesc.offset,Q.tangetsAttrDesc.count);X.Ga(H.c.TangentKind,y,!1)}if(Q.uvsAttrDesc&&Q.uvsAttrDesc.count>0){const y=new Float32Array(q,Q.uvsAttrDesc.offset,Q.uvsAttrDesc.count);if(j.c)for(let q=1;q<y.length;q+=2)y[q]=1-y[q];X.Ga(H.c.UVKind,y,!1)}if(Q.uvs2AttrDesc&&Q.uvs2AttrDesc.count>0){const y=new Float32Array(q,Q.uvs2AttrDesc.offset,Q.uvs2AttrDesc.count);if(j.c)for(let q=1;q<y.length;q+=2)y[q]=1-y[q];X.Ga(H.c.UV2Kind,y,!1)}if(Q.uvs3AttrDesc&&Q.uvs3AttrDesc.count>0){const y=new Float32Array(q,Q.uvs3AttrDesc.offset,Q.uvs3AttrDesc.count);if(j.c)for(let q=1;q<y.length;q+=2)y[q]=1-y[q];X.Ga(H.c.UV3Kind,y,!1)}if(Q.uvs4AttrDesc&&Q.uvs4AttrDesc.count>0){const y=new Float32Array(q,Q.uvs4AttrDesc.offset,Q.uvs4AttrDesc.count);if(j.c)for(let q=1;q<y.length;q+=2)y[q]=1-y[q];X.Ga(H.c.UV4Kind,y,!1)}if(Q.uvs5AttrDesc&&Q.uvs5AttrDesc.count>0){const y=new Float32Array(q,Q.uvs5AttrDesc.offset,Q.uvs5AttrDesc.count);if(j.c)for(let q=1;q<y.length;q+=2)y[q]=1-y[q];X.Ga(H.c.UV5Kind,y,!1)}if(Q.uvs6AttrDesc&&Q.uvs6AttrDesc.count>0){const y=new Float32Array(q,Q.uvs6AttrDesc.offset,Q.uvs6AttrDesc.count);if(j.c)for(let q=1;q<y.length;q+=2)y[q]=1-y[q];X.Ga(H.c.UV6Kind,y,!1)}if(Q.colorsAttrDesc&&Q.colorsAttrDesc.count>0){const y=new Float32Array(q,Q.colorsAttrDesc.offset,Q.colorsAttrDesc.count);X.Ga(H.c.ColorKind,y,!1,Q.colorsAttrDesc.stride)}if(Q.matricesIndicesAttrDesc&&Q.matricesIndicesAttrDesc.count>0){const y=new Int32Array(q,Q.matricesIndicesAttrDesc.offset,Q.matricesIndicesAttrDesc.count),x=[];for(let q=0;q<y.length;q++){const X=y[q];x.push(255&X),x.push((65280&X)>>8),x.push((16711680&X)>>16),x.push(X>>24&255)}X.Ga(H.c.MatricesIndicesKind,x,!1)}if(Q.matricesIndicesExtraAttrDesc&&Q.matricesIndicesExtraAttrDesc.count>0){const y=new Int32Array(q,Q.matricesIndicesExtraAttrDesc.offset,Q.matricesIndicesExtraAttrDesc.count),x=[];for(let q=0;q<y.length;q++){const X=y[q];x.push(255&X),x.push((65280&X)>>8),x.push((16711680&X)>>16),x.push(X>>24&255)}X.Ga(H.c.MatricesIndicesExtraKind,x,!1)}if(Q.matricesWeightsAttrDesc&&Q.matricesWeightsAttrDesc.count>0){const y=new Float32Array(q,Q.matricesWeightsAttrDesc.offset,Q.matricesWeightsAttrDesc.count);X.Ga(H.c.MatricesWeightsKind,y,!1)}if(Q.indicesAttrDesc&&Q.indicesAttrDesc.count>0){const y=new Int32Array(q,Q.indicesAttrDesc.offset,Q.indicesAttrDesc.count);X.setIndices(y,null)}if(Q.subMeshesAttrDesc&&Q.subMeshesAttrDesc.count>0){const y=new Int32Array(q,Q.subMeshesAttrDesc.offset,5*Q.subMeshesAttrDesc.count);X.be=[];for(let q=0;q<Q.subMeshesAttrDesc.count;q++){const Q=y[5*q+0],x=y[5*q+1],u=y[5*q+2],H=y[5*q+3],D=y[5*q+4];b.e.AddToMesh(Q,x,u,H,D,X)}}}else if(q.xa&&q.ya&&q.indices){if(X.Ga(H.c.PositionKind,q.xa,q.xa._updatable),X.Ga(H.c.NormalKind,q.ya,q.ya._updatable),q.tangents&&X.Ga(H.c.TangentKind,q.tangents,q.tangents._updatable),q.Aa&&X.Ga(H.c.UVKind,q.Aa,q.Aa._updatable),q.uvs2&&X.Ga(H.c.UV2Kind,q.uvs2,q.uvs2._updatable),q.uvs3&&X.Ga(H.c.UV3Kind,q.uvs3,q.uvs3._updatable),q.uvs4&&X.Ga(H.c.UV4Kind,q.uvs4,q.uvs4._updatable),q.uvs5&&X.Ga(H.c.UV5Kind,q.uvs5,q.uvs5._updatable),q.uvs6&&X.Ga(H.c.UV6Kind,q.uvs6,q.uvs6._updatable),q.za&&X.Ga(H.c.ColorKind,x.c.CheckColors4(q.za,q.xa.length/3),q.za._updatable),q.matricesIndices)if(q.matricesIndices._isExpanded)delete q.matricesIndices._isExpanded,X.Ga(H.c.MatricesIndicesKind,q.matricesIndices,q.matricesIndices._updatable);else{const Q=[];for(let X=0;X<q.matricesIndices.length;X++){const y=q.matricesIndices[X];Q.push(255&y),Q.push((65280&y)>>8),Q.push((16711680&y)>>16),Q.push(y>>24&255)}X.Ga(H.c.MatricesIndicesKind,Q,q.matricesIndices._updatable)}if(q.matricesIndicesExtra)if(q.matricesIndicesExtra._isExpanded)delete q.matricesIndices._isExpanded,X.Ga(H.c.MatricesIndicesExtraKind,q.matricesIndicesExtra,q.matricesIndicesExtra._updatable);else{const Q=[];for(let X=0;X<q.matricesIndicesExtra.length;X++){const y=q.matricesIndicesExtra[X];Q.push(255&y),Q.push((65280&y)>>8),Q.push((16711680&y)>>16),Q.push(y>>24&255)}X.Ga(H.c.MatricesIndicesExtraKind,Q,q.matricesIndicesExtra._updatable)}q.matricesWeights&&(d._CleanMatricesWeights(q,X),X.Ga(H.c.MatricesWeightsKind,q.matricesWeights,q.matricesWeights._updatable)),q.matricesWeightsExtra&&X.Ga(H.c.MatricesWeightsExtraKind,q.matricesWeightsExtra,q.matricesWeights._updatable),X.setIndices(q.indices,null)}if(q.be){X.be=[];for(let Q=0;Q<q.be.length;Q++){const y=q.be[Q];b.e.AddToMesh(y.materialIndex,y.verticesStart,y.verticesCount,y.indexStart,y.indexCount,X)}}X._shouldGenerateFlatShading&&(X.convertToFlatShadedMesh(),X._shouldGenerateFlatShading=!1),X.le(!0),Q.onMeshImportedObservable.notifyObservers(X)}static _CleanMatricesWeights(q,X){const Q=.001;if(!D.c.CleanBoneMatrixWeights)return;let y=0;if(!(q.skeletonId>-1))return;{const Q=X.va().getLastSkeletonById(q.skeletonId);if(!Q)return;y=Q.bones.length}const x=X.getVerticesData(H.c.MatricesIndicesKind),u=X.getVerticesData(H.c.MatricesIndicesExtraKind),b=q.matricesWeights,a=q.matricesWeightsExtra,R=q.numBoneInfluencer,L=b.length;for(let H=0;H<L;H+=4){let q=0,X=-1;for(let y=0;y<4;y++){const x=b[H+y];q+=x,x<Q&&X<0&&(X=y)}if(a)for(let y=0;y<4;y++){const x=a[H+y];q+=x,x<Q&&X<0&&(X=y+4)}if((X<0||X>R-1)&&(X=R-1),q>Q){const X=1/q;for(let q=0;q<4;q++)b[H+q]*=X;if(a)for(let q=0;q<4;q++)a[H+q]*=X}else X>=4?(a[H+X-4]=1-q,u[H+X-4]=y):(b[H+X]=1-q,x[H+X]=y)}X.Ga(H.c.MatricesIndicesKind,x),q.matricesWeightsExtra&&X.Ga(H.c.MatricesIndicesExtraKind,u)}static Parse(q,X,Q){const x=new d(q.id,X,void 0,q.updatable);return x._loadedUniqueId=q.uniqueId,L.d&&L.d.AddTagsTo(x,q.tags),q.delayLoadingFile?(x.delayLoadState=4,x.delayLoadingFile=Q+q.delayLoadingFile,x._boundingInfo=new a.e(y.n.Rd(q.boundingBoxMinimum),y.n.Rd(q.boundingBoxMaximum)),x._delayInfo=[],q.hasUVs&&x._delayInfo.push(H.c.UVKind),q.hasUVs2&&x._delayInfo.push(H.c.UV2Kind),q.hasUVs3&&x._delayInfo.push(H.c.UV3Kind),q.hasUVs4&&x._delayInfo.push(H.c.UV4Kind),q.hasUVs5&&x._delayInfo.push(H.c.UV5Kind),q.hasUVs6&&x._delayInfo.push(H.c.UV6Kind),q.hasColors&&x._delayInfo.push(H.c.ColorKind),q.hasMatricesIndices&&x._delayInfo.push(H.c.MatricesIndicesKind),q.hasMatricesWeights&&x._delayInfo.push(H.c.MatricesWeightsKind),x._delayLoadingFunction=u.d.ImportVertexData):u.d.ImportVertexData(q,x),X.pushGeometry(x,!0),x}}},11907:(q,X,Q)=>{"use strict";Q.d(X,{d:()=>f});var y=Q(1002),x=Q(1099),u=Q(11291),H=Q(11253),b=Q(1220),D=Q(11298),a=Q(1261),R=Q(1215),L=Q(1015);H.b._instancedMeshFactory=(q,X)=>{const Q=new f(q,X);if(X.instancedBuffers){Q.instancedBuffers={};for(const q in X.instancedBuffers)Q.instancedBuffers[q]=X.instancedBuffers[q]}return Q};class f extends u.c{constructor(q,X){super(q,X.va()),this._indexInSourceMeshInstanceArray=-1,this._distanceToCamera=0,X.Cj(this),this._sourceMesh=X,this._unIndexed=X._unIndexed,this.position.p(X.position),this.rotation.p(X.rotation),this.He.p(X.He),X.rotationQuaternion&&(this.rotationQuaternion=X.rotationQuaternion.clone()),this.animations=X.animations.slice();for(const Q of X.getAnimationRanges())null!=Q&&this.createAnimationRange(Q.name,Q.from,Q.to);this.infiniteDistance=X.infiniteDistance,this.setPivotMatrix(X.getPivotMatrix()),this.refreshBoundingInfo(!0,!0),this._syncSubMeshes()}getClassName(){return"InstancedMesh"}get lightSources(){return this._sourceMesh._lightSources}_resyncLightSources(){}_resyncLightSource(){}_removeLightSource(){}get receiveShadows(){return this._sourceMesh.receiveShadows}set receiveShadows(q){var X;(null===(X=this._sourceMesh)||void 0===X?void 0:X.receiveShadows)!==q&&R.f.Warn("Setting receiveShadows on an instanced mesh has no effect")}get material(){return this._sourceMesh.material}set material(q){var X;(null===(X=this._sourceMesh)||void 0===X?void 0:X.material)!==q&&R.f.Warn("Setting material on an instanced mesh has no effect")}get visibility(){return this._sourceMesh.visibility}set visibility(q){var X;(null===(X=this._sourceMesh)||void 0===X?void 0:X.visibility)!==q&&R.f.Warn("Setting visibility on an instanced mesh has no effect")}get skeleton(){return this._sourceMesh.skeleton}set skeleton(q){var X;(null===(X=this._sourceMesh)||void 0===X?void 0:X.skeleton)!==q&&R.f.Warn("Setting skeleton on an instanced mesh has no effect")}get renderingGroupId(){return this._sourceMesh.renderingGroupId}set renderingGroupId(q){this._sourceMesh&&q!==this._sourceMesh.renderingGroupId&&x.b.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")}getTotalVertices(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0}getTotalIndices(){return this._sourceMesh.getTotalIndices()}get sourceMesh(){return this._sourceMesh}kd(q){return this._sourceMesh.kd(q)}isReady(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._sourceMesh.isReady(q,!0)}getVerticesData(q,X,Q){return this._sourceMesh.getVerticesData(q,X,Q)}copyVerticesData(q,X){this._sourceMesh.copyVerticesData(q,X)}Ga(q,X,Q,y){return this.sourceMesh&&this.sourceMesh.Ga(q,X,Q,y),this.sourceMesh}updateVerticesData(q,X,Q,y){return this.sourceMesh&&this.sourceMesh.updateVerticesData(q,X,Q,y),this.sourceMesh}setIndices(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.sourceMesh&&this.sourceMesh.setIndices(q,X),this.sourceMesh}isVerticesDataPresent(q){return this._sourceMesh.isVerticesDataPresent(q)}Nd(){return this._sourceMesh.Nd()}get _positions(){return this._sourceMesh._positions}refreshBoundingInfo(){let q,X=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;q="object"===typeof X?X:{applySkeleton:X,applyMorph:Q};const y=this._sourceMesh.ze?this._sourceMesh.ze.boundingBias:null;return this.Fa(this._sourceMesh._getData(q,null,a.c.PositionKind),y),this}_preActivate(){return this._currentLOD&&this._currentLOD._preActivate(),this}_activate(q,X){if(super._activate(q,X),this._sourceMesh.be||x.b.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!==this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,q),X){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1}_postActivate(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)}getWorldMatrix(){if(this._currentLOD&&this._currentLOD.billboardMode!==D.c.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new y.b);const q=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,y.h.Od[7].p(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.p(this._currentLOD.le(!0)),this._currentLOD.position.p(y.h.Od[7]),this._currentLOD._masterMesh=q,this._billboardWorldMatrix}return super.getWorldMatrix()}get isAnInstance(){return!0}getLOD(q){if(!q)return this;const X=this.sourceMesh.getLODLevels();if(X&&0!==X.length){const X=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(q,X.boundingSphere)}else this._currentLOD=this.sourceMesh;return this._currentLOD}_preActivateForIntermediateRendering(q){return this.sourceMesh._preActivateForIntermediateRendering(q)}_syncSubMeshes(){if(this.releaseSubMeshes(),this._sourceMesh.be)for(let q=0;q<this._sourceMesh.be.length;q++)this._sourceMesh.be[q].clone(this,this._sourceMesh);return this}_generatePointsArray(){return this._sourceMesh._generatePointsArray()}Ea(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}clone(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Q=arguments.length>2?arguments[2]:void 0;const y=((arguments.length>3?arguments[3]:void 0)||this._sourceMesh).kd(q);if(b.d.DeepCopy(this,y,["name","be","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","nj","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo"],[]),this.refreshBoundingInfo(),X&&(y.parent=X),!Q)for(let x=0;x<this.va().meshes.length;x++){const q=this.va().meshes[x];q.parent===this&&q.clone(q.name,y)}return y.le(!0),this.onClonedObservable.notifyObservers(y),y}dispose(q){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._sourceMesh.Bj(this),super.dispose(q,X)}_serializeAsParent(q){super._serializeAsParent(q),q.parentId=this._sourceMesh.uniqueId,q.parentInstanceIndex=this._indexInSourceMeshInstanceArray}instantiateHierarchy(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,X=arguments.length>1?arguments[1]:void 0,Q=arguments.length>2?arguments[2]:void 0;const y=this.clone("Clone of "+(this.name||this.id),q||this.parent,!0,X&&X.newSourcedMesh);y&&Q&&Q(this,y);for(const x of this.getChildTransformNodes(!0))x.instantiateHierarchy(y,X,Q);return y}}H.b.prototype.registerInstancedBuffer=function(q,X){var Q,y;if(null===(Q=this._userInstancedBuffersStorage)||void 0===Q||null===(y=Q.vertexBuffers[q])||void 0===y||y.dispose(),!this.instancedBuffers){this.instancedBuffers={};for(const q of this.instances)q.instancedBuffers={}}this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this.instancedBuffers[q]=null,this._userInstancedBuffersStorage.strides[q]=X,this._userInstancedBuffersStorage.sizes[q]=32*X,this._userInstancedBuffersStorage.data[q]=new Float32Array(this._userInstancedBuffersStorage.sizes[q]),this._userInstancedBuffersStorage.vertexBuffers[q]=new a.c(this.getEngine(),this._userInstancedBuffersStorage.data[q],q,!0,!1,X,!0);for(const x of this.instances)x.instancedBuffers[q]=null;this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()},H.b.prototype._processInstancedBuffers=function(q,X){const Q=q?q.length:0;for(const y in this.instancedBuffers){let x=this._userInstancedBuffersStorage.sizes[y];const u=this._userInstancedBuffersStorage.strides[y],H=(Q+1)*u;for(;x<H;)x*=2;this._userInstancedBuffersStorage.data[y].length!=x&&(this._userInstancedBuffersStorage.data[y]=new Float32Array(x),this._userInstancedBuffersStorage.sizes[y]=x,this._userInstancedBuffersStorage.vertexBuffers[y]&&(this._userInstancedBuffersStorage.vertexBuffers[y].dispose(),this._userInstancedBuffersStorage.vertexBuffers[y]=null));const b=this._userInstancedBuffersStorage.data[y];let D=0;if(X){const q=this.instancedBuffers[y];q.toArray?q.toArray(b,D):q.copyToArray?q.copyToArray(b,D):b[D]=q,D+=u}for(let X=0;X<Q;X++){const Q=q[X].instancedBuffers[y];Q.toArray?Q.toArray(b,D):Q.copyToArray?Q.copyToArray(b,D):b[D]=Q,D+=u}this._userInstancedBuffersStorage.vertexBuffers[y]?this._userInstancedBuffersStorage.vertexBuffers[y].updateDirectly(b,0):(this._userInstancedBuffersStorage.vertexBuffers[y]=new a.c(this.getEngine(),this._userInstancedBuffersStorage.data[y],y,!0,!1,u,!0),this._invalidateInstanceVertexArrayObject())}},H.b.prototype._invalidateInstanceVertexArrayObject=function(){if(this._userInstancedBuffersStorage&&void 0!==this._userInstancedBuffersStorage.vertexArrayObjects){for(const q in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[q]);this._userInstancedBuffersStorage.vertexArrayObjects={}}},H.b.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(const q in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[q]&&this._userInstancedBuffersStorage.vertexBuffers[q].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}},(0,L.h)("BABYLON.InstancedMesh",f)},11253:(q,X,Q)=>{"use strict";Q.d(X,{b:()=>l,c:()=>U});var y=Q(998),x=Q(1215),u=Q(1220),H=Q(1175),b=Q(11259),D=Q(11265),a=Q(1002),R=Q(1182),L=Q(11270),f=Q(1261),k=Q(11276),j=Q(11279),I=Q(11291),d=Q(1337),e=Q(1331),i=Q(11307),A=Q(11284),B=Q(1173),w=Q(1099),V=Q(1015),W=Q(1081),v=Q(1285);class Z{constructor(q,X){this.distanceOrScreenCoverage=q,this.mesh=X}}class U{}class O{constructor(){this.visibleInstances={},this.batchCache=new g,this.batchCacheReplacementModeInFrozenMode=new g,this.instancesBufferSize=2048}}class g{constructor(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=[],this.hardwareInstancedRendering=[]}}class P{constructor(){this.instancesCount=0,this.matrixBuffer=null,this.previousMatrixBuffer=null,this.matrixBufferSize=512,this.matrixData=null,this.boundingVectors=[],this.worldMatrices=null}}class F{constructor(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._useLODScreenCoverage=!1,this._effectiveMaterial=null,this._forcedInstanceCount=0,this._overrideRenderingFillMode=null}}class l extends I.c{static _GetDefaultSideOrientation(q){return q||l.FRONTSIDE}get useLODScreenCoverage(){return this._internalMeshDataInfo._useLODScreenCoverage}set useLODScreenCoverage(q){this._internalMeshDataInfo._useLODScreenCoverage=q,this._sortLODLevels()}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(q){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==q&&(q&&this._internalMeshDataInfo._sourcePositions&&(this.Ga(f.c.PositionKind,this._internalMeshDataInfo._sourcePositions,!0),this._internalMeshDataInfo._sourceNormals&&this.Ga(f.c.NormalKind,this._internalMeshDataInfo._sourceNormals,!0),this._internalMeshDataInfo._sourcePositions=null,this._internalMeshDataInfo._sourceNormals=null),this._internalAbstractMeshDataInfo._computeBonesUsingShaders=q,this._markSubMeshesAsAttributesDirty())}get onBeforeRenderObservable(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new y.c),this._internalMeshDataInfo._onBeforeRenderObservable}get onBeforeBindObservable(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new y.c),this._internalMeshDataInfo._onBeforeBindObservable}get onAfterRenderObservable(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new y.c),this._internalMeshDataInfo._onAfterRenderObservable}get onBetweenPassObservable(){return this._internalMeshDataInfo._onBetweenPassObservable||(this._internalMeshDataInfo._onBetweenPassObservable=new y.c),this._internalMeshDataInfo._onBetweenPassObservable}get onBeforeDrawObservable(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new y.c),this._internalMeshDataInfo._onBeforeDrawObservable}set onBeforeDraw(q){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(q)}get hasInstances(){return this.instances.length>0}get hasThinInstances(){return(this.forcedInstanceCount||this._thinInstanceDataStorage.instancesCount||0)>0}get forcedInstanceCount(){return this._internalMeshDataInfo._forcedInstanceCount}set forcedInstanceCount(q){this._internalMeshDataInfo._forcedInstanceCount=q}get sideOrientation(){return this._internalMeshDataInfo._sideOrientation}set sideOrientation(q){this._internalMeshDataInfo._sideOrientation=q,this._internalAbstractMeshDataInfo._sideOrientationHint=this._scene.useRightHandedSystem&&1===q||!this._scene.useRightHandedSystem&&0===q}get overrideMaterialSideOrientation(){return this.sideOrientation}set overrideMaterialSideOrientation(q){this.sideOrientation=q,this.material&&(this.material.sideOrientation=null)}get overrideRenderingFillMode(){return this._internalMeshDataInfo._overrideRenderingFillMode}set overrideRenderingFillMode(q){this._internalMeshDataInfo._overrideRenderingFillMode=q}get material(){return this._internalAbstractMeshDataInfo._material}set material(q){q&&(this.material&&null===this.material.sideOrientation||this._internalAbstractMeshDataInfo._sideOrientationHint)&&(q.sideOrientation=null),this._setMaterial(q)}get source(){return this._internalMeshDataInfo._source}get cloneMeshMap(){return this._internalMeshDataInfo.meshMap}get isUnIndexed(){return this._unIndexed}set isUnIndexed(q){this._unIndexed!==q&&(this._unIndexed=q,this._markSubMeshesAsAttributesDirty())}get worldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesData}get previousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesPreviousData}get manualUpdateOfWorldMatrixInstancedBuffer(){return this._instanceDataStorage.manualUpdate}set manualUpdateOfWorldMatrixInstancedBuffer(q){this._instanceDataStorage.manualUpdate=q}get manualUpdateOfPreviousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.previousManualUpdate}set manualUpdateOfPreviousWorldMatrixInstancedBuffer(q){this._instanceDataStorage.previousManualUpdate=q}get forceWorldMatrixInstancedBufferUpdate(){return this._instanceDataStorage.forceMatrixUpdates}set forceWorldMatrixInstancedBufferUpdate(q){this._instanceDataStorage.forceMatrixUpdates=q}_copySource(q,X){let Q=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const y=this.va();if(q._geometry&&q._geometry.Ca(this),u.d.DeepCopy(q,this,["name","material","skeleton","instances","parent","uniqueId","source","metadata","morphTargetManager","hasInstances","worldMatrixInstancedBuffer","previousWorldMatrixInstancedBuffer","hasLODLevels","ze","isBlocked","areNormalsFrozen","facetNb","isFacetDataEnabled","lightSources","useBones","isAnInstance","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","nj","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","cloneMeshMap","hasBoundingInfo","physicsBody","physicsImpostor"],["_poseMatrix"]),this._internalMeshDataInfo._source=q,y.useClonedMeshMap&&(q._internalMeshDataInfo.meshMap||(q._internalMeshDataInfo.meshMap={}),q._internalMeshDataInfo.meshMap[this.uniqueId]=this),this._originalBuilderSideOrientation=q._originalBuilderSideOrientation,this._creationDataStorage=q._creationDataStorage,q._ranges){const X=q._ranges;for(const q in X)Object.prototype.hasOwnProperty.call(X,q)&&X[q]&&this.createAnimationRange(q,X[q].from,X[q].to)}if(q.metadata&&q.metadata.clone?this.metadata=q.metadata.clone():this.metadata=q.metadata,this._internalMetadata=q._internalMetadata,H.d&&H.d.HasTags(q)&&H.d.AddTagsTo(this,H.d.GetTags(q,!0)),this.tg(q.isEnabled(!1)),this.parent=q.parent,this.setPivotMatrix(q.getPivotMatrix(),this._postMultiplyPivotMatrix),this.id=this.name+"."+q.id,this.material=q.material,!X){const X=q.getDescendants(!0);for(let q=0;q<X.length;q++){const Q=X[q];Q.clone&&Q.clone(this.name+"."+Q.name,this)}}if(q.morphTargetManager&&(this.morphTargetManager=q.morphTargetManager),y.getPhysicsEngine){const X=y.getPhysicsEngine();if(Q&&X)if(1===X.getPluginVersion()){const Q=X.getImpostorForPhysicsObject(q);Q&&(this.physicsImpostor=Q.clone(this))}else 2===X.getPluginVersion()&&q.physicsBody&&q.physicsBody.clone(this)}for(let x=0;x<y.je.length;x++){const X=y.je[x];X.k===q&&X.clone(X.name,this)}this.skeleton=q.skeleton,this.refreshBoundingInfo(!0,!0),this.le(!0)}constructor(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,u=arguments.length>4?arguments[4]:void 0,H=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];super(q,X),this._internalMeshDataInfo=new F,this.delayLoadState=0,this.instances=[],this._creationDataStorage=null,this._geometry=null,this._instanceDataStorage=new O,this._thinInstanceDataStorage=new P,this._shouldGenerateFlatShading=!1,this._originalBuilderSideOrientation=l.DEFAULTSIDE,this.ignoreCameraMaxZ=!1,X=this.va(),this._scene.useRightHandedSystem?this.sideOrientation=0:this.sideOrientation=1,this._onBeforeDraw=(q,X,Q)=>{q&&Q&&(this._uniformBuffer?this.transferToEffect(X):Q.bindOnlyWorldMatrix(X))},x&&this._copySource(x,u,H),null!==Q&&(this.parent=Q),this._instanceDataStorage.hardwareInstancedRendering=this.getEngine().getCaps().instancedArrays,this._internalMeshDataInfo._onMeshReadyObserverAdded=q=>{q.unregisterOnNextCall=!0,this.isReady(!0)?this.onMeshReadyObservable.notifyObservers(this):this._internalMeshDataInfo._checkReadinessObserver||(this._internalMeshDataInfo._checkReadinessObserver=this._scene.onBeforeRenderObservable.add((()=>{this.isReady(!0)&&(this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),this._internalMeshDataInfo._checkReadinessObserver=null,this.onMeshReadyObservable.notifyObservers(this))})))},this.onMeshReadyObservable=new y.c(this._internalMeshDataInfo._onMeshReadyObserverAdded),x&&x.onClonedObservable.notifyObservers(this)}instantiateHierarchy(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,X=arguments.length>1?arguments[1]:void 0,Q=arguments.length>2?arguments[2]:void 0;const y=0===this.getTotalVertices()||X&&X.doNotInstantiate&&(!0===X.doNotInstantiate||X.doNotInstantiate(this))?this.clone("Clone of "+(this.name||this.id),q||this.parent,!0):this.kd("instance of "+(this.name||this.id));y.parent=q||this.parent,y.position=this.position.clone(),y.He=this.He.clone(),this.rotationQuaternion?y.rotationQuaternion=this.rotationQuaternion.clone():y.rotation=this.rotation.clone(),Q&&Q(this,y);for(const x of this.getChildTransformNodes(!0))"InstancedMesh"===x.getClassName()&&"Mesh"===y.getClassName()&&x.sourceMesh===this?x.instantiateHierarchy(y,{doNotInstantiate:X&&X.doNotInstantiate||!1,newSourcedMesh:y},Q):x.instantiateHierarchy(y,X,Q);return y}getClassName(){return"Mesh"}get _isMesh(){return!0}toString(q){let X=super.toString(q);if(X+=", n vertices: "+this.getTotalVertices(),X+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(let Q=0;Q<this.animations.length;Q++)X+=", animation[0]: "+this.animations[Q].toString(q);if(q)if(this._geometry){const q=this.Nd(),Q=this.getVerticesData(f.c.PositionKind);Q&&q&&(X+=", flat shading: "+(Q.length/3===q.length?"YES":"NO"))}else X+=", flat shading: UNKNOWN";return X}_unBindEffect(){super._unBindEffect();for(const q of this.instances)q._unBindEffect()}get hasLODLevels(){return this._internalMeshDataInfo._LODLevels.length>0}getLODLevels(){return this._internalMeshDataInfo._LODLevels}_sortLODLevels(){const q=this._internalMeshDataInfo._useLODScreenCoverage?-1:1;this._internalMeshDataInfo._LODLevels.sort(((X,Q)=>X.distanceOrScreenCoverage<Q.distanceOrScreenCoverage?q:X.distanceOrScreenCoverage>Q.distanceOrScreenCoverage?-q:0))}addLODLevel(q,X){if(X&&X._masterMesh)return w.b.Warn("You cannot use a mesh as LOD level twice"),this;const Q=new Z(q,X);return this._internalMeshDataInfo._LODLevels.push(Q),X&&(X._masterMesh=this),this._sortLODLevels(),this}getLODLevelAtDistance(q){const X=this._internalMeshDataInfo;for(let Q=0;Q<X._LODLevels.length;Q++){const y=X._LODLevels[Q];if(y.distanceOrScreenCoverage===q)return y.mesh}return null}removeLODLevel(q){const X=this._internalMeshDataInfo;for(let Q=0;Q<X._LODLevels.length;Q++)X._LODLevels[Q].mesh===q&&(X._LODLevels.splice(Q,1),q&&(q._masterMesh=null));return this._sortLODLevels(),this}getLOD(q,X){const Q=this._internalMeshDataInfo;if(!Q._LODLevels||0===Q._LODLevels.length)return this;const y=X||this.getBoundingInfo().boundingSphere,x=q.mode===D.c.ORTHOGRAPHIC_CAMERA?q._i:y.centerWorld.Sc(q.globalPosition).length();let u=x,H=1;if(Q._useLODScreenCoverage){const X=q.screenArea;let Q=y.radiusWorld*q._i/x;Q=Q*Q*Math.PI,u=Q/X,H=-1}if(H*Q._LODLevels[Q._LODLevels.length-1].distanceOrScreenCoverage>H*u)return this.onLODLevelSelection&&this.onLODLevelSelection(u,this,this),this;for(let b=0;b<Q._LODLevels.length;b++){const q=Q._LODLevels[b];if(H*q.distanceOrScreenCoverage<H*u){if(q.mesh){if(4===q.mesh.delayLoadState)return q.mesh._checkDelayState(),this;if(2===q.mesh.delayLoadState)return this;q.mesh._preActivate(),q.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)}return this.onLODLevelSelection&&this.onLODLevelSelection(u,this,q.mesh),q.mesh}}return this.onLODLevelSelection&&this.onLODLevelSelection(u,this,this),this}get ze(){return this._geometry}getTotalVertices(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()}getVerticesData(q,X,Q,y){var x,u;if(!this._geometry)return null;let H=y||null===(x=this._userInstancedBuffersStorage)||void 0===x||null===(u=x.vertexBuffers[q])||void 0===u?void 0:u.getFloatData(this.instances.length+1,Q||X&&1!==this._geometry.meshes.length);return H||(H=this._geometry.getVerticesData(q,X,Q)),H}copyVerticesData(q,X){this._geometry&&this._geometry.copyVerticesData(q,X)}getVertexBuffer(q,X){var Q;return this._geometry?(X||null===(Q=this._userInstancedBuffersStorage)||void 0===Q?void 0:Q.vertexBuffers[q])??this._geometry.getVertexBuffer(q):null}isVerticesDataPresent(q,X){var Q;return this._geometry?!X&&void 0!==(null===(Q=this._userInstancedBuffersStorage)||void 0===Q?void 0:Q.vertexBuffers[q])||this._geometry.isVerticesDataPresent(q):!!this._delayInfo&&-1!==this._delayInfo.indexOf(q)}isVertexBufferUpdatable(q,X){if(!this._geometry)return!!this._delayInfo&&-1!==this._delayInfo.indexOf(q);if(!X){var Q;const X=null===(Q=this._userInstancedBuffersStorage)||void 0===Q?void 0:Q.vertexBuffers[q];if(X)return X.isUpdatable()}return this._geometry.isVertexBufferUpdatable(q)}getVerticesDataKinds(q){if(!this._geometry){const q=[];return this._delayInfo&&this._delayInfo.forEach((function(X){q.push(X)})),q}const X=this._geometry.getVerticesDataKinds();if(!q&&this._userInstancedBuffersStorage)for(const Q in this._userInstancedBuffersStorage.vertexBuffers)-1===X.indexOf(Q)&&X.push(Q);return X}getTotalIndices(){return this._geometry?this._geometry.getTotalIndices():0}Nd(q,X){return this._geometry?this._geometry.Nd(q,X):[]}get isBlocked(){return null!==this._masterMesh&&void 0!==this._masterMesh}isReady(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],X=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(2===this.delayLoadState)return!1;if(!super.isReady(q))return!1;if(!this.be||0===this.be.length)return!0;if(!q)return!0;const Q=this.getEngine(),y=this.va(),x=X||Q.getCaps().instancedArrays&&(this.instances.length>0||this.hasThinInstances);this.le();const u=this.material||y.defaultMaterial;if(u)if(u._storeEffectOnSubMeshes)for(const f of this.be){const q=f.Ha();if(q)if(q._storeEffectOnSubMeshes){if(!q.isReadyForSubMesh(this,f,x))return!1}else if(!q.isReady(this,x))return!1}else if(!u.isReady(this,x))return!1;const H=Q.currentRenderPassId;for(const f of this.lightSources){const q=f.getShadowGenerators();if(!q)continue;const X=q.values();for(let y=X.next();!0!==y.done;y=X.next()){var b,D,a,R;const q=y.value;if(q&&(null===(b=q.getShadowMap())||void 0===b||!b.renderList||null!==(D=q.getShadowMap())&&void 0!==D&&D.renderList&&-1!==(null===(a=q.getShadowMap())||void 0===a||null===(R=a.renderList)||void 0===R?void 0:R.indexOf(this)))){const X=q.getShadowMap().renderPassIds??[Q.currentRenderPassId];for(let y=0;y<X.length;++y){Q.currentRenderPassId=X[y];for(const X of this.be){var L;if(!q.isReady(X,x,(null===(L=X.Ha())||void 0===L?void 0:L.needAlphaBlendingForMesh(this))??!1))return Q.currentRenderPassId=H,!1}}Q.currentRenderPassId=H}}}for(const f of this._internalMeshDataInfo._LODLevels)if(f.mesh&&!f.mesh.isReady(x))return!1;return!0}get areNormalsFrozen(){return this._internalMeshDataInfo._areNormalsFrozen}Yh(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this}unfreezeNormals(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this}set overridenInstanceCount(q){this._instanceDataStorage.overridenInstanceCount=q}_preActivate(){const q=this._internalMeshDataInfo,X=this.va().getRenderId();return q._preActivateId===X||(q._preActivateId=X,this._instanceDataStorage.visibleInstances=null),this}_preActivateForIntermediateRendering(q){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=q),this}_registerInstanceForRenderId(q,X){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:X,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[X]||(void 0!==this._instanceDataStorage.previousRenderId&&this._instanceDataStorage.isFrozen&&(this._instanceDataStorage.visibleInstances[this._instanceDataStorage.previousRenderId]=null),this._instanceDataStorage.previousRenderId=X,this._instanceDataStorage.visibleInstances[X]=new Array),this._instanceDataStorage.visibleInstances[X].push(q),this}_afterComputeWorldMatrix(){super._afterComputeWorldMatrix(),this.hasThinInstances&&(this.Da||this.thinInstanceRefreshBoundingInfo(!1))}_postActivate(){this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup&&(this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer),this.edgesRenderer.customInstances.push(this.getWorldMatrix()))}refreshBoundingInfo(){let q,X=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;q="object"===typeof X?X:{applySkeleton:X,applyMorph:Q};const y=this.ze?this.ze.boundingBias:null;return this.Fa(this._getData(q,null,f.c.PositionKind),y),this}_createGlobalSubMesh(q){const X=this.getTotalVertices();if(!X||!this.Nd())return null;if(this.be&&this.be.length>0){const Q=this.Nd();if(!Q)return null;const y=Q.length;let x=!1;if(q)x=!0;else for(const q of this.be){if(q.indexStart+q.indexCount>y){x=!0;break}if(q.verticesStart+q.verticesCount>X){x=!0;break}}if(!x)return this.be[0]}return this.releaseSubMeshes(),new d.e(0,0,X,0,this.getTotalIndices(),this)}subdivide(q){if(q<1)return;const X=this.getTotalIndices();let Q=X/q|0,y=0;for(;Q%3!==0;)Q++;this.releaseSubMeshes();for(let x=0;x<q&&!(y>=X);x++)d.e.CreateFromIndices(0,y,x===q-1?X-y:Q,this,void 0,!1),y+=Q;this.refreshBoundingInfo(),this.synchronizeInstances()}Ga(q,X){let Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2],y=arguments.length>3?arguments[3]:void 0;if(this._geometry)this._geometry.Ga(q,X,Q,y);else{const y=new k.d;y.set(X,q);const x=this.va();new j.d(j.d.RandomId(),x,y,Q,this)}return this}removeVerticesData(q){this._geometry&&this._geometry.removeVerticesData(q)}markVerticesDataAsUpdatable(q){let X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const Q=this.getVertexBuffer(q);Q&&Q.isUpdatable()!==X&&this.Ga(q,this.getVerticesData(q),X)}setVerticesBuffer(q){let X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._geometry||(this._geometry=j.d.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(q,null,X),this}updateVerticesData(q,X,Q,y){return this._geometry?(y?(this.makeGeometryUnique(),this.updateVerticesData(q,X,Q,!1)):this._geometry.updateVerticesData(q,X,Q),this):this}updateMeshPositions(q){let X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const Q=this.getVerticesData(f.c.PositionKind);if(!Q)return this;if(q(Q),this.updateVerticesData(f.c.PositionKind,Q,!1,!1),X){const q=this.Nd(),X=this.getVerticesData(f.c.NormalKind);if(!X)return this;k.d.ComputeNormals(Q,q,X),this.updateVerticesData(f.c.NormalKind,X,!1,!1)}return this}makeGeometryUnique(){if(!this._geometry)return this;if(1===this._geometry.meshes.length)return this;const q=this._geometry,X=this._geometry.j(j.d.RandomId());return q.releaseForMesh(this,!0),X.Ca(this),this}setIndexBuffer(q,X,Q){let y=this._geometry;y||(y=new j.d(j.d.RandomId(),this.va(),void 0,void 0,this)),y.setIndexBuffer(q,X,Q)}setIndices(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2],y=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this._geometry)this._geometry.setIndices(q,X,Q,y);else{const X=new k.d;X.indices=q;const y=this.va();new j.d(j.d.RandomId(),y,X,Q,this)}return this}updateIndices(q,X){let Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this._geometry?(this._geometry.updateIndices(q,X,Q),this):this}toLeftHanded(){return this._geometry?(this._geometry.toLeftHanded(),this):this}_bind(q,X,Q){let y=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!this._geometry)return this;const x=this.va().getEngine();let u;if(this._unIndexed)if(this._getRenderingFillMode(Q)===e.b.WireFrameFillMode)u=q._getLinesIndexBuffer(this.Nd(),x);else u=null;else switch(this._getRenderingFillMode(Q)){case e.b.PointFillMode:u=null;break;case e.b.WireFrameFillMode:u=q._getLinesIndexBuffer(this.Nd(),x);break;default:case e.b.TriangleFillMode:u=this._geometry.getIndexBuffer()}return this._bindDirect(X,u,y)}_bindDirect(q,X){let Q=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this._geometry?(this.morphTargetManager&&this.morphTargetManager.isUsingTextureForTargets&&this.morphTargetManager._bind(q),Q&&this._userInstancedBuffersStorage&&!this.hasThinInstances?this._geometry._bind(q,X,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects):this._geometry._bind(q,X),this):this}_draw(q,X,Q){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);const y=this.va().getEngine();return this._unIndexed&&X!==e.b.WireFrameFillMode||X==e.b.PointFillMode?y.drawArraysType(X,q.verticesStart,q.verticesCount,this.forcedInstanceCount||Q):X==e.b.WireFrameFillMode?y.drawElementsType(X,0,q._linesIndexCount,this.forcedInstanceCount||Q):y.drawElementsType(X,q.indexStart,q.indexCount,this.forcedInstanceCount||Q),this}registerBeforeRender(q){return this.onBeforeRenderObservable.add(q),this}unregisterBeforeRender(q){return this.onBeforeRenderObservable.removeCallback(q),this}registerAfterRender(q){return this.onAfterRenderObservable.add(q),this}unregisterAfterRender(q){return this.onAfterRenderObservable.removeCallback(q),this}_getInstancesRenderList(q){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._instanceDataStorage.isFrozen){if(X)return this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.hardwareInstancedRendering[q]=!1,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.renderSelf[q]=!0,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode;if(this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch}const Q=this.va(),y=Q._isInIntermediateRendering(),x=y?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,u=this._instanceDataStorage.batchCache;if(u.mustReturn=!1,u.renderSelf[q]=X||!x&&this.isEnabled()&&this.isVisible,u.visibleInstances[q]=null,this._instanceDataStorage.visibleInstances&&!X){const X=this._instanceDataStorage.visibleInstances,x=Q.getRenderId(),H=y?X.intermediateDefaultRenderId:X.defaultRenderId;u.visibleInstances[q]=X[x],!u.visibleInstances[q]&&H&&(u.visibleInstances[q]=X[H])}return u.hardwareInstancedRendering[q]=!X&&this._instanceDataStorage.hardwareInstancedRendering&&null!==u.visibleInstances[q]&&void 0!==u.visibleInstances[q],this._instanceDataStorage.previousBatch=u,u}_renderWithInstances(q,X,Q,y,x){const u=Q.visibleInstances[q._id],H=u?u.length:0,b=this._instanceDataStorage,D=b.instancesBufferSize;let R=b.instancesBuffer,L=b.instancesPreviousBuffer;const k=16*(H+1)*4;for(;b.instancesBufferSize<k;)b.instancesBufferSize*=2;b.instancesData&&D==b.instancesBufferSize||(b.instancesData=new Float32Array(b.instancesBufferSize/4)),(this._scene.needsPreviousWorldMatrices&&!b.instancesPreviousData||D!=b.instancesBufferSize)&&(b.instancesPreviousData=new Float32Array(b.instancesBufferSize/4));let j=0,I=0;const d=Q.renderSelf[q._id],e=!R||D!==b.instancesBufferSize||this._scene.needsPreviousWorldMatrices&&!b.instancesPreviousBuffer;if(this._instanceDataStorage.manualUpdate||b.isFrozen&&!e)I=(d?1:0)+H;else{const X=this.getWorldMatrix();if(d&&(this._scene.needsPreviousWorldMatrices&&(b.masterMeshPreviousWorldMatrix?(b.masterMeshPreviousWorldMatrix.copyToArray(b.instancesPreviousData,j),b.masterMeshPreviousWorldMatrix.p(X)):(b.masterMeshPreviousWorldMatrix=X.clone(),b.masterMeshPreviousWorldMatrix.copyToArray(b.instancesPreviousData,j))),X.copyToArray(b.instancesData,j),j+=16,I++),u){var i;if(l.INSTANCEDMESH_SORT_TRANSPARENT&&this._scene.activeCamera&&null!==(i=q.Ha())&&void 0!==i&&i.needAlphaBlendingForMesh(q.getRenderingMesh())){const q=this._scene.activeCamera.globalPosition;for(let X=0;X<u.length;X++){const Q=u[X];Q._distanceToCamera=a.n.Distance(Q.getBoundingInfo().boundingSphere.centerWorld,q)}u.sort(((q,X)=>q._distanceToCamera>X._distanceToCamera?-1:q._distanceToCamera<X._distanceToCamera?1:0))}for(let q=0;q<u.length;q++){const X=u[q],Q=X.getWorldMatrix();Q.copyToArray(b.instancesData,j),this._scene.needsPreviousWorldMatrices&&(X._previousWorldMatrix?(X._previousWorldMatrix.copyToArray(b.instancesPreviousData,j),X._previousWorldMatrix.p(Q)):(X._previousWorldMatrix=Q.clone(),X._previousWorldMatrix.copyToArray(b.instancesPreviousData,j))),j+=16,I++}}}return e?(R&&R.dispose(),L&&L.dispose(),R=new f.b(x,b.instancesData,!0,16,!1,!0),b.instancesBuffer=R,this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this._userInstancedBuffersStorage.vertexBuffers.world0=R.createVertexBuffer("world0",0,4),this._userInstancedBuffersStorage.vertexBuffers.world1=R.createVertexBuffer("world1",4,4),this._userInstancedBuffersStorage.vertexBuffers.world2=R.createVertexBuffer("world2",8,4),this._userInstancedBuffersStorage.vertexBuffers.world3=R.createVertexBuffer("world3",12,4),this._scene.needsPreviousWorldMatrices&&(L=new f.b(x,b.instancesPreviousData,!0,16,!1,!0),b.instancesPreviousBuffer=L,this._userInstancedBuffersStorage.vertexBuffers.previousWorld0=L.createVertexBuffer("previousWorld0",0,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld1=L.createVertexBuffer("previousWorld1",4,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld2=L.createVertexBuffer("previousWorld2",8,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld3=L.createVertexBuffer("previousWorld3",12,4)),this._invalidateInstanceVertexArrayObject()):this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||(R.updateDirectly(b.instancesData,0,I),!this._scene.needsPreviousWorldMatrices||this._instanceDataStorage.manualUpdate&&!this._instanceDataStorage.previousManualUpdate||L.updateDirectly(b.instancesPreviousData,0,I)),this._processInstancedBuffers(u,d),this.va()._activeIndices.addCount(q.indexCount*I,!1),x._currentDrawContext&&(x._currentDrawContext.useInstancing=!0),this._bind(q,y,X),this._draw(q,X,I),!this._scene.needsPreviousWorldMatrices||e||!this._instanceDataStorage.manualUpdate||this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||this._instanceDataStorage.previousManualUpdate||L.updateDirectly(b.instancesData,0,I),x.unbindInstanceAttributes(),this}_renderWithThinInstances(q,X,Q,y){var x;const u=(null===(x=this._thinInstanceDataStorage)||void 0===x?void 0:x.instancesCount)??0;this.va()._activeIndices.addCount(q.indexCount*u,!1),y._currentDrawContext&&(y._currentDrawContext.useInstancing=!0),this._bind(q,Q,X),this._draw(q,X,u),this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&this._thinInstanceDataStorage.matrixData&&(this._thinInstanceDataStorage.previousMatrixBuffer?this._thinInstanceDataStorage.previousMatrixBuffer.updateDirectly(this._thinInstanceDataStorage.matrixData,0,u):this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.matrixData,!1)),y.unbindInstanceAttributes()}_processInstancedBuffers(q,X){}_processRendering(q,X,Q,y,x,u,H,b){const D=this.va(),a=D.getEngine();if(y=this._getRenderingFillMode(y),u&&X.getRenderingMesh().hasThinInstances)return this._renderWithThinInstances(X,y,Q,a),this;if(u)this._renderWithInstances(X,y,x,Q,a);else{a._currentDrawContext&&(a._currentDrawContext.useInstancing=!1);let Q=0;x.renderSelf[X._id]&&(H&&H(!1,q.getWorldMatrix(),b),Q++,this._draw(X,y,this._instanceDataStorage.overridenInstanceCount));const u=x.visibleInstances[X._id];if(u){const q=u.length;Q+=q;for(let Q=0;Q<q;Q++){const q=u[Q].getWorldMatrix();H&&H(!0,q,b),this._draw(X,y)}}D._activeIndices.addCount(X.indexCount*Q,!1)}return this}_rebuild(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._instanceDataStorage.instancesBuffer&&(q&&this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),this._userInstancedBuffersStorage){for(const X in this._userInstancedBuffersStorage.vertexBuffers){const Q=this._userInstancedBuffersStorage.vertexBuffers[X];Q&&(q&&Q.dispose(),this._userInstancedBuffersStorage.vertexBuffers[X]=null)}this._userInstancedBuffersStorage.vertexArrayObjects&&(this._userInstancedBuffersStorage.vertexArrayObjects={})}this._internalMeshDataInfo._effectiveMaterial=null,super._rebuild(q)}_freeze(){if(this.be){for(let q=0;q<this.be.length;q++)this._getInstancesRenderList(q);this._internalMeshDataInfo._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}}_unFreeze(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null}renderWithRenderPassId(q,X,Q,y){let x=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const u=this._scene.getEngine(),H=u.currentRenderPassId;if(void 0!==q&&(u.currentRenderPassId=q),y)(!x||x&&y.isInFrustum(this._scene._frustumPlanes))&&this.render(y,!!X,Q);else for(let b=0;b<this.be.length;b++){const q=this.be[b];(!x||x&&q.isInFrustum(this._scene._frustumPlanes))&&this.render(q,!!X,Q)}return void 0!==q&&(u.currentRenderPassId=H),this}directRender(){if(!this.be)return this;for(const q of this.be)this.render(q,!1);return this}render(q,X,Q){var y,x,u;const H=this.va();this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1;const b=(null===(y=H.activeCameras)||void 0===y?void 0:y.length)??0;if((b>1&&H.activeCamera===H.activeCameras[0]||b<=1)&&this._checkOcclusionQuery()&&!this._occlusionDataStorage.forceRenderingWhenOccluded)return this;const D=this._getInstancesRenderList(q._id,!!Q);if(D.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const a=H.getEngine();let R=0,L=null;this.ignoreCameraMaxZ&&H.activeCamera&&!H._isInIntermediateRendering()&&(R=H.activeCamera.maxZ,L=H.activeCamera,H.activeCamera.maxZ=0,H.updateTransformMatrix(!0)),this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);const f=q.getRenderingMesh(),k=D.hardwareInstancedRendering[q._id]||f.hasThinInstances||!!this._userInstancedBuffersStorage&&!q.getMesh()._internalAbstractMeshDataInfo._actAsRegularMesh,j=this._instanceDataStorage,I=q.Ha();if(!I)return L&&(L.maxZ=R,H.updateTransformMatrix(!0)),this;if(j.isFrozen&&this._internalMeshDataInfo._effectiveMaterial&&this._internalMeshDataInfo._effectiveMaterial===I){if(I._storeEffectOnSubMeshes&&(null===(x=q._drawWrapper)||void 0===x||!x._wasPreviouslyReady)||!I._storeEffectOnSubMeshes&&!I._getDrawWrapper()._wasPreviouslyReady)return L&&(L.maxZ=R,H.updateTransformMatrix(!0)),this}else{if(I._storeEffectOnSubMeshes){if(!I.isReadyForSubMesh(this,q,k))return L&&(L.maxZ=R,H.updateTransformMatrix(!0)),this}else if(!I.isReady(this,k))return L&&(L.maxZ=R,H.updateTransformMatrix(!0)),this;this._internalMeshDataInfo._effectiveMaterial=I}let d;X&&a.setAlphaMode(this._internalMeshDataInfo._effectiveMaterial.alphaMode),d=this._internalMeshDataInfo._effectiveMaterial._storeEffectOnSubMeshes?q._drawWrapper:this._internalMeshDataInfo._effectiveMaterial._getDrawWrapper();const i=(null===(u=d)||void 0===u?void 0:u.effect)??null;for(const e of H._beforeRenderingMeshStage)e.action(this,q,D,i);if(!d||!i)return L&&(L.maxZ=R,H.updateTransformMatrix(!0)),this;const A=Q||this;let B;if(j.isFrozen||!this._internalMeshDataInfo._effectiveMaterial.ue&&null===this._internalMeshDataInfo._effectiveMaterial.sideOrientation&&!this._internalMeshDataInfo._effectiveMaterial.twoSidedLighting)B=j.sideOrientation;else{const q=A._getWorldMatrixDeterminant();B=this._internalMeshDataInfo._effectiveMaterial._getEffectiveOrientation(this),q<0&&(B=B===e.b.ClockWiseSideOrientation?e.b.CounterClockWiseSideOrientation:e.b.ClockWiseSideOrientation),j.sideOrientation=B}const w=this._internalMeshDataInfo._effectiveMaterial._preBind(d,B);this._internalMeshDataInfo._effectiveMaterial.forceDepthWrite&&a.setDepthWrite(!0);const V=this._internalMeshDataInfo._effectiveMaterial,W=V.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),k||this._bind(q,i,W,!1);const v=A.getWorldMatrix();V._storeEffectOnSubMeshes?V.bindForSubMesh(v,this,q):V.bind(v,this),!V.ue&&V.separateCullingPass&&(a.setState(!0,V.zOffset,!1,!w,V.cullBackFaces,V.stencil,V.zOffsetUnits),this._processRendering(this,q,i,W,D,k,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),a.setState(!0,V.zOffset,!1,w,V.cullBackFaces,V.stencil,V.zOffsetUnits),this._internalMeshDataInfo._onBetweenPassObservable&&this._internalMeshDataInfo._onBetweenPassObservable.notifyObservers(q)),this._processRendering(this,q,i,W,D,k,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),this._internalMeshDataInfo._effectiveMaterial.unbind();for(const e of H._afterRenderingMeshStage)e.action(this,q,D,i);return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),L&&(L.maxZ=R,H.updateTransformMatrix(!0)),2!==H.performancePriority||j.isFrozen||this._freeze(),this}cleanMatrixWeights(){this.isVerticesDataPresent(f.c.MatricesWeightsKind)&&(this.isVerticesDataPresent(f.c.MatricesWeightsExtraKind)?this._normalizeSkinWeightsAndExtra():this._normalizeSkinFourWeights())}_normalizeSkinFourWeights(){const q=this.getVerticesData(f.c.MatricesWeightsKind),X=q.length;for(let Q=0;Q<X;Q+=4){const X=q[Q]+q[Q+1]+q[Q+2]+q[Q+3];if(0===X)q[Q]=1;else{const y=1/X;q[Q]*=y,q[Q+1]*=y,q[Q+2]*=y,q[Q+3]*=y}}this.Ga(f.c.MatricesWeightsKind,q)}_normalizeSkinWeightsAndExtra(){const q=this.getVerticesData(f.c.MatricesWeightsExtraKind),X=this.getVerticesData(f.c.MatricesWeightsKind),Q=X.length;for(let y=0;y<Q;y+=4){let Q=X[y]+X[y+1]+X[y+2]+X[y+3];if(Q+=q[y]+q[y+1]+q[y+2]+q[y+3],0===Q)X[y]=1;else{const x=1/Q;X[y]*=x,X[y+1]*=x,X[y+2]*=x,X[y+3]*=x,q[y]*=x,q[y+1]*=x,q[y+2]*=x,q[y+3]*=x}}this.Ga(f.c.MatricesWeightsKind,X),this.Ga(f.c.MatricesWeightsKind,q)}validateSkinning(){const q=this.getVerticesData(f.c.MatricesWeightsExtraKind),X=this.getVerticesData(f.c.MatricesWeightsKind);if(null===X||null==this.skeleton)return{skinned:!1,valid:!0,Ke:"not skinned"};const Q=X.length;let y=0,x=0,u=0,H=0;const b=null===q?4:8,D=[];for(let f=0;f<=b;f++)D[f]=0;for(let f=0;f<Q;f+=4){let Q=X[f],a=Q,R=0===a?0:1;for(let x=1;x<b;x++){const u=x<4?X[f+x]:q[f+x-4];u>Q&&y++,0!==u&&R++,a+=u,Q=u}if(D[R]++,R>u&&(u=R),0===a)x++;else{const Q=1/a;let y=0;for(let x=0;x<b;x++)y+=x<4?Math.abs(X[f+x]-X[f+x]*Q):Math.abs(q[f+x-4]-q[f+x-4]*Q);y>.001&&H++}}const a=this.skeleton.bones.length,R=this.getVerticesData(f.c.MatricesIndicesKind),L=this.getVerticesData(f.c.MatricesIndicesExtraKind);let k=0;for(let f=0;f<Q;f+=4)for(let q=0;q<b;q++){const X=q<4?R[f+q]:L[f+q-4];(X>=a||X<0)&&k++}return{skinned:!0,valid:0===x&&0===H&&0===k,Ke:"Number of Weights = "+Q/4+"\nMaximum influences = "+u+"\nMissing Weights = "+x+"\nNot Sorted = "+y+"\nNot Normalized = "+H+"\nWeightCounts = ["+D+"]\nNumber of bones = "+a+"\nBad Bone Indices = "+k}}_checkDelayState(){const q=this.va();return this._geometry?this._geometry.load(q):4===this.delayLoadState&&(this.delayLoadState=2,this._queueLoad(q)),this}_queueLoad(q){q.addPendingData(this);const X=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return x.f.LoadFile(this.delayLoadingFile,(X=>{X instanceof ArrayBuffer?this._delayLoadingFunction(X,this):this._delayLoadingFunction(JSON.parse(X),this),this.instances.forEach((q=>{q.refreshBoundingInfo(),q._syncSubMeshes()})),this.delayLoadState=1,q.removePendingData(this)}),(()=>{}),q.offlineProvider,X),this}isInFrustum(q){return 2!==this.delayLoadState&&(!!super.isInFrustum(q)&&(this._checkDelayState(),!0))}setMaterialById(q){const X=this.va().materials;let Q;for(Q=X.length-1;Q>-1;Q--)if(X[Q].id===q)return this.material=X[Q],this;const y=this.va().multiMaterials;for(Q=y.length-1;Q>-1;Q--)if(y[Q].id===q)return this.material=y[Q],this;return this}getAnimatables(){const q=[];return this.material&&q.push(this.material),this.skeleton&&q.push(this.skeleton),q}bakeTransformIntoVertices(q){if(!this.isVerticesDataPresent(f.c.PositionKind))return this;const X=this.be.splice(0);this._resetPointsArrayCache();let Q=this.getVerticesData(f.c.PositionKind);const y=a.n.Zero();let x;for(x=0;x<Q.length;x+=3)a.n.TransformCoordinatesFromFloatsToRef(Q[x],Q[x+1],Q[x+2],q,y).toArray(Q,x);if(this.Ga(f.c.PositionKind,Q,this.getVertexBuffer(f.c.PositionKind).isUpdatable()),this.isVerticesDataPresent(f.c.NormalKind)){for(Q=this.getVerticesData(f.c.NormalKind),x=0;x<Q.length;x+=3)a.n.TransformNormalFromFloatsToRef(Q[x],Q[x+1],Q[x+2],q,y).normalize().toArray(Q,x);this.Ga(f.c.NormalKind,Q,this.getVertexBuffer(f.c.NormalKind).isUpdatable())}if(this.isVerticesDataPresent(f.c.TangentKind)){for(Q=this.getVerticesData(f.c.TangentKind),x=0;x<Q.length;x+=4)a.n.TransformNormalFromFloatsToRef(Q[x],Q[x+1],Q[x+2],q,y).normalize().toArray(Q,x);this.Ga(f.c.TangentKind,Q,this.getVertexBuffer(f.c.TangentKind).isUpdatable())}return q.determinant()<0&&this.flipFaces(),this.releaseSubMeshes(),this.be=X,this}bakeCurrentTransformIntoVertices(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.bakeTransformIntoVertices(this.le(!0)),this.resetLocalMatrix(q),this}get _positions(){return this._internalAbstractMeshDataInfo._positions||this._geometry&&this._geometry._positions||null}_resetPointsArrayCache(){return this._geometry&&this._geometry._resetPointsArrayCache(),this}_generatePointsArray(){return!!this._geometry&&this._geometry._generatePointsArray()}clone(){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,X=arguments.length>2?arguments[2]:void 0,Q=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return new l(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",this.va(),q,this,X,Q)}dispose(q){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);const Q=this._internalMeshDataInfo;if(Q._onBeforeDrawObservable&&Q._onBeforeDrawObservable.clear(),Q._onBeforeBindObservable&&Q._onBeforeBindObservable.clear(),Q._onBeforeRenderObservable&&Q._onBeforeRenderObservable.clear(),Q._onAfterRenderObservable&&Q._onAfterRenderObservable.clear(),Q._onBetweenPassObservable&&Q._onBetweenPassObservable.clear(),this._scene.useClonedMeshMap){if(Q.meshMap)for(const q in Q.meshMap){const X=Q.meshMap[q];X&&(X._internalMeshDataInfo._source=null,Q.meshMap[q]=void 0)}Q._source&&Q._source._internalMeshDataInfo.meshMap&&(Q._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else{const q=this.va().meshes;for(const X of q){const q=X;q._internalMeshDataInfo&&q._internalMeshDataInfo._source&&q._internalMeshDataInfo._source===this&&(q._internalMeshDataInfo._source=null)}}Q._source=null,this._instanceDataStorage.visibleInstances={},this._disposeInstanceSpecificData(),this._disposeThinInstanceSpecificData(),this._internalMeshDataInfo._checkReadinessObserver&&this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),super.dispose(q,X)}_disposeInstanceSpecificData(){}_disposeThinInstanceSpecificData(){}_invalidateInstanceVertexArrayObject(){}applyDisplacementMap(q,X,Q,y,u,H){let b=arguments.length>6&&void 0!==arguments[6]&&arguments[6],D=arguments.length>7?arguments[7]:void 0;const a=this.va();return x.f.LoadImage(q,(q=>{const x=q.width,D=q.height,a=this.getEngine().createCanvas(x,D).getContext("2d");a.drawImage(q,0,0);const R=a.getImageData(0,0,x,D).data;this.applyDisplacementMapFromBuffer(R,x,D,X,Q,u,H,b),y&&y(this)}),D||(()=>{}),a.offlineProvider),this}applyDisplacementMapFromBuffer(q,X,Q,y,x,u,H){let b=arguments.length>7&&void 0!==arguments[7]&&arguments[7];if(!this.isVerticesDataPresent(f.c.PositionKind)||!this.isVerticesDataPresent(f.c.NormalKind)||!this.isVerticesDataPresent(f.c.UVKind))return w.b.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;const D=this.getVerticesData(f.c.PositionKind,!0,!0),R=this.getVerticesData(f.c.NormalKind),L=this.getVerticesData(f.c.UVKind);let j=a.n.Zero();const I=a.n.Zero(),d=a.k.Zero();u=u||a.k.Zero(),H=H||new a.k(1,1);for(let f=0;f<D.length;f+=3){a.n.FromArrayToRef(D,f,j),a.n.FromArrayToRef(R,f,I),a.k.FromArrayToRef(L,f/3*2,d);const b=4*((Math.abs(d.x*H.x+u.x%1)*(X-1)%X|0)+(Math.abs(d.y*H.y+u.y%1)*(Q-1)%Q|0)*X),k=.3*(q[b]/255)+.59*(q[b+1]/255)+.11*(q[b+2]/255);I.normalize(),I.scaleInPlace(y+(x-y)*k),j=j.add(I),j.toArray(D,f)}return k.d.ComputeNormals(D,this.Nd(),R),b?(this.Ga(f.c.PositionKind,D),this.Ga(f.c.NormalKind,R),this.Ga(f.c.UVKind,L)):(this.updateVerticesData(f.c.PositionKind,D),this.updateVerticesData(f.c.NormalKind,R)),this}_getFlattenedNormals(q,X){const Q=new Float32Array(3*q.length);let y=0;const x=this.sideOrientation===(this._scene.useRightHandedSystem?1:0);for(let u=0;u<q.length;u+=3){const H=a.n.Rd(X,3*q[u]),b=a.n.Rd(X,3*q[u+1]),D=a.n.Rd(X,3*q[u+2]),R=H.Sc(b),L=D.Sc(b),f=a.n.Normalize(a.n.Cross(R,L));x&&f.scaleInPlace(-1);for(let q=0;q<3;q++)Q[y++]=f.x,Q[y++]=f.y,Q[y++]=f.z}return Q}_convertToUnIndexedMesh(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const X=this.getVerticesDataKinds().filter((q=>{var X;return!(null!==(X=this.getVertexBuffer(q))&&void 0!==X&&X.getIsInstanced())})),Q=this.Nd(),y={},x=(q,X)=>{const y=new Float32Array(Q.length*X);let x=0;for(let u=0;u<Q.length;u++)for(let H=0;H<X;H++)y[x++]=q[Q[u]*X+H];return y},u=this.getBoundingInfo(),H=this.ze?this.be.slice(0):[];for(const b of X)y[b]=this.getVerticesData(b);for(const b of X){const X=this.getVertexBuffer(b),u=X.getSize();if(q&&b===f.c.NormalKind){const q=this._getFlattenedNormals(Q,y[f.c.PositionKind]);this.Ga(f.c.NormalKind,q,X.isUpdatable(),u)}else this.Ga(b,x(y[b],u),X.isUpdatable(),u)}if(this.morphTargetManager){for(let X=0;X<this.morphTargetManager.numTargets;X++){const y=this.morphTargetManager.getTarget(X),u=y.getPositions();y.setPositions(x(u,3));const H=y.getNormals();H&&y.setNormals(q?this._getFlattenedNormals(Q,u):x(H,3));const b=y.getTangents();b&&y.setTangents(x(b,3));const D=y.getUVs();D&&y.setUVs(x(D,2))}this.morphTargetManager.synchronize()}for(let b=0;b<Q.length;b++)Q[b]=b;this.setIndices(Q),this._unIndexed=!0,this.releaseSubMeshes();for(const b of H){const q=b.getBoundingInfo();d.e.AddToMesh(b.materialIndex,b.indexStart,b.indexCount,b.indexStart,b.indexCount,this).setBoundingInfo(q)}return this.setBoundingInfo(u),this.synchronizeInstances(),this}convertToFlatShadedMesh(){return this._convertToUnIndexedMesh(!0)}convertToUnIndexedMesh(){return this._convertToUnIndexedMesh()}flipFaces(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const X=k.d.ExtractFromMesh(this);let Q;if(q&&this.isVerticesDataPresent(f.c.NormalKind)&&X.ya){for(Q=0;Q<X.ya.length;Q++)X.ya[Q]*=-1;this.Ga(f.c.NormalKind,X.ya,this.isVertexBufferUpdatable(f.c.NormalKind))}if(X.indices){let q;for(Q=0;Q<X.indices.length;Q+=3)q=X.indices[Q+1],X.indices[Q+1]=X.indices[Q+2],X.indices[Q+2]=q;this.setIndices(X.indices,null,this.isVertexBufferUpdatable(f.c.PositionKind),!0)}return this}increaseVertices(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const X=k.d.ExtractFromMesh(this),Q=X.indices&&!Array.isArray(X.indices)&&Array.from?Array.from(X.indices):X.indices,y=X.xa&&!Array.isArray(X.xa)&&Array.from?Array.from(X.xa):X.xa,x=X.Aa&&!Array.isArray(X.Aa)&&Array.from?Array.from(X.Aa):X.Aa,u=X.ya&&!Array.isArray(X.ya)&&Array.from?Array.from(X.ya):X.ya;if(Q&&y){X.indices=Q,X.xa=y,x&&(X.Aa=x),u&&(X.ya=u);const H=q+1,b=new Array;for(let q=0;q<H+1;q++)b[q]=new Array;let D,R;const L=new a.n(0,0,0),k=new a.n(0,0,0),j=new a.k(0,0),I=new Array,d=new Array,e=new Array;let i,A,B,w=y.length;x&&(A=x.length),u&&(B=u.length);for(let q=0;q<Q.length;q+=3){d[0]=Q[q],d[1]=Q[q+1],d[2]=Q[q+2];for(let q=0;q<3;q++)if(D=d[q],R=d[(q+1)%3],void 0===e[D]&&void 0===e[R]?(e[D]=new Array,e[R]=new Array):(void 0===e[D]&&(e[D]=new Array),void 0===e[R]&&(e[R]=new Array)),void 0===e[D][R]&&void 0===e[R][D]){e[D][R]=[],L.x=(y[3*R]-y[3*D])/H,L.y=(y[3*R+1]-y[3*D+1])/H,L.z=(y[3*R+2]-y[3*D+2])/H,u&&(k.x=(u[3*R]-u[3*D])/H,k.y=(u[3*R+1]-u[3*D+1])/H,k.z=(u[3*R+2]-u[3*D+2])/H),x&&(j.x=(x[2*R]-x[2*D])/H,j.y=(x[2*R+1]-x[2*D+1])/H),e[D][R].push(D);for(let q=1;q<H;q++)e[D][R].push(y.length/3),y[w++]=y[3*D]+q*L.x,y[w++]=y[3*D+1]+q*L.y,y[w++]=y[3*D+2]+q*L.z,u&&(u[B++]=u[3*D]+q*k.x,u[B++]=u[3*D+1]+q*k.y,u[B++]=u[3*D+2]+q*k.z),x&&(x[A++]=x[2*D]+q*j.x,x[A++]=x[2*D+1]+q*j.y);e[D][R].push(R),e[R][D]=new Array,i=e[D][R].length;for(let q=0;q<i;q++)e[R][D][q]=e[D][R][i-1-q]}b[0][0]=Q[q],b[1][0]=e[Q[q]][Q[q+1]][1],b[1][1]=e[Q[q]][Q[q+2]][1];for(let X=2;X<H;X++){b[X][0]=e[Q[q]][Q[q+1]][X],b[X][X]=e[Q[q]][Q[q+2]][X],L.x=(y[3*b[X][X]]-y[3*b[X][0]])/X,L.y=(y[3*b[X][X]+1]-y[3*b[X][0]+1])/X,L.z=(y[3*b[X][X]+2]-y[3*b[X][0]+2])/X,u&&(k.x=(u[3*b[X][X]]-u[3*b[X][0]])/X,k.y=(u[3*b[X][X]+1]-u[3*b[X][0]+1])/X,k.z=(u[3*b[X][X]+2]-u[3*b[X][0]+2])/X),x&&(j.x=(x[2*b[X][X]]-x[2*b[X][0]])/X,j.y=(x[2*b[X][X]+1]-x[2*b[X][0]+1])/X);for(let q=1;q<X;q++)b[X][q]=y.length/3,y[w++]=y[3*b[X][0]]+q*L.x,y[w++]=y[3*b[X][0]+1]+q*L.y,y[w++]=y[3*b[X][0]+2]+q*L.z,u&&(u[B++]=u[3*b[X][0]]+q*k.x,u[B++]=u[3*b[X][0]+1]+q*k.y,u[B++]=u[3*b[X][0]+2]+q*k.z),x&&(x[A++]=x[2*b[X][0]]+q*j.x,x[A++]=x[2*b[X][0]+1]+q*j.y)}b[H]=e[Q[q+1]][Q[q+2]],I.push(b[0][0],b[1][0],b[1][1]);for(let q=1;q<H;q++){let X;for(X=0;X<q;X++)I.push(b[q][X],b[q+1][X],b[q+1][X+1]),I.push(b[q][X],b[q+1][X+1],b[q][X+1]);I.push(b[q][X],b[q+1][X],b[q+1][X+1])}}X.indices=I,X.Ca(this,this.isVertexBufferUpdatable(f.c.PositionKind))}else w.b.Warn("Couldn't increase number of vertices : VertexData must contain at least indices and positions")}forceSharedVertices(){const q=k.d.ExtractFromMesh(this),X=q.Aa,Q=q.indices,y=q.xa,x=q.za,u=q.matricesIndices,H=q.matricesWeights,b=q.matricesIndicesExtra,D=q.matricesWeightsExtra;if(void 0===Q||void 0===y||null===Q||null===y)w.b.Warn("VertexData contains empty entries");else{const a=new Array,R=new Array,L=new Array,j=new Array,I=new Array,d=new Array,e=new Array,i=new Array;let A=new Array,B=0;const w={};let V,W;for(let q=0;q<Q.length;q+=3){W=[Q[q],Q[q+1],Q[q+2]],A=[];for(let q=0;q<3;q++){A[q]="";for(let X=0;X<3;X++)Math.abs(y[3*W[q]+X])<1e-8&&(y[3*W[q]+X]=0),A[q]+=y[3*W[q]+X]+"|"}if(A[0]!=A[1]&&A[0]!=A[2]&&A[1]!=A[2])for(let q=0;q<3;q++){if(V=w[A[q]],void 0===V){w[A[q]]=B,V=B++;for(let X=0;X<3;X++)a.push(y[3*W[q]+X]);if(null!==x&&void 0!==x)for(let X=0;X<4;X++)j.push(x[4*W[q]+X]);if(null!==X&&void 0!==X)for(let Q=0;Q<2;Q++)L.push(X[2*W[q]+Q]);if(null!==u&&void 0!==u)for(let X=0;X<4;X++)I.push(u[4*W[q]+X]);if(null!==H&&void 0!==H)for(let X=0;X<4;X++)d.push(H[4*W[q]+X]);if(null!==b&&void 0!==b)for(let X=0;X<4;X++)e.push(b[4*W[q]+X]);if(null!==D&&void 0!==D)for(let X=0;X<4;X++)i.push(D[4*W[q]+X])}R.push(V)}}const v=new Array;k.d.ComputeNormals(a,R,v),q.xa=a,q.indices=R,q.ya=v,null!==X&&void 0!==X&&(q.Aa=L),null!==x&&void 0!==x&&(q.za=j),null!==u&&void 0!==u&&(q.matricesIndices=I),null!==H&&void 0!==H&&(q.matricesWeights=d),null!==b&&void 0!==b&&(q.matricesIndicesExtra=e),null!==H&&void 0!==H&&(q.matricesWeightsExtra=i),q.Ca(this,this.isVertexBufferUpdatable(f.c.PositionKind))}}static _instancedMeshFactory(q,X){throw(0,W.c)("InstancedMesh")}static _PhysicsImpostorParser(q,X,Q){throw(0,W.c)("PhysicsImpostor")}kd(q){const X=l._instancedMeshFactory(q,this);return X.parent=this.parent,X}synchronizeInstances(){for(let q=0;q<this.instances.length;q++){this.instances[q]._syncSubMeshes()}return this}optimizeIndices(q){const X=this.Nd(),Q=this.getVerticesData(f.c.PositionKind);if(!Q||!X)return this;const y=[];for(let x=0;x<Q.length;x+=3)y.push(a.n.Rd(Q,x));const u=[];return x.e.SyncAsyncForLoop(y.length,40,(q=>{const X=y.length-1-q,Q=y[X];for(let x=0;x<X;++x){const q=y[x];if(Q.equals(q)){u[X]=x;break}}}),(()=>{for(let q=0;q<X.length;++q)X[q]=u[X[q]]||X[q];const Q=this.be.slice(0);this.setIndices(X),this.be=Q,q&&q(this)})),this}serialize(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};q.name=this.name,q.id=this.id,q.uniqueId=this.uniqueId,q.type=this.getClassName(),H.d&&H.d.HasTags(this)&&(q.tags=H.d.GetTags(this)),q.position=this.position.ee(),this.rotationQuaternion?q.rotationQuaternion=this.rotationQuaternion.ee():this.rotation&&(q.rotation=this.rotation.ee()),q.He=this.He.ee(),this._postMultiplyPivotMatrix?q.pivotMatrix=this.getPivotMatrix().ee():q.localMatrix=this.getPivotMatrix().ee(),q.isEnabled=this.isEnabled(!1),q.isVisible=this.isVisible,q.infiniteDistance=this.infiniteDistance,q.pickable=this.Ne,q.receiveShadows=this.receiveShadows,q.billboardMode=this.billboardMode,q.visibility=this.visibility,q.Ze=this.Ze,q.checkCollisions=this.checkCollisions,q.ellipsoid=this.ellipsoid.ee(),q.ellipsoidOffset=this.ellipsoidOffset.ee(),q.Da=this.Da,q.isBlocker=this.isBlocker,q.sideOrientation=this.sideOrientation,this.parent&&this.parent._serializeAsParent(q),q.isUnIndexed=this.isUnIndexed;const X=this._geometry;if(X&&this.be){q.geometryUniqueId=X.uniqueId,q.geometryId=X.id,q.be=[];for(let X=0;X<this.be.length;X++){const Q=this.be[X];q.be.push({materialIndex:Q.materialIndex,verticesStart:Q.verticesStart,verticesCount:Q.verticesCount,indexStart:Q.indexStart,indexCount:Q.indexCount})}}if(this.material?this.material.doNotSerialize||(q.materialUniqueId=this.material.uniqueId,q.materialId=this.material.id):(this.material=null,q.materialUniqueId=this._scene.defaultMaterial.uniqueId,q.materialId=this._scene.defaultMaterial.id),this.morphTargetManager&&(q.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(q.skeletonId=this.skeleton.id,q.numBoneInfluencers=this.numBoneInfluencers),this.va()._getComponent(v.c.NAME_PHYSICSENGINE)){const X=this.getPhysicsImpostor();X&&(q.physicsMass=X.getParam("mass"),q.physicsFriction=X.getParam("friction"),q.physicsRestitution=X.getParam("mass"),q.physicsImpostor=X.type)}this.metadata&&(q.metadata=this.metadata),q.instances=[];for(let Q=0;Q<this.instances.length;Q++){const X=this.instances[Q];if(X.doNotSerialize)continue;const y={name:X.name,id:X.id,isEnabled:X.isEnabled(!1),isVisible:X.isVisible,Ne:X.Ne,checkCollisions:X.checkCollisions,position:X.position.ee(),He:X.He.ee()};if(X.parent&&X.parent._serializeAsParent(y),X.rotationQuaternion?y.rotationQuaternion=X.rotationQuaternion.ee():X.rotation&&(y.rotation=X.rotation.ee()),this.va()._getComponent(v.c.NAME_PHYSICSENGINE)){const q=X.getPhysicsImpostor();q&&(y.physicsMass=q.getParam("mass"),y.physicsFriction=q.getParam("friction"),y.physicsRestitution=q.getParam("mass"),y.physicsImpostor=q.type)}X.metadata&&(y.metadata=X.metadata),X.actionManager&&(y.actions=X.actionManager.serialize(X.name)),q.instances.push(y),B.c.AppendSerializedAnimations(X,y),y.ranges=X.serializeAnimationRanges()}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData&&(q.thinInstances={instancesCount:this._thinInstanceDataStorage.instancesCount,matrixData:Array.from(this._thinInstanceDataStorage.matrixData),matrixBufferSize:this._thinInstanceDataStorage.matrixBufferSize,enablePicking:this.thinInstanceEnablePicking},this._userThinInstanceBuffersStorage)){const X={data:{},sizes:{},strides:{}};for(const q in this._userThinInstanceBuffersStorage.data)X.data[q]=Array.from(this._userThinInstanceBuffersStorage.data[q]),X.sizes[q]=this._userThinInstanceBuffersStorage.sizes[q],X.strides[q]=this._userThinInstanceBuffersStorage.strides[q];q.thinInstances.userThinInstance=X}return B.c.AppendSerializedAnimations(this,q),q.ranges=this.serializeAnimationRanges(),q.layerMask=this.layerMask,q.alphaIndex=this.alphaIndex,q.hasVertexAlpha=this.hasVertexAlpha,q.overlayAlpha=this.overlayAlpha,q.overlayColor=this.overlayColor.ee(),q.renderOverlay=this.renderOverlay,q.applyFog=this.applyFog,this.actionManager&&(q.actions=this.actionManager.serialize(this.name)),q}_syncGeometryWithMorphTargetManager(){if(!this.ze)return;this._markSubMeshesAsAttributesDirty();const q=this._internalAbstractMeshDataInfo._morphTargetManager;if(q&&q.vertexCount){if(q.vertexCount!==this.getTotalVertices())return w.b.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);if(q.isUsingTextureForTargets)return;for(let X=0;X<q.numInfluencers;X++){const Q=q.getActiveTarget(X),y=Q.getPositions();if(!y)return void w.b.Error("Invalid morph target. Target must have positions.");this.ze.Ga(f.c.PositionKind+X,y,!1,3);const x=Q.getNormals();x&&this.ze.Ga(f.c.NormalKind+X,x,!1,3);const u=Q.getTangents();u&&this.ze.Ga(f.c.TangentKind+X,u,!1,3);const H=Q.getUVs();H&&this.ze.Ga(f.c.UVKind+"_"+X,H,!1,2)}}else{let q=0;for(;this.ze.isVerticesDataPresent(f.c.PositionKind+q);)this.ze.removeVerticesData(f.c.PositionKind+q),this.ze.isVerticesDataPresent(f.c.NormalKind+q)&&this.ze.removeVerticesData(f.c.NormalKind+q),this.ze.isVerticesDataPresent(f.c.TangentKind+q)&&this.ze.removeVerticesData(f.c.TangentKind+q),this.ze.isVerticesDataPresent(f.c.UVKind+q)&&this.ze.removeVerticesData(f.c.UVKind+"_"+q),q++}}static Parse(q,X,Q){let y;if(y=q.type&&"LinesMesh"===q.type?l._LinesMeshParser(q,X):q.type&&"GroundMesh"===q.type?l._GroundMeshParser(q,X):q.type&&"GoldbergMesh"===q.type?l._GoldbergMeshParser(q,X):q.type&&"GreasedLineMesh"===q.type?l._GreasedLineMeshParser(q,X):q.type&&"TrailMesh"===q.type?l._TrailMeshParser(q,X):new l(q.name,X),y.id=q.id,y._waitingParsedUniqueId=q.uniqueId,H.d&&H.d.AddTagsTo(y,q.tags),y.position=a.n.Rd(q.position),void 0!==q.metadata&&(y.metadata=q.metadata),q.rotationQuaternion?y.rotationQuaternion=a.d.Rd(q.rotationQuaternion):q.rotation&&(y.rotation=a.n.Rd(q.rotation)),y.He=a.n.Rd(q.He),q.localMatrix?y.setPreTransformMatrix(a.b.Rd(q.localMatrix)):q.pivotMatrix&&y.setPivotMatrix(a.b.Rd(q.pivotMatrix)),y.tg(q.isEnabled),y.isVisible=q.isVisible,y.infiniteDistance=q.infiniteDistance,y.Ze=!!q.Ze,y.showBoundingBox=q.showBoundingBox,y.showSubMeshesBoundingBox=q.showSubMeshesBoundingBox,void 0!==q.applyFog&&(y.applyFog=q.applyFog),void 0!==q.pickable&&(y.Ne=q.pickable),void 0!==q.alphaIndex&&(y.alphaIndex=q.alphaIndex),y.receiveShadows=q.receiveShadows,void 0!==q.billboardMode&&(y.billboardMode=q.billboardMode),void 0!==q.visibility&&(y.visibility=q.visibility),y.checkCollisions=q.checkCollisions,y.Da=!!q.Da,q.ellipsoid&&(y.ellipsoid=a.n.Rd(q.ellipsoid)),q.ellipsoidOffset&&(y.ellipsoidOffset=a.n.Rd(q.ellipsoidOffset)),null!=q.overrideMaterialSideOrientation&&(y.sideOrientation=q.overrideMaterialSideOrientation),void 0!==q.sideOrientation&&(y.sideOrientation=q.sideOrientation),void 0!==q.isBlocker&&(y.isBlocker=q.isBlocker),y._shouldGenerateFlatShading=q.useFlatShading,q.$h&&(y._waitingData.$h=q.$h),void 0!==q.parentId&&(y._waitingParentId=q.parentId),void 0!==q.parentInstanceIndex&&(y._waitingParentInstanceIndex=q.parentInstanceIndex),void 0!==q.actions&&(y._waitingData.actions=q.actions),void 0!==q.overlayAlpha&&(y.overlayAlpha=q.overlayAlpha),void 0!==q.overlayColor&&(y.overlayColor=R.b.Rd(q.overlayColor)),void 0!==q.renderOverlay&&(y.renderOverlay=q.renderOverlay),y.isUnIndexed=!!q.isUnIndexed,y.hasVertexAlpha=q.hasVertexAlpha,q.delayLoadingFile?(y.delayLoadState=4,y.delayLoadingFile=Q+q.delayLoadingFile,y.buildBoundingInfo(a.n.Rd(q.boundingBoxMinimum),a.n.Rd(q.boundingBoxMaximum)),q._binaryInfo&&(y._binaryInfo=q._binaryInfo),y._delayInfo=[],q.hasUVs&&y._delayInfo.push(f.c.UVKind),q.hasUVs2&&y._delayInfo.push(f.c.UV2Kind),q.hasUVs3&&y._delayInfo.push(f.c.UV3Kind),q.hasUVs4&&y._delayInfo.push(f.c.UV4Kind),q.hasUVs5&&y._delayInfo.push(f.c.UV5Kind),q.hasUVs6&&y._delayInfo.push(f.c.UV6Kind),q.hasColors&&y._delayInfo.push(f.c.ColorKind),q.hasMatricesIndices&&y._delayInfo.push(f.c.MatricesIndicesKind),q.hasMatricesWeights&&y._delayInfo.push(f.c.MatricesWeightsKind),y._delayLoadingFunction=j.d._ImportGeometry,A.c.ForceFullSceneLoadingForIncremental&&y._checkDelayState()):j.d._ImportGeometry(q,y),q.materialUniqueId?y._waitingMaterialId=q.materialUniqueId:q.materialId&&(y._waitingMaterialId=q.materialId),q.morphTargetManagerId>-1&&(y._waitingMorphTargetManagerId=q.morphTargetManagerId),void 0!==q.skeletonId&&null!==q.skeletonId&&(y.skeleton=X.getLastSkeletonById(q.skeletonId),q.numBoneInfluencers&&(y.numBoneInfluencers=q.numBoneInfluencers)),q.animations){for(let X=0;X<q.animations.length;X++){const Q=q.animations[X],x=(0,V.d)("BABYLON.Animation");x&&y.animations.push(x.Parse(Q))}L.d.ParseAnimationRanges(y,q,X)}if(q.autoAnimate&&X.beginAnimation(y,q.autoAnimateFrom,q.autoAnimateTo,q.autoAnimateLoop,q.autoAnimateSpeed||1),q.layerMask&&!isNaN(q.layerMask)?y.layerMask=Math.abs(parseInt(q.layerMask)):y.layerMask=268435455,q.physicsImpostor&&(y.physicsImpostor=l._PhysicsImpostorParser(X,y,q)),q.lodMeshIds&&(y._waitingData.lods={ids:q.lodMeshIds,distances:q.lodDistances?q.lodDistances:null,coverages:q.lodCoverages?q.lodCoverages:null}),q.instances)for(let x=0;x<q.instances.length;x++){const Q=q.instances[x],u=y.kd(Q.name);if(Q.id&&(u.id=Q.id),H.d&&(Q.tags?H.d.AddTagsTo(u,Q.tags):H.d.AddTagsTo(u,q.tags)),u.position=a.n.Rd(Q.position),void 0!==Q.metadata&&(u.metadata=Q.metadata),void 0!==Q.parentId&&(u._waitingParentId=Q.parentId),void 0!==Q.parentInstanceIndex&&(u._waitingParentInstanceIndex=Q.parentInstanceIndex),void 0!==Q.isEnabled&&null!==Q.isEnabled&&u.tg(Q.isEnabled),void 0!==Q.isVisible&&null!==Q.isVisible&&(u.isVisible=Q.isVisible),void 0!==Q.Ne&&null!==Q.Ne&&(u.Ne=Q.Ne),Q.rotationQuaternion?u.rotationQuaternion=a.d.Rd(Q.rotationQuaternion):Q.rotation&&(u.rotation=a.n.Rd(Q.rotation)),u.He=a.n.Rd(Q.He),void 0!=Q.checkCollisions&&null!=Q.checkCollisions&&(u.checkCollisions=Q.checkCollisions),void 0!=Q.pickable&&null!=Q.pickable&&(u.Ne=Q.pickable),void 0!=Q.showBoundingBox&&null!=Q.showBoundingBox&&(u.showBoundingBox=Q.showBoundingBox),void 0!=Q.showSubMeshesBoundingBox&&null!=Q.showSubMeshesBoundingBox&&(u.showSubMeshesBoundingBox=Q.showSubMeshesBoundingBox),void 0!=Q.alphaIndex&&null!=Q.showSubMeshesBoundingBox&&(u.alphaIndex=Q.alphaIndex),Q.physicsImpostor&&(u.physicsImpostor=l._PhysicsImpostorParser(X,u,Q)),void 0!==Q.actions&&(u._waitingData.actions=Q.actions),Q.animations){for(let q=0;q<Q.animations.length;q++){const X=Q.animations[q],y=(0,V.d)("BABYLON.Animation");y&&u.animations.push(y.Parse(X))}L.d.ParseAnimationRanges(u,Q,X),Q.autoAnimate&&X.beginAnimation(u,Q.autoAnimateFrom,Q.autoAnimateTo,Q.autoAnimateLoop,Q.autoAnimateSpeed||1)}}if(q.thinInstances){const X=q.thinInstances;if(y.thinInstanceEnablePicking=!!X.enablePicking,X.matrixData?(y.Mj("matrix",new Float32Array(X.matrixData),16,!1),y._thinInstanceDataStorage.matrixBufferSize=X.matrixBufferSize,y._thinInstanceDataStorage.instancesCount=X.instancesCount):y._thinInstanceDataStorage.matrixBufferSize=X.matrixBufferSize,q.thinInstances.userThinInstance){const X=q.thinInstances.userThinInstance;for(const q in X.data)y.Mj(q,new Float32Array(X.data[q]),X.strides[q],!1),y._userThinInstanceBuffersStorage.sizes[q]=X.sizes[q]}}return y}setPositionsForCPUSkinning(){const q=this._internalMeshDataInfo;if(!q._sourcePositions){const X=this.getVerticesData(f.c.PositionKind);if(!X)return q._sourcePositions;q._sourcePositions=new Float32Array(X),this.isVertexBufferUpdatable(f.c.PositionKind)||this.Ga(f.c.PositionKind,X,!0)}return q._sourcePositions}setNormalsForCPUSkinning(){const q=this._internalMeshDataInfo;if(!q._sourceNormals){const X=this.getVerticesData(f.c.NormalKind);if(!X)return q._sourceNormals;q._sourceNormals=new Float32Array(X),this.isVertexBufferUpdatable(f.c.NormalKind)||this.Ga(f.c.NormalKind,X,!0)}return q._sourceNormals}applySkeleton(q){if(!this.ze)return this;if(this.ze._softwareSkinningFrameId==this.va().getFrameId())return this;if(this.ze._softwareSkinningFrameId=this.va().getFrameId(),!this.isVerticesDataPresent(f.c.PositionKind))return this;if(!this.isVerticesDataPresent(f.c.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(f.c.MatricesWeightsKind))return this;const X=this.isVerticesDataPresent(f.c.NormalKind),Q=this._internalMeshDataInfo;if(!Q._sourcePositions){const q=this.be.slice();this.setPositionsForCPUSkinning(),this.be=q}X&&!Q._sourceNormals&&this.setNormalsForCPUSkinning();let y=this.getVerticesData(f.c.PositionKind);if(!y)return this;y instanceof Float32Array||(y=new Float32Array(y));let x=this.getVerticesData(f.c.NormalKind);if(X){if(!x)return this;x instanceof Float32Array||(x=new Float32Array(x))}const u=this.getVerticesData(f.c.MatricesIndicesKind),H=this.getVerticesData(f.c.MatricesWeightsKind);if(!H||!u)return this;const b=this.numBoneInfluencers>4,D=b?this.getVerticesData(f.c.MatricesIndicesExtraKind):null,R=b?this.getVerticesData(f.c.MatricesWeightsExtraKind):null,L=q.getTransformMatrices(this),k=a.n.Zero(),j=new a.b,I=new a.b;let d,e=0;for(let f=0;f<y.length;f+=3,e+=4){let q;for(d=0;d<4;d++)q=H[e+d],q>0&&(a.b.FromFloat32ArrayToRefScaled(L,Math.floor(16*u[e+d]),q,I),j.addToSelf(I));if(b)for(d=0;d<4;d++)q=R[e+d],q>0&&(a.b.FromFloat32ArrayToRefScaled(L,Math.floor(16*D[e+d]),q,I),j.addToSelf(I));a.n.TransformCoordinatesFromFloatsToRef(Q._sourcePositions[f],Q._sourcePositions[f+1],Q._sourcePositions[f+2],j,k),k.toArray(y,f),X&&(a.n.TransformNormalFromFloatsToRef(Q._sourceNormals[f],Q._sourceNormals[f+1],Q._sourceNormals[f+2],j,k),k.toArray(x,f)),j.reset()}return this.updateVerticesData(f.c.PositionKind,y),X&&this.updateVerticesData(f.c.NormalKind,x),this}static MinMax(q){let X=null,Q=null;return q.forEach((function(q){const y=q.getBoundingInfo().boundingBox;X&&Q?(X.minimizeInPlace(y.minimumWorld),Q.maximizeInPlace(y.maximumWorld)):(X=y.minimumWorld,Q=y.maximumWorld)})),X&&Q?{min:X,max:Q}:{min:a.n.Zero(),max:a.n.Zero()}}static Center(q){const X=q instanceof Array?l.MinMax(q):q;return a.n.Center(X.min,X.max)}static MergeMeshes(q){let X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],Q=arguments.length>2?arguments[2]:void 0,y=arguments.length>3?arguments[3]:void 0,x=arguments.length>4?arguments[4]:void 0,u=arguments.length>5?arguments[5]:void 0;return(0,b.i)(l._MergeMeshesCoroutine(q,X,Q,y,x,u,!1))}static MergeMeshesAsync(q){let X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],Q=arguments.length>2?arguments[2]:void 0,y=arguments.length>3?arguments[3]:void 0,x=arguments.length>4?arguments[4]:void 0,u=arguments.length>5?arguments[5]:void 0;return(0,b.h)(l._MergeMeshesCoroutine(q,X,Q,y,x,u,!0),(0,b.c)())}static*_MergeMeshesCoroutine(q){let X,Q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],y=arguments.length>2?arguments[2]:void 0,x=arguments.length>3?arguments[3]:void 0,u=arguments.length>4?arguments[4]:void 0,H=arguments.length>5?arguments[5]:void 0,b=arguments.length>6?arguments[6]:void 0;if(0===(q=q.filter(Boolean)).length)return null;if(!y){let Q=0;for(X=0;X<q.length;X++)if(Q+=q[X].getTotalVertices(),Q>=65536)return w.b.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}H&&(u=!1);const D=new Array,a=new Array,R=new Array,L=q[0].sideOrientation;for(X=0;X<q.length;X++){const Q=q[X];if(Q.isAnInstance)return w.b.Warn("Cannot merge instance meshes."),null;if(L!==Q.sideOrientation)return w.b.Warn("Cannot merge meshes with different sideOrientation values."),null;if(u&&R.push(Q.getTotalIndices()),H)if(Q.material){const q=Q.material;if(q instanceof i.b){for(let X=0;X<q.sg.length;X++)D.indexOf(q.sg[X])<0&&D.push(q.sg[X]);for(let X=0;X<Q.be.length;X++)a.push(D.indexOf(q.sg[Q.be[X].materialIndex])),R.push(Q.be[X].indexCount)}else{D.indexOf(q)<0&&D.push(q);for(let X=0;X<Q.be.length;X++)a.push(D.indexOf(q)),R.push(Q.be[X].indexCount)}}else for(let q=0;q<Q.be.length;q++)a.push(0),R.push(Q.be[q].indexCount)}const f=q[0],j=q=>{const X=q.le(!0);return{vertexData:k.d.ExtractFromMesh(q,!1,!1),transform:X}},{vertexData:I,transform:e}=j(f);b&&(yield);const A=new Array(q.length-1);for(let k=1;k<q.length;k++)A[k-1]=j(q[k]),b&&(yield);const B=I._mergeCoroutine(e,A,y,b,!Q);let V=B.next();for(;!V.done;)b&&(yield),V=B.next();const W=V.value;x||(x=new l(f.name+"_merged",f.va()));const v=W._applyToCoroutine(x,void 0,b);let Z=v.next();for(;!Z.done;)b&&(yield),Z=v.next();if(x.checkCollisions=f.checkCollisions,x.sideOrientation=f.sideOrientation,Q)for(X=0;X<q.length;X++)q[X].dispose();if(u||H){x.releaseSubMeshes(),X=0;let q=0;for(;X<R.length;)d.e.CreateFromIndices(0,q,R[X],x,void 0,!1),q+=R[X],X++;for(const X of x.be)X.refreshBoundingInfo();x.le(!0)}if(H){const q=new i.b(f.name+"_merged",f.va());q.sg=D;for(let X=0;X<x.be.length;X++)x.be[X].materialIndex=a[X];x.material=q}else x.material=f.material;return x}Cj(q){q._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(q)}Bj(q){const X=q._indexInSourceMeshInstanceArray;if(-1!=X){if(X!==this.instances.length-1){const q=this.instances[this.instances.length-1];this.instances[X]=q,q._indexInSourceMeshInstanceArray=X}q._indexInSourceMeshInstanceArray=-1,this.instances.pop()}}_shouldConvertRHS(){return this._scene.useRightHandedSystem&&this.sideOrientation===e.b.CounterClockWiseSideOrientation}_getRenderingFillMode(q){const X=this.va();return X.forcePointsCloud?e.b.PointFillMode:X.forceWireframe?e.b.WireFrameFillMode:this.overrideRenderingFillMode??q}setMaterialByID(q){return this.setMaterialById(q)}static CreateRibbon(q,X,Q,y,x,u,H,b,D){throw new Error("Import MeshBuilder to populate this function")}static nb(q,X,Q,y,x,u){throw new Error("Import MeshBuilder to populate this function")}static CreateBox(q,X,Q,y,x){throw new Error("Import MeshBuilder to populate this function")}static CreateSphere(q,X,Q,y,x,u){throw new Error("Import MeshBuilder to populate this function")}static CreateHemisphere(q,X,Q,y){throw new Error("Import MeshBuilder to populate this function")}static CreateCylinder(q,X,Q,y,x,u,H,b,D){throw new Error("Import MeshBuilder to populate this function")}static CreateTorus(q,X,Q,y,x,u,H){throw new Error("Import MeshBuilder to populate this function")}static CreateTorusKnot(q,X,Q,y,x,u,H,b,D,a){throw new Error("Import MeshBuilder to populate this function")}static pb(q,X,Q,y,x){throw new Error("Import MeshBuilder to populate this function")}static CreateDashedLines(q,X,Q,y,x,u,H,b){throw new Error("Import MeshBuilder to populate this function")}static CreatePolygon(q,X,Q,y,x,u,H){throw new Error("Import MeshBuilder to populate this function")}static ExtrudePolygon(q,X,Q,y,x,u,H,b){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShape(q,X,Q,y,x,u,H,b,D,a){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShapeCustom(q,X,Q,y,x,u,H,b,D,a,R,L){throw new Error("Import MeshBuilder to populate this function")}static CreateLathe(q,X,Q,y,x,u,H){throw new Error("Import MeshBuilder to populate this function")}static ug(q,X,Q,y,x){throw new Error("Import MeshBuilder to populate this function")}static CreateGround(q,X,Q,y,x,u){throw new Error("Import MeshBuilder to populate this function")}static CreateTiledGround(q,X,Q,y,x,u,H,b,D){throw new Error("Import MeshBuilder to populate this function")}static CreateGroundFromHeightMap(q,X,Q,y,x,u,H,b,D,a,R){throw new Error("Import MeshBuilder to populate this function")}static CreateTube(q,X,Q,y,x,u,H,b,D,a){throw new Error("Import MeshBuilder to populate this function")}static CreatePolyhedron(q,X,Q){throw new Error("Import MeshBuilder to populate this function")}static CreateIcoSphere(q,X,Q){throw new Error("Import MeshBuilder to populate this function")}static CreateDecal(q,X,Q,y,x,u){throw new Error("Import MeshBuilder to populate this function")}static CreateCapsule(q,X,Q){throw new Error("Import MeshBuilder to populate this function")}static ExtendToGoldberg(q){throw new Error("Import MeshBuilder to populate this function")}}l.FRONTSIDE=k.d.FRONTSIDE,l.BACKSIDE=k.d.BACKSIDE,l.DOUBLESIDE=k.d.DOUBLESIDE,l.DEFAULTSIDE=k.d.DEFAULTSIDE,l.NO_CAP=0,l.CAP_START=1,l.CAP_END=2,l.CAP_ALL=3,l.NO_FLIP=0,l.FLIP_TILE=1,l.ROTATE_TILE=2,l.FLIP_ROW=3,l.ROTATE_ROW=4,l.FLIP_N_ROTATE_TILE=5,l.FLIP_N_ROTATE_ROW=6,l.CENTER=0,l.LEFT=1,l.RIGHT=2,l.TOP=3,l.BOTTOM=4,l.INSTANCEDMESH_SORT_TRANSPARENT=!1,l._GroundMeshParser=(q,X)=>{throw(0,W.c)("GroundMesh")},l._GoldbergMeshParser=(q,X)=>{throw(0,W.c)("GoldbergMesh")},l._LinesMeshParser=(q,X)=>{throw(0,W.c)("LinesMesh")},l._GreasedLineMeshParser=(q,X)=>{throw(0,W.c)("GreasedLineMesh")},l._GreasedLineRibbonMeshParser=(q,X)=>{throw(0,W.c)("GreasedLineRibbonMesh")},l._TrailMeshParser=(q,X)=>{throw(0,W.c)("TrailMesh")},(0,V.h)("BABYLON.Mesh",l)},11276:(q,X,Q)=>{"use strict";Q.d(X,{d:()=>j});var y=Q(975),x=Q(1002),u=Q(1261),H=Q(1081),b=Q(1182),D=Q(1099),a=Q(984),R=Q(11259),L=Q(1065),f=Q(1337);class k{}class j{constructor(){this.uniqueId=0,this.metadata={},this._applyTo=(0,R.g)(this._applyToCoroutine.bind(this)),this.uniqueId=j._UniqueIDGenerator,j._UniqueIDGenerator++}set(q,X){switch(q.length||D.b.Warn(`Setting vertex data kind '${X}' with an empty array`),X){case u.c.PositionKind:this.xa=q;break;case u.c.NormalKind:this.ya=q;break;case u.c.TangentKind:this.tangents=q;break;case u.c.UVKind:this.Aa=q;break;case u.c.UV2Kind:this.uvs2=q;break;case u.c.UV3Kind:this.uvs3=q;break;case u.c.UV4Kind:this.uvs4=q;break;case u.c.UV5Kind:this.uvs5=q;break;case u.c.UV6Kind:this.uvs6=q;break;case u.c.ColorKind:this.za=q;break;case u.c.MatricesIndicesKind:this.matricesIndices=q;break;case u.c.MatricesWeightsKind:this.matricesWeights=q;break;case u.c.MatricesIndicesExtraKind:this.matricesIndicesExtra=q;break;case u.c.MatricesWeightsExtraKind:this.matricesWeightsExtra=q}}Ca(q,X){return this._applyTo(q,X,!1),this}applyToGeometry(q,X){return this._applyTo(q,X,!1),this}updateMesh(q){return this._update(q),this}updateGeometry(q){return this._update(q),this}*_applyToCoroutine(q){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Q=arguments.length>2?arguments[2]:void 0;if(this.xa&&(q.Ga(u.c.PositionKind,this.xa,X),Q&&(yield)),this.ya&&(q.Ga(u.c.NormalKind,this.ya,X),Q&&(yield)),this.tangents&&(q.Ga(u.c.TangentKind,this.tangents,X),Q&&(yield)),this.Aa&&(q.Ga(u.c.UVKind,this.Aa,X),Q&&(yield)),this.uvs2&&(q.Ga(u.c.UV2Kind,this.uvs2,X),Q&&(yield)),this.uvs3&&(q.Ga(u.c.UV3Kind,this.uvs3,X),Q&&(yield)),this.uvs4&&(q.Ga(u.c.UV4Kind,this.uvs4,X),Q&&(yield)),this.uvs5&&(q.Ga(u.c.UV5Kind,this.uvs5,X),Q&&(yield)),this.uvs6&&(q.Ga(u.c.UV6Kind,this.uvs6,X),Q&&(yield)),this.za&&(q.Ga(u.c.ColorKind,this.za,X),this.hasVertexAlpha&&void 0!==q.hasVertexAlpha&&(q.hasVertexAlpha=!0),Q&&(yield)),this.matricesIndices&&(q.Ga(u.c.MatricesIndicesKind,this.matricesIndices,X),Q&&(yield)),this.matricesWeights&&(q.Ga(u.c.MatricesWeightsKind,this.matricesWeights,X),Q&&(yield)),this.matricesIndicesExtra&&(q.Ga(u.c.MatricesIndicesExtraKind,this.matricesIndicesExtra,X),Q&&(yield)),this.matricesWeightsExtra&&(q.Ga(u.c.MatricesWeightsExtraKind,this.matricesWeightsExtra,X),Q&&(yield)),this.indices?(q.setIndices(this.indices,null,X),Q&&(yield)):q.setIndices([],null),q.be&&this.materialInfos&&this.materialInfos.length>1){const X=q;X.be=[];for(const q of this.materialInfos)new f.e(q.materialIndex,q.verticesStart,q.verticesCount,q.indexStart,q.indexCount,X)}return this}_update(q,X,Q){return this.xa&&q.updateVerticesData(u.c.PositionKind,this.xa,X,Q),this.ya&&q.updateVerticesData(u.c.NormalKind,this.ya,X,Q),this.tangents&&q.updateVerticesData(u.c.TangentKind,this.tangents,X,Q),this.Aa&&q.updateVerticesData(u.c.UVKind,this.Aa,X,Q),this.uvs2&&q.updateVerticesData(u.c.UV2Kind,this.uvs2,X,Q),this.uvs3&&q.updateVerticesData(u.c.UV3Kind,this.uvs3,X,Q),this.uvs4&&q.updateVerticesData(u.c.UV4Kind,this.uvs4,X,Q),this.uvs5&&q.updateVerticesData(u.c.UV5Kind,this.uvs5,X,Q),this.uvs6&&q.updateVerticesData(u.c.UV6Kind,this.uvs6,X,Q),this.za&&q.updateVerticesData(u.c.ColorKind,this.za,X,Q),this.matricesIndices&&q.updateVerticesData(u.c.MatricesIndicesKind,this.matricesIndices,X,Q),this.matricesWeights&&q.updateVerticesData(u.c.MatricesWeightsKind,this.matricesWeights,X,Q),this.matricesIndicesExtra&&q.updateVerticesData(u.c.MatricesIndicesExtraKind,this.matricesIndicesExtra,X,Q),this.matricesWeightsExtra&&q.updateVerticesData(u.c.MatricesWeightsExtraKind,this.matricesWeightsExtra,X,Q),this.indices&&q.setIndices(this.indices,null),this}static _TransformVector3Coordinates(q,X){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:q.length;const u=x.h.Od[0],H=x.h.Od[1];for(let b=Q;b<Q+y;b+=3)x.n.FromArrayToRef(q,b,u),x.n.TransformCoordinatesToRef(u,X,H),q[b]=H.x,q[b+1]=H.y,q[b+2]=H.z}static _TransformVector3Normals(q,X){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:q.length;const u=x.h.Od[0],H=x.h.Od[1];for(let b=Q;b<Q+y;b+=3)x.n.FromArrayToRef(q,b,u),x.n.TransformNormalToRef(u,X,H),q[b]=H.x,q[b+1]=H.y,q[b+2]=H.z}static _TransformVector4Normals(q,X){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:q.length;const u=x.h.Vector4[0],H=x.h.Vector4[1];for(let b=Q;b<Q+y;b+=4)x.q.FromArrayToRef(q,b,u),x.q.TransformNormalToRef(u,X,H),q[b]=H.x,q[b+1]=H.y,q[b+2]=H.z,q[b+3]=H.w}static _FlipFaces(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:q.length;for(let y=X;y<X+Q;y+=3){const X=q[y+1];q[y+1]=q[y+2],q[y+2]=X}}transform(q){const X=q.determinant()<0;return this.xa&&j._TransformVector3Coordinates(this.xa,q),this.ya&&j._TransformVector3Normals(this.ya,q),this.tangents&&j._TransformVector4Normals(this.tangents,q),X&&this.indices&&j._FlipFaces(this.indices),this}splitBasedOnMaterialID(){if(!this.materialInfos||this.materialInfos.length<2)return[this];const q=[];for(const X of this.materialInfos){const Q=new j;if(this.xa&&(Q.xa=this.xa.slice(3*X.verticesStart,3*(X.verticesCount+X.verticesStart))),this.ya&&(Q.ya=this.ya.slice(3*X.verticesStart,3*(X.verticesCount+X.verticesStart))),this.tangents&&(Q.tangents=this.tangents.slice(4*X.verticesStart,4*(X.verticesCount+X.verticesStart))),this.za&&(Q.za=this.za.slice(4*X.verticesStart,4*(X.verticesCount+X.verticesStart))),this.Aa&&(Q.Aa=this.Aa.slice(2*X.verticesStart,2*(X.verticesCount+X.verticesStart))),this.uvs2&&(Q.uvs2=this.uvs2.slice(2*X.verticesStart,2*(X.verticesCount+X.verticesStart))),this.uvs3&&(Q.uvs3=this.uvs3.slice(2*X.verticesStart,2*(X.verticesCount+X.verticesStart))),this.uvs4&&(Q.uvs4=this.uvs4.slice(2*X.verticesStart,2*(X.verticesCount+X.verticesStart))),this.uvs5&&(Q.uvs5=this.uvs5.slice(2*X.verticesStart,2*(X.verticesCount+X.verticesStart))),this.uvs6&&(Q.uvs6=this.uvs6.slice(2*X.verticesStart,2*(X.verticesCount+X.verticesStart))),this.matricesIndices&&(Q.matricesIndices=this.matricesIndices.slice(4*X.verticesStart,4*(X.verticesCount+X.verticesStart))),this.matricesIndicesExtra&&(Q.matricesIndicesExtra=this.matricesIndicesExtra.slice(4*X.verticesStart,4*(X.verticesCount+X.verticesStart))),this.matricesWeights&&(Q.matricesWeights=this.matricesWeights.slice(4*X.verticesStart,4*(X.verticesCount+X.verticesStart))),this.matricesWeightsExtra&&(Q.matricesWeightsExtra=this.matricesWeightsExtra.slice(4*X.verticesStart,4*(X.verticesCount+X.verticesStart))),this.indices){Q.indices=[];for(let q=X.indexStart;q<X.indexStart+X.indexCount;q++)Q.indices.push(this.indices[q]-X.verticesStart)}const y=new k;y.indexStart=0,y.indexCount=Q.indices?Q.indices.length:0,y.materialIndex=X.materialIndex,y.verticesStart=0,y.verticesCount=(Q.xa?Q.xa.length:0)/3,Q.materialInfos=[y],q.push(Q)}return q}merge(q){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2],y=arguments.length>3&&void 0!==arguments[3]&&arguments[3],x=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const u=Array.isArray(q)?q.map((q=>({vertexData:q}))):[{vertexData:q}];return(0,R.i)(this._mergeCoroutine(void 0,u,X,!1,Q,y,x))}*_mergeCoroutine(q,X){var Q,y;let x=arguments.length>2&&void 0!==arguments[2]&&arguments[2],H=arguments.length>3?arguments[3]:void 0,b=arguments.length>4?arguments[4]:void 0,D=arguments.length>5&&void 0!==arguments[5]&&arguments[5],a=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this._validate();let R=X.map((q=>q.vertexData)),L=this;if(a)for(const u of R)u&&(u._validate(),!this.ya&&u.ya&&(this.ya=new Float32Array(this.xa.length)),!this.tangents&&u.tangents&&(this.tangents=new Float32Array(this.xa.length/3*4)),!this.Aa&&u.Aa&&(this.Aa=new Float32Array(this.xa.length/3*2)),!this.uvs2&&u.uvs2&&(this.uvs2=new Float32Array(this.xa.length/3*2)),!this.uvs3&&u.uvs3&&(this.uvs3=new Float32Array(this.xa.length/3*2)),!this.uvs4&&u.uvs4&&(this.uvs4=new Float32Array(this.xa.length/3*2)),!this.uvs5&&u.uvs5&&(this.uvs5=new Float32Array(this.xa.length/3*2)),!this.uvs6&&u.uvs6&&(this.uvs6=new Float32Array(this.xa.length/3*2)),!this.za&&u.za&&(this.za=new Float32Array(this.xa.length/3*4),this.za.fill(1)),!this.matricesIndices&&u.matricesIndices&&(this.matricesIndices=new Float32Array(this.xa.length/3*4)),!this.matricesWeights&&u.matricesWeights&&(this.matricesWeights=new Float32Array(this.xa.length/3*4)),!this.matricesIndicesExtra&&u.matricesIndicesExtra&&(this.matricesIndicesExtra=new Float32Array(this.xa.length/3*4)),!this.matricesWeightsExtra&&u.matricesWeightsExtra&&(this.matricesWeightsExtra=new Float32Array(this.xa.length/3*4)));for(const u of R)if(u)if(a)this.ya&&!u.ya&&(u.ya=new Float32Array(u.xa.length)),this.tangents&&!u.tangents&&(u.tangents=new Float32Array(u.xa.length/3*4)),this.Aa&&!u.Aa&&(u.Aa=new Float32Array(u.xa.length/3*2)),this.uvs2&&!u.uvs2&&(u.uvs2=new Float32Array(u.xa.length/3*2)),this.uvs3&&!u.uvs3&&(u.uvs3=new Float32Array(u.xa.length/3*2)),this.uvs4&&!u.uvs4&&(u.uvs4=new Float32Array(u.xa.length/3*2)),this.uvs5&&!u.uvs5&&(u.uvs5=new Float32Array(u.xa.length/3*2)),this.uvs6&&!u.uvs6&&(u.uvs6=new Float32Array(u.xa.length/3*2)),this.za&&!u.za&&(u.za=new Float32Array(u.xa.length/3*4),u.za.fill(1)),this.matricesIndices&&!u.matricesIndices&&(u.matricesIndices=new Float32Array(u.xa.length/3*4)),this.matricesWeights&&!u.matricesWeights&&(u.matricesWeights=new Float32Array(u.xa.length/3*4)),this.matricesIndicesExtra&&!u.matricesIndicesExtra&&(u.matricesIndicesExtra=new Float32Array(u.xa.length/3*4)),this.matricesWeightsExtra&&!u.matricesWeightsExtra&&(u.matricesWeightsExtra=new Float32Array(u.xa.length/3*4));else if(u._validate(),!this.ya!==!u.ya||!this.tangents!==!u.tangents||!this.Aa!==!u.Aa||!this.uvs2!==!u.uvs2||!this.uvs3!==!u.uvs3||!this.uvs4!==!u.uvs4||!this.uvs5!==!u.uvs5||!this.uvs6!==!u.uvs6||!this.za!==!u.za||!this.matricesIndices!==!u.matricesIndices||!this.matricesWeights!==!u.matricesWeights||!this.matricesIndicesExtra!==!u.matricesIndicesExtra||!this.matricesWeightsExtra!==!u.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(D){let Q=0,y=0,x=0;const u=[];let H=null;const b=[];for(const X of this.splitBasedOnMaterialID())b.push({vertexData:X,transform:q});for(const q of X)if(q.vertexData)for(const X of q.vertexData.splitBasedOnMaterialID())b.push({vertexData:X,transform:q.transform});b.sort(((q,X)=>{const Q=q.vertexData.materialInfos?q.vertexData.materialInfos[0].materialIndex:0,y=X.vertexData.materialInfos?X.vertexData.materialInfos[0].materialIndex:0;return Q>y?1:Q===y?0:-1}));for(const q of b){const X=q.vertexData;if(Q=X.materialInfos?X.materialInfos[0].materialIndex:0,H&&H.materialIndex===Q)H.indexCount+=X.indices.length,H.verticesCount+=X.xa.length/3;else{const q=new k;q.materialIndex=Q,q.indexStart=y,q.indexCount=X.indices.length,q.verticesStart=x,q.verticesCount=X.xa.length/3,u.push(q),H=q}y+=X.indices.length,x+=X.xa.length/3}const D=b.splice(0,1)[0];L=D.vertexData,q=D.transform,R=b.map((q=>q.vertexData)),X=b,this.materialInfos=u}const f=R.reduce(((q,X)=>{var Q;return q+((null===(Q=X.indices)||void 0===Q?void 0:Q.length)??0)}),(null===(Q=L.indices)||void 0===Q?void 0:Q.length)??0);let I=b||R.some((q=>q.indices===L.indices))?null===(y=L.indices)||void 0===y?void 0:y.slice():L.indices;if(f>0){var d;let Q=(null===(d=I)||void 0===d?void 0:d.length)??0;if(I||(I=new Array(f)),I.length!==f){if(Array.isArray(I))I.length=f;else{const q=x||I instanceof Uint32Array?new Uint32Array(f):new Uint16Array(f);q.set(I),I=q}q&&q.determinant()<0&&j._FlipFaces(I,0,Q)}let y=L.xa?L.xa.length/3:0;for(const{vertexData:q,transform:x}of X)if(q.indices){for(let X=0;X<q.indices.length;X++)I[Q+X]=q.indices[X]+y;x&&x.determinant()<0&&j._FlipFaces(I,Q,q.indices.length),y+=q.xa.length/3,Q+=q.indices.length,H&&(yield)}}return this.indices=I,this.xa=j._MergeElement(u.c.PositionKind,L.xa,q,X.map((q=>[q.vertexData.xa,q.transform]))),H&&(yield),L.ya&&(this.ya=j._MergeElement(u.c.NormalKind,L.ya,q,X.map((q=>[q.vertexData.ya,q.transform]))),H&&(yield)),L.tangents&&(this.tangents=j._MergeElement(u.c.TangentKind,L.tangents,q,X.map((q=>[q.vertexData.tangents,q.transform]))),H&&(yield)),L.Aa&&(this.Aa=j._MergeElement(u.c.UVKind,L.Aa,q,X.map((q=>[q.vertexData.Aa,q.transform]))),H&&(yield)),L.uvs2&&(this.uvs2=j._MergeElement(u.c.UV2Kind,L.uvs2,q,X.map((q=>[q.vertexData.uvs2,q.transform]))),H&&(yield)),L.uvs3&&(this.uvs3=j._MergeElement(u.c.UV3Kind,L.uvs3,q,X.map((q=>[q.vertexData.uvs3,q.transform]))),H&&(yield)),L.uvs4&&(this.uvs4=j._MergeElement(u.c.UV4Kind,L.uvs4,q,X.map((q=>[q.vertexData.uvs4,q.transform]))),H&&(yield)),L.uvs5&&(this.uvs5=j._MergeElement(u.c.UV5Kind,L.uvs5,q,X.map((q=>[q.vertexData.uvs5,q.transform]))),H&&(yield)),L.uvs6&&(this.uvs6=j._MergeElement(u.c.UV6Kind,L.uvs6,q,X.map((q=>[q.vertexData.uvs6,q.transform]))),H&&(yield)),L.za&&(this.za=j._MergeElement(u.c.ColorKind,L.za,q,X.map((q=>[q.vertexData.za,q.transform]))),(void 0!==L.hasVertexAlpha||X.some((q=>void 0!==q.vertexData.hasVertexAlpha)))&&(this.hasVertexAlpha=L.hasVertexAlpha||X.some((q=>q.vertexData.hasVertexAlpha))),H&&(yield)),L.matricesIndices&&(this.matricesIndices=j._MergeElement(u.c.MatricesIndicesKind,L.matricesIndices,q,X.map((q=>[q.vertexData.matricesIndices,q.transform]))),H&&(yield)),L.matricesWeights&&(this.matricesWeights=j._MergeElement(u.c.MatricesWeightsKind,L.matricesWeights,q,X.map((q=>[q.vertexData.matricesWeights,q.transform]))),H&&(yield)),L.matricesIndicesExtra&&(this.matricesIndicesExtra=j._MergeElement(u.c.MatricesIndicesExtraKind,L.matricesIndicesExtra,q,X.map((q=>[q.vertexData.matricesIndicesExtra,q.transform]))),H&&(yield)),L.matricesWeightsExtra&&(this.matricesWeightsExtra=j._MergeElement(u.c.MatricesWeightsExtraKind,L.matricesWeightsExtra,q,X.map((q=>[q.vertexData.matricesWeightsExtra,q.transform])))),this}static _MergeElement(q,X,Q,y){const x=y.filter((q=>null!==q[0]&&void 0!==q[0]));if(!X&&0==x.length)return X;if(!X)return this._MergeElement(q,x[0][0],x[0][1],x.slice(1));const H=x.reduce(((q,X)=>q+X[0].length),X.length),b=q===u.c.PositionKind?j._TransformVector3Coordinates:q===u.c.NormalKind?j._TransformVector3Normals:q===u.c.TangentKind?j._TransformVector4Normals:()=>{};if(X instanceof Float32Array){const q=new Float32Array(H);q.set(X),Q&&b(q,Q,0,X.length);let y=X.length;for(const[X,Q]of x)q.set(X,y),Q&&b(q,Q,y,X.length),y+=X.length;return q}{const q=new Array(H);for(let Q=0;Q<X.length;Q++)q[Q]=X[Q];Q&&b(q,Q,0,X.length);let y=X.length;for(const[X,Q]of x){for(let Q=0;Q<X.length;Q++)q[y+Q]=X[Q];Q&&b(q,Q,y,X.length),y+=X.length}return q}}_validate(){if(!this.xa)throw new L.f("Positions are required",L.e.MeshInvalidPositionsError);const q=(q,X)=>{const Q=u.c.DeduceStride(q);if(X.length%Q!==0)throw new Error("The "+q+"s array count must be a multiple of "+Q);return X.length/Q},X=q(u.c.PositionKind,this.xa),Q=(Q,y)=>{const x=q(Q,y);if(x!==X)throw new Error("The "+Q+"s element count ("+x+") does not match the positions count ("+X+")")};this.ya&&Q(u.c.NormalKind,this.ya),this.tangents&&Q(u.c.TangentKind,this.tangents),this.Aa&&Q(u.c.UVKind,this.Aa),this.uvs2&&Q(u.c.UV2Kind,this.uvs2),this.uvs3&&Q(u.c.UV3Kind,this.uvs3),this.uvs4&&Q(u.c.UV4Kind,this.uvs4),this.uvs5&&Q(u.c.UV5Kind,this.uvs5),this.uvs6&&Q(u.c.UV6Kind,this.uvs6),this.za&&Q(u.c.ColorKind,this.za),this.matricesIndices&&Q(u.c.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&Q(u.c.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&Q(u.c.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&Q(u.c.MatricesWeightsExtraKind,this.matricesWeightsExtra)}clone(){const q=this.serialize();return j.Parse(q)}serialize(){const q={};if(this.xa&&(q.xa=Array.from(this.xa)),this.ya&&(q.ya=Array.from(this.ya)),this.tangents&&(q.tangents=Array.from(this.tangents)),this.Aa&&(q.Aa=Array.from(this.Aa)),this.uvs2&&(q.uvs2=Array.from(this.uvs2)),this.uvs3&&(q.uvs3=Array.from(this.uvs3)),this.uvs4&&(q.uvs4=Array.from(this.uvs4)),this.uvs5&&(q.uvs5=Array.from(this.uvs5)),this.uvs6&&(q.uvs6=Array.from(this.uvs6)),this.za&&(q.za=Array.from(this.za),q.hasVertexAlpha=this.hasVertexAlpha),this.matricesIndices&&(q.matricesIndices=Array.from(this.matricesIndices),q.matricesIndices._isExpanded=!0),this.matricesWeights&&(q.matricesWeights=Array.from(this.matricesWeights)),this.matricesIndicesExtra&&(q.matricesIndicesExtra=Array.from(this.matricesIndicesExtra),q.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(q.matricesWeightsExtra=Array.from(this.matricesWeightsExtra)),q.indices=Array.from(this.indices),this.materialInfos){q.materialInfos=[];for(const X of this.materialInfos){const Q={indexStart:X.indexStart,indexCount:X.indexCount,materialIndex:X.materialIndex,verticesStart:X.verticesStart,verticesCount:X.verticesCount};q.materialInfos.push(Q)}}return q}static ExtractFromMesh(q,X,Q){return j._ExtractFrom(q,X,Q)}static ExtractFromGeometry(q,X,Q){return j._ExtractFrom(q,X,Q)}static _ExtractFrom(q,X,Q){const y=new j;if(q.isVerticesDataPresent(u.c.PositionKind)&&(y.xa=q.getVerticesData(u.c.PositionKind,X,Q)),q.isVerticesDataPresent(u.c.NormalKind)&&(y.ya=q.getVerticesData(u.c.NormalKind,X,Q)),q.isVerticesDataPresent(u.c.TangentKind)&&(y.tangents=q.getVerticesData(u.c.TangentKind,X,Q)),q.isVerticesDataPresent(u.c.UVKind)&&(y.Aa=q.getVerticesData(u.c.UVKind,X,Q)),q.isVerticesDataPresent(u.c.UV2Kind)&&(y.uvs2=q.getVerticesData(u.c.UV2Kind,X,Q)),q.isVerticesDataPresent(u.c.UV3Kind)&&(y.uvs3=q.getVerticesData(u.c.UV3Kind,X,Q)),q.isVerticesDataPresent(u.c.UV4Kind)&&(y.uvs4=q.getVerticesData(u.c.UV4Kind,X,Q)),q.isVerticesDataPresent(u.c.UV5Kind)&&(y.uvs5=q.getVerticesData(u.c.UV5Kind,X,Q)),q.isVerticesDataPresent(u.c.UV6Kind)&&(y.uvs6=q.getVerticesData(u.c.UV6Kind,X,Q)),q.isVerticesDataPresent(u.c.ColorKind)){const x=q.ze||q,H=x.getVertexBuffer(u.c.ColorKind),b=x.getVerticesData(u.c.ColorKind,X,Q);if(3===H.getSize()){const q=new Float32Array(4*b.length/3);for(let X=0,Q=0;X<b.length;X+=3,Q+=4)q[Q]=b[X],q[Q+1]=b[X+1],q[Q+2]=b[X+2],q[Q+3]=1;y.za=q}else{if(4!==H.getSize())throw new Error(`Unexpected number of color components: ${H.getSize()}`);y.za=b}}return q.isVerticesDataPresent(u.c.MatricesIndicesKind)&&(y.matricesIndices=q.getVerticesData(u.c.MatricesIndicesKind,X,Q)),q.isVerticesDataPresent(u.c.MatricesWeightsKind)&&(y.matricesWeights=q.getVerticesData(u.c.MatricesWeightsKind,X,Q)),q.isVerticesDataPresent(u.c.MatricesIndicesExtraKind)&&(y.matricesIndicesExtra=q.getVerticesData(u.c.MatricesIndicesExtraKind,X,Q)),q.isVerticesDataPresent(u.c.MatricesWeightsExtraKind)&&(y.matricesWeightsExtra=q.getVerticesData(u.c.MatricesWeightsExtraKind,X,Q)),y.indices=q.Nd(X,Q),y}static CreateRibbon(q){throw(0,H.c)("ribbonBuilder")}static CreateBox(q){throw(0,H.c)("boxBuilder")}static CreateTiledBox(q){throw(0,H.c)("tiledBoxBuilder")}static CreateTiledPlane(q){throw(0,H.c)("tiledPlaneBuilder")}static CreateSphere(q){throw(0,H.c)("sphereBuilder")}static CreateCylinder(q){throw(0,H.c)("cylinderBuilder")}static CreateTorus(q){throw(0,H.c)("torusBuilder")}static CreateLineSystem(q){throw(0,H.c)("linesBuilder")}static CreateDashedLines(q){throw(0,H.c)("linesBuilder")}static CreateGround(q){throw(0,H.c)("groundBuilder")}static CreateTiledGround(q){throw(0,H.c)("groundBuilder")}static CreateGroundFromHeightMap(q){throw(0,H.c)("groundBuilder")}static ug(q){throw(0,H.c)("planeBuilder")}static nb(q){throw(0,H.c)("discBuilder")}static CreatePolygon(q,X,Q,y,x,u,b){throw(0,H.c)("polygonBuilder")}static CreateIcoSphere(q){throw(0,H.c)("icoSphereBuilder")}static CreatePolyhedron(q){throw(0,H.c)("polyhedronBuilder")}static CreateCapsule(){arguments.length>0&&void 0!==arguments[0]||x.n.Up();throw(0,H.c)("capsuleBuilder")}static CreateTorusKnot(q){throw(0,H.c)("torusKnotBuilder")}static ComputeNormals(q,X,Q,y){let u=0,H=0,b=0,D=0,a=0,R=0,L=0,f=0,k=0,j=0,I=0,d=0,e=0,i=0,A=0,B=0,w=0,V=0,W=0,v=0,Z=!1,U=!1,O=!1,g=!1,P=1,F=0,l=null;y&&(Z=!!y.facetNormals,U=!!y.facetPositions,O=!!y.facetPartitioning,P=!0===y.useRightHandedSystem?-1:1,F=y.ratio||0,g=!!y.depthSort,l=y.distanceTo,g&&void 0===l&&(l=x.n.Zero()));let m=0,M=0,o=0,Y=0;for(O&&y&&y.bbSize&&(m=y.subDiv.X*F/y.bbSize.x,M=y.subDiv.Y*F/y.bbSize.y,o=y.subDiv.Z*F/y.bbSize.z,Y=y.subDiv.max*y.subDiv.max,y.facetPartitioning.length=0),u=0;u<q.length;u++)Q[u]=0;const N=X.length/3|0;for(u=0;u<N;u++){if(d=3*X[3*u],e=d+1,i=d+2,A=3*X[3*u+1],B=A+1,w=A+2,V=3*X[3*u+2],W=V+1,v=V+2,H=q[d]-q[A],b=q[e]-q[B],D=q[i]-q[w],a=q[V]-q[A],R=q[W]-q[B],L=q[v]-q[w],f=P*(b*L-D*R),k=P*(D*a-H*L),j=P*(H*R-b*a),I=Math.sqrt(f*f+k*k+j*j),I=0===I?1:I,f/=I,k/=I,j/=I,Z&&y&&(y.facetNormals[u].x=f,y.facetNormals[u].y=k,y.facetNormals[u].z=j),U&&y&&(y.facetPositions[u].x=(q[d]+q[A]+q[V])/3,y.facetPositions[u].y=(q[e]+q[B]+q[W])/3,y.facetPositions[u].z=(q[i]+q[w]+q[v])/3),O&&y){const X=Math.floor((y.facetPositions[u].x-y.bInfo.minimum.x*F)*m),Q=Math.floor((y.facetPositions[u].y-y.bInfo.minimum.y*F)*M),x=Math.floor((y.facetPositions[u].z-y.bInfo.minimum.z*F)*o),H=Math.floor((q[d]-y.bInfo.minimum.x*F)*m),b=Math.floor((q[e]-y.bInfo.minimum.y*F)*M),D=Math.floor((q[i]-y.bInfo.minimum.z*F)*o),a=Math.floor((q[A]-y.bInfo.minimum.x*F)*m),R=Math.floor((q[B]-y.bInfo.minimum.y*F)*M),L=Math.floor((q[w]-y.bInfo.minimum.z*F)*o),f=Math.floor((q[V]-y.bInfo.minimum.x*F)*m),k=Math.floor((q[W]-y.bInfo.minimum.y*F)*M),j=Math.floor((q[v]-y.bInfo.minimum.z*F)*o),I=H+y.subDiv.max*b+Y*D,Z=a+y.subDiv.max*R+Y*L,U=f+y.subDiv.max*k+Y*j,O=X+y.subDiv.max*Q+Y*x;y.facetPartitioning[O]=y.facetPartitioning[O]?y.facetPartitioning[O]:new Array,y.facetPartitioning[I]=y.facetPartitioning[I]?y.facetPartitioning[I]:new Array,y.facetPartitioning[Z]=y.facetPartitioning[Z]?y.facetPartitioning[Z]:new Array,y.facetPartitioning[U]=y.facetPartitioning[U]?y.facetPartitioning[U]:new Array,y.facetPartitioning[I].push(u),Z!=I&&y.facetPartitioning[Z].push(u),U!=Z&&U!=I&&y.facetPartitioning[U].push(u),O!=I&&O!=Z&&O!=U&&y.facetPartitioning[O].push(u)}if(g&&y&&y.facetPositions){const q=y.depthSortedFacets[u];q.ind=3*u,q.sqDistance=x.n.DistanceSquared(y.facetPositions[u],l)}Q[d]+=f,Q[e]+=k,Q[i]+=j,Q[A]+=f,Q[B]+=k,Q[w]+=j,Q[V]+=f,Q[W]+=k,Q[v]+=j}for(u=0;u<Q.length/3;u++)f=Q[3*u],k=Q[3*u+1],j=Q[3*u+2],I=Math.sqrt(f*f+k*k+j*j),I=0===I?1:I,f/=I,k/=I,j/=I,Q[3*u]=f,Q[3*u+1]=k,Q[3*u+2]=j}static _ComputeSides(q,X,Q,y,u,H,b){const D=Q.length,a=y.length;let R,L;switch(q=q||j.DEFAULTSIDE){case j.FRONTSIDE:break;case j.BACKSIDE:for(R=0;R<D;R+=3){const q=Q[R];Q[R]=Q[R+2],Q[R+2]=q}for(L=0;L<a;L++)y[L]=-y[L];break;case j.DOUBLESIDE:{const q=X.length,f=q/3;for(let Q=0;Q<q;Q++)X[q+Q]=X[Q];for(R=0;R<D;R+=3)Q[R+D]=Q[R+2]+f,Q[R+1+D]=Q[R+1]+f,Q[R+2+D]=Q[R]+f;for(L=0;L<a;L++)y[a+L]=-y[L];const k=u.length;let j=0;for(j=0;j<k;j++)u[j+k]=u[j];for(H=H||new x.q(0,0,1,1),b=b||new x.q(0,0,1,1),j=0,R=0;R<k/2;R++)u[j]=H.x+(H.z-H.x)*u[j],u[j+1]=H.y+(H.w-H.y)*u[j+1],u[j+k]=b.x+(b.z-b.x)*u[j+k],u[j+k+1]=b.y+(b.w-b.y)*u[j+k+1],j+=2;break}}}static Parse(q){const X=new j,Q=q.xa;Q&&X.set(Q,u.c.PositionKind);const y=q.ya;y&&X.set(y,u.c.NormalKind);const x=q.tangents;x&&X.set(x,u.c.TangentKind);const H=q.Aa;H&&X.set(H,u.c.UVKind);const D=q.uvs2;D&&X.set(D,u.c.UV2Kind);const a=q.uvs3;a&&X.set(a,u.c.UV3Kind);const R=q.uvs4;R&&X.set(R,u.c.UV4Kind);const L=q.uvs5;L&&X.set(L,u.c.UV5Kind);const f=q.uvs6;f&&X.set(f,u.c.UV6Kind);const I=q.za;I&&(X.set(b.c.CheckColors4(I,Q.length/3),u.c.ColorKind),void 0!==q.hasVertexAlpha&&(X.hasVertexAlpha=q.hasVertexAlpha));const d=q.matricesIndices;d&&X.set(d,u.c.MatricesIndicesKind);const e=q.matricesWeights;e&&X.set(e,u.c.MatricesWeightsKind);const i=q.indices;i&&(X.indices=i);const A=q.materialInfos;if(A){X.materialInfos=[];for(const q of A){const Q=new k;Q.indexCount=q.indexCount,Q.indexStart=q.indexStart,Q.verticesCount=q.verticesCount,Q.verticesStart=q.verticesStart,Q.materialIndex=q.materialIndex,X.materialInfos.push(Q)}}return X}static ImportVertexData(q,X){const Q=j.Parse(q);X.setAllVerticesData(Q,q.updatable)}}j.FRONTSIDE=0,j.BACKSIDE=1,j.DOUBLESIDE=2,j.DEFAULTSIDE=0,j._UniqueIDGenerator=0,(0,y.b)([a.g.filter((function(){for(var q=arguments.length,X=new Array(q),Q=0;Q<q;Q++)X[Q]=arguments[Q];let[y]=X;return!Array.isArray(y)}))],j,"_TransformVector3Coordinates",null),(0,y.b)([a.g.filter((function(){for(var q=arguments.length,X=new Array(q),Q=0;Q<q;Q++)X[Q]=arguments[Q];let[y]=X;return!Array.isArray(y)}))],j,"_TransformVector3Normals",null),(0,y.b)([a.g.filter((function(){for(var q=arguments.length,X=new Array(q),Q=0;Q<q;Q++)X[Q]=arguments[Q];let[y]=X;return!Array.isArray(y)}))],j,"_TransformVector4Normals",null),(0,y.b)([a.g.filter((function(){for(var q=arguments.length,X=new Array(q),Q=0;Q<q;Q++)X[Q]=arguments[Q];let[y]=X;return!Array.isArray(y)}))],j,"_FlipFaces",null)},12220:(q,X,Q)=>{"use strict";Q.d(X,{e:()=>Iq});var y=Q(1002),x=Q(11253),u=Q(1261),H=Q(11276),b=Q(1195);function D(q){let X=q.pathArray;const Q=q.closeArray||!1,y=q.closePath||!1,x=q.invertUV||!1,D=Math.floor(X[0].length/2);let a=q.offset||D;a=a>D?D:Math.floor(a);const R=0===q.sideOrientation?0:q.sideOrientation||H.d.DEFAULTSIDE,L=q.Aa,f=q.za,k=[],j=[],I=[],d=[],e=[],i=[],A=[],B=[];let w;const V=[],W=[];let v,Z,U;if(X.length<2){const q=[],Q=[];for(Z=0;Z<X[0].length-a;Z++)q.push(X[0][Z]),Q.push(X[0][Z+a]);X=[q,Q]}let O=0;const g=y?1:0,P=Q?1:0;let F,l,m,M,o,Y;for(w=X[0].length,v=0;v<X.length+P;v++){for(A[v]=0,e[v]=[0],F=v===X.length?X[0]:X[v],l=F.length,w=w<l?w:l,U=0;U<l;)k.push(F[U].x,F[U].y,F[U].z),U>0&&(m=F[U].Sc(F[U-1]).length(),M=m+A[v],e[v].push(M),A[v]=M),U++;y&&(U--,k.push(F[0].x,F[0].y,F[0].z),m=F[U].Sc(F[0]).length(),M=m+A[v],e[v].push(M),A[v]=M),V[v]=l+g,W[v]=O,O+=l+g}let N,S,c=null,p=null;for(Z=0;Z<w+g;Z++)for(B[Z]=0,i[Z]=[0],v=0;v<X.length-1+P;v++)o=X[v],Y=v===X.length-1?X[0]:X[v+1],Z===w?(c=o[0],p=Y[0]):(c=o[Z],p=Y[Z]),m=p.Sc(c).length(),M=m+B[Z],i[Z].push(M),B[Z]=M;if(L)for(v=0;v<L.length;v++)d.push(L[v].x,b.c?1-L[v].y:L[v].y);else for(v=0;v<X.length+P;v++)for(Z=0;Z<w+g;Z++)N=0!=A[v]?e[v][Z]/A[v]:0,S=0!=B[Z]?i[Z][v]/B[Z]:0,x?d.push(S,N):d.push(N,b.c?1-S:S);v=0;let t=0,z=V[v]-1,K=V[v+1]-1,h=z<K?z:K,G=W[1]-W[0];const C=V.length-1;for(;t<=h&&v<C;)j.push(t,t+G,t+1),j.push(t+G+1,t+1,t+G),t+=1,t===h&&(v++,G=W[v+1]-W[v],z=V[v]-1,K=V[v+1]-1,t=W[v],h=z<K?z+t:K+t);if(H.d.ComputeNormals(k,j,I),y){let q=0,Q=0;for(v=0;v<X.length;v++){q=3*W[v],Q=v+1<X.length?3*(W[v+1]-1):I.length-3,I[q]=.5*(I[q]+I[Q]),I[q+1]=.5*(I[q+1]+I[Q+1]),I[q+2]=.5*(I[q+2]+I[Q+2]);const y=Math.sqrt(I[q]*I[q]+I[q+1]*I[q+1]+I[q+2]*I[q+2]);I[q]/=y,I[q+1]/=y,I[q+2]/=y,I[Q]=I[q],I[Q+1]=I[q+1],I[Q+2]=I[q+2]}}if(Q){let q=3*W[0],Q=3*W[X.length];for(Z=0;Z<w+g;Z++){I[q]=.5*(I[q]+I[Q]),I[q+1]=.5*(I[q+1]+I[Q+1]),I[q+2]=.5*(I[q+2]+I[Q+2]);const X=Math.sqrt(I[q]*I[q]+I[q+1]*I[q+1]+I[q+2]*I[q+2]);I[q]/=X,I[q+1]/=X,I[q+2]/=X,I[Q]=I[q],I[Q+1]=I[q+1],I[Q+2]=I[q+2],q+=3,Q+=3}}H.d._ComputeSides(R,k,j,I,d,q.frontUVs,q.backUVs);let E=null;if(f){E=new Float32Array(4*f.length);for(let q=0;q<f.length;q++)E[4*q]=f[q].r,E[4*q+1]=f[q].g,E[4*q+2]=f[q].b,E[4*q+3]=f[q].a}const J=new H.d,n=new Float32Array(k),r=new Float32Array(I),s=new Float32Array(d);return J.indices=j,J.xa=n,J.ya=r,J.Aa=s,E&&J.set(E,u.c.ColorKind),y&&(J._idx=W),J}function a(q,X){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const a=X.pathArray,R=X.closeArray,L=X.closePath,f=x.b._GetDefaultSideOrientation(X.sideOrientation),k=X.instance,j=X.updatable;if(k){const q=y.h.Od[0].Td(Number.MAX_VALUE),Q=y.h.Od[1].Td(-Number.MAX_VALUE),D=X=>{let y=a[0].length;const u=k;let H=0;const b=u._originalBuilderSideOrientation===x.b.DOUBLESIDE?2:1;for(let x=1;x<=b;++x)for(let b=0;b<a.length;++b){const x=a[b],D=x.length;y=y<D?y:D;for(let u=0;u<y;++u){const y=x[u];X[H]=y.x,X[H+1]=y.y,X[H+2]=y.z,q.minimizeInPlaceFromFloats(y.x,y.y,y.z),Q.maximizeInPlaceFromFloats(y.x,y.y,y.z),H+=3}if(u._creationDataStorage&&u._creationDataStorage.closePath){const q=x[0];X[H]=q.x,X[H+1]=q.y,X[H+2]=q.z,H+=3}}},R=k.getVerticesData(u.c.PositionKind);if(D(R),k.hasBoundingInfo?k.getBoundingInfo().reConstruct(q,Q,k._worldMatrix):k.buildBoundingInfo(q,Q,k._worldMatrix),k.updateVerticesData(u.c.PositionKind,R,!1,!1),X.za){const q=k.getVerticesData(u.c.ColorKind);for(let Q=0,y=0;Q<X.za.length;Q++,y+=4){const x=X.za[Q];q[y]=x.r,q[y+1]=x.g,q[y+2]=x.b,q[y+3]=x.a}k.updateVerticesData(u.c.ColorKind,q,!1,!1)}if(X.Aa){const q=k.getVerticesData(u.c.UVKind);for(let Q=0;Q<X.Aa.length;Q++)q[2*Q]=X.Aa[Q].x,q[2*Q+1]=b.c?1-X.Aa[Q].y:X.Aa[Q].y;k.updateVerticesData(u.c.UVKind,q,!1,!1)}if(!k.areNormalsFrozen||k.isFacetDataEnabled){const q=k.Nd(),X=k.getVerticesData(u.c.NormalKind),Q=k.isFacetDataEnabled?k.getFacetDataParameters():null;if(H.d.ComputeNormals(R,q,X,Q),k._creationDataStorage&&k._creationDataStorage.closePath){let q=0,Q=0;for(let y=0;y<a.length;y++)q=3*k._creationDataStorage.idx[y],Q=y+1<a.length?3*(k._creationDataStorage.idx[y+1]-1):X.length-3,X[q]=.5*(X[q]+X[Q]),X[q+1]=.5*(X[q+1]+X[Q+1]),X[q+2]=.5*(X[q+2]+X[Q+2]),X[Q]=X[q],X[Q+1]=X[q+1],X[Q+2]=X[q+2]}k.areNormalsFrozen||k.updateVerticesData(u.c.NormalKind,X,!1,!1)}return k}{const y=new x.b(q,Q);y._originalBuilderSideOrientation=f,y._creationDataStorage=new x.c;const u=D(X);return L&&(y._creationDataStorage.idx=u._idx),y._creationDataStorage.closePath=L,y._creationDataStorage.closeArray=R,u.Ca(y,j),y}}H.d.CreateRibbon=D,x.b.CreateRibbon=function(q,X){return a(q,{pathArray:X,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var R=Q(11421),L=Q(11311),f=Q(1182);function k(q){const X=q.pattern||x.b.NO_FLIP,Q=q.tileWidth||q.tileSize||1,y=q.tileHeight||q.tileSize||1,u=q.alignHorizontal||0,b=q.alignVertical||0,D=q.width||q.size||1,a=Math.floor(D/Q);let R=D-a*Q;const L=q.height||q.size||1,f=Math.floor(L/y);let k=L-f*y;const j=Q*a/2,I=y*f/2;let d=0,e=0,i=0,A=0,B=0,w=0;if(R>0||k>0){switch(i=-j,A=-I,B=j,w=I,u){case x.b.CENTER:R/=2,i-=R,B+=R;break;case x.b.LEFT:B+=R,d=-R/2;break;case x.b.RIGHT:i-=R,d=R/2}switch(b){case x.b.CENTER:k/=2,A-=k,w+=k;break;case x.b.BOTTOM:w+=k,e=-k/2;break;case x.b.TOP:A-=k,e=k/2}}const V=[],W=[],v=[];v[0]=[0,0,1,0,1,1,0,1],v[1]=[0,0,1,0,1,1,0,1],X!==x.b.ROTATE_TILE&&X!==x.b.ROTATE_ROW||(v[1]=[1,1,0,1,0,0,1,0]),X!==x.b.FLIP_TILE&&X!==x.b.FLIP_ROW||(v[1]=[1,0,0,0,0,1,1,1]),X!==x.b.FLIP_N_ROTATE_TILE&&X!==x.b.FLIP_N_ROTATE_ROW||(v[1]=[0,1,1,1,1,0,0,0]);let Z=[];const U=[],O=[];let g=0;for(let H=0;H<f;H++)for(let q=0;q<a;q++)V.push(q*Q-j+d,H*y-I+e,0),V.push((q+1)*Q-j+d,H*y-I+e,0),V.push((q+1)*Q-j+d,(H+1)*y-I+e,0),V.push(q*Q-j+d,(H+1)*y-I+e,0),O.push(g,g+1,g+3,g+1,g+2,g+3),Z=X===x.b.FLIP_TILE||X===x.b.ROTATE_TILE||X===x.b.FLIP_N_ROTATE_TILE?Z.concat(v[(q%2+H%2)%2]):X===x.b.FLIP_ROW||X===x.b.ROTATE_ROW||X===x.b.FLIP_N_ROTATE_ROW?Z.concat(v[H%2]):Z.concat(v[0]),U.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),W.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),g+=4;if(R>0||k>0){const q=k>0&&(b===x.b.CENTER||b===x.b.TOP),H=k>0&&(b===x.b.CENTER||b===x.b.BOTTOM),D=R>0&&(u===x.b.CENTER||u===x.b.RIGHT),L=R>0&&(u===x.b.CENTER||u===x.b.LEFT);let v,P,F,l,m=[];if(q&&D&&(V.push(i+d,A+e,0),V.push(-j+d,A+e,0),V.push(-j+d,A+k+e,0),V.push(i+d,A+k+e,0),O.push(g,g+1,g+3,g+1,g+2,g+3),g+=4,v=1-R/Q,P=1-k/y,F=1,l=1,m=[v,P,F,P,F,l,v,l],X===x.b.ROTATE_ROW&&(m=[1-v,1-P,1-F,1-P,1-F,1-l,1-v,1-l]),X===x.b.FLIP_ROW&&(m=[1-v,P,1-F,P,1-F,l,1-v,l]),X===x.b.FLIP_N_ROTATE_ROW&&(m=[v,1-P,F,1-P,F,1-l,v,1-l]),Z=Z.concat(m),U.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),W.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),q&&L&&(V.push(j+d,A+e,0),V.push(B+d,A+e,0),V.push(B+d,A+k+e,0),V.push(j+d,A+k+e,0),O.push(g,g+1,g+3,g+1,g+2,g+3),g+=4,v=0,P=1-k/y,F=R/Q,l=1,m=[v,P,F,P,F,l,v,l],(X===x.b.ROTATE_ROW||X===x.b.ROTATE_TILE&&a%2===0)&&(m=[1-v,1-P,1-F,1-P,1-F,1-l,1-v,1-l]),(X===x.b.FLIP_ROW||X===x.b.FLIP_TILE&&a%2===0)&&(m=[1-v,P,1-F,P,1-F,l,1-v,l]),(X===x.b.FLIP_N_ROTATE_ROW||X===x.b.FLIP_N_ROTATE_TILE&&a%2===0)&&(m=[v,1-P,F,1-P,F,1-l,v,1-l]),Z=Z.concat(m),U.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),W.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),H&&D&&(V.push(i+d,I+e,0),V.push(-j+d,I+e,0),V.push(-j+d,w+e,0),V.push(i+d,w+e,0),O.push(g,g+1,g+3,g+1,g+2,g+3),g+=4,v=1-R/Q,P=0,F=1,l=k/y,m=[v,P,F,P,F,l,v,l],(X===x.b.ROTATE_ROW&&f%2===1||X===x.b.ROTATE_TILE&&f%1===0)&&(m=[1-v,1-P,1-F,1-P,1-F,1-l,1-v,1-l]),(X===x.b.FLIP_ROW&&f%2===1||X===x.b.FLIP_TILE&&f%2===0)&&(m=[1-v,P,1-F,P,1-F,l,1-v,l]),(X===x.b.FLIP_N_ROTATE_ROW&&f%2===1||X===x.b.FLIP_N_ROTATE_TILE&&f%2===0)&&(m=[v,1-P,F,1-P,F,1-l,v,1-l]),Z=Z.concat(m),U.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),W.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),H&&L&&(V.push(j+d,I+e,0),V.push(B+d,I+e,0),V.push(B+d,w+e,0),V.push(j+d,w+e,0),O.push(g,g+1,g+3,g+1,g+2,g+3),g+=4,v=0,P=0,F=R/Q,l=k/y,m=[v,P,F,P,F,l,v,l],(X===x.b.ROTATE_ROW&&f%2===1||X===x.b.ROTATE_TILE&&(f+a)%2===1)&&(m=[1-v,1-P,1-F,1-P,1-F,1-l,1-v,1-l]),(X===x.b.FLIP_ROW&&f%2===1||X===x.b.FLIP_TILE&&(f+a)%2===1)&&(m=[1-v,P,1-F,P,1-F,l,1-v,l]),(X===x.b.FLIP_N_ROTATE_ROW&&f%2===1||X===x.b.FLIP_N_ROTATE_TILE&&(f+a)%2===1)&&(m=[v,1-P,F,1-P,F,1-l,v,1-l]),Z=Z.concat(m),U.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),W.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),q){const q=[];v=0,P=1-k/y,F=1,l=1,q[0]=[v,P,F,P,F,l,v,l],q[1]=[v,P,F,P,F,l,v,l],X!==x.b.ROTATE_TILE&&X!==x.b.ROTATE_ROW||(q[1]=[1-v,1-P,1-F,1-P,1-F,1-l,1-v,1-l]),X!==x.b.FLIP_TILE&&X!==x.b.FLIP_ROW||(q[1]=[1-v,P,1-F,P,1-F,l,1-v,l]),X!==x.b.FLIP_N_ROTATE_TILE&&X!==x.b.FLIP_N_ROTATE_ROW||(q[1]=[v,1-P,F,1-P,F,1-l,v,1-l]);for(let y=0;y<a;y++)V.push(y*Q-j+d,A+e,0),V.push((y+1)*Q-j+d,A+e,0),V.push((y+1)*Q-j+d,A+k+e,0),V.push(y*Q-j+d,A+k+e,0),O.push(g,g+1,g+3,g+1,g+2,g+3),g+=4,Z=X===x.b.FLIP_TILE||X===x.b.ROTATE_TILE||X===x.b.FLIP_N_ROTATE_TILE?Z.concat(q[(y+1)%2]):X===x.b.FLIP_ROW||X===x.b.ROTATE_ROW||X===x.b.FLIP_N_ROTATE_ROW?Z.concat(q[1]):Z.concat(q[0]),U.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),W.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(H){const q=[];v=0,P=0,F=1,l=k/y,q[0]=[v,P,F,P,F,l,v,l],q[1]=[v,P,F,P,F,l,v,l],X!==x.b.ROTATE_TILE&&X!==x.b.ROTATE_ROW||(q[1]=[1-v,1-P,1-F,1-P,1-F,1-l,1-v,1-l]),X!==x.b.FLIP_TILE&&X!==x.b.FLIP_ROW||(q[1]=[1-v,P,1-F,P,1-F,l,1-v,l]),X!==x.b.FLIP_N_ROTATE_TILE&&X!==x.b.FLIP_N_ROTATE_ROW||(q[1]=[v,1-P,F,1-P,F,1-l,v,1-l]);for(let y=0;y<a;y++)V.push(y*Q-j+d,w-k+e,0),V.push((y+1)*Q-j+d,w-k+e,0),V.push((y+1)*Q-j+d,w+e,0),V.push(y*Q-j+d,w+e,0),O.push(g,g+1,g+3,g+1,g+2,g+3),g+=4,Z=X===x.b.FLIP_TILE||X===x.b.ROTATE_TILE||X===x.b.FLIP_N_ROTATE_TILE?Z.concat(q[(y+f)%2]):X===x.b.FLIP_ROW||X===x.b.ROTATE_ROW||X===x.b.FLIP_N_ROTATE_ROW?Z.concat(q[f%2]):Z.concat(q[0]),U.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),W.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(D){const q=[];v=1-R/Q,P=0,F=1,l=1,q[0]=[v,P,F,P,F,l,v,l],q[1]=[v,P,F,P,F,l,v,l],X!==x.b.ROTATE_TILE&&X!==x.b.ROTATE_ROW||(q[1]=[1-v,1-P,1-F,1-P,1-F,1-l,1-v,1-l]),X!==x.b.FLIP_TILE&&X!==x.b.FLIP_ROW||(q[1]=[1-v,P,1-F,P,1-F,l,1-v,l]),X!==x.b.FLIP_N_ROTATE_TILE&&X!==x.b.FLIP_N_ROTATE_ROW||(q[1]=[v,1-P,F,1-P,F,1-l,v,1-l]);for(let Q=0;Q<f;Q++)V.push(i+d,Q*y-I+e,0),V.push(i+R+d,Q*y-I+e,0),V.push(i+R+d,(Q+1)*y-I+e,0),V.push(i+d,(Q+1)*y-I+e,0),O.push(g,g+1,g+3,g+1,g+2,g+3),g+=4,Z=X===x.b.FLIP_TILE||X===x.b.ROTATE_TILE||X===x.b.FLIP_N_ROTATE_TILE?Z.concat(q[(Q+1)%2]):X===x.b.FLIP_ROW||X===x.b.ROTATE_ROW||X===x.b.FLIP_N_ROTATE_ROW?Z.concat(q[Q%2]):Z.concat(q[0]),U.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),W.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(L){const q=[];v=0,P=0,F=R/y,l=1,q[0]=[v,P,F,P,F,l,v,l],q[1]=[v,P,F,P,F,l,v,l],X!==x.b.ROTATE_TILE&&X!==x.b.ROTATE_ROW||(q[1]=[1-v,1-P,1-F,1-P,1-F,1-l,1-v,1-l]),X!==x.b.FLIP_TILE&&X!==x.b.FLIP_ROW||(q[1]=[1-v,P,1-F,P,1-F,l,1-v,l]),X!==x.b.FLIP_N_ROTATE_TILE&&X!==x.b.FLIP_N_ROTATE_ROW||(q[1]=[v,1-P,F,1-P,F,1-l,v,1-l]);for(let Q=0;Q<f;Q++)V.push(B-R+d,Q*y-I+e,0),V.push(B+d,Q*y-I+e,0),V.push(B+d,(Q+1)*y-I+e,0),V.push(B-R+d,(Q+1)*y-I+e,0),O.push(g,g+1,g+3,g+1,g+2,g+3),g+=4,Z=X===x.b.FLIP_TILE||X===x.b.ROTATE_TILE||X===x.b.FLIP_N_ROTATE_TILE?Z.concat(q[(Q+a)%2]):X===x.b.FLIP_ROW||X===x.b.ROTATE_ROW||X===x.b.FLIP_N_ROTATE_ROW?Z.concat(q[Q%2]):Z.concat(q[0]),U.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),W.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const P=0===q.sideOrientation?0:q.sideOrientation||H.d.DEFAULTSIDE;H.d._ComputeSides(P,V,O,W,Z,q.frontUVs,q.backUVs);const F=new H.d;F.indices=O,F.xa=V,F.ya=W,F.Aa=Z;const l=P===H.d.DOUBLESIDE?U.concat(U):U;return F.za=l,F}function j(q,X){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const y=new x.b(q,Q);X.sideOrientation=x.b._GetDefaultSideOrientation(X.sideOrientation),y._originalBuilderSideOrientation=X.sideOrientation;return k(X).Ca(y,X.updatable),y}function I(q){const X=q.faceUV||new Array(6),Q=q.faceColors,u=q.pattern||x.b.NO_FLIP,D=q.width||q.size||1,a=q.height||q.size||1,R=q.depth||q.size||1,L=q.tileWidth||q.tileSize||1,j=q.tileHeight||q.tileSize||1,I=q.alignHorizontal||0,d=q.alignVertical||0,e=0===q.sideOrientation?0:q.sideOrientation||H.d.DEFAULTSIDE;for(let x=0;x<6;x++)void 0===X[x]&&(X[x]=new y.q(0,0,1,1)),Q&&void 0===Q[x]&&(Q[x]=new f.c(1,1,1,1));const i=D/2,A=a/2,B=R/2,w=[];for(let y=0;y<2;y++)w[y]=k({pattern:u,tileWidth:L,tileHeight:j,width:D,height:a,alignVertical:d,alignHorizontal:I,sideOrientation:e});for(let y=2;y<4;y++)w[y]=k({pattern:u,tileWidth:L,tileHeight:j,width:R,height:a,alignVertical:d,alignHorizontal:I,sideOrientation:e});let V=d;d===x.b.BOTTOM?V=x.b.TOP:d===x.b.TOP&&(V=x.b.BOTTOM);for(let y=4;y<6;y++)w[y]=k({pattern:u,tileWidth:L,tileHeight:j,width:D,height:R,alignVertical:V,alignHorizontal:I,sideOrientation:e});let W=[],v=[],Z=[],U=[];const O=[],g=[],P=[],F=[];let l=0,m=0;for(let x=0;x<6;x++){const q=w[x].xa.length;g[x]=[],P[x]=[];for(let X=0;X<q/3;X++)g[x].push(new y.n(w[x].xa[3*X],w[x].xa[3*X+1],w[x].xa[3*X+2])),P[x].push(new y.n(w[x].ya[3*X],w[x].ya[3*X+1],w[x].ya[3*X+2]));l=w[x].Aa.length,F[x]=[];for(let Q=0;Q<l;Q+=2)F[x][Q]=X[x].x+(X[x].z-X[x].x)*w[x].Aa[Q],F[x][Q+1]=X[x].y+(X[x].w-X[x].y)*w[x].Aa[Q+1],b.c&&(F[x][Q+1]=1-F[x][Q+1]);if(Z=Z.concat(F[x]),U=U.concat(w[x].indices.map((q=>q+m))),m+=g[x].length,Q)for(let X=0;X<4;X++)O.push(Q[x].r,Q[x].g,Q[x].b,Q[x].a)}const M=new y.n(0,0,B),o=y.b.RotationY(Math.PI);W=g[0].map((q=>y.n.TransformNormal(q,o).add(M))).map((q=>[q.x,q.y,q.z])).reduce(((q,X)=>q.concat(X)),[]),v=P[0].map((q=>y.n.TransformNormal(q,o))).map((q=>[q.x,q.y,q.z])).reduce(((q,X)=>q.concat(X)),[]),W=W.concat(g[1].map((q=>q.Sc(M))).map((q=>[q.x,q.y,q.z])).reduce(((q,X)=>q.concat(X)),[])),v=v.concat(P[1].map((q=>[q.x,q.y,q.z])).reduce(((q,X)=>q.concat(X)),[]));const Y=new y.n(i,0,0),N=y.b.RotationY(-Math.PI/2);W=W.concat(g[2].map((q=>y.n.TransformNormal(q,N).add(Y))).map((q=>[q.x,q.y,q.z])).reduce(((q,X)=>q.concat(X)),[])),v=v.concat(P[2].map((q=>y.n.TransformNormal(q,N))).map((q=>[q.x,q.y,q.z])).reduce(((q,X)=>q.concat(X)),[]));const S=y.b.RotationY(Math.PI/2);W=W.concat(g[3].map((q=>y.n.TransformNormal(q,S).Sc(Y))).map((q=>[q.x,q.y,q.z])).reduce(((q,X)=>q.concat(X)),[])),v=v.concat(P[3].map((q=>y.n.TransformNormal(q,S))).map((q=>[q.x,q.y,q.z])).reduce(((q,X)=>q.concat(X)),[]));const c=new y.n(0,A,0),p=y.b.RotationX(Math.PI/2);W=W.concat(g[4].map((q=>y.n.TransformNormal(q,p).add(c))).map((q=>[q.x,q.y,q.z])).reduce(((q,X)=>q.concat(X)),[])),v=v.concat(P[4].map((q=>y.n.TransformNormal(q,p))).map((q=>[q.x,q.y,q.z])).reduce(((q,X)=>q.concat(X)),[]));const t=y.b.RotationX(-Math.PI/2);W=W.concat(g[5].map((q=>y.n.TransformNormal(q,t).Sc(c))).map((q=>[q.x,q.y,q.z])).reduce(((q,X)=>q.concat(X)),[])),v=v.concat(P[5].map((q=>y.n.TransformNormal(q,t))).map((q=>[q.x,q.y,q.z])).reduce(((q,X)=>q.concat(X)),[])),H.d._ComputeSides(e,W,U,v,Z);const z=new H.d;if(z.indices=U,z.xa=W,z.ya=v,z.Aa=Z,Q){const q=e===H.d.DOUBLESIDE?O.concat(O):O;z.za=q}return z}function d(q,X){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const y=new x.b(q,Q);X.sideOrientation=x.b._GetDefaultSideOrientation(X.sideOrientation),y._originalBuilderSideOrientation=X.sideOrientation;return I(X).Ca(y,X.updatable),y}H.d.CreateTiledPlane=k;H.d.CreateTiledBox=I;var e=Q(11412),i=Q(1206),A=Q(1497);function B(q){const X=q.height||2;let Q=0===q.diameterTop?0:q.diameterTop||q.diameter||1,u=0===q.diameterBottom?0:q.diameterBottom||q.diameter||1;Q=Q||1e-5,u=u||1e-5;const D=0|(q.Ok||24),a=0|(q.subdivisions||1),R=!!q.hasRings,L=!!q.enclose,k=0===q.cap?0:q.cap||x.b.CAP_ALL,j=q.arc&&(q.arc<=0||q.arc>1)?1:q.arc||1,I=0===q.sideOrientation?0:q.sideOrientation||H.d.DEFAULTSIDE,d=q.faceUV||new Array(3),e=q.faceColors,i=2+(1+(1!==j&&L?2:0))*(R?a:1);let B;for(B=0;B<i;B++)e&&void 0===e[B]&&(e[B]=new f.c(1,1,1,1));for(B=0;B<i;B++)d&&void 0===d[B]&&(d[B]=new y.q(0,0,1,1));const w=[],V=[],W=[],v=[],Z=[],U=2*Math.PI*j/D;let O,g,P;const F=(u-Q)/2/X,l=y.n.Zero(),m=y.n.Zero(),M=y.n.Zero(),o=y.n.Zero(),Y=y.n.Zero(),N=A.c.Y;let S,c,p,t=1,z=1,K=0,h=0;for(S=0;S<=a;S++)for(g=S/a,P=(g*(Q-u)+u)/2,t=R&&0!==S&&S!==a?2:1,p=0;p<t;p++){for(R&&(z+=p),L&&(z+=2*p),c=0;c<=D;c++)O=c*U,l.x=Math.cos(-O)*P,l.y=-X/2+g*X,l.z=Math.sin(-O)*P,0===Q&&S===a?(m.x=W[W.length-3*(D+1)],m.y=W[W.length-3*(D+1)+1],m.z=W[W.length-3*(D+1)+2]):(m.x=l.x,m.z=l.z,m.y=Math.sqrt(m.x*m.x+m.z*m.z)*F,m.normalize()),0===c&&(M.p(l),o.p(m)),V.push(l.x,l.y,l.z),W.push(m.x,m.y,m.z),h=R?K!==z?d[z].y:d[z].w:d[z].y+(d[z].w-d[z].y)*g,v.push(d[z].x+(d[z].z-d[z].x)*c/D,b.c?1-h:h),e&&Z.push(e[z].r,e[z].g,e[z].b,e[z].a);1!==j&&L&&(V.push(l.x,l.y,l.z),V.push(0,l.y,0),V.push(0,l.y,0),V.push(M.x,M.y,M.z),y.n.CrossToRef(N,m,Y),Y.normalize(),W.push(Y.x,Y.y,Y.z,Y.x,Y.y,Y.z),y.n.CrossToRef(o,N,Y),Y.normalize(),W.push(Y.x,Y.y,Y.z,Y.x,Y.y,Y.z),h=R?K!==z?d[z+1].y:d[z+1].w:d[z+1].y+(d[z+1].w-d[z+1].y)*g,v.push(d[z+1].x,b.c?1-h:h),v.push(d[z+1].z,b.c?1-h:h),h=R?K!==z?d[z+2].y:d[z+2].w:d[z+2].y+(d[z+2].w-d[z+2].y)*g,v.push(d[z+2].x,b.c?1-h:h),v.push(d[z+2].z,b.c?1-h:h),e&&(Z.push(e[z+1].r,e[z+1].g,e[z+1].b,e[z+1].a),Z.push(e[z+1].r,e[z+1].g,e[z+1].b,e[z+1].a),Z.push(e[z+2].r,e[z+2].g,e[z+2].b,e[z+2].a),Z.push(e[z+2].r,e[z+2].g,e[z+2].b,e[z+2].a))),K!==z&&(K=z)}const G=1!==j&&L?D+4:D;for(S=0,z=0;z<a;z++){let q=0,X=0,Q=0,y=0;for(c=0;c<D;c++)q=S*(G+1)+c,X=(S+1)*(G+1)+c,Q=S*(G+1)+(c+1),y=(S+1)*(G+1)+(c+1),w.push(q,X,Q),w.push(y,Q,X);1!==j&&L&&(w.push(q+2,X+2,Q+2),w.push(y+2,Q+2,X+2),w.push(q+4,X+4,Q+4),w.push(y+4,Q+4,X+4)),S=R?S+2:S+1}const C=q=>{const x=q?Q/2:u/2;if(0===x)return;let H,a,R;const L=q?d[i-1]:d[0];let f=null;e&&(f=q?e[i-1]:e[0]);const k=V.length/3,I=q?X/2:-X/2,A=new y.n(0,I,0);V.push(A.x,A.y,A.z),W.push(0,q?1:-1,0);const B=L.y+.5*(L.w-L.y);v.push(L.x+.5*(L.z-L.x),b.c?1-B:B),f&&Z.push(f.r,f.g,f.b,f.a);const U=new y.k(.5,.5);for(R=0;R<=D;R++){H=2*Math.PI*R*j/D;const X=Math.cos(-H),Q=Math.sin(-H);a=new y.n(X*x,I,Q*x);const u=new y.k(X*U.x+.5,Q*U.y+.5);V.push(a.x,a.y,a.z),W.push(0,q?1:-1,0);const k=L.y+(L.w-L.y)*u.y;v.push(L.x+(L.z-L.x)*u.x,b.c?1-k:k),f&&Z.push(f.r,f.g,f.b,f.a)}for(R=0;R<D;R++)q?(w.push(k),w.push(k+(R+2)),w.push(k+(R+1))):(w.push(k),w.push(k+(R+1)),w.push(k+(R+2)))};k!==x.b.CAP_START&&k!==x.b.CAP_ALL||C(!1),k!==x.b.CAP_END&&k!==x.b.CAP_ALL||C(!0),H.d._ComputeSides(I,V,w,W,v,q.frontUVs,q.backUVs);const E=new H.d;return E.indices=w,E.xa=V,E.ya=W,E.Aa=v,e&&(E.za=Z),E}function w(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Q=arguments.length>2?arguments[2]:void 0;const y=new x.b(q,Q);X.sideOrientation=x.b._GetDefaultSideOrientation(X.sideOrientation),y._originalBuilderSideOrientation=X.sideOrientation;return B(X).Ca(y,X.updatable),y}function V(q){const X=[],Q=[],x=[],u=[],D=q.diameter||1,a=q.thickness||.5,R=0|(q.Ok||16),L=0===q.sideOrientation?0:q.sideOrientation||H.d.DEFAULTSIDE,f=R+1;for(let H=0;H<=R;H++){const q=H/R,L=H*Math.PI*2/R-Math.PI/2,k=y.b.Translation(D/2,0,0).multiply(y.b.RotationY(L));for(let D=0;D<=R;D++){const L=1-D/R,j=D*Math.PI*2/R+Math.PI,I=Math.cos(j),d=Math.sin(j);let e=new y.n(I,d,0),i=e.scale(a/2);const A=new y.k(q,L);i=y.n.TransformCoordinates(i,k),e=y.n.TransformNormal(e,k),Q.push(i.x,i.y,i.z),x.push(e.x,e.y,e.z),u.push(A.x,b.c?1-A.y:A.y);const B=(H+1)%f,w=(D+1)%f;X.push(H*f+D),X.push(H*f+w),X.push(B*f+D),X.push(H*f+w),X.push(B*f+w),X.push(B*f+D)}}H.d._ComputeSides(L,Q,X,x,u,q.frontUVs,q.backUVs);const k=new H.d;return k.indices=X,k.xa=Q,k.ya=x,k.Aa=u,k}function W(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Q=arguments.length>2?arguments[2]:void 0;const y=new x.b(q,Q);X.sideOrientation=x.b._GetDefaultSideOrientation(X.sideOrientation),y._originalBuilderSideOrientation=X.sideOrientation;return V(X).Ca(y,X.updatable),y}H.d.CreateCylinder=B,x.b.CreateCylinder=(q,X,Q,y,u,H,b,D,a)=>{void 0!==b&&b instanceof i.d||(void 0!==b&&(a=D||x.b.DEFAULTSIDE,D=b),b=H,H=1);return w(q,{height:X,diameterTop:Q,diameterBottom:y,Ok:u,subdivisions:H,sideOrientation:a,updatable:D},b)};function v(q){const X=[],Q=[],x=[],u=[],D=q.i||2,a=q.tube||.5,R=q.radialSegments||32,L=q.tubularSegments||32,f=q.p||2,k=q.q||3,j=0===q.sideOrientation?0:q.sideOrientation||H.d.DEFAULTSIDE,I=q=>{const X=Math.cos(q),Q=Math.sin(q),x=k/f*q,u=Math.cos(x),H=D*(2+u)*.5*X,b=D*(2+u)*Q*.5,a=D*Math.sin(x)*.5;return new y.n(H,b,a)};let d,e;for(d=0;d<=R;d++){const q=d%R/R*2*f*Math.PI,X=I(q),x=I(q+.01),H=x.Sc(X);let D=x.add(X);const k=y.n.Cross(H,D);for(D=y.n.Cross(k,H),k.normalize(),D.normalize(),e=0;e<L;e++){const q=e%L/L*2*Math.PI,y=-a*Math.cos(q),x=a*Math.sin(q);Q.push(X.x+y*D.x+x*k.x),Q.push(X.y+y*D.y+x*k.y),Q.push(X.z+y*D.z+x*k.z),u.push(d/R),u.push(b.c?1-e/L:e/L)}}for(d=0;d<R;d++)for(e=0;e<L;e++){const q=(e+1)%L,Q=d*L+e,y=(d+1)*L+e,x=(d+1)*L+q,u=d*L+q;X.push(u),X.push(y),X.push(Q),X.push(u),X.push(x),X.push(y)}H.d.ComputeNormals(Q,X,x),H.d._ComputeSides(j,Q,X,x,u,q.frontUVs,q.backUVs);const i=new H.d;return i.indices=X,i.xa=Q,i.ya=x,i.Aa=u,i}function Z(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Q=arguments.length>2?arguments[2]:void 0;const y=new x.b(q,Q);X.sideOrientation=x.b._GetDefaultSideOrientation(X.sideOrientation),y._originalBuilderSideOrientation=X.sideOrientation;return v(X).Ca(y,X.updatable),y}H.d.CreateTorus=V,x.b.CreateTorus=(q,X,Q,y,x,u,H)=>W(q,{diameter:X,thickness:Q,Ok:y,sideOrientation:H,updatable:u},x);H.d.CreateTorusKnot=v,x.b.CreateTorusKnot=(q,X,Q,y,x,u,H,b,D,a)=>Z(q,{i:X,tube:Q,radialSegments:y,tubularSegments:x,p:u,q:H,sideOrientation:a,updatable:D},b);var U=Q(12224),O=Q(1099),g=Q(1502),P=Q(1004),F=Q(1028);class l extends y.k{constructor(q,X){super(q.x,q.y),this.index=X}}class m{constructor(){this.elements=[]}add(q){const X=[];return q.forEach((q=>{const Q=new l(q,this.elements.length);X.push(Q),this.elements.push(Q)})),X}computeBounds(){const q=new y.k(this.elements[0].x,this.elements[0].y),X=new y.k(this.elements[0].x,this.elements[0].y);return this.elements.forEach((Q=>{Q.x<q.x?q.x=Q.x:Q.x>X.x&&(X.x=Q.x),Q.y<q.y?q.y=Q.y:Q.y>X.y&&(X.y=Q.y)})),{min:q,max:X,width:X.x-q.x,height:X.y-q.y}}}class M{_addToepoint(q){for(const X of q)this._epoints.push(X.x,X.y)}constructor(q,X,Q){let y,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;this._points=new m,this._outlinepoints=new m,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=x,this._name=q,this._scene=Q||F.c.LastCreatedScene,y=X instanceof g.d?X.getPoints():X,this._addToepoint(y),this._points.add(y),this._outlinepoints.add(y),"undefined"===typeof this.bjsEarcut&&O.b.Warn("Earcut was not found, the polygon will not be built.")}addHole(q){this._points.add(q);const X=new m;return X.add(q),this._holes.push(X),this._eholes.push(this._epoints.length/2),this._addToepoint(q),this}build(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const y=new x.b(this._name,this._scene),H=this.buildVertexData(X,Q);return y.Ga(u.c.PositionKind,H.xa,q),y.Ga(u.c.NormalKind,H.ya,q),y.Ga(u.c.UVKind,H.Aa,q),y.setIndices(H.indices),y}buildVertexData(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const Q=new H.d,y=[],x=[],u=[],b=this._points.computeBounds();this._points.elements.forEach((q=>{y.push(0,1,0),x.push(q.x,0,q.y),u.push((q.x-b.min.x)/b.width,(q.y-b.min.y)/b.height)}));const D=[],a=this.bjsEarcut(this._epoints,this._eholes,2);for(let H=0;H<a.length;H++)D.push(a[H]);if(q>0){const Q=x.length/3;this._points.elements.forEach((X=>{y.push(0,-1,0),x.push(X.x,-q,X.y),u.push(1-(X.x-b.min.x)/b.width,1-(X.y-b.min.y)/b.height)}));const H=D.length;for(let q=0;q<H;q+=3){const X=D[q+0],y=D[q+1],x=D[q+2];D.push(x+Q),D.push(y+Q),D.push(X+Q)}this._addSide(x,y,u,D,b,this._outlinepoints,q,!1,X),this._holes.forEach((Q=>{this._addSide(x,y,u,D,b,Q,q,!0,X)}))}return Q.indices=D,Q.xa=x,Q.ya=y,Q.Aa=u,Q}_addSide(q,X,Q,x,u,H,b,D,a){let R=q.length/3,L=0;for(let f=0;f<H.elements.length;f++){const k=H.elements[f],j=H.elements[(f+1)%H.elements.length];q.push(k.x,0,k.y),q.push(k.x,-b,k.y),q.push(j.x,0,j.y),q.push(j.x,-b,j.y);const I=H.elements[(f+H.elements.length-1)%H.elements.length],d=H.elements[(f+2)%H.elements.length];let e=new y.n(-(j.y-k.y),0,j.x-k.x),i=new y.n(-(k.y-I.y),0,k.x-I.x),A=new y.n(-(d.y-j.y),0,d.x-j.x);D||(e=e.scale(-1),i=i.scale(-1),A=A.scale(-1));const B=e.normalizeToNew();let w=i.normalizeToNew(),V=A.normalizeToNew();const W=y.n.Dot(w,B);w=W>a?W<P.b-1?new y.n(k.x,0,k.y).Sc(new y.n(j.x,0,j.y)).normalize():i.add(e).normalize():B;const v=y.n.Dot(A,e);V=v>a?v<P.b-1?new y.n(j.x,0,j.y).Sc(new y.n(k.x,0,k.y)).normalize():A.add(e).normalize():B,Q.push(L/u.width,0),Q.push(L/u.width,1),L+=e.length(),Q.push(L/u.width,0),Q.push(L/u.width,1),X.push(w.x,w.y,w.z),X.push(w.x,w.y,w.z),X.push(V.x,V.y,V.z),X.push(V.x,V.y,V.z),D?(x.push(R),x.push(R+2),x.push(R+1),x.push(R+1),x.push(R+2),x.push(R+3)):(x.push(R),x.push(R+1),x.push(R+2),x.push(R+1),x.push(R+3),x.push(R+2)),R+=4}}}function o(q,X,Q,x,D,a,R){const L=Q||new Array(3),k=x,j=[],I=R||!1;for(let u=0;u<3;u++)void 0===L[u]&&(L[u]=new y.q(0,0,1,1)),k&&void 0===k[u]&&(k[u]=new f.c(1,1,1,1));const d=q.getVerticesData(u.c.PositionKind),e=q.getVerticesData(u.c.NormalKind),i=q.getVerticesData(u.c.UVKind),A=q.Nd(),B=d.length/9;let w=0,V=0,W=0,v=0,Z=0;const U=[0];if(I)for(let y=B;y<d.length/3;y+=4)V=d[3*(y+2)]-d[3*y],W=d[3*(y+2)+2]-d[3*y+2],v=Math.sqrt(V*V+W*W),Z+=v,U.push(Z);let O=0,g=0;for(let y=0;y<e.length;y+=3)Math.abs(e[y+1])<.001&&(g=1),Math.abs(e[y+1]-1)<.001&&(g=0),Math.abs(e[y+1]+1)<.001&&(g=2),O=y/3,1===g?(w=O-B,i[2*O]=w%4<1.5?I?L[g].x+(L[g].z-L[g].x)*U[Math.floor(w/4)]/Z:L[g].x:I?L[g].x+(L[g].z-L[g].x)*U[Math.floor(w/4)+1]/Z:L[g].z,i[2*O+1]=w%2===0?b.c?1-L[g].w:L[g].w:b.c?1-L[g].y:L[g].y):(i[2*O]=(1-i[2*O])*L[g].x+i[2*O]*L[g].z,i[2*O+1]=(1-i[2*O+1])*L[g].y+i[2*O+1]*L[g].w,b.c&&(i[2*O+1]=1-i[2*O+1])),k&&j.push(k[g].r,k[g].g,k[g].b,k[g].a);H.d._ComputeSides(X,d,A,e,i,D,a);const P=new H.d;if(P.indices=A,P.xa=d,P.ya=e,P.Aa=i,k){const q=X===H.d.DOUBLESIDE?j.concat(j):j;P.za=q}return P}function Y(q,X){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;X.sideOrientation=x.b._GetDefaultSideOrientation(X.sideOrientation);const H=X.shape,b=X.holes||[],D=X.depth||0,a=X.smoothingThreshold||2,R=[];let L=[];for(let x=0;x<H.length;x++)R[x]=new y.k(H[x].x,H[x].z);R[0].equalsWithEpsilon(R[R.length-1],1e-8)&&R.pop();const f=new M(q,R,Q||F.c.LastCreatedScene,u);for(let x=0;x<b.length;x++){L=[];for(let q=0;q<b[x].length;q++)L.push(new y.k(b[x][q].x,b[x][q].z));f.addHole(L)}const k=f.build(!1,D,a);k._originalBuilderSideOrientation=X.sideOrientation;return o(k,X.sideOrientation,X.faceUV,X.faceColors,X.frontUVs,X.backUVs,X.wrap).Ca(k,X.updatable),k}function N(q,X){return Y(q,X,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut)}function S(q,X){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const y=X.path,u=X.shape,H=X.scale||1,b=X.rotation||0,D=0===X.cap?0:X.cap||x.b.NO_CAP,a=X.updatable,R=x.b._GetDefaultSideOrientation(X.sideOrientation),L=X.instance||null,f=X.invertUV||!1,k=X.closeShape||!1;return p(q,u,y,H,b,null,null,X.closePath||!1,k,D,!1,Q,!!a,R,L,f,X.frontUVs||null,X.backUVs||null,X.firstNormal||null,!!X.adjustFrame)}function c(q,X){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const y=X.path,u=X.shape,H=X.scaleFunction||(()=>1),b=X.rotationFunction||(()=>0),D=X.closePath||X.ribbonCloseArray||!1,a=X.closeShape||X.ribbonClosePath||!1,R=0===X.cap?0:X.cap||x.b.NO_CAP,L=X.updatable,f=X.firstNormal||null,k=X.adjustFrame||!1;return p(q,u,y,null,null,H,b,D,a,R,!0,Q,!!L,x.b._GetDefaultSideOrientation(X.sideOrientation),X.instance||null,X.invertUV||!1,X.frontUVs||null,X.backUVs||null,f,k)}function p(q,X,Q,u,H,b,D,R,L,f,k,j,I,d,e,i,A,B,w,V){const W=(q,X,Q,u,H,b,D,a,R,L,f)=>{const k=Q.getTangents(),j=Q.getNormals(),I=Q.getBinormals(),d=Q.getDistances();if(f)for(let x=0;x<k.length;x++)if(0==k[x].x&&0==k[x].y&&0==k[x].z&&k[x].p(k[x-1]),0==j[x].x&&0==j[x].y&&0==j[x].z&&j[x].p(j[x-1]),0==I[x].x&&0==I[x].y&&0==I[x].z&&I[x].p(I[x-1]),x>0){let q=k[x-1];y.n.Dot(q,k[x])<0&&k[x].scaleInPlace(-1),q=j[x-1],y.n.Dot(q,j[x])<0&&j[x].scaleInPlace(-1),q=I[x-1],y.n.Dot(q,I[x])<0&&I[x].scaleInPlace(-1)}let e=0;const i=L&&a?a:()=>null!==b?b:0,A=L&&D?D:()=>null!==H?H:1;let B=R===x.b.NO_CAP||R===x.b.CAP_END?0:2;const w=y.h.Matrix[0];for(let x=0;x<X.length;x++){const Q=[],H=i(x,d[x]),b=A(x,d[x]);y.b.RotationAxisToRef(k[x],e,w);for(let u=0;u<q.length;u++){const H=k[x].scale(q[u].z).add(j[x].scale(q[u].x)).add(I[x].scale(q[u].y)),D=y.n.Zero();y.n.TransformCoordinatesToRef(H,w,D),D.scaleInPlace(b).addInPlace(X[x]),Q[u]=D}u[B]=Q,e+=H,B++}const V=q=>{const X=Array(),Q=y.n.Zero();let x;for(x=0;x<q.length;x++)Q.addInPlace(q[x]);for(Q.scaleInPlace(1/q.length),x=0;x<q.length;x++)X.push(Q);return X};switch(R){case x.b.NO_CAP:break;case x.b.CAP_START:u[0]=V(u[2]),u[1]=u[2];break;case x.b.CAP_END:u[B]=u[B-1],u[B+1]=V(u[B-1]);break;case x.b.CAP_ALL:u[0]=V(u[2]),u[1]=u[2],u[B]=u[B-1],u[B+1]=V(u[B-1])}return u};let v,Z;if(e){const q=e._creationDataStorage;return v=w?q.path3D.update(Q,w):q.path3D.update(Q),Z=W(X,Q,q.path3D,q.pathArray,u,H,b,D,q.cap,k,V),e=a("",{pathArray:Z,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:e},j||void 0)}v=w?new g.e(Q,w):new g.e(Q);Z=W(X,Q,v,new Array,u,H,b,D,f=f<0||f>3?0:f,k,V);const U=a(q,{pathArray:Z,closeArray:R,closePath:L,updatable:I,sideOrientation:d,invertUV:i,frontUVs:A||void 0,backUVs:B||void 0},j);return U._creationDataStorage.pathArray=Z,U._creationDataStorage.path3D=v,U._creationDataStorage.cap=f,U}H.d.CreatePolygon=o,x.b.CreatePolygon=function(q,X,Q,y,x,u){return Y(q,{shape:X,holes:y,updatable:x,sideOrientation:u},Q,arguments.length>6&&void 0!==arguments[6]?arguments[6]:earcut)},x.b.ExtrudePolygon=function(q,X,Q,y,x,u,H){return N(q,{shape:X,holes:x,depth:Q,updatable:u,sideOrientation:H},y,arguments.length>7&&void 0!==arguments[7]?arguments[7]:earcut)};function t(q,X){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const u=X.arc?X.arc<=0||X.arc>1?1:X.arc:1,H=void 0===X.closed||X.closed,b=X.shape,D=X.i||1,R=X.Ok||64,L=X.clip||0,f=X.updatable,k=x.b._GetDefaultSideOrientation(X.sideOrientation),j=X.cap||x.b.NO_CAP,I=2*Math.PI,d=[],e=X.invertUV||!1;let i=0,A=0;const B=I/R*u;let w,V;for(i=0;i<=R-L;i++){for(V=[],j!=x.b.CAP_START&&j!=x.b.CAP_ALL||(V.push(new y.n(0,b[0].y,0)),V.push(new y.n(Math.cos(i*B)*b[0].x*D,b[0].y,Math.sin(i*B)*b[0].x*D))),A=0;A<b.length;A++)w=new y.n(Math.cos(i*B)*b[A].x*D,b[A].y,Math.sin(i*B)*b[A].x*D),V.push(w);j!=x.b.CAP_END&&j!=x.b.CAP_ALL||(V.push(new y.n(Math.cos(i*B)*b[b.length-1].x*D,b[b.length-1].y,Math.sin(i*B)*b[b.length-1].x*D)),V.push(new y.n(0,b[b.length-1].y,0))),d.push(V)}return a(q,{pathArray:d,closeArray:H,sideOrientation:k,updatable:f,invertUV:e,frontUVs:X.frontUVs,backUVs:X.backUVs},Q)}x.b.ExtrudeShape=function(q,X,Q,y,u,H){let b=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,D=arguments.length>7?arguments[7]:void 0,a=arguments.length>8?arguments[8]:void 0,R=arguments.length>9?arguments[9]:void 0;return S(q,{shape:X,path:Q,scale:y,rotation:u,cap:0===H?0:H||x.b.NO_CAP,sideOrientation:a,instance:R,updatable:D},b)},x.b.ExtrudeShapeCustom=(q,X,Q,y,u,H,b,D,a,R,L,f)=>c(q,{shape:X,path:Q,scaleFunction:y,rotationFunction:u,ribbonCloseArray:H,ribbonClosePath:b,cap:0===D?0:D||x.b.NO_CAP,sideOrientation:L,instance:f,updatable:R},a);x.b.CreateLathe=(q,X,Q,y,x,u,H)=>t(q,{shape:X,i:Q,Ok:y,sideOrientation:H,updatable:u},x);var z=Q(11370),K=Q(11315);function h(q,X){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const u=X.path;let H=X.instance,b=1;void 0!==X.i?b=X.i:H&&(b=H._creationDataStorage.i);const D=X.Ok||64,R=X.radiusFunction||null;let L=X.cap||x.b.NO_CAP;const f=X.invertUV||!1,k=X.updatable,j=x.b._GetDefaultSideOrientation(X.sideOrientation);X.arc=X.arc&&(X.arc<=0||X.arc>1)?1:X.arc||1;const I=(q,X,Q,u,H,b,D,a)=>{const R=X.getTangents(),L=X.getNormals(),f=X.getDistances(),k=2*Math.PI/H*a,j=b||(()=>u);let I,d,e,i;const A=y.h.Matrix[0];let B=D===x.b.NO_CAP||D===x.b.CAP_END?0:2;for(let x=0;x<q.length;x++){d=j(x,f[x]),I=Array(),e=L[x];for(let X=0;X<H;X++)y.b.RotationAxisToRef(R[x],k*X,A),i=I[X]?I[X]:y.n.Zero(),y.n.TransformCoordinatesToRef(e,A,i),i.scaleInPlace(d).addInPlace(q[x]),I[X]=i;Q[B]=I,B++}const w=(X,Q)=>{const y=Array();for(let x=0;x<X;x++)y.push(q[Q]);return y};switch(D){case x.b.NO_CAP:break;case x.b.CAP_START:Q[0]=w(H,0),Q[1]=Q[2].slice(0);break;case x.b.CAP_END:Q[B]=Q[B-1].slice(0),Q[B+1]=w(H,q.length-1);break;case x.b.CAP_ALL:Q[0]=w(H,0),Q[1]=Q[2].slice(0),Q[B]=Q[B-1].slice(0),Q[B+1]=w(H,q.length-1)}return Q};let d,e;if(H){const q=H._creationDataStorage,Q=X.arc||q.arc;return d=q.path3D.update(u),e=I(u,d,q.pathArray,b,q.Ok,R,q.cap,Q),H=a("",{pathArray:e,instance:H}),q.path3D=d,q.pathArray=e,q.arc=Q,q.i=b,H}d=new g.e(u);L=L<0||L>3?0:L,e=I(u,d,new Array,b,D,R,L,X.arc);const i=a(q,{pathArray:e,closePath:!0,closeArray:!1,updatable:k,sideOrientation:j,invertUV:f,frontUVs:X.frontUVs,backUVs:X.backUVs},Q);return i._creationDataStorage.pathArray=e,i._creationDataStorage.path3D=d,i._creationDataStorage.Ok=D,i._creationDataStorage.cap=L,i._creationDataStorage.arc=X.arc,i._creationDataStorage.i=b,i}function G(q){const X=[];X[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},X[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},X[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},X[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},X[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},X[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},X[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},X[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},X[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},X[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},X[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},X[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},X[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},X[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},X[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const Q=q.type&&(q.type<0||q.type>=X.length)?0:q.type||0,x=q.size,u=q.sizeX||x||1,D=q.sizeY||x||1,a=q.sizeZ||x||1,R=q.custom||X[Q],L=R.face.length,k=q.faceUV||new Array(L),j=q.faceColors,I=void 0===q.flat||q.flat,d=0===q.sideOrientation?0:q.sideOrientation||H.d.DEFAULTSIDE,e=[],i=[],A=[],B=[],w=[];let V=0,W=0;const v=[];let Z,U,O,g,P,F,l=0,m=0;if(I)for(m=0;m<L;m++)j&&void 0===j[m]&&(j[m]=new f.c(1,1,1,1)),k&&void 0===k[m]&&(k[m]=new y.q(0,0,1,1));if(I)for(m=0;m<L;m++){const q=R.face[m].length;for(O=2*Math.PI/q,g=.5*Math.tan(O/2),P=.5,l=0;l<q;l++)e.push(R.vertex[R.face[m][l]][0]*u,R.vertex[R.face[m][l]][1]*D,R.vertex[R.face[m][l]][2]*a),v.push(V),V++,Z=k[m].x+(k[m].z-k[m].x)*(.5+g),U=k[m].y+(k[m].w-k[m].y)*(P-.5),B.push(Z,b.c?1-U:U),F=g*Math.cos(O)-P*Math.sin(O),P=g*Math.sin(O)+P*Math.cos(O),g=F,j&&w.push(j[m].r,j[m].g,j[m].b,j[m].a);for(l=0;l<q-2;l++)i.push(v[0+W],v[l+2+W],v[l+1+W]);W+=q}else{for(l=0;l<R.vertex.length;l++)e.push(R.vertex[l][0]*u,R.vertex[l][1]*D,R.vertex[l][2]*a),B.push(0,b.c?1:0);for(m=0;m<L;m++)for(l=0;l<R.face[m].length-2;l++)i.push(R.face[m][0],R.face[m][l+2],R.face[m][l+1])}H.d.ComputeNormals(e,i,A),H.d._ComputeSides(d,e,i,A,B,q.frontUVs,q.backUVs);const M=new H.d;return M.xa=e,M.indices=i,M.ya=A,M.Aa=B,j&&I&&(M.za=w),M}function C(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const y=new x.b(q,Q);X.sideOrientation=x.b._GetDefaultSideOrientation(X.sideOrientation),y._originalBuilderSideOrientation=X.sideOrientation;return G(X).Ca(y,X.updatable),y}x.b.CreateTube=(q,X,Q,y,x,u,H,b,D,a)=>h(q,{path:X,i:Q,Ok:y,radiusFunction:x,arc:1,cap:u,updatable:b,sideOrientation:D,instance:a},H);function E(q){const X=q.sideOrientation||H.d.DEFAULTSIDE,Q=q.i||1,x=void 0===q.flat||q.flat,u=0|(q.subdivisions||4),D=q.radiusX||Q,a=q.radiusY||Q,R=q.radiusZ||Q,L=(1+Math.sqrt(5))/2,f=[-1,L,-0,1,L,0,-1,-L,0,1,-L,0,0,-1,-L,0,1,-L,0,-1,L,0,1,L,L,0,1,L,0,-1,-L,0,1,-L,0,-1],k=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],j=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],I=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],d=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],e=[],i=[],A=[],B=[];let w=0;const V=new Array(3),W=new Array(3);let v;for(v=0;v<3;v++)V[v]=y.n.Zero(),W[v]=y.k.Zero();for(let H=0;H<20;H++){for(v=0;v<3;v++){const q=k[3*H+v];V[v].Pd(f[3*j[q]],f[3*j[q]+1],f[3*j[q]+2]),V[v].normalize(),W[v].Pd(.134765625*I[2*q]+.05859375+-.0390625*d[H],.2333984375*I[2*q+1]+.025390625+.01953125*d[H])}const q=(q,X,Q,H)=>{const L=y.n.Lerp(V[0],V[2],X/u),f=y.n.Lerp(V[1],V[2],X/u),k=u===X?V[2]:y.n.Lerp(L,f,q/(u-X));let j;if(k.normalize(),x){const q=y.n.Lerp(V[0],V[2],H/u),X=y.n.Lerp(V[1],V[2],H/u);j=y.n.Lerp(q,X,Q/(u-H))}else j=new y.n(k.x,k.y,k.z);j.x/=D,j.y/=a,j.z/=R,j.normalize();const I=y.k.Lerp(W[0],W[2],X/u),d=y.k.Lerp(W[1],W[2],X/u),v=u===X?W[2]:y.k.Lerp(I,d,q/(u-X));i.push(k.x*D,k.y*a,k.z*R),A.push(j.x,j.y,j.z),B.push(v.x,b.c?1-v.y:v.y),e.push(w),w++};for(let X=0;X<u;X++)for(let Q=0;Q+X<u;Q++)q(Q,X,Q+1/3,X+1/3),q(Q+1,X,Q+1/3,X+1/3),q(Q,X+1,Q+1/3,X+1/3),Q+X+1<u&&(q(Q+1,X,Q+2/3,X+2/3),q(Q+1,X+1,Q+2/3,X+2/3),q(Q,X+1,Q+2/3,X+2/3))}H.d._ComputeSides(X,i,e,A,B,q.frontUVs,q.backUVs);const Z=new H.d;return Z.indices=e,Z.xa=i,Z.ya=A,Z.Aa=B,Z}function J(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const y=new x.b(q,Q);X.sideOrientation=x.b._GetDefaultSideOrientation(X.sideOrientation),y._originalBuilderSideOrientation=X.sideOrientation;return E(X).Ca(y,X.updatable),y}H.d.CreatePolyhedron=G,x.b.CreatePolyhedron=(q,X,Q)=>C(q,X,Q);H.d.CreateIcoSphere=E,x.b.CreateIcoSphere=(q,X,Q)=>J(q,X,Q);var n=Q(1032);const r=new y.n(1,0,0),s=new y.n(-1,0,0),T=new y.n(0,1,0),qq=new y.n(0,-1,0),Xq=new y.n(0,0,1),Qq=new y.n(0,0,-1);class yq{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:y.n.Zero(),X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:y.n.Up(),Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:y.k.Zero(),x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,H=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,b=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,D=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,a=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=q,this.qe=X,this.uv=Q,this.vertexIdx=x,this.vertexIdxForBones=u,this.localPositionOverride=H,this.localNormalOverride=b,this.matrixIndicesOverride=D,this.matrixWeightsOverride=a}clone(){var q,X,Q,y;return new yq(this.position.clone(),this.qe.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(q=this.localPositionOverride)||void 0===q?void 0:q.slice(),null===(X=this.localNormalOverride)||void 0===X?void 0:X.slice(),null===(Q=this.matrixIndicesOverride)||void 0===Q?void 0:Q.slice(),null===(y=this.matrixWeightsOverride)||void 0===y?void 0:y.slice())}}function xq(q,X,Q){var D,a,R,L;const f=!!X.skeleton,k=Q.localMode||f,j=X.Nd(),I=f?X.Ef(!0,!0):X.getVerticesData(u.c.PositionKind),d=f?X.getNormalsData(!0,!0):X.getVerticesData(u.c.NormalKind),e=k?f?X.getVerticesData(u.c.PositionKind):I:null,i=k?f?X.getVerticesData(u.c.NormalKind):d:null,A=X.getVerticesData(u.c.UVKind),B=f?X.getVerticesData(u.c.MatricesIndicesKind):null,w=f?X.getVerticesData(u.c.MatricesWeightsKind):null,V=f?X.getVerticesData(u.c.MatricesIndicesExtraKind):null,W=f?X.getVerticesData(u.c.MatricesWeightsExtraKind):null,v=Q.position||y.n.Zero();let Z=Q.qe||y.n.Up();const U=Q.size||y.n.One(),O=Q.angle||0;if(!Z){const q=new y.n(0,0,1),Q=X.va().activeCamera,x=y.n.TransformCoordinates(q,Q.getWorldMatrix());Z=Q.globalPosition.Sc(x)}const g=-Math.atan2(Z.z,Z.x)-Math.PI/2,P=Math.sqrt(Z.x*Z.x+Z.z*Z.z),F=Math.atan2(Z.y,P),l=new H.d;l.indices=[],l.xa=[],l.ya=[],l.Aa=[],l.matricesIndices=f?[]:null,l.matricesWeights=f?[]:null,l.matricesIndicesExtra=V?[]:null,l.matricesWeightsExtra=W?[]:null;let m=0;const M=(q,X)=>{const x=new yq;if(!j||!I||!d)return x;const u=j[q];if(x.vertexIdx=3*u,x.vertexIdxForBones=4*u,x.position=new y.n(I[3*u],I[3*u+1],I[3*u+2]),y.n.TransformCoordinatesToRef(x.position,X,x.position),x.qe=new y.n(d[3*u],d[3*u+1],d[3*u+2]),y.n.TransformNormalToRef(x.qe,X,x.qe),Q.captureUVS&&A){const q=A[2*u+1];x.uv=new y.k(A[2*u],b.c?1-q:q)}return x},o=[0,0,0,0],Y=(q,X)=>{if(0===q.length)return q;const Q=.5*Math.abs(y.n.Dot(U,X)),x=(q,X,Q,y)=>{for(let x=0;x<y;++x)if(q[Q+x]===X)return Q+x;return-1},u=(q,u)=>{const H=y.n.GetClipFactor(q.position,u.position,X,Q);let b=o,D=o;if(B&&w){const X=q.matrixIndicesOverride?0:q.vertexIdxForBones,Q=q.matrixIndicesOverride??B,y=q.matrixWeightsOverride??w,a=u.matrixIndicesOverride?0:u.vertexIdxForBones,R=u.matrixIndicesOverride??B,L=u.matrixWeightsOverride??w;b=[0,0,0,0],D=[0,0,0,0];let f=0;for(let q=0;q<4;++q)if(y[X+q]>0){const u=x(R,Q[X+q],a,4);b[f]=Q[X+q],D[f]=(0,n.n)(y[X+q],u>=0?L[u]:0,H),f++}for(let q=0;q<4&&f<4;++q){const y=R[a+q];-1===x(Q,y,X,4)&&(b[f]=y,D[f]=(0,n.n)(0,L[a+q],H),f++)}const k=D[0]+D[1]+D[2]+D[3];D[0]/=k,D[1]/=k,D[2]/=k,D[3]/=k}const a=q.localPositionOverride?q.localPositionOverride[0]:(null===e||void 0===e?void 0:e[q.vertexIdx])??0,R=q.localPositionOverride?q.localPositionOverride[1]:(null===e||void 0===e?void 0:e[q.vertexIdx+1])??0,L=q.localPositionOverride?q.localPositionOverride[2]:(null===e||void 0===e?void 0:e[q.vertexIdx+2])??0,f=u.localPositionOverride?u.localPositionOverride[0]:(null===e||void 0===e?void 0:e[u.vertexIdx])??0,k=u.localPositionOverride?u.localPositionOverride[1]:(null===e||void 0===e?void 0:e[u.vertexIdx+1])??0,j=u.localPositionOverride?u.localPositionOverride[2]:(null===e||void 0===e?void 0:e[u.vertexIdx+2])??0,I=q.localNormalOverride?q.localNormalOverride[0]:(null===i||void 0===i?void 0:i[q.vertexIdx])??0,d=q.localNormalOverride?q.localNormalOverride[1]:(null===i||void 0===i?void 0:i[q.vertexIdx+1])??0,A=q.localNormalOverride?q.localNormalOverride[2]:(null===i||void 0===i?void 0:i[q.vertexIdx+2])??0,V=I+((u.localNormalOverride?u.localNormalOverride[0]:(null===i||void 0===i?void 0:i[u.vertexIdx])??0)-I)*H,W=d+((u.localNormalOverride?u.localNormalOverride[1]:(null===i||void 0===i?void 0:i[u.vertexIdx+1])??0)-d)*H,v=A+((u.localNormalOverride?u.localNormalOverride[2]:(null===i||void 0===i?void 0:i[u.vertexIdx+2])??0)-A)*H,Z=Math.sqrt(V*V+W*W+v*v);return new yq(y.n.Lerp(q.position,u.position,H),y.n.Lerp(q.qe,u.qe,H).normalize(),y.k.Lerp(q.uv,u.uv,H),-1,-1,e?[a+(f-a)*H,R+(k-R)*H,L+(j-L)*H]:null,i?[V/Z,W/Z,v/Z]:null,b,D)};let H=null;q.length>3&&(H=[]);for(let b=0;b<q.length;b+=3){let x=0,D=null,a=null,R=null,L=null;const f=y.n.Dot(q[b].position,X)-Q>0,k=y.n.Dot(q[b+1].position,X)-Q>0,j=y.n.Dot(q[b+2].position,X)-Q>0;switch(x=(f?1:0)+(k?1:0)+(j?1:0),x){case 0:q.length>3?(H.push(q[b]),H.push(q[b+1]),H.push(q[b+2])):H=q;break;case 1:if(H=H??new Array,f&&(D=q[b+1],a=q[b+2],R=u(q[b],D),L=u(q[b],a)),k){D=q[b],a=q[b+2],R=u(q[b+1],D),L=u(q[b+1],a),H.push(R),H.push(a.clone()),H.push(D.clone()),H.push(a.clone()),H.push(R.clone()),H.push(L);break}j&&(D=q[b],a=q[b+1],R=u(q[b+2],D),L=u(q[b+2],a)),D&&a&&R&&L&&(H.push(D.clone()),H.push(a.clone()),H.push(R),H.push(L),H.push(R.clone()),H.push(a.clone()));break;case 2:H=H??new Array,f||(D=q[b].clone(),a=u(D,q[b+1]),R=u(D,q[b+2]),H.push(D),H.push(a),H.push(R)),k||(D=q[b+1].clone(),a=u(D,q[b+2]),R=u(D,q[b]),H.push(D),H.push(a),H.push(R)),j||(D=q[b+2].clone(),a=u(D,q[b]),R=u(D,q[b+1]),H.push(D),H.push(a),H.push(R))}}return H},N=X instanceof x.b?X:null,S=null===N||void 0===N?void 0:N._thinInstanceDataStorage.matrixData,c=(null===N||void 0===N?void 0:N.Ij)||1,p=y.h.Matrix[0];p.p(y.b.IdentityReadOnly);for(let x=0;x<c;++x){if(null!==N&&void 0!==N&&N.hasThinInstances&&S){const q=16*x;p.setRowFromFloats(0,S[q+0],S[q+1],S[q+2],S[q+3]),p.setRowFromFloats(1,S[q+4],S[q+5],S[q+6],S[q+7]),p.setRowFromFloats(2,S[q+8],S[q+9],S[q+10],S[q+11]),p.setRowFromFloats(3,S[q+12],S[q+13],S[q+14],S[q+15])}const q=y.b.RotationYawPitchRoll(g,F,O).multiply(y.b.Translation(v.x,v.y,v.z)),u=y.b.Invert(q),H=X.getWorldMatrix(),D=p.multiply(H).multiply(u),a=new Array(3);for(let X=0;X<j.length;X+=3){let q=a;if(q[0]=M(X,D),q[1]=M(X+1,D),q[2]=M(X+2,D),!(Q.cullBackFaces&&-q[0].qe.z<=0&&-q[1].qe.z<=0&&-q[2].qe.z<=0)&&(q=Y(q,r),q&&(q=Y(q,s),q&&(q=Y(q,T),q&&(q=Y(q,qq),q&&(q=Y(q,Xq),q&&(q=Y(q,Qq),q)))))))for(let X=0;X<q.length;X++){const y=q[X];if(l.indices.push(m),k?(y.localPositionOverride?(l.xa[3*m]=y.localPositionOverride[0],l.xa[3*m+1]=y.localPositionOverride[1],l.xa[3*m+2]=y.localPositionOverride[2]):e&&(l.xa[3*m]=e[y.vertexIdx],l.xa[3*m+1]=e[y.vertexIdx+1],l.xa[3*m+2]=e[y.vertexIdx+2]),y.localNormalOverride?(l.ya[3*m]=y.localNormalOverride[0],l.ya[3*m+1]=y.localNormalOverride[1],l.ya[3*m+2]=y.localNormalOverride[2]):i&&(l.ya[3*m]=i[y.vertexIdx],l.ya[3*m+1]=i[y.vertexIdx+1],l.ya[3*m+2]=i[y.vertexIdx+2])):(y.position.toArray(l.xa,3*m),y.qe.toArray(l.ya,3*m)),l.matricesIndices&&l.matricesWeights&&(y.matrixIndicesOverride?(l.matricesIndices[4*m]=y.matrixIndicesOverride[0],l.matricesIndices[4*m+1]=y.matrixIndicesOverride[1],l.matricesIndices[4*m+2]=y.matrixIndicesOverride[2],l.matricesIndices[4*m+3]=y.matrixIndicesOverride[3]):(B&&(l.matricesIndices[4*m]=B[y.vertexIdxForBones],l.matricesIndices[4*m+1]=B[y.vertexIdxForBones+1],l.matricesIndices[4*m+2]=B[y.vertexIdxForBones+2],l.matricesIndices[4*m+3]=B[y.vertexIdxForBones+3]),V&&l.matricesIndicesExtra&&(l.matricesIndicesExtra[4*m]=V[y.vertexIdxForBones],l.matricesIndicesExtra[4*m+1]=V[y.vertexIdxForBones+1],l.matricesIndicesExtra[4*m+2]=V[y.vertexIdxForBones+2],l.matricesIndicesExtra[4*m+3]=V[y.vertexIdxForBones+3])),y.matrixWeightsOverride?(l.matricesWeights[4*m]=y.matrixWeightsOverride[0],l.matricesWeights[4*m+1]=y.matrixWeightsOverride[1],l.matricesWeights[4*m+2]=y.matrixWeightsOverride[2],l.matricesWeights[4*m+3]=y.matrixWeightsOverride[3]):(w&&(l.matricesWeights[4*m]=w[y.vertexIdxForBones],l.matricesWeights[4*m+1]=w[y.vertexIdxForBones+1],l.matricesWeights[4*m+2]=w[y.vertexIdxForBones+2],l.matricesWeights[4*m+3]=w[y.vertexIdxForBones+3]),W&&l.matricesWeightsExtra&&(l.matricesWeightsExtra[4*m]=W[y.vertexIdxForBones],l.matricesWeightsExtra[4*m+1]=W[y.vertexIdxForBones+1],l.matricesWeightsExtra[4*m+2]=W[y.vertexIdxForBones+2],l.matricesWeightsExtra[4*m+3]=W[y.vertexIdxForBones+3]))),Q.captureUVS)y.uv.toArray(l.Aa,2*m);else{l.Aa.push(.5+y.position.x/U.x);const q=.5+y.position.y/U.y;l.Aa.push(b.c?1-q:q)}m++}}}0===l.indices.length&&(l.indices=null),0===l.xa.length&&(l.xa=null),0===l.ya.length&&(l.ya=null),0===l.Aa.length&&(l.Aa=null),0===(null===(D=l.matricesIndices)||void 0===D?void 0:D.length)&&(l.matricesIndices=null),0===(null===(a=l.matricesWeights)||void 0===a?void 0:a.length)&&(l.matricesWeights=null),0===(null===(R=l.matricesIndicesExtra)||void 0===R?void 0:R.length)&&(l.matricesIndicesExtra=null),0===(null===(L=l.matricesWeightsExtra)||void 0===L?void 0:L.length)&&(l.matricesWeightsExtra=null);const t=new x.b(q,X.va());return l.Ca(t),k?(t.skeleton=X.skeleton,t.parent=X):(t.position=v.clone(),t.rotation=new y.n(F,g,O)),t.le(!0),t.refreshBoundingInfo(!0,!0),t}function uq(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,Ok:16,height:1,i:.25,capSubdivisions:6};const X=0|Math.max(q.subdivisions?q.subdivisions:2,1),Q=0|Math.max(q.Ok?q.Ok:16,3),x=Math.max(q.height?q.height:1,0),u=Math.max(q.i?q.i:.25,0),D=0|Math.max(q.capSubdivisions?q.capSubdivisions:6,1),a=Q,R=X,L=Math.max(q.radiusTop?q.radiusTop:u,0),f=Math.max(q.radiusBottom?q.radiusBottom:u,0),k=x-(L+f),j=2*Math.PI,I=Math.max(q.topCapSubdivisions?q.topCapSubdivisions:D,1),d=Math.max(q.bottomCapSubdivisions?q.bottomCapSubdivisions:D,1),e=Math.acos((f-L)/x);let i=[];const A=[],B=[],w=[];let V=0;const W=[],v=.5*k,Z=.5*Math.PI;let U,O;const g=y.n.Zero(),P=y.n.Zero(),F=Math.cos(e),l=Math.sin(e),m=new y.k(L*l,v+L*F).Sc(new y.k(f*l,f*F-v)).length(),M=L*e+m+f*(Z-e);let o=0;for(O=0;O<=I;O++){const q=[],X=Z-e*(O/I);o+=L*e/I;const Q=Math.cos(X),y=Math.sin(X),x=Q*L;for(U=0;U<=a;U++){const X=U/a,u=X*j+0,H=Math.sin(u),D=Math.cos(u);P.x=x*H,P.y=v+y*L,P.z=x*D,A.push(P.x,P.y,P.z),g.set(Q*H,y,Q*D),B.push(g.x,g.y,g.z),w.push(X,b.c?o/M:1-o/M),q.push(V),V++}W.push(q)}const Y=x-L-f+F*L-F*f,N=l*(f-L)/Y;for(O=1;O<=R;O++){const q=[];o+=m/R;const X=l*(O*(f-L)/R+L);for(U=0;U<=a;U++){const Q=U/a,y=Q*j+0,x=Math.sin(y),u=Math.cos(y);P.x=X*x,P.y=v+F*L-O*Y/R,P.z=X*u,A.push(P.x,P.y,P.z),g.set(x,N,u).normalize(),B.push(g.x,g.y,g.z),w.push(Q,b.c?o/M:1-o/M),q.push(V),V++}W.push(q)}for(O=1;O<=d;O++){const q=[],X=Z-e-(Math.PI-e)*(O/d);o+=f*e/d;const Q=Math.cos(X),y=Math.sin(X),x=Q*f;for(U=0;U<=a;U++){const X=U/a,u=X*j+0,H=Math.sin(u),D=Math.cos(u);P.x=x*H,P.y=y*f-v,P.z=x*D,A.push(P.x,P.y,P.z),g.set(Q*H,y,Q*D),B.push(g.x,g.y,g.z),w.push(X,b.c?o/M:1-o/M),q.push(V),V++}W.push(q)}for(U=0;U<a;U++)for(O=0;O<I+R+d;O++){const q=W[O][U],X=W[O+1][U],Q=W[O+1][U+1],y=W[O][U+1];i.push(q),i.push(X),i.push(y),i.push(X),i.push(Q),i.push(y)}if(i=i.reverse(),q.orientation&&!q.orientation.equals(y.n.Up())){const X=new y.b;q.orientation.clone().scale(.5*Math.PI).cross(y.n.Up()).toQuaternion().toRotationMatrix(X);const Q=y.n.Zero();for(let q=0;q<A.length;q+=3)Q.set(A[q],A[q+1],A[q+2]),y.n.TransformCoordinatesToRef(Q.clone(),X,Q),A[q]=Q.x,A[q+1]=Q.y,A[q+2]=Q.z}const S=new H.d;return S.xa=A,S.ya=B,S.Aa=w,S.indices=i,S}function Hq(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:y.n.Up(),subdivisions:2,Ok:16,height:1,i:.25,capSubdivisions:6,updatable:!1},Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const u=new x.b(q,Q);return uq(X).Ca(u,X.updatable),u}x.b.CreateDecal=(q,X,Q,y,x,u)=>xq(q,X,{position:Q,qe:y,size:x,angle:u});x.b.CreateCapsule=(q,X,Q)=>Hq(q,X,Q),H.d.CreateCapsule=uq;class bq{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=q,this.y=X,q!==Math.floor(q)&&(q=Math.floor(q),O.b.Warn("x is not an integer, floor(x) used")),X!==Math.floor(X)&&(X=Math.floor(X),O.b.Warn("y is not an integer, floor(y) used"))}clone(){return new bq(this.x,this.y)}rotate60About(q){const X=this.x;return this.x=q.x+q.y-this.y,this.y=X+this.y-q.x,this}rotateNeg60About(q){const X=this.x;return this.x=X+this.y-q.y,this.y=q.x+q.y-X,this}rotate120(q,X){q!==Math.floor(q)&&(q=Math.floor(q),O.b.Warn("m not an integer only floor(m) used")),X!==Math.floor(X)&&(X=Math.floor(X),O.b.Warn("n not an integer only floor(n) used"));const Q=this.x;return this.x=q-Q-this.y,this.y=X+Q,this}rotateNeg120(q,X){q!==Math.floor(q)&&(q=Math.floor(q),O.b.Warn("m is not an integer, floor(m) used")),X!==Math.floor(X)&&(X=Math.floor(X),O.b.Warn("n is not an integer,   floor(n) used"));const Q=this.x;return this.x=this.y-X,this.y=q+X-Q-this.y,this}toCartesianOrigin(q,X){const Q=y.n.Zero();return Q.x=q.x+2*this.x*X+this.y*X,Q.y=q.y+Math.sqrt(3)*this.y*X,Q}static Zero(){return new bq(0,0)}}class Dq{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new aq("icosahedron","Regular",[[0,P.d,-1],[-P.d,1,0],[-1,0,-P.d],[1,0,-P.d],[P.d,1,0],[0,P.d,1],[-1,0,P.d],[-P.d,-1,0],[0,-P.d,-1],[P.d,-1,0],[1,0,P.d],[0,-P.d,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let q=12;const X={},Q=this.m,y=this.n;let x,u,H,b,D,a=Q,R=1,L=0;0!==y&&(a=(0,n.i)(Q,y)),R=Q/a,L=y/a;const f=bq.Zero(),k=new bq(Q,y),j=new bq(-y,Q+y),I=bq.Zero(),d=bq.Zero(),e=bq.Zero();let i,A,B,w,V=[];const W=[],v=this.vertByDist,Z=(Q,y,x,u)=>{i=Q+"|"+x,A=y+"|"+u,i in X||A in X?i in X&&!(A in X)?X[A]=X[i]:A in X&&!(i in X)&&(X[i]=X[A]):(X[i]=q,X[A]=q,q++),v[x][0]>2?W[X[i]]=[-v[x][0],v[x][1],X[i]]:W[X[i]]=[V[v[x][0]],v[x][1],X[i]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let U=0;U<20;U++){if(V=this.IDATA.face[U],H=V[2],b=V[1],D=V[0],B=f.x+"|"+f.y,i=U+"|"+B,i in X||(X[i]=H,W[H]=[V[v[B][0]],v[B][1]]),B=k.x+"|"+k.y,i=U+"|"+B,i in X||(X[i]=b,W[b]=[V[v[B][0]],v[B][1]]),B=j.x+"|"+j.y,i=U+"|"+B,i in X||(X[i]=D,W[D]=[V[v[B][0]],v[B][1]]),x=this.IDATA.edgematch[U][0],u=this.IDATA.edgematch[U][1],"B"===u)for(let q=1;q<a;q++)d.x=Q-q*(R+L),d.y=y+q*R,e.x=-q*L,e.y=q*(R+L),B=d.x+"|"+d.y,w=e.x+"|"+e.y,Z(U,x,B,w);if("O"===u)for(let q=1;q<a;q++)e.x=-q*L,e.y=q*(R+L),I.x=q*R,I.y=q*L,B=e.x+"|"+e.y,w=I.x+"|"+I.y,Z(U,x,B,w);if(x=this.IDATA.edgematch[U][2],u=this.IDATA.edgematch[U][3],u&&"A"===u)for(let q=1;q<a;q++)I.x=q*R,I.y=q*L,d.x=Q-(a-q)*(R+L),d.y=y+(a-q)*R,B=I.x+"|"+I.y,w=d.x+"|"+d.y,Z(U,x,B,w);for(let Q=0;Q<this.vertices.length;Q++)B=this.vertices[Q].x+"|"+this.vertices[Q].y,i=U+"|"+B,i in X||(X[i]=q++,v[B][0]>2?W[X[i]]=[-v[B][0],v[B][1],X[i]]:W[X[i]]=[V[v[B][0]],v[B][1],X[i]])}this.closestTo=W,this.vecToidx=X}calcCoeffs(){const q=this.m,X=this.n,Q=Math.sqrt(3)/3,y=q*q+X*X+q*X;this.coau=(q+X)/y,this.cobu=-X/y,this.coav=-Q*(q-X)/y,this.cobv=Q*(2*q+X)/y}createInnerFacets(){const q=this.m,X=this.n;for(let Q=0;Q<X+q+1;Q++)for(let q=this.min[Q];q<this.max[Q]+1;q++)q<this.max[Q]&&q<this.max[Q+1]+1&&this.innerFacets.push(["|"+q+"|"+Q,"|"+q+"|"+(Q+1),"|"+(q+1)+"|"+Q]),Q>0&&q<this.max[Q-1]&&q+1<this.max[Q]+1&&this.innerFacets.push(["|"+q+"|"+Q,"|"+(q+1)+"|"+Q,"|"+(q+1)+"|"+(Q-1)])}edgeVecsABOB(){const q=this.m,X=this.n,Q=new bq(-X,q+X);for(let y=1;y<q+X;y++){const q=new bq(this.min[y],y),X=new bq(this.min[y-1],y-1),x=new bq(this.min[y+1],y+1),u=q.clone(),H=X.clone(),b=x.clone();u.rotate60About(Q),H.rotate60About(Q),b.rotate60About(Q);const D=new bq(this.max[u.y],u.y),a=new bq(this.max[u.y-1],u.y-1),R=new bq(this.max[u.y-1]-1,u.y-1);u.x===D.x&&u.y===D.y||(u.x!==a.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([q,a,R]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([q,R,D])):u.y===b.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([q,X,a]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([q,a,x])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([q,X,a]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([q,a,D])))}}mapABOBtoOBOA(){const q=new bq(0,0);for(let X=0;X<this.isoVecsABOB.length;X++){const Q=[];for(let y=0;y<3;y++)q.x=this.isoVecsABOB[X][y].x,q.y=this.isoVecsABOB[X][y].y,0===this.vertexTypes[X][y]&&q.rotateNeg120(this.m,this.n),Q.push(q.clone());this.isoVecsOBOA.push(Q)}}mapABOBtoBAOA(){const q=new bq(0,0);for(let X=0;X<this.isoVecsABOB.length;X++){const Q=[];for(let y=0;y<3;y++)q.x=this.isoVecsABOB[X][y].x,q.y=this.isoVecsABOB[X][y].y,1===this.vertexTypes[X][y]&&q.rotate120(this.m,this.n),Q.push(q.clone());this.isoVecsBAOA.push(Q)}}MapToFace(q,X){const Q=this.IDATA.face[q],x=Q[2],u=Q[1],H=Q[0],b=y.n.Rd(this.IDATA.vertex[x]),D=y.n.Rd(this.IDATA.vertex[u]),a=y.n.Rd(this.IDATA.vertex[H]),R=D.Sc(b),L=a.Sc(b),f=R.scale(this.coau).add(L.scale(this.cobu)),k=R.scale(this.coav).add(L.scale(this.cobv)),j=[];let I,d=y.h.Od[0];for(let y=0;y<this.cartesian.length;y++)d=f.scale(this.cartesian[y].x).add(k.scale(this.cartesian[y].y)).add(b),j[y]=[d.x,d.y,d.z],I=q+"|"+this.vertices[y].x+"|"+this.vertices[y].y,X.vertex[this.vecToidx[I]]=[d.x,d.y,d.z]}build(q,X){const Q=[],y=bq.Zero(),x=new bq(q,X),u=new bq(-X,q+X);Q.push(y,x,u);for(let B=X;B<q+1;B++)for(let X=0;X<q+1-B;X++)Q.push(new bq(X,B));if(X>0){const y=(0,n.i)(q,X),x=q/y,u=X/y;for(let b=1;b<y;b++)Q.push(new bq(b*x,b*u)),Q.push(new bq(-b*u,b*(x+u))),Q.push(new bq(q-b*(x+u),X+b*x));const H=q/X;for(let b=1;b<X;b++)for(let y=0;y<b*H;y++)Q.push(new bq(y,b)),Q.push(new bq(y,b).rotate120(q,X)),Q.push(new bq(y,b).rotateNeg120(q,X))}Q.sort(((q,X)=>q.x-X.x)),Q.sort(((q,X)=>q.y-X.y));const H=new Array(q+X+1),b=new Array(q+X+1);for(let B=0;B<H.length;B++)H[B]=1/0,b[B]=-1/0;let D=0,a=0;const R=Q.length;for(let B=0;B<R;B++)a=Q[B].x,D=Q[B].y,H[D]=Math.min(a,H[D]),b[D]=Math.max(a,b[D]);const L=(Q,y)=>{const x=Q.clone();return"A"===y&&x.rotateNeg120(q,X),"B"===y&&x.rotate120(q,X),x.x<0?x.y:x.x+x.y},f=[],k=[],j=[],I=[],d={},e=[];let i=-1,A=-1;for(let B=0;B<R;B++)f[B]=Q[B].toCartesianOrigin(new bq(0,0),.5),k[B]=L(Q[B],"O"),j[B]=L(Q[B],"A"),I[B]=L(Q[B],"B"),k[B]===j[B]&&j[B]===I[B]?(i=3,A=k[B]):k[B]===j[B]?(i=4,A=k[B]):j[B]===I[B]?(i=5,A=j[B]):I[B]===k[B]&&(i=6,A=k[B]),k[B]<j[B]&&k[B]<I[B]&&(i=2,A=k[B]),j[B]<k[B]&&j[B]<I[B]&&(i=1,A=j[B]),I[B]<j[B]&&I[B]<k[B]&&(i=0,A=I[B]),e.push([i,A,Q[B].x,Q[B].y]);e.sort(((q,X)=>q[2]-X[2])),e.sort(((q,X)=>q[3]-X[3])),e.sort(((q,X)=>q[1]-X[1])),e.sort(((q,X)=>q[0]-X[0]));for(let B=0;B<e.length;B++)d[e[B][2]+"|"+e[B][3]]=[e[B][0],e[B][1],B];return this.m=q,this.n=X,this.vertices=Q,this.vertByDist=d,this.cartesian=f,this.min=H,this.max=b,this}}class aq{constructor(q,X,Q,y){this.name=q,this.category=X,this.vertex=Q,this.face=y}}class Rq extends aq{innerToData(q,X){for(let Q=0;Q<X.innerFacets.length;Q++)this.face.push(X.innerFacets[Q].map((Q=>X.vecToidx[q+Q])))}mapABOBtoDATA(q,X){const Q=X.IDATA.edgematch[q][0];for(let y=0;y<X.isoVecsABOB.length;y++){const x=[];for(let u=0;u<3;u++)0===X.vertexTypes[y][u]?x.push(q+"|"+X.isoVecsABOB[y][u].x+"|"+X.isoVecsABOB[y][u].y):x.push(Q+"|"+X.isoVecsABOB[y][u].x+"|"+X.isoVecsABOB[y][u].y);this.face.push([X.vecToidx[x[0]],X.vecToidx[x[1]],X.vecToidx[x[2]]])}}mapOBOAtoDATA(q,X){const Q=X.IDATA.edgematch[q][0];for(let y=0;y<X.isoVecsOBOA.length;y++){const x=[];for(let u=0;u<3;u++)1===X.vertexTypes[y][u]?x.push(q+"|"+X.isoVecsOBOA[y][u].x+"|"+X.isoVecsOBOA[y][u].y):x.push(Q+"|"+X.isoVecsOBOA[y][u].x+"|"+X.isoVecsOBOA[y][u].y);this.face.push([X.vecToidx[x[0]],X.vecToidx[x[1]],X.vecToidx[x[2]]])}}mapBAOAtoDATA(q,X){const Q=X.IDATA.edgematch[q][2];for(let y=0;y<X.isoVecsBAOA.length;y++){const x=[];for(let u=0;u<3;u++)1===X.vertexTypes[y][u]?x.push(q+"|"+X.isoVecsBAOA[y][u].x+"|"+X.isoVecsBAOA[y][u].y):x.push(Q+"|"+X.isoVecsBAOA[y][u].x+"|"+X.isoVecsBAOA[y][u].y);this.face.push([X.vecToidx[x[0]],X.vecToidx[x[1]],X.vecToidx[x[2]]])}}orderData(q){const X=[];for(let u=0;u<13;u++)X[u]=[];const Q=q.closestTo;for(let u=0;u<Q.length;u++)Q[u][0]>-1?Q[u][1]>0&&X[Q[u][0]].push([u,Q[u][1]]):X[12].push([u,Q[u][0]]);const y=[];for(let u=0;u<12;u++)y[u]=u;let x=12;for(let u=0;u<12;u++){X[u].sort(((q,X)=>q[1]-X[1]));for(let q=0;q<X[u].length;q++)y[X[u][q][0]]=x++}for(let u=0;u<X[12].length;u++)y[X[12][u][0]]=x++;for(let u=0;u<this.vertex.length;u++)this.vertex[u].push(y[u]);this.vertex.sort(((q,X)=>q[3]-X[3]));for(let u=0;u<this.vertex.length;u++)this.vertex[u].pop();for(let u=0;u<this.face.length;u++)for(let q=0;q<this.face[u].length;q++)this.face[u][q]=y[this.face[u][q]];this.sharedNodes=X[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(q,X){const Q=[],y=[];let x=X.pop();y.push(x);let u=this.face[x].indexOf(q);u=(u+2)%3;let H=this.face[x][u];Q.push(H);let b=0;for(;X.length>0;)x=X[b],this.face[x].indexOf(H)>-1?(u=(this.face[x].indexOf(H)+1)%3,H=this.face[x][u],Q.push(H),y.push(x),X.splice(b,1),b=0):b++;return this.adjacentFaces.push(Q),y}toGoldbergPolyhedronData(){const q=new aq("GeoDual","Goldberg",[],[]);q.name="GD dual";const X=this.vertex.length,Q=new Array(X);for(let D=0;D<X;D++)Q[D]=[];for(let D=0;D<this.face.length;D++)for(let q=0;q<3;q++)Q[this.face[D][q]].push(D);let y=0,x=0,u=0,H=[],b=[];this.adjacentFaces=[];for(let D=0;D<Q.length;D++)q.face[D]=this.setOrder(D,Q[D].concat([])),Q[D].forEach((X=>{y=0,x=0,u=0,H=this.face[X];for(let q=0;q<3;q++)b=this.vertex[H[q]],y+=b[0],x+=b[1],u+=b[2];q.vertex[X]=[y/3,x/3,u/3]}));return q}static BuildGeodesicData(q){const X=new Rq("Geodesic-m-n","Geodesic",[[0,P.d,-1],[-P.d,1,0],[-1,0,-P.d],[1,0,-P.d],[P.d,1,0],[0,P.d,1],[-1,0,P.d],[-P.d,-1,0],[0,-P.d,-1],[P.d,-1,0],[1,0,P.d],[0,-P.d,1]],[]);q.setIndices(),q.calcCoeffs(),q.createInnerFacets(),q.edgeVecsABOB(),q.mapABOBtoOBOA(),q.mapABOBtoBAOA();for(let Q=0;Q<q.IDATA.face.length;Q++)q.MapToFace(Q,X),X.innerToData(Q,q),"B"===q.IDATA.edgematch[Q][1]&&X.mapABOBtoDATA(Q,q),"O"===q.IDATA.edgematch[Q][1]&&X.mapOBOAtoDATA(Q,q),"A"===q.IDATA.edgematch[Q][3]&&X.mapBAOAtoDATA(Q,q);X.orderData(q);return X.vertex=X.vertex.map((function(q){const X=q[0],Q=q[1],y=q[2],x=Math.sqrt(X*X+Q*Q+y*y);return q[0]*=1/x,q[1]*=1/x,q[2]*=1/x,q})),X}}x.b._GoldbergMeshParser=(q,X)=>Lq.Parse(q,X);class Lq extends x.b{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(q,X){return void 0===X?(q>this.goldbergData.nbUnsharedFaces-1&&(O.b.Warn("Maximum number of unshared faces used"),q=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+q):(q>11&&(O.b.Warn("Last pole used"),q=11),X>this.goldbergData.nbFacesAtPole-1&&(O.b.Warn("Maximum number of faces at a pole used"),X=this.goldbergData.nbFacesAtPole-1),12+q*this.goldbergData.nbFacesAtPole+X)}_changeGoldbergFaceColors(q){for(let Q=0;Q<q.length;Q++){const X=q[Q][0],y=q[Q][1],x=q[Q][2];for(let q=X;q<y+1;q++)this.goldbergData.faceColors[q]=x}const X=[];for(let Q=0;Q<12;Q++)for(let q=0;q<5;q++)X.push(this.goldbergData.faceColors[Q].r,this.goldbergData.faceColors[Q].g,this.goldbergData.faceColors[Q].b,this.goldbergData.faceColors[Q].a);for(let Q=12;Q<this.goldbergData.faceColors.length;Q++)for(let q=0;q<6;q++)X.push(this.goldbergData.faceColors[Q].r,this.goldbergData.faceColors[Q].g,this.goldbergData.faceColors[Q].b,this.goldbergData.faceColors[Q].a);return X}setGoldbergFaceColors(q){const X=this._changeGoldbergFaceColors(q);this.Ga(u.c.ColorKind,X)}updateGoldbergFaceColors(q){const X=this._changeGoldbergFaceColors(q);this.updateVerticesData(u.c.ColorKind,X)}_changeGoldbergFaceUVs(q){const X=this.getVerticesData(u.c.UVKind);for(let Q=0;Q<q.length;Q++){const y=q[Q][0],x=q[Q][1],u=q[Q][2],H=q[Q][3],b=q[Q][4],D=[],a=[];let R,L;for(let q=0;q<5;q++)R=u.x+H*Math.cos(b+q*Math.PI/2.5),L=u.y+H*Math.sin(b+q*Math.PI/2.5),R<0&&(R=0),R>1&&(R=1),D.push(R,L);for(let q=0;q<6;q++)R=u.x+H*Math.cos(b+q*Math.PI/3),L=u.y+H*Math.sin(b+q*Math.PI/3),R<0&&(R=0),R>1&&(R=1),a.push(R,L);for(let q=y;q<Math.min(12,x+1);q++)for(let Q=0;Q<5;Q++)X[10*q+2*Q]=D[2*Q],X[10*q+2*Q+1]=D[2*Q+1];for(let q=Math.max(12,y);q<x+1;q++)for(let Q=0;Q<6;Q++)X[12*q-24+2*Q]=a[2*Q],X[12*q-23+2*Q]=a[2*Q+1]}return X}setGoldbergFaceUVs(q){const X=this._changeGoldbergFaceUVs(q);this.Ga(u.c.UVKind,X)}updateGoldbergFaceUVs(q){const X=this._changeGoldbergFaceUVs(q);this.updateVerticesData(u.c.UVKind,X)}placeOnGoldbergFaceAt(q,X,Q){const x=y.n.RotationFromAxis(this.goldbergData.faceXaxis[X],this.goldbergData.faceYaxis[X],this.goldbergData.faceZaxis[X]);q.rotation=x,q.position=this.goldbergData.faceCenters[X].add(this.goldbergData.faceXaxis[X].scale(Q.x)).add(this.goldbergData.faceYaxis[X].scale(Q.y)).add(this.goldbergData.faceZaxis[X].scale(Q.z))}serialize(q){super.serialize(q),q.type="GoldbergMesh";const X={};if(X.adjacentFaces=this.goldbergData.adjacentFaces,X.nbSharedFaces=this.goldbergData.nbSharedFaces,X.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,X.nbFaces=this.goldbergData.nbFaces,X.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){X.faceColors=[];for(const q of this.goldbergData.faceColors)X.faceColors.push(q.ee())}if(this.goldbergData.faceCenters){X.faceCenters=[];for(const q of this.goldbergData.faceCenters)X.faceCenters.push(q.ee())}if(this.goldbergData.faceZaxis){X.faceZaxis=[];for(const q of this.goldbergData.faceZaxis)X.faceZaxis.push(q.ee())}if(this.goldbergData.faceYaxis){X.faceYaxis=[];for(const q of this.goldbergData.faceYaxis)X.faceYaxis.push(q.ee())}if(this.goldbergData.faceXaxis){X.faceXaxis=[];for(const q of this.goldbergData.faceXaxis)X.faceXaxis.push(q.ee())}q.goldbergData=X}static Parse(q,X){const Q=q.goldbergData;Q.faceColors=Q.faceColors.map((q=>f.c.Rd(q))),Q.faceCenters=Q.faceCenters.map((q=>y.n.Rd(q))),Q.faceZaxis=Q.faceZaxis.map((q=>y.n.Rd(q))),Q.faceXaxis=Q.faceXaxis.map((q=>y.n.Rd(q))),Q.faceYaxis=Q.faceYaxis.map((q=>y.n.Rd(q)));const x=new Lq(q.name,X);return x.goldbergData=Q,x}}var fq=Q(11298);class kq{constructor(q){this._paths=[],this._tempPaths=[],this._holes=[],this._resolution=q}moveTo(q,X){this._currentPath=new g.d(q,X),this._tempPaths.push(this._currentPath)}lineTo(q,X){this._currentPath.addLineTo(q,X)}quadraticCurveTo(q,X,Q,y){this._currentPath.addQuadraticCurveTo(q,X,Q,y,this._resolution)}bezierCurveTo(q,X,Q,y,x,u){this._currentPath.addBezierCurveTo(q,X,Q,y,x,u,this._resolution)}extractHoles(){for(const q of this._tempPaths)q.area()>0?this._holes.push(q):this._paths.push(q);if(!this._paths.length&&this._holes.length){const q=this._holes;this._holes=this._paths,this._paths=q}this._tempPaths.length=0}get paths(){return this._paths}get holes(){return this._holes}}function jq(q,X,Q,y,x,u){const H=u.glyphs[q]||u.glyphs["?"];if(!H)return null;const b=new kq(x);if(H.o){const q=H.o.split(" ");for(let x=0,u=q.length;x<u;){switch(q[x++]){case"m":{const u=parseInt(q[x++])*X+Q,H=parseInt(q[x++])*X+y;b.moveTo(u,H);break}case"l":{const u=parseInt(q[x++])*X+Q,H=parseInt(q[x++])*X+y;b.lineTo(u,H);break}case"q":{const u=parseInt(q[x++])*X+Q,H=parseInt(q[x++])*X+y,D=parseInt(q[x++])*X+Q,a=parseInt(q[x++])*X+y;b.quadraticCurveTo(D,a,u,H);break}case"b":{const u=parseInt(q[x++])*X+Q,H=parseInt(q[x++])*X+y,D=parseInt(q[x++])*X+Q,a=parseInt(q[x++])*X+y,R=parseInt(q[x++])*X+Q,L=parseInt(q[x++])*X+y;b.bezierCurveTo(D,a,R,L,u,H);break}}}}return b.extractHoles(),{offsetX:H.ha*X,shapePath:b}}const Iq={CreateBox:L.e,CreateTiledBox:d,CreateSphere:e.c,nb:R.b,CreateIcoSphere:J,CreateRibbon:a,CreateCylinder:w,CreateTorus:W,CreateTorusKnot:Z,CreateLineSystem:U.e,pb:U.i,CreateDashedLines:U.c,ExtrudeShape:S,ExtrudeShapeCustom:c,CreateLathe:t,CreateTiledPlane:j,ug:z.e,CreateGround:K.i,CreateTiledGround:K.k,CreateGroundFromHeightMap:K.e,CreatePolygon:Y,ExtrudePolygon:N,CreateTube:h,CreatePolyhedron:C,CreateGeodesic:function(q,X){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,y=X.m||1;y!==Math.floor(y)&&(y=Math.floor(y),O.b.Warn("m not an integer only floor(m) used"));let x=X.n||0;if(x!==Math.floor(x)&&(x=Math.floor(x),O.b.Warn("n not an integer only floor(n) used")),x>y){const q=x;x=y,y=q,O.b.Warn("n > m therefore m and n swapped")}const u=new Dq;return u.build(y,x),C(q,{custom:Rq.BuildGeodesicData(u),size:X.size,sizeX:X.sizeX,sizeY:X.sizeY,sizeZ:X.sizeZ,faceUV:X.faceUV,faceColors:X.faceColors,flat:X.flat,updatable:X.updatable,sideOrientation:X.sideOrientation,frontUVs:X.frontUVs,backUVs:X.backUVs},Q)},CreateGoldberg:function(q,X){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const u=X.size,D=X.sizeX||u||1,a=X.sizeY||u||1,R=X.sizeZ||u||1;let L=X.m||1;L!==Math.floor(L)&&(L=Math.floor(L),O.b.Warn("m not an integer only floor(m) used"));let k=X.n||0;if(k!==Math.floor(k)&&(k=Math.floor(k),O.b.Warn("n not an integer only floor(n) used")),k>L){const q=k;k=L,L=q,O.b.Warn("n > m therefore m and n swapped")}const j=new Dq;j.build(L,k);const I=Rq.BuildGeodesicData(j),d=I.toGoldbergPolyhedronData(),e=new Lq(q,Q);X.sideOrientation=x.b._GetDefaultSideOrientation(X.sideOrientation),e._originalBuilderSideOrientation=X.sideOrientation;(function(q,X){const Q=q.size,x=q.sizeX||Q||1,u=q.sizeY||Q||1,D=q.sizeZ||Q||1,a=0===q.sideOrientation?0:q.sideOrientation||H.d.DEFAULTSIDE,R=[],L=[],f=[],k=[];let j=1/0,I=-1/0,d=1/0,e=-1/0;for(let y=0;y<X.vertex.length;y++)j=Math.min(j,X.vertex[y][0]*x),I=Math.max(I,X.vertex[y][0]*x),d=Math.min(d,X.vertex[y][1]*u),e=Math.max(e,X.vertex[y][1]*u);let i=0;for(let H=0;H<X.face.length;H++){const q=X.face[H],Q=y.n.Rd(X.vertex[q[0]]),a=y.n.Rd(X.vertex[q[2]]),A=y.n.Rd(X.vertex[q[1]]),B=a.Sc(Q),w=A.Sc(Q),V=y.n.Cross(w,B).normalize();for(let y=0;y<q.length;y++){f.push(V.x,V.y,V.z);const Q=X.vertex[q[y]];R.push(Q[0]*x,Q[1]*u,Q[2]*D);const H=(Q[1]*u-d)/(e-d);k.push((Q[0]*x-j)/(I-j),b.c?1-H:H)}for(let X=0;X<q.length-2;X++)L.push(i,i+X+2,i+X+1);i+=q.length}H.d._ComputeSides(a,R,L,f,k);const A=new H.d;return A.xa=R,A.indices=L,A.ya=f,A.Aa=k,A})(X,d).Ca(e,X.updatable),e.goldbergData.nbSharedFaces=I.sharedNodes,e.goldbergData.nbUnsharedFaces=I.poleNodes,e.goldbergData.adjacentFaces=I.adjacentFaces,e.goldbergData.nbFaces=e.goldbergData.nbSharedFaces+e.goldbergData.nbUnsharedFaces,e.goldbergData.nbFacesAtPole=(e.goldbergData.nbUnsharedFaces-12)/12;for(let x=0;x<I.vertex.length;x++)e.goldbergData.faceCenters.push(y.n.Rd(I.vertex[x])),e.goldbergData.faceCenters[x].x*=D,e.goldbergData.faceCenters[x].y*=a,e.goldbergData.faceCenters[x].z*=R,e.goldbergData.faceColors.push(new f.c(1,1,1,1));for(let x=0;x<d.face.length;x++){const q=d.face[x],X=y.n.Rd(d.vertex[q[0]]),Q=y.n.Rd(d.vertex[q[2]]),u=y.n.Rd(d.vertex[q[1]]),H=Q.Sc(X),b=u.Sc(X),D=y.n.Cross(b,H).normalize(),a=y.n.Cross(b,D).normalize();e.goldbergData.faceXaxis.push(b.normalize()),e.goldbergData.faceYaxis.push(D),e.goldbergData.faceZaxis.push(a)}return e},CreateDecal:xq,CreateCapsule:Hq,CreateText:function(q,X,Q){let u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{size:50,resolution:8,depth:1},H=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:earcut;const D=function(q,X,Q,y){const x=Array.from(q),u=X/y.resolution,H=(y.boundingBox.yMax-y.boundingBox.yMin+y.underlineThickness)*u,b=[];let D=0,a=0;for(let R=0;R<x.length;R++){const q=x[R];if("\n"===q)D=0,a-=H;else{const X=jq(q,u,D,a,Q,y);X&&(D+=X.offsetX,b.push(X.shapePath))}}return b}(X,u.size||50,u.resolution||8,Q),a=[];let R=0;for(const j of D){if(!j.paths.length)continue;const X=j.holes.slice();for(const Q of j.paths){var L,f;const D=[],k=[],j=Q.getPoints();for(const q of j)k.push(new y.n(q.x,0,q.y));const I=X.slice();for(const q of I){const x=q.getPoints();let u=!1;for(const q of x)if(Q.isPointInside(q)){u=!0;break}if(!u)continue;const H=[];for(const q of x)H.push(new y.n(q.x,0,q.y));D.push(H),X.splice(X.indexOf(q),1)}if(!D.length&&X.length)for(const q of X){const X=q.getPoints(),Q=[];for(const q of X)Q.push(new y.n(q.x,0,q.y));D.push(Q)}const d=N(q,{shape:k,holes:D.length?D:void 0,depth:u.depth||1,faceUV:u.faceUV||(null===(L=u.perLetterFaceUV)||void 0===L?void 0:L.call(u,R)),faceColors:u.faceColors||(null===(f=u.perLetterFaceColors)||void 0===f?void 0:f.call(u,R)),sideOrientation:x.b._GetDefaultSideOrientation(u.sideOrientation||x.b.DOUBLESIDE)},H,b);a.push(d),R++}}const k=x.b.MergeMeshes(a,!0,!0);if(k){const X=k.getBoundingInfo().boundingBox;k.position.x+=-(X.minimumWorld.x+X.maximumWorld.x)/2,k.position.y+=-(X.minimumWorld.y+X.maximumWorld.y)/2,k.position.z+=-(X.minimumWorld.z+X.maximumWorld.z)/2+X.extendSize.z,k.name=q;const Q=new fq.c("pivot",H);Q.rotation.x=-Math.PI/2,k.parent=Q,k.bakeCurrentTransformIntoVertices(),k.parent=null,Q.dispose()}return k}}},11925:(q,X,Q)=>{"use strict";var y=Q(11253),x=Q(1261),u=Q(1002),H=Q(1099),b=Q(1347);y.b.prototype.thinInstanceAdd=function(q){let X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.va().getEngine().getCaps().instancedArrays)return H.b.Error("Thin Instances are not supported on this device as Instanced Array extension not supported"),-1;this._thinInstanceUpdateBufferSize("matrix",Array.isArray(q)?q.length:1);const Q=this._thinInstanceDataStorage.instancesCount;if(Array.isArray(q))for(let y=0;y<q.length;++y)this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,q[y],y===q.length-1&&X);else this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,q,X);return Q},y.b.prototype.thinInstanceAddSelf=function(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.thinInstanceAdd(u.b.IdentityReadOnly,q)},y.b.prototype.thinInstanceRegisterAttribute=function(q,X){q===x.c.ColorKind&&(q=x.c.ColorInstanceKind),this.removeVerticesData(q),this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.strides[q]=X,this._userThinInstanceBuffersStorage.sizes[q]=X*Math.max(32,this._thinInstanceDataStorage.instancesCount),this._userThinInstanceBuffersStorage.data[q]=new Float32Array(this._userThinInstanceBuffersStorage.sizes[q]),this._userThinInstanceBuffersStorage.vertexBuffers[q]=new x.c(this.getEngine(),this._userThinInstanceBuffersStorage.data[q],q,!0,!1,X,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[q])},y.b.prototype.thinInstanceSetMatrixAt=function(q,X){let Q=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!this._thinInstanceDataStorage.matrixData||q>=this._thinInstanceDataStorage.instancesCount)return!1;const y=this._thinInstanceDataStorage.matrixData;return X.copyToArray(y,16*q),this._thinInstanceDataStorage.worldMatrices&&(this._thinInstanceDataStorage.worldMatrices[q]=X),Q&&(this.Lj("matrix"),this.Da||this.thinInstanceRefreshBoundingInfo(!1)),!0},y.b.prototype.thinInstanceSetAttributeAt=function(q,X,Q){let y=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return q===x.c.ColorKind&&(q=x.c.ColorInstanceKind),!(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.data[q]||X>=this._thinInstanceDataStorage.instancesCount)&&(this._thinInstanceUpdateBufferSize(q,0),this._userThinInstanceBuffersStorage.data[q].set(Q,X*this._userThinInstanceBuffersStorage.strides[q]),y&&this.Lj(q),!0)},Object.defineProperty(y.b.prototype,"Ij",{get:function(){return this._thinInstanceDataStorage.instancesCount},set:function(q){var X;const Q=this._thinInstanceDataStorage.matrixData??(null===(X=this.source)||void 0===X?void 0:X._thinInstanceDataStorage.matrixData);q<=(Q?Q.length/16:0)&&(this._thinInstanceDataStorage.instancesCount=q)},enumerable:!0,configurable:!0}),y.b.prototype._thinInstanceCreateMatrixBuffer=function(q,X){let Q=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const y=new x.b(this.getEngine(),X,!Q,16,!1,!0);for(let x=0;x<4;x++)this.setVerticesBuffer(y.createVertexBuffer(q+x,4*x,4));return y},y.b.prototype.Mj=function(q,X){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,y=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];var u;if(Q=Q||16,"matrix"===q)null===(u=this._thinInstanceDataStorage.matrixBuffer)||void 0===u||u.dispose(),this._thinInstanceDataStorage.matrixBuffer=null,this._thinInstanceDataStorage.matrixBufferSize=X?X.length:32*Q,this._thinInstanceDataStorage.matrixData=X,this._thinInstanceDataStorage.worldMatrices=null,null!==X?(this._thinInstanceDataStorage.instancesCount=X.length/Q,this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",X,y),this.Da||this.thinInstanceRefreshBoundingInfo(!1)):(this._thinInstanceDataStorage.instancesCount=0,this.Da||this.refreshBoundingInfo());else if("previousMatrix"===q){var H;null===(H=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===H||H.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=null,this._thinInstanceDataStorage.previousMatrixData=X,null!==X&&(this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",X,y))}else{var b;if(q===x.c.ColorKind&&(q=x.c.ColorInstanceKind),null===X)null!==(b=this._userThinInstanceBuffersStorage)&&void 0!==b&&b.data[q]&&(this.removeVerticesData(q),delete this._userThinInstanceBuffersStorage.data[q],delete this._userThinInstanceBuffersStorage.strides[q],delete this._userThinInstanceBuffersStorage.sizes[q],delete this._userThinInstanceBuffersStorage.vertexBuffers[q]);else this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.data[q]=X,this._userThinInstanceBuffersStorage.strides[q]=Q,this._userThinInstanceBuffersStorage.sizes[q]=X.length,this._userThinInstanceBuffersStorage.vertexBuffers[q]=new x.c(this.getEngine(),X,q,!y,!1,Q,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[q])}},y.b.prototype.Lj=function(q){var X;if("matrix"===q)this.Hj&&this._thinInstanceDataStorage.matrixBuffer&&!this._thinInstanceDataStorage.matrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(q),null===(X=this._thinInstanceDataStorage.matrixBuffer)||void 0===X||X.updateDirectly(this._thinInstanceDataStorage.matrixData,0,this._thinInstanceDataStorage.instancesCount);else if("previousMatrix"===q){var Q;this.Hj&&this._thinInstanceDataStorage.previousMatrixBuffer&&!this._thinInstanceDataStorage.previousMatrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(q),null===(Q=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===Q||Q.updateDirectly(this._thinInstanceDataStorage.previousMatrixData,0,this._thinInstanceDataStorage.instancesCount)}else{var y;q===x.c.ColorKind&&(q=x.c.ColorInstanceKind),null!==(y=this._userThinInstanceBuffersStorage)&&void 0!==y&&y.vertexBuffers[q]&&(this.Hj&&!this._userThinInstanceBuffersStorage.vertexBuffers[q].isUpdatable()&&this._thinInstanceRecreateBuffer(q),this._userThinInstanceBuffersStorage.vertexBuffers[q].updateDirectly(this._userThinInstanceBuffersStorage.data[q],0))}},y.b.prototype.thinInstancePartialBufferUpdate=function(q,X,Q){var y;"matrix"===q?this._thinInstanceDataStorage.matrixBuffer&&this._thinInstanceDataStorage.matrixBuffer.updateDirectly(X,Q):(q===x.c.ColorKind&&(q=x.c.ColorInstanceKind),null!==(y=this._userThinInstanceBuffersStorage)&&void 0!==y&&y.vertexBuffers[q]&&this._userThinInstanceBuffersStorage.vertexBuffers[q].updateDirectly(X,Q))},y.b.prototype.thinInstanceGetWorldMatrices=function(){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return[];const q=this._thinInstanceDataStorage.matrixData;if(!this._thinInstanceDataStorage.worldMatrices){this._thinInstanceDataStorage.worldMatrices=[];for(let X=0;X<this._thinInstanceDataStorage.instancesCount;++X)this._thinInstanceDataStorage.worldMatrices[X]=u.b.Rd(q,16*X)}return this._thinInstanceDataStorage.worldMatrices},y.b.prototype.thinInstanceRefreshBoundingInfo=function(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return;const y=this._thinInstanceDataStorage.boundingVectors;if(q||!this.rawBoundingInfo){y.length=0,this.refreshBoundingInfo(X,Q);const q=this.getBoundingInfo();this.rawBoundingInfo=new b.e(q.minimum,q.maximum)}const x=this.getBoundingInfo(),H=this._thinInstanceDataStorage.matrixData;if(0===y.length)for(let u=0;u<x.boundingBox.vectors.length;++u)y.push(x.boundingBox.vectors[u].clone());u.h.Od[0].Td(Number.POSITIVE_INFINITY),u.h.Od[1].Td(Number.NEGATIVE_INFINITY);for(let b=0;b<this._thinInstanceDataStorage.instancesCount;++b){u.b.FromArrayToRef(H,16*b,u.h.Matrix[0]);for(let q=0;q<y.length;++q)u.n.TransformCoordinatesToRef(y[q],u.h.Matrix[0],u.h.Od[2]),u.h.Od[0].minimizeInPlace(u.h.Od[2]),u.h.Od[1].maximizeInPlace(u.h.Od[2])}x.reConstruct(u.h.Od[0],u.h.Od[1]),this.Ea()},y.b.prototype._thinInstanceRecreateBuffer=function(q){let X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var Q;if("matrix"===q)null===(Q=this._thinInstanceDataStorage.matrixBuffer)||void 0===Q||Q.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",this._thinInstanceDataStorage.matrixData,X);else if("previousMatrix"===q){var y;if(this._scene.needsPreviousWorldMatrices)null===(y=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===y||y.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.previousMatrixData??this._thinInstanceDataStorage.matrixData,X)}else{var u;q===x.c.ColorKind&&(q=x.c.ColorInstanceKind),null===(u=this._userThinInstanceBuffersStorage.vertexBuffers[q])||void 0===u||u.dispose(),this._userThinInstanceBuffersStorage.vertexBuffers[q]=new x.c(this.getEngine(),this._userThinInstanceBuffersStorage.data[q],q,!X,!1,this._userThinInstanceBuffersStorage.strides[q],!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[q])}},y.b.prototype._thinInstanceUpdateBufferSize=function(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;q===x.c.ColorKind&&(q=x.c.ColorInstanceKind);const Q="matrix"===q;if(!Q&&(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.strides[q]))return;const y=Q?16:this._userThinInstanceBuffersStorage.strides[q],u=Q?this._thinInstanceDataStorage.matrixBufferSize:this._userThinInstanceBuffersStorage.sizes[q];let H=Q?this._thinInstanceDataStorage.matrixData:this._userThinInstanceBuffersStorage.data[q];const b=(this._thinInstanceDataStorage.instancesCount+X)*y;let D=u;for(;D<b;)D*=2;if(!H||u!=D){if(H){const q=new Float32Array(D);q.set(H,0),H=q}else H=new Float32Array(D);var a,R,L;if(Q){if(null===(a=this._thinInstanceDataStorage.matrixBuffer)||void 0===a||a.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",H,!1),this._thinInstanceDataStorage.matrixData=H,this._thinInstanceDataStorage.matrixBufferSize=D,this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData)null===(R=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===R||R.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",H,!1)}else null===(L=this._userThinInstanceBuffersStorage.vertexBuffers[q])||void 0===L||L.dispose(),this._userThinInstanceBuffersStorage.data[q]=H,this._userThinInstanceBuffersStorage.sizes[q]=D,this._userThinInstanceBuffersStorage.vertexBuffers[q]=new x.c(this.getEngine(),H,q,!0,!1,y,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[q])}},y.b.prototype._thinInstanceInitializeUserStorage=function(){this._userThinInstanceBuffersStorage||(this._userThinInstanceBuffersStorage={data:{},sizes:{},vertexBuffers:{},strides:{}})},y.b.prototype._disposeThinInstanceSpecificData=function(){var q;null!==(q=this._thinInstanceDataStorage)&&void 0!==q&&q.matrixBuffer&&(this._thinInstanceDataStorage.matrixBuffer.dispose(),this._thinInstanceDataStorage.matrixBuffer=null)}},11298:(q,X,Q)=>{"use strict";Q.d(X,{c:()=>L});var y=Q(975),x=Q(984),u=Q(1173),H=Q(998),b=Q(1002),D=Q(11270),a=Q(1015);const R=b.b.Compose(b.n.One(),b.d.FromEulerAngles(0,Math.PI,0),b.n.Zero());class L extends D.d{get billboardMode(){return this._billboardMode}set billboardMode(q){this._billboardMode!==q&&(this._billboardMode=q,this._cache.useBillboardPosition=0!==(this._billboardMode&L.BILLBOARDMODE_USE_POSITION),this._computeUseBillboardPath())}get preserveParentRotationForBillboard(){return this._preserveParentRotationForBillboard}set preserveParentRotationForBillboard(q){q!==this._preserveParentRotationForBillboard&&(this._preserveParentRotationForBillboard=q,this._computeUseBillboardPath())}_computeUseBillboardPath(){this._cache.useBillboardPath=this._billboardMode!==L.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}get infiniteDistance(){return this._infiniteDistance}set infiniteDistance(q){this._infiniteDistance!==q&&(this._infiniteDistance=q)}constructor(q){let X=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(q,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,!1),this._forward=new b.n(0,0,1),this._up=new b.n(0,1,0),this._right=new b.n(1,0,0),this._position=b.n.Zero(),this._rotation=b.n.Zero(),this._rotationQuaternion=null,this._scaling=b.n.One(),this._transformToBoneReferal=null,this._isAbsoluteSynced=!1,this._billboardMode=L.BILLBOARDMODE_NONE,this._preserveParentRotationForBillboard=!1,this.scalingDeterminant=1,this._infiniteDistance=!1,this.ignoreNonUniformScaling=!1,this.reIntegrateRotationIntoRotationQuaternion=!1,this._poseMatrix=null,this.Kj=b.b.Zero(),this._usePivotMatrix=!1,this._absolutePosition=b.n.Zero(),this._absoluteScaling=b.n.Zero(),this._absoluteRotationQuaternion=b.d.Identity(),this._pivotMatrix=b.b.Identity(),this._postMultiplyPivotMatrix=!1,this._isWorldMatrixFrozen=!1,this._indexInSceneTransformNodesArray=-1,this.onAfterWorldMatrixUpdateObservable=new H.c,this._nonUniformScaling=!1,X&&this.va().addTransformNode(this)}getClassName(){return"qb"}get position(){return this._position}set position(q){this._position=q,this._markAsDirtyInternal()}isUsingPivotMatrix(){return this._usePivotMatrix}isUsingPostMultiplyPivotMatrix(){return this._postMultiplyPivotMatrix}get rotation(){return this._rotation}set rotation(q){this._rotation=q,this._rotationQuaternion=null,this._markAsDirtyInternal()}get He(){return this._scaling}set He(q){this._scaling=q,this._markAsDirtyInternal()}get rotationQuaternion(){return this._rotationQuaternion}set rotationQuaternion(q){this._rotationQuaternion=q,q&&this._rotation.Td(0),this._markAsDirtyInternal()}_markAsDirtyInternal(){this._isDirty||(this._isDirty=!0,this.customMarkAsDirty&&this.customMarkAsDirty())}get forward(){return b.n.TransformNormalFromFloatsToRef(0,0,this.va().useRightHandedSystem?-1:1,this.getWorldMatrix(),this._forward),this._forward.normalize()}get up(){return b.n.TransformNormalFromFloatsToRef(0,1,0,this.getWorldMatrix(),this._up),this._up.normalize()}get right(){return b.n.TransformNormalFromFloatsToRef(this.va().useRightHandedSystem?-1:1,0,0,this.getWorldMatrix(),this._right),this._right.normalize()}updatePoseMatrix(q){return this._poseMatrix?(this._poseMatrix.p(q),this):(this._poseMatrix=q.clone(),this)}getPoseMatrix(){return this._poseMatrix||(this._poseMatrix=b.b.Identity()),this._poseMatrix}_isSynchronized(){const q=this._cache;return this._billboardMode===q.billboardMode&&this._billboardMode===L.BILLBOARDMODE_NONE&&(!q.pivotMatrixUpdated&&(!this._infiniteDistance&&(!this._position._isDirty&&(!this._scaling._isDirty&&!(this._rotationQuaternion&&this._rotationQuaternion._isDirty||this._rotation._isDirty)))))}_initCache(){super._initCache();const q=this._cache;q.localMatrixUpdated=!1,q.billboardMode=-1,q.infiniteDistance=!1,q.useBillboardPosition=!1,q.useBillboardPath=!1}get absolutePosition(){return this.getAbsolutePosition()}get absoluteScaling(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling}get absoluteRotationQuaternion(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion}setPreTransformMatrix(q){return this.setPivotMatrix(q,!1)}setPivotMatrix(q){let X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._pivotMatrix.p(q),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=X,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=b.b.Invert(this._pivotMatrix)),this}getPivotMatrix(){return this._pivotMatrix}instantiateHierarchy(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,X=arguments.length>1?arguments[1]:void 0,Q=arguments.length>2?arguments[2]:void 0;const y=this.clone("Clone of "+(this.name||this.id),q||this.parent,!0);y&&Q&&Q(this,y);for(const x of this.getChildTransformNodes(!0))x.instantiateHierarchy(y,X,Q);return y}$h(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return q?arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(this._rotation.Td(0),this._rotationQuaternion=this._rotationQuaternion||b.d.Identity(),q.decompose(this._scaling,this._rotationQuaternion,this._position),this.le(!0)):(this._worldMatrix=q,this._absolutePosition.Pd(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._afterComputeWorldMatrix()):(this._isWorldMatrixFrozen=!1,this.le(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this}unfreezeWorldMatrix(){return this._isWorldMatrixFrozen=!1,this.le(!0),this}get nj(){return this._isWorldMatrixFrozen}getAbsolutePosition(){return this.le(),this._absolutePosition}setAbsolutePosition(q){if(!q)return this;let X,Q,y;if(void 0===q.x){if(arguments.length<3)return this;X=arguments[0],Q=arguments[1],y=arguments[2]}else X=q.x,Q=q.y,y=q.z;if(this.parent){const q=b.h.Matrix[0];this.parent.getWorldMatrix().invertToRef(q),b.n.TransformCoordinatesFromFloatsToRef(X,Q,y,q,this.position)}else this.position.x=X,this.position.y=Q,this.position.z=y;return this._absolutePosition.p(q),this}setPositionWithLocalVector(q){return this.le(),this.position=b.n.TransformNormal(q,this.Kj),this}getPositionExpressedInLocalSpace(){this.le();const q=b.h.Matrix[0];return this.Kj.invertToRef(q),b.n.TransformNormal(this.position,q)}locallyTranslate(q){return this.le(!0),this.position=b.n.TransformCoordinates(q,this.Kj),this}lookAt(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const u=L._LookAtVectorCache,H=0===x?this.position:this.getAbsolutePosition();if(q.subtractToRef(H,u),this.setDirection(u,X,Q,y),1===x&&this.parent)if(this.rotationQuaternion){const q=b.h.Matrix[0];this.rotationQuaternion.toRotationMatrix(q);const X=b.h.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(X),X.invert(),q.multiplyToRef(X,q),this.rotationQuaternion.fromRotationMatrix(q)}else{const q=b.h.Quaternion[0];b.d.FromEulerVectorToRef(this.rotation,q);const X=b.h.Matrix[0];q.toRotationMatrix(X);const Q=b.h.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(Q),Q.invert(),X.multiplyToRef(Q,X),q.fromRotationMatrix(X),q.toEulerAnglesToRef(this.rotation)}return this}ef(q){const X=b.n.Zero();return this.getDirectionToRef(q,X),X}getDirectionToRef(q,X){return b.n.TransformNormalToRef(q,this.getWorldMatrix(),X),this}setDirection(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const x=-Math.atan2(q.z,q.x)+Math.PI/2,u=Math.sqrt(q.x*q.x+q.z*q.z),H=-Math.atan2(q.y,u);return this.rotationQuaternion?b.d.RotationYawPitchRollToRef(x+X,H+Q,y,this.rotationQuaternion):(this.rotation.x=H+Q,this.rotation.y=x+X,this.rotation.z=y),this}setPivotPoint(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;0==this.va().getRenderId()&&this.le(!0);const Q=this.getWorldMatrix();if(1==X){const X=b.h.Matrix[0];Q.invertToRef(X),q=b.n.TransformCoordinates(q,X)}return this.setPivotMatrix(b.b.Translation(-q.x,-q.y,-q.z),!0)}getPivotPoint(){const q=b.n.Zero();return this.getPivotPointToRef(q),q}getPivotPointToRef(q){return q.x=-this._pivotMatrix.m[12],q.y=-this._pivotMatrix.m[13],q.z=-this._pivotMatrix.m[14],this}getAbsolutePivotPoint(){const q=b.n.Zero();return this.getAbsolutePivotPointToRef(q),q}getAbsolutePivotPointToRef(q){return this.getPivotPointToRef(q),b.n.TransformCoordinatesToRef(q,this.getWorldMatrix(),q),this}te(q){if(this._isDirty)return this;if(this._children)for(const X of this._children)X.te(q);return super.te(q)}setParent(q){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!q&&!this.parent)return this;const y=b.h.Quaternion[0],x=b.h.Od[0],u=b.h.Od[1],H=b.h.Matrix[1];b.b.IdentityToRef(H);const D=b.h.Matrix[0];this.le(!0);let a=this.rotationQuaternion;return a||(a=L._TmpRotation,b.d.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,a)),b.b.ComposeToRef(this.He,a,this.position,D),this.parent&&D.multiplyToRef(this.parent.le(!0),D),q&&(q.le(!0).invertToRef(H),D.multiplyToRef(H,D)),D.decompose(u,y,x,X?this:void 0),this.rotationQuaternion?this.rotationQuaternion.p(y):y.toEulerAnglesToRef(this.rotation),this.He.p(u),this.position.p(x),this.parent=q,Q&&this.setPivotMatrix(b.b.Identity()),this}addChild(q){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return q.setParent(this,X),this}removeChild(q){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return q.setParent(null,X),this}get nonUniformScaling(){return this._nonUniformScaling}_updateNonUniformScalingState(q){return this._nonUniformScaling!==q&&(this._nonUniformScaling=q,!0)}attachToBone(q,X){return this._currentParentWhenAttachingToBone=this.parent,this._transformToBoneReferal=X,this.parent=q,q.getSkeleton().prepare(!0),q.getFinalMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this}detachFromBone(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=q?this._currentParentWhenAttachingToBone:null,this):(q&&(this.parent=this._currentParentWhenAttachingToBone),this)}rotate(q,X,Q){let y;if(q.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.Td(0)),Q&&0!==Q){if(this.parent){const Q=this.parent.getWorldMatrix(),y=b.h.Matrix[0];Q.invertToRef(y),q=b.n.TransformNormal(q,y),Q.determinant()<0&&(X*=-1)}y=b.d.RotationAxisToRef(q,X,L._RotationAxisCache),y.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else y=b.d.RotationAxisToRef(q,X,L._RotationAxisCache),this.rotationQuaternion.multiplyToRef(y,this.rotationQuaternion);return this}rotateAround(q,X,Q){X.normalize(),this.rotationQuaternion||(this.rotationQuaternion=b.d.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.Td(0));const y=b.h.Od[0],x=b.h.Od[1],u=b.h.Od[2],H=b.h.Quaternion[0],D=b.h.Matrix[0],a=b.h.Matrix[1],R=b.h.Matrix[2],L=b.h.Matrix[3];return q.subtractToRef(this.position,y),b.b.TranslationToRef(y.x,y.y,y.z,D),b.b.TranslationToRef(-y.x,-y.y,-y.z,a),b.b.RotationAxisToRef(X,Q,R),a.multiplyToRef(R,L),L.multiplyToRef(D,L),L.decompose(x,H,u),this.position.addInPlace(u),H.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this}translate(q,X,Q){const y=q.scale(X);if(Q&&0!==Q)this.setAbsolutePosition(this.getAbsolutePosition().add(y));else{const q=this.getPositionExpressedInLocalSpace().add(y);this.setPositionWithLocalVector(q)}return this}addRotation(q,X,Q){let y;this.rotationQuaternion?y=this.rotationQuaternion:(y=b.h.Quaternion[1],b.d.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,y));const x=b.h.Quaternion[0];return b.d.RotationYawPitchRollToRef(X,q,Q,x),y.multiplyInPlace(x),this.rotationQuaternion||y.toEulerAnglesToRef(this.rotation),this}_getEffectiveParent(){return this.parent}isWorldMatrixCameraDependent(){return this._infiniteDistance&&!this.parent||this._billboardMode!==L.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}le(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;const Q=this.va().getRenderId();if(!this._isDirty&&!q&&(this._currentRenderId===Q||this.isSynchronized()))return this._currentRenderId=Q,this._worldMatrix;X=X||this.va().activeCamera,this._updateCache();const y=this._cache;y.pivotMatrixUpdated=!1,y.billboardMode=this.billboardMode,y.infiniteDistance=this.infiniteDistance,y.parent=this._parentNode,this._currentRenderId=Q,this._childUpdateId+=1,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;const x=this._getEffectiveParent(),u=L._TmpScaling;let H,D=this._position;if(this._infiniteDistance&&!this.parent&&X){const q=X.getWorldMatrix(),Q=new b.n(q.m[12],q.m[13],q.m[14]);D=L._TmpTranslation,D.Pd(this._position.x+Q.x,this._position.y+Q.y,this._position.z+Q.z)}if(u.Pd(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant),this._rotationQuaternion){if(this._rotationQuaternion._isDirty=!1,H=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion){this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(b.d.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.Pd(0,0,0))}}else H=L._TmpRotation,b.d.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,H);if(this._usePivotMatrix){const q=b.h.Matrix[1];b.b.ScalingToRef(u.x,u.y,u.z,q);const X=b.h.Matrix[0];H.toRotationMatrix(X),this._pivotMatrix.multiplyToRef(q,b.h.Matrix[4]),b.h.Matrix[4].multiplyToRef(X,this.Kj),this._postMultiplyPivotMatrix&&this.Kj.multiplyToRef(this._pivotMatrixInverse,this.Kj),this.Kj.addTranslationFromFloats(D.x,D.y,D.z)}else b.b.ComposeToRef(u,H,D,this.Kj);if(x&&x.getWorldMatrix){if(q&&x.le(q),y.useBillboardPath){if(this._transformToBoneReferal){const q=this.parent;q.getSkeleton().prepare(),q.getFinalMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),b.h.Matrix[7])}else b.h.Matrix[7].p(x.getWorldMatrix());const q=b.h.Od[5],X=b.h.Od[6],Q=b.h.Quaternion[0];b.h.Matrix[7].decompose(X,Q,q),b.b.ScalingToRef(X.x,X.y,X.z,b.h.Matrix[7]),b.h.Matrix[7].setTranslation(q),L.BillboardUseParentOrientation&&(this._position.applyRotationQuaternionToRef(Q,q),this.Kj.setTranslation(q)),this.Kj.multiplyToRef(b.h.Matrix[7],this._worldMatrix)}else if(this._transformToBoneReferal){const q=this.parent;q.getSkeleton().prepare(),this.Kj.multiplyToRef(q.getFinalMatrix(),b.h.Matrix[6]),b.h.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)}else this.Kj.multiplyToRef(x.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.p(this.Kj);if(y.useBillboardPath&&X&&this.billboardMode&&!y.useBillboardPosition){const q=b.h.Od[0];if(this._worldMatrix.getTranslationToRef(q),b.h.Matrix[1].p(X.getViewMatrix()),this._scene.useRightHandedSystem&&b.h.Matrix[1].multiplyToRef(R,b.h.Matrix[1]),b.h.Matrix[1].setTranslationFromFloats(0,0,0),b.h.Matrix[1].invertToRef(b.h.Matrix[0]),(this.billboardMode&L.BILLBOARDMODE_ALL)!==L.BILLBOARDMODE_ALL){b.h.Matrix[0].decompose(void 0,b.h.Quaternion[0],void 0);const q=b.h.Od[1];b.h.Quaternion[0].toEulerAnglesToRef(q),(this.billboardMode&L.BILLBOARDMODE_X)!==L.BILLBOARDMODE_X&&(q.x=0),(this.billboardMode&L.BILLBOARDMODE_Y)!==L.BILLBOARDMODE_Y&&(q.y=0),(this.billboardMode&L.BILLBOARDMODE_Z)!==L.BILLBOARDMODE_Z&&(q.z=0),b.b.RotationYawPitchRollToRef(q.y,q.x,q.z,b.h.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(b.h.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(b.h.Od[0])}else if(y.useBillboardPath&&X&&y.useBillboardPosition){const q=b.h.Od[0];this._worldMatrix.getTranslationToRef(q);const Q=X.globalPosition;this._worldMatrix.invertToRef(b.h.Matrix[1]);const y=b.h.Od[1];b.n.TransformCoordinatesToRef(Q,b.h.Matrix[1],y),y.normalize();const x=-Math.atan2(y.z,y.x)+Math.PI/2,u=Math.sqrt(y.x*y.x+y.z*y.z),H=-Math.atan2(y.y,u);if(b.d.RotationYawPitchRollToRef(x,H,0,b.h.Quaternion[0]),(this.billboardMode&L.BILLBOARDMODE_ALL)!==L.BILLBOARDMODE_ALL){const q=b.h.Od[1];b.h.Quaternion[0].toEulerAnglesToRef(q),(this.billboardMode&L.BILLBOARDMODE_X)!==L.BILLBOARDMODE_X&&(q.x=0),(this.billboardMode&L.BILLBOARDMODE_Y)!==L.BILLBOARDMODE_Y&&(q.y=0),(this.billboardMode&L.BILLBOARDMODE_Z)!==L.BILLBOARDMODE_Z&&(q.z=0),b.b.RotationYawPitchRollToRef(q.y,q.x,q.z,b.h.Matrix[0])}else b.b.FromQuaternionToRef(b.h.Quaternion[0],b.h.Matrix[0]);this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(b.h.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(b.h.Od[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):x&&x._nonUniformScaling?this._updateNonUniformScalingState(x._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.Pd(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=b.b.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix}resetLocalMatrix(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.le(),q){const q=this.getChildren();for(let X=0;X<q.length;++X){const Q=q[X];if(Q){Q.le();const q=b.h.Matrix[0];Q.Kj.multiplyToRef(this.Kj,q);const X=b.h.Quaternion[0];q.decompose(Q.He,X,Q.position),Q.rotationQuaternion?Q.rotationQuaternion.p(X):X.toEulerAnglesToRef(Q.rotation)}}}this.He.Pd(1,1,1),this.position.Pd(0,0,0),this.rotation.Pd(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=b.d.Identity()),this._worldMatrix=b.b.Identity()}_afterComputeWorldMatrix(){}registerAfterWorldMatrixUpdate(q){return this.onAfterWorldMatrixUpdateObservable.add(q),this}unregisterAfterWorldMatrixUpdate(q){return this.onAfterWorldMatrixUpdateObservable.removeCallback(q),this}getPositionInCameraSpace(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return q||(q=this.va().activeCamera),b.n.TransformCoordinates(this.getAbsolutePosition(),q.getViewMatrix())}getDistanceToCamera(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return q||(q=this.va().activeCamera),this.getAbsolutePosition().Sc(q.globalPosition).length()}clone(q,X,Q){const y=u.c.Clone((()=>new L(q,this.va())),this);if(y.name=q,y.id=q,X&&(y.parent=X),!Q){const X=this.getDescendants(!0);for(let Q=0;Q<X.length;Q++){const x=X[Q];x.clone&&x.clone(q+"."+x.name,y)}}return y}serialize(q){const X=u.c.Serialize(this,q);return X.type=this.getClassName(),X.uniqueId=this.uniqueId,this.parent&&this.parent._serializeAsParent(X),X.localMatrix=this.getPivotMatrix().ee(),X.isEnabled=this.isEnabled(),u.c.AppendSerializedAnimations(this,X),X.ranges=this.serializeAnimationRanges(),X}static Parse(q,X,Q){const y=u.c.Parse((()=>new L(q.name,X)),q,X,Q);if(q.localMatrix?y.setPreTransformMatrix(b.b.Rd(q.localMatrix)):q.pivotMatrix&&y.setPivotMatrix(b.b.Rd(q.pivotMatrix)),y.tg(q.isEnabled),y._waitingParsedUniqueId=q.uniqueId,void 0!==q.parentId&&(y._waitingParentId=q.parentId),void 0!==q.parentInstanceIndex&&(y._waitingParentInstanceIndex=q.parentInstanceIndex),q.animations){for(let X=0;X<q.animations.length;X++){const Q=q.animations[X],x=(0,a.d)("BABYLON.Animation");x&&y.animations.push(x.Parse(Q))}D.d.ParseAnimationRanges(y,q,X)}return q.autoAnimate&&X.beginAnimation(y,q.autoAnimateFrom,q.autoAnimateTo,q.autoAnimateLoop,q.autoAnimateSpeed||1),y}getChildTransformNodes(q,X){const Q=[];return this._getDescendants(Q,q,(q=>(!X||X(q))&&q instanceof L)),Q}dispose(q){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.va().stopAnimation(this),this.va().removeTransformNode(this),this._parentContainer){const q=this._parentContainer.transformNodes.indexOf(this);q>-1&&this._parentContainer.transformNodes.splice(q,1),this._parentContainer=null}if(this.onAfterWorldMatrixUpdateObservable.clear(),q){const q=this.getChildTransformNodes(!0);for(const X of q)X.parent=null,X.le(!0)}super.dispose(q,X)}normalizeToUnitCube(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Q=arguments.length>2?arguments[2]:void 0,y=null,x=null;X&&(this.rotationQuaternion?(x=this.rotationQuaternion.clone(),this.rotationQuaternion.Pd(0,0,0,1)):this.rotation&&(y=this.rotation.clone(),this.rotation.Pd(0,0,0)));const u=this.getHierarchyBoundingVectors(q,Q),H=u.max.Sc(u.min),b=Math.max(H.x,H.y,H.z);if(0===b)return this;const D=1/b;return this.He.scaleInPlace(D),X&&(this.rotationQuaternion&&x?this.rotationQuaternion.p(x):this.rotation&&y&&this.rotation.p(y)),this}_syncAbsoluteScalingAndRotation(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)}}L.BILLBOARDMODE_NONE=0,L.BILLBOARDMODE_X=1,L.BILLBOARDMODE_Y=2,L.BILLBOARDMODE_Z=4,L.BILLBOARDMODE_ALL=7,L.BILLBOARDMODE_USE_POSITION=128,L.BillboardUseParentOrientation=!1,L._TmpRotation=b.d.Zero(),L._TmpScaling=b.n.Zero(),L._TmpTranslation=b.n.Zero(),L._LookAtVectorCache=new b.n(0,0,0),L._RotationAxisCache=new b.d,(0,y.b)([(0,x.F)("position")],L.prototype,"_position",void 0),(0,y.b)([(0,x.F)("rotation")],L.prototype,"_rotation",void 0),(0,y.b)([(0,x.A)("rotationQuaternion")],L.prototype,"_rotationQuaternion",void 0),(0,y.b)([(0,x.F)("He")],L.prototype,"_scaling",void 0),(0,y.b)([(0,x.J)("billboardMode")],L.prototype,"_billboardMode",void 0),(0,y.b)([(0,x.J)()],L.prototype,"scalingDeterminant",void 0),(0,y.b)([(0,x.J)("infiniteDistance")],L.prototype,"_infiniteDistance",void 0),(0,y.b)([(0,x.J)()],L.prototype,"ignoreNonUniformScaling",void 0),(0,y.b)([(0,x.J)()],L.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0)},11893:(q,X,Q)=>{"use strict";Q.d(X,{d:()=>H});var y=Q(972),x=Q(10230);let u=0;const H=q=>{if(!q.environmentBRDFTexture){const X=q.useDelayedTextureLoading;q.useDelayedTextureLoading=!1;const Q=q._blockEntityCollection;q._blockEntityCollection=!1;const H=y.d.CreateFromBase64String("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR42u29yY5tWXIlZnbuiSaTbZFUkZRKrCKhElASQA0EoQABgn6hJvoXzfUP+gP9hWb6Bg00IgRoQJaKqUxmZmTEe8/v0uB2u7Fm2T7HIyIrnz88uPvt3f2a2WrMbOvf/u3PvvzP/sUf/N6//i8vf/lv/3v5H//d//Sb//Uq/5u8yf8hV/m/5Cp/L1f5hVzlG7nKJ7mKyJuIXN/hPwqXI/g++zq6rPI5u8z+WqfLre+zy7PrVv9L8brsMiGvk8XLmM/sdfHXal4e3ad6GXPdyu2ij8u/+uv/5cuf/OSLfdtEfvUr+dnf/d0X//t3H/7bf/hP//N/928h/0Yg/4VA/kogfyGQP5Wr/IFAvhbIlwK5CGQTPP+9z5uPeePJSW+yo2+s/GtN30Rnv1E+f5zxof9R/lSXv/nr//mrr3+i+5dfyX7ZZQP07Tffys//8R/l/9TtX7790T/7r/8G8pdy+/8XAvnnAvkzgfwzgfyxQP5AIL8vkJ8K5KsmMVzu1U7p5PA5AXxOAJ8TwPf7sX/51ZeXfcemqnp9w/W77/S7X/6T/vzf/7383RWCX3/z05/9i3/13/0PX//eX/2FyP8tIv+PiPy9iPy/IvIzEfm5iPxCRH4lIt/c/393//9BRD6KyKf7f488fP74/PH544dJAF9cLl98IZfLBZtuqterXr/7Dt9982v95S9+Lv+gF/3i7Spv/8lf/vnf/vGf/dF/JfKnIvLnIvLvReQ/NEngn0TklyLy6/v/34jIt00iGJOBlxAsdvv54/PH5493SQCXy9t2ueh2ueimKorrFbjq9eNH+fDtb+TXv/ol/vHyhX4Fxfbx7euPf/Lnf/PfiPyeiPyhiPxxkwB+fk8AvxzQgJcIrGTwFsiAEXH4/PH54/PHUgLY7whgu2C7bLqpQgHB2xvePn6SDx8+6G9+84384vKF/IPu8iVU9Y/+7C/+jWxffiHytYj8VER+X0T+oEEBvxqQwCMJeIngo5EI3goIwVMIPn98/vj8ESaAbbtu2ybbvl8u2ybbdtluSECA65u8ffqIDx8+6G++/VZ/efkV/sO261dQXP7wT/7kX8vl8qXIFyLylbySwe/dE0CLAr65B/9vGn0gQwRMMqgmhM/J4fPH548eAezbZd/lsm3YtssNAYiqiogAAkCvb5/k46cP8u2HD/rrb7+R/2/b9Wu9yJe//8d/9Ney6S5yEZFdRL68/38khG/uKOCnAwoYkcCoEXwkEgGDDq7CeQfyOTl8/vhd1QCum26ybZtu2yabbrKpQvXue1yvuF6v+vbpTT5+/CDffviAX1++1V9sO77WXb/66R/+4V/dgkbllQi+aBLBV/dE8LWRALwkYCWCNyMZXElkwLTMeMkga/P4/PH547ccAVwuctkvdxSw6bbdtYDbTfSZBN7e8PHTR/3u4wf55vKd/nL7DX6mu3791U9//5+/gkNFZGuSgZUQvnKowKgLWLTAQgRtEniTuEfwaELw0MJvf3LQzynud+53uG+X6y3gN9kul+2y6XVT1U27JCDAFVc8ksAn/e7jR/nN5YP+avtWfq6Xy9f7Vz/9w1dgRYngiyYhfNkkgzYBWHTg44AEMmqQUYQKOmDaiCIa8TmsfmzB+DnZDQjgcpGLbti2y3bZHjRAdRMVvb/dcYU8kcDbPQlsH/CrbddfbF98+RPZfvLFnAQeieCRDC5DMvju/vmD4JkEvjRQgKULeGggowdHkAHTYxihg89vu88I5UeGAPSOAFTlrgPopiqbKPSmCKreUoAAkCcSePukHz590m8vH+WbD9/JP335k6/+tA86KxFchv8jMvhiogE4JQm8XhfKqOAqx5qRPyeGzx8/cgSwbXcUoLJtim27C4Oi93+4v6VxQwKAvl2v+Hj9pB8+fZJvt4/yzfbF9lPdv/wJnsE2BogmyeCRED40tGFvksIXiSbgiYSRRpDNDZ6BDI6ghM+J4fPHeyKAO+zX7cb9t4tedMMNAQju5V+f1uAtBSiu1zsduMrHy5t8ePsk3376KN98sX/xE5FPAnm7/782o0DiUINXMkCXCB7/P94/e87AWUmARQWVvgMuKej9t1RLBp+Tw+ePgwngsutFFdu26WXbbl+rSvdfbnqAiuA23QcBgCugV1zl7e1NPm5v+LC96XfbJ/1W9y++fgXjA3bDYXV+MuhRwSPwL3JLMFYC+HS/LU8HYrGwIhwyNOF12SvgM4SgztdifP85MXz+KGsA2C6X7aJ6bXSAOwrY5OYIqGy3d5uq4P5GhABXuV6veLvRAf10fZMPb2/y3b7vX7+g+9v98/WOBq7GG7RNAlYy+Dgkhhb+Xxp0sE8IAC4SGAP/TbgVJK/PoJPBnAiwPKxsXfbbnRg+i3s/JAK4Q/4b9NfLtomBAqCickMBjy7BuywAUVyv8na94tMjCVzf9KNcLl/0SeA6oAEYb1i9g+FtSALb/bKL8/+t+wxXFMyswqiHoK4ToIgKqslgpg1qUC0QoYbvJZg/B/q5v4szHmPX7YEAsD0CX25OwEUVm9xag1+agKg+nxQArnKjAtDr9U0+Xd/k4/UqH7bL5YsewrcBBiMJZPRAp6TwQgWfjM9vgRbgUYGL8AvLWH2gqhesCokeUmCSwPsnhs8fP2YNYMO2XeSmAWxy2VQaXeDmDIhApf33rD4PTUCuV+DtCn27XuXT5ir8VmCJ2G5BpBM8/r/dEcJb8/0lEQMtJHA5TAlqNuLRhJChhEpSqFabH3di+G1AGj+W1/dyAR4IYJNNnuLf6+tWC9CHHiAtFhAIFLjK2/Uqn65X+SS67aK+3QeTDoy/IG2ogQ7fb/dAtz5vBgrYGqrwNtCHsVfgIvwK07OTQBURVNCBFpKCOjqCHn5L/67TgTN+fpySAC56nwSUi256kXsSuFGAVyLoUIDo8/Pz7fdoErr/v17lk162HbgHvFpIYDfoAJJfW4sGPjkU4VNAF8ZEcLmLhdc7kljdY1y1Dq9yLiI4IiRqcLujb138KIPn80ejATwRwIbtBvn1cqv+2J78/5EI5N4cJA8qIPcmwRsKAHDF9WYP6mV7VmrgLuTpxYTcMEW0LAmoQxFsuvAI8tv/a/C5fV2ZMMiKg++FCM7RDPRu8ebWY7VG6VJi+Bzk35MI2LsAckMAgwvQ0gC5DQjd3ABg2HQLAPpEAlZ1Bu7VV7MGHDFRAbo3VKsTbAY9sPWC/uvx86gBbDK3D1eEQS8pbAeSgSwmhepnJb6uBv/o/PzHLzxWA/X7TH77De5j6AGQi6o0CUGfCOD2X7cXAlCFQABtEsGLDtxuOyQB2UTQBKZe5GUPXgkUYCUAbZJRhBDeuq8xBf+bgwbehDm+BFQi2IJksOocvA8ysIMfxluVcRsY/eB3JzH8GFDAXQO48X/dcIf9jyDHptIigDsFkEe066tBSETQUYF7ElDdYEBytN4+rk9UcBPfrKaZqFHWcw3i4J8/X4ev2//bSXqAhwTay6OEIPLD2Ipt8OtAGzxkwLw9WVFRjTc/qC6H3+YK/b1oAA0KuOizHfieCLaHHiAb5NYTIC9EMEbZrVEQt1xwhVy1UfBh8PUOquMizwaap3tQXfY5B//tea/NZdfhsvbz+PURQTDSGWB87VX/7WSd4KxjUqrIgE0IUkoKGnhIvwvawpGf6eECXJ7tv4qbA7DJgwpsKthEmmYgfaAAffYF3HLxo0vwNjJ0SwRWMG4db4eh1gPNm18vQ+us/0eGmxDemu/fnM/X4evq/8342ksGHgLY5LyT/zg0wM8lcMjgGFXwqIOVFJBQw99eCvF9oZL9Mfl3QwAvIXDsBRC9R+fz8x0FPBLB0xJEpwUobrfAkARgIAF41h3wQgP6QAmX5E/7eI43IxGwwf/moIkRyWRJQIPgt9CA9b39nzt4bYUWjAlCjWDPgv8IEjgLJfzuaAsrv9VdVG4OwOXW/fdoA35qAdL0BDwvf6AAUVHd8LIEu94A3K+Q+2YxaB84MOH62P//qoo38fCRDERE2zf0JfmDa+MieElAjcDPKz+mRKCOtdgGtXaBjgNJ4H2owSpNeAW/rRH4CaHSpMwnBYYycjgSJwfie9CR6mPu20Uv8kABF206AvXlBMiIBPSlB9wjBW1fwEuSb94296VCqgMaGCt/G1BbExi3IG+r3a3J6P48Gv/J0YmEYoiGY7V/SxwFCwGoE/xa0AJ0CEiV9QPCJb1OJ5F1VTjEY2/MO9AEJvj1BJTQpqLfTlGwjABuzT962e4IoKnyrdh3+/6mzDVJ4PHOxj0JqGKoy20+wBMN6D1gLWi9NQHfVP5MEEPzjGYy8BMAOnTAJgEr8HUIejRo5xrA5xkR5AngmiSHs+zDDAmMgWzTg55GSJEmHE8IvWPAoYTfhWak/Wn/bQ0CGLSAjv83SUEfKp5q24LXuQICpzrjrgWoza8xVE00CQCORdhMJuTUT/rjuls0gO4Iby8BIEgK6gS7BsGuTtDrScH/fR68biUHNVGBnxjeNyHEvQe/ve3LZQqgG3rof6cEclsNflG9J4KtaQ8WHcVBHS1BtHE4QP9OBMS98mpbKTeDW7dJwRsnHpMBTFJpV4I+b0kY/NqInVFSyBLANbnMSgBM8F+Fqfxq/h657/Up+GaBnwV9hRqc9bZ/vA6vu+T9E8KPJWns94UfTeCj2QXwCHS9dNL8Xf3Ho/rfewSeFODGDV69AU0y6NFAE1DP3qK++rdB7/1HRxf86gT376zOr99T/h/ioBiXWQkgQgVeIrCC/WomhDmQK+hASI2ARQZKooHMLdCJwGEBBXC3+uERwg+VOHZ9ioAt9H80AI06wGgJ3nQA3BoCut6AhxYwgcPOFnxuFnrphk+NIKIGrWPQtgz3b0i7Y6D5rs1GKqTop0nQX52vmQC4BkjA+r4a7Kx9WLENGeegkhSETBCrNXIMdi/444Rw1n6E96ry7OPuj8UfLxtQ78NA2iSBbg7gIiIbdDLsb5agPhLC3RkYKv8NDbS2YGsatNRAG2oQwf9ZIOydgy1MAzBkAw8UwEEIDzSAqdPQ6za0PkeJAMH3Z0wXniUSZoHvBXU2mcjQgv56TedIKglCpIoQfgwCIjOytd8WgN0bfxoR8Fn9Gx0Aj5Zgq0lIZbsH/ibSJoFnS+C98g9ooHEELI3gliy25yONIiE6pb0NfBlyNEYyENoodkKwgl6I6s8kARgJ4ZoEfuYWHLEJa0LhSBXm7kImGeSfVdoJ1DO2G7WXsehAptupSOoyrCSF904k+6vt98X/ZcM98Hsd4JYIXhQAIg3/f9AAUYhsLQKAtkHVBnzjCKhOoYl2ym+iBtvzDzQ2DLXJ4PUmbJHAVnBQX4jkxfvHhNDqAdHXGQJgv0aSDGItgOseHIU+K9hXnIJzkoGlEKzNHagTdJ6VWEUH4iCKH4fd2AwDPaYBm4Wgng4gQ9V/CoGiuNmD04AQtNGMGzSAAQ2I2pzfogY9LRh7BrbOh4+D30sAencljFu2CUFrwY8UAWRfWwGvVOVfbx2uIILM0pwDv082dUTw8hYs8L+uIWiHGpWgClnAa1lMPJogovvvbePPs/q3Xr++kgCsfgB5oQF9WYKPJqEn6G+OE3i5AqouF59FQOmahQC8rlPLj38kg1c2f30vw+XaoIX24/pMGIgSBoZqoH3wo0sIIGlA9PWcCPrAtpPB8eBf6x1o6cHra+2+tpIFP4PgBfxZtZUJfo4qxELT948D9ucK8Mt9+ccjIQw6QJcEbrD/1g340ATuDgDkFfx6twSf1f9xvuBECYxq/7ythQQGm+5JDx6Brw4CkMGT3wgscCUoQ4sU2t6DR2ciBjTgtcpenQoZVX9NuL4Owc+dVaDursYVkVALX+shjSBKBuvCYDUZjE5BdNkxdHAUBexyHwB6NP7Iyw7sxUDViwge1t+mz8B/LAvVx/c3PeBBCToB8IUGOgqA3iV4yUg6UAOxaUFHDx6CYS8SorMOue0CCJGAf5YfRhoAI+A1CvwxqNkAY5yAIx2EQmkFfeWOXi+nEdSQQA0ZHMEItiagJArQxDXIrj8nCfQi4HZPAttrIahso9oPQ/2/JwV5JQU8zw+7I4D7/sBn4EO6rjw0FR+i3Z9fHtahzsFvJgM0X+tmVH5vaYiNDGAigewAz+gyNLThnjCURQFR1b9d3lZvnVqmj9mEPDKIUIC4KCCjBXywS4N+otp/Hk3QVthOkwEKlV9PQwXjT7s/zwF4Qf9toAAzFdjuaEB6S7D1//U5FIQu2MevO0rQQH8ZmoXE6B/IkgE60XCjVoq8gt2iCG0S8L5GdxkM1cGsfsCMArSCAnrr7dzAZxCEEpepvB8tqHJ/q+bmJGGts/AcAXFOMMeTwC7Pw0B6CtCtA2vWgonqBQJFSwH0JQK29OB2kvgj2HHXAoyeAIsCQO0kMNECAhFMqCBf8mElAkyBbX1tJQP2RJ/ha0gpAfS9l+/5n00CkrQpq0MZbOdAuxmMvHswog62jZj7BnYQe19b14kxNq2D/ehX/p68HEcF+x3yP7z/V/A/q/5DA3i5A/dzA5pdgbKp3v3/wQF4Bb70WkCTHGRAA6+KL0bFl6FJaFw0ImZwm6igSwbbwPn9RMBWf3sN2JgA/BVh/Rg0kQBgePf6HglAHLFQwqQQOwDjbdVxNZjR4iM6Qa3WxwvNxh0JFb3g/WzFQQS8b/ttKcDWoABtUMAd8j9hf0MB2uDXhzX4CHj03L9DBU3Qjz0C0l4mLSLQPicOOwZoVCB6P6dA7nDbGkVuxcNr8PU2JQO4wX5trEqmccZaHU4q8oCDFOpzAnOwqyMIMktNNNAHouDGxO37DgArQZzlmp/14W1QlqHTMaIIx7SCx0+5yza7AKJ3IXBrNAHVDcMZAU/BT/vgv/ULPOA+XiLggAREDF2g0ci6xNDRglegd7P7TWWH5oJfayliEg7bScQRBVgI4Ookg/F6rvpLWP29swREqA3CaG8/FpKqS8DTAV4TiBqIqtxfzaQRLys5I0XEFIFrPbZRQb+16Fgi2LvJv8EFUPW1gGfQv1T/F/d/HBnccP7rAwnIIyHI4ArgWeGbU4eHy6Tx/EeTZIb5bo/BsMBjmjBE08f/RB0PHYBd9eVRAGY7cHRwiBf8WeCPHY1bgBTa9xKTELzEkQX9CPtl0gJiqsAmCT7I8xbjivh3JGFI+D2nBcSJQJ8agDX+O9iBL7UfG4bzAkcaICrbtYHz1ycSmGmAjJfL3CMgT3tQpmrfB7gxSzC1DnvdhQMieG47u75+kTouKNkM8c/+vq/Q7ZYjO/hhVvRq8F/9gGfhP8aqE9EIdR6LTwJ1h0BItyDqB8iFwuNqASscRnYioxOg9ApvnYA35f8e9Ohbfe8J4rknoFkO0lmA2gmAG0YK0DkB4ieEjiLoMD8wBzom27ANZkzIoU8EMHk/uo1mzeVoEoRWKn8L/62EYAX/lsB7D/LXg74uAMr9oGivJ0CNJCGD6i9DhZdQF+gtOp4S+NODRzsDVbhdgv4BqTMNyIL9SCKwL9/FGPp5oQKxIf8A/UX6r231H7YIqLML0Ae2GtrADOvRQH5b/MPE9dt9BGLNG8jVTAQvIaK5TtvvvWQgDvyXIClUA78S9Nfg7VtIBlO7cbsEYkQDMot+ygQ7QwmOawTHnAM2XUSnJvPIYRYMmYPS+sv3J+cfP3d04JYIXsF/EwMbBKB9Q9AY+BiSwFj9mzrSXmcJhFPVHySTbgHJCPvRQ/z7G/SVUETsg0ZF+i3CRoCjhf7y1A9mOiDD7TwdwEoEXjLwAv+avLE2B7Jnb+OqDpBoAchoQJskxKnss0vu7Q2YhcDv4ySeLOg9GsCKiUIihP7yfW7zbTsBh0TQfN0iAWn9f72Z56/Ax9P7j5OAH/Qvv3/QxKfk0DgDuP+R3USg3bzBC7bO/QT9Eeh9QvDPG7glBQzJwK740lAFFgFk8P88CqDGAa223YckWYhr+c0BPdwetl2ocnsfzePAWcVnnAIp6gDVhDLyfV4nqFEDPxHsbWD3k4BDkN+pARqKMLYBPzYEvxp9xmCHQQdgWH/9EtH2TIFpu3AH/cdGydv1j0TQbRrq+D/mLcX3ZACZ15bF378CG0My6Kq/zoGOQwhASDFwFbxyNGBuSxbCEhQ/uEPe/6gAERWQObCVVfjPpQX+rexxYhYFxIkgpgX7Y/vPs+Pvxf9vwt8kAs7i32t3QCP+3SPaTwIytQXP38u0PESm+YER+o9B3vr8mETAUfDrEkPI80ck0FZ0dXh9U+HRbhey0cAc2H7A4y4egoD6y8JfkBiigLdFP8v2W00E8deT2IeAKujZ/QAVKpAtKI20gLWksHedfgPcb+0+NEHefd9vB9rayi8h7J91gBbaw20MsnWAF5xHkyDUCOoXp+yrOwwxcKj0aL6fFppaaKDv6OpHR5sgx5BAlK/+fYhuP1D196o8e7lFBaKqv5YIMnFQpd0FGVR35RJCnCDaABaXBtgbiSwtICMtalKC+1JQ6bx/PLcDPQL91QFodQNKpwOgF/9eqcBxBBqRcKAAVk+ArQOMx1RYGgB6naDhlK+uQQwJYx4meQbxtNnYQwMjt/d4f3M9ZE4UOld1LAh99fbfzOxiEkKFCkTJIUIMUeVnJ/9sDt8/e1NEJOi9oVHDGYhgnSLss9DX2IAqw1zALUncKcDr0FB5NP+0cBQNrEezDiyiADPkt9qGpwoPdL0AGPx/NOKeyf3b9WJNdfcFv6bKd2cLMJVfJ6Y3B6wB9WFUfWWEwKMfGiQL+3bz9XGQz2EHKhF41GCtZyDi/gUCsNhYoAr3UNJ58YidHKqnMb/6AB5J4N73/4L+t7mAkeeP3P+1LNSB/l0SkMEd8DcEuUlguEw6t2AU/PCE/q++Akw6QFf1u6SBrj1ZnnhG50AfkoGIdf7gJv1KcSfgzWWkQ9U33Z3tHXYASKJ9e/YhU90rvD+q9Ej69/wxYJVs506Eg/r3DkMDzEdDBRGgcZay49XihLA30P+l8N+hf1f57/0AoxbQbwYaan/rBMirE9Dk+sBzTkC8JNDEUlv5McB8PP19Y01Gayep+hC/2zvQ/2HGLAurowsNGlA1cnqGGzeH5weiYLZm7h3QQC4O2tXdhvMMk1ZS5ebpgI8eMrPvPGkwaxayk8Yc6PMOBPEdC1XZ+2UfbfOPtxLMQQAG9BcZFoF0gp/RKjxe7+oAw9T7ZPWhgedodgz0gf5KBtrtIZhQAZpAV1Bi36w6t98qVfH7hqGI318lLCjLCUFlxRHwqYEH9a2qb4XjWvDT7kBwfbZA5P0+PNuRuW1yf4yNQH3zzwv6b70QOJ0G9OT/dhoYRUGT15uQH/71MjQLtQlxfDuiCXrtM+SkA+icQdH6sU/xz7Ze7FlubV4TpoTQ2osdpaEjtqADmEU7OkBEFoLeC3IWFFeswJXKXzkboNL+wzcFHU8hTGKIboO7CLi1/P+5F+gydQhuvRbwEgxvtACmANikhLTbj0gCYk8KdlYgmj+4Ymaod7TwahwadICuX0Cm2fE5iNHPK0x/CDV66Kyg1MnqjNFBnhBoLQCgUULfaVe5nq/6EQWY67bXCszUb+7232fVPz51iGB12owK9peyP1T4raMFF/OEYJP792mgXYfZ04GHMAhBkCSmSj+dKqRPgVFGHbpLEGMiGFeQWfSgrY52VxaeDUPSNJI0P7NoisG729HHl78z6hxfs9rV3m4JjgM/lsui2qmThjCfDFSb+I9vwUqG5wwL55U7C+6ot8B+7N2o6r3q37T9trfpjgmTvv7PSQATLLeRAOZhIJHBQfDQQJPBdUwEbVW3+L08EcEE/9G4ANrCeWcnPKRHDupbNynMx5AA9IRYLmrc/YLSiD5EaEBS/s/TgnU9ILcH19n+CpHwegLejx7Mn/d25fdN+e9U/1vgb7bqf08MOtf8EXxaoh+GY8L6gDfhvs4i6HQ7seYI2sv1GchdMsBIG3xlvxcCRzdgCPTn+6q/TW00VE8Q9FaFv+R2VlOM1vm/hhjhDCdgNflVKME5B47I9xT8z0YgPAJ8myb/LqHy36j/Mwqw9AALxuO1JVjiuQAYLcFzIhiEPe05fk8tRjGw7yWQbsfuLAT2VqOId1osnr0F49VM8INACPHDoBz4B5mqqSnUgyh3ArjXxfQH5BbgUS8gP7aU+w0zHD9GGD0CGHf+P1p/DeivlhU4BbxR9a2kYFR58YaDZCUR2P0DMmgED2eg77puegy6PgDphEB0CwlG/i9d+/Hs34pBEQrBn0W51mqGnJAk3ACCHeiqkQ1XFQA5AlKH7Lk8yJKWY3/nym14h2C3JvxeMwD9ZVMz0BPMi1n1RbKl1cYhIVblF3G0ATsRiCMUvoK9//OgcwYMoe+ZKOLlC6/Xk50br9NFz9fanqA8UIYSpCwlBO4kHc4WLLBfBHVaKwKgLQjmP4Un61Vq+3s7Bsyi0WztmLjJwJwFeE0I2vD/1Q6MVwefxfUf32skCPbCnxQqf+QMPEUDHZ7vGeyj020JgkPXXwsldA7SYR1RE3h94NvNtugswcgxXEkIcBPCGZ1rmrgDC0A4K88nm2fn/eTnpQtWyZfybRoK8Dro4zYDIMGsf7saTBzvX0SMbkAD6o9CYbsfMK38cJKD9l2FJt9/VGs0h5Gib33pxMKWNsigFUh3G2un+/N1WUglI/EEx8fq27vUNnwsiOoKecL7kQS8VnWAGCFUgn6dBtQhv40CmIYggwK0uwDHRGAuBXVdfwzHUjZzATLMAoyJ4FmBhzaWBlrHld9CCWpPHRqofBqMReMGTJ78q9rDes1Tv7/0m0v0AFHXNR6P6g30SHivin7V1BOhh3iWPwvps/yE836L2XiwnUT8x2iHgfqhnwn667QHEE8oLQjEvtEW7GYBZDrDVkwNIO4G5GiBDf9fGoFM6n+vbEtzXwP6u9AduaWnGYSLAlVdl/AU+ikrSeEIKgwdaZ4AACAASURBVKj4/wtgHcHtdO2nWKcBkPfxcvnNQvsj2Me9f02r76T8q0IBn9OLKfz1HX8yVXQYGoAB/2UeBQ5/5kCL6+H/OGGoRnLSwdd3oH8r7KkGTbgIxEwVWvnF8KOpHnyzfF9Jod5Px+IF1h8owyitDw/XEgRb5bPqbt1uvn7qBIQ16vtS/u+DP3cR7CH0WWJgd5mTJKYgNzoGjQrfvu99NDBC+bnyW1x/qhTatv2OaMKgJWPvv5kwnMgxHYGFRtJW8VMl3uP+MgoqSZyWFKr7+KIDw1d6+IiOgZI4+d5iYL3imzbgyO+tph9t2oSBxOM3ugHtPoFZ1LM0hF4kXNEBssvVgPdjdXZWK7uKvyS3q1Xb1WQwtVDqSUggq+Vw3t56JA2cz7PXOwGNW1ecwxPhfe3QEUsDsFaAz8jg0nf+iZMAHNg/XSazDuC18Iq1HBRrOsAQ8NLB+16g614jmuSgs3bROxE55D+WDDQNA4ivdMJ9M1b309UqknaDU8ObV9/PwmMPATvTMAxpABLBzugUtV9bLdhNDQA+7B9tQJ06/7QNDHGSwtgZOCIA47InIoDdROQGtt0U1HI3GaoUnCnC/rzBMQJteN17+VaAzYNA7e+PFqHQUyXPUYB7iQYa5ZFjq1Zqpx8Uqu/XT7+6BWC1Xaj0GlBIwMoHu7UzcI/6/Acb8KIq+hzmGWmAYnADrIpvKP7TZeLaf0LAeQkGgebbq9FToI44p654F47tekKkI0L5PQNZPsDwPBpy/ni+wKMN76Vav4+2cFZFf8+JwAraMt0DFB7beA/u4Zz/a+RXx0M/ct4/jwaNAS8G17eSwmta0Fhx0VRxJkHMivso+onMXr+YwdWKbgioy1jp4x4AzIKg5lEA7wvHEYCRmdx11TAuT6lDLVl4KvXkAET9P4RT8H2u+lg9EPQIpw+/NpJ7RwE8HaDv/Mu4f3OdNkq/EfAiEiOANjEALvcWL9gfFV4NZbgbQc6qPky4Pm35QZxtH1f4j+P/jXuaYPcWwIEH/fmEPBoAO4m4LGxV3txOQqDU+dXgey+UwSzuqP++uImO/u/6ogCb7wTc1n61sL+vZi87rxnrNas+giTg6QLzaUCjIp6JfhwtGI7AjBBB9JjDY4ePYVR6ZPgN4owVv6Q2N5hhVHwNeYrM+w6dN6K1sMHZm/Ce7bHe3dzKr1xw1w4JrSQMZtgnoQHlr18fzunAszD4qurNUg/TDqzx/lfCaO6t4tACMUQ6P6htWjDPC1hCoZ8kpODzJ70MUR9AODcgwyqyPhmE+wfHYB/hvSqt6qeXUShhXH+d9SR8DzrDaZZdpSp/HxqLMQuATgDU/qDPRgOIeT8cvz/h/XC6BtE7ACLOWPE0KIS4UUjmZaJ2grBphiWgT41BUVWZfP3AnEIT6OrfoF122l2rMycBoU5i/OXoUZ4/aglsXwLzHNU++FVF3qikOj5HXm2PBitT1WuvJRAB+6O//W0/PY8vQH5IrAsMs/WuVmAdHBrQgrbOxJShXwRSsu08h8JMBpo0+aDTALwV4tbswgzHrftG/dJKIAQb5h9KCssWIMeto+GYqG12/HWGjx8kzqNJaa0noMWOr2KwW01AMwJoNvhMQda2/RKQP/3ecABM3g9uD6BY68Ntz9+nDOMb5iV+hIE+dP/Zs/wwJhJ9mgBnohBuStABUXjugF3hkXF9ZZJAjefKdHZCc389LoStKvIl7QIEb1d9RyciQgFDI9Cjyccc/23Aam7/PZJBhgDgin5CtQvbCzX8ip9YgIFtOAt+w0owp/hOiCWgEGbVHuYjRigPGR/YOnEoqPDoV5z5YqB3mRq2ox5ICmSSgAP1Ne+XV2NE+/vuFbCTRADxtS70VRBCjgBk2OyDUQiUgfl77b7DwaHm2rAZ7osRSOOUoHgKfNBSLI767+oDYrfwZvqChSpGfj3pFwZFsCJg2jeIQQBUiyI4WgD68ww4qO8khuWkkIuDrxWv2nv+UTBpJYiPd0KemTA8qqFiuUF1jWS3BoG6pADJq751JqBI0wvAVPyMQvjcX1zbELltKK+zBiXRFiRxG+b7q3M9xuLdzR8g0gCGNzSM5gNYfqGO9CBT8OHct6oB3KsSDBisUnwsFuISQaRHxDSv0vptt2oeLHMERfRn/FG/Cx01EpgIQG8LP+/i37PKw53xn6sYCM4/JwSRrCnIeB1ZkLsawDhaPKv/njU3wnZ/dBdGE8+YTHSG8+ofGgIjsC19YnwdM/KAnTSsqj6ig7uGgIPw3nYFzhhIIvriAxFP9CQd4HSlnzgxONIdrE7A8ZDPx9fjib8ifgegNIliRgdx95+E1T7+3nQVNNhEzDgGA3T2rEDLduwtPpuuouPcs8swwXFjdTaMKt+jA5gUAQPcf95KJQxYU0cYxEDvsBSmYuukp7AwnqniC9Afa5z8vboI68ImT0t26CvwBzSggkj447r9IojvCn7U92J/Hw0QSdwZKNNjxPCfSxRqnATkdwpOwh88oc4J8KTSm/wdbZjrc+4iFP8YO0/5JJDCfaijK5xVXevqfg6zGRrQf83chvX4aRfAE//6vv5+6490U4ADdO7QgM/5bcHP/n4OtCQhBEFeDWSvos8DPq8/IwzLzjpa8/U6MMSkBklDm8e0mn3QIY7XG1Om8wzN48y7HwhOK3P0/ZwUQHHv4psbdoVeb9VlAjChBCdtDDpOKTh9ZfcagOYq31RFjN4/gwBYzp8lAwYNwBELhZoxECeZxMlAzWGdCRV0fQWGHo8+8Kx+AAxnCIzowAxy9KvNepWfsfp4RR9kUrD88CPVTuXRybhqqTHcnxEGndsgub1Gdug8yz9fHt3Hpl57x/mfCOC29FOSQ7/noAZR5W3Ob24UMpuPYAYiQrQgk1gnFoUIKr4vKFpV15pHUJO3Y5rfH3UFHU4bGkU+NKJ9f2hJyOMxDBDpjAgwiYqvk5TqNl9EH2Arb6fA3yaA4cBtPWewhkEcIQJBlGzYp6zRmr1v+e3Fv27xpzvyI44NGDkCIi7CGNV9Dw0M8NtHC2vUwHINumCGNG8erxOwtQINsW88Tlwdoc+F85nI559ngEDpt2F/Uu3hiXYrkN/pBFS26hYDAkFgErMK67y9mGBA3L5ore5izf8b3n805MOq/t7XU4WHv1DUF/5gugCSOAIW/59uMwl6CHWAib8bvfxWl9/rBGEMTTwDfG+ezEYG4yk6FvRPuPwE+wvc39IRjENWM+/cm5b0W4Pf4WuKUnw/vD6eDbB1ETs5vl77Dhnm/51g6wPWwQAqxnivgQaeS3gy/u/1H4hpTPrIgHAN0mSgXUX13YP5PMIuQAfBr/f70cdeE+QoCX3i8nFMLcAjInBoAIYqt1LhC1WdtvmSab28AYffaeivCB+ohdYQgfUa/WS4ToMsNLHLc9nnvPZLwn1/EefPVf+U/xvnCVSEQEkEQEnEQJO7S7RvYDxNeNYKrG7DKMhtsQ8cMmhgPKKKj+F7CiHYFR5KIIPxOmg5IVAtu3ACQSPh7CzUQOgAej5CWEkIe3vgxz0ROGO//qYfz/dnLT+ZxDr4QW0eNCJBorCFOVC312Ec2TiY5Bk0cAaQmiA1VH1MOwDHQ0kHdEDDf+2UTWhS4Z8diQMicLx8MLBfverLcP/jQzF0P8EJj5+NGK9RCz755S6F/f1+X/gxeP+Wsedv+vF8/54aSPJYFjIQd624MDz/UDLQnr8HU3ztKHRf8Qeno1vyAQJBaLcMtTV3cvgP56COCqd/QP9xLgBkH4BxO13n4hNUDtACC6G1S3zqooZ6Ba4lp/zcAFb7iERKQwQcF39IFJjdXECGADw0IE4gg674pYAnk4HoHPx54tD5daO5vxrugSkMjgiiqc7TVKAT6AT8R4ckbHEQCYR/IZBxJgA+XZjsR7vaoRpIxWqeqfXuGC2CxwudicwePEB1kNkaZCuwyF0DuKv/4sz9mzP/Qxdg3BDkBTMC8Q+loD6UGBzx0Kz6eAX/KArOQTlPHFoI4vVtf4rNuLrca9edRn4xBP7k8w+9AgZCgBfEUZWfEs8iFNZ3UO7TqmkjCO/rWdgco/yIqHcQWaC2EGTzgz5y/iXQAvyx3riyxxV/JeBriaGB9OrTA5g9/eokM+37GszqfA/UZk9iW5UnCtBqBl3XoNN6Ag/+zy6A5evPAp+TIFDn15gQw9rjrOzFX0s2JBVAxa/nP1a6AsNWYGjPNGPLTQgBsNUFvOA3Ht9o/rGDN0tWOCcxJGp+f7++kkP7PxcGv1+GjkaLt/fawpwwerQxBJNW4b+PJsYEgiAYYdEAGIlDNaAbRkIgK3ut0jKByp+8yz23X6GttmBmjwDvChgiYLP5V/zhH6/110sGcKo5CkggCngxnIPoPja0j2B+1BRkiYJiviaLJqghDI63G2nAgAxMCuDdnoD0wIQm+urMB3VuAwbBrFGgGgnhAFqg9+ujKsLxB3qGCQNEEtPinIQlAj4WgIw7/iXc9V/x/yUWFs2KH504bAh4aYWf4TrTLGTy9YbftyLeVOWNfYNyt/ji29mQnqMAltU3ioTtbX343yv/1u0YPUBz6zB702tQucnX0gWaFh6DgPdmhXaapGotw0SFz1qDiTMdd8h45HfcqCPRUhA3+NmKz1l9teCPaMd4urGaewRitNBDdahR5c3AfQmDCFT9vmtQEwqAYXX4XI2n23Z9B/Yb1FL+LWox6wHGbZSo6FR1LzyG+3hriSZvWT6jfXhl2cmQZJDrAbuYAqAHo1GA/EOgD8eGcU7A8eDvH4fQBuAhBL/Zp/vamPTrRENDGLTV/7E1WEPLDlP/PwzU4YhusIMUgfIPAr6Dhv5R4y2r8ldFwiFoYHnmr8TAHbhRQSZOctH598ZYhqt6wP7q/ouqe77RJxvzFYaji/z4vna4v5cUMDXqDAJ5ytktqtBDckyjvJg04hl16LB0xFfyMfD77PZjErGQRRjYIfSvoAXntks0ok8MsUC4KARWnYPlJBeIgLeFrUgDOHYCag0/XNAbWgRwQuLAsaQwIhC1g7+jCNKuT38JfnYSyTi+QQEwwHeT4/dWHYxJPxfOj5oAnRQqgU3YgGZSOaDyK3n/qkDYBKptzR3oD6B4fyRKjp2AzSl80YR/3P+/1vBjX18Jbu+YsrMRgbqPP8zrDLTAaupphfeZtyPs9BPztpLSBZjowF3woYRwBwOWaqbev15b7X4RWsiqYiY6ZkFEIoUwUA2OrkeEQE8HYNyD/rl3m88jCGgO/nPW3xy8x4Q/HBcM1dYg5q8N+B/SBSYhtD0EY1PRGLDoKIBHF3yLz4H/gSYQJRETgqeB2d4vC8L2NVnQn4PoVJJAcP0inahAfdXVI8CFszjRagCTtRdV7Sr895NBpRKXIT64RMFw/iw5eChhEvmmyUIH+k+Qu3cLzOAN6ILlFvgWnx3YWFDz0f38ze9GlfP6UQ3ojEY0gtqRIEbA5/WgQFhsEuIeL75uTzvqHktAWfj/OD6sQXssROcGiRgFn0QVkld7OznMDT7CJKzhMIqxW9B+LCOQdH4uyxIcE49VTSeLj0wKjzcp2oDXQA8YoDEGBLMW0BJw+eAxXejPV/IXd59/tp5rVyYXDw5BlRetSpQAcvgfOwVM8ObzBq/AQ2wX4lwkQV3vNhYFfn2LFgaoDU1ogqsfqGkJYmrj9Tr22KQwBLzbLuzDeA9yzyJjVRfwegWq0H+FThDPA6ZhZwX2M2Kh4waovCzAWJTzD/qY00c+6PM8coz08VNqglzx54LfHuTJK7z2rwX35ABLg1DzsZ7Qv7l/f2yXDlbf4C/irg0MJ0aCuD0wP74MrxfdFlX7tq+vtRdCpvt599EG9Yz3V+P+Oj/n4zLruZHcJ7oMt/MNp9eD6HEeFb6/TMfbWo85Pb79HJo8t3371/PuIAZqMvjPC34nVV6ZB4hEuA7AzA5cfU0y2n6ux89D/35/n2/vWY5Bf0qwf3tPLISO1Tap9qzFB6eap/beqI94NCCbGwgqOItY3CGl446CaQ8i2Q9g0AvmgJOnBoAA0gu17tsKtKS7D4udgCYERy2QIceCX/P7mBW+g/7D9S6Mn50CS0eAoQPDcBjopIA5+EcxEjLweRjXq0UbLIjcBxsGx2IZvlf0ATjz/6qypAmY7bhrk4ahsIis6ccXKHdueAfUgk+RWPCLh42c6zEeKyJpRTdRAOqBbl/Wq/uT+q+Fx3FoTIuCzc6+hN8j4veGjuAnhSE5gKnco3A3XwYlq2sq+lmP4yEOpqEoG0M+mGDYuYT0pKCFHgLHKt3T7T9p8GcWH+n1UwGa8X6kQt2x4CeqPexegT6o/Z4Cr313PHdgrsS2ZReLfpKIf+IMFnmVmwxQ9AhithYT73+p2s+JIVfrjwiHnpAZrSsr9CMstQXP1+1+510N/q8E/YoekMN9OMFvi5LvkRDsy9rgFCOoPdpgaQIWBZjf5KCSQszZJ1ivTvLokpen6tsJAVND0NFqb6GUGg2Im4Dyx9Pn7/0dm4pADAslJzTv+dKNrAPQ0wyySm7bj1RQgbAXsRa4R+mBJzpaQmHLmy0BLoL+Nh2ZRca8uUc6P37k97n451fvTieAE8BdZ2ItqFEK6oOJIYPsiU4woo140Oh+H/UC++gatHYcOFT+2y3AYvD1rM/fpxdUcsAi70c0OxAEP45X/hymE9XeoC0zfYhbcqfbhs09HpwnKMDR6g0mmYyKth/UcLl9ITGQ8N1S6s+gA1HvQCc2pluPvN2Br8SyZyfyxPP/VhCi1L1HWX2CQCuAE8TIq/sBYdANZmTIwqq0sb0HIzhhugBeUpBZLFyA8y+EErsBUYDZHYN9QAAooQwOws+uQlhdESSSqk5Qsh8LSYI6LDS1AbmOvLlRBqQIeITvM36+TP63VfE5hFClCTr9zEyVFwS3STQBy66DMHB+PJWIrfgGnYBx2dTboPa2X49GaBVlePA7CFx4iaGi4ns0aLVjMGvtPTDtmO4XEE8E5Kb/8qYai+NHl60LgAICcUCoJPVeiYG6Pxw/X9VFNVbFn9FNPzXoIRDTyzcpREYB5Fm1EQQn3KRi9wKApR8Tz48SwxnV3qM0q7ZhpdKvr0zfY+gO4oQf+EGPFYW/Xf5hwWsUgxiBbShGoGIx+D2eH1h2EeR3UQMH4zMaUKr4033nzkSkfQADelFbLOQCalxdxvN8mInhPas9bxtGJw29Fx3Y8429MAS0fL33Oeo7qFZeiToCC3B/VSNYuU0fgDnkhxGgMFdxiYEY7MYel+OHPH30IMeVFK1C79l+QdXVpFqHlMAXEf3EYDyfkkGdNvJ8f3RAXU0jpgM7jMNA5yCrtfzOicKG/M9bgEkEjqqPPDEcDfqVwGZv6zcO9avDfOhf4OmLFd9OLBHHdxp51HvOBlnAoQksYjASA1xnIhPsapTCPjbsGB2YevpPpgM73EYeSYIftgPgte6CWesVBB9QEgfnWYMgoeC8ql69bWoRIqYHvSIv/u26bj/jdqZ9KSGk74JRo6QS9PuTiSHm6Z62kLUGH0UO4rwWrhtRETkR4iKRdI8giJ2D2nUCMjsA0TXiVDb98NAf/rCMlajA9wesWHZrAe1dlwRyVI2jx4KkyUHSx7YDe6YD4tOC6XW01puEdAJwaEJzf1uATHi6ZlSCpBQscsh6C1xRcWEG4bCFeKcAVhVlDu54JQIkTT21hptIT/Afk0kMcS9BKfjBJozcDXCrtgbWXxbMAw3INQIxtQJPAGwXmYaBbYh4SCsuKwLOAQ5awKskCMmRg8P3xwlBfbosQaDqyZqBkyQe1CLQACoTgN4qbyHsPwkTiF2pYaj6MAXBmUosQHnUEYCsBL3MW39SNKMJ5PfoBsT33DVJCEbFnBCMOkHfvj6Xq8uw+dgRIhGgAiUqf5QgKDFyhe8nnYrlqn9sG1GoAfirubygX4H+8IM1CmQrMFAJ5ExzKIp54nPoVU2Auh6eBShDlTV4u5c4HE/fVvjFrsII0Ik6QX+Iq68jB19ziLoKC27FYe0gC+j1RSS+BgB7AvAM3m8HLdy5fV60C8RMVuhD1ieQB32MCCq0QPJuvuw5IHF/geMKwOPdpmsxBwVEfGEOgeincJqNmuSFIPhPq/xM81CWIIi+gCFBqDX3QPYd2OcCRo6GZBoA3AM+00aesAOQ7/2Pe/vBCXoguD4OBD1WfPwClzcui12AuH+gC0gEwW72KfjBCQRBr05D0IQc7N8PzOCMehPWK384MPVDJQim7yDdoiRTItzzFV/ZOX9sYFetP0fsQzb6O7wOoFjxk89YoQXv+BmSN+yYHYO+BsDRAXHhuJXsEFbdIEGZQWUkNVNzGA9NZUVBIQL7jASR0AclE4Pb7JN3BO72mG92+o8UG3nybj+mASh0FsLKn9GPxDrEcS2Au35BzHO1BksriIJdpqWjKR1wlpR4fN977rZqI+XbYjYDgVDpcYQalOYKMiuQbB3G6Pu/HlMbi9a0EMkksXtjvvXTfgMKAEZRN/i/O7yD8Da2S2Bdh3ICWfp8yuMkYl5a4df4vVWt4UF0yyqEnaT6swYyWB8/j111Y1ERS9oB0SLMtBGDEBD1PEHwtdjUEAHnqmoHU4wCDAoAS+lHwtu9eQLUAgmxVvAuMB9cELMV3m8EUtcBYYI9nkNIEEJYrQeUHfnzzRyC39j8CgSkir/E0P2odnAmAqDnDIhqrtV9BDNS2POjv/0pwKr6z1h/PMz3uf9ykFYq9TtoAXSwpz0HljdvBCVAPY6t7osv6gFhMpkX13rcfXQMIpuTsfTibkfOPRAC2meLRipI4mDPwMD5x+v3+Ey+qEfACwoUEkKQSMZxYJDz9R68PyP43yvo2aYf881rNQbZgRU/jp80QnW/hdXqJxMvCFxXQSNHpE8QiF4XI+wFfQcw7VL2Md7RRajsKgh2D+6SLAKPF356+/7yXYBTUgFy/38StUjFHweD+iiHh8/LV/i/TSvGk4L5x7F6AsIKbgb4C0YjgdGRIToGUx7cgS3JKP8pRcgak95BJGQbjaJdBYQ1qHYnYHL8F45QgHx2gLMQ2cDxBD/4SeR0LSDi5XzPQNjM4ySE/HGG6g+ugltLNSARn281BPtNO72eJLjdX4ITSEgpQvJYFEUg24f1qAYQNQdxx6Q/RcB85j9f+03zf2QV33IDPHegNgPABTfqFR8cZK9TA7/ll0EQbUUHW8Gr1d+MSadia+LRHwhunv87yWoJ3h/pRDwJAbDNQQFd2P2mH4kP/wDT/ZeN3CK3+ZjvgVpw4r20AMafb58j4N1UMknuj6iCx883PU9g2VHVH5JX2eEcPghSgRBCKPzK0Q3fknwPN0Hk0CyC0zBkz//7duEetgFjVtypASDI4CsknYJgYDhqsBxxy29+eyxrAZX75EEf8f+CkOcijMDDHx4ASYGGu8WHgPwpHJc0qOG8FgFTuVk0cRZVePFwHEIUEu8xSHoL5qWg4I7/HgOKXe2dcnu2SSdCGIDTA+AcxY1zYL6Q6AAFu+/1GvjKPSeEoJV3NiM4Dz9C6oWkEav+NWjPWXNOIkKgNTi2I8LeBgaZHJxqrC4oNXoB9pzzMws/OW3ghSyQJgjbygOVEDhoj4nHLld8HPD6UUMFVLIgKrTL7cFoBRLQgEdXIseZ2/HhFPKbk4d5tYWwwR0nIFQSD2P5gQhs6meVfB+Bkyz2fOIvX/zxqsSODuAGIOLtPNnmIPCrv6Kqvgz3q4tCwNl9lWYfnsdHj2HTgQw5IBHwULmfSu1jEV3gDFSxTBmqSEVqiYK2IkWcRiAkwV/cyW9YhqHXDw9dkNQAcO6HFNJT7oChfrPUYc3KY17zAd+evAwF2w5SCKLV4EuCEKsKfjBVWHu9Q9Arh4CoBqEMWYBsNX7YgKP/69uC3M7/mOOz232QT+ox4iCyJGEFP4oBHd+GVvXBwX35nqp7qeIbV6L6tdZub3ueJ+gBIKgC6S5gOQFxDoGr+Bv2nzqbknd7ph/EmXzO0o+kZdc/wqvQkAOUffVMzKtYgx5Vob1/+HAfCdzHSiXHenX35/2JTr3KZ9Ruj2lYiMhLIFoNyMq9hFroeYMTE0bSLbhb4l3YlFPa6hMd2jk8dmrDgdQCnC4/+ANFlYTB6ATlx2GDGXP1rvL+SnWHw+cJes5/rRWt4H2pw9GklD4uSMpwasIQiaYR92gIyFX5S8dtRZt/nCAH48VXW3hRE/HKOsGquj8EM85Q9cfeAV4XwNGAlmIFIwPYrfLKuxV476RRetzcdeAsRSZhiHizCKEIOHn3EMOWy5X4uIJnXX6sFiBFLaBm/THOQAkVJK9j6TKwiSDTBWpwHkSPQJX7U959uAkoaTUuug6oQCBz1Zlxm0OJSIoIw04M+7zCGuYiznCfHww9AN6Ir+HXA7lfn2oBSJ2FOOh8SzINfmcAyITq8JX/sOMPx6A9LeYtVfwgCBZhdu25OB9/XmWWNPUEPD5dUuJ68wd1AqD2+w1PI9KxE9BW5t3z/igdYGWiL7L+wPv9jgVY8f0ZcbCKCuLAHN+c5wa69Zpr0J9t2KnpAGzyiAIPiFalJ8/xXrrA6Y+/8NoDnWCPNwFJzf5DpVkHte8hx76P+HU1+HEytEeSEIzAsu5r6wPJGu6oLz8VrKofXLce+ywIHhNa/Dmw8LrptWXZ4NKZm4pr/QQ7Qk8ehMrPtAF7PQCD309QgRgRZMKgAbFREAfBBXNalbHA9cEHMo4IgIUuPjjBWEUFEQpYTkhVO43eRiynJw9Jjj8TOUIlJExK+0wA4gWgQvcFBHAc7P4/u78/Ff4CC5ATB3P3oUwFClYgcALcxzp/B9Ez4DUV8RjBbsCBrMH4dLNwIDaCGhA6o3pXksdBvYBsktrXDgNJKAFy1Z+ZGIy5NXgXoBT8a3ZgVSPIUAMV6DjLxhsV8wX4n4ibbONObHNyCr8Z4FinNFjg8ziiF5zSV8A99u7Zdf5OisvVaAAAG3VJREFU/kIPAJLWX3hUIFD6o7MD4WkHIMXBk4IftSrPNBJVk0OoC7ice8HGS8XBKDoz/YFBLaQi392lGpCMJfhD9xVkx5Xbj73P9V4m1j0v73x9FjDDPlYvATkgFAVWcdNvJBamliOjAwRV0EpeRymAe717kMYRyy/j5FwFBX0fP7Dyx8gq8wn2ZXi8GfGYR+lFcGJSxa3Y84WgzBHetlU4cvKY44Ps4iP9fsgsPGEhQTAcHqwwGCj61SoPexKwasXFqtxq8qhD9SixoBBYcJEDNzmIoi3J7QkoJActVHocTVpPBCDhElAvMDK1PT/Sq3DwB/ygmyB9GNhYDH4so4Foy48kkPtZfZEv1PQTxYpyX0EI3Bu+/5krcN8fgwVdwWu2JNVNWAk+PcOOPMNdGFyAZ5Aj6gicgzNfwuHZg0HrLxBWfjSRl88fVCo/apX/IBrIvf65ZxtEoK9Bec4KZIPLe76osQns46NwW0pUPCPAyMc4A/KXOwZzFLGbAqD5xhhbgBcWfoJBAlarcCSQgdQJ+Movnih4gjZQTw51rz588y/ZgxVUEAQ8soCfX8OR26JwujCLGFAMsOjnwGrlPuQw9D/PPv8BYVR7pG/eeFtQpsLzR2KFI8SwKj9KlX++HeLOPuSBKrKeHBi7L4b+Kx184+ptAp4Trcscv69oARVYzWgaK01H1X0K3zNSmARKtxXYHvwJuT+8gLGGWgpHcWOmBeljFB2Ckg6wiAYOqfxEK3GMCAj6kIiTWdCBCXhkjUKMgJcLk271N9uLSbtvvK0S69OXAvoA5z94VsFubbmZvx4QAnXgBnJxENyQjy38wef81uPhxMpPJIQzr5ckuUTKe0wZyN57iFTWga8GvCwlh5UqvYgmaNV9XSxEVWs40kkosFwA70RgNOu8mLZfR6wDiwRa35y7j08NksqPQhcfkRBK/J8R75Iz+9C8gJpqzwiIeZII3QnYOkJWbVEI5jNuA+o2BwK82ifwnpSgHwaC+GNAdmW2VXfC+vPu6wR6lBj84C9WfvivZyUhZMJlJhjSukDlFJ3g4AvGJfC1iEpQJ/CaEd7G9wds7p71+odruKrHip/C7RdsxeVjzIxhoNkFGOW/+sk/YVAGtltfzZAIfzix8gcHhZCXpcGN2u69qWqD9OlRFAy7x2fQBhHUiETB+DocqvArYt98f+AEAXApsEmEcNLC0t2uPHCqPQIXwHYDfI4/9+8LMpchqr5HK39MJSrBXwnutNqjovjHFdq+fcHLp7YLR4mGgduW5hFpAXUoL4cTTuW5HJSkB5PC0S7A+8c+837DyoM1J9iv/po/o3BunlDqPjOSO/YbLFd+FGy9sxKFeT8b+nLNPrkAyD53FtT27yUS32yqUaEGTMBiASGcZ0FmK8nWxbvjC1q6WQC4VdWdAcBY8eFoAzIrC0b7Wt8wlPcIdE1FhUWeKU1Igv8Q/0dl4k/NnYSxdlDon8diUDeuQB4c8XVzcahRgyyZmNC+LAgeCfSVALde8/t1DCYawNoePGT83wlOpFUdOZKwxn89OsMEf0X8CxJCBN/dwKbFwkSMgx0ACJJDJD4iC1JEYh6XcEqVHpx4+J4I4UiAl26r5x64sttvSlAn3LBuQCz6edU8C+J5epBrC4YP52EFDgHrCw1B0eU9bOaTgh3wmYvQV3Oqqcf53XnVNXUBELX1xtSgFrirlII5d3HFulxBCNEfZx0h7K2f34XwdHpuYQcguN189Ow/nPXclaUcqMH5leCXjKOjbv3F0a7i2ZaRHmBe5zwnhA9S736ZC8AH8LHkg/T5znYgmES1dtuzGo92qwHIquiWX+4KgVLd8utv9Ml1BQNhEJW/FOgweiTguCUoQHkEwYhjfQIgm8eAzPKzHqAG5xGiiPyxeGRRaYetUpDVpHVC1T9bHGyaknb/TQTnuG7rDYwYCUT7/cMjtILzA+Go/FPw581F/mWeTkDuBsBCAK8ki+A29nMzPn4Rzjv6QV7xWW4fzQFUxb9jQQ1qc28kMi4mDl1NBr4usIsz5ltZqNm7AeJXfuTHd7nioLEyPBISU+8/tP1AC4Il/n+YGmjg2NiBRdl6yCw//zG5ph7bqaBuz8B4VMU/TqSsNPbwCeZA1cdxyG9SgKzRZPL+GXFOiH1/SFZ9wX8M3zUgvH8a4rMBjZj/h1W9MrwTiN6MlsCKiI4gycBzgV/xUaQGjGDHwHiYi0VIzeEAasCpNuL76AC7BIEl7i4AIxnAfoMxk35eJbZ68wWEUChs8IPz/EEE9BkUoNA4RCWSLJkY1h0Y/dG9bVCtUVPe7QRhtStXG4nOECDfUxc4Uw/Ik8JkA9o9+a83IrfHH11EdFUWc4phNgVFWkPsIHBnCvCCYBSgqEN9qtoXuwHhByYoJJA7BxIkkRwpDGgAHo+vQ3ZGOwCFJCJKUAx4MBpFZWvReeLgtBBkDDQu2OJxXa7SE/P4ZiUPHABjY1DsFIhPAaygWewiXK72hHjow/k8gCL6gKES8qcDZ7A+EhYlWCPGCX1wXIwzkQEKt8cP6iqkC0FEhFj/ZYtvXCtwuBLcDT5wXN+9H6ZEIkTwV/x/s78fXFX3siWHEKrC3tw7EFZ31Ll7ttknQyEMGgAqCaVe1bGk8r8nFWCQQR0h7CY0dsU/mIeIuA1AGCo02Q0YVXxub36sG1Qgfo0CBBUXxap+ECFEycQVyViBEBFPt14TK9rZHB9EwMG7DPXOv0OVHkdtx7OSCXfb3av4CFZGTwQBwT7/hKPHE4PzpJ4L4+FM9r1n8B+B+9R9I4Fu9brYUZgCunZWNxdQgIs8mASBQ4F8hJpEiaf4GPihk8FdAxin/kybjZjTj+mAQy6ihZ9whDvHAWB6BKrBXQr+5SBfqPaINwiz12UIwoTmbPACZY/fshBBBKNlW8ZCHwH/cVKSOZMm4Mxk4OwE9JeB+EFkn1IzcPQoiSB4vGgNeJSoik1A7m0TCmE/HrggB+/1M12C1Z18ACGoIeH1pH2IhAqFWgBq+kDFEWAvA3X8tpW0cnSD5WAOriOHhnYraF1eLTkS8P/QsHUBdtMPnOrMaANJE9AZiaKWII5Ue/8PTHn/UcCSTgIF2xN4zdmAQYIAKeBFl6FiO0aKfq5jcImHfPwTxcEdRmD3LcFoAva1Hdjm9UgGggI9YOoPkOBYLsT8HlG3nucMDGkOOJ8CkNOELdSO7D5qqAeJYBb2GpABgRi2gxLITgrOQ9C937HgB+0i7MeRx3gfPWCXLtgbLJAu/gCFBPzRX8eADJqCvA3FViC/BlOQC4LZyrBq8BdQAOUKoKjqR7v7EFfVFMojPgEoSlJesNIePyLHwW9NRgq7E6HvUN8A0yj0wyWDHRZ3J2A1jHdMyu3hCGwSDwdRir7h9VP7AKLgPoMCgKziOFLtrUm8aIFHlgxYfz8WBYUU55iAXauo+evJaIK/NTgRJM9sUcZRzcCnMdNKMJc7usnAyrpxHYkTRHK+n1HxS01LheAHqRWwKIDqLvQC0+PupHZgBawfVGsiniTVHwZHRqbUI/D4Cd+ftgyLAR1ehkIiqaKFw7MJEwUIuK5zsu4svoFYCFKgBJZACBuppOId2RDkPZas8H9kULcA9a0KTCQDGtpnzT+RMJiOGseHl4BQ1C29AWUXIIf/OIwwqoNEK3SCuA7FRiBrE9B4/PcrGJ1OQNj83F4Xbol/TgVHfMiIZLAdcaVkgh8sLrd+liNQH/FqsNTfj15m1J0X+ffZuq/gTY7QnvIfJz6UzBJLs83ItQpt3RfZz5iuGfNPajpngUm0R8DoA5jDlzsOTAwZjzsC3Jjxg7H914PjlcskGdghgx9HG4OOQH34uwQyzz61/0qiYNQjXxECuWYbGM/DrjtPH/Mw/K+gBLLSA+cEfPr4MroArzcDuybbr8Zc72i2UnzeHnTgzD4Ug78SzIvCoARVOQxaFFR3TzWnkkHUVFShEuqKxZnKz4p4YYcf8ZhYhuu8wFgSHcuuwCJagI4bgchJQK/qe9c/RT6nGcg6KGREJpb+MI0EY/b0jcsni3AJBeCQNsBOFVYoApcM2Aom4VFgIRdHpeIG8D3YaxBD+qCiQ+rBOSVnci8hzkAG1t/pgHA4uwDzmu8xFKkkkIqCfkIRs204r/hiDgutoAAcowBMZ9+KS0CcXVBOHCvJw2jMQSJyeoeExF2DuTuRcuWAo9sefyUQ6/oBaIjPtiRH1KvQKvygAHb171d+vc4GRMDPoxN/kL5pwlVh1mBQ1quQJAJ5j0TgOAis+h8d3mnC8xTKE34+8sDNjyVXE6nFMN+H39TQDmocHScENvN74LoGScGU4f7g6IG3n3C3qnG6JBS+Z5tHOOzRYQx+u7MZmAl0OSsRLAS/VIKfRAWU92+12aaVPksGDBWQuCMvgNy2M2Mt8EwqbjosZAec5xLEAmXmcFTHiOWARWglpNpjdEtBQRxJJU5VL5/7F1X86XntXgUK4q+KggsUoIIK8oA+kgy4+zLaACqQGTVOX6MBWdehL6BxHn+tlyBMDGAqufd7WOX5WTJwKYDfXJJP2GXDPk7Tj5Ed7BOG7DMFaBRAJgI/+H2Ngeb2SKb0zkoGlQBHkefDr7xMA5HZeJPtKIzyApI9gmnPgf1c3mulfhe0gFekDCdNFnrOwi4Gs6eTACNjB+Uegcgojog4V25P8bctRYY6RL8AJklE9ACFAGZdBEahd4d4CmghFhbzcwaXYH5qTlS6DY+KfNH5Avzjo2JJ0poDkSCMxLn73H/eB+ifvgvyIFCWAji7BWC8hd0qj0FziMdrS70BlVbgamIgcmotGZDNPwm0L9l5iHv7WRoAFx57ScFS2r2iwot8oKu8l+TOCOg2mZ2nFdjTgOFQENzKkJ8OjEnsE8f6AzyXwT6MNF3RDRnuj0Lwo6wTlBMDIyqaz6G+RiLJMg/KUrQV/rh9uH0tWduwoxmky0kSMQ+rnXxZsGadgnxfgk1pCnsIsGYltvfdzTOBIclIsN8MLAGcz5gBwj94AE8DuC9Molip/JGwB57nRyJiyD3pyk6q5ij+3TzRLohcqyqCEQBTepF15+WVmW8SEr5jMUUkx3oMIsrH3ndwAQganKzyMpOJNxMQooGBYwcByw7axIhgPRGEr6GSGJhkAELoQ1YRg+dPeD5IIRDIqq5PA2Jh0Rq0YcS8XBi0ghGRFpCtWTdum5+yLOsQf2EuYY8AfnbQZDgCjHxBSKwTGpt8QCIDVH3/4H5OwEvldhliINwAFLsEyyIfGKV+vm3eEehVqKTdNxtDiPoLHCRiuwTJxCECxMDqDjTvZ63KaPKvRgV2i/F3ohm88V8LN8hgJcXD5pVGIPPNn9EBqSQC0I4AMxBUcQNCkarkFgSn/oCs9GCVep4eUG5BRAOcQOCWlGSc3If0IFqRfURQGRrKewPKEJ9sLnIowKCcw+f48N6UHjqYtgInaCCkBbPSj8VEkCr2g8U43wY1xX/BNkwreQrzg+oaJghOCGTU8RBxuIp6VFOGoEXgEsBLIgV6gBgxoLSI5CgiYNT+GBHsU01GthrceiMUtv9KgAYktgVNeGrBbtiOQVi9x8WjiAW7UNUnm4Vet7WtsFgDCDYEwQ/EVL1PnQf/xCDLTowTh4c4HPRDoQaiwhKIAae4B7xgCBydI/CDPOrevK0FR4p6w3VfoXgQiB3T1N8Y1PCD0X19JqcHGfzB5WkQE4p/kdeXBcEVUXEIFqSij82lMyrWq/7c+LFHA7z5/dwOHHg8s/Y8C2CmhbmALtare+4UWLfb25BmXABKABTniC8gRAP2yvDAiUAsElnrxFzITQa/sAFecAOY7zPV/8jMQHSbWAiUPGkQNABhw85xrSCv+mMSzFR8+7mjw01A8f4F8S/td4jnDHYxpT8/OEyV3gz2+GTfdAeAszswfJNGlQhEIjB0Bls0BKn4Iw7WKu9f1gmSagmvqleEwJwnZwjO7npz1HdCJ1hS/mlBcRXyF3i/M7NxqJFoeH27z7nnJaBmpUZKHsTbGUc1ALEoIGsGYl9ixS50gjAT/VhB8IzvGTrBVfWEz1MzAkRFTtecW731VdjNQPukVdhdn0Y8d/a7WYH6i/TBPBzUFwAlHwtGHOQISrgb1AMUgDETTA3+THAdeRJhg59V/Ektofa9I8wxVICkC7QQSAd2O3cftzPzdMK6aA4iZI4ILfYRbb9RgqICt2AxVnYZ4kkBvHOBxT/zN9ybHx/f5Ql2fkGCX6ANm6F8WCfqAS+Eq5AGcHJd2IFHagTMHAAj+mWBnDXuc81CjhsAi5dL2K8QCYI1aJ/PJtSSxEFXASv7C2I3ZB9/a0j/7nDn/j1pHsz9Jr8fNpxPBUAUUYD4wz5GBlmyAiORjtAIGDFwzSUwqiNZ1d1tPiB7/Q9VeI9KeJU16/knkEeQJEALjY4rkp74fCZiMDSA/PgvT/aT2gYgp5E/P29AKBQAo6TRth5T4VesQFb0i4K7RA2MZpgyFXCEQHCOixuYMPgy2L7+45ezSSKt2oUkURlpXkEMOLSiXPuDQZjk63N5bmzOSxQdLHX7AhwUEA0BAeQPJIQzkAuFlOK/GtyLdiGDKEBdllQ7YouxV2Xdwza9So4Kp5Z0yAgUhTlJgFzSFrznIHYIwKcCu2/L3LsCg6UI1b1/CA+ApIV5/32HqOIjdQusE4azip5Wc1b0q/QGIAlaWEJbXP3r/L+AEipw/+BtkQVY9fIM2i/ZhgVEgJO6DZ1ksVtlYdoQAPhVO0oKmYBmnAYco4DRCRB3TwCziptaE0auER9/VzRqKNOEYINOQg2m1l9GpGNQAhh1v6UmxNQh2M4+LmlUzll0OTjYQOaGlZAEMCrdhmBphaMBwBADrSQQc3//He8KgFETT7p6BHnjj2X9EXsDjrgBS6ihoAmcSQVYmE4JgYWFpp1waAQRoqDzxDhU+HxSnZHz/9JEY6Y5MJA+cwoWrt99+U3Mc/9g/NQTFaigAEtwB1yBzwzucZSX7RZEILhR1d5GDCsBLVUdIQvsldZfEJt5i/MHx2hGJZFkVVyK242iFeh58oBUFqIQbkfp2DV2X0CkAYgv1sU+P+I/HmBu8nErugdRnUWhfp+A/ddlbEH3uQlBsNobUEMHasK1HOYn8BEEvCUaiuigXRIKj+sGOPA4KAWz9/s7WxcgB4+a6/fI2osEwv4yOENAiPf+wQhbc/5f0gGisWuQaRFmGoIqguARWsBQgTTocDLMT5OJUQnhqdCEig+/EShKSEgTVV0MBMnz04BcshPnLk/+OaV0/dwKzB4QUt1NB6uTDfGOP+cNm9mEsBAFiM7AQh9AKVEU75vy68jeOxrUC4mDEuYO0oLqoSdHaEF2eXYYSm0V+oEOwpLmYFOF3Z4CmAeBTIGueiIw2xoKPzDBJVBXQ5g5O8/twwA+QguIjJt3+g0NQEcDfUXgO5gsqlTBLkQLdl86K3CWneitQ8sg/5oWAUJP2C3V3RoEyji5n4b9lB4t9pz2CA+cAFn1Z9I/uzYsU/ELtEBOCHYQQqGcFejV+yeuRJX31zsKV5IGjway9z6PLDxKwNEPsBuOEiqw57jGgOtZ1Y++T50AuMFl7hPIbhskiOwsATtRoc7rS7dXrpcgrMCGJca6ELJo+Y0be0BW5ZKGcFz4y8W9BduwcDnK9iO5fagsKpp9ANnvDPxeP8THNyIVFo1AMas8Qk5v2Ytm0LCCYAXqn+wQsPTBh/5Bcnne14Os3uCQt28vsK1WUESJFviBgAW//3u9PLxusXchcCR2WsNzv/ImvgZzzkUByDUAIrjTvmSHAowpJBQE4SUlxMxnARlQbIqkArVAJ6pBBvELCCKlkyCDAP45BYfEPfcUpfMch3Vn4bheYK4E66BxAxHSVd5INgEPgU/NBCDfNQ8Ho1CoINAPQAW/QT8OCIZlNFCB84XhoDChFByHGjx35v9BLgyhmojqHYb5QYXnuAecvua0hZe6BV9f7v4ibvgvamrmAc1TmaEir0LQ9h97eYAYVoM/nWA60i8Q3Ifezha9BqaaL3zvqd6IAuwwLSCCuCLuJWch4h30giPtyiAphKEBcCu9BV5wwzkMxID8rhMwdwMhcSFgrBT3RUTQboAUg3+p+Qe1IGarOioVnazmefV3lHpwA0AcLWCahUiXwePHWJsP+GH1gnp/we5KfOhJAbsj0H/BIEb04TbrTPsAyb2LLu93KwfCvn5PLAwrOXAa72eEQRo1CNdw5IprsAZ3hApy9zlcITG2vpCihsRSYxNS+J4vdBZ6B52eqRcQ/QXmSjAWSfa/5GA5qEg4iJFtm624AqXLrSA2gx8p1Mdqcghv41S0lSp/xAYs9gakQc4Ie2RTUYwYgt748mV+FU1Xgp14eW3XYZ6cdqGTNHwHICTwEeTPl0jEZwIgP9gDEaogeg5IHWCF+1eoAhvEKPB/EAeTRsM/pSAP5wjWEUMM1/NJRhwJbpJSgK7S7zF3EOsI5jBQBK9DV80Z8Y0COzvmWzJXgDl40KEC6cqvqgi4OB5cpgLFYK/1CvDiItXqC6/S87wfAUfPtxqfGNzlYaOjlf1IsHPPvffHgDAoEeEST4ZLZUd/RSo91/BjXY5ggWgQ4In3fyj4mUqPrInHOCLKO3wUwRsfyXpt1nEIRLrqcWeTuk7bigsbid1zD4iDRQtnIdQsyIXnFCn1I9D7ADgxEhOvR5AJosoUbu1FkJyYCi9OhQERoIx+4AX/YqUXQhtYEwKN4Cy1HntLMmtaAQpqfrT/UCoLSxeswjA5UWPPi0mjajUWxMTdVusNvt/ChMdmILK5IRMFu90BMEzFYHdg2GAgeYVHMMJIBTA7EFTx/5fpgTFXz9w/en0ZjD8kCDoKPNGwlB01BmoWQbh+AxR689mBponGJOr9OwmMu3dtJ/ylW1Tik4ElUPmR9RqII+pVhD9ychABMQ51gOIZg+/G+5mGIzLB1JJC5WhzYjhJ7IWmLDpA8jzsAafUPkB2WnFBF4iSxkq1ty7f25rv/+EQLOxs2oUdTSA9HIR9swdBlCcFe9owPC3XWDDC0ISVzsEVbSCF/sWdA5Fu4HJqankp2SeQCYYrImNalfmhpVxYrGkUS4LeSUjg8dD7+D7w/ybIfy7vlB9/HJ978zr7/45Qgajzj+4EjIK/ULHPRAOlKr/aG0AFcqCyu0GcW45Igh6JMJmhA49/U+cEssHNJhtXDC1MOya3j/sAiAGcrEtqtgjBD6wEzSDc7D8o6C8rIqAZyPk+NQoNLAZ1hR64Yl1FBY648smUYKnSg1Xwk/0DyRyArByMUobyByhCcPnOaPyoegREFS4jNfYAw+IHCjdC1J2WDZBke/OyN85J24WiXwDYPoJyYuCD238ulvuzwt6KgHf0shWKsqCFFGjB/w8HU8eeTED9wAAAAABJRU5ErkJggg==","EnvironmentBRDFTexture"+u++,q,!0,!1,y.d.BILINEAR_SAMPLINGMODE);q._blockEntityCollection=Q;const b=q.getEngine().getLoadedTexturesCache(),D=b.indexOf(H.getInternalTexture());-1!==D&&b.splice(D,1),H.isRGBD=!0,H.wrapU=y.d.CLAMP_ADDRESSMODE,H.wrapV=y.d.CLAMP_ADDRESSMODE,q.environmentBRDFTexture=H,q.useDelayedTextureLoading=X,x.b.ExpandRGBDTexture(H);const a=q.getEngine().onContextRestoredObservable.add((()=>{H.isRGBD=!0;const X=q.onBeforeRenderObservable.add((()=>{H.isReady()&&(q.onBeforeRenderObservable.remove(X),x.b.ExpandRGBDTexture(H))}))}));q._d.add((()=>{q.getEngine().onContextRestoredObservable.remove(a)}))}return q.environmentBRDFTexture}},11259:(q,X,Q)=>{"use strict";function y(q,X,Q){try{const y=q.next();y.done?X(y):y.value?y.value.then((()=>{y.value=void 0,X(y)}),Q):X(y)}catch(y){Q(y)}}function x(){let q,X=arguments.length>0&&void 0!==arguments[0]?arguments[0]:25;return(Q,x,u)=>{const H=performance.now();void 0===q||H-q>X?(q=H,setTimeout((()=>{y(Q,x,u)}),0)):y(Q,x,u)}}function u(q,X,Q,y,x){const u=()=>{let H;const b=q=>{q.done?Q(q.value):void 0===H?H=!0:u()};do{H=void 0,x&&x.aborted?y(new Error("Aborted")):X(q,b,y),void 0===H&&(H=!1)}while(H)};u()}function H(q,X){let Q;return u(q,y,(q=>Q=q),(q=>{throw q}),X),Q}function b(q,X,Q){return new Promise(((y,x)=>{u(q,X,y,x,Q)}))}function D(q,X){return function(){return H(q(...arguments),X)}}Q.d(X,{c:()=>x,g:()=>D,h:()=>b,i:()=>H})},10257:(q,X,Q)=>{"use strict";Q.d(X,{d:()=>x});class y{constructor(q){this._pendingActions=new Array,this._workerInfos=q.map((q=>({workerPromise:Promise.resolve(q),idle:!0})))}dispose(){for(const q of this._workerInfos)q.workerPromise.then((q=>{q.terminate()}));this._workerInfos.length=0,this._pendingActions.length=0}push(q){this._executeOnIdleWorker(q)||this._pendingActions.push(q)}_executeOnIdleWorker(q){for(const X of this._workerInfos)if(X.idle)return this._execute(X,q),!0;return!1}_execute(q,X){q.idle=!1,q.workerPromise.then((Q=>{X(Q,(()=>{const X=this._pendingActions.shift();X?this._execute(q,X):q.idle=!0}))}))}}class x extends y{constructor(q,X){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:x.DefaultOptions;super([]),this._maxWorkers=q,this._createWorkerAsync=X,this._options=Q}push(q){if(!this._executeOnIdleWorker(q))if(this._workerInfos.length<this._maxWorkers){const X={workerPromise:this._createWorkerAsync(),idle:!1};this._workerInfos.push(X),this._execute(X,q)}else this._pendingActions.push(q)}_execute(q,X){q.timeoutId&&(clearTimeout(q.timeoutId),delete q.timeoutId),super._execute(q,((Q,y)=>{X(Q,(()=>{y(),q.idle&&(q.timeoutId=setTimeout((()=>{q.workerPromise.then((q=>{q.terminate()}));const X=this._workerInfos.indexOf(q);-1!==X&&this._workerInfos.splice(X,1)}),this._options.idleTimeElapsedBeforeRelease))}))}))}}x.DefaultOptions={idleTimeElapsedBeforeRelease:1e3}},11405:(q,X,Q)=>{"use strict";Q.d(X,{e:()=>eq});var y=Q(1002),x=Q(1384);class u extends x.c{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var H=Q(1182),b=(Q(1465),Q(1015));class D{get noiseTexture(){return this._noiseTexture}set noiseTexture(q){this._noiseTexture!==q&&(this._noiseTexture=q,this._reset())}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(q){this._isAnimationSheetEnabled!=q&&(this._isAnimationSheetEnabled=q,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(q){this._useLogarithmicDepth=q&&this.va().getEngine().getCaps().fragmentDepthSupported}va(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:y.n.Zero()}set direction1(q){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=q)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:y.n.Zero()}set direction2(q){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=q)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:y.n.Zero()}set minEmitBox(q){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=q)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:y.n.Zero()}set maxEmitBox(q){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=q)}get billboardMode(){return this._billboardMode}set billboardMode(q){this._billboardMode!==q&&(this._billboardMode=q,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(q){this._isBillboardBased!==q&&(this._isBillboardBased=q,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(q){this._attachImageProcessingConfiguration(q)}_attachImageProcessingConfiguration(q){q!==this._imageProcessingConfiguration&&(!q&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=q)}_reset(){}_removeGradientAndTexture(q,X,Q){if(!X)return this;let y=0;for(const x of X){if(x.gradient===q){X.splice(y,1);break}y++}return Q&&Q.dispose(),this}constructor(q){this.animations=[],this.renderingGroupId=0,this.k=y.n.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this.targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new y.n(10,10,10),this.onAnimationEnd=null,this.blendMode=D.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new y.k(0,0),this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.mg=new y.n(0,0,0),this._useLogarithmicDepth=!1,this.gravity=y.n.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new H.c(1,1,1,1),this.color2=new H.c(1,1,1,1),this.colorDead=new H.c(0,0,0,1),this.textureMask=new H.c(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new u,this.id=q,this.name=q}createPointEmitter(q,X){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new y.n(0,1,0),arguments.length>2&&void 0!==arguments[2]||new y.n(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new y.n(0,1,0),arguments.length>4&&void 0!==arguments[4]||new y.n(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new y.n(0,1,0),arguments.length>3&&void 0!==arguments[3]||new y.n(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(q,X,Q,y){throw new Error("Method not implemented.")}}D.BLENDMODE_ONEONE=0,D.BLENDMODE_STANDARD=1,D.BLENDMODE_ADD=2,D.BLENDMODE_MULTIPLY=3,D.BLENDMODE_MULTIPLYADD=4,(0,b.h)("BABYLON.BaseParticleSystem",D);var a=Q(1032),R=Q(1220);class L{constructor(){this.direction1=new y.n(0,1,0),this.direction2=new y.n(0,1,0),this.minEmitBox=new y.n(-.5,-.5,-.5),this.maxEmitBox=new y.n(.5,.5,.5)}startDirectionFunction(q,X,Q,x){const u=(0,a.s)(this.direction1.x,this.direction2.x),H=(0,a.s)(this.direction1.y,this.direction2.y),b=(0,a.s)(this.direction1.z,this.direction2.z);if(x)return X.x=u,X.y=H,void(X.z=b);y.n.TransformNormalFromFloatsToRef(u,H,b,q,X)}startPositionFunction(q,X,Q,x){const u=(0,a.s)(this.minEmitBox.x,this.maxEmitBox.x),H=(0,a.s)(this.minEmitBox.y,this.maxEmitBox.y),b=(0,a.s)(this.minEmitBox.z,this.maxEmitBox.z);if(x)return X.x=u,X.y=H,void(X.z=b);y.n.TransformCoordinatesFromFloatsToRef(u,H,b,q,X)}clone(){const q=new L;return R.d.DeepCopy(this,q),q}applyToShader(q){q.setVector3("direction1",this.direction1),q.setVector3("direction2",this.direction2),q.setVector3("minEmitBox",this.minEmitBox),q.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(q){q.addUniform("direction1",3),q.addUniform("direction2",3),q.addUniform("minEmitBox",3),q.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const q={};return q.type=this.getClassName(),q.direction1=this.direction1.ee(),q.direction2=this.direction2.ee(),q.minEmitBox=this.minEmitBox.ee(),q.maxEmitBox=this.maxEmitBox.ee(),q}parse(q){y.n.FromArrayToRef(q.direction1,0,this.direction1),y.n.FromArrayToRef(q.direction2,0,this.direction2),y.n.FromArrayToRef(q.minEmitBox,0,this.minEmitBox),y.n.FromArrayToRef(q.maxEmitBox,0,this.maxEmitBox)}}class f{get i(){return this._radius}set i(q){this._radius=q,this._buildHeight()}get angle(){return this._angle}set angle(q){this._angle=q,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=Q,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=X,this.i=q}startDirectionFunction(q,X,Q,x){x?y.h.Od[0].p(Q.qg).normalize():Q.position.subtractToRef(q.getTranslation(),y.h.Od[0]).normalize();const u=(0,a.s)(0,this.directionRandomizer),H=(0,a.s)(0,this.directionRandomizer),b=(0,a.s)(0,this.directionRandomizer);X.x=y.h.Od[0].x+u,X.y=y.h.Od[0].y+H,X.z=y.h.Od[0].z+b,X.normalize()}startPositionFunction(q,X,Q,x){const u=(0,a.s)(0,2*Math.PI);let H;this.emitFromSpawnPointOnly?H=1e-4:(H=(0,a.s)(0,this.heightRange),H=1-H*H);let b=this._radius-(0,a.s)(0,this._radius*this.radiusRange);b*=H;const D=b*Math.sin(u),R=b*Math.cos(u),L=H*this._height;if(x)return X.x=D,X.y=L,void(X.z=R);y.n.TransformCoordinatesFromFloatsToRef(D,L,R,q,X)}clone(){const q=new f(this._radius,this._angle,this.directionRandomizer);return R.d.DeepCopy(this,q),q}applyToShader(q){q.setFloat2("i",this._radius,this.radiusRange),q.setFloat("coneAngle",this._angle),q.setFloat2("height",this._height,this.heightRange),q.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(q){q.addUniform("i",2),q.addUniform("coneAngle",1),q.addUniform("height",2),q.addUniform("directionRandomizer",1)}getEffectDefines(){let q="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(q+="\n#define CONEEMITTERSPAWNPOINT"),q}getClassName(){return"ConeParticleEmitter"}serialize(){const q={};return q.type=this.getClassName(),q.i=this._radius,q.angle=this._angle,q.directionRandomizer=this.directionRandomizer,q.radiusRange=this.radiusRange,q.heightRange=this.heightRange,q.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,q}parse(q){this.i=q.i,this.angle=q.angle,this.directionRandomizer=q.directionRandomizer,this.radiusRange=void 0!==q.radiusRange?q.radiusRange:1,this.heightRange=void 0!==q.radiusRange?q.heightRange:1,this.emitFromSpawnPointOnly=void 0!==q.emitFromSpawnPointOnly&&q.emitFromSpawnPointOnly}}class k extends f{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new y.n(0,1,0),x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new y.n(0,1,0);super(q,X),this.direction1=Q,this.direction2=x}startDirectionFunction(q,X){const Q=(0,a.s)(this.direction1.x,this.direction2.x),x=(0,a.s)(this.direction1.y,this.direction2.y),u=(0,a.s)(this.direction1.z,this.direction2.z);y.n.TransformNormalFromFloatsToRef(Q,x,u,q,X)}clone(){const q=new k(this.i,this.angle,this.direction1,this.direction2);return R.d.DeepCopy(this,q),q}applyToShader(q){q.setFloat("i",this.i),q.setFloat("radiusRange",this.radiusRange),q.setVector3("direction1",this.direction1),q.setVector3("direction2",this.direction2)}buildUniformLayout(q){q.addUniform("i",1),q.addUniform("radiusRange",1),q.addUniform("direction1",3),q.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const q=super.serialize();return q.direction1=this.direction1.ee(),q.direction2=this.direction2.ee(),q}parse(q){super.parse(q),this.direction1.p(q.direction1),this.direction2.p(q.direction2)}}class j{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.i=q,this.height=X,this.radiusRange=Q,this.directionRandomizer=x,this._tempVector=y.n.Zero()}startDirectionFunction(q,X,Q,x,u){Q.position.subtractToRef(q.getTranslation(),this._tempVector),this._tempVector.normalize(),y.n.TransformNormalToRef(this._tempVector,u,this._tempVector);const H=(0,a.s)(-this.directionRandomizer/2,this.directionRandomizer/2);let b=Math.atan2(this._tempVector.x,this._tempVector.z);b+=(0,a.s)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=H,this._tempVector.x=Math.sin(b),this._tempVector.z=Math.cos(b),this._tempVector.normalize(),x?X.p(this._tempVector):y.n.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,q,X)}startPositionFunction(q,X,Q,x){const u=(0,a.s)(-this.height/2,this.height/2),H=(0,a.s)(0,2*Math.PI),b=(0,a.s)((1-this.radiusRange)*(1-this.radiusRange),1),D=Math.sqrt(b)*this.i,R=D*Math.cos(H),L=D*Math.sin(H);x?X.Pd(R,u,L):y.n.TransformCoordinatesFromFloatsToRef(R,u,L,q,X)}clone(){const q=new j(this.i,this.directionRandomizer);return R.d.DeepCopy(this,q),q}applyToShader(q){q.setFloat("i",this.i),q.setFloat("height",this.height),q.setFloat("radiusRange",this.radiusRange),q.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(q){q.addUniform("i",1),q.addUniform("height",1),q.addUniform("radiusRange",1),q.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const q={};return q.type=this.getClassName(),q.i=this.i,q.height=this.height,q.radiusRange=this.radiusRange,q.directionRandomizer=this.directionRandomizer,q}parse(q){this.i=q.i,this.height=q.height,this.radiusRange=q.radiusRange,this.directionRandomizer=q.directionRandomizer}}class I extends j{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new y.n(0,1,0),u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new y.n(0,1,0);super(q,X,Q),this.direction1=x,this.direction2=u}startDirectionFunction(q,X,Q,x){const u=(0,a.s)(this.direction1.x,this.direction2.x),H=(0,a.s)(this.direction1.y,this.direction2.y),b=(0,a.s)(this.direction1.z,this.direction2.z);x?X.Pd(u,H,b):y.n.TransformNormalFromFloatsToRef(u,H,b,q,X)}clone(){const q=new I(this.i,this.height,this.radiusRange,this.direction1,this.direction2);return R.d.DeepCopy(this,q),q}applyToShader(q){q.setFloat("i",this.i),q.setFloat("height",this.height),q.setFloat("radiusRange",this.radiusRange),q.setVector3("direction1",this.direction1),q.setVector3("direction2",this.direction2)}buildUniformLayout(q){q.addUniform("i",1),q.addUniform("height",1),q.addUniform("radiusRange",1),q.addUniform("direction1",3),q.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const q=super.serialize();return q.direction1=this.direction1.ee(),q.direction2=this.direction2.ee(),q}parse(q){super.parse(q),y.n.FromArrayToRef(q.direction1,0,this.direction1),y.n.FromArrayToRef(q.direction2,0,this.direction2)}}class d{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.i=q,this.radiusRange=X,this.directionRandomizer=Q}startDirectionFunction(q,X,Q,x){const u=Q.position.Sc(q.getTranslation()).normalize(),H=(0,a.s)(0,this.directionRandomizer),b=(0,a.s)(0,this.directionRandomizer),D=(0,a.s)(0,this.directionRandomizer);u.x+=H,u.y+=b,u.z+=D,u.normalize(),x?X.p(u):y.n.TransformNormalFromFloatsToRef(u.x,u.y,u.z,q,X)}startPositionFunction(q,X,Q,x){const u=this.i-(0,a.s)(0,this.i*this.radiusRange),H=(0,a.s)(0,1),b=(0,a.s)(0,2*Math.PI),D=Math.acos(2*H-1),R=u*Math.cos(b)*Math.sin(D),L=u*Math.cos(D),f=u*Math.sin(b)*Math.sin(D);x?X.Pd(R,Math.abs(L),f):y.n.TransformCoordinatesFromFloatsToRef(R,Math.abs(L),f,q,X)}clone(){const q=new d(this.i,this.directionRandomizer);return R.d.DeepCopy(this,q),q}applyToShader(q){q.setFloat("i",this.i),q.setFloat("radiusRange",this.radiusRange),q.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(q){q.addUniform("i",1),q.addUniform("radiusRange",1),q.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const q={};return q.type=this.getClassName(),q.i=this.i,q.radiusRange=this.radiusRange,q.directionRandomizer=this.directionRandomizer,q}parse(q){this.i=q.i,this.radiusRange=q.radiusRange,this.directionRandomizer=q.directionRandomizer}}class e{constructor(){this.direction1=new y.n(0,1,0),this.direction2=new y.n(0,1,0)}startDirectionFunction(q,X,Q,x){const u=(0,a.s)(this.direction1.x,this.direction2.x),H=(0,a.s)(this.direction1.y,this.direction2.y),b=(0,a.s)(this.direction1.z,this.direction2.z);x?X.Pd(u,H,b):y.n.TransformNormalFromFloatsToRef(u,H,b,q,X)}startPositionFunction(q,X,Q,x){x?X.Pd(0,0,0):y.n.TransformCoordinatesFromFloatsToRef(0,0,0,q,X)}clone(){const q=new e;return R.d.DeepCopy(this,q),q}applyToShader(q){q.setVector3("direction1",this.direction1),q.setVector3("direction2",this.direction2)}buildUniformLayout(q){q.addUniform("direction1",3),q.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const q={};return q.type=this.getClassName(),q.direction1=this.direction1.ee(),q.direction2=this.direction2.ee(),q}parse(q){y.n.FromArrayToRef(q.direction1,0,this.direction1),y.n.FromArrayToRef(q.direction2,0,this.direction2)}}class i{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.i=q,this.radiusRange=X,this.directionRandomizer=Q}startDirectionFunction(q,X,Q,x){const u=Q.position.Sc(q.getTranslation()).normalize(),H=(0,a.s)(0,this.directionRandomizer),b=(0,a.s)(0,this.directionRandomizer),D=(0,a.s)(0,this.directionRandomizer);u.x+=H,u.y+=b,u.z+=D,u.normalize(),x?X.p(u):y.n.TransformNormalFromFloatsToRef(u.x,u.y,u.z,q,X)}startPositionFunction(q,X,Q,x){const u=this.i-(0,a.s)(0,this.i*this.radiusRange),H=(0,a.s)(0,1),b=(0,a.s)(0,2*Math.PI),D=Math.acos(2*H-1),R=u*Math.cos(b)*Math.sin(D),L=u*Math.cos(D),f=u*Math.sin(b)*Math.sin(D);x?X.Pd(R,L,f):y.n.TransformCoordinatesFromFloatsToRef(R,L,f,q,X)}clone(){const q=new i(this.i,this.directionRandomizer);return R.d.DeepCopy(this,q),q}applyToShader(q){q.setFloat("i",this.i),q.setFloat("radiusRange",this.radiusRange),q.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(q){q.addUniform("i",1),q.addUniform("radiusRange",1),q.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const q={};return q.type=this.getClassName(),q.i=this.i,q.radiusRange=this.radiusRange,q.directionRandomizer=this.directionRandomizer,q}parse(q){this.i=q.i,this.radiusRange=q.radiusRange,this.directionRandomizer=q.directionRandomizer}}class A extends i{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new y.n(0,1,0),Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new y.n(0,1,0);super(q),this.direction1=X,this.direction2=Q}startDirectionFunction(q,X){const Q=(0,a.s)(this.direction1.x,this.direction2.x),x=(0,a.s)(this.direction1.y,this.direction2.y),u=(0,a.s)(this.direction1.z,this.direction2.z);y.n.TransformNormalFromFloatsToRef(Q,x,u,q,X)}clone(){const q=new A(this.i,this.direction1,this.direction2);return R.d.DeepCopy(this,q),q}applyToShader(q){q.setFloat("i",this.i),q.setFloat("radiusRange",this.radiusRange),q.setVector3("direction1",this.direction1),q.setVector3("direction2",this.direction2)}buildUniformLayout(q){q.addUniform("i",1),q.addUniform("radiusRange",1),q.addUniform("direction1",3),q.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const q=super.serialize();return q.direction1=this.direction1.ee(),q.direction2=this.direction2.ee(),q}parse(q){super.parse(q),this.direction1.p(q.direction1),this.direction2.p(q.direction2)}}class B{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{}}startDirectionFunction(q,X,Q,x){const u=y.h.Od[0];if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,Q,u);const q=y.h.Od[1];u.subtractToRef(Q.position,q),q.scaleToRef(1/Q.lifeTime,u)}else u.set(0,0,0);x?X.p(u):y.n.TransformNormalToRef(u,q,X)}startPositionFunction(q,X,Q,x){const u=y.h.Od[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,Q,u):u.set(0,0,0),x?X.p(u):y.n.TransformCoordinatesToRef(u,q,X)}clone(){const q=new B;return R.d.DeepCopy(this,q),q}applyToShader(q){}buildUniformLayout(q){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const q={};return q.type=this.getClassName(),q.particlePositionGenerator=this.particlePositionGenerator,q.particleDestinationGenerator=this.particleDestinationGenerator,q}parse(q){q.particlePositionGenerator&&(this.particlePositionGenerator=q.particlePositionGenerator),q.particleDestinationGenerator&&(this.particleDestinationGenerator=q.particleDestinationGenerator)}}var w=Q(1261);class V{get mesh(){return this.re}set mesh(q){this.re!==q&&(this.re=q,q?(this._indices=q.Nd(),this._positions=q.getVerticesData(w.c.PositionKind),this._normals=q.getVerticesData(w.c.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=y.n.Zero(),this.re=null,this.direction1=new y.n(0,1,0),this.direction2=new y.n(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=q}startDirectionFunction(q,X,Q,x){if(this.useMeshNormalsForDirection&&this._normals)return void y.n.TransformNormalToRef(this._storedNormal,q,X);const u=(0,a.s)(this.direction1.x,this.direction2.x),H=(0,a.s)(this.direction1.y,this.direction2.y),b=(0,a.s)(this.direction1.z,this.direction2.z);x?X.Pd(u,H,b):y.n.TransformNormalFromFloatsToRef(u,H,b,q,X)}startPositionFunction(q,X,Q,x){if(!this._indices||!this._positions)return;const u=3*Math.random()*(this._indices.length/3)|0,H=Math.random(),b=Math.random()*(1-H),D=1-H-b,a=this._indices[u],R=this._indices[u+1],L=this._indices[u+2],f=y.h.Od[0],k=y.h.Od[1],j=y.h.Od[2],I=y.h.Od[3];y.n.FromArrayToRef(this._positions,3*a,f),y.n.FromArrayToRef(this._positions,3*R,k),y.n.FromArrayToRef(this._positions,3*L,j),I.x=H*f.x+b*k.x+D*j.x,I.y=H*f.y+b*k.y+D*j.y,I.z=H*f.z+b*k.z+D*j.z,x?X.Pd(I.x,I.y,I.z):y.n.TransformCoordinatesFromFloatsToRef(I.x,I.y,I.z,q,X),this.useMeshNormalsForDirection&&this._normals&&(y.n.FromArrayToRef(this._normals,3*a,f),y.n.FromArrayToRef(this._normals,3*R,k),y.n.FromArrayToRef(this._normals,3*L,j),this._storedNormal.x=H*f.x+b*k.x+D*j.x,this._storedNormal.y=H*f.y+b*k.y+D*j.y,this._storedNormal.z=H*f.z+b*k.z+D*j.z)}clone(){const q=new V(this.mesh);return R.d.DeepCopy(this,q),q}applyToShader(q){q.setVector3("direction1",this.direction1),q.setVector3("direction2",this.direction2)}buildUniformLayout(q){q.addUniform("direction1",3),q.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var q;const X={};return X.type=this.getClassName(),X.direction1=this.direction1.ee(),X.direction2=this.direction2.ee(),X.meshId=null===(q=this.mesh)||void 0===q?void 0:q.id,X.useMeshNormalsForDirection=this.useMeshNormalsForDirection,X}parse(q,X){y.n.FromArrayToRef(q.direction1,0,this.direction1),y.n.FromArrayToRef(q.direction2,0,this.direction2),q.meshId&&X&&(this.mesh=X.getLastMeshById(q.meshId)),this.useMeshNormalsForDirection=q.useMeshNormalsForDirection}}var W=Q(1110);class v{_isUbo(q){return void 0!==q.addUniform}constructor(q){this._isUbo(q)?(this.setMatrix3x3=q.updateMatrix3x3.bind(q),this.setMatrix2x2=q.updateMatrix2x2.bind(q),this.setFloat=q.updateFloat.bind(q),this.setFloat2=q.updateFloat2.bind(q),this.setFloat3=q.updateFloat3.bind(q),this.setFloat4=q.updateFloat4.bind(q),this.setFloatArray=q.updateFloatArray.bind(q),this.setArray=q.updateArray.bind(q),this.setIntArray=q.updateIntArray.bind(q),this.setMatrix=q.Ae.bind(q),this.setMatrices=q.updateMatrices.bind(q),this.setVector3=q.updateVector3.bind(q),this.setVector4=q.updateVector4.bind(q),this.setColor3=q.updateColor3.bind(q),this.setColor4=q.updateColor4.bind(q),this.setDirectColor4=q.updateDirectColor4.bind(q),this.setInt=q.updateInt.bind(q),this.setInt2=q.updateInt2.bind(q),this.setInt3=q.updateInt3.bind(q),this.setInt4=q.updateInt4.bind(q)):(this.setMatrix3x3=q.setMatrix3x3.bind(q),this.setMatrix2x2=q.setMatrix2x2.bind(q),this.setFloat=q.setFloat.bind(q),this.setFloat2=q.setFloat2.bind(q),this.setFloat3=q.setFloat3.bind(q),this.setFloat4=q.setFloat4.bind(q),this.setFloatArray=q.setFloatArray.bind(q),this.setArray=q.setArray.bind(q),this.setIntArray=q.setIntArray.bind(q),this.setMatrix=q.setMatrix.bind(q),this.setMatrices=q.setMatrices.bind(q),this.setVector3=q.setVector3.bind(q),this.setVector4=q.setVector4.bind(q),this.setColor3=q.setColor3.bind(q),this.setColor4=q.setColor4.bind(q),this.setDirectColor4=q.setDirectColor4.bind(q),this.setInt=q.setInt.bind(q),this.setInt2=q.setInt2.bind(q),this.setInt3=q.setInt3.bind(q),this.setInt4=q.setInt4.bind(q))}}var Z=Q(1119);const U="gpuUpdateParticlesPixelShader",O="#version 300 es\nvoid main() {discard;}\n";Z.c.ShadersStore[U]=O;const g="gpuUpdateParticlesVertexShader",P="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";Z.c.ShadersStore[g]=P;(0,b.h)("BABYLON.WebGL2ParticleSystem",class{constructor(q,X){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=q,this._engine=X,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","i","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var q;return(null===(q=this._updateEffect)||void 0===q?void 0:q.isReady())??!1}createUpdateBuffer(q){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof B&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=q,this._updateEffect=new W.c("gpuUpdateParticles",this._updateEffectOptions,this._engine),new v(this._updateEffect)}createVertexBuffers(q,X){this._updateVAO.push(this._createUpdateVAO(q)),this._renderVAO.push(this._engine.recordVertexArrayObject(X,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=X}createParticleBuffer(q){return q}bindDrawBuffers(q,X,Q){Q?this._engine.bindBuffers(this._renderVertexBuffers,Q,X):this._engine.bindVertexArrayObject(this._renderVAO[q],null)}preUpdateParticleBuffer(){const q=this._engine;if(this._engine.enableEffect(this._updateEffect),!q.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(q,X,Q){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[q],null);const y=this._engine;y.bindTransformFeedbackBuffer(X.getBuffer()),y.setRasterizerState(!1),y.beginTransformFeedback(!0),y.drawArraysType(3,0,Q),y.endTransformFeedback(),y.setRasterizerState(!0),y.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let q=0;q<this._updateVAO.length;q++)this._engine.releaseVertexArrayObject(this._updateVAO[q]);this._updateVAO.length=0;for(let q=0;q<this._renderVAO.length;q++)this._engine.releaseVertexArrayObject(this._renderVAO[q]);this._renderVAO.length=0}_createUpdateVAO(q){const X={};X.position=q.createVertexBuffer("position",0,3);let Q=3;X.age=q.createVertexBuffer("age",Q,1),Q+=1,X.size=q.createVertexBuffer("size",Q,3),Q+=3,X.life=q.createVertexBuffer("life",Q,1),Q+=1,X.seed=q.createVertexBuffer("seed",Q,4),Q+=4,X.direction=q.createVertexBuffer("direction",Q,3),Q+=3,this._parent.particleEmitterType instanceof B&&(X.initialPosition=q.createVertexBuffer("initialPosition",Q,3),Q+=3),this._parent._colorGradientsTexture||(X.color=q.createVertexBuffer("color",Q,4),Q+=4),this._parent._isBillboardBased||(X.initialDirection=q.createVertexBuffer("initialDirection",Q,3),Q+=3),this._parent.noiseTexture&&(X.noiseCoordinates1=q.createVertexBuffer("noiseCoordinates1",Q,3),Q+=3,X.noiseCoordinates2=q.createVertexBuffer("noiseCoordinates2",Q,3),Q+=3),this._parent._angularSpeedGradientsTexture?(X.angle=q.createVertexBuffer("angle",Q,1),Q+=1):(X.angle=q.createVertexBuffer("angle",Q,2),Q+=2),this._parent._isAnimationSheetEnabled&&(X.cellIndex=q.createVertexBuffer("cellIndex",Q,1),Q+=1,this._parent.spriteRandomStartCell&&(X.cellStartOffset=q.createVertexBuffer("cellStartOffset",Q,1),Q+=1));const y=this._engine.recordVertexArrayObject(X,null,this._updateEffect);return this._engine.bindArrayBuffer(null),y}});class F{constructor(q,X){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,y=arguments.length>3?arguments[3]:void 0;this._engine=q,this._label=y,this._engine._storageBuffers.push(this),this._create(X,Q)}_create(q,X){this._bufferSize=q,this._creationFlags=X,this._buffer=this._engine.createStorageBuffer(q,X,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(q,X,Q){this._buffer&&this._engine.updateStorageBuffer(this._buffer,q,X,Q)}read(q,X,Q,y){return this._engine.readFromStorageBuffer(this._buffer,q,X,Q,y)}dispose(){const q=this._engine._storageBuffers,X=q.indexOf(this);-1!==X&&(q[X]=q[q.length-1],q.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var l=Q(975),m=Q(984),M=Q(1173),o=Q(972),Y=Q(1310),N=Q(1099),S=Q(1152),c=Q(1303);class p{constructor(){this._gpuTimeInFrameId=-1,this.counter=new c.e}_addDuration(q,X){q<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==q?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(X,!1),this._gpuTimeInFrameId=q):this.counter.addCount(X,!1))}}class t{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(q,X,Q){let y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=q,this._engine=X,this.uniqueId=Y.d.UniqueId,X.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new p),this._engine.getCaps().supportComputeShaders?y.bindingsMapping?(this._context=X.createComputeContext(),this._shaderPath=Q,this._options={bindingsMapping:{},defines:[],...y}):N.b.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):N.b.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(q,X){let Q=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const y=this._bindings[q];this._bindings[q]={type:Q?0:4,object:X,indexInGroupEntries:null===y||void 0===y?void 0:y.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!y||y.object!==X||y.type!==this._bindings[q].type)}setStorageTexture(q,X){const Q=this._bindings[q];this._contextIsDirty||(this._contextIsDirty=!Q||Q.object!==X),this._bindings[q]={type:1,object:X,indexInGroupEntries:null===Q||void 0===Q?void 0:Q.indexInGroupEntries}}setExternalTexture(q,X){const Q=this._bindings[q];this._contextIsDirty||(this._contextIsDirty=!Q||Q.object!==X),this._bindings[q]={type:6,object:X,indexInGroupEntries:null===Q||void 0===Q?void 0:Q.indexInGroupEntries}}setVideoTexture(q,X){return!!X.externalTexture&&(this.setExternalTexture(q,X.externalTexture),!0)}setUniformBuffer(q,X){const Q=this._bindings[q];this._contextIsDirty||(this._contextIsDirty=!Q||Q.object!==X),this._bindings[q]={type:t._BufferIsDataBuffer(X)?7:2,object:X,indexInGroupEntries:null===Q||void 0===Q?void 0:Q.indexInGroupEntries}}setStorageBuffer(q,X){const Q=this._bindings[q];this._contextIsDirty||(this._contextIsDirty=!Q||Q.object!==X),this._bindings[q]={type:t._BufferIsDataBuffer(X)?7:3,object:X,indexInGroupEntries:null===Q||void 0===Q?void 0:Q.indexInGroupEntries}}setTextureSampler(q,X){const Q=this._bindings[q];this._contextIsDirty||(this._contextIsDirty=!Q||!X.compareSampler(Q.object)),this._bindings[q]={type:5,object:X,indexInGroupEntries:null===Q||void 0===Q?void 0:Q.indexInGroupEntries}}isReady(){let q=this._effect;for(const x in this._bindings){const q=this._bindings[x],X=q.type,Q=q.object;switch(X){case 0:case 4:case 1:if(!Q.isReady())return!1;break;case 6:if(!Q.isReady())return!1;break}}const X=[],Q=this._shaderPath;if(this._options.defines)for(let x=0;x<this._options.defines.length;x++)X.push(this._options.defines[x]);const y=X.join("\n");return this._cachedDefines!==y&&(this._cachedDefines=y,q=this._engine.createComputeEffect(Q,{defines:y,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=q),!!q.isReady()}dispatch(q,X,Q){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,q,X,Q,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const Q=t._BufferIsDataBuffer(q)?q:q.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,Q,X,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const X in this._bindings){const Q=this._bindings[X];if(!this._options.bindingsMapping[X])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+X+"'");switch(Q.type){case 0:{const y=this._samplers[X],x=Q.object;var q;if(!y||!x._texture||!y.compareSampler(x._texture))this._samplers[X]=(new S.b).setParameters(x.wrapU,x.wrapV,x.wrapR,x.anisotropicFilteringLevel,x._texture.samplingMode,null===(q=x._texture)||void 0===q?void 0:q._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const q=Q.object;q.getBuffer()!==Q.buffer&&(Q.buffer=q.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}dispatchWhenReady(q,X,Q){let y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return new Promise((x=>{const u=()=>{this.dispatch(q,X,Q)?x():setTimeout(u,y)};u()}))}serialize(){const q=M.c.Serialize(this);q.options=this._options,q.shaderPath=this._shaderPath,q.uj={},q.textures={};for(const X in this._bindings){const Q=this._bindings[X],y=Q.object;switch(Q.type){case 0:case 4:case 1:{const x=y.serialize();x&&(q.textures[X]=x,q.uj[X]={type:Q.type});break}}}return q}static Parse(q,X,Q){const y=M.c.Parse((()=>new t(q.name,X.getEngine(),q.shaderPath,q.options)),q,X,Q);for(const x in q.textures){const u=q.uj[x],H=o.d.Parse(q.textures[x],X,Q);0===u.type?y.setTexture(x,H):4===u.type?y.setTexture(x,H,!1):y.setStorageTexture(x,H)}return y}static _BufferIsDataBuffer(q){return void 0!==q.underlyingResource}}(0,l.b)([(0,m.J)()],t.prototype,"name",void 0),(0,l.b)([(0,m.J)()],t.prototype,"fastMode",void 0),(0,b.h)("BABYLON.ComputeShader",t);var z=Q(1256);const K="gpuUpdateParticlesComputeShader",h="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";Z.c.ShadersStoreWGSL[K]=h;(0,b.h)("BABYLON.ComputeShaderParticleSystem",class{constructor(q,X){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=q,this._engine=X}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var q;return(null===(q=this._updateComputeShader)||void 0===q?void 0:q.isReady())??!1}createUpdateBuffer(q){var X;const Q={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(Q.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(Q.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(Q.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(Q.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(Q.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(Q.noiseTexture={group:1,binding:11}),this._updateComputeShader=new t("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:Q,defines:q.split("\n")}),null===(X=this._simParamsComputeShader)||void 0===X||X.dispose(),this._simParamsComputeShader=new z.c(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new v(this._simParamsComputeShader)}createVertexBuffers(q,X){this._renderVertexBuffers.push(X)}createParticleBuffer(q){const X=new F(this._engine,4*q.length,11,"ComputeShaderParticleSystemBuffer");return X.update(q),this._bufferComputeShader.push(X),X.getBuffer()}bindDrawBuffers(q,X,Q){this._engine.bindBuffers(this._renderVertexBuffers[q],Q,X)}preUpdateParticleBuffer(){}updateParticleBuffer(q,X,Q){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[q]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^q]),this._updateComputeShader.dispatch(Math.ceil(Q/64))}releaseBuffers(){var q;for(let X=0;X<this._bufferComputeShader.length;++X)this._bufferComputeShader[X].dispose();this._bufferComputeShader.length=0,null===(q=this._simParamsComputeShader)||void 0===q||q.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class G{constructor(q,X,Q){this.gradient=q,this.color1=X,this.color2=Q}getColorToRef(q){this.color2?H.c.LerpToRef(this.color1,this.color2,Math.random(),q):q.p(this.color1)}}class C{constructor(q,X){this.gradient=q,this.color=X}}class E{constructor(q,X,Q){this.gradient=q,this.factor1=X,this.factor2=Q}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class J{static GetCurrentGradient(q,X,Q){if(X[0].gradient>q)return void Q(X[0],X[0],1);for(let x=0;x<X.length-1;x++){const y=X[x],u=X[x+1];if(q>=y.gradient&&q<=u.gradient){return void Q(y,u,(q-y.gradient)/(u.gradient-y.gradient))}}const y=X.length-1;Q(X[y],X[y],1)}}var n=Q(998),r=Q(11408),s=Q(1028);class T{constructor(q){this.particleSystem=q,this.position=y.n.Zero(),this.direction=y.n.Zero(),this.color=new H.c(0,0,0,0),this.colorStep=new H.c(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new y.k(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new H.c(0,0,0,0),this._currentColor2=new H.c(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=T._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let q=this.age,X=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===X?(X=1,q=this._randomCellOffset):q+=this._randomCellOffset);const Q=this._initialEndSpriteCellID-this._initialStartSpriteCellID+1;let y;y=this._initialSpriteCellLoop?(0,a.d)(q*X%this.lifeTime/this.lifeTime):(0,a.d)(q*X/this.lifeTime),this.cellIndex=this._initialStartSpriteCellID+y*Q|0}_inheritParticleInfoToSubEmitter(q){if(q.particleSystem.k.position){const X=q.particleSystem.k;if(X.position.p(this.position),q.inheritDirection){const q=y.h.Od[0];this.direction.normalizeToRef(q),X.setDirection(q,0,Math.PI/2)}}else{q.particleSystem.k.p(this.position)}this.direction.scaleToRef(q.inheritedVelocityAmount/2,y.h.Od[0]),q.particleSystem._inheritedVelocityOffset.p(y.h.Od[0])}_inheritParticleInfoToSubEmitters(){this._attachedSubEmitters&&this._attachedSubEmitters.length>0&&this._attachedSubEmitters.forEach((q=>{this._inheritParticleInfoToSubEmitter(q)}))}_reset(){this.age=0,this.id=T._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(q){q.position.p(this.position),this._initialDirection?q._initialDirection?q._initialDirection.p(this._initialDirection):q._initialDirection=this._initialDirection.clone():q._initialDirection=null,q.direction.p(this.direction),this.qg&&(q.qg?q.qg.p(this.qg):q.qg=this.qg.clone()),q.color.p(this.color),q.colorStep.p(this.colorStep),q.lifeTime=this.lifeTime,q.age=this.age,q._randomCellOffset=this._randomCellOffset,q.size=this.size,q.scale.p(this.scale),q.angle=this.angle,q.angularSpeed=this.angularSpeed,q.particleSystem=this.particleSystem,q.cellIndex=this.cellIndex,q.id=this.id,q._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(q._currentColorGradient=this._currentColorGradient,q._currentColor1.p(this._currentColor1),q._currentColor2.p(this._currentColor2)),this._currentSizeGradient&&(q._currentSizeGradient=this._currentSizeGradient,q._currentSize1=this._currentSize1,q._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(q._currentAngularSpeedGradient=this._currentAngularSpeedGradient,q._currentAngularSpeed1=this._currentAngularSpeed1,q._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(q._currentVelocityGradient=this._currentVelocityGradient,q._currentVelocity1=this._currentVelocity1,q._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(q._currentLimitVelocityGradient=this._currentLimitVelocityGradient,q._currentLimitVelocity1=this._currentLimitVelocity1,q._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(q._currentDragGradient=this._currentDragGradient,q._currentDrag1=this._currentDrag1,q._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(q._initialStartSpriteCellID=this._initialStartSpriteCellID,q._initialEndSpriteCellID=this._initialEndSpriteCellID,q._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(q.remapData&&this.remapData?q.remapData.p(this.remapData):q.remapData=new y.q(0,0,0,0)),this._randomNoiseCoordinates1&&(q._randomNoiseCoordinates1?(q._randomNoiseCoordinates1.p(this._randomNoiseCoordinates1),q._randomNoiseCoordinates2.p(this._randomNoiseCoordinates2)):(q._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),q._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}T._Count=0;var qq=Q(1371),Xq=(Q(1460),Q(1378)),Qq=Q(1374),yq=Q(1251);class xq extends D{set onDispose(q){this._onDisposeObserver&&this._d.remove(this._onDisposeObserver),this._onDisposeObserver=this._d.add(q)}get useRampGradients(){return this._useRampGradients}set useRampGradients(q){this._useRampGradients!==q&&(this._useRampGradients=q,this._resetEffect())}get particles(){return this.pj}get shaderLanguage(){return this._shaderLanguage}getActiveCount(){return this.pj.length}getClassName(){return"$e"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var q;let X=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(q=this._customWrappers[X])||void 0===q?void 0:q.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[q]??this._customWrappers[0]}setCustomEffect(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[X]=new qq.b(this._engine),this._customWrappers[X].effect=q,this._customWrappers[X].drawContext&&(this._customWrappers[X].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new n.c),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}constructor(q,X,Q){let x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,u=arguments.length>4&&void 0!==arguments[4]&&arguments[4],b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01;super(q),this._emitterInverseWorldMatrix=y.b.Identity(),this._inheritedVelocityOffset=new y.n,this._d=new n.c,this.onStoppedObservable=new n.c,this.pj=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new H.c(0,0,0,0),this._colorDiff=new H.c(0,0,0,0),this._scaledDirection=y.n.Zero(),this._scaledGravity=y.n.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this.isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=q=>{},this.recycleParticle=q=>{const X=this.pj.pop();X!==q&&X.copyTo(q),this._stockParticles.push(X)},this._createParticle=()=>{let q;return 0!==this._stockParticles.length?(q=this._stockParticles.pop(),q._reset()):q=new T(this),this._prepareParticle(q),q},this._shadersLoaded=!1,this._capacity=X,this._epsilon=b,this._isAnimationSheetEnabled=u,Q&&"Scene"!==Q.getClassName()?(this._engine=Q,this.defaultProjectionMatrix=y.b.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=Q||s.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.je.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._attachImageProcessingConfiguration(null),this._customWrappers={0:new qq.b(this._engine)},this._customWrappers[0].effect=x,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new L;let D=null;this.updateFunction=q=>{let X=null;var Q;this.noiseTexture&&(X=this.noiseTexture.getSize(),null===(Q=this.noiseTexture.getContent())||void 0===Q||Q.then((q=>{D=q})));const x=q===this.pj;for(let u=0;u<q.length;u++){const Q=q[u];let b=this._scaledUpdateSpeed;const R=Q.age;if(Q.age+=b,Q.age>Q.lifeTime){const q=Q.age-R;b=(Q.lifeTime-R)*b/q,Q.age=Q.lifeTime}const L=Q.age/Q.lifeTime;this._colorGradients&&this._colorGradients.length>0?J.GetCurrentGradient(L,this._colorGradients,((q,X,y)=>{q!==Q._currentColorGradient&&(Q._currentColor1.p(Q._currentColor2),X.getColorToRef(Q._currentColor2),Q._currentColorGradient=q),H.c.LerpToRef(Q._currentColor1,Q._currentColor2,y,Q.color)})):(Q.colorStep.scaleToRef(b,this._scaledColorStep),Q.color.addInPlace(this._scaledColorStep),Q.color.a<0&&(Q.color.a=0)),this._angularSpeedGradients&&this._angularSpeedGradients.length>0&&J.GetCurrentGradient(L,this._angularSpeedGradients,((q,X,y)=>{q!==Q._currentAngularSpeedGradient&&(Q._currentAngularSpeed1=Q._currentAngularSpeed2,Q._currentAngularSpeed2=X.getFactor(),Q._currentAngularSpeedGradient=q),Q.angularSpeed=(0,a.n)(Q._currentAngularSpeed1,Q._currentAngularSpeed2,y)})),Q.angle+=Q.angularSpeed*b;let f=b;if(this._velocityGradients&&this._velocityGradients.length>0&&J.GetCurrentGradient(L,this._velocityGradients,((q,X,y)=>{q!==Q._currentVelocityGradient&&(Q._currentVelocity1=Q._currentVelocity2,Q._currentVelocity2=X.getFactor(),Q._currentVelocityGradient=q),f*=(0,a.n)(Q._currentVelocity1,Q._currentVelocity2,y)})),Q.direction.scaleToRef(f,this._scaledDirection),this._limitVelocityGradients&&this._limitVelocityGradients.length>0&&J.GetCurrentGradient(L,this._limitVelocityGradients,((q,X,y)=>{q!==Q._currentLimitVelocityGradient&&(Q._currentLimitVelocity1=Q._currentLimitVelocity2,Q._currentLimitVelocity2=X.getFactor(),Q._currentLimitVelocityGradient=q);const x=(0,a.n)(Q._currentLimitVelocity1,Q._currentLimitVelocity2,y);Q.direction.length()>x&&Q.direction.scaleInPlace(this.limitVelocityDamping)})),this._dragGradients&&this._dragGradients.length>0&&J.GetCurrentGradient(L,this._dragGradients,((q,X,y)=>{q!==Q._currentDragGradient&&(Q._currentDrag1=Q._currentDrag2,Q._currentDrag2=X.getFactor(),Q._currentDragGradient=q);const x=(0,a.n)(Q._currentDrag1,Q._currentDrag2,y);this._scaledDirection.scaleInPlace(1-x)})),this.isLocal&&Q.qg?(Q.qg.addInPlace(this._scaledDirection),y.n.TransformCoordinatesToRef(Q.qg,this._emitterWorldMatrix,Q.position)):Q.position.addInPlace(this._scaledDirection),D&&X&&Q._randomNoiseCoordinates1){const q=this._fetchR(Q._randomNoiseCoordinates1.x,Q._randomNoiseCoordinates1.y,X.width,X.height,D),x=this._fetchR(Q._randomNoiseCoordinates1.z,Q._randomNoiseCoordinates2.x,X.width,X.height,D),u=this._fetchR(Q._randomNoiseCoordinates2.y,Q._randomNoiseCoordinates2.z,X.width,X.height,D),H=y.h.Od[0],a=y.h.Od[1];H.Pd((2*q-1)*this.noiseStrength.x,(2*x-1)*this.noiseStrength.y,(2*u-1)*this.noiseStrength.z),H.scaleToRef(b,a),Q.direction.addInPlace(a)}this.gravity.scaleToRef(b,this._scaledGravity),Q.direction.addInPlace(this._scaledGravity),this._sizeGradients&&this._sizeGradients.length>0&&J.GetCurrentGradient(L,this._sizeGradients,((q,X,y)=>{q!==Q._currentSizeGradient&&(Q._currentSize1=Q._currentSize2,Q._currentSize2=X.getFactor(),Q._currentSizeGradient=q),Q.size=(0,a.n)(Q._currentSize1,Q._currentSize2,y)})),this._useRampGradients&&(this._colorRemapGradients&&this._colorRemapGradients.length>0&&J.GetCurrentGradient(L,this._colorRemapGradients,((q,X,y)=>{const x=(0,a.n)(q.factor1,X.factor1,y),u=(0,a.n)(q.factor2,X.factor2,y);Q.remapData.x=x,Q.remapData.y=u-x})),this._alphaRemapGradients&&this._alphaRemapGradients.length>0&&J.GetCurrentGradient(L,this._alphaRemapGradients,((q,X,y)=>{const x=(0,a.n)(q.factor1,X.factor1,y),u=(0,a.n)(q.factor2,X.factor2,y);Q.remapData.z=x,Q.remapData.w=u-x}))),this._isAnimationSheetEnabled&&Q.updateCellIndex(),Q._inheritParticleInfoToSubEmitters(),Q.age>=Q.lifeTime&&(this._emitFromParticle(Q),Q._attachedSubEmitters&&(Q._attachedSubEmitters.forEach((q=>{q.particleSystem.disposeOnStop=!0,q.particleSystem.stop()})),Q._attachedSubEmitters=null),this.recycleParticle(Q),x&&u--)}}}serialize(q){throw new Error("Method not implemented.")}clone(q,X){throw new Error("Method not implemented.")}_addFactorGradient(q,X,Q,y){const x=new E(X,Q,y);q.push(x),q.sort(((q,X)=>q.gradient<X.gradient?-1:q.gradient>X.gradient?1:0))}_removeFactorGradient(q,X){if(!q)return;let Q=0;for(const y of q){if(y.gradient===X){q.splice(Q,1);break}Q++}}addLifeTimeGradient(q,X,Q){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,q,X,Q),this}removeLifeTimeGradient(q){return this._removeFactorGradient(this._lifeTimeGradients,q),this}addSizeGradient(q,X,Q){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,q,X,Q),this}removeSizeGradient(q){return this._removeFactorGradient(this._sizeGradients,q),this}addColorRemapGradient(q,X,Q){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,q,X,Q),this}removeColorRemapGradient(q){return this._removeFactorGradient(this._colorRemapGradients,q),this}addAlphaRemapGradient(q,X,Q){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,q,X,Q),this}removeAlphaRemapGradient(q){return this._removeFactorGradient(this._alphaRemapGradients,q),this}addAngularSpeedGradient(q,X,Q){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,q,X,Q),this}removeAngularSpeedGradient(q){return this._removeFactorGradient(this._angularSpeedGradients,q),this}addVelocityGradient(q,X,Q){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,q,X,Q),this}removeVelocityGradient(q){return this._removeFactorGradient(this._velocityGradients,q),this}addLimitVelocityGradient(q,X,Q){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,q,X,Q),this}removeLimitVelocityGradient(q){return this._removeFactorGradient(this._limitVelocityGradients,q),this}addDragGradient(q,X,Q){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,q,X,Q),this}removeDragGradient(q){return this._removeFactorGradient(this._dragGradients,q),this}addEmitRateGradient(q,X,Q){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,q,X,Q),this}removeEmitRateGradient(q){return this._removeFactorGradient(this._emitRateGradients,q),this}addStartSizeGradient(q,X,Q){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,q,X,Q),this}removeStartSizeGradient(q){return this._removeFactorGradient(this._startSizeGradients,q),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const q=new Uint8Array(4*this._rawTextureWidth),X=H.g.Fe[0];for(let Q=0;Q<this._rawTextureWidth;Q++){const y=Q/this._rawTextureWidth;J.GetCurrentGradient(y,this._rampGradients,((y,x,u)=>{H.b.LerpToRef(y.color,x.color,u,X),q[4*Q]=255*X.r,q[4*Q+1]=255*X.g,q[4*Q+2]=255*X.b,q[4*Q+3]=255}))}this._rampGradientsTexture=r.c.CreateRGBATexture(q,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((q,X)=>q.gradient<X.gradient?-1:q.gradient>X.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(q,X){this._rampGradients||(this._rampGradients=[]);const Q=new C(q,X);return this._rampGradients.push(Q),this._syncRampGradientTexture(),this}removeRampGradient(q){return this._removeGradientAndTexture(q,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(q,X,Q){this._colorGradients||(this._colorGradients=[]);const y=new G(q,X,Q);return this._colorGradients.push(y),this._colorGradients.sort(((q,X)=>q.gradient<X.gradient?-1:q.gradient>X.gradient?1:0)),this}removeColorGradient(q){if(!this._colorGradients)return this;let X=0;for(const Q of this._colorGradients){if(Q.gradient===q){this._colorGradients.splice(X,1);break}X++}return this}resetDrawCache(){for(const q of this._drawWrappers)if(q)for(const X of q)null===X||void 0===X||X.dispose();this._drawWrappers=[]}_fetchR(q,X,Q,y,x){return x[4*(((q=.5*Math.abs(q)+.5)*Q%Q|0)+((X=.5*Math.abs(X)+.5)*y%y|0)*Q)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const q=this._engine,X=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*X),this._vertexBuffer=new w.b(q,this._vertexData,!0,X);let Q=0;const y=this._vertexBuffer.createVertexBuffer(w.c.PositionKind,Q,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[w.c.PositionKind]=y,Q+=3;const x=this._vertexBuffer.createVertexBuffer(w.c.ColorKind,Q,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[w.c.ColorKind]=x,Q+=4;const u=this._vertexBuffer.createVertexBuffer("angle",Q,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=u,Q+=1;const H=this._vertexBuffer.createVertexBuffer("size",Q,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=H,Q+=2,this._isAnimationSheetEnabled){const q=this._vertexBuffer.createVertexBuffer("cellIndex",Q,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=q,Q+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const q=this._vertexBuffer.createVertexBuffer("direction",Q,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=q,Q+=3}if(this._useRampGradients){const q=this._vertexBuffer.createVertexBuffer("remapData",Q,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=q,Q+=4}let b;if(this._useInstancing){const X=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new w.b(q,X,!1,2),b=this._spriteBuffer.createVertexBuffer("offset",0,2)}else b=this._vertexBuffer.createVertexBuffer("offset",Q,2,this._vertexBufferSize,this._useInstancing),Q+=2;this._vertexBuffers.offset=b,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const q=[],X=[];let Q=0;for(let y=0;y<this._capacity;y++)q.push(Q),q.push(Q+1),q.push(Q+2),q.push(Q),q.push(Q+2),q.push(Q+3),X.push(Q,Q+1,Q+1,Q+2,Q+2,Q+3,Q+3,Q,Q,Q+3),Q+=4;this._indexBuffer=this._engine.createIndexBuffer(q),this._linesIndexBuffer=this._engine.createIndexBuffer(X)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(q)setTimeout((()=>{this.start(0)}),q);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var X;-1!==(null===(X=this.k)||void 0===X?void 0:X.getClassName().indexOf("Mesh"))&&this.k.le(!0);const q=this.noiseTexture;if(q&&q.onGeneratedObservable)q.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let X=0;X<this.preWarmCycles;X++)this.animate(!0),q.render()}))}));else for(let X=0;X<this.preWarmCycles;X++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop)}}stop(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(q))}_postStop(q){}reset(){this._stockParticles.length=0,this.pj.length=0}_appendParticleVertex(q,X,Q,x){let u=q*this._vertexBufferSize;if(this._vertexData[u++]=X.position.x+this.mg.x,this._vertexData[u++]=X.position.y+this.mg.y,this._vertexData[u++]=X.position.z+this.mg.z,this._vertexData[u++]=X.color.r,this._vertexData[u++]=X.color.g,this._vertexData[u++]=X.color.b,this._vertexData[u++]=X.color.a,this._vertexData[u++]=X.angle,this._vertexData[u++]=X.scale.x*X.size,this._vertexData[u++]=X.scale.y*X.size,this._isAnimationSheetEnabled&&(this._vertexData[u++]=X.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[u++]=X.direction.x,this._vertexData[u++]=X.direction.y,this._vertexData[u++]=X.direction.z);else if(X._initialDirection){let q=X._initialDirection;this.isLocal&&(y.n.TransformNormalToRef(q,this._emitterWorldMatrix,y.h.Od[0]),q=y.h.Od[0]),0===q.x&&0===q.z&&(q.x=.001),this._vertexData[u++]=q.x,this._vertexData[u++]=q.y,this._vertexData[u++]=q.z}else{let q=X.direction;this.isLocal&&(y.n.TransformNormalToRef(q,this._emitterWorldMatrix,y.h.Od[0]),q=y.h.Od[0]),0===q.x&&0===q.z&&(q.x=.001),this._vertexData[u++]=q.x,this._vertexData[u++]=q.y,this._vertexData[u++]=q.z}this._useRampGradients&&X.remapData&&(this._vertexData[u++]=X.remapData.x,this._vertexData[u++]=X.remapData.y,this._vertexData[u++]=X.remapData.z,this._vertexData[u++]=X.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===Q?Q=this._epsilon:1===Q&&(Q=1-this._epsilon),0===x?x=this._epsilon:1===x&&(x=1-this._epsilon)),this._vertexData[u++]=Q,this._vertexData[u++]=x)}_prepareParticle(q){}_update(q){if(this._alive=this.pj.length>0,this.k.position){const q=this.k;this._emitterWorldMatrix=q.getWorldMatrix()}else{const q=this.k;this._emitterWorldMatrix=y.b.Translation(q.x,q.y,q.z)}let X;this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.pj);for(let Q=0;Q<q&&this.pj.length!==this._capacity;Q++){if(X=this._createParticle(),this.pj.push(X),this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0){const q=(0,a.d)(this._actualFrame/this.targetStopDuration);J.GetCurrentGradient(q,this._lifeTimeGradients,((Q,y)=>{const x=Q,u=y,H=x.getFactor(),b=u.getFactor(),D=(q-x.gradient)/(u.gradient-x.gradient);X.lifeTime=(0,a.n)(H,b,D)}))}else X.lifeTime=(0,a.s)(this.minLifeTime,this.maxLifeTime);const q=(0,a.s)(this.minEmitPower,this.maxEmitPower);if(this.startPositionFunction?this.startPositionFunction(this._emitterWorldMatrix,X.position,X,this.isLocal):this.particleEmitterType.startPositionFunction(this._emitterWorldMatrix,X.position,X,this.isLocal),this.isLocal&&(X.qg?X.qg.p(X.position):X.qg=X.position.clone(),y.n.TransformCoordinatesToRef(X.qg,this._emitterWorldMatrix,X.position)),this.startDirectionFunction?this.startDirectionFunction(this._emitterWorldMatrix,X.direction,X,this.isLocal):this.particleEmitterType.startDirectionFunction(this._emitterWorldMatrix,X.direction,X,this.isLocal,this._emitterInverseWorldMatrix),0===q?X._initialDirection?X._initialDirection.p(X.direction):X._initialDirection=X.direction.clone():X._initialDirection=null,X.direction.scaleInPlace(q),this._sizeGradients&&0!==this._sizeGradients.length?(X._currentSizeGradient=this._sizeGradients[0],X._currentSize1=X._currentSizeGradient.getFactor(),X.size=X._currentSize1,this._sizeGradients.length>1?X._currentSize2=this._sizeGradients[1].getFactor():X._currentSize2=X._currentSize1):X.size=(0,a.s)(this.minSize,this.maxSize),X.scale.Pd((0,a.s)(this.minScaleX,this.maxScaleX),(0,a.s)(this.minScaleY,this.maxScaleY)),this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration){const q=this._actualFrame/this.targetStopDuration;J.GetCurrentGradient(q,this._startSizeGradients,((q,Q,y)=>{q!==this._currentStartSizeGradient&&(this._currentStartSize1=this._currentStartSize2,this._currentStartSize2=Q.getFactor(),this._currentStartSizeGradient=q);const x=(0,a.n)(this._currentStartSize1,this._currentStartSize2,y);X.scale.scaleInPlace(x)}))}if(this._angularSpeedGradients&&0!==this._angularSpeedGradients.length?(X._currentAngularSpeedGradient=this._angularSpeedGradients[0],X.angularSpeed=X._currentAngularSpeedGradient.getFactor(),X._currentAngularSpeed1=X.angularSpeed,this._angularSpeedGradients.length>1?X._currentAngularSpeed2=this._angularSpeedGradients[1].getFactor():X._currentAngularSpeed2=X._currentAngularSpeed1):X.angularSpeed=(0,a.s)(this.minAngularSpeed,this.maxAngularSpeed),X.angle=(0,a.s)(this.minInitialRotation,this.maxInitialRotation),this._velocityGradients&&this._velocityGradients.length>0&&(X._currentVelocityGradient=this._velocityGradients[0],X._currentVelocity1=X._currentVelocityGradient.getFactor(),this._velocityGradients.length>1?X._currentVelocity2=this._velocityGradients[1].getFactor():X._currentVelocity2=X._currentVelocity1),this._limitVelocityGradients&&this._limitVelocityGradients.length>0&&(X._currentLimitVelocityGradient=this._limitVelocityGradients[0],X._currentLimitVelocity1=X._currentLimitVelocityGradient.getFactor(),this._limitVelocityGradients.length>1?X._currentLimitVelocity2=this._limitVelocityGradients[1].getFactor():X._currentLimitVelocity2=X._currentLimitVelocity1),this._dragGradients&&this._dragGradients.length>0&&(X._currentDragGradient=this._dragGradients[0],X._currentDrag1=X._currentDragGradient.getFactor(),this._dragGradients.length>1?X._currentDrag2=this._dragGradients[1].getFactor():X._currentDrag2=X._currentDrag1),this._colorGradients&&0!==this._colorGradients.length)X._currentColorGradient=this._colorGradients[0],X._currentColorGradient.getColorToRef(X.color),X._currentColor1.p(X.color),this._colorGradients.length>1?this._colorGradients[1].getColorToRef(X._currentColor2):X._currentColor2.p(X.color);else{const q=(0,a.s)(0,1);H.c.LerpToRef(this.color1,this.color2,q,X.color),this.colorDead.subtractToRef(X.color,this._colorDiff),this._colorDiff.scaleToRef(1/X.lifeTime,X.colorStep)}this._isAnimationSheetEnabled&&(X._initialStartSpriteCellID=this.startSpriteCellID,X._initialEndSpriteCellID=this.endSpriteCellID,X._initialSpriteCellLoop=this.spriteCellLoop),X.direction.addInPlace(this._inheritedVelocityOffset),this._useRampGradients&&(X.remapData=new y.q(0,1,0,1)),this.noiseTexture&&(X._randomNoiseCoordinates1?(X._randomNoiseCoordinates1.Pd(Math.random(),Math.random(),Math.random()),X._randomNoiseCoordinates2.Pd(Math.random(),Math.random(),Math.random())):(X._randomNoiseCoordinates1=new y.n(Math.random(),Math.random(),Math.random()),X._randomNoiseCoordinates2=new y.n(Math.random(),Math.random(),Math.random()))),X._inheritParticleInfoToSubEmitters()}}static _GetAttributeNamesOrOptions(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const y=[w.c.PositionKind,w.c.ColorKind,"angle","offset","size"];return q&&y.push("cellIndex"),X||y.push("direction"),Q&&y.push("remapData"),y}static _GetEffectCreationOptions(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const y=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,Xq.e)(y),q&&y.push("particlesInfos"),X&&y.push("logarithmicDepthConstant"),Q&&(y.push("vFogInfos"),y.push("vFogColor")),y}fillDefines(q,X){let Q=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,Xq.j)(this,this._scene,q),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&q.push("#define FOG")),this._isAnimationSheetEnabled&&q.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&q.push("#define LOGARITHMICDEPTH"),X===D.BLENDMODE_MULTIPLY&&q.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&q.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(q.push("#define BILLBOARD"),this.billboardMode){case 2:q.push("#define BILLBOARDY");break;case 8:case 9:q.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&q.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:q.push("#define BILLBOARDMODE_ALL")}Q&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),q.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(q,X,Q){X.push(...xq._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),q.push(...xq._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),Q.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,yq.d)(q,this._imageProcessingConfigurationDefines),(0,yq.c)(Q,this._imageProcessingConfigurationDefines))}_getWrapper(q){const X=this._getCustomDrawWrapper(q);if(null!==X&&void 0!==X&&X.effect)return X;const Q=[];this.fillDefines(Q,q);const y=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let x=this._drawWrappers[y];x||(x=this._drawWrappers[y]=[]);let u=x[q];u||(u=new qq.b(this._engine),u.drawContext&&(u.drawContext.useInstancing=this._useInstancing),x[q]=u);const H=Q.join("\n");if(u.defines!==H){const q=[],X=[],Q=[];this.fillUniformsAttributesAndSamplerNames(X,q,Q),u.setEffect(this._engine.createEffect("particles",q,X,Q,H,void 0,void 0,void 0,void 0,this._shaderLanguage),H)}return u}animate(){var q;let X,Q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started){if(!Q&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(Q?this.preWarmStepOffset:(null===(q=this._scene)||void 0===q?void 0:q.getAnimationRatio())||1),this.manualEmitCount>-1)X=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let q=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const X=this._actualFrame/this.targetStopDuration;J.GetCurrentGradient(X,this._emitRateGradients,((X,Q,y)=>{X!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=Q.getFactor(),this._currentEmitRateGradient=X),q=(0,a.n)(this._currentEmitRate1,this._currentEmitRate2,y)}))}X=q*this._scaledUpdateSpeed|0,this._newPartsExcess+=q*this._scaledUpdateSpeed-X}if(this._newPartsExcess>1&&(X+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?X=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(X),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!Q){let q=0;for(let X=0;X<this.pj.length;X++){const Q=this.pj[X];this._appendParticleVertices(q,Q),q+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.pj.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(q,X){this._appendParticleVertex(q++,X,0,0),this._useInstancing||(this._appendParticleVertex(q++,X,1,0),this._appendParticleVertex(q++,X,1,1),this._appendParticleVertex(q++,X,0,1))}rebuild(){var q;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(q=this._spriteBuffer)||void 0===q||q._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!xq.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(Q.bind(Q,11451)),Promise.resolve().then(Q.bind(Q,11442))])):await Promise.all([Promise.resolve().then(Q.bind(Q,11433)),Promise.resolve().then(Q.bind(Q,11429))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.k||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==D.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(D.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(D.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(q){const X=this._getWrapper(q),Q=X.effect,x=this._engine;x.enableEffect(X);const u=this.defaultViewMatrix??this._scene.getViewMatrix();if(Q.setTexture("diffuseSampler",this.particleTexture),Q.setMatrix("view",u),Q.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const q=this.particleTexture.getBaseSize();Q.setFloat3("particlesInfos",this.spriteCellWidth/q.width,this.spriteCellHeight/q.height,this.spriteCellWidth/q.width)}if(Q.setVector2("translationPivot",this.translationPivot),Q.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const q=this._scene.activeCamera;Q.setVector3("eyePosition",q.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),Q.setTexture("rampSampler",this._rampGradientsTexture));const H=Q.defines;var b,a,R,L,f,k;(this._scene&&((0,Xq.g)(Q,this,this._scene),this.applyFog&&(0,Qq.g)(this._scene,void 0,Q)),H.indexOf("#define BILLBOARDMODE_ALL")>=0&&(u.invertToRef(y.h.Matrix[0]),Q.setMatrix("invView",y.h.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(b=this._scene)&&void 0!==b&&b.forceWireframe?x.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,Q):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,Q)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(a=this._scene)&&void 0!==a&&a.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?x.bindBuffers(this._vertexBuffers,null!==(R=this._scene)&&void 0!==R&&R.forceWireframe?this._linesIndexBuffer:this._indexBuffer,Q):x.bindBuffers(this._vertexBuffers,null!==(L=this._scene)&&void 0!==L&&L.forceWireframe?this._linesIndexBufferUseInstancing:null,Q);switch(this.useLogarithmicDepth&&this._scene&&(0,Qq.l)(H,Q,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(Q),q){case D.BLENDMODE_ADD:x.setAlphaMode(1);break;case D.BLENDMODE_ONEONE:x.setAlphaMode(6);break;case D.BLENDMODE_STANDARD:x.setAlphaMode(2);break;case D.BLENDMODE_MULTIPLY:x.setAlphaMode(4)}(this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(Q),this._useInstancing)?null!==(f=this._scene)&&void 0!==f&&f.forceWireframe?x.drawElementsType(6,0,10,this.pj.length):x.drawArraysType(7,0,4,this.pj.length):null!==(k=this._scene)&&void 0!==k&&k.forceWireframe?x.drawElementsType(1,0,10*this.pj.length):x.drawElementsType(0,0,6*this.pj.length);return this.pj.length}render(){if(!this.isReady()||!this.pj.length)return 0;const q=this._engine;q.setState&&(q.setState(!1),this.forceDepthWrite&&q.setDepthWrite(!0));let X=0;return X=this.blendMode===D.BLENDMODE_MULTIPLYADD?this._render(D.BLENDMODE_MULTIPLY)+this._render(D.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),X}_onDispose(){}dispose(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),q&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),q&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(X,Q),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const q=this._scene.je.indexOf(this);q>-1&&this._scene.je.splice(q,1),this._scene._activeParticleSystems.dispose()}this._d.notifyObservers(this),this._d.clear(),this.onStoppedObservable.clear(),this.reset()}}xq.ForceGLSL=!1;var uq,Hq=Q(1081);!function(q){q[q.ATTACHED=0]="ATTACHED",q[q.END=1]="END"}(uq||(uq={}));class bq{constructor(q){if(this.particleSystem=q,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!q.k||!q.k.dispose){const X=(0,b.d)("BABYLON.AbstractMesh");q.k=new X("SubemitterSystemEmitter",q.va()),q._disposeEmitterOnDispose=!0}}clone(){let q=this.particleSystem.k;if(q){if(q instanceof y.n)q=q.clone();else if(-1!==q.getClassName().indexOf("Mesh")){q=new((0,b.d)("BABYLON.Mesh"))("",q.va()),q.isVisible=!1}}else q=new y.n;const X=new bq(this.particleSystem.clone(this.particleSystem.name,q));return X.particleSystem.name+="Clone",X.type=this.type,X.inheritDirection=this.inheritDirection,X.inheritedVelocityAmount=this.inheritedVelocityAmount,X.particleSystem._disposeEmitterOnDispose=!0,X.particleSystem.disposeOnStop=!0,X}serialize(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const X={};return X.type=this.type,X.inheritDirection=this.inheritDirection,X.inheritedVelocityAmount=this.inheritedVelocityAmount,X.particleSystem=this.particleSystem.serialize(q),X}static _ParseParticleSystem(q,X,Q){throw(0,Hq.c)("ParseParticle")}static Parse(q,X,Q){const y=q.particleSystem,x=new bq(bq._ParseParticleSystem(y,X,Q,!0));return x.type=q.type,x.inheritDirection=q.inheritDirection,x.inheritedVelocityAmount=q.inheritedVelocityAmount,x.particleSystem._isSubEmitter=!0,x}dispose(){this.particleSystem.dispose()}}var Dq=Q(1105);function aq(q,X){const Q=new e;return Q.direction1=q,Q.direction2=X,Q}function Rq(){return new d(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function Lq(){return new i(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function fq(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new y.n(0,1,0),Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new y.n(0,1,0);return new A(q,X,Q)}function kq(){return new j(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function jq(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new y.n(0,1,0),u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new y.n(0,1,0);return new I(q,X,Q,x,u)}function Iq(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new f(q,X)}function dq(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new y.n(0,1,0),x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new y.n(0,1,0);return new k(q,X,Q,x)}class eq extends xq{constructor(){super(...arguments),this._disposeEmitterOnDispose=!1,this._emitFromParticle=q=>{if(!this._subEmitters||0===this._subEmitters.length)return;const X=Math.floor(Math.random()*this._subEmitters.length);this._subEmitters[X].forEach((X=>{if(1===X.type){const Q=X.clone();q._inheritParticleInfoToSubEmitter(Q),Q.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(Q.particleSystem),Q.particleSystem.start()}}))}}createPointEmitter(q,X){const Q=aq(q,X);return this.particleEmitterType=Q,Q}createHemisphericEmitter(){const q=Rq(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=q,q}createSphereEmitter(){const q=Lq(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=q,q}createDirectedSphereEmitter(){const q=fq(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new y.n(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new y.n(0,1,0));return this.particleEmitterType=q,q}createCylinderEmitter(){const q=kq(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=q,q}createDirectedCylinderEmitter(){const q=jq(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new y.n(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new y.n(0,1,0));return this.particleEmitterType=q,q}createConeEmitter(){const q=Iq(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=q,q}createDirectedConeEmitter(){const q=dq(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new y.n(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new y.n(0,1,0));return this.particleEmitterType=q,q}createBoxEmitter(q,X,Q,y){const x=new L;return this.particleEmitterType=x,this.direction1=q,this.direction2=X,this.minEmitBox=Q,this.maxEmitBox=y,x}_prepareSubEmitterInternalArray(){this._subEmitters=new Array,this.subEmitters&&this.subEmitters.forEach((q=>{q instanceof eq?this._subEmitters.push([new bq(q)]):q instanceof bq?this._subEmitters.push([q]):q instanceof Array&&this._subEmitters.push(q)}))}_stopSubEmitters(){this.activeSubSystems&&(this.activeSubSystems.forEach((q=>{q.stop(!0)})),this.activeSubSystems=[])}_removeFromRoot(){if(!this._rootParticleSystem)return;const q=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==q&&this._rootParticleSystem.activeSubSystems.splice(q,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(q){q&&this._stopSubEmitters()}_prepareParticle(q){if(this._subEmitters&&this._subEmitters.length>0){const X=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];q._attachedSubEmitters=[],X.forEach((X=>{if(0===X.type){const Q=X.clone();q._attachedSubEmitters.push(Q),Q.particleSystem.start()}}))}}_onDispose(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],X=arguments.length>1&&void 0!==arguments[1]&&arguments[1];var Q;(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),q)&&(null===(Q=this.particles)||void 0===Q||Q.forEach((q=>{if(q._attachedSubEmitters)for(let X=q._attachedSubEmitters.length-1;X>=0;X-=1)q._attachedSubEmitters[X].dispose()})));if(X&&this.activeSubSystems)for(let y=this.activeSubSystems.length-1;y>=0;y-=1)this.activeSubSystems[y].dispose();if(this._subEmitters&&this._subEmitters.length){for(let q=0;q<this._subEmitters.length;q++)for(const X of this._subEmitters[q])X.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.k&&this.k.dispose&&this.k.dispose(!0)}static _Parse(q,X,Q,x){let u;u=Q instanceof Dq.e?null:Q;const D=(0,b.d)("BABYLON.Texture");if(D&&u&&(q.texture?X.particleTexture=D.Parse(q.texture,u,x):q.textureName&&(X.particleTexture=new D(x+q.textureName,u,!1,void 0===q.invertY||q.invertY),X.particleTexture.name=q.textureName)),q.emitterId||0===q.emitterId||void 0!==q.k?q.emitterId&&u?X.k=u.getLastMeshById(q.emitterId):X.k=y.n.Rd(q.k):X.k=y.n.Zero(),X.isLocal=!!q.isLocal,void 0!==q.renderingGroupId&&(X.renderingGroupId=q.renderingGroupId),void 0!==q.isBillboardBased&&(X.isBillboardBased=q.isBillboardBased),void 0!==q.billboardMode&&(X.billboardMode=q.billboardMode),void 0!==q.useLogarithmicDepth&&(X.useLogarithmicDepth=q.useLogarithmicDepth),q.animations){for(let Q=0;Q<q.animations.length;Q++){const y=q.animations[Q],x=(0,b.d)("BABYLON.Animation");x&&X.animations.push(x.Parse(y))}X.beginAnimationOnStart=q.beginAnimationOnStart,X.beginAnimationFrom=q.beginAnimationFrom,X.beginAnimationTo=q.beginAnimationTo,X.beginAnimationLoop=q.beginAnimationLoop}if(q.autoAnimate&&u&&u.beginAnimation(X,q.autoAnimateFrom,q.autoAnimateTo,q.autoAnimateLoop,q.autoAnimateSpeed||1),X.startDelay=0|q.startDelay,X.minAngularSpeed=q.minAngularSpeed,X.maxAngularSpeed=q.maxAngularSpeed,X.minSize=q.minSize,X.maxSize=q.maxSize,q.minScaleX&&(X.minScaleX=q.minScaleX,X.maxScaleX=q.maxScaleX,X.minScaleY=q.minScaleY,X.maxScaleY=q.maxScaleY),void 0!==q.preWarmCycles&&(X.preWarmCycles=q.preWarmCycles,X.preWarmStepOffset=q.preWarmStepOffset),void 0!==q.minInitialRotation&&(X.minInitialRotation=q.minInitialRotation,X.maxInitialRotation=q.maxInitialRotation),X.minLifeTime=q.minLifeTime,X.maxLifeTime=q.maxLifeTime,X.minEmitPower=q.minEmitPower,X.maxEmitPower=q.maxEmitPower,X.emitRate=q.emitRate,X.gravity=y.n.Rd(q.gravity),q.noiseStrength&&(X.noiseStrength=y.n.Rd(q.noiseStrength)),X.color1=H.c.Rd(q.color1),X.color2=H.c.Rd(q.color2),X.colorDead=H.c.Rd(q.colorDead),X.updateSpeed=q.updateSpeed,X.targetStopDuration=q.targetStopDuration,X.blendMode=q.blendMode,q.colorGradients)for(const y of q.colorGradients)X.addColorGradient(y.gradient,H.c.Rd(y.color1),y.color2?H.c.Rd(y.color2):void 0);if(q.rampGradients){for(const Q of q.rampGradients)X.addRampGradient(Q.gradient,H.b.Rd(Q.color));X.useRampGradients=q.useRampGradients}if(q.colorRemapGradients)for(const y of q.colorRemapGradients)X.addColorRemapGradient(y.gradient,void 0!==y.factor1?y.factor1:y.factor,y.factor2);if(q.alphaRemapGradients)for(const y of q.alphaRemapGradients)X.addAlphaRemapGradient(y.gradient,void 0!==y.factor1?y.factor1:y.factor,y.factor2);if(q.sizeGradients)for(const y of q.sizeGradients)X.addSizeGradient(y.gradient,void 0!==y.factor1?y.factor1:y.factor,y.factor2);if(q.angularSpeedGradients)for(const y of q.angularSpeedGradients)X.addAngularSpeedGradient(y.gradient,void 0!==y.factor1?y.factor1:y.factor,y.factor2);if(q.velocityGradients)for(const y of q.velocityGradients)X.addVelocityGradient(y.gradient,void 0!==y.factor1?y.factor1:y.factor,y.factor2);if(q.dragGradients)for(const y of q.dragGradients)X.addDragGradient(y.gradient,void 0!==y.factor1?y.factor1:y.factor,y.factor2);if(q.emitRateGradients)for(const y of q.emitRateGradients)X.addEmitRateGradient(y.gradient,void 0!==y.factor1?y.factor1:y.factor,y.factor2);if(q.startSizeGradients)for(const y of q.startSizeGradients)X.addStartSizeGradient(y.gradient,void 0!==y.factor1?y.factor1:y.factor,y.factor2);if(q.lifeTimeGradients)for(const y of q.lifeTimeGradients)X.addLifeTimeGradient(y.gradient,void 0!==y.factor1?y.factor1:y.factor,y.factor2);if(q.limitVelocityGradients){for(const Q of q.limitVelocityGradients)X.addLimitVelocityGradient(Q.gradient,void 0!==Q.factor1?Q.factor1:Q.factor,Q.factor2);X.limitVelocityDamping=q.limitVelocityDamping}if(q.noiseTexture&&u){const Q=(0,b.d)("BABYLON.ProceduralTexture");X.noiseTexture=Q.Parse(q.noiseTexture,u,x)}let a;if(q.particleEmitterType){switch(q.particleEmitterType.type){case"SphereParticleEmitter":a=new i;break;case"SphereDirectedParticleEmitter":a=new A;break;case"ConeEmitter":case"ConeParticleEmitter":a=new f;break;case"ConeDirectedParticleEmitter":a=new k;break;case"CylinderParticleEmitter":a=new j;break;case"CylinderDirectedParticleEmitter":a=new I;break;case"HemisphericParticleEmitter":a=new d;break;case"PointParticleEmitter":a=new e;break;case"MeshParticleEmitter":a=new V;break;case"CustomParticleEmitter":a=new B;break;default:a=new L}a.parse(q.particleEmitterType,u)}else a=new L,a.parse(q,u);X.particleEmitterType=a,X.startSpriteCellID=q.startSpriteCellID,X.endSpriteCellID=q.endSpriteCellID,X.spriteCellLoop=q.spriteCellLoop??!0,X.spriteCellWidth=q.spriteCellWidth,X.spriteCellHeight=q.spriteCellHeight,X.spriteCellChangeSpeed=q.spriteCellChangeSpeed,X.spriteRandomStartCell=q.spriteRandomStartCell,X.disposeOnStop=q.disposeOnStop??!1,X.manualEmitCount=q.manualEmitCount??-1}static Parse(q,X,Q){let x=arguments.length>3&&void 0!==arguments[3]&&arguments[3],u=arguments.length>4?arguments[4]:void 0;const b=q.name;let D,a,R=null,L=null;if(X instanceof Dq.e?D=X:(a=X,D=a.getEngine()),q.customShader&&D.createEffectForParticles){L=q.customShader;const X=L.shaderOptions.defines.length>0?L.shaderOptions.defines.join("\n"):"";R=D.createEffectForParticles(L.shaderPath.fragmentElement,L.shaderOptions.uniforms,L.shaderOptions.samplers,X)}const f=new eq(b,u||q.Ld,X,R,q.isAnimationSheetEnabled);if(f.customShader=L,f._rootUrl=Q,q.id&&(f.id=q.id),q.subEmitters){f.subEmitters=[];for(const y of q.subEmitters){const q=[];for(const x of y)q.push(bq.Parse(x,X,Q));f.subEmitters.push(q)}}return eq._Parse(q,f,X,Q),q.textureMask&&(f.textureMask=H.c.Rd(q.textureMask)),q.mg&&(f.mg=y.n.Rd(q.mg)),q.preventAutoStart&&(f.preventAutoStart=q.preventAutoStart),x||f.preventAutoStart||f.start(),f}serialize(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const X={};if(eq._Serialize(X,this,q),X.textureMask=this.textureMask.ee(),X.customShader=this.customShader,X.preventAutoStart=this.preventAutoStart,X.mg=this.mg.ee(),this.subEmitters){X.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const Q of this._subEmitters){const y=[];for(const X of Q)y.push(X.serialize(q));X.subEmitters.push(y)}}return X}static _Serialize(q,X,Q){if(q.name=X.name,q.id=X.id,q.Ld=X.getCapacity(),q.disposeOnStop=X.disposeOnStop,q.manualEmitCount=X.manualEmitCount,X.k.position){const Q=X.k;q.emitterId=Q.id}else{const Q=X.k;q.k=Q.ee()}X.particleEmitterType&&(q.particleEmitterType=X.particleEmitterType.serialize()),X.particleTexture&&(Q?q.texture=X.particleTexture.serialize():(q.textureName=X.particleTexture.name,q.invertY=!!X.particleTexture._invertY)),q.isLocal=X.isLocal,M.c.AppendSerializedAnimations(X,q),q.beginAnimationOnStart=X.beginAnimationOnStart,q.beginAnimationFrom=X.beginAnimationFrom,q.beginAnimationTo=X.beginAnimationTo,q.beginAnimationLoop=X.beginAnimationLoop,q.startDelay=X.startDelay,q.renderingGroupId=X.renderingGroupId,q.isBillboardBased=X.isBillboardBased,q.billboardMode=X.billboardMode,q.minAngularSpeed=X.minAngularSpeed,q.maxAngularSpeed=X.maxAngularSpeed,q.minSize=X.minSize,q.maxSize=X.maxSize,q.minScaleX=X.minScaleX,q.maxScaleX=X.maxScaleX,q.minScaleY=X.minScaleY,q.maxScaleY=X.maxScaleY,q.minEmitPower=X.minEmitPower,q.maxEmitPower=X.maxEmitPower,q.minLifeTime=X.minLifeTime,q.maxLifeTime=X.maxLifeTime,q.emitRate=X.emitRate,q.gravity=X.gravity.ee(),q.noiseStrength=X.noiseStrength.ee(),q.color1=X.color1.ee(),q.color2=X.color2.ee(),q.colorDead=X.colorDead.ee(),q.updateSpeed=X.updateSpeed,q.targetStopDuration=X.targetStopDuration,q.blendMode=X.blendMode,q.preWarmCycles=X.preWarmCycles,q.preWarmStepOffset=X.preWarmStepOffset,q.minInitialRotation=X.minInitialRotation,q.maxInitialRotation=X.maxInitialRotation,q.startSpriteCellID=X.startSpriteCellID,q.spriteCellLoop=X.spriteCellLoop,q.endSpriteCellID=X.endSpriteCellID,q.spriteCellChangeSpeed=X.spriteCellChangeSpeed,q.spriteCellWidth=X.spriteCellWidth,q.spriteCellHeight=X.spriteCellHeight,q.spriteRandomStartCell=X.spriteRandomStartCell,q.isAnimationSheetEnabled=X.isAnimationSheetEnabled,q.useLogarithmicDepth=X.useLogarithmicDepth;const y=X.getColorGradients();if(y){q.colorGradients=[];for(const X of y){const Q={gradient:X.gradient,color1:X.color1.ee()};X.color2?Q.color2=X.color2.ee():Q.color2=X.color1.ee(),q.colorGradients.push(Q)}}const x=X.getRampGradients();if(x){q.rampGradients=[];for(const X of x){const Q={gradient:X.gradient,color:X.color.ee()};q.rampGradients.push(Q)}q.useRampGradients=X.useRampGradients}const u=X.getColorRemapGradients();if(u){q.colorRemapGradients=[];for(const X of u){const Q={gradient:X.gradient,factor1:X.factor1};void 0!==X.factor2?Q.factor2=X.factor2:Q.factor2=X.factor1,q.colorRemapGradients.push(Q)}}const H=X.getAlphaRemapGradients();if(H){q.alphaRemapGradients=[];for(const X of H){const Q={gradient:X.gradient,factor1:X.factor1};void 0!==X.factor2?Q.factor2=X.factor2:Q.factor2=X.factor1,q.alphaRemapGradients.push(Q)}}const b=X.getSizeGradients();if(b){q.sizeGradients=[];for(const X of b){const Q={gradient:X.gradient,factor1:X.factor1};void 0!==X.factor2?Q.factor2=X.factor2:Q.factor2=X.factor1,q.sizeGradients.push(Q)}}const D=X.getAngularSpeedGradients();if(D){q.angularSpeedGradients=[];for(const X of D){const Q={gradient:X.gradient,factor1:X.factor1};void 0!==X.factor2?Q.factor2=X.factor2:Q.factor2=X.factor1,q.angularSpeedGradients.push(Q)}}const a=X.getVelocityGradients();if(a){q.velocityGradients=[];for(const X of a){const Q={gradient:X.gradient,factor1:X.factor1};void 0!==X.factor2?Q.factor2=X.factor2:Q.factor2=X.factor1,q.velocityGradients.push(Q)}}const R=X.getDragGradients();if(R){q.dragGradients=[];for(const X of R){const Q={gradient:X.gradient,factor1:X.factor1};void 0!==X.factor2?Q.factor2=X.factor2:Q.factor2=X.factor1,q.dragGradients.push(Q)}}const L=X.getEmitRateGradients();if(L){q.emitRateGradients=[];for(const X of L){const Q={gradient:X.gradient,factor1:X.factor1};void 0!==X.factor2?Q.factor2=X.factor2:Q.factor2=X.factor1,q.emitRateGradients.push(Q)}}const f=X.getStartSizeGradients();if(f){q.startSizeGradients=[];for(const X of f){const Q={gradient:X.gradient,factor1:X.factor1};void 0!==X.factor2?Q.factor2=X.factor2:Q.factor2=X.factor1,q.startSizeGradients.push(Q)}}const k=X.getLifeTimeGradients();if(k){q.lifeTimeGradients=[];for(const X of k){const Q={gradient:X.gradient,factor1:X.factor1};void 0!==X.factor2?Q.factor2=X.factor2:Q.factor2=X.factor1,q.lifeTimeGradients.push(Q)}}const j=X.getLimitVelocityGradients();if(j){q.limitVelocityGradients=[];for(const X of j){const Q={gradient:X.gradient,factor1:X.factor1};void 0!==X.factor2?Q.factor2=X.factor2:Q.factor2=X.factor1,q.limitVelocityGradients.push(Q)}q.limitVelocityDamping=X.limitVelocityDamping}X.noiseTexture&&(q.noiseTexture=X.noiseTexture.serialize())}clone(q,X){let Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const y={...this._customWrappers};let x=null;const u=this._engine;if(u.createEffectForParticles&&null!=this.customShader){x=this.customShader;const q=x.shaderOptions.defines.length>0?x.shaderOptions.defines.join("\n"):"",X=u.createEffectForParticles(x.shaderPath.fragmentElement,x.shaderOptions.uniforms,x.shaderOptions.samplers,q);y[0]?y[0].effect=X:this.setCustomEffect(X,0)}const H=this.serialize(Q),b=eq.Parse(H,this._scene||this._engine,this._rootUrl);return b.name=q,b.customShader=x,b._customWrappers=y,void 0===X&&(X=this.k),this.noiseTexture&&(b.noiseTexture=this.noiseTexture.clone()),b.k=X,this.preventAutoStart||b.start(),b}}eq.BILLBOARDMODE_Y=2,eq.BILLBOARDMODE_ALL=7,eq.BILLBOARDMODE_STRETCHED=8,eq.BILLBOARDMODE_STRETCHED_LOCAL=9,bq._ParseParticleSystem=eq.Parse;var iq=Q(1234),Aq=Q(1206),Bq=Q(1430);Bq.e.prototype.createTransformFeedback=function(){const q=this._gl.createTransformFeedback();if(!q)throw new Error("Unable to create Transform Feedback");return q},Bq.e.prototype.deleteTransformFeedback=function(q){this._gl.deleteTransformFeedback(q)},Bq.e.prototype.bindTransformFeedback=function(q){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,q)},Bq.e.prototype.beginTransformFeedback=function(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(q?this._gl.POINTS:this._gl.TRIANGLES)},Bq.e.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},Bq.e.prototype.setTranformFeedbackVaryings=function(q,X){this._gl.transformFeedbackVaryings(q,X,this._gl.INTERLEAVED_ATTRIBS)},Bq.e.prototype.bindTransformFeedbackBuffer=function(q){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,q?q.underlyingResource:null)},Bq.e.prototype.readTransformFeedbackBuffer=function(q){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,q)};const wq="clipPlaneFragmentDeclaration2",Vq="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";Z.c.IncludesShadersStore[wq]=Vq;Q(10809),Q(10669),Q(10589),Q(10818),Q(10848),Q(10852),Q(10883),Q(10891);const Wq="gpuRenderParticlesPixelShader",vq="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";Z.c.ShadersStore[Wq]=vq;const Zq="clipPlaneVertexDeclaration2",Uq="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";Z.c.IncludesShadersStore[Zq]=Uq;Q(10635),Q(10725),Q(10734),Q(10753);const Oq="gpuRenderParticlesVertexShader",gq="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";Z.c.ShadersStore[Oq]=gq;class Pq extends D{static get IsSupported(){if(!s.c.LastCreatedEngine)return!1;const q=s.c.LastCreatedEngine.getCaps();return q.supportTransformFeedbacks||q.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(q){this._maxActiveParticleCount=Math.min(q,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(q){this.maxActiveParticleCount=q}createPointEmitter(q,X){const Q=aq(q,X);return this.particleEmitterType=Q,Q}createHemisphericEmitter(){const q=Rq(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=q,q}createSphereEmitter(){const q=Lq(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=q,q}createDirectedSphereEmitter(){const q=fq(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new y.n(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new y.n(0,1,0));return this.particleEmitterType=q,q}createCylinderEmitter(){const q=kq(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=q,q}createDirectedCylinderEmitter(){const q=jq(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new y.n(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new y.n(0,1,0));return this.particleEmitterType=q,q}createConeEmitter(){const q=Iq(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=q,q}createDirectedConeEmitter(){const q=dq(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new y.n(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new y.n(0,1,0));return this.particleEmitterType=q,q}createBoxEmitter(q,X,Q,y){const x=new L;return this.particleEmitterType=x,this.direction1=q,this.direction2=X,this.minEmitBox=Q,this.maxEmitBox=y,x}isReady(){if(!this.k||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==eq.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(eq.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(eq.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";q?setTimeout((()=>{this.start(0)}),q):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var q;let X=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(q=this._customWrappers[X])||void 0===q?void 0:q.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[q]??this._customWrappers[0]}setCustomEffect(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[X]=new qq.b(this._engine),this._customWrappers[X].effect=q}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new n.c),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(q,X,Q){return super._removeGradientAndTexture(q,X,Q),this._releaseBuffers(),this}addColorGradient(q,X){this._colorGradients||(this._colorGradients=[]);const Q=new G(q,X);return this._colorGradients.push(Q),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(q&&this._colorGradients.sort(((q,X)=>q.gradient<X.gradient?-1:q.gradient>X.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(q){return this._removeGradientAndTexture(q,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const X in this._drawWrappers){var q;null===(q=this._drawWrappers[X].drawContext)||void 0===q||q.reset()}}_addFactorGradient(q,X,Q){const y=new E(X,Q);q.push(y),this._releaseBuffers()}addSizeGradient(q,X){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,q,X),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(q){return this._removeGradientAndTexture(q,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(q,X){if(!q)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&q.sort(((q,X)=>q.gradient<X.gradient?-1:q.gradient>X.gradient?1:0));const Q=this;Q[X]&&(Q[X].dispose(),Q[X]=null)}addAngularSpeedGradient(q,X){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,q,X),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(q){return this._removeGradientAndTexture(q,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(q,X){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,q,X),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(q){return this._removeGradientAndTexture(q,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(q,X){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,q,X),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(q){return this._removeGradientAndTexture(q,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(q,X){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,q,X),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(q){return this._removeGradientAndTexture(q,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(q){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(q,X,Q){let x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,u=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(q),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this._d=new n.c,this.onStoppedObservable=new n.c,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._onBeforeDrawParticlesObservable=null,Q&&"Scene"!==Q.getClassName()?(this._engine=Q,this.defaultProjectionMatrix=y.b.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=Q||s.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.je.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,b.d)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,b.d)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,b.d)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,b.d)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new qq.b(this._engine)},this._customWrappers[0].effect=x,this._drawWrappers={0:new qq.b(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(X=X??{}).randomTextureSize||delete X.randomTextureSize;const H={Ld:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...X},D=X;isFinite(D)&&(H.Ld=D),this._capacity=H.Ld,this._maxActiveParticleCount=H.Ld,this._currentActiveCount=0,this._isAnimationSheetEnabled=u,this.particleEmitterType=new L;const a=Math.min(this._engine.getCaps().maxTextureSize,H.randomTextureSize);let R=[];for(let y=0;y<a;++y)R.push(Math.random()),R.push(Math.random()),R.push(Math.random()),R.push(Math.random());this._randomTexture=new r.c(new Float32Array(R),a,1,5,Q,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,R=[];for(let y=0;y<a;++y)R.push(Math.random()),R.push(Math.random()),R.push(Math.random()),R.push(Math.random());this._randomTexture2=new r.c(new Float32Array(R),a,1,5,Q,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=a}_reset(){this._releaseBuffers()}_createVertexBuffers(q,X,Q){const y={};y.position=X.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let x=3;y.age=X.createVertexBuffer("age",x,1,this._attributesStrideSize,!0),x+=1,y.size=X.createVertexBuffer("size",x,3,this._attributesStrideSize,!0),x+=3,y.life=X.createVertexBuffer("life",x,1,this._attributesStrideSize,!0),x+=1,x+=4,this.billboardMode===eq.BILLBOARDMODE_STRETCHED&&(y.direction=X.createVertexBuffer("direction",x,3,this._attributesStrideSize,!0)),x+=3,this._platform.alignDataInBuffer&&(x+=1),this.particleEmitterType instanceof B&&(x+=3,this._platform.alignDataInBuffer&&(x+=1)),this._colorGradientsTexture||(y.color=X.createVertexBuffer("color",x,4,this._attributesStrideSize,!0),x+=4),this._isBillboardBased||(y.initialDirection=X.createVertexBuffer("initialDirection",x,3,this._attributesStrideSize,!0),x+=3,this._platform.alignDataInBuffer&&(x+=1)),this.noiseTexture&&(y.noiseCoordinates1=X.createVertexBuffer("noiseCoordinates1",x,3,this._attributesStrideSize,!0),x+=3,this._platform.alignDataInBuffer&&(x+=1),y.noiseCoordinates2=X.createVertexBuffer("noiseCoordinates2",x,3,this._attributesStrideSize,!0),x+=3,this._platform.alignDataInBuffer&&(x+=1)),y.angle=X.createVertexBuffer("angle",x,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?x++:x+=2,this._isAnimationSheetEnabled&&(y.cellIndex=X.createVertexBuffer("cellIndex",x,1,this._attributesStrideSize,!0),x+=1,this.spriteRandomStartCell&&(y.cellStartOffset=X.createVertexBuffer("cellStartOffset",x,1,this._attributesStrideSize,!0),x+=1)),y.offset=Q.createVertexBuffer("offset",0,2),y.uv=Q.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(y),this._platform.createVertexBuffers(q,y),this.resetDrawCache()}_initialize(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!q)return;const X=this._engine,Q=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof B&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const x=this.particleEmitterType instanceof B,u=y.h.Od[0];let H=0;for(let y=0;y<this._capacity;y++)if(Q.push(0),Q.push(0),Q.push(0),Q.push(0),Q.push(0),Q.push(0),Q.push(0),Q.push(0),Q.push(Math.random()),Q.push(Math.random()),Q.push(Math.random()),Q.push(Math.random()),x?(this.particleEmitterType.particleDestinationGenerator(y,null,u),Q.push(u.x),Q.push(u.y),Q.push(u.z)):(Q.push(0),Q.push(0),Q.push(0)),this._platform.alignDataInBuffer&&Q.push(0),H+=16,x&&(this.particleEmitterType.particlePositionGenerator(y,null,u),Q.push(u.x),Q.push(u.y),Q.push(u.z),this._platform.alignDataInBuffer&&Q.push(0),H+=4),this._colorGradientsTexture||(Q.push(0),Q.push(0),Q.push(0),Q.push(0),H+=4),this.isBillboardBased||(Q.push(0),Q.push(0),Q.push(0),this._platform.alignDataInBuffer&&Q.push(0),H+=4),this.noiseTexture&&(Q.push(Math.random()),Q.push(Math.random()),Q.push(Math.random()),this._platform.alignDataInBuffer&&Q.push(0),Q.push(Math.random()),Q.push(Math.random()),Q.push(Math.random()),this._platform.alignDataInBuffer&&Q.push(0),H+=8),Q.push(0),H+=1,this._angularSpeedGradientsTexture||(Q.push(0),H+=1),this._isAnimationSheetEnabled&&(Q.push(0),H+=1,this.spriteRandomStartCell&&(Q.push(0),H+=1)),this._platform.alignDataInBuffer){let q=3-(H+3&3);for(H+=q;q-- >0;)Q.push(0)}const b=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),D=this._platform.createParticleBuffer(Q),a=this._platform.createParticleBuffer(Q);this._buffer0=new w.b(X,D,!1,this._attributesStrideSize),this._buffer1=new w.b(X,a,!1,this._attributesStrideSize),this._spriteBuffer=new w.b(X,b,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let q=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(q+="\n#define BILLBOARD"),this._colorGradientsTexture&&(q+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(q+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(q+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(q+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(q+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(q+="\n#define DRAGGRADIENTS"),this.isAnimationSheetEnabled&&(q+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(q+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(q+="\n#define NOISE"),this.isLocal&&(q+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===q||(this._cachedUpdateDefines=q,this._updateBuffer=this._platform.createUpdateBuffer(q)),this._platform.isUpdateBufferReady()}_getWrapper(q){const X=this._getCustomDrawWrapper(q);if(null!==X&&void 0!==X&&X.effect)return X;const Q=[];this.fillDefines(Q,q);let y=this._drawWrappers[q];y||(y=new qq.b(this._engine),y.drawContext&&(y.drawContext.useInstancing=!0),this._drawWrappers[q]=y);const x=Q.join("\n");if(y.defines!==x){const q=[],X=[],Q=[];this.fillUniformsAttributesAndSamplerNames(X,q,Q),y.setEffect(this._engine.createEffect("gpuRenderParticles",q,X,Q,x),x)}return y}static _GetAttributeNamesOrOptions(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2],y=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const x=[w.c.PositionKind,"age","life","size","angle"];return q||x.push(w.c.ColorKind),X&&x.push("cellIndex"),Q||x.push("initialDirection"),y&&x.push("direction"),x.push("offset",w.c.UVKind),x}static _GetEffectCreationOptions(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const y=["emitterWM","mg","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,Xq.e)(y),q&&y.push("sheetInfos"),X&&y.push("logarithmicDepthConstant"),Q&&(y.push("vFogInfos"),y.push("vFogColor")),y}fillDefines(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Q=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,Xq.j)(this,this._scene,q),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==Aq.d.FOGMODE_NONE&&q.push("#define FOG")),X===eq.BLENDMODE_MULTIPLY&&q.push("#define BLENDMULTIPLYMODE"),this.isLocal&&q.push("#define LOCAL"),this.useLogarithmicDepth&&q.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(q.push("#define BILLBOARD"),this.billboardMode){case eq.BILLBOARDMODE_Y:q.push("#define BILLBOARDY");break;case eq.BILLBOARDMODE_STRETCHED:q.push("#define BILLBOARDSTRETCHED");break;case eq.BILLBOARDMODE_ALL:q.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&q.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&q.push("#define ANIMATESHEET"),Q&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),q.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(q,X,Q){X.push(...Pq._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===eq.BILLBOARDMODE_STRETCHED)),q.push(...Pq._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),Q.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(iq.b.PrepareUniforms(q,this._imageProcessingConfigurationDefines),iq.b.PrepareSamplers(Q,this._imageProcessingConfigurationDefines))}animate(){var q;let X=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(X?this.preWarmStepOffset:(null===(q=this._scene)||void 0===q?void 0:q.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(q,X){const Q=this[X];if(!q||!q.length||Q)return;const y=new Float32Array(this._rawTextureWidth);for(let x=0;x<this._rawTextureWidth;x++){const X=x/this._rawTextureWidth;J.GetCurrentGradient(X,q,((q,X,Q)=>{y[x]=(0,a.n)(q.factor1,X.factor1,Q)}))}this[X]=r.c.CreateRTexture(y,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[X].name=X.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const q=new Uint8Array(4*this._rawTextureWidth),X=H.g.Ge[0];for(let Q=0;Q<this._rawTextureWidth;Q++){const y=Q/this._rawTextureWidth;J.GetCurrentGradient(y,this._colorGradients,((y,x,u)=>{H.c.LerpToRef(y.color1,x.color1,u,X),q[4*Q]=255*X.r,q[4*Q+1]=255*X.g,q[4*Q+2]=255*X.b,q[4*Q+3]=255*X.a}))}this._colorGradientsTexture=r.c.CreateRGBATexture(q,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(q,X){var Q,x,u,H;const b=this._getWrapper(q),D=b.effect;this._engine.enableEffect(b);const a=(null===(Q=this._scene)||void 0===Q?void 0:Q.getViewMatrix())||y.b.IdentityReadOnly;if(D.setMatrix("view",a),D.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),D.setTexture("diffuseSampler",this.particleTexture),D.setVector2("translationPivot",this.translationPivot),D.setVector3("mg",this.mg),this.isLocal&&D.setMatrix("emitterWM",X),this._colorGradientsTexture?D.setTexture("colorGradientSampler",this._colorGradientsTexture):D.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const q=this.particleTexture.getBaseSize();D.setFloat3("sheetInfos",this.spriteCellWidth/q.width,this.spriteCellHeight/q.height,q.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const q=this._scene.activeCamera;D.setVector3("eyePosition",q.globalPosition)}const R=D.defines;if(this._scene&&((0,Xq.g)(D,this,this._scene),this.applyFog&&(0,Qq.g)(this._scene,void 0,D)),R.indexOf("#define BILLBOARDMODE_ALL")>=0){const q=a.clone();q.invert(),D.setMatrix("invView",q)}switch(this.useLogarithmicDepth&&this._scene&&(0,Qq.l)(R,D,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(D),q){case eq.BLENDMODE_ADD:this._engine.setAlphaMode(1);break;case eq.BLENDMODE_ONEONE:this._engine.setAlphaMode(6);break;case eq.BLENDMODE_STANDARD:this._engine.setAlphaMode(2);break;case eq.BLENDMODE_MULTIPLY:this._engine.setAlphaMode(4)}return this._platform.bindDrawBuffers(this._targetIndex,D,null!==(x=this._scene)&&void 0!==x&&x.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(D),null!==(u=this._scene)&&void 0!==u&&u.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(H=this._scene)&&void 0!==H&&H.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(q){if(!this.k||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!q)if(this.k.position){q=this.k.getWorldMatrix()}else{const X=this.k;q=y.h.Matrix[0],y.b.TranslationToRef(X.x,X.y,X.z,q)}this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this.isLocal||this._updateBuffer.setMatrix("emitterWM",q),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const X=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=X}render(){let q,X=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!X&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let q=0;q<this.preWarmCycles;q++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>1){const q=0|this._accumulatedCount;this._accumulatedCount-=q,this._currentActiveCount+=q}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.k.position){q=this.k.getWorldMatrix()}else{const X=this.k;q=y.h.Matrix[0],y.b.TranslationToRef(X.x,X.y,X.z,q)}const x=this._engine;this.updateInAnimate||this._update(q);let u=0;return X||Q||(x.setState(!1),this.forceDepthWrite&&x.setDepthWrite(!0),u=this.blendMode===eq.BLENDMODE_MULTIPLYADD?this._render(eq.BLENDMODE_MULTIPLY,q)+this._render(eq.BLENDMODE_ADD,q):this._render(this.blendMode,q),this._engine.setAlphaMode(0)),u}rebuild(){const q=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(q,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,q()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const X in this._drawWrappers){this._drawWrappers[X].dispose()}if(this._drawWrappers={},this._scene){const q=this._scene.je.indexOf(this);q>-1&&this._scene.je.splice(q,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let X=0;X<this._renderVertexBuffers.length;++X){const q=this._renderVertexBuffers[X];for(const X in q)q[X].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),q&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),q&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this._d.notifyObservers(this),this._d.clear()}clone(q,X){let Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const y={...this._customWrappers};let x=null;const u=this._engine;if(u.createEffectForParticles&&null!=this.customShader){x=this.customShader;const q=x.shaderOptions.defines.length>0?x.shaderOptions.defines.join("\n"):"";y[0]=u.createEffectForParticles(x.shaderPath.fragmentElement,x.shaderOptions.uniforms,x.shaderOptions.samplers,q,void 0,void 0,void 0,this)}const H=this.serialize(Q),b=Pq.Parse(H,this._scene||this._engine,this._rootUrl);return b.name=q,b.customShader=x,b._customWrappers=y,void 0===X&&(X=this.k),this.noiseTexture&&(b.noiseTexture=this.noiseTexture.clone()),b.k=X,b}serialize(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const X={};return eq._Serialize(X,this,q),X.activeParticleCount=this.activeParticleCount,X.randomTextureSize=this._randomTextureSize,X.customShader=this.customShader,X}static Parse(q,X,Q){let y=arguments.length>3&&void 0!==arguments[3]&&arguments[3],x=arguments.length>4?arguments[4]:void 0;const u=q.name;let H,b;X instanceof Dq.e?H=X:(b=X,H=b.getEngine());const D=new Pq(u,{Ld:x||q.Ld,randomTextureSize:q.randomTextureSize},X,null,q.isAnimationSheetEnabled);if(D._rootUrl=Q,q.customShader&&H.createEffectForParticles){const X=q.customShader,Q=X.shaderOptions.defines.length>0?X.shaderOptions.defines.join("\n"):"",y=H.createEffectForParticles(X.shaderPath.fragmentElement,X.shaderOptions.uniforms,X.shaderOptions.samplers,Q,void 0,void 0,void 0,D);D.setCustomEffect(y,0),D.customShader=X}return q.id&&(D.id=q.id),q.activeParticleCount&&(D.activeParticleCount=q.activeParticleCount),eq._Parse(q,D,X,Q),q.preventAutoStart&&(D.preventAutoStart=q.preventAutoStart),y||D.preventAutoStart||D.start(),D}}var Fq=Q(1215),lq=Q(11412),mq=Q(1197);class Mq{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(q){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const X of this.systems)X.k=q;this._emitterNode=q}setEmitterAsSphere(q,X,Q){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:q,renderingGroupId:X};const y=(0,lq.c)("emitterSphere",{diameter:q.diameter,segments:q.segments},Q);y.renderingGroupId=X;const x=new mq.c("emitterSphereMaterial",Q);x.emissiveColor=q.color,y.material=x;for(const u of this.systems)u.k=y;this._emitterNode=y}start(q){for(const X of this.systems)q&&(X.k=q),X.start()}dispose(){for(const q of this.systems)q.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const X={systems:[]};for(const Q of this.systems)X.systems.push(Q.serialize(q));return this._emitterNode&&(X.k=this._emitterCreationOptions),X}static Parse(q,X){let Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2],y=arguments.length>3?arguments[3]:void 0;const x=new Mq,u=this.BaseAssetsUrl+"/textures/";X=X||s.c.LastCreatedScene;for(const H of q.systems)x.systems.push(Q?Pq.Parse(H,X,u,!0,y):eq.Parse(H,X,u,!0,y));if(q.k){const Q=q.k.options;if("Sphere"===q.k.kind)x.setEmitterAsSphere({diameter:Q.diameter,segments:Q.segments,color:H.b.Rd(Q.color)},q.k.renderingGroupId,X)}return x}}Mq.BaseAssetsUrl="https://assets.babylonjs.com/particles";var oq=Q(1059);class Yq{static CreateDefault(q){let X,Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,y=arguments.length>2?arguments[2]:void 0;return X=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new Pq("default system",{Ld:Q},y):new eq("default system",Q,y),X.k=q,X.particleTexture=new o.d("https://assets.babylonjs.com/textures/flare.png",X.va()),X.createConeEmitter(.1,Math.PI/4),X.color1=new H.c(1,1,1,1),X.color2=new H.c(1,1,1,1),X.colorDead=new H.c(1,1,1,0),X.minSize=.1,X.maxSize=.1,X.minEmitPower=2,X.maxEmitPower=2,X.updateSpeed=1/60,X.emitRate=30,X}static CreateAsync(q,X){let Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2],y=arguments.length>3?arguments[3]:void 0;X||(X=s.c.LastCreatedScene);const x={};return X.addPendingData(x),new Promise(((u,H)=>{if(Q&&!Pq.IsSupported)return X.removePendingData(x),H("Particle system with GPU is not supported.");Fq.f.LoadFile(`${Yq.BaseAssetsUrl}/systems/${q}.json`,(q=>{X.removePendingData(x);const H=JSON.parse(q.toString());return u(Mq.Parse(H,X,Q,y))}),void 0,void 0,void 0,(()=>(X.removePendingData(x),H(`An error occurred with the creation of your particle system. Check if your type '${q}' exists.`))))}))}static ExportSet(q){const X=new Mq;for(const Q of q)X.systems.push(Q);return X}static ParseFromFileAsync(q,X,Q){let y=arguments.length>3&&void 0!==arguments[3]&&arguments[3],x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",u=arguments.length>5?arguments[5]:void 0;return new Promise(((H,b)=>{const D=new oq.c;D.addEventListener("readystatechange",(()=>{if(4==D.readyState)if(200==D.status){const X=JSON.parse(D.responseText);let b;b=y?Pq.Parse(X,Q,x,!1,u):eq.Parse(X,Q,x,!1,u),q&&(b.name=q),H(b)}else b("Unable to load the particle system")})),D.open("GET",X),D.send()}))}static ParseFromSnippetAsync(q,X){let Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2],y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",x=arguments.length>4?arguments[4]:void 0;if("_BLANK"===q){const q=this.CreateDefault(null);return q.start(),Promise.resolve(q)}return new Promise(((u,H)=>{const b=new oq.c;b.addEventListener("readystatechange",(()=>{if(4==b.readyState)if(200==b.status){const H=JSON.parse(JSON.parse(b.responseText).jsonPayload),D=JSON.parse(H.particleSystem);let a;a=Q?Pq.Parse(D,X,y,!1,x):eq.Parse(D,X,y,!1,x),a.snippetId=q,u(a)}else H("Unable to load the snippet "+q)})),b.open("GET",this.SnippetUrl+"/"+q.replace(/#/g,"/")),b.send()}))}}Yq.BaseAssetsUrl=Mq.BaseAssetsUrl,Yq.SnippetUrl="https://snippet.babylonjs.com",Yq.CreateFromSnippetAsync=Yq.ParseFromSnippetAsync;var Nq=Q(11253),Sq=Q(1285),cq=Q(11418);(0,cq.f)(Sq.c.NAME_PARTICLESYSTEM,((q,X,Q,y)=>{const x=(0,cq.h)(Sq.c.NAME_PARTICLESYSTEM);if(x&&void 0!==q.je&&null!==q.je)for(let u=0,H=q.je.length;u<H;u++){const H=q.je[u];Q.je.push(x(H,X,y))}})),(0,cq.d)(Sq.c.NAME_PARTICLESYSTEM,((q,X,Q)=>{if(q.activeParticleCount){return Pq.Parse(q,X,Q)}return eq.Parse(q,X,Q)})),Dq.e.prototype.createEffectForParticles=function(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",u=arguments.length>4?arguments[4]:void 0,H=arguments.length>5?arguments[5]:void 0,b=arguments.length>6?arguments[6]:void 0,D=arguments.length>7?arguments[7]:void 0,a=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,R=[],L=[];const f=[];return D?D.fillUniformsAttributesAndSamplerNames(L,R,f):(R=eq._GetAttributeNamesOrOptions(),L=eq._GetEffectCreationOptions()),-1===x.indexOf(" BILLBOARD")&&(x+="\n#define BILLBOARD\n"),null!==D&&void 0!==D&&D.isAnimationSheetEnabled&&-1===x.indexOf(" ANIMATESHEET")&&(x+="\n#define ANIMATESHEET\n"),-1===y.indexOf("diffuseSampler")&&y.push("diffuseSampler"),this.createEffect({vertex:(null===D||void 0===D?void 0:D.vertexShaderName)??"particles",fragmentElement:q},R,L.concat(X),f.concat(y),x,u,H,b,void 0,a,(async()=>{0===a?await Promise.resolve().then(Q.bind(Q,11433)):await Promise.resolve().then(Q.bind(Q,11451))}))},Nq.b.prototype.getEmittedParticleSystems=function(){const q=[];for(let X=0;X<this.va().je.length;X++){const Q=this.va().je[X];Q.k===this&&q.push(Q)}return q},Nq.b.prototype.getHierarchyEmittedParticleSystems=function(){const q=[],X=this.getDescendants();X.push(this);for(let Q=0;Q<this.va().je.length;Q++){const y=this.va().je[Q],x=y.k;x.position&&-1!==X.indexOf(x)&&q.push(y)}return q};Q(1347),Q(1360),Q(11291);Q(11276),Q(11421),Q(1497),Q(1337),Q(11307);Q(1489);var pq;Q(11425),Q(1039);!function(q){q[q.Color=2]="Color",q[q.UV=1]="UV",q[q.Random=0]="Random",q[q.Stated=3]="Stated"}(pq||(pq={}));Q(11429),Q(11433),Q(11442),Q(11451)},10520:(q,X,Q)=>{"use strict";const y="clipPlaneFragment",x="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";Q(1119).c.IncludesShadersStoreWGSL[y]=x},10508:(q,X,Q)=>{"use strict";const y="clipPlaneFragmentDeclaration",x="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";Q(1119).c.IncludesShadersStoreWGSL[y]=x},10423:(q,X,Q)=>{"use strict";const y="clipPlaneVertex",x="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";Q(1119).c.IncludesShadersStoreWGSL[y]=x},10340:(q,X,Q)=>{"use strict";const y="clipPlaneVertexDeclaration",x="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";Q(1119).c.IncludesShadersStoreWGSL[y]=x},10548:(q,X,Q)=>{"use strict";const y="fogFragment",x="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";Q(1119).c.IncludesShadersStoreWGSL[y]=x},10517:(q,X,Q)=>{"use strict";const y="fogFragmentDeclaration",x="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";Q(1119).c.IncludesShadersStoreWGSL[y]=x},10430:(q,X,Q)=>{"use strict";const y="fogVertex",x="#ifdef FOG\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#endif\n";Q(1119).c.IncludesShadersStoreWGSL[y]=x},10346:(q,X,Q)=>{"use strict";const y="fogVertexDeclaration",x="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";Q(1119).c.IncludesShadersStoreWGSL[y]=x},10297:(q,X,Q)=>{"use strict";const y="helperFunctions",x="const PI: f32=3.1415926535897932384626433832795;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3<f32>=vec3<f32> (0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(0.0),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);} \nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3<f32>=inMatrix[0];let i1: vec3<f32>=inMatrix[1];let i2: vec3<f32>=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3<f32>)->vec3<f32>\n{let nearZeroSection: vec3<f32>=0.0773993808*color;let remainingSection: vec3<f32>=pow(0.947867299*(color+vec3<f32>(0.055)),vec3<f32>(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3<f32>(0.04045)));}\nfn toGammaSpaceExact(color: vec3<f32>)->vec3<f32>\n{let nearZeroSection: vec3<f32>=12.92*color;let remainingSection: vec3<f32>=1.055*pow(color,vec3<f32>(0.41666))-vec3<f32>(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3<f32>(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3<f32>)->vec3<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3<f32>(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3<f32>(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3<f32>)->vec3<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3<f32>(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3<f32>)->vec3<f32>\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3<f32>)->f32\n{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3<f32>)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3<f32> =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(clamp(rgb,vec3<f32>(0.,0.,0.),vec3<f32>(1.,1.,1.)),D); }\nfn fromRGBD(rgbd: vec4<f32>)->vec3<f32> {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3<f32>,origVec: vec3<f32>,cubeSize: vec3<f32>,cubePos: vec3<f32>)->vec3<f32> {let invOrigVec: vec3<f32>=vec3<f32>(1.0,1.0,1.0)/origVec;let halfSize: vec3<f32>=cubeSize*0.5;let intersecAtMaxPlane: vec3<f32>=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3<f32>=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3<f32>=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3<f32>=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\n";Q(1119).c.IncludesShadersStoreWGSL[y]=x},10484:(q,X,Q)=>{"use strict";const y="imageProcessingDeclaration",x="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";Q(1119).c.IncludesShadersStoreWGSL[y]=x},10489:(q,X,Q)=>{"use strict";const y="imageProcessingFunctions",x="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";Q(1119).c.IncludesShadersStoreWGSL[y]=x},10368:(q,X,Q)=>{"use strict";const y="logDepthDeclaration",x="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";Q(1119).c.IncludesShadersStoreWGSL[y]=x},10540:(q,X,Q)=>{"use strict";const y="logDepthFragment",x="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";Q(1119).c.IncludesShadersStoreWGSL[y]=x},10448:(q,X,Q)=>{"use strict";const y="logDepthVertex",x="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";Q(1119).c.IncludesShadersStoreWGSL[y]=x},11442:(q,X,Q)=>{"use strict";Q.r(X),Q.d(X,{particlesPixelShaderWGSL:()=>H});var y=Q(1119);Q(10508),Q(10484),Q(10368),Q(10297),Q(10489),Q(10517),Q(10520),Q(10540),Q(10548);const x="particlesPixelShader",u="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";y.c.ShadersStoreWGSL[x]=u;const H={name:x,shader:u}},11451:(q,X,Q)=>{"use strict";Q.r(X),Q.d(X,{particlesVertexShaderWGSL:()=>H});var y=Q(1119);Q(10340),Q(10346),Q(10368),Q(10423),Q(10430),Q(10448);const x="particlesVertexShader",u="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return input.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";y.c.ShadersStoreWGSL[x]=u;const H={name:x,shader:u}},10852:(q,X,Q)=>{"use strict";const y="clipPlaneFragment",x="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";Q(1119).c.IncludesShadersStore[y]=x},10842:(q,X,Q)=>{"use strict";const y="clipPlaneFragmentDeclaration",x="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";Q(1119).c.IncludesShadersStore[y]=x},10725:(q,X,Q)=>{"use strict";const y="clipPlaneVertex",x="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";Q(1119).c.IncludesShadersStore[y]=x},10633:(q,X,Q)=>{"use strict";const y="clipPlaneVertexDeclaration",x="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";Q(1119).c.IncludesShadersStore[y]=x},10891:(q,X,Q)=>{"use strict";const y="fogFragment",x="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";Q(1119).c.IncludesShadersStore[y]=x},10848:(q,X,Q)=>{"use strict";const y="fogFragmentDeclaration",x="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";Q(1119).c.IncludesShadersStore[y]=x},10734:(q,X,Q)=>{"use strict";const y="fogVertex",x="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";Q(1119).c.IncludesShadersStore[y]=x},10635:(q,X,Q)=>{"use strict";const y="fogVertexDeclaration",x="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";Q(1119).c.IncludesShadersStore[y]=x},10589:(q,X,Q)=>{"use strict";const y="helperFunctions",x="const float PI=3.1415926535897932384626433832795;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.0;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(clamp(rgb,0.,1.),D); }\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.0,1.0,1.0)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\n";Q(1119).c.IncludesShadersStore[y]=x},10809:(q,X,Q)=>{"use strict";const y="imageProcessingDeclaration",x="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";Q(1119).c.IncludesShadersStore[y]=x},10818:(q,X,Q)=>{"use strict";const y="imageProcessingFunctions",x="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";Q(1119).c.IncludesShadersStore[y]=x},10669:(q,X,Q)=>{"use strict";const y="logDepthDeclaration",x="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";Q(1119).c.IncludesShadersStore[y]=x},10883:(q,X,Q)=>{"use strict";const y="logDepthFragment",x="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";Q(1119).c.IncludesShadersStore[y]=x},10753:(q,X,Q)=>{"use strict";const y="logDepthVertex",x="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";Q(1119).c.IncludesShadersStore[y]=x},11429:(q,X,Q)=>{"use strict";Q.r(X),Q.d(X,{particlesPixelShader:()=>H});var y=Q(1119);Q(10842),Q(10809),Q(10669),Q(10589),Q(10818),Q(10848),Q(10852),Q(10883),Q(10891);const x="particlesPixelShader",u="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";y.c.ShadersStore[x]=u;const H={name:x,shader:u}},11433:(q,X,Q)=>{"use strict";Q.r(X),Q.d(X,{particlesVertexShader:()=>H});var y=Q(1119);Q(10633),Q(10635),Q(10669),Q(10725),Q(10734),Q(10753);const x="particlesVertexShader",u="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";y.c.ShadersStore[x]=u;const H={name:x,shader:u}},11270:(q,X,Q)=>{"use strict";Q.d(X,{d:()=>L});var y=Q(975),x=Q(1002),u=Q(984),H=Q(998),b=Q(1028),D=Q(1081),a=Q(1173);class R{constructor(){this._doNotSerialize=!1,this._isDisposed=!1,this._sceneRootNodesIndex=-1,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._onEnabledStateChangedObservable=new H.c,this._onClonedObservable=new H.c}}class L{static AddNodeConstructor(q,X){this._NodeConstructors[q]=X}static Construct(q,X,Q,y){const x=this._NodeConstructors[q];return x?x(X,Q,y):null}set accessibilityTag(q){this._accessibilityTag=q,this.onAccessibilityTagChangedObservable.notifyObservers(q)}get accessibilityTag(){return this._accessibilityTag}get doNotSerialize(){return!!this._nodeDataStorage._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize}set doNotSerialize(q){this._nodeDataStorage._doNotSerialize=q}u(){return this._nodeDataStorage._isDisposed}set parent(q){if(this._parentNode===q)return;const X=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){const X=this._parentNode._children.indexOf(this);-1!==X&&this._parentNode._children.splice(X,1),q||this._nodeDataStorage._isDisposed||this._addToSceneRootNodes()}this._parentNode=q,this._isDirty=!0,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),X||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}get parent(){return this._parentNode}_serializeAsParent(q){q.parentId=this.uniqueId}_addToSceneRootNodes(){-1===this._nodeDataStorage._sceneRootNodesIndex&&(this._nodeDataStorage._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))}_removeFromSceneRootNodes(){if(-1!==this._nodeDataStorage._sceneRootNodesIndex){const q=this._scene.rootNodes,X=q.length-1;q[this._nodeDataStorage._sceneRootNodesIndex]=q[X],q[this._nodeDataStorage._sceneRootNodesIndex]._nodeDataStorage._sceneRootNodesIndex=this._nodeDataStorage._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._nodeDataStorage._sceneRootNodesIndex=-1}}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(q){this._animationPropertiesOverride=q}getClassName(){return"Node"}set onDispose(q){this._onDisposeObserver&&this._d.remove(this._onDisposeObserver),this._onDisposeObserver=this._d.add(q)}get onEnabledStateChangedObservable(){return this._nodeDataStorage._onEnabledStateChangedObservable}get onClonedObservable(){return this._nodeDataStorage._onClonedObservable}constructor(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Q=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._isDirty=!1,this._nodeDataStorage=new R,this.state="",this.metadata=null,this.reservedDataStore=null,this._accessibilityTag=null,this.onAccessibilityTagChangedObservable=new H.c,this._parentContainer=null,this.animations=[],this._ranges={},this.onReady=null,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._waitingParentInstanceIndex=null,this._waitingParsedUniqueId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=x.b.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._animationPropertiesOverride=null,this._isNode=!0,this._d=new H.c,this._onDisposeObserver=null,this._behaviors=new Array,this.name=q,this.id=q,this._scene=X||b.c.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache(),Q&&this._addToSceneRootNodes()}va(){return this._scene}getEngine(){return this._scene.getEngine()}addBehavior(q){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return-1!==this._behaviors.indexOf(q)||(q.init(),this._scene.isLoading&&!X?this._scene.onDataLoadedObservable.addOnce((()=>{q.attach(this)})):q.attach(this),this._behaviors.push(q)),this}removeBehavior(q){const X=this._behaviors.indexOf(q);return-1===X||(this._behaviors[X].detach(),this._behaviors.splice(X,1)),this}get behaviors(){return this._behaviors}getBehaviorByName(q){for(const X of this._behaviors)if(X.name===q)return X;return null}getWorldMatrix(){return this._currentRenderId!==this._scene.getRenderId()&&this.le(),this._worldMatrix}_getWorldMatrixDeterminant(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant}get worldMatrixFromCache(){return this._worldMatrix}_initCache(){this._cache={}}updateCache(q){!q&&this.isSynchronized()||this._updateCache()}_getActionManagerForTrigger(q){return this.parent?this.parent._getActionManagerForTrigger(q,!1):null}_updateCache(q){}_isSynchronized(){return!0}_markSyncedWithParent(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)}isSynchronizedWithParent(){return!this._parentNode||!this._parentNode._isDirty&&this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()}isSynchronized(){return!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()}isReady(){return this._nodeDataStorage._isReady}te(q){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}isEnabled(){return!1===(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])?this._nodeDataStorage._isEnabled:!!this._nodeDataStorage._isEnabled&&this._nodeDataStorage._isParentEnabled}_syncParentEnabledState(){this._nodeDataStorage._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children&&this._children.forEach((q=>{q._syncParentEnabledState()}))}tg(q){this._nodeDataStorage._isEnabled!==q&&(this._nodeDataStorage._isEnabled=q,this._syncParentEnabledState(),this._nodeDataStorage._onEnabledStateChangedObservable.notifyObservers(q))}isDescendantOf(q){return!!this.parent&&(this.parent===q||this.parent.isDescendantOf(q))}_getDescendants(q){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Q=arguments.length>2?arguments[2]:void 0;if(this._children)for(let y=0;y<this._children.length;y++){const x=this._children[y];Q&&!Q(x)||q.push(x),X||x._getDescendants(q,!1,Q)}}getDescendants(q,X){const Q=[];return this._getDescendants(Q,q,X),Q}getChildMeshes(q,X){const Q=[];return this._getDescendants(Q,q,(q=>(!X||X(q))&&void 0!==q.Je)),Q}getChildren(q){let X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.getDescendants(X,q)}_setReady(q){q!==this._nodeDataStorage._isReady&&(q?(this.onReady&&this.onReady(this),this._nodeDataStorage._isReady=!0):this._nodeDataStorage._isReady=!1)}getAnimationByName(q){for(let X=0;X<this.animations.length;X++){const Q=this.animations[X];if(Q.name===q)return Q}return null}createAnimationRange(q,X,Q){if(!this._ranges[q]){this._ranges[q]=L._AnimationRangeFactory(q,X,Q);for(let y=0,x=this.animations.length;y<x;y++)this.animations[y]&&this.animations[y].createRange(q,X,Q)}}deleteAnimationRange(q){let X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let Q=0,y=this.animations.length;Q<y;Q++)this.animations[Q]&&this.animations[Q].deleteRange(q,X);this._ranges[q]=null}getAnimationRange(q){return this._ranges[q]||null}clone(q,X,Q){const y=a.c.Clone((()=>new L(q,this.va())),this);if(X&&(y.parent=X),!Q){const X=this.getDescendants(!0);for(let Q=0;Q<X.length;Q++){const x=X[Q];x.clone(q+"."+x.name,y)}}return y}getAnimationRanges(){const q=[];let X;for(X in this._ranges)q.push(this._ranges[X]);return q}beginAnimation(q,X,Q,y){const x=this.getAnimationRange(q);return x?this._scene.beginAnimation(this,x.from,x.to,X,Q,y):null}serializeAnimationRanges(){const q=[];for(const X in this._ranges){const Q=this._ranges[X];if(!Q)continue;const y={};y.name=X,y.from=Q.from,y.to=Q.to,q.push(y)}return q}le(q){return this._worldMatrix||(this._worldMatrix=x.b.Identity()),this._worldMatrix}dispose(q){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._nodeDataStorage._isDisposed=!0,!q){const Q=this.getDescendants(!0);for(const y of Q)y.dispose(q,X)}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this._d.notifyObservers(this),this._d.clear(),this.onEnabledStateChangedObservable.clear(),this.onClonedObservable.clear();for(const Q of this._behaviors)Q.detach();this._behaviors.length=0,this.metadata=null}static ParseAnimationRanges(q,X,Q){if(X.ranges)for(let y=0;y<X.ranges.length;y++){const Q=X.ranges[y];q.createAnimationRange(Q.name,Q.from,Q.to)}}getHierarchyBoundingVectors(){let q,X,Q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.va().incrementRenderId(),this.le(!0);const u=this;if(u.getBoundingInfo&&u.be){const Q=u.getBoundingInfo();q=Q.boundingBox.minimumWorld.clone(),X=Q.boundingBox.maximumWorld.clone()}else q=new x.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),X=new x.n(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(Q){const Q=this.getDescendants(!1);for(const u of Q){const Q=u;if(Q.le(!0),y&&!y(Q))continue;if(!Q.getBoundingInfo||0===Q.getTotalVertices())continue;const H=Q.getBoundingInfo().boundingBox,b=H.minimumWorld,D=H.maximumWorld;x.n.CheckExtends(b,q,X),x.n.CheckExtends(D,q,X)}}return{min:q,max:X}}}L._AnimationRangeFactory=(q,X,Q)=>{throw(0,D.c)("AnimationRange")},L._NodeConstructors={},(0,y.b)([(0,u.J)()],L.prototype,"name",void 0),(0,y.b)([(0,u.J)()],L.prototype,"id",void 0),(0,y.b)([(0,u.J)()],L.prototype,"uniqueId",void 0),(0,y.b)([(0,u.J)()],L.prototype,"state",void 0),(0,y.b)([(0,u.J)()],L.prototype,"metadata",void 0)},11854:(q,X,Q)=>{"use strict";class y{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((q,X)=>{this._resolve=q,this._reject=X}))}}var x=Q(1002),u=Q(1182),H=Q(1215),b=Q(11265),D=Q(11859),a=Q(11877),R=Q(998),L=Q(11408),f=Q(11882),k=Q(11887),j=Q(1028),I=Q(1099),d=Q(1220);class e{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(q){this._useTextureToStoreBoneMatrices=q,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(q){this._animationPropertiesOverride=q}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(q,X,Q){this.name=q,this.id=X,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=x.b.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new R.c,this.bones=[],this._scene=Q||j.c.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const y=this._scene.getEngine().getCaps();this._canUseTextureForBones=y.textureFloat&&y.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((q=>!q.getParent()))}getTransformMatrices(q){if(this.needInitialSkinMatrix){if(!q)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return q._bonesTransformMatrices||this.prepare(!0),q._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(q){return this.needInitialSkinMatrix&&q._transformMatrixTexture?q._transformMatrixTexture:this._transformMatrixTexture}va(){return this._scene}toString(q){let X=`Name: ${this.name}, nBones: ${this.bones.length}`;if(X+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,q){X+=", Ranges: {";let q=!0;for(const Q in this._ranges)q&&(X+=", ",q=!1),X+=Q;X+="}"}return X}getBoneIndexByName(q){for(let X=0,Q=this.bones.length;X<Q;X++)if(this.bones[X].name===q)return X;return-1}createAnimationRange(q,X,Q){if(!this._ranges[q]){this._ranges[q]=new k.b(q,X,Q);for(let y=0,x=this.bones.length;y<x;y++)this.bones[y].animations[0]&&this.bones[y].animations[0].createRange(q,X,Q)}}deleteAnimationRange(q){let X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let Q=0,y=this.bones.length;Q<y;Q++)this.bones[Q].animations[0]&&this.bones[Q].animations[0].deleteRange(q,X);this._ranges[q]=null}getAnimationRange(q){return this._ranges[q]||null}getAnimationRanges(){const q=[];let X;for(X in this._ranges)q.push(this._ranges[X]);return q}copyAnimationRange(q,X){let Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[X]||!q.getAnimationRange(X))return!1;let y=!0;const x=this._getHighestAnimationFrame()+1,u={},H=q.bones;let b,D;for(D=0,b=H.length;D<b;D++)u[H[D].name]=H[D];this.bones.length!==H.length&&(I.b.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${H.length}`),y=!1);const a=Q&&this.dimensionsAtRest&&q.dimensionsAtRest?this.dimensionsAtRest.divide(q.dimensionsAtRest):null;for(D=0,b=this.bones.length;D<b;D++){const q=this.bones[D].name,H=u[q];H?y=y&&this.bones[D].copyAnimationRange(H,X,x,Q,a):(I.b.Warn("copyAnimationRange: not same rig, missing source bone "+q),y=!1)}const R=q.getAnimationRange(X);return R&&(this._ranges[X]=new k.b(X,R.from+x,R.to+x)),y}returnToRest(){for(const q of this.bones)-1!==q._index&&q.returnToRest()}_getHighestAnimationFrame(){let q=0;for(let X=0,Q=this.bones.length;X<Q;X++)if(this.bones[X].animations[0]){const Q=this.bones[X].animations[0].getHighestFrame();q<Q&&(q=Q)}return q}beginAnimation(q,X,Q,y){const x=this.getAnimationRange(q);return x?this._scene.beginAnimation(this,x.from,x.to,X,Q,y):null}static MakeAnimationAdditive(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Q=arguments.length>2?arguments[2]:void 0;const y=q.getAnimationRange(Q);if(!y)return null;const x=q._scene.getAllAnimatablesByTarget(q);let u=null;for(let b=0;b<x.length;b++){const q=x[b];if(q.fromFrame===(null===y||void 0===y?void 0:y.from)&&q.toFrame===(null===y||void 0===y?void 0:y.to)){u=q;break}}const H=q.getAnimatables();for(let b=0;b<H.length;b++){const q=H[b].animations;if(q)for(let y=0;y<q.length;y++)f.e.MakeAnimationAdditive(q[y],X,Q)}return u&&(u.isAdditive=!0),q}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(q){this._meshesWithPoseMatrix.push(q)}_unregisterMeshWithPoseMatrix(q){const X=this._meshesWithPoseMatrix.indexOf(q);X>-1&&this._meshesWithPoseMatrix.splice(X,1)}_computeTransformMatrices(q,X){this.onBeforeComputeObservable.notifyObservers(this);for(let Q=0;Q<this.bones.length;Q++){const y=this.bones[Q];y._childUpdateId++;const x=y.getParent();if(x?y.getLocalMatrix().multiplyToRef(x.getFinalMatrix(),y.getFinalMatrix()):X?y.getLocalMatrix().multiplyToRef(X,y.getFinalMatrix()):y.getFinalMatrix().p(y.getLocalMatrix()),-1!==y._index){const X=null===y._index?Q:y._index;y.getAbsoluteInverseBindMatrix().multiplyToArray(y.getFinalMatrix(),q,16*X)}}this._identity.copyToArray(q,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const q=this.va().getRenderId();if(this._currentRenderId===q)return;this._currentRenderId=q}if(this._numBonesWithLinkedTransformNode>0)for(const q of this.bones)if(q._linkedTransformNode){const X=q._linkedTransformNode;q.position=X.position,X.rotationQuaternion?q.rotationQuaternion=X.rotationQuaternion:q.rotation=X.rotation,q.He=X.He}if(this.needInitialSkinMatrix)for(const q of this._meshesWithPoseMatrix){const X=q.getPoseMatrix();let Q=this._isDirty;if(q._bonesTransformMatrices&&q._bonesTransformMatrices.length===16*(this.bones.length+1)||(q._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),Q=!0),Q){if(this._synchronizedWithMesh!==q){this._synchronizedWithMesh=q;for(const q of this.bones)if(!q.getParent()){q.getBindMatrix().multiplyToRef(X,x.h.Matrix[1]),q._updateAbsoluteBindMatrices(x.h.Matrix[1])}if(this.isUsingTextureForMatrices){const X=4*(this.bones.length+1);q._transformMatrixTexture&&q._transformMatrixTexture.getSize().width===X||(q._transformMatrixTexture&&q._transformMatrixTexture.dispose(),q._transformMatrixTexture=L.c.CreateRGBATexture(q._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(q._bonesTransformMatrices,X),this.isUsingTextureForMatrices&&q._transformMatrixTexture&&q._transformMatrixTexture.update(q._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=L.c.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let q=0;q<this.bones.length;q++)this._animatables.push(this.bones[q])}return this._animatables}clone(q,X){const Q=new e(q,X||q,this._scene);Q.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let y=0;y<this.bones.length;y++){const q=this.bones[y];let X=null;const x=q.getParent();if(x){const q=this.bones.indexOf(x);X=Q.bones[q]}const u=new a.e(q.name,Q,X,q.getBindMatrix().clone(),q.getRestMatrix().clone());u._index=q._index,q._linkedTransformNode&&u.linkTransformNode(q._linkedTransformNode),d.d.DeepCopy(q.animations,u.animations)}if(this._ranges){Q._ranges={};for(const q in this._ranges){const X=this._ranges[q];X&&(Q._ranges[q]=X.clone())}}return this._isDirty=!0,Q.prepare(!0),Q}enableBlending(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;this.bones.forEach((X=>{X.animations.forEach((X=>{X.enableBlending=!0,X.blendingSpeed=q}))}))}dispose(){if(this._meshesWithPoseMatrix.length=0,this.va().stopAnimation(this),this.va().removeSkeleton(this),this._parentContainer){const q=this._parentContainer.skeletons.indexOf(this);q>-1&&this._parentContainer.skeletons.splice(q,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const q={};q.name=this.name,q.id=this.id,this.dimensionsAtRest&&(q.dimensionsAtRest=this.dimensionsAtRest.ee()),q.bones=[],q.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let Q=0;Q<this.bones.length;Q++){var X;const y=this.bones[Q],x=y.getParent(),u={parentBoneIndex:x?this.bones.indexOf(x):-1,index:y.getIndex(),name:y.name,id:y.id,matrix:y.getBindMatrix().ee(),rest:y.getRestMatrix().ee(),linkedTransformNodeId:null===(X=y.getTransformNode())||void 0===X?void 0:X.id};q.bones.push(u),y.length&&(u.length=y.length),y.metadata&&(u.metadata=y.metadata),y.animations&&y.animations.length>0&&(u.animation=y.animations[0].serialize()),q.ranges=[];for(const X in this._ranges){const Q=this._ranges[X];if(!Q)continue;const y={};y.name=X,y.from=Q.from,y.to=Q.to,q.ranges.push(y)}}return q}static Parse(q,X){const Q=new e(q.name,q.id,X);let y;for(q.dimensionsAtRest&&(Q.dimensionsAtRest=x.n.Rd(q.dimensionsAtRest)),Q.needInitialSkinMatrix=q.needInitialSkinMatrix,y=0;y<q.bones.length;y++){const X=q.bones[y],u=q.bones[y].index;let H=null;X.parentBoneIndex>-1&&(H=Q.bones[X.parentBoneIndex]);const b=X.rest?x.b.Rd(X.rest):null,D=new a.e(X.name,Q,H,x.b.Rd(X.matrix),b,null,u);void 0!==X.id&&null!==X.id&&(D.id=X.id),X.length&&(D.length=X.length),X.metadata&&(D.metadata=X.metadata),X.animation&&D.animations.push(f.e.Parse(X.animation)),void 0!==X.linkedTransformNodeId&&null!==X.linkedTransformNodeId&&(Q._hasWaitingData=!0,D._waitingTransformNodeId=X.linkedTransformNodeId)}if(q.ranges)for(y=0;y<q.ranges.length;y++){const X=q.ranges[y];Q.createAnimationRange(X.name,X.from,X.to)}return Q}computeAbsoluteMatrices(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||q)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(q)}getPoseMatrix(){let q=null;return this._meshesWithPoseMatrix.length>0&&(q=this._meshesWithPoseMatrix[0].getPoseMatrix()),q}sortBones(){const q=[],X=new Array(this.bones.length);for(let Q=0;Q<this.bones.length;Q++)this._sortBones(Q,q,X);this.bones=q}_sortBones(q,X,Q){if(Q[q])return;Q[q]=!0;const y=this.bones[q];if(!y)return;void 0===y._index&&(y._index=q);const x=y.getParent();x&&this._sortBones(this.bones.indexOf(x),X,Q),X.push(y)}setCurrentPoseAsRest(){this.bones.forEach((q=>{q.setCurrentPoseAsRest()}))}}var i=Q(1331),A=Q(975),B=Q(984),w=Q(11893),V=Q(11899),W=Q(1015),v=Q(1173);class Z extends V.d{get refractionTexture(){return this.subSurface.refractionTexture}set refractionTexture(q){this.subSurface.refractionTexture=q,q?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)}get indexOfRefraction(){return this.subSurface.indexOfRefraction}set indexOfRefraction(q){this.subSurface.indexOfRefraction=q}get invertRefractionY(){return this.subSurface.invertRefractionY}set invertRefractionY(q){this.subSurface.invertRefractionY=q}get linkRefractionWithTransparency(){return this.subSurface.linkRefractionWithTransparency}set linkRefractionWithTransparency(q){this.subSurface.linkRefractionWithTransparency=q,q&&(this.subSurface.isRefractionEnabled=!0)}get usePhysicalLightFalloff(){return this._lightFalloff===V.d.LIGHTFALLOFF_PHYSICAL}set usePhysicalLightFalloff(q){q!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=q?V.d.LIGHTFALLOFF_PHYSICAL:V.d.LIGHTFALLOFF_STANDARD)}get useGLTFLightFalloff(){return this._lightFalloff===V.d.LIGHTFALLOFF_GLTF}set useGLTFLightFalloff(q){q!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=q?V.d.LIGHTFALLOFF_GLTF:V.d.LIGHTFALLOFF_STANDARD)}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(q){this._attachImageProcessingConfiguration(q),this._markAllSubMeshesAsTexturesDirty()}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(q){this.imageProcessingConfiguration.colorCurvesEnabled=q}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(q){this.imageProcessingConfiguration.colorGradingEnabled=q}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(q){this._imageProcessingConfiguration.toneMappingEnabled=q}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(q){this._imageProcessingConfiguration.exposure=q}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(q){this._imageProcessingConfiguration.contrast=q}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(q){this._imageProcessingConfiguration.colorGradingTexture=q}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(q){this._imageProcessingConfiguration.colorCurves=q}constructor(q,X){super(q,X,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.directIntensity=1,this.emissiveIntensity=1,this.environmentIntensity=1,this.specularIntensity=1,this.disableBumpMap=!1,this.ambientTextureStrength=1,this.ambientTextureImpactOnAnalyticalLights=Z.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this.metallicF0Factor=1,this.metallicReflectanceColor=u.b.White(),this.useOnlyMetallicFromMetallicReflectanceTexture=!1,this.ambientColor=new u.b(0,0,0),this.albedoColor=new u.b(1,1,1),this.reflectivityColor=new u.b(1,1,1),this.reflectionColor=new u.b(1,1,1),this.emissiveColor=new u.b(0,0,0),this.microSurface=1,this.useLightmapAsShadowmap=!1,this.useAlphaFromAlbedoTexture=!1,this.forceAlphaTest=!1,this.alphaCutOff=.4,this.useSpecularOverAlpha=!0,this.useMicroSurfaceFromReflectivityMapAlpha=!1,this.useRoughnessFromMetallicTextureAlpha=!0,this.useRoughnessFromMetallicTextureGreen=!1,this.useMetallnessFromMetallicTextureBlue=!1,this.useAmbientOcclusionFromMetallicTextureRed=!1,this.useAmbientInGrayScale=!1,this.useAutoMicroSurfaceFromReflectivityMap=!1,this.useRadianceOverAlpha=!0,this.useObjectSpaceNormalMap=!1,this.useParallax=!1,this.useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this.disableLighting=!1,this.forceIrradianceInFragment=!1,this.maxSimultaneousLights=4,this.invertNormalMapX=!1,this.invertNormalMapY=!1,this.twoSidedLighting=!1,this.useAlphaFresnel=!1,this.useLinearAlphaFresnel=!1,this.environmentBRDFTexture=null,this.forceNormalForward=!1,this.enableSpecularAntiAliasing=!1,this.useHorizonOcclusion=!0,this.useRadianceOcclusion=!0,this.unlit=!1,this.applyDecalMapAfterDetailMap=!1,this._environmentBRDFTexture=(0,w.d)(this.va())}getClassName(){return"PBRMaterial"}clone(q){let X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const y=v.c.Clone((()=>new Z(q,this.va())),this,{cloneTexturesOnlyOnce:X});return y.id=q,y.name=q,this.stencil.copyTo(y.stencil),this._clonePlugins(y,Q),y}serialize(){const q=super.serialize();return q.customType="BABYLON.PBRMaterial",q}static Parse(q,X,Q){const y=v.c.Parse((()=>new Z(q.name,X)),q,X,Q);return q.stencil&&y.stencil.parse(q.stencil,X,Q),i.b._ParsePlugins(q,y,X,Q),q.clearCoat&&y.clearCoat.parse(q.clearCoat,X,Q),q.anisotropy&&y.anisotropy.parse(q.anisotropy,X,Q),q.brdf&&y.brdf.parse(q.brdf,X,Q),q.sheen&&y.sheen.parse(q.sheen,X,Q),q.subSurface&&y.subSurface.parse(q.subSurface,X,Q),q.iridescence&&y.iridescence.parse(q.iridescence,X,Q),y}}Z.PBRMATERIAL_OPAQUE=V.d.PBRMATERIAL_OPAQUE,Z.PBRMATERIAL_ALPHATEST=V.d.PBRMATERIAL_ALPHATEST,Z.PBRMATERIAL_ALPHABLEND=V.d.PBRMATERIAL_ALPHABLEND,Z.PBRMATERIAL_ALPHATESTANDBLEND=V.d.PBRMATERIAL_ALPHATESTANDBLEND,Z.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=V.d.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,(0,A.b)([(0,B.J)(),(0,B.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"directIntensity",void 0),(0,A.b)([(0,B.J)(),(0,B.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"emissiveIntensity",void 0),(0,A.b)([(0,B.J)(),(0,B.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"environmentIntensity",void 0),(0,A.b)([(0,B.J)(),(0,B.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"specularIntensity",void 0),(0,A.b)([(0,B.J)(),(0,B.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"disableBumpMap",void 0),(0,A.b)([(0,B.B)(),(0,B.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"albedoTexture",void 0),(0,A.b)([(0,B.B)(),(0,B.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"ambientTexture",void 0),(0,A.b)([(0,B.J)(),(0,B.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"ambientTextureStrength",void 0),(0,A.b)([(0,B.J)(),(0,B.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),(0,A.b)([(0,B.B)(),(0,B.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],Z.prototype,"opacityTexture",void 0),(0,A.b)([(0,B.B)(),(0,B.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"reflectionTexture",void 0),(0,A.b)([(0,B.B)(),(0,B.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"emissiveTexture",void 0),(0,A.b)([(0,B.B)(),(0,B.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"reflectivityTexture",void 0),(0,A.b)([(0,B.B)(),(0,B.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"metallicTexture",void 0),(0,A.b)([(0,B.J)(),(0,B.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"metallic",void 0),(0,A.b)([(0,B.J)(),(0,B.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"roughness",void 0),(0,A.b)([(0,B.J)(),(0,B.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"metallicF0Factor",void 0),(0,A.b)([(0,B.o)(),(0,B.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"metallicReflectanceColor",void 0),(0,A.b)([(0,B.J)(),(0,B.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"useOnlyMetallicFromMetallicReflectanceTexture",void 0),(0,A.b)([(0,B.B)(),(0,B.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"metallicReflectanceTexture",void 0),(0,A.b)([(0,B.B)(),(0,B.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"reflectanceTexture",void 0),(0,A.b)([(0,B.B)(),(0,B.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"microSurfaceTexture",void 0),(0,A.b)([(0,B.B)(),(0,B.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"bumpTexture",void 0),(0,A.b)([(0,B.B)(),(0,B.d)("_markAllSubMeshesAsTexturesDirty",null)],Z.prototype,"lightmapTexture",void 0),(0,A.b)([(0,B.o)("ambient"),(0,B.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"ambientColor",void 0),(0,A.b)([(0,B.o)("albedo"),(0,B.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"albedoColor",void 0),(0,A.b)([(0,B.o)("reflectivity"),(0,B.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"reflectivityColor",void 0),(0,A.b)([(0,B.o)("reflection"),(0,B.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"reflectionColor",void 0),(0,A.b)([(0,B.o)("emissive"),(0,B.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"emissiveColor",void 0),(0,A.b)([(0,B.J)(),(0,B.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"microSurface",void 0),(0,A.b)([(0,B.J)(),(0,B.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"useLightmapAsShadowmap",void 0),(0,A.b)([(0,B.J)(),(0,B.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],Z.prototype,"useAlphaFromAlbedoTexture",void 0),(0,A.b)([(0,B.J)(),(0,B.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],Z.prototype,"forceAlphaTest",void 0),(0,A.b)([(0,B.J)(),(0,B.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],Z.prototype,"alphaCutOff",void 0),(0,A.b)([(0,B.J)(),(0,B.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"useSpecularOverAlpha",void 0),(0,A.b)([(0,B.J)(),(0,B.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),(0,A.b)([(0,B.J)(),(0,B.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),(0,A.b)([(0,B.J)(),(0,B.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"useRoughnessFromMetallicTextureGreen",void 0),(0,A.b)([(0,B.J)(),(0,B.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"useMetallnessFromMetallicTextureBlue",void 0),(0,A.b)([(0,B.J)(),(0,B.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),(0,A.b)([(0,B.J)(),(0,B.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"useAmbientInGrayScale",void 0),(0,A.b)([(0,B.J)(),(0,B.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),(0,A.b)([(0,B.J)()],Z.prototype,"usePhysicalLightFalloff",null),(0,A.b)([(0,B.J)()],Z.prototype,"useGLTFLightFalloff",null),(0,A.b)([(0,B.J)(),(0,B.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"useRadianceOverAlpha",void 0),(0,A.b)([(0,B.J)(),(0,B.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"useObjectSpaceNormalMap",void 0),(0,A.b)([(0,B.J)(),(0,B.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"useParallax",void 0),(0,A.b)([(0,B.J)(),(0,B.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"useParallaxOcclusion",void 0),(0,A.b)([(0,B.J)(),(0,B.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"parallaxScaleBias",void 0),(0,A.b)([(0,B.J)(),(0,B.d)("_markAllSubMeshesAsLightsDirty")],Z.prototype,"disableLighting",void 0),(0,A.b)([(0,B.J)(),(0,B.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"forceIrradianceInFragment",void 0),(0,A.b)([(0,B.J)(),(0,B.d)("_markAllSubMeshesAsLightsDirty")],Z.prototype,"maxSimultaneousLights",void 0),(0,A.b)([(0,B.J)(),(0,B.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"invertNormalMapX",void 0),(0,A.b)([(0,B.J)(),(0,B.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"invertNormalMapY",void 0),(0,A.b)([(0,B.J)(),(0,B.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"twoSidedLighting",void 0),(0,A.b)([(0,B.J)(),(0,B.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"useAlphaFresnel",void 0),(0,A.b)([(0,B.J)(),(0,B.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"useLinearAlphaFresnel",void 0),(0,A.b)([(0,B.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"environmentBRDFTexture",void 0),(0,A.b)([(0,B.J)(),(0,B.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"forceNormalForward",void 0),(0,A.b)([(0,B.J)(),(0,B.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"enableSpecularAntiAliasing",void 0),(0,A.b)([(0,B.J)(),(0,B.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"useHorizonOcclusion",void 0),(0,A.b)([(0,B.J)(),(0,B.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"useRadianceOcclusion",void 0),(0,A.b)([(0,B.J)(),(0,B.d)("_markAllSubMeshesAsMiscDirty")],Z.prototype,"unlit",void 0),(0,A.b)([(0,B.J)(),(0,B.d)("_markAllSubMeshesAsMiscDirty")],Z.prototype,"applyDecalMapAfterDetailMap",void 0),(0,W.h)("BABYLON.PBRMaterial",Z);var U=Q(972),O=Q(11298),g=Q(1261),P=Q(11279),F=Q(11291),l=Q(11253);class m{get influence(){return this._influence}set influence(q){if(this._influence===q)return;const X=this._influence;this._influence=q,this.onInfluenceChanged.hasObservers()&&this.onInfluenceChanged.notifyObservers(0===X||0===q)}get animationPropertiesOverride(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride}set animationPropertiesOverride(q){this._animationPropertiesOverride=q}constructor(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.name=q,this.animations=[],this._positions=null,this._normals=null,this._tangents=null,this._uvs=null,this._uniqueId=0,this.onInfluenceChanged=new R.c,this._onDataLayoutChanged=new R.c,this._animationPropertiesOverride=null,this.id=q,this._scene=Q||j.c.LastCreatedScene,this.influence=X,this._scene&&(this._uniqueId=this._scene.getUniqueId())}get uniqueId(){return this._uniqueId}get hasPositions(){return!!this._positions}get hasNormals(){return!!this._normals}get hasTangents(){return!!this._tangents}get hasUVs(){return!!this._uvs}setPositions(q){const X=this.hasPositions;this._positions=q,X!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)}getPositions(){return this._positions}setNormals(q){const X=this.hasNormals;this._normals=q,X!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)}getNormals(){return this._normals}setTangents(q){const X=this.hasTangents;this._tangents=q,X!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)}getTangents(){return this._tangents}setUVs(q){const X=this.hasUVs;this._uvs=q,X!==this.hasUVs&&this._onDataLayoutChanged.notifyObservers(void 0)}getUVs(){return this._uvs}clone(){const q=v.c.Clone((()=>new m(this.name,this.influence,this._scene)),this);return q._positions=this._positions,q._normals=this._normals,q._tangents=this._tangents,q._uvs=this._uvs,q}serialize(){const q={};return q.name=this.name,q.influence=this.influence,q.xa=Array.prototype.slice.call(this.getPositions()),null!=this.id&&(q.id=this.id),this.hasNormals&&(q.ya=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(q.tangents=Array.prototype.slice.call(this.getTangents())),this.hasUVs&&(q.Aa=Array.prototype.slice.call(this.getUVs())),v.c.AppendSerializedAnimations(this,q),q}getClassName(){return"MorphTarget"}static Parse(q,X){const Q=new m(q.name,q.influence);if(Q.setPositions(q.xa),null!=q.id&&(Q.id=q.id),q.ya&&Q.setNormals(q.ya),q.tangents&&Q.setTangents(q.tangents),q.Aa&&Q.setUVs(q.Aa),q.animations){for(let X=0;X<q.animations.length;X++){const y=q.animations[X],x=(0,W.d)("BABYLON.Animation");x&&Q.animations.push(x.Parse(y))}q.autoAnimate&&X&&X.beginAnimation(Q,q.autoAnimateFrom,q.autoAnimateTo,q.autoAnimateLoop,q.autoAnimateSpeed||1)}return Q}static FromMesh(q,X,Q){X||(X=q.name);const y=new m(X,Q,q.va());return y.setPositions(q.getVerticesData(g.c.PositionKind)),q.isVerticesDataPresent(g.c.NormalKind)&&y.setNormals(q.getVerticesData(g.c.NormalKind)),q.isVerticesDataPresent(g.c.TangentKind)&&y.setTangents(q.getVerticesData(g.c.TangentKind)),q.isVerticesDataPresent(g.c.UVKind)&&y.setUVs(q.getVerticesData(g.c.UVKind)),y}}(0,A.b)([(0,B.J)()],m.prototype,"id",void 0);var M=Q(1199),o=Q(1562);class Y{set areUpdatesFrozen(q){q?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(!0)))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new M.g(16),this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,q||(q=j.c.LastCreatedScene),this._scene=q,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const q=this._scene.getEngine().getCaps();this._canUseTextureForTargets=q.canUseGLVertexID&&q.textureFloat&&q.maxVertexTextureImageUnits>0&&q.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return this._numMaxInfluencers}set numMaxInfluencers(q){this._numMaxInfluencers!==q&&(this._numMaxInfluencers=q,this._syncActiveTargets(!0))}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(q){this._useTextureToStoreTargets=q}get isUsingTextureForTargets(){var q;return Y.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(q=this._scene)&&void 0!==q&&q.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(q){return this._activeTargets.data[q]}getTarget(q){return this._targets[q]}getTargetByName(q){for(const X of this._targets)if(X.name===q)return X;return null}addTarget(q){this._targets.push(q),this._targetInfluenceChangedObservers.push(q.onInfluenceChanged.add((q=>{this._syncActiveTargets(q)}))),this._targetDataLayoutChangedObservers.push(q._onDataLayoutChanged.add((()=>{this._syncActiveTargets(!0)}))),this._syncActiveTargets(!0)}removeTarget(q){const X=this._targets.indexOf(q);X>=0&&(this._targets.splice(X,1),q.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(X,1)[0]),q._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(X,1)[0]),this._syncActiveTargets(!0)),this._scene&&this._scene.stopAnimation(q)}_bind(q){q.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),q.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),q.setTexture("morphTargets",this._targetStoreTexture),q.setInt("morphTargetCount",this.numInfluencers)}clone(){const q=new Y(this._scene);for(const X of this._targets)q.addTarget(X.clone());return q.enableNormalMorphing=this.enableNormalMorphing,q.enableTangentMorphing=this.enableTangentMorphing,q.enableUVMorphing=this.enableUVMorphing,q}serialize(){const q={};q.id=this.uniqueId,q.targets=[];for(const X of this._targets)q.targets.push(X.serialize());return q}_syncActiveTargets(q){if(this.areUpdatesFrozen)return;let X=0;this._activeTargets.reset(),this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._vertexCount=0,this._scene&&this._targets.length>this._scene.getEngine().getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let Q=-1;for(const y of this._targets){if(Q++,0===y.influence&&this.optimizeInfluencers)continue;if(this._activeTargets.length>=Y.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(y),this._morphTargetTextureIndices[X]=Q,this._tempInfluences[X++]=y.influence,this._supportsNormals=this._supportsNormals&&y.hasNormals,this._supportsTangents=this._supportsTangents&&y.hasTangents,this._supportsUVs=this._supportsUVs&&y.hasUVs;const q=y.getPositions();if(q){const X=q.length/3;if(0===this._vertexCount)this._vertexCount=X;else if(this._vertexCount!==X)return void I.b.Error("Incompatible target. Targets must all have the same vertices count.")}}this._morphTargetTextureIndices.length!==X&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,X)),this._influences&&this._influences.length===X||(this._influences=new Float32Array(X));for(let y=0;y<X;y++)this._influences[y]=this._tempInfluences[y];q&&this.synchronize()}synchronize(){if(this._scene&&!this.areUpdatesFrozen){if(this.isUsingTextureForTargets&&(this._vertexCount||this.numMaxInfluencers>0)){this._textureVertexStride=1,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const q=this._scene.getEngine().getCaps().maxTextureSize;this._textureWidth>q&&(this._textureHeight=Math.ceil(this._textureWidth/q),this._textureWidth=q);let X=!0;if(this._targetStoreTexture){const q=this._targetStoreTexture.getSize();q.width===this._textureWidth&&q.height===this._textureHeight&&this._targetStoreTexture.depth===this._targets.length&&(X=!1)}if(X){this._targetStoreTexture&&this._targetStoreTexture.dispose();const q=this._targets.length,X=new Float32Array(q*this._textureWidth*this._textureHeight*4);let Q=0;for(let y=0;y<q;y++){const q=this._targets[y],x=q.getPositions(),u=q.getNormals(),H=q.getUVs(),b=q.getTangents();if(!x)return void(0===y&&I.b.Error("Invalid morph target. Target must have positions."));Q=y*this._textureWidth*this._textureHeight*4;for(let y=0;y<this._vertexCount;y++)X[Q]=x[3*y],X[Q+1]=x[3*y+1],X[Q+2]=x[3*y+2],Q+=4,this._supportsNormals&&u&&(X[Q]=u[3*y],X[Q+1]=u[3*y+1],X[Q+2]=u[3*y+2],Q+=4),this._supportsUVs&&H&&(X[Q]=H[2*y],X[Q+1]=H[2*y+1],Q+=4),this._supportsTangents&&b&&(X[Q]=b[3*y],X[Q+1]=b[3*y+1],X[Q+2]=b[3*y+2],Q+=4)}this._targetStoreTexture=o.b.CreateRGBATexture(X,this._textureWidth,this._textureHeight,q,this._scene,!1,!1,1,1)}}for(const q of this._scene.meshes)q.morphTargetManager===this&&q._syncGeometryWithMorphTargetManager()}}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const q=this._parentContainer.morphTargetManagers.indexOf(this);q>-1&&this._parentContainer.morphTargetManagers.splice(q,1),this._parentContainer=null}for(const q of this._targets)this._scene.stopAnimation(q)}}static Parse(q,X){const Q=new Y(X);for(const y of q.targets)Q.addTarget(m.Parse(y,X));return Q}}Y.EnableTextureStorage=!0,Y.MaxActiveMorphTargetsInVertexAttributeMode=8;var N=Q(11903),S=Q(1055),c=Q(1347);function p(q,X,Q,y){return x.n.Rd(X,Q).scaleInPlace(y)}class t{constructor(q,X,Q,y){this.type=q,this.name=X,this.getValue=Q,this.getStride=y}_buildAnimation(q,X,Q){const y=new f.e(q,this.name,X,this.type);return y.setKeys(Q),y}}class z extends t{buildAnimations(q,X,Q,y,x){x(q._babylonTransformNode,this._buildAnimation(X,Q,y))}}const K={translation:[new z(f.e.ANIMATIONTYPE_VECTOR3,"position",p,(()=>3))],rotation:[new z(f.e.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",(function(q,X,Q,y){return x.d.Rd(X,Q).scaleInPlace(y)}),(()=>4))],scale:[new z(f.e.ANIMATIONTYPE_VECTOR3,"He",p,(()=>3))],weights:[new class extends t{buildAnimations(q,X,Q,y,x){if(q._numMorphTargets)for(let u=0;u<q._numMorphTargets;u++){const H=new f.e(`${X}_${u}`,this.name,Q,this.type);if(H.setKeys(y.map((q=>({frame:q.frame,inTangent:q.inTangent?q.inTangent[u]:void 0,value:q.value[u],outTangent:q.outTangent?q.outTangent[u]:void 0,interpolation:q.interpolation})))),q._primitiveBabylonMeshes)for(const X of q._primitiveBabylonMeshes)if(X.morphTargetManager){const q=X.morphTargetManager.getTarget(u),Q=H.clone();q.animations.push(Q),x(q,Q)}}}}(f.e.ANIMATIONTYPE_FLOAT,"influence",(function(q,X,Q,y){const x=new Array(q._numMorphTargets);for(let u=0;u<x.length;u++)x[u]=X[Q++]*y;return x}),(q=>q._numMorphTargets))]},h=new Map,G=h;function C(q,X,Q){E(q)&&I.b.Warn(`Extension with the name '${q}' already exists`),h.set(q,{isGLTFExtension:X,factory:Q})}function E(q){return h.delete(q)}function J(){const q=q=>q&&"object"===typeof q;for(var X=arguments.length,Q=new Array(X),y=0;y<X;y++)Q[y]=arguments[y];return Q.reduce(((X,Q)=>(Object.keys(Q).forEach((y=>{const x=X[y],u=Q[y];Array.isArray(x)&&Array.isArray(u)?X[y]=x.concat(...u):q(x)&&q(u)?X[y]=J(x,u):X[y]=u})),X)),{})}class n{static Get(q,X,Q){if(!X||void 0==Q||!X[Q])throw new Error(`${q}: Failed to find index (${Q})`);return X[Q]}static TryGet(q,X){return q&&void 0!=X&&q[X]?q[X]:null}static Assign(q){if(q)for(let X=0;X<q.length;X++)q[X].index=X}}class r{static RegisterExtension(q,X){C(q,!1,X)}static UnregisterExtension(q){return E(q)}get Wi(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(q){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=q}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((q=>q.dispose&&q.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}importMeshAsync(q,X,Q,y,x,u){let H=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return Promise.resolve().then((()=>{this._babylonScene=X,this._assetContainer=Q,this._loadData(y);let u=null;if(q){const X={};if(this._gltf.nodes)for(const q of this._gltf.nodes)q.name&&(X[q.name]=q.index);u=(q instanceof Array?q:[q]).map((q=>{const Q=X[q];if(void 0===Q)throw new Error(`Failed to find node '${q}'`);return Q}))}return this._loadAsync(x,H,u,(()=>({meshes:this._getMeshes(),je:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}loadAsync(q,X,Q,y){let x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return Promise.resolve().then((()=>(this._babylonScene=q,this._loadData(X),this._loadAsync(Q,x,null,(()=>{})))))}_loadAsync(q,X,Q,y){return Promise.resolve().then((async()=>{this._rootUrl=q,this._uniqueRootUrl=!q.startsWith("file:")&&X?q:`${q}${Date.now()}/`,this._fileName=X,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const x=`${N.j[N.j.LOADING]} => ${N.j[N.j.READY]}`,u=`${N.j[N.j.LOADING]} => ${N.j[N.j.COMPLETE]}`;this._parent._startPerformanceCounter(x),this._parent._startPerformanceCounter(u),this._parent._setState(N.j.LOADING),this._extensionsOnLoading();const b=new Array;if(!this.parent.loadOnlyMaterials)if(Q)b.push(this.loadSceneAsync("/nodes",{nodes:Q,index:-1}));else if(void 0!=this._gltf.Le||this._gltf.scenes&&this._gltf.scenes[0]){const q=n.Get("/scene",this._gltf.scenes,this._gltf.Le||0);b.push(this.loadSceneAsync(`/scenes/${q.index}`,q))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let q=0;q<this._gltf.materials.length;++q){const X=this._gltf.materials[q],Q="/materials/"+q,y=i.b.TriangleFillMode;b.push(this._loadMaterialAsync(Q,X,null,y,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&b.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&b.push(this._compileShadowGeneratorsAsync());return Promise.all(b).then((()=>(this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.tg(!0),this._extensionsOnReady(),this._parent._setState(N.j.READY),this._startAnimations(),y()))).then((q=>(this._parent._endPerformanceCounter(x),H.f.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(u),this._parent._setState(N.j.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(q=>{this._parent.onErrorObservable.notifyObservers(q),this._parent.onErrorObservable.clear(),this.dispose()}))})),q)))})).catch((q=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(q),this._parent.onErrorObservable.clear(),this.dispose()),q}))}_loadData(q){if(this._gltf=q.json,this._setupData(),q.bin){const X=this._gltf.buffers;if(X&&X[0]&&!X[0].uri){const Q=X[0];(Q.byteLength<q.bin.byteLength-3||Q.byteLength>q.bin.byteLength)&&I.b.Warn(`Binary buffer length (${Q.byteLength}) from JSON does not match chunk length (${q.bin.byteLength})`),this._bin=q.bin}else I.b.Warn("Unexpected BIN chunk")}}_setupData(){if(n.Assign(this._gltf.accessors),n.Assign(this._gltf.animations),n.Assign(this._gltf.buffers),n.Assign(this._gltf.bufferViews),n.Assign(this._gltf.cameras),n.Assign(this._gltf.images),n.Assign(this._gltf.materials),n.Assign(this._gltf.meshes),n.Assign(this._gltf.nodes),n.Assign(this._gltf.samplers),n.Assign(this._gltf.scenes),n.Assign(this._gltf.skins),n.Assign(this._gltf.textures),this._gltf.nodes){const q={};for(const Q of this._gltf.nodes)if(Q.children)for(const X of Q.children)q[X]=Q.index;const X=this._createRootNode();for(const Q of this._gltf.nodes){const y=q[Q.index];Q.parent=void 0===y?X:this._gltf.nodes[y]}}}async _loadExtensionsAsync(){const q=[];if(G.forEach(((X,Q)=>{var y;!1===(null===(y=this.parent.extensionOptions[Q])||void 0===y?void 0:y.enabled)?X.isGLTFExtension&&this.isExtensionUsed(Q)&&I.b.Warn(`Extension ${Q} is used but has been explicitly disabled.`):X.isGLTFExtension&&!this.isExtensionUsed(Q)||q.push((async()=>{const q=await X.factory(this);return q.name!==Q&&I.b.Warn(`The name of the glTF loader extension instance does not match the registered name: ${q.name} !== ${Q}`),this._parent.onExtensionLoadedObservable.notifyObservers(q),q})())})),this._extensions.push(...await Promise.all(q)),this._extensions.sort(((q,X)=>(q.order||Number.MAX_VALUE)-(X.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const Q of this._gltf.extensionsRequired){if(!this._extensions.some((q=>q.name===Q&&q.enabled))){var X;if(!1===(null===(X=this.parent.extensionOptions[Q])||void 0===X?void 0:X.enabled))throw new Error(`Required extension ${Q} is disabled`);throw new Error(`Required extension ${Q} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const q=new l.b("__root__",this._babylonScene);this._rootBabylonMesh=q,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.tg(!1);const X={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case N.i.AUTO:this._babylonScene.useRightHandedSystem||(X.rotation=[0,1,0,0],X.scale=[1,1,-1],r._LoadTransform(X,this._rootBabylonMesh));break;case N.i.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(q),X}loadSceneAsync(q,X){const Q=this._extensionsLoadSceneAsync(q,X);if(Q)return Q;const y=new Array;if(this.logOpen(`${q} ${X.name||""}`),X.nodes)for(const x of X.nodes){const X=n.Get(`${q}/nodes/${x}`,this._gltf.nodes,x);y.push(this.loadNodeAsync(`/nodes/${X.index}`,X,(q=>{q.parent=this._rootBabylonMesh})))}for(const x of this._postSceneLoadActions)x();return y.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(y).then((()=>{}))}_forEachPrimitive(q,X){if(q._primitiveBabylonMeshes)for(const Q of q._primitiveBabylonMeshes)X(Q)}_getGeometries(){const q=[],X=this._gltf.nodes;if(X)for(const Q of X)this._forEachPrimitive(Q,(X=>{const Q=X.ze;Q&&-1===q.indexOf(Q)&&q.push(Q)}));return q}_getMeshes(){const q=[];this._rootBabylonMesh instanceof F.c&&q.push(this._rootBabylonMesh);const X=this._gltf.nodes;if(X)for(const Q of X)this._forEachPrimitive(Q,(X=>{q.push(X)}));return q}_getTransformNodes(){const q=[],X=this._gltf.nodes;if(X)for(const Q of X)Q._babylonTransformNode&&"qb"===Q._babylonTransformNode.getClassName()&&q.push(Q._babylonTransformNode),Q._babylonTransformNodeForSkin&&q.push(Q._babylonTransformNodeForSkin);return q}_getSkeletons(){const q=[],X=this._gltf.skins;if(X)for(const Q of X)Q._data&&q.push(Q._data.babylonSkeleton);return q}_getAnimationGroups(){const q=[],X=this._gltf.animations;if(X)for(const Q of X)Q._babylonAnimationGroup&&q.push(Q._babylonAnimationGroup);return q}_startAnimations(){switch(this._parent.animationStartMode){case N.h.NONE:break;case N.h.FIRST:{const q=this._getAnimationGroups();0!==q.length&&q[0].start(!0);break}case N.h.ALL:{const q=this._getAnimationGroups();for(const X of q)X.start(!0);break}default:return void I.b.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(q,X){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const y=this._extensionsLoadNodeAsync(q,X,Q);if(y)return y;if(X._babylonTransformNode)throw new Error(`${q}: Invalid recursive node hierarchy`);const x=new Array;this.logOpen(`${q} ${X.name||""}`);const u=y=>{if(r.AddPointerMetadata(y,q),r._LoadTransform(X,y),void 0!=X.camera){const Q=n.Get(`${q}/camera`,this._gltf.cameras,X.camera);x.push(this.loadCameraAsync(`/cameras/${Q.index}`,Q,(q=>{q.parent=y})))}if(X.children)for(const Q of X.children){const X=n.Get(`${q}/children/${Q}`,this._gltf.nodes,Q);x.push(this.loadNodeAsync(`/nodes/${X.index}`,X,(q=>{q.parent=y})))}Q(y)},H=void 0!=X.mesh,b=this._parent.loadSkins&&void 0!=X.skin;if(!H||b){const q=X.name||`node${X.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const Q=new O.c(q,this._babylonScene);Q._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==X.mesh?X._babylonTransformNode=Q:X._babylonTransformNodeForSkin=Q,u(Q)}if(H)if(b){const Q=n.Get(`${q}/mesh`,this._gltf.meshes,X.mesh);x.push(this._loadMeshAsync(`/meshes/${Q.index}`,X,Q,(Q=>{const y=X._babylonTransformNodeForSkin;Q.metadata=J(y.metadata,Q.metadata||{});const u=n.Get(`${q}/skin`,this._gltf.skins,X.skin);x.push(this._loadSkinAsync(`/skins/${u.index}`,X,u,(q=>{this._forEachPrimitive(X,(X=>{X.skeleton=q})),this._postSceneLoadActions.push((()=>{if(void 0!=u.skeleton){const q=n.Get(`/skins/${u.index}/skeleton`,this._gltf.nodes,u.skeleton).parent;X.index===q.index?Q.parent=y.parent:Q.parent=q._babylonTransformNode}else Q.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:y,skinnedNode:Q})}))})))})))}else{const Q=n.Get(`${q}/mesh`,this._gltf.meshes,X.mesh);x.push(this._loadMeshAsync(`/meshes/${Q.index}`,X,Q,u))}return this.logClose(),Promise.all(x).then((()=>(this._forEachPrimitive(X,(q=>{q.ze&&q.ze.useBoundingInfoFromGeometry?q.Ea():q.refreshBoundingInfo(!0,!0)})),X._babylonTransformNode)))}_loadMeshAsync(q,X,Q,y){const x=Q.primitives;if(!x||!x.length)throw new Error(`${q}: Primitives are missing`);void 0==x[0].index&&n.Assign(x);const u=new Array;this.logOpen(`${q} ${Q.name||""}`);const H=X.name||`node${X.index}`;if(1===x.length){const y=Q.primitives[0];u.push(this._loadMeshPrimitiveAsync(`${q}/primitives/${y.index}`,H,X,Q,y,(q=>{X._babylonTransformNode=q,X._primitiveBabylonMeshes=[q]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,X._babylonTransformNode=new O.c(H,this._babylonScene),X._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,X._primitiveBabylonMeshes=[];for(const y of x)u.push(this._loadMeshPrimitiveAsync(`${q}/primitives/${y.index}`,`${H}_primitive${y.index}`,X,Q,y,(q=>{q.parent=X._babylonTransformNode,X._primitiveBabylonMeshes.push(q)})))}return y(X._babylonTransformNode),this.logClose(),Promise.all(u).then((()=>X._babylonTransformNode))}_loadMeshPrimitiveAsync(q,X,Q,y,x,u){const H=this._extensionsLoadMeshPrimitiveAsync(q,X,Q,y,x,u);if(H)return H;this.logOpen(`${q}`);const b=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==Q.skin&&!y.primitives[0].targets;let D,a;if(b&&x._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,D=x._instanceData.babylonSourceMesh.kd(X),D._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,a=x._instanceData.promise;else{const u=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const H=new l.b(X,this._babylonScene);H._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,H.sideOrientation=this._babylonScene.useRightHandedSystem?i.b.CounterClockWiseSideOrientation:i.b.ClockWiseSideOrientation,this._createMorphTargets(q,Q,y,x,H),u.push(this._loadVertexDataAsync(q,x,H).then((X=>this._loadMorphTargetsAsync(q,x,H,X).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,X.Ca(H),X._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const R=r._GetDrawMode(q,x.mode);if(void 0==x.material){let q=this._defaultBabylonMaterialData[R];q||(q=this._createDefaultMaterial("__GLTFLoader._default",R),this._parent.onMaterialLoadedObservable.notifyObservers(q),this._defaultBabylonMaterialData[R]=q),H.material=q}else if(!this.parent.skipMaterials){const X=n.Get(`${q}/material`,this._gltf.materials,x.material);u.push(this._loadMaterialAsync(`/materials/${X.index}`,X,H,R,(q=>{H.material=q})))}a=Promise.all(u),b&&(x._instanceData={babylonSourceMesh:H,promise:a}),D=H}return r.AddPointerMetadata(D,q),this._parent.onMeshLoadedObservable.notifyObservers(D),u(D),this.logClose(),a.then((()=>D))}_loadVertexDataAsync(q,X,Q){const y=this._extensionsLoadVertexDataAsync(q,X,Q);if(y)return y;const u=X.attributes;if(!u)throw new Error(`${q}: Attributes are missing`);const H=new Array,b=new P.d(Q.name,this._babylonScene);if(void 0==X.indices)Q.isUnIndexed=!0;else{const Q=n.Get(`${q}/indices`,this._gltf.accessors,X.indices);H.push(this._loadIndicesAccessorAsync(`/accessors/${Q.index}`,Q).then((q=>{b.setIndices(q)})))}const D=(X,y,D)=>{if(void 0==u[X])return;Q._delayInfo=Q._delayInfo||[],-1===Q._delayInfo.indexOf(y)&&Q._delayInfo.push(y);const a=n.Get(`${q}/attributes/${X}`,this._gltf.accessors,u[X]);H.push(this._loadVertexAccessorAsync(`/accessors/${a.index}`,a,y).then((q=>{if(q.getKind()===g.c.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!Q.skeleton&&a.min&&a.max){const q=x.h.Od[0].Pd(...a.min),X=x.h.Od[1].Pd(...a.max);if(a.normalized&&5126!==a.componentType){let Q=1;switch(a.componentType){case 5120:Q=127;break;case 5121:Q=255;break;case 5122:Q=32767;break;case 5123:Q=65535}const y=1/Q;q.scaleInPlace(y),X.scaleInPlace(y)}b._boundingInfo=new c.e(q,X),b.useBoundingInfoFromGeometry=!0}b.setVerticesBuffer(q,a.count)}))),y==g.c.MatricesIndicesExtraKind&&(Q.numBoneInfluencers=8),D&&D(a)};return D("POSITION",g.c.PositionKind),D("NORMAL",g.c.NormalKind),D("TANGENT",g.c.TangentKind),D("TEXCOORD_0",g.c.UVKind),D("TEXCOORD_1",g.c.UV2Kind),D("TEXCOORD_2",g.c.UV3Kind),D("TEXCOORD_3",g.c.UV4Kind),D("TEXCOORD_4",g.c.UV5Kind),D("TEXCOORD_5",g.c.UV6Kind),D("JOINTS_0",g.c.MatricesIndicesKind),D("WEIGHTS_0",g.c.MatricesWeightsKind),D("JOINTS_1",g.c.MatricesIndicesExtraKind),D("WEIGHTS_1",g.c.MatricesWeightsExtraKind),D("COLOR_0",g.c.ColorKind,(q=>{"VEC4"===q.type&&(Q.hasVertexAlpha=!0)})),Promise.all(H).then((()=>b))}_createMorphTargets(q,X,Q,y,x){if(!y.targets||!this._parent.loadMorphTargets)return;if(void 0==X._numMorphTargets)X._numMorphTargets=y.targets.length;else if(y.targets.length!==X._numMorphTargets)throw new Error(`${q}: Primitives do not have the same number of targets`);const u=Q.extras?Q.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,x.morphTargetManager=new Y(this._babylonScene),x.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,x.morphTargetManager.areUpdatesFrozen=!0;for(let H=0;H<y.targets.length;H++){const q=X.weights?X.weights[H]:Q.weights?Q.weights[H]:0,y=u?u[H]:`morphTarget${H}`;x.morphTargetManager.addTarget(new m(y,q,x.va()))}}_loadMorphTargetsAsync(q,X,Q,y){if(!X.targets||!this._parent.loadMorphTargets)return Promise.resolve();const x=new Array,u=Q.morphTargetManager;for(let H=0;H<u.numTargets;H++){const Q=u.getTarget(H);x.push(this._loadMorphTargetVertexDataAsync(`${q}/targets/${H}`,y,X.targets[H],Q))}return Promise.all(x).then((()=>{u.areUpdatesFrozen=!1}))}_loadMorphTargetVertexDataAsync(q,X,Q,y){const x=new Array,u=(y,u,H)=>{if(void 0==Q[y])return;const b=X.getVertexBuffer(u);if(!b)return;const D=n.Get(`${q}/${y}`,this._gltf.accessors,Q[y]);x.push(this._loadFloatAccessorAsync(`/accessors/${D.index}`,D).then((q=>{H(b,q)})))};return u("POSITION",g.c.PositionKind,((q,X)=>{const Q=new Float32Array(X.length);q.forEach(X.length,((q,y)=>{Q[y]=X[y]+q})),y.setPositions(Q)})),u("NORMAL",g.c.NormalKind,((q,X)=>{const Q=new Float32Array(X.length);q.forEach(Q.length,((q,y)=>{Q[y]=X[y]+q})),y.setNormals(Q)})),u("TANGENT",g.c.TangentKind,((q,X)=>{const Q=new Float32Array(X.length/3*4);let x=0;q.forEach(X.length/3*4,((q,y)=>{(y+1)%4!==0&&(Q[x]=X[x]+q,x++)})),y.setTangents(Q)})),Promise.all(x).then((()=>{}))}static _LoadTransform(q,X){if(void 0!=q.skin)return;let Q=x.n.Zero(),y=x.d.Identity(),u=x.n.One();if(q.matrix){x.b.Rd(q.matrix).decompose(u,y,Q)}else q.translation&&(Q=x.n.Rd(q.translation)),q.rotation&&(y=x.d.Rd(q.rotation)),q.scale&&(u=x.n.Rd(q.scale));X.position=Q,X.rotationQuaternion=y,X.He=u}_loadSkinAsync(q,X,Q,y){if(!this._parent.loadSkins)return Promise.resolve();const x=this._extensionsLoadSkinAsync(q,X,Q);if(x)return x;if(Q._data)return y(Q._data.babylonSkeleton),Q._data.promise;const u=`skeleton${Q.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const H=new e(Q.name||u,u,this._babylonScene);H._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(q,Q,H);const b=this._loadSkinInverseBindMatricesDataAsync(q,Q).then((q=>{this._updateBoneMatrices(H,q)}));return Q._data={babylonSkeleton:H,promise:b},y(H),b}_loadBones(q,X,Q){if(void 0==X.skeleton||this._parent.alwaysComputeSkeletonRootNode){const Q=this._findSkeletonRootNode(`${q}/joints`,X.joints);if(Q)if(void 0===X.skeleton)X.skeleton=Q.index;else{const y=(q,X)=>{for(;X.parent;X=X.parent)if(X.parent===q)return!0;return!1},x=n.Get(`${q}/skeleton`,this._gltf.nodes,X.skeleton);x===Q||y(x,Q)||(I.b.Warn(`${q}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),X.skeleton=Q.index)}else I.b.Warn(`${q}: Failed to find common root`)}const y={};for(const x of X.joints){const u=n.Get(`${q}/joints/${x}`,this._gltf.nodes,x);this._loadBone(u,X,Q,y)}}_findSkeletonRootNode(q,X){if(0===X.length)return null;const Q={};for(const x of X){const X=[];let y=n.Get(`${q}/${x}`,this._gltf.nodes,x);for(;-1!==y.index;)X.unshift(y),y=y.parent;Q[x]=X}let y=null;for(let x=0;;++x){let q=Q[X[0]];if(x>=q.length)return y;const u=q[x];for(let H=1;H<X.length;++H)if(q=Q[X[H]],x>=q.length||u!==q[x])return y;y=u}}_loadBone(q,X,Q,y){q._isJoint=!0;let x=y[q.index];if(x)return x;let u=null;q.index!==X.skeleton&&(q.parent&&-1!==q.parent.index?u=this._loadBone(q.parent,X,Q,y):void 0!==X.skeleton&&I.b.Warn(`/skins/${X.index}/skeleton: Skeleton node is not a common root`));const H=X.joints.indexOf(q.index);return x=new a.e(q.name||`joint${q.index}`,Q,u,this._getNodeMatrix(q),null,null,H),y[q.index]=x,this._postSceneLoadActions.push((()=>{x.linkTransformNode(q._babylonTransformNode)})),x}_loadSkinInverseBindMatricesDataAsync(q,X){if(void 0==X.inverseBindMatrices)return Promise.resolve(null);const Q=n.Get(`${q}/inverseBindMatrices`,this._gltf.accessors,X.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${Q.index}`,Q)}_updateBoneMatrices(q,X){for(const Q of q.bones){const q=x.b.Identity(),y=Q._index;X&&-1!==y&&(x.b.FromArrayToRef(X,16*y,q),q.invertToRef(q));const u=Q.getParent();u&&q.multiplyToRef(u.getAbsoluteInverseBindMatrix(),q),Q.Ae(q,!1,!1),Q._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(q){return q.matrix?x.b.Rd(q.matrix):x.b.Compose(q.scale?x.n.Rd(q.scale):x.n.One(),q.rotation?x.d.Rd(q.rotation):x.d.Identity(),q.translation?x.n.Rd(q.translation):x.n.Zero())}loadCameraAsync(q,X){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const y=this._extensionsLoadCameraAsync(q,X,Q);if(y)return y;const u=new Array;this.logOpen(`${q} ${X.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const H=new D.b(X.name||`camera${X.index}`,x.n.Zero(),this._babylonScene,!1);switch(H._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,H.ignoreParentScaling=!0,X._babylonCamera=H,H.rotation.set(0,Math.PI,0),X.type){case"perspective":{const Q=X.perspective;if(!Q)throw new Error(`${q}: Camera perspective properties are missing`);H.fov=Q.yfov,H._i=Q.znear,H.maxZ=Q.zfar||0;break}case"orthographic":if(!X.orthographic)throw new Error(`${q}: Camera orthographic properties are missing`);H.mode=b.c.ORTHOGRAPHIC_CAMERA,H.orthoLeft=-X.orthographic.xmag,H.orthoRight=X.orthographic.xmag,H.orthoBottom=-X.orthographic.ymag,H.orthoTop=X.orthographic.ymag,H._i=X.orthographic.znear,H.maxZ=X.orthographic.zfar;break;default:throw new Error(`${q}: Invalid camera type (${X.type})`)}return r.AddPointerMetadata(H,q),this._parent.onCameraLoadedObservable.notifyObservers(H),Q(H),this.logClose(),Promise.all(u).then((()=>H))}_loadAnimationsAsync(){const q=this._gltf.animations;if(!q)return Promise.resolve();const X=new Array;for(let Q=0;Q<q.length;Q++){const y=q[Q];X.push(this.loadAnimationAsync(`/animations/${y.index}`,y).then((q=>{0===q.targetedAnimations.length&&q.dispose()})))}return Promise.all(X).then((()=>{}))}loadAnimationAsync(q,X){const y=this._extensionsLoadAnimationAsync(q,X);return y||Q.e(43).then(Q.bind(Q,12536)).then((Q=>{let{AnimationGroup:y}=Q;this._babylonScene._blockEntityCollection=!!this._assetContainer;const x=new y(X.name||`animation${X.index}`,this._babylonScene);x._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,X._babylonAnimationGroup=x;const u=new Array;n.Assign(X.channels),n.Assign(X.samplers);for(const H of X.channels)u.push(this._loadAnimationChannelAsync(`${q}/channels/${H.index}`,q,X,H,((q,X)=>{q.animations=q.animations||[],q.animations.push(X),x.addTargetedAnimation(X,q)})));return Promise.all(u).then((()=>(x.normalize(0),x)))}))}_loadAnimationChannelAsync(q,X,Q,y,x){const u=this._extensionsLoadAnimationChannelAsync(q,X,Q,y,x);if(u)return u;if(void 0==y.target.node)return Promise.resolve();const H=n.Get(`${q}/target/node`,this._gltf.nodes,y.target.node),b=y.target.path,D="weights"===b;if(D&&!H._numMorphTargets||!D&&!H._babylonTransformNode)return Promise.resolve();if(!this._parent.loadNodeAnimations&&!D&&!H._isJoint)return Promise.resolve();let a;switch(b){case"translation":a=K.translation;break;case"rotation":a=K.rotation;break;case"scale":a=K.scale;break;case"weights":a=K.weights;break;default:throw new Error(`${q}/target/path: Invalid value (${y.target.path})`)}const R={object:H,info:a};return this._loadAnimationChannelFromTargetInfoAsync(q,X,Q,y,R,x)}_loadAnimationChannelFromTargetInfoAsync(q,X,Q,y,x,u){const H=this.parent.targetFps,b=1/H,D=n.Get(`${q}/sampler`,Q.samplers,y.sampler);return this._loadAnimationSamplerAsync(`${X}/samplers/${y.sampler}`,D).then((q=>{let X=0;const D=x.object,a=x.info;for(const x of a){const a=x.getStride(D),R=q.input,L=q.output,f=new Array(R.length);let k=0;switch(q.interpolation){case"STEP":for(let q=0;q<R.length;q++){const X=x.getValue(D,L,k,1);k+=a,f[q]={frame:R[q]*H,value:X,interpolation:1}}break;case"CUBICSPLINE":for(let q=0;q<R.length;q++){const X=x.getValue(D,L,k,b);k+=a;const Q=x.getValue(D,L,k,1);k+=a;const y=x.getValue(D,L,k,b);k+=a,f[q]={frame:R[q]*H,inTangent:X,value:Q,outTangent:y}}break;case"LINEAR":for(let q=0;q<R.length;q++){const X=x.getValue(D,L,k,1);k+=a,f[q]={frame:R[q]*H,value:X}}}if(k>0){const q=`${Q.name||`animation${Q.index}`}_channel${y.index}_${X}`;x.buildAnimations(D,q,H,f,((q,Q)=>{++X,u(q,Q)}))}}}))}_loadAnimationSamplerAsync(q,X){if(X._data)return X._data;const Q=X.interpolation||"LINEAR";switch(Q){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${q}/interpolation: Invalid value (${X.interpolation})`)}const y=n.Get(`${q}/input`,this._gltf.accessors,X.input),x=n.Get(`${q}/output`,this._gltf.accessors,X.output);return X._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${y.index}`,y),this._loadFloatAccessorAsync(`/accessors/${x.index}`,x)]).then((q=>{let[X,y]=q;return{input:X,interpolation:Q,output:y}})),X._data}loadBufferAsync(q,X,Q,y){const x=this._extensionsLoadBufferAsync(q,X,Q,y);if(x)return x;if(!X._data)if(X.uri)X._data=this.loadUriAsync(`${q}/uri`,X,X.uri);else{if(!this._bin)throw new Error(`${q}: Uri is missing or the binary glTF is missing its binary chunk`);X._data=this._bin.readAsync(0,X.byteLength)}return X._data.then((X=>{try{return new Uint8Array(X.buffer,X.byteOffset+Q,y)}catch(x){throw new Error(`${q}: ${x.message}`)}}))}loadBufferViewAsync(q,X){const Q=this._extensionsLoadBufferViewAsync(q,X);if(Q)return Q;if(X._data)return X._data;const y=n.Get(`${q}/buffer`,this._gltf.buffers,X.buffer);return X._data=this.loadBufferAsync(`/buffers/${y.index}`,y,X.byteOffset||0,X.byteLength),X._data}_loadAccessorAsync(q,X,Q){if(X._data)return X._data;const y=r._GetNumComponents(q,X.type),x=y*g.c.GetTypeByteLength(X.componentType),u=y*X.count;if(void 0==X.bufferView)X._data=Promise.resolve(new Q(u));else{const H=n.Get(`${q}/bufferView`,this._gltf.bufferViews,X.bufferView);X._data=this.loadBufferViewAsync(`/bufferViews/${H.index}`,H).then((b=>{if(5126!==X.componentType||X.normalized||H.byteStride&&H.byteStride!==x){const q=new Q(u);return g.c.ForEach(b,X.byteOffset||0,H.byteStride||x,y,X.componentType,q.length,X.normalized||!1,((X,Q)=>{q[Q]=X})),q}return r._GetTypedArray(q,X.componentType,b,X.byteOffset,u)}))}if(X.sparse){const u=X.sparse;X._data=X._data.then((H=>{const b=H,D=n.Get(`${q}/sparse/indices/bufferView`,this._gltf.bufferViews,u.indices.bufferView),a=n.Get(`${q}/sparse/values/bufferView`,this._gltf.bufferViews,u.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${D.index}`,D),this.loadBufferViewAsync(`/bufferViews/${a.index}`,a)]).then((H=>{let[D,a]=H;const R=r._GetTypedArray(`${q}/sparse/indices`,u.indices.componentType,D,u.indices.byteOffset,u.count),L=y*u.count;let f;if(5126!==X.componentType||X.normalized){const H=r._GetTypedArray(`${q}/sparse/values`,X.componentType,a,u.values.byteOffset,L);f=new Q(L),g.c.ForEach(H,0,x,y,X.componentType,f.length,X.normalized||!1,((q,X)=>{f[X]=q}))}else f=r._GetTypedArray(`${q}/sparse/values`,X.componentType,a,u.values.byteOffset,L);let k=0;for(let q=0;q<R.length;q++){let X=R[q]*y;for(let q=0;q<y;q++)b[X++]=f[k++]}return b}))}))}return X._data}_loadFloatAccessorAsync(q,X){return this._loadAccessorAsync(q,X,Float32Array)}_loadIndicesAccessorAsync(q,X){if("SCALAR"!==X.type)throw new Error(`${q}/type: Invalid value ${X.type}`);if(5121!==X.componentType&&5123!==X.componentType&&5125!==X.componentType)throw new Error(`${q}/componentType: Invalid value ${X.componentType}`);if(X._data)return X._data;if(X.sparse){const Q=r._GetTypedArrayConstructor(`${q}/componentType`,X.componentType);X._data=this._loadAccessorAsync(q,X,Q)}else{const Q=n.Get(`${q}/bufferView`,this._gltf.bufferViews,X.bufferView);X._data=this.loadBufferViewAsync(`/bufferViews/${Q.index}`,Q).then((Q=>r._GetTypedArray(q,X.componentType,Q,X.byteOffset,X.count)))}return X._data}_loadVertexBufferViewAsync(q){if(q._babylonBuffer)return q._babylonBuffer;const X=this._babylonScene.getEngine();return q._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${q.index}`,q).then((q=>new g.b(X,q,!1))),q._babylonBuffer}_loadVertexAccessorAsync(q,X,Q){var y;if(null!==(y=X._babylonVertexBuffer)&&void 0!==y&&y[Q])return X._babylonVertexBuffer[Q];X._babylonVertexBuffer||(X._babylonVertexBuffer={});const x=this._babylonScene.getEngine();if(X.sparse||void 0==X.bufferView)X._babylonVertexBuffer[Q]=this._loadFloatAccessorAsync(q,X).then((q=>new g.c(x,q,Q,!1)));else{const y=n.Get(`${q}/bufferView`,this._gltf.bufferViews,X.bufferView);X._babylonVertexBuffer[Q]=this._loadVertexBufferViewAsync(y).then((u=>{const H=r._GetNumComponents(q,X.type);return new g.c(x,u,Q,!1,void 0,y.byteStride,void 0,X.byteOffset,H,X.componentType,X.normalized,!0,void 0,!0)}))}return X._babylonVertexBuffer[Q]}_loadMaterialMetallicRoughnessPropertiesAsync(q,X,Q){if(!(Q instanceof Z))throw new Error(`${q}: Material type not supported`);const y=new Array;return X&&(X.baseColorFactor?(Q.albedoColor=u.b.Rd(X.baseColorFactor),Q.alpha=X.baseColorFactor[3]):Q.albedoColor=u.b.White(),Q.metallic=void 0==X.metallicFactor?1:X.metallicFactor,Q.roughness=void 0==X.roughnessFactor?1:X.roughnessFactor,X.baseColorTexture&&y.push(this.loadTextureInfoAsync(`${q}/baseColorTexture`,X.baseColorTexture,(q=>{q.name=`${Q.name} (Base Color)`,Q.albedoTexture=q}))),X.metallicRoughnessTexture&&(X.metallicRoughnessTexture.nonColorData=!0,y.push(this.loadTextureInfoAsync(`${q}/metallicRoughnessTexture`,X.metallicRoughnessTexture,(q=>{q.name=`${Q.name} (Metallic Roughness)`,Q.metallicTexture=q}))),Q.useMetallnessFromMetallicTextureBlue=!0,Q.useRoughnessFromMetallicTextureGreen=!0,Q.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(y).then((()=>{}))}_loadMaterialAsync(q,X,Q,y){let x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const u=this._extensionsLoadMaterialAsync(q,X,Q,y,x);if(u)return u;X._data=X._data||{};let H=X._data[y];if(!H){this.logOpen(`${q} ${X.name||""}`);const Q=this.createMaterial(q,X,y);H={babylonMaterial:Q,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(q,X,Q)},X._data[y]=H,r.AddPointerMetadata(Q,q),this._parent.onMaterialLoadedObservable.notifyObservers(Q),this.logClose()}return Q&&(H.babylonMeshes.push(Q),Q._d.addOnce((()=>{const q=H.babylonMeshes.indexOf(Q);-1!==q&&H.babylonMeshes.splice(q,1)}))),x(H.babylonMaterial),H.promise.then((()=>H.babylonMaterial))}_createDefaultMaterial(q,X){this._babylonScene._blockEntityCollection=!!this._assetContainer;const Q=new Z(q,this._babylonScene);return Q._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,Q.fillMode=X,Q.enableSpecularAntiAliasing=!0,Q.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,Q.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,Q.transparencyMode=Z.PBRMATERIAL_OPAQUE,Q.metallic=1,Q.roughness=1,Q}createMaterial(q,X,Q){const y=this._extensionsCreateMaterial(q,X,Q);if(y)return y;const x=X.name||`material${X.index}`;return this._createDefaultMaterial(x,Q)}loadMaterialPropertiesAsync(q,X,Q){const y=this._extensionsLoadMaterialPropertiesAsync(q,X,Q);if(y)return y;const x=new Array;return x.push(this.loadMaterialBasePropertiesAsync(q,X,Q)),X.pbrMetallicRoughness&&x.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${q}/pbrMetallicRoughness`,X.pbrMetallicRoughness,Q)),this.loadMaterialAlphaProperties(q,X,Q),Promise.all(x).then((()=>{}))}loadMaterialBasePropertiesAsync(q,X,Q){if(!(Q instanceof Z))throw new Error(`${q}: Material type not supported`);const y=new Array;return Q.emissiveColor=X.emissiveFactor?u.b.Rd(X.emissiveFactor):new u.b(0,0,0),X.doubleSided&&(Q.ue=!1,Q.twoSidedLighting=!0),X.normalTexture&&(X.normalTexture.nonColorData=!0,y.push(this.loadTextureInfoAsync(`${q}/normalTexture`,X.normalTexture,(q=>{q.name=`${Q.name} (Normal)`,Q.bumpTexture=q}))),Q.invertNormalMapX=!this._babylonScene.useRightHandedSystem,Q.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=X.normalTexture.scale&&Q.bumpTexture&&(Q.bumpTexture.level=X.normalTexture.scale),Q.forceIrradianceInFragment=!0),X.occlusionTexture&&(X.occlusionTexture.nonColorData=!0,y.push(this.loadTextureInfoAsync(`${q}/occlusionTexture`,X.occlusionTexture,(q=>{q.name=`${Q.name} (Occlusion)`,Q.ambientTexture=q}))),Q.useAmbientInGrayScale=!0,void 0!=X.occlusionTexture.strength&&(Q.ambientTextureStrength=X.occlusionTexture.strength)),X.emissiveTexture&&y.push(this.loadTextureInfoAsync(`${q}/emissiveTexture`,X.emissiveTexture,(q=>{q.name=`${Q.name} (Emissive)`,Q.emissiveTexture=q}))),Promise.all(y).then((()=>{}))}loadMaterialAlphaProperties(q,X,Q){if(!(Q instanceof Z))throw new Error(`${q}: Material type not supported`);switch(X.alphaMode||"OPAQUE"){case"OPAQUE":Q.transparencyMode=Z.PBRMATERIAL_OPAQUE,Q.alpha=1;break;case"MASK":Q.transparencyMode=Z.PBRMATERIAL_ALPHATEST,Q.alphaCutOff=void 0==X.alphaCutoff?.5:X.alphaCutoff,Q.albedoTexture&&(Q.albedoTexture.fc=!0);break;case"BLEND":Q.transparencyMode=Z.PBRMATERIAL_ALPHABLEND,Q.albedoTexture&&(Q.albedoTexture.fc=!0,Q.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${q}/alphaMode: Invalid value (${X.alphaMode})`)}}loadTextureInfoAsync(q,X){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const y=this._extensionsLoadTextureInfoAsync(q,X,Q);if(y)return y;if(this.logOpen(`${q}`),X.texCoord>=6)throw new Error(`${q}/texCoord: Invalid value (${X.texCoord})`);const x=n.Get(`${q}/index`,this._gltf.textures,X.index);x._textureInfo=X;const u=this._loadTextureAsync(`/textures/${X.index}`,x,(y=>{y.coordinatesIndex=X.texCoord||0,r.AddPointerMetadata(y,q),this._parent.onTextureLoadedObservable.notifyObservers(y),Q(y)}));return this.logClose(),u}_loadTextureAsync(q,X){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const y=this._extensionsLoadTextureAsync(q,X,Q);if(y)return y;this.logOpen(`${q} ${X.name||""}`);const x=void 0==X.sampler?r.DefaultSampler:n.Get(`${q}/sampler`,this._gltf.samplers,X.sampler),u=n.Get(`${q}/source`,this._gltf.images,X.source),H=this._createTextureAsync(q,x,u,Q,void 0,!X._textureInfo.nonColorData);return this.logClose(),H}_createTextureAsync(q,X,Q){let x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},u=arguments.length>4?arguments[4]:void 0,H=arguments.length>5?arguments[5]:void 0;const b=this._loadSampler(`/samplers/${X.index}`,X),D=new Array,a=new y;this._babylonScene._blockEntityCollection=!!this._assetContainer;const R={noMipmap:b.noMipMaps,invertY:!1,samplingMode:b.samplingMode,X:()=>{this._disposed||a.resolve()},onError:(X,Q)=>{this._disposed||a.reject(new Error(`${q}: ${Q&&Q.message?Q.message:X||"Failed to load texture"}`))},mimeType:Q.mimeType,loaderOptions:u,useSRGBBuffer:!!H&&this._parent.useSRGBBuffers},L=new U.d(null,this._babylonScene,R);return L._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,D.push(a.promise),D.push(this.loadImageAsync(`/images/${Q.index}`,Q).then((q=>{const X=Q.uri||`${this._fileName}#image${Q.index}`,y=`data:${this._uniqueRootUrl}${X}`;L.updateURL(y,q);const x=L.getInternalTexture();x&&(x.label=Q.name)}))),L.wrapU=b.wrapU,L.wrapV=b.wrapV,x(L),this._parent.useGltfTextureNames&&(L.name=Q.name||Q.uri||`image${Q.index}`),Promise.all(D).then((()=>L))}_loadSampler(q,X){return X._data||(X._data={noMipMaps:9728===X.minFilter||9729===X.minFilter,samplingMode:r._GetTextureSamplingMode(q,X),wrapU:r._GetTextureWrapMode(`${q}/wrapS`,X.wrapS),wrapV:r._GetTextureWrapMode(`${q}/wrapT`,X.wrapT)}),X._data}loadImageAsync(q,X){if(!X._data){if(this.logOpen(`${q} ${X.name||""}`),X.uri)X._data=this.loadUriAsync(`${q}/uri`,X,X.uri);else{const Q=n.Get(`${q}/bufferView`,this._gltf.bufferViews,X.bufferView);X._data=this.loadBufferViewAsync(`/bufferViews/${Q.index}`,Q)}this.logClose()}return X._data}loadUriAsync(q,X,Q){const y=this._extensionsLoadUriAsync(q,X,Q);if(y)return y;if(!r._ValidateUri(Q))throw new Error(`${q}: '${Q}' is invalid`);if((0,S.j)(Q)){const X=new Uint8Array((0,S.c)(Q));return this.log(`${q}: Decoded ${Q.substring(0,64)}... (${X.length} bytes)`),Promise.resolve(X)}return this.log(`${q}: Loading ${Q}`),this._parent.preprocessUrlAsync(this._rootUrl+Q).then((X=>new Promise(((y,x)=>{this._parent._loadFile(this._babylonScene,X,(X=>{this._disposed||(this.log(`${q}: Loaded ${Q} (${X.byteLength} bytes)`),y(new Uint8Array(X)))}),!0,(X=>{x(new S.m(`${q}: Failed to load '${Q}'${X?": "+X.status+" "+X.statusText:""}`,X))}))}))))}static AddPointerMetadata(q,X){q.metadata=q.metadata||{};const Q=q._internalMetadata=q._internalMetadata||{},y=Q.Wi=Q.Wi||{};(y.pointers=y.pointers||[]).push(X)}static _GetTextureWrapMode(q,X){switch(X=void 0==X?10497:X){case 33071:return U.d.CLAMP_ADDRESSMODE;case 33648:return U.d.MIRROR_ADDRESSMODE;case 10497:return U.d.WRAP_ADDRESSMODE;default:return I.b.Warn(`${q}: Invalid value (${X})`),U.d.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(q,X){const Q=void 0==X.magFilter?9729:X.magFilter,y=void 0==X.minFilter?9987:X.minFilter;if(9729===Q)switch(y){case 9728:return U.d.LINEAR_NEAREST;case 9729:return U.d.LINEAR_LINEAR;case 9984:return U.d.LINEAR_NEAREST_MIPNEAREST;case 9985:return U.d.LINEAR_LINEAR_MIPNEAREST;case 9986:return U.d.LINEAR_NEAREST_MIPLINEAR;case 9987:return U.d.LINEAR_LINEAR_MIPLINEAR;default:return I.b.Warn(`${q}/minFilter: Invalid value (${y})`),U.d.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==Q&&I.b.Warn(`${q}/magFilter: Invalid value (${Q})`),y){case 9728:return U.d.NEAREST_NEAREST;case 9729:return U.d.NEAREST_LINEAR;case 9984:return U.d.NEAREST_NEAREST_MIPNEAREST;case 9985:return U.d.NEAREST_LINEAR_MIPNEAREST;case 9986:return U.d.NEAREST_NEAREST_MIPLINEAR;case 9987:return U.d.NEAREST_LINEAR_MIPLINEAR;default:return I.b.Warn(`${q}/minFilter: Invalid value (${y})`),U.d.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(q,X){switch(X){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`${q}: Invalid component type ${X}`)}}static _GetTypedArray(q,X,Q,y,x){const u=Q.buffer;y=Q.byteOffset+(y||0);const H=r._GetTypedArrayConstructor(`${q}/componentType`,X),b=g.c.GetTypeByteLength(X);return y%b!==0?(I.b.Warn(`${q}: Copying buffer as byte offset (${y}) is not a multiple of component type byte length (${b})`),new H(u.slice(y,y+x*b),0)):new H(u,y,x)}static _GetNumComponents(q,X){switch(X){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${q}: Invalid type (${X})`)}static _ValidateUri(q){return H.f.IsBase64(q)||-1===q.indexOf("..")}static _GetDrawMode(q,X){switch(void 0==X&&(X=4),X){case 0:return i.b.PointListDrawMode;case 1:return i.b.LineListDrawMode;case 2:return i.b.LineLoopDrawMode;case 3:return i.b.LineStripDrawMode;case 4:return i.b.TriangleFillMode;case 5:return i.b.TriangleStripDrawMode;case 6:return i.b.TriangleFanDrawMode}throw new Error(`${q}: Invalid mesh primitive mode (${X})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const q=new Array;if(this._gltf.materials)for(const X of this._gltf.materials)if(X._data)for(const Q in X._data){const y=X._data[Q];for(const X of y.babylonMeshes){X.le(!0);const Q=y.babylonMaterial;q.push(Q.forceCompilationAsync(X)),q.push(Q.forceCompilationAsync(X,{useInstances:!0})),this._parent.useClipPlane&&(q.push(Q.forceCompilationAsync(X,{clipPlane:!0})),q.push(Q.forceCompilationAsync(X,{clipPlane:!0,useInstances:!0})))}}return Promise.all(q).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const q=new Array,X=this._babylonScene.lights;for(const Q of X){const X=Q.getShadowGenerator();X&&q.push(X.forceCompilationAsync())}return Promise.all(q).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(q){for(const X of this._extensions)X.enabled&&q(X)}_applyExtensions(q,X,Q){for(const y of this._extensions)if(y.enabled){const x=`${y.name}.${X}`,u=q;u._activeLoaderExtensionFunctions=u._activeLoaderExtensionFunctions||{};const H=u._activeLoaderExtensionFunctions;if(!H[x]){H[x]=!0;try{const q=Q(y);if(q)return q}finally{delete H[x]}}}return null}_extensionsOnLoading(){this._forEachExtensions((q=>q.onLoading&&q.onLoading()))}_extensionsOnReady(){this._forEachExtensions((q=>q.onReady&&q.onReady()))}_extensionsLoadSceneAsync(q,X){return this._applyExtensions(X,"loadScene",(Q=>Q.loadSceneAsync&&Q.loadSceneAsync(q,X)))}_extensionsLoadNodeAsync(q,X,Q){return this._applyExtensions(X,"loadNode",(y=>y.loadNodeAsync&&y.loadNodeAsync(q,X,Q)))}_extensionsLoadCameraAsync(q,X,Q){return this._applyExtensions(X,"loadCamera",(y=>y.loadCameraAsync&&y.loadCameraAsync(q,X,Q)))}_extensionsLoadVertexDataAsync(q,X,Q){return this._applyExtensions(X,"loadVertexData",(y=>y._loadVertexDataAsync&&y._loadVertexDataAsync(q,X,Q)))}_extensionsLoadMeshPrimitiveAsync(q,X,Q,y,x,u){return this._applyExtensions(x,"loadMeshPrimitive",(H=>H._loadMeshPrimitiveAsync&&H._loadMeshPrimitiveAsync(q,X,Q,y,x,u)))}_extensionsLoadMaterialAsync(q,X,Q,y,x){return this._applyExtensions(X,"loadMaterial",(u=>u._loadMaterialAsync&&u._loadMaterialAsync(q,X,Q,y,x)))}_extensionsCreateMaterial(q,X,Q){return this._applyExtensions(X,"createMaterial",(y=>y.createMaterial&&y.createMaterial(q,X,Q)))}_extensionsLoadMaterialPropertiesAsync(q,X,Q){return this._applyExtensions(X,"loadMaterialProperties",(y=>y.loadMaterialPropertiesAsync&&y.loadMaterialPropertiesAsync(q,X,Q)))}_extensionsLoadTextureInfoAsync(q,X,Q){return this._applyExtensions(X,"loadTextureInfo",(y=>y.loadTextureInfoAsync&&y.loadTextureInfoAsync(q,X,Q)))}_extensionsLoadTextureAsync(q,X,Q){return this._applyExtensions(X,"loadTexture",(y=>y._loadTextureAsync&&y._loadTextureAsync(q,X,Q)))}_extensionsLoadAnimationAsync(q,X){return this._applyExtensions(X,"loadAnimation",(Q=>Q.loadAnimationAsync&&Q.loadAnimationAsync(q,X)))}_extensionsLoadAnimationChannelAsync(q,X,Q,y,x){return this._applyExtensions(Q,"loadAnimationChannel",(u=>u._loadAnimationChannelAsync&&u._loadAnimationChannelAsync(q,X,Q,y,x)))}_extensionsLoadSkinAsync(q,X,Q){return this._applyExtensions(Q,"loadSkin",(y=>y._loadSkinAsync&&y._loadSkinAsync(q,X,Q)))}_extensionsLoadUriAsync(q,X,Q){return this._applyExtensions(X,"loadUri",(y=>y._loadUriAsync&&y._loadUriAsync(q,X,Q)))}_extensionsLoadBufferViewAsync(q,X){return this._applyExtensions(X,"loadBufferView",(Q=>Q.loadBufferViewAsync&&Q.loadBufferViewAsync(q,X)))}_extensionsLoadBufferAsync(q,X,Q,y){return this._applyExtensions(X,"loadBuffer",(x=>x.loadBufferAsync&&x.loadBufferAsync(q,X,Q,y)))}static LoadExtensionAsync(q,X,Q,y){if(!X.extensions)return null;const x=X.extensions[Q];return x?y(`${q}/extensions/${Q}`,x):null}static LoadExtraAsync(q,X,Q,y){if(!X.extras)return null;const x=X.extras[Q];return x?y(`${q}/extras/${Q}`,x):null}isExtensionUsed(q){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(q)}logOpen(q){this._parent._logOpen(q)}logClose(){this._parent._logClose()}log(q){this._parent._log(q)}startPerformanceCounter(q){this._parent._startPerformanceCounter(q)}endPerformanceCounter(q){this._parent._endPerformanceCounter(q)}}r.DefaultSampler={index:-1},N.e._CreateGLTF2Loader=q=>new r(q);var s=Q(1485),T=Q(10223),qq=Q(11920);class Xq extends qq.e{constructor(q,X,Q){let y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,u=arguments.length>5&&void 0!==arguments[5]&&arguments[5],H=arguments.length>6&&void 0!==arguments[6]&&arguments[6],b=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,D=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",q),this._texture=q.getEngine().createRawCubeTexture(X,Q,y,x,u,H,b,D)}update(q,X,Q,y){let x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,q,X,Q,y,x)}updateRGBDAsync(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,T.j)(this._texture,q,X,Q,y).then((()=>{}))}clone(){return v.c.Clone((()=>{const q=this.va(),X=this._texture,Q=new Xq(q,X._bufferViewArray,X.width,X.format,X.type,X.generateMipMaps,X.invertY,X.samplingMode,X._compression);return 13===X.source&&Q.updateRGBDAsync(X._bufferViewArrayArray,X._sphericalPolynomial,X._lodGenerationScale,X._lodGenerationOffset),Q}),this)}}const Qq="EXT_lights_image_based";class yq{constructor(q){this.name=Qq,this._loader=q,this.enabled=this._loader.isExtensionUsed(Qq)}dispose(){this._loader=null,delete this._lights}onLoading(){const q=this._loader.Wi.extensions;if(q&&q[this.name]){const X=q[this.name];this._lights=X.lights}}loadSceneAsync(q,X){return r.LoadExtensionAsync(q,X,this.name,((Q,y)=>{this._loader._allMaterialsDirtyRequired=!0;const x=new Array;x.push(this._loader.loadSceneAsync(q,X)),this._loader.logOpen(`${Q}`);const u=n.Get(`${Q}/light`,this._lights,y.eb);return x.push(this._loadLightAsync(`/extensions/${this.name}/lights/${y.eb}`,u).then((q=>{this._loader.babylonScene.environmentTexture=q}))),this._loader.logClose(),Promise.all(x).then((()=>{}))}))}_loadLightAsync(q,X){if(!X._loaded){const Q=new Array;this._loader.logOpen(`${q}`);const y=new Array(X.specularImages.length);for(let x=0;x<X.specularImages.length;x++){const u=X.specularImages[x];y[x]=new Array(u.length);for(let X=0;X<u.length;X++){const H=`${q}/specularImages/${x}/${X}`;this._loader.logOpen(`${H}`);const b=u[X],D=n.Get(H,this._loader.Wi.images,b);Q.push(this._loader.loadImageAsync(`/images/${b}`,D).then((q=>{y[x][X]=q}))),this._loader.logClose()}}this._loader.logClose(),X._loaded=Promise.all(Q).then((()=>{const Q=new Xq(this._loader.babylonScene,null,X.specularImageSize);if(Q.name=X.name||"environment",X._babylonTexture=Q,void 0!=X.dj&&(Q.level=X.dj),X.rotation){let q=x.d.Rd(X.rotation);this._loader.babylonScene.useRightHandedSystem||(q=x.d.Inverse(q)),x.b.FromQuaternionToRef(q,Q.getReflectionTextureMatrix())}if(!X.irradianceCoefficients)throw new Error(`${q}: Irradiance coefficients are missing`);const u=s.c.Rd(X.irradianceCoefficients);u.scaleInPlace(X.dj),u.convertIrradianceToLambertianRadiance();const H=s.d.FromHarmonics(u),b=(y.length-1)/Math.log2(X.specularImageSize);return Q.updateRGBDAsync(y,H,b)}))}return X._loaded.then((()=>X._babylonTexture))}}E(Qq),C(Qq,!0,(q=>new yq(q)));Q(11925);const xq="EXT_mesh_gpu_instancing";class uq{constructor(q){this.name=xq,this._loader=q,this.enabled=this._loader.isExtensionUsed(xq)}dispose(){this._loader=null}loadNodeAsync(q,X,Q){return r.LoadExtensionAsync(q,X,this.name,((q,y)=>{this._loader._disableInstancedMesh++;const u=this._loader.loadNodeAsync(`/nodes/${X.index}`,X,Q);if(this._loader._disableInstancedMesh--,!X._primitiveBabylonMeshes)return u;const H=new Array;let b=0;const D=X=>{if(void 0==y.attributes[X])return void H.push(Promise.resolve(null));const Q=n.Get(`${q}/attributes/${X}`,this._loader.Wi.accessors,y.attributes[X]);if(H.push(this._loader._loadFloatAccessorAsync(`/accessors/${Q.bufferView}`,Q)),0===b)b=Q.count;else if(b!==Q.count)throw new Error(`${q}/attributes: Instance buffer accessors do not have the same count.`)};return D("TRANSLATION"),D("ROTATION"),D("SCALE"),u.then((q=>Promise.all(H).then((Q=>{let[y,u,H]=Q;const D=new Float32Array(16*b);x.h.Od[0].Pd(0,0,0),x.h.Quaternion[0].Pd(0,0,0,1),x.h.Od[1].Pd(1,1,1);for(let q=0;q<b;++q)y&&x.n.FromArrayToRef(y,3*q,x.h.Od[0]),u&&x.d.FromArrayToRef(u,4*q,x.h.Quaternion[0]),H&&x.n.FromArrayToRef(H,3*q,x.h.Od[1]),x.b.ComposeToRef(x.h.Od[1],x.h.Quaternion[0],x.h.Od[0],x.h.Matrix[0]),x.h.Matrix[0].copyToArray(D,16*q);for(const q of X._primitiveBabylonMeshes)q.Mj("matrix",D,16,!0);return q}))))}))}}E(xq),C(xq,!0,(q=>new uq(q)));class Hq{static get Default(){return Hq._Default||(Hq._Default=new Hq),Hq._Default}constructor(){const q=Hq.Configuration.decoder;this._decoderModulePromise=H.f.LoadBabylonScriptAsync(q.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}decodeGltfBufferAsync(q,X,Q,y,x){return this._decoderModulePromise.then((async()=>{MeshoptDecoder.useWorkers(1);const u=await MeshoptDecoder.decodeGltfBufferAsync(X,Q,q,y,x);return MeshoptDecoder.useWorkers(0),u}))}}Hq.Configuration={decoder:{url:`${H.f._DefaultCdnUrl}/meshopt_decoder.js`}},Hq._Default=null;const bq="EXT_meshopt_compression";class Dq{constructor(q){this.name=bq,this.enabled=q.isExtensionUsed(bq),this._loader=q}dispose(){this._loader=null}loadBufferViewAsync(q,X){return r.LoadExtensionAsync(q,X,this.name,((Q,y)=>{const x=X;if(x._meshOptData)return x._meshOptData;const u=n.Get(`${q}/buffer`,this._loader.Wi.buffers,y.buffer);return x._meshOptData=this._loader.loadBufferAsync(`/buffers/${u.index}`,u,y.byteOffset||0,y.byteLength).then((q=>Hq.Default.decodeGltfBufferAsync(q,y.count,y.byteStride,y.mode,y.filter))),x._meshOptData}))}}E(bq),C(bq,!0,(q=>new Dq(q)));const aq="EXT_texture_webp";class Rq{constructor(q){this.name=aq,this._loader=q,this.enabled=q.isExtensionUsed(aq)}dispose(){this._loader=null}_loadTextureAsync(q,X,Q){return r.LoadExtensionAsync(q,X,this.name,((y,x)=>{const u=void 0==X.sampler?r.DefaultSampler:n.Get(`${q}/sampler`,this._loader.Wi.samplers,X.sampler),H=n.Get(`${y}/source`,this._loader.Wi.images,x.source);return this._loader._createTextureAsync(q,u,H,(q=>{Q(q)}),void 0,!X._textureInfo.nonColorData)}))}}E(aq),C(aq,!0,(q=>new Rq(q)));const Lq="EXT_texture_avif";class fq{constructor(q){this.name=Lq,this._loader=q,this.enabled=q.isExtensionUsed(Lq)}dispose(){this._loader=null}_loadTextureAsync(q,X,Q){return r.LoadExtensionAsync(q,X,this.name,((y,x)=>{const u=void 0==X.sampler?r.DefaultSampler:n.Get(`${q}/sampler`,this._loader.Wi.samplers,X.sampler),H=n.Get(`${y}/source`,this._loader.Wi.images,x.source);return this._loader._createTextureAsync(q,u,H,(q=>{Q(q)}),void 0,!X._textureInfo.nonColorData)}))}}E(Lq),C(Lq,!0,(q=>new fq(q)));var kq=Q(11931);const jq="KHR_draco_mesh_compression";class Iq{constructor(q){this.name=jq,this.useNormalizedFlagFromAccessor=!0,this._loader=q,this.enabled=kq.b.DecoderAvailable&&this._loader.isExtensionUsed(jq)}dispose(){delete this.dracoCompression,this._loader=null}_loadVertexDataAsync(q,X,Q){return r.LoadExtensionAsync(q,X,this.name,((y,x)=>{if(void 0!=X.mode&&4!==X.mode&&5!==X.mode)throw new Error(`${q}: Unsupported mode ${X.mode}`);const u={},H={},b=(q,y)=>{const b=x.attributes[q];if(void 0!=b&&(Q._delayInfo=Q._delayInfo||[],-1===Q._delayInfo.indexOf(y)&&Q._delayInfo.push(y),u[y]=b,this.useNormalizedFlagFromAccessor)){const Q=n.TryGet(this._loader.Wi.accessors,X.attributes[q]);Q&&(H[y]=Q.normalized||!1)}};b("POSITION",g.c.PositionKind),b("NORMAL",g.c.NormalKind),b("TANGENT",g.c.TangentKind),b("TEXCOORD_0",g.c.UVKind),b("TEXCOORD_1",g.c.UV2Kind),b("TEXCOORD_2",g.c.UV3Kind),b("TEXCOORD_3",g.c.UV4Kind),b("TEXCOORD_4",g.c.UV5Kind),b("TEXCOORD_5",g.c.UV6Kind),b("JOINTS_0",g.c.MatricesIndicesKind),b("WEIGHTS_0",g.c.MatricesWeightsKind),b("COLOR_0",g.c.ColorKind);const D=n.Get(y,this._loader.Wi.bufferViews,x.bufferView);return D._dracoBabylonGeometry||(D._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${D.index}`,D).then((X=>(this.dracoCompression||kq.b.Default)._decodeMeshToGeometryForGltfAsync(Q.name,this._loader.babylonScene,X,u,H).catch((X=>{throw new Error(`${q}: ${X.message}`)}))))),D._dracoBabylonGeometry}))}}E(jq),C(jq,!0,(q=>new Iq(q)));var dq=Q(11934),eq=Q(11270),iq=Q(11911),Aq=Q(11939);eq.d.AddNodeConstructor("Light_Type_0",((q,X)=>()=>new Bq(q,x.n.Zero(),X)));class Bq extends Aq.d{get shadowAngle(){return this._shadowAngle}set shadowAngle(q){this._shadowAngle=q,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(q){const X=this.needCube();if(this._direction=q,this.needCube()!==X&&this._shadowGenerators){const q=this._shadowGenerators.values();for(let X=q.next();!0!==X.done;X=q.next()){X.value.recreateShadowMap()}}}constructor(q,X,Q){super(q,Q),this._shadowAngle=Math.PI/2,this.position=X}getClassName(){return"PointLight"}getTypeID(){return iq.b.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(q){if(this.direction)return super.getShadowDirection(q);switch(q){case 0:return new x.n(1,0,0);case 1:return new x.n(-1,0,0);case 2:return new x.n(0,-1,0);case 3:return new x.n(0,1,0);case 4:return new x.n(0,0,1);case 5:return new x.n(0,0,-1)}return x.n.Zero()}_setDefaultShadowProjectionMatrix(q,X,Q){const y=this.va().activeCamera;if(!y)return;const u=void 0!==this.shadowMinZ?this.shadowMinZ:y._i,H=void 0!==this.shadowMaxZ?this.shadowMaxZ:y.maxZ,b=this.va().getEngine().useReverseDepthBuffer;x.b.PerspectiveFovLHToRef(this.shadowAngle,1,b?H:u,b?u:H,q,!0,this._scene.getEngine().isNDCHalfZRange,void 0,b)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(q,X){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,X):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,X),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,X),this}transferToNodeMaterialEffect(q,X){return this.computeTransformedInformation()?q.setFloat3(X,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):q.setFloat3(X,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(q,X){q["POINTLIGHT"+X]=!0}}(0,A.b)([(0,B.J)()],Bq.prototype,"shadowAngle",null),(0,W.h)("BABYLON.PointLight",Bq),eq.d.AddNodeConstructor("Light_Type_2",((q,X)=>()=>new wq(q,x.n.Zero(),x.n.Zero(),0,0,X)));class wq extends Aq.d{get angle(){return this._angle}set angle(q){this._angle=q,this._cosHalfAngle=Math.cos(.5*q),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(q){this._innerAngle=q,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(q){this._shadowAngleScale=q,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(q){this._projectionTextureLightNear=q,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(q){this._projectionTextureLightFar=q,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(q){this._projectionTextureUpDirection=q,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(q){this._projectionTexture!==q&&(this._projectionTexture=q,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(wq._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):wq._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(q){return void 0!==q.onGeneratedObservable}static _IsTexture(q){return void 0!==q.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(q){this._projectionTextureProjectionLightMatrix=q,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(q,X,Q,y,u,H){super(q,H),this._innerAngle=0,this._projectionTextureMatrix=x.b.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=x.n.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=x.n.Zero(),this._projectionTextureViewLightMatrix=x.b.Zero(),this._projectionTextureProjectionLightMatrix=x.b.Zero(),this._projectionTextureScalingMatrix=x.b.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=X,this.direction=Q,this.angle=y,this.exponent=u}getClassName(){return"SpotLight"}getTypeID(){return iq.b.LIGHTTYPEID_SPOTLIGHT}_setDirection(q){super._setDirection(q),this._projectionTextureViewLightDirty=!0}_setPosition(q){super._setPosition(q),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(q,X,Q){const y=this.va().activeCamera;if(!y)return;this._shadowAngleScale=this._shadowAngleScale||1;const u=this._shadowAngleScale*this._angle,H=void 0!==this.shadowMinZ?this.shadowMinZ:y._i,b=void 0!==this.shadowMaxZ?this.shadowMaxZ:y.maxZ,D=this.va().getEngine().useReverseDepthBuffer;x.b.PerspectiveFovLHToRef(u,1,D?b:H,D?H:b,q,!0,this._scene.getEngine().isNDCHalfZRange,void 0,D)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),x.b.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const q=this.projectionTextureLightFar,X=this.projectionTextureLightNear,Q=q/(q-X),y=-Q*X,u=1/Math.tan(this._angle/2);x.b.FromValuesToRef(u/1,0,0,0,0,u,0,0,0,0,Q,1,0,0,y,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof U.d){const q=this._projectionTexture.uScale/2,X=this._projectionTexture.vScale/2;x.b.FromValuesToRef(q,0,0,0,0,X,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(q,X){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),q.setMatrix("textureProjectionMatrix"+X,this._projectionTextureMatrix),q.setTexture("projectionLightTexture"+X,this.projectionTexture)),this}transferToEffect(q,X){let Q;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,X),Q=x.n.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,X),Q=x.n.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",Q.x,Q.y,Q.z,this._cosHalfAngle,X),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,X),this}transferToNodeMaterialEffect(q,X){let Q;return Q=this.computeTransformedInformation()?x.n.Normalize(this.transformedDirection):x.n.Normalize(this.direction),this.va().useRightHandedSystem?q.setFloat3(X,-Q.x,-Q.y,-Q.z):q.setFloat3(X,Q.x,Q.y,Q.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose()}getDepthMinZ(q){const X=this._scene.getEngine(),Q=void 0!==this.shadowMinZ?this.shadowMinZ:q._i;return X.useReverseDepthBuffer&&X.isNDCHalfZRange?Q:this._scene.getEngine().isNDCHalfZRange?0:Q}getDepthMaxZ(q){const X=this._scene.getEngine(),Q=void 0!==this.shadowMaxZ?this.shadowMaxZ:q.maxZ;return X.useReverseDepthBuffer&&X.isNDCHalfZRange?0:Q}prepareLightSpecificDefines(q,X){q["SPOTLIGHT"+X]=!0,q["PROJECTEDLIGHTTEXTURE"+X]=!(!this.projectionTexture||!this.projectionTexture.isReady())}}(0,A.b)([(0,B.J)()],wq.prototype,"angle",null),(0,A.b)([(0,B.J)()],wq.prototype,"innerAngle",null),(0,A.b)([(0,B.J)()],wq.prototype,"shadowAngleScale",null),(0,A.b)([(0,B.J)()],wq.prototype,"exponent",void 0),(0,A.b)([(0,B.J)()],wq.prototype,"projectionTextureLightNear",null),(0,A.b)([(0,B.J)()],wq.prototype,"projectionTextureLightFar",null),(0,A.b)([(0,B.J)()],wq.prototype,"projectionTextureUpDirection",null),(0,A.b)([(0,B.B)("projectedLightTexture")],wq.prototype,"_projectionTexture",void 0),(0,W.h)("BABYLON.SpotLight",wq);const Vq="KHR_lights_punctual";class Wq{constructor(q){this.name=Vq,this._loader=q,this.enabled=this._loader.isExtensionUsed(Vq)}dispose(){this._loader=null,delete this._lights}onLoading(){const q=this._loader.Wi.extensions;if(q&&q[this.name]){const X=q[this.name];this._lights=X.lights,n.Assign(this._lights)}}loadNodeAsync(q,X,Q){return r.LoadExtensionAsync(q,X,this.name,((y,H)=>(this._loader._allMaterialsDirtyRequired=!0,this._loader.loadNodeAsync(q,X,(q=>{let X;const b=n.Get(y,this._lights,H.eb),D=b.name||q.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,b.type){case"directional":{const q=new dq.c(D,x.n.Backward(),this._loader.babylonScene);q.position.Td(0),X=q;break}case"point":X=new Bq(D,x.n.Zero(),this._loader.babylonScene);break;case"spot":{const q=new wq(D,x.n.Zero(),x.n.Backward(),0,1,this._loader.babylonScene);q.angle=2*(b.spot&&b.spot.outerConeAngle||Math.PI/4),q.innerAngle=2*(b.spot&&b.spot.innerConeAngle||0),X=q;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${y}: Invalid light type (${b.type})`)}X._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,b._babylonLight=X,X.falloffType=iq.b.FALLOFF_GLTF,X.Jh=b.color?u.b.Rd(b.color):u.b.White(),X.dj=void 0==b.dj?1:b.dj,X.range=void 0==b.range?Number.MAX_VALUE:b.range,X.parent=q,this._loader._babylonLights.push(X),r.AddPointerMetadata(X,y),Q(q)})))))}}E(Vq),C(Vq,!0,(q=>new Wq(q)));const vq="KHR_materials_pbrSpecularGlossiness";class Zq{constructor(q){this.name=vq,this.order=200,this._loader=q,this.enabled=this._loader.isExtensionUsed(vq)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,X,Q){return r.LoadExtensionAsync(q,X,this.name,((y,x)=>{const u=new Array;return u.push(this._loader.loadMaterialBasePropertiesAsync(q,X,Q)),u.push(this._loadSpecularGlossinessPropertiesAsync(y,x,Q)),this._loader.loadMaterialAlphaProperties(q,X,Q),Promise.all(u).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(q,X,Q){if(!(Q instanceof Z))throw new Error(`${q}: Material type not supported`);const y=new Array;return Q.metallic=null,Q.roughness=null,X.diffuseFactor?(Q.albedoColor=u.b.Rd(X.diffuseFactor),Q.alpha=X.diffuseFactor[3]):Q.albedoColor=u.b.White(),Q.reflectivityColor=X.specularFactor?u.b.Rd(X.specularFactor):u.b.White(),Q.microSurface=void 0==X.glossinessFactor?1:X.glossinessFactor,X.diffuseTexture&&y.push(this._loader.loadTextureInfoAsync(`${q}/diffuseTexture`,X.diffuseTexture,(q=>{q.name=`${Q.name} (Diffuse)`,Q.albedoTexture=q}))),X.specularGlossinessTexture&&(y.push(this._loader.loadTextureInfoAsync(`${q}/specularGlossinessTexture`,X.specularGlossinessTexture,(q=>{q.name=`${Q.name} (Specular Glossiness)`,Q.reflectivityTexture=q,Q.reflectivityTexture.fc=!0}))),Q.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(y).then((()=>{}))}}E(vq),C(vq,!0,(q=>new Zq(q)));const Uq="KHR_materials_unlit";class Oq{constructor(q){this.name=Uq,this.order=210,this._loader=q,this.enabled=this._loader.isExtensionUsed(Uq)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,X,Q){return r.LoadExtensionAsync(q,X,this.name,(()=>this._loadUnlitPropertiesAsync(q,X,Q)))}_loadUnlitPropertiesAsync(q,X,Q){if(!(Q instanceof Z))throw new Error(`${q}: Material type not supported`);const y=new Array;Q.unlit=!0;const x=X.pbrMetallicRoughness;return x&&(x.baseColorFactor?(Q.albedoColor=u.b.Rd(x.baseColorFactor),Q.alpha=x.baseColorFactor[3]):Q.albedoColor=u.b.White(),x.baseColorTexture&&y.push(this._loader.loadTextureInfoAsync(`${q}/baseColorTexture`,x.baseColorTexture,(q=>{q.name=`${Q.name} (Base Color)`,Q.albedoTexture=q})))),X.doubleSided&&(Q.ue=!1,Q.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(q,X,Q),Promise.all(y).then((()=>{}))}}E(Uq),C(Uq,!0,(q=>new Oq(q)));const gq="KHR_materials_clearcoat";class Pq{constructor(q){this.name=gq,this.order=190,this._loader=q,this.enabled=this._loader.isExtensionUsed(gq)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,X,Q){return r.LoadExtensionAsync(q,X,this.name,((y,x)=>{const u=new Array;return u.push(this._loader.loadMaterialPropertiesAsync(q,X,Q)),u.push(this._loadClearCoatPropertiesAsync(y,x,Q)),Promise.all(u).then((()=>{}))}))}_loadClearCoatPropertiesAsync(q,X,Q){if(!(Q instanceof Z))throw new Error(`${q}: Material type not supported`);const y=new Array;return Q.clearCoat.isEnabled=!0,Q.clearCoat.useRoughnessFromMainTexture=!1,Q.clearCoat.remapF0OnInterfaceChange=!1,void 0!=X.clearcoatFactor?Q.clearCoat.dj=X.clearcoatFactor:Q.clearCoat.dj=0,X.clearcoatTexture&&y.push(this._loader.loadTextureInfoAsync(`${q}/clearcoatTexture`,X.clearcoatTexture,(q=>{q.name=`${Q.name} (ClearCoat)`,Q.clearCoat.texture=q}))),void 0!=X.clearcoatRoughnessFactor?Q.clearCoat.roughness=X.clearcoatRoughnessFactor:Q.clearCoat.roughness=0,X.clearcoatRoughnessTexture&&(X.clearcoatRoughnessTexture.nonColorData=!0,y.push(this._loader.loadTextureInfoAsync(`${q}/clearcoatRoughnessTexture`,X.clearcoatRoughnessTexture,(q=>{q.name=`${Q.name} (ClearCoat Roughness)`,Q.clearCoat.textureRoughness=q})))),X.clearcoatNormalTexture&&(X.clearcoatNormalTexture.nonColorData=!0,y.push(this._loader.loadTextureInfoAsync(`${q}/clearcoatNormalTexture`,X.clearcoatNormalTexture,(q=>{q.name=`${Q.name} (ClearCoat Normal)`,Q.clearCoat.bumpTexture=q}))),Q.invertNormalMapX=!Q.va().useRightHandedSystem,Q.invertNormalMapY=Q.va().useRightHandedSystem,void 0!=X.clearcoatNormalTexture.scale&&(Q.clearCoat.bumpTexture.level=X.clearcoatNormalTexture.scale)),Promise.all(y).then((()=>{}))}}E(gq),C(gq,!0,(q=>new Pq(q)));const Fq="KHR_materials_iridescence";class lq{constructor(q){this.name=Fq,this.order=195,this._loader=q,this.enabled=this._loader.isExtensionUsed(Fq)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,X,Q){return r.LoadExtensionAsync(q,X,this.name,((y,x)=>{const u=new Array;return u.push(this._loader.loadMaterialPropertiesAsync(q,X,Q)),u.push(this._loadIridescencePropertiesAsync(y,x,Q)),Promise.all(u).then((()=>{}))}))}_loadIridescencePropertiesAsync(q,X,Q){if(!(Q instanceof Z))throw new Error(`${q}: Material type not supported`);const y=new Array;return Q.iridescence.isEnabled=!0,Q.iridescence.dj=X.iridescenceFactor??0,Q.iridescence.indexOfRefraction=X.iridescenceIor??X.iridescenceIOR??1.3,Q.iridescence.minimumThickness=X.iridescenceThicknessMinimum??100,Q.iridescence.maximumThickness=X.iridescenceThicknessMaximum??400,X.iridescenceTexture&&y.push(this._loader.loadTextureInfoAsync(`${q}/iridescenceTexture`,X.iridescenceTexture,(q=>{q.name=`${Q.name} (Iridescence)`,Q.iridescence.texture=q}))),X.iridescenceThicknessTexture&&y.push(this._loader.loadTextureInfoAsync(`${q}/iridescenceThicknessTexture`,X.iridescenceThicknessTexture,(q=>{q.name=`${Q.name} (Iridescence Thickness)`,Q.iridescence.thicknessTexture=q}))),Promise.all(y).then((()=>{}))}}E(Fq),C(Fq,!0,(q=>new lq(q)));const mq="KHR_materials_anisotropy";class Mq{constructor(q){this.name=mq,this.order=195,this._loader=q,this.enabled=this._loader.isExtensionUsed(mq)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,X,Q){return r.LoadExtensionAsync(q,X,this.name,((y,x)=>{const u=new Array;return u.push(this._loader.loadMaterialPropertiesAsync(q,X,Q)),u.push(this._loadIridescencePropertiesAsync(y,x,Q)),Promise.all(u).then((()=>{}))}))}_loadIridescencePropertiesAsync(q,X,Q){if(!(Q instanceof Z))throw new Error(`${q}: Material type not supported`);const y=new Array;return Q.anisotropy.isEnabled=!0,Q.anisotropy.dj=X.anisotropyStrength??0,Q.anisotropy.angle=X.anisotropyRotation??0,X.anisotropyTexture&&(X.anisotropyTexture.nonColorData=!0,y.push(this._loader.loadTextureInfoAsync(`${q}/anisotropyTexture`,X.anisotropyTexture,(q=>{q.name=`${Q.name} (Anisotropy Intensity)`,Q.anisotropy.texture=q})))),Promise.all(y).then((()=>{}))}}E(mq),C(mq,!0,(q=>new Mq(q)));const oq="KHR_materials_emissive_strength";class Yq{constructor(q){this.name=oq,this.order=170,this._loader=q,this.enabled=this._loader.isExtensionUsed(oq)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,X,Q){return r.LoadExtensionAsync(q,X,this.name,((y,x)=>this._loader.loadMaterialPropertiesAsync(q,X,Q).then((()=>{this._loadEmissiveProperties(y,x,Q)}))))}_loadEmissiveProperties(q,X,Q){if(!(Q instanceof Z))throw new Error(`${q}: Material type not supported`);void 0!==X.emissiveStrength&&(Q.emissiveIntensity=X.emissiveStrength)}}E(oq),C(oq,!0,(q=>new Yq(q)));const Nq="KHR_materials_sheen";class Sq{constructor(q){this.name=Nq,this.order=190,this._loader=q,this.enabled=this._loader.isExtensionUsed(Nq)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,X,Q){return r.LoadExtensionAsync(q,X,this.name,((y,x)=>{const u=new Array;return u.push(this._loader.loadMaterialPropertiesAsync(q,X,Q)),u.push(this._loadSheenPropertiesAsync(y,x,Q)),Promise.all(u).then((()=>{}))}))}_loadSheenPropertiesAsync(q,X,Q){if(!(Q instanceof Z))throw new Error(`${q}: Material type not supported`);const y=new Array;return Q.sheen.isEnabled=!0,Q.sheen.dj=1,void 0!=X.sheenColorFactor?Q.sheen.color=u.b.Rd(X.sheenColorFactor):Q.sheen.color=u.b.Black(),X.sheenColorTexture&&y.push(this._loader.loadTextureInfoAsync(`${q}/sheenColorTexture`,X.sheenColorTexture,(q=>{q.name=`${Q.name} (Sheen Color)`,Q.sheen.texture=q}))),void 0!==X.sheenRoughnessFactor?Q.sheen.roughness=X.sheenRoughnessFactor:Q.sheen.roughness=0,X.sheenRoughnessTexture&&(X.sheenRoughnessTexture.nonColorData=!0,y.push(this._loader.loadTextureInfoAsync(`${q}/sheenRoughnessTexture`,X.sheenRoughnessTexture,(q=>{q.name=`${Q.name} (Sheen Roughness)`,Q.sheen.textureRoughness=q})))),Q.sheen.albedoScaling=!0,Q.sheen.useRoughnessFromMainTexture=!1,Promise.all(y).then((()=>{}))}}E(Nq),C(Nq,!0,(q=>new Sq(q)));const cq="KHR_materials_specular";class pq{constructor(q){this.name=cq,this.order=190,this._loader=q,this.enabled=this._loader.isExtensionUsed(cq)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,X,Q){return r.LoadExtensionAsync(q,X,this.name,((y,x)=>{const u=new Array;return u.push(this._loader.loadMaterialPropertiesAsync(q,X,Q)),u.push(this._loadSpecularPropertiesAsync(y,x,Q)),Promise.all(u).then((()=>{}))}))}_loadSpecularPropertiesAsync(q,X,Q){if(!(Q instanceof Z))throw new Error(`${q}: Material type not supported`);const y=new Array;return void 0!==X.specularFactor&&(Q.metallicF0Factor=X.specularFactor),void 0!==X.specularColorFactor&&(Q.metallicReflectanceColor=u.b.Rd(X.specularColorFactor)),X.specularTexture&&(X.specularTexture.nonColorData=!0,y.push(this._loader.loadTextureInfoAsync(`${q}/specularTexture`,X.specularTexture,(q=>{q.name=`${Q.name} (Specular)`,Q.metallicReflectanceTexture=q,Q.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),X.specularColorTexture&&y.push(this._loader.loadTextureInfoAsync(`${q}/specularColorTexture`,X.specularColorTexture,(q=>{q.name=`${Q.name} (Specular Color)`,Q.reflectanceTexture=q}))),Promise.all(y).then((()=>{}))}}E(cq),C(cq,!0,(q=>new pq(q)));const tq="KHR_materials_ior";class zq{constructor(q){this.name=tq,this.order=180,this._loader=q,this.enabled=this._loader.isExtensionUsed(tq)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,X,Q){return r.LoadExtensionAsync(q,X,this.name,((y,x)=>{const u=new Array;return u.push(this._loader.loadMaterialPropertiesAsync(q,X,Q)),u.push(this._loadIorPropertiesAsync(y,x,Q)),Promise.all(u).then((()=>{}))}))}_loadIorPropertiesAsync(q,X,Q){if(!(Q instanceof Z))throw new Error(`${q}: Material type not supported`);return void 0!==X.ior?Q.indexOfRefraction=X.ior:Q.indexOfRefraction=zq._DEFAULT_IOR,Promise.resolve()}}zq._DEFAULT_IOR=1.5,E(tq),C(tq,!0,(q=>new zq(q)));const Kq="KHR_materials_variants";class hq{constructor(q){this.name=Kq,this._loader=q,this.enabled=this._loader.isExtensionUsed(Kq)}dispose(){this._loader=null}static GetAvailableVariants(q){const X=this._GetExtensionMetadata(q);return X?Object.keys(X.variants):[]}getAvailableVariants(q){return hq.GetAvailableVariants(q)}static SelectVariant(q,X){const Q=this._GetExtensionMetadata(q);if(!Q)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${Kq} extension`);const y=q=>{const X=Q.variants[q];if(X)for(const Q of X)Q.mesh.material=Q.material};if(X instanceof Array)for(const x of X)y(x);else y(X);Q.lastSelected=X}selectVariant(q,X){hq.SelectVariant(q,X)}static Reset(q){const X=this._GetExtensionMetadata(q);if(!X)throw new Error(`Cannot reset on a glTF mesh that does not have the ${Kq} extension`);for(const Q of X.original)Q.mesh.material=Q.material;X.lastSelected=null}reset(q){hq.Reset(q)}static GetLastSelectedVariant(q){const X=this._GetExtensionMetadata(q);if(!X)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${Kq} extension`);return X.lastSelected}getLastSelectedVariant(q){return hq.GetLastSelectedVariant(q)}static _GetExtensionMetadata(q){var X,Q;return(null===q||void 0===q||null===(X=q._internalMetadata)||void 0===X||null===(Q=X.Wi)||void 0===Q?void 0:Q[Kq])||null}onLoading(){const q=this._loader.Wi.extensions;if(q&&q[this.name]){const X=q[this.name];this._variants=X.variants}}_loadMeshPrimitiveAsync(q,X,Q,y,x,u){return r.LoadExtensionAsync(q,x,this.name,((H,b)=>{const D=new Array;return D.push(this._loader._loadMeshPrimitiveAsync(q,X,Q,y,x,(X=>{if(u(X),X instanceof l.b){const Q=r._GetDrawMode(q,x.mode),y=this._loader.rootBabylonMesh,u=y?y._internalMetadata=y._internalMetadata||{}:{},a=u.Wi=u.Wi||{},R=a[Kq]=a[Kq]||{lastSelected:null,original:[],variants:{}};R.original.push({mesh:X,material:X.material});for(let q=0;q<b.mappings.length;++q){const x=b.mappings[q],u=n.Get(`${H}/mappings/${q}/material`,this._loader.Wi.materials,x.material);D.push(this._loader._loadMaterialAsync(`#/materials/${x.material}`,u,X,Q,(q=>{for(let Q=0;Q<x.variants.length;++Q){const u=x.variants[Q],H=n.Get(`/extensions/${Kq}/variants/${u}`,this._variants,u);R.variants[H.name]=R.variants[H.name]||[],R.variants[H.name].push({mesh:X,material:q}),X.onClonedObservable.add((q=>{const Q=q;let x=null,u=Q;do{if(u=u.parent,!u)return;x=hq._GetExtensionMetadata(u)}while(null===x);if(y&&x===hq._GetExtensionMetadata(y)){u._internalMetadata={};for(const q in y._internalMetadata)u._internalMetadata[q]=y._internalMetadata[q];u._internalMetadata.Wi=[];for(const q in y._internalMetadata.Wi)u._internalMetadata.Wi[q]=y._internalMetadata.Wi[q];u._internalMetadata.Wi[Kq]={lastSelected:null,original:[],variants:{}};for(const q of x.original)u._internalMetadata.Wi[Kq].original.push({mesh:q.mesh,material:q.material});for(const q in x.variants)if(Object.prototype.hasOwnProperty.call(x.variants,q)){u._internalMetadata.Wi[Kq].variants[q]=[];for(const X of x.variants[q])u._internalMetadata.Wi[Kq].variants[q].push({mesh:X.mesh,material:X.material})}x=u._internalMetadata.Wi[Kq]}for(const y of x.original)y.mesh===X&&(y.mesh=Q);for(const y of x.variants[H.name])y.mesh===X&&(y.mesh=Q)}))}})))}}}))),Promise.all(D).then((q=>{let[X]=q;return X}))}))}}E(Kq),C(Kq,!0,(q=>new hq(q)));var Gq=Q(1525);class Cq{}Cq.AUTOSAMPLERSUFFIX="Sampler",Cq.DISABLEUA="#define DISABLE_UNIFORMITY_ANALYSIS",Cq.ALPHA_DISABLE=0,Cq.ALPHA_ADD=1,Cq.ALPHA_COMBINE=2,Cq.ALPHA_SUBTRACT=3,Cq.ALPHA_MULTIPLY=4,Cq.ALPHA_MAXIMIZED=5,Cq.ALPHA_ONEONE=6,Cq.ALPHA_PREMULTIPLIED=7,Cq.ALPHA_PREMULTIPLIED_PORTERDUFF=8,Cq.ALPHA_INTERPOLATE=9,Cq.ALPHA_SCREENMODE=10,Cq.ALPHA_ONEONE_ONEONE=11,Cq.ALPHA_ALPHATOCOLOR=12,Cq.ALPHA_REVERSEONEMINUS=13,Cq.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,Cq.ALPHA_ONEONE_ONEZERO=15,Cq.ALPHA_EXCLUSION=16,Cq.ALPHA_LAYER_ACCUMULATE=17,Cq.ALPHA_EQUATION_ADD=0,Cq.ALPHA_EQUATION_SUBSTRACT=1,Cq.ALPHA_EQUATION_REVERSE_SUBTRACT=2,Cq.ALPHA_EQUATION_MAX=3,Cq.ALPHA_EQUATION_MIN=4,Cq.ALPHA_EQUATION_DARKEN=5,Cq.DELAYLOADSTATE_NONE=0,Cq.DELAYLOADSTATE_LOADED=1,Cq.DELAYLOADSTATE_LOADING=2,Cq.DELAYLOADSTATE_NOTLOADED=4,Cq.NEVER=512,Cq.ALWAYS=519,Cq.LESS=513,Cq.EQUAL=514,Cq.LEQUAL=515,Cq.GREATER=516,Cq.GEQUAL=518,Cq.NOTEQUAL=517,Cq.KEEP=7680,Cq.ZERO=0,Cq.REPLACE=7681,Cq.INCR=7682,Cq.DECR=7683,Cq.INVERT=5386,Cq.INCR_WRAP=34055,Cq.DECR_WRAP=34056,Cq.TEXTURE_CLAMP_ADDRESSMODE=0,Cq.TEXTURE_WRAP_ADDRESSMODE=1,Cq.TEXTURE_MIRROR_ADDRESSMODE=2,Cq.TEXTURE_CREATIONFLAG_STORAGE=1,Cq.TEXTUREFORMAT_ALPHA=0,Cq.TEXTUREFORMAT_LUMINANCE=1,Cq.TEXTUREFORMAT_LUMINANCE_ALPHA=2,Cq.TEXTUREFORMAT_RGB=4,Cq.TEXTUREFORMAT_RGBA=5,Cq.TEXTUREFORMAT_RED=6,Cq.TEXTUREFORMAT_R=6,Cq.TEXTUREFORMAT_RG=7,Cq.TEXTUREFORMAT_RED_INTEGER=8,Cq.TEXTUREFORMAT_R_INTEGER=8,Cq.TEXTUREFORMAT_RG_INTEGER=9,Cq.TEXTUREFORMAT_RGB_INTEGER=10,Cq.TEXTUREFORMAT_RGBA_INTEGER=11,Cq.TEXTUREFORMAT_BGRA=12,Cq.TEXTUREFORMAT_DEPTH24_STENCIL8=13,Cq.TEXTUREFORMAT_DEPTH32_FLOAT=14,Cq.TEXTUREFORMAT_DEPTH16=15,Cq.TEXTUREFORMAT_DEPTH24=16,Cq.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17,Cq.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18,Cq.TEXTUREFORMAT_STENCIL8=19,Cq.TEXTUREFORMAT_UNDEFINED=4294967295,Cq.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492,Cq.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493,Cq.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495,Cq.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494,Cq.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779,Cq.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919,Cq.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778,Cq.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918,Cq.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777,Cq.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776,Cq.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917,Cq.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916,Cq.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808,Cq.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840,Cq.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196,Cq.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492,Cq.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493,Cq.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494,Cq.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495,Cq.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496,Cq.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497,Cq.TEXTURETYPE_UNSIGNED_BYTE=0,Cq.TEXTURETYPE_UNSIGNED_INT=0,Cq.TEXTURETYPE_FLOAT=1,Cq.TEXTURETYPE_HALF_FLOAT=2,Cq.TEXTURETYPE_BYTE=3,Cq.TEXTURETYPE_SHORT=4,Cq.TEXTURETYPE_UNSIGNED_SHORT=5,Cq.TEXTURETYPE_INT=6,Cq.TEXTURETYPE_UNSIGNED_INTEGER=7,Cq.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,Cq.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,Cq.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,Cq.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,Cq.TEXTURETYPE_UNSIGNED_INT_24_8=12,Cq.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,Cq.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,Cq.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,Cq.TEXTURETYPE_UNDEFINED=16,Cq.TEXTURE_2D=3553,Cq.TEXTURE_2D_ARRAY=35866,Cq.TEXTURE_CUBE_MAP=34067,Cq.TEXTURE_CUBE_MAP_ARRAY=3735928559,Cq.TEXTURE_3D=32879,Cq.TEXTURE_NEAREST_SAMPLINGMODE=1,Cq.TEXTURE_NEAREST_NEAREST=1,Cq.TEXTURE_BILINEAR_SAMPLINGMODE=2,Cq.TEXTURE_LINEAR_LINEAR=2,Cq.TEXTURE_TRILINEAR_SAMPLINGMODE=3,Cq.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,Cq.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,Cq.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,Cq.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,Cq.TEXTURE_NEAREST_LINEAR=7,Cq.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,Cq.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,Cq.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,Cq.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,Cq.TEXTURE_LINEAR_NEAREST=12,Cq.TEXTURE_EXPLICIT_MODE=0,Cq.TEXTURE_SPHERICAL_MODE=1,Cq.TEXTURE_PLANAR_MODE=2,Cq.TEXTURE_CUBIC_MODE=3,Cq.TEXTURE_PROJECTION_MODE=4,Cq.TEXTURE_SKYBOX_MODE=5,Cq.TEXTURE_INVCUBIC_MODE=6,Cq.TEXTURE_EQUIRECTANGULAR_MODE=7,Cq.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,Cq.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,Cq.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,Cq.TEXTURE_FILTERING_QUALITY_HIGH=64,Cq.TEXTURE_FILTERING_QUALITY_MEDIUM=16,Cq.TEXTURE_FILTERING_QUALITY_LOW=8,Cq.SCALEMODE_FLOOR=1,Cq.SCALEMODE_NEAREST=2,Cq.SCALEMODE_CEILING=3,Cq.MATERIAL_TextureDirtyFlag=1,Cq.MATERIAL_LightDirtyFlag=2,Cq.MATERIAL_FresnelDirtyFlag=4,Cq.MATERIAL_AttributesDirtyFlag=8,Cq.MATERIAL_MiscDirtyFlag=16,Cq.MATERIAL_PrePassDirtyFlag=32,Cq.MATERIAL_AllDirtyFlag=63,Cq.MATERIAL_TriangleFillMode=0,Cq.MATERIAL_WireFrameFillMode=1,Cq.MATERIAL_PointFillMode=2,Cq.MATERIAL_PointListDrawMode=3,Cq.MATERIAL_LineListDrawMode=4,Cq.MATERIAL_LineLoopDrawMode=5,Cq.MATERIAL_LineStripDrawMode=6,Cq.MATERIAL_TriangleStripDrawMode=7,Cq.MATERIAL_TriangleFanDrawMode=8,Cq.MATERIAL_ClockWiseSideOrientation=0,Cq.MATERIAL_CounterClockWiseSideOrientation=1,Cq.ACTION_NothingTrigger=0,Cq.ACTION_OnPickTrigger=1,Cq.ACTION_OnLeftPickTrigger=2,Cq.ACTION_OnRightPickTrigger=3,Cq.ACTION_OnCenterPickTrigger=4,Cq.ACTION_OnPickDownTrigger=5,Cq.ACTION_OnDoublePickTrigger=6,Cq.ACTION_OnPickUpTrigger=7,Cq.ACTION_OnPickOutTrigger=16,Cq.ACTION_OnLongPressTrigger=8,Cq.ACTION_OnPointerOverTrigger=9,Cq.ACTION_OnPointerOutTrigger=10,Cq.ACTION_OnEveryFrameTrigger=11,Cq.ACTION_OnIntersectionEnterTrigger=12,Cq.ACTION_OnIntersectionExitTrigger=13,Cq.ACTION_OnKeyDownTrigger=14,Cq.ACTION_OnKeyUpTrigger=15,Cq.PARTICLES_BILLBOARDMODE_Y=2,Cq.PARTICLES_BILLBOARDMODE_ALL=7,Cq.PARTICLES_BILLBOARDMODE_STRETCHED=8,Cq.PARTICLES_BILLBOARDMODE_STRETCHED_LOCAL=9,Cq.MESHES_CULLINGSTRATEGY_STANDARD=0,Cq.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,Cq.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,Cq.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,Cq.SCENELOADER_NO_LOGGING=0,Cq.SCENELOADER_MINIMAL_LOGGING=1,Cq.SCENELOADER_SUMMARY_LOGGING=2,Cq.SCENELOADER_DETAILED_LOGGING=3,Cq.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,Cq.PREPASS_POSITION_TEXTURE_TYPE=1,Cq.PREPASS_VELOCITY_TEXTURE_TYPE=2,Cq.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,Cq.PREPASS_COLOR_TEXTURE_TYPE=4,Cq.PREPASS_DEPTH_TEXTURE_TYPE=5,Cq.PREPASS_NORMAL_TEXTURE_TYPE=6,Cq.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7,Cq.PREPASS_WORLD_NORMAL_TEXTURE_TYPE=8,Cq.PREPASS_LOCAL_POSITION_TEXTURE_TYPE=9,Cq.PREPASS_SCREENSPACE_DEPTH_TEXTURE_TYPE=10,Cq.PREPASS_VELOCITY_LINEAR_TEXTURE_TYPE=11,Cq.PREPASS_ALBEDO_TEXTURE_TYPE=12,Cq.BUFFER_CREATIONFLAG_READ=1,Cq.BUFFER_CREATIONFLAG_WRITE=2,Cq.BUFFER_CREATIONFLAG_READWRITE=3,Cq.BUFFER_CREATIONFLAG_UNIFORM=4,Cq.BUFFER_CREATIONFLAG_VERTEX=8,Cq.BUFFER_CREATIONFLAG_INDEX=16,Cq.BUFFER_CREATIONFLAG_STORAGE=32,Cq.BUFFER_CREATIONFLAG_INDIRECT=64,Cq.RENDERPASS_MAIN=0,Cq.INPUT_ALT_KEY=18,Cq.INPUT_CTRL_KEY=17,Cq.INPUT_META_KEY1=91,Cq.INPUT_META_KEY2=92,Cq.INPUT_META_KEY3=93,Cq.INPUT_SHIFT_KEY=16,Cq.SNAPSHOTRENDERING_STANDARD=0,Cq.SNAPSHOTRENDERING_FAST=1,Cq.PERSPECTIVE_CAMERA=0,Cq.ORTHOGRAPHIC_CAMERA=1,Cq.FOVMODE_VERTICAL_FIXED=0,Cq.FOVMODE_HORIZONTAL_FIXED=1,Cq.RIG_MODE_NONE=0,Cq.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,Cq.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,Cq.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,Cq.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,Cq.RIG_MODE_STEREOSCOPIC_INTERLACED=14,Cq.RIG_MODE_VR=20,Cq.RIG_MODE_CUSTOM=22,Cq.MAX_SUPPORTED_UV_SETS=6,Cq.GL_ALPHA_EQUATION_ADD=32774,Cq.GL_ALPHA_EQUATION_MIN=32775,Cq.GL_ALPHA_EQUATION_MAX=32776,Cq.GL_ALPHA_EQUATION_SUBTRACT=32778,Cq.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779,Cq.GL_ALPHA_FUNCTION_SRC=768,Cq.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769,Cq.GL_ALPHA_FUNCTION_SRC_ALPHA=770,Cq.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771,Cq.GL_ALPHA_FUNCTION_DST_ALPHA=772,Cq.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773,Cq.GL_ALPHA_FUNCTION_DST_COLOR=774,Cq.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775,Cq.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776,Cq.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769,Cq.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770,Cq.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771,Cq.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772,Cq.GL_ALPHA_FUNCTION_SRC1_COLOR=35065,Cq.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_COLOR=35066,Cq.GL_ALPHA_FUNCTION_SRC1_ALPHA=34185,Cq.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_ALPHA=35067,Cq.SnippetUrl="https://snippet.babylonjs.com",Cq.FOGMODE_NONE=0,Cq.FOGMODE_EXP=1,Cq.FOGMODE_EXP2=2,Cq.FOGMODE_LINEAR=3,Cq.BYTE=5120,Cq.UNSIGNED_BYTE=5121,Cq.SHORT=5122,Cq.UNSIGNED_SHORT=5123,Cq.INT=5124,Cq.UNSIGNED_INT=5125,Cq.FLOAT=5126,Cq.PositionKind="position",Cq.NormalKind="qe",Cq.TangentKind="tangent",Cq.UVKind="uv",Cq.UV2Kind="uv2",Cq.UV3Kind="uv3",Cq.UV4Kind="uv4",Cq.UV5Kind="uv5",Cq.UV6Kind="uv6",Cq.ColorKind="color",Cq.ColorInstanceKind="instanceColor",Cq.MatricesIndicesKind="matricesIndices",Cq.MatricesWeightsKind="matricesWeights",Cq.MatricesIndicesExtraKind="matricesIndicesExtra",Cq.MatricesWeightsExtraKind="matricesWeightsExtra";class Eq{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:Cq.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(q,X){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...Eq._GetDefaultOptions(),...q},this._scene=X,this._scene._transmissionHelper=this,this.onErrorObservable=new R.c,this._scene._d.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(q){if(!Object.keys(q).filter((X=>this._options[X]!==q[X])).length)return;const X={...this._options,...q},Q=this._options;this._options=X,X.renderSize===Q.renderSize&&X.renderTargetTextureType===Q.renderTargetTextureType&&X.generateMipmaps===Q.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=X.samples,this._opaqueRenderTarget.lodGenerationScale=X.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=X.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(q){return!!q&&!!(q instanceof Z&&q.subSurface.isRefractionEnabled)}_addMesh(q){this._materialObservers[q.uniqueId]=q.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),H.f.SetImmediate((()=>{this._shouldRenderAsTransmission(q.material)?(q.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(q)&&this._transparentMeshesCache.push(q)):-1===this._opaqueMeshesCache.indexOf(q)&&this._opaqueMeshesCache.push(q)}))}_removeMesh(q){q.onMaterialChangedObservable.remove(this._materialObservers[q.uniqueId]),delete this._materialObservers[q.uniqueId];let X=this._transparentMeshesCache.indexOf(q);-1!==X&&this._transparentMeshesCache.splice(X,1),X=this._opaqueMeshesCache.indexOf(q),-1!==X&&this._opaqueMeshesCache.splice(X,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(q){const X=this._transparentMeshesCache.indexOf(q),Q=this._opaqueMeshesCache.indexOf(q);this._shouldRenderAsTransmission(q.material)?(q.material instanceof Z&&(q.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==Q?(this._opaqueMeshesCache.splice(Q,1),this._transparentMeshesCache.push(q)):-1===X&&this._transparentMeshesCache.push(q)):-1!==X?(this._transparentMeshesCache.splice(X,1),this._opaqueMeshesCache.push(q)):-1===Q&&this._opaqueMeshesCache.push(q)}_isRenderTargetValid(){var q;return null!==(null===(q=this._opaqueRenderTarget)||void 0===q?void 0:q.getInternalTexture())}_setupRenderTargets(){var q;let X,Q;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new Gq.c("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(q=this._options.clearColor)||void 0===q?void 0:q.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((q=>{Q=this._scene.environmentIntensity,this._scene.environmentIntensity=1,X=this._scene.imageProcessingConfiguration.applyByPostProcess,this._options.clearColor?q.clearColor.p(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(q.clearColor,this._scene.getEngine().useExactSrgbConversions),this._scene.imageProcessingConfiguration._applyByPostProcess=!0})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=Q,this._scene.imageProcessingConfiguration._applyByPostProcess=X})),this._transparentMeshesCache.forEach((q=>{this._shouldRenderAsTransmission(q.material)&&(q.material.refractionTexture=this._opaqueRenderTarget)}))}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const Jq="KHR_materials_transmission";class nq{constructor(q){this.name=Jq,this.order=175,this._loader=q,this.enabled=this._loader.isExtensionUsed(Jq),this.enabled&&(q.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,X,Q){return r.LoadExtensionAsync(q,X,this.name,((y,x)=>{const u=new Array;return u.push(this._loader.loadMaterialPropertiesAsync(q,X,Q)),u.push(this._loadTransparentPropertiesAsync(y,X,Q,x)),Promise.all(u).then((()=>{}))}))}_loadTransparentPropertiesAsync(q,X,Q,y){if(!(Q instanceof Z))throw new Error(`${q}: Material type not supported`);const x=Q;if(x.subSurface.isRefractionEnabled=!0,x.subSurface.volumeIndexOfRefraction=1,x.subSurface.useAlbedoToTintRefraction=!0,void 0===y.transmissionFactor)return x.subSurface.refractionIntensity=0,x.subSurface.isRefractionEnabled=!1,Promise.resolve();{var u;x.subSurface.refractionIntensity=y.transmissionFactor;const q=x.va();if(x.subSurface.refractionIntensity&&!q._transmissionHelper)new Eq({},x.va());else if(x.subSurface.refractionIntensity&&(null===(u=q._transmissionHelper)||void 0===u||!u._isRenderTargetValid())){var H;null===(H=q._transmissionHelper)||void 0===H||H._setupRenderTargets()}}return x.subSurface.minimumThickness=0,x.subSurface.maximumThickness=0,y.transmissionTexture?(y.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${q}/transmissionTexture`,y.transmissionTexture,void 0).then((q=>{q.name=`${Q.name} (Transmission)`,x.subSurface.refractionIntensityTexture=q,x.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}E(Jq),C(Jq,!0,(q=>new nq(q)));const rq="KHR_materials_diffuse_transmission";class sq{constructor(q){this.name=rq,this.order=174,this._loader=q,this.enabled=this._loader.isExtensionUsed(rq),this.enabled&&(q.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,X,Q){return r.LoadExtensionAsync(q,X,this.name,((y,x)=>{const u=new Array;return u.push(this._loader.loadMaterialPropertiesAsync(q,X,Q)),u.push(this._loadTranslucentPropertiesAsync(y,X,Q,x)),Promise.all(u).then((()=>{}))}))}_loadTranslucentPropertiesAsync(q,X,Q,y){if(!(Q instanceof Z))throw new Error(`${q}: Material type not supported`);const x=Q;if(x.subSurface.isTranslucencyEnabled=!0,x.subSurface.volumeIndexOfRefraction=1,x.subSurface.minimumThickness=0,x.subSurface.maximumThickness=0,x.subSurface.useAlbedoToTintTranslucency=!1,void 0===y.diffuseTransmissionFactor)return x.subSurface.translucencyIntensity=0,x.subSurface.isTranslucencyEnabled=!1,Promise.resolve();x.subSurface.translucencyIntensity=y.diffuseTransmissionFactor;const H=new Array;return x.subSurface.useGltfStyleTextures=!0,y.diffuseTransmissionTexture&&(y.diffuseTransmissionTexture.nonColorData=!0,H.push(this._loader.loadTextureInfoAsync(`${q}/diffuseTransmissionTexture`,y.diffuseTransmissionTexture).then((q=>{q.name=`${Q.name} (Diffuse Transmission)`,x.subSurface.translucencyIntensityTexture=q})))),void 0!==y.diffuseTransmissionColorFactor?x.subSurface.translucencyColor=u.b.Rd(y.diffuseTransmissionColorFactor):x.subSurface.translucencyColor=u.b.White(),y.diffuseTransmissionColorTexture&&H.push(this._loader.loadTextureInfoAsync(`${q}/diffuseTransmissionColorTexture`,y.diffuseTransmissionColorTexture).then((q=>{q.name=`${Q.name} (Diffuse Transmission Color)`,x.subSurface.translucencyColorTexture=q}))),Promise.all(H).then((()=>{}))}}E(rq),C(rq,!0,(q=>new sq(q)));const Tq="KHR_materials_volume";class qX{constructor(q){this.name=Tq,this.order=173,this._loader=q,this.enabled=this._loader.isExtensionUsed(Tq),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(q,X,Q){return r.LoadExtensionAsync(q,X,this.name,((y,x)=>{const u=new Array;return u.push(this._loader.loadMaterialPropertiesAsync(q,X,Q)),u.push(this._loadVolumePropertiesAsync(y,X,Q,x)),Promise.all(u).then((()=>{}))}))}_loadVolumePropertiesAsync(q,X,Q,y){if(!(Q instanceof Z))throw new Error(`${q}: Material type not supported`);if(!Q.subSurface.isRefractionEnabled&&!Q.subSurface.isTranslucencyEnabled||!y.thicknessFactor)return Promise.resolve();Q.subSurface.volumeIndexOfRefraction=Q.indexOfRefraction;const x=void 0!==y.attenuationDistance?y.attenuationDistance:Number.MAX_VALUE;return Q.subSurface.tintColorAtDistance=x,void 0!==y.attenuationColor&&3==y.attenuationColor.length&&Q.subSurface.tintColor.Pd(y.attenuationColor[0],y.attenuationColor[1],y.attenuationColor[2]),Q.subSurface.minimumThickness=0,Q.subSurface.maximumThickness=y.thicknessFactor,Q.subSurface.useThicknessAsDepth=!0,y.thicknessTexture?(y.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${q}/thicknessTexture`,y.thicknessTexture).then((q=>{q.name=`${Q.name} (Thickness)`,Q.subSurface.thicknessTexture=q,Q.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}E(Tq),C(Tq,!0,(q=>new qX(q)));const XX="KHR_materials_dispersion";class QX{constructor(q){this.name=XX,this.order=174,this._loader=q,this.enabled=this._loader.isExtensionUsed(XX)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,X,Q){return r.LoadExtensionAsync(q,X,this.name,((y,x)=>{const u=new Array;return u.push(this._loader.loadMaterialPropertiesAsync(q,X,Q)),u.push(this._loadDispersionPropertiesAsync(y,X,Q,x)),Promise.all(u).then((()=>{}))}))}_loadDispersionPropertiesAsync(q,X,Q,y){if(!(Q instanceof Z))throw new Error(`${q}: Material type not supported`);return Q.subSurface.isRefractionEnabled&&y.dispersion?(Q.subSurface.isDispersionEnabled=!0,Q.subSurface.dispersion=y.dispersion,Promise.resolve()):Promise.resolve()}}E(XX),C(XX,!0,(q=>new QX(q)));const yX="KHR_mesh_quantization";class xX{constructor(q){this.name=yX,this.enabled=q.isExtensionUsed(yX)}dispose(){}}E(yX),C(yX,!0,(q=>new xX(q)));const uX="KHR_texture_basisu";class HX{constructor(q){this.name=uX,this._loader=q,this.enabled=q.isExtensionUsed(uX)}dispose(){this._loader=null}_loadTextureAsync(q,X,Q){return r.LoadExtensionAsync(q,X,this.name,((y,x)=>{const u=void 0==X.sampler?r.DefaultSampler:n.Get(`${q}/sampler`,this._loader.Wi.samplers,X.sampler),H=n.Get(`${y}/source`,this._loader.Wi.images,x.source);return this._loader._createTextureAsync(q,u,H,(q=>{Q(q)}),X._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!X._textureInfo.nonColorData)}))}}E(uX),C(uX,!0,(q=>new HX(q)));const bX="KHR_texture_transform";class DX{constructor(q){this.name=bX,this._loader=q,this.enabled=this._loader.isExtensionUsed(bX)}dispose(){this._loader=null}loadTextureInfoAsync(q,X,Q){return r.LoadExtensionAsync(q,X,this.name,((y,x)=>this._loader.loadTextureInfoAsync(q,X,(q=>{if(!(q instanceof U.d))throw new Error(`${y}: Texture type not supported`);x.offset&&(q.uOffset=x.offset[0],q.vOffset=x.offset[1]),q.uRotationCenter=0,q.vRotationCenter=0,x.rotation&&(q.wAng=-x.rotation),x.scale&&(q.uScale=x.scale[0],q.vScale=x.scale[1]),void 0!=x.texCoord&&(q.coordinatesIndex=x.texCoord),Q(q)}))))}}E(bX),C(bX,!0,(q=>new DX(q)));const aX="KHR_xmp_json_ld";class RX{constructor(q){this.name=aX,this.order=100,this._loader=q,this.enabled=this._loader.isExtensionUsed(aX)}dispose(){this._loader=null}onLoading(){var q,X,Q;if(null===this._loader.rootBabylonMesh)return;const y=null===(q=this._loader.Wi.extensions)||void 0===q?void 0:q.KHR_xmp_json_ld,x=null===(X=this._loader.Wi.asset)||void 0===X||null===(Q=X.extensions)||void 0===Q?void 0:Q.KHR_xmp_json_ld;if(y&&x){const q=+x.packet;y.packets&&q<y.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=y.packets[q])}}}function LX(q,X,Q,y){return u.b.Rd(X,Q).scale(y)}function fX(q,X,Q,y){return X[Q]*y}function kX(q,X,Q,y){return-X[Q]*y}function jX(q,X,Q,y){return X[Q+1]*y}function IX(q,X,Q,y){return X[Q]*y*2}function dX(q){return{scale:[new iX(f.e.ANIMATIONTYPE_FLOAT,`${q}.uScale`,fX,(()=>2)),new iX(f.e.ANIMATIONTYPE_FLOAT,`${q}.vScale`,jX,(()=>2))],offset:[new iX(f.e.ANIMATIONTYPE_FLOAT,`${q}.uOffset`,fX,(()=>2)),new iX(f.e.ANIMATIONTYPE_FLOAT,`${q}.vOffset`,jX,(()=>2))],rotation:[new iX(f.e.ANIMATIONTYPE_FLOAT,`${q}.wAng`,kX,(()=>1))]}}E(aX),C(aX,!0,(q=>new RX(q)));class eX extends t{buildAnimations(q,X,Q,y,x){x(q._babylonCamera,this._buildAnimation(X,Q,y))}}class iX extends t{buildAnimations(q,X,Q,y,x){for(const u in q._data)x(q._data[u].babylonMaterial,this._buildAnimation(X,Q,y))}}class AX extends t{buildAnimations(q,X,Q,y,x){x(q._babylonLight,this._buildAnimation(X,Q,y))}}const BX={__array__:{__target__:!0,...K}},wX={__array__:{__target__:!0,orthographic:{xmag:[new eX(f.e.ANIMATIONTYPE_FLOAT,"orthoLeft",kX,(()=>1)),new eX(f.e.ANIMATIONTYPE_FLOAT,"orthoRight",jX,(()=>1))],ymag:[new eX(f.e.ANIMATIONTYPE_FLOAT,"orthoBottom",kX,(()=>1)),new eX(f.e.ANIMATIONTYPE_FLOAT,"orthoTop",jX,(()=>1))],zfar:[new eX(f.e.ANIMATIONTYPE_FLOAT,"maxZ",fX,(()=>1))],znear:[new eX(f.e.ANIMATIONTYPE_FLOAT,"_i",fX,(()=>1))]},perspective:{yfov:[new eX(f.e.ANIMATIONTYPE_FLOAT,"fov",fX,(()=>1))],zfar:[new eX(f.e.ANIMATIONTYPE_FLOAT,"maxZ",fX,(()=>1))],znear:[new eX(f.e.ANIMATIONTYPE_FLOAT,"_i",fX,(()=>1))]}}},VX={nodes:BX,materials:{__array__:{__target__:!0,pbrMetallicRoughness:{baseColorFactor:[new iX(f.e.ANIMATIONTYPE_COLOR3,"albedoColor",LX,(()=>4)),new iX(f.e.ANIMATIONTYPE_FLOAT,"alpha",(function(q,X,Q,y){return X[Q+3]*y}),(()=>4))],metallicFactor:[new iX(f.e.ANIMATIONTYPE_FLOAT,"metallic",fX,(()=>1))],roughnessFactor:[new iX(f.e.ANIMATIONTYPE_FLOAT,"roughness",fX,(()=>1))],baseColorTexture:{extensions:{KHR_texture_transform:dX("albedoTexture")}},metallicRoughnessTexture:{extensions:{KHR_texture_transform:dX("metallicTexture")}}},emissiveFactor:[new iX(f.e.ANIMATIONTYPE_COLOR3,"emissiveColor",LX,(()=>3))],normalTexture:{scale:[new iX(f.e.ANIMATIONTYPE_FLOAT,"bumpTexture.level",fX,(()=>1))],extensions:{KHR_texture_transform:dX("bumpTexture")}},occlusionTexture:{strength:[new iX(f.e.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",fX,(()=>1))],extensions:{KHR_texture_transform:dX("ambientTexture")}},emissiveTexture:{extensions:{KHR_texture_transform:dX("emissiveTexture")}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:[new iX(f.e.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",fX,(()=>1))],anisotropyRotation:[new iX(f.e.ANIMATIONTYPE_FLOAT,"anisotropy.angle",fX,(()=>1))],anisotropyTexture:{extensions:{KHR_texture_transform:dX("anisotropy.texture")}}},KHR_materials_clearcoat:{clearcoatFactor:[new iX(f.e.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",fX,(()=>1))],clearcoatRoughnessFactor:[new iX(f.e.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",fX,(()=>1))],clearcoatTexture:{extensions:{KHR_texture_transform:dX("clearCoat.texture")}},clearcoatNormalTexture:{scale:[new iX(f.e.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",fX,(()=>1))],extensions:{KHR_texture_transform:dX("clearCoat.bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:dX("clearCoat.textureRoughness")}}},KHR_materials_dispersion:{dispersion:[new iX(f.e.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",fX,(()=>1))]},KHR_materials_emissive_strength:{emissiveStrength:[new iX(f.e.ANIMATIONTYPE_FLOAT,"emissiveIntensity",fX,(()=>1))]},KHR_materials_ior:{ior:[new iX(f.e.ANIMATIONTYPE_FLOAT,"indexOfRefraction",fX,(()=>1))]},KHR_materials_iridescence:{iridescenceFactor:[new iX(f.e.ANIMATIONTYPE_FLOAT,"iridescence.intensity",fX,(()=>1))],iridescenceIor:[new iX(f.e.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",fX,(()=>1))],iridescenceThicknessMinimum:[new iX(f.e.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",fX,(()=>1))],iridescenceThicknessMaximum:[new iX(f.e.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",fX,(()=>1))],iridescenceTexture:{extensions:{KHR_texture_transform:dX("iridescence.texture")}},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:dX("iridescence.thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:[new iX(f.e.ANIMATIONTYPE_COLOR3,"sheen.color",LX,(()=>3))],sheenRoughnessFactor:[new iX(f.e.ANIMATIONTYPE_FLOAT,"sheen.roughness",fX,(()=>1))],sheenColorTexture:{extensions:{KHR_texture_transform:dX("sheen.texture")}},sheenRoughnessTexture:{extensions:{KHR_texture_transform:dX("sheen.textureRoughness")}}},KHR_materials_specular:{specularFactor:[new iX(f.e.ANIMATIONTYPE_FLOAT,"metallicF0Factor",fX,(()=>1))],specularColorFactor:[new iX(f.e.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",LX,(()=>3))],specularTexture:{extensions:{KHR_texture_transform:dX("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:dX("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:[new iX(f.e.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",fX,(()=>1))],transmissionTexture:{extensions:{KHR_texture_transform:dX("subSurface.refractionIntensityTexture")}}},KHR_materials_volume:{attenuationColor:[new iX(f.e.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",LX,(()=>3))],attenuationDistance:[new iX(f.e.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",fX,(()=>1))],thicknessFactor:[new iX(f.e.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",fX,(()=>1))],thicknessTexture:{extensions:{KHR_texture_transform:dX("subSurface.thicknessTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:[new iX(f.e.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",fX,(()=>1))],diffuseTransmissionTexture:{extensions:{KHR_texture_transform:dX("subSurface.translucencyIntensityTexture")}},diffuseTransmissionColorFactor:[new iX(f.e.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",LX,(()=>3))],diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:dX("subSurface.translucencyColorTexture")}}}}}},cameras:wX,extensions:{KHR_lights_punctual:{lights:{__array__:{__target__:!0,color:[new AX(f.e.ANIMATIONTYPE_COLOR3,"diffuse",LX,(()=>3))],dj:[new AX(f.e.ANIMATIONTYPE_FLOAT,"intensity",fX,(()=>1))],range:[new AX(f.e.ANIMATIONTYPE_FLOAT,"range",fX,(()=>1))],spot:{innerConeAngle:[new AX(f.e.ANIMATIONTYPE_FLOAT,"innerAngle",IX,(()=>1))],outerConeAngle:[new AX(f.e.ANIMATIONTYPE_FLOAT,"angle",IX,(()=>1))]}}}}}};class WX{constructor(q,X){this._gltf=q,this._infoTree=X}convert(q){let X,Q=this._gltf,y=this._infoTree;if(!q.startsWith("/"))throw new Error("Path must start with a /");const x=q.split("/");x.shift();for(const u of x){if(y.__array__)y=y.__array__;else if(y=y[u],!y)throw new Error(`Path ${q} is invalid`);if(void 0===Q)throw new Error(`Path ${q} is invalid`);Q=Q[u],y.__target__&&(X=Q)}return{object:X,info:y}}}const vX="KHR_animation_pointer";class ZX extends WX{constructor(q){super(q,VX)}}class UX{constructor(q){this.name=vX,this._loader=q,this._pathToObjectConverter=new ZX(this._loader.Wi)}get enabled(){return this._loader.isExtensionUsed(vX)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(q,X,Q,y,x){var u;const H=null===(u=y.target.extensions)||void 0===u?void 0:u.KHR_animation_pointer;if(!H||!this._pathToObjectConverter)return null;"pointer"!==y.target.path&&I.b.Warn(`${q}/target/path: Value (${y.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=y.target.node&&I.b.Warn(`${q}/target/node: Value (${y.target.node}) must not be present when using the ${this.name} extension`);const b=`${q}/extensions/${this.name}`,D=H.pointer;if(!D)throw new Error(`${b}: Pointer is missing`);try{const u=this._pathToObjectConverter.convert(D);return this._loader._loadAnimationChannelFromTargetInfoAsync(q,X,Q,y,u,x)}catch(a){return I.b.Warn(`${b}/pointer: Invalid pointer (${D}) skipped`),null}}}E(vX),C(vX,!0,(q=>new UX(q)));class OX{constructor(q,X,Q){this.frame=q,this.action=X,this.onlyOnce=Q,this.isDone=!1}_clone(){return new OX(this.frame,this.action,this.onlyOnce)}}var gX=Q(1081),PX=Q(1105);class FX{get loop(){return this._loop}set loop(q){q!==this._loop&&(this._loop=q,this.updateOptions({loop:q}))}get currentTime(){var q;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(q=PX.e.audioEngine)&&void 0!==q&&q.audioContext&&(this.isPlaying||this.isPaused)){const q=this.isPaused?0:PX.e.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+q}return 0}get spatialSound(){return this._spatialSound}set spatialSound(q){if(q==this._spatialSound)return;const X=this.isPlaying;this.pause(),q?(this._spatialSound=q,this._updateSpatialParameters()):this._disableSpatialSound(),X&&this.play()}constructor(q,X,Q){var y;let u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,b=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new R.c,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=x.n.Zero(),this._localDirection=new x.n(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=q,Q=Q||j.c.LastCreatedScene)if(this._scene=Q,FX._SceneComponentInitialization(Q),this._readyToPlayCallback=u,this._customAttenuationFunction=(q,X,Q,y,x)=>X<Q?q*(1-X/Q):0,b&&(this.autoplay=b.autoplay||!1,this._loop=b.loop||!1,void 0!==b.volume&&(this._volume=b.volume),this._spatialSound=b.spatialSound??!1,this.maxDistance=b.maxDistance??100,this.useCustomAttenuation=b.useCustomAttenuation??!1,this.rolloffFactor=b.rolloffFactor||1,this.refDistance=b.refDistance||1,this.distanceModel=b.distanceModel||"linear",this._playbackRate=b.playbackRate||1,this._streaming=b.streaming??!1,this._length=b.length,this._offset=b.offset),null!==(y=PX.e.audioEngine)&&void 0!==y&&y.canUseWebAudio&&PX.e.audioEngine.audioContext){this._soundGain=PX.e.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let q=!0;if(X)try{"string"===typeof X?(this._urlType="String",this._url=X):X instanceof ArrayBuffer?this._urlType="ArrayBuffer":X instanceof HTMLMediaElement?this._urlType="MediaElement":X instanceof MediaStream?this._urlType="MediaStream":X instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(X)&&(this._urlType="Array");let Q=[],y=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=PX.e.audioEngine.audioContext.createMediaElementSource(X),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=PX.e.audioEngine.audioContext.createMediaStreamSource(X),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":X.byteLength>0&&(y=!0,this._soundLoaded(X));break;case"AudioBuffer":this._audioBufferLoaded(X);break;case"String":Q.push(X);case"Array":0===Q.length&&(Q=X);for(let q=0;q<Q.length;q++){const X=Q[q];if(y=b&&b.skipCodecCheck||-1!==X.indexOf(".mp3",X.length-4)&&PX.e.audioEngine.isMP3supported||-1!==X.indexOf(".ogg",X.length-4)&&PX.e.audioEngine.isOGGsupported||-1!==X.indexOf(".wav",X.length-4)||-1!==X.indexOf(".m4a",X.length-4)||-1!==X.indexOf(".mp4",X.length-4)||-1!==X.indexOf("blob:"),y){this._streaming?(this._htmlAudioElement=new Audio(X),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,H.f.SetCorsBehavior(X,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(X,(q=>{this._soundLoaded(q)}),void 0,!0,!0,(q=>{q&&I.b.Error("XHR "+q.status+" error on: "+X+"."),I.b.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:q=!1}q?y||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):I.b.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(D){I.b.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),PX.e.audioEngine&&!PX.e.audioEngine.WarnedWebAudioUnsupported&&(I.b.Error("Web Audio is not supported by your browser."),PX.e.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var q;null!==(q=PX.e.audioEngine)&&void 0!==q&&q.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(q){var X;null!==(X=PX.e.audioEngine)&&void 0!==X&&X.audioContext&&(this._audioBuffer=q,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(q){var X;null!==(X=PX.e.audioEngine)&&void 0!==X&&X.audioContext&&PX.e.audioEngine.audioContext.decodeAudioData(q,(q=>{this._audioBufferLoaded(q)}),(q=>{I.b.Error("Error while decoding audio data for: "+this.name+" / Error: "+q)}))}setAudioBuffer(q){var X;null!==(X=PX.e.audioEngine)&&void 0!==X&&X.canUseWebAudio&&(this._audioBuffer=q,this._isReadyToPlay=!0)}updateOptions(q){q&&(this.loop=q.loop??this.loop,this.maxDistance=q.maxDistance??this.maxDistance,this.useCustomAttenuation=q.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=q.rolloffFactor??this.rolloffFactor,this.refDistance=q.refDistance??this.refDistance,this.distanceModel=q.distanceModel??this.distanceModel,this._playbackRate=q.playbackRate??this._playbackRate,this._length=q.length??void 0,this.spatialSound=q.spatialSound??this._spatialSound,this._setOffset(q.offset??void 0),this.setVolume(q.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var q;null!==(q=PX.e.audioEngine)&&void 0!==q&&q.canUseWebAudio&&PX.e.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??PX.e.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var q;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(q=this._soundPanner)||void 0===q||q.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var q;null!==(q=PX.e.audioEngine)&&void 0!==q&&q.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(q){var X;null!==(X=PX.e.audioEngine)&&void 0!==X&&X.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(q),this._isOutputConnected=!0)}setDirectionalCone(q,X,Q){X<q?I.b.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=q,this._coneOuterAngle=X,this._coneOuterGain=Q,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(q){if(q!=this._coneInnerAngle){var X;if(this._coneOuterAngle<q)return void I.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=q,null!==(X=PX.e.audioEngine)&&void 0!==X&&X.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(q){if(q!=this._coneOuterAngle){var X;if(q<this._coneInnerAngle)return void I.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=q,null!==(X=PX.e.audioEngine)&&void 0!==X&&X.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(q){var X;q.equals(this._position)||(this._position.p(q),null!==(X=PX.e.audioEngine)&&void 0!==X&&X.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(q){var X;this._localDirection=q,null!==(X=PX.e.audioEngine)&&void 0!==X&&X.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const q=this._connectedTransformNode.getWorldMatrix(),X=x.n.TransformNormal(this._localDirection,q);X.normalize(),this._soundPanner.orientationX.value=X.x,this._soundPanner.orientationY.value=X.y,this._soundPanner.orientationZ.value=X.z}updateDistanceFromListener(){var q;if(null!==(q=PX.e.audioEngine)&&void 0!==q&&q.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const q=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.Sc(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,q,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(q){this._customAttenuationFunction=q}play(q,X,Q){var y;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(y=PX.e.audioEngine)&&void 0!==y&&y.audioContext)try{var x,u;this._clearTimeoutsAndObservers();let y=q?(null===(x=PX.e.audioEngine)||void 0===x?void 0:x.audioContext.currentTime)+q:null===(u=PX.e.audioEngine)||void 0===u?void 0:u.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=PX.e.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const q=()=>{var Q;if(null!==(Q=PX.e.audioEngine)&&void 0!==Q&&Q.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=X??0;const Q=this._htmlAudioElement.play();void 0!==Q&&Q.catch((()=>{var X,Q;(null===(X=PX.e.audioEngine)||void 0===X||X.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(Q=PX.e.audioEngine)||void 0===Q?void 0:Q.onAudioUnlockedObservable.addOnce((()=>{q()})))}))}else{var y;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(y=PX.e.audioEngine)||void 0===y?void 0:y.onAudioUnlockedObservable.addOnce((()=>{q()}))}};q()}}else{var H;const x=()=>{var x;if(null!==(x=PX.e.audioEngine)&&void 0!==x&&x.audioContext){var u;if(Q=Q||this._length,void 0!==X&&this._setOffset(X),this._soundSource){const q=this._soundSource;q.onended=()=>{q.disconnect()}}if(this._soundSource=null===(u=PX.e.audioEngine)||void 0===u?void 0:u.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var H;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==X&&(this._soundSource.loopStart=X),void 0!==Q&&(this._soundSource.loopEnd=(0|X)+Q),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},y=q?(null===(H=PX.e.audioEngine)||void 0===H?void 0:H.audioContext.currentTime)+q:PX.e.audioEngine.audioContext.currentTime;const x=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(y,x,this.loop?void 0:Q)}}};"suspended"===(null===(H=PX.e.audioEngine)||void 0===H?void 0:H.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var q;"suspended"===(null===(q=PX.e.audioEngine)||void 0===q?void 0:q.audioContext.state)?(PX.e.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=PX.e.audioEngine.onAudioUnlockedObservable.addOnce((()=>{x()})))):x()}),500):x()}this._startTime=y,this.isPlaying=!0,this.isPaused=!1}catch(b){I.b.Error("Error while trying to play audio: "+this.name+", "+b.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(q){var X;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var Q;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(Q=this._streamingSource)||void 0===Q||Q.disconnect();this.isPlaying=!1}else if(null!==(X=PX.e.audioEngine)&&void 0!==X&&X.audioContext&&this._soundSource){const X=q?PX.e.audioEngine.audioContext.currentTime+q:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(X)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var q;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var X;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(X=this._streamingSource)||void 0===X||X.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(q=PX.e.audioEngine)&&void 0!==q&&q.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=PX.e.audioEngine.audioContext.currentTime-this._startTime)}setVolume(q,X){var Q;null!==(Q=PX.e.audioEngine)&&void 0!==Q&&Q.canUseWebAudio&&this._soundGain&&(X&&PX.e.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(PX.e.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,PX.e.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(q,PX.e.audioEngine.audioContext.currentTime+X)):this._soundGain.gain.value=q),this._volume=q}setPlaybackRate(q){this._playbackRate=q,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(q){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=q,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=q=>this._onRegisterAfterWorldMatrixUpdate(q),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(q){var X;if(q.getBoundingInfo){const X=q.getBoundingInfo();this.setPosition(X.boundingSphere.centerWorld)}else this.setPosition(q.absolutePosition);null!==(X=PX.e.audioEngine)&&void 0!==X&&X.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const q=()=>{this._isReadyToPlay?(Q._audioBuffer=this.getAudioBuffer(),Q._isReadyToPlay=!0,Q.autoplay&&Q.play(0,this._offset,this._length)):setTimeout(q,300)},X={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},Q=new FX(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,X);return this.useCustomAttenuation&&Q.setAttenuationFunction(this._customAttenuationFunction),Q.setPosition(this._position),Q.setPlaybackRate(this._playbackRate),q(),Q}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const q={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(q.connectedMeshId=this._connectedTransformNode.id),q.position=this._position.ee(),q.refDistance=this.refDistance,q.distanceModel=this.distanceModel,q.isDirectional=this._isDirectional,q.localDirectionToMesh=this._localDirection.ee(),q.coneInnerAngle=this._coneInnerAngle,q.coneOuterAngle=this._coneOuterAngle,q.coneOuterGain=this._coneOuterGain),q}static Parse(q,X,Q,y){const u=q.name;let H;H=q.url?Q+q.url:Q+u;const b={autoplay:q.autoplay,loop:q.loop,volume:q.volume,spatialSound:q.spatialSound,maxDistance:q.maxDistance,rolloffFactor:q.rolloffFactor,refDistance:q.refDistance,distanceModel:q.distanceModel,playbackRate:q.playbackRate};let D;if(y){const q=()=>{y._isReadyToPlay?(D._audioBuffer=y.getAudioBuffer(),D._isReadyToPlay=!0,D.autoplay&&D.play(0,D._offset,D._length)):setTimeout(q,300)};D=new FX(u,new ArrayBuffer(0),X,null,b),q()}else D=new FX(u,H,X,(()=>{X.removePendingData(D)}),b),X.addPendingData(D);if(q.position){const X=x.n.Rd(q.position);D.setPosition(X)}if(q.isDirectional&&(D.setDirectionalCone(q.coneInnerAngle||360,q.coneOuterAngle||360,q.coneOuterGain||0),q.localDirectionToMesh)){const X=x.n.Rd(q.localDirectionToMesh);D.setLocalDirectionToMesh(X)}if(q.connectedMeshId){const Q=X.getMeshById(q.connectedMeshId);Q&&D.attachToMesh(Q)}return q.metadata&&(D.metadata=q.metadata),D}_setOffset(q){this._offset!==q&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=q)}_clearTimeoutsAndObservers(){var q;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(q=PX.e.audioEngine)||void 0===q||q.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}FX._SceneComponentInitialization=q=>{throw(0,gX.c)("AudioSceneComponent")},(0,W.h)("BABYLON.Sound",FX);class lX{constructor(q,X,Q){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],X.length!==Q.length)throw new Error("Sounds length does not equal weights length");this.loop=q,this._weights=Q;let y=0;for(const u of Q)y+=u;const x=y>0?1/y:0;for(let u=0;u<this._weights.length;u++)this._weights[u]*=x;this._sounds=X;for(const u of this._sounds)u.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(q){if(q!==this._coneInnerAngle){if(this._coneOuterAngle<q)return void I.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=q;for(const X of this._sounds)X.directionalConeInnerAngle=q}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(q){if(q!==this._coneOuterAngle){if(q<this._coneInnerAngle)return void I.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=q;for(const X of this._sounds)X.directionalConeOuterAngle=q}}get volume(){return this._volume}set volume(q){if(q!==this._volume)for(const X of this._sounds)X.setVolume(q)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(q){if(!this.isPaused){this.stop();const q=Math.random();let X=0;for(let Q=0;Q<this._weights.length;Q++)if(X+=this._weights[Q],q<=X){this._currentIndex=Q;break}}const X=this._sounds[this._currentIndex??0];X.isReady()?X.play(0,this.isPaused?void 0:q):X.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class mX{constructor(q){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(q=q||j.c.LastCreatedScene)&&(this._scene=q,this.soundCollection=[],this._options=X,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var q;null!==(q=PX.e.audioEngine)&&void 0!==q&&q.canUseWebAudio&&PX.e.audioEngine.audioContext&&(this._outputAudioNode=PX.e.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(PX.e.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(PX.e.audioEngine&&PX.e.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(q){var X;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(X=PX.e.audioEngine)&&void 0!==X&&X.canUseWebAudio&&this._outputAudioNode&&q.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==q.soundTrackId&&(-1===q.soundTrackId?this._scene.mainSoundTrack.removeSound(q):this._scene.soundTracks&&this._scene.soundTracks[q.soundTrackId].removeSound(q)),this.soundCollection.push(q),q.soundTrackId=this.id}removeSound(q){const X=this.soundCollection.indexOf(q);-1!==X&&this.soundCollection.splice(X,1)}setVolume(q){var X;null!==(X=PX.e.audioEngine)&&void 0!==X&&X.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=q)}switchPanningModelToHRTF(){var q;if(null!==(q=PX.e.audioEngine)&&void 0!==q&&q.canUseWebAudio)for(let X=0;X<this.soundCollection.length;X++)this.soundCollection[X].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var q;if(null!==(q=PX.e.audioEngine)&&void 0!==q&&q.canUseWebAudio)for(let X=0;X<this.soundCollection.length;X++)this.soundCollection[X].switchPanningModelToEqualPower()}connectToAnalyser(q){var X;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=q,null!==(X=PX.e.audioEngine)&&void 0!==X&&X.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,PX.e.audioEngine.masterGain))}}var MX=Q(1285),oX=Q(1206),YX=(Q(1560),Q(1141));(0,Q(11418).f)(MX.c.NAME_AUDIO,((q,X,Q,y)=>{let x,u=[];if(Q.Te=Q.Te||[],void 0!==q.Te&&null!==q.Te)for(let b=0,D=q.Te.length;b<D;b++){var H;const D=q.Te[b];null!==(H=PX.e.audioEngine)&&void 0!==H&&H.canUseWebAudio?(D.url||(D.url=D.name),u[D.url]?Q.Te.push(FX.Parse(D,X,y,u[D.url])):(x=FX.Parse(D,X,y),u[D.url]=x,Q.Te.push(x))):Q.Te.push(new FX(D.name,null,X))}u=[]})),Object.defineProperty(oX.d.prototype,"mainSoundTrack",{get:function(){let q=this._getComponent(MX.c.NAME_AUDIO);return q||(q=new NX(this),this.Se(q)),this._mainSoundTrack||(this._mainSoundTrack=new mX(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),oX.d.prototype.getSoundByName=function(q){let X;for(X=0;X<this.mainSoundTrack.soundCollection.length;X++)if(this.mainSoundTrack.soundCollection[X].name===q)return this.mainSoundTrack.soundCollection[X];if(this.soundTracks)for(let Q=0;Q<this.soundTracks.length;Q++)for(X=0;X<this.soundTracks[Q].soundCollection.length;X++)if(this.soundTracks[Q].soundCollection[X].name===q)return this.soundTracks[Q].soundCollection[X];return null},Object.defineProperty(oX.d.prototype,"audioEnabled",{get:function(){let q=this._getComponent(MX.c.NAME_AUDIO);return q||(q=new NX(this),this.Se(q)),q.audioEnabled},set:function(q){let X=this._getComponent(MX.c.NAME_AUDIO);X||(X=new NX(this),this.Se(X)),q?X.enableAudio():X.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(oX.d.prototype,"headphone",{get:function(){let q=this._getComponent(MX.c.NAME_AUDIO);return q||(q=new NX(this),this.Se(q)),q.headphone},set:function(q){let X=this._getComponent(MX.c.NAME_AUDIO);X||(X=new NX(this),this.Se(X)),q?X.switchAudioModeForHeadphones():X.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(oX.d.prototype,"audioListenerPositionProvider",{get:function(){let q=this._getComponent(MX.c.NAME_AUDIO);return q||(q=new NX(this),this.Se(q)),q.audioListenerPositionProvider},set:function(q){let X=this._getComponent(MX.c.NAME_AUDIO);if(X||(X=new NX(this),this.Se(X)),q&&"function"!==typeof q)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");X.audioListenerPositionProvider=q},enumerable:!0,configurable:!0}),Object.defineProperty(oX.d.prototype,"audioListenerRotationProvider",{get:function(){let q=this._getComponent(MX.c.NAME_AUDIO);return q||(q=new NX(this),this.Se(q)),q.audioListenerRotationProvider},set:function(q){let X=this._getComponent(MX.c.NAME_AUDIO);if(X||(X=new NX(this),this.Se(X)),q&&"function"!==typeof q)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");X.audioListenerRotationProvider=q},enumerable:!0,configurable:!0}),Object.defineProperty(oX.d.prototype,"audioPositioningRefreshRate",{get:function(){let q=this._getComponent(MX.c.NAME_AUDIO);return q||(q=new NX(this),this.Se(q)),q.audioPositioningRefreshRate},set:function(q){let X=this._getComponent(MX.c.NAME_AUDIO);X||(X=new NX(this),this.Se(X)),X.audioPositioningRefreshRate=q},enumerable:!0,configurable:!0});class NX{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(q){this.name=MX.c.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new x.n,this._cachedCameraPosition=new x.n,this._lastCheck=0,this._invertMatrixTemp=new x.b,this._cameraDirectionTemp=new x.n,(q=q||j.c.LastCreatedScene)&&(this.Le=q,q.soundTracks=[],q.Te=[])}register(){this.Le._afterRenderStage.registerStep(MX.c.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(q){if(q.Te=[],this.Le.soundTracks)for(let X=0;X<this.Le.soundTracks.length;X++){const Q=this.Le.soundTracks[X];for(let X=0;X<Q.soundCollection.length;X++)q.Te.push(Q.soundCollection[X].serialize())}}addFromContainer(q){q.Te&&q.Te.forEach((q=>{q.play(),q.autoplay=!0,this.Le.mainSoundTrack.addSound(q)}))}removeFromContainer(q){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1];q.Te&&q.Te.forEach((q=>{q.stop(),q.autoplay=!1,this.Le.mainSoundTrack.removeSound(q),X&&q.dispose()}))}dispose(){const q=this.Le;if(q._mainSoundTrack&&q.mainSoundTrack.dispose(),q.soundTracks)for(let X=0;X<q.soundTracks.length;X++)q.soundTracks[X].dispose()}disableAudio(){const q=this.Le;let X;for(this._audioEnabled=!1,PX.e.audioEngine&&PX.e.audioEngine.audioContext&&PX.e.audioEngine.audioContext.suspend(),X=0;X<q.mainSoundTrack.soundCollection.length;X++)q.mainSoundTrack.soundCollection[X].pause();if(q.soundTracks)for(X=0;X<q.soundTracks.length;X++)for(let Q=0;Q<q.soundTracks[X].soundCollection.length;Q++)q.soundTracks[X].soundCollection[Q].pause()}enableAudio(){const q=this.Le;let X;for(this._audioEnabled=!0,PX.e.audioEngine&&PX.e.audioEngine.audioContext&&PX.e.audioEngine.audioContext.resume(),X=0;X<q.mainSoundTrack.soundCollection.length;X++)q.mainSoundTrack.soundCollection[X].isPaused&&q.mainSoundTrack.soundCollection[X].play();if(q.soundTracks)for(X=0;X<q.soundTracks.length;X++)for(let Q=0;Q<q.soundTracks[X].soundCollection.length;Q++)q.soundTracks[X].soundCollection[Q].isPaused&&q.soundTracks[X].soundCollection[Q].play()}switchAudioModeForHeadphones(){const q=this.Le;if(this._headphone=!0,q.mainSoundTrack.switchPanningModelToHRTF(),q.soundTracks)for(let X=0;X<q.soundTracks.length;X++)q.soundTracks[X].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const q=this.Le;if(this._headphone=!1,q.mainSoundTrack.switchPanningModelToEqualPower(),q.soundTracks)for(let X=0;X<q.soundTracks.length;X++)q.soundTracks[X].switchPanningModelToEqualPower()}_afterRender(){const q=YX.e.Now;if(this._lastCheck&&q-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=q;const X=this.Le;if(!this._audioEnabled||!X._mainSoundTrack||!X.soundTracks||0===X._mainSoundTrack.soundCollection.length&&1===X.soundTracks.length)return;const Q=PX.e.audioEngine;if(Q&&Q.audioContext){let q,y=X.activeCamera;if(X.activeCameras&&X.activeCameras.length>0&&(y=X.activeCameras[0]),this.audioListenerPositionProvider){const q=this.audioListenerPositionProvider();Q.audioContext.listener.setPosition(q.x||0,q.y||0,q.z||0)}else y?this._cachedCameraPosition.equals(y.globalPosition)||(this._cachedCameraPosition.p(y.globalPosition),Q.audioContext.listener.setPosition(y.globalPosition.x,y.globalPosition.y,y.globalPosition.z)):Q.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const q=this.audioListenerRotationProvider();Q.audioContext.listener.setOrientation(q.x||0,q.y||0,q.z||0,0,1,0)}else y?(y.rigCameras&&y.rigCameras.length>0&&(y=y.rigCameras[0]),y.getViewMatrix().invertToRef(this._invertMatrixTemp),x.n.TransformNormalToRef(NX._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.p(this._cameraDirectionTemp),Q.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):Q.audioContext.listener.setOrientation(0,0,0,0,1,0);for(q=0;q<X.mainSoundTrack.soundCollection.length;q++){const Q=X.mainSoundTrack.soundCollection[q];Q.useCustomAttenuation&&Q.updateDistanceFromListener()}if(X.soundTracks)for(q=0;q<X.soundTracks.length;q++)for(let Q=0;Q<X.soundTracks[q].soundCollection.length;Q++){const y=X.soundTracks[q].soundCollection[Q];y.useCustomAttenuation&&y.updateDistanceFromListener()}}}}NX._CameraDirection=new x.n(0,0,-1),FX._SceneComponentInitialization=q=>{let X=q._getComponent(MX.c.NAME_AUDIO);X||(X=new NX(q),q.Se(X))};const SX="MSFT_audio_emitter";class cX{constructor(q){this.name=SX,this._loader=q,this.enabled=this._loader.isExtensionUsed(SX)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const q=this._loader.Wi.extensions;if(q&&q[this.name]){const X=q[this.name];this._clips=X.clips,this._emitters=X.emitters,n.Assign(this._clips),n.Assign(this._emitters)}}loadSceneAsync(q,X){return r.LoadExtensionAsync(q,X,this.name,((Q,y)=>{const x=new Array;x.push(this._loader.loadSceneAsync(q,X));for(const q of y.emitters){const X=n.Get(`${Q}/emitters`,this._emitters,q);if(void 0!=X.refDistance||void 0!=X.maxDistance||void 0!=X.rolloffFactor||void 0!=X.distanceModel||void 0!=X.innerAngle||void 0!=X.outerAngle)throw new Error(`${Q}: Direction or Distance properties are not allowed on emitters attached to a scene`);x.push(this._loadEmitterAsync(`${Q}/emitters/${X.index}`,X))}return Promise.all(x).then((()=>{}))}))}loadNodeAsync(q,X,Q){return r.LoadExtensionAsync(q,X,this.name,((q,y)=>{const u=new Array;return this._loader.loadNodeAsync(q,X,(X=>{for(const Q of y.emitters){const y=n.Get(`${q}/emitters`,this._emitters,Q);u.push(this._loadEmitterAsync(`${q}/emitters/${y.index}`,y).then((()=>{for(const q of y._babylonSounds)q.attachToMesh(X),void 0==y.innerAngle&&void 0==y.outerAngle||(q.setLocalDirectionToMesh(x.n.Forward()),q.setDirectionalCone(2*H.f.ToDegrees(void 0==y.innerAngle?Math.PI:y.innerAngle),2*H.f.ToDegrees(void 0==y.outerAngle?Math.PI:y.outerAngle),0))})))}Q(X)})).then((q=>Promise.all(u).then((()=>q))))}))}loadAnimationAsync(q,X){return r.LoadExtensionAsync(q,X,this.name,((Q,y)=>this._loader.loadAnimationAsync(q,X).then((x=>{const u=new Array;n.Assign(y.events);for(const H of y.events)u.push(this._loadAnimationEventAsync(`${Q}/events/${H.index}`,q,X,H,x));return Promise.all(u).then((()=>x))}))))}_loadClipAsync(q,X){if(X._objectURL)return X._objectURL;let Q;if(X.uri)Q=this._loader.loadUriAsync(q,X,X.uri);else{const y=n.Get(`${q}/bufferView`,this._loader.Wi.bufferViews,X.bufferView);Q=this._loader.loadBufferViewAsync(`/bufferViews/${y.index}`,y)}return X._objectURL=Q.then((q=>URL.createObjectURL(new Blob([q],{type:X.mimeType})))),X._objectURL}_loadEmitterAsync(q,X){if(X._babylonSounds=X._babylonSounds||[],!X._babylonData){const q=new Array,Q=X.name||`emitter${X.index}`,y={loop:!1,autoplay:!1,volume:void 0==X.volume?1:X.volume};for(let u=0;u<X.clips.length;u++){const x=`/extensions/${this.name}/clips`,H=n.Get(x,this._clips,X.clips[u].clip);q.push(this._loadClipAsync(`${x}/${X.clips[u].clip}`,H).then((q=>{const x=X._babylonSounds[u]=new FX(Q,q,this._loader.babylonScene,null,y);x.refDistance=X.refDistance||1,x.maxDistance=X.maxDistance||256,x.rolloffFactor=X.rolloffFactor||1,x.distanceModel=X.distanceModel||"exponential"})))}const x=Promise.all(q).then((()=>{const q=X.clips.map((q=>q.weight||1)),Q=new lX(X.loop||!1,X._babylonSounds,q);X.innerAngle&&(Q.directionalConeInnerAngle=2*H.f.ToDegrees(X.innerAngle)),X.outerAngle&&(Q.directionalConeOuterAngle=2*H.f.ToDegrees(X.outerAngle)),X.volume&&(Q.volume=X.volume),X._babylonData.sound=Q}));X._babylonData={loaded:x}}return X._babylonData.loaded}_getEventAction(q,X,Q,y,x){switch(Q){case"play":return q=>{const Q=(x||0)+(q-y);X.play(Q)};case"stop":return()=>{X.stop()};case"pause":return()=>{X.pause()};default:throw new Error(`${q}: Unsupported action ${Q}`)}}_loadAnimationEventAsync(q,X,Q,y,x){if(0==x.targetedAnimations.length)return Promise.resolve();const u=x.targetedAnimations[0],H=y.k,b=n.Get(`/extensions/${this.name}/emitters`,this._emitters,H);return this._loadEmitterAsync(q,b).then((()=>{const X=b._babylonData.sound;if(X){const Q=new OX(y.time,this._getEventAction(q,X,y.action,y.time,y.startOffset));u.animation.addEvent(Q),x.onAnimationGroupEndObservable.add((()=>{X.stop()})),x.onAnimationGroupPauseObservable.add((()=>{X.pause()}))}}))}}E(SX),C(SX,!0,(q=>new cX(q)));const pX="MSFT_lod";class tX{constructor(q){var X;this.name=pX,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new R.c,this.onMaterialLODsLoadedObservable=new R.c,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=q,this.maxLODsToLoad=(null===(X=this._loader.parent.extensionOptions[pX])||void 0===X?void 0:X.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(pX)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let q=0;q<this._nodePromiseLODs.length;q++){const X=Promise.all(this._nodePromiseLODs[q]).then((()=>{0!==q&&(this._loader.endPerformanceCounter(`Node LOD ${q}`),this._loader.log(`Loaded node LOD ${q}`)),this.onNodeLODsLoadedObservable.notifyObservers(q),q!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${q+1}`),this._loadBufferLOD(this._nodeBufferLODs,q+1),this._nodeSignalLODs[q]&&this._nodeSignalLODs[q].resolve())}));this._loader._completePromises.push(X)}for(let q=0;q<this._materialPromiseLODs.length;q++){const X=Promise.all(this._materialPromiseLODs[q]).then((()=>{0!==q&&(this._loader.endPerformanceCounter(`Material LOD ${q}`),this._loader.log(`Loaded material LOD ${q}`)),this.onMaterialLODsLoadedObservable.notifyObservers(q),q!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${q+1}`),this._loadBufferLOD(this._materialBufferLODs,q+1),this._materialSignalLODs[q]&&this._materialSignalLODs[q].resolve())}));this._loader._completePromises.push(X)}}loadSceneAsync(q,X){const Q=this._loader.loadSceneAsync(q,X);return this._loadBufferLOD(this._bufferLODs,0),Q}loadNodeAsync(q,X,Q){return r.LoadExtensionAsync(q,X,this.name,((q,x)=>{let u;const H=this._getLODs(q,X,this._loader.Wi.nodes,x.ids);this._loader.logOpen(`${q}`);for(let X=0;X<H.length;X++){const q=H[X];0!==X&&(this._nodeIndexLOD=X,this._nodeSignalLODs[X]=this._nodeSignalLODs[X]||new y);const x=q=>{Q(q),q.tg(!1)},b=this._loader.loadNodeAsync(`/nodes/${q.index}`,q,x).then((q=>{if(0!==X){const q=H[X-1];q._babylonTransformNode&&(this._disposeTransformNode(q._babylonTransformNode),delete q._babylonTransformNode)}return q.tg(!0),q}));this._nodePromiseLODs[X]=this._nodePromiseLODs[X]||[],0===X?u=b:(this._nodeIndexLOD=null,this._nodePromiseLODs[X].push(b))}return this._loader.logClose(),u}))}_loadMaterialAsync(q,X,Q,y,x){return this._nodeIndexLOD?null:r.LoadExtensionAsync(q,X,this.name,((q,u)=>{let H;const b=this._getLODs(q,X,this._loader.Wi.materials,u.ids);this._loader.logOpen(`${q}`);for(let X=0;X<b.length;X++){const q=b[X];0!==X&&(this._materialIndexLOD=X);const u=this._loader._loadMaterialAsync(`/materials/${q.index}`,q,Q,y,(q=>{0===X&&x(q)})).then((q=>{if(0!==X){x(q);const Q=b[X-1]._data;Q[y]&&(this._disposeMaterials([Q[y].babylonMaterial]),delete Q[y])}return q}));this._materialPromiseLODs[X]=this._materialPromiseLODs[X]||[],0===X?H=u:(this._materialIndexLOD=null,this._materialPromiseLODs[X].push(u))}return this._loader.logClose(),H}))}_loadUriAsync(q,X,Q){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const x=this._nodeIndexLOD-1;return this._nodeSignalLODs[x]=this._nodeSignalLODs[x]||new y,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((()=>this._loader.loadUriAsync(q,X,Q)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const x=this._materialIndexLOD-1;return this._materialSignalLODs[x]=this._materialSignalLODs[x]||new y,this._materialSignalLODs[x].promise.then((()=>this._loader.loadUriAsync(q,X,Q)))}return null}loadBufferAsync(q,X,Q,x){if(this._loader.parent.useRangeRequests&&!X.uri){if(!this._loader.bin)throw new Error(`${q}: Uri is missing or the binary glTF is missing its binary chunk`);const X=(q,X)=>{const u=Q,H=u+x-1;let b=q[X];return b?(b.start=Math.min(b.start,u),b.end=Math.max(b.end,H)):(b={start:u,end:H,loaded:new y},q[X]=b),b.loaded.promise.then((q=>new Uint8Array(q.buffer,q.byteOffset+Q-b.start,x)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?X(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?X(this._materialBufferLODs,this._materialIndexLOD):X(this._bufferLODs,0)}return null}_loadBufferLOD(q,X){const Q=q[X];Q&&(this._loader.log(`Loading buffer range [${Q.start}-${Q.end}]`),this._loader.bin.readAsync(Q.start,Q.end-Q.start+1).then((q=>{Q.loaded.resolve(q)}),(q=>{Q.loaded.reject(q)})))}_getLODs(q,X,Q,y){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const x=[];for(let u=y.length-1;u>=0;u--)if(x.push(n.Get(`${q}/ids/${y[u]}`,Q,y[u])),x.length===this.maxLODsToLoad)return x;return x.push(X),x}_disposeTransformNode(q){const X=[],Q=q.material;Q&&X.push(Q);for(const x of q.getChildMeshes())x.material&&X.push(x.material);q.dispose();const y=X.filter((q=>this._loader.babylonScene.meshes.every((X=>X.material!=q))));this._disposeMaterials(y)}_disposeMaterials(q){const X={};for(const Q of q){for(const q of Q.getActiveTextures())X[q.uniqueId]=q;Q.dispose()}for(const Q in X)for(const q of this._loader.babylonScene.materials)q.hasTexture(X[Q])&&delete X[Q];for(const Q in X)X[Q].dispose()}}E(pX),C(pX,!0,(q=>new tX(q)));const zX="MSFT_minecraftMesh";class KX{constructor(q){this.name=zX,this._loader=q,this.enabled=this._loader.isExtensionUsed(zX)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,X,Q){return r.LoadExtraAsync(q,X,this.name,((y,x)=>{if(x){if(!(Q instanceof Z))throw new Error(`${y}: Material type not supported`);const x=this._loader.loadMaterialPropertiesAsync(q,X,Q);return Q.needAlphaBlending()&&(Q.forceDepthWrite=!0,Q.separateCullingPass=!0),Q.ue=Q.forceDepthWrite,Q.twoSidedLighting=!0,x}return null}))}}E(zX),C(zX,!0,(q=>new KX(q)));const hX="MSFT_sRGBFactors";class GX{constructor(q){this.name=hX,this._loader=q,this.enabled=this._loader.isExtensionUsed(hX)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,X,Q){return r.LoadExtraAsync(q,X,this.name,((y,x)=>{if(x){if(!(Q instanceof Z))throw new Error(`${y}: Material type not supported`);const x=this._loader.loadMaterialPropertiesAsync(q,X,Q),u=Q.va().getEngine().useExactSrgbConversions;return Q.albedoTexture||Q.albedoColor.toLinearSpaceToRef(Q.albedoColor,u),Q.reflectivityTexture||Q.reflectivityColor.toLinearSpaceToRef(Q.reflectivityColor,u),x}return null}))}}E(hX),C(hX,!0,(q=>new GX(q)));var CX,EX=Q(1047);!function(q){q[q.Input=0]="Input",q[q.Output=1]="Output"}(CX||(CX={}));class JX{constructor(q,X,Q){this._ownerBlock=Q,this._connectedPoint=[],this.uniqueId=(0,EX.d)(),this.connectedPointIds=[],this.name=q,this._connectionType=X}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(q){if(this._connectionType===q._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||q._isSingularConnection()&&q._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(q),q._connectedPoint.push(this)}serialize(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};q.uniqueId=this.uniqueId,q.name=this.name,q._connectionType=this._connectionType,q.connectedPointIds=[],q.className=this.getClassName();for(const X of this._connectedPoint)q.connectedPointIds.push(X.uniqueId)}getClassName(){return"FGConnection"}deserialize(q){this.uniqueId=q.uniqueId,this.name=q.name,this._connectionType=q._connectionType,this.connectedPointIds=q.connectedPointIds}static Parse(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},X=arguments.length>1?arguments[1]:void 0;const Q=new(H.f.Instantiate(q.className))(q.name,q._connectionType,X);return Q.deserialize(q),Q}}class nX{constructor(q){this.value=this._toInt(q)}_toInt(q){return 0|q}add(q){return new nX(this.value+q.value)}Sc(q){return new nX(this.value-q.value)}multiply(q){return new nX(Math.imul(this.value,q.value))}divide(q){return new nX(this.value/q.value)}getClassName(){return nX.ClassName}equals(q){return this.value===q.value}static Parse(q){return new nX(q.value)}}nX.ClassName="FlowGraphInteger",(0,W.h)("FlowGraphInteger",nX);class rX{constructor(q,X){this.typeName=q,this.defaultValue=X}serialize(q){q.typeName=this.typeName,q.defaultValue=this.defaultValue}static Parse(q){return new rX(q.typeName,q.defaultValue)}}const sX=new rX("any",void 0),TX=(new rX("string",""),new rX("number",0)),qQ=new rX("boolean",!1),XQ=new rX("Vector2",x.k.Zero()),QQ=new rX("Od",x.n.Zero()),yQ=(new rX("Vector4",x.q.Zero()),new rX("Matrix",x.b.Identity())),xQ=(new rX("Fe",u.b.Black()),new rX("Ge",new u.c(0,0,0,0)),new rX("Quaternion",x.d.Identity()),new rX("FlowGraphInteger",new nX(0)));class uQ extends JX{constructor(q,X,Q,y){super(q,X,Q),this.richType=y}_isSingularConnection(){return 0===this.connectionType}setValue(q,X){X._setConnectionValue(this,q)}connectTo(q){super.connectTo(q)}_getValueOrDefault(q){return q._hasConnectionValue(this)?q._getConnectionValue(this):this.richType.defaultValue}getValue(q){return 1===this.connectionType?(q._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(q),this._getValueOrDefault(q)):this.isConnected()?this._connectedPoint[0].getValue(q):this._getValueOrDefault(q)}getClassName(){return"FGDataConnection"}serialize(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(q),q.richType={},this.richType.serialize(q.richType)}static Parse(q,X){const Q=JX.Parse(q,X);return Q.richType=rX.Parse(q.richType),Q}}function HQ(q){return"Mesh"===q||"AbstractMesh"===q||"GroundMesh"===q||"InstanceMesh"===q||"LinesMesh"===q||"GoldbergMesh"===q||"GreasedLineMesh"===q||"TrailMesh"===q}function bQ(q){return"Vector2"===q||"Od"===q||"Vector4"===q||"Quaternion"===q||"Fe"===q||"Ge"===q}function DQ(q,X,Q){var y;const x=(null===X||void 0===X||null===(y=X.getClassName)||void 0===y?void 0:y.call(X))??"";HQ(x)?Q[q]={name:X.name,className:x}:bQ(x)?Q[q]={value:X.ee(),className:x}:Q[q]=X}function aQ(q,X,Q){const y=X[q];let H;const b=null===y||void 0===y?void 0:y.className;return H=HQ(b)?Q.getMeshByName(y.name):bQ(b)?function(q,X){if("Vector2"===q)return x.k.Rd(X);if("Od"===q)return x.n.Rd(X);if("Vector4"===q)return x.q.Rd(X);if("Quaternion"===q)return x.d.Rd(X);if("Fe"===q)return new u.b(X[0],X[1],X[2]);if("Ge"===q)return new u.c(X[0],X[1],X[2],X[3]);throw new Error(`Unknown vector class name ${q}`)}(b,y.value):"Matrix"===b?x.b.Rd(y.value):b===nX.ClassName?nX.Parse(y):y&&void 0!==y.value?y.value:y,H}(0,W.h)("FGDataConnection",uQ);class RQ{constructor(q){var X;this.config=q,this.uniqueId=(0,EX.d)(),this.name=(null===(X=this.config)||void 0===X?void 0:X.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(q){}registerDataInput(q,X){const Q=new uQ(q,0,this,X);return this.dataInputs.push(Q),Q}registerDataOutput(q,X){const Q=new uQ(q,1,this,X);return this.dataOutputs.push(Q),Q}getDataInput(q){return this.dataInputs.find((X=>X.name===q))}getDataOutput(q){return this.dataOutputs.find((X=>X.name===q))}serialize(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};q.uniqueId=this.uniqueId,q.config={},this.config&&(q.config.name=this.config.name),q.dataInputs=[],q.dataOutputs=[],q.className=this.getClassName();for(const X of this.dataInputs){const Q={};X.serialize(Q),q.dataInputs.push(Q)}for(const X of this.dataOutputs){const Q={};X.serialize(Q),q.dataOutputs.push(Q)}}getClassName(){return"FGBlock"}static Parse(q,X){const Q=H.f.Instantiate(q.className),y={},x=X.valueParseFunction??aQ;if(q.config)for(const H in q.config)y[H]=x(H,q.config,X.Le);var u;("FGSetPropertyBlock"===(u=q.className)||"FGGetPropertyBlock"===u||"FGPlayAnimationBlock"===u||"FGMeshPickEventBlock"===u)&&(y.pathConverter=X.pathConverter);const b=new Q(y);b.uniqueId=q.uniqueId;for(let H=0;H<q.dataInputs.length;H++){const X=b.getDataInput(q.dataInputs[H].name);if(!X)throw new Error("Could not find data input with name "+q.dataInputs[H].name+" in block "+q.className);X.deserialize(q.dataInputs[H])}for(let H=0;H<q.dataOutputs.length;H++){const X=b.getDataOutput(q.dataOutputs[H].name);if(!X)throw new Error("Could not find data output with name "+q.dataOutputs[H].name+" in block "+q.className);X.deserialize(q.dataOutputs[H])}return b.metadata=q.metadata,b.deserialize&&b.deserialize(q),b}}class LQ extends JX{_isSingularConnection(){return 1===this.connectionType}_activateSignal(q){var X;0===this.connectionType?(q._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(q,this),q._increaseExecutionId()):null===(X=this._connectedPoint[0])||void 0===X||X._activateSignal(q)}}(0,W.h)("FlowGraphSignalConnection",LQ);class fQ extends RQ{constructor(q){super(q),this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in")}_registerSignalInput(q){const X=new LQ(q,0,this);return this.signalInputs.push(X),X}_registerSignalOutput(q){const X=new LQ(q,1,this);return this.signalOutputs.push(X),X}getSignalInput(q){return this.signalInputs.find((X=>X.name===q))}getSignalOutput(q){return this.signalOutputs.find((X=>X.name===q))}serialize(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(q),q.signalInputs=[],q.signalOutputs=[];for(const X of this.signalInputs){const Q={};X.serialize(Q),q.signalInputs.push(Q)}for(const X of this.signalOutputs){const Q={};X.serialize(Q),q.signalOutputs.push(Q)}}deserialize(q){for(let X=0;X<q.signalInputs.length;X++){const Q=this.getSignalInput(q.signalInputs[X].name);if(!Q)throw new Error("Could not find signal input with name "+q.signalInputs[X].name+" in block "+q.className);Q.deserialize(q.signalInputs[X])}for(let X=0;X<q.signalOutputs.length;X++){const Q=this.getSignalOutput(q.signalOutputs[X].name);if(!Q)throw new Error("Could not find signal output with name "+q.signalOutputs[X].name+" in block "+q.className);Q.deserialize(q.signalOutputs[X])}}getClassName(){return"FGExecutionBlock"}}class kQ extends fQ{constructor(q){super(q),this.out=this._registerSignalOutput("out"),this.done=this._registerSignalOutput("done")}_startPendingTasks(q){this._preparePendingTasks(q),q._addPendingBlock(this)}}class jQ extends kQ{_execute(q){q._notifyExecuteNode(this),this.out._activateSignal(q)}}class IQ{constructor(q){this.uniqueId=(0,EX.d)(),this._userVariables={},this._executionVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new R.c,this._configuration=q}hasVariable(q){return q in this._userVariables}setVariable(q,X){this._userVariables[q]=X}getVariable(q){return this._userVariables[q]}get userVariables(){return this._userVariables}_getUniqueIdPrefixedName(q,X){return`${q.uniqueId}_${X}`}_setExecutionVariable(q,X,Q){this._executionVariables[this._getUniqueIdPrefixedName(q,X)]=Q}_getExecutionVariable(q,X,Q){return this._hasExecutionVariable(q,X)?this._executionVariables[this._getUniqueIdPrefixedName(q,X)]:Q}_deleteExecutionVariable(q,X){delete this._executionVariables[this._getUniqueIdPrefixedName(q,X)]}_hasExecutionVariable(q,X){return this._getUniqueIdPrefixedName(q,X)in this._executionVariables}_hasConnectionValue(q){return q.uniqueId in this._connectionValues}_setConnectionValue(q,X){this._connectionValues[q.uniqueId]=X}_getConnectionValue(q){return this._connectionValues[q.uniqueId]}get configuration(){return this._configuration}_addPendingBlock(q){this._pendingBlocks.push(q)}_removePendingBlock(q){const X=this._pendingBlocks.indexOf(q);-1!==X&&this._pendingBlocks.splice(X,1)}_clearPendingBlocks(){for(const q of this._pendingBlocks)q._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(q){this.onNodeExecutedObservable.notifyObservers(q)}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:DQ;q.uniqueId=this.uniqueId,q._userVariables={};for(const Q in this._userVariables)X(Q,this._userVariables[Q],q._userVariables);q._connectionValues={};for(const Q in this._connectionValues)X(Q,this._connectionValues[Q],q._connectionValues)}getClassName(){return"FGContext"}static Parse(q,X){const Q=X.graph.createContext(),y=X.valueParseFunction??aQ;Q.uniqueId=q.uniqueId;for(const x in q._userVariables){const X=y(x,q._userVariables,Q._configuration.Le);Q._userVariables[x]=X}for(const x in q._connectionValues){const X=y(x,q._connectionValues,Q._configuration.Le);Q._connectionValues[x]=X}return Q}}(0,A.b)([(0,B.J)()],IQ.prototype,"uniqueId",void 0);var dQ,eQ,iQ=Q(1288);function AQ(q,X){return!(!q.parent||q.parent!==X&&!AQ(q.parent,X))}class BQ extends jQ{constructor(q){super(q),this.config=q}_getReferencedMesh(){const q=this.config.pathConverter.convert(this.config.path),X=q.info.getObject(q.object);if(!X||!(X instanceof F.c))throw new Error("Mesh pick event block requires a valid mesh");return X}_preparePendingTasks(q){let X=q._getExecutionVariable(this,"meshPickObserver");if(!X){const Q=this._getReferencedMesh();q._setExecutionVariable(this,"mesh",Q),X=Q.va().onPointerObservable.add((X=>{var y,x,u;X.type===iQ.c.POINTERPICK&&null!==(y=X.pickInfo)&&void 0!==y&&y.pickedMesh&&((null===(x=X.pickInfo)||void 0===x?void 0:x.pickedMesh)===Q||AQ(null===(u=X.pickInfo)||void 0===u?void 0:u.pickedMesh,Q))&&this._execute(q)}));const y=Q._d.add((()=>this._onDispose));q._setExecutionVariable(this,"meshPickObserver",X),q._setExecutionVariable(this,"meshDisposeObserver",y)}}_onDispose(q){this._cancelPendingTasks(q),q._removePendingBlock(this)}_cancelPendingTasks(q){const X=q._getExecutionVariable(this,"mesh"),Q=q._getExecutionVariable(this,"meshPickObserver"),y=q._getExecutionVariable(this,"meshDisposeObserver");X.va().onPointerObservable.remove(Q),X._d.remove(y),q._deleteExecutionVariable(this,"mesh"),q._deleteExecutionVariable(this,"meshPickObserver"),q._deleteExecutionVariable(this,"meshDisposeObserver")}getClassName(){return BQ.ClassName}serialize(q){super.serialize(q),q.config.path=this.config.path}}BQ.ClassName="FGMeshPickEventBlock",(0,W.h)(BQ.ClassName,BQ),function(q){q[q.Stopped=0]="Stopped",q[q.Started=1]="Started"}(dQ||(dQ={}));class wQ{constructor(q){this._eventBlocks=[],this._executionContexts=[],this.state=0,this._scene=q.Le,this._coordinator=q.coordinator,this._sceneDisposeObserver=this._scene._d.add((()=>this.dispose()))}createContext(){const q=new IQ({Le:this._scene,coordinator:this._coordinator});return this._executionContexts.push(q),q}getContext(q){return this._executionContexts[q]}addEventBlock(q){this._eventBlocks.push(q)}start(){if(1!==this.state){this.state=1,0===this._executionContexts.length&&this.createContext();for(const q of this._executionContexts){const X=this._getContextualOrder();for(const Q of X)Q._startPendingTasks(q)}}}_getContextualOrder(){const q=[];for(const X of this._eventBlocks)if(X.getClassName()===BQ.ClassName){const Q=X._getReferencedMesh();let y=0;for(;y<q.length;y++){const X=q[y]._getReferencedMesh();if(Q&&X&&AQ(Q,X))break}q.splice(y,0,X)}else q.push(X);return q}dispose(){if(0!==this.state){this.state=0;for(const q of this._executionContexts)q._clearPendingBlocks();this._executionContexts.length=0,this._eventBlocks.length=0,this._scene._d.remove(this._sceneDisposeObserver),this._sceneDisposeObserver=null}}visitAllBlocks(q){const X=[],Q=new Set;for(const y of this._eventBlocks)X.push(y),Q.add(y.uniqueId);for(;X.length>0;){const y=X.pop();q(y);for(const q of y.dataInputs)for(const y of q._connectedPoint)Q.has(y._ownerBlock.uniqueId)||(X.push(y._ownerBlock),Q.add(y._ownerBlock.uniqueId));if(y instanceof fQ)for(const q of y.signalOutputs)for(const y of q._connectedPoint)Q.has(y._ownerBlock.uniqueId)||(X.push(y._ownerBlock),Q.add(y._ownerBlock.uniqueId))}}serialize(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},X=arguments.length>1?arguments[1]:void 0;q.allBlocks=[],this.visitAllBlocks((X=>{const Q={};X.serialize(Q),q.allBlocks.push(Q)})),q.executionContexts=[];for(const Q of this._executionContexts){const y={};Q.serialize(y,X),q.executionContexts.push(y)}}static GetDataOutConnectionByUniqueId(q,X){for(const Q of q)for(const q of Q.dataOutputs)if(q.uniqueId===X)return q;throw new Error("Could not find data out connection with unique id "+X)}static GetSignalInConnectionByUniqueId(q,X){for(const Q of q)if(Q instanceof fQ)for(const q of Q.signalInputs)if(q.uniqueId===X)return q;throw new Error("Could not find signal in connection with unique id "+X)}static Parse(q,X){const Q=X.coordinator.createGraph(),y=[],x=X.valueParseFunction??aQ;for(const u of q.allBlocks){const q=RQ.Parse(u,{Le:X.coordinator.config.Le,pathConverter:X.pathConverter,valueParseFunction:x});y.push(q),q instanceof jQ&&Q.addEventBlock(q)}for(const u of y){for(const q of u.dataInputs)for(const X of q.connectedPointIds){const Q=wQ.GetDataOutConnectionByUniqueId(y,X);q.connectTo(Q)}if(u instanceof fQ)for(const q of u.signalOutputs)for(const X of q.connectedPointIds){const Q=wQ.GetSignalInConnectionByUniqueId(y,X);q.connectTo(Q)}}for(const u of q.executionContexts)IQ.Parse(u,{graph:Q,valueParseFunction:x});return Q}}class VQ{constructor(q){this.config=q,this._flowGraphs=[],this._customEventsMap=new Map,this.config.Le._d.add((()=>{this.dispose()}));(VQ.SceneCoordinators.get(this.config.Le)??[]).push(this)}createGraph(){const q=new wQ({Le:this.config.Le,coordinator:this});return this._flowGraphs.push(q),q}removeGraph(q){const X=this._flowGraphs.indexOf(q);-1!==X&&(q.dispose(),this._flowGraphs.splice(X,1))}start(){this._flowGraphs.forEach((q=>q.start()))}dispose(){this._flowGraphs.forEach((q=>q.dispose())),this._flowGraphs.length=0;const q=VQ.SceneCoordinators.get(this.config.Le)??[],X=q.indexOf(this);-1!==X&&q.splice(X,1)}serialize(q,X){q._flowGraphs=[],this._flowGraphs.forEach((Q=>{const y={};Q.serialize(y,X),q._flowGraphs.push(y)}))}static Parse(q,X){var Q;const y=X.valueParseFunction??aQ,x=new VQ({Le:X.Le});return null===(Q=q._flowGraphs)||void 0===Q||Q.forEach((q=>{wQ.Parse(q,{coordinator:x,valueParseFunction:y,pathConverter:X.pathConverter})})),x}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(q){let X=this._customEventsMap.get(q);return X||(X=new R.c,this._customEventsMap.set(q,X)),X}notifyCustomEvent(q,X){const Q=this._customEventsMap.get(q);Q&&Q.notifyObservers(X)}}VQ.SceneCoordinators=new Map;class WQ extends jQ{_preparePendingTasks(q){if(!q._getExecutionVariable(this,"sceneReadyObserver")){const X=q.configuration.Le.onReadyObservable.add((()=>{this._execute(q)}));q._setExecutionVariable(this,"sceneReadyObserver",X)}}_cancelPendingTasks(q){const X=q._getExecutionVariable(this,"sceneReadyObserver");q.configuration.Le.onReadyObservable.remove(X),q._deleteExecutionVariable(this,"sceneReadyObserver")}getClassName(){return WQ.ClassName}}WQ.ClassName="FGSceneReadyEventBlock",(0,W.h)("FGSceneReadyEventBlock",WQ);class vQ extends jQ{_preparePendingTasks(q){if(!q._getExecutionVariable(this,"sceneBeforeRender")){const X=q.configuration.Le.onBeforeRenderObservable.add((()=>{this._execute(q)}));q._setExecutionVariable(this,"sceneBeforeRender",X)}}_cancelPendingTasks(q){const X=q._getExecutionVariable(this,"sceneBeforeRender");q.configuration.Le.onBeforeRenderObservable.remove(X),q._deleteExecutionVariable(this,"sceneBeforeRender")}getClassName(){return vQ.ClassName}}vQ.ClassName="FGSceneTickEventBlock",(0,W.h)(vQ.ClassName,vQ);class ZQ extends fQ{constructor(q){super(q),this.out=this._registerSignalOutput("out")}}class UQ extends ZQ{constructor(q){super(q),this.message=this.registerDataInput("message",sX)}_execute(q){const X=this.message.getValue(q);I.b.Log(X),this.out._activateSignal(q)}getClassName(){return UQ.ClassName}}UQ.ClassName="FGConsoleLogBlock",(0,W.h)(UQ.ClassName,UQ),function(q){q[q.INIT=0]="INIT",q[q.STARTED=1]="STARTED",q[q.ENDED=2]="ENDED"}(eQ||(eQ={}));class OQ{constructor(q){this.onEachCountObservable=new R.c,this.onTimerAbortedObservable=new R.c,this.onTimerEndedObservable=new R.c,this.onStateChangedObservable=new R.c,this._observer=null,this._breakOnNextTick=!1,this._tick=q=>{const X=Date.now();this._timer=X-this._startTime;const Q={startTime:this._startTime,currentTime:X,deltaTime:this._timer,completeRate:this._timer/this._timeToEnd,payload:q},y=this._breakOnNextTick||this._breakCondition(Q);y||this._timer>=this._timeToEnd?this._stop(Q,y):this.onEachCountObservable.notifyObservers(Q)},this._setState(0),this._contextObservable=q.contextObservable,this._observableParameters=q.observableParameters??{},this._breakCondition=q.breakCondition??(()=>!1),this._timeToEnd=q.timeout,q.onEnded&&this.onTimerEndedObservable.add(q.onEnded),q.ni&&this.onEachCountObservable.add(q.ni),q.onAborted&&this.onTimerAbortedObservable.add(q.onAborted)}set breakCondition(q){this._breakCondition=q}clearObservables(){this.onEachCountObservable.clear(),this.onTimerAbortedObservable.clear(),this.onTimerEndedObservable.clear(),this.onStateChangedObservable.clear()}start(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._timeToEnd;if(1===this._state)throw new Error("Timer already started. Please stop it before starting again");this._timeToEnd=q,this._startTime=Date.now(),this._timer=0,this._observer=this._contextObservable.add(this._tick,this._observableParameters.mask,this._observableParameters.insertFirst,this._observableParameters.scope),this._setState(1)}stop(){1===this._state&&(this._breakOnNextTick=!0)}dispose(){this._observer&&this._contextObservable.remove(this._observer),this.clearObservables()}_setState(q){this._state=q,this.onStateChangedObservable.notifyObservers(this._state)}_stop(q){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._contextObservable.remove(this._observer),this._setState(2),X?this.onTimerAbortedObservable.notifyObservers(q):this.onTimerEndedObservable.notifyObservers(q)}}class gQ extends kQ{constructor(q){super(q),this.timeout=this.registerDataInput("timeout",TX)}_preparePendingTasks(q){const X=this.timeout.getValue(q);if(void 0!==X&&X>=0){const Q=q._getExecutionVariable(this,"runningTimers")||[],y=q.configuration.Le,x=new OQ({timeout:X,contextObservable:y.onBeforeRenderObservable,onEnded:()=>this._onEnded(x,q)});x.start(),Q.push(x),q._setExecutionVariable(this,"runningTimers",Q)}}_execute(q){this._startPendingTasks(q),this.out._activateSignal(q)}_onEnded(q,X){const Q=X._getExecutionVariable(this,"runningTimers")||[],y=Q.indexOf(q);-1!==y?Q.splice(y,1):H.f.Warn("FlowGraphTimerBlock: Timer ended but was not found in the running timers list"),X._removePendingBlock(this),this.done._activateSignal(X)}_cancelPendingTasks(q){const X=q._getExecutionVariable(this,"runningTimers")||[];for(const Q of X)Q.dispose();q._deleteExecutionVariable(this,"runningTimers")}getClassName(){return gQ.ClassName}}gQ.ClassName="FGTimerBlock",(0,W.h)("FGTimerBlock",gQ);class PQ extends ZQ{constructor(q){super(q),this.config=q;for(let X=0;X<this.config.eventData.length;X++){const q=this.config.eventData[X];this.registerDataInput(q,sX)}}_execute(q){const X=this.config.eventId,Q=this.dataInputs.map((X=>X.getValue(q)));q.configuration.coordinator.notifyCustomEvent(X,Q),this.out._activateSignal(q)}getClassName(){return PQ.ClassName}}PQ.ClassName="FGSendCustomEventBlock",(0,W.h)("FGSendCustomEventBlock",PQ);class FQ extends jQ{constructor(q){super(q),this.config=q;for(let X=0;X<this.config.eventData.length;X++){const q=this.config.eventData[X];this.registerDataOutput(q,sX)}}_preparePendingTasks(q){const X=q.configuration.coordinator.getCustomEventObservable(this.config.eventId);this._eventObserver=X.add((X=>{for(let Q=0;Q<X.length;Q++)this.dataOutputs[Q].setValue(X[Q],q);this._execute(q)}))}_cancelPendingTasks(q){const X=q.configuration.coordinator.getCustomEventObservable(this.config.eventId);X?X.remove(this._eventObserver):H.f.Warn(`FlowGraphReceiveCustomEventBlock: Missing observable for event ${this.config.eventId}`)}getClassName(){return FQ.ClassName}serialize(q){super.serialize(q),q.eventId=this.config.eventId,q.eventData=this.config.eventData}}FQ.ClassName="FGReceiveCustomEventBlock",(0,W.h)(FQ.ClassName,FQ);class lQ extends fQ{constructor(q){super(q),this.config=q,this.outFlows=[];for(let X=0;X<this.config.numberOutputFlows;X++)this.outFlows.push(this._registerSignalOutput(`${X}`))}_execute(q){for(let X=0;X<this.config.numberOutputFlows;X++)this.outFlows[X]._activateSignal(q)}getClassName(){return lQ.ClassName}}lQ.ClassName="FGSequenceBlock",(0,W.h)(lQ.ClassName,lQ);const mQ=new RegExp(/\{(\w+)\}/g);class MQ{constructor(q,X){this.path=q,this.ownerBlock=X,this.templatedInputs=[];let Q=mQ.exec(q);for(;Q;){const[,y]=Q;this.templatedInputs.push(X.registerDataInput(y,xQ)),Q=mQ.exec(q)}}getAccessor(q,X){let Q=this.path;for(const y of this.templatedInputs){const q=y.getValue(X).value;Q=Q.replace(`{${y.name}}`,q.toString())}return q.convert(Q)}}class oQ extends RQ{constructor(q){super(q),this.config=q,this.value=this.registerDataOutput("value",sX),this.templateComponent=new MQ(q.path,this)}_updateOutputs(q){const X=this.templateComponent.getAccessor(this.config.pathConverter,q),Q=X.info.get(X.object);this.value.setValue(Q,q)}getClassName(){return oQ.ClassName}serialize(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(q),q.config.path=this.config.path}}oQ.ClassName="FGGetPropertyBlock",(0,W.h)(oQ.ClassName,oQ);class YQ extends ZQ{constructor(q){super(q),this.config=q,this.a=this.registerDataInput("a",sX),this.templateComponent=new MQ(q.path,this)}_execute(q){const X=this.a.getValue(q),Q=this.templateComponent.getAccessor(this.config.pathConverter,q);Q.info.set(X,Q.object),this.out._activateSignal(q)}serialize(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(q),q.config.path=this.config.path}getClassName(){return YQ.ClassName}}YQ.ClassName="FGSetPropertyBlock",(0,W.h)("FGSetPropertyBlock",YQ);const NQ="cachedOperationValue",SQ="cachedExecutionId";class cQ extends RQ{constructor(q,X){super(X),this.value=this.registerDataOutput("value",q)}_updateOutputs(q){const X=q._getExecutionVariable(this,SQ),Q=q._getExecutionVariable(this,NQ);if(void 0!==Q&&X===q.executionId)this.value.setValue(Q,q);else{const X=this._doOperation(q);q._setExecutionVariable(this,NQ,X),q._setExecutionVariable(this,SQ,q.executionId),this.value.setValue(X,q)}}}class pQ extends cQ{constructor(q,X,Q,y,x,u){super(Q,u),this._operation=y,this._className=x,this.a=this.registerDataInput("a",q),this.b=this.registerDataInput("b",X)}_doOperation(q){return this._operation(this.a.getValue(q),this.b.getValue(q))}getClassName(){return this._className}}class tQ extends cQ{constructor(q,X,Q,y){super(q,y),this._operation=X,this._className=Q}_doOperation(q){return this._operation()}getClassName(){return this._className}}class zQ extends cQ{constructor(q,X,Q,y,x){super(X,x),this._operation=Q,this._className=y,this.a=this.registerDataInput("a",q)}_doOperation(q){return this._operation(this.a.getValue(q))}getClassName(){return this._className}}class KQ extends cQ{constructor(q,X,Q,y,x,u,H){super(y,H),this._operation=x,this._className=u,this.a=this.registerDataInput("a",q),this.b=this.registerDataInput("b",X),this.c=this.registerDataInput("c",Q)}_doOperation(q){return this._operation(this.a.getValue(q),this.b.getValue(q),this.c.getValue(q))}getClassName(){return this._className}}function hQ(q){return q.getClassName?q.getClassName():""}function GQ(q,X){return"Vector2"===q&&"Vector2"===X||"Od"===q&&"Od"===X||"Vector4"===q&&"Vector4"===X}function CQ(q,X){return"Matrix"===q&&"Matrix"===X}function EQ(q,X){return"FlowGraphInteger"===q&&"FlowGraphInteger"===X}class JQ extends pQ{constructor(q){super(sX,sX,sX,((q,X)=>this._polymorphicAdd(q,X)),JQ.ClassName,q)}_polymorphicAdd(q,X){const Q=hQ(q),y=hQ(X);return GQ(Q,y)||CQ(Q,y)||EQ(Q,y)?q.add(X):q+X}}JQ.ClassName="FGAddBlock",(0,W.h)(JQ.ClassName,JQ);class nQ extends pQ{constructor(q){super(sX,sX,sX,((q,X)=>this._polymorphicAdd(q,X)),nQ.ClassName,q)}_polymorphicAdd(q,X){const Q=hQ(q),y=hQ(X);return GQ(Q,y)||EQ(Q,y)?q.Sc(X):CQ(Q,y)?q.add(X.scale(-1)):q-X}}nQ.ClassName="FGSubBlock",(0,W.h)(nQ.ClassName,nQ);class rQ extends pQ{constructor(q){super(sX,sX,sX,((q,X)=>this._polymorphicMultiply(q,X)),rQ.ClassName,q)}_polymorphicMultiply(q,X){const Q=hQ(q),y=hQ(X);return GQ(Q,y)||EQ(Q,y)?q.multiply(X):CQ(Q,y)?x.b.FromValues(q.m[0]*X.m[0],q.m[4]*X.m[4],q.m[8]*X.m[8],q.m[12]*X.m[12],q.m[1]*X.m[1],q.m[5]*X.m[5],q.m[9]*X.m[9],q.m[13]*X.m[13],q.m[2]*X.m[2],q.m[6]*X.m[6],q.m[10]*X.m[10],q.m[14]*X.m[14],q.m[3]*X.m[3],q.m[7]*X.m[7],q.m[11]*X.m[11],q.m[15]*X.m[15]):q*X}}rQ.ClassName="FGMultiplyBlock",(0,W.h)(rQ.ClassName,rQ);class sQ extends pQ{constructor(q){super(sX,sX,sX,((q,X)=>this._polymorphicDivide(q,X)),sQ.ClassName,q)}_polymorphicDivide(q,X){const Q=hQ(q),y=hQ(X);return GQ(Q,y)||EQ(Q,y)?q.divide(X):CQ(Q,y)?x.b.FromValues(q.m[0]/X.m[0],q.m[4]/X.m[4],q.m[8]/X.m[8],q.m[12]/X.m[12],q.m[1]/X.m[1],q.m[5]/X.m[5],q.m[9]/X.m[9],q.m[13]/X.m[13],q.m[2]/X.m[2],q.m[6]/X.m[6],q.m[10]/X.m[10],q.m[14]/X.m[14],q.m[3]/X.m[3],q.m[7]/X.m[7],q.m[11]/X.m[11],q.m[15]/X.m[15]):q/X}}sQ.ClassName="FGDivideBlock",(0,W.h)(sQ.ClassName,sQ);class TQ extends tQ{constructor(q){super(TX,(()=>Math.random()),TQ.ClassName,q)}}TQ.ClassName="FGRandomBlock",(0,W.h)(TQ.ClassName,TQ);class qy extends pQ{constructor(q){super(sX,sX,TX,((q,X)=>this._polymorphicDot(q,X)),qy.ClassName,q)}_polymorphicDot(q,X){switch(hQ(q)){case"Vector2":return x.k.Dot(q,X);case"Od":return x.n.Dot(q,X);case"Vector4":return x.q.Dot(q,X);default:throw new Error(`Cannot get dot product of ${q} and ${X}`)}}}qy.ClassName="FGDotBlock",(0,W.h)(qy.ClassName,qy);class Xy extends tQ{constructor(q){super(TX,(()=>Math.E),Xy.ClassName,q)}}Xy.ClassName="FGEBlock",(0,W.h)(Xy.ClassName,Xy);class Qy extends tQ{constructor(q){super(TX,(()=>Math.PI),Qy.ClassName,q)}}Qy.ClassName="FGPIBlock",(0,W.h)(Qy.ClassName,Qy);class yy extends tQ{constructor(q){super(TX,(()=>Number.POSITIVE_INFINITY),yy.ClassName,q)}}yy.ClassName="FGInfBlock",(0,W.h)(yy.ClassName,yy);class xy extends tQ{constructor(q){super(TX,(()=>Number.NaN),xy.ClassName,q)}}function uy(q,X){switch(hQ(q)){case"FlowGraphInteger":return new nX(X(q.value));case"Vector2":return new x.k(X(q.x),X(q.y));case"Od":return new x.n(X(q.x),X(q.y),X(q.z));case"Vector4":return new x.q(X(q.x),X(q.y),X(q.z),X(q.w));case"Matrix":return x.b.FromValues(X(q.m[0]),X(q.m[4]),X(q.m[8]),X(q.m[12]),X(q.m[1]),X(q.m[5]),X(q.m[9]),X(q.m[13]),X(q.m[2]),X(q.m[6]),X(q.m[10]),X(q.m[14]),X(q.m[3]),X(q.m[7]),X(q.m[11]),X(q.m[15]));default:return X(q)}}xy.ClassName="FGNaNBlock",(0,W.h)(xy.ClassName,xy);class Hy extends zQ{constructor(q){super(sX,sX,(q=>this._polymorphicAbs(q)),Hy.ClassName,q)}_polymorphicAbs(q){return uy(q,Math.abs)}}Hy.ClassName="FGAbsBlock",(0,W.h)(Hy.ClassName,Hy);class by extends zQ{constructor(q){super(sX,sX,(q=>this._polymorphicSign(q)),by.ClassName,q)}_polymorphicSign(q){return uy(q,Math.sign)}}by.ClassName="FGSignBlock",(0,W.h)(by.ClassName,by);class Dy extends zQ{constructor(q){super(sX,sX,(q=>this._polymorphicTrunc(q)),Dy.ClassName,q)}_polymorphicTrunc(q){return uy(q,Math.trunc)}}Dy.ClassName="FGTruncBlock",(0,W.h)(Dy.ClassName,Dy);class ay extends zQ{constructor(q){super(sX,sX,(q=>this._polymorphicFloor(q)),ay.ClassName,q)}_polymorphicFloor(q){return uy(q,Math.floor)}}ay.ClassName="FGFloorBlock",(0,W.h)(ay.ClassName,ay);class Ry extends zQ{constructor(q){super(sX,sX,(q=>this._polymorphicCeiling(q)),Ry.ClassName,q)}_polymorphicCeiling(q){return uy(q,Math.ceil)}}Ry.ClassName="FGCeilBlock",(0,W.h)(Ry.ClassName,Ry);class Ly extends zQ{constructor(q){super(sX,sX,(q=>this._polymorphicFract(q)),Ly.ClassName,q)}_polymorphicFract(q){return uy(q,(q=>q-Math.floor(q)))}}Ly.ClassName="FGFractBlock",(0,W.h)(Ly.ClassName,Ly);class fy extends zQ{constructor(q){super(sX,sX,(q=>this._polymorphicNeg(q)),fy.ClassName,q)}_polymorphicNeg(q){return uy(q,(q=>-q))}}function ky(q,X,Q){switch(hQ(q)){case"FlowGraphInteger":return new nX(Q(q.value,X.value));case"Vector2":return new x.k(Q(q.x,X.x),Q(q.y,X.y));case"Od":return new x.n(Q(q.x,X.x),Q(q.y,X.y),Q(q.z,X.z));case"Vector4":return new x.q(Q(q.x,X.x),Q(q.y,X.y),Q(q.z,X.z),Q(q.w,X.w));case"Matrix":return x.b.FromValues(Q(q.m[0],X.m[0]),Q(q.m[4],X.m[4]),Q(q.m[8],X.m[8]),Q(q.m[12],X.m[12]),Q(q.m[1],X.m[1]),Q(q.m[5],X.m[5]),Q(q.m[9],X.m[9]),Q(q.m[13],X.m[13]),Q(q.m[2],X.m[2]),Q(q.m[6],X.m[6]),Q(q.m[10],X.m[10]),Q(q.m[14],X.m[14]),Q(q.m[3],X.m[3]),Q(q.m[7],X.m[7]),Q(q.m[11],X.m[11]),Q(q.m[15],X.m[15]));default:return Q(q,X)}}fy.ClassName="FGNegBlock",(0,W.h)(fy.ClassName,fy);class jy extends pQ{constructor(q){super(sX,sX,sX,((q,X)=>this._polymorphicRemainder(q,X)),jy.ClassName,q)}_polymorphicRemainder(q,X){return ky(q,X,((q,X)=>q%X))}}jy.ClassName="FGRemainderBlock",(0,W.h)(jy.ClassName,jy);class Iy extends pQ{constructor(q){super(sX,sX,sX,((q,X)=>this._polymorphicMin(q,X)),Iy.ClassName,q)}_polymorphicMin(q,X){return ky(q,X,Math.min)}}Iy.ClassName="FGMinBlock",(0,W.h)(Iy.ClassName,Iy);class dy extends pQ{constructor(q){super(sX,sX,sX,((q,X)=>this._polymorphicMax(q,X)),dy.ClassName,q)}_polymorphicMax(q,X){return ky(q,X,Math.max)}}function ey(q,X,Q){return Math.min(Math.max(q,Math.min(X,Q)),Math.max(X,Q))}function iy(q,X,Q,y){switch(hQ(q)){case"FlowGraphInteger":return new nX(y(q.value,X.value,Q.value));case"Vector2":return new x.k(y(q.x,X.x,Q.x),y(q.y,X.y,Q.y));case"Od":return new x.n(y(q.x,X.x,Q.x),y(q.y,X.y,Q.y),y(q.z,X.z,Q.z));case"Vector4":return new x.q(y(q.x,X.x,Q.x),y(q.y,X.y,Q.y),y(q.z,X.z,Q.z),y(q.w,X.w,Q.w));case"Matrix":return x.b.FromValues(y(q.m[0],X.m[0],Q.m[0]),y(q.m[4],X.m[4],Q.m[4]),y(q.m[8],X.m[8],Q.m[8]),y(q.m[12],X.m[12],Q.m[12]),y(q.m[1],X.m[1],Q.m[1]),y(q.m[5],X.m[5],Q.m[5]),y(q.m[9],X.m[9],Q.m[9]),y(q.m[13],X.m[13],Q.m[13]),y(q.m[2],X.m[2],Q.m[2]),y(q.m[6],X.m[6],Q.m[6]),y(q.m[10],X.m[10],Q.m[10]),y(q.m[14],X.m[14],Q.m[14]),y(q.m[3],X.m[3],Q.m[3]),y(q.m[7],X.m[7],Q.m[7]),y(q.m[11],X.m[11],Q.m[11]),y(q.m[15],X.m[15],Q.m[15]));default:return y(q,X,Q)}}dy.ClassName="FGMaxBlock",(0,W.h)(dy.ClassName,dy);class Ay extends KQ{constructor(q){super(sX,sX,sX,sX,((q,X,Q)=>this._polymorphicClamp(q,X,Q)),Ay.ClassName,q)}_polymorphicClamp(q,X,Q){return iy(q,X,Q,ey)}}function By(q){return Math.min(Math.max(q,0),1)}Ay.ClassName="FGClampBlock",(0,W.h)(Ay.ClassName,Ay);class wy extends zQ{constructor(q){super(sX,sX,(q=>this._polymorphicSaturate(q)),wy.ClassName,q)}_polymorphicSaturate(q){return uy(q,By)}}wy.ClassName="FGSaturateBlock",(0,W.h)(wy.ClassName,wy);class Vy extends KQ{constructor(q){super(sX,sX,sX,sX,((q,X,Q)=>this._polymorphicInterpolate(q,X,Q)),Vy.ClassName,q)}_interpolate(q,X,Q){return(1-Q)*q+Q*X}_polymorphicInterpolate(q,X,Q){return iy(q,X,Q,this._interpolate)}}Vy.ClassName="FGInterpolateBlock",(0,W.h)(Vy.ClassName,Vy);class Wy extends pQ{constructor(q){super(sX,sX,qQ,((q,X)=>this._polymorphicEq(q,X)),Wy.ClassName,q)}_polymorphicEq(q,X){const Q=hQ(q),y=hQ(X);return GQ(Q,y)||CQ(Q,y)||EQ(Q,y)?q.equals(X):q===X}}function vy(q,X,Q){const y=hQ(q);if(y===hQ(X)){if(""===y)return Q(q,X);if("FlowGraphInteger"===y)return Q(q.value,X.value);throw new Error(`Cannot compare ${q} and ${X}`)}throw new Error(`${q} and ${X} are of different types.`)}Wy.ClassName="FGEqBlock",(0,W.h)(Wy.ClassName,Wy);class Zy extends pQ{constructor(q){super(sX,sX,qQ,((q,X)=>this._polymorphicLessThan(q,X)),Zy.ClassName,q)}_polymorphicLessThan(q,X){return vy(q,X,((q,X)=>q<X))}}Zy.ClassName="FGLessThanBlock",(0,W.h)(Zy.ClassName,Zy);class Uy extends pQ{constructor(q){super(sX,sX,qQ,((q,X)=>this._polymorphicLessThanOrEqual(q,X)),Uy.ClassName,q)}_polymorphicLessThanOrEqual(q,X){return vy(q,X,((q,X)=>q<=X))}}Uy.ClassName="FGLessThanOrEqualBlock";class Oy extends pQ{constructor(q){super(sX,sX,qQ,((q,X)=>this._polymorphicGreaterThan(q,X)),Oy.ClassName,q)}_polymorphicGreaterThan(q,X){return vy(q,X,((q,X)=>q>X))}}Oy.ClassName="FGGreaterThanBlock",(0,W.h)(Oy.ClassName,Oy);class gy extends pQ{constructor(q){super(sX,sX,qQ,((q,X)=>this._polymorphicGreaterThanOrEqual(q,X)),gy.ClassName,q)}_polymorphicGreaterThanOrEqual(q,X){return vy(q,X,((q,X)=>q>=X))}}gy.ClassName="FGGreaterThanOrEqualBlock",(0,W.h)(gy.ClassName,gy);class Py extends zQ{constructor(q){super(sX,qQ,(q=>this._polymorphicIsNan(q)),Py.ClassName,q)}_polymorphicIsNan(q){const X=hQ(q);if(""===X)return isNaN(q);if("FlowGraphInteger"===X)return isNaN(q.value);throw new Error(`Cannot get NaN of ${q}`)}}Py.ClassName="FGIsNanBlock",(0,W.h)(Py.ClassName,Py);class Fy extends zQ{constructor(q){super(sX,qQ,(q=>this._polymorphicIsInf(q)),Fy.ClassName,q)}_polymorphicIsInf(q){const X=hQ(q);if(""===X)return!isFinite(q);if("FlowGraphInteger"===X)return!isFinite(q.value);throw new Error(`Cannot get isInf of ${q}`)}}Fy.ClassName="FGIsInfBlock";class ly extends zQ{constructor(q){super(sX,sX,(q=>this._polymorphicDegToRad(q)),ly.ClassName,q)}_degToRad(q){return q*Math.PI/180}_polymorphicDegToRad(q){return uy(q,this._degToRad)}}ly.ClassName="FGDegToRadBlock",(0,W.h)(ly.ClassName,ly);class my extends zQ{constructor(q){super(sX,sX,(q=>this._polymorphicRadToDeg(q)),my.ClassName,q)}_radToDeg(q){return 180*q/Math.PI}_polymorphicRadToDeg(q){return uy(q,this._radToDeg)}}my.ClassName="FGRadToDegBlock",(0,W.h)(my.ClassName,my);class My extends zQ{constructor(q){super(sX,sX,(q=>this._polymorphicSin(q)),My.ClassName,q)}_polymorphicSin(q){return uy(q,Math.sin)}}My.ClassName="FGSinBlock",(0,W.h)(My.ClassName,My);class oy extends zQ{constructor(q){super(sX,sX,(q=>this._polymorphicCos(q)),oy.ClassName,q)}_polymorphicCos(q){return uy(q,Math.cos)}}oy.ClassName="FGCosBlock",(0,W.h)(oy.ClassName,oy);class Yy extends zQ{constructor(q){super(sX,sX,(q=>this._polymorphicTan(q)),Yy.ClassName,q)}_polymorphicTan(q){return uy(q,Math.tan)}}Yy.ClassName="FGTanBlock",(0,W.h)(Yy.ClassName,Yy);class Ny extends zQ{constructor(q){super(sX,sX,(q=>this._polymorphicAsin(q)),Ny.ClassName,q)}_polymorphicAsin(q){return uy(q,Math.asin)}}Ny.ClassName="FGAsinBlock",(0,W.h)(Ny.ClassName,Ny);class Sy extends zQ{constructor(q){super(sX,sX,(q=>this._polymorphicAcos(q)),Sy.ClassName,q)}_polymorphicAcos(q){return uy(q,Math.acos)}}Sy.ClassName="FGAcosBlock",(0,W.h)(Sy.ClassName,Sy);class cy extends zQ{constructor(q){super(sX,sX,(q=>this._polymorphicAtan(q)),cy.ClassName,q)}_polymorphicAtan(q){return uy(q,Math.atan)}}cy.ClassName="FGAtanBlock",(0,W.h)(cy.ClassName,cy);class py extends pQ{constructor(q){super(sX,sX,sX,((q,X)=>this._polymorphicAtan2(q,X)),py.ClassName,q)}_polymorphicAtan2(q,X){return ky(q,X,Math.atan2)}}py.ClassName="FGAtan2Block",(0,W.h)(py.ClassName,py);class ty extends zQ{constructor(q){super(sX,sX,(q=>this._polymorphicSinh(q)),ty.ClassName,q)}_polymorphicSinh(q){return uy(q,Math.sinh)}}ty.ClassName="FGSinhBlock",(0,W.h)(ty.ClassName,ty);class zy extends zQ{constructor(q){super(sX,sX,(q=>this._polymorphicCosh(q)),zy.ClassName,q)}_polymorphicCosh(q){return uy(q,Math.cosh)}}zy.ClassName="FGCoshBlock",(0,W.h)(zy.ClassName,zy);class Ky extends zQ{constructor(q){super(sX,sX,(q=>this._polymorphicTanh(q)),Ky.ClassName,q)}_polymorphicTanh(q){return uy(q,Math.tanh)}}Ky.ClassName="FGTanhBlock",(0,W.h)(Ky.ClassName,Ky);class hy extends zQ{constructor(q){super(sX,TX,(q=>this._polymorphicAsinh(q)),hy.ClassName,q)}_polymorphicAsinh(q){return uy(q,Math.asinh)}}hy.ClassName="FGAsinhBlock",(0,W.h)(hy.ClassName,hy);class Gy extends zQ{constructor(q){super(sX,TX,(q=>this._polymorphicAcosh(q)),Gy.ClassName,q)}_polymorphicAcosh(q){return uy(q,Math.acosh)}}Gy.ClassName="FGAcoshBlock",(0,W.h)(Gy.ClassName,Gy);class Cy extends zQ{constructor(q){super(sX,TX,(q=>this._polymorphicAtanh(q)),Cy.ClassName,q)}_polymorphicAtanh(q){return uy(q,Math.atanh)}}Cy.ClassName="FGAtanhBlock",(0,W.h)(Cy.ClassName,Cy);class Ey extends zQ{constructor(q){super(sX,TX,(q=>this._polymorphicExp(q)),Ey.ClassName,q)}_polymorphicExp(q){return uy(q,Math.exp)}}Ey.ClassName="FGExpBlock",(0,W.h)(Ey.ClassName,Ey);class Jy extends zQ{constructor(q){super(sX,TX,(q=>this._polymorphicLog(q)),Jy.ClassName,q)}_polymorphicLog(q){return uy(q,Math.log)}}Jy.ClassName="FGLogBlock",(0,W.h)(Jy.ClassName,Jy);class ny extends zQ{constructor(q){super(sX,TX,(q=>this._polymorphicLog2(q)),ny.ClassName,q)}_polymorphicLog2(q){return uy(q,Math.log2)}}ny.ClassName="FGLog2Block",(0,W.h)(ny.ClassName,ny);class ry extends zQ{constructor(q){super(sX,TX,(q=>this._polymorphicLog10(q)),ry.ClassName,q)}_polymorphicLog10(q){return uy(q,Math.log10)}}ry.ClassName="FGLog10Block",(0,W.h)(ry.ClassName,ry);class sy extends zQ{constructor(q){super(sX,TX,(q=>this._polymorphicSqrt(q)),sy.ClassName,q)}_polymorphicSqrt(q){return uy(q,Math.sqrt)}}sy.ClassName="FGSqrtBlock",(0,W.h)(sy.ClassName,sy);class Ty extends zQ{constructor(q){super(sX,TX,(q=>this._polymorphicCubeRoot(q)),Ty.ClassName,q)}_polymorphicCubeRoot(q){return uy(q,Math.cbrt)}}Ty.ClassName="FGCubeRootBlock",(0,W.h)(Ty.ClassName,Ty);class qx extends pQ{constructor(q){super(sX,TX,TX,((q,X)=>this._polymorphicPow(q,X)),qx.ClassName,q)}_polymorphicPow(q,X){return ky(q,X,Math.pow)}}qx.ClassName="FGPowBlock",(0,W.h)(qx.ClassName,qx);class Xx extends zQ{constructor(q){super(sX,TX,(q=>this._polymorphicLength(q)),Xx.ClassName,q)}_polymorphicLength(q){switch(hQ(q)){case"Vector2":case"Od":case"Vector4":return q.length();default:throw new Error(`Cannot compute length of value ${q}`)}}}Xx.ClassName="FGLengthBlock",(0,W.h)(Xx.ClassName,Xx);class Qx extends zQ{constructor(q){super(sX,sX,(q=>this._polymorphicNormalize(q)),Qx.ClassName,q)}_polymorphicNormalize(q){switch(hQ(q)){case"Vector2":case"Od":case"Vector4":return q.normalize();default:throw new Error(`Cannot normalize value ${q}`)}}}Qx.ClassName="FGNormalizeBlock",(0,W.h)(Qx.ClassName,Qx);class yx extends pQ{constructor(q){super(QQ,QQ,QQ,((q,X)=>x.n.Cross(q,X)),yx.ClassName,q)}}yx.ClassName="FGCrossBlock",(0,W.h)(yx.ClassName,yx);class xx extends pQ{constructor(q){super(XQ,TX,XQ,((q,X)=>x.k.Transform(q,x.b.RotationZ(X))),xx.ClassName,q)}}xx.ClassName="FGRotate2DBlock",(0,W.h)(xx.ClassName,xx);class ux extends KQ{constructor(q){super(QQ,QQ,TX,QQ,((q,X,Q)=>x.n.TransformCoordinates(q,x.b.RotationAxis(X,Q))),ux.ClassName,q)}}ux.ClassName="FGRotate3DBlock",(0,W.h)(ux.ClassName,ux);class Hx extends zQ{constructor(q){super(yQ,yQ,(q=>x.b.Transpose(q)),Hx.ClassName,q)}}Hx.ClassName="FGTransposeBlock",(0,W.h)(Hx.ClassName,Hx);class bx extends zQ{constructor(q){super(yQ,TX,(q=>q.determinant()),bx.ClassName,q)}}bx.ClassName="FGDeterminantBlock",(0,W.h)(bx.ClassName,bx);class Dx extends zQ{constructor(q){super(yQ,yQ,(q=>x.b.Invert(q)),Dx.ClassName,q)}}Dx.ClassName="FGInvertMatrixBlock",(0,W.h)(Dx.ClassName,Dx);class ax extends pQ{constructor(q){super(yQ,yQ,yQ,((q,X)=>X.multiply(q)),ax.ClassName,q)}}ax.ClassName="FGMatMulBlock",(0,W.h)(ax.ClassName,ax);class Rx extends zQ{constructor(q){super(xQ,xQ,(q=>new nX(~q.value)),Rx.ClassName,q)}}Rx.ClassName="FGBitwiseNotBlock",(0,W.h)(Rx.ClassName,Rx);class Lx extends pQ{constructor(q){super(xQ,xQ,xQ,((q,X)=>new nX(q.value&X.value)),Lx.ClassName,q)}}Lx.ClassName="FGBitwiseAndBlock",(0,W.h)(Lx.ClassName,Lx);class fx extends pQ{constructor(q){super(xQ,xQ,xQ,((q,X)=>new nX(q.value|X.value)),fx.ClassName,q)}}fx.ClassName="FGBitwiseOrBlock",(0,W.h)(fx.ClassName,fx);class kx extends pQ{constructor(q){super(xQ,xQ,xQ,((q,X)=>new nX(q.value^X.value)),kx.ClassName,q)}}kx.ClassName="FGBitwiseXorBlock",(0,W.h)(kx.ClassName,kx);class jx extends pQ{constructor(q){super(xQ,xQ,xQ,((q,X)=>new nX(q.value<<X.value)),jx.ClassName,q)}}jx.ClassName="FGBitwiseLeftShiftBlock",(0,W.h)(jx.ClassName,jx);class Ix extends pQ{constructor(q){super(xQ,xQ,xQ,((q,X)=>new nX(q.value>>X.value)),Ix.ClassName,q)}}Ix.ClassName="FGBitwiseRightShiftBlock",(0,W.h)(Ix.ClassName,Ix);class dx extends zQ{constructor(q){super(xQ,xQ,(q=>new nX(Math.clz32(q.value))),dx.ClassName,q)}}dx.ClassName="FGCountLeadingZerosBlock",(0,W.h)(dx.ClassName,dx);class ex extends zQ{constructor(q){super(xQ,xQ,(q=>new nX(q.value?31-Math.clz32(q.value&-q.value):32)),ex.ClassName,q)}}ex.ClassName="FGCountTrailingZerosBlock",(0,W.h)(ex.ClassName,ex);class ix extends zQ{constructor(q){super(xQ,xQ,(q=>new nX(function(q){let X=0;for(;q;)X+=1&q,q>>=1;return X}(q.value))),ix.ClassName,q)}}ix.ClassName="FGCountOneBitsBlock",(0,W.h)(ix.ClassName,ix);class Ax extends ZQ{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{startIndex:new nX(0)};super(q),this.config=q,this.reset=this._registerSignalInput("reset"),this.n=this.registerDataInput("n",xQ),this.value=this.registerDataOutput("value",xQ)}_execute(q,X){if(X===this.reset)this.value.setValue(this.config.startIndex,q);else{const X=this.value.getValue(q);X.value<this.n.getValue(q).value&&(this.value.setValue(new nX(X.value+1),q),this.out._activateSignal(q))}}getClassName(){return Ax.ClassName}}Ax.ClassName="FGDoNBlock",(0,W.h)(Ax.ClassName,Ax);class Bx extends RQ{constructor(q){super(q),this.config=q,this.output=this.registerDataOutput(q.variableName,sX)}_updateOutputs(q){const X=this.config.variableName;q.hasVariable(X)&&this.output.setValue(q.getVariable(X),q)}getClassName(){return Bx.ClassName}serialize(q){super.serialize(q),q.config.variableName=this.config.variableName}}Bx.ClassName="FGGetVariableBlock",(0,W.h)(Bx.ClassName,Bx);class wx extends ZQ{constructor(q){super(q),this.config=q,this.input=this.registerDataInput(q.variableName,sX)}_execute(q){const X=this.config.variableName,Q=this.input.getValue(q);q.setVariable(X,Q),this.out._activateSignal(q)}getClassName(){return wx.ClassName}}wx.ClassName="FGSetVariableBlock",(0,W.h)(wx.ClassName,wx);class Vx extends ZQ{constructor(q){super(q),this.config=q,this.condition=this.registerDataInput("condition",qQ),this.loopBody=this._registerSignalOutput("loopBody")}_execute(q,X){var Q;let y=this.condition.getValue(q);for(null!==(Q=this.config)&&void 0!==Q&&Q.isDo&&!y&&this.loopBody._activateSignal(q);y;)this.loopBody._activateSignal(q),y=this.condition.getValue(q);this.out._activateSignal(q)}getClassName(){return Vx.ClassName}serialize(q){var X;super.serialize(q),q.isDo=null===(X=this.config)||void 0===X?void 0:X.isDo}}Vx.ClassName="FGWhileLoopBlock",(0,W.h)(Vx.ClassName,Vx);const Wx={"lifecycle/onStart":WQ.ClassName,"lifecycle/onTick":vQ.ClassName,log:UQ.ClassName,"flow/delay":gQ.ClassName,"customEvent/send":PQ.ClassName,"customEvent/receive":FQ.ClassName,"flow/sequence":lQ.ClassName,"world/get":oQ.ClassName,"world/set":YQ.ClassName,"flow/doN":Ax.ClassName,"variable/get":Bx.ClassName,"variable/set":wx.ClassName,"flow/whileLoop":Vx.ClassName,"math/random":TQ.ClassName,"math/e":Xy.ClassName,"math/pi":Qy.ClassName,"math/inf":yy.ClassName,"math/nan":xy.ClassName,"math/abs":Hy.ClassName,"math/sign":by.ClassName,"math/trunc":Dy.ClassName,"math/floor":ay.ClassName,"math/ceil":Ry.ClassName,"math/fract":Ly.ClassName,"math/neg":fy.ClassName,"math/add":JQ.ClassName,"math/sub":nQ.ClassName,"math/mul":rQ.ClassName,"math/div":sQ.ClassName,"math/rem":jy.ClassName,"math/min":Iy.ClassName,"math/max":dy.ClassName,"math/clamp":Ay.ClassName,"math/saturate":wy.ClassName,"math/mix":Vy.ClassName,"math/eq":Wy.ClassName,"math/lt":Zy.ClassName,"math/le":Uy.ClassName,"math/gt":Oy.ClassName,"math/ge":gy.ClassName,"math/isnan":Py.ClassName,"math/isinf":Fy.ClassName,"math/rad":ly.ClassName,"math/deg":my.ClassName,"math/sin":My.ClassName,"math/cos":oy.ClassName,"math/tan":Yy.ClassName,"math/asin":Ny.ClassName,"math/acos":Sy.ClassName,"math/atan":cy.ClassName,"math/atan2":py.ClassName,"math/sinh":ty.ClassName,"math/cosh":zy.ClassName,"math/tanh":Ky.ClassName,"math/asinh":hy.ClassName,"math/acosh":Gy.ClassName,"math/atanh":Cy.ClassName,"math/exp":Ey.ClassName,"math/log":Jy.ClassName,"math/log2":ny.ClassName,"math/log10":ry.ClassName,"math/sqrt":sy.ClassName,"math/cbrt":Ty.ClassName,"math/pow":qx.ClassName,"math/length":Xx.ClassName,"math/normalize":Qx.ClassName,"math/dot":qy.ClassName,"math/cross":yx.ClassName,"math/rotate2d":xx.ClassName,"math/rotate3d":ux.ClassName,"math/transpose":Hx.ClassName,"math/determinant":bx.ClassName,"math/inverse":Dx.ClassName,"math/matmul":ax.ClassName,"math/not":Rx.ClassName,"math/and":Lx.ClassName,"math/or":fx.ClassName,"math/xor":kx.ClassName,"math/asr":Ix.ClassName,"math/lsl":jx.ClassName,"math/clz":dx.ClassName,"math/ctz":ex.ClassName,"math/popcnt":ix.ClassName},vx={float2:"Vector2",float3:"Od",float4:"Vector4",float4x4:"Matrix",int:"FlowGraphInteger"};function Zx(q,X,Q){if(void 0!==q.type){const y=X.types&&X.types[q.type];if(!y)throw new Error(`${Q}: Unknown type: ${q.type}`);const x=y.signature;if(!x)throw new Error(`${Q}: Type ${q.type} has no signature`);const u=vx[x];return{value:q.value,className:u}}return q.value}function Ux(q,X,Q){const y=Wx[X.type];if(!y)throw new Error(`/extensions/KHR_interactivity/nodes/${q}: Unknown block type: ${X.type}`);const x=q.toString(),u=function(q,X,Q){const y={},x=q.configuration??[];for(const u of x)if("customEvent"===u.id){const q=X.customEvents&&X.customEvents[u.value];if(!q)throw new Error(`/extensions/KHR_interactivity/nodes/${Q}: Unknown custom event: ${u.value}`);y.eventId=q.id,y.eventData=q.values.map((q=>q.id))}else if("variable"===u.id){const q=X.variables&&X.variables[u.value];if(!q)throw new Error(`/extensions/KHR_interactivity/nodes/${Q}: Unknown variable: ${u.value}`);y.variableName=q.id}else if("path"===u.id){const q=u.value;y.path=q}else y[u.id]=Zx(u,X,`/extensions/KHR_interactivity/nodes/${Q}`);return y}(X,Q,x);return{className:y,config:u,uniqueId:x,metadata:X.metadata,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[]}}class Ox extends WX{constructor(q){super(q,Px)}}const gx={__array__:{__target__:!0,translation:{type:"Od",get:q=>q._babylonTransformNode.position,set:(q,X)=>{X._babylonTransformNode.position=q},getObject:q=>q._babylonTransformNode}}},Px={nodes:gx},Fx="KHR_interactivity";class lx{constructor(q){this._loader=q,this.name=Fx,this.enabled=this._loader.isExtensionUsed(Fx),this._pathConverter=new Ox(this._loader.Wi)}dispose(){this._loader=null,delete this._pathConverter}onReady(){var q;if(!this._loader.babylonScene||!this._pathConverter)return;const X=this._loader.babylonScene,Q=function(q){const X={uniqueId:(0,EX.d)(),_userVariables:{},_connectionValues:{}},Q=[X],y=[];for(let u=0;u<q.nodes.length;u++){const X=Ux(u,q.nodes[u],q);y.push(X)}for(let u=0;u<q.nodes.length;u++){const Q=q.nodes[u],x=y[u],H=Q.flows??[];for(const q of H){const X=q.id,Q={uniqueId:(0,EX.d)(),name:X,_connectionType:1,connectedPointIds:[]};x.signalOutputs.push(Q);const H=q.node,b=q.socket,D=y[H];if(!D)throw new Error(`/extensions/KHR_interactivity/nodes/${u}: Could not find node with id ${H} that connects its input with with node ${u}'s output ${X}`);let a=D.signalInputs.find((q=>q.name===b));a||(a={uniqueId:(0,EX.d)(),name:b,_connectionType:0,connectedPointIds:[]},D.signalInputs.push(a)),a.connectedPointIds.push(Q.uniqueId),Q.connectedPointIds.push(a.uniqueId)}const b=Q.values??[];for(const D of b){const Q=D.id,H={uniqueId:(0,EX.d)(),name:Q,_connectionType:0,connectedPointIds:[]};if(x.dataInputs.push(H),void 0!==D.value){const Q=Zx(D,q,`/extensions/KHR_interactivity/nodes/${u}`);X._connectionValues[H.uniqueId]=Q}else{if(void 0===D.node||void 0===D.socket)throw new Error(`/extensions/KHR_interactivity/nodes/${u}: Invalid socket ${Q} in node ${u}`);{const q=D.node,X=D.socket,x=y[q];if(!x)throw new Error(`/extensions/KHR_interactivity/nodes/${u}: Could not find node with id ${q} that connects its output with node${u}'s input ${Q}`);let b=x.dataOutputs.find((q=>q.name===X));b||(b={uniqueId:(0,EX.d)(),name:X,_connectionType:1,connectedPointIds:[]},x.dataOutputs.push(b)),H.connectedPointIds.push(b.uniqueId),b.connectedPointIds.push(H.uniqueId)}}}}const x=q.variables??[];for(let u=0;u<x.length;u++){const Q=x[u],y=Q.id;X._userVariables[y]=Zx(Q,q,`/extensions/KHR_interactivity/variables/${u}`)}return{allBlocks:y,executionContexts:Q}}(null===(q=this._loader.Wi.extensions)||void 0===q?void 0:q.KHR_interactivity),y=new VQ({Le:X});wQ.Parse(Q,{coordinator:y,pathConverter:this._pathConverter}),y.start()}}E(Fx),C(Fx,!0,(q=>new lx(q)));const mx="KHR_node_visibility";class Mx{constructor(q){this.name=mx,this._loader=q,this.enabled=q.isExtensionUsed(mx)}async onReady(){var q;null===(q=this._loader.Wi.nodes)||void 0===q||q.forEach((q=>{var X,Q,y,x;(null===(X=q._primitiveBabylonMeshes)||void 0===X||X.forEach((q=>{q.inheritVisibility=!0})),null!==(Q=q.extensions)&&void 0!==Q&&Q.KHR_node_visibility)&&(!1===(null===(y=q.extensions)||void 0===y?void 0:y.KHR_node_visibility.visible)&&(q._babylonTransformNode&&(q._babylonTransformNode.isVisible=!1),null===(x=q._primitiveBabylonMeshes)||void 0===x||x.forEach((q=>{q.isVisible=!1}))))}))}dispose(){this._loader=null}}E(mx),C(mx,!0,(q=>new Mx(q)));const ox="ExtrasAsMetadata";class Yx{_assignExtras(q,X){if(X.extras&&Object.keys(X.extras).length>0){const Q=q.metadata=q.metadata||{};(Q.Wi=Q.Wi||{}).extras=X.extras}}constructor(q){this.name=ox,this.enabled=!0,this._loader=q}dispose(){this._loader=null}loadNodeAsync(q,X,Q){return this._loader.loadNodeAsync(q,X,(q=>{this._assignExtras(q,X),Q(q)}))}loadCameraAsync(q,X,Q){return this._loader.loadCameraAsync(q,X,(q=>{this._assignExtras(q,X),Q(q)}))}createMaterial(q,X,Q){const y=this._loader.createMaterial(q,X,Q);return this._assignExtras(y,X),y}}E(ox),C(ox,!1,(q=>new Yx(q)))},11903:(q,X,Q)=>{"use strict";Q.d(X,{e:()=>F,h:()=>v,i:()=>W,j:()=>Z});var y=Q(998),x=Q(1215),u=Q(11364),H=Q(11253),b=Q(11298),D=Q(11291),a=Q(1099),R=Q(1028),L=Q(11907),f=Q(11911),k=Q(11265);class j{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.je=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.Te=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(q){this._environmentTexture=q}getNodes(){let q=[];return q=q.concat(this.meshes),q=q.concat(this.lights),q=q.concat(this.cameras),q=q.concat(this.transformNodes),this.skeletons.forEach((X=>q=q.concat(X.bones))),q}}class I extends j{}class d{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){this.rootNodes.slice(0).forEach((q=>{q.dispose()})),this.rootNodes.length=0,this.skeletons.slice(0).forEach((q=>{q.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((q=>{q.dispose()})),this.animationGroups.length=0}}class e extends j{constructor(q){super(),this._wasAddedToScene=!1,(q=q||R.c.LastCreatedScene)&&(this.Le=q,this.proceduralTextures=[],q._d.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=q.getEngine().onContextRestoredObservable.add((()=>{for(const q of this.geometries)q._rebuild();for(const q of this.meshes)q._rebuild();for(const q of this.je)q.rebuild();for(const q of this.textures)q._rebuild()})))}_topologicalSort(q){const X=new Map;for(const H of q)X.set(H.uniqueId,H);const Q={dependsOn:new Map,dependedBy:new Map};for(const H of q){const q=H.uniqueId;Q.dependsOn.set(q,new Set),Q.dependedBy.set(q,new Set)}for(const H of q){const q=H.uniqueId,y=Q.dependsOn.get(q);if(H instanceof L.d){const x=H.sourceMesh;X.has(x.uniqueId)&&(y.add(x.uniqueId),Q.dependedBy.get(x.uniqueId).add(q))}const x=Q.dependedBy.get(q);for(const u of H.getDescendants()){const y=u.uniqueId;if(X.has(y)){x.add(y);Q.dependsOn.get(y).add(q)}}}const y=[],x=[];for(const H of q){const q=H.uniqueId;0===Q.dependsOn.get(q).size&&(x.push(H),X.delete(q))}const u=x;for(;u.length>0;){const q=u.shift();y.push(q);const x=Q.dependedBy.get(q.uniqueId);for(const y of Array.from(x.values())){const x=Q.dependsOn.get(y);x.delete(q.uniqueId),0===x.size&&X.get(y)&&(u.push(X.get(y)),X.delete(y))}}return X.size>0&&(a.b.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),X.forEach((q=>a.b.Error(q.name)))),y}_addNodeAndDescendantsToList(q,X,Q,y){if(Q&&(!y||y(Q))&&!X.has(Q.uniqueId)){q.push(Q),X.add(Q.uniqueId);for(const x of Q.getDescendants(!0))this._addNodeAndDescendantsToList(q,X,x,y)}}_isNodeInContainer(q){return q instanceof D.c&&-1!==this.meshes.indexOf(q)||(q instanceof b.c&&-1!==this.transformNodes.indexOf(q)||(q instanceof f.b&&-1!==this.lights.indexOf(q)||q instanceof k.c&&-1!==this.cameras.indexOf(q)))}_isValidHierarchy(){for(const q of this.meshes)if(q.parent&&!this._isNodeInContainer(q.parent))return a.b.Warn(`Node ${q.name} has a parent that is not in the container.`),!1;for(const q of this.transformNodes)if(q.parent&&!this._isNodeInContainer(q.parent))return a.b.Warn(`Node ${q.name} has a parent that is not in the container.`),!1;for(const q of this.lights)if(q.parent&&!this._isNodeInContainer(q.parent))return a.b.Warn(`Node ${q.name} has a parent that is not in the container.`),!1;for(const q of this.cameras)if(q.parent&&!this._isNodeInContainer(q.parent))return a.b.Warn(`Node ${q.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(q){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Q=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||x.f.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const y={},u={},b=new d,D=[],a=[],R={doNotInstantiate:!0,...Q},L=[],f=new Set;for(const x of this.transformNodes)null===x.parent&&this._addNodeAndDescendantsToList(L,f,x,R.predicate);for(const x of this.meshes)null===x.parent&&this._addNodeAndDescendantsToList(L,f,x,R.predicate);const k=this._topologicalSort(L),j=(Q,x)=>{if(((X,Q)=>{if(y[X.uniqueId]=Q.uniqueId,u[Q.uniqueId]=Q,q&&(Q.name=q(X.name)),Q instanceof H.b){const q=Q;if(q.morphTargetManager){const Q=X.morphTargetManager;q.morphTargetManager=Q.clone();for(let X=0;X<Q.numTargets;X++){const x=Q.getTarget(X),H=q.morphTargetManager.getTarget(X);y[x.uniqueId]=H.uniqueId,u[H.uniqueId]=H}}}})(Q,x),Q.parent){const q=y[Q.parent.uniqueId],X=u[q];x.parent=X||Q.parent}if(x.position&&Q.position&&x.position.p(Q.position),x.rotationQuaternion&&Q.rotationQuaternion&&x.rotationQuaternion.p(Q.rotationQuaternion),x.rotation&&Q.rotation&&x.rotation.p(Q.rotation),x.He&&Q.He&&x.He.p(Q.He),x.material){const H=x;if(H.material)if(X){const X=Q.material;if(-1===a.indexOf(X)){let Q=X.clone(q?q(X.name):"Clone of "+X.name);if(a.push(X),y[X.uniqueId]=Q.uniqueId,u[Q.uniqueId]=Q,"MultiMaterial"===X.getClassName()){const x=X;for(const X of x.sg)X&&(Q=X.clone(q?q(X.name):"Clone of "+X.name),a.push(X),y[X.uniqueId]=Q.uniqueId,u[Q.uniqueId]=Q);x.sg=x.sg.map((q=>q&&u[y[q.uniqueId]]))}}"InstancedMesh"!==H.getClassName()&&(H.material=u[y[X.uniqueId]])}else"MultiMaterial"===H.material.getClassName()?-1===this.Le.multiMaterials.indexOf(H.material)&&this.Le.addMultiMaterial(H.material):-1===this.Le.materials.indexOf(H.material)&&this.Le.addMaterial(H.material)}null===x.parent&&b.rootNodes.push(x)};return k.forEach((q=>{if("InstancedMesh"===q.getClassName()){const X=q,Q=X.sourceMesh,x=y[Q.uniqueId],H=("number"===typeof x?u[x]:Q).kd(X.name);j(X,H)}else{let X=!0;"qb"===q.getClassName()||"Node"===q.getClassName()||q.skeleton||!q.getTotalVertices||0===q.getTotalVertices()?X=!1:R.doNotInstantiate&&(X="function"===typeof R.doNotInstantiate?!R.doNotInstantiate(q):!R.doNotInstantiate);const Q=X?q.kd(`instance of ${q.name}`):q.clone(`Clone of ${q.name}`,null,!0);if(!Q)throw new Error(`Could not clone or instantiate node on Asset Container ${q.name}`);j(q,Q)}})),this.skeletons.forEach((X=>{if(R.predicate&&!R.predicate(X))return;const Q=X.clone(q?q(X.name):"Clone of "+X.name);for(const q of this.meshes)if(q.skeleton===X&&!q.isAnInstance){const X=u[y[q.uniqueId]];if(!X||X.isAnInstance)continue;if(X.skeleton=Q,-1!==D.indexOf(Q))continue;D.push(Q);for(const q of Q.bones)q._linkedTransformNode&&(q._linkedTransformNode=u[y[q._linkedTransformNode.uniqueId]])}b.skeletons.push(Q)})),this.animationGroups.forEach((X=>{if(R.predicate&&!R.predicate(X))return;const Q=X.clone(q?q(X.name):"Clone of "+X.name,(q=>u[y[q.uniqueId]]||q));b.animationGroups.push(Q)})),b}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||x.f.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.Le.environmentTexture=this.environmentTexture);for(const q of this.Le._serializableComponents)q.addFromContainer(this);this.Le.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const X=[];this.cameras.forEach((Q=>{q&&!q(Q)||(this.Le.addCamera(Q),X.push(Q))})),this.lights.forEach((Q=>{q&&!q(Q)||(this.Le.addLight(Q),X.push(Q))})),this.meshes.forEach((Q=>{q&&!q(Q)||(this.Le.Ve(Q),X.push(Q))})),this.skeletons.forEach((X=>{q&&!q(X)||this.Le.addSkeleton(X)})),this.animations.forEach((X=>{q&&!q(X)||this.Le.addAnimation(X)})),this.animationGroups.forEach((X=>{q&&!q(X)||this.Le.addAnimationGroup(X)})),this.multiMaterials.forEach((X=>{q&&!q(X)||this.Le.addMultiMaterial(X)})),this.materials.forEach((X=>{q&&!q(X)||this.Le.addMaterial(X)})),this.morphTargetManagers.forEach((X=>{q&&!q(X)||this.Le.addMorphTargetManager(X)})),this.geometries.forEach((X=>{q&&!q(X)||this.Le.addGeometry(X)})),this.transformNodes.forEach((Q=>{q&&!q(Q)||(this.Le.addTransformNode(Q),X.push(Q))})),this.actionManagers.forEach((X=>{q&&!q(X)||this.Le.addActionManager(X)})),this.textures.forEach((X=>{q&&!q(X)||this.Le.addTexture(X)})),this.reflectionProbes.forEach((X=>{q&&!q(X)||this.Le.addReflectionProbe(X)}));for(const Q of X)Q.parent&&-1===this.Le.getNodes().indexOf(Q.parent)&&(Q.setParent?Q.setParent(null):Q.parent=null)}removeAllFromScene(){this._isValidHierarchy()||x.f.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.Le.environmentTexture&&(this.Le.environmentTexture=null);for(const q of this.Le._serializableComponents)q.removeFromContainer(this)}removeFromScene(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.cameras.forEach((X=>{q&&!q(X)||this.Le.removeCamera(X)})),this.lights.forEach((X=>{q&&!q(X)||this.Le.removeLight(X)})),this.meshes.forEach((X=>{q&&!q(X)||this.Le.Xe(X,!0)})),this.skeletons.forEach((X=>{q&&!q(X)||this.Le.removeSkeleton(X)})),this.animations.forEach((X=>{q&&!q(X)||this.Le.removeAnimation(X)})),this.animationGroups.forEach((X=>{q&&!q(X)||this.Le.removeAnimationGroup(X)})),this.multiMaterials.forEach((X=>{q&&!q(X)||this.Le.removeMultiMaterial(X)})),this.materials.forEach((X=>{q&&!q(X)||this.Le.removeMaterial(X)})),this.morphTargetManagers.forEach((X=>{q&&!q(X)||this.Le.removeMorphTargetManager(X)})),this.geometries.forEach((X=>{q&&!q(X)||this.Le.removeGeometry(X)})),this.transformNodes.forEach((X=>{q&&!q(X)||this.Le.removeTransformNode(X)})),this.actionManagers.forEach((X=>{q&&!q(X)||this.Le.removeActionManager(X)})),this.textures.forEach((X=>{q&&!q(X)||this.Le.removeTexture(X)})),this.reflectionProbes.forEach((X=>{q&&!q(X)||this.Le.removeReflectionProbe(X)}))}dispose(){this.cameras.slice(0).forEach((q=>{q.dispose()})),this.cameras.length=0,this.lights.slice(0).forEach((q=>{q.dispose()})),this.lights.length=0,this.meshes.slice(0).forEach((q=>{q.dispose()})),this.meshes.length=0,this.skeletons.slice(0).forEach((q=>{q.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((q=>{q.dispose()})),this.animationGroups.length=0,this.multiMaterials.slice(0).forEach((q=>{q.dispose()})),this.multiMaterials.length=0,this.materials.slice(0).forEach((q=>{q.dispose()})),this.materials.length=0,this.geometries.slice(0).forEach((q=>{q.dispose()})),this.geometries.length=0,this.transformNodes.slice(0).forEach((q=>{q.dispose()})),this.transformNodes.length=0,this.actionManagers.slice(0).forEach((q=>{q.dispose()})),this.actionManagers.length=0,this.textures.slice(0).forEach((q=>{q.dispose()})),this.textures.length=0,this.reflectionProbes.slice(0).forEach((q=>{q.dispose()})),this.reflectionProbes.length=0,this.morphTargetManagers.slice(0).forEach((q=>{q.dispose()})),this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const q of this.Le._serializableComponents)q.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.Le.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(q,X,Q){if(q&&X)for(const y of q){let q=!0;if(Q)for(const X of Q)if(y===X){q=!1;break}q&&(X.push(y),y._parentContainer=this)}}moveAllFromScene(q){this._wasAddedToScene=!1,void 0===q&&(q=new I);for(const X in this)Object.prototype.hasOwnProperty.call(this,X)&&(this[X]=this[X]||("_environmentTexture"===X?null:[]),this._moveAssets(this.Le[X],this[X],q[X]));this.environmentTexture=this.Le.environmentTexture,this.removeAllFromScene()}createRootMesh(){const q=new H.b("assetContainerRootMesh",this.Le);return this.meshes.forEach((X=>{X.parent||q.addChild(X)})),this.meshes.unshift(q),q}mergeAnimationsTo(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:R.c.LastCreatedScene,X=arguments.length>1?arguments[1]:void 0,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!q)return a.b.Error("No scene available to merge animations to"),[];const y=Q||(X=>{let Q=null;const y=X.animations.length?X.animations[0].targetProperty:"",x=X.name.split(".").join("").split("_primitive")[0];switch(y){case"position":case"rotationQuaternion":Q=q.getTransformNodeByName(X.name)||q.getTransformNodeByName(x);break;case"influence":Q=q.getMorphTargetByName(X.name)||q.getMorphTargetByName(x);break;default:Q=q.getNodeByName(X.name)||q.getNodeByName(x)}return Q});this.getNodes().forEach((q=>{const X=y(q);if(null!==X){for(const Q of q.animations){const q=X.animations.filter((q=>q.targetProperty===Q.targetProperty));for(const Q of q){const q=X.animations.indexOf(Q,0);q>-1&&X.animations.splice(q,1)}}X.animations=X.animations.concat(q.animations)}}));const x=[];return this.animationGroups.slice().forEach((q=>{x.push(q.clone(q.name,y)),q.animatables.forEach((q=>{q.stop()}))})),X.forEach((X=>{const Q=y(X.target);Q&&(q.beginAnimation(Q,X.fromFrame,X.toFrame,X.loopAnimation,X.speedRatio,X.onAnimationEnd?X.onAnimationEnd:void 0,void 0,!0,void 0,X.onAnimationLoop?X.onAnimationLoop:void 0),q.stopAnimation(X.target))})),x}populateRootNodes(){this.rootNodes.length=0,this.meshes.forEach((q=>{q.parent||-1!==this.rootNodes.indexOf(q)||this.rootNodes.push(q)})),this.transformNodes.forEach((q=>{q.parent||-1!==this.rootNodes.indexOf(q)||this.rootNodes.push(q)})),this.lights.forEach((q=>{q.parent||-1!==this.rootNodes.indexOf(q)||this.rootNodes.push(q)})),this.cameras.forEach((q=>{q.parent||-1!==this.rootNodes.indexOf(q)||this.rootNodes.push(q)}))}addAllAssetsToContainer(q){if(!q)return;const X=[],Q=new Set;for(X.push(q);X.length>0;){const q=X.pop();if(q instanceof H.b?(q.ze&&-1===this.geometries.indexOf(q.ze)&&this.geometries.push(q.ze),this.meshes.push(q)):q instanceof b.c?this.transformNodes.push(q):q instanceof f.b?this.lights.push(q):q instanceof k.c&&this.cameras.push(q),q instanceof D.c){if(q.material&&-1===this.materials.indexOf(q.material)){this.materials.push(q.material);for(const X of q.material.getActiveTextures())-1===this.textures.indexOf(X)&&this.textures.push(X)}q.skeleton&&-1===this.skeletons.indexOf(q.skeleton)&&this.skeletons.push(q.skeleton),q.morphTargetManager&&-1===this.morphTargetManagers.indexOf(q.morphTargetManager)&&this.morphTargetManagers.push(q.morphTargetManager)}for(const y of q.getChildren())Q.has(y)||X.push(y);Q.add(q)}this.populateRootNodes()}}var i=Q(1067);class A{constructor(q){this.byteOffset=0,this.buffer=q}loadAsync(q){return this.buffer.readAsync(this.byteOffset,q).then((q=>{this._dataView=new DataView(q.buffer,q.byteOffset,q.byteLength),this._dataByteOffset=0}))}readUint32(){const q=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,q}readUint8Array(q){const X=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,q);return this._dataByteOffset+=q,this.byteOffset+=q,X}readString(q){return(0,i.f)(this.readUint8Array(q))}skipBytes(q){this._dataByteOffset+=q,this.byteOffset+=q}}var B=Q(11916);const w="Z2xURg",V={name:"Wi",extensions:{".gltf":{isBinary:!1},".glb":{isBinary:!0}},canDirectLoad:q=>-1!==q.indexOf("asset")&&-1!==q.indexOf("version")||q.startsWith("data:base64,"+w)||q.startsWith("data:;base64,"+w)||q.startsWith("data:application/octet-stream;base64,"+w)||q.startsWith("data:model/gltf-binary;base64,"+w)};var W,v,Z,U=Q(1055),O=Q(1065);function g(q,X,Q){try{return Promise.resolve(new Uint8Array(q,X,Q))}catch(y){return Promise.reject(y)}}!function(q){q[q.AUTO=0]="AUTO",q[q.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(W||(W={})),function(q){q[q.NONE=0]="NONE",q[q.FIRST=1]="FIRST",q[q.ALL=2]="ALL"}(v||(v={})),function(q){q[q.LOADING=0]="LOADING",q[q.READY=1]="READY",q[q.COMPLETE=2]="COMPLETE"}(Z||(Z={}));class P{constructor(){this.coordinateSystemMode=W.AUTO,this.animationStartMode=v.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=q=>Promise.resolve(q),this.extensionOptions={}}p(q){q&&(this.onParsed=q.onParsed,this.coordinateSystemMode=q.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=q.animationStartMode??this.animationStartMode,this.loadNodeAnimations=q.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=q.loadSkins??this.loadSkins,this.loadMorphTargets=q.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=q.compileMaterials??this.compileMaterials,this.useClipPlane=q.useClipPlane??this.useClipPlane,this.compileShadowGenerators=q.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=q.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=q.useRangeRequests??this.useRangeRequests,this.createInstances=q.createInstances??this.createInstances,this.alwaysComputeBoundingBox=q.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=q.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=q.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=q.skipMaterials??this.skipMaterials,this.useSRGBBuffers=q.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=q.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=q.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=q.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=q.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=q.customRootNode,this.onMeshLoaded=q.onMeshLoaded,this.onSkinLoaded=q.onSkinLoaded,this.onTextureLoaded=q.onTextureLoaded,this.onMaterialLoaded=q.onMaterialLoaded,this.onCameraLoaded=q.onCameraLoaded,this.extensionOptions=q.extensionOptions??this.extensionOptions)}}class F extends P{constructor(q){super(),this.onParsedObservable=new y.c,this.onMeshLoadedObservable=new y.c,this.onSkinLoadedObservable=new y.c,this.onTextureLoadedObservable=new y.c,this.onMaterialLoadedObservable=new y.c,this.onCameraLoadedObservable=new y.c,this.onCompleteObservable=new y.c,this.onErrorObservable=new y.c,this._d=new y.c,this.onExtensionLoadedObservable=new y.c,this.validate=!1,this.onValidatedObservable=new y.c,this._loader=null,this._state=null,this._requests=new Array,this.name=V.name,this.extensions=V.extensions,this.onLoaderStateChangedObservable=new y.c,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.p(q)}set onParsed(q){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),q&&(this._onParsedObserver=this.onParsedObservable.add(q))}set onMeshLoaded(q){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),q&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(q))}set onSkinLoaded(q){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),q&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((X=>q(X.node,X.skinnedNode))))}set onTextureLoaded(q){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),q&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(q))}set onMaterialLoaded(q){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),q&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(q))}set onCameraLoaded(q){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),q&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(q))}set onComplete(q){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(q)}set onError(q){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(q)}set onDispose(q){this._onDisposeObserver&&this._d.remove(this._onDisposeObserver),this._onDisposeObserver=this._d.add(q)}set onExtensionLoaded(q){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(q)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(q){this._loggingEnabled!==q&&(this._loggingEnabled=q,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(q){this._capturePerformanceCounters!==q&&(this._capturePerformanceCounters=q,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(q){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(q)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const q of this._requests)q.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=q=>Promise.resolve(q),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this._d.notifyObservers(void 0),this._d.clear()}loadFile(q,X,Q,u,H,b,D,R){if(ArrayBuffer.isView(X))return this._loadBinary(q,X,Q,u,D,R),null;this._progressCallback=H;const L=X.name||x.f.GetFilename(X);if(b){if(this.useRangeRequests){this.validate&&a.b.Warn("glTF validation is not supported when range requests are enabled");const Q={abort:()=>{},onCompleteObservable:new y.c},x={readAsync:(Q,y)=>new Promise(((x,u)=>{this._loadFile(q,X,(q=>{x(new Uint8Array(q))}),!0,(q=>{u(q)}),(q=>{q.setRequestHeader("Range",`bytes=${Q}-${Q+y-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new A(x)).then((q=>{Q.onCompleteObservable.notifyObservers(Q),u(q)}),D?q=>D(void 0,q):void 0),Q}return this._loadFile(q,X,(X=>{this._validate(q,new Uint8Array(X,0,X.byteLength),Q,L),this._unpackBinaryAsync(new A({readAsync:(q,Q)=>g(X,q,Q),byteLength:X.byteLength})).then((q=>{u(q)}),D?q=>D(void 0,q):void 0)}),!0,D)}return this._loadFile(q,X,(X=>{try{this._validate(q,X,Q,L),u({json:this._parseJson(X)})}catch{D&&D()}}),!1,D)}_loadBinary(q,X,Q,y,x,u){this._validate(q,new Uint8Array(X.buffer,X.byteOffset,X.byteLength),Q,u),this._unpackBinaryAsync(new A({readAsync:(q,Q)=>function(q,X,Q){try{if(X<0||X>=q.byteLength)throw new RangeError("Offset is out of range.");if(X+Q>q.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(q.buffer,q.byteOffset+X,Q))}catch(y){return Promise.reject(y)}}(X,q,Q),byteLength:X.byteLength})).then((q=>{y(q)}),x?q=>x(void 0,q):void 0)}importMeshAsync(q,X,Q,y,x,u){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(Q),this.onParsedObservable.clear(),this._log(`Loading ${u||""}`),this._loader=this._getLoader(Q),this._loader.importMeshAsync(q,X,null,Q,y,x,u))))}loadAsync(q,X,Q,y,x){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(X),this.onParsedObservable.clear(),this._log(`Loading ${x||""}`),this._loader=this._getLoader(X),this._loader.loadAsync(q,X,Q,y,x))))}loadAssetContainerAsync(q,X,Q,y,x){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(X),this.onParsedObservable.clear(),this._log(`Loading ${x||""}`),this._loader=this._getLoader(X);const u=new e(q),H=[];this.onMaterialLoadedObservable.add((q=>{H.push(q)}));const b=[];this.onTextureLoadedObservable.add((q=>{b.push(q)}));const D=[];this.onCameraLoadedObservable.add((q=>{D.push(q)}));const a=[];return this.onMeshLoadedObservable.add((q=>{q.morphTargetManager&&a.push(q.morphTargetManager)})),this._loader.importMeshAsync(null,q,u,X,Q,y,x).then((q=>(Array.prototype.push.apply(u.geometries,q.geometries),Array.prototype.push.apply(u.meshes,q.meshes),Array.prototype.push.apply(u.je,q.je),Array.prototype.push.apply(u.skeletons,q.skeletons),Array.prototype.push.apply(u.animationGroups,q.animationGroups),Array.prototype.push.apply(u.materials,H),Array.prototype.push.apply(u.textures,b),Array.prototype.push.apply(u.lights,q.lights),Array.prototype.push.apply(u.transformNodes,q.transformNodes),Array.prototype.push.apply(u.cameras,D),Array.prototype.push.apply(u.morphTargetManagers,a),u)))}))}canDirectLoad(q){return V.canDirectLoad(q)}directLoad(q,X){if(X.startsWith("base64,"+w)||X.startsWith(";base64,"+w)||X.startsWith("application/octet-stream;base64,"+w)||X.startsWith("model/gltf-binary;base64,"+w)){const Q=(0,U.c)(X);return this._validate(q,new Uint8Array(Q,0,Q.byteLength)),this._unpackBinaryAsync(new A({readAsync:(q,X)=>g(Q,q,X),byteLength:Q.byteLength}))}return this._validate(q,X),Promise.resolve({json:this._parseJson(X)})}createPlugin(q){return new F(q[V.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((q,X)=>{this.onCompleteObservable.addOnce((()=>{q()})),this.onErrorObservable.addOnce((q=>{X(q)}))}))}_setState(q){this._state!==q&&(this._state=q,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(Z[this._state]))}_loadFile(q,X,Q,y,x,u){const H=q._loadFile(X,Q,(q=>{this._onProgress(q,H)}),!0,y,x,u);return H.onCompleteObservable.add((()=>{H._lengthComputable=!0,H._total=H._loaded})),this._requests.push(H),H}_onProgress(q,X){if(!this._progressCallback)return;X._lengthComputable=q.lengthComputable,X._loaded=q.loaded,X._total=q.total;let Q=!0,y=0,x=0;for(const u of this._requests){if(void 0===u._lengthComputable||void 0===u._loaded||void 0===u._total)return;Q=Q&&u._lengthComputable,y+=u._loaded,x+=u._total}this._progressCallback({lengthComputable:Q,loaded:y,total:Q?x:0})}_validate(q,X){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),B.c.ValidateAsync(X,Q,y,(X=>this.preprocessUrlAsync(Q+X).then((X=>q._loadFileAsync(X,void 0,!0,!0).then((q=>new Uint8Array(q,0,q.byteLength))))))).then((q=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(q),this.onValidatedObservable.clear()}),(q=>{this._endPerformanceCounter("Validate JSON"),x.f.Warn(`Failed to validate: ${q.message}`),this.onValidatedObservable.clear()})))}_getLoader(q){const X=q.json.asset||{};this._log(`Asset version: ${X.version}`),X.minVersion&&this._log(`Asset minimum version: ${X.minVersion}`),X.generator&&this._log(`Asset generator: ${X.generator}`);const Q=F._parseVersion(X.version);if(!Q)throw new Error("Invalid version: "+X.version);if(void 0!==X.minVersion){const q=F._parseVersion(X.minVersion);if(!q)throw new Error("Invalid minimum version: "+X.minVersion);if(F._compareVersion(q,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+X.minVersion)}const y={1:F._CreateGLTF1Loader,2:F._CreateGLTF2Loader}[Q.major];if(!y)throw new Error("Unsupported version: "+X.version);return y(this)}_parseJson(q){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${q.length}`);const X=JSON.parse(q);return this._endPerformanceCounter("Parse JSON"),X}_unpackBinaryAsync(q){return this._startPerformanceCounter("Unpack Binary"),q.loadAsync(20).then((()=>{const X=q.readUint32();if(1179937895!==X)throw new O.f("Unexpected magic: "+X,O.e.GLTFLoaderUnexpectedMagicError);const Q=q.readUint32();this.loggingEnabled&&this._log(`Binary version: ${Q}`);const y=q.readUint32();let x;switch(this.useRangeRequests||y===q.buffer.byteLength||a.b.Warn(`Length in header does not match actual data length: ${y} != ${q.buffer.byteLength}`),Q){case 1:x=this._unpackBinaryV1Async(q,y);break;case 2:x=this._unpackBinaryV2Async(q,y);break;default:throw new Error("Unsupported version: "+Q)}return this._endPerformanceCounter("Unpack Binary"),x}))}_unpackBinaryV1Async(q,X){const Q=q.readUint32(),y=q.readUint32();if(0!==y)throw new Error(`Unexpected content format: ${y}`);const x=X-q.byteOffset,u={json:this._parseJson(q.readString(Q)),bin:null};if(0!==x){const X=q.byteOffset;u.bin={readAsync:(Q,y)=>q.buffer.readAsync(X+Q,y),byteLength:x}}return Promise.resolve(u)}_unpackBinaryV2Async(q,X){const Q=1313821514,y=5130562,x=q.readUint32();if(q.readUint32()!==Q)throw new Error("First chunk format is not JSON");return q.byteOffset+x===X?q.loadAsync(x).then((()=>({json:this._parseJson(q.readString(x)),bin:null}))):q.loadAsync(x+8).then((()=>{const u={json:this._parseJson(q.readString(x)),bin:null},H=()=>{const x=q.readUint32();switch(q.readUint32()){case Q:throw new Error("Unexpected JSON chunk");case y:{const X=q.byteOffset;u.bin={readAsync:(Q,y)=>q.buffer.readAsync(X+Q,y),byteLength:x},q.skipBytes(x);break}default:q.skipBytes(x)}return q.byteOffset!==X?q.loadAsync(8).then(H):Promise.resolve(u)};return H()}))}static _parseVersion(q){if("1.0"===q||"1.0.1"===q)return{major:1,minor:0};const X=(q+"").match(/^(\d+)\.(\d+)/);return X?{major:parseInt(X[1]),minor:parseInt(X[2])}:null}static _compareVersion(q,X){return q.major>X.major?1:q.major<X.major?-1:q.minor>X.minor?1:q.minor<X.minor?-1:0}_logOpen(q){this._log(q),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(q){const X=F._logSpaces.substring(0,2*this._logIndentLevel);a.b.Log(`${X}${q}`)}_logDisabled(q){}_startPerformanceCounterEnabled(q){x.f.StartPerformanceCounter(q)}_startPerformanceCounterDisabled(q){}_endPerformanceCounterEnabled(q){x.f.EndPerformanceCounter(q)}_endPerformanceCounterDisabled(q){}}F.IncrementalLoading=!0,F.HomogeneousCoordinates=!1,F._logSpaces="                                ",(0,u.g)(new F)},11916:(q,X,Q)=>{"use strict";Q.d(X,{c:()=>H});var y=Q(1215);function x(q,X,Q,y){const x={externalResourceFunction:y};return Q&&(x.uri="file:"===X?Q:X+Q),ArrayBuffer.isView(q)?GLTFValidator.validateBytes(q,x):GLTFValidator.validateString(q,x)}function u(){const q=[];onmessage=X=>{const Q=X.data;switch(Q.id){case"init":importScripts(Q.url);break;case"validate":x(Q.data,Q.rootUrl,Q.fileName,(X=>new Promise(((Q,y)=>{const x=q.length;q.push({resolve:Q,reject:y}),postMessage({id:"getExternalResource",index:x,uri:X})})))).then((q=>{postMessage({id:"validate.resolve",value:q})}),(q=>{postMessage({id:"validate.reject",reason:q})}));break;case"getExternalResource.resolve":q[Q.index].resolve(Q.value);break;case"getExternalResource.reject":q[Q.index].reject(Q.reason)}}}class H{static ValidateAsync(q,X,Q,H){return"function"===typeof Worker?new Promise(((b,D)=>{const a=`${x}(${u})()`,R=URL.createObjectURL(new Blob([a],{type:"application/javascript"})),L=new Worker(R),f=q=>{L.removeEventListener("error",f),L.removeEventListener("message",k),D(q)},k=q=>{const X=q.data;switch(X.id){case"getExternalResource":H(X.uri).then((q=>{L.postMessage({id:"getExternalResource.resolve",index:X.index,value:q},[q.buffer])}),(q=>{L.postMessage({id:"getExternalResource.reject",index:X.index,reason:q})}));break;case"validate.resolve":L.removeEventListener("error",f),L.removeEventListener("message",k),b(X.value),L.terminate();break;case"validate.reject":L.removeEventListener("error",f),L.removeEventListener("message",k),D(X.reason),L.terminate()}};if(L.addEventListener("error",f),L.addEventListener("message",k),L.postMessage({id:"init",url:y.f.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(q)){const y=q.slice();L.postMessage({id:"validate",data:y,rootUrl:X,fileName:Q},[y.buffer])}else L.postMessage({id:"validate",data:q,rootUrl:X,fileName:Q})})):(this._LoadScriptPromise||(this._LoadScriptPromise=y.f.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>x(q,X,Q,H))))}}H.Configuration={url:`${y.f._DefaultCdnUrl}/gltf_validator.js`}},12238:(q,X,Q)=>{"use strict";Q.d(X,{b:()=>W});var y=Q(975),x=Q(984),u=Q(1173),H=Q(1002),b=Q(1384),D=Q(1390),a=Q(1261),R=Q(1206),L=Q(1015),f=Q(1119);Q(10842),Q(10669),Q(10848),Q(10589),Q(10852),Q(10883),Q(10891);const k="imageProcessingCompatibility",j="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";f.c.IncludesShadersStore[k]=j;const I="skyPixelShader",d="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";f.c.ShadersStore[I]=d;Q(10633),Q(10635),Q(10725),Q(10753),Q(10734);const e="skyVertexShader",i="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";f.c.ShadersStore[e]=i;var A=Q(1400),B=Q(1378),w=Q(1374);class V extends b.c{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class W extends D.e{constructor(q,X){super(q,X),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new H.n(0,100,0),this.useSunPosition=!1,this.cameraOffset=H.n.Zero(),this.up=H.n.Up(),this.dithering=!1,this._cameraPosition=H.n.Zero(),this._skyOrientation=new H.d}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(q,X){const Q=X._drawWrapper;if(this.isFrozen&&Q.effect&&Q._wasPreviouslyReady)return!0;X.materialDefines||(X.materialDefines=new V);const y=X.materialDefines,x=this.va();if(this._isReadyForSubMesh(X))return!0;if((0,w.Y)(q,x,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,y),(0,w.M)(q,y,!0,!1),y.IMAGEPROCESSINGPOSTPROCESS!==x.imageProcessingConfiguration.applyByPostProcess&&y.markAsMiscDirty(),y.DITHER!==this.dithering&&y.markAsMiscDirty(),y.isDirty){y.markAsProcessed(),x.resetCachedMaterial();const q=new A.e;y.FOG&&q.addFallback(1,"FOG"),y.IMAGEPROCESSINGPOSTPROCESS=x.imageProcessingConfiguration.applyByPostProcess,y.DITHER=this.dithering;const Q=[a.c.PositionKind];y.VERTEXCOLOR&&Q.push(a.c.ColorKind);const u="sky",H=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,B.e)(H);const b=y.toString();X.setEffect(x.getEngine().createEffect(u,Q,H,[],b,q,this.onCompiled,this.onError),y,this._materialContext)}return!(!X.effect||!X.effect.isReady())&&(y._renderId=x.getRenderId(),Q._wasPreviouslyReady=!0,!0)}bindForSubMesh(q,X,Q){const y=this.va(),x=Q.materialDefines;if(!x)return;const u=Q.effect;if(!u)return;this._activeEffect=u,this.bindOnlyWorldMatrix(q),this._activeEffect.setMatrix("viewProjection",y.getTransformMatrix()),this._mustRebind(y,u,Q)&&((0,B.g)(u,this,y),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,w.l)(x,u,y)),y.fogEnabled&&X.applyFog&&y.fogMode!==R.d.FOGMODE_NONE&&this._activeEffect.setMatrix("view",y.getViewMatrix()),(0,w.g)(y,X,this._activeEffect);const b=y.activeCamera;if(b){const q=b.getWorldMatrix();this._cameraPosition.x=q.m[12],this._cameraPosition.y=q.m[13],this._cameraPosition.z=q.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const q=Math.PI*(this.inclination-.5),X=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(X)*Math.cos(q),this.sunPosition.y=this.distance*Math.sin(-q),this.sunPosition.z=this.distance*Math.sin(X)*Math.cos(q),H.d.FromUnitVectorsToRef(H.n.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(X,this._activeEffect,Q)}getAnimatables(){return[]}dispose(q){super.dispose(q)}clone(q){return u.c.Clone((()=>new W(q,this.va())),this)}serialize(){const q=super.serialize();return q.customType="BABYLON.SkyMaterial",q}getClassName(){return"SkyMaterial"}static Parse(q,X,Q){return u.c.Parse((()=>new W(q.name,X)),q,X,Q)}}(0,y.b)([(0,x.J)()],W.prototype,"luminance",void 0),(0,y.b)([(0,x.J)()],W.prototype,"turbidity",void 0),(0,y.b)([(0,x.J)()],W.prototype,"rayleigh",void 0),(0,y.b)([(0,x.J)()],W.prototype,"mieCoefficient",void 0),(0,y.b)([(0,x.J)()],W.prototype,"mieDirectionalG",void 0),(0,y.b)([(0,x.J)()],W.prototype,"distance",void 0),(0,y.b)([(0,x.J)()],W.prototype,"inclination",void 0),(0,y.b)([(0,x.J)()],W.prototype,"azimuth",void 0),(0,y.b)([(0,x.F)()],W.prototype,"sunPosition",void 0),(0,y.b)([(0,x.J)()],W.prototype,"useSunPosition",void 0),(0,y.b)([(0,x.F)()],W.prototype,"cameraOffset",void 0),(0,y.b)([(0,x.F)()],W.prototype,"up",void 0),(0,y.b)([(0,x.J)()],W.prototype,"dithering",void 0),(0,L.h)("BABYLON.SkyMaterial",W)},11014:(q,X,Q)=>{"use strict";function y(q,X){X.headers=q.headers||{},X.statusMessage=q.statusText,X.statusCode=q.status,X.data=q.response}function x(q,X,Q){return new Promise((function(x,u){Q=Q||{};var H,b,D,a=new XMLHttpRequest,R=Q.body,L=Q.headers||{};for(H in Q.timeout&&(a.timeout=Q.timeout),a.ontimeout=a.onerror=function(q){q.timeout="timeout"==q.type,u(q)},a.open(q,X.href||X),a.onload=function(){for(D=a.getAllResponseHeaders().trim().split(/[\r\n]+/),y(a,a);b=D.shift();)b=b.split(": "),a.headers[b.shift().toLowerCase()]=b.join(": ");if((b=a.headers["content-type"])&&~b.indexOf("application/json"))try{a.data=JSON.parse(a.data,Q.reviver)}catch(q){return y(a,q),u(q)}(a.status>=400?u:x)(a)},typeof FormData<"u"&&R instanceof FormData||R&&"object"==typeof R&&(L["content-type"]="application/json",R=JSON.stringify(R)),a.withCredentials=!!Q.withCredentials,L)a.setRequestHeader(H,L[H]);a.send(R)}))}Q.r(X),Q.d(X,{del:()=>D,get:()=>u,patch:()=>b,post:()=>H,put:()=>a,send:()=>x});var u=x.bind(x,"GET"),H=x.bind(x,"POST"),b=x.bind(x,"PATCH"),D=x.bind(x,"DELETE"),a=x.bind(x,"PUT")},12359:(q,X,Q)=>{"use strict";Q.d(X,{c:()=>L});const y=.5*(Math.sqrt(3)-1),x=(3-Math.sqrt(3))/6,u=1/3,H=1/6,b=(Math.sqrt(5)-1)/4,D=(5-Math.sqrt(5))/20,a=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),R=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const L=class{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const X="function"==typeof q?q:function(q){let X=0,Q=0,y=0,x=1;const u=function(){let q=4022871197;return function(X){X=X.toString();for(let Q=0;Q<X.length;Q++){q+=X.charCodeAt(Q);let y=.02519603282416938*q;q=y>>>0,y-=q,y*=q,q=y>>>0,y-=q,q+=4294967296*y}return 2.3283064365386963e-10*(q>>>0)}}();X=u(" "),Q=u(" "),y=u(" "),X-=u(q),X<0&&(X+=1);Q-=u(q),Q<0&&(Q+=1);y-=u(q),y<0&&(y+=1);return function(){const q=2091639*X+2.3283064365386963e-10*x;return X=Q,Q=y,y=q-(x=0|q)}}(q);this.p=function(q){const X=new Uint8Array(256);for(let Q=0;Q<256;Q++)X[Q]=Q;for(let Q=0;Q<255;Q++){const y=Q+~~(q()*(256-Q)),x=X[Q];X[Q]=X[y],X[y]=x}return X}(X),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let Q=0;Q<512;Q++)this.perm[Q]=this.p[255&Q],this.permMod12[Q]=this.perm[Q]%12}noise2D(q,X){const Q=this.permMod12,u=this.perm;let H=0,b=0,D=0;const R=(q+X)*y,L=Math.floor(q+R),f=Math.floor(X+R),k=(L+f)*x,j=q-(L-k),I=X-(f-k);let d,e;j>I?(d=1,e=0):(d=0,e=1);const i=j-d+x,A=I-e+x,B=j-1+2*x,w=I-1+2*x,V=255&L,W=255&f;let v=.5-j*j-I*I;if(v>=0){const q=3*Q[V+u[W]];v*=v,H=v*v*(a[q]*j+a[q+1]*I)}let Z=.5-i*i-A*A;if(Z>=0){const q=3*Q[V+d+u[W+e]];Z*=Z,b=Z*Z*(a[q]*i+a[q+1]*A)}let U=.5-B*B-w*w;if(U>=0){const q=3*Q[V+1+u[W+1]];U*=U,D=U*U*(a[q]*B+a[q+1]*w)}return 70*(H+b+D)}noise3D(q,X,Q){const y=this.permMod12,x=this.perm;let b,D,R,L;const f=(q+X+Q)*u,k=Math.floor(q+f),j=Math.floor(X+f),I=Math.floor(Q+f),d=(k+j+I)*H,e=q-(k-d),i=X-(j-d),A=Q-(I-d);let B,w,V,W,v,Z;e>=i?i>=A?(B=1,w=0,V=0,W=1,v=1,Z=0):e>=A?(B=1,w=0,V=0,W=1,v=0,Z=1):(B=0,w=0,V=1,W=1,v=0,Z=1):i<A?(B=0,w=0,V=1,W=0,v=1,Z=1):e<A?(B=0,w=1,V=0,W=0,v=1,Z=1):(B=0,w=1,V=0,W=1,v=1,Z=0);const U=e-B+H,O=i-w+H,g=A-V+H,P=e-W+2*H,F=i-v+2*H,l=A-Z+2*H,m=e-1+.5,M=i-1+.5,o=A-1+.5,Y=255&k,N=255&j,S=255&I;let c=.6-e*e-i*i-A*A;if(c<0)b=0;else{const q=3*y[Y+x[N+x[S]]];c*=c,b=c*c*(a[q]*e+a[q+1]*i+a[q+2]*A)}let p=.6-U*U-O*O-g*g;if(p<0)D=0;else{const q=3*y[Y+B+x[N+w+x[S+V]]];p*=p,D=p*p*(a[q]*U+a[q+1]*O+a[q+2]*g)}let t=.6-P*P-F*F-l*l;if(t<0)R=0;else{const q=3*y[Y+W+x[N+v+x[S+Z]]];t*=t,R=t*t*(a[q]*P+a[q+1]*F+a[q+2]*l)}let z=.6-m*m-M*M-o*o;if(z<0)L=0;else{const q=3*y[Y+1+x[N+1+x[S+1]]];z*=z,L=z*z*(a[q]*m+a[q+1]*M+a[q+2]*o)}return 32*(b+D+R+L)}noise4D(q,X,Q,y){const x=this.perm;let u,H,a,L,f;const k=(q+X+Q+y)*b,j=Math.floor(q+k),I=Math.floor(X+k),d=Math.floor(Q+k),e=Math.floor(y+k),i=(j+I+d+e)*D,A=q-(j-i),B=X-(I-i),w=Q-(d-i),V=y-(e-i);let W=0,v=0,Z=0,U=0;A>B?W++:v++,A>w?W++:Z++,A>V?W++:U++,B>w?v++:Z++,B>V?v++:U++,w>V?Z++:U++;const O=W>=3?1:0,g=v>=3?1:0,P=Z>=3?1:0,F=U>=3?1:0,l=W>=2?1:0,m=v>=2?1:0,M=Z>=2?1:0,o=U>=2?1:0,Y=W>=1?1:0,N=v>=1?1:0,S=Z>=1?1:0,c=U>=1?1:0,p=A-O+D,t=B-g+D,z=w-P+D,K=V-F+D,h=A-l+2*D,G=B-m+2*D,C=w-M+2*D,E=V-o+2*D,J=A-Y+3*D,n=B-N+3*D,r=w-S+3*D,s=V-c+3*D,T=A-1+4*D,qq=B-1+4*D,Xq=w-1+4*D,Qq=V-1+4*D,yq=255&j,xq=255&I,uq=255&d,Hq=255&e;let bq=.6-A*A-B*B-w*w-V*V;if(bq<0)u=0;else{const q=x[yq+x[xq+x[uq+x[Hq]]]]%32*4;bq*=bq,u=bq*bq*(R[q]*A+R[q+1]*B+R[q+2]*w+R[q+3]*V)}let Dq=.6-p*p-t*t-z*z-K*K;if(Dq<0)H=0;else{const q=x[yq+O+x[xq+g+x[uq+P+x[Hq+F]]]]%32*4;Dq*=Dq,H=Dq*Dq*(R[q]*p+R[q+1]*t+R[q+2]*z+R[q+3]*K)}let aq=.6-h*h-G*G-C*C-E*E;if(aq<0)a=0;else{const q=x[yq+l+x[xq+m+x[uq+M+x[Hq+o]]]]%32*4;aq*=aq,a=aq*aq*(R[q]*h+R[q+1]*G+R[q+2]*C+R[q+3]*E)}let Rq=.6-J*J-n*n-r*r-s*s;if(Rq<0)L=0;else{const q=x[yq+Y+x[xq+N+x[uq+S+x[Hq+c]]]]%32*4;Rq*=Rq,L=Rq*Rq*(R[q]*J+R[q+1]*n+R[q+2]*r+R[q+3]*s)}let Lq=.6-T*T-qq*qq-Xq*Xq-Qq*Qq;if(Lq<0)f=0;else{const q=x[yq+1+x[xq+1+x[uq+1+x[Hq+1]]]]%32*4;Lq*=Lq,f=Lq*Lq*(R[q]*T+R[q+1]*qq+R[q+2]*Xq+R[q+3]*Qq)}return 27*(u+H+a+L+f)}}}}]);