/*! For license information please see o09hnv.10.becaa446.chunk.js.LICENSE.txt */
(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[10],{11085:function(N,Z){!function(N){"use strict";var Z=function(N,d){return Z=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(N,Z){N.__proto__=Z}||function(N,Z){for(var d in Z)Object.prototype.hasOwnProperty.call(Z,d)&&(N[d]=Z[d])},Z(N,d)};function d(N,d){if("function"!==typeof d&&null!==d)throw new TypeError("Class extends value "+String(d)+" is not a constructor or null");function X(){this.constructor=N}Z(N,d),N.prototype=null===d?Object.create(d):(X.prototype=d.prototype,new X)}function X(N,Z,d,X){var I,m=arguments.length,z=m<3?Z:null===X?X=Object.getOwnPropertyDescriptor(Z,d):X;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)z=Reflect.decorate(N,Z,d,X);else for(var w=N.length-1;w>=0;w--)(I=N[w])&&(z=(m<3?I(z):m>3?I(Z,d,z):I(Z,d))||z);return m>3&&z&&Object.defineProperty(Z,d,z),z}function I(N,Z,d){if(d||2===arguments.length)for(var X,I=0,m=Z.length;I<m;I++)!X&&I in Z||(X||(X=Array.prototype.slice.call(Z,0,I)),X[I]=Z[I]);return N.concat(X||Array.prototype.slice.call(Z))}var m,z=255,w=213;N.OPERATION=void 0,(m=N.OPERATION||(N.OPERATION={}))[m.ADD=128]="ADD",m[m.REPLACE=0]="REPLACE",m[m.DELETE=64]="DELETE",m[m.DELETE_AND_ADD=192]="DELETE_AND_ADD",m[m.TOUCH=1]="TOUCH",m[m.CLEAR=10]="CLEAR";var S=function(){function Z(N,Z,d){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=N,this.setParent(Z,d)}return Z.prototype.setParent=function(N,Z,d){var X=this;if(this.indexes||(this.indexes=this.ref instanceof bN?this.ref._definition.indexes:{}),this.parent=N,this.parentIndex=d,Z)if(this.root=Z,this.ref instanceof bN){var I=this.ref._definition;for(var m in I.schema){var z=this.ref[m];if(z&&z.$changes){var w=I.indexes[m];z.$changes.setParent(this.ref,Z,w)}}}else"object"===typeof this.ref&&this.ref.forEach((function(N,Z){if(N instanceof bN){var d=N.$changes,I=X.ref.$changes.indexes[Z];d.setParent(X.ref,X.root,I)}}))},Z.prototype.operation=function(N){this.changes.set(--this.currentCustomOperation,N)},Z.prototype.change=function(Z,d){void 0===d&&(d=N.OPERATION.ADD);var X="number"===typeof Z?Z:this.indexes[Z];this.assertValidIndex(X,Z);var I=this.changes.get(X);I&&I.op!==N.OPERATION.DELETE&&I.op!==N.OPERATION.TOUCH||this.changes.set(X,{op:I&&I.op===N.OPERATION.DELETE?N.OPERATION.DELETE_AND_ADD:d,index:X}),this.allChanges.add(X),this.changed=!0,this.touchParents()},Z.prototype.touch=function(Z){var d="number"===typeof Z?Z:this.indexes[Z];this.assertValidIndex(d,Z),this.changes.has(d)||this.changes.set(d,{op:N.OPERATION.TOUCH,index:d}),this.allChanges.add(d),this.touchParents()},Z.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},Z.prototype.getType=function(N){if(this.ref._definition)return(Z=this.ref._definition).schema[Z.fieldsByIndex[N]];var Z,d=(Z=this.parent._definition).schema[Z.fieldsByIndex[this.parentIndex]];return Object.values(d)[0]},Z.prototype.getChildrenFilter=function(){var N=this.parent._definition.childFilters;return N&&N[this.parentIndex]},Z.prototype.getValue=function(N){return this.ref.getByIndex(N)},Z.prototype.delete=function(Z){var d="number"===typeof Z?Z:this.indexes[Z];if(void 0!==d){var X=this.getValue(d);this.changes.set(d,{op:N.OPERATION.DELETE,index:d}),this.allChanges.delete(d),delete this.caches[d],X&&X.$changes&&(X.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(Z," (").concat(d,")"))},Z.prototype.discard=function(Z,d){var X=this;void 0===Z&&(Z=!1),void 0===d&&(d=!1),this.ref instanceof bN||this.changes.forEach((function(Z){if(Z.op===N.OPERATION.DELETE){var d=X.ref.getIndex(Z.index);delete X.indexes[d]}})),this.changes.clear(),this.changed=Z,d&&this.allChanges.clear(),this.currentCustomOperation=0},Z.prototype.discardAll=function(){var N=this;this.changes.forEach((function(Z){var d=N.getValue(Z.index);d&&d.$changes&&d.$changes.discardAll()})),this.discard()},Z.prototype.cache=function(N,Z){this.caches[N]=Z},Z.prototype.clone=function(){return new Z(this.ref,this.parent,this.root)},Z.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},Z.prototype.assertValidIndex=function(N,Z){if(void 0===N)throw new Error('ChangeTree: missing index for field "'.concat(Z,'"'))},Z}();function e(N,Z,d,X){return N[Z]||(N[Z]=[]),N[Z].push(d),null===X||void 0===X||X.forEach((function(N,Z){return d(N,Z)})),function(){return B(N[Z],N[Z].indexOf(d))}}function j(Z){var d=this,X="string"!==typeof this.$changes.getType();this.$items.forEach((function(I,m){Z.push({refId:d.$changes.refId,op:N.OPERATION.DELETE,field:m,value:void 0,previousValue:I}),X&&d.$changes.root.removeRef(I.$changes.refId)}))}function B(N,Z){if(-1===Z||Z>=N.length)return!1;for(var d=N.length-1,X=Z;X<d;X++)N[X]=N[X+1];return N.length=d,!0}var D=function(N,Z){var d=N.toString(),X=Z.toString();return d<X?-1:d>X?1:0};function v(N){return N.$proxy=!0,N=new Proxy(N,{get:function(N,Z){return"symbol"===typeof Z||isNaN(Z)?N[Z]:N.at(Z)},set:function(N,Z,d){if("symbol"===typeof Z||isNaN(Z))N[Z]=d;else{var X=Array.from(N.$items.keys()),I=parseInt(X[Z]||Z);void 0===d||null===d?N.deleteAt(I):N.setAt(I,d)}return!0},deleteProperty:function(N,Z){return"number"===typeof Z?N.deleteAt(Z):delete N[Z],!0}})}var T=function(){function Z(){for(var N=[],Z=0;Z<arguments.length;Z++)N[Z]=arguments[Z];this.$changes=new S(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,N)}return Z.prototype.Af=function(Z,d){return void 0===d&&(d=!0),e(this.$callbacks||(this.$callbacks=[]),N.OPERATION.ADD,Z,d?this.$items:void 0)},Z.prototype.bb=function(Z){return e(this.$callbacks||(this.$callbacks=[]),N.OPERATION.DELETE,Z)},Z.prototype.onChange=function(Z){return e(this.$callbacks||(this.$callbacks=[]),N.OPERATION.REPLACE,Z)},Z.is=function(N){return Array.isArray(N)||void 0!==N.array},Object.defineProperty(Z.prototype,"length",{get:function(){return this.$items.size},set:function(N){0===N?this.clear():this.splice(N,this.length-N)},enumerable:!1,configurable:!0}),Z.prototype.push=function(){for(var N,Z=this,d=[],X=0;X<arguments.length;X++)d[X]=arguments[X];return d.forEach((function(d){N=Z.$refId++,Z.setAt(N,d)})),N},Z.prototype.pop=function(){var N=Array.from(this.$indexes.values()).pop();if(void 0!==N){this.$changes.delete(N),this.$indexes.delete(N);var Z=this.$items.get(N);return this.$items.delete(N),Z}},Z.prototype.at=function(N){var Z=Array.from(this.$items.keys())[N];return this.$items.get(Z)},Z.prototype.setAt=function(Z,d){var X,I;if(void 0!==d&&null!==d){if(this.$items.get(Z)!==d){void 0!==d.$changes&&d.$changes.setParent(this,this.$changes.root,Z);var m=null!==(I=null===(X=this.$changes.indexes[Z])||void 0===X?void 0:X.op)&&void 0!==I?I:N.OPERATION.ADD;this.$changes.indexes[Z]=Z,this.$indexes.set(Z,Z),this.$items.set(Z,d),this.$changes.change(Z,m)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},Z.prototype.deleteAt=function(N){var Z=Array.from(this.$items.keys())[N];return void 0!==Z&&this.$deleteAt(Z)},Z.prototype.$deleteAt=function(N){return this.$changes.delete(N),this.$indexes.delete(N),this.$items.delete(N)},Z.prototype.clear=function(Z){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),Z&&j.call(this,Z),this.$items.clear(),this.$changes.operation({index:0,op:N.OPERATION.CLEAR}),this.$changes.touchParents()},Z.prototype.concat=function(){for(var N,d=[],X=0;X<arguments.length;X++)d[X]=arguments[X];return new(Z.bind.apply(Z,I([void 0],(N=Array.from(this.$items.values())).concat.apply(N,d),!1)))},Z.prototype.join=function(N){return Array.from(this.$items.values()).join(N)},Z.prototype.reverse=function(){var N=this,Z=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(d,X){N.setAt(Z[X],d)})),this},Z.prototype.shift=function(){var N=Array.from(this.$items.keys()).shift();if(void 0!==N){var Z=this.$items.get(N);return this.$deleteAt(N),Z}},Z.prototype.slice=function(N,d){var X=new Z;return X.push.apply(X,Array.from(this.$items.values()).slice(N,d)),X},Z.prototype.sort=function(N){var Z=this;void 0===N&&(N=D);var d=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(N).forEach((function(N,X){Z.setAt(d[X],N)})),this},Z.prototype.splice=function(N,Z){void 0===Z&&(Z=this.length-N);for(var d=Array.from(this.$items.keys()),X=[],I=N;I<N+Z;I++)X.push(this.$items.get(d[I])),this.$deleteAt(d[I]);return X},Z.prototype.unshift=function(){for(var N=this,Z=[],d=0;d<arguments.length;d++)Z[d]=arguments[d];var X=this.length,I=Z.length,m=Array.from(this.$items.values());return Z.forEach((function(Z,d){N.setAt(d,Z)})),m.forEach((function(Z,d){N.setAt(I+d,Z)})),X+I},Z.prototype.indexOf=function(N,Z){return Array.from(this.$items.values()).indexOf(N,Z)},Z.prototype.lastIndexOf=function(N,Z){return void 0===Z&&(Z=this.length-1),Array.from(this.$items.values()).lastIndexOf(N,Z)},Z.prototype.every=function(N,Z){return Array.from(this.$items.values()).every(N,Z)},Z.prototype.some=function(N,Z){return Array.from(this.$items.values()).some(N,Z)},Z.prototype.forEach=function(N,Z){Array.from(this.$items.values()).forEach(N,Z)},Z.prototype.map=function(N,Z){return Array.from(this.$items.values()).map(N,Z)},Z.prototype.filter=function(N,Z){return Array.from(this.$items.values()).filter(N,Z)},Z.prototype.reduce=function(N,Z){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},Z.prototype.reduceRight=function(N,Z){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},Z.prototype.find=function(N,Z){return Array.from(this.$items.values()).find(N,Z)},Z.prototype.findIndex=function(N,Z){return Array.from(this.$items.values()).findIndex(N,Z)},Z.prototype.fill=function(N,Z,d){throw new Error("ArraySchema#fill() not implemented")},Z.prototype.copyWithin=function(N,Z,d){throw new Error("ArraySchema#copyWithin() not implemented")},Z.prototype.toString=function(){return this.$items.toString()},Z.prototype.toLocaleString=function(){return this.$items.toLocaleString()},Z.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(Z,Symbol.species,{get:function(){return Z},enumerable:!1,configurable:!0}),Z.prototype.entries=function(){return this.$items.entries()},Z.prototype.keys=function(){return this.$items.keys()},Z.prototype.values=function(){return this.$items.values()},Z.prototype.includes=function(N,Z){return Array.from(this.$items.values()).includes(N,Z)},Z.prototype.flatMap=function(N,Z){throw new Error("ArraySchema#flatMap() is not supported.")},Z.prototype.flat=function(N){throw new Error("ArraySchema#flat() is not supported.")},Z.prototype.findLast=function(){var N=Array.from(this.$items.values());return N.findLast.apply(N,arguments)},Z.prototype.findLastIndex=function(){var N=Array.from(this.$items.values());return N.findLastIndex.apply(N,arguments)},Z.prototype.setIndex=function(N,Z){this.$indexes.set(N,Z)},Z.prototype.getIndex=function(N){return this.$indexes.get(N)},Z.prototype.getByIndex=function(N){return this.$items.get(this.$indexes.get(N))},Z.prototype.deleteByIndex=function(N){var Z=this.$indexes.get(N);this.$items.delete(Z),this.$indexes.delete(N)},Z.prototype.toArray=function(){return Array.from(this.$items.values())},Z.prototype.toJSON=function(){return this.toArray().map((function(N){return"function"===typeof N.toJSON?N.toJSON():N}))},Z.prototype.clone=function(N){return N?new(Z.bind.apply(Z,I([void 0],Array.from(this.$items.values()),!1))):new(Z.bind.apply(Z,I([void 0],this.map((function(N){return N.$changes?N.clone():N})),!1)))},Z}();function k(N){return N.$proxy=!0,N=new Proxy(N,{get:function(N,Z){return"symbol"!==typeof Z&&"undefined"===typeof N[Z]?N.get(Z):N[Z]},set:function(N,Z,d){return"symbol"!==typeof Z&&-1===Z.indexOf("$")&&"Af"!==Z&&"bb"!==Z&&"onChange"!==Z?N.set(Z,d):N[Z]=d,!0},deleteProperty:function(N,Z){return N.delete(Z),!0}})}var h=function(){function Z(N){var d=this;if(this.$changes=new S(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,N)if(N instanceof Map||N instanceof Z)N.forEach((function(N,Z){return d.set(Z,N)}));else for(var X in N)this.set(X,N[X])}return Z.prototype.Af=function(Z,d){return void 0===d&&(d=!0),e(this.$callbacks||(this.$callbacks=[]),N.OPERATION.ADD,Z,d?this.$items:void 0)},Z.prototype.bb=function(Z){return e(this.$callbacks||(this.$callbacks=[]),N.OPERATION.DELETE,Z)},Z.prototype.onChange=function(Z){return e(this.$callbacks||(this.$callbacks=[]),N.OPERATION.REPLACE,Z)},Z.is=function(N){return void 0!==N.map},Z.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(Z.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(Z,Symbol.species,{get:function(){return Z},enumerable:!1,configurable:!0}),Z.prototype.set=function(Z,d){if(void 0===d||null===d)throw new Error("MapSchema#set('".concat(Z,"', ").concat(d,"): trying to set ").concat(d," value on '").concat(Z,"'."));Z=Z.toString();var X="undefined"!==typeof this.$changes.indexes[Z],I=X?this.$changes.indexes[Z]:this.$refId++,m=X?N.OPERATION.REPLACE:N.OPERATION.ADD,z=void 0!==d.$changes;if(z&&d.$changes.setParent(this,this.$changes.root,I),X){if(!z&&this.$items.get(Z)===d)return;z&&this.$items.get(Z)!==d&&(m=N.OPERATION.ADD)}else this.$changes.indexes[Z]=I,this.$indexes.set(I,Z);return this.$items.set(Z,d),this.$changes.change(Z,m),this},Z.prototype.get=function(N){return this.$items.get(N)},Z.prototype.delete=function(N){return this.$changes.delete(N),this.$items.delete(N)},Z.prototype.clear=function(Z){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),Z&&j.call(this,Z),this.$items.clear(),this.$changes.operation({index:0,op:N.OPERATION.CLEAR}),this.$changes.touchParents()},Z.prototype.has=function(N){return this.$items.has(N)},Z.prototype.forEach=function(N){this.$items.forEach(N)},Z.prototype.entries=function(){return this.$items.entries()},Z.prototype.keys=function(){return this.$items.keys()},Z.prototype.values=function(){return this.$items.values()},Object.defineProperty(Z.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),Z.prototype.setIndex=function(N,Z){this.$indexes.set(N,Z)},Z.prototype.getIndex=function(N){return this.$indexes.get(N)},Z.prototype.getByIndex=function(N){return this.$items.get(this.$indexes.get(N))},Z.prototype.deleteByIndex=function(N){var Z=this.$indexes.get(N);this.$items.delete(Z),this.$indexes.delete(N)},Z.prototype.toJSON=function(){var N={};return this.forEach((function(Z,d){N[d]="function"===typeof Z.toJSON?Z.toJSON():Z})),N},Z.prototype.clone=function(N){var d;return N?d=Object.assign(new Z,this):(d=new Z,this.forEach((function(N,Z){N.$changes?d.set(Z,N.clone()):d.set(Z,N)}))),d},Z}(),U={};function C(N,Z){U[N]=Z}function M(N){return U[N]}var Q=function(){function N(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return N.create=function(Z){var d=new N;return d.schema=Object.assign({},Z&&Z.schema||{}),d.indexes=Object.assign({},Z&&Z.indexes||{}),d.fieldsByIndex=Object.assign({},Z&&Z.fieldsByIndex||{}),d.descriptors=Object.assign({},Z&&Z.descriptors||{}),d.deprecated=Object.assign({},Z&&Z.deprecated||{}),d},N.prototype.addField=function(N,Z){var d=this.getNextFieldIndex();this.fieldsByIndex[d]=N,this.indexes[N]=d,this.schema[N]=Array.isArray(Z)?{array:Z[0]}:Z},N.prototype.hasField=function(N){return void 0!==this.indexes[N]},N.prototype.addFilter=function(N,Z){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[N]]=Z,this.indexesWithFilters.push(this.indexes[N]),!0},N.prototype.addChildrenFilter=function(N,Z){var d=this.indexes[N],X=this.schema[N];if(M(Object.keys(X)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[d]=Z,!0;console.warn("@filterChildren: field '".concat(N,"' can't have children. Ignoring filter."))},N.prototype.getChildrenFilter=function(N){return this.childFilters&&this.childFilters[this.indexes[N]]},N.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},N}();function A(N){return N._context&&N._context.useFilters}var n=function(){function N(){this.types={},this.schemas=new Map,this.useFilters=!1}return N.prototype.has=function(N){return this.schemas.has(N)},N.prototype.get=function(N){return this.types[N]},N.prototype.add=function(N,Z){void 0===Z&&(Z=this.schemas.size),N._definition=Q.create(N._definition),N._typeid=Z,this.types[Z]=N,this.schemas.set(N,Z)},N.create=function(Z){return void 0===Z&&(Z={}),function(d){return Z.context||(Z.context=new N),E(d,Z)}},N}(),g=new n;function E(N,Z){return void 0===Z&&(Z={}),function(d,X){var m=Z.context||g,z=d.constructor;if(z._context=m,!N)throw new Error("".concat(z.name,': @type() reference provided for "').concat(X,"\" is undefined. Make sure you don't have any circular dependencies."));m.has(z)||m.add(z);var w=z._definition;if(w.addField(X,N),w.descriptors[X]){if(w.deprecated[X])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(X,"' definition on '").concat(z.name,"'.\nCheck @type() annotation"))}catch(U){var S=U.stack.split("\n")[4].trim();throw new Error("".concat(U.message," ").concat(S))}}var e=T.is(N),j=!e&&h.is(N);if("string"!==typeof N&&!bN.is(N)){var B=Object.values(N)[0];"string"===typeof B||m.has(B)||m.add(B)}if(Z.manual)w.descriptors[X]={enumerable:!0,configurable:!0,writable:!0};else{var D="_".concat(X);w.descriptors[D]={enumerable:!1,configurable:!1,writable:!0},w.descriptors[X]={get:function(){return this[D]},set:function(N){N!==this[D]&&(void 0!==N&&null!==N?(!e||N instanceof T||(N=new(T.bind.apply(T,I([void 0],N,!1)))),!j||N instanceof h||(N=new h(N)),void 0===N.$proxy&&(j?N=k(N):e&&(N=v(N))),this.$changes.change(X),N.$changes&&N.$changes.setParent(this,this.$changes.root,this._definition.indexes[X])):this[D]&&this.$changes.delete(X),this[D]=N)},enumerable:!0,configurable:!0}}}}function V(N){return function(Z,d){var X=Z.constructor;X._definition.addFilter(d,N)&&(X._context.useFilters=!0)}}function O(N){return function(Z,d){var X=Z.constructor;X._definition.addChildrenFilter(d,N)&&(X._context.useFilters=!0)}}function K(N){return void 0===N&&(N=!0),function(Z,d){var X=Z.constructor._definition;X.deprecated[d]=!0,N&&(X.descriptors[d]={get:function(){throw new Error("".concat(d," is deprecated."))},set:function(N){},enumerable:!1,configurable:!0})}}function r(N,Z,d){for(var X in void 0===d&&(d={}),d.context||(d.context=N._context||d.context||g),Z)E(Z[X],d)(N.prototype,X);return N}function P(N){for(var Z=0,d=0,X=0,I=N.length;X<I;X++)(Z=N.charCodeAt(X))<128?d+=1:Z<2048?d+=2:Z<55296||Z>=57344?d+=3:(X++,d+=4);return d}function W(N,Z,d){for(var X=0,I=0,m=d.length;I<m;I++)(X=d.charCodeAt(I))<128?N[Z++]=X:X<2048?(N[Z++]=192|X>>6,N[Z++]=128|63&X):X<55296||X>=57344?(N[Z++]=224|X>>12,N[Z++]=128|X>>6&63,N[Z++]=128|63&X):(I++,X=65536+((1023&X)<<10|1023&d.charCodeAt(I)),N[Z++]=240|X>>18,N[Z++]=128|X>>12&63,N[Z++]=128|X>>6&63,N[Z++]=128|63&X)}function b(N,Z){N.push(255&Z)}function J(N,Z){N.push(255&Z)}function F(N,Z){N.push(255&Z),N.push(Z>>8&255)}function G(N,Z){N.push(255&Z),N.push(Z>>8&255)}function x(N,Z){N.push(255&Z),N.push(Z>>8&255),N.push(Z>>16&255),N.push(Z>>24&255)}function t(N,Z){var d=Z>>24,X=Z>>16,I=Z>>8,m=Z;N.push(255&m),N.push(255&I),N.push(255&X),N.push(255&d)}function q(N,Z){var d=Math.floor(Z/Math.pow(2,32));t(N,Z>>>0),t(N,d)}function Y(N,Z){var d=Z/Math.pow(2,32)|0;t(N,Z>>>0),t(N,d)}function s(N,Z){y(N,Z)}function L(N,Z){l(N,Z)}var H=new Int32Array(2),i=new Float32Array(H.buffer),p=new Float64Array(H.buffer);function y(N,Z){i[0]=Z,x(N,H[0])}function l(N,Z){p[0]=Z,x(N,H[0]),x(N,H[1])}function u(N,Z){return J(N,Z?1:0)}function a(N,Z){Z||(Z="");var d=P(Z),X=0;if(d<32)N.push(160|d),X=1;else if(d<256)N.push(217),J(N,d),X=2;else if(d<65536)N.push(218),G(N,d),X=3;else{if(!(d<4294967296))throw new Error("String too long");N.push(219),t(N,d),X=5}return W(N,N.length,Z),X+d}function c(N,Z){return isNaN(Z)?c(N,0):isFinite(Z)?Z!==(0|Z)?(N.push(203),l(N,Z),9):Z>=0?Z<128?(J(N,Z),1):Z<256?(N.push(204),J(N,Z),2):Z<65536?(N.push(205),G(N,Z),3):Z<4294967296?(N.push(206),t(N,Z),5):(N.push(207),Y(N,Z),9):Z>=-32?(N.push(224|Z+32),1):Z>=-128?(N.push(208),b(N,Z),2):Z>=-32768?(N.push(209),F(N,Z),3):Z>=-2147483648?(N.push(210),x(N,Z),5):(N.push(211),q(N,Z),9):c(N,Z>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var R=Object.freeze({__proto__:null,utf8Write:W,int8:b,uint8:J,int16:F,uint16:G,int32:x,uint32:t,int64:q,uint64:Y,float32:s,float64:L,writeFloat32:y,writeFloat64:l,boolean:u,string:a,number:c});function f(N,Z,d){for(var X="",I=0,m=Z,z=Z+d;m<z;m++){var w=N[m];0!==(128&w)?192!==(224&w)?224!==(240&w)?240!==(248&w)?console.error("Invalid byte "+w.toString(16)):(I=(7&w)<<18|(63&N[++m])<<12|(63&N[++m])<<6|63&N[++m])>=65536?(I-=65536,X+=String.fromCharCode(55296+(I>>>10),56320+(1023&I))):X+=String.fromCharCode(I):X+=String.fromCharCode((15&w)<<12|(63&N[++m])<<6|63&N[++m]):X+=String.fromCharCode((31&w)<<6|63&N[++m]):X+=String.fromCharCode(w)}return X}function o(N,Z){return NN(N,Z)<<24>>24}function NN(N,Z){return N[Z.offset++]}function ZN(N,Z){return dN(N,Z)<<16>>16}function dN(N,Z){return N[Z.offset++]|N[Z.offset++]<<8}function XN(N,Z){return N[Z.offset++]|N[Z.offset++]<<8|N[Z.offset++]<<16|N[Z.offset++]<<24}function IN(N,Z){return XN(N,Z)>>>0}function mN(N,Z){return DN(N,Z)}function zN(N,Z){return vN(N,Z)}function wN(N,Z){var d=IN(N,Z);return XN(N,Z)*Math.pow(2,32)+d}function SN(N,Z){var d=IN(N,Z);return IN(N,Z)*Math.pow(2,32)+d}var eN=new Int32Array(2),jN=new Float32Array(eN.buffer),BN=new Float64Array(eN.buffer);function DN(N,Z){return eN[0]=XN(N,Z),jN[0]}function vN(N,Z){return eN[0]=XN(N,Z),eN[1]=XN(N,Z),BN[0]}function TN(N,Z){return NN(N,Z)>0}function kN(N,Z){var d,X=N[Z.offset++];X<192?d=31&X:217===X?d=NN(N,Z):218===X?d=dN(N,Z):219===X&&(d=IN(N,Z));var I=f(N,Z.offset,d);return Z.offset+=d,I}function hN(N,Z){var d=N[Z.offset];return d<192&&d>160||217===d||218===d||219===d}function UN(N,Z){var d=N[Z.offset++];return d<128?d:202===d?DN(N,Z):203===d?vN(N,Z):204===d?NN(N,Z):205===d?dN(N,Z):206===d?IN(N,Z):207===d?SN(N,Z):208===d?o(N,Z):209===d?ZN(N,Z):210===d?XN(N,Z):211===d?wN(N,Z):d>223?-1*(255-d+1):void 0}function CN(N,Z){var d=N[Z.offset];return d<128||d>=202&&d<=211}function MN(N,Z){return N[Z.offset]<160}function QN(N,Z){return N[Z.offset-1]===z&&(N[Z.offset]<128||N[Z.offset]>=202&&N[Z.offset]<=211)}var AN=Object.freeze({__proto__:null,int8:o,uint8:NN,int16:ZN,uint16:dN,int32:XN,uint32:IN,float32:mN,float64:zN,int64:wN,uint64:SN,readFloat32:DN,readFloat64:vN,boolean:TN,string:kN,stringCheck:hN,number:UN,numberCheck:CN,arrayCheck:MN,switchStructureCheck:QN}),nN=function(){function Z(N){var Z=this;this.$changes=new S(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,N&&N.forEach((function(N){return Z.add(N)}))}return Z.prototype.Af=function(Z,d){return void 0===d&&(d=!0),e(this.$callbacks||(this.$callbacks=[]),N.OPERATION.ADD,Z,d?this.$items:void 0)},Z.prototype.bb=function(Z){return e(this.$callbacks||(this.$callbacks=[]),N.OPERATION.DELETE,Z)},Z.prototype.onChange=function(Z){return e(this.$callbacks||(this.$callbacks=[]),N.OPERATION.REPLACE,Z)},Z.is=function(N){return void 0!==N.collection},Z.prototype.add=function(N){var Z=this.$refId++;return void 0!==N.$changes&&N.$changes.setParent(this,this.$changes.root,Z),this.$changes.indexes[Z]=Z,this.$indexes.set(Z,Z),this.$items.set(Z,N),this.$changes.change(Z),Z},Z.prototype.at=function(N){var Z=Array.from(this.$items.keys())[N];return this.$items.get(Z)},Z.prototype.entries=function(){return this.$items.entries()},Z.prototype.delete=function(N){for(var Z,d,X=this.$items.entries();(d=X.next())&&!d.done;)if(N===d.value[1]){Z=d.value[0];break}return void 0!==Z&&(this.$changes.delete(Z),this.$indexes.delete(Z),this.$items.delete(Z))},Z.prototype.clear=function(Z){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),Z&&j.call(this,Z),this.$items.clear(),this.$changes.operation({index:0,op:N.OPERATION.CLEAR}),this.$changes.touchParents()},Z.prototype.has=function(N){return Array.from(this.$items.values()).some((function(Z){return Z===N}))},Z.prototype.forEach=function(N){var Z=this;this.$items.forEach((function(d,X,I){return N(d,X,Z)}))},Z.prototype.values=function(){return this.$items.values()},Object.defineProperty(Z.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),Z.prototype.setIndex=function(N,Z){this.$indexes.set(N,Z)},Z.prototype.getIndex=function(N){return this.$indexes.get(N)},Z.prototype.getByIndex=function(N){return this.$items.get(this.$indexes.get(N))},Z.prototype.deleteByIndex=function(N){var Z=this.$indexes.get(N);this.$items.delete(Z),this.$indexes.delete(N)},Z.prototype.toArray=function(){return Array.from(this.$items.values())},Z.prototype.toJSON=function(){var N=[];return this.forEach((function(Z,d){N.push("function"===typeof Z.toJSON?Z.toJSON():Z)})),N},Z.prototype.clone=function(N){var d;return N?d=Object.assign(new Z,this):(d=new Z,this.forEach((function(N){N.$changes?d.add(N.clone()):d.add(N)}))),d},Z}(),gN=function(){function Z(N){var Z=this;this.$changes=new S(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,N&&N.forEach((function(N){return Z.add(N)}))}return Z.prototype.Af=function(Z,d){return void 0===d&&(d=!0),e(this.$callbacks||(this.$callbacks=[]),N.OPERATION.ADD,Z,d?this.$items:void 0)},Z.prototype.bb=function(Z){return e(this.$callbacks||(this.$callbacks=[]),N.OPERATION.DELETE,Z)},Z.prototype.onChange=function(Z){return e(this.$callbacks||(this.$callbacks=[]),N.OPERATION.REPLACE,Z)},Z.is=function(N){return void 0!==N.set},Z.prototype.add=function(Z){var d,X;if(this.has(Z))return!1;var I=this.$refId++;void 0!==Z.$changes&&Z.$changes.setParent(this,this.$changes.root,I);var m=null!==(X=null===(d=this.$changes.indexes[I])||void 0===d?void 0:d.op)&&void 0!==X?X:N.OPERATION.ADD;return this.$changes.indexes[I]=I,this.$indexes.set(I,I),this.$items.set(I,Z),this.$changes.change(I,m),I},Z.prototype.entries=function(){return this.$items.entries()},Z.prototype.delete=function(N){for(var Z,d,X=this.$items.entries();(d=X.next())&&!d.done;)if(N===d.value[1]){Z=d.value[0];break}return void 0!==Z&&(this.$changes.delete(Z),this.$indexes.delete(Z),this.$items.delete(Z))},Z.prototype.clear=function(Z){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),Z&&j.call(this,Z),this.$items.clear(),this.$changes.operation({index:0,op:N.OPERATION.CLEAR}),this.$changes.touchParents()},Z.prototype.has=function(N){for(var Z,d=this.$items.values(),X=!1;(Z=d.next())&&!Z.done;)if(N===Z.value){X=!0;break}return X},Z.prototype.forEach=function(N){var Z=this;this.$items.forEach((function(d,X,I){return N(d,X,Z)}))},Z.prototype.values=function(){return this.$items.values()},Object.defineProperty(Z.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),Z.prototype.setIndex=function(N,Z){this.$indexes.set(N,Z)},Z.prototype.getIndex=function(N){return this.$indexes.get(N)},Z.prototype.getByIndex=function(N){return this.$items.get(this.$indexes.get(N))},Z.prototype.deleteByIndex=function(N){var Z=this.$indexes.get(N);this.$items.delete(Z),this.$indexes.delete(N)},Z.prototype.toArray=function(){return Array.from(this.$items.values())},Z.prototype.toJSON=function(){var N=[];return this.forEach((function(Z,d){N.push("function"===typeof Z.toJSON?Z.toJSON():Z)})),N},Z.prototype.clone=function(N){var d;return N?d=Object.assign(new Z,this):(d=new Z,this.forEach((function(N){N.$changes?d.add(N.clone()):d.add(N)}))),d},Z}(),EN=function(){function N(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return N.prototype.addRefId=function(N){this.refIds.has(N)||(this.refIds.add(N),this.containerIndexes.set(N,new Set))},N.get=function(Z){return void 0===Z.$filterState&&(Z.$filterState=new N),Z.$filterState},N}(),VN=function(){function N(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return N.prototype.getNextUniqueId=function(){return this.nextUniqueId++},N.prototype.addRef=function(N,Z,d){void 0===d&&(d=!0),this.refs.set(N,Z),d&&(this.refCounts[N]=(this.refCounts[N]||0)+1)},N.prototype.removeRef=function(N){this.refCounts[N]=this.refCounts[N]-1,this.deletedRefs.add(N)},N.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},N.prototype.garbageCollectDeletedRefs=function(){var N=this;this.deletedRefs.forEach((function(Z){if(!(N.refCounts[Z]>0)){var d=N.refs.get(Z);if(d instanceof bN)for(var X in d._definition.schema)"string"!==typeof d._definition.schema[X]&&d[X]&&d[X].$changes&&N.removeRef(d[X].$changes.refId);else{var I=d.$changes.parent._definition,m=I.schema[I.fieldsByIndex[d.$changes.parentIndex]];"function"===typeof Object.values(m)[0]&&Array.from(d.values()).forEach((function(Z){return N.removeRef(Z.$changes.refId)}))}N.refs.delete(Z),delete N.refCounts[Z]}})),this.deletedRefs.clear()},N}(),ON=function(N){function Z(){return null!==N&&N.apply(this,arguments)||this}return d(Z,N),Z}(Error);function KN(N,Z,d,X){var I,m=!1;switch(Z){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":I="number",isNaN(N)&&console.log('trying to encode "NaN" in '.concat(d.constructor.name,"#").concat(X));break;case"string":I="string",m=!0;break;case"boolean":return}if(typeof N!==I&&(!m||m&&null!==N)){var z="'".concat(JSON.stringify(N),"'").concat(N&&N.constructor&&" (".concat(N.constructor.name,")")||"");throw new ON("a '".concat(I,"' was expected, but ").concat(z," was provided in ").concat(d.constructor.name,"#").concat(X))}}function rN(N,Z,d,X){if(!(N instanceof Z))throw new ON("a '".concat(Z.name,"' was expected, but '").concat(N.constructor.name,"' was provided in ").concat(d.constructor.name,"#").concat(X))}function PN(N,Z,d,X,I){KN(d,N,X,I);var m=R[N];if(!m)throw new ON("a '".concat(N,"' was expected, but ").concat(d," was provided in ").concat(X.constructor.name,"#").concat(I));m(Z,d)}function WN(N,Z,d){return AN[N](Z,d)}var bN=function(){function Z(){for(var N=[],Z=0;Z<arguments.length;Z++)N[Z]=arguments[Z];Object.defineProperties(this,{$changes:{value:new S(this,void 0,new VN),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var d=this._definition.descriptors;d&&Object.defineProperties(this,d),N[0]&&this.assign(N[0])}return Z.onError=function(N){console.error(N)},Z.is=function(N){return N._definition&&void 0!==N._definition.schema},Z.prototype.onChange=function(Z){return e(this.$callbacks||(this.$callbacks=[]),N.OPERATION.REPLACE,Z)},Z.prototype.bb=function(Z){return e(this.$callbacks||(this.$callbacks=[]),N.OPERATION.DELETE,Z)},Z.prototype.assign=function(N){return Object.assign(this,N),this},Object.defineProperty(Z.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),Z.prototype.setDirty=function(N,Z){this.$changes.change(N,Z)},Z.prototype.listen=function(N,Z,d){var X=this;return void 0===d&&(d=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[N]||(this.$callbacks[N]=[]),this.$callbacks[N].push(Z),d&&void 0!==this[N]&&Z(this[N],void 0),function(){return B(X.$callbacks[N],X.$callbacks[N].indexOf(Z))}},Z.prototype.decode=function(d,X,I){var m;void 0===X&&(X={offset:0}),void 0===I&&(I=this);var w=[],S=this.$changes.root,e=d.length,j=0;for(S.refs.set(j,this);X.offset<e;){var B=d[X.offset++];if(B!=z){var D=I.$changes,v=void 0!==I._definition,k=v?B>>6<<6:B;if(k!==N.OPERATION.CLEAR){var U=v?B%(k||255):UN(d,X),C=v?I._definition.fieldsByIndex[U]:"",Q=D.getType(U),A=void 0,n=void 0,g=void 0;if(v?n=I["_".concat(C)]:(n=I.getByIndex(U),(k&N.OPERATION.ADD)===N.OPERATION.ADD?(g=I instanceof h?kN(d,X):U,I.setIndex(U,g)):g=I.getIndex(U)),(k&N.OPERATION.DELETE)===N.OPERATION.DELETE&&(k!==N.OPERATION.DELETE_AND_ADD&&I.deleteByIndex(U),n&&n.$changes&&S.removeRef(n.$changes.refId),A=null),void 0!==C){if(k===N.OPERATION.DELETE);else if(Z.is(Q)){var E=UN(d,X);if(A=S.refs.get(E),k!==N.OPERATION.REPLACE){var V=this.getSchemaType(d,X,Q);A||((A=this.createTypeInstance(V)).$changes.refId=E,n&&(A.$callbacks=n.$callbacks,n.$changes.refId&&E!==n.$changes.refId&&S.removeRef(n.$changes.refId))),S.addRef(E,A,A!==n)}}else if("string"===typeof Q)A=WN(Q,d,X);else{var O=M(Object.keys(Q)[0]),K=UN(d,X),r=S.refs.has(K)?n||S.refs.get(K):new O.constructor;if((A=r.clone(!0)).$changes.refId=K,n&&(A.$callbacks=n.$callbacks,n.$changes.refId&&K!==n.$changes.refId)){S.removeRef(n.$changes.refId);for(var P=n.entries(),W=void 0;(W=P.next())&&!W.done;){var b=(m=W.value)[0],J=m[1];w.push({refId:K,op:N.OPERATION.DELETE,field:b,value:void 0,previousValue:J})}}S.addRef(K,A,r!==n)}if(null!==A&&void 0!==A)if(A.$changes&&A.$changes.setParent(D.ref,D.root,U),I instanceof Z)I[C]=A;else if(I instanceof h)b=g,I.$items.set(b,A),I.$changes.allChanges.add(U);else if(I instanceof T)I.setAt(U,A);else if(I instanceof nN){var F=I.add(A);I.setIndex(U,F)}else I instanceof gN&&!1!==(F=I.add(A))&&I.setIndex(U,F);n!==A&&w.push({refId:j,op:k,field:C,dynamicIndex:g,value:A,previousValue:n})}else{console.warn("@colyseus/schema: definition mismatch");for(var G={offset:X.offset};X.offset<e&&(!QN(d,X)||(G.offset=X.offset+1,!S.refs.has(UN(d,G))));)X.offset++}}else I.clear(w)}else{j=UN(d,X);var x=S.refs.get(j);if(!x)throw new Error('"refId" not found: '.concat(j));I=x}}return this._triggerChanges(w),S.garbageCollectDeletedRefs(),w},Z.prototype.encode=function(d,X,I){void 0===d&&(d=!1),void 0===X&&(X=[]),void 0===I&&(I=!1);for(var m=this.$changes,w=new WeakSet,S=[m],e=1,j=0;j<e;j++){var B=S[j],D=B.ref,v=D instanceof Z;B.ensureRefId(),w.add(B),B!==m&&(B.changed||d)&&(J(X,z),c(X,B.refId));for(var T=d?Array.from(B.allChanges):Array.from(B.changes.values()),k=0,U=T.length;k<U;k++){var C=d?{op:N.OPERATION.ADD,index:T[k]}:T[k],Q=C.index,A=v?D._definition.fieldsByIndex&&D._definition.fieldsByIndex[Q]:Q,n=X.length;if(C.op!==N.OPERATION.TOUCH)if(v)J(X,Q|C.op);else{if(J(X,C.op),C.op===N.OPERATION.CLEAR)continue;c(X,Q)}if(v||(C.op&N.OPERATION.ADD)!=N.OPERATION.ADD||D instanceof h&&a(X,B.ref.$indexes.get(Q)),C.op!==N.OPERATION.DELETE){var g=B.getType(Q),E=B.getValue(Q);if(E&&E.$changes&&!w.has(E.$changes)&&(S.push(E.$changes),E.$changes.ensureRefId(),e++),C.op!==N.OPERATION.TOUCH){if(Z.is(g))rN(E,g,D,A),c(X,E.$changes.refId),(C.op&N.OPERATION.ADD)===N.OPERATION.ADD&&this.tryEncodeTypeId(X,g,E.constructor);else if("string"===typeof g)PN(g,X,E,D,A);else{var V=M(Object.keys(g)[0]);rN(D["_".concat(A)],V.constructor,D,A),c(X,E.$changes.refId)}I&&B.cache(Q,X.slice(n))}}}d||I||B.discard()}return X},Z.prototype.encodeAll=function(N){return this.encode(!0,[],N)},Z.prototype.applyFilters=function(d,X){var I,m;void 0===X&&(X=!1);for(var w=this,S=new Set,e=EN.get(d),j=[this.$changes],B=1,D=[],v=function(v){var T=j[v];if(S.has(T.refId))return"continue";var k=T.ref,U=k instanceof Z;J(D,z),c(D,T.refId);var C=e.refIds.has(T),M=X||!C;e.addRefId(T);var Q=e.containerIndexes.get(T),A=M?Array.from(T.allChanges):Array.from(T.changes.values());!X&&U&&k._definition.indexesWithFilters&&k._definition.indexesWithFilters.forEach((function(Z){!Q.has(Z)&&T.allChanges.has(Z)&&(M?A.push(Z):A.push({op:N.OPERATION.ADD,index:Z}))}));for(var n=0,g=A.length;n<g;n++){var E=M?{op:N.OPERATION.ADD,index:A[n]}:A[n];if(E.op!==N.OPERATION.CLEAR){var V=E.index;if(E.op!==N.OPERATION.DELETE){var O=T.getValue(V),K=T.getType(V);if(U){if((r=k._definition.filters&&k._definition.filters[V])&&!r.call(k,d,O,w)){O&&O.$changes&&S.add(O.$changes.refId);continue}}else{var r,P=T.parent;if((r=T.getChildrenFilter())&&!r.call(P,d,k.$indexes.get(V),O,w)){O&&O.$changes&&S.add(O.$changes.refId);continue}}if(O.$changes&&(j.push(O.$changes),B++),E.op!==N.OPERATION.TOUCH)if(E.op===N.OPERATION.ADD||U)D.push.apply(D,null!==(I=T.caches[V])&&void 0!==I?I:[]),Q.add(V);else if(Q.has(V))D.push.apply(D,null!==(m=T.caches[V])&&void 0!==m?m:[]);else{if(Q.add(V),J(D,N.OPERATION.ADD),c(D,V),k instanceof h){var W=T.ref.$indexes.get(V);a(D,W)}O.$changes?c(D,O.$changes.refId):R[K](D,O)}else O.$changes&&!U&&(J(D,N.OPERATION.ADD),c(D,V),k instanceof h&&(W=T.ref.$indexes.get(V),a(D,W)),c(D,O.$changes.refId))}else U?J(D,E.op|V):(J(D,E.op),c(D,V))}else J(D,E.op)}},T=0;T<B;T++)v(T);return D},Z.prototype.clone=function(){var N,Z=new this.constructor,d=this._definition.schema;for(var X in d)"object"===typeof this[X]&&"function"===typeof(null===(N=this[X])||void 0===N?void 0:N.clone)?Z[X]=this[X].clone():Z[X]=this[X];return Z},Z.prototype.toJSON=function(){var N=this._definition.schema,Z=this._definition.deprecated,d={};for(var X in N)Z[X]||null===this[X]||"undefined"===typeof this[X]||(d[X]="function"===typeof this[X].toJSON?this[X].toJSON():this["_".concat(X)]);return d},Z.prototype.discardAllChanges=function(){this.$changes.discardAll()},Z.prototype.getByIndex=function(N){return this[this._definition.fieldsByIndex[N]]},Z.prototype.deleteByIndex=function(N){this[this._definition.fieldsByIndex[N]]=void 0},Z.prototype.tryEncodeTypeId=function(N,Z,d){Z._typeid!==d._typeid&&(J(N,w),c(N,d._typeid))},Z.prototype.getSchemaType=function(N,Z,d){var X;return N[Z.offset]===w&&(Z.offset++,X=this.constructor._context.get(UN(N,Z))),X||d},Z.prototype.createTypeInstance=function(N){var Z=new N;return Z.$changes.root=this.$changes.root,Z},Z.prototype._triggerChanges=function(d){for(var X,I,m,z,w,S,e,j,B,D=new Set,v=this.$changes.root.refs,T=function(T){var k=d[T],h=k.refId,U=v.get(h),C=U.$callbacks;if((k.op&N.OPERATION.DELETE)===N.OPERATION.DELETE&&k.previousValue instanceof Z&&(null===(I=null===(X=k.previousValue.$callbacks)||void 0===X?void 0:X[N.OPERATION.DELETE])||void 0===I||I.forEach((function(N){return N()}))),!C)return"continue";if(U instanceof Z){if(!D.has(h))try{null===(m=null===C||void 0===C?void 0:C[N.OPERATION.REPLACE])||void 0===m||m.forEach((function(N){return N()}))}catch(M){Z.onError(M)}try{C.hasOwnProperty(k.field)&&(null===(z=C[k.field])||void 0===z||z.forEach((function(N){return N(k.value,k.previousValue)})))}catch(M){Z.onError(M)}}else k.op===N.OPERATION.ADD&&void 0===k.previousValue?null===(w=C[N.OPERATION.ADD])||void 0===w||w.forEach((function(N){var Z;return N(k.value,null!==(Z=k.dynamicIndex)&&void 0!==Z?Z:k.field)})):k.op===N.OPERATION.DELETE?void 0!==k.previousValue&&(null===(S=C[N.OPERATION.DELETE])||void 0===S||S.forEach((function(N){var Z;return N(k.previousValue,null!==(Z=k.dynamicIndex)&&void 0!==Z?Z:k.field)}))):k.op===N.OPERATION.DELETE_AND_ADD&&(void 0!==k.previousValue&&(null===(e=C[N.OPERATION.DELETE])||void 0===e||e.forEach((function(N){var Z;return N(k.previousValue,null!==(Z=k.dynamicIndex)&&void 0!==Z?Z:k.field)}))),null===(j=C[N.OPERATION.ADD])||void 0===j||j.forEach((function(N){var Z;return N(k.value,null!==(Z=k.dynamicIndex)&&void 0!==Z?Z:k.field)}))),k.value!==k.previousValue&&(null===(B=C[N.OPERATION.REPLACE])||void 0===B||B.forEach((function(N){var Z;return N(k.value,null!==(Z=k.dynamicIndex)&&void 0!==Z?Z:k.field)})));D.add(h)},k=0;k<d.length;k++)T(k)},Z._definition=Q.create(),Z}();function JN(N){for(var Z=[N.$changes],d=1,X={},I=X,m=function(N){var d=Z[N];d.changes.forEach((function(N){var Z=d.ref,X=N.index,m=Z._definition?Z._definition.fieldsByIndex[X]:Z.$indexes.get(X);I[m]=d.getValue(X)}))},z=0;z<d;z++)m(z);return X}var FN={context:new n},GN=function(N){function Z(){return null!==N&&N.apply(this,arguments)||this}return d(Z,N),X([E("string",FN)],Z.prototype,"name",void 0),X([E("string",FN)],Z.prototype,"type",void 0),X([E("number",FN)],Z.prototype,"referencedType",void 0),Z}(bN),xN=function(N){function Z(){var Z=null!==N&&N.apply(this,arguments)||this;return Z.fields=new T,Z}return d(Z,N),X([E("number",FN)],Z.prototype,"id",void 0),X([E([GN],FN)],Z.prototype,"fields",void 0),Z}(bN),tN=function(N){function Z(){var Z=null!==N&&N.apply(this,arguments)||this;return Z.types=new T,Z}return d(Z,N),Z.encode=function(N){var d=N.constructor,X=new Z;X.rootType=d._typeid;var I=function(N,Z){for(var d in Z){var I=new GN;I.name=d;var m=void 0;if("string"===typeof Z[d])m=Z[d];else{var z=Z[d],w=void 0;bN.is(z)?(m="ref",w=Z[d]):"string"===typeof z[m=Object.keys(z)[0]]?m+=":"+z[m]:w=z[m],I.referencedType=w?w._typeid:-1}I.type=m,N.fields.push(I)}X.types.push(N)},m=d._context.types;for(var z in m){var w=new xN;w.id=Number(z),I(w,m[z]._definition.schema)}return X.encodeAll()},Z.decode=function(N,X){var I=new n,m=new Z;m.decode(N,X);var z=m.types.reduce((function(N,Z){var X=function(N){function Z(){return null!==N&&N.apply(this,arguments)||this}return d(Z,N),Z}(bN),m=Z.id;return N[m]=X,I.add(X,m),N}),{});m.types.forEach((function(N){var Z=z[N.id];N.fields.forEach((function(N){var d;if(void 0!==N.referencedType){var X=N.type,m=z[N.referencedType];if(!m){var w=N.type.split(":");X=w[0],m=w[1]}"ref"===X?E(m,{context:I})(Z.prototype,N.name):E(((d={})[X]=m,d),{context:I})(Z.prototype,N.name)}else E(N.type,{context:I})(Z.prototype,N.name)}))}));var w=z[m.rootType],S=new w;for(var e in w._definition.schema){var j=w._definition.schema[e];"string"!==typeof j&&(S[e]="function"===typeof j?new j:new(M(Object.keys(j)[0]).constructor))}return S},X([E([xN],FN)],Z.prototype,"types",void 0),X([E("number",FN)],Z.prototype,"rootType",void 0),Z}(bN);C("map",{constructor:h}),C("array",{constructor:T}),C("set",{constructor:gN}),C("collection",{constructor:nN}),N.ArraySchema=T,N.CollectionSchema=nN,N.Context=n,N.MapSchema=h,N.Reflection=tN,N.ReflectionField=GN,N.ReflectionType=xN,N.Schema=bN,N.SchemaDefinition=Q,N.SetSchema=gN,N.decode=AN,N.defineTypes=r,N.deprecated=K,N.dumpChanges=JN,N.encode=R,N.filter=V,N.filterChildren=O,N.hasFilter=A,N.registerType=C,N.type=E,Object.defineProperty(N,"__esModule",{value:!0})}(Z)},11879:N=>{N.exports=function(N){return null!=N&&null!=N.constructor&&"function"===typeof N.constructor.isBuffer&&N.constructor.isBuffer(N)}},11866:(N,Z,d)=>{"use strict";var X=d(11871),I=d(11876),m=d(11879);d.g.__TYPEDARRAY_POOL||(d.g.__TYPEDARRAY_POOL={UINT8:I([32,0]),UINT16:I([32,0]),UINT32:I([32,0]),INT8:I([32,0]),INT16:I([32,0]),INT32:I([32,0]),FLOAT:I([32,0]),DOUBLE:I([32,0]),DATA:I([32,0]),UINT8C:I([32,0]),BUFFER:I([32,0])});var z="undefined"!==typeof Uint8ClampedArray,w=d.g.__TYPEDARRAY_POOL;w.UINT8C||(w.UINT8C=I([32,0])),w.BUFFER||(w.BUFFER=I([32,0]));var S=w.DATA,e=w.BUFFER;function j(N){if(N){var Z=N.length||N.byteLength,d=X.log2(Z);S[d].push(N)}}function B(N){N=X.nextPow2(N);var Z=X.log2(N),d=S[Z];return d.length>0?d.pop():new ArrayBuffer(N)}function D(N){return new Uint8Array(B(N),0,N)}function v(N){return new Uint16Array(B(2*N),0,N)}function T(N){return new Uint32Array(B(4*N),0,N)}function k(N){return new Int8Array(B(N),0,N)}function h(N){return new Int16Array(B(2*N),0,N)}function U(N){return new Int32Array(B(4*N),0,N)}function C(N){return new Float32Array(B(4*N),0,N)}function M(N){return new Float64Array(B(8*N),0,N)}function Q(N){return z?new Uint8ClampedArray(B(N),0,N):D(N)}function A(N){return new DataView(B(N),0,N)}Z.free=function(N){if(m(N))e[X.log2(N.length)].push(N);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(N)&&(N=N.buffer),!N)return;var Z=N.length||N.byteLength,d=0|X.log2(Z);S[d].push(N)}},Z.freeUint8=Z.freeUint16=Z.freeUint32=Z.freeInt8=Z.freeInt16=Z.freeInt32=Z.freeFloat32=Z.freeFloat=Z.freeFloat64=Z.freeDouble=Z.freeUint8Clamped=Z.freeDataView=function(N){j(N.buffer)},Z.freeArrayBuffer=j,Z.freeBuffer=function(N){e[X.log2(N.length)].push(N)},Z.malloc=function(N,Z){if(void 0===Z||"arraybuffer"===Z)return B(N);switch(Z){case"uint8":return D(N);case"uint16":return v(N);case"uint32":return T(N);case"int8":return k(N);case"int16":return h(N);case"int32":return U(N);case"float":case"float32":return C(N);case"double":case"float64":return M(N);case"uint8_clamped":return Q(N);case"buffer":throw"Buffer not supported";case"data":case"dataview":return A(N);default:return null}return null},Z.mallocArrayBuffer=B,Z.mallocUint8=D,Z.mallocUint16=v,Z.mallocUint32=T,Z.mallocInt8=k,Z.mallocInt16=h,Z.mallocInt32=U,Z.mallocFloat32=Z.mallocFloat=C,Z.mallocFloat64=Z.mallocDouble=M,Z.mallocUint8Clamped=Q,Z.mallocDataView=A,Z.clearCache=function(){for(var N=0;N<32;++N)w.UINT8[N].length=0,w.UINT16[N].length=0,w.UINT32[N].length=0,w.INT8[N].length=0,w.INT16[N].length=0,w.INT32[N].length=0,w.FLOAT[N].length=0,w.DOUBLE[N].length=0,w.UINT8C[N].length=0,S[N].length=0,e[N].length=0}},11944:(N,Z,d)=>{N.exports=I;var X=d(133);function I(N,Z){if(!(this instanceof I))return new I(N,Z);var d=X.create();X.add(d,N,Z),this.Lc=X.min(X.create(),N,d),this.xh=X.clone(Z),this.max=X.max(X.create(),N,d),this.mag=X.length(this.xh)}var m=I.prototype;m.width=function(){return this.xh[0]},m.height=function(){return this.xh[1]},m.depth=function(){return this.xh[2]},m.x0=function(){return this.Lc[0]},m.y0=function(){return this.Lc[1]},m.z0=function(){return this.Lc[2]},m.x1=function(){return this.max[0]},m.y1=function(){return this.max[1]},m.z1=function(){return this.max[2]},m.translate=function(N){return X.add(this.max,this.max,N),X.add(this.Lc,this.Lc,N),this},m.setPosition=function(N){return X.add(this.max,N,this.xh),X.j(this.Lc,N),this},m.expand=function(N){var Z=X.create(),d=X.create();return X.max(Z,N.max,this.max),X.min(d,N.Lc,this.Lc),X.rc(Z,Z,d),new I(d,Z)},m.intersects=function(N){return!(N.Lc[0]>this.max[0])&&(!(N.Lc[1]>this.max[1])&&(!(N.Lc[2]>this.max[2])&&(!(N.max[0]<this.Lc[0])&&(!(N.max[1]<this.Lc[1])&&!(N.max[2]<this.Lc[2])))))},m.touches=function(N){var Z=this.union(N);return null!==Z&&(0==Z.width()||0==Z.height()||0==Z.depth())},m.union=function(N){if(!this.intersects(N))return null;var Z=Math.max(N.Lc[0],this.Lc[0]),d=Math.max(N.Lc[1],this.Lc[1]),X=Math.max(N.Lc[2],this.Lc[2]);return new I([Z,d,X],[Math.min(N.max[0],this.max[0])-Z,Math.min(N.max[1],this.max[1])-d,Math.min(N.max[2],this.max[2])-X])}},11871:(N,Z)=>{"use strict";function d(N){var Z=32;return(N&=-N)&&Z--,65535&N&&(Z-=16),16711935&N&&(Z-=8),252645135&N&&(Z-=4),858993459&N&&(Z-=2),1431655765&N&&(Z-=1),Z}Z.INT_BITS=32,Z.INT_MAX=2147483647,Z.INT_MIN=-1<<31,Z.sign=function(N){return(N>0)-(N<0)},Z.abs=function(N){var Z=N>>31;return(N^Z)-Z},Z.min=function(N,Z){return Z^(N^Z)&-(N<Z)},Z.max=function(N,Z){return N^(N^Z)&-(N<Z)},Z.isPow2=function(N){return!(N&N-1)&&!!N},Z.log2=function(N){var Z,d;return Z=(N>65535)<<4,Z|=d=((N>>>=Z)>255)<<3,Z|=d=((N>>>=d)>15)<<2,(Z|=d=((N>>>=d)>3)<<1)|(N>>>=d)>>1},Z.log10=function(N){return N>=1e9?9:N>=1e8?8:N>=1e7?7:N>=1e6?6:N>=1e5?5:N>=1e4?4:N>=1e3?3:N>=100?2:N>=10?1:0},Z.popCount=function(N){return 16843009*((N=(858993459&(N-=N>>>1&1431655765))+(N>>>2&858993459))+(N>>>4)&252645135)>>>24},Z.countTrailingZeros=d,Z.nextPow2=function(N){return N+=0===N,--N,N|=N>>>1,N|=N>>>2,N|=N>>>4,N|=N>>>8,(N|=N>>>16)+1},Z.prevPow2=function(N){return N|=N>>>1,N|=N>>>2,N|=N>>>4,N|=N>>>8,(N|=N>>>16)-(N>>>1)},Z.parity=function(N){return N^=N>>>16,N^=N>>>8,N^=N>>>4,27030>>>(N&=15)&1};var X=new Array(256);!function(N){for(var Z=0;Z<256;++Z){var d=Z,X=Z,I=7;for(d>>>=1;d;d>>>=1)X<<=1,X|=1&d,--I;N[Z]=X<<I&255}}(X),Z.reverse=function(N){return X[255&N]<<24|X[N>>>8&255]<<16|X[N>>>16&255]<<8|X[N>>>24&255]},Z.interleave2=function(N,Z){return(N=1431655765&((N=858993459&((N=252645135&((N=16711935&((N&=65535)|N<<8))|N<<4))|N<<2))|N<<1))|(Z=1431655765&((Z=858993459&((Z=252645135&((Z=16711935&((Z&=65535)|Z<<8))|Z<<4))|Z<<2))|Z<<1))<<1},Z.deinterleave2=function(N,Z){return(N=65535&((N=16711935&((N=252645135&((N=858993459&((N=N>>>Z&1431655765)|N>>>1))|N>>>2))|N>>>4))|N>>>16))<<16>>16},Z.interleave3=function(N,Z,d){return N=1227133513&((N=3272356035&((N=251719695&((N=4278190335&((N&=1023)|N<<16))|N<<8))|N<<4))|N<<2),(N|=(Z=1227133513&((Z=3272356035&((Z=251719695&((Z=4278190335&((Z&=1023)|Z<<16))|Z<<8))|Z<<4))|Z<<2))<<1)|(d=1227133513&((d=3272356035&((d=251719695&((d=4278190335&((d&=1023)|d<<16))|d<<8))|d<<4))|d<<2))<<2},Z.deinterleave3=function(N,Z){return(N=1023&((N=4278190335&((N=251719695&((N=3272356035&((N=N>>>Z&1227133513)|N>>>2))|N>>>4))|N>>>8))|N>>>16))<<22>>22},Z.nextCombination=function(N){var Z=N|N-1;return Z+1|(~Z&-~Z)-1>>>d(N)+1}},11860:(N,Z,d)=>{"use strict";N.exports=function(N,Z,d){switch(arguments.length){case 1:return X=[],e(I=N,I,j,!0),X;case 2:return"function"===typeof Z?e(N,N,Z,!0):function(N,Z){return X=[],e(N,Z,j,!1),X}(N,Z);case 3:return e(N,Z,d,!1);default:throw new Error("box-intersect: Invalid arguments")}var I};var X,I=d(11866),m=d(11887),z=d(11892);function w(N,Z){for(var d=0;d<N;++d)if(!(Z[d]<=Z[d+N]))return!0;return!1}function S(N,Z,d,X){for(var I=0,m=0,z=0,S=N.length;z<S;++z){var e=N[z];if(!w(Z,e)){for(var j=0;j<2*Z;++j)d[I++]=e[j];X[m++]=z}}return m}function e(N,Z,d,X){var w=N.length,e=Z.length;if(!(w<=0||e<=0)){var j=N[0].length>>>1;if(!(j<=0)){var B,D=I.mallocDouble(2*j*w),v=I.mallocInt32(w);if((w=S(N,j,D,v))>0){if(1===j&&X)m.init(w),B=m.sweepComplete(j,d,0,w,D,v,0,w,D,v);else{var T=I.mallocDouble(2*j*e),k=I.mallocInt32(e);(e=S(Z,j,T,k))>0&&(m.init(w+e),B=1===j?m.sweepBipartite(j,d,0,w,D,v,0,e,T,k):z(j,d,X,w,D,v,e,T,k),I.free(T),I.free(k))}I.free(D),I.free(v)}return B}}}function j(N,Z){X.push([N,Z])}},11898:(N,Z)=>{"use strict";var d="d",X="ax",I="fp",m="es",z="rs",w="re",S="rb",e="bs",j="be",B="bb",D=[d,X,"vv",z,w,S,"ri",e,j,B,"bi"];function v(N){var Z="bruteForce"+(N?"Full":"Partial"),X=[],z=D.slice();N||z.splice(3,0,I);var w=["function "+Z+"("+z.join()+"){"];function S(Z,I){var z=function(N,Z,X){var I="bruteForce"+(N?"Red":"Blue")+(Z?"Flip":"")+(X?"Full":""),z=["function ",I,"(",D.join(),"){","var ",m,"=2*",d,";"],w="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",S="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(X?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return N?z.push(w,"Q",":",S):z.push(S,"Q",":",w),X?z.push("if(y1<x0||x1<y0)continue;"):Z?z.push("if(y0<=x0||x1<y0)continue;"):z.push("if(y0<x0||x1<y0)continue;"),z.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),Z?z.push("yi,xi"):z.push("xi,yi"),z.push(");if(rv!==void 0)return rv;}}}"),{name:I,code:z.join("")}}(Z,I,N);X.push(z.code),w.push("return "+z.name+"("+D.join()+");")}w.push("if(re-rs>be-bs){"),N?(S(!0,!1),w.push("}else{"),S(!1,!1)):(w.push("if(fp){"),S(!0,!0),w.push("}else{"),S(!0,!1),w.push("}}else{if(fp){"),S(!1,!0),w.push("}else{"),S(!1,!1),w.push("}")),w.push("}}return "+Z);var e=X.join("")+w.join("");return new Function(e)()}Z.partial=v(!1),Z.full=v(!0)},11892:(N,Z,d)=>{"use strict";N.exports=function(N,Z,d,m,j,K,r,P,W){!function(N,Z){var d=8*I.log2(Z+1)*(N+1)|0,m=I.nextPow2(Q*d);n.length<m&&(X.free(n),n=X.mallocInt32(m));var z=I.nextPow2(A*d);g.length<z&&(X.free(g),g=X.mallocDouble(z))}(N,m+r);var b,J=0,F=2*N;E(J++,0,0,m,0,r,d?16:0,-1/0,1/0),d||E(J++,0,0,r,0,m,1,-1/0,1/0);for(;J>0;){var G=(J-=1)*Q,x=n[G],t=n[G+1],q=n[G+2],Y=n[G+3],s=n[G+4],L=n[G+5],H=J*A,i=g[H],p=g[H+1],y=1&L,l=!!(16&L),u=j,a=K,c=P,R=W;if(y&&(u=P,a=W,c=j,R=K),!(2&L&&t>=(q=h(N,x,t,q,u,a,p)))&&!(4&L&&(t=U(N,x,t,q,u,a,i))>=q)){var f=q-t,o=s-Y;if(l){if(N*f*(f+o)<v){if(void 0!==(b=S.scanComplete(N,x,Z,t,q,u,a,Y,s,c,R)))return b;continue}}else{if(N*Math.min(f,o)<B){if(void 0!==(b=z(N,x,Z,y,t,q,u,a,Y,s,c,R)))return b;continue}if(N*f*o<D){if(void 0!==(b=S.scanBipartite(N,x,Z,y,t,q,u,a,Y,s,c,R)))return b;continue}}var NN=T(N,x,t,q,u,a,i,p);if(t<NN)if(N*(NN-t)<B){if(void 0!==(b=w(N,x+1,Z,t,NN,u,a,Y,s,c,R)))return b}else if(x===N-2){if(void 0!==(b=y?S.sweepBipartite(N,Z,Y,s,c,R,t,NN,u,a):S.sweepBipartite(N,Z,t,NN,u,a,Y,s,c,R)))return b}else E(J++,x+1,t,NN,Y,s,y,-1/0,1/0),E(J++,x+1,Y,s,t,NN,1^y,-1/0,1/0);if(NN<q){var ZN=e(N,x,Y,s,c,R),dN=c[F*ZN+x],XN=k(N,x,ZN,s,c,R,dN);if(XN<s&&E(J++,x,NN,q,XN,s,(4|y)+(l?16:0),dN,p),Y<ZN&&E(J++,x,NN,q,Y,ZN,(2|y)+(l?16:0),i,dN),ZN+1===XN){if(void 0!==(b=l?O(N,x,Z,NN,q,u,a,ZN,c,R[ZN]):V(N,x,Z,y,NN,q,u,a,ZN,c,R[ZN])))return b}else if(ZN<XN){var IN;if(l){if(NN<(IN=C(N,x,NN,q,u,a,dN))){var mN=k(N,x,NN,IN,u,a,dN);if(x===N-2){if(NN<mN&&void 0!==(b=S.sweepComplete(N,Z,NN,mN,u,a,ZN,XN,c,R)))return b;if(mN<IN&&void 0!==(b=S.sweepBipartite(N,Z,mN,IN,u,a,ZN,XN,c,R)))return b}else NN<mN&&E(J++,x+1,NN,mN,ZN,XN,16,-1/0,1/0),mN<IN&&(E(J++,x+1,mN,IN,ZN,XN,0,-1/0,1/0),E(J++,x+1,ZN,XN,mN,IN,1,-1/0,1/0))}}else NN<(IN=y?M(N,x,NN,q,u,a,dN):C(N,x,NN,q,u,a,dN))&&(x===N-2?b=y?S.sweepBipartite(N,Z,ZN,XN,c,R,NN,IN,u,a):S.sweepBipartite(N,Z,NN,IN,u,a,ZN,XN,c,R):(E(J++,x+1,NN,IN,ZN,XN,y,-1/0,1/0),E(J++,x+1,ZN,XN,NN,IN,1^y,-1/0,1/0)))}}}}};var X=d(11866),I=d(11871),m=d(11898),z=m.partial,w=m.full,S=d(11887),e=d(11902),j=d(11906),B=128,D=1<<22,v=1<<22,T=j("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),k=j("lo===p0",["p0"]),h=j("lo<p0",["p0"]),U=j("hi<=p0",["p0"]),C=j("lo<=p0&&p0<=hi",["p0"]),M=j("lo<p0&&p0<=hi",["p0"]),Q=6,A=2,n=X.mallocInt32(1024),g=X.mallocDouble(1024);function E(N,Z,d,X,I,m,z,w,S){var e=Q*N;n[e]=Z,n[e+1]=d,n[e+2]=X,n[e+3]=I,n[e+4]=m,n[e+5]=z;var j=A*N;g[j]=w,g[j+1]=S}function V(N,Z,d,X,I,m,z,w,S,e,j){var B=2*N,D=S*B,v=e[D+Z];N:for(var T=I,k=I*B;T<m;++T,k+=B){var h=z[k+Z],U=z[k+Z+N];if(!(v<h||U<v)&&(!X||v!==h)){for(var C,M=w[T],Q=Z+1;Q<N;++Q){h=z[k+Q],U=z[k+Q+N];var A=e[D+Q],n=e[D+Q+N];if(U<A||n<h)continue N}if(void 0!==(C=X?d(j,M):d(M,j)))return C}}}function O(N,Z,d,X,I,m,z,w,S,e){var j=2*N,B=w*j,D=S[B+Z];N:for(var v=X,T=X*j;v<I;++v,T+=j){var k=z[v];if(k!==e){var h=m[T+Z],U=m[T+Z+N];if(!(D<h||U<D)){for(var C=Z+1;C<N;++C){h=m[T+C],U=m[T+C+N];var M=S[B+C],Q=S[B+C+N];if(U<M||Q<h)continue N}var A=d(k,e);if(void 0!==A)return A}}}}},11902:(N,Z,d)=>{"use strict";N.exports=function(N,Z,d,z,w,S){if(z<=d+1)return d;var e=d,j=z,B=z+d>>>1,D=2*N,v=B,T=w[D*B+Z];for(;e<j;){if(j-e<I){m(N,Z,e,j,w,S),T=w[D*B+Z];break}var k=j-e,h=Math.random()*k+e|0,U=w[D*h+Z],C=Math.random()*k+e|0,M=w[D*C+Z],Q=Math.random()*k+e|0,A=w[D*Q+Z];U<=M?A>=M?(v=C,T=M):U>=A?(v=h,T=U):(v=Q,T=A):M>=A?(v=C,T=M):A>=U?(v=h,T=U):(v=Q,T=A);for(var n=D*(j-1),g=D*v,E=0;E<D;++E,++n,++g){var V=w[n];w[n]=w[g],w[g]=V}var O=S[j-1];S[j-1]=S[v],S[v]=O;for(n=D*(j-1),g=D*(v=X(N,Z,e,j-1,w,S,T)),E=0;E<D;++E,++n,++g){V=w[n];w[n]=w[g],w[g]=V}O=S[j-1];if(S[j-1]=S[v],S[v]=O,B<v){for(j=v-1;e<j&&w[D*(j-1)+Z]===T;)j-=1;j+=1}else{if(!(v<B))break;for(e=v+1;e<j&&w[D*e+Z]===T;)e+=1}}return X(N,Z,d,B,w,S,w[D*B+Z])};var X=d(11906)("lo<p0",["p0"]),I=8;function m(N,Z,d,X,I,m){for(var z=2*N,w=z*(d+1)+Z,S=d+1;S<X;++S,w+=z)for(var e=I[w],j=S,B=z*(S-1);j>d&&I[B+Z]>e;--j,B-=z){for(var D=B,v=B+z,T=0;T<z;++T,++D,++v){var k=I[D];I[D]=I[v],I[v]=k}var h=m[j];m[j]=m[j-1],m[j-1]=h}}},11906:N=>{"use strict";N.exports=function(N,d){var X="abcdef".split("").concat(d),I=[];N.indexOf("lo")>=0&&I.push("lo=e[k+n]");N.indexOf("hi")>=0&&I.push("hi=e[k+o]");return X.push(Z.replace("_",I.join()).replace("$",N)),Function.apply(void 0,X)};var Z="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},11889:N=>{"use strict";N.exports=function(N,X){X<=4*Z?d(0,X-1,N):e(0,X-1,N)};var Z=32;function d(N,Z,d){for(var X=2*(N+1),I=N+1;I<=Z;++I){for(var m=d[X++],z=d[X++],w=I,S=X-2;w-- >N;){var e=d[S-2],j=d[S-1];if(e<m)break;if(e===m&&j<z)break;d[S]=e,d[S+1]=j,S-=2}d[S]=m,d[S+1]=z}}function X(N,Z,d){Z*=2;var X=d[N*=2],I=d[N+1];d[N]=d[Z],d[N+1]=d[Z+1],d[Z]=X,d[Z+1]=I}function I(N,Z,d){Z*=2,d[N*=2]=d[Z],d[N+1]=d[Z+1]}function m(N,Z,d,X){Z*=2,d*=2;var I=X[N*=2],m=X[N+1];X[N]=X[Z],X[N+1]=X[Z+1],X[Z]=X[d],X[Z+1]=X[d+1],X[d]=I,X[d+1]=m}function z(N,Z,d,X,I){Z*=2,I[N*=2]=I[Z],I[Z]=d,I[N+1]=I[Z+1],I[Z+1]=X}function w(N,Z,d){Z*=2;var X=d[N*=2],I=d[Z];return!(X<I)&&(X!==I||d[N+1]>d[Z+1])}function S(N,Z,d,X){var I=X[N*=2];return I<Z||I===Z&&X[N+1]<d}function e(N,j,B){var D=(j-N+1)/6|0,v=N+D,T=j-D,k=N+j>>1,h=k-D,U=k+D,C=v,M=h,Q=k,A=U,n=T,g=N+1,E=j-1,V=0;w(C,M,B)&&(V=C,C=M,M=V),w(A,n,B)&&(V=A,A=n,n=V),w(C,Q,B)&&(V=C,C=Q,Q=V),w(M,Q,B)&&(V=M,M=Q,Q=V),w(C,A,B)&&(V=C,C=A,A=V),w(Q,A,B)&&(V=Q,Q=A,A=V),w(M,n,B)&&(V=M,M=n,n=V),w(M,Q,B)&&(V=M,M=Q,Q=V),w(A,n,B)&&(V=A,A=n,n=V);for(var O=B[2*M],K=B[2*M+1],r=B[2*A],P=B[2*A+1],W=2*C,b=2*Q,J=2*n,F=2*v,G=2*k,x=2*T,t=0;t<2;++t){var q=B[W+t],Y=B[b+t],s=B[J+t];B[F+t]=q,B[G+t]=Y,B[x+t]=s}I(h,N,B),I(U,j,B);for(var L=g;L<=E;++L)if(S(L,O,K,B))L!==g&&X(L,g,B),++g;else if(!S(L,r,P,B))for(;;){if(S(E,r,P,B)){S(E,O,K,B)?(m(L,g,E,B),++g,--E):(X(L,E,B),--E);break}if(--E<L)break}z(N,g-1,O,K,B),z(j,E+1,r,P,B),g-2-N<=Z?d(N,g-2,B):e(N,g-2,B),j-(E+2)<=Z?d(E+2,j,B):e(E+2,j,B),E-g<=Z?d(g,E,B):e(g,E,B)}},11887:(N,Z,d)=>{"use strict";N.exports={init:function(N){var Z=I.nextPow2(N);S.length<Z&&(X.free(S),S=X.mallocInt32(Z));e.length<Z&&(X.free(e),e=X.mallocInt32(Z));j.length<Z&&(X.free(j),j=X.mallocInt32(Z));B.length<Z&&(X.free(B),B=X.mallocInt32(Z));D.length<Z&&(X.free(D),D=X.mallocInt32(Z));v.length<Z&&(X.free(v),v=X.mallocInt32(Z));var d=8*Z;T.length<d&&(X.free(T),T=X.mallocDouble(d))},sweepBipartite:function(N,Z,d,X,I,w,D,v,U,C){for(var M=0,Q=2*N,A=N-1,n=Q-1,g=d;g<X;++g){var E=w[g],V=Q*g;T[M++]=I[V+A],T[M++]=-(E+1),T[M++]=I[V+n],T[M++]=E}for(g=D;g<v;++g){E=C[g]+z;var O=Q*g;T[M++]=U[O+A],T[M++]=-E,T[M++]=U[O+n],T[M++]=E}var K=M>>>1;m(T,K);var r=0,P=0;for(g=0;g<K;++g){var W=0|T[2*g+1];if(W>=z)k(j,B,P--,W=W-z|0);else if(W>=0)k(S,e,r--,W);else if(W<=-z){W=-W-z|0;for(var b=0;b<r;++b){if(void 0!==(J=Z(S[b],W)))return J}h(j,B,P++,W)}else{W=-W-1|0;for(b=0;b<P;++b){var J;if(void 0!==(J=Z(W,j[b])))return J}h(S,e,r++,W)}}},sweepComplete:function(N,Z,d,X,I,z,w,U,C,M){for(var Q=0,A=2*N,n=N-1,g=A-1,E=d;E<X;++E){var V=z[E]+1<<1,O=A*E;T[Q++]=I[O+n],T[Q++]=-V,T[Q++]=I[O+g],T[Q++]=V}for(E=w;E<U;++E){V=M[E]+1<<1;var K=A*E;T[Q++]=C[K+n],T[Q++]=1|-V,T[Q++]=C[K+g],T[Q++]=1|V}var r=Q>>>1;m(T,r);var P=0,W=0,b=0;for(E=0;E<r;++E){var J=0|T[2*E+1],F=1&J;if(E<r-1&&J>>1===T[2*E+3]>>1&&(F=2,E+=1),J<0){for(var G=-(J>>1)-1,x=0;x<b;++x){if(void 0!==(t=Z(D[x],G)))return t}if(0!==F)for(x=0;x<P;++x){if(void 0!==(t=Z(S[x],G)))return t}if(1!==F)for(x=0;x<W;++x){var t;if(void 0!==(t=Z(j[x],G)))return t}0===F?h(S,e,P++,G):1===F?h(j,B,W++,G):2===F&&h(D,v,b++,G)}else{G=(J>>1)-1;0===F?k(S,e,P--,G):1===F?k(j,B,W--,G):2===F&&k(D,v,b--,G)}}},scanBipartite:function(N,Z,d,X,I,w,j,B,D,v,U,C){var M=0,Q=2*N,A=Z,n=Z+N,g=1,E=1;X?E=z:g=z;for(var V=I;V<w;++V){var O=V+g,K=Q*V;T[M++]=j[K+A],T[M++]=-O,T[M++]=j[K+n],T[M++]=O}for(V=D;V<v;++V){O=V+E;var r=Q*V;T[M++]=U[r+A],T[M++]=-O}var P=M>>>1;m(T,P);var W=0;for(V=0;V<P;++V){var b=0|T[2*V+1];if(b<0){var J=!1;if((O=-b)>=z?(J=!X,O-=z):(J=!!X,O-=1),J)h(S,e,W++,O);else{var F=C[O],G=Q*O,x=U[G+Z+1],t=U[G+Z+1+N];N:for(var q=0;q<W;++q){var Y=S[q],s=Q*Y;if(!(t<j[s+Z+1]||j[s+Z+1+N]<x)){for(var L=Z+2;L<N;++L)if(U[G+L+N]<j[s+L]||j[s+L+N]<U[G+L])continue N;var H,i=B[Y];if(void 0!==(H=X?d(F,i):d(i,F)))return H}}}}else k(S,e,W--,b-g)}},scanComplete:function(N,Z,d,X,I,w,e,j,B,D,v){for(var k=0,h=2*N,U=Z,C=Z+N,M=X;M<I;++M){var Q=M+z,A=h*M;T[k++]=w[A+U],T[k++]=-Q,T[k++]=w[A+C],T[k++]=Q}for(M=j;M<B;++M){Q=M+1;var n=h*M;T[k++]=D[n+U],T[k++]=-Q}var g=k>>>1;m(T,g);var E=0;for(M=0;M<g;++M){var V=0|T[2*M+1];if(V<0){if((Q=-V)>=z)S[E++]=Q-z;else{var O=v[Q-=1],K=h*Q,r=D[K+Z+1],P=D[K+Z+1+N];N:for(var W=0;W<E;++W){var b=S[W],J=e[b];if(J===O)break;var F=h*b;if(!(P<w[F+Z+1]||w[F+Z+1+N]<r)){for(var G=Z+2;G<N;++G)if(D[K+G+N]<w[F+G]||w[F+G+N]<D[K+G])continue N;var x=d(J,O);if(void 0!==x)return x}}}}else{for(Q=V-z,W=E-1;W>=0;--W)if(S[W]===Q){for(G=W+1;G<E;++G)S[G-1]=S[G];break}--E}}}};var X=d(11866),I=d(11871),m=d(11889),z=1<<28,w=1024,S=X.mallocInt32(w),e=X.mallocInt32(w),j=X.mallocInt32(w),B=X.mallocInt32(w),D=X.mallocInt32(w),v=X.mallocInt32(w),T=X.mallocDouble(8192);function k(N,Z,d,X){var I=Z[X],m=N[d-1];N[I]=m,Z[m]=I}function h(N,Z,d,X){N[d]=X,Z[X]=d}},11997:N=>{"use strict";N.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},11990:(N,Z,d)=>{var X=d(11997),I=d(12006),m=Object.hasOwnProperty,z=Object.create(null);for(var w in X)m.call(X,w)&&(z[X[w]]=w);var S=N.exports={to:{},get:{}};function e(N,Z,d){return Math.min(Math.max(Z,N),d)}function j(N){var Z=Math.round(N).toString(16).toUpperCase();return Z.length<2?"0"+Z:Z}S.get=function(N){var Z,d;switch(N.substring(0,3).toLowerCase()){case"hsl":Z=S.get.hsl(N),d="hsl";break;case"hwb":Z=S.get.hwb(N),d="hwb";break;default:Z=S.get.rgb(N),d="rgb"}return Z?{model:d,value:Z}:null},S.get.rgb=function(N){if(!N)return null;var Z,d,I,z=[0,0,0,1];if(Z=N.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(I=Z[2],Z=Z[1],d=0;d<3;d++){var w=2*d;z[d]=parseInt(Z.slice(w,w+2),16)}I&&(z[3]=parseInt(I,16)/255)}else if(Z=N.match(/^#([a-f0-9]{3,4})$/i)){for(I=(Z=Z[1])[3],d=0;d<3;d++)z[d]=parseInt(Z[d]+Z[d],16);I&&(z[3]=parseInt(I+I,16)/255)}else if(Z=N.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(d=0;d<3;d++)z[d]=parseInt(Z[d+1],0);Z[4]&&(Z[5]?z[3]=.01*parseFloat(Z[4]):z[3]=parseFloat(Z[4]))}else{if(!(Z=N.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(Z=N.match(/^(\w+)$/))?"transparent"===Z[1]?[0,0,0,0]:m.call(X,Z[1])?((z=X[Z[1]])[3]=1,z):null:null;for(d=0;d<3;d++)z[d]=Math.round(2.55*parseFloat(Z[d+1]));Z[4]&&(Z[5]?z[3]=.01*parseFloat(Z[4]):z[3]=parseFloat(Z[4]))}for(d=0;d<3;d++)z[d]=e(z[d],0,255);return z[3]=e(z[3],0,1),z},S.get.hsl=function(N){if(!N)return null;var Z=N.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(Z){var d=parseFloat(Z[4]);return[(parseFloat(Z[1])%360+360)%360,e(parseFloat(Z[2]),0,100),e(parseFloat(Z[3]),0,100),e(isNaN(d)?1:d,0,1)]}return null},S.get.hwb=function(N){if(!N)return null;var Z=N.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(Z){var d=parseFloat(Z[4]);return[(parseFloat(Z[1])%360+360)%360,e(parseFloat(Z[2]),0,100),e(parseFloat(Z[3]),0,100),e(isNaN(d)?1:d,0,1)]}return null},S.to.hex=function(){var N=I(arguments);return"#"+j(N[0])+j(N[1])+j(N[2])+(N[3]<1?j(Math.round(255*N[3])):"")},S.to.rgb=function(){var N=I(arguments);return N.length<4||1===N[3]?"rgb("+Math.round(N[0])+", "+Math.round(N[1])+", "+Math.round(N[2])+")":"rgba("+Math.round(N[0])+", "+Math.round(N[1])+", "+Math.round(N[2])+", "+N[3]+")"},S.to.rgb.percent=function(){var N=I(arguments),Z=Math.round(N[0]/255*100),d=Math.round(N[1]/255*100),X=Math.round(N[2]/255*100);return N.length<4||1===N[3]?"rgb("+Z+"%, "+d+"%, "+X+"%)":"rgba("+Z+"%, "+d+"%, "+X+"%, "+N[3]+")"},S.to.hsl=function(){var N=I(arguments);return N.length<4||1===N[3]?"hsl("+N[0]+", "+N[1]+"%, "+N[2]+"%)":"hsla("+N[0]+", "+N[1]+"%, "+N[2]+"%, "+N[3]+")"},S.to.hwb=function(){var N=I(arguments),Z="";return N.length>=4&&1!==N[3]&&(Z=", "+N[3]),"hwb("+N[0]+", "+N[1]+"%, "+N[2]+"%"+Z+")"},S.to.keyword=function(N){return z[N.slice(0,3)]}},11983:(N,Z,d)=>{const X=d(11990),I=d(12022),m=["keyword","gray","hex"],z={};for(const v of Object.keys(I))z[[...I[v].labels].sort().join("")]=v;const w={};function S(N,Z){if(!(this instanceof S))return new S(N,Z);if(Z&&Z in m&&(Z=null),Z&&!(Z in I))throw new Error("Unknown model: "+Z);let d,e;if(null==N)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(N instanceof S)this.model=N.model,this.color=[...N.color],this.valpha=N.valpha;else if("string"===typeof N){const Z=X.get(N);if(null===Z)throw new Error("Unable to parse color from string: "+N);this.model=Z.model,e=I[this.model].channels,this.color=Z.value.slice(0,e),this.valpha="number"===typeof Z.value[e]?Z.value[e]:1}else if(N.length>0){this.model=Z||"rgb",e=I[this.model].channels;const d=Array.prototype.slice.call(N,0,e);this.color=D(d,e),this.valpha="number"===typeof N[e]?N[e]:1}else if("number"===typeof N)this.model="rgb",this.color=[N>>16&255,N>>8&255,255&N],this.valpha=1;else{this.valpha=1;const Z=Object.keys(N);"alpha"in N&&(Z.splice(Z.indexOf("alpha"),1),this.valpha="number"===typeof N.alpha?N.alpha:0);const X=Z.sort().join("");if(!(X in z))throw new Error("Unable to parse color from object: "+JSON.stringify(N));this.model=z[X];const{labels:m}=I[this.model],w=[];for(d=0;d<m.length;d++)w.push(N[m[d]]);this.color=D(w)}if(w[this.model])for(e=I[this.model].channels,d=0;d<e;d++){const N=w[this.model][d];N&&(this.color[d]=N(this.color[d]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}S.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(N){let Z=this.model in X.to?this:this.rgb();Z=Z.round("number"===typeof N?N:1);const d=1===Z.valpha?Z.color:[...Z.color,this.valpha];return X.to[Z.model](d)},percentString(N){const Z=this.rgb().round("number"===typeof N?N:1),d=1===Z.valpha?Z.color:[...Z.color,this.valpha];return X.to.rgb.percent(d)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const N={},{channels:Z}=I[this.model],{labels:d}=I[this.model];for(let X=0;X<Z;X++)N[d[X]]=this.color[X];return 1!==this.valpha&&(N.alpha=this.valpha),N},unitArray(){const N=this.rgb().color;return N[0]/=255,N[1]/=255,N[2]/=255,1!==this.valpha&&N.push(this.valpha),N},unitObject(){const N=this.rgb().object();return N.r/=255,N.g/=255,N.b/=255,1!==this.valpha&&(N.alpha=this.valpha),N},round(N){return N=Math.max(N||0,0),new S([...this.color.map(e(N)),this.valpha],this.model)},alpha(N){return void 0!==N?new S([...this.color,Math.max(0,Math.min(1,N))],this.model):this.valpha},red:j("rgb",0,B(255)),green:j("rgb",1,B(255)),blue:j("rgb",2,B(255)),hue:j(["hsl","hsv","hsl","hwb","hcg"],0,(N=>(N%360+360)%360)),saturationl:j("hsl",1,B(100)),lightness:j("hsl",2,B(100)),saturationv:j("hsv",1,B(100)),value:j("hsv",2,B(100)),chroma:j("hcg",1,B(100)),gray:j("hcg",2,B(100)),white:j("hwb",1,B(100)),wblack:j("hwb",2,B(100)),cyan:j("cmyk",0,B(100)),magenta:j("cmyk",1,B(100)),yellow:j("cmyk",2,B(100)),black:j("cmyk",3,B(100)),x:j("xyz",0,B(95.047)),y:j("xyz",1,B(100)),z:j("xyz",2,B(108.833)),l:j("lab",0,B(100)),a:j("lab",1),b:j("lab",2),keyword(N){return void 0!==N?new S(N):I[this.model].keyword(this.color)},hex(N){return void 0!==N?new S(N):X.to.hex(this.rgb().round().color)},hexa(N){if(void 0!==N)return new S(N);const Z=this.rgb().round().color;let d=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===d.length&&(d="0"+d),X.to.hex(Z)+d},rgbNumber(){const N=this.rgb().color;return(255&N[0])<<16|(255&N[1])<<8|255&N[2]},luminosity(){const N=this.rgb().color,Z=[];for(const[d,X]of N.entries()){const N=X/255;Z[d]=N<=.04045?N/12.92:((N+.055)/1.055)**2.4}return.2126*Z[0]+.7152*Z[1]+.0722*Z[2]},contrast(N){const Z=this.luminosity(),d=N.luminosity();return Z>d?(Z+.05)/(d+.05):(d+.05)/(Z+.05)},level(N){const Z=this.contrast(N);return Z>=7?"AAA":Z>=4.5?"AA":""},isDark(){const N=this.rgb().color;return(2126*N[0]+7152*N[1]+722*N[2])/1e4<128},isLight(){return!this.isDark()},negate(){const N=this.rgb();for(let Z=0;Z<3;Z++)N.color[Z]=255-N.color[Z];return N},lighten(N){const Z=this.hsl();return Z.color[2]+=Z.color[2]*N,Z},darken(N){const Z=this.hsl();return Z.color[2]-=Z.color[2]*N,Z},saturate(N){const Z=this.hsl();return Z.color[1]+=Z.color[1]*N,Z},desaturate(N){const Z=this.hsl();return Z.color[1]-=Z.color[1]*N,Z},whiten(N){const Z=this.hwb();return Z.color[1]+=Z.color[1]*N,Z},blacken(N){const Z=this.hwb();return Z.color[2]+=Z.color[2]*N,Z},grayscale(){const N=this.rgb().color,Z=.3*N[0]+.59*N[1]+.11*N[2];return S.rgb(Z,Z,Z)},fade(N){return this.alpha(this.valpha-this.valpha*N)},opaquer(N){return this.alpha(this.valpha+this.valpha*N)},rotate(N){const Z=this.hsl();let d=Z.color[0];return d=(d+N)%360,d=d<0?360+d:d,Z.color[0]=d,Z},mix(N,Z){if(!N||!N.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof N);const d=N.rgb(),X=this.rgb(),I=void 0===Z?.5:Z,m=2*I-1,z=d.alpha()-X.alpha(),w=((m*z===-1?m:(m+z)/(1+m*z))+1)/2,e=1-w;return S.rgb(w*d.red()+e*X.red(),w*d.green()+e*X.green(),w*d.blue()+e*X.blue(),d.alpha()*I+X.alpha()*(1-I))}};for(const v of Object.keys(I)){if(m.includes(v))continue;const{channels:N}=I[v];S.prototype[v]=function(){if(this.model===v)return new S(this);for(var N=arguments.length,Z=new Array(N),d=0;d<N;d++)Z[d]=arguments[d];return Z.length>0?new S(Z,v):new S([...(X=I[this.model][v].raw(this.color),Array.isArray(X)?X:[X]),this.valpha],v);var X},S[v]=function(){for(var Z=arguments.length,d=new Array(Z),X=0;X<Z;X++)d[X]=arguments[X];let I=d[0];return"number"===typeof I&&(I=D(d,N)),new S(I,v)}}function e(N){return function(Z){return function(N,Z){return Number(N.toFixed(Z))}(Z,N)}}function j(N,Z,d){N=Array.isArray(N)?N:[N];for(const X of N)(w[X]||(w[X]=[]))[Z]=d;return N=N[0],function(X){let I;return void 0!==X?(d&&(X=d(X)),I=this[N](),I.color[Z]=X,I):(I=this[N]().color[Z],d&&(I=d(I)),I)}}function B(N){return function(Z){return Math.max(0,Math.min(N,Z))}}function D(N,Z){for(let d=0;d<Z;d++)"number"!==typeof N[d]&&(N[d]=0);return N}N.exports=S},12030:(N,Z,d)=>{const X=d(12033),I={};for(const z of Object.keys(X))I[X[z]]=z;const m={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};N.exports=m;for(const z of Object.keys(m)){if(!("channels"in m[z]))throw new Error("missing channels property: "+z);if(!("labels"in m[z]))throw new Error("missing channel labels property: "+z);if(m[z].labels.length!==m[z].channels)throw new Error("channel and label counts mismatch: "+z);const{channels:N,labels:Z}=m[z];delete m[z].channels,delete m[z].labels,Object.defineProperty(m[z],"channels",{value:N}),Object.defineProperty(m[z],"labels",{value:Z})}m.rgb.hsl=function(N){const Z=N[0]/255,d=N[1]/255,X=N[2]/255,I=Math.min(Z,d,X),m=Math.max(Z,d,X),z=m-I;let w,S;m===I?w=0:Z===m?w=(d-X)/z:d===m?w=2+(X-Z)/z:X===m&&(w=4+(Z-d)/z),w=Math.min(60*w,360),w<0&&(w+=360);const e=(I+m)/2;return S=m===I?0:e<=.5?z/(m+I):z/(2-m-I),[w,100*S,100*e]},m.rgb.hsv=function(N){let Z,d,X,I,m;const z=N[0]/255,w=N[1]/255,S=N[2]/255,e=Math.max(z,w,S),j=e-Math.min(z,w,S),B=function(N){return(e-N)/6/j+.5};return 0===j?(I=0,m=0):(m=j/e,Z=B(z),d=B(w),X=B(S),z===e?I=X-d:w===e?I=1/3+Z-X:S===e&&(I=2/3+d-Z),I<0?I+=1:I>1&&(I-=1)),[360*I,100*m,100*e]},m.rgb.hwb=function(N){const Z=N[0],d=N[1];let X=N[2];const I=m.rgb.hsl(N)[0],z=1/255*Math.min(Z,Math.min(d,X));return X=1-1/255*Math.max(Z,Math.max(d,X)),[I,100*z,100*X]},m.rgb.cmyk=function(N){const Z=N[0]/255,d=N[1]/255,X=N[2]/255,I=Math.min(1-Z,1-d,1-X);return[100*((1-Z-I)/(1-I)||0),100*((1-d-I)/(1-I)||0),100*((1-X-I)/(1-I)||0),100*I]},m.rgb.keyword=function(N){const Z=I[N];if(Z)return Z;let d,m=1/0;for(const I of Object.keys(X)){const Z=X[I],S=(w=Z,((z=N)[0]-w[0])**2+(z[1]-w[1])**2+(z[2]-w[2])**2);S<m&&(m=S,d=I)}var z,w;return d},m.keyword.rgb=function(N){return X[N]},m.rgb.xyz=function(N){let Z=N[0]/255,d=N[1]/255,X=N[2]/255;Z=Z>.04045?((Z+.055)/1.055)**2.4:Z/12.92,d=d>.04045?((d+.055)/1.055)**2.4:d/12.92,X=X>.04045?((X+.055)/1.055)**2.4:X/12.92;return[100*(.4124*Z+.3576*d+.1805*X),100*(.2126*Z+.7152*d+.0722*X),100*(.0193*Z+.1192*d+.9505*X)]},m.rgb.lab=function(N){const Z=m.rgb.xyz(N);let d=Z[0],X=Z[1],I=Z[2];d/=95.047,X/=100,I/=108.883,d=d>.008856?d**(1/3):7.787*d+16/116,X=X>.008856?X**(1/3):7.787*X+16/116,I=I>.008856?I**(1/3):7.787*I+16/116;return[116*X-16,500*(d-X),200*(X-I)]},m.hsl.rgb=function(N){const Z=N[0]/360,d=N[1]/100,X=N[2]/100;let I,m,z;if(0===d)return z=255*X,[z,z,z];I=X<.5?X*(1+d):X+d-X*d;const w=2*X-I,S=[0,0,0];for(let e=0;e<3;e++)m=Z+1/3*-(e-1),m<0&&m++,m>1&&m--,z=6*m<1?w+6*(I-w)*m:2*m<1?I:3*m<2?w+(I-w)*(2/3-m)*6:w,S[e]=255*z;return S},m.hsl.hsv=function(N){const Z=N[0];let d=N[1]/100,X=N[2]/100,I=d;const m=Math.max(X,.01);X*=2,d*=X<=1?X:2-X,I*=m<=1?m:2-m;return[Z,100*(0===X?2*I/(m+I):2*d/(X+d)),100*((X+d)/2)]},m.hsv.rgb=function(N){const Z=N[0]/60,d=N[1]/100;let X=N[2]/100;const I=Math.floor(Z)%6,m=Z-Math.floor(Z),z=255*X*(1-d),w=255*X*(1-d*m),S=255*X*(1-d*(1-m));switch(X*=255,I){case 0:return[X,S,z];case 1:return[w,X,z];case 2:return[z,X,S];case 3:return[z,w,X];case 4:return[S,z,X];case 5:return[X,z,w]}},m.hsv.hsl=function(N){const Z=N[0],d=N[1]/100,X=N[2]/100,I=Math.max(X,.01);let m,z;z=(2-d)*X;const w=(2-d)*I;return m=d*I,m/=w<=1?w:2-w,m=m||0,z/=2,[Z,100*m,100*z]},m.hwb.rgb=function(N){const Z=N[0]/360;let d=N[1]/100,X=N[2]/100;const I=d+X;let m;I>1&&(d/=I,X/=I);const z=Math.floor(6*Z),w=1-X;m=6*Z-z,0!==(1&z)&&(m=1-m);const S=d+m*(w-d);let e,j,B;switch(z){default:case 6:case 0:e=w,j=S,B=d;break;case 1:e=S,j=w,B=d;break;case 2:e=d,j=w,B=S;break;case 3:e=d,j=S,B=w;break;case 4:e=S,j=d,B=w;break;case 5:e=w,j=d,B=S}return[255*e,255*j,255*B]},m.cmyk.rgb=function(N){const Z=N[0]/100,d=N[1]/100,X=N[2]/100,I=N[3]/100;return[255*(1-Math.min(1,Z*(1-I)+I)),255*(1-Math.min(1,d*(1-I)+I)),255*(1-Math.min(1,X*(1-I)+I))]},m.xyz.rgb=function(N){const Z=N[0]/100,d=N[1]/100,X=N[2]/100;let I,m,z;return I=3.2406*Z+-1.5372*d+-.4986*X,m=-.9689*Z+1.8758*d+.0415*X,z=.0557*Z+-.204*d+1.057*X,I=I>.0031308?1.055*I**(1/2.4)-.055:12.92*I,m=m>.0031308?1.055*m**(1/2.4)-.055:12.92*m,z=z>.0031308?1.055*z**(1/2.4)-.055:12.92*z,I=Math.min(Math.max(0,I),1),m=Math.min(Math.max(0,m),1),z=Math.min(Math.max(0,z),1),[255*I,255*m,255*z]},m.xyz.lab=function(N){let Z=N[0],d=N[1],X=N[2];Z/=95.047,d/=100,X/=108.883,Z=Z>.008856?Z**(1/3):7.787*Z+16/116,d=d>.008856?d**(1/3):7.787*d+16/116,X=X>.008856?X**(1/3):7.787*X+16/116;return[116*d-16,500*(Z-d),200*(d-X)]},m.lab.xyz=function(N){let Z,d,X;d=(N[0]+16)/116,Z=N[1]/500+d,X=d-N[2]/200;const I=d**3,m=Z**3,z=X**3;return d=I>.008856?I:(d-16/116)/7.787,Z=m>.008856?m:(Z-16/116)/7.787,X=z>.008856?z:(X-16/116)/7.787,Z*=95.047,d*=100,X*=108.883,[Z,d,X]},m.lab.lch=function(N){const Z=N[0],d=N[1],X=N[2];let I;I=360*Math.atan2(X,d)/2/Math.PI,I<0&&(I+=360);return[Z,Math.sqrt(d*d+X*X),I]},m.lch.lab=function(N){const Z=N[0],d=N[1],X=N[2]/360*2*Math.PI;return[Z,d*Math.cos(X),d*Math.sin(X)]},m.rgb.ansi16=function(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[d,X,I]=N;let z=null===Z?m.rgb.hsv(N)[2]:Z;if(z=Math.round(z/50),0===z)return 30;let w=30+(Math.round(I/255)<<2|Math.round(X/255)<<1|Math.round(d/255));return 2===z&&(w+=60),w},m.hsv.ansi16=function(N){return m.rgb.ansi16(m.hsv.rgb(N),N[2])},m.rgb.ansi256=function(N){const Z=N[0],d=N[1],X=N[2];if(Z===d&&d===X)return Z<8?16:Z>248?231:Math.round((Z-8)/247*24)+232;return 16+36*Math.round(Z/255*5)+6*Math.round(d/255*5)+Math.round(X/255*5)},m.ansi16.rgb=function(N){let Z=N%10;if(0===Z||7===Z)return N>50&&(Z+=3.5),Z=Z/10.5*255,[Z,Z,Z];const d=.5*(1+~~(N>50));return[(1&Z)*d*255,(Z>>1&1)*d*255,(Z>>2&1)*d*255]},m.ansi256.rgb=function(N){if(N>=232){const Z=10*(N-232)+8;return[Z,Z,Z]}let Z;N-=16;return[Math.floor(N/36)/5*255,Math.floor((Z=N%36)/6)/5*255,Z%6/5*255]},m.rgb.hex=function(N){const Z=(((255&Math.round(N[0]))<<16)+((255&Math.round(N[1]))<<8)+(255&Math.round(N[2]))).toString(16).toUpperCase();return"000000".substring(Z.length)+Z},m.hex.rgb=function(N){const Z=N.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!Z)return[0,0,0];let d=Z[0];3===Z[0].length&&(d=d.split("").map((N=>N+N)).join(""));const X=parseInt(d,16);return[X>>16&255,X>>8&255,255&X]},m.rgb.hcg=function(N){const Z=N[0]/255,d=N[1]/255,X=N[2]/255,I=Math.max(Math.max(Z,d),X),m=Math.min(Math.min(Z,d),X),z=I-m;let w,S;return w=z<1?m/(1-z):0,S=z<=0?0:I===Z?(d-X)/z%6:I===d?2+(X-Z)/z:4+(Z-d)/z,S/=6,S%=1,[360*S,100*z,100*w]},m.hsl.hcg=function(N){const Z=N[1]/100,d=N[2]/100,X=d<.5?2*Z*d:2*Z*(1-d);let I=0;return X<1&&(I=(d-.5*X)/(1-X)),[N[0],100*X,100*I]},m.hsv.hcg=function(N){const Z=N[1]/100,d=N[2]/100,X=Z*d;let I=0;return X<1&&(I=(d-X)/(1-X)),[N[0],100*X,100*I]},m.hcg.rgb=function(N){const Z=N[0]/360,d=N[1]/100,X=N[2]/100;if(0===d)return[255*X,255*X,255*X];const I=[0,0,0],m=Z%1*6,z=m%1,w=1-z;let S=0;switch(Math.floor(m)){case 0:I[0]=1,I[1]=z,I[2]=0;break;case 1:I[0]=w,I[1]=1,I[2]=0;break;case 2:I[0]=0,I[1]=1,I[2]=z;break;case 3:I[0]=0,I[1]=w,I[2]=1;break;case 4:I[0]=z,I[1]=0,I[2]=1;break;default:I[0]=1,I[1]=0,I[2]=w}return S=(1-d)*X,[255*(d*I[0]+S),255*(d*I[1]+S),255*(d*I[2]+S)]},m.hcg.hsv=function(N){const Z=N[1]/100,d=Z+N[2]/100*(1-Z);let X=0;return d>0&&(X=Z/d),[N[0],100*X,100*d]},m.hcg.hsl=function(N){const Z=N[1]/100,d=N[2]/100*(1-Z)+.5*Z;let X=0;return d>0&&d<.5?X=Z/(2*d):d>=.5&&d<1&&(X=Z/(2*(1-d))),[N[0],100*X,100*d]},m.hcg.hwb=function(N){const Z=N[1]/100,d=Z+N[2]/100*(1-Z);return[N[0],100*(d-Z),100*(1-d)]},m.hwb.hcg=function(N){const Z=N[1]/100,d=1-N[2]/100,X=d-Z;let I=0;return X<1&&(I=(d-X)/(1-X)),[N[0],100*X,100*I]},m.apple.rgb=function(N){return[N[0]/65535*255,N[1]/65535*255,N[2]/65535*255]},m.rgb.apple=function(N){return[N[0]/255*65535,N[1]/255*65535,N[2]/255*65535]},m.gray.rgb=function(N){return[N[0]/100*255,N[0]/100*255,N[0]/100*255]},m.gray.hsl=function(N){return[0,0,N[0]]},m.gray.hsv=m.gray.hsl,m.gray.hwb=function(N){return[0,100,N[0]]},m.gray.cmyk=function(N){return[0,0,0,N[0]]},m.gray.lab=function(N){return[N[0],0,0]},m.gray.hex=function(N){const Z=255&Math.round(N[0]/100*255),d=((Z<<16)+(Z<<8)+Z).toString(16).toUpperCase();return"000000".substring(d.length)+d},m.rgb.gray=function(N){return[(N[0]+N[1]+N[2])/3/255*100]}},12022:(N,Z,d)=>{const X=d(12030),I=d(12038),m={};Object.keys(X).forEach((N=>{m[N]={},Object.defineProperty(m[N],"channels",{value:X[N].channels}),Object.defineProperty(m[N],"labels",{value:X[N].labels});const Z=I(N);Object.keys(Z).forEach((d=>{const X=Z[d];m[N][d]=function(N){const Z=function(){for(var Z=arguments.length,d=new Array(Z),X=0;X<Z;X++)d[X]=arguments[X];const I=d[0];if(void 0===I||null===I)return I;I.length>1&&(d=I);const m=N(d);if("object"===typeof m)for(let N=m.length,z=0;z<N;z++)m[z]=Math.round(m[z]);return m};return"conversion"in N&&(Z.conversion=N.conversion),Z}(X),m[N][d].raw=function(N){const Z=function(){for(var Z=arguments.length,d=new Array(Z),X=0;X<Z;X++)d[X]=arguments[X];const I=d[0];return void 0===I||null===I?I:(I.length>1&&(d=I),N(d))};return"conversion"in N&&(Z.conversion=N.conversion),Z}(X)}))})),N.exports=m},12038:(N,Z,d)=>{const X=d(12030);function I(N){const Z=function(){const N={},Z=Object.keys(X);for(let d=Z.length,X=0;X<d;X++)N[Z[X]]={distance:-1,parent:null};return N}(),d=[N];for(Z[N].distance=0;d.length;){const N=d.pop(),I=Object.keys(X[N]);for(let X=I.length,m=0;m<X;m++){const X=I[m],z=Z[X];-1===z.distance&&(z.distance=Z[N].distance+1,z.parent=N,d.unshift(X))}}return Z}function m(N,Z){return function(d){return Z(N(d))}}function z(N,Z){const d=[Z[N].parent,N];let I=X[Z[N].parent][N],z=Z[N].parent;for(;Z[z].parent;)d.unshift(Z[z].parent),I=m(X[Z[z].parent][z],I),z=Z[z].parent;return I.conversion=d,I}N.exports=function(N){const Z=I(N),d={},X=Object.keys(Z);for(let I=X.length,m=0;m<I;m++){const N=X[m];null!==Z[N].parent&&(d[N]=z(N,Z))}return d}},12033:N=>{"use strict";N.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},11093:function(N,Z,d){"use strict";var X=this&&this.__createBinding||(Object.create?function(N,Z,d,X){void 0===X&&(X=d);var I=Object.getOwnPropertyDescriptor(Z,d);I&&!("get"in I?!Z.__esModule:I.writable||I.configurable)||(I={enumerable:!0,get:function(){return Z[d]}}),Object.defineProperty(N,X,I)}:function(N,Z,d,X){void 0===X&&(X=d),N[X]=Z[d]}),I=this&&this.__setModuleDefault||(Object.create?function(N,Z){Object.defineProperty(N,"default",{enumerable:!0,value:Z})}:function(N,Z){N.default=Z}),m=this&&this.__importStar||function(N){if(N&&N.__esModule)return N;var Z={};if(null!=N)for(var d in N)"default"!==d&&Object.prototype.hasOwnProperty.call(N,d)&&X(Z,N,d);return I(Z,N),Z},z=this&&this.__awaiter||function(N,Z,d,X){return new(d||(d=Promise))((function(I,m){function z(N){try{S(X.next(N))}catch(Z){m(Z)}}function w(N){try{S(X.throw(N))}catch(Z){m(Z)}}function S(N){var Z;N.done?I(N.value):(Z=N.value,Z instanceof d?Z:new d((function(N){N(Z)}))).then(z,w)}S((X=X.apply(N,Z||[])).next())}))};Object.defineProperty(Z,"__esModule",{value:!0}),Z.Auth=Z.Platform=void 0;const w=m(d(11030)),S=d(11100),e="colyseus-auth-token";!function(N){N.ios="ios",N.android="android"}(Z.Platform||(Z.Platform={}));Z.Auth=class{constructor(N){this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=N.replace("ws","http"),(0,S.getItem)(e,(N=>this.token=N))}get hasToken(){return!!this.token}login(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return z(this,void 0,void 0,(function*(){const Z=Object.assign({},N);this.hasToken&&(Z.token=this.token);const d=yield this.request("post","/auth",Z);this.token=d.token,(0,S.setItem)(e,this.token);for(let N in d)this.hasOwnProperty(N)&&(this[N]=d[N]);return this.registerPingService(),this}))}save(){return z(this,void 0,void 0,(function*(){return yield this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone}),this}))}getFriends(){return z(this,void 0,void 0,(function*(){return yield this.request("get","/friends/all")}))}getOnlineFriends(){return z(this,void 0,void 0,(function*(){return yield this.request("get","/friends/online")}))}getFriendRequests(){return z(this,void 0,void 0,(function*(){return yield this.request("get","/friends/requests")}))}sendFriendRequest(N){return z(this,void 0,void 0,(function*(){return yield this.request("post","/friends/requests",{userId:N})}))}acceptFriendRequest(N){return z(this,void 0,void 0,(function*(){return yield this.request("put","/friends/requests",{userId:N})}))}declineFriendRequest(N){return z(this,void 0,void 0,(function*(){return yield this.request("del","/friends/requests",{userId:N})}))}blockUser(N){return z(this,void 0,void 0,(function*(){return yield this.request("post","/friends/block",{userId:N})}))}unblockUser(N){return z(this,void 0,void 0,(function*(){return yield this.request("put","/friends/block",{userId:N})}))}request(N,Z){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},X=arguments.length>3?arguments[3]:void 0,I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return z(this,void 0,void 0,(function*(){I.Accept="application/json",this.hasToken&&(I.Authorization="Bearer "+this.token);const m=[];for(const N in d)m.push(`${N}=${d[N]}`);const z=m.length>0?`?${m.join("&")}`:"",S={headers:I};return X&&(S.body=X),(yield w[N](`${this.endpoint}${Z}${z}`,S)).data}))}logout(){this.token=void 0,(0,S.removeItem)(e),this.unregisterPingService()}registerPingService(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;this.unregisterPingService(),this.keepOnlineInterval=setInterval((()=>this.request("get","/auth")),N)}unregisterPingService(){clearInterval(this.keepOnlineInterval)}}},11026:function(N,Z,d){"use strict";var X,I=this&&this.__awaiter||function(N,Z,d,X){return new(d||(d=Promise))((function(I,m){function z(N){try{S(X.next(N))}catch(Z){m(Z)}}function w(N){try{S(X.throw(N))}catch(Z){m(Z)}}function S(N){var Z;N.done?I(N.value):(Z=N.value,Z instanceof d?Z:new d((function(N){N(Z)}))).then(z,w)}S((X=X.apply(N,Z||[])).next())}))};Object.defineProperty(Z,"__esModule",{value:!0}),Z.Client=Z.MatchMakeError=void 0;const m=d(11030),z=d(11034),w=d(11038);class S extends Error{constructor(N,Z){super(N),this.code=Z,Object.setPrototypeOf(this,S.prototype)}}Z.MatchMakeError=S;const e="undefined"!==typeof window&&"undefined"!==typeof(null===(X=null===window||void 0===window?void 0:window.location)||void 0===X?void 0:X.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";Z.Client=class{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e;if("string"===typeof N){const Z=new URL(N),d="https:"===Z.protocol||"wss:"===Z.protocol,X=Number(Z.port||(d?443:80));this.settings={hostname:Z.hostname,pathname:"/"!==Z.pathname?Z.pathname:"",port:X,secure:d}}else void 0===N.port&&(N.port=N.secure?443:80),void 0===N.pathname&&(N.pathname=""),this.settings=N}joinOrCreate(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=arguments.length>2?arguments[2]:void 0;return I(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",N,Z,d)}))}create(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=arguments.length>2?arguments[2]:void 0;return I(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",N,Z,d)}))}join(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=arguments.length>2?arguments[2]:void 0;return I(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",N,Z,d)}))}joinById(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=arguments.length>2?arguments[2]:void 0;return I(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",N,Z,d)}))}reconnect(N,Z){return I(this,void 0,void 0,(function*(){if("string"===typeof N&&"string"===typeof Z)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[d,X]=N.split(":");return yield this.createMatchMakeRequest("reconnect",d,{reconnectionToken:X},Z)}))}getAvailableRooms(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return I(this,void 0,void 0,(function*(){return(yield(0,m.get)(this.getHttpEndpoint(`${N}`),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(N,Z,d){return I(this,void 0,void 0,(function*(){const X=this.createRoom(N.room.name,Z);X.roomId=N.room.roomId,X.sessionId=N.sessionId;const m={sessionId:X.sessionId};N.reconnectionToken&&(m.reconnectionToken=N.reconnectionToken);const w=d||X;return X.connect(this.buildEndpoint(N.room,m),N.devMode&&(()=>I(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${X.roomId}'...`);let d=0;const m=()=>I(this,void 0,void 0,(function*(){d++;try{yield this.consumeSeatReservation(N,Z,w),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${X.roomId}'`)}catch(I){d<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${d} out of 8)`),setTimeout(m,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(m,2e3)}))),w),new Promise(((N,Z)=>{const d=(N,d)=>Z(new z.ServerError(N,d));w.onError.once(d),w.onJoin.once((()=>{w.onError.remove(d),N(w)}))}))}))}createMatchMakeRequest(N,Z){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},X=arguments.length>3?arguments[3]:void 0,z=arguments.length>4?arguments[4]:void 0;return I(this,void 0,void 0,(function*(){const I=(yield(0,m.post)(this.getHttpEndpoint(`${N}/${Z}`),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(d)})).data;if(I.error)throw new S(I.error,I.code);return"reconnect"===N&&(I.reconnectionToken=d.reconnectionToken),yield this.consumeSeatReservation(I,X,z)}))}createRoom(N,Z){return new w.Room(N,Z)}buildEndpoint(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const d=[];for(const I in Z)Z.hasOwnProperty(I)&&d.push(`${I}=${Z[I]}`);let X=this.settings.secure?"wss://":"ws://";return N.publicAddress?X+=`${N.publicAddress}`:X+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`,`${X}/${N.processId}/${N.roomId}?${d.join("&")}`}getHttpEndpoint(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}/matchmake/${N}`}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},11048:(N,Z,d)=>{"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.Connection=void 0;const X=d(11052);Z.Connection=class{constructor(){this.events={},this.transport=new X.WebSocketTransport(this.events)}send(N){this.transport.send(N)}connect(N){this.transport.connect(N)}close(N,Z){this.transport.close(N,Z)}get isOpen(){return this.transport.isOpen}}},11066:(N,Z)=>{"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.utf8Length=Z.utf8Read=Z.ErrorCode=Z.Protocol=void 0,function(N){N[N.HANDSHAKE=9]="HANDSHAKE",N[N.JOIN_ROOM=10]="JOIN_ROOM",N[N.ERROR=11]="ERROR",N[N.LEAVE_ROOM=12]="LEAVE_ROOM",N[N.ROOM_DATA=13]="ROOM_DATA",N[N.ROOM_STATE=14]="ROOM_STATE",N[N.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",N[N.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",N[N.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(Z.Protocol||(Z.Protocol={})),function(N){N[N.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",N[N.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",N[N.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",N[N.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",N[N.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",N[N.AUTH_FAILED=4215]="AUTH_FAILED",N[N.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(Z.ErrorCode||(Z.ErrorCode={})),Z.utf8Read=function(N,Z){const d=N[Z++];for(var X="",I=0,m=Z,z=Z+d;m<z;m++){var w=N[m];if(0!==(128&w))if(192!==(224&w))if(224!==(240&w)){if(240!==(248&w))throw new Error("Invalid byte "+w.toString(16));(I=(7&w)<<18|(63&N[++m])<<12|(63&N[++m])<<6|63&N[++m])>=65536?(I-=65536,X+=String.fromCharCode(55296+(I>>>10),56320+(1023&I))):X+=String.fromCharCode(I)}else X+=String.fromCharCode((15&w)<<12|(63&N[++m])<<6|63&N[++m]);else X+=String.fromCharCode((31&w)<<6|63&N[++m]);else X+=String.fromCharCode(w)}return X},Z.utf8Length=function(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",Z=0,d=0;for(let X=0,I=N.length;X<I;X++)Z=N.charCodeAt(X),Z<128?d+=1:Z<2048?d+=2:Z<55296||Z>=57344?d+=3:(X++,d+=4);return d+1}},11038:function(N,Z,d){"use strict";var X=this&&this.__createBinding||(Object.create?function(N,Z,d,X){void 0===X&&(X=d);var I=Object.getOwnPropertyDescriptor(Z,d);I&&!("get"in I?!Z.__esModule:I.writable||I.configurable)||(I={enumerable:!0,get:function(){return Z[d]}}),Object.defineProperty(N,X,I)}:function(N,Z,d,X){void 0===X&&(X=d),N[X]=Z[d]}),I=this&&this.__setModuleDefault||(Object.create?function(N,Z){Object.defineProperty(N,"default",{enumerable:!0,value:Z})}:function(N,Z){N.default=Z}),m=this&&this.__importStar||function(N){if(N&&N.__esModule)return N;var Z={};if(null!=N)for(var d in N)"default"!==d&&Object.prototype.hasOwnProperty.call(N,d)&&X(Z,N,d);return I(Z,N),Z};Object.defineProperty(Z,"__esModule",{value:!0}),Z.Room=void 0;const z=m(d(11046)),w=d(11048),S=d(11066),e=d(11072),j=d(11077),B=d(11082),D=d(11085),v=d(11034);class T{constructor(N,Z){this.onStateChange=(0,B.createSignal)(),this.onError=(0,B.createSignal)(),this.onLeave=(0,B.createSignal)(),this.onJoin=(0,B.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,j.createNanoEvents)(),this.roomId=null,this.name=N,Z&&(this.serializer=new((0,e.getSerializer)("schema")),this.rootSchema=Z,this.serializer.state=new Z),this.onError(((N,Z)=>{var d;return null===(d=console.warn)||void 0===d?void 0:d.call(console,`colyseus.js - onError => (${N}) ${Z}`)})),this.onLeave((()=>this.removeAllListeners()))}get id(){return this.roomId}connect(N,Z){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;const X=new w.Connection;d.connection=X,X.events.onmessage=T.prototype.onMessageCallback.bind(d),X.events.onclose=function(N){var X;if(!d.hasJoined)return null===(X=console.warn)||void 0===X||X.call(console,`Room connection was closed unexpectedly (${N.code}): ${N.reason}`),void d.onError.invoke(N.code,N.reason);N.code===v.CloseCode.DEVMODE_RESTART&&Z?Z():(d.onLeave.invoke(N.code),d.destroy())},X.events.onerror=function(N){var Z;null===(Z=console.warn)||void 0===Z||Z.call(console,`Room, onError (${N.code}): ${N.reason}`),d.onError.invoke(N.code,N.reason)},X.connect(N)}leave(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((Z=>{this.onLeave((N=>Z(N))),this.connection?N?this.connection.send([S.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(v.CloseCode.CONSENTED)}))}onMessage(N,Z){return this.onMessageHandlers.on(this.getMessageHandlerKey(N),Z)}send(N,Z){const d=[S.Protocol.ROOM_DATA];let X;if("string"===typeof N?D.encode.string(d,N):D.encode.number(d,N),void 0!==Z){const N=z.encode(Z);X=new Uint8Array(d.length+N.byteLength),X.set(new Uint8Array(d),0),X.set(new Uint8Array(N),d.length)}else X=new Uint8Array(d);this.connection.send(X.buffer)}sendBytes(N,Z){const d=[S.Protocol.ROOM_DATA_BYTES];let X;"string"===typeof N?D.encode.string(d,N):D.encode.number(d,N),X=new Uint8Array(d.length+(Z.byteLength||Z.length)),X.set(new Uint8Array(d),0),X.set(new Uint8Array(Z),d.length),this.connection.send(X.buffer)}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(N){const Z=Array.from(new Uint8Array(N.data)),d=Z[0];if(d===S.Protocol.JOIN_ROOM){let N=1;const d=(0,S.utf8Read)(Z,N);if(N+=(0,S.utf8Length)(d),this.serializerId=(0,S.utf8Read)(Z,N),N+=(0,S.utf8Length)(this.serializerId),!this.serializer){const N=(0,e.getSerializer)(this.serializerId);this.serializer=new N}Z.length>N&&this.serializer.handshake&&this.serializer.handshake(Z,{offset:N}),this.reconnectionToken=`${this.roomId}:${d}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([S.Protocol.JOIN_ROOM])}else if(d===S.Protocol.ERROR){const N={offset:1},d=D.decode.number(Z,N),X=D.decode.string(Z,N);this.onError.invoke(d,X)}else if(d===S.Protocol.LEAVE_ROOM)this.leave();else if(d===S.Protocol.ROOM_DATA_SCHEMA){const N={offset:1},d=this.serializer.getState().constructor._context.get(D.decode.number(Z,N)),X=new d;X.decode(Z,N),this.dispatchMessage(d,X)}else if(d===S.Protocol.ROOM_STATE)Z.shift(),this.setState(Z);else if(d===S.Protocol.ROOM_STATE_PATCH)Z.shift(),this.patch(Z);else if(d===S.Protocol.ROOM_DATA){const d={offset:1},X=D.decode.stringCheck(Z,d)?D.decode.string(Z,d):D.decode.number(Z,d),I=Z.length>d.offset?z.decode(N.data,d.offset):void 0;this.dispatchMessage(X,I)}else if(d===S.Protocol.ROOM_DATA_BYTES){const N={offset:1},d=D.decode.stringCheck(Z,N)?D.decode.string(Z,N):D.decode.number(Z,N);this.dispatchMessage(d,new Uint8Array(Z.slice(N.offset)))}}setState(N){this.serializer.setState(N),this.onStateChange.invoke(this.serializer.getState())}patch(N){this.serializer.patch(N),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(N,Z){var d;const X=this.getMessageHandlerKey(N);this.onMessageHandlers.events[X]?this.onMessageHandlers.emit(X,Z):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",N,Z):null===(d=console.warn)||void 0===d||d.call(console,`colyseus.js: onMessage() not registered for type '${N}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(N){switch(typeof N){case"function":return`$${N._typeid}`;case"string":return N;case"number":return`i${N}`;default:throw new Error("invalid message type.")}}}Z.Room=T},11100:(N,Z)=>{"use strict";let d;function X(){return d||(d="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!==typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(N,Z){this.cache[N]=Z},getItem:function(N){this.cache[N]},removeItem:function(N){delete this.cache[N]}}),d}Object.defineProperty(Z,"__esModule",{value:!0}),Z.getItem=Z.removeItem=Z.setItem=void 0,Z.setItem=function(N,Z){X().setItem(N,Z)},Z.removeItem=function(N){X().removeItem(N)},Z.getItem=function(N,Z){const d=X().getItem(N);"undefined"!==typeof Promise&&d instanceof Promise?d.then((N=>Z(N))):Z(d)}},11077:(N,Z)=>{"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.createNanoEvents=void 0;Z.createNanoEvents=()=>({emit(N){let Z=this.events[N]||[];for(var d=arguments.length,X=new Array(d>1?d-1:0),I=1;I<d;I++)X[I-1]=arguments[I];for(let m=0,z=Z.length;m<z;m++)Z[m](...X)},events:{},on(N,Z){var d;return(null===(d=this.events[N])||void 0===d?void 0:d.push(Z))||(this.events[N]=[Z]),()=>{var d;this.events[N]=null===(d=this.events[N])||void 0===d?void 0:d.filter((N=>Z!==N))}}})},11082:(N,Z)=>{"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.createSignal=Z.EventEmitter=void 0;class d{constructor(){this.handlers=[]}register(N){return this.handlers.push(N),this}invoke(){for(var N=arguments.length,Z=new Array(N),d=0;d<N;d++)Z[d]=arguments[d];this.handlers.forEach((N=>N.apply(this,Z)))}invokeAsync(){for(var N=arguments.length,Z=new Array(N),d=0;d<N;d++)Z[d]=arguments[d];return Promise.all(this.handlers.map((N=>N.apply(this,Z))))}remove(N){const Z=this.handlers.indexOf(N);this.handlers[Z]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}Z.EventEmitter=d,Z.createSignal=function(){const N=new d;function Z(Z){return N.register(Z,null===this)}return Z.once=Z=>{const d=function(){for(var X=arguments.length,I=new Array(X),m=0;m<X;m++)I[m]=arguments[m];Z.apply(this,I),N.remove(d)};N.register(d)},Z.remove=Z=>N.remove(Z),Z.invoke=function(){return N.invoke(...arguments)},Z.invokeAsync=function(){return N.invokeAsync(...arguments)},Z.clear=()=>N.clear(),Z}},11034:(N,Z)=>{"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.ServerError=Z.CloseCode=void 0,function(N){N[N.CONSENTED=4e3]="CONSENTED",N[N.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(Z.CloseCode||(Z.CloseCode={}));class d extends Error{constructor(N,Z){super(Z),this.name="ServerError",this.code=N}}Z.ServerError=d},11013:(N,Z,d)=>{"use strict";Z.d=void 0,d(11018);var X=d(11026);Object.defineProperty(Z,"d",{enumerable:!0,get:function(){return X.Client}});var I=d(11066);var m=d(11038);var z=d(11093);const w=d(11105);const S=d(11113),e=d(11072);(0,e.registerSerializer)("schema",w.SchemaSerializer),(0,e.registerSerializer)("none",S.NoneSerializer)},11018:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=N=>null!==N&&"object"===typeof N&&N.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},11046:(N,Z)=>{"use strict";function d(N,Z){if(this._offset=Z,N instanceof ArrayBuffer)this._buffer=N,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(N))throw new Error("Invalid argument");this._buffer=N.buffer,this._view=new DataView(this._buffer,N.byteOffset,N.byteLength)}}Object.defineProperty(Z,"__esModule",{value:!0}),Z.decode=Z.encode=void 0,d.prototype._array=function(N){for(var Z=new Array(N),d=0;d<N;d++)Z[d]=this._parse();return Z},d.prototype._map=function(N){for(var Z={},d=0;d<N;d++)Z[this._parse()]=this._parse();return Z},d.prototype._str=function(N){var Z=function(N,Z,d){for(var X="",I=0,m=Z,z=Z+d;m<z;m++){var w=N.getUint8(m);if(0!==(128&w))if(192!==(224&w))if(224!==(240&w)){if(240!==(248&w))throw new Error("Invalid byte "+w.toString(16));(I=(7&w)<<18|(63&N.getUint8(++m))<<12|(63&N.getUint8(++m))<<6|63&N.getUint8(++m))>=65536?(I-=65536,X+=String.fromCharCode(55296+(I>>>10),56320+(1023&I))):X+=String.fromCharCode(I)}else X+=String.fromCharCode((15&w)<<12|(63&N.getUint8(++m))<<6|63&N.getUint8(++m));else X+=String.fromCharCode((31&w)<<6|63&N.getUint8(++m));else X+=String.fromCharCode(w)}return X}(this._view,this._offset,N);return this._offset+=N,Z},d.prototype._bin=function(N){var Z=this._buffer.slice(this._offset,this._offset+N);return this._offset+=N,Z},d.prototype._parse=function(){var N,Z=this._view.getUint8(this._offset++),d=0,X=0,I=0,m=0;if(Z<192)return Z<128?Z:Z<144?this._map(15&Z):Z<160?this._array(15&Z):this._str(31&Z);if(Z>223)return-1*(255-Z+1);switch(Z){case 192:return null;case 194:return!1;case 195:return!0;case 196:return d=this._view.getUint8(this._offset),this._offset+=1,this._bin(d);case 197:return d=this._view.getUint16(this._offset),this._offset+=2,this._bin(d);case 198:return d=this._view.getUint32(this._offset),this._offset+=4,this._bin(d);case 199:if(d=this._view.getUint8(this._offset),X=this._view.getInt8(this._offset+1),this._offset+=2,-1===X){var z=this._view.getUint32(this._offset);return I=this._view.getInt32(this._offset+4),m=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*I+m)+z/1e6)}return[X,this._bin(d)];case 200:return d=this._view.getUint16(this._offset),X=this._view.getInt8(this._offset+2),this._offset+=3,[X,this._bin(d)];case 201:return d=this._view.getUint32(this._offset),X=this._view.getInt8(this._offset+4),this._offset+=5,[X,this._bin(d)];case 202:return N=this._view.getFloat32(this._offset),this._offset+=4,N;case 203:return N=this._view.getFloat64(this._offset),this._offset+=8,N;case 204:return N=this._view.getUint8(this._offset),this._offset+=1,N;case 205:return N=this._view.getUint16(this._offset),this._offset+=2,N;case 206:return N=this._view.getUint32(this._offset),this._offset+=4,N;case 207:return I=this._view.getUint32(this._offset)*Math.pow(2,32),m=this._view.getUint32(this._offset+4),this._offset+=8,I+m;case 208:return N=this._view.getInt8(this._offset),this._offset+=1,N;case 209:return N=this._view.getInt16(this._offset),this._offset+=2,N;case 210:return N=this._view.getInt32(this._offset),this._offset+=4,N;case 211:return I=this._view.getInt32(this._offset)*Math.pow(2,32),m=this._view.getUint32(this._offset+4),this._offset+=8,I+m;case 212:return X=this._view.getInt8(this._offset),this._offset+=1,0===X?void(this._offset+=1):[X,this._bin(1)];case 213:return X=this._view.getInt8(this._offset),this._offset+=1,[X,this._bin(2)];case 214:return X=this._view.getInt8(this._offset),this._offset+=1,-1===X?(N=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*N)):[X,this._bin(4)];case 215:return X=this._view.getInt8(this._offset),this._offset+=1,0===X?(I=this._view.getInt32(this._offset)*Math.pow(2,32),m=this._view.getUint32(this._offset+4),this._offset+=8,new Date(I+m)):-1===X?(I=this._view.getUint32(this._offset),m=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&I)+m)+(I>>>2)/1e6)):[X,this._bin(8)];case 216:return X=this._view.getInt8(this._offset),this._offset+=1,[X,this._bin(16)];case 217:return d=this._view.getUint8(this._offset),this._offset+=1,this._str(d);case 218:return d=this._view.getUint16(this._offset),this._offset+=2,this._str(d);case 219:return d=this._view.getUint32(this._offset),this._offset+=4,this._str(d);case 220:return d=this._view.getUint16(this._offset),this._offset+=2,this._array(d);case 221:return d=this._view.getUint32(this._offset),this._offset+=4,this._array(d);case 222:return d=this._view.getUint16(this._offset),this._offset+=2,this._map(d);case 223:return d=this._view.getUint32(this._offset),this._offset+=4,this._map(d)}throw new Error("Could not parse")},Z.decode=function(N){var Z=new d(N,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),X=Z._parse();if(Z._offset!==N.byteLength)throw new Error(N.byteLength-Z._offset+" trailing bytes");return X};function X(N,Z,d){for(var X=0,I=0,m=d.length;I<m;I++)(X=d.charCodeAt(I))<128?N.setUint8(Z++,X):X<2048?(N.setUint8(Z++,192|X>>6),N.setUint8(Z++,128|63&X)):X<55296||X>=57344?(N.setUint8(Z++,224|X>>12),N.setUint8(Z++,128|X>>6&63),N.setUint8(Z++,128|63&X)):(I++,X=65536+((1023&X)<<10|1023&d.charCodeAt(I)),N.setUint8(Z++,240|X>>18),N.setUint8(Z++,128|X>>12&63),N.setUint8(Z++,128|X>>6&63),N.setUint8(Z++,128|63&X))}function I(N,Z,d){var X=typeof d,m=0,z=0,w=0,S=0,e=0,j=0;if("string"===X){if(e=function(N){for(var Z=0,d=0,X=0,I=N.length;X<I;X++)(Z=N.charCodeAt(X))<128?d+=1:Z<2048?d+=2:Z<55296||Z>=57344?d+=3:(X++,d+=4);return d}(d),e<32)N.push(160|e),j=1;else if(e<256)N.push(217,e),j=2;else if(e<65536)N.push(218,e>>8,e),j=3;else{if(!(e<4294967296))throw new Error("String too long");N.push(219,e>>24,e>>16,e>>8,e),j=5}return Z.push({_str:d,_length:e,_offset:N.length}),j+e}if("number"===X)return Math.floor(d)===d&&isFinite(d)?d>=0?d<128?(N.push(d),1):d<256?(N.push(204,d),2):d<65536?(N.push(205,d>>8,d),3):d<4294967296?(N.push(206,d>>24,d>>16,d>>8,d),5):(w=d/Math.pow(2,32)|0,S=d>>>0,N.push(207,w>>24,w>>16,w>>8,w,S>>24,S>>16,S>>8,S),9):d>=-32?(N.push(d),1):d>=-128?(N.push(208,d),2):d>=-32768?(N.push(209,d>>8,d),3):d>=-2147483648?(N.push(210,d>>24,d>>16,d>>8,d),5):(w=Math.floor(d/Math.pow(2,32)),S=d>>>0,N.push(211,w>>24,w>>16,w>>8,w,S>>24,S>>16,S>>8,S),9):(N.push(203),Z.push({_float:d,_length:8,_offset:N.length}),9);if("object"===X){if(null===d)return N.push(192),1;if(Array.isArray(d)){if((e=d.length)<16)N.push(144|e),j=1;else if(e<65536)N.push(220,e>>8,e),j=3;else{if(!(e<4294967296))throw new Error("Array too large");N.push(221,e>>24,e>>16,e>>8,e),j=5}for(m=0;m<e;m++)j+=I(N,Z,d[m]);return j}if(d instanceof Date){var B=d.getTime(),D=Math.floor(B/1e3),v=1e6*(B-1e3*D);return D>=0&&v>=0&&D<=17179869183?0===v&&D<=4294967295?(N.push(214,255,D>>24,D>>16,D>>8,D),6):(w=D/4294967296,S=4294967295&D,N.push(215,255,v>>22,v>>14,v>>6,w,S>>24,S>>16,S>>8,S),10):(w=Math.floor(D/4294967296),S=D>>>0,N.push(199,12,255,v>>24,v>>16,v>>8,v,w>>24,w>>16,w>>8,w,S>>24,S>>16,S>>8,S),15)}if(d instanceof ArrayBuffer){if((e=d.byteLength)<256)N.push(196,e),j=2;else if(e<65536)N.push(197,e>>8,e),j=3;else{if(!(e<4294967296))throw new Error("Buffer too large");N.push(198,e>>24,e>>16,e>>8,e),j=5}return Z.push({_bin:d,_length:e,_offset:N.length}),j+e}if("function"===typeof d.toJSON)return I(N,Z,d.toJSON());var T=[],k="",h=Object.keys(d);for(m=0,z=h.length;m<z;m++)void 0!==d[k=h[m]]&&"function"!==typeof d[k]&&T.push(k);if((e=T.length)<16)N.push(128|e),j=1;else if(e<65536)N.push(222,e>>8,e),j=3;else{if(!(e<4294967296))throw new Error("Object too large");N.push(223,e>>24,e>>16,e>>8,e),j=5}for(m=0;m<e;m++)j+=I(N,Z,k=T[m]),j+=I(N,Z,d[k]);return j}if("boolean"===X)return N.push(d?195:194),1;if("undefined"===X)return N.push(192),1;if("function"===typeof d.toJSON)return I(N,Z,d.toJSON());throw new Error("Could not encode")}Z.encode=function(N){var Z=[],d=[],m=I(Z,d,N),z=new ArrayBuffer(m),w=new DataView(z),S=0,e=0,j=-1;d.length>0&&(j=d[0]._offset);for(var B,D=0,v=0,T=0,k=Z.length;T<k;T++)if(w.setUint8(e+T,Z[T]),T+1===j){if(D=(B=d[S])._length,v=e+j,B._bin)for(var h=new Uint8Array(B._bin),U=0;U<D;U++)w.setUint8(v+U,h[U]);else B._str?X(w,v,B._str):void 0!==B._float&&w.setFloat64(v,B._float);e+=D,d[++S]&&(j=d[S]._offset)}return z}},11113:(N,Z)=>{"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.NoneSerializer=void 0;Z.NoneSerializer=class{setState(N){}getState(){return null}patch(N){}teardown(){}handshake(N){}}},11105:(N,Z,d)=>{"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.SchemaSerializer=void 0;const X=d(11085);Z.SchemaSerializer=class{setState(N){return this.state.decode(N)}getState(){return this.state}patch(N){return this.state.decode(N)}teardown(){var N,Z;null===(Z=null===(N=this.state)||void 0===N?void 0:N.$changes)||void 0===Z||Z.root.clearRefs()}handshake(N,Z){if(this.state){(new X.Reflection).decode(N,Z)}else this.state=X.Reflection.decode(N,Z)}}},11072:(N,Z)=>{"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.getSerializer=Z.registerSerializer=void 0;const d={};Z.registerSerializer=function(N,Z){d[N]=Z},Z.getSerializer=function(N){const Z=d[N];if(!Z)throw new Error("missing serializer: "+N);return Z}},11052:function(N,Z,d){"use strict";var X=this&&this.__importDefault||function(N){return N&&N.__esModule?N:{default:N}};Object.defineProperty(Z,"__esModule",{value:!0}),Z.WebSocketTransport=void 0;const I=X(d(11058)),m=globalThis.WebSocket||I.default;Z.WebSocketTransport=class{constructor(N){this.events=N}send(N){N instanceof ArrayBuffer?this.ws.send(N):Array.isArray(N)&&this.ws.send(new Uint8Array(N).buffer)}connect(N){this.ws=new m(N,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(N,Z){this.ws.close(N,Z)}get isOpen(){return this.ws.readyState===m.OPEN}}},11058:N=>{"use strict";N.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},11876:N=>{"use strict";function Z(N,d,X){var I=0|N[X];if(I<=0)return[];var m,z=new Array(I);if(X===N.length-1)for(m=0;m<I;++m)z[m]=d;else for(m=0;m<I;++m)z[m]=Z(N,d,X+1);return z}N.exports=function(N,d){switch("undefined"===typeof d&&(d=0),typeof N){case"number":if(N>0)return function(N,Z){var d,X;for(d=new Array(N),X=0;X<N;++X)d[X]=Z;return d}(0|N,d);break;case"object":if("number"===typeof N.length)return Z(N,d,0)}return[]}},11834:(N,Z,d)=>{N.exports=function(){var N=this;this.components={},this.comps=this.components;var Z=this.components,d=1,I={},m=[],z=[],w={timeout:!1,removals:[],multiComps:[]};function S(N,d){var X=Z[d],m=I[d],z=m.hash[N];z&&(m.remove(N),X.bb&&(X.multi?(z.forEach((Z=>{Z&&X.bb(N,Z)})),z.length=0):X.bb(N,z)),w.removals.push(m),e())}function e(){w.timeout||(w.timeout=!0,setTimeout(j,1))}function j(){w.timeout=!1,B()}function B(){w.multiComps.length&&function(N){for(var Z=0;Z<N.length;Z++){var{entID:d,data:X}=N[Z],I=X.hash[d];if(I){for(var m=0;m<I.length;m++)I[m]||(I.splice(m,1),m--);0===I.length&&(X.remove(d),w.removals.push(X))}}N.length=0}(w.multiComps),w.removals.length&&function(N){for(var Z=0;Z<N.length;Z++){N[Z].flush()}N.length=0}(w.removals)}this.Si=I,this._systems=m,this._renderSystems=z,this.Ch=function(Z){var X=d++;return Array.isArray(Z)&&Z.forEach((Z=>N.qf(X,Z))),X},this.deleteEntity=function(Z){return Object.keys(I).forEach((N=>{I[N].hash[Z]&&S(Z,N)})),N},this.Yh=function(N){if(!N)throw new Error("Missing component definition");var d=N.name;if(!d)throw new Error("Component definition must have a name property.");if("string"!==typeof d)throw new Error("Component name must be a string.");if(""===d)throw new Error("Component name must be a non-empty string.");if(I[d])throw new Error(`Component ${d} already exists.`);var w={};return w.name=d,w.multi=!!N.multi,w.order=isNaN(N.order)?99:N.order,w.stateConstructor=N.stateConstructor||null,w.state=N.state||{},w.Af=N.Af||null,w.bb=N.bb||null,w.system=N.system||null,w.Qg=N.Qg||null,Z[d]=w,I[d]=new X,I[d]._pendingMultiCleanup=!1,I[d]._multiCleanupIDs=w.multi?[]:null,w.system&&(m.push(d),m.sort(((N,d)=>Z[N].order-Z[d].order))),w.Qg&&(z.push(d),z.sort(((N,d)=>Z[N].order-Z[d].order))),d},this.overwriteComponent=function(N,d){var X=Z[N];if(!X)throw new Error(`Unknown component: ${N}`);if(!d)throw new Error("Missing component definition");if(X.name!==d.name)throw new Error("Overwriting component must use the same name property.");var w={};w.name=N,w.multi=!!d.multi,w.order=isNaN(d.order)?99:d.order,w.state=d.state||{},w.Af=d.Af||null,w.bb=d.bb||null,w.system=d.system||null,w.Qg=d.Qg||null,Z[N]=w,I[N]._pendingMultiCleanup=!1,I[N]._multiCleanupIDs=w.multi?[]:null;var S=m.indexOf(N);w.system&&S<0&&m.push(N),!w.system&&S>=0&&m.splice(S,1),m.sort(((N,d)=>Z[N].order-Z[d].order));var e=z.indexOf(N);w.Qg&&e<0&&z.push(N),!w.Qg&&e>=0&&z.splice(e,1),z.sort(((N,d)=>Z[N].order-Z[d].order));var j=w.state;return this.Vg(N).forEach((N=>{for(var Z in j)Z in N||(N[Z]=j[Z]);w.Af&&w.Af(N.Pg,N)})),N},this.deleteComponent=function(d){var X=I[d];if(!X)throw new Error(`Unknown component: ${d}`);X.flush(),X.list.forEach((N=>{N&&S(N.Pg||N[0].Pg,d)}));var w=m.indexOf(d),e=z.indexOf(d);return w>-1&&m.splice(w,1),e>-1&&z.splice(e,1),I[d].dispose(),delete I[d],delete Z[d],N},this.qf=function(N,d,X){var m,z=Z[d],w=I[d];if(!w)throw new Error(`Unknown component: ${d}.`);if(w.hash[N]&&!z.multi)throw new Error(`Entity ${N} already has component: ${d}.`);if(z.stateConstructor){if(!(m=new z.stateConstructor).hasOwnProperty("Pg"))throw new Error(`Component ${z.name} stateConstructor type does not have property __id`)}else m=Object.assign({},{Pg:N},z.state,X);if(m.Pg=N,z.multi){var S=w.hash[N];S||(S=[],w.add(N,S)),S.push(m)}else w.add(N,m);return z.Af&&z.Af(N,m),this},this.Jf=function(N,Z){var d=I[Z];if(!d)throw new Error(`Unknown component: ${Z}.`);return!!d.hash[N]},this.uf=function(Z,d){if(!I[d])throw new Error(`Unknown component: ${d}.`);return S(Z,d),N},this.getState=function(N,Z){var d=I[Z];if(!d)throw new Error(`Unknown component: ${Z}.`);return d.hash[N]},this.Vg=function(N){var Z=I[N];if(!Z)throw new Error(`Unknown component: ${N}.`);return B(),Z.list},this.zk=function(N){if(!I[N])throw new Error(`Unknown component: ${N}.`);var Z=I[N].hash;return N=>Z[N]},this.Ck=function(N){if(!I[N])throw new Error(`Unknown component: ${N}.`);var Z=I[N].hash;return N=>!!Z[N]},this.Ye=function(d){B();for(var X=0;X<m.length;X++){var z=m[X],w=Z[z],S=I[z];w.system(d,S.list),B()}return N},this.render=function(d){B();for(var X=0;X<z.length;X++){var m=z[X],w=Z[m],S=I[m];w.Qg(d,S.list),B()}return N},this.removeMultiComponent=function(d,X,m){var z=Z[X],S=I[X];if(!S)throw new Error(`Unknown component: ${X}.`);if(!z.multi)throw new Error("removeMultiComponent called on non-multi component");return function(N,Z,d,X){var I=d.hash[N];if(I){var m=I[X];m&&(I[X]=null,Z.bb&&Z.bb(N,m),w.multiComps.push({entID:N,data:d}),e())}}(d,z,S,m),N}};var X=d(11840)},11840:N=>{function Z(N,Z){var d=N._map[Z];if(delete N.hash[Z],delete N._map[Z],d===N.list.length-1)N.list.pop();else{var X=N.list.pop();if(N.list[d]=X,null===X||null===X[0]){var I=N.list.length;for(var m in N._map)if(N._map[m]===I)return void(N._map[m]=d)}else{var z=X.Pg||X[0].Pg;N._map[z]=d}}}N.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(N,Z){if("number"===typeof this._map[N]){var d=this._map[N];this.hash[N]=Z,this.list[d]=Z}else this._map[N]=this.list.length,this.hash[N]=Z,this.list.push(Z)}remove(N){var Z=this._map[N];this.hash[N]=null,this.list[Z]=null,this._pendingRemovals.push(N)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var N=0;N<this._pendingRemovals.length;N++){var d=this._pendingRemovals[N];null===this.hash[d]&&Z(this,d)}this._pendingRemovals.length=0}}},12098:N=>{"use strict";N.exports=function(N,Z,d,X,I,m){var z=+Z[0],w=+Z[1],S=+Z[2],e=+d[0],j=+d[1],B=+d[2],D=Math.sqrt(e*e+j*j+B*B);if(0===D)throw new Error("Can't raycast along a zero vector");return function(N,Z,d,X,I,m,z,w,S,e){for(var j=0,B=Math.floor,D=0|B(Z),v=0|B(d),T=0|B(X),k=I>0?1:-1,h=m>0?1:-1,U=z>0?1:-1,C=Math.abs(1/I),M=Math.abs(1/m),Q=Math.abs(1/z),A=C<1/0?C*(k>0?D+1-Z:Z-D):1/0,n=M<1/0?M*(h>0?v+1-d:d-v):1/0,g=Q<1/0?Q*(U>0?T+1-X:X-T):1/0,E=-1;j<=w;){var V=N(D,v,T);if(V)return S&&(S[0]=Z+j*I,S[1]=d+j*m,S[2]=X+j*z),e&&(e[0]=e[1]=e[2]=0,0===E&&(e[0]=-k),1===E&&(e[1]=-h),2===E&&(e[2]=-U)),V;A<n?A<g?(D+=k,j=A,A+=C,E=0):(T+=U,j=g,g+=Q,E=2):n<g?(v+=h,j=n,n+=M,E=1):(T+=U,j=g,g+=Q,E=2)}return S&&(S[0]=Z+j*I,S[1]=d+j*m,S[2]=X+j*z),e&&(e[0]=e[1]=e[2]=0),0}(N,z,w,S,e/=D,j/=D,B/=D,X="undefined"===typeof X?64:+X,I,m)}},12120:(N,Z,d)=>{"use strict";d.d(Z,{b:()=>m});var X=d(692);function I(){this.zj=!1,this.stopPropagation=!1,this.Aj=!1,this.disabled=!1}class m{constructor(N,Z){this.version="0.7.0";var d=Object.assign({},new I,Z||{});this.element=N||document,this.zj=!!d.zj,this.stopPropagation=!!d.stopPropagation,this.Aj=!!d.Aj,this.disabled=!!d.disabled,this.filterEvents=(N,Z)=>!0,this.down=new X.EventEmitter,this.up=new X.EventEmitter,this.state={},this.Jg={dx:0,dy:0,qk:0,Hg:0,rk:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?w(this):document.addEventListener("DOMContentLoaded",(N=>{w(this)}),{once:!0})}bind(N){for(var Z=arguments.length,d=new Array(Z>1?Z-1:0),X=1;X<Z;X++)d[X-1]=arguments[X];d.forEach((Z=>{var d=this._keyBindmap[Z]||[];d.includes(N)||(d.push(N),this._keyBindmap[Z]=d)})),this.state[N]=!!this.state[N],this.pressCount[N]=this.pressCount[N]||0,this.releaseCount[N]=this.releaseCount[N]||0}unbind(N){for(var Z in this._keyBindmap){var d=this._keyBindmap[Z],X=d.indexOf(N);X>-1&&d.splice(X,1)}}getBindings(){var N={};for(var Z in this._keyBindmap){this._keyBindmap[Z].forEach((d=>{N[d]=N[d]||[],N[d].push(Z)}))}return N}Ye(){z(this.Jg),z(this.pressCount),z(this.releaseCount)}}function z(N){for(var Z in N)N[Z]=0}function w(N){window.addEventListener("keydown",T.bind(null,N,!0),!1),window.addEventListener("keyup",T.bind(null,N,!1),!1);var Z={passive:!0};N.element.addEventListener("touchstart",B.bind(void 0,N),{passive:!1}),N.element.addEventListener("touchend",v.bind(void 0,N),Z),N.element.addEventListener("mousedown",k.bind(null,N,!0),Z),window.document.addEventListener("mouseup",k.bind(null,N,!1),Z),N.element.addEventListener("touchmove",h.bind(null,N),Z),N.element.addEventListener("mousemove",h.bind(null,N),Z),window.PointerEvent,N.element.addEventListener("wheel",U.bind(null,N),Z),N.element.addEventListener("contextmenu",C.bind(null,N),!1),window.addEventListener("blur",M.bind(null,N),!1)}var S=0,e=0,j=null;function B(N,Z){Z.preventDefault(),D(Z)}function D(N){let Z=!1;for(let d=0;d<N.touches.length;++d)if(N.touches[d].identifier===j){Z=!0;break}if(!Z){const Z=N.changedTouches[0];S=Z.clientX,e=Z.clientY,j=Z.identifier}}function v(N,Z){for(var d=Z.changedTouches,X=0;X<d.length;++X)d[X].identifier===j&&(j=null)}function T(N,Z,d){Q(d.code,Z,N,d)}function k(N,Z,d){if("pointerId"in d)if(Z){if(null!==N._touches.currID)return;N._touches.currID=d.pointerId}else{if(N._touches.currID!==d.pointerId)return;N._touches.currID=null}return Q("Mouse"+("button"in d?d.button+1:1),Z,N,d),!1}function h(N,Z){var d=Z.movementX||Z.mozMovementX||0,X=Z.movementY||Z.mozMovementY||0;if(Z.touches&&0===(d|X)){var I=function(N){D(N);for(let Z=0;Z<N.changedTouches.length;++Z)if(N.changedTouches[Z].identifier==j){const d=N.changedTouches[Z],X=[d.clientX-S,d.clientY-e];return S=d.clientX,e=d.clientY,X}return console.error(`Did not find touch id ${j}`),[0,0]}(Z);d=I[0],X=I[1]}N.Jg.dx+=d,N.Jg.dy+=X}function U(N,Z){var d=1;switch(Z.deltaMode){case 0:d=1;break;case 1:d=12;break;case 2:d=N.element.clientHeight||window.innerHeight}N.Jg.qk+=(Z.deltaX||0)*d,N.Jg.Hg+=(Z.deltaY||0)*d,N.Jg.rk+=(Z.deltaZ||0)*d}function C(N,Z){if(!N.Aj)return Z.preventDefault(),!1}function M(N){for(var Z in N._keyStates)N._keyStates[Z]&&(/^Mouse\d/.test(Z)||Q(Z,!1,N,{code:Z,note:"This is a mocked KeyboardEvent made by the 'game-inputs' module",preventDefault:()=>{},stopPropagation:()=>{}}))}function Q(N,Z,d,X){var I=d._keyBindmap[N];I&&(A(d._keyStates[N],Z)&&(d._keyStates[N]=Z,I.forEach((N=>{(!d.filterEvents||d.filterEvents(X,N))&&function(N,Z,d,X){var I=Z?d.pressCount:d.releaseCount;I[N]=(I[N]||0)+1;var m=d._bindPressCount[N]||0;(m+=Z?1:-1)<0&&(m=0);d._bindPressCount[N]=m;var z=d.state[N];if(A(z,m)){d.state[N]=m>0;var w=Z?d.down:d.up;d.disabled||w.emit(N,X)}}(N,Z,d,X)}))),"button"in X||(d.zj&&!X.defaultPrevented&&X.preventDefault(),d.stopPropagation&&X.stopPropagation()))}function A(N,Z){return N?!Z:Z}},11165:N=>{"use strict";N.exports=function(N){for(var Z=new Array(N),d=0;d<N;++d)Z[d]=d;return Z}},11174:N=>{function Z(N){return!!N.constructor&&"function"===typeof N.constructor.isBuffer&&N.constructor.isBuffer(N)}N.exports=function(N){return null!=N&&(Z(N)||function(N){return"function"===typeof N.readFloatLE&&"function"===typeof N.slice&&Z(N.slice(0,0))}(N)||!!N._isBuffer)}},12100:(N,Z,d)=>{"use strict";d.d(Z,{e:()=>X});class X{constructor(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.ri=!1,this.si=!1,this.pi=30,this.qi=0,this.Bi=!1,this.fullscreen=!1,this.ui=function(N){},this.wi=function(){},this.zi=function(){},this.cb=function(){},this.xi=function(N){},this.onFullscreenChanged=function(N){},e((()=>{!function(N,Z){N._nowObject=performance||Date,N._lastTick=0,N._renderAccum=0,N._rt=0,N._frameCB=w.bind(null,N),requestAnimationFrame(N._frameCB),Z>0&&(N._intervalCB=z.bind(null,N),N._interval=setInterval(N._intervalCB,Math.max(Z,1e3/N.pi/2)))}(this,Z),function(N,Z){if(!Z)return;var d=!1,X=!1;document.addEventListener("pointerlockchange",(X=>{d=document.pointerLockElement===Z,N.xi(d)})),document.addEventListener("fullscreenchange",(d=>{X=document.fullscreenElement===Z,N.onFullscreenChanged(X)})),Object.defineProperty(N,"Bi",{get:()=>d,set:N=>{N&&!d?S(Z):d&&!N&&function(N){N.exitPointerLock&&N.exitPointerLock()}(document)}}),Object.defineProperty(N,"fullscreen",{get:()=>X,set:N=>{N&&!X?Z.requestFullscreen():X&&!N&&document.exitFullscreen()}}),Z.addEventListener("click",(I=>{N.ri&&!d&&S(Z),N.si&&!X&&Z.requestFullscreen()}));var I=()=>N.cb();if(window.ResizeObserver){new ResizeObserver(I).observe(Z)}else window.addEventListener("resize",I)}(this,N),this.zi()}))}}var I=3,m=20;function z(N){for(var Z=1e3/N.pi,d=N._nowObject.now()+m,X=0;N._nowObject.now()>=N._lastTick+Z&&N._nowObject.now()<d&&++X<=I;)N.ui(Z),N._lastTick+=Z;var z=5*(Z+5),w=N._nowObject.now();if(w-N._lastTick>z)for(;w>=N._lastTick+Z;)N._lastTick+=Z}function w(N){requestAnimationFrame(N._frameCB),z(N);var Z=N._nowObject.now(),d=Z-N._rt;if(N._rt=Z,N.qi>0){N._renderAccum+=d;var X=1e3/N.qi;if(N._renderAccum<X)return;N._renderAccum=Math.min(N._renderAccum-X,X)}var I=1e3/N.pi,m=(Z-N._lastTick)/I;N.wi(d,m,I)}function S(N){N.requestPointerLock&&N.requestPointerLock()}var e=N=>{if("loading"===document.readyState){var Z=()=>{document.removeEventListener("readystatechange",Z),N()};document.addEventListener("readystatechange",Z)}else setTimeout(N,1)}},11159:(N,Z,d)=>{var X=d(11165),I=d(11174),m="undefined"!==typeof Float64Array;function z(N,Z){return N[0]-Z[0]}function w(){var N,Z=this.stride,d=new Array(Z.length);for(N=0;N<d.length;++N)d[N]=[Math.abs(Z[N]),N];d.sort(z);var X=new Array(d.length);for(N=0;N<X.length;++N)X[N]=d[N][1];return X}function S(N,Z){var d=["View",Z,"d",N].join("");Z<0&&(d="View_Nil"+N);var I="generic"===N;if(-1===Z){var m="function "+d+"(a){this.data=a;};var proto="+d+".prototype;proto.dtype='"+N+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+d+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+d+"(a){return new "+d+"(a);}";return new Function(m)()}if(0===Z){m="function "+d+"(a,d) {this.data = a;this.offset = d};var proto="+d+".prototype;proto.dtype='"+N+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+d+"_copy() {return new "+d+"(this.data,this.offset)};proto.pick=function "+d+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+d+"_get(){return "+(I?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+d+"_set(v){return "+(I?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+d+"(a,b,c,d){return new "+d+"(a,d)}";return new Function("TrivialArray",m)(e[N][0])}m=["'use strict'"];var z=X(Z),S=z.map((function(N){return"i"+N})),j="this.offset+"+z.map((function(N){return"this.stride["+N+"]*i"+N})).join("+"),B=z.map((function(N){return"b"+N})).join(","),D=z.map((function(N){return"c"+N})).join(",");m.push("function "+d+"(a,"+B+","+D+",d){this.data=a","this.shape=["+B+"]","this.stride=["+D+"]","this.offset=d|0}","var proto="+d+".prototype","proto.dtype='"+N+"'","proto.dimension="+Z),m.push("Object.defineProperty(proto,'size',{get:function "+d+"_size(){return "+z.map((function(N){return"this.shape["+N+"]"})).join("*"),"}})"),1===Z?m.push("proto.order=[0]"):(m.push("Object.defineProperty(proto,'order',{get:"),Z<4?(m.push("function "+d+"_order(){"),2===Z?m.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===Z&&m.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):m.push("ORDER})")),m.push("proto.set=function "+d+"_set("+S.join(",")+",v){"),I?m.push("return this.data.set("+j+",v)}"):m.push("return this.data["+j+"]=v}"),m.push("proto.get=function "+d+"_get("+S.join(",")+"){"),I?m.push("return this.data.get("+j+")}"):m.push("return this.data["+j+"]}"),m.push("proto.index=function "+d+"_index(",S.join(),"){return "+j+"}"),m.push("proto.hi=function "+d+"_hi("+S.join(",")+"){return new "+d+"(this.data,"+z.map((function(N){return["(typeof i",N,"!=='number'||i",N,"<0)?this.shape[",N,"]:i",N,"|0"].join("")})).join(",")+","+z.map((function(N){return"this.stride["+N+"]"})).join(",")+",this.offset)}");var v=z.map((function(N){return"a"+N+"=this.shape["+N+"]"})),T=z.map((function(N){return"c"+N+"=this.stride["+N+"]"}));m.push("proto.lo=function "+d+"_lo("+S.join(",")+"){var b=this.offset,d=0,"+v.join(",")+","+T.join(","));for(var k=0;k<Z;++k)m.push("if(typeof i"+k+"==='number'&&i"+k+">=0){d=i"+k+"|0;b+=c"+k+"*d;a"+k+"-=d}");m.push("return new "+d+"(this.data,"+z.map((function(N){return"a"+N})).join(",")+","+z.map((function(N){return"c"+N})).join(",")+",b)}"),m.push("proto.step=function "+d+"_step("+S.join(",")+"){var "+z.map((function(N){return"a"+N+"=this.shape["+N+"]"})).join(",")+","+z.map((function(N){return"b"+N+"=this.stride["+N+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(k=0;k<Z;++k)m.push("if(typeof i"+k+"==='number'){d=i"+k+"|0;if(d<0){c+=b"+k+"*(a"+k+"-1);a"+k+"=ceil(-a"+k+"/d)}else{a"+k+"=ceil(a"+k+"/d)}b"+k+"*=d}");m.push("return new "+d+"(this.data,"+z.map((function(N){return"a"+N})).join(",")+","+z.map((function(N){return"b"+N})).join(",")+",c)}");var h=new Array(Z),U=new Array(Z);for(k=0;k<Z;++k)h[k]="a[i"+k+"]",U[k]="b[i"+k+"]";m.push("proto.transpose=function "+d+"_transpose("+S+"){"+S.map((function(N,Z){return N+"=("+N+"===undefined?"+Z+":"+N+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+d+"(this.data,"+h.join(",")+","+U.join(",")+",this.offset)}"),m.push("proto.pick=function "+d+"_pick("+S+"){var a=[],b=[],c=this.offset");for(k=0;k<Z;++k)m.push("if(typeof i"+k+"==='number'&&i"+k+">=0){c=(c+this.stride["+k+"]*i"+k+")|0}else{a.push(this.shape["+k+"]);b.push(this.stride["+k+"])}");return m.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),m.push("return function construct_"+d+"(data,shape,stride,offset){return new "+d+"(data,"+z.map((function(N){return"shape["+N+"]"})).join(",")+","+z.map((function(N){return"stride["+N+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",m.join("\n"))(e[N],w)}var e={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};N.exports=function(N,Z,d,X){if(void 0===N)return(0,e.array[0])([]);"number"===typeof N&&(N=[N]),void 0===Z&&(Z=[N.length]);var z=Z.length;if(void 0===d){d=new Array(z);for(var w=z-1,j=1;w>=0;--w)d[w]=j,j*=Z[w]}if(void 0===X){X=0;for(w=0;w<z;++w)d[w]<0&&(X-=(Z[w]-1)*d[w])}for(var B=function(N){if(I(N))return"buffer";if(m)switch(Object.prototype.toString.call(N)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(N)?"array":"generic"}(N),D=e[B];D.length<=z+1;)D.push(S(B,D.length-1));return(0,D[z+1])(N,Z,d,X)}},11130:N=>{var Z;self,Z=()=>(()=>{"use strict";var N={d:(Z,d)=>{for(var X in d)N.o(d,X)&&!N.o(Z,X)&&Object.defineProperty(Z,X,{enumerable:!0,get:d[X]})},o:(N,Z)=>Object.prototype.hasOwnProperty.call(N,Z)},Z={};N.d(Z,{default:()=>J});var d,X=function(N,Z){var d=Z.x-N.x,X=Z.y-N.y;return Math.sqrt(d*d+X*X)},I=function(N){return N*(Math.PI/180)},m=new Map,z=function(N){m.has(N)&&clearTimeout(m.get(N)),m.set(N,setTimeout(N,100))},w=function(N,Z,d){for(var X,I=Z.split(/[ ,]+/g),m=0;m<I.length;m+=1)X=I[m],N.addEventListener?N.addEventListener(X,d,!1):N.attachEvent&&N.attachEvent(X,d)},S=function(N,Z,d){for(var X,I=Z.split(/[ ,]+/g),m=0;m<I.length;m+=1)X=I[m],N.removeEventListener?N.removeEventListener(X,d):N.detachEvent&&N.detachEvent(X,d)},e=function(N){return N.preventDefault(),N.type.match(/^touch/)?N.changedTouches:N},j=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},B=function(N,Z){Z.top||Z.right||Z.bottom||Z.left?(N.style.top=Z.top,N.style.right=Z.right,N.style.bottom=Z.bottom,N.style.left=Z.left):(N.style.left=Z.x+"px",N.style.top=Z.y+"px")},D=function(N,Z,d){var X=v(N);for(var I in X)if(X.hasOwnProperty(I))if("string"==typeof Z)X[I]=Z+" "+d;else{for(var m="",z=0,w=Z.length;z<w;z+=1)m+=Z[z]+" "+d+", ";X[I]=m.slice(0,-2)}return X},v=function(N){var Z={};return Z[N]="",["webkit","Moz","o"].forEach((function(d){Z[d+N.charAt(0).toUpperCase()+N.slice(1)]=""})),Z},T=function(N,Z){for(var d in Z)Z.hasOwnProperty(d)&&(N[d]=Z[d]);return N},k=function(N,Z){if(N.length)for(var d=0,X=N.length;d<X;d+=1)Z(N[d]);else Z(N)},h="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,U=window.matchMedia("(any-hover: none)").matches,C=!!("ontouchstart"in window),M=!!window.PointerEvent,Q=!!window.MSPointerEvent,A={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},n={start:"mousedown",move:"mousemove",end:"mouseup"},g={};function E(){}h&&!U?d=A:M?d={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:Q?d={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:C?(d=A,g=n):d=n,E.prototype.on=function(N,Z){var d,X=this,I=N.split(/[ ,]+/g);X._handlers_=X._handlers_||{};for(var m=0;m<I.length;m+=1)d=I[m],X._handlers_[d]=X._handlers_[d]||[],X._handlers_[d].push(Z);return X},E.prototype.off=function(N,Z){var d=this;return d._handlers_=d._handlers_||{},void 0===N?d._handlers_={}:void 0===Z?d._handlers_[N]=null:d._handlers_[N]&&d._handlers_[N].indexOf(Z)>=0&&d._handlers_[N].splice(d._handlers_[N].indexOf(Z),1),d},E.prototype.trigger=function(N,Z){var d,X=this,I=N.split(/[ ,]+/g);X._handlers_=X._handlers_||{};for(var m=0;m<I.length;m+=1)d=I[m],X._handlers_[d]&&X._handlers_[d].length&&X._handlers_[d].forEach((function(N){N.call(X,{type:d,target:X},Z)}))},E.prototype.config=function(N){var Z=this;Z.options=Z.defaults||{},N&&(Z.options=function(N,Z){var d={};for(var X in N)N.hasOwnProperty(X)&&Z.hasOwnProperty(X)?d[X]=Z[X]:N.hasOwnProperty(X)&&(d[X]=N[X]);return d}(Z.options,N))},E.prototype.bindEvt=function(N,Z){var X=this;return X._domHandlers_=X._domHandlers_||{},X._domHandlers_[Z]=function(){"function"==typeof X["on"+Z]?X["on"+Z].apply(X,arguments):console.warn('[WARNING] : Missing "on'+Z+'" handler.')},w(N,d[Z],X._domHandlers_[Z]),g[Z]&&w(N,g[Z],X._domHandlers_[Z]),X},E.prototype.unbindEvt=function(N,Z){var X=this;return X._domHandlers_=X._domHandlers_||{},S(N,d[Z],X._domHandlers_[Z]),g[Z]&&S(N,g[Z],X._domHandlers_[Z]),delete X._domHandlers_[Z],this};const V=E;function O(N,Z){return this.identifier=Z.identifier,this.position=Z.position,this.frontPosition=Z.frontPosition,this.collection=N,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(Z),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=O.id,O.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}O.prototype=new V,O.constructor=O,O.id=0,O.prototype.buildEl=function(N){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},O.prototype.stylize=function(){if(this.options.dataOnly)return this;var N=this.options.fadeTime+"ms",Z=function(){var N=v("borderRadius");for(var Z in N)N.hasOwnProperty(Z)&&(N[Z]="50%");return N}(),d=D("transition","opacity",N),X={};return X.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},X.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},X.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},T(X.el,d),"circle"===this.options.shape&&T(X.back,Z),T(X.front,Z),this.applyStyles(X),this},O.prototype.applyStyles=function(N){for(var Z in this.ui)if(this.ui.hasOwnProperty(Z))for(var d in N[Z])this.ui[Z].style[d]=N[Z][d];return this},O.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},O.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},O.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},O.prototype.show=function(N){var Z=this;return Z.options.dataOnly||(clearTimeout(Z.removeTimeout),clearTimeout(Z.showTimeout),clearTimeout(Z.restTimeout),Z.addToDom(),Z.restCallback(),setTimeout((function(){Z.ui.el.style.opacity=1}),0),Z.showTimeout=setTimeout((function(){Z.trigger("shown",Z.instance),"function"==typeof N&&N.call(this)}),Z.options.fadeTime)),Z},O.prototype.hide=function(N){var Z=this;if(Z.options.dataOnly)return Z;if(Z.ui.el.style.opacity=Z.options.restOpacity,clearTimeout(Z.removeTimeout),clearTimeout(Z.showTimeout),clearTimeout(Z.restTimeout),Z.removeTimeout=setTimeout((function(){var d="dynamic"===Z.options.mode?"none":"block";Z.ui.el.style.display=d,"function"==typeof N&&N.call(Z),Z.trigger("hidden",Z.instance)}),Z.options.fadeTime),Z.options.restJoystick){var d=Z.options.restJoystick,X={};X.x=!0===d||!1!==d.x?0:Z.instance.frontPosition.x,X.y=!0===d||!1!==d.y?0:Z.instance.frontPosition.y,Z.setPosition(N,X)}return Z},O.prototype.setPosition=function(N,Z){var d=this;d.frontPosition={x:Z.x,y:Z.y};var X=d.options.fadeTime+"ms",I={};I.front=D("transition",["transform"],X);var m={front:{}};m.front={transform:"translate("+d.frontPosition.x+"px,"+d.frontPosition.y+"px)"},d.applyStyles(I),d.applyStyles(m),d.restTimeout=setTimeout((function(){"function"==typeof N&&N.call(d),d.restCallback()}),d.options.fadeTime)},O.prototype.restCallback=function(){var N=this,Z={};Z.front=D("transition","none",""),N.applyStyles(Z),N.trigger("rested",N.instance)},O.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},O.prototype.computeDirection=function(N){var Z,d,X,I=N.angle.radian,m=Math.PI/4,z=Math.PI/2;if(I>m&&I<3*m&&!N.lockX?Z="up":I>-m&&I<=m&&!N.lockY?Z="left":I>3*-m&&I<=-m&&!N.lockX?Z="down":N.lockY||(Z="right"),N.lockY||(d=I>-z&&I<z?"left":"right"),N.lockX||(X=I>0?"up":"down"),N.force>this.options.threshold){var w,S={};for(w in this.direction)this.direction.hasOwnProperty(w)&&(S[w]=this.direction[w]);var e={};for(w in this.direction={x:d,y:X,angle:Z},N.direction=this.direction,S)S[w]===this.direction[w]&&(e[w]=!0);if(e.x&&e.y&&e.angle)return N;e.x&&e.y||this.trigger("plain",N),e.x||this.trigger("plain:"+d,N),e.y||this.trigger("plain:"+X,N),e.angle||this.trigger("dir dir:"+Z,N)}else this.resetDirection();return N};const K=O;function r(N,Z){var d=this;d.nipples=[],d.idles=[],d.actives=[],d.ids=[],d.pressureIntervals={},d.manager=N,d.id=r.id,r.id+=1,d.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},d.config(Z),"static"!==d.options.mode&&"semi"!==d.options.mode||(d.options.multitouch=!1),d.options.multitouch||(d.options.maxNumberOfNipples=1);var X=getComputedStyle(d.options.zone.parentElement);return X&&"flex"===X.display&&(d.parentIsFlex=!0),d.updateBox(),d.prepareNipples(),d.Bj(),d.begin(),d.nipples}r.prototype=new V,r.constructor=r,r.id=0,r.prototype.prepareNipples=function(){var N=this,Z=N.nipples;Z.on=N.on.bind(N),Z.off=N.off.bind(N),Z.options=N.options,Z.destroy=N.destroy.bind(N),Z.ids=N.ids,Z.id=N.id,Z.processOnMove=N.processOnMove.bind(N),Z.processOnEnd=N.processOnEnd.bind(N),Z.get=function(N){if(void 0===N)return Z[0];for(var d=0,X=Z.length;d<X;d+=1)if(Z[d].identifier===N)return Z[d];return!1}},r.prototype.Bj=function(){var N=this;N.bindEvt(N.options.zone,"start"),N.options.zone.style.touchAction="none",N.options.zone.style.msTouchAction="none"},r.prototype.begin=function(){var N=this,Z=N.options;if("static"===Z.mode){var d=N.createNipple(Z.position,N.manager.getIdentifier());d.add(),N.idles.push(d)}},r.prototype.createNipple=function(N,Z){var d=this,X=d.manager.scroll,I={},m=d.options,z=d.parentIsFlex?X.x:X.x+d.box.left,w=d.parentIsFlex?X.y:X.y+d.box.top;if(N.x&&N.y)I={x:N.x-z,y:N.y-w};else if(N.top||N.right||N.bottom||N.left){var S=document.createElement("DIV");S.style.display="hidden",S.style.top=N.top,S.style.right=N.right,S.style.bottom=N.bottom,S.style.left=N.left,S.style.position="absolute",m.zone.appendChild(S);var e=S.getBoundingClientRect();m.zone.removeChild(S),I=N,N={x:e.left+X.x,y:e.top+X.y}}var j=new K(d,{color:m.color,size:m.size,threshold:m.threshold,fadeTime:m.fadeTime,dataOnly:m.dataOnly,restJoystick:m.restJoystick,restOpacity:m.restOpacity,mode:m.mode,identifier:Z,position:N,zone:m.zone,frontPosition:{x:0,y:0},shape:m.shape});return m.dataOnly||(B(j.ui.el,I),B(j.ui.front,j.frontPosition)),d.nipples.push(j),d.trigger("added "+j.identifier+":added",j),d.manager.trigger("added "+j.identifier+":added",j),d.bindNipple(j),j},r.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},r.prototype.bindNipple=function(N){var Z,d=this,X=function(N,X){Z=N.type+" "+X.id+":"+N.type,d.trigger(Z,X)};N.on("destroyed",d.onDestroyed.bind(d)),N.on("shown hidden rested dir plain",X),N.on("dir:up dir:right dir:down dir:left",X),N.on("plain:up plain:right plain:down plain:left",X)},r.prototype.pressureFn=function(N,Z,d){var X=this,I=0;clearInterval(X.pressureIntervals[d]),X.pressureIntervals[d]=setInterval(function(){var d=N.force||N.pressure||N.webkitForce||0;d!==I&&(Z.trigger("pressure",d),X.trigger("pressure "+Z.identifier+":pressure",d),I=d)}.bind(X),100)},r.prototype.onstart=function(N){var Z=this,d=Z.options,X=N;return N=e(N),Z.updateBox(),k(N,(function(I){Z.actives.length<d.maxNumberOfNipples?Z.processOnStart(I):X.type.match(/^touch/)&&(Object.keys(Z.manager.ids).forEach((function(d){if(Object.values(X.touches).findIndex((function(N){return N.identifier===d}))<0){var I=[N[0]];I.identifier=d,Z.processOnEnd(I)}})),Z.actives.length<d.maxNumberOfNipples&&Z.processOnStart(I))})),Z.manager.bindDocument(),!1},r.prototype.processOnStart=function(N){var Z,d=this,I=d.options,m=d.manager.getIdentifier(N),z=N.force||N.pressure||N.webkitForce||0,w={x:N.pageX,y:N.pageY},S=d.getOrCreate(m,w);S.identifier!==m&&d.manager.removeIdentifier(S.identifier),S.identifier=m;var e=function(Z){Z.trigger("start",Z),d.trigger("start "+Z.id+":start",Z),Z.show(),z>0&&d.pressureFn(N,Z,Z.identifier),d.processOnMove(N)};if((Z=d.idles.indexOf(S))>=0&&d.idles.splice(Z,1),d.actives.push(S),d.ids.push(S.identifier),"semi"!==I.mode)e(S);else{if(!(X(w,S.position)<=I.catchDistance))return S.destroy(),void d.processOnStart(N);e(S)}return S},r.prototype.getOrCreate=function(N,Z){var d,X=this,I=X.options;return/(semi|static)/.test(I.mode)?(d=X.idles[0])?(X.idles.splice(0,1),d):"semi"===I.mode?X.createNipple(Z,N):(console.warn("Coudln't find the needed nipple."),!1):d=X.createNipple(Z,N)},r.prototype.processOnMove=function(N){var Z=this,d=Z.options,m=Z.manager.getIdentifier(N),z=Z.nipples.get(m),w=Z.manager.scroll;if(function(N){return isNaN(N.buttons)?0!==N.pressure:0!==N.buttons}(N)){if(!z)return console.error("Found zombie joystick with ID "+m),void Z.manager.removeIdentifier(m);if(d.dynamicPage){var S=z.el.getBoundingClientRect();z.position={x:w.x+S.left,y:w.y+S.top}}z.identifier=m;var e=z.options.size/2,j={x:N.pageX,y:N.pageY};d.lockX&&(j.y=z.position.y),d.lockY&&(j.x=z.position.x);var B,D,v,T,k,h,U,C,M,Q,A=X(j,z.position),n=(B=j,v=(D=z.position).x-B.x,T=D.y-B.y,function(N){return N*(180/Math.PI)}(Math.atan2(T,v))),g=I(n),E=A/e,V={distance:A,position:j};if("circle"===z.options.shape?(k=Math.min(A,e),U=z.position,C=k,Q={x:0,y:0},M=I(M=n),Q.x=U.x-C*Math.cos(M),Q.y=U.y-C*Math.sin(M),h=Q):(h=function(N,Z,d){return{x:Math.min(Math.max(N.x,Z.x-d),Z.x+d),y:Math.min(Math.max(N.y,Z.y-d),Z.y+d)}}(j,z.position,e),k=X(h,z.position)),d.follow){if(A>e){var O=j.x-h.x,K=j.y-h.y;z.position.x+=O,z.position.y+=K,z.el.style.top=z.position.y-(Z.box.top+w.y)+"px",z.el.style.left=z.position.x-(Z.box.left+w.x)+"px",A=X(j,z.position)}}else j=h,A=k;var r=j.x-z.position.x,P=j.y-z.position.y;z.frontPosition={x:r,y:P},d.dataOnly||(z.ui.front.style.transform="translate("+r+"px,"+P+"px)");var W={identifier:z.identifier,position:j,force:E,pressure:N.force||N.pressure||N.webkitForce||0,distance:A,angle:{radian:g,degree:n},vector:{x:r/e,y:-P/e},raw:V,instance:z,lockX:d.lockX,lockY:d.lockY};(W=z.computeDirection(W)).angle={radian:I(180-n),degree:180-n},z.trigger("move",W),Z.trigger("move "+z.id+":move",W)}else this.processOnEnd(N)},r.prototype.processOnEnd=function(N){var Z=this,d=Z.options,X=Z.manager.getIdentifier(N),I=Z.nipples.get(X),m=Z.manager.removeIdentifier(I.identifier);I&&(d.dataOnly||I.hide((function(){"dynamic"===d.mode&&(I.trigger("removed",I),Z.trigger("removed "+I.id+":removed",I),Z.manager.trigger("removed "+I.id+":removed",I),I.destroy())})),clearInterval(Z.pressureIntervals[I.identifier]),I.resetDirection(),I.trigger("end",I),Z.trigger("end "+I.id+":end",I),Z.ids.indexOf(I.identifier)>=0&&Z.ids.splice(Z.ids.indexOf(I.identifier),1),Z.actives.indexOf(I)>=0&&Z.actives.splice(Z.actives.indexOf(I),1),/(semi|static)/.test(d.mode)?Z.idles.push(I):Z.nipples.indexOf(I)>=0&&Z.nipples.splice(Z.nipples.indexOf(I),1),Z.manager.unbindDocument(),/(semi|static)/.test(d.mode)&&(Z.manager.ids[m.id]=m.identifier))},r.prototype.onDestroyed=function(N,Z){var d=this;d.nipples.indexOf(Z)>=0&&d.nipples.splice(d.nipples.indexOf(Z),1),d.actives.indexOf(Z)>=0&&d.actives.splice(d.actives.indexOf(Z),1),d.idles.indexOf(Z)>=0&&d.idles.splice(d.idles.indexOf(Z),1),d.ids.indexOf(Z.identifier)>=0&&d.ids.splice(d.ids.indexOf(Z.identifier),1),d.manager.removeIdentifier(Z.identifier),d.manager.unbindDocument()},r.prototype.destroy=function(){var N=this;for(var Z in N.unbindEvt(N.options.zone,"start"),N.nipples.forEach((function(N){N.destroy()})),N.pressureIntervals)N.pressureIntervals.hasOwnProperty(Z)&&clearInterval(N.pressureIntervals[Z]);N.trigger("destroyed",N.nipples),N.manager.unbindDocument(),N.off()};const P=r;function W(N){var Z=this;Z.ids={},Z.index=0,Z.collections=[],Z.scroll=j(),Z.config(N),Z.prepareCollections();var d=function(){var N;Z.collections.forEach((function(d){d.forEach((function(d){N=d.el.getBoundingClientRect(),d.position={x:Z.scroll.x+N.left,y:Z.scroll.y+N.top}}))}))};w(window,"resize",(function(){z(d)}));var X=function(){Z.scroll=j()};return w(window,"scroll",(function(){z(X)})),Z.collections}W.prototype=new V,W.constructor=W,W.prototype.prepareCollections=function(){var N=this;N.collections.create=N.create.bind(N),N.collections.on=N.on.bind(N),N.collections.off=N.off.bind(N),N.collections.destroy=N.destroy.bind(N),N.collections.get=function(Z){var d;return N.collections.every((function(N){return!(d=N.get(Z))})),d}},W.prototype.create=function(N){return this.createCollection(N)},W.prototype.createCollection=function(N){var Z=this,d=new P(Z,N);return Z.bindCollection(d),Z.collections.push(d),d},W.prototype.bindCollection=function(N){var Z,d=this,X=function(N,X){Z=N.type+" "+X.id+":"+N.type,d.trigger(Z,X)};N.on("destroyed",d.onDestroyed.bind(d)),N.on("shown hidden rested dir plain",X),N.on("dir:up dir:right dir:down dir:left",X),N.on("plain:up plain:right plain:down plain:left",X)},W.prototype.bindDocument=function(){var N=this;N.binded||(N.bindEvt(document,"move").bindEvt(document,"end"),N.binded=!0)},W.prototype.unbindDocument=function(N){var Z=this;Object.keys(Z.ids).length&&!0!==N||(Z.unbindEvt(document,"move").unbindEvt(document,"end"),Z.binded=!1)},W.prototype.getIdentifier=function(N){var Z;return N?void 0===(Z=void 0===N.identifier?N.pointerId:N.identifier)&&(Z=this.latest||0):Z=this.index,void 0===this.ids[Z]&&(this.ids[Z]=this.index,this.index+=1),this.latest=Z,this.ids[Z]},W.prototype.removeIdentifier=function(N){var Z={};for(var d in this.ids)if(this.ids[d]===N){Z.id=d,Z.identifier=this.ids[d],delete this.ids[d];break}return Z},W.prototype.onmove=function(N){return this.onAny("move",N),!1},W.prototype.onend=function(N){return this.onAny("end",N),!1},W.prototype.oncancel=function(N){return this.onAny("end",N),!1},W.prototype.onAny=function(N,Z){var d,X=this,I="processOn"+N.charAt(0).toUpperCase()+N.slice(1);Z=e(Z);var m=function(N,Z,d){d.ids.indexOf(Z)>=0&&(d[I](N),N._found_=!0)};return k(Z,(function(N){d=X.getIdentifier(N),k(X.collections,m.bind(null,N,d)),N._found_||X.removeIdentifier(d)})),!1},W.prototype.destroy=function(){var N=this;N.unbindDocument(!0),N.ids={},N.index=0,N.collections.forEach((function(N){N.destroy()})),N.off()},W.prototype.onDestroyed=function(N,Z){var d=this;if(d.collections.indexOf(Z)<0)return!1;d.collections.splice(d.collections.indexOf(Z),1)};var b=new W;const J={create:function(N){return b.create(N)},factory:b};return Z.default})(),N.exports=Z()},11182:(N,Z,d)=>{"use strict";const{Deflate:X,deflate:I,deflateRaw:m,gzip:z}=d(11189),{Inflate:w,inflate:S,inflateRaw:e,ungzip:j}=d(11250),B=d(11223);N.exports.Deflate=X,N.exports.deflate=I,N.exports.deflateRaw=m,N.exports.gzip=z,N.exports.Inflate=w,N.exports.inflate=S,N.exports.inflateRaw=e,N.exports.ungzip=j,N.exports.constants=B},11189:(N,Z,d)=>{"use strict";const X=d(11194),I=d(11229),m=d(11237),z=d(11220),w=d(11244),S=Object.prototype.toString,{Z_NO_FLUSH:e,Z_SYNC_FLUSH:j,Z_FULL_FLUSH:B,Z_FINISH:D,Z_OK:v,Z_STREAM_END:T,Z_DEFAULT_COMPRESSION:k,Z_DEFAULT_STRATEGY:h,Z_DEFLATED:U}=d(11223);function C(N){this.options=I.assign({level:k,method:U,Ja:16384,windowBits:15,memLevel:8,strategy:h},N||{});let Z=this.options;Z.raw&&Z.windowBits>0?Z.windowBits=-Z.windowBits:Z.gzip&&Z.windowBits>0&&Z.windowBits<16&&(Z.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new w,this.strm.avail_out=0;let d=X.deflateInit2(this.strm,Z.level,Z.method,Z.windowBits,Z.memLevel,Z.strategy);if(d!==v)throw new Error(z[d]);if(Z.header&&X.deflateSetHeader(this.strm,Z.header),Z.dictionary){let N;if(N="string"===typeof Z.dictionary?m.string2buf(Z.dictionary):"[object ArrayBuffer]"===S.call(Z.dictionary)?new Uint8Array(Z.dictionary):Z.dictionary,d=X.deflateSetDictionary(this.strm,N),d!==v)throw new Error(z[d]);this._dict_set=!0}}function M(N,Z){const d=new C(Z);if(d.push(N,!0),d.err)throw d.msg||z[d.err];return d.result}C.prototype.push=function(N,Z){const d=this.strm,I=this.options.Ja;let z,w;if(this.ended)return!1;for(w=Z===~~Z?Z:!0===Z?D:e,"string"===typeof N?d.input=m.string2buf(N):"[object ArrayBuffer]"===S.call(N)?d.input=new Uint8Array(N):d.input=N,d.next_in=0,d.avail_in=d.input.length;;)if(0===d.avail_out&&(d.output=new Uint8Array(I),d.next_out=0,d.avail_out=I),(w===j||w===B)&&d.avail_out<=6)this.onData(d.output.subarray(0,d.next_out)),d.avail_out=0;else{if(z=X.deflate(d,w),z===T)return d.next_out>0&&this.onData(d.output.subarray(0,d.next_out)),z=X.deflateEnd(this.strm),this.onEnd(z),this.ended=!0,z===v;if(0!==d.avail_out){if(w>0&&d.next_out>0)this.onData(d.output.subarray(0,d.next_out)),d.avail_out=0;else if(0===d.avail_in)break}else this.onData(d.output)}return!0},C.prototype.onData=function(N){this.chunks.push(N)},C.prototype.onEnd=function(N){N===v&&(this.result=I.flattenChunks(this.chunks)),this.chunks=[],this.err=N,this.msg=this.strm.msg},N.exports.Deflate=C,N.exports.deflate=M,N.exports.deflateRaw=function(N,Z){return(Z=Z||{}).raw=!0,M(N,Z)},N.exports.gzip=function(N,Z){return(Z=Z||{}).gzip=!0,M(N,Z)},N.exports.constants=d(11223)},11250:(N,Z,d)=>{"use strict";const X=d(11256),I=d(11229),m=d(11237),z=d(11220),w=d(11244),S=d(11279),e=Object.prototype.toString,{Z_NO_FLUSH:j,Z_FINISH:B,Z_OK:D,Z_STREAM_END:v,Z_NEED_DICT:T,Z_STREAM_ERROR:k,Z_DATA_ERROR:h,Z_MEM_ERROR:U}=d(11223);function C(N){this.options=I.assign({Ja:65536,windowBits:15,to:""},N||{});const Z=this.options;Z.raw&&Z.windowBits>=0&&Z.windowBits<16&&(Z.windowBits=-Z.windowBits,0===Z.windowBits&&(Z.windowBits=-15)),!(Z.windowBits>=0&&Z.windowBits<16)||N&&N.windowBits||(Z.windowBits+=32),Z.windowBits>15&&Z.windowBits<48&&0===(15&Z.windowBits)&&(Z.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new w,this.strm.avail_out=0;let d=X.inflateInit2(this.strm,Z.windowBits);if(d!==D)throw new Error(z[d]);if(this.header=new S,X.inflateGetHeader(this.strm,this.header),Z.dictionary&&("string"===typeof Z.dictionary?Z.dictionary=m.string2buf(Z.dictionary):"[object ArrayBuffer]"===e.call(Z.dictionary)&&(Z.dictionary=new Uint8Array(Z.dictionary)),Z.raw&&(d=X.inflateSetDictionary(this.strm,Z.dictionary),d!==D)))throw new Error(z[d])}function M(N,Z){const d=new C(Z);if(d.push(N),d.err)throw d.msg||z[d.err];return d.result}C.prototype.push=function(N,Z){const d=this.strm,I=this.options.Ja,z=this.options.dictionary;let w,S,C;if(this.ended)return!1;for(S=Z===~~Z?Z:!0===Z?B:j,"[object ArrayBuffer]"===e.call(N)?d.input=new Uint8Array(N):d.input=N,d.next_in=0,d.avail_in=d.input.length;;){for(0===d.avail_out&&(d.output=new Uint8Array(I),d.next_out=0,d.avail_out=I),w=X.inflate(d,S),w===T&&z&&(w=X.inflateSetDictionary(d,z),w===D?w=X.inflate(d,S):w===h&&(w=T));d.avail_in>0&&w===v&&d.state.wrap>0&&0!==N[d.next_in];)X.inflateReset(d),w=X.inflate(d,S);switch(w){case k:case h:case T:case U:return this.onEnd(w),this.ended=!0,!1}if(C=d.avail_out,d.next_out&&(0===d.avail_out||w===v))if("string"===this.options.to){let N=m.utf8border(d.output,d.next_out),Z=d.next_out-N,X=m.buf2string(d.output,N);d.next_out=Z,d.avail_out=I-Z,Z&&d.output.set(d.output.subarray(N,N+Z),0),this.onData(X)}else this.onData(d.output.length===d.next_out?d.output:d.output.subarray(0,d.next_out));if(w!==D||0!==C){if(w===v)return w=X.inflateEnd(this.strm),this.onEnd(w),this.ended=!0,!0;if(0===d.avail_in)break}}return!0},C.prototype.onData=function(N){this.chunks.push(N)},C.prototype.onEnd=function(N){N===D&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=I.flattenChunks(this.chunks)),this.chunks=[],this.err=N,this.msg=this.strm.msg},N.exports.Inflate=C,N.exports.inflate=M,N.exports.inflateRaw=function(N,Z){return(Z=Z||{}).raw=!0,M(N,Z)},N.exports.ungzip=M,N.exports.constants=d(11223)},11229:N=>{"use strict";const Z=(N,Z)=>Object.prototype.hasOwnProperty.call(N,Z);N.exports.assign=function(N){const d=Array.prototype.slice.call(arguments,1);for(;d.length;){const X=d.shift();if(X){if("object"!==typeof X)throw new TypeError(X+"must be non-object");for(const d in X)Z(X,d)&&(N[d]=X[d])}}return N},N.exports.flattenChunks=N=>{let Z=0;for(let X=0,I=N.length;X<I;X++)Z+=N[X].length;const d=new Uint8Array(Z);for(let X=0,I=0,m=N.length;X<m;X++){let Z=N[X];d.set(Z,I),I+=Z.length}return d}},11237:N=>{"use strict";let Z=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(X){Z=!1}const d=new Uint8Array(256);for(let I=0;I<256;I++)d[I]=I>=252?6:I>=248?5:I>=240?4:I>=224?3:I>=192?2:1;d[254]=d[254]=1,N.exports.string2buf=N=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(N);let Z,d,X,I,m,z=N.length,w=0;for(I=0;I<z;I++)d=N.charCodeAt(I),55296===(64512&d)&&I+1<z&&(X=N.charCodeAt(I+1),56320===(64512&X)&&(d=65536+(d-55296<<10)+(X-56320),I++)),w+=d<128?1:d<2048?2:d<65536?3:4;for(Z=new Uint8Array(w),m=0,I=0;m<w;I++)d=N.charCodeAt(I),55296===(64512&d)&&I+1<z&&(X=N.charCodeAt(I+1),56320===(64512&X)&&(d=65536+(d-55296<<10)+(X-56320),I++)),d<128?Z[m++]=d:d<2048?(Z[m++]=192|d>>>6,Z[m++]=128|63&d):d<65536?(Z[m++]=224|d>>>12,Z[m++]=128|d>>>6&63,Z[m++]=128|63&d):(Z[m++]=240|d>>>18,Z[m++]=128|d>>>12&63,Z[m++]=128|d>>>6&63,Z[m++]=128|63&d);return Z};N.exports.buf2string=(N,X)=>{const I=X||N.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(N.subarray(0,X));let m,z;const w=new Array(2*I);for(z=0,m=0;m<I;){let Z=N[m++];if(Z<128){w[z++]=Z;continue}let X=d[Z];if(X>4)w[z++]=65533,m+=X-1;else{for(Z&=2===X?31:3===X?15:7;X>1&&m<I;)Z=Z<<6|63&N[m++],X--;X>1?w[z++]=65533:Z<65536?w[z++]=Z:(Z-=65536,w[z++]=55296|Z>>10&1023,w[z++]=56320|1023&Z)}}return((N,d)=>{if(d<65534&&N.subarray&&Z)return String.fromCharCode.apply(null,N.length===d?N:N.subarray(0,d));let X="";for(let Z=0;Z<d;Z++)X+=String.fromCharCode(N[Z]);return X})(w,z)},N.exports.utf8border=(N,Z)=>{(Z=Z||N.length)>N.length&&(Z=N.length);let X=Z-1;for(;X>=0&&128===(192&N[X]);)X--;return X<0||0===X?Z:X+d[N[X]]>Z?X:Z}},11208:N=>{"use strict";N.exports=(N,Z,d,X)=>{let I=65535&N,m=N>>>16&65535,z=0;for(;0!==d;){z=d>2e3?2e3:d,d-=z;do{I=I+Z[X++]|0,m=m+I|0}while(--z);I%=65521,m%=65521}return I|m<<16}},11223:N=>{"use strict";N.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},11215:N=>{"use strict";const Z=new Uint32Array((()=>{let N,Z=[];for(var d=0;d<256;d++){N=d;for(var X=0;X<8;X++)N=1&N?3988292384^N>>>1:N>>>1;Z[d]=N}return Z})());N.exports=(N,d,X,I)=>{const m=Z,z=I+X;N^=-1;for(let Z=I;Z<z;Z++)N=N>>>8^m[255&(N^d[Z])];return~N}},11194:(N,Z,d)=>{"use strict";const{_tr_init:X,_tr_stored_block:I,_tr_flush_block:m,_tr_tally:z,_tr_align:w}=d(11200),S=d(11208),e=d(11215),j=d(11220),{Z_NO_FLUSH:B,Z_PARTIAL_FLUSH:D,Z_FULL_FLUSH:v,Z_FINISH:T,Z_BLOCK:k,Z_OK:h,Z_STREAM_END:U,Z_STREAM_ERROR:C,Z_DATA_ERROR:M,Z_BUF_ERROR:Q,Z_DEFAULT_COMPRESSION:A,Z_FILTERED:n,Z_HUFFMAN_ONLY:g,Z_RLE:E,Z_FIXED:V,Z_DEFAULT_STRATEGY:O,Z_UNKNOWN:K,Z_DEFLATED:r}=d(11223),P=258,W=262,b=103,J=113,F=666,G=(N,Z)=>(N.msg=j[Z],Z),x=N=>(N<<1)-(N>4?9:0),t=N=>{let Z=N.length;for(;--Z>=0;)N[Z]=0};let q=(N,Z,d)=>(Z<<N.hash_shift^d)&N.hash_mask;const Y=N=>{const Z=N.state;let d=Z.pending;d>N.avail_out&&(d=N.avail_out),0!==d&&(N.output.set(Z.pending_buf.subarray(Z.pending_out,Z.pending_out+d),N.next_out),N.next_out+=d,Z.pending_out+=d,N.total_out+=d,N.avail_out-=d,Z.pending-=d,0===Z.pending&&(Z.pending_out=0))},s=(N,Z)=>{m(N,N.block_start>=0?N.block_start:-1,N.strstart-N.block_start,Z),N.block_start=N.strstart,Y(N.strm)},L=(N,Z)=>{N.pending_buf[N.pending++]=Z},H=(N,Z)=>{N.pending_buf[N.pending++]=Z>>>8&255,N.pending_buf[N.pending++]=255&Z},i=(N,Z,d,X)=>{let I=N.avail_in;return I>X&&(I=X),0===I?0:(N.avail_in-=I,Z.set(N.input.subarray(N.next_in,N.next_in+I),d),1===N.state.wrap?N.adler=S(N.adler,Z,I,d):2===N.state.wrap&&(N.adler=e(N.adler,Z,I,d)),N.next_in+=I,N.total_in+=I,I)},p=(N,Z)=>{let d,X,I=N.max_chain_length,m=N.strstart,z=N.prev_length,w=N.nice_match;const S=N.strstart>N.w_size-W?N.strstart-(N.w_size-W):0,e=N.window,j=N.w_mask,B=N.prev,D=N.strstart+P;let v=e[m+z-1],T=e[m+z];N.prev_length>=N.good_match&&(I>>=2),w>N.lookahead&&(w=N.lookahead);do{if(d=Z,e[d+z]===T&&e[d+z-1]===v&&e[d]===e[m]&&e[++d]===e[m+1]){m+=2,d++;do{}while(e[++m]===e[++d]&&e[++m]===e[++d]&&e[++m]===e[++d]&&e[++m]===e[++d]&&e[++m]===e[++d]&&e[++m]===e[++d]&&e[++m]===e[++d]&&e[++m]===e[++d]&&m<D);if(X=P-(D-m),m=D-P,X>z){if(N.match_start=Z,z=X,X>=w)break;v=e[m+z-1],T=e[m+z]}}}while((Z=B[Z&j])>S&&0!==--I);return z<=N.lookahead?z:N.lookahead},y=N=>{const Z=N.w_size;let d,X,I,m,z;do{if(m=N.window_size-N.lookahead-N.strstart,N.strstart>=Z+(Z-W)){N.window.set(N.window.subarray(Z,Z+Z),0),N.match_start-=Z,N.strstart-=Z,N.block_start-=Z,X=N.hash_size,d=X;do{I=N.head[--d],N.head[d]=I>=Z?I-Z:0}while(--X);X=Z,d=X;do{I=N.prev[--d],N.prev[d]=I>=Z?I-Z:0}while(--X);m+=Z}if(0===N.strm.avail_in)break;if(X=i(N.strm,N.window,N.strstart+N.lookahead,m),N.lookahead+=X,N.lookahead+N.insert>=3)for(z=N.strstart-N.insert,N.ins_h=N.window[z],N.ins_h=q(N,N.ins_h,N.window[z+1]);N.insert&&(N.ins_h=q(N,N.ins_h,N.window[z+3-1]),N.prev[z&N.w_mask]=N.head[N.ins_h],N.head[N.ins_h]=z,z++,N.insert--,!(N.lookahead+N.insert<3)););}while(N.lookahead<W&&0!==N.strm.avail_in)},l=(N,Z)=>{let d,X;for(;;){if(N.lookahead<W){if(y(N),N.lookahead<W&&Z===B)return 1;if(0===N.lookahead)break}if(d=0,N.lookahead>=3&&(N.ins_h=q(N,N.ins_h,N.window[N.strstart+3-1]),d=N.prev[N.strstart&N.w_mask]=N.head[N.ins_h],N.head[N.ins_h]=N.strstart),0!==d&&N.strstart-d<=N.w_size-W&&(N.match_length=p(N,d)),N.match_length>=3)if(X=z(N,N.strstart-N.match_start,N.match_length-3),N.lookahead-=N.match_length,N.match_length<=N.max_lazy_match&&N.lookahead>=3){N.match_length--;do{N.strstart++,N.ins_h=q(N,N.ins_h,N.window[N.strstart+3-1]),d=N.prev[N.strstart&N.w_mask]=N.head[N.ins_h],N.head[N.ins_h]=N.strstart}while(0!==--N.match_length);N.strstart++}else N.strstart+=N.match_length,N.match_length=0,N.ins_h=N.window[N.strstart],N.ins_h=q(N,N.ins_h,N.window[N.strstart+1]);else X=z(N,0,N.window[N.strstart]),N.lookahead--,N.strstart++;if(X&&(s(N,!1),0===N.strm.avail_out))return 1}return N.insert=N.strstart<2?N.strstart:2,Z===T?(s(N,!0),0===N.strm.avail_out?3:4):N.last_lit&&(s(N,!1),0===N.strm.avail_out)?1:2},u=(N,Z)=>{let d,X,I;for(;;){if(N.lookahead<W){if(y(N),N.lookahead<W&&Z===B)return 1;if(0===N.lookahead)break}if(d=0,N.lookahead>=3&&(N.ins_h=q(N,N.ins_h,N.window[N.strstart+3-1]),d=N.prev[N.strstart&N.w_mask]=N.head[N.ins_h],N.head[N.ins_h]=N.strstart),N.prev_length=N.match_length,N.prev_match=N.match_start,N.match_length=2,0!==d&&N.prev_length<N.max_lazy_match&&N.strstart-d<=N.w_size-W&&(N.match_length=p(N,d),N.match_length<=5&&(N.strategy===n||3===N.match_length&&N.strstart-N.match_start>4096)&&(N.match_length=2)),N.prev_length>=3&&N.match_length<=N.prev_length){I=N.strstart+N.lookahead-3,X=z(N,N.strstart-1-N.prev_match,N.prev_length-3),N.lookahead-=N.prev_length-1,N.prev_length-=2;do{++N.strstart<=I&&(N.ins_h=q(N,N.ins_h,N.window[N.strstart+3-1]),d=N.prev[N.strstart&N.w_mask]=N.head[N.ins_h],N.head[N.ins_h]=N.strstart)}while(0!==--N.prev_length);if(N.match_available=0,N.match_length=2,N.strstart++,X&&(s(N,!1),0===N.strm.avail_out))return 1}else if(N.match_available){if(X=z(N,0,N.window[N.strstart-1]),X&&s(N,!1),N.strstart++,N.lookahead--,0===N.strm.avail_out)return 1}else N.match_available=1,N.strstart++,N.lookahead--}return N.match_available&&(X=z(N,0,N.window[N.strstart-1]),N.match_available=0),N.insert=N.strstart<2?N.strstart:2,Z===T?(s(N,!0),0===N.strm.avail_out?3:4):N.last_lit&&(s(N,!1),0===N.strm.avail_out)?1:2};function a(N,Z,d,X,I){this.good_length=N,this.max_lazy=Z,this.nice_length=d,this.max_chain=X,this.func=I}const c=[new a(0,0,0,0,((N,Z)=>{let d=65535;for(d>N.pending_buf_size-5&&(d=N.pending_buf_size-5);;){if(N.lookahead<=1){if(y(N),0===N.lookahead&&Z===B)return 1;if(0===N.lookahead)break}N.strstart+=N.lookahead,N.lookahead=0;const X=N.block_start+d;if((0===N.strstart||N.strstart>=X)&&(N.lookahead=N.strstart-X,N.strstart=X,s(N,!1),0===N.strm.avail_out))return 1;if(N.strstart-N.block_start>=N.w_size-W&&(s(N,!1),0===N.strm.avail_out))return 1}return N.insert=0,Z===T?(s(N,!0),0===N.strm.avail_out?3:4):(N.strstart>N.block_start&&(s(N,!1),N.strm.avail_out),1)})),new a(4,4,8,4,l),new a(4,5,16,8,l),new a(4,6,32,32,l),new a(4,4,16,16,u),new a(8,16,32,32,u),new a(8,16,128,128,u),new a(8,32,128,256,u),new a(32,128,258,1024,u),new a(32,258,258,4096,u)];function R(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=r,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),t(this.dyn_ltree),t(this.dyn_dtree),t(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),t(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),t(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const f=N=>{if(!N||!N.state)return G(N,C);N.total_in=N.total_out=0,N.data_type=K;const Z=N.state;return Z.pending=0,Z.pending_out=0,Z.wrap<0&&(Z.wrap=-Z.wrap),Z.status=Z.wrap?42:J,N.adler=2===Z.wrap?0:1,Z.last_flush=B,X(Z),h},o=N=>{const Z=f(N);var d;return Z===h&&((d=N.state).window_size=2*d.w_size,t(d.head),d.max_lazy_match=c[d.level].max_lazy,d.good_match=c[d.level].good_length,d.nice_match=c[d.level].nice_length,d.max_chain_length=c[d.level].max_chain,d.strstart=0,d.block_start=0,d.lookahead=0,d.insert=0,d.match_length=d.prev_length=2,d.match_available=0,d.ins_h=0),Z},NN=(N,Z,d,X,I,m)=>{if(!N)return C;let z=1;if(Z===A&&(Z=6),X<0?(z=0,X=-X):X>15&&(z=2,X-=16),I<1||I>9||d!==r||X<8||X>15||Z<0||Z>9||m<0||m>V)return G(N,C);8===X&&(X=9);const w=new R;return N.state=w,w.strm=N,w.wrap=z,w.gzhead=null,w.w_bits=X,w.w_size=1<<w.w_bits,w.w_mask=w.w_size-1,w.hash_bits=I+7,w.hash_size=1<<w.hash_bits,w.hash_mask=w.hash_size-1,w.hash_shift=~~((w.hash_bits+3-1)/3),w.window=new Uint8Array(2*w.w_size),w.head=new Uint16Array(w.hash_size),w.prev=new Uint16Array(w.w_size),w.lit_bufsize=1<<I+6,w.pending_buf_size=4*w.lit_bufsize,w.pending_buf=new Uint8Array(w.pending_buf_size),w.d_buf=1*w.lit_bufsize,w.l_buf=3*w.lit_bufsize,w.level=Z,w.strategy=m,w.method=d,o(N)};N.exports.deflateInit=(N,Z)=>NN(N,Z,r,15,8,O),N.exports.deflateInit2=NN,N.exports.deflateReset=o,N.exports.deflateResetKeep=f,N.exports.deflateSetHeader=(N,Z)=>N&&N.state?2!==N.state.wrap?C:(N.state.gzhead=Z,h):C,N.exports.deflate=(N,Z)=>{let d,X;if(!N||!N.state||Z>k||Z<0)return N?G(N,C):C;const m=N.state;if(!N.output||!N.input&&0!==N.avail_in||m.status===F&&Z!==T)return G(N,0===N.avail_out?Q:C);m.strm=N;const S=m.last_flush;if(m.last_flush=Z,42===m.status)if(2===m.wrap)N.adler=0,L(m,31),L(m,139),L(m,8),m.gzhead?(L(m,(m.gzhead.text?1:0)+(m.gzhead.hcrc?2:0)+(m.gzhead.extra?4:0)+(m.gzhead.name?8:0)+(m.gzhead.comment?16:0)),L(m,255&m.gzhead.time),L(m,m.gzhead.time>>8&255),L(m,m.gzhead.time>>16&255),L(m,m.gzhead.time>>24&255),L(m,9===m.level?2:m.strategy>=g||m.level<2?4:0),L(m,255&m.gzhead.os),m.gzhead.extra&&m.gzhead.extra.length&&(L(m,255&m.gzhead.extra.length),L(m,m.gzhead.extra.length>>8&255)),m.gzhead.hcrc&&(N.adler=e(N.adler,m.pending_buf,m.pending,0)),m.gzindex=0,m.status=69):(L(m,0),L(m,0),L(m,0),L(m,0),L(m,0),L(m,9===m.level?2:m.strategy>=g||m.level<2?4:0),L(m,3),m.status=J);else{let Z=r+(m.w_bits-8<<4)<<8,d=-1;d=m.strategy>=g||m.level<2?0:m.level<6?1:6===m.level?2:3,Z|=d<<6,0!==m.strstart&&(Z|=32),Z+=31-Z%31,m.status=J,H(m,Z),0!==m.strstart&&(H(m,N.adler>>>16),H(m,65535&N.adler)),N.adler=1}if(69===m.status)if(m.gzhead.extra){for(d=m.pending;m.gzindex<(65535&m.gzhead.extra.length)&&(m.pending!==m.pending_buf_size||(m.gzhead.hcrc&&m.pending>d&&(N.adler=e(N.adler,m.pending_buf,m.pending-d,d)),Y(N),d=m.pending,m.pending!==m.pending_buf_size));)L(m,255&m.gzhead.extra[m.gzindex]),m.gzindex++;m.gzhead.hcrc&&m.pending>d&&(N.adler=e(N.adler,m.pending_buf,m.pending-d,d)),m.gzindex===m.gzhead.extra.length&&(m.gzindex=0,m.status=73)}else m.status=73;if(73===m.status)if(m.gzhead.name){d=m.pending;do{if(m.pending===m.pending_buf_size&&(m.gzhead.hcrc&&m.pending>d&&(N.adler=e(N.adler,m.pending_buf,m.pending-d,d)),Y(N),d=m.pending,m.pending===m.pending_buf_size)){X=1;break}X=m.gzindex<m.gzhead.name.length?255&m.gzhead.name.charCodeAt(m.gzindex++):0,L(m,X)}while(0!==X);m.gzhead.hcrc&&m.pending>d&&(N.adler=e(N.adler,m.pending_buf,m.pending-d,d)),0===X&&(m.gzindex=0,m.status=91)}else m.status=91;if(91===m.status)if(m.gzhead.comment){d=m.pending;do{if(m.pending===m.pending_buf_size&&(m.gzhead.hcrc&&m.pending>d&&(N.adler=e(N.adler,m.pending_buf,m.pending-d,d)),Y(N),d=m.pending,m.pending===m.pending_buf_size)){X=1;break}X=m.gzindex<m.gzhead.comment.length?255&m.gzhead.comment.charCodeAt(m.gzindex++):0,L(m,X)}while(0!==X);m.gzhead.hcrc&&m.pending>d&&(N.adler=e(N.adler,m.pending_buf,m.pending-d,d)),0===X&&(m.status=b)}else m.status=b;if(m.status===b&&(m.gzhead.hcrc?(m.pending+2>m.pending_buf_size&&Y(N),m.pending+2<=m.pending_buf_size&&(L(m,255&N.adler),L(m,N.adler>>8&255),N.adler=0,m.status=J)):m.status=J),0!==m.pending){if(Y(N),0===N.avail_out)return m.last_flush=-1,h}else if(0===N.avail_in&&x(Z)<=x(S)&&Z!==T)return G(N,Q);if(m.status===F&&0!==N.avail_in)return G(N,Q);if(0!==N.avail_in||0!==m.lookahead||Z!==B&&m.status!==F){let d=m.strategy===g?((N,Z)=>{let d;for(;;){if(0===N.lookahead&&(y(N),0===N.lookahead)){if(Z===B)return 1;break}if(N.match_length=0,d=z(N,0,N.window[N.strstart]),N.lookahead--,N.strstart++,d&&(s(N,!1),0===N.strm.avail_out))return 1}return N.insert=0,Z===T?(s(N,!0),0===N.strm.avail_out?3:4):N.last_lit&&(s(N,!1),0===N.strm.avail_out)?1:2})(m,Z):m.strategy===E?((N,Z)=>{let d,X,I,m;const w=N.window;for(;;){if(N.lookahead<=P){if(y(N),N.lookahead<=P&&Z===B)return 1;if(0===N.lookahead)break}if(N.match_length=0,N.lookahead>=3&&N.strstart>0&&(I=N.strstart-1,X=w[I],X===w[++I]&&X===w[++I]&&X===w[++I])){m=N.strstart+P;do{}while(X===w[++I]&&X===w[++I]&&X===w[++I]&&X===w[++I]&&X===w[++I]&&X===w[++I]&&X===w[++I]&&X===w[++I]&&I<m);N.match_length=P-(m-I),N.match_length>N.lookahead&&(N.match_length=N.lookahead)}if(N.match_length>=3?(d=z(N,1,N.match_length-3),N.lookahead-=N.match_length,N.strstart+=N.match_length,N.match_length=0):(d=z(N,0,N.window[N.strstart]),N.lookahead--,N.strstart++),d&&(s(N,!1),0===N.strm.avail_out))return 1}return N.insert=0,Z===T?(s(N,!0),0===N.strm.avail_out?3:4):N.last_lit&&(s(N,!1),0===N.strm.avail_out)?1:2})(m,Z):c[m.level].func(m,Z);if(3!==d&&4!==d||(m.status=F),1===d||3===d)return 0===N.avail_out&&(m.last_flush=-1),h;if(2===d&&(Z===D?w(m):Z!==k&&(I(m,0,0,!1),Z===v&&(t(m.head),0===m.lookahead&&(m.strstart=0,m.block_start=0,m.insert=0))),Y(N),0===N.avail_out))return m.last_flush=-1,h}return Z!==T?h:m.wrap<=0?U:(2===m.wrap?(L(m,255&N.adler),L(m,N.adler>>8&255),L(m,N.adler>>16&255),L(m,N.adler>>24&255),L(m,255&N.total_in),L(m,N.total_in>>8&255),L(m,N.total_in>>16&255),L(m,N.total_in>>24&255)):(H(m,N.adler>>>16),H(m,65535&N.adler)),Y(N),m.wrap>0&&(m.wrap=-m.wrap),0!==m.pending?h:U)},N.exports.deflateEnd=N=>{if(!N||!N.state)return C;const Z=N.state.status;return 42!==Z&&69!==Z&&73!==Z&&91!==Z&&Z!==b&&Z!==J&&Z!==F?G(N,C):(N.state=null,Z===J?G(N,M):h)},N.exports.deflateSetDictionary=(N,Z)=>{let d=Z.length;if(!N||!N.state)return C;const X=N.state,I=X.wrap;if(2===I||1===I&&42!==X.status||X.lookahead)return C;if(1===I&&(N.adler=S(N.adler,Z,d,0)),X.wrap=0,d>=X.w_size){0===I&&(t(X.head),X.strstart=0,X.block_start=0,X.insert=0);let N=new Uint8Array(X.w_size);N.set(Z.subarray(d-X.w_size,d),0),Z=N,d=X.w_size}const m=N.avail_in,z=N.next_in,w=N.input;for(N.avail_in=d,N.next_in=0,N.input=Z,y(X);X.lookahead>=3;){let N=X.strstart,Z=X.lookahead-2;do{X.ins_h=q(X,X.ins_h,X.window[N+3-1]),X.prev[N&X.w_mask]=X.head[X.ins_h],X.head[X.ins_h]=N,N++}while(--Z);X.strstart=N,X.lookahead=2,y(X)}return X.strstart+=X.lookahead,X.block_start=X.strstart,X.insert=X.lookahead,X.lookahead=0,X.match_length=X.prev_length=2,X.match_available=0,N.next_in=z,N.input=w,N.avail_in=m,X.wrap=I,h},N.exports.deflateInfo="pako deflate (from Nodeca project)"},11279:N=>{"use strict";N.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},11264:N=>{"use strict";N.exports=function(N,Z){let d,X,I,m,z,w,S,e,j,B,D,v,T,k,h,U,C,M,Q,A,n,g,E,V;const O=N.state;d=N.next_in,E=N.input,X=d+(N.avail_in-5),I=N.next_out,V=N.output,m=I-(Z-N.avail_out),z=I+(N.avail_out-257),w=O.dmax,S=O.wsize,e=O.whave,j=O.wnext,B=O.window,D=O.hold,v=O.bits,T=O.lencode,k=O.distcode,h=(1<<O.lenbits)-1,U=(1<<O.distbits)-1;N:do{v<15&&(D+=E[d++]<<v,v+=8,D+=E[d++]<<v,v+=8),C=T[D&h];Z:for(;;){if(M=C>>>24,D>>>=M,v-=M,M=C>>>16&255,0===M)V[I++]=65535&C;else{if(!(16&M)){if(0===(64&M)){C=T[(65535&C)+(D&(1<<M)-1)];continue Z}if(32&M){O.mode=12;break N}N.msg="invalid literal/length code",O.mode=30;break N}Q=65535&C,M&=15,M&&(v<M&&(D+=E[d++]<<v,v+=8),Q+=D&(1<<M)-1,D>>>=M,v-=M),v<15&&(D+=E[d++]<<v,v+=8,D+=E[d++]<<v,v+=8),C=k[D&U];d:for(;;){if(M=C>>>24,D>>>=M,v-=M,M=C>>>16&255,!(16&M)){if(0===(64&M)){C=k[(65535&C)+(D&(1<<M)-1)];continue d}N.msg="invalid distance code",O.mode=30;break N}if(A=65535&C,M&=15,v<M&&(D+=E[d++]<<v,v+=8,v<M&&(D+=E[d++]<<v,v+=8)),A+=D&(1<<M)-1,A>w){N.msg="invalid distance too far back",O.mode=30;break N}if(D>>>=M,v-=M,M=I-m,A>M){if(M=A-M,M>e&&O.sane){N.msg="invalid distance too far back",O.mode=30;break N}if(n=0,g=B,0===j){if(n+=S-M,M<Q){Q-=M;do{V[I++]=B[n++]}while(--M);n=I-A,g=V}}else if(j<M){if(n+=S+j-M,M-=j,M<Q){Q-=M;do{V[I++]=B[n++]}while(--M);if(n=0,j<Q){M=j,Q-=M;do{V[I++]=B[n++]}while(--M);n=I-A,g=V}}}else if(n+=j-M,M<Q){Q-=M;do{V[I++]=B[n++]}while(--M);n=I-A,g=V}for(;Q>2;)V[I++]=g[n++],V[I++]=g[n++],V[I++]=g[n++],Q-=3;Q&&(V[I++]=g[n++],Q>1&&(V[I++]=g[n++]))}else{n=I-A;do{V[I++]=V[n++],V[I++]=V[n++],V[I++]=V[n++],Q-=3}while(Q>2);Q&&(V[I++]=V[n++],Q>1&&(V[I++]=V[n++]))}break}}break}}while(d<X&&I<z);Q=v>>3,d-=Q,v-=Q<<3,D&=(1<<v)-1,N.next_in=d,N.next_out=I,N.avail_in=d<X?X-d+5:5-(d-X),N.avail_out=I<z?z-I+257:257-(I-z),O.hold=D,O.bits=v}},11256:(N,Z,d)=>{"use strict";const X=d(11208),I=d(11215),m=d(11264),z=d(11271),{Z_FINISH:w,Z_BLOCK:S,Z_TREES:e,Z_OK:j,Z_STREAM_END:B,Z_NEED_DICT:D,Z_STREAM_ERROR:v,Z_DATA_ERROR:T,Z_MEM_ERROR:k,Z_BUF_ERROR:h,Z_DEFLATED:U}=d(11223),C=12,M=30,Q=N=>(N>>>24&255)+(N>>>8&65280)+((65280&N)<<8)+((255&N)<<24);function A(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const n=N=>{if(!N||!N.state)return v;const Z=N.state;return N.total_in=N.total_out=Z.total=0,N.msg="",Z.wrap&&(N.adler=1&Z.wrap),Z.mode=1,Z.last=0,Z.havedict=0,Z.dmax=32768,Z.head=null,Z.hold=0,Z.bits=0,Z.lencode=Z.lendyn=new Int32Array(852),Z.distcode=Z.distdyn=new Int32Array(592),Z.sane=1,Z.back=-1,j},g=N=>{if(!N||!N.state)return v;const Z=N.state;return Z.wsize=0,Z.whave=0,Z.wnext=0,n(N)},E=(N,Z)=>{let d;if(!N||!N.state)return v;const X=N.state;return Z<0?(d=0,Z=-Z):(d=1+(Z>>4),Z<48&&(Z&=15)),Z&&(Z<8||Z>15)?v:(null!==X.window&&X.wbits!==Z&&(X.window=null),X.wrap=d,X.wbits=Z,g(N))},V=(N,Z)=>{if(!N)return v;const d=new A;N.state=d,d.window=null;const X=E(N,Z);return X!==j&&(N.state=null),X};let O,K,r=!0;const P=N=>{if(r){O=new Int32Array(512),K=new Int32Array(32);let Z=0;for(;Z<144;)N.lens[Z++]=8;for(;Z<256;)N.lens[Z++]=9;for(;Z<280;)N.lens[Z++]=7;for(;Z<288;)N.lens[Z++]=8;for(z(1,N.lens,0,288,O,0,N.work,{bits:9}),Z=0;Z<32;)N.lens[Z++]=5;z(2,N.lens,0,32,K,0,N.work,{bits:5}),r=!1}N.lencode=O,N.lenbits=9,N.distcode=K,N.distbits=5},W=(N,Z,d,X)=>{let I;const m=N.state;return null===m.window&&(m.wsize=1<<m.wbits,m.wnext=0,m.whave=0,m.window=new Uint8Array(m.wsize)),X>=m.wsize?(m.window.set(Z.subarray(d-m.wsize,d),0),m.wnext=0,m.whave=m.wsize):(I=m.wsize-m.wnext,I>X&&(I=X),m.window.set(Z.subarray(d-X,d-X+I),m.wnext),(X-=I)?(m.window.set(Z.subarray(d-X,d),0),m.wnext=X,m.whave=m.wsize):(m.wnext+=I,m.wnext===m.wsize&&(m.wnext=0),m.whave<m.wsize&&(m.whave+=I))),0};N.exports.inflateReset=g,N.exports.inflateReset2=E,N.exports.inflateResetKeep=n,N.exports.inflateInit=N=>V(N,15),N.exports.inflateInit2=V,N.exports.inflate=(N,Z)=>{let d,A,n,g,E,V,O,K,r,b,J,F,G,x,t,q,Y,s,L,H,i,p,y=0;const l=new Uint8Array(4);let u,a;const c=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!N||!N.state||!N.output||!N.input&&0!==N.avail_in)return v;d=N.state,d.mode===C&&(d.mode=13),E=N.next_out,n=N.output,O=N.avail_out,g=N.next_in,A=N.input,V=N.avail_in,K=d.hold,r=d.bits,b=V,J=O,p=j;N:for(;;)switch(d.mode){case 1:if(0===d.wrap){d.mode=13;break}for(;r<16;){if(0===V)break N;V--,K+=A[g++]<<r,r+=8}if(2&d.wrap&&35615===K){d.check=0,l[0]=255&K,l[1]=K>>>8&255,d.check=I(d.check,l,2,0),K=0,r=0,d.mode=2;break}if(d.flags=0,d.head&&(d.head.done=!1),!(1&d.wrap)||(((255&K)<<8)+(K>>8))%31){N.msg="incorrect header check",d.mode=M;break}if((15&K)!==U){N.msg="unknown compression method",d.mode=M;break}if(K>>>=4,r-=4,i=8+(15&K),0===d.wbits)d.wbits=i;else if(i>d.wbits){N.msg="invalid window size",d.mode=M;break}d.dmax=1<<d.wbits,N.adler=d.check=1,d.mode=512&K?10:C,K=0,r=0;break;case 2:for(;r<16;){if(0===V)break N;V--,K+=A[g++]<<r,r+=8}if(d.flags=K,(255&d.flags)!==U){N.msg="unknown compression method",d.mode=M;break}if(57344&d.flags){N.msg="unknown header flags set",d.mode=M;break}d.head&&(d.head.text=K>>8&1),512&d.flags&&(l[0]=255&K,l[1]=K>>>8&255,d.check=I(d.check,l,2,0)),K=0,r=0,d.mode=3;case 3:for(;r<32;){if(0===V)break N;V--,K+=A[g++]<<r,r+=8}d.head&&(d.head.time=K),512&d.flags&&(l[0]=255&K,l[1]=K>>>8&255,l[2]=K>>>16&255,l[3]=K>>>24&255,d.check=I(d.check,l,4,0)),K=0,r=0,d.mode=4;case 4:for(;r<16;){if(0===V)break N;V--,K+=A[g++]<<r,r+=8}d.head&&(d.head.xflags=255&K,d.head.os=K>>8),512&d.flags&&(l[0]=255&K,l[1]=K>>>8&255,d.check=I(d.check,l,2,0)),K=0,r=0,d.mode=5;case 5:if(1024&d.flags){for(;r<16;){if(0===V)break N;V--,K+=A[g++]<<r,r+=8}d.length=K,d.head&&(d.head.extra_len=K),512&d.flags&&(l[0]=255&K,l[1]=K>>>8&255,d.check=I(d.check,l,2,0)),K=0,r=0}else d.head&&(d.head.extra=null);d.mode=6;case 6:if(1024&d.flags&&(F=d.length,F>V&&(F=V),F&&(d.head&&(i=d.head.extra_len-d.length,d.head.extra||(d.head.extra=new Uint8Array(d.head.extra_len)),d.head.extra.set(A.subarray(g,g+F),i)),512&d.flags&&(d.check=I(d.check,A,F,g)),V-=F,g+=F,d.length-=F),d.length))break N;d.length=0,d.mode=7;case 7:if(2048&d.flags){if(0===V)break N;F=0;do{i=A[g+F++],d.head&&i&&d.length<65536&&(d.head.name+=String.fromCharCode(i))}while(i&&F<V);if(512&d.flags&&(d.check=I(d.check,A,F,g)),V-=F,g+=F,i)break N}else d.head&&(d.head.name=null);d.length=0,d.mode=8;case 8:if(4096&d.flags){if(0===V)break N;F=0;do{i=A[g+F++],d.head&&i&&d.length<65536&&(d.head.comment+=String.fromCharCode(i))}while(i&&F<V);if(512&d.flags&&(d.check=I(d.check,A,F,g)),V-=F,g+=F,i)break N}else d.head&&(d.head.comment=null);d.mode=9;case 9:if(512&d.flags){for(;r<16;){if(0===V)break N;V--,K+=A[g++]<<r,r+=8}if(K!==(65535&d.check)){N.msg="header crc mismatch",d.mode=M;break}K=0,r=0}d.head&&(d.head.hcrc=d.flags>>9&1,d.head.done=!0),N.adler=d.check=0,d.mode=C;break;case 10:for(;r<32;){if(0===V)break N;V--,K+=A[g++]<<r,r+=8}N.adler=d.check=Q(K),K=0,r=0,d.mode=11;case 11:if(0===d.havedict)return N.next_out=E,N.avail_out=O,N.next_in=g,N.avail_in=V,d.hold=K,d.bits=r,D;N.adler=d.check=1,d.mode=C;case C:if(Z===S||Z===e)break N;case 13:if(d.last){K>>>=7&r,r-=7&r,d.mode=27;break}for(;r<3;){if(0===V)break N;V--,K+=A[g++]<<r,r+=8}switch(d.last=1&K,K>>>=1,r-=1,3&K){case 0:d.mode=14;break;case 1:if(P(d),d.mode=20,Z===e){K>>>=2,r-=2;break N}break;case 2:d.mode=17;break;case 3:N.msg="invalid block type",d.mode=M}K>>>=2,r-=2;break;case 14:for(K>>>=7&r,r-=7&r;r<32;){if(0===V)break N;V--,K+=A[g++]<<r,r+=8}if((65535&K)!==(K>>>16^65535)){N.msg="invalid stored block lengths",d.mode=M;break}if(d.length=65535&K,K=0,r=0,d.mode=15,Z===e)break N;case 15:d.mode=16;case 16:if(F=d.length,F){if(F>V&&(F=V),F>O&&(F=O),0===F)break N;n.set(A.subarray(g,g+F),E),V-=F,g+=F,O-=F,E+=F,d.length-=F;break}d.mode=C;break;case 17:for(;r<14;){if(0===V)break N;V--,K+=A[g++]<<r,r+=8}if(d.nlen=257+(31&K),K>>>=5,r-=5,d.ndist=1+(31&K),K>>>=5,r-=5,d.ncode=4+(15&K),K>>>=4,r-=4,d.nlen>286||d.ndist>30){N.msg="too many length or distance symbols",d.mode=M;break}d.have=0,d.mode=18;case 18:for(;d.have<d.ncode;){for(;r<3;){if(0===V)break N;V--,K+=A[g++]<<r,r+=8}d.lens[c[d.have++]]=7&K,K>>>=3,r-=3}for(;d.have<19;)d.lens[c[d.have++]]=0;if(d.lencode=d.lendyn,d.lenbits=7,u={bits:d.lenbits},p=z(0,d.lens,0,19,d.lencode,0,d.work,u),d.lenbits=u.bits,p){N.msg="invalid code lengths set",d.mode=M;break}d.have=0,d.mode=19;case 19:for(;d.have<d.nlen+d.ndist;){for(;y=d.lencode[K&(1<<d.lenbits)-1],t=y>>>24,q=y>>>16&255,Y=65535&y,!(t<=r);){if(0===V)break N;V--,K+=A[g++]<<r,r+=8}if(Y<16)K>>>=t,r-=t,d.lens[d.have++]=Y;else{if(16===Y){for(a=t+2;r<a;){if(0===V)break N;V--,K+=A[g++]<<r,r+=8}if(K>>>=t,r-=t,0===d.have){N.msg="invalid bit length repeat",d.mode=M;break}i=d.lens[d.have-1],F=3+(3&K),K>>>=2,r-=2}else if(17===Y){for(a=t+3;r<a;){if(0===V)break N;V--,K+=A[g++]<<r,r+=8}K>>>=t,r-=t,i=0,F=3+(7&K),K>>>=3,r-=3}else{for(a=t+7;r<a;){if(0===V)break N;V--,K+=A[g++]<<r,r+=8}K>>>=t,r-=t,i=0,F=11+(127&K),K>>>=7,r-=7}if(d.have+F>d.nlen+d.ndist){N.msg="invalid bit length repeat",d.mode=M;break}for(;F--;)d.lens[d.have++]=i}}if(d.mode===M)break;if(0===d.lens[256]){N.msg="invalid code -- missing end-of-block",d.mode=M;break}if(d.lenbits=9,u={bits:d.lenbits},p=z(1,d.lens,0,d.nlen,d.lencode,0,d.work,u),d.lenbits=u.bits,p){N.msg="invalid literal/lengths set",d.mode=M;break}if(d.distbits=6,d.distcode=d.distdyn,u={bits:d.distbits},p=z(2,d.lens,d.nlen,d.ndist,d.distcode,0,d.work,u),d.distbits=u.bits,p){N.msg="invalid distances set",d.mode=M;break}if(d.mode=20,Z===e)break N;case 20:d.mode=21;case 21:if(V>=6&&O>=258){N.next_out=E,N.avail_out=O,N.next_in=g,N.avail_in=V,d.hold=K,d.bits=r,m(N,J),E=N.next_out,n=N.output,O=N.avail_out,g=N.next_in,A=N.input,V=N.avail_in,K=d.hold,r=d.bits,d.mode===C&&(d.back=-1);break}for(d.back=0;y=d.lencode[K&(1<<d.lenbits)-1],t=y>>>24,q=y>>>16&255,Y=65535&y,!(t<=r);){if(0===V)break N;V--,K+=A[g++]<<r,r+=8}if(q&&0===(240&q)){for(s=t,L=q,H=Y;y=d.lencode[H+((K&(1<<s+L)-1)>>s)],t=y>>>24,q=y>>>16&255,Y=65535&y,!(s+t<=r);){if(0===V)break N;V--,K+=A[g++]<<r,r+=8}K>>>=s,r-=s,d.back+=s}if(K>>>=t,r-=t,d.back+=t,d.length=Y,0===q){d.mode=26;break}if(32&q){d.back=-1,d.mode=C;break}if(64&q){N.msg="invalid literal/length code",d.mode=M;break}d.extra=15&q,d.mode=22;case 22:if(d.extra){for(a=d.extra;r<a;){if(0===V)break N;V--,K+=A[g++]<<r,r+=8}d.length+=K&(1<<d.extra)-1,K>>>=d.extra,r-=d.extra,d.back+=d.extra}d.was=d.length,d.mode=23;case 23:for(;y=d.distcode[K&(1<<d.distbits)-1],t=y>>>24,q=y>>>16&255,Y=65535&y,!(t<=r);){if(0===V)break N;V--,K+=A[g++]<<r,r+=8}if(0===(240&q)){for(s=t,L=q,H=Y;y=d.distcode[H+((K&(1<<s+L)-1)>>s)],t=y>>>24,q=y>>>16&255,Y=65535&y,!(s+t<=r);){if(0===V)break N;V--,K+=A[g++]<<r,r+=8}K>>>=s,r-=s,d.back+=s}if(K>>>=t,r-=t,d.back+=t,64&q){N.msg="invalid distance code",d.mode=M;break}d.offset=Y,d.extra=15&q,d.mode=24;case 24:if(d.extra){for(a=d.extra;r<a;){if(0===V)break N;V--,K+=A[g++]<<r,r+=8}d.offset+=K&(1<<d.extra)-1,K>>>=d.extra,r-=d.extra,d.back+=d.extra}if(d.offset>d.dmax){N.msg="invalid distance too far back",d.mode=M;break}d.mode=25;case 25:if(0===O)break N;if(F=J-O,d.offset>F){if(F=d.offset-F,F>d.whave&&d.sane){N.msg="invalid distance too far back",d.mode=M;break}F>d.wnext?(F-=d.wnext,G=d.wsize-F):G=d.wnext-F,F>d.length&&(F=d.length),x=d.window}else x=n,G=E-d.offset,F=d.length;F>O&&(F=O),O-=F,d.length-=F;do{n[E++]=x[G++]}while(--F);0===d.length&&(d.mode=21);break;case 26:if(0===O)break N;n[E++]=d.length,O--,d.mode=21;break;case 27:if(d.wrap){for(;r<32;){if(0===V)break N;V--,K|=A[g++]<<r,r+=8}if(J-=O,N.total_out+=J,d.total+=J,J&&(N.adler=d.check=d.flags?I(d.check,n,J,E-J):X(d.check,n,J,E-J)),J=O,(d.flags?K:Q(K))!==d.check){N.msg="incorrect data check",d.mode=M;break}K=0,r=0}d.mode=28;case 28:if(d.wrap&&d.flags){for(;r<32;){if(0===V)break N;V--,K+=A[g++]<<r,r+=8}if(K!==(4294967295&d.total)){N.msg="incorrect length check",d.mode=M;break}K=0,r=0}d.mode=29;case 29:p=B;break N;case M:p=T;break N;case 31:return k;default:return v}return N.next_out=E,N.avail_out=O,N.next_in=g,N.avail_in=V,d.hold=K,d.bits=r,(d.wsize||J!==N.avail_out&&d.mode<M&&(d.mode<27||Z!==w))&&W(N,N.output,N.next_out,J-N.avail_out)?(d.mode=31,k):(b-=N.avail_in,J-=N.avail_out,N.total_in+=b,N.total_out+=J,d.total+=J,d.wrap&&J&&(N.adler=d.check=d.flags?I(d.check,n,J,N.next_out-J):X(d.check,n,J,N.next_out-J)),N.data_type=d.bits+(d.last?64:0)+(d.mode===C?128:0)+(20===d.mode||15===d.mode?256:0),(0===b&&0===J||Z===w)&&p===j&&(p=h),p)},N.exports.inflateEnd=N=>{if(!N||!N.state)return v;let Z=N.state;return Z.window&&(Z.window=null),N.state=null,j},N.exports.inflateGetHeader=(N,Z)=>{if(!N||!N.state)return v;const d=N.state;return 0===(2&d.wrap)?v:(d.head=Z,Z.done=!1,j)},N.exports.inflateSetDictionary=(N,Z)=>{const d=Z.length;let I,m,z;return N&&N.state?(I=N.state,0!==I.wrap&&11!==I.mode?v:11===I.mode&&(m=1,m=X(m,Z,d,0),m!==I.check)?T:(z=W(N,Z,d,d),z?(I.mode=31,k):(I.havedict=1,j))):v},N.exports.inflateInfo="pako inflate (from Nodeca project)"},11271:N=>{"use strict";const Z=15,d=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),X=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),I=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),m=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);N.exports=(N,z,w,S,e,j,B,D)=>{const v=D.bits;let T,k,h,U,C,M,Q=0,A=0,n=0,g=0,E=0,V=0,O=0,K=0,r=0,P=0,W=null,b=0;const J=new Uint16Array(16),F=new Uint16Array(16);let G,x,t,q=null,Y=0;for(Q=0;Q<=Z;Q++)J[Q]=0;for(A=0;A<S;A++)J[z[w+A]]++;for(E=v,g=Z;g>=1&&0===J[g];g--);if(E>g&&(E=g),0===g)return e[j++]=20971520,e[j++]=20971520,D.bits=1,0;for(n=1;n<g&&0===J[n];n++);for(E<n&&(E=n),K=1,Q=1;Q<=Z;Q++)if(K<<=1,K-=J[Q],K<0)return-1;if(K>0&&(0===N||1!==g))return-1;for(F[1]=0,Q=1;Q<Z;Q++)F[Q+1]=F[Q]+J[Q];for(A=0;A<S;A++)0!==z[w+A]&&(B[F[z[w+A]]++]=A);if(0===N?(W=q=B,M=19):1===N?(W=d,b-=257,q=X,Y-=257,M=256):(W=I,q=m,M=-1),P=0,A=0,Q=n,C=j,V=E,O=0,h=-1,r=1<<E,U=r-1,1===N&&r>852||2===N&&r>592)return 1;for(;;){G=Q-O,B[A]<M?(x=0,t=B[A]):B[A]>M?(x=q[Y+B[A]],t=W[b+B[A]]):(x=96,t=0),T=1<<Q-O,k=1<<V,n=k;do{k-=T,e[C+(P>>O)+k]=G<<24|x<<16|t}while(0!==k);for(T=1<<Q-1;P&T;)T>>=1;if(0!==T?(P&=T-1,P+=T):P=0,A++,0===--J[Q]){if(Q===g)break;Q=z[w+B[A]]}if(Q>E&&(P&U)!==h){for(0===O&&(O=E),C+=n,V=Q-O,K=1<<V;V+O<g&&(K-=J[V+O],!(K<=0));)V++,K<<=1;if(r+=1<<V,1===N&&r>852||2===N&&r>592)return 1;h=P&U,e[h]=E<<24|V<<16|C-j}}return 0!==P&&(e[C+P]=Q-O<<24|64<<16),D.bits=E,0}},11220:N=>{"use strict";N.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},11200:N=>{"use strict";function Z(N){let Z=N.length;for(;--Z>=0;)N[Z]=0}const d=256,X=286,I=30,m=15,z=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),w=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),S=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),e=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),j=new Array(576);Z(j);const B=new Array(60);Z(B);const D=new Array(512);Z(D);const v=new Array(256);Z(v);const T=new Array(29);Z(T);const k=new Array(I);function h(N,Z,d,X,I){this.static_tree=N,this.extra_bits=Z,this.extra_base=d,this.elems=X,this.max_length=I,this.has_stree=N&&N.length}let U,C,M;function Q(N,Z){this.dyn_tree=N,this.max_code=0,this.stat_desc=Z}Z(k);const A=N=>N<256?D[N]:D[256+(N>>>7)],n=(N,Z)=>{N.pending_buf[N.pending++]=255&Z,N.pending_buf[N.pending++]=Z>>>8&255},g=(N,Z,d)=>{N.bi_valid>16-d?(N.bi_buf|=Z<<N.bi_valid&65535,n(N,N.bi_buf),N.bi_buf=Z>>16-N.bi_valid,N.bi_valid+=d-16):(N.bi_buf|=Z<<N.bi_valid&65535,N.bi_valid+=d)},E=(N,Z,d)=>{g(N,d[2*Z],d[2*Z+1])},V=(N,Z)=>{let d=0;do{d|=1&N,N>>>=1,d<<=1}while(--Z>0);return d>>>1},O=(N,Z,d)=>{const X=new Array(16);let I,z,w=0;for(I=1;I<=m;I++)X[I]=w=w+d[I-1]<<1;for(z=0;z<=Z;z++){let Z=N[2*z+1];0!==Z&&(N[2*z]=V(X[Z]++,Z))}},K=N=>{let Z;for(Z=0;Z<X;Z++)N.dyn_ltree[2*Z]=0;for(Z=0;Z<I;Z++)N.dyn_dtree[2*Z]=0;for(Z=0;Z<19;Z++)N.bl_tree[2*Z]=0;N.dyn_ltree[512]=1,N.opt_len=N.static_len=0,N.last_lit=N.matches=0},r=N=>{N.bi_valid>8?n(N,N.bi_buf):N.bi_valid>0&&(N.pending_buf[N.pending++]=N.bi_buf),N.bi_buf=0,N.bi_valid=0},P=(N,Z,d,X)=>{const I=2*Z,m=2*d;return N[I]<N[m]||N[I]===N[m]&&X[Z]<=X[d]},W=(N,Z,d)=>{const X=N.heap[d];let I=d<<1;for(;I<=N.heap_len&&(I<N.heap_len&&P(Z,N.heap[I+1],N.heap[I],N.depth)&&I++,!P(Z,X,N.heap[I],N.depth));)N.heap[d]=N.heap[I],d=I,I<<=1;N.heap[d]=X},b=(N,Z,X)=>{let I,m,S,e,j=0;if(0!==N.last_lit)do{I=N.pending_buf[N.d_buf+2*j]<<8|N.pending_buf[N.d_buf+2*j+1],m=N.pending_buf[N.l_buf+j],j++,0===I?E(N,m,Z):(S=v[m],E(N,S+d+1,Z),e=z[S],0!==e&&(m-=T[S],g(N,m,e)),I--,S=A(I),E(N,S,X),e=w[S],0!==e&&(I-=k[S],g(N,I,e)))}while(j<N.last_lit);E(N,256,Z)},J=(N,Z)=>{const d=Z.dyn_tree,X=Z.stat_desc.static_tree,I=Z.stat_desc.has_stree,z=Z.stat_desc.elems;let w,S,e,j=-1;for(N.heap_len=0,N.heap_max=573,w=0;w<z;w++)0!==d[2*w]?(N.heap[++N.heap_len]=j=w,N.depth[w]=0):d[2*w+1]=0;for(;N.heap_len<2;)e=N.heap[++N.heap_len]=j<2?++j:0,d[2*e]=1,N.depth[e]=0,N.opt_len--,I&&(N.static_len-=X[2*e+1]);for(Z.max_code=j,w=N.heap_len>>1;w>=1;w--)W(N,d,w);e=z;do{w=N.heap[1],N.heap[1]=N.heap[N.heap_len--],W(N,d,1),S=N.heap[1],N.heap[--N.heap_max]=w,N.heap[--N.heap_max]=S,d[2*e]=d[2*w]+d[2*S],N.depth[e]=(N.depth[w]>=N.depth[S]?N.depth[w]:N.depth[S])+1,d[2*w+1]=d[2*S+1]=e,N.heap[1]=e++,W(N,d,1)}while(N.heap_len>=2);N.heap[--N.heap_max]=N.heap[1],((N,Z)=>{const d=Z.dyn_tree,X=Z.max_code,I=Z.stat_desc.static_tree,z=Z.stat_desc.has_stree,w=Z.stat_desc.extra_bits,S=Z.stat_desc.extra_base,e=Z.stat_desc.max_length;let j,B,D,v,T,k,h=0;for(v=0;v<=m;v++)N.bl_count[v]=0;for(d[2*N.heap[N.heap_max]+1]=0,j=N.heap_max+1;j<573;j++)B=N.heap[j],v=d[2*d[2*B+1]+1]+1,v>e&&(v=e,h++),d[2*B+1]=v,B>X||(N.bl_count[v]++,T=0,B>=S&&(T=w[B-S]),k=d[2*B],N.opt_len+=k*(v+T),z&&(N.static_len+=k*(I[2*B+1]+T)));if(0!==h){do{for(v=e-1;0===N.bl_count[v];)v--;N.bl_count[v]--,N.bl_count[v+1]+=2,N.bl_count[e]--,h-=2}while(h>0);for(v=e;0!==v;v--)for(B=N.bl_count[v];0!==B;)D=N.heap[--j],D>X||(d[2*D+1]!==v&&(N.opt_len+=(v-d[2*D+1])*d[2*D],d[2*D+1]=v),B--)}})(N,Z),O(d,j,N.bl_count)},F=(N,Z,d)=>{let X,I,m=-1,z=Z[1],w=0,S=7,e=4;for(0===z&&(S=138,e=3),Z[2*(d+1)+1]=65535,X=0;X<=d;X++)I=z,z=Z[2*(X+1)+1],++w<S&&I===z||(w<e?N.bl_tree[2*I]+=w:0!==I?(I!==m&&N.bl_tree[2*I]++,N.bl_tree[32]++):w<=10?N.bl_tree[34]++:N.bl_tree[36]++,w=0,m=I,0===z?(S=138,e=3):I===z?(S=6,e=3):(S=7,e=4))},G=(N,Z,d)=>{let X,I,m=-1,z=Z[1],w=0,S=7,e=4;for(0===z&&(S=138,e=3),X=0;X<=d;X++)if(I=z,z=Z[2*(X+1)+1],!(++w<S&&I===z)){if(w<e)do{E(N,I,N.bl_tree)}while(0!==--w);else 0!==I?(I!==m&&(E(N,I,N.bl_tree),w--),E(N,16,N.bl_tree),g(N,w-3,2)):w<=10?(E(N,17,N.bl_tree),g(N,w-3,3)):(E(N,18,N.bl_tree),g(N,w-11,7));w=0,m=I,0===z?(S=138,e=3):I===z?(S=6,e=3):(S=7,e=4)}};let x=!1;const t=(N,Z,d,X)=>{g(N,0+(X?1:0),3),((N,Z,d,X)=>{r(N),X&&(n(N,d),n(N,~d)),N.pending_buf.set(N.window.subarray(Z,Z+d),N.pending),N.pending+=d})(N,Z,d,!0)};N.exports._tr_init=N=>{x||((()=>{let N,Z,d,e,Q;const A=new Array(16);for(d=0,e=0;e<28;e++)for(T[e]=d,N=0;N<1<<z[e];N++)v[d++]=e;for(v[d-1]=e,Q=0,e=0;e<16;e++)for(k[e]=Q,N=0;N<1<<w[e];N++)D[Q++]=e;for(Q>>=7;e<I;e++)for(k[e]=Q<<7,N=0;N<1<<w[e]-7;N++)D[256+Q++]=e;for(Z=0;Z<=m;Z++)A[Z]=0;for(N=0;N<=143;)j[2*N+1]=8,N++,A[8]++;for(;N<=255;)j[2*N+1]=9,N++,A[9]++;for(;N<=279;)j[2*N+1]=7,N++,A[7]++;for(;N<=287;)j[2*N+1]=8,N++,A[8]++;for(O(j,287,A),N=0;N<I;N++)B[2*N+1]=5,B[2*N]=V(N,5);U=new h(j,z,257,X,m),C=new h(B,w,0,I,m),M=new h(new Array(0),S,0,19,7)})(),x=!0),N.l_desc=new Q(N.dyn_ltree,U),N.d_desc=new Q(N.dyn_dtree,C),N.bl_desc=new Q(N.bl_tree,M),N.bi_buf=0,N.bi_valid=0,K(N)},N.exports._tr_stored_block=t,N.exports._tr_flush_block=(N,Z,X,I)=>{let m,z,w=0;N.level>0?(2===N.strm.data_type&&(N.strm.data_type=(N=>{let Z,X=4093624447;for(Z=0;Z<=31;Z++,X>>>=1)if(1&X&&0!==N.dyn_ltree[2*Z])return 0;if(0!==N.dyn_ltree[18]||0!==N.dyn_ltree[20]||0!==N.dyn_ltree[26])return 1;for(Z=32;Z<d;Z++)if(0!==N.dyn_ltree[2*Z])return 1;return 0})(N)),J(N,N.l_desc),J(N,N.d_desc),w=(N=>{let Z;for(F(N,N.dyn_ltree,N.l_desc.max_code),F(N,N.dyn_dtree,N.d_desc.max_code),J(N,N.bl_desc),Z=18;Z>=3&&0===N.bl_tree[2*e[Z]+1];Z--);return N.opt_len+=3*(Z+1)+5+5+4,Z})(N),m=N.opt_len+3+7>>>3,z=N.static_len+3+7>>>3,z<=m&&(m=z)):m=z=X+5,X+4<=m&&-1!==Z?t(N,Z,X,I):4===N.strategy||z===m?(g(N,2+(I?1:0),3),b(N,j,B)):(g(N,4+(I?1:0),3),((N,Z,d,X)=>{let I;for(g(N,Z-257,5),g(N,d-1,5),g(N,X-4,4),I=0;I<X;I++)g(N,N.bl_tree[2*e[I]+1],3);G(N,N.dyn_ltree,Z-1),G(N,N.dyn_dtree,d-1)})(N,N.l_desc.max_code+1,N.d_desc.max_code+1,w+1),b(N,N.dyn_ltree,N.dyn_dtree)),K(N),I&&r(N)},N.exports._tr_tally=(N,Z,X)=>(N.pending_buf[N.d_buf+2*N.last_lit]=Z>>>8&255,N.pending_buf[N.d_buf+2*N.last_lit+1]=255&Z,N.pending_buf[N.l_buf+N.last_lit]=255&X,N.last_lit++,0===Z?N.dyn_ltree[2*X]++:(N.matches++,Z--,N.dyn_ltree[2*(v[X]+d+1)]++,N.dyn_dtree[2*A(Z)]++),N.last_lit===N.lit_bufsize-1),N.exports._tr_align=N=>{g(N,2,3),E(N,256,j),(N=>{16===N.bi_valid?(n(N,N.bi_buf),N.bi_buf=0,N.bi_valid=0):N.bi_valid>=8&&(N.pending_buf[N.pending++]=255&N.bi_buf,N.bi_buf>>=8,N.bi_valid-=8)})(N)}},11244:N=>{"use strict";N.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},11658:N=>{function Z(N,Z,d){for(var X=N.length,I=-1/0,m=1/0,z=0;z<X;z++){var w=(d[0][z]-N[z])/Z[z],S=(d[1][z]-N[z])/Z[z];if(w>S){var e=w;w=S,S=e}if(S<I||w>m)return 1/0;w>I&&(I=w),S<m&&(m=S)}return I>m?1/0:I}N.exports=function(N,d,X,I){var m=Z(d,X,I);if(m===1/0)N=null;else{N=N||[];for(var z=0;z<d.length;z++)N[z]=d[z]+X[z]*m}return N},N.exports.distance=Z},12059:(N,Z,d)=>{"use strict";d.d(Z,{c:()=>z});var X=d(28);const I=X.useLayoutEffect;const m=function(N){var Z=(0,X.useRef)(N);return I((function(){Z.current=N})),Z};var z=function(N){var Z=m(N);(0,X.useEffect)((function(){var N=function(N){var d;if(null!=Z.current&&(d=Z.current(N)),N.defaultPrevented&&(N.returnValue=""),"string"===typeof d)return N.returnValue=d,d};return window.addEventListener("beforeunload",N),function(){window.removeEventListener("beforeunload",N)}}),[])}},12006:(N,Z,d)=>{"use strict";var X=d(12015),I=Array.prototype.concat,m=Array.prototype.slice,z=N.exports=function(N){for(var Z=[],d=0,z=N.length;d<z;d++){var w=N[d];X(w)?Z=I.call(Z,m.call(w)):Z.push(w)}return Z};z.wrap=function(N){return function(){return N(z(arguments))}}},12015:N=>{N.exports=function(N){return!(!N||"string"===typeof N)&&(N instanceof Array||Array.isArray(N)||N.length>=0&&(N.splice instanceof Function||Object.getOwnPropertyDescriptor(N,N.length-1)&&"String"!==N.constructor.name))}},11952:N=>{"use strict";var Z=[],d=[],X=[],I=[],m=[],z=[],w=[],S=[],e=[],j=[],B=[],D=[];N.exports=function(N,v,T,k,h,U){for(var C=w,M=e,Q=j,A=D,n=0;n<3;n++)C[n]=+T[n],Q[n]=+v.max[n],M[n]=+v.Lc[n];U||(U=1e-10);var g=function(N,w,e,j,D,v){var T=Z,k=d,h=X,U=I,C=m,M=z,Q=S,A=Math.floor,n=0,g=0,E=0,V=0,O=0;if(K(),0===E)return 0;for(V=W();g<=E;){if(r(V)&&P())return n;V=W()}for(n+=E,O=0;O<3;O++)j[O]+=e[O],D[O]+=e[O];return n;function K(){if(g=0,0!==(E=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])))for(var N=0;N<3;N++){var Z=e[N]>=0;U[N]=Z?1:-1;var d=Z?D[N]:j[N];T[N]=Z?j[N]:D[N],k[N]=b(d,U[N]),h[N]=J(T[N],U[N]),Q[N]=e[N]/E,C[N]=Math.abs(1/Q[N]);var X=Z?k[N]+1-d:d-k[N];M[N]=C[N]<1/0?C[N]*X:1/0}}function r(Z){for(var d=U[0],X=0===Z?k[0]:h[0],I=k[0]+d,m=U[1],z=1===Z?k[1]:h[1],w=k[1]+m,S=U[2],e=2===Z?k[2]:h[2],j=k[2]+S,B=X;B!=I;B+=d)for(var D=z;D!=w;D+=m)for(var v=e;v!=j;v+=S)if(N(B,D,v))return!0;return!1}function P(){n+=g;var N=U[V],Z=g/E,d=B;for(O=0;O<3;O++){var X=e[O]*Z;j[O]+=X,D[O]+=X,d[O]=e[O]-X}if(N>0?D[V]=Math.round(D[V]):j[V]=Math.round(j[V]),w(n,V,N,d))return!0;for(O=0;O<3;O++)e[O]=d[O];return K(),0===E}function W(){var N=M[0]<M[1]?M[0]<M[2]?0:2:M[1]<M[2]?1:2,Z=M[N]-g;for(g=M[N],k[N]+=U[N],M[N]+=C[N],O=0;O<3;O++)T[O]+=Z*Q[O],h[O]=J(T[O],U[O]);return N}function b(N,Z){return A(N-Z*v)}function J(N,Z){return A(N+Z*v)}}(N,k,C,M,Q,U);if(!h){for(n=0;n<3;n++)A[n]=T[n]>0?Q[n]-v.max[n]:M[n]-v.Lc[n];v.translate(A)}return g}},11147:(N,Z,d)=>{var X=d(11151);function I(N){for(var Z,d,I=0,m=N.length,z=0;z<N.length;){for(Z=N[z],d=0;z<m&&N[z]===Z;)++z,++d;I+=X.log2(d)/7|0,I+=X.log2(Z>>>0)/7|0,I+=2}return I}Z.size=I,Z.encode=function(N,Z){Z||(Z=new Uint8Array(I(N)));for(var d,X,m=0,z=Z.length,w=0;w<N.length;){for(d=N[w],X=0;w<N.length&&N[w]===d;)++w,++X;for(;m<z&&X>=128;)Z[m++]=128+(127&X),X>>>=7;if(m>=z)throw new Error("RLE buffer overflow");for(Z[m++]=X,d>>>=0;m<z&&d>=128;)Z[m++]=128+(127&d),d>>>=7;if(m>=z)throw new Error("RLE buffer overflow");Z[m++]=d}return Z},Z.decode=function(N,Z){for(var d,X,I,m,z=Z.length,w=N.length,S=0,e=0;e<w;){for(d=0,X=0;e<w&&N[e]>=128;)d+=(127&N[e++])<<X,X+=7;if(d+=N[e++]<<X,e>=w)throw new Error("RLE buffer underrun");if(S+d>z)throw new Error("Chunk buffer overflow");for(I=0,X=0;e<w&&N[e]>=128;)I+=(127&N[e++])<<X,X+=7;if(e>=w)throw new Error("RLE buffer underrun");for(I+=N[e++]<<X,m=0;m<d;++m)Z[S++]=I}return Z}},11151:(N,Z)=>{"use strict";function d(N){var Z=32;return(N&=-N)&&Z--,65535&N&&(Z-=16),16711935&N&&(Z-=8),252645135&N&&(Z-=4),858993459&N&&(Z-=2),1431655765&N&&(Z-=1),Z}Z.INT_BITS=32,Z.INT_MAX=2147483647,Z.INT_MIN=-1<<31,Z.sign=function(N){return(N>0)-(N<0)},Z.abs=function(N){var Z=N>>31;return(N^Z)-Z},Z.min=function(N,Z){return Z^(N^Z)&-(N<Z)},Z.max=function(N,Z){return N^(N^Z)&-(N<Z)},Z.isPow2=function(N){return!(N&N-1)&&!!N},Z.log2=function(N){var Z,d;return Z=(N>65535)<<4,Z|=d=((N>>>=Z)>255)<<3,Z|=d=((N>>>=d)>15)<<2,(Z|=d=((N>>>=d)>3)<<1)|(N>>>=d)>>1},Z.log10=function(N){return N>=1e9?9:N>=1e8?8:N>=1e7?7:N>=1e6?6:N>=1e5?5:N>=1e4?4:N>=1e3?3:N>=100?2:N>=10?1:0},Z.popCount=function(N){return 16843009*((N=(858993459&(N-=N>>>1&1431655765))+(N>>>2&858993459))+(N>>>4)&252645135)>>>24},Z.countTrailingZeros=d,Z.nextPow2=function(N){return N+=0===N,--N,N|=N>>>1,N|=N>>>2,N|=N>>>4,N|=N>>>8,(N|=N>>>16)+1},Z.prevPow2=function(N){return N|=N>>>1,N|=N>>>2,N|=N>>>4,N|=N>>>8,(N|=N>>>16)-(N>>>1)},Z.parity=function(N){return N^=N>>>16,N^=N>>>8,N^=N>>>4,27030>>>(N&=15)&1};var X=new Array(256);!function(N){for(var Z=0;Z<256;++Z){var d=Z,X=Z,I=7;for(d>>>=1;d;d>>>=1)X<<=1,X|=1&d,--I;N[Z]=X<<I&255}}(X),Z.reverse=function(N){return X[255&N]<<24|X[N>>>8&255]<<16|X[N>>>16&255]<<8|X[N>>>24&255]},Z.interleave2=function(N,Z){return(N=1431655765&((N=858993459&((N=252645135&((N=16711935&((N&=65535)|N<<8))|N<<4))|N<<2))|N<<1))|(Z=1431655765&((Z=858993459&((Z=252645135&((Z=16711935&((Z&=65535)|Z<<8))|Z<<4))|Z<<2))|Z<<1))<<1},Z.deinterleave2=function(N,Z){return(N=65535&((N=16711935&((N=252645135&((N=858993459&((N=N>>>Z&1431655765)|N>>>1))|N>>>2))|N>>>4))|N>>>16))<<16>>16},Z.interleave3=function(N,Z,d){return N=1227133513&((N=3272356035&((N=251719695&((N=4278190335&((N&=1023)|N<<16))|N<<8))|N<<4))|N<<2),(N|=(Z=1227133513&((Z=3272356035&((Z=251719695&((Z=4278190335&((Z&=1023)|Z<<16))|Z<<8))|Z<<4))|Z<<2))<<1)|(d=1227133513&((d=3272356035&((d=251719695&((d=4278190335&((d&=1023)|d<<16))|d<<8))|d<<4))|d<<2))<<2},Z.deinterleave3=function(N,Z){return(N=1023&((N=4278190335&((N=251719695&((N=3272356035&((N=N>>>Z&1227133513)|N>>>2))|N>>>4))|N>>>8))|N>>>16))<<22>>22},Z.nextCombination=function(N){var Z=N|N-1;return Z+1|(~Z&-~Z)-1>>>d(N)+1}},12129:(N,Z,d)=>{"use strict";d.d(Z,{c:()=>B});var X=d(11944),I=d(133);class m{constructor(N,Z,d,m,z,w,S){this.Ug=new X(N.Lc,N.xh),this.mass=Z,this.friction=d,this.restitution=m,this.wb=z,this.Kk=w,this.Db=!!S,this.wh=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.xl=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.gg=I.create(),this.Og=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=I.create(),this._impulses=I.create(),this._sleepFrameCount=10}loadFromCopy(N){I.j(this.Ug.Lc,N.Ug.Lc),I.j(this.Ug.xh,N.Ug.xh),I.j(this.Ug.max,N.Ug.max),this.Ug.mag=N.Ug.mag,this.mass=N.mass,this.friction=N.friction,this.restitution=N.restitution,this.wb=N.wb,this.Kk=N.Kk,this.Db=N.Db,this.wh=N.wh,this.fluidDrag=N.fluidDrag,this.xl=N.xl,this.preventFallOffEdge=N.preventFallOffEdge,this.rolledBackLastTick=N.rolledBackLastTick,I.j(this.gg,N.gg),I.j(this.Og,N.Og),this.inFluid=N.inFluid,this._ratioInFluid=N._ratioInFluid,I.j(this._forces,N._forces),I.j(this._impulses,N._impulses),this._sleepFrameCount=N._sleepFrameCount}setPosition(N){z(N),I.rc(N,N,this.Ug.Lc),this.Ug.translate(N),this.kg()}fb(){return I.clone(this.Ug.Lc)}applyForce(N){z(N),I.add(this._forces,this._forces,N),this.kg()}applyImpulse(N){z(N),I.add(this._impulses,this._impulses,N),this.kg()}kg(){this._sleepFrameCount=10}atRestX(){return this.Og[0]}atRestY(){return this.Og[1]}atRestZ(){return this.Og[2]}}var z=N=>{};var w=d(11944),S=d(133),e=d(11952);function j(){this.wh=.1,this.fluidDrag=.4,this.ec=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function B(N,Z,d){N=Object.assign(new j,N),this.gravity=N.gravity||[0,-10,0],this.wh=N.wh||.1,this.ec=N.ec||2,this.fluidDrag=N.fluidDrag||.4,this.minBounceImpulse=N.minBounceImpulse,this.bodies=[],this.fk=N.fk,this.testSolid=Z,this.testFluid=d}B.prototype.Rk=function(N,Z,d,X,I,z){N=N||new w([0,0,0],[1,1,1]),"undefined"==typeof Z&&(Z=1),"undefined"==typeof d&&(d=1),"undefined"==typeof X&&(X=0),"undefined"==typeof I&&(I=1);var S=new m(N,Z,d,X,I,z);return this.bodies.push(S),S},B.prototype.Sk=function(N){var Z=this.bodies.indexOf(N);Z<0||(this.bodies.splice(Z,1),N.Ug=N.Kk=null)};var D=S.create(),v=S.create(),T=S.create(),k=S.create(),h=S.create(),U=S.create(),C=S.create(),M=new w([0,0,0],[1,1,1]),Q=new m(M,1,1,0,1,(()=>{}),!1);function A(N,Z,d){return Z=d,Z*=1-(1-N.ratioInFluid)**2}B.prototype.Ye=function(N){N/=1e3;var Z=q(0,S.squaredLength(this.gravity));this.bodies.forEach((d=>function(N,Z,d,X){S.j(h,Z.Og),N.fk&&Q.loadFromCopy(Z);if(Z.mass<=0)return S.set(Z.gg,0,0,0),S.set(Z._forces,0,0,0),void S.set(Z._impulses,0,0,0);var I=X||0===Z.wb;if(function(N,Z,d,X){if(Z._sleepFrameCount>0)return!1;if(X)return!0;var I=!1,m=.5*d*d*Z.wb;return S.scale(t,N.gravity,m),e(N.testSolid,Z.Ug,t,(function(){return I=!0,!0}),!0),I}(N,Z,d,I))return;Z._sleepFrameCount--,function(N,Z){var d=Z.Ug,X=Math.floor(d.Lc[0]),I=Math.floor(d.Lc[2]),m=Math.floor(d.Lc[1]),z=Math.floor(d.max[1]);if(!N.testFluid(X,m,I))return Z.inFluid=!1,void(Z.ratioInFluid=0);var w=1,e=m+1;for(;e<=z&&N.testFluid(X,e,I);)w++,e++;var j=(m+w-d.Lc[1])/d.xh[1];j>1&&(j=1);var B=d.xh[0]*d.xh[1]*d.xh[2]*j,D=g;S.scale(D,N.gravity,-N.ec*B*Z.wb),Z.applyForce(D),Z.inFluid=!0,Z.ratioInFluid=j}(N,Z),s(Z._forces),s(Z._impulses),s(Z.gg),s(Z.Og),S.scale(D,Z._forces,1/Z.mass),S.vc(D,D,N.gravity,Z.wb),S.scale(v,Z._impulses,1/Z.mass),S.vc(v,v,D,d),S.add(Z.gg,Z.gg,v),Z.friction&&(E(N,0,Z,v,d),E(N,1,Z,v,d),E(N,2,Z,v,d));var m=Z.fluidDrag>=0?Z.fluidDrag:N.fluidDrag,z=Z.wh>=0?Z.wh:N.wh,w=z,j=z;Z.inFluid&&(w=A(Z,w,Z.fluidDragHoriz>=0?Z.fluidDragHoriz:m),j=A(Z,j,Z.fluidDragVert>=0?Z.fluidDragVert:m));w=Math.max(1-w*d/Z.mass,0),j=Math.max(1-j*d/Z.mass,0),S.set(n,w,j,w),S.multiply(Z.gg,Z.gg,n),S.scale(T,Z.gg,d),S.set(Z._forces,0,0,0),S.set(Z._impulses,0,0,0),Z.Db&&Y(K,Z.Ug);S.j(U,T),S.set(C,0,0,0),Z.preventFallOffEdge&&function(N,Z,d,X){if(!Z.Og[1]||d[1]>0)return;var I=F;Y(I,Z.Ug);for(var m=0;m<3;m+=2){S.set(J,0,0,0),J[m]=d[m];var z=!0;(z=(z=(z=(z=z&&!x(N,I.Lc[0]+J[0]+1e-5,I.Lc[1],I.Lc[2]+J[2]+1e-5))&&!x(N,I.max[0]+J[0]-1e-5,I.Lc[1],I.Lc[2]+J[2]+1e-5))&&!x(N,I.Lc[0]+J[0]+1e-5,I.Lc[1],I.max[2]+J[2]-1e-5))&&!x(N,I.max[0]+J[0]-1e-5,I.Lc[1],I.max[2]+J[2]-1e-5))?(X[m]=d[m]>0?1:-1,d[m]=0):0===m&&(S.set(G,d[0],0,0),O(N,I,G,X,Z.slideOnCollision))}}(N,Z,T,C);O(N,Z.Ug,T,Z.Og,Z.slideOnCollision),Z.Db&&function(N,Z,d,X){if(Z.Og[1]>=0&&!Z.inFluid)return;var I=0!==Z.Og[0],m=0!==Z.Og[2];if(!I&&!m)return;var z=Math.abs(X[0]/X[2]),w=4;if(!I&&z>w)return;if(!m&&z<1/w)return;S.add(P,d.Lc,X);var j=N.testSolid;e(j,d,X,(function(N,Z,d,X){if(1!==Z)return!0;X[Z]=0}));var B=d.Lc[1],D=Z.inFluid?1.951:1.001,v=Math.floor(B+D)-B;S.set(W,0,v,0);var T=!1;if(e(j,d,W,(function(N,Z,d,X){return T=!0,!0})),T)return;S.rc(b,P,d.Lc),b[1]=0,O(N,d,b,r,!0);var k=q(d.Lc[0],P[0]),h=q(d.Lc[2],P[2]);if(I&&!k&&(!h||!m))return;if(m&&(!k||!I)&&!h)return;var U=!0;if(U=U&&!x(N,d.Lc[0]+1e-5,d.Lc[1],d.Lc[2]+1e-5),U=U&&!x(N,d.max[0]-1e-5,d.Lc[1],d.Lc[2]+1e-5),U=U&&!x(N,d.Lc[0]+1e-5,d.Lc[1],d.max[2]-1e-5),U=U&&!x(N,d.max[0]-1e-5,d.Lc[1],d.max[2]-1e-5),U)return;Y(Z.Ug,d),Z.Og[0]=r[0],Z.Og[2]=r[2],Z.xl&&Z.xl()}(N,Z,K,U);for(var B=0;B<3;++B)Z.Og[B]=Z.Og[B]||C[B],k[B]=0,Z.Og[B]&&(h[B]||(k[B]=-Z.gg[B]),Z.gg[B]=0);var M=S.length(k);M>.001&&(S.scale(k,k,Z.mass),Z.Kk&&Z.Kk(k),Z.restitution>0&&M>N.minBounceImpulse&&(S.scale(k,k,Z.restitution),Z.applyImpulse(k)));var V=S.squaredLength(Z.gg);V>1e-5&&Z.kg();N.fk&&N.fk(Z)?(Z.loadFromCopy(Q),Z.rolledBackLastTick=!0):Z.rolledBackLastTick=!1}(this,d,N,Z)))};var n=S.create([0,0,0]);var g=S.create();function E(N,Z,d,X,I){var m=d.Og[Z],z=X[Z];if(!d.alwaysApplyHorizFriction||1!==Z){if(0===m)return;if(m*z<=0)return}S.j(V,d.gg),V[Z]=0;var w=S.length(V);if(!q(w,0)){var e=Math.abs(d.friction*N.gravity[Z]*I),j=w>e?(w-e)/w:0;d.gg[(Z+1)%3]*=j,d.gg[(Z+2)%3]*=j}}var V=S.create();function O(N,Z,d,X,I){return S.set(X,0,0,0),e(N.testSolid,Z,d,(function(N,Z,d,m){X[Z]=d,m[Z]=0,I||(m[0]=0,m[1]=0,m[2]=0)}))}var K=new w([],[]),r=S.create(),P=S.create(),W=S.create(),b=S.create();var J=S.create(),F=new w([],[]),G=S.create();function x(N,Z,d,X){return N.testSolid(Math.floor(Z),Math.floor(d-1),Math.floor(X))}var t=S.create();function q(N,Z){return Math.abs(N-Z)<1e-5}function Y(N,Z){for(var d=0;d<3;d++)N.Lc[d]=Z.Lc[d],N.max[d]=Z.max[d],N.xh[d]=Z.xh[d]}var s=function(N){}},11180:N=>{"use strict";N.exports=function(N,Z,d,X){var I=self||window;try{try{var m;try{m=new I.Blob([N])}catch(e){(m=new(I.BlobBuilder||I.WebKitBlobBuilder||I.MozBlobBuilder||I.MSBlobBuilder)).append(N),m=m.getBlob()}var z=I.URL||I.webkitURL,w=z.createObjectURL(m),S=new I[Z](w,d);return z.revokeObjectURL(w),S}catch(e){return new I[Z]("data:application/javascript,".concat(encodeURIComponent(N)),d)}}catch(e){if(!X)throw Error("Inline worker is not supported");return new I[Z](X,d)}}},11636:(N,Z,d)=>{"use strict";function X(N,Z,d,X,I){var m={};return Object.keys(X).forEach((function(N){m[N]=X[N]})),m.enumerable=!!m.enumerable,m.configurable=!!m.configurable,("value"in m||m.initializer)&&(m.writable=!0),m=d.slice().reverse().reduce((function(d,X){return X(N,Z,d)||d}),m),I&&void 0!==m.initializer&&(m.value=m.initializer?m.initializer.call(I):void 0,m.initializer=void 0),void 0===m.initializer&&(Object.defineProperty(N,Z,m),m=null),m}d.d(Z,{e:()=>X})},11627:(N,Z,d)=>{"use strict";function X(N,Z,d,X){d&&Object.defineProperty(N,Z,{enumerable:d.enumerable,configurable:d.configurable,writable:d.writable,value:d.initializer?d.initializer.call(X):void 0})}d.d(Z,{e:()=>X})},11715:(N,Z,d)=>{"use strict";d.d(Z,{b:()=>M,f:()=>h,i:()=>U,m:()=>D,o:()=>k,r:()=>T,t:()=>v});var X=d(960),I=d(1108),m=d(994),z=d(978),w=d(11723),S=d(11343),e=d(1088),j=d(1017),B=d(1094);const D=Object.freeze(new X.g(0,0,0,0)),v=Object.freeze(X.n.Zero()),T=Object.freeze(X.l.Zero()),k=Object.freeze(e.e.Zero()),h=Object.freeze(I.b.Black()),U=Object.freeze(new I.e(0,0,0,0)),C={key:0,repeatCount:0,loopMode:2};class M{static _PrepareAnimation(N,Z,d,m,z,w,S,j){let B;if(!isNaN(parseFloat(z))&&isFinite(z)?B=M.ANIMATIONTYPE_FLOAT:z instanceof X.g?B=M.ANIMATIONTYPE_QUATERNION:z instanceof X.n?B=M.ANIMATIONTYPE_VECTOR3:z instanceof X.l?B=M.ANIMATIONTYPE_VECTOR2:z instanceof I.b?B=M.ANIMATIONTYPE_COLOR3:z instanceof I.e?B=M.ANIMATIONTYPE_COLOR4:z instanceof e.e&&(B=M.ANIMATIONTYPE_SIZE),void 0==B)return null;const D=new M(N,Z,d,B,S),v=[{frame:0,value:z},{frame:m,value:w}];return D.setKeys(v),void 0!==j&&D.setEasingFunction(j),D}static CreateAnimation(N,Z,d,X){const I=new M(N+"Animation",N,d,Z,M.ANIMATIONLOOPMODE_CONSTANT);return I.setEasingFunction(X),I}static CreateAndStartAnimation(N,Z,d,X,I,m,z,w,S,e,j){const B=M._PrepareAnimation(N,d,X,I,m,z,w,S);return B?(Z.va&&(j=Z.va()),j?j.beginDirectAnimation(Z,[B],0,I,1===B.loopMode,1,e):null):null}static CreateAndStartHierarchyAnimation(N,Z,d,X,I,m,z,w,S,e,j){const B=M._PrepareAnimation(N,X,I,m,z,w,S,e);if(!B)return null;return Z.va().beginDirectHierarchyAnimation(Z,d,[B],0,m,1===B.loopMode,1,j)}static CreateMergeAndStartAnimation(N,Z,d,X,I,m,z,w,S,e){const j=M._PrepareAnimation(N,d,X,I,m,z,w,S);return j?(Z.animations.push(j),Z.va().beginAnimation(Z,0,I,1===j.loopMode,1,e)):null}static MakeAnimationAdditive(N,Z,d){let I;I="object"===typeof Z?Z:{referenceFrame:Z??0,range:d,cloneOriginalAnimation:arguments.length>3&&void 0!==arguments[3]&&arguments[3],clonedAnimationName:arguments.length>4?arguments[4]:void 0};let m=N;if(I.cloneOriginalAnimation&&(m=N.clone(),m.name=I.clonedAnimationName||m.name),!m._keys.length)return m;const z=I.referenceFrame&&I.referenceFrame>=0?I.referenceFrame:0;let w=0;const S=m._keys[0];let e=m._keys.length-1;const j=m._keys[e],B={referenceValue:S.value,referencePosition:X.h.kd[0],referenceQuaternion:X.h.Quaternion[0],referenceScaling:X.h.kd[1],keyPosition:X.h.kd[2],keyQuaternion:X.h.Quaternion[1],keyScaling:X.h.kd[3]};let D=S.frame,v=j.frame;if(I.range){const N=m.getRange(I.range);N&&(D=N.from,v=N.to)}else D=I.fromFrame??D,v=I.toFrame??v;if(D!==S.frame&&(w=m.createKeyForFrame(D)),v!==j.frame&&(e=m.createKeyForFrame(v)),1===m._keys.length){const N=m._getKeyValue(m._keys[0]);B.referenceValue=N.clone?N.clone():N}else if(z<=S.frame){const N=m._getKeyValue(S.value);B.referenceValue=N.clone?N.clone():N}else if(z>=j.frame){const N=m._getKeyValue(j.value);B.referenceValue=N.clone?N.clone():N}else{C.key=0;const N=m._interpolate(z,C);B.referenceValue=N.clone?N.clone():N}m.dataType===M.ANIMATIONTYPE_QUATERNION?B.referenceValue.normalize().conjugateInPlace():m.dataType===M.ANIMATIONTYPE_MATRIX&&(B.referenceValue.decompose(B.referenceScaling,B.referenceQuaternion,B.referencePosition),B.referenceQuaternion.normalize().conjugateInPlace());let T=Number.MAX_VALUE;const k=I.clipKeys?[]:null;for(let h=w;h<=e;h++){let N=m._keys[h];if((k||I.cloneOriginalAnimation)&&(N={frame:N.frame,value:N.value.clone?N.value.clone():N.value,inTangent:N.inTangent,outTangent:N.outTangent,interpolation:N.interpolation,lockedTangent:N.lockedTangent},k&&(T===Number.MAX_VALUE&&(T=N.frame),N.frame-=T,k.push(N))),!h||m.dataType===M.ANIMATIONTYPE_FLOAT||N.value!==S.value)switch(m.dataType){case M.ANIMATIONTYPE_MATRIX:N.value.decompose(B.keyScaling,B.keyQuaternion,B.keyPosition),B.keyPosition.$c(B.referencePosition),B.keyScaling.divideInPlace(B.referenceScaling),B.referenceQuaternion.multiplyToRef(B.keyQuaternion,B.keyQuaternion),X.c.ComposeToRef(B.keyScaling,B.keyQuaternion,B.keyPosition,N.value);break;case M.ANIMATIONTYPE_QUATERNION:B.referenceValue.multiplyToRef(N.value,N.value);break;case M.ANIMATIONTYPE_VECTOR2:case M.ANIMATIONTYPE_VECTOR3:case M.ANIMATIONTYPE_COLOR3:case M.ANIMATIONTYPE_COLOR4:N.value.subtractToRef(B.referenceValue,N.value);break;case M.ANIMATIONTYPE_SIZE:N.value.width-=B.referenceValue.width,N.value.height-=B.referenceValue.height;break;default:N.value-=B.referenceValue}}return k&&m.setKeys(k,!0),m}static TransitionTo(N,Z,d,X,I,m,z){let w=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;if(z<=0)return d[N]=Z,w&&w(),null;const S=I*(z/1e3);m.setKeys([{frame:0,value:d[N].clone?d[N].clone():d[N]},{frame:S,value:Z}]),d.animations||(d.animations=[]),d.animations.push(m);const e=X.beginAnimation(d,0,S,!1);return e.onAnimationEnd=w,e}get runtimeAnimations(){return this._runtimeAnimations}get hasRunningRuntimeAnimations(){for(const N of this._runtimeAnimations)if(!N.isStopped())return!0;return!1}constructor(N,Z,d,X,I,m){this.name=N,this.targetProperty=Z,this.framePerSecond=d,this.dataType=X,this.loopMode=I,this.enableBlending=m,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=Z.split("."),this.dataType=X,this.loopMode=void 0===I?M.ANIMATIONLOOPMODE_CYCLE:I,this.uniqueId=M._UniqueIdGenerator++}toString(N){let Z="Name: "+this.name+", property: "+this.targetProperty;if(Z+=", datatype: "+["Float","kd","Quaternion","Matrix","wd","Vector2"][this.dataType],Z+=", nKeys: "+(this._keys?this._keys.length:"none"),Z+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),N){Z+=", Ranges: {";let N=!0;for(const d in this._ranges)N&&(Z+=", ",N=!1),Z+=d;Z+="}"}return Z}addEvent(N){this._events.push(N),this._events.sort(((N,Z)=>N.frame-Z.frame))}removeEvents(N){for(let Z=0;Z<this._events.length;Z++)this._events[Z].frame===N&&(this._events.splice(Z,1),Z--)}getEvents(){return this._events}createRange(N,Z,d){this._ranges[N]||(this._ranges[N]=new w.d(N,Z,d))}deleteRange(N){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const d=this._ranges[N];if(d){if(Z){const N=d.from,Z=d.to;for(let d=this._keys.length-1;d>=0;d--)this._keys[d].frame>=N&&this._keys[d].frame<=Z&&this._keys.splice(d,1)}this._ranges[N]=null}}getRange(N){return this._ranges[N]}getKeys(){return this._keys}getHighestFrame(){let N=0;for(let Z=0,d=this._keys.length;Z<d;Z++)N<this._keys[Z].frame&&(N=this._keys[Z].frame);return N}getEasingFunction(){return this._easingFunction}setEasingFunction(N){this._easingFunction=N}floatInterpolateFunction(N,Z,d){return(0,m.o)(N,Z,d)}floatInterpolateFunctionWithTangents(N,Z,d,X,I){return(0,m.f)(N,Z,d,X,I)}quaternionInterpolateFunction(N,Z,d){return X.g.Slerp(N,Z,d)}quaternionInterpolateFunctionWithTangents(N,Z,d,I,m){return X.g.Hermite(N,Z,d,I,m).normalize()}vector3InterpolateFunction(N,Z,d){return X.n.Lerp(N,Z,d)}vector3InterpolateFunctionWithTangents(N,Z,d,I,m){return X.n.Hermite(N,Z,d,I,m)}vector2InterpolateFunction(N,Z,d){return X.l.Lerp(N,Z,d)}vector2InterpolateFunctionWithTangents(N,Z,d,I,m){return X.l.Hermite(N,Z,d,I,m)}sizeInterpolateFunction(N,Z,d){return e.e.Lerp(N,Z,d)}color3InterpolateFunction(N,Z,d){return I.b.Lerp(N,Z,d)}color3InterpolateFunctionWithTangents(N,Z,d,X,m){return I.b.Hermite(N,Z,d,X,m)}color4InterpolateFunction(N,Z,d){return I.e.Lerp(N,Z,d)}color4InterpolateFunctionWithTangents(N,Z,d,X,m){return I.e.Hermite(N,Z,d,X,m)}_getKeyValue(N){return"function"===typeof N?N():N}evaluate(N){return C.key=0,this._interpolate(N,C)}_interpolate(N,Z){let d=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Z.loopMode===M.ANIMATIONLOOPMODE_CONSTANT&&Z.repeatCount>0)return Z.highLimitValue.clone?Z.highLimitValue.clone():Z.highLimitValue;const X=this._keys,I=X.length;let m=Z.key;for(;m>=0&&N<X[m].frame;)--m;for(;m+1<=I-1&&N>=X[m+1].frame;)++m;if(Z.key=m,m<0)return d?void 0:this._getKeyValue(X[0].value);if(m+1>I-1)return d?void 0:this._getKeyValue(X[I-1].value);const z=X[m],w=X[m+1];if(d&&(N===z.frame||N===w.frame))return;const S=this._getKeyValue(z.value),e=this._getKeyValue(w.value);if(1===z.interpolation)return w.frame>N?S:e;const j=void 0!==z.outTangent&&void 0!==w.inTangent,B=w.frame-z.frame;let C=(N-z.frame)/B;const Q=z.easingFunction||this.getEasingFunction();switch(null!==Q&&(C=Q.ease(C)),this.dataType){case M.ANIMATIONTYPE_FLOAT:{const N=j?this.floatInterpolateFunctionWithTangents(S,z.outTangent*B,e,w.inTangent*B,C):this.floatInterpolateFunction(S,e,C);switch(Z.loopMode){case M.ANIMATIONLOOPMODE_CYCLE:case M.ANIMATIONLOOPMODE_CONSTANT:case M.ANIMATIONLOOPMODE_YOYO:return N;case M.ANIMATIONLOOPMODE_RELATIVE:case M.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return(Z.offsetValue??0)*Z.repeatCount+N}break}case M.ANIMATIONTYPE_QUATERNION:{const N=j?this.quaternionInterpolateFunctionWithTangents(S,z.outTangent.scale(B),e,w.inTangent.scale(B),C):this.quaternionInterpolateFunction(S,e,C);switch(Z.loopMode){case M.ANIMATIONLOOPMODE_CYCLE:case M.ANIMATIONLOOPMODE_CONSTANT:case M.ANIMATIONLOOPMODE_YOYO:return N;case M.ANIMATIONLOOPMODE_RELATIVE:case M.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return N.addInPlace((Z.offsetValue||D).scale(Z.repeatCount))}return N}case M.ANIMATIONTYPE_VECTOR3:{const N=j?this.vector3InterpolateFunctionWithTangents(S,z.outTangent.scale(B),e,w.inTangent.scale(B),C):this.vector3InterpolateFunction(S,e,C);switch(Z.loopMode){case M.ANIMATIONLOOPMODE_CYCLE:case M.ANIMATIONLOOPMODE_CONSTANT:case M.ANIMATIONLOOPMODE_YOYO:return N;case M.ANIMATIONLOOPMODE_RELATIVE:case M.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return N.add((Z.offsetValue||v).scale(Z.repeatCount))}break}case M.ANIMATIONTYPE_VECTOR2:{const N=j?this.vector2InterpolateFunctionWithTangents(S,z.outTangent.scale(B),e,w.inTangent.scale(B),C):this.vector2InterpolateFunction(S,e,C);switch(Z.loopMode){case M.ANIMATIONLOOPMODE_CYCLE:case M.ANIMATIONLOOPMODE_CONSTANT:case M.ANIMATIONLOOPMODE_YOYO:return N;case M.ANIMATIONLOOPMODE_RELATIVE:case M.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return N.add((Z.offsetValue||T).scale(Z.repeatCount))}break}case M.ANIMATIONTYPE_SIZE:switch(Z.loopMode){case M.ANIMATIONLOOPMODE_CYCLE:case M.ANIMATIONLOOPMODE_CONSTANT:case M.ANIMATIONLOOPMODE_YOYO:return this.sizeInterpolateFunction(S,e,C);case M.ANIMATIONLOOPMODE_RELATIVE:case M.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return this.sizeInterpolateFunction(S,e,C).add((Z.offsetValue||k).scale(Z.repeatCount))}break;case M.ANIMATIONTYPE_COLOR3:{const N=j?this.color3InterpolateFunctionWithTangents(S,z.outTangent.scale(B),e,w.inTangent.scale(B),C):this.color3InterpolateFunction(S,e,C);switch(Z.loopMode){case M.ANIMATIONLOOPMODE_CYCLE:case M.ANIMATIONLOOPMODE_CONSTANT:case M.ANIMATIONLOOPMODE_YOYO:return N;case M.ANIMATIONLOOPMODE_RELATIVE:case M.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return N.add((Z.offsetValue||h).scale(Z.repeatCount))}break}case M.ANIMATIONTYPE_COLOR4:{const N=j?this.color4InterpolateFunctionWithTangents(S,z.outTangent.scale(B),e,w.inTangent.scale(B),C):this.color4InterpolateFunction(S,e,C);switch(Z.loopMode){case M.ANIMATIONLOOPMODE_CYCLE:case M.ANIMATIONLOOPMODE_CONSTANT:case M.ANIMATIONLOOPMODE_YOYO:return N;case M.ANIMATIONLOOPMODE_RELATIVE:case M.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return N.add((Z.offsetValue||U).scale(Z.repeatCount))}break}case M.ANIMATIONTYPE_MATRIX:switch(Z.loopMode){case M.ANIMATIONLOOPMODE_CYCLE:case M.ANIMATIONLOOPMODE_CONSTANT:case M.ANIMATIONLOOPMODE_YOYO:return M.AllowMatricesInterpolation?this.matrixInterpolateFunction(S,e,C,Z.workValue):S;case M.ANIMATIONLOOPMODE_RELATIVE:case M.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return S}}return 0}matrixInterpolateFunction(N,Z,d,I){return M.AllowMatrixDecomposeForInterpolation?I?(X.c.DecomposeLerpToRef(N,Z,d,I),I):X.c.DecomposeLerp(N,Z,d):I?(X.c.LerpToRef(N,Z,d,I),I):X.c.Lerp(N,Z,d)}clone(){const N=new M(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(N.enableBlending=this.enableBlending,N.blendingSpeed=this.blendingSpeed,this._keys&&N.setKeys(this._keys),this._ranges){N._ranges={};for(const Z in this._ranges){const d=this._ranges[Z];d&&(N._ranges[Z]=d.clone())}}return N}setKeys(N){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._keys=Z?N:N.slice(0)}createKeyForFrame(N){C.key=0;const Z=this._interpolate(N,C,!0);if(!Z)return this._keys[C.key].frame===N?C.key:C.key+1;const d={frame:N,value:Z.clone?Z.clone():Z};return this._keys.splice(C.key+1,0,d),C.key+1}serialize(){const N={};N.name=this.name,N.property=this.targetProperty,N.framePerSecond=this.framePerSecond,N.dataType=this.dataType,N.loopBehavior=this.loopMode,N.enableBlending=this.enableBlending,N.blendingSpeed=this.blendingSpeed;const Z=this.dataType;N.keys=[];const d=this.getKeys();for(let X=0;X<d.length;X++){const I=d[X],m={};switch(m.frame=I.frame,Z){case M.ANIMATIONTYPE_FLOAT:m.values=[I.value],void 0!==I.inTangent&&m.values.push(I.inTangent),void 0!==I.outTangent&&(void 0===I.inTangent&&m.values.push(void 0),m.values.push(I.outTangent)),void 0!==I.interpolation&&(void 0===I.inTangent&&m.values.push(void 0),void 0===I.outTangent&&m.values.push(void 0),m.values.push(I.interpolation));break;case M.ANIMATIONTYPE_QUATERNION:case M.ANIMATIONTYPE_MATRIX:case M.ANIMATIONTYPE_VECTOR3:case M.ANIMATIONTYPE_COLOR3:case M.ANIMATIONTYPE_COLOR4:m.values=I.value.ed(),void 0!=I.inTangent&&m.values.push(I.inTangent.ed()),void 0!=I.outTangent&&(void 0===I.inTangent&&m.values.push(void 0),m.values.push(I.outTangent.ed())),void 0!==I.interpolation&&(void 0===I.inTangent&&m.values.push(void 0),void 0===I.outTangent&&m.values.push(void 0),m.values.push(I.interpolation))}N.keys.push(m)}N.ranges=[];for(const X in this._ranges){const Z=this._ranges[X];if(!Z)continue;const d={};d.name=X,d.from=Z.from,d.to=Z.to,N.ranges.push(d)}return N}static _UniversalLerp(N,Z,d){const X=N.constructor;return X.Lerp?X.Lerp(N,Z,d):X.Slerp?X.Slerp(N,Z,d):N.toFixed?N*(1-d)+d*Z:Z}static Parse(N){const Z=new M(N.name,N.property,N.framePerSecond,N.dataType,N.loopBehavior),d=N.dataType,m=[];let z,w;for(N.enableBlending&&(Z.enableBlending=N.enableBlending),N.blendingSpeed&&(Z.blendingSpeed=N.blendingSpeed),w=0;w<N.keys.length;w++){const Z=N.keys[w];let S,e,j;switch(d){case M.ANIMATIONTYPE_FLOAT:z=Z.values[0],Z.values.length>=2&&(S=Z.values[1]),Z.values.length>=3&&(e=Z.values[2]),Z.values.length>=4&&(j=Z.values[3]);break;case M.ANIMATIONTYPE_QUATERNION:if(z=X.g._c(Z.values),Z.values.length>=8){const N=X.g._c(Z.values.slice(4,8));N.equals(X.g.Zero())||(S=N)}if(Z.values.length>=12){const N=X.g._c(Z.values.slice(8,12));N.equals(X.g.Zero())||(e=N)}Z.values.length>=13&&(j=Z.values[12]);break;case M.ANIMATIONTYPE_MATRIX:z=X.c._c(Z.values),Z.values.length>=17&&(j=Z.values[16]);break;case M.ANIMATIONTYPE_COLOR3:z=I.b._c(Z.values),Z.values[3]&&(S=I.b._c(Z.values[3])),Z.values[4]&&(e=I.b._c(Z.values[4])),Z.values[5]&&(j=Z.values[5]);break;case M.ANIMATIONTYPE_COLOR4:z=I.e._c(Z.values),Z.values[4]&&(S=I.e._c(Z.values[4])),Z.values[5]&&(e=I.e._c(Z.values[5])),Z.values[6]&&(j=I.e._c(Z.values[6]));break;case M.ANIMATIONTYPE_VECTOR3:default:z=X.n._c(Z.values),Z.values[3]&&(S=X.n._c(Z.values[3])),Z.values[4]&&(e=X.n._c(Z.values[4])),Z.values[5]&&(j=Z.values[5])}const B={};B.frame=Z.frame,B.value=z,void 0!=S&&(B.inTangent=S),void 0!=e&&(B.outTangent=e),void 0!=j&&(B.interpolation=j),m.push(B)}if(Z.setKeys(m),N.ranges)for(w=0;w<N.ranges.length;w++)z=N.ranges[w],Z.createRange(z.name,z.from,z.to);return Z}static AppendSerializedAnimations(N,Z){B.c.AppendSerializedAnimations(N,Z)}static ParseFromFileAsync(N,Z){return new Promise(((d,X)=>{const I=new j.c;I.addEventListener("readystatechange",(()=>{if(4==I.readyState)if(200==I.status){let Z=JSON.parse(I.responseText);if(Z.animations&&(Z=Z.animations),Z.length){const N=[];for(const d of Z)N.push(this.Parse(d));d(N)}else{const X=this.Parse(Z);N&&(X.name=N),d(X)}}else X("Unable to load the animation")})),I.open("GET",Z),I.send()}))}static ParseFromSnippetAsync(N){return new Promise(((Z,d)=>{const X=new j.c;X.addEventListener("readystatechange",(()=>{if(4==X.readyState)if(200==X.status){const d=JSON.parse(JSON.parse(X.responseText).jsonPayload);if(d.animations){const X=JSON.parse(d.animations),I=[];for(const Z of X.animations){const d=this.Parse(Z);d.snippetId=N,I.push(d)}Z(I)}else{const X=JSON.parse(d.animation),I=this.Parse(X);I.snippetId=N,Z(I)}}else d("Unable to load the snippet "+N)})),X.open("GET",this.SnippetUrl+"/"+N.replace(/#/g,"/")),X.send()}))}}M._UniqueIdGenerator=0,M.AllowMatricesInterpolation=!1,M.AllowMatrixDecomposeForInterpolation=!0,M.SnippetUrl="https://snippet.babylonjs.com",M.ANIMATIONTYPE_FLOAT=0,M.ANIMATIONTYPE_VECTOR3=1,M.ANIMATIONTYPE_QUATERNION=2,M.ANIMATIONTYPE_MATRIX=3,M.ANIMATIONTYPE_COLOR3=4,M.ANIMATIONTYPE_COLOR4=7,M.ANIMATIONTYPE_VECTOR2=5,M.ANIMATIONTYPE_SIZE=6,M.ANIMATIONLOOPMODE_RELATIVE=0,M.ANIMATIONLOOPMODE_CYCLE=1,M.ANIMATIONLOOPMODE_CONSTANT=2,M.ANIMATIONLOOPMODE_YOYO=4,M.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT=5,M.CreateFromSnippetAsync=M.ParseFromSnippetAsync,(0,z.h)("BABYLON.Animation",M),S.e._AnimationRangeFactory=(N,Z,d)=>new w.d(N,Z,d)},11723:(N,Z,d)=>{"use strict";d.d(Z,{d:()=>X});class X{constructor(N,Z,d){this.name=N,this.from=Z,this.to=d}clone(){return new X(this.name,this.from,this.to)}}},11709:(N,Z,d)=>{"use strict";d.d(Z,{c:()=>z});var X=d(960),I=d(971),m=d(11343);class z extends m.e{get _matrix(){return this._compose(),this.Rj}set _matrix(N){(N.updateFlag!==this.Rj.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.Rj.p(N),this._markAsDirtyAndDecompose())}constructor(N,Z){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,m=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,w=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(N,Z.va(),!1),this.name=N,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=Z,this.Rj=(null===I||void 0===I?void 0:I.clone())??X.c.Identity(),this._restMatrix=m??this.Rj.clone(),this._bindMatrix=z??this.Rj.clone(),this._index=w,this._absoluteMatrix=new X.c,this._absoluteBindMatrix=new X.c,this._absoluteInverseBindMatrix=new X.c,this._finalMatrix=new X.c,Z.bones.push(this),this.setParent(d,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(N){this.setParent(N)}setParent(N){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==N){if(this.parent){const N=this.parent.children.indexOf(this);-1!==N&&this.parent.children.splice(N,1)}this._parentNode=N,this.parent&&this.parent.children.push(this),Z&&this._updateAbsoluteBindMatrices(),this.fe()}}getLocalMatrix(){return this._compose(),this.Rj}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(N){this._restMatrix.p(N)}setRestPose(N){this.setRestMatrix(N)}getBindPose(){return this.getBindMatrix()}setBindMatrix(N){this.Cd(N)}setBindPose(N){this.setBindMatrix(N)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const N=X.h.kd[0],Z=X.h.Quaternion[0],d=X.h.kd[1];this.getRestMatrix().decompose(N,Z,d),this._linkedTransformNode.position.p(d),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??X.g.Identity(),this._linkedTransformNode.rotationQuaternion.p(Z),this._linkedTransformNode.od.p(N)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(N){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=N,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.sg}set position(N){this._decompose(),this.sg.p(N),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(N){this.setRotation(N)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(N){this.setRotationQuaternion(N)}get od(){return this.getScale()}set od(N){this.setScale(N)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=X.n.Zero(),this._localRotation=X.g.Zero(),this.sg=X.n.Zero()),this.Rj.decompose(this._localScaling,this._localRotation,this.sg))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,X.c.ComposeToRef(this._localScaling,this._localRotation,this.sg,this.Rj)):this._needToCompose=!1)}Cd(N){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],d=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.p(N),Z&&this._updateAbsoluteBindMatrices(),d?this._matrix=N:this.fe()}_updateAbsoluteBindMatrices(N){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(N||(N=this._bindMatrix),this.parent?N.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.p(N),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),Z)for(let d=0;d<this.children.length;d++)this.children[d]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}fe(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.fe(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.fe(),this._needToDecompose=!0}_updatePosition(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,d=arguments.length>2?arguments[2]:void 0,I=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const m=this.getLocalMatrix();if(0==Z)I?(m.addAtIndex(12,N.x),m.addAtIndex(13,N.y),m.addAtIndex(14,N.z)):m.setTranslationFromFloats(N.x,N.y,N.z);else{let Z=null;d&&(Z=d.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const w=z._TmpMats[0],S=z._TmpVecs[0];this.parent?d&&Z?(w.p(this.parent.getAbsoluteMatrix()),w.multiplyToRef(Z,w)):w.p(this.parent.getAbsoluteMatrix()):X.c.IdentityToRef(w),I&&w.setTranslationFromFloats(0,0,0),w.invert(),X.n.TransformCoordinatesToRef(N,w,S),I?(m.addAtIndex(12,S.x),m.addAtIndex(13,S.y),m.addAtIndex(14,S.z)):m.setTranslationFromFloats(S.x,S.y,S.z)}this._markAsDirtyAndDecompose()}translate(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,d=arguments.length>2?arguments[2]:void 0;this._updatePosition(N,Z,d,!0)}setPosition(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,d=arguments.length>2?arguments[2]:void 0;this._updatePosition(N,Z,d,!1)}setAbsolutePosition(N,Z){this.setPosition(N,1,Z)}scale(N,Z,d){let I=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const m=this.getLocalMatrix(),w=z._TmpMats[0];X.c.ScalingToRef(N,Z,d,w),w.multiplyToRef(m,m),w.invert();for(const X of this.children){const I=X.getLocalMatrix();I.multiplyToRef(w,I),I.multiplyAtIndex(12,N),I.multiplyAtIndex(13,Z),I.multiplyAtIndex(14,d),X._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),I)for(const X of this.children)X.scale(N,Z,d,I)}setScale(N){this._decompose(),this._localScaling.p(N),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(N){this._decompose(),N.p(this._localScaling)}setYawPitchRoll(N,Z,d){let I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,m=arguments.length>4?arguments[4]:void 0;if(0===I){const w=z._TmpQuat;return X.g.RotationYawPitchRollToRef(N,Z,d,w),void this.setRotationQuaternion(w,I,m)}const w=z._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(w,m))return;const S=z._TmpMats[1];X.c.RotationYawPitchRollToRef(N,Z,d,S),w.multiplyToRef(S,S),this._rotateWithMatrix(S,I,m)}rotate(N,Z){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,I=arguments.length>3?arguments[3]:void 0;const m=z._TmpMats[0];m.setTranslationFromFloats(0,0,0),X.c.RotationAxisToRef(N,Z,m),this._rotateWithMatrix(m,d,I)}setAxisAngle(N,Z){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,I=arguments.length>3?arguments[3]:void 0;if(0===d){const m=z._TmpQuat;return X.g.RotationAxisToRef(N,Z,m),void this.setRotationQuaternion(m,d,I)}const m=z._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(m,I))return;const w=z._TmpMats[1];X.c.RotationAxisToRef(N,Z,w),m.multiplyToRef(w,w),this._rotateWithMatrix(w,d,I)}setRotation(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,d=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(N.y,N.x,N.z,Z,d)}setRotationQuaternion(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,d=arguments.length>2?arguments[2]:void 0;if(0===Z)return this._decompose(),this._localRotation.p(N),void this._markAsDirtyAndCompose();const I=z._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(I,d))return;const m=z._TmpMats[1];X.c.FromQuaternionToRef(N,m),I.multiplyToRef(m,m),this._rotateWithMatrix(m,Z,d)}setRotationMatrix(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,d=arguments.length>2?arguments[2]:void 0;if(0===Z){const I=z._TmpQuat;return X.g.FromRotationMatrixToRef(N,I),void this.setRotationQuaternion(I,Z,d)}const I=z._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(I,d))return;const m=z._TmpMats[1];m.p(N),I.multiplyToRef(N,m),this._rotateWithMatrix(m,Z,d)}_rotateWithMatrix(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,d=arguments.length>2?arguments[2]:void 0;const X=this.getLocalMatrix(),I=X.m[12],m=X.m[13],w=X.m[14],S=this.getParent(),e=z._TmpMats[3],j=z._TmpMats[4];S&&1==Z?(d?(e.p(d.getWorldMatrix()),S.getAbsoluteMatrix().multiplyToRef(e,e)):e.p(S.getAbsoluteMatrix()),j.p(e),j.invert(),X.multiplyToRef(e,X),X.multiplyToRef(N,X),X.multiplyToRef(j,X)):1==Z&&d?(e.p(d.getWorldMatrix()),j.p(e),j.invert(),X.multiplyToRef(e,X),X.multiplyToRef(N,X),X.multiplyToRef(j,X)):X.multiplyToRef(N,X),X.setTranslationFromFloats(I,m,w),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(N,Z){const d=z._TmpMats[2];return N.p(this.getAbsoluteMatrix()),Z?(N.multiplyToRef(Z.getWorldMatrix(),N),X.c.ScalingToRef(Z.od.x,Z.od.y,Z.od.z,d)):X.c.IdentityToRef(d),N.invert(),!isNaN(N.m[0])&&(d.multiplyAtIndex(0,this._scalingDeterminant),N.multiplyToRef(d,N),!0)}fb(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const d=X.n.Zero();return this.getPositionToRef(N,Z,d),d}getPositionToRef(){let N=arguments.length>1?arguments[1]:void 0,Z=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const N=this.getLocalMatrix();Z.x=N.m[12],Z.y=N.m[13],Z.z=N.m[14]}else{let d=null;N&&(d=N.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let X=z._TmpMats[0];N&&d?(X.p(this.getAbsoluteMatrix()),X.multiplyToRef(d,X)):X=this.getAbsoluteMatrix(),Z.x=X.m[12],Z.y=X.m[13],Z.z=X.m[14]}}getAbsolutePosition(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const Z=X.n.Zero();return this.getPositionToRef(1,N,Z),Z}getAbsolutePositionToRef(N,Z){this.getPositionToRef(1,N,Z)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.Rj.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.p(this.Rj);const N=this._skeleton.getPoseMatrix();N&&this._absoluteMatrix.multiplyToRef(N,this._absoluteMatrix)}const N=this.children,Z=N.length;for(let d=0;d<Z;d++)N[d].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}bf(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const d=X.n.Zero();return this.getDirectionToRef(N,Z,d),d}getDirectionToRef(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,d=arguments.length>2?arguments[2]:void 0,I=null;Z&&(I=Z.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const m=z._TmpMats[0];m.p(this.getAbsoluteMatrix()),Z&&I&&m.multiplyToRef(I,m),X.n.TransformNormalToRef(N,m,d),d.normalize()}getRotation(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const d=X.n.Zero();return this.getRotationToRef(N,Z,d),d}getRotationToRef(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,d=arguments.length>2?arguments[2]:void 0;const X=z._TmpQuat;this.getRotationQuaternionToRef(N,Z,X),X.toEulerAnglesToRef(d)}getRotationQuaternion(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const d=X.g.Identity();return this.getRotationQuaternionToRef(N,Z,d),d}getRotationQuaternionToRef(){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Z=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),Z.p(this._localRotation);else{const d=z._TmpMats[0],X=this.getAbsoluteMatrix();N?X.multiplyToRef(N.getWorldMatrix(),d):d.p(X),d.multiplyAtIndex(0,this._scalingDeterminant),d.multiplyAtIndex(1,this._scalingDeterminant),d.multiplyAtIndex(2,this._scalingDeterminant),d.decompose(void 0,Z,void 0)}}getRotationMatrix(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Z=arguments.length>1?arguments[1]:void 0;const d=X.c.Identity();return this.getRotationMatrixToRef(N,Z,d),d}getRotationMatrixToRef(){let N=arguments.length>1?arguments[1]:void 0,Z=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(Z);else{const d=z._TmpMats[0],X=this.getAbsoluteMatrix();N?X.multiplyToRef(N.getWorldMatrix(),d):d.p(X),d.multiplyAtIndex(0,this._scalingDeterminant),d.multiplyAtIndex(1,this._scalingDeterminant),d.multiplyAtIndex(2,this._scalingDeterminant),d.getRotationMatrixToRef(Z)}}getAbsolutePositionFromLocal(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const d=X.n.Zero();return this.getAbsolutePositionFromLocalToRef(N,Z,d),d}getAbsolutePositionFromLocalToRef(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,d=arguments.length>2?arguments[2]:void 0,I=null;Z&&(I=Z.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const m=z._TmpMats[0];m.p(this.getAbsoluteMatrix()),Z&&I&&m.multiplyToRef(I,m),X.n.TransformCoordinatesToRef(N,m,d)}getLocalPositionFromAbsolute(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const d=X.n.Zero();return this.getLocalPositionFromAbsoluteToRef(N,Z,d),d}getLocalPositionFromAbsoluteToRef(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,d=arguments.length>2?arguments[2]:void 0,I=null;Z&&(I=Z.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const m=z._TmpMats[0];m.p(this.getAbsoluteMatrix()),Z&&I&&m.multiplyToRef(I,m),m.invert(),X.n.TransformCoordinatesToRef(N,m,d)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}}z._TmpVecs=(0,I.c)(2,X.n.Zero),z._TmpQuat=X.g.Identity(),z._TmpMats=(0,I.c)(5,X.c.Identity)},12042:(N,Z,d)=>{"use strict";d.d(Z,{e:()=>b});var X=d(942),I=d(949),m=d(958),z=d(960),w=d(11343),S=d(11321),e=d(1199),j=d(1077),B=d(966);class D{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(N){this._zoomStopsAnimation=N}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(N){this._idleRotationSpeed=N}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(N){this._idleRotationWaitTime=N}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(N){this._idleRotationSpinupTime=N}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(N){this._attachedCamera=N;const Z=this._attachedCamera.va();this._onPrePointerObservableObserver=Z.onPrePointerObservable.add((N=>{N.type!==e.d.POINTERDOWN?N.type===e.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=N.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const N=j.d.Now;let Z=0;null!=this._lastFrameTime&&(Z=N-this._lastFrameTime),this._lastFrameTime=N,this._applyUserInteraction();const d=N-this._lastInteractionTime-this._idleRotationWaitTime,X=Math.max(Math.min(d/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*X,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(Z/1e3))}))}detach(){if(!this._attachedCamera)return;const N=this._attachedCamera.va();this._onPrePointerObservableObserver&&N.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(N){this._lastInteractionTime=N??j.d.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<B.b}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let N=!1;return this._lastFrameRadius===this._attachedCamera.i&&0!==this._attachedCamera.inertialRadiusOffset&&(N=!0),this._lastFrameRadius=this._attachedCamera.i,this._zoomStopsAnimation?N:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=j.d.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}d(1395);class v{constructor(){this._easingMode=v.EASINGMODE_EASEIN}setEasingMode(N){const Z=Math.min(Math.max(N,0),2);this._easingMode=Z}getEasingMode(){return this._easingMode}easeInCore(N){throw new Error("You must implement this method")}ease(N){switch(this._easingMode){case v.EASINGMODE_EASEIN:return this.easeInCore(N);case v.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-N)}return N>=.5?.5*(1-this.easeInCore(2*(1-N)))+.5:.5*this.easeInCore(2*N)}}v.EASINGMODE_EASEIN=0,v.EASINGMODE_EASEOUT=1,v.EASINGMODE_EASEINOUT=2;var T=d(11715);class k{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(N){if(this._autoTransitionRange===N)return;this._autoTransitionRange=N;const Z=this._attachedCamera;Z&&(N?this._onMeshTargetChangedObserver=Z.onMeshTargetChangedObservable.add((N=>{if(N&&(N.be(!0),N.getBoundingInfo)){const Z=N.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*Z,this.upperRadiusTransitionRange=.05*Z}})):this._onMeshTargetChangedObserver&&Z.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(N){this._attachedCamera=N,this._onAfterCheckInputsObserver=N.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(N){return!!this._attachedCamera&&(this._attachedCamera.i===N&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(N){if(!this._attachedCamera)return;this._radiusBounceTransition||(k.EasingFunction.setEasingMode(k.EasingMode),this._radiusBounceTransition=T.b.CreateAnimation("i",T.b.ANIMATIONTYPE_FLOAT,60,k.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const Z=T.b.TransitionTo("i",this._attachedCamera.i+N,this._attachedCamera,this._attachedCamera.va(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));Z&&this._animatables.push(Z)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}k.EasingFunction=new class extends v{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=N}easeInCore(N){const Z=Math.max(0,this.amplitude);return Math.pow(N,3)-N*Z*Math.sin(3.141592653589793*N)}}(.3),k.EasingMode=v.EASINGMODE_EASEOUT;class h{constructor(){this.onTargetFramingAnimationEndObservable=new m.d,this._mode=h.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(N){this._mode=N}get mode(){return this._mode}set radiusScale(N){this._radiusScale=N}get radiusScale(){return this._radiusScale}set positionScale(N){this._positionScale=N}get positionScale(){return this._positionScale}set defaultElevation(N){this._defaultElevation=N}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(N){this._elevationReturnTime=N}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(N){this._elevationReturnWaitTime=N}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(N){this._zoomStopsAnimation=N}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(N){this._framingTime=N}get framingTime(){return this._framingTime}init(){}attach(N){this._attachedCamera=N;const Z=this._attachedCamera.va();h.EasingFunction.setEasingMode(h.EasingMode),this._onPrePointerObservableObserver=Z.onPrePointerObservable.add((N=>{N.type!==e.d.POINTERDOWN?N.type===e.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=N.onMeshTargetChangedObservable.add((N=>{N&&N.getBoundingInfo&&this.zoomOnMesh(N,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=N.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const N=this._attachedCamera.va();this._onPrePointerObservableObserver&&N.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(N){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;N.be(!0);const X=N.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(X.minimumWorld,X.maximumWorld,Z,d)}zoomOnMeshHierarchy(N){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;N.be(!0);const X=N.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(X.min,X.max,Z,d)}zoomOnMeshesHierarchy(N){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const X=new z.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),I=new z.n(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let m=0;m<N.length;m++){const Z=N[m].getHierarchyBoundingVectors(!0);z.n.CheckExtends(Z.min,X,I),z.n.CheckExtends(Z.max,X,I)}this.zoomOnBoundingInfo(X,I,Z,d)}zoomOnBoundingInfo(N,Z){let d,X=arguments.length>2&&void 0!==arguments[2]&&arguments[2],I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const m=N.y,w=m+(Z.y-m)*this._positionScale,S=Z.rc(N).scale(.5);if(X)d=new z.n(0,w,0);else{const Z=N.add(S);d=new z.n(Z.x,w,Z.z)}this._vectorTransition||(this._vectorTransition=T.b.CreateAnimation("target",T.b.ANIMATIONTYPE_VECTOR3,60,h.EasingFunction)),this._betaIsAnimating=!0;let e=T.b.TransitionTo("target",d,this._attachedCamera,this._attachedCamera.va(),60,this._vectorTransition,this._framingTime);e&&this._animatables.push(e);let j=0;if(this._mode===h.FitFrustumSidesMode){const d=this._calculateLowerRadiusFromModelBoundingSphere(N,Z);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=S.length()+this._attachedCamera.gj),j=d}else this._mode===h.IgnoreBoundsSizeMode&&(j=this._calculateLowerRadiusFromModelBoundingSphere(N,Z),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.gj));if(this.autoCorrectCameraLimitsAndSensibility){const d=Z.rc(N).length();this._attachedCamera.panningSensibility=5e3/d,this._attachedCamera.wheelPrecision=100/j}return this._radiusTransition||(this._radiusTransition=T.b.CreateAnimation("i",T.b.ANIMATIONTYPE_FLOAT,60,h.EasingFunction)),e=T.b.TransitionTo("i",j,this._attachedCamera,this._attachedCamera.va(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),I&&I(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),e&&this._animatables.push(e),!0}_calculateLowerRadiusFromModelBoundingSphere(N,Z){const d=this._attachedCamera;if(!d)return 0;let X=d._calculateLowerRadiusFromModelBoundingSphere(N,Z,this._radiusScale);return d.lowerRadiusLimit&&this._mode===h.IgnoreBoundsSizeMode&&(X=X<d.lowerRadiusLimit?d.lowerRadiusLimit:X),d.upperRadiusLimit&&(X=X>d.upperRadiusLimit?d.upperRadiusLimit:X),X}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const N=j.d.Now-this._lastInteractionTime,Z=.5*Math.PI-this._defaultElevation,d=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>d&&N>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=T.b.CreateAnimation("beta",T.b.ANIMATIONTYPE_FLOAT,60,h.EasingFunction));const N=T.b.TransitionTo("beta",Z,this._attachedCamera,this._attachedCamera.va(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));N&&this._animatables.push(N)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=j.d.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}h.EasingFunction=new class extends v{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=N}easeInCore(N){return this.exponent<=0?N:(Math.exp(this.exponent*N)-1)/(Math.exp(this.exponent)-1)}},h.EasingMode=v.EASINGMODE_EASEINOUT,h.IgnoreBoundsSizeMode=0,h.FitFrustumSidesMode=1;var U=d(11335),C=d(11693),M=d(11702),Q=d(1133);class A{constructor(){this._currentActiveButton=-1,this.buttons=[0,1,2]}attachControl(N){N=Q.g.BackCompatCameraNoPreventDefault(arguments);const Z=this.camera.getEngine(),d=Z.getInputElement();let X=0,I=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=m=>{var z,w;const S=m.event,j="touch"===S.pointerType;if(m.type!==e.d.POINTERMOVE&&-1===this.buttons.indexOf(S.button))return;const B=S.target;if(this._altKey=S.altKey,this._ctrlKey=S.ctrlKey,this._metaKey=S.metaKey,this._shiftKey=S.shiftKey,this._buttonsPressed=S.buttons,Z.isPointerLock){const N=S.movementX,Z=S.movementY;this.onTouch(null,N,Z),this._pointA=null,this._pointB=null}else{if(m.type!==e.d.POINTERDOWN&&m.type!==e.d.POINTERDOUBLETAP&&j&&(null===(z=this._pointA)||void 0===z?void 0:z.pointerId)!==S.pointerId&&(null===(w=this._pointB)||void 0===w?void 0:w.pointerId)!==S.pointerId)return;if(m.type!==e.d.POINTERDOWN||-1!==this._currentActiveButton&&!j)if(m.type===e.d.POINTERDOUBLETAP)this.onDoubleTap(S.pointerType);else if(m.type!==e.d.POINTERUP||this._currentActiveButton!==S.button&&!j){if(m.type===e.d.POINTERMOVE)if(N||S.preventDefault(),this._pointA&&null===this._pointB){const N=S.clientX-this._pointA.x,Z=S.clientY-this._pointA.y;this._pointA.x=S.clientX,this._pointA.y=S.clientY,this.onTouch(this._pointA,N,Z)}else if(this._pointA&&this._pointB){const N=this._pointA.pointerId===S.pointerId?this._pointA:this._pointB;N.x=S.clientX,N.y=S.clientY;const Z=this._pointA.x-this._pointB.x,d=this._pointA.y-this._pointB.y,z=Z*Z+d*d,w={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:S.pointerId,type:m.type};this.onMultiTouch(this._pointA,this._pointB,X,z,I,w),I=w,X=z}}else{try{null===B||void 0===B||B.releasePointerCapture(S.pointerId)}catch(D){}j||(this._pointB=null),Z._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==S.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==S.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==X||I)&&(this.onMultiTouch(this._pointA,this._pointB,X,0,I,null),X=0,I=null),this._currentActiveButton=-1,this.onButtonUp(S),N||S.preventDefault()}else{try{null===B||void 0===B||B.setPointerCapture(S.pointerId)}catch(D){}if(null===this._pointA)this._pointA={x:S.clientX,y:S.clientY,pointerId:S.pointerId,type:S.pointerType};else{if(null!==this._pointB)return;this._pointB={x:S.clientX,y:S.clientY,pointerId:S.pointerId,type:S.pointerType}}-1!==this._currentActiveButton||j||(this._currentActiveButton=S.button),this.onButtonDown(S),N||(S.preventDefault(),d&&d.focus())}}},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,e.d.POINTERDOWN|e.d.POINTERUP|e.d.POINTERMOVE|e.d.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,X=0,I=null,this.onLostFocus()},this._contextMenuBind=N=>this.onContextMenu(N),d&&d.addEventListener("contextmenu",this._contextMenuBind,!1);const m=this.camera.va().getEngine().getHostWindow();m&&Q.g.RegisterTopRootEvents(m,[{name:"blur",handler:this._onLostFocus}])}Gd(){if(this._onLostFocus){const N=this.camera.va().getEngine().getHostWindow();N&&Q.g.UnregisterTopRootEvents(N,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const N=this.camera.va().getEngine().getInputElement();N&&N.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentActiveButton=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(N){}onTouch(N,Z,d){}onMultiTouch(N,Z,d,X,I,m){}onContextMenu(N){N.preventDefault()}onButtonDown(N){}onButtonUp(N){}onLostFocus(){}}(0,X.d)([(0,I.I)()],A.prototype,"buttons",void 0);class n extends A{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(N,Z){if(0!==this.panningSensibility&&N&&Z){const d=Z.x-N.x,X=Z.y-N.y;this.camera.inertialPanningX+=-d/this.panningSensibility,this.camera.inertialPanningY+=X/this.panningSensibility}}_computePinchZoom(N,Z){const d=this.camera.i||n.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.i=d*Math.sqrt(N)/Math.sqrt(Z):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(Z-N)*d*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(Z-N)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(N,Z,d){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-Z/this.panningSensibility,this.camera.inertialPanningY+=d/this.panningSensibility):(this.camera.inertialAlphaOffset-=Z/this.angularSensibilityX,this.camera.inertialBetaOffset-=d/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(N,Z,d,X,I,m){0===d&&null===I||0===X&&null===m||(this.multiTouchPanAndZoom?(this._computePinchZoom(d,X),this._computeMultiTouchPanning(I,m)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(X)-Math.sqrt(d))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(d,X),this._isPinching=!0):this._computeMultiTouchPanning(I,m)):this.multiTouchPanning?this._computeMultiTouchPanning(I,m):this.pinchZoom&&this._computePinchZoom(d,X))}onButtonDown(N){this._isPanClick=N.button===this.camera._panningMouseButton}onButtonUp(N){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}n.MinimumRadiusForPinch=.001,(0,X.d)([(0,I.I)()],n.prototype,"buttons",void 0),(0,X.d)([(0,I.I)()],n.prototype,"angularSensibilityX",void 0),(0,X.d)([(0,I.I)()],n.prototype,"angularSensibilityY",void 0),(0,X.d)([(0,I.I)()],n.prototype,"pinchPrecision",void 0),(0,X.d)([(0,I.I)()],n.prototype,"pinchDeltaPercentage",void 0),(0,X.d)([(0,I.I)()],n.prototype,"useNaturalPinchZoom",void 0),(0,X.d)([(0,I.I)()],n.prototype,"pinchZoom",void 0),(0,X.d)([(0,I.I)()],n.prototype,"panningSensibility",void 0),(0,X.d)([(0,I.I)()],n.prototype,"multiTouchPanning",void 0),(0,X.d)([(0,I.I)()],n.prototype,"multiTouchPanAndZoom",void 0),M.b.ArcRotateCameraPointersInput=n;var g=d(1206);class E{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(N){N=Q.g.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((Z=>{const d=Z.event;if(!d.metaKey)if(Z.type===g.d.KEYDOWN){if(this._ctrlPressed=d.ctrlKey,this._altPressed=d.altKey,-1!==this.keysUp.indexOf(d.keyCode)||-1!==this.keysDown.indexOf(d.keyCode)||-1!==this.keysLeft.indexOf(d.keyCode)||-1!==this.keysRight.indexOf(d.keyCode)||-1!==this.keysReset.indexOf(d.keyCode)){-1===this._keys.indexOf(d.keyCode)&&this._keys.push(d.keyCode),d.preventDefault&&(N||d.preventDefault())}}else if(-1!==this.keysUp.indexOf(d.keyCode)||-1!==this.keysDown.indexOf(d.keyCode)||-1!==this.keysLeft.indexOf(d.keyCode)||-1!==this.keysRight.indexOf(d.keyCode)||-1!==this.keysReset.indexOf(d.keyCode)){const Z=this._keys.indexOf(d.keyCode);Z>=0&&this._keys.splice(Z,1),d.preventDefault&&(N||d.preventDefault())}})))}Gd(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const N=this.camera;for(let Z=0;Z<this._keys.length;Z++){const d=this._keys[Z];-1!==this.keysLeft.indexOf(d)?this._ctrlPressed&&this.camera._useCtrlForPanning?N.inertialPanningX-=1/this.panningSensibility:N.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(d)?this._ctrlPressed&&this.camera._useCtrlForPanning?N.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?N.inertialRadiusOffset+=1/this.zoomingSensibility:N.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(d)?this._ctrlPressed&&this.camera._useCtrlForPanning?N.inertialPanningX+=1/this.panningSensibility:N.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(d)?this._ctrlPressed&&this.camera._useCtrlForPanning?N.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?N.inertialRadiusOffset-=1/this.zoomingSensibility:N.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(d)&&N.useInputToRestoreState&&N.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,X.d)([(0,I.I)()],E.prototype,"keysUp",void 0),(0,X.d)([(0,I.I)()],E.prototype,"keysDown",void 0),(0,X.d)([(0,I.I)()],E.prototype,"keysLeft",void 0),(0,X.d)([(0,I.I)()],E.prototype,"keysRight",void 0),(0,X.d)([(0,I.I)()],E.prototype,"keysReset",void 0),(0,X.d)([(0,I.I)()],E.prototype,"panningSensibility",void 0),(0,X.d)([(0,I.I)()],E.prototype,"zoomingSensibility",void 0),(0,X.d)([(0,I.I)()],E.prototype,"useAltToZoom",void 0),(0,X.d)([(0,I.I)()],E.prototype,"angularSpeed",void 0),M.b.ArcRotateCameraKeyboardMoveInput=E;var V=d(1116),O=d(1211),K=d(994);class r{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new z.n(0,0,0),this._globalOffset=new z.n(0,0,0),this._inertialPanning=z.n.Zero()}_computeDeltaFromMouseWheelLegacyEvent(N,Z){let d=0;const X=.01*N*this.wheelDeltaPercentage*Z;return d=N>0?X/(1+this.wheelDeltaPercentage):X*(1+this.wheelDeltaPercentage),d}attachControl(N){N=Q.g.BackCompatCameraNoPreventDefault(arguments),this._wheel=Z=>{if(Z.type!==e.d.POINTERWHEEL)return;const d=Z.event;let X=0;const I=d.deltaMode===O.c.DOM_DELTA_LINE?40:1,m=-d.deltaY*I;if(this.customComputeDeltaFromMouseWheel)X=this.customComputeDeltaFromMouseWheel(m,this,d);else if(this.wheelDeltaPercentage){if(X=this._computeDeltaFromMouseWheelLegacyEvent(m,this.camera.i),X>0){let N=this.camera.i,Z=this.camera.inertialRadiusOffset+X;for(let d=0;d<20&&Math.abs(Z)>.001;d++)N-=Z,Z*=this.camera.inertia;N=(0,K.e)(N,0,Number.MAX_VALUE),X=this._computeDeltaFromMouseWheelLegacyEvent(m,N)}}else X=m/(40*this.wheelPrecision);X&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(X)):this.camera.inertialRadiusOffset+=X),d.preventDefault&&(N||d.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,e.d.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.hd(0)}Gd(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const N=this.camera;0+N.inertialAlphaOffset+N.inertialBetaOffset+N.inertialRadiusOffset&&(this._updateHitPlane(),N.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(N.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const N=this.camera,Z=N.target.rc(N.position);this._hitPlane=V.b.FromPositionAndNormal(N.target,Z)}_getPosition(){const N=this.camera,Z=N.va(),d=Z.createPickingRay(Z.pointerX,Z.pointerY,z.c.Identity(),N,!1);0===N.targetScreenOffset.x&&0===N.targetScreenOffset.y||(this._viewOffset.set(N.targetScreenOffset.x,N.targetScreenOffset.y,0),N.getViewMatrix().invertToRef(N._cameraTransformMatrix),this._globalOffset=z.n.TransformNormal(this._viewOffset,N._cameraTransformMatrix),d.origin.addInPlace(this._globalOffset));let X=0;return this._hitPlane&&(X=d.intersectsPlane(this._hitPlane)??0),d.origin.addInPlace(d.direction.scaleInPlace(X))}_zoomToMouse(N){const Z=this.camera,d=1-Z.inertia;if(Z.lowerRadiusLimit){const X=Z.lowerRadiusLimit??0;Z.i-(Z.inertialRadiusOffset+N)/d<X&&(N=(Z.i-X)*d-Z.inertialRadiusOffset)}if(Z.upperRadiusLimit){const X=Z.upperRadiusLimit??0;Z.i-(Z.inertialRadiusOffset+N)/d>X&&(N=(Z.i-X)*d-Z.inertialRadiusOffset)}const X=N/d/Z.i,I=this._getPosition(),m=z.h.kd[6];I.subtractToRef(Z.target,m),m.scaleInPlace(X),m.scaleInPlace(d),this._inertialPanning.addInPlace(m),Z.inertialRadiusOffset+=N}_zeroIfClose(N){Math.abs(N.x)<B.b&&(N.x=0),Math.abs(N.y)<B.b&&(N.y=0),Math.abs(N.z)<B.b&&(N.z=0)}}(0,X.d)([(0,I.I)()],r.prototype,"wheelPrecision",void 0),(0,X.d)([(0,I.I)()],r.prototype,"zoomToMouseLocation",void 0),(0,X.d)([(0,I.I)()],r.prototype,"wheelDeltaPercentage",void 0),M.b.ArcRotateCameraMouseWheelInput=r;class P extends M.e{constructor(N){super(N)}addMouseWheel(){return this.add(new r),this}addPointers(){return this.add(new n),this}addKeyboard(){return this.add(new E),this}}var W=d(978);w.e.AddNodeConstructor("ArcRotateCamera",((N,Z)=>()=>new b(N,0,0,1,z.n.Zero(),Z)));class b extends C.c{get target(){return this._target}set target(N){this.setTarget(N)}get targetHost(){return this._targetHost}set targetHost(N){N&&this.setTarget(N)}getTarget(){return this.target}get position(){return this._position}set position(N){this.setPosition(N)}set upVector(N){this._upToYMatrix||(this._yToUpMatrix=new z.c,this._upToYMatrix=new z.c,this._upVector=z.n.Zero()),N.normalize(),this._upVector.p(N),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){z.c.RotationAlignToRef(z.n.UpReadOnly,this._upVector,this._yToUpMatrix),z.c.RotationAlignToRef(this._upVector,z.n.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const N=this.inputs.attached.pointers;return N?N.angularSensibilityX:0}set angularSensibilityX(N){const Z=this.inputs.attached.pointers;Z&&(Z.angularSensibilityX=N)}get angularSensibilityY(){const N=this.inputs.attached.pointers;return N?N.angularSensibilityY:0}set angularSensibilityY(N){const Z=this.inputs.attached.pointers;Z&&(Z.angularSensibilityY=N)}get pinchPrecision(){const N=this.inputs.attached.pointers;return N?N.pinchPrecision:0}set pinchPrecision(N){const Z=this.inputs.attached.pointers;Z&&(Z.pinchPrecision=N)}get pinchDeltaPercentage(){const N=this.inputs.attached.pointers;return N?N.pinchDeltaPercentage:0}set pinchDeltaPercentage(N){const Z=this.inputs.attached.pointers;Z&&(Z.pinchDeltaPercentage=N)}get useNaturalPinchZoom(){const N=this.inputs.attached.pointers;return!!N&&N.useNaturalPinchZoom}set useNaturalPinchZoom(N){const Z=this.inputs.attached.pointers;Z&&(Z.useNaturalPinchZoom=N)}get panningSensibility(){const N=this.inputs.attached.pointers;return N?N.panningSensibility:0}set panningSensibility(N){const Z=this.inputs.attached.pointers;Z&&(Z.panningSensibility=N)}get keysUp(){const N=this.inputs.attached.keyboard;return N?N.keysUp:[]}set keysUp(N){const Z=this.inputs.attached.keyboard;Z&&(Z.keysUp=N)}get keysDown(){const N=this.inputs.attached.keyboard;return N?N.keysDown:[]}set keysDown(N){const Z=this.inputs.attached.keyboard;Z&&(Z.keysDown=N)}get keysLeft(){const N=this.inputs.attached.keyboard;return N?N.keysLeft:[]}set keysLeft(N){const Z=this.inputs.attached.keyboard;Z&&(Z.keysLeft=N)}get keysRight(){const N=this.inputs.attached.keyboard;return N?N.keysRight:[]}set keysRight(N){const Z=this.inputs.attached.keyboard;Z&&(Z.keysRight=N)}get wheelPrecision(){const N=this.inputs.attached.mousewheel;return N?N.wheelPrecision:0}set wheelPrecision(N){const Z=this.inputs.attached.mousewheel;Z&&(Z.wheelPrecision=N)}get zoomToMouseLocation(){const N=this.inputs.attached.mousewheel;return!!N&&N.zoomToMouseLocation}set zoomToMouseLocation(N){const Z=this.inputs.attached.mousewheel;Z&&(Z.zoomToMouseLocation=N)}get wheelDeltaPercentage(){const N=this.inputs.attached.mousewheel;return N?N.wheelDeltaPercentage:0}set wheelDeltaPercentage(N){const Z=this.inputs.attached.mousewheel;Z&&(Z.wheelDeltaPercentage=N)}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(N){N!==this.useBouncingBehavior&&(N?(this._bouncingBehavior=new k,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(N){N!==this.useFramingBehavior&&(N?(this._framingBehavior=new h,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(N){N!==this.useAutoRotationBehavior&&(N?(this._autoRotationBehavior=new D,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(N,Z,d,X,I,w){var S;let e=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(N,z.n.Zero(),w,e),S=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=z.n.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=z.l.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._viewMatrix=new z.c,this.panningAxis=new z.n(1,1,0),this._transformedDirection=new z.n,this.mapPanning=!1,this._progressiveRestore=!1,this.onMeshTargetChangedObservable=new m.d,this.checkCollisions=!1,this.collisionRadius=new z.n(.5,.5,.5),this._previousPosition=z.n.Zero(),this._collisionVelocity=z.n.Zero(),this._newPosition=z.n.Zero(),this._computationVector=z.n.Zero(),this._onCollisionPositionChange=function(N,Z){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;d?(S.setPosition(Z),S.Kk&&S.Kk(d)):S._previousPosition.p(S._position);const X=Math.cos(S.alpha),I=Math.sin(S.alpha),m=Math.cos(S.beta);let z=Math.sin(S.beta);0===z&&(z=1e-4);const w=S._getTargetPosition();S._computationVector.fd(S.i*X*z,S.i*m,S.i*I*z),w.addToRef(S._computationVector,S._newPosition),S._position.p(S._newPosition);let e=S.upVector;S.allowUpsideDown&&S.beta<0&&(e=e.clone(),e=e.negate()),S._computeViewMatrix(S._position,w,e),S._viewMatrix.addAtIndex(12,S.targetScreenOffset.x),S._viewMatrix.addAtIndex(13,S.targetScreenOffset.y),S._collisionTriggered=!1},this._target=z.n.Zero(),I&&this.setTarget(I),this.alpha=Z,this.beta=d,this.i=X,this.getViewMatrix(),this.inputs=new P(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new z.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.i=void 0,this._cache.targetScreenOffset=z.l.Zero()}_updateCache(N){N||super._updateCache(),this._cache._target.p(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.i=this.i,this._cache.targetScreenOffset.p(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const N=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?N.addToRef(this._targetBoundingCenter,this._target):this._target.p(N)}const N=this._getLockedTargetPosition();return N||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.i,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>B.b&&this.restoreStateInterpolationFactor<1?(this._progressiveRestore=!0,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.i=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.i===this.i&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(N,Z){let d=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const I=arguments;Z=Q.g.BackCompatCameraNoPreventDefault(I),this._useCtrlForPanning=d,this._panningMouseButton=X,"boolean"===typeof I[0]&&(I.length>1&&(this._useCtrlForPanning=I[1]),I.length>2&&(this._panningMouseButton=I[2])),this.inputs.attachElement(Z),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}Gd(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),this._progressiveRestore){const N=this._scene.getEngine().getDeltaTime()/1e3,Z=1-Math.pow(2,-N/this.restoreStateInterpolationFactor);this.setTarget(z.n.Lerp(this.getTarget(),this._storedTarget,Z)),z.g.RotationAlphaBetaGammaToRef(this._storedAlpha,this._storedBeta,0,z.h.Quaternion[0]),z.g.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,z.h.Quaternion[1]),z.g.SlerpToRef(z.h.Quaternion[1],z.h.Quaternion[0],Z,z.h.Quaternion[2]),z.h.Quaternion[2].normalize(),z.h.Quaternion[2].toAlphaBetaGammaToRef(z.h.kd[0]),this.alpha=z.h.kd[0].x,this.beta=z.h.kd[0].y,this.i+=(this._storedRadius-this.i)*Z,z.l.LerpToRef(this.targetScreenOffset,this._storedTargetScreenOffset,Z,this.targetScreenOffset),(z.n.DistanceSquared(this.getTarget(),this._storedTarget)<B.b&&z.h.Quaternion[2].equalsWithEpsilon(z.h.Quaternion[0])&&Math.pow(this._storedRadius-this.i,2)<B.b&&z.l.Distance(this.targetScreenOffset,this._storedTargetScreenOffset)<B.b||0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset||0!==this.inertialPanningX||0!==this.inertialPanningY)&&(this._progressiveRestore=!1)}if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){const N=this.invertRotation?-1:1,Z=this._calculateHandednessMultiplier();let d=this.inertialAlphaOffset*Z;this.beta<0&&(d*=-1),this.alpha+=d*N,this.beta+=this.inertialBetaOffset*N,this.i-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<B.b&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<B.b&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*B.b&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){const N=new z.n(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),N.multiplyInPlace(this.panningAxis),z.n.TransformNormalToRef(N,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const N=this.upVector,Z=z.n.CrossToRef(this._transformedDirection,N,this._transformedDirection);z.n.CrossToRef(N,Z,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);z.n.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.p(this._transformedDirection)}else{if(this.parent){const N=z.h.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(N),N.transposeToRef(N),z.n.TransformCoordinatesToRef(this._transformedDirection,N,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*B.b&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*B.b&&(this.inertialPanningY=0)}this._checkLimits(),super._checkInputs()}}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.i<this.lowerRadiusLimit&&(this.i=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.i>this.upperRadiusLimit&&(this.i=this.upperRadiusLimit,this.inertialRadiusOffset=0)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||z.n.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.i=this._computationVector.length(),0===this.i&&(this.i=1e-4);const N=this.alpha;0===this._computationVector.x&&0===this._computationVector.z?this.alpha=Math.PI/2:this.alpha=Math.acos(this._computationVector.x/Math.sqrt(Math.pow(this._computationVector.x,2)+Math.pow(this._computationVector.z,2))),this._computationVector.z<0&&(this.alpha=2*Math.PI-this.alpha);const Z=Math.round((N-this.alpha)/(2*Math.PI));this.alpha+=2*Z*Math.PI,this.beta=Math.acos(this._computationVector.y/this.i),this._checkLimits()}setPosition(N){this._position.equals(N)||(this._position.p(N),this.rebuildAnglesAndRadius())}setTarget(N){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],d=arguments.length>2&&void 0!==arguments[2]&&arguments[2],X=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(X=this.overrideCloneAlphaBetaRadius??X,N.be)Z&&N.getBoundingInfo?this._targetBoundingCenter=N.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,N.be(),this._targetHost=N,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const Z=N,X=this._getTargetPosition();if(X&&!d&&X.equals(Z))return;this._targetHost=null,this._target=Z,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}X||this.rebuildAnglesAndRadius()}_getViewMatrix(){const N=Math.cos(this.alpha),Z=Math.sin(this.alpha),d=Math.cos(this.beta);let X=Math.sin(this.beta);0===X&&(X=1e-4),0===this.i&&(this.i=1e-4);const I=this._getTargetPosition();if(this._computationVector.fd(this.i*N*X,this.i*d,this.i*Z*X),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||z.n.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),I.addToRef(this._computationVector,this._newPosition),this.va().collisionsEnabled&&this.checkCollisions){const N=this.va().collisionCoordinator;this._collider||(this._collider=N.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,N.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.p(this._newPosition);let N=this.upVector;this.allowUpsideDown&&X<0&&(N=N.negate()),this._computeViewMatrix(this._position,I,N),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget=I,this._viewMatrix}zoomOn(N){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];N=N||this.va().meshes;const d=S.b.MinMax(N);let X=this._calculateLowerRadiusFromModelBoundingSphere(d.min,d.max);X=Math.max(Math.min(X,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.i=X*this.zoomOnFactor,this.focusOn({min:d.min,max:d.max,distance:X},Z)}focusOn(N){let Z,d,X=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===N.min){const X=N||this.va().meshes;Z=S.b.MinMax(X),d=z.n.Distance(Z.min,Z.max)}else{Z=N,d=N.distance}this._target=S.b.Center(Z),X||(this.maxZ=2*d)}createRigCamera(N,Z){let d=0;switch(this.cameraRigMode){case U.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case U.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case U.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case U.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case U.e.RIG_MODE_VR:d=this._cameraRigParams.stereoHalfAngle*(0===Z?1:-1);break;case U.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:d=this._cameraRigParams.stereoHalfAngle*(0===Z?-1:1)}const X=new b(N,this.alpha+d,this.beta,this.i,this._target,this.va());return X._cameraRigParams={},X.isRigCamera=!0,X.rigParent=this,X.upVector=this.upVector,X.mode=this.mode,X.orthoLeft=this.orthoLeft,X.orthoRight=this.orthoRight,X.orthoBottom=this.orthoBottom,X.orthoTop=this.orthoTop,X}_updateRigCameras(){const N=this._rigCameras[0],Z=this._rigCameras[1];switch(N.beta=Z.beta=this.beta,this.cameraRigMode){case U.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case U.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case U.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case U.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case U.e.RIG_MODE_VR:N.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,Z.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case U.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:N.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,Z.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(N,Z){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const X=z.n.Distance(N,Z),I=this.va().getEngine().getAspectRatio(this),m=Math.tan(this.fov/2),w=m*I,S=.5*X*d,e=S*Math.sqrt(1+1/(w*w)),j=S*Math.sqrt(1+1/(m*m));return Math.max(e,j)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,X.d)([(0,I.I)()],b.prototype,"alpha",void 0),(0,X.d)([(0,I.I)()],b.prototype,"beta",void 0),(0,X.d)([(0,I.I)()],b.prototype,"i",void 0),(0,X.d)([(0,I.I)()],b.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,X.d)([(0,I.H)("target")],b.prototype,"_target",void 0),(0,X.d)([(0,I.v)("targetHost")],b.prototype,"_targetHost",void 0),(0,X.d)([(0,I.I)()],b.prototype,"inertialAlphaOffset",void 0),(0,X.d)([(0,I.I)()],b.prototype,"inertialBetaOffset",void 0),(0,X.d)([(0,I.I)()],b.prototype,"inertialRadiusOffset",void 0),(0,X.d)([(0,I.I)()],b.prototype,"lowerAlphaLimit",void 0),(0,X.d)([(0,I.I)()],b.prototype,"upperAlphaLimit",void 0),(0,X.d)([(0,I.I)()],b.prototype,"lowerBetaLimit",void 0),(0,X.d)([(0,I.I)()],b.prototype,"upperBetaLimit",void 0),(0,X.d)([(0,I.I)()],b.prototype,"lowerRadiusLimit",void 0),(0,X.d)([(0,I.I)()],b.prototype,"upperRadiusLimit",void 0),(0,X.d)([(0,I.I)()],b.prototype,"inertialPanningX",void 0),(0,X.d)([(0,I.I)()],b.prototype,"inertialPanningY",void 0),(0,X.d)([(0,I.I)()],b.prototype,"pinchToPanMaxDistance",void 0),(0,X.d)([(0,I.I)()],b.prototype,"panningDistanceLimit",void 0),(0,X.d)([(0,I.H)()],b.prototype,"panningOriginTarget",void 0),(0,X.d)([(0,I.I)()],b.prototype,"panningInertia",void 0),(0,X.d)([(0,I.I)()],b.prototype,"zoomToMouseLocation",null),(0,X.d)([(0,I.I)()],b.prototype,"zoomOnFactor",void 0),(0,X.d)([(0,I.E)()],b.prototype,"targetScreenOffset",void 0),(0,X.d)([(0,I.I)()],b.prototype,"allowUpsideDown",void 0),(0,X.d)([(0,I.I)()],b.prototype,"useInputToRestoreState",void 0),(0,X.d)([(0,I.I)()],b.prototype,"restoreStateInterpolationFactor",void 0),(0,W.h)("BABYLON.ArcRotateCamera",b)},11335:(N,Z,d)=>{"use strict";d.d(Z,{e:()=>h});var X=d(942),I=d(949),m=d(1125),z=d(1133),w=d(958),S=d(960),e=d(11343),j=d(1051),B=d(978),D=d(1041),v=d(1398),T=d(1228),k=d(1094);class h extends e.e{get position(){return this._position}set position(N){this._position=N}set upVector(N){this._upVector=N}get upVector(){return this._upVector}get screenArea(){let N=0,Z=0;if(this.mode===h.PERSPECTIVE_CAMERA)this.fovMode===h.FOVMODE_VERTICAL_FIXED?(Z=2*this.gj*Math.tan(this.fov/2),N=this.getEngine().getAspectRatio(this)*Z):(N=2*this.gj*Math.tan(this.fov/2),Z=N/this.getEngine().getAspectRatio(this));else{const d=this.getEngine().getRenderWidth()/2,X=this.getEngine().getRenderHeight()/2;N=(this.orthoRight??d)-(this.orthoLeft??-d),Z=(this.orthoTop??X)-(this.orthoBottom??-X)}return N*Z}set orthoLeft(N){this._orthoLeft=N;for(const Z of this._rigCameras)Z.orthoLeft=N}get orthoLeft(){return this._orthoLeft}set orthoRight(N){this._orthoRight=N;for(const Z of this._rigCameras)Z.orthoRight=N}get orthoRight(){return this._orthoRight}set orthoBottom(N){this._orthoBottom=N;for(const Z of this._rigCameras)Z.orthoBottom=N}get orthoBottom(){return this._orthoBottom}set orthoTop(N){this._orthoTop=N;for(const Z of this._rigCameras)Z.orthoTop=N}get orthoTop(){return this._orthoTop}set mode(N){this._mode=N;for(const Z of this._rigCameras)Z.mode=N}get mode(){return this._mode}get hasMoved(){return this._hasMoved}constructor(N,Z,d){let X=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];super(N,d,!1),this._position=S.n.Zero(),this._upVector=S.n.Up(),this.oblique=null,this._orthoLeft=null,this._orthoRight=null,this._orthoBottom=null,this._orthoTop=null,this.fov=.8,this.projectionPlaneTilt=0,this.gj=1,this.maxZ=1e4,this.inertia=.9,this._mode=h.PERSPECTIVE_CAMERA,this.isIntermediate=!1,this.viewport=new v.e(0,0,1,1),this.layerMask=268435455,this.fovMode=h.FOVMODE_VERTICAL_FIXED,this.cameraRigMode=h.RIG_MODE_NONE,this.customRenderTargets=[],this.outputRenderTarget=null,this.onViewMatrixChangedObservable=new w.d,this.onProjectionMatrixChangedObservable=new w.d,this.onAfterCheckInputsObservable=new w.d,this.onRestoreStateObservable=new w.d,this.isRigCamera=!1,this._hasMoved=!1,this._rigCameras=new Array,this._skipRendering=!1,this._projectionMatrix=new S.c,this._postProcesses=new Array,this._activeMeshes=new m.h(256),this._globalPosition=S.n.Zero(),this._computedViewMatrix=S.c.Identity(),this._doNotComputeProjectionMatrix=!1,this._transformMatrix=S.c.Zero(),this._refreshFrustumPlanes=!0,this._absoluteRotation=S.g.Identity(),this._isCamera=!0,this._isLeftCamera=!1,this._isRightCamera=!1,this.va().addCamera(this),X&&!this.va().activeCamera&&(this.va().activeCamera=this),this.position=Z,this.renderPassId=this.va().getEngine().createRenderPassId(`Camera ${N}`)}storeState(){return this._stateStored=!0,this._storedFov=this.fov,this}hasStateStored(){return!!this._stateStored}_restoreStateValues(){return!!this._stateStored&&(this.fov=this._storedFov,!0)}restoreState(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)}getClassName(){return"Sh"}toString(N){let Z="Name: "+this.name;if(Z+=", type: "+this.getClassName(),this.animations)for(let d=0;d<this.animations.length;d++)Z+=", animation[0]: "+this.animations[d].toString(N);return Z}applyVerticalCorrection(){const N=this.absoluteRotation.toEulerAngles();this.projectionPlaneTilt=this._scene.useRightHandedSystem?-N.x:N.x}get globalPosition(){return this._globalPosition}getActiveMeshes(){return this._activeMeshes}isActiveMesh(N){return-1!==this._activeMeshes.indexOf(N)}isReady(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(N)for(const Z of this._postProcesses)if(Z&&!Z.isReady())return!1;return super.isReady(N)}_initCache(){super._initCache(),this._cache.position=new S.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new S.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.gj=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.obliqueAngle=void 0,this._cache.obliqueLength=void 0,this._cache.obliqueOffset=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0}_updateCache(N){N||super._updateCache(),this._cache.position.p(this.position),this._cache.upVector.p(this.upVector)}_isSynchronized(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()}_isSynchronizedViewMatrix(){return!!super._isSynchronized()&&(this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent())}_isSynchronizedProjectionMatrix(){let N=this._cache.mode===this.mode&&this._cache.gj===this.gj&&this._cache.maxZ===this.maxZ;if(!N)return!1;const Z=this.getEngine();return this.mode===h.PERSPECTIVE_CAMERA?N=this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===Z.getAspectRatio(this)&&this._cache.projectionPlaneTilt===this.projectionPlaneTilt:(N=this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===Z.getRenderWidth()&&this._cache.renderHeight===Z.getRenderHeight(),this.oblique&&(N=N&&this._cache.obliqueAngle===this.oblique.angle&&this._cache.obliqueLength===this.oblique.length&&this._cache.obliqueOffset===this.oblique.offset)),N}attachControl(N,Z){}Gd(N){}update(){this._hasMoved=!1,this._checkInputs(),this.cameraRigMode!==h.RIG_MODE_NONE&&this._updateRigCameras(),this.getViewMatrix(),this.getProjectionMatrix()}_checkInputs(){this.onAfterCheckInputsObservable.notifyObservers(this)}get rigCameras(){return this._rigCameras}get rigPostProcess(){return this._rigPostProcess}_getFirstPostProcess(){for(let N=0;N<this._postProcesses.length;N++)if(null!==this._postProcesses[N])return this._postProcesses[N];return null}_cascadePostProcessesToRigCams(){const N=this._getFirstPostProcess();N&&N.markTextureDirty();for(let Z=0,d=this._rigCameras.length;Z<d;Z++){const N=this._rigCameras[Z],d=N._rigPostProcess;if(d){"pass"===d.getEffectName()&&(N.isIntermediate=0===this._postProcesses.length),N._postProcesses=this._postProcesses.slice(0).concat(d),d.markTextureDirty()}else N._postProcesses=this._postProcesses.slice(0)}}attachPostProcess(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return!N.isReusable()&&this._postProcesses.indexOf(N)>-1?(j.e.Error("You're trying to reuse a post process not defined as reusable."),0):(null==Z||Z<0?this._postProcesses.push(N):null===this._postProcesses[Z]?this._postProcesses[Z]=N:this._postProcesses.splice(Z,0,N),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.fe(),this._postProcesses.indexOf(N))}detachPostProcess(N){const Z=this._postProcesses.indexOf(N);-1!==Z&&(this._postProcesses[Z]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.fe(),this._cascadePostProcessesToRigCams()}getWorldMatrix(){return this._isSynchronizedViewMatrix()||this.getViewMatrix(),this._worldMatrix}_getViewMatrix(){return S.c.Identity()}getViewMatrix(N){return!N&&this._isSynchronizedViewMatrix()||(this._hasMoved=!0,this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.va().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix)),this._computedViewMatrix}freezeProjectionMatrix(N){this._doNotComputeProjectionMatrix=!0,void 0!==N&&(this._projectionMatrix=N)}unfreezeProjectionMatrix(){this._doNotComputeProjectionMatrix=!1}getProjectionMatrix(N){if(this._doNotComputeProjectionMatrix||!N&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.gj=this.gj,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;const Z=this.getEngine(),d=this.va(),X=Z.useReverseDepthBuffer;if(this.mode===h.PERSPECTIVE_CAMERA){let N;this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=Z.getAspectRatio(this),this._cache.projectionPlaneTilt=this.projectionPlaneTilt,this.gj<=0&&(this.gj=.1),N=d.useRightHandedSystem?S.c.PerspectiveFovRHToRef:S.c.PerspectiveFovLHToRef,N(this.fov,Z.getAspectRatio(this),X?this.maxZ:this.gj,X?this.gj:this.maxZ,this._projectionMatrix,this.fovMode===h.FOVMODE_VERTICAL_FIXED,Z.isNDCHalfZRange,this.projectionPlaneTilt,X)}else{var I,m,z;const N=Z.getRenderWidth()/2,w=Z.getRenderHeight()/2;d.useRightHandedSystem?this.oblique?S.c.ObliqueOffCenterRHToRef(this.orthoLeft??-N,this.orthoRight??N,this.orthoBottom??-w,this.orthoTop??w,X?this.maxZ:this.gj,X?this.gj:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,Z.isNDCHalfZRange):S.c.OrthoOffCenterRHToRef(this.orthoLeft??-N,this.orthoRight??N,this.orthoBottom??-w,this.orthoTop??w,X?this.maxZ:this.gj,X?this.gj:this.maxZ,this._projectionMatrix,Z.isNDCHalfZRange):this.oblique?S.c.ObliqueOffCenterLHToRef(this.orthoLeft??-N,this.orthoRight??N,this.orthoBottom??-w,this.orthoTop??w,X?this.maxZ:this.gj,X?this.gj:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,Z.isNDCHalfZRange):S.c.OrthoOffCenterLHToRef(this.orthoLeft??-N,this.orthoRight??N,this.orthoBottom??-w,this.orthoTop??w,X?this.maxZ:this.gj,X?this.gj:this.maxZ,this._projectionMatrix,Z.isNDCHalfZRange),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.obliqueAngle=null===(I=this.oblique)||void 0===I?void 0:I.angle,this._cache.obliqueLength=null===(m=this.oblique)||void 0===m?void 0:m.length,this._cache.obliqueOffset=null===(z=this.oblique)||void 0===z?void 0:z.offset,this._cache.renderWidth=Z.getRenderWidth(),this._cache.renderHeight=Z.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix}getTransformationMatrix(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix}_computeObliqueDistance(N){return(this.i||(this.target?S.n.Distance(this.position,this.target):this.position.length()))+N}_updateFrustumPlanes(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?T.e.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=T.e.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)}isInFrustum(N){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._updateFrustumPlanes(),Z&&this.rigCameras.length>0){let Z=!1;return this.rigCameras.forEach((d=>{d._updateFrustumPlanes(),Z=Z||N.isInFrustum(d._frustumPlanes)})),Z}return N.isInFrustum(this._frustumPlanes)}isCompletelyInFrustum(N){return this._updateFrustumPlanes(),N.isCompletelyInFrustum(this._frustumPlanes)}getForwardRay(){throw(0,D.b)("Ray")}getForwardRayToRef(N){throw(0,D.b)("Ray")}dispose(N){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.va().stopAnimation(this),this.va().removeCamera(this);this._rigCameras.length>0;){const N=this._rigCameras.pop();N&&N.dispose()}if(this._parentContainer){const N=this._parentContainer.cameras.indexOf(this);N>-1&&this._parentContainer.cameras.splice(N,1),this._parentContainer=null}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses.length=0;else if(this.cameraRigMode!==h.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses.length=0;else{let N=this._postProcesses.length;for(;--N>=0;){const Z=this._postProcesses[N];Z&&Z.dispose(this)}}let d=this.customRenderTargets.length;for(;--d>=0;)this.customRenderTargets[d].dispose();this.customRenderTargets.length=0,this._activeMeshes.dispose(),this.va().getEngine().releaseRenderPassId(this.renderPassId),super.dispose(N,Z)}get isLeftCamera(){return this._isLeftCamera}get isRightCamera(){return this._isRightCamera}get leftCamera(){return this._rigCameras.length<1?null:this._rigCameras[0]}get rightCamera(){return this._rigCameras.length<2?null:this._rigCameras[1]}getLeftTarget(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()}getRightTarget(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()}setCameraRigMode(N,Z){if(this.cameraRigMode!==N){for(;this._rigCameras.length>0;){const N=this._rigCameras.pop();N&&N.dispose()}if(this.cameraRigMode=N,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=Z.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=z.g.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==h.RIG_MODE_NONE){const N=this.createRigCamera(this.name+"_L",0);N&&(N._isLeftCamera=!0);const Z=this.createRigCamera(this.name+"_R",1);Z&&(Z._isRightCamera=!0),N&&Z&&(this._rigCameras.push(N),this._rigCameras.push(Z))}this._setRigMode(Z),this._cascadePostProcessesToRigCams(),this.update()}}_setRigMode(N){}_getVRProjectionMatrix(){return S.c.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.gj,this.maxZ,this._cameraRigParams.vrWorkMatrix,!0,this.getEngine().isNDCHalfZRange),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix}setCameraRigParameter(N,Z){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[N]=Z,"interaxialDistance"===N&&(this._cameraRigParams.stereoHalfAngle=z.g.ToRadians(Z/.0637))}createRigCamera(N,Z){return null}_updateRigCameras(){for(let N=0;N<this._rigCameras.length;N++)this._rigCameras[N].gj=this.gj,this._rigCameras[N].maxZ=this.maxZ,this._rigCameras[N].fov=this.fov,this._rigCameras[N].upVector.p(this.upVector);this.cameraRigMode===h.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)}_setupInputs(){}serialize(){const N=k.c.Serialize(this);return N.uniqueId=this.uniqueId,N.type=this.getClassName(),this.parent&&this.parent._serializeAsParent(N),this.inputs&&this.inputs.serialize(N),k.c.AppendSerializedAnimations(this,N),N.ranges=this.serializeAnimationRanges(),N.isEnabled=this.isEnabled(),N}clone(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const d=k.c.Clone(h.GetConstructorFromName(this.getClassName(),N,this.va(),this.interaxialDistance,this.isStereoscopicSideBySide),this);return d.name=N,d.parent=Z,this.onClonedObservable.notifyObservers(d),d}bf(N){const Z=S.n.Zero();return this.getDirectionToRef(N,Z),Z}get absoluteRotation(){return this.getWorldMatrix().decompose(void 0,this._absoluteRotation),this._absoluteRotation}getDirectionToRef(N,Z){S.n.TransformNormalToRef(N,this.getWorldMatrix(),Z)}static GetConstructorFromName(N,Z,d){let X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,I=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const m=e.e.Construct(N,Z,d,{interaxial_distance:X,isStereoscopicSideBySide:I});return m||(()=>h._CreateDefaultParsedCamera(Z,d))}be(){return this.getWorldMatrix()}static Parse(N,Z){const d=N.type,X=h.GetConstructorFromName(d,N.name,Z,N.interaxial_distance,N.isStereoscopicSideBySide),I=k.c.Parse(X,N,Z);if(void 0!==N.parentId&&(I._waitingParentId=N.parentId),void 0!==N.parentInstanceIndex&&(I._waitingParentInstanceIndex=N.parentInstanceIndex),I.inputs&&(I.inputs.parse(N),I._setupInputs()),N.upVector&&(I.upVector=S.n._c(N.upVector)),I.setPosition&&(I.position.fd(0,0,0),I.setPosition(S.n._c(N.position))),N.target&&I.setTarget&&I.setTarget(S.n._c(N.target)),N.cameraRigMode){const Z=N.interaxial_distance?{interaxialDistance:N.interaxial_distance}:{};I.setCameraRigMode(N.cameraRigMode,Z)}if(N.animations){for(let Z=0;Z<N.animations.length;Z++){const d=N.animations[Z],X=(0,B.d)("BABYLON.Animation");X&&I.animations.push(X.Parse(d))}e.e.ParseAnimationRanges(I,N,Z)}return N.autoAnimate&&Z.beginAnimation(I,N.autoAnimateFrom,N.autoAnimateTo,N.autoAnimateLoop,N.autoAnimateSpeed||1),void 0!==N.isEnabled&&I.wg(N.isEnabled),I}_calculateHandednessMultiplier(){let N=this.va().useRightHandedSystem?-1:1;return this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(N*=-1),N}}h._CreateDefaultParsedCamera=(N,Z)=>{throw(0,D.b)("UniversalCamera")},h.PERSPECTIVE_CAMERA=0,h.ORTHOGRAPHIC_CAMERA=1,h.FOVMODE_VERTICAL_FIXED=0,h.FOVMODE_HORIZONTAL_FIXED=1,h.RIG_MODE_NONE=0,h.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,h.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,h.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,h.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,h.RIG_MODE_STEREOSCOPIC_INTERLACED=14,h.RIG_MODE_VR=20,h.RIG_MODE_CUSTOM=22,h.ForceAttachControlToAlwaysPreventDefault=!1,(0,X.d)([(0,I.H)("position")],h.prototype,"_position",void 0),(0,X.d)([(0,I.H)("upVector")],h.prototype,"_upVector",void 0),(0,X.d)([(0,I.I)()],h.prototype,"orthoLeft",null),(0,X.d)([(0,I.I)()],h.prototype,"orthoRight",null),(0,X.d)([(0,I.I)()],h.prototype,"orthoBottom",null),(0,X.d)([(0,I.I)()],h.prototype,"orthoTop",null),(0,X.d)([(0,I.I)()],h.prototype,"fov",void 0),(0,X.d)([(0,I.I)()],h.prototype,"projectionPlaneTilt",void 0),(0,X.d)([(0,I.I)()],h.prototype,"gj",void 0),(0,X.d)([(0,I.I)()],h.prototype,"maxZ",void 0),(0,X.d)([(0,I.I)()],h.prototype,"inertia",void 0),(0,X.d)([(0,I.I)()],h.prototype,"mode",null),(0,X.d)([(0,I.I)()],h.prototype,"layerMask",void 0),(0,X.d)([(0,I.I)()],h.prototype,"fovMode",void 0),(0,X.d)([(0,I.I)()],h.prototype,"cameraRigMode",void 0),(0,X.d)([(0,I.I)()],h.prototype,"interaxialDistance",void 0),(0,X.d)([(0,I.I)()],h.prototype,"isStereoscopicSideBySide",void 0)},11702:(N,Z,d)=>{"use strict";d.d(Z,{b:()=>z,e:()=>w});var X=d(1051),I=d(1094),m=d(11335),z={};class w{constructor(N){this.attachedToElement=!1,this.attached={},this.camera=N,this.checkInputs=()=>{}}add(N){const Z=N.getSimpleName();this.attached[Z]?X.e.Warn("camera input of type "+Z+" already exists on camera"):(this.attached[Z]=N,N.camera=this.camera,N.checkInputs&&(this.checkInputs=this._addCheckInputs(N.checkInputs.bind(N))),this.attachedToElement&&N.attachControl(this.noPreventDefault))}remove(N){for(const Z in this.attached){const d=this.attached[Z];if(d===N)return d.Gd(),d.camera=null,delete this.attached[Z],void this.rebuildInputCheck()}}removeByType(N){for(const Z in this.attached){const d=this.attached[Z];d.getClassName()===N&&(d.Gd(),d.camera=null,delete this.attached[Z],this.rebuildInputCheck())}}_addCheckInputs(N){const Z=this.checkInputs;return()=>{Z(),N()}}attachInput(N){this.attachedToElement&&N.attachControl(this.noPreventDefault)}attachElement(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){N=!m.e.ForceAttachControlToAlwaysPreventDefault&&N,this.attachedToElement=!0,this.noPreventDefault=N;for(const Z in this.attached)this.attached[Z].attachControl(N)}}detachElement(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const Z in this.attached)this.attached[Z].Gd(),N&&(this.attached[Z].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const N in this.attached){const Z=this.attached[N];Z.checkInputs&&(this.checkInputs=this._addCheckInputs(Z.checkInputs.bind(Z)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(N){const Z={};for(const d in this.attached){const N=this.attached[d],X=I.c.Serialize(N);Z[N.getClassName()]=X}N.inputsmgr=Z}parse(N){const Z=N.inputsmgr;if(Z){this.clear();for(const N in Z){const d=z[N];if(d){const X=Z[N],m=I.c.Parse((()=>new d),X,null);this.add(m)}}}else for(const d in this.attached){const Z=z[this.attached[d].getClassName()];if(Z){const X=I.c.Parse((()=>new Z),N,null);this.remove(this.attached[d]),this.add(X)}}}}},11684:(N,Z,d)=>{"use strict";d.d(Z,{b:()=>n});var X=d(942),I=d(949),m=d(960),z=d(11693),w=d(11702),S=d(1206),e=d(1133);class j{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(N){N=e.g.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((Z=>{const d=Z.event;if(!d.metaKey)if(Z.type===S.d.KEYDOWN){if(-1!==this.keysUp.indexOf(d.keyCode)||-1!==this.keysDown.indexOf(d.keyCode)||-1!==this.keysLeft.indexOf(d.keyCode)||-1!==this.keysRight.indexOf(d.keyCode)||-1!==this.keysUpward.indexOf(d.keyCode)||-1!==this.keysDownward.indexOf(d.keyCode)||-1!==this.keysRotateLeft.indexOf(d.keyCode)||-1!==this.keysRotateRight.indexOf(d.keyCode)||-1!==this.keysRotateUp.indexOf(d.keyCode)||-1!==this.keysRotateDown.indexOf(d.keyCode)){-1===this._keys.indexOf(d.keyCode)&&this._keys.push(d.keyCode),N||d.preventDefault()}}else if(-1!==this.keysUp.indexOf(d.keyCode)||-1!==this.keysDown.indexOf(d.keyCode)||-1!==this.keysLeft.indexOf(d.keyCode)||-1!==this.keysRight.indexOf(d.keyCode)||-1!==this.keysUpward.indexOf(d.keyCode)||-1!==this.keysDownward.indexOf(d.keyCode)||-1!==this.keysRotateLeft.indexOf(d.keyCode)||-1!==this.keysRotateRight.indexOf(d.keyCode)||-1!==this.keysRotateUp.indexOf(d.keyCode)||-1!==this.keysRotateDown.indexOf(d.keyCode)){const Z=this._keys.indexOf(d.keyCode);Z>=0&&this._keys.splice(Z,1),N||d.preventDefault()}})))}Gd(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const N=this.camera;for(let Z=0;Z<this._keys.length;Z++){const d=this._keys[Z],X=N._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(d)?N._localDirection.fd(-X,0,0):-1!==this.keysUp.indexOf(d)?N._localDirection.fd(0,0,X):-1!==this.keysRight.indexOf(d)?N._localDirection.fd(X,0,0):-1!==this.keysDown.indexOf(d)?N._localDirection.fd(0,0,-X):-1!==this.keysUpward.indexOf(d)?N._localDirection.fd(0,X,0):-1!==this.keysDownward.indexOf(d)?N._localDirection.fd(0,-X,0):-1!==this.keysRotateLeft.indexOf(d)?(N._localDirection.fd(0,0,0),N.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(d)?(N._localDirection.fd(0,0,0),N.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(d)?(N._localDirection.fd(0,0,0),N.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(d)&&(N._localDirection.fd(0,0,0),N.cameraRotation.x+=this._getLocalRotation()),N.va().useRightHandedSystem&&(N._localDirection.z*=-1),N.getViewMatrix().invertToRef(N._cameraTransformMatrix),m.n.TransformNormalToRef(N._localDirection,N._cameraTransformMatrix,N._transformedDirection),N.cameraDirection.addInPlace(N._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const N=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*N}}(0,X.d)([(0,I.I)()],j.prototype,"keysUp",void 0),(0,X.d)([(0,I.I)()],j.prototype,"keysUpward",void 0),(0,X.d)([(0,I.I)()],j.prototype,"keysDown",void 0),(0,X.d)([(0,I.I)()],j.prototype,"keysDownward",void 0),(0,X.d)([(0,I.I)()],j.prototype,"keysLeft",void 0),(0,X.d)([(0,I.I)()],j.prototype,"keysRight",void 0),(0,X.d)([(0,I.I)()],j.prototype,"rotationSpeed",void 0),(0,X.d)([(0,I.I)()],j.prototype,"keysRotateLeft",void 0),(0,X.d)([(0,I.I)()],j.prototype,"keysRotateRight",void 0),(0,X.d)([(0,I.I)()],j.prototype,"keysRotateUp",void 0),(0,X.d)([(0,I.I)()],j.prototype,"keysRotateDown",void 0),w.b.FreeCameraKeyboardMoveInput=j;var B=d(958),D=d(1199);class v{constructor(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=N,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new B.d,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(N){N=e.g.BackCompatCameraNoPreventDefault(arguments);const Z=this.camera.getEngine(),d=Z.getInputElement();this._pointerInput||(this._pointerInput=X=>{const I=X.event,m="touch"===I.pointerType;if(!this.touchEnabled&&m)return;if(X.type!==D.d.POINTERMOVE&&-1===this.buttons.indexOf(I.button))return;const z=I.target;if(X.type===D.d.POINTERDOWN){if(m&&-1!==this._activePointerId||!m&&-1!==this._currentActiveButton)return;this._activePointerId=I.pointerId;try{null===z||void 0===z||z.setPointerCapture(I.pointerId)}catch(w){}-1===this._currentActiveButton&&(this._currentActiveButton=I.button),this._previousPosition={x:I.clientX,y:I.clientY},N||(I.preventDefault(),d&&d.focus()),Z.isPointerLock&&this._onMouseMove&&this._onMouseMove(X.event)}else if(X.type===D.d.POINTERUP){if(m&&this._activePointerId!==I.pointerId||!m&&this._currentActiveButton!==I.button)return;try{null===z||void 0===z||z.releasePointerCapture(I.pointerId)}catch(w){}this._currentActiveButton=-1,this._previousPosition=null,N||I.preventDefault(),this._activePointerId=-1}else if(X.type===D.d.POINTERMOVE&&(this._activePointerId===I.pointerId||!m))if(Z.isPointerLock&&this._onMouseMove)this._onMouseMove(X.event);else if(this._previousPosition){const Z=this.camera._calculateHandednessMultiplier(),d=(I.clientX-this._previousPosition.x)*Z,X=I.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=d/this.angularSensibility,this.camera.cameraRotation.x+=X/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:d,offsetY:X}),this._previousPosition={x:I.clientX,y:I.clientY},N||I.preventDefault()}}),this._onMouseMove=d=>{if(!Z.isPointerLock)return;const X=this.camera._calculateHandednessMultiplier(),I=d.movementX*X;this.camera.cameraRotation.y+=I/this.angularSensibility;const m=d.movementY;this.camera.cameraRotation.x+=m/this.angularSensibility,this._previousPosition=null,N||d.preventDefault()},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,D.d.POINTERDOWN|D.d.POINTERUP|D.d.POINTERMOVE),d&&(this._contextMenuBind=N=>this.onContextMenu(N),d.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(N){N.preventDefault()}Gd(){if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const N=this.camera.getEngine().getInputElement();N&&N.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,X.d)([(0,I.I)()],v.prototype,"buttons",void 0),(0,X.d)([(0,I.I)()],v.prototype,"angularSensibility",void 0),w.b.FreeCameraMouseInput=v;var T,k=d(1211);class h{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new B.d,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(N){N=e.g.BackCompatCameraNoPreventDefault(arguments),this._wheel=Z=>{if(Z.type!==D.d.POINTERWHEEL)return;const d=Z.event,X=d.deltaMode===k.c.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*X*d.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*X*d.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*X*d.deltaZ/this._normalize,d.preventDefault&&(N||d.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,D.d.POINTERWHEEL)}Gd(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,X.d)([(0,I.I)()],h.prototype,"wheelPrecisionX",void 0),(0,X.d)([(0,I.I)()],h.prototype,"wheelPrecisionY",void 0),(0,X.d)([(0,I.I)()],h.prototype,"wheelPrecisionZ",void 0),function(N){N[N.MoveRelative=0]="MoveRelative",N[N.RotateRelative=1]="RotateRelative",N[N.MoveScene=2]="MoveScene"}(T||(T={}));class U extends h{constructor(){super(...arguments),this._moveRelative=m.n.Zero(),this._rotateRelative=m.n.Zero(),this._moveScene=m.n.Zero(),this._wheelXAction=T.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=T.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(N){null===N&&this._wheelXAction!==T.MoveRelative||(this._wheelXAction=T.MoveRelative,this._wheelXActionCoordinate=N)}get wheelXMoveRelative(){return this._wheelXAction!==T.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(N){null===N&&this._wheelYAction!==T.MoveRelative||(this._wheelYAction=T.MoveRelative,this._wheelYActionCoordinate=N)}get wheelYMoveRelative(){return this._wheelYAction!==T.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(N){null===N&&this._wheelZAction!==T.MoveRelative||(this._wheelZAction=T.MoveRelative,this._wheelZActionCoordinate=N)}get wheelZMoveRelative(){return this._wheelZAction!==T.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(N){null===N&&this._wheelXAction!==T.RotateRelative||(this._wheelXAction=T.RotateRelative,this._wheelXActionCoordinate=N)}get wheelXRotateRelative(){return this._wheelXAction!==T.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(N){null===N&&this._wheelYAction!==T.RotateRelative||(this._wheelYAction=T.RotateRelative,this._wheelYActionCoordinate=N)}get wheelYRotateRelative(){return this._wheelYAction!==T.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(N){null===N&&this._wheelZAction!==T.RotateRelative||(this._wheelZAction=T.RotateRelative,this._wheelZActionCoordinate=N)}get wheelZRotateRelative(){return this._wheelZAction!==T.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(N){null===N&&this._wheelXAction!==T.MoveScene||(this._wheelXAction=T.MoveScene,this._wheelXActionCoordinate=N)}get wheelXMoveScene(){return this._wheelXAction!==T.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(N){null===N&&this._wheelYAction!==T.MoveScene||(this._wheelYAction=T.MoveScene,this._wheelYActionCoordinate=N)}get wheelYMoveScene(){return this._wheelYAction!==T.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(N){null===N&&this._wheelZAction!==T.MoveScene||(this._wheelZAction=T.MoveScene,this._wheelZActionCoordinate=N)}get wheelZMoveScene(){return this._wheelZAction!==T.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.hd(0),this._rotateRelative.hd(0),this._moveScene.hd(0),this._updateCamera(),this.camera.va().useRightHandedSystem&&(this._moveRelative.z*=-1);const N=m.c.Zero();this.camera.getViewMatrix().invertToRef(N);const Z=m.n.Zero();m.n.TransformNormalToRef(this._moveRelative,N,Z),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(Z),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(N,Z,d){if(0===N)return;if(null===Z||null===d)return;let X=null;switch(Z){case T.MoveRelative:X=this._moveRelative;break;case T.RotateRelative:X=this._rotateRelative;break;case T.MoveScene:X=this._moveScene}switch(d){case 0:X.set(N,0,0);break;case 1:X.set(0,N,0);break;case 2:X.set(0,0,N)}}}(0,X.d)([(0,I.I)()],U.prototype,"wheelXMoveRelative",null),(0,X.d)([(0,I.I)()],U.prototype,"wheelYMoveRelative",null),(0,X.d)([(0,I.I)()],U.prototype,"wheelZMoveRelative",null),(0,X.d)([(0,I.I)()],U.prototype,"wheelXRotateRelative",null),(0,X.d)([(0,I.I)()],U.prototype,"wheelYRotateRelative",null),(0,X.d)([(0,I.I)()],U.prototype,"wheelZRotateRelative",null),(0,X.d)([(0,I.I)()],U.prototype,"wheelXMoveScene",null),(0,X.d)([(0,I.I)()],U.prototype,"wheelYMoveScene",null),(0,X.d)([(0,I.I)()],U.prototype,"wheelZMoveScene",null),w.b.FreeCameraMouseWheelInput=U;class C{constructor(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=N,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=e.g.IsSafari()}attachControl(N){N=e.g.BackCompatCameraNoPreventDefault(arguments);let Z=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=d=>{const X=d.event,I="mouse"===X.pointerType||this._isSafari&&"undefined"===typeof X.pointerType;if(this.allowMouse||!I)if(d.type===D.d.POINTERDOWN){if(N||X.preventDefault(),this._pointerPressed.push(X.pointerId),1!==this._pointerPressed.length)return;Z={x:X.clientX,y:X.clientY}}else if(d.type===D.d.POINTERUP){N||X.preventDefault();const d=this._pointerPressed.indexOf(X.pointerId);if(-1===d)return;if(this._pointerPressed.splice(d,1),0!=d)return;Z=null,this._offsetX=null,this._offsetY=null}else if(d.type===D.d.POINTERMOVE){if(N||X.preventDefault(),!Z)return;if(0!=this._pointerPressed.indexOf(X.pointerId))return;this._offsetX=X.clientX-Z.x,this._offsetY=-(X.clientY-Z.y)}}),this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,D.d.POINTERDOWN|D.d.POINTERUP|D.d.POINTERMOVE),this._onLostFocus){const N=this.camera.getEngine().getInputElement();N&&N.addEventListener("blur",this._onLostFocus)}}Gd(){if(this._pointerInput){if(this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const N=this.camera.getEngine().getInputElement();N&&N.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const N=this.camera,Z=N._calculateHandednessMultiplier();N.cameraRotation.y=Z*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)N.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const Z=N._computeLocalCameraSpeed(),d=new m.n(0,0,0!==this.touchMoveSensibility?Z*this._offsetY/this.touchMoveSensibility:0);m.c.RotationYawPitchRollToRef(N.rotation.y,N.rotation.x,0,N._cameraRotationMatrix),N.cameraDirection.addInPlace(m.n.TransformCoordinates(d,N._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,X.d)([(0,I.I)()],C.prototype,"touchAngularSensibility",void 0),(0,X.d)([(0,I.I)()],C.prototype,"touchMoveSensibility",void 0),w.b.FreeCameraTouchInput=C;class M extends w.e{constructor(N){super(N),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new j),this}addMouse(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new v(N),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new U,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new C),this}clear(){super.clear(),this._mouseInput=null}}var Q=d(978),A=d(1060);class n extends z.c{get angularSensibility(){const N=this.inputs.attached.mouse;return N?N.angularSensibility:0}set angularSensibility(N){const Z=this.inputs.attached.mouse;Z&&(Z.angularSensibility=N)}get keysUp(){const N=this.inputs.attached.keyboard;return N?N.keysUp:[]}set keysUp(N){const Z=this.inputs.attached.keyboard;Z&&(Z.keysUp=N)}get keysUpward(){const N=this.inputs.attached.keyboard;return N?N.keysUpward:[]}set keysUpward(N){const Z=this.inputs.attached.keyboard;Z&&(Z.keysUpward=N)}get keysDown(){const N=this.inputs.attached.keyboard;return N?N.keysDown:[]}set keysDown(N){const Z=this.inputs.attached.keyboard;Z&&(Z.keysDown=N)}get keysDownward(){const N=this.inputs.attached.keyboard;return N?N.keysDownward:[]}set keysDownward(N){const Z=this.inputs.attached.keyboard;Z&&(Z.keysDownward=N)}get keysLeft(){const N=this.inputs.attached.keyboard;return N?N.keysLeft:[]}set keysLeft(N){const Z=this.inputs.attached.keyboard;Z&&(Z.keysLeft=N)}get keysRight(){const N=this.inputs.attached.keyboard;return N?N.keysRight:[]}set keysRight(N){const Z=this.inputs.attached.keyboard;Z&&(Z.keysRight=N)}get keysRotateLeft(){const N=this.inputs.attached.keyboard;return N?N.keysRotateLeft:[]}set keysRotateLeft(N){const Z=this.inputs.attached.keyboard;Z&&(Z.keysRotateLeft=N)}get keysRotateRight(){const N=this.inputs.attached.keyboard;return N?N.keysRotateRight:[]}set keysRotateRight(N){const Z=this.inputs.attached.keyboard;Z&&(Z.keysRotateRight=N)}get keysRotateUp(){const N=this.inputs.attached.keyboard;return N?N.keysRotateUp:[]}set keysRotateUp(N){const Z=this.inputs.attached.keyboard;Z&&(Z.keysRotateUp=N)}get keysRotateDown(){const N=this.inputs.attached.keyboard;return N?N.keysRotateDown:[]}set keysRotateDown(N){const Z=this.inputs.attached.keyboard;Z&&(Z.keysRotateDown=N)}constructor(N,Z,d){var X;super(N,Z,d,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),X=this,this.ellipsoid=new m.n(.5,1,.5),this.ellipsoidOffset=new m.n(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=m.n.Zero(),this._diffPosition=m.n.Zero(),this._newPosition=m.n.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(N,Z){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;X._newPosition.p(Z),X._newPosition.subtractToRef(X._oldPosition,X._diffPosition),X._diffPosition.length()>A.c.CollisionsEpsilon&&(X.position.addToRef(X._diffPosition,X._deferredPositionUpdate),X._deferOnly?X._deferredUpdated=!0:X.position.p(X._deferredPositionUpdate),X.Kk&&d&&X.Kk(d))},this.inputs=new M(this),this.inputs.addKeyboard().addMouse()}attachControl(N,Z){Z=e.g.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(Z)}Gd(){this.inputs.detachElement(),this.cameraDirection=new m.n(0,0,0),this.cameraRotation=new m.l(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(N){this._collisionMask=isNaN(N)?-1:N}_collideWithWorld(N){let Z;Z=this.parent?m.n.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,Z.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const d=this.va().collisionCoordinator;this._collider||(this._collider=d.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let X=N;this.applyGravity&&(X=N.add(this.va().gravity)),d.getNewPosition(this._oldPosition,X,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=m.n.Zero(),this._transformedDirection=m.n.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(N){this._needMoveForGravity=N}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.va().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"hb"}}(0,X.d)([(0,I.H)()],n.prototype,"ellipsoid",void 0),(0,X.d)([(0,I.H)()],n.prototype,"ellipsoidOffset",void 0),(0,X.d)([(0,I.I)()],n.prototype,"checkCollisions",void 0),(0,X.d)([(0,I.I)()],n.prototype,"applyGravity",void 0),(0,Q.h)("BABYLON.FreeCamera",n)},11693:(N,Z,d)=>{"use strict";d.d(Z,{c:()=>e});var X=d(942),I=d(949),m=d(11335),z=d(960),w=d(966),S=d(1388);d(11343).e.AddNodeConstructor("TargetCamera",((N,Z)=>()=>new e(N,z.n.Zero(),Z)));class e extends m.e{constructor(N,Z,d){super(N,Z,d,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),this._tmpUpVector=z.n.Zero(),this._tmpTargetVector=z.n.Zero(),this.cameraDirection=new z.n(0,0,0),this.cameraRotation=new z.l(0,0),this.ignoreParentScaling=!1,this.updateUpVectorFromRotation=!1,this._tmpQuaternion=new z.g,this.rotation=new z.n(0,0,0),this.speed=2,this.noRotationConstraint=!1,this.invertRotation=!1,this.inverseRotationSpeed=.2,this.lockedTarget=null,this._currentTarget=z.n.Zero(),this._initialFocalDistance=1,this._viewMatrix=z.c.Zero(),this._camMatrix=z.c.Zero(),this._cameraTransformMatrix=z.c.Zero(),this._cameraRotationMatrix=z.c.Zero(),this._referencePoint=new z.n(0,0,1),this._transformedReferencePoint=z.n.Zero(),this._deferredPositionUpdate=new z.n,this._deferredRotationQuaternionUpdate=new z.g,this._deferredRotationUpdate=new z.n,this._deferredUpdated=!1,this._deferOnly=!1,this._defaultUp=z.n.Up(),this._cachedRotationZ=0,this._cachedQuaternionRotationZ=0}getFrontPosition(N){this.getWorldMatrix();const Z=this.getTarget().rc(this.position);return Z.normalize(),Z.scaleInPlace(N),this.globalPosition.add(Z)}_getLockedTargetPosition(){if(!this.lockedTarget)return null;if(this.lockedTarget.absolutePosition){const N=this.lockedTarget;N.be().getTranslationToRef(N.absolutePosition)}return this.lockedTarget.absolutePosition||this.lockedTarget}storeState(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),super.storeState()}_restoreStateValues(){return!!super._restoreStateValues()&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.fd(0,0,0),this.cameraRotation.fd(0,0),!0)}_initCache(){super._initCache(),this._cache.lockedTarget=new z.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new z.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new z.g(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}_updateCache(N){N||super._updateCache();const Z=this._getLockedTargetPosition();Z?this._cache.lockedTarget?this._cache.lockedTarget.p(Z):this._cache.lockedTarget=Z.clone():this._cache.lockedTarget=null,this._cache.rotation.p(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.p(this.rotationQuaternion)}_isSynchronizedViewMatrix(){if(!super._isSynchronizedViewMatrix())return!1;const N=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(N):!N)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))}_computeLocalCameraSpeed(){const N=this.getEngine();return this.speed*Math.sqrt(N.getDeltaTime()/(100*N.getFps()))}setTarget(N){this.upVector.normalize(),this._initialFocalDistance=N.rc(this.position).length(),this.position.z===N.z&&(this.position.z+=w.b),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),z.c.LookAtLHToRef(this.position,N,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);const Z=N.rc(this.position);Z.x>=0?this.rotation.y=-Math.atan(Z.z/Z.x)+Math.PI/2:this.rotation.y=-Math.atan(Z.z/Z.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&z.g.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)}get target(){return this.getTarget()}set target(N){this.setTarget(N)}getTarget(){return this._currentTarget}_decideIfNeedsToMove(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(z.h.Matrix[0]),z.n.TransformNormalToRef(this.cameraDirection,z.h.Matrix[0],z.h.kd[0]),this._deferredPositionUpdate.addInPlace(z.h.kd[0]),void(this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate));this._deferredPositionUpdate.addInPlace(this.cameraDirection),this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate)}_checkInputs(){const N=this.invertRotation?-this.inverseRotationSpeed:1,Z=this._decideIfNeedsToMove(),d=this.cameraRotation.x||this.cameraRotation.y;if(this._deferredUpdated=!1,this._deferredRotationUpdate.p(this.rotation),this._deferredPositionUpdate.p(this.position),this.rotationQuaternion&&this._deferredRotationQuaternionUpdate.p(this.rotationQuaternion),Z&&this._updatePosition(),d){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this._deferredRotationUpdate),this._deferredRotationUpdate.x+=this.cameraRotation.x*N,this._deferredRotationUpdate.y+=this.cameraRotation.y*N,!this.noRotationConstraint){const N=1.570796;this._deferredRotationUpdate.x>N&&(this._deferredRotationUpdate.x=N),this._deferredRotationUpdate.x<-N&&(this._deferredRotationUpdate.x=-N)}if(this._deferOnly?this._deferredUpdated=!0:this.rotation.p(this._deferredRotationUpdate),this.rotationQuaternion){this._deferredRotationUpdate.lengthSquared()&&(z.g.RotationYawPitchRollToRef(this._deferredRotationUpdate.y,this._deferredRotationUpdate.x,this._deferredRotationUpdate.z,this._deferredRotationQuaternionUpdate),this._deferOnly?this._deferredUpdated=!0:this.rotationQuaternion.p(this._deferredRotationQuaternionUpdate))}}Z&&(Math.abs(this.cameraDirection.x)<this.speed*w.b&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*w.b&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*w.b&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),d&&(Math.abs(this.cameraRotation.x)<this.speed*w.b&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*w.b&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),super._checkInputs()}_updateCameraRotationMatrix(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):z.c.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)}_rotateUpVectorWithCameraRotationMatrix(){return z.n.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this}_getViewMatrix(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),z.n.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?S.d.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(z.g.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),S.d.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix}_computeViewMatrix(N,Z,d){if(this.ignoreParentScaling){if(this.parent){const X=this.parent.getWorldMatrix();z.n.TransformCoordinatesToRef(N,X,this._globalPosition),z.n.TransformCoordinatesToRef(Z,X,this._tmpTargetVector),z.n.TransformNormalToRef(d,X,this._tmpUpVector),this._markSyncedWithParent()}else this._globalPosition.p(N),this._tmpTargetVector.p(Z),this._tmpUpVector.p(d);this.va().useRightHandedSystem?z.c.LookAtRHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix):z.c.LookAtLHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix)}else if(this.va().useRightHandedSystem?z.c.LookAtRHToRef(N,Z,d,this._viewMatrix):z.c.LookAtLHToRef(N,Z,d,this._viewMatrix),this.parent){const N=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(N,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.p(N)}createRigCamera(N,Z){if(this.cameraRigMode!==m.e.RIG_MODE_NONE){const Z=new e(N,this.position.clone(),this.va());return Z.isRigCamera=!0,Z.rigParent=this,this.cameraRigMode===m.e.RIG_MODE_VR&&(this.rotationQuaternion||(this.rotationQuaternion=new z.g),Z._cameraRigParams={},Z.rotationQuaternion=new z.g),Z.mode=this.mode,Z.orthoLeft=this.orthoLeft,Z.orthoRight=this.orthoRight,Z.orthoTop=this.orthoTop,Z.orthoBottom=this.orthoBottom,Z}return null}_updateRigCameras(){const N=this._rigCameras[0],Z=this._rigCameras[1];switch(this.be(),this.cameraRigMode){case m.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case m.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case m.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case m.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case m.e.RIG_MODE_STEREOSCOPIC_INTERLACED:{const d=this.cameraRigMode===m.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,X=this.cameraRigMode===m.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*d,N),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*X,Z);break}case m.e.RIG_MODE_VR:N.rotationQuaternion?(N.rotationQuaternion.p(this.rotationQuaternion),Z.rotationQuaternion.p(this.rotationQuaternion)):(N.rotation.p(this.rotation),Z.rotation.p(this.rotation)),N.position.p(this.position),Z.position.p(this.position)}super._updateRigCameras()}_getRigCamPositionAndTarget(N,Z){this.getTarget().subtractToRef(this.position,e._TargetFocalPoint),e._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);const d=e._TargetFocalPoint.addInPlace(this.position);z.c.TranslationToRef(-d.x,-d.y,-d.z,e._TargetTransformMatrix),e._TargetTransformMatrix.multiplyToRef(z.c.RotationAxis(Z.upVector,N),e._RigCamTransformMatrix),z.c.TranslationToRef(d.x,d.y,d.z,e._TargetTransformMatrix),e._RigCamTransformMatrix.multiplyToRef(e._TargetTransformMatrix,e._RigCamTransformMatrix),z.n.TransformCoordinatesToRef(this.position,e._RigCamTransformMatrix,Z.position),Z.setTarget(d)}getClassName(){return"TargetCamera"}}e._RigCamTransformMatrix=new z.c,e._TargetTransformMatrix=new z.c,e._TargetFocalPoint=new z.n,(0,X.d)([(0,I.H)()],e.prototype,"rotation",void 0),(0,X.d)([(0,I.I)()],e.prototype,"speed",void 0),(0,X.d)([(0,I.v)("lockedTargetId")],e.prototype,"lockedTarget",void 0)},12102:(N,Z,d)=>{"use strict";d.d(Z,{e:()=>m});var X=d(1125),I=d(12105);class m{constructor(N,Z){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=d,this.Ei=[],this._maxBlockCapacity=Z||64,this._selectionContent=new X.e(1024),this._creationFunc=N}update(N,Z,d){I.d._CreateBlocks(N,Z,d,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}Wd(N){for(let Z=0;Z<this.Xh.length;Z++){this.Xh[Z].addEntry(N)}}_d(N){for(let Z=0;Z<this.Xh.length;Z++){this.Xh[Z].removeEntry(N)}}select(N,Z){this._selectionContent.reset();for(let d=0;d<this.Xh.length;d++){this.Xh[d].select(N,this._selectionContent,Z)}return Z?this._selectionContent.concat(this.Ei):this._selectionContent.concatWithNoDuplicate(this.Ei),this._selectionContent}intersects(N,Z,d){this._selectionContent.reset();for(let X=0;X<this.Xh.length;X++){this.Xh[X].intersects(N,Z,this._selectionContent,d)}return d?this._selectionContent.concat(this.Ei):this._selectionContent.concatWithNoDuplicate(this.Ei),this._selectionContent}intersectsRay(N){this._selectionContent.reset();for(let Z=0;Z<this.Xh.length;Z++){this.Xh[Z].intersectsRay(N,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.Ei),this._selectionContent}}m.CreationFuncForMeshes=(N,Z)=>{const d=N.getBoundingInfo();!N.isBlocked&&d.boundingBox.intersectsMinMax(Z.Ii,Z.Ji)&&Z.entries.push(N)},m.CreationFuncForSubMeshes=(N,Z)=>{N.getBoundingInfo().boundingBox.intersectsMinMax(Z.Ii,Z.Ji)&&Z.entries.push(N)}},12105:(N,Z,d)=>{"use strict";d.d(Z,{d:()=>m});var X=d(960),I=d(1271);class m{constructor(N,Z,d,X,I,m){this.entries=[],this.Ki=new Array,this._capacity=d,this._depth=X,this._maxDepth=I,this._creationFunc=m,this._minPoint=N,this._maxPoint=Z,this.Ki.push(N.clone()),this.Ki.push(Z.clone()),this.Ki.push(N.clone()),this.Ki[2].x=Z.x,this.Ki.push(N.clone()),this.Ki[3].y=Z.y,this.Ki.push(N.clone()),this.Ki[4].z=Z.z,this.Ki.push(Z.clone()),this.Ki[5].z=N.z,this.Ki.push(Z.clone()),this.Ki[6].x=N.x,this.Ki.push(Z.clone()),this.Ki[7].y=N.y}get he(){return this._capacity}get Ii(){return this._minPoint}get Ji(){return this._maxPoint}addEntry(N){if(this.Xh)for(let Z=0;Z<this.Xh.length;Z++){this.Xh[Z].addEntry(N)}else this._creationFunc(N,this),this.entries.length>this.he&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(N){if(this.Xh){for(let Z=0;Z<this.Xh.length;Z++){this.Xh[Z].removeEntry(N)}return}const Z=this.entries.indexOf(N);Z>-1&&this.entries.splice(Z,1)}addEntries(N){for(let Z=0;Z<N.length;Z++){const d=N[Z];this.addEntry(d)}}select(N,Z,d){if(I.c.IsInFrustum(this.Ki,N)){if(this.Xh){for(let X=0;X<this.Xh.length;X++){this.Xh[X].select(N,Z,d)}return}d?Z.concat(this.entries):Z.concatWithNoDuplicate(this.entries)}}intersects(N,Z,d,X){if(I.c.IntersectsSphere(this._minPoint,this._maxPoint,N,Z)){if(this.Xh){for(let I=0;I<this.Xh.length;I++){this.Xh[I].intersects(N,Z,d,X)}return}X?d.concat(this.entries):d.concatWithNoDuplicate(this.entries)}}intersectsRay(N,Z){if(N.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.Xh){for(let d=0;d<this.Xh.length;d++){this.Xh[d].intersectsRay(N,Z)}return}Z.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){m._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(N,Z,d,I,z,w,S,e){S.Xh=new Array;const j=new X.n((Z.x-N.x)/2,(Z.y-N.y)/2,(Z.z-N.z)/2);for(let X=0;X<2;X++)for(let Z=0;Z<2;Z++)for(let B=0;B<2;B++){const D=N.add(j.multiplyByFloats(X,Z,B)),v=N.add(j.multiplyByFloats(X+1,Z+1,B+1)),T=new m(D,v,I,z+1,w,e);T.addEntries(d),S.Xh.push(T)}}}},12107:(N,Z,d)=>{"use strict";d.d(Z,{b:()=>j});var X=d(1131),I=d(960),m=d(11366),z=d(11496),w=d(1193),S=d(12102),e=d(986);X.e.prototype.createOrUpdateSelectionOctree=function(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,d=this._getComponent(w.e.NAME_OCTREE);d||(d=new j(this),this.Nd(d)),this.Ci||(this.Ci=new S.e(S.e.CreationFuncForMeshes,N,Z));const X=this.getWorldExtends();return this.Ci.update(X.min,X.max,this.meshes),this.Ci},Object.defineProperty(X.e.prototype,"selectionOctree",{get:function(){return this.Ci},enumerable:!0,configurable:!0}),m.b.prototype.createOrUpdateSubmeshesOctree=function(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const d=this.va();let X=d._getComponent(w.e.NAME_OCTREE);X||(X=new j(d),d.Nd(X)),this._submeshesOctree||(this._submeshesOctree=new S.e(S.e.CreationFuncForSubMeshes,N,Z)),this.be(!0);const I=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(I.minimumWorld,I.maximumWorld,this.Sd),this._submeshesOctree};class j{constructor(N){this.name=w.e.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new z.d(I.n.Zero(),new I.n(1,1,1)),(N=N||e.e.LastCreatedScene)&&(this.Td=N,this.Td.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.Td.getActiveSubMeshCandidates=N=>this.getActiveSubMeshCandidates(N),this.Td.getCollidingSubMeshCandidates=(N,Z)=>this.getCollidingSubMeshCandidates(N,Z),this.Td.getIntersectingSubMeshCandidates=(N,Z)=>this.getIntersectingSubMeshCandidates(N,Z))}register(){this.Td.onMeshRemovedObservable.add((N=>{const Z=this.Td.selectionOctree;if(void 0!==Z&&null!==Z){const d=Z.Ei.indexOf(N);-1!==d&&Z.Ei.splice(d,1)}})),this.Td.onMeshImportedObservable.add((N=>{const Z=this.Td.selectionOctree;void 0!==Z&&null!==Z&&Z.Wd(N)}))}getActiveMeshCandidates(){var N;return(null===(N=this.Td.Ci)||void 0===N?void 0:N.select(this.Td.frustumPlanes))||this.Td._getDefaultMeshCandidates()}getActiveSubMeshCandidates(N){if(N._submeshesOctree&&N.useOctreeForRenderingSelection){return N._submeshesOctree.select(this.Td.frustumPlanes)}return this.Td._getDefaultSubMeshCandidates(N)}getIntersectingSubMeshCandidates(N,Z){if(N._submeshesOctree&&N.useOctreeForPicking){z.d.TransformToRef(Z,N.getWorldMatrix(),this._tempRay);return N._submeshesOctree.intersectsRay(this._tempRay)}return this.Td._getDefaultSubMeshCandidates(N)}getCollidingSubMeshCandidates(N,Z){if(N._submeshesOctree&&N.useOctreeForCollisions){const d=Z._velocityWorldLength+Math.max(Z._radius.x,Z._radius.y,Z._radius.z);return N._submeshesOctree.intersects(Z._basePointWorld,d)}return this.Td._getDefaultSubMeshCandidates(N)}rebuild(){}dispose(){}}},11496:(N,Z,d)=>{"use strict";d.d(Z,{d:()=>v});var X=d(1131),I=d(11335),m=d(966),z=d(960),w=d(971),S=d(1258),e=d(1163),j=d(986),B=d(1219);const D={internalPickerForMesh:void 0};class v{constructor(N,Z){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:m.b;this.origin=N,this.direction=Z,this.length=d,this.epsilon=X}clone(){return new v(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(N,Z){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const X=v._TmpVector3[0].fd(N.x-d,N.y-d,N.z-d),I=v._TmpVector3[1].fd(Z.x+d,Z.y+d,Z.z+d);let m,z,w,S,e=0,j=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<X.x||this.origin.x>I.x)return!1}else if(m=1/this.direction.x,z=(X.x-this.origin.x)*m,w=(I.x-this.origin.x)*m,w===-1/0&&(w=1/0),z>w&&(S=z,z=w,w=S),e=Math.max(z,e),j=Math.min(w,j),e>j)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<X.y||this.origin.y>I.y)return!1}else if(m=1/this.direction.y,z=(X.y-this.origin.y)*m,w=(I.y-this.origin.y)*m,w===-1/0&&(w=1/0),z>w&&(S=z,z=w,w=S),e=Math.max(z,e),j=Math.min(w,j),e>j)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<X.z||this.origin.z>I.z)return!1}else if(m=1/this.direction.z,z=(X.z-this.origin.z)*m,w=(I.z-this.origin.z)*m,w===-1/0&&(w=1/0),z>w&&(S=z,z=w,w=S),e=Math.max(z,e),j=Math.min(w,j),e>j)return!1;return!0}intersectsBox(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(N.minimum,N.maximum,Z)}intersectsSphere(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const d=N.center.x-this.origin.x,X=N.center.y-this.origin.y,I=N.center.z-this.origin.z,m=d*d+X*X+I*I,z=N.i+Z,w=z*z;if(m<=w)return!0;const S=d*this.direction.x+X*this.direction.y+I*this.direction.z;if(S<0)return!1;return m-S*S<=w}intersectsTriangle(N,Z,d){const X=v._TmpVector3[0],I=v._TmpVector3[1],m=v._TmpVector3[2],w=v._TmpVector3[3],e=v._TmpVector3[4];Z.subtractToRef(N,X),d.subtractToRef(N,I),z.n.CrossToRef(this.direction,I,m);const j=z.n.Dot(X,m);if(0===j)return null;const B=1/j;this.origin.subtractToRef(N,w);const D=z.n.Dot(w,m)*B;if(D<-this.epsilon||D>1+this.epsilon)return null;z.n.CrossToRef(w,X,e);const T=z.n.Dot(this.direction,e)*B;if(T<-this.epsilon||D+T>1+this.epsilon)return null;const k=z.n.Dot(I,e)*B;return k>this.length?null:new S.d(1-D-T,D,k)}intersectsPlane(N){let Z;const d=z.n.Dot(N.ld,this.direction);if(Math.abs(d)<9.99999997475243e-7)return null;{const X=z.n.Dot(N.ld,this.origin);return Z=(-N.d-X)/d,Z<0?Z<-9.99999997475243e-7?null:0:Z}}intersectsAxis(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(N){case"y":{const N=(this.origin.y-Z)/this.direction.y;return N>0?null:new z.n(this.origin.x+this.direction.x*-N,Z,this.origin.z+this.direction.z*-N)}case"x":{const N=(this.origin.x-Z)/this.direction.x;return N>0?null:new z.n(Z,this.origin.y+this.direction.y*-N,this.origin.z+this.direction.z*-N)}case"z":{const N=(this.origin.z-Z)/this.direction.z;return N>0?null:new z.n(this.origin.x+this.direction.x*-N,this.origin.y+this.direction.y*-N,Z)}default:return null}}intersectsMesh(N,Z,d){let X=arguments.length>3&&void 0!==arguments[3]&&arguments[3],I=arguments.length>4?arguments[4]:void 0,m=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const w=z.h.Matrix[0];return N.getWorldMatrix().invertToRef(w),this._tmpRay?v.TransformToRef(this,w,this._tmpRay):this._tmpRay=v.Transform(this,w),N.intersects(this._tmpRay,Z,d,X,I,m)}intersectsMeshes(N,Z,d){d?d.length=0:d=[];for(let X=0;X<N.length;X++){const I=this.intersectsMesh(N[X],Z);I.hit&&d.push(I)}return d.sort(this._comparePickingInfo),d}_comparePickingInfo(N,Z){return N.distance<Z.distance?-1:N.distance>Z.distance?1:0}intersectionSegment(N,Z,d){const X=this.origin,I=z.h.kd[0],m=z.h.kd[1],w=z.h.kd[2],S=z.h.kd[3];Z.subtractToRef(N,I),this.direction.scaleToRef(v._Rayl,w),X.addToRef(w,m),N.subtractToRef(X,S);const e=z.n.Dot(I,I),j=z.n.Dot(I,w),B=z.n.Dot(w,w),D=z.n.Dot(I,S),T=z.n.Dot(w,S),k=e*B-j*j;let h,U,C=k,M=k;k<v._Smallnum?(h=0,C=1,U=T,M=B):(h=j*T-B*D,U=e*T-j*D,h<0?(h=0,U=T,M=B):h>C&&(h=C,U=T+j,M=B)),U<0?(U=0,-D<0?h=0:-D>e?h=C:(h=-D,C=e)):U>M&&(U=M,-D+j<0?h=0:-D+j>e?h=C:(h=-D+j,C=e));const Q=Math.abs(h)<v._Smallnum?0:h/C,A=Math.abs(U)<v._Smallnum?0:U/M,n=z.h.kd[4];w.scaleToRef(A,n);const g=z.h.kd[5];I.scaleToRef(Q,g),g.addInPlace(S);const E=z.h.kd[6];g.subtractToRef(n,E);return A>0&&A<=this.length&&E.lengthSquared()<d*d?g.length():-1}update(N,Z,d,X,I,m,w){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){v._RayDistant||(v._RayDistant=v.Zero()),v._RayDistant.unprojectRayToRef(N,Z,d,X,z.c.IdentityReadOnly,m,w);const S=z.h.Matrix[0];I.invertToRef(S),v.TransformToRef(v._RayDistant,S,this)}else this.unprojectRayToRef(N,Z,d,X,I,m,w);return this}static Zero(){return new v(z.n.Zero(),z.n.Zero())}static CreateNew(N,Z,d,X,I,m,z){return v.Zero().update(N,Z,d,X,I,m,z)}static CreateNewFromTo(N,Z){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:z.c.IdentityReadOnly;const X=new v(new z.n(0,0,0),new z.n(0,0,0));return v.CreateFromToToRef(N,Z,X,d)}static CreateFromToToRef(N,Z,d){let X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:z.c.IdentityReadOnly;d.origin.p(N);const I=Z.subtractToRef(N,d.direction),m=Math.sqrt(I.x*I.x+I.y*I.y+I.z*I.z);return d.length=m,d.direction.normalize(),v.TransformToRef(d,X,d)}static Transform(N,Z){const d=new v(new z.n(0,0,0),new z.n(0,0,0));return v.TransformToRef(N,Z,d),d}static TransformToRef(N,Z,d){z.n.TransformCoordinatesToRef(N.origin,Z,d.origin),z.n.TransformNormalToRef(N.direction,Z,d.direction),d.length=N.length,d.epsilon=N.epsilon;const X=d.direction,I=X.length();if(0!==I&&1!==I){const N=1/I;X.x*=N,X.y*=N,X.z*=N,d.length*=I}return d}unprojectRayToRef(N,Z,d,X,I,m,w){const S=z.h.Matrix[0];I.multiplyToRef(m,S),S.multiplyToRef(w,S),S.invert();const e=j.e.LastCreatedEngine,B=z.h.kd[0];B.x=N/d*2-1,B.y=-(Z/X*2-1),B.z=null!==e&&void 0!==e&&e.useReverseDepthBuffer?1:null!==e&&void 0!==e&&e.isNDCHalfZRange?0:-1;const D=z.h.kd[1].fd(B.x,B.y,1-1e-8),v=z.h.kd[2],T=z.h.kd[3];z.n._UnprojectFromInvertedMatrixToRef(B,S,v),z.n._UnprojectFromInvertedMatrixToRef(D,S,T),this.origin.p(v),T.subtractToRef(v,this.direction),this.direction.normalize()}}function T(N,Z,d,X,I){let m=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const z=v.Zero();return k(N,Z,d,X,z,I,m),z}function k(N,Z,d,X,I,m){let w=arguments.length>6&&void 0!==arguments[6]&&arguments[6],S=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const e=N.getEngine();if(!m&&!(m=N.activeCamera))return N;const j=m.viewport,B=e.getRenderHeight(),{x:D,y:v,width:T,height:k}=j.toGlobal(e.getRenderWidth(),B),h=1/e.getHardwareScalingLevel();return Z=Z*h-D,d=d*h-(B-v-k),I.update(Z,d,T,k,X||z.c.IdentityReadOnly,w?z.c.IdentityReadOnly:m.getViewMatrix(),m.getProjectionMatrix(),S),N}function h(N,Z,d,X,I){if(!e.c)return N;const m=N.getEngine();if(!I&&!(I=N.activeCamera))throw new Error("Active camera not set");const w=I.viewport,S=m.getRenderHeight(),{x:j,y:B,width:D,height:v}=w.toGlobal(m.getRenderWidth(),S),T=z.c.Identity(),k=1/m.getHardwareScalingLevel();return Z=Z*k-j,d=d*k-(S-B-v),X.update(Z,d,D,v,T,T,I.getProjectionMatrix()),N}function U(N,Z,d,X,I,m,z,w){const S=Z(X,d.enableDistantPicking),e=d.intersects(S,I,z,m,X,w);return e&&e.hit?!I&&null!=N&&e.distance>=N.distance?null:e:null}function C(N,Z,d,X,I,m){let w=null;const S=!!(N.activeCameras&&N.activeCameras.length>1&&N.cameraToUseForPointers!==N.activeCamera),j=N.cameraToUseForPointers||N.activeCamera,B=D.internalPickerForMesh||U;for(let e=0;e<N.meshes.length;e++){const D=N.meshes[e];if(d){if(!d(D,-1))continue}else if(!D.isEnabled()||!D.isVisible||!D.Fd)continue;const v=S&&D.isWorldMatrixCameraDependent(),T=D.be(v,j);if(D.hasThinInstances&&D.thinInstanceEnablePicking){const N=B(w,Z,D,T,!0,!0,m);if(N){if(I)return N;const S=z.h.Matrix[1],e=D.thinInstanceGetWorldMatrices();for(let N=0;N<e.length;N++){if(d&&!d(D,N))continue;e[N].multiplyToRef(T,S);const z=B(w,Z,D,S,X,I,m,!0);if(z&&(w=z,w.thinInstanceIndex=N,X))return w}}}else{const N=B(w,Z,D,T,X,I,m);if(N&&(w=N,X))return w}}return w||new e.c}function M(N,Z,d,X){if(!e.c)return null;const I=[],m=!!(N.activeCameras&&N.activeCameras.length>1&&N.cameraToUseForPointers!==N.activeCamera),w=N.cameraToUseForPointers||N.activeCamera,S=D.internalPickerForMesh||U;for(let e=0;e<N.meshes.length;e++){const j=N.meshes[e];if(d){if(!d(j,-1))continue}else if(!j.isEnabled()||!j.isVisible||!j.Fd)continue;const B=m&&j.isWorldMatrixCameraDependent(),D=j.be(B,w);if(j.hasThinInstances&&j.thinInstanceEnablePicking){if(S(null,Z,j,D,!0,!0,X)){const N=z.h.Matrix[1],m=j.thinInstanceGetWorldMatrices();for(let z=0;z<m.length;z++){if(d&&!d(j,z))continue;m[z].multiplyToRef(D,N);const w=S(null,Z,j,N,!1,!1,X,!0);w&&(w.thinInstanceIndex=z,I.push(w))}}}else{const N=S(null,Z,j,D,!1,!1,X);N&&I.push(N)}}return I}function Q(N,Z){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,X=arguments.length>3?arguments[3]:void 0,I=arguments.length>4?arguments[4]:void 0;X||(X=N.getWorldMatrix()),Z.length=d,I?Z.origin.p(I):Z.origin.p(N.position);const m=z.h.kd[2];m.set(0,0,N._scene.useRightHandedSystem?-1:1);const w=z.h.kd[3];return z.n.TransformNormalToRef(m,X,w),z.n.NormalizeToRef(w,Z.direction),Z}var A,n;v._TmpVector3=(0,w.c)(6,z.n.Zero),v._RayDistant=v.Zero(),v._Smallnum=1e-8,v._Rayl=1e9,A=X.e,(n=I.e)&&(n.prototype.getForwardRay=function(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,Z=arguments.length>1?arguments[1]:void 0,d=arguments.length>2?arguments[2]:void 0;return Q(this,new v(z.n.Zero(),z.n.Zero(),N),N,Z,d)},n.prototype.getForwardRayToRef=function(N){return Q(this,N,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),A&&(B.d._IsPickingAvailable=!0,A.prototype.createPickingRay=function(N,Z,d,X){return T(this,N,Z,d,X,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),X.e.prototype.createPickingRayToRef=function(N,Z,d,X,I){return k(this,N,Z,d,X,I,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},X.e.prototype.createPickingRayInCameraSpace=function(N,Z,d){return function(N,Z,d,X){const I=v.Zero();return h(N,Z,d,I,X),I}(this,N,Z,d)},X.e.prototype.createPickingRayInCameraSpaceToRef=function(N,Z,d,X){return h(this,N,Z,d,X)},X.e.prototype.pickWithBoundingInfo=function(N,Z,d,X,I){return function(N,Z,d,X,I,m){if(!e.c)return null;const w=C(N,(X=>(N._tempPickingRay||(N._tempPickingRay=v.Zero()),k(N,Z,d,X,N._tempPickingRay,m||null),N._tempPickingRay)),X,I,!0);return w&&(w.ray=T(N,Z,d,z.c.Identity(),m||null)),w}(this,N,Z,d,X,I)},X.e.prototype.Ed=function(N,Z,d,X,I,m){return function(N,Z,d,X,I,m,w){const S=C(N,((X,I)=>(N._tempPickingRay||(N._tempPickingRay=v.Zero()),k(N,Z,d,X,N._tempPickingRay,m||null,!1,I),N._tempPickingRay)),X,I,!1,w);return S&&(S.ray=T(N,Z,d,z.c.Identity(),m||null)),S}(this,N,Z,d,X,I,m)},X.e.prototype.pickWithRay=function(N,Z,d,X){return function(N,Z,d,X,I){const m=C(N,(d=>(N._pickWithRayInverseMatrix||(N._pickWithRayInverseMatrix=z.c.Identity()),d.invertToRef(N._pickWithRayInverseMatrix),N._cachedRayForTransform||(N._cachedRayForTransform=v.Zero()),v.TransformToRef(Z,N._pickWithRayInverseMatrix,N._cachedRayForTransform),N._cachedRayForTransform)),d,X,!1,I);return m&&(m.ray=Z),m}(this,N,Z,d,X)},X.e.prototype.multiPick=function(N,Z,d,X,I){return function(N,Z,d,X,I,m){return M(N,(X=>T(N,Z,d,X,I||null)),X,m)}(this,N,Z,d,X,I)},X.e.prototype.multiPickWithRay=function(N,Z,d){return function(N,Z,d,X){return M(N,(d=>(N._pickWithRayInverseMatrix||(N._pickWithRayInverseMatrix=z.c.Identity()),d.invertToRef(N._pickWithRayInverseMatrix),N._cachedRayForTransform||(N._cachedRayForTransform=v.Zero()),v.TransformToRef(Z,N._pickWithRayInverseMatrix,N._cachedRayForTransform),N._cachedRayForTransform)),d,X)}(this,N,Z,d)}},12116:(N,Z,d)=>{"use strict";d(1051);var X=d(1321);d(1080),d(1176),d(982),d(1366),d(1327);X.c},11177:(N,Z,d)=>{"use strict";d.r(Z),d.d(Z,{SceneInstrumentation:()=>m});var X=d(1133),I=d(1222);class m{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(N){N!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=N,N?(this._onBeforeActiveMeshesEvaluationObserver=this.Td.onBeforeActiveMeshesEvaluationObservable.add((()=>{X.g.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.Td.onAfterActiveMeshesEvaluationObservable.add((()=>{X.g.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.Td.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Td.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(N){N!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=N,N?(this._onBeforeRenderTargetsRenderObserver=this.Td.onBeforeRenderTargetsRenderObservable.add((()=>{X.g.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.Td.onAfterRenderTargetsRenderObservable.add((()=>{X.g.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.Td.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Td.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(N){N!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=N,N?(this._onBeforeParticlesRenderingObserver=this.Td.onBeforeParticlesRenderingObservable.add((()=>{X.g.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.Td.onAfterParticlesRenderingObservable.add((()=>{X.g.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.Td.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Td.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(N){N!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=N,this.Td.spriteManagers&&(N?(this._onBeforeSpritesRenderingObserver=this.Td.onBeforeSpritesRenderingObservable.add((()=>{X.g.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.Td.onAfterSpritesRenderingObservable.add((()=>{X.g.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.Td.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.Td.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(N){N!==this._capturePhysicsTime&&this.Td.onBeforePhysicsObservable&&(this._capturePhysicsTime=N,N?(this._onBeforePhysicsObserver=this.Td.onBeforePhysicsObservable.add((()=>{X.g.StartPerformanceCounter("ib"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.Td.onAfterPhysicsObservable.add((()=>{X.g.EndPerformanceCounter("ib"),this._physicsTime.endMonitoring()}))):(this.Td.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.Td.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(N){N!==this._captureAnimationsTime&&(this._captureAnimationsTime=N,N?this._onAfterAnimationsObserver=this.Td.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.Td.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(N){this._captureFrameTime=N}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(N){this._captureInterFrameTime=N}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(N){N!==this._captureRenderTime&&(this._captureRenderTime=N,N?(this._onBeforeDrawPhaseObserver=this.Td.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),X.g.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.Td.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),X.g.EndPerformanceCounter("Main render")}))):(this.Td.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Td.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(N){N!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=N,N?(this._onBeforeCameraRenderObserver=this.Td.onBeforeCameraRenderObservable.add((N=>{this._cameraRenderTime.beginMonitoring(),X.g.StartPerformanceCounter(`Rendering camera ${N.name}`)})),this._onAfterCameraRenderObserver=this.Td.onAfterCameraRenderObservable.add((N=>{this._cameraRenderTime.endMonitoring(!1),X.g.EndPerformanceCounter(`Rendering camera ${N.name}`)}))):(this.Td.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Td.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.Td.getEngine()._drawCalls}constructor(N){this.Td=N,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new I.b,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new I.b,this._captureFrameTime=!1,this._frameTime=new I.b,this._captureRenderTime=!1,this._renderTime=new I.b,this._captureInterFrameTime=!1,this._interFrameTime=new I.b,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new I.b,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new I.b,this._capturePhysicsTime=!1,this._physicsTime=new I.b,this._captureAnimationsTime=!1,this._animationsTime=new I.b,this._captureCameraRenderTime=!1,this._cameraRenderTime=new I.b,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._onBeforeAnimationsObserver=N.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(X.g.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.Td.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=N.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(X.g.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.vd(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.vd(),this._captureParticlesRenderTime&&this._particlesRenderTime.vd(),this._captureSpritesRenderTime&&this._spritesRenderTime.vd(),this._captureRenderTime&&this._renderTime.vd(),this._captureCameraRenderTime&&this._cameraRenderTime.vd()}))}dispose(){this.Td.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.Td.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Td.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.Td.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Td.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.Td.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.Td.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Td.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.Td.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.Td.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.Td.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Td.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.Td.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.Td.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.Td.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.Td.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Td.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.Td=null}}},11785:(N,Z,d)=>{"use strict";d.d(Z,{d:()=>j});var X=d(942),I=d(949),m=d(960),z=d(11343),w=d(11753),S=d(11788),e=d(978);z.e.AddNodeConstructor("Light_Type_1",((N,Z)=>()=>new j(N,m.n.Zero(),Z)));class j extends S.c{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(N){this._shadowFrustumSize=N,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(N){this._shadowOrthoScale=N,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(N){this._orthoLeft=N}get orthoRight(){return this._orthoRight}set orthoRight(N){this._orthoRight=N}get orthoTop(){return this._orthoTop}set orthoTop(N){this._orthoTop=N}get orthoBottom(){return this._orthoBottom}set orthoBottom(N){this._orthoBottom=N}constructor(N,Z,d){super(N,d),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=Z.scale(-1),this.direction=Z}getClassName(){return"jb"}getTypeID(){return w.d.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(N,Z,d){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(N):this._setDefaultAutoExtendShadowProjectionMatrix(N,Z,d)}_setDefaultFixedFrustumShadowProjectionMatrix(N){const Z=this.va().activeCamera;Z&&m.c.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:Z.gj,void 0!==this.shadowMaxZ?this.shadowMaxZ:Z.maxZ,N,this.va().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(N,Z,d){const X=this.va().activeCamera;if(!X)return;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const N=m.n.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let X=Number.MAX_VALUE,I=-Number.MAX_VALUE;for(let z=0;z<d.length;z++){const w=d[z];if(!w)continue;const S=w.getBoundingInfo().boundingBox;for(let d=0;d<S.vectorsWorld.length;d++)m.n.TransformCoordinatesToRef(S.vectorsWorld[d],Z,N),N.x<this._orthoLeft&&(this._orthoLeft=N.x),N.y<this._orthoBottom&&(this._orthoBottom=N.y),N.x>this._orthoRight&&(this._orthoRight=N.x),N.y>this._orthoTop&&(this._orthoTop=N.y),this.autoCalcShadowZBounds&&(N.z<X&&(X=N.z),N.z>I&&(I=N.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=X,this._shadowMaxZ=I)}const I=this._orthoRight-this._orthoLeft,z=this._orthoTop-this._orthoBottom,w=void 0!==this.shadowMinZ?this.shadowMinZ:X.gj,S=void 0!==this.shadowMaxZ?this.shadowMaxZ:X.maxZ,e=this.va().getEngine().useReverseDepthBuffer;m.c.OrthoOffCenterLHToRef(this._orthoLeft-I*this.shadowOrthoScale,this._orthoRight+I*this.shadowOrthoScale,this._orthoBottom-z*this.shadowOrthoScale,this._orthoTop+z*this.shadowOrthoScale,e?S:w,e?w:S,N,this.va().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(N,Z){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,Z),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,Z),this)}transferToNodeMaterialEffect(N,Z){return this.computeTransformedInformation()?(N.setFloat3(Z,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(N.setFloat3(Z,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(N){const Z=this._scene.getEngine();return!Z.useReverseDepthBuffer&&Z.isNDCHalfZRange?0:1}getDepthMaxZ(N){const Z=this._scene.getEngine();return Z.useReverseDepthBuffer&&Z.isNDCHalfZRange?0:1}prepareLightSpecificDefines(N,Z){N["DIRLIGHT"+Z]=!0}}(0,X.d)([(0,I.I)()],j.prototype,"shadowFrustumSize",null),(0,X.d)([(0,I.I)()],j.prototype,"shadowOrthoScale",null),(0,X.d)([(0,I.I)()],j.prototype,"autoUpdateExtends",void 0),(0,X.d)([(0,I.I)()],j.prototype,"autoCalcShadowZBounds",void 0),(0,X.d)([(0,I.I)("orthoLeft")],j.prototype,"_orthoLeft",void 0),(0,X.d)([(0,I.I)("orthoRight")],j.prototype,"_orthoRight",void 0),(0,X.d)([(0,I.I)("orthoTop")],j.prototype,"_orthoTop",void 0),(0,X.d)([(0,I.I)("orthoBottom")],j.prototype,"_orthoBottom",void 0),(0,e.h)("BABYLON.DirectionalLight",j)},12051:(N,Z,d)=>{"use strict";d.d(Z,{e:()=>j});var X=d(942),I=d(949),m=d(960),z=d(1108),w=d(11343),S=d(11753),e=d(978);w.e.AddNodeConstructor("Light_Type_3",((N,Z)=>()=>new j(N,m.n.Zero(),Z)));class j extends S.d{constructor(N,Z,d){super(N,d),this.groundColor=new z.b(0,0,0),this.direction=Z||m.n.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"lb"}setDirectionToTarget(N){return this.direction=m.n.Normalize(N.rc(m.n.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(N,Z){const d=m.n.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",d.x,d.y,d.z,0,Z),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.kj),Z),this}transferToNodeMaterialEffect(N,Z){const d=m.n.Normalize(this.direction);return N.setFloat3(Z,d.x,d.y,d.z),this}be(){return this._worldMatrix||(this._worldMatrix=m.c.Identity()),this._worldMatrix}getTypeID(){return S.d.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(N,Z){N["HEMILIGHT"+Z]=!0}}(0,X.d)([(0,I.m)()],j.prototype,"groundColor",void 0),(0,X.d)([(0,I.H)()],j.prototype,"direction",void 0),(0,e.h)("BABYLON.HemisphericLight",j)},11753:(N,Z,d)=>{"use strict";d.d(Z,{d:()=>D});var X=d(942),I=d(949),m=d(960),z=d(1108),w=d(11343),S=d(1157),e=d(978),j=d(1238),B=d(1094);class D extends w.e{get range(){return this._range}set range(N){this._range=N,this._inverseSquaredRange=1/(this.range*this.range)}get intensityMode(){return this._intensityMode}set intensityMode(N){this._intensityMode=N,this._computePhotometricScale()}get i(){return this._radius}set i(N){this._radius=N,this._computePhotometricScale()}get shadowEnabled(){return this._shadowEnabled}set shadowEnabled(N){this._shadowEnabled!==N&&(this._shadowEnabled=N,this._markMeshesAsLightDirty())}get includedOnlyMeshes(){return this._includedOnlyMeshes}set includedOnlyMeshes(N){this._includedOnlyMeshes=N,this._hookArrayForIncludedOnly(N)}get excludedMeshes(){return this._excludedMeshes}set excludedMeshes(N){this._excludedMeshes=N,this._hookArrayForExcluded(N)}get excludeWithLayerMask(){return this._excludeWithLayerMask}set excludeWithLayerMask(N){this._excludeWithLayerMask=N,this._resyncMeshes()}get includeOnlyWithLayerMask(){return this._includeOnlyWithLayerMask}set includeOnlyWithLayerMask(N){this._includeOnlyWithLayerMask=N,this._resyncMeshes()}get lightmapMode(){return this._lightmapMode}set lightmapMode(N){this._lightmapMode!==N&&(this._lightmapMode=N,this._markMeshesAsLightDirty())}getViewMatrix(N){return null}getProjectionMatrix(N,Z){return null}constructor(N,Z){super(N,Z,!1),this.Uh=new z.b(1,1,1),this.te=new z.b(1,1,1),this.falloffType=D.FALLOFF_DEFAULT,this.kj=1,this._range=Number.MAX_VALUE,this._inverseSquaredRange=0,this._photometricScale=1,this._intensityMode=D.INTENSITYMODE_AUTOMATIC,this._radius=1e-5,this.renderPriority=0,this._shadowEnabled=!0,this._excludeWithLayerMask=0,this._includeOnlyWithLayerMask=0,this._lightmapMode=0,this._shadowGenerators=null,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,this._isLight=!0,this.va().addLight(this),this._uniformBuffer=new S.e(this.va().getEngine(),void 0,void 0,N),this._buildUniformLayout(),this.includedOnlyMeshes=[],this.excludedMeshes=[],this._resyncMeshes()}transferTexturesToEffect(N,Z){return this}_bindLight(N,Z,d,X){let I=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const m=N.toString();let w=!1;if(this._uniformBuffer.bindToEffect(d,"Light"+m),this._renderId!==Z.getRenderId()||this._lastUseSpecular!==X||!this._uniformBuffer.useUbo){this._renderId=Z.getRenderId(),this._lastUseSpecular=X;const N=this.getScaledIntensity();this.transferToEffect(d,m),this.Uh.scaleToRef(N,z.i.wd[0]),this._uniformBuffer.updateColor4("vLightDiffuse",z.i.wd[0],this.range,m),X&&(this.te.scaleToRef(N,z.i.wd[1]),this._uniformBuffer.updateColor4("vLightSpecular",z.i.wd[1],this.i,m)),w=!0}if(this.transferTexturesToEffect(d,m),Z.shadowsEnabled&&this.shadowEnabled&&I){const N=this.getShadowGenerator(Z.activeCamera)??this.getShadowGenerator();N&&(N.bindShadowLight(m,d),w=!0)}w?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()}getClassName(){return"Light"}toString(N){let Z="Name: "+this.name;if(Z+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(let d=0;d<this.animations.length;d++)Z+=", animation[0]: "+this.animations[d].toString(N);return Z}_syncParentEnabledState(){super._syncParentEnabledState(),this.u()||this._resyncMeshes()}wg(N){super.wg(N),this._resyncMeshes()}getShadowGenerator(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===this._shadowGenerators?null:this._shadowGenerators.get(N)??null}getShadowGenerators(){return this._shadowGenerators}getAbsolutePosition(){return m.n.Zero()}canAffectMesh(N){return!N||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(N))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(N))&&((0===this.includeOnlyWithLayerMask||0!==(this.includeOnlyWithLayerMask&N.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&N.layerMask)))}dispose(N){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._shadowGenerators){const N=this._shadowGenerators.values();for(let Z=N.next();!0!==Z.done;Z=N.next()){Z.value.dispose()}this._shadowGenerators=null}if(this.va().stopAnimation(this),this._parentContainer){const N=this._parentContainer.lights.indexOf(this);N>-1&&this._parentContainer.lights.splice(N,1),this._parentContainer=null}for(const d of this.va().meshes)d._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.va().removeLight(this),super.dispose(N,Z)}getTypeID(){return 0}getScaledIntensity(){return this._photometricScale*this.kj}clone(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const d=D.GetConstructorFromName(this.getTypeID(),N,this.va());if(!d)return null;const X=B.c.Clone(d,this);return N&&(X.name=N),Z&&(X.parent=Z),X.wg(this.isEnabled()),this.onClonedObservable.notifyObservers(X),X}serialize(){const N=B.c.Serialize(this);return N.uniqueId=this.uniqueId,N.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(N),this.excludedMeshes.length>0&&(N.excludedMeshesIds=[],this.excludedMeshes.forEach((Z=>{N.excludedMeshesIds.push(Z.id)}))),this.includedOnlyMeshes.length>0&&(N.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach((Z=>{N.includedOnlyMeshesIds.push(Z.id)}))),B.c.AppendSerializedAnimations(this,N),N.ranges=this.serializeAnimationRanges(),N.isEnabled=this.isEnabled(),N}static GetConstructorFromName(N,Z,d){const X=w.e.Construct("Light_Type_"+N,Z,d);return X||null}static Parse(N,Z){const d=D.GetConstructorFromName(N.type,N.name,Z);if(!d)return null;const X=B.c.Parse(d,N,Z);if(N.excludedMeshesIds&&(X._excludedMeshesIds=N.excludedMeshesIds),N.includedOnlyMeshesIds&&(X._includedOnlyMeshesIds=N.includedOnlyMeshesIds),void 0!==N.parentId&&(X._waitingParentId=N.parentId),void 0!==N.parentInstanceIndex&&(X._waitingParentInstanceIndex=N.parentInstanceIndex),void 0!==N.falloffType&&(X.falloffType=N.falloffType),void 0!==N.lightmapMode&&(X.lightmapMode=N.lightmapMode),N.animations){for(let Z=0;Z<N.animations.length;Z++){const d=N.animations[Z],I=(0,e.d)("BABYLON.Animation");I&&X.animations.push(I.Parse(d))}w.e.ParseAnimationRanges(X,N,Z)}return N.autoAnimate&&Z.beginAnimation(X,N.autoAnimateFrom,N.autoAnimateTo,N.autoAnimateLoop,N.autoAnimateSpeed||1),void 0!==N.isEnabled&&X.wg(N.isEnabled),X}_hookArrayForExcluded(N){var Z=this;const d=N.push;N.push=function(){for(var X=arguments.length,I=new Array(X),m=0;m<X;m++)I[m]=arguments[m];const z=d.apply(N,I);for(const N of I)N._resyncLightSource(Z);return z};const X=N.splice;N.splice=(Z,d)=>{const I=X.apply(N,[Z,d]);for(const N of I)N._resyncLightSource(this);return I};for(const I of N)I._resyncLightSource(this)}_hookArrayForIncludedOnly(N){var Z=this;const d=N.push;N.push=function(){for(var X=arguments.length,I=new Array(X),m=0;m<X;m++)I[m]=arguments[m];const z=d.apply(N,I);return Z._resyncMeshes(),z};const X=N.splice;N.splice=(Z,d)=>{const I=X.apply(N,[Z,d]);return this._resyncMeshes(),I},this._resyncMeshes()}_resyncMeshes(){for(const N of this.va().meshes)N._resyncLightSource(this)}_markMeshesAsLightDirty(){for(const N of this.va().meshes)-1!==N.lightSources.indexOf(this)&&N._markSubMeshesAsLightDirty()}_computePhotometricScale(){this._photometricScale=this._getPhotometricScale(),this.va().resetCachedMaterial()}_getPhotometricScale(){let N=0;const Z=this.getTypeID();let d=this.intensityMode;switch(d===D.INTENSITYMODE_AUTOMATIC&&(d=Z===D.LIGHTTYPEID_DIRECTIONALLIGHT?D.INTENSITYMODE_ILLUMINANCE:D.INTENSITYMODE_LUMINOUSINTENSITY),Z){case D.LIGHTTYPEID_POINTLIGHT:case D.LIGHTTYPEID_SPOTLIGHT:switch(d){case D.INTENSITYMODE_LUMINOUSPOWER:N=1/(4*Math.PI);break;case D.INTENSITYMODE_LUMINOUSINTENSITY:N=1;break;case D.INTENSITYMODE_LUMINANCE:N=this.i*this.i}break;case D.LIGHTTYPEID_DIRECTIONALLIGHT:switch(d){case D.INTENSITYMODE_ILLUMINANCE:N=1;break;case D.INTENSITYMODE_LUMINANCE:{let Z=this.i;Z=Math.max(Z,.001);N=2*Math.PI*(1-Math.cos(Z));break}}break;case D.LIGHTTYPEID_HEMISPHERICLIGHT:N=1}return N}_reorderLightsInScene(){const N=this.va();0!=this._renderPriority&&(N.requireLightSorting=!0),this.va().sortLightsByPriority()}}D.FALLOFF_DEFAULT=j.c.FALLOFF_DEFAULT,D.FALLOFF_PHYSICAL=j.c.FALLOFF_PHYSICAL,D.FALLOFF_GLTF=j.c.FALLOFF_GLTF,D.FALLOFF_STANDARD=j.c.FALLOFF_STANDARD,D.LIGHTMAP_DEFAULT=j.c.LIGHTMAP_DEFAULT,D.LIGHTMAP_SPECULAR=j.c.LIGHTMAP_SPECULAR,D.LIGHTMAP_SHADOWSONLY=j.c.LIGHTMAP_SHADOWSONLY,D.INTENSITYMODE_AUTOMATIC=j.c.INTENSITYMODE_AUTOMATIC,D.INTENSITYMODE_LUMINOUSPOWER=j.c.INTENSITYMODE_LUMINOUSPOWER,D.INTENSITYMODE_LUMINOUSINTENSITY=j.c.INTENSITYMODE_LUMINOUSINTENSITY,D.INTENSITYMODE_ILLUMINANCE=j.c.INTENSITYMODE_ILLUMINANCE,D.INTENSITYMODE_LUMINANCE=j.c.INTENSITYMODE_LUMINANCE,D.LIGHTTYPEID_POINTLIGHT=j.c.LIGHTTYPEID_POINTLIGHT,D.LIGHTTYPEID_DIRECTIONALLIGHT=j.c.LIGHTTYPEID_DIRECTIONALLIGHT,D.LIGHTTYPEID_SPOTLIGHT=j.c.LIGHTTYPEID_SPOTLIGHT,D.LIGHTTYPEID_HEMISPHERICLIGHT=j.c.LIGHTTYPEID_HEMISPHERICLIGHT,(0,X.d)([(0,I.m)()],D.prototype,"diffuse",void 0),(0,X.d)([(0,I.m)()],D.prototype,"specular",void 0),(0,X.d)([(0,I.I)()],D.prototype,"falloffType",void 0),(0,X.d)([(0,I.I)()],D.prototype,"intensity",void 0),(0,X.d)([(0,I.I)()],D.prototype,"range",null),(0,X.d)([(0,I.I)()],D.prototype,"intensityMode",null),(0,X.d)([(0,I.I)()],D.prototype,"i",null),(0,X.d)([(0,I.I)()],D.prototype,"_renderPriority",void 0),(0,X.d)([(0,I.b)("_reorderLightsInScene")],D.prototype,"renderPriority",void 0),(0,X.d)([(0,I.I)("shadowEnabled")],D.prototype,"_shadowEnabled",void 0),(0,X.d)([(0,I.I)("excludeWithLayerMask")],D.prototype,"_excludeWithLayerMask",void 0),(0,X.d)([(0,I.I)("includeOnlyWithLayerMask")],D.prototype,"_includeOnlyWithLayerMask",void 0),(0,X.d)([(0,I.I)("lightmapMode")],D.prototype,"_lightmapMode",void 0)},11788:(N,Z,d)=>{"use strict";d.d(Z,{c:()=>S});var X=d(942),I=d(949),m=d(960),z=d(11753),w=d(1388);class S extends z.d{constructor(){super(...arguments),this._needProjectionMatrixCompute=!0,this._viewMatrix=m.c.Identity(),this._projectionMatrix=m.c.Identity()}_setPosition(N){this._position=N}get position(){return this._position}set position(N){this._setPosition(N)}_setDirection(N){this._direction=N}get direction(){return this._direction}set direction(N){this._setDirection(N)}get shadowMinZ(){return this._shadowMinZ}set shadowMinZ(N){this._shadowMinZ=N,this.forceProjectionMatrixCompute()}get shadowMaxZ(){return this._shadowMaxZ}set shadowMaxZ(N){this._shadowMaxZ=N,this.forceProjectionMatrixCompute()}computeTransformedInformation(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=m.n.Zero()),m.n.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=m.n.Zero()),m.n.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)}getDepthScale(){return 50}getShadowDirection(N){return this.transformedDirection?this.transformedDirection:this.direction}getAbsolutePosition(){return this.transformedPosition?this.transformedPosition:this.position}setDirectionToTarget(N){return this.direction=m.n.Normalize(N.rc(this.position)),this.direction}getRotation(){this.direction.normalize();const N=m.n.Cross(this.direction,w.d.Y),Z=m.n.Cross(N,this.direction);return m.n.RotationFromAxis(N,Z,this.direction)}needCube(){return!1}needProjectionMatrixCompute(){return this._needProjectionMatrixCompute}forceProjectionMatrixCompute(){this._needProjectionMatrixCompute=!0}_initCache(){super._initCache(),this._cache.position=m.n.Zero()}_isSynchronized(){return!!this._cache.position.equals(this.position)}be(N){return!N&&this.isSynchronized()?(this._currentRenderId=this.va().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.p(this.position),this._worldMatrix||(this._worldMatrix=m.c.Identity()),m.c.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)}getDepthMinZ(N){return void 0!==this.shadowMinZ?this.shadowMinZ:N.gj}getDepthMaxZ(N){return void 0!==this.shadowMaxZ?this.shadowMaxZ:N.maxZ}setShadowProjectionMatrix(N,Z,d){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(Z,d,N):this._setDefaultShadowProjectionMatrix(N,Z,d),this}_syncParentEnabledState(){super._syncParentEnabledState(),this.parent&&this.parent.getWorldMatrix||(this.transformedPosition=null,this.transformedDirection=null)}getViewMatrix(N){const Z=m.h.kd[0];let d=this.position;this.computeTransformedInformation()&&(d=this.transformedPosition),m.n.NormalizeToRef(this.getShadowDirection(N),Z),1===Math.abs(m.n.Dot(Z,m.n.Up()))&&(Z.z=1e-13);const X=m.h.kd[1];return d.addToRef(Z,X),m.c.LookAtLHToRef(d,X,m.n.Up(),this._viewMatrix),this._viewMatrix}getProjectionMatrix(N,Z){return this.setShadowProjectionMatrix(this._projectionMatrix,N??this._viewMatrix,Z??[]),this._projectionMatrix}}(0,X.d)([(0,I.H)()],S.prototype,"position",null),(0,X.d)([(0,I.H)()],S.prototype,"direction",null),(0,X.d)([(0,I.I)()],S.prototype,"shadowMinZ",null),(0,X.d)([(0,I.I)()],S.prototype,"shadowMaxZ",null)},11482:(N,Z,d)=>{"use strict";d.d(Z,{b:()=>z,e:()=>m,i:()=>w});const X={},I={};function m(N,Z){X[N]=Z}function z(N,Z){I[N]=Z}function w(N){return I[N]?I[N]:null}},11429:(N,Z,d)=>{"use strict";d.d(Z,{d:()=>J,h:()=>n});var X,I=d(1133),m=d(958),z=d(1131),w=d(986),S=d(1051),e=d(11361),j=d(1008),B=d(1023),D=d(1004),v=d(1060);!function(N){N[N.Clean=0]="Clean",N[N.Stop=1]="Stop",N[N.Sync=2]="Sync",N[N.NoSync=3]="NoSync"}(X||(X={}));const T=new m.d,k={};let h=!1;function U(){return k[".babylon"]}function C(N){const Z=k[N];return Z||(S.e.Warn("Unable to find a plugin to load "+N+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),U())}function M(N,Z,d){let X="Unable to load from "+(N.rawData?"binary data":N.url);return Z?X+=`: ${Z}`:d&&(X+=`: ${d}`),X}function Q(N,Z,d,X,I,m,z,w,S){var e;const B="data:"===(D=N.url).substring(0,5)?D.substring(5):null;var D;if(N.rawData&&!z)throw"When using ArrayBufferView to load data the file extension must be provided.";const h=z?C(z):B?function(N){for(const Z in k){const d=k[Z].plugin;if(d.canDirectLoad&&d.canDirectLoad(N))return k[Z]}return U()}(N.url):function(N){const Z=N.indexOf("?");-1!==Z&&(N=N.substring(0,Z));const d=N.lastIndexOf(".");return C(N.substring(d,N.length).toLowerCase())}(N.url);if(!h)throw new Error(`No plugin or fallback for ${z??N.url}`);if(!1===(null===S||void 0===S||null===(e=S[h.plugin.name])||void 0===e?void 0:e.enabled))throw new Error(`The '${h.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(N.rawData&&!h.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(N=>{if(h.plugin.createPlugin){const Z=h.plugin.createPlugin(S??{});return Z instanceof Promise?(Z.then(N).catch((N=>{I("Error instantiating plugin.",N)})),null):(N(Z),Z)}return N(h.plugin),h.plugin})((S=>{var e;if(!S)throw`The loader plugin corresponding to the '${z}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(T.notifyObservers(S),B&&(S.canDirectLoad&&S.canDirectLoad(N.url)||!(0,j.j)(N.url))){if(S.directLoad){const N=S.directLoad(Z,B);N instanceof Promise?N.then((N=>{d(S,N)})).catch((N=>{I("Error in directLoad of _loadData: "+N,N)})):d(S,N)}else d(S,B);return}const D=h.isBinary,k=(N,X)=>{Z.u?I("Scene has been disposed"):d(S,N,X)};let U=null,C=!1;null===(e=S.pd)||void 0===e||e.add((()=>{C=!0,U&&(U.abort(),U=null),m()}));const M=()=>{if(C)return;const d=(N,Z)=>{I(null===N||void 0===N?void 0:N.statusText,Z)};if(!S.loadFile&&N.rawData)throw"Plugin does not support loading ArrayBufferView.";U=S.loadFile?S.loadFile(Z,N.rawData||N.file||N.url,N.rootUrl,k,X,D,d,w):Z._loadFile(N.file||N.url,k,X,!0,D,d)},Q=Z.getEngine();let A=Q.enableOfflineSupport;if(A){let d=!1;for(const X of Z.disableOfflineSupportExceptionRules)if(X.test(N.url)){d=!0;break}A=!d}A&&v.c.OfflineProviderFactory?Z.offlineProvider=v.c.OfflineProviderFactory(N.url,M,Q.disableManifestCheck):M()}))}function A(N,Z){let d,X,m=null,z=null;if(Z)if(Z.name)d=`file:${Z.name}`,X=Z.name,m=Z;else if(ArrayBuffer.isView(Z))d="",X=(0,D.e)(),z=Z;else if(Z.startsWith("data:"))d=Z,X="";else if(N){const m=Z;if("/"===m.substring(0,1))return I.g.Error("Wrong sceneFilename parameter"),null;d=N+m,X=m}else d=Z,X=I.g.GetFilename(Z),N=I.g.GetFolderPath(Z);else d=N,X=I.g.GetFilename(N),N=I.g.GetFolderPath(N);return{url:d,rootUrl:N,name:X,file:m,rawData:z}}function n(N){if("string"===typeof N.extensions){const Z=N.extensions;k[Z.toLowerCase()]={plugin:N,isBinary:!1}}else{const Z=N.extensions;Object.keys(Z).forEach((d=>{k[d.toLowerCase()]={plugin:N,isBinary:Z[d].isBinary}}))}}function g(N,Z){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:w.e.LastCreatedScene,I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,e=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,j=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",D=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!X)return S.e.Error("No scene available to import mesh to"),null;const v=A(Z,d);if(!v)return null;const T={};X.addPendingData(T);const k=()=>{X.removePendingData(T)},h=(N,Z)=>{const d=M(v,N,Z);z?z(X,d,new B.f(d,B.c.SceneLoaderError,Z)):S.e.Error(d),k()},U=m?N=>{try{m(N)}catch(Z){h("Error in onProgress callback: "+Z,Z)}}:void 0,C=(N,Z,d,m,z,w,S,e)=>{if(X.importedMeshesFiles.push(v.url),I)try{I(N,Z,d,m,z,w,S,e)}catch(j){h("Error in onSuccess callback: "+j,j)}X.removePendingData(T)};return Q(v,X,((Z,d,I)=>{if(Z.rewriteRootURL&&(v.rootUrl=Z.rewriteRootURL(v.rootUrl,I)),Z.importMesh){const I=[],m=[],z=[];if(!Z.importMesh(N,X,d,v.rootUrl,I,m,z,h))return;X.loadingPluginName=Z.name,C(I,m,z,[],[],[],[],[])}else{Z.importMeshAsync(N,X,d,v.rootUrl,U,v.name).then((N=>{X.loadingPluginName=Z.name,C(N.meshes,N.Od,N.skeletons,N.animationGroups,N.transformNodes,N.geometries,N.lights,N.spriteManagers)})).catch((N=>{h(N.message,N)}))}}),U,h,k,e,j,D)}function E(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:w.e.LastCreatedEngine,X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,m=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,e=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,j=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",B=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};return d?O(N,Z,new z.e(d),X,m,S,e,j,B):(I.g.Error("No engine available"),null)}function V(N,Z,d,X,I,m,z){return new Promise(((w,S)=>{E(N,Z,d,(N=>{w(N)}),X,((N,Z,d)=>{S(d||new Error(Z))}),I,m,z)}))}function O(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:w.e.LastCreatedScene,X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,j=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",D=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!d)return S.e.Error("No scene available to append to"),null;const v=A(N,Z);if(!v)return null;const T={};d.addPendingData(T);const k=()=>{d.removePendingData(T)};e.b.ShowLoadingScreen&&!h&&(h=!0,d.getEngine().displayLoadingUI(),d.executeWhenReady((()=>{d.getEngine().hideLoadingUI(),h=!1})));const U=(N,Z)=>{const X=M(v,N,Z);m?m(d,X,new B.f(X,B.c.SceneLoaderError,Z)):S.e.Error(X),k()},C=I?N=>{try{I(N)}catch(Z){U("Error in onProgress callback",Z)}}:void 0,n=()=>{if(X)try{X(d)}catch(N){U("Error in onSuccess callback",N)}d.removePendingData(T)};return Q(v,d,((N,Z)=>{if(N.load){if(!N.load(d,Z,v.rootUrl,U))return;d.loadingPluginName=N.name,n()}else{N.loadAsync(d,Z,v.rootUrl,C,v.name).then((()=>{d.loadingPluginName=N.name,n()})).catch((N=>{U(N.message,N)}))}}),C,U,k,z,j,D)}function K(N,Z,d,X,I,m,z){return new Promise(((w,S)=>{O(N,Z,d,(N=>{w(N)}),X,((N,Z,d)=>{S(d||new Error(Z))}),I,m,z)}))}function r(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:w.e.LastCreatedScene,X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,e=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",j=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!d)return S.e.Error("No scene available to load asset container to"),null;const D=A(N,Z);if(!D)return null;const v={};d.addPendingData(v);const T=()=>{d.removePendingData(v)},k=(N,Z)=>{const X=M(D,N,Z);m?m(d,X,new B.f(X,B.c.SceneLoaderError,Z)):S.e.Error(X),T()},h=I?N=>{try{I(N)}catch(Z){k("Error in onProgress callback",Z)}}:void 0,U=N=>{if(X)try{X(N)}catch(Z){k("Error in onSuccess callback",Z)}d.removePendingData(v)};return Q(D,d,((N,Z)=>{if(N.loadAssetContainer){const X=N.loadAssetContainer(d,Z,D.rootUrl,k);if(!X)return;X.populateRootNodes(),d.loadingPluginName=N.name,U(X)}else if(N.loadAssetContainerAsync){N.loadAssetContainerAsync(d,Z,D.rootUrl,h,D.name).then((Z=>{Z.populateRootNodes(),d.loadingPluginName=N.name,U(Z)})).catch((N=>{k(N.message,N)}))}else k("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),h,k,T,z,e,j)}function P(N,Z,d,X,I,m,z){return new Promise(((w,S)=>{r(N,Z,d,(N=>{w(N)}),X,((N,Z,d)=>{S(d||new Error(Z))}),I,m,z)}))}function W(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:w.e.LastCreatedScene,X=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,e=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,j=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,B=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,D=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",v=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!d)return void S.e.Error("No scene available to load animations to");if(X){for(const N of d.animatables)N.reset();d.stopAllAnimations(),d.animationGroups.slice().forEach((N=>{N.dispose()}));d.getNodes().forEach((N=>{N.animations&&(N.animations=[])}))}else switch(I){case 0:d.animationGroups.slice().forEach((N=>{N.dispose()}));break;case 1:d.animationGroups.forEach((N=>{N.stop()}));break;case 2:d.animationGroups.forEach((N=>{N.reset(),N.restart()}));break;case 3:break;default:return void S.e.Error("Unknown animation group loading mode value '"+I+"'")}const T=d.animatables.length;r(N,Z,d,(N=>{N.mergeAnimationsTo(d,d.animatables.slice(T),m),N.dispose(),d.onAnimationFileImportedObservable.notifyObservers(d),z&&z(d)}),e,j,B,D,v)}function b(N,Z,d,X,I,m,z,w,S,e){return new Promise(((j,B)=>{W(N,Z,d,X,I,m,(N=>{j(N)}),z,((N,Z,d)=>{B(d||new Error(Z))}),w,S,e)}))}class J{static get ForceFullSceneLoadingForIncremental(){return e.b.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(N){e.b.ForceFullSceneLoadingForIncremental=N}static get ShowLoadingScreen(){return e.b.ShowLoadingScreen}static set ShowLoadingScreen(N){e.b.ShowLoadingScreen=N}static get loggingLevel(){return e.b.loggingLevel}static set loggingLevel(N){e.b.loggingLevel=N}static get CleanBoneMatrixWeights(){return e.b.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(N){e.b.CleanBoneMatrixWeights=N}static GetDefaultPlugin(){return U()}static GetPluginForExtension(N){var Z;return null===(Z=C(N))||void 0===Z?void 0:Z.plugin}static IsPluginForExtensionAvailable(N){return function(N){return!!k[N]}(N)}static RegisterPlugin(N){n(N)}static ImportMesh(N,Z,d,X,I,m,z,w,S){return g(N,Z,d,X,I,m,z,w,S)}static ImportMeshAsync(N,Z,d,X,I,m,z){return function(N,Z,d,X,I,m,z,w){return new Promise(((S,e)=>{g(N,Z,d,X,((N,Z,d,X,I,m,z,w)=>{S({meshes:N,Od:Z,skeletons:d,animationGroups:X,transformNodes:I,geometries:m,lights:z,spriteManagers:w})}),I,((N,Z,d)=>{e(d||new Error(Z))}),m,z,w)}))}(N,Z,d,X,I,m,z)}static Load(N,Z,d,X,I,m,z,w){return E(N,Z,d,X,I,m,z,w)}static LoadAsync(N,Z,d,X,I,m){return V(N,Z,d,X,I,m)}static Append(N,Z,d,X,I,m,z,w){return O(N,Z,d,X,I,m,z,w)}static AppendAsync(N,Z,d,X,I,m){return K(N,Z,d,X,I,m)}static LoadAssetContainer(N,Z,d,X,I,m,z,w){return r(N,Z,d,X,I,m,z,w)}static LoadAssetContainerAsync(N,Z,d,X,I,m){return P(N,Z,d,X,I,m)}static ImportAnimations(N,Z,d,X,I,m,z,w,S,e,j){W(N,Z,d,X,I,m,z,w,S,e,j)}static ImportAnimationsAsync(N,Z,d,X,I,m,z,w,S,e,j){return b(N,Z,d,X,I,m,w,e,j)}}J.NO_LOGGING=0,J.MINIMAL_LOGGING=1,J.SUMMARY_LOGGING=2,J.DETAILED_LOGGING=3,J.OnPluginActivatedObservable=T},11361:(N,Z,d)=>{"use strict";d.d(Z,{b:()=>X});class X{static get ForceFullSceneLoadingForIncremental(){return X._ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(N){X._ForceFullSceneLoadingForIncremental=N}static get ShowLoadingScreen(){return X._ShowLoadingScreen}static set ShowLoadingScreen(N){X._ShowLoadingScreen=N}static get loggingLevel(){return X._LoggingLevel}static set loggingLevel(N){X._LoggingLevel=N}static get CleanBoneMatrixWeights(){return X._CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(N){X._CleanBoneMatrixWeights=N}}X._ForceFullSceneLoadingForIncremental=!1,X._ShowLoadingScreen=!0,X._CleanBoneMatrixWeights=!1,X._LoggingLevel=0},11733:(N,Z,d)=>{"use strict";d.d(Z,{b:()=>s});var X=d(942),I=d(949),m=d(1051),z=d(1125),w=d(11728),S=d(1131),e=d(960),j=d(1169),B=d(1293),D=d(1310);class v extends B.b{constructor(){super(...arguments),this.BRDF_V_HEIGHT_CORRELATED=!1,this.MS_BRDF_ENERGY_CONSERVATION=!1,this.SPHERICAL_HARMONICS=!1,this.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1}}class T extends D.b{_markAllSubMeshesAsMiscDirty(){this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(N){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(N,"PBRBRDF",90,new v,Z),this._useEnergyConservation=T.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=T.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=T.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=T.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=T.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=T.DEFAULT_USE_SPHERICAL_HARMONICS,this._useSpecularGlossinessInputEnergyConservation=T.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this.useSpecularGlossinessInputEnergyConservation=T.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this._internalMarkAllSubMeshesAsMiscDirty=N._dirtyCallbacks[16],this._enable(!0)}prepareDefines(N){N.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,N.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,N.SPHERICAL_HARMONICS=this._useSphericalHarmonics,N.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation}getClassName(){return"PBRBRDFConfiguration"}}T.DEFAULT_USE_ENERGY_CONSERVATION=!0,T.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,T.DEFAULT_USE_SPHERICAL_HARMONICS=!0,T.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0,(0,X.d)([(0,I.I)(),(0,I.b)("_markAllSubMeshesAsMiscDirty")],T.prototype,"useEnergyConservation",void 0),(0,X.d)([(0,I.I)(),(0,I.b)("_markAllSubMeshesAsMiscDirty")],T.prototype,"useSmithVisibilityHeightCorrelated",void 0),(0,X.d)([(0,I.I)(),(0,I.b)("_markAllSubMeshesAsMiscDirty")],T.prototype,"useSphericalHarmonics",void 0),(0,X.d)([(0,I.I)(),(0,I.b)("_markAllSubMeshesAsMiscDirty")],T.prototype,"useSpecularGlossinessInputEnergyConservation",void 0);var k=d(1240),h=d(1108),U=d(1150),C=d(1249),M=d(1297),Q=d(938),A=d(1301),n=(d(10263),d(1303)),g=d(1285);class E extends B.b{constructor(){super(...arguments),this.CLEARCOAT=!1,this.CLEARCOAT_DEFAULTIOR=!1,this.CLEARCOAT_TEXTURE=!1,this.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this.CLEARCOAT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,this.CLEARCOAT_BUMP=!1,this.CLEARCOAT_BUMPDIRECTUV=0,this.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,this.CLEARCOAT_REMAP_F0=!1,this.CLEARCOAT_TINT=!1,this.CLEARCOAT_TINT_TEXTURE=!1,this.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TINT_GAMMATEXTURE=!1}}class V extends D.b{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(N){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(N,"PBRClearCoat",100,new E,Z),this._isEnabled=!1,this.isEnabled=!1,this.kj=1,this.roughness=0,this._indexOfRefraction=V._DefaultIndexOfRefraction,this.indexOfRefraction=V._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._textureRoughness=null,this.textureRoughness=null,this._remapF0OnInterfaceChange=!0,this.remapF0OnInterfaceChange=!0,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=h.b.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=N._dirtyCallbacks[1]}isReadyForSubMesh(N,Z,d){if(!this._isEnabled)return!0;const X=this._material._disableBumpMap;if(N._areTexturesDirty&&Z.texturesEnabled){if(this._texture&&A.c.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&A.c.ClearCoatTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1;if(d.getCaps().standardDerivatives&&this._bumpTexture&&A.c.ClearCoatBumpTextureEnabled&&!X&&!this._bumpTexture.isReady())return!1;if(this._isTintEnabled&&this._tintTexture&&A.c.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(N,Z){this._isEnabled?(N.CLEARCOAT=!0,N.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,N.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange,N._areTexturesDirty&&Z.texturesEnabled&&(this._texture&&A.c.ClearCoatTextureEnabled?(0,g.J)(this._texture,N,"CLEARCOAT_TEXTURE"):N.CLEARCOAT_TEXTURE=!1,this._textureRoughness&&A.c.ClearCoatTextureEnabled?(0,g.J)(this._textureRoughness,N,"CLEARCOAT_TEXTURE_ROUGHNESS"):N.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this._bumpTexture&&A.c.ClearCoatBumpTextureEnabled?(0,g.J)(this._bumpTexture,N,"CLEARCOAT_BUMP"):N.CLEARCOAT_BUMP=!1,N.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===V._DefaultIndexOfRefraction,this._isTintEnabled?(N.CLEARCOAT_TINT=!0,this._tintTexture&&A.c.ClearCoatTintTextureEnabled?((0,g.J)(this._tintTexture,N,"CLEARCOAT_TINT_TEXTURE"),N.CLEARCOAT_TINT_GAMMATEXTURE=this._tintTexture.gammaSpace):N.CLEARCOAT_TINT_TEXTURE=!1):(N.CLEARCOAT_TINT=!1,N.CLEARCOAT_TINT_TEXTURE=!1))):(N.CLEARCOAT=!1,N.CLEARCOAT_TEXTURE=!1,N.CLEARCOAT_TEXTURE_ROUGHNESS=!1,N.CLEARCOAT_BUMP=!1,N.CLEARCOAT_TINT=!1,N.CLEARCOAT_TINT_TEXTURE=!1,N.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,N.CLEARCOAT_DEFAULTIOR=!1,N.CLEARCOAT_TEXTUREDIRECTUV=0,N.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,N.CLEARCOAT_BUMPDIRECTUV=0,N.CLEARCOAT_REMAP_F0=!1,N.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,N.CLEARCOAT_TINT_GAMMATEXTURE=!1)}bindForSubMesh(N,Z,d,X){if(!this._isEnabled)return;const I=X.materialDefines,m=this._material.isFrozen,z=this._material._disableBumpMap,w=this._material._invertNormalMapX,S=this._material._invertNormalMapY;if(!N.useUbo||!m||!N.isSync){var e,j,B,D;if((this._texture||this._textureRoughness)&&A.c.ClearCoatTextureEnabled)N.updateFloat4("vClearCoatInfos",(null===(e=this._texture)||void 0===e?void 0:e.coordinatesIndex)??0,(null===(j=this._texture)||void 0===j?void 0:j.level)??0,(null===(B=this._textureRoughness)||void 0===B?void 0:B.coordinatesIndex)??0,(null===(D=this._textureRoughness)||void 0===D?void 0:D.level)??0),this._texture&&(0,g.t)(this._texture,N,"clearCoat"),this._textureRoughness&&!I.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,g.t)(this._textureRoughness,N,"clearCoatRoughness");this._bumpTexture&&d.getCaps().standardDerivatives&&A.c.ClearCoatTextureEnabled&&!z&&(N.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),(0,g.t)(this._bumpTexture,N,"clearCoatBump"),Z._mirroredCameraPosition?N.updateFloat2("vClearCoatTangentSpaceParams",w?1:-1,S?1:-1):N.updateFloat2("vClearCoatTangentSpaceParams",w?-1:1,S?-1:1)),this._tintTexture&&A.c.ClearCoatTintTextureEnabled&&(N.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),(0,g.t)(this._tintTexture,N,"clearCoatTint")),N.updateFloat2("vClearCoatParams",this.kj,this.roughness);const X=1-this._indexOfRefraction,m=1+this._indexOfRefraction,v=Math.pow(-X/m,2),T=1/this._indexOfRefraction;N.updateFloat4("vClearCoatRefractionParams",v,T,X,m),this._isTintEnabled&&(N.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),N.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}Z.texturesEnabled&&(this._texture&&A.c.ClearCoatTextureEnabled&&N.setTexture("clearCoatSampler",this._texture),this._textureRoughness&&!I.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&A.c.ClearCoatTextureEnabled&&N.setTexture("clearCoatRoughnessSampler",this._textureRoughness),this._bumpTexture&&d.getCaps().standardDerivatives&&A.c.ClearCoatBumpTextureEnabled&&!z&&N.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&A.c.ClearCoatTintTextureEnabled&&N.setTexture("clearCoatTintSampler",this._tintTexture))}hasTexture(N){return this._texture===N||(this._textureRoughness===N||(this._bumpTexture===N||this._tintTexture===N))}getActiveTextures(N){this._texture&&N.push(this._texture),this._textureRoughness&&N.push(this._textureRoughness),this._bumpTexture&&N.push(this._bumpTexture),this._tintTexture&&N.push(this._tintTexture)}getAnimatables(N){this._texture&&this._texture.animations&&this._texture.animations.length>0&&N.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&N.push(this._textureRoughness),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&N.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&N.push(this._tintTexture)}dispose(N){var Z,d,X,I;N&&(null===(Z=this._texture)||void 0===Z||Z.dispose(),null===(d=this._textureRoughness)||void 0===d||d.dispose(),null===(X=this._bumpTexture)||void 0===X||X.dispose(),null===(I=this._tintTexture)||void 0===I||I.dispose())}getClassName(){return"PBRClearCoatConfiguration"}addFallbacks(N,Z,d){return N.CLEARCOAT_BUMP&&Z.addFallback(d++,"CLEARCOAT_BUMP"),N.CLEARCOAT_TINT&&Z.addFallback(d++,"CLEARCOAT_TINT"),N.CLEARCOAT&&Z.addFallback(d++,"CLEARCOAT"),d}getSamplers(N){N.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler")}getUniforms(){return{ubo:[{name:"vClearCoatParams",size:2,type:"vec2"},{name:"vClearCoatRefractionParams",size:4,type:"vec4"},{name:"vClearCoatInfos",size:4,type:"vec4"},{name:"clearCoatMatrix",size:16,type:"mat4"},{name:"clearCoatRoughnessMatrix",size:16,type:"mat4"},{name:"vClearCoatBumpInfos",size:2,type:"vec2"},{name:"vClearCoatTangentSpaceParams",size:2,type:"vec2"},{name:"clearCoatBumpMatrix",size:16,type:"mat4"},{name:"vClearCoatTintParams",size:4,type:"vec4"},{name:"clearCoatColorAtDistance",size:1,type:"float"},{name:"vClearCoatTintInfos",size:2,type:"vec2"},{name:"clearCoatTintMatrix",size:16,type:"mat4"}]}}}V._DefaultIndexOfRefraction=1.5,(0,X.d)([(0,I.I)(),(0,I.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"isEnabled",void 0),(0,X.d)([(0,I.I)()],V.prototype,"intensity",void 0),(0,X.d)([(0,I.I)()],V.prototype,"roughness",void 0),(0,X.d)([(0,I.I)(),(0,I.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"indexOfRefraction",void 0),(0,X.d)([(0,I.A)(),(0,I.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"texture",void 0),(0,X.d)([(0,I.I)(),(0,I.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"useRoughnessFromMainTexture",void 0),(0,X.d)([(0,I.A)(),(0,I.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"textureRoughness",void 0),(0,X.d)([(0,I.I)(),(0,I.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"remapF0OnInterfaceChange",void 0),(0,X.d)([(0,I.A)(),(0,I.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"bumpTexture",void 0),(0,X.d)([(0,I.I)(),(0,I.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"isTintEnabled",void 0),(0,X.d)([(0,I.m)()],V.prototype,"tintColor",void 0),(0,X.d)([(0,I.I)()],V.prototype,"tintColorAtDistance",void 0),(0,X.d)([(0,I.I)()],V.prototype,"tintThickness",void 0),(0,X.d)([(0,I.A)(),(0,I.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"tintTexture",void 0);class O extends B.b{constructor(){super(...arguments),this.IRIDESCENCE=!1,this.IRIDESCENCE_TEXTURE=!1,this.IRIDESCENCE_TEXTUREDIRECTUV=0,this.IRIDESCENCE_THICKNESS_TEXTURE=!1,this.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0}}class K extends D.b{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(N){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(N,"PBRIridescence",110,new O,Z),this._isEnabled=!1,this.isEnabled=!1,this.kj=1,this.minimumThickness=K._DefaultMinimumThickness,this.maximumThickness=K._DefaultMaximumThickness,this.indexOfRefraction=K._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._thicknessTexture=null,this.thicknessTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=N._dirtyCallbacks[1]}isReadyForSubMesh(N,Z){if(!this._isEnabled)return!0;if(N._areTexturesDirty&&Z.texturesEnabled){if(this._texture&&A.c.IridescenceTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._thicknessTexture&&A.c.IridescenceTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(N,Z){this._isEnabled?(N.IRIDESCENCE=!0,N._areTexturesDirty&&Z.texturesEnabled&&(this._texture&&A.c.IridescenceTextureEnabled?(0,g.J)(this._texture,N,"IRIDESCENCE_TEXTURE"):N.IRIDESCENCE_TEXTURE=!1,this._thicknessTexture&&A.c.IridescenceTextureEnabled?(0,g.J)(this._thicknessTexture,N,"IRIDESCENCE_THICKNESS_TEXTURE"):N.IRIDESCENCE_THICKNESS_TEXTURE=!1)):(N.IRIDESCENCE=!1,N.IRIDESCENCE_TEXTURE=!1,N.IRIDESCENCE_THICKNESS_TEXTURE=!1,N.IRIDESCENCE_TEXTUREDIRECTUV=0,N.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0)}bindForSubMesh(N,Z){if(!this._isEnabled)return;const d=this._material.isFrozen;if(!N.useUbo||!d||!N.isSync){var X,I,m,z;if((this._texture||this._thicknessTexture)&&A.c.IridescenceTextureEnabled)N.updateFloat4("vIridescenceInfos",(null===(X=this._texture)||void 0===X?void 0:X.coordinatesIndex)??0,(null===(I=this._texture)||void 0===I?void 0:I.level)??0,(null===(m=this._thicknessTexture)||void 0===m?void 0:m.coordinatesIndex)??0,(null===(z=this._thicknessTexture)||void 0===z?void 0:z.level)??0),this._texture&&(0,g.t)(this._texture,N,"iridescence"),this._thicknessTexture&&(0,g.t)(this._thicknessTexture,N,"iridescenceThickness");N.updateFloat4("vIridescenceParams",this.kj,this.indexOfRefraction,this.minimumThickness,this.maximumThickness)}Z.texturesEnabled&&(this._texture&&A.c.IridescenceTextureEnabled&&N.setTexture("iridescenceSampler",this._texture),this._thicknessTexture&&A.c.IridescenceTextureEnabled&&N.setTexture("iridescenceThicknessSampler",this._thicknessTexture))}hasTexture(N){return this._texture===N||this._thicknessTexture===N}getActiveTextures(N){this._texture&&N.push(this._texture),this._thicknessTexture&&N.push(this._thicknessTexture)}getAnimatables(N){this._texture&&this._texture.animations&&this._texture.animations.length>0&&N.push(this._texture),this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&N.push(this._thicknessTexture)}dispose(N){var Z,d;N&&(null===(Z=this._texture)||void 0===Z||Z.dispose(),null===(d=this._thicknessTexture)||void 0===d||d.dispose())}getClassName(){return"PBRIridescenceConfiguration"}addFallbacks(N,Z,d){return N.IRIDESCENCE&&Z.addFallback(d++,"IRIDESCENCE"),d}getSamplers(N){N.push("iridescenceSampler","iridescenceThicknessSampler")}getUniforms(){return{ubo:[{name:"vIridescenceParams",size:4,type:"vec4"},{name:"vIridescenceInfos",size:4,type:"vec4"},{name:"iridescenceMatrix",size:16,type:"mat4"},{name:"iridescenceThicknessMatrix",size:16,type:"mat4"}]}}}K._DefaultMinimumThickness=100,K._DefaultMaximumThickness=400,K._DefaultIndexOfRefraction=1.3,(0,X.d)([(0,I.I)(),(0,I.b)("_markAllSubMeshesAsTexturesDirty")],K.prototype,"isEnabled",void 0),(0,X.d)([(0,I.I)()],K.prototype,"intensity",void 0),(0,X.d)([(0,I.I)()],K.prototype,"minimumThickness",void 0),(0,X.d)([(0,I.I)()],K.prototype,"maximumThickness",void 0),(0,X.d)([(0,I.I)()],K.prototype,"indexOfRefraction",void 0),(0,X.d)([(0,I.A)(),(0,I.b)("_markAllSubMeshesAsTexturesDirty")],K.prototype,"texture",void 0),(0,X.d)([(0,I.A)(),(0,I.b)("_markAllSubMeshesAsTexturesDirty")],K.prototype,"thicknessTexture",void 0);class r extends B.b{constructor(){super(...arguments),this.ANISOTROPIC=!1,this.ANISOTROPIC_TEXTURE=!1,this.ANISOTROPIC_TEXTUREDIRECTUV=0,this.ANISOTROPIC_LEGACY=!1,this.MAINUV1=!1}}class P extends D.b{set angle(N){this.direction.x=Math.cos(N),this.direction.y=Math.sin(N)}get angle(){return Math.atan2(this.direction.y,this.direction.x)}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markAllSubMeshesAsMiscDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(N){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(N,"PBRAnisotropic",110,new r,Z),this._isEnabled=!1,this.isEnabled=!1,this.kj=1,this.direction=new e.l(1,0),this._texture=null,this.texture=null,this._legacy=!1,this.legacy=!1,this._internalMarkAllSubMeshesAsTexturesDirty=N._dirtyCallbacks[1],this._internalMarkAllSubMeshesAsMiscDirty=N._dirtyCallbacks[16]}isReadyForSubMesh(N,Z){return!this._isEnabled||!(N._areTexturesDirty&&Z.texturesEnabled&&this._texture&&A.c.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())}prepareDefinesBeforeAttributes(N,Z,d){this._isEnabled?(N.ANISOTROPIC=this._isEnabled,this._isEnabled&&!d.isVerticesDataPresent(j.d.TangentKind)&&(N._needUVs=!0,N.MAINUV1=!0),N._areTexturesDirty&&Z.texturesEnabled&&(this._texture&&A.c.AnisotropicTextureEnabled?(0,g.J)(this._texture,N,"ANISOTROPIC_TEXTURE"):N.ANISOTROPIC_TEXTURE=!1),N._areMiscDirty&&(N.ANISOTROPIC_LEGACY=this._legacy)):(N.ANISOTROPIC=!1,N.ANISOTROPIC_TEXTURE=!1,N.ANISOTROPIC_TEXTUREDIRECTUV=0,N.ANISOTROPIC_LEGACY=!1)}bindForSubMesh(N,Z){if(!this._isEnabled)return;const d=this._material.isFrozen;N.useUbo&&d&&N.isSync||(this._texture&&A.c.AnisotropicTextureEnabled&&(N.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),(0,g.t)(this._texture,N,"anisotropy")),N.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.kj)),Z.texturesEnabled&&this._texture&&A.c.AnisotropicTextureEnabled&&N.setTexture("anisotropySampler",this._texture)}hasTexture(N){return this._texture===N}getActiveTextures(N){this._texture&&N.push(this._texture)}getAnimatables(N){this._texture&&this._texture.animations&&this._texture.animations.length>0&&N.push(this._texture)}dispose(N){N&&this._texture&&this._texture.dispose()}getClassName(){return"PBRAnisotropicConfiguration"}addFallbacks(N,Z,d){return N.ANISOTROPIC&&Z.addFallback(d++,"ANISOTROPIC"),d}getSamplers(N){N.push("anisotropySampler")}getUniforms(){return{ubo:[{name:"vAnisotropy",size:3,type:"vec3"},{name:"vAnisotropyInfos",size:2,type:"vec2"},{name:"anisotropyMatrix",size:16,type:"mat4"}]}}parse(N,Z,d){super.parse(N,Z,d),void 0===N.legacy&&(this.legacy=!0)}}(0,X.d)([(0,I.I)(),(0,I.b)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"isEnabled",void 0),(0,X.d)([(0,I.I)()],P.prototype,"intensity",void 0),(0,X.d)([(0,I.E)()],P.prototype,"direction",void 0),(0,X.d)([(0,I.A)(),(0,I.b)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"texture",void 0),(0,X.d)([(0,I.I)(),(0,I.b)("_markAllSubMeshesAsMiscDirty")],P.prototype,"legacy",void 0);class W extends B.b{constructor(){super(...arguments),this.SHEEN=!1,this.SHEEN_TEXTURE=!1,this.SHEEN_GAMMATEXTURE=!1,this.SHEEN_TEXTURE_ROUGHNESS=!1,this.SHEEN_TEXTUREDIRECTUV=0,this.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0,this.SHEEN_LINKWITHALBEDO=!1,this.SHEEN_ROUGHNESS=!1,this.SHEEN_ALBEDOSCALING=!1,this.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1}}class b extends D.b{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(N){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(N,"Sheen",120,new W,Z),this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.kj=1,this.color=h.b.White(),this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._roughness=null,this.roughness=null,this._textureRoughness=null,this.textureRoughness=null,this._albedoScaling=!1,this.albedoScaling=!1,this._internalMarkAllSubMeshesAsTexturesDirty=N._dirtyCallbacks[1]}isReadyForSubMesh(N,Z){if(!this._isEnabled)return!0;if(N._areTexturesDirty&&Z.texturesEnabled){if(this._texture&&A.c.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&A.c.SheenTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(N,Z){this._isEnabled?(N.SHEEN=!0,N.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,N.SHEEN_ROUGHNESS=null!==this._roughness,N.SHEEN_ALBEDOSCALING=this._albedoScaling,N.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,N._areTexturesDirty&&Z.texturesEnabled&&(this._texture&&A.c.SheenTextureEnabled?((0,g.J)(this._texture,N,"SHEEN_TEXTURE"),N.SHEEN_GAMMATEXTURE=this._texture.gammaSpace):N.SHEEN_TEXTURE=!1,this._textureRoughness&&A.c.SheenTextureEnabled?(0,g.J)(this._textureRoughness,N,"SHEEN_TEXTURE_ROUGHNESS"):N.SHEEN_TEXTURE_ROUGHNESS=!1)):(N.SHEEN=!1,N.SHEEN_TEXTURE=!1,N.SHEEN_TEXTURE_ROUGHNESS=!1,N.SHEEN_LINKWITHALBEDO=!1,N.SHEEN_ROUGHNESS=!1,N.SHEEN_ALBEDOSCALING=!1,N.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,N.SHEEN_GAMMATEXTURE=!1,N.SHEEN_TEXTUREDIRECTUV=0,N.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0)}bindForSubMesh(N,Z,d,X){if(!this._isEnabled)return;const I=X.materialDefines,m=this._material.isFrozen;if(!N.useUbo||!m||!N.isSync){var z,w,S,e;if((this._texture||this._textureRoughness)&&A.c.SheenTextureEnabled)N.updateFloat4("vSheenInfos",(null===(z=this._texture)||void 0===z?void 0:z.coordinatesIndex)??0,(null===(w=this._texture)||void 0===w?void 0:w.level)??0,(null===(S=this._textureRoughness)||void 0===S?void 0:S.coordinatesIndex)??0,(null===(e=this._textureRoughness)||void 0===e?void 0:e.level)??0),this._texture&&(0,g.t)(this._texture,N,"sheen"),this._textureRoughness&&!I.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,g.t)(this._textureRoughness,N,"sheenRoughness");N.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.kj),null!==this._roughness&&N.updateFloat("vSheenRoughness",this._roughness)}Z.texturesEnabled&&(this._texture&&A.c.SheenTextureEnabled&&N.setTexture("sheenSampler",this._texture),this._textureRoughness&&!I.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&A.c.SheenTextureEnabled&&N.setTexture("sheenRoughnessSampler",this._textureRoughness))}hasTexture(N){return this._texture===N||this._textureRoughness===N}getActiveTextures(N){this._texture&&N.push(this._texture),this._textureRoughness&&N.push(this._textureRoughness)}getAnimatables(N){this._texture&&this._texture.animations&&this._texture.animations.length>0&&N.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&N.push(this._textureRoughness)}dispose(N){var Z,d;N&&(null===(Z=this._texture)||void 0===Z||Z.dispose(),null===(d=this._textureRoughness)||void 0===d||d.dispose())}getClassName(){return"PBRSheenConfiguration"}addFallbacks(N,Z,d){return N.SHEEN&&Z.addFallback(d++,"SHEEN"),d}getSamplers(N){N.push("sheenSampler","sheenRoughnessSampler")}getUniforms(){return{ubo:[{name:"vSheenColor",size:4,type:"vec4"},{name:"vSheenRoughness",size:1,type:"float"},{name:"vSheenInfos",size:4,type:"vec4"},{name:"sheenMatrix",size:16,type:"mat4"},{name:"sheenRoughnessMatrix",size:16,type:"mat4"}]}}}(0,X.d)([(0,I.I)(),(0,I.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"isEnabled",void 0),(0,X.d)([(0,I.I)(),(0,I.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"linkSheenWithAlbedo",void 0),(0,X.d)([(0,I.I)()],b.prototype,"intensity",void 0),(0,X.d)([(0,I.m)()],b.prototype,"color",void 0),(0,X.d)([(0,I.A)(),(0,I.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"texture",void 0),(0,X.d)([(0,I.I)(),(0,I.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"useRoughnessFromMainTexture",void 0),(0,X.d)([(0,I.I)(),(0,I.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"roughness",void 0),(0,X.d)([(0,I.A)(),(0,I.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"textureRoughness",void 0),(0,X.d)([(0,I.I)(),(0,I.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"albedoScaling",void 0);class J extends B.b{constructor(){super(...arguments),this.SUBSURFACE=!1,this.SS_REFRACTION=!1,this.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_TRANSLUCENCY=!1,this.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_SCATTERING=!1,this.SS_DISPERSION=!1,this.SS_THICKNESSANDMASK_TEXTURE=!1,this.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,this.SS_HAS_THICKNESS=!1,this.SS_REFRACTIONINTENSITY_TEXTURE=!1,this.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,this.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,this.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,this.SS_REFRACTIONMAP_3D=!1,this.SS_REFRACTIONMAP_OPPOSITEZ=!1,this.SS_LODINREFRACTIONALPHA=!1,this.SS_GAMMAREFRACTION=!1,this.SS_RGBDREFRACTION=!1,this.SS_LINEARSPECULARREFRACTION=!1,this.SS_LINKREFRACTIONTOTRANSPARENCY=!1,this.SS_ALBEDOFORREFRACTIONTINT=!1,this.SS_ALBEDOFORTRANSLUCENCYTINT=!1,this.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.SS_USE_THICKNESS_AS_DEPTH=!1,this.SS_USE_GLTF_TEXTURES=!1}}class F extends D.b{get scatteringDiffusionProfile(){return this._scene.subSurfaceConfiguration?this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex]:null}set scatteringDiffusionProfile(N){this._scene.enableSubSurfaceForPrePass()&&N&&(this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(N))}get volumeIndexOfRefraction(){return this._volumeIndexOfRefraction>=1?this._volumeIndexOfRefraction:this._indexOfRefraction}set volumeIndexOfRefraction(N){this._volumeIndexOfRefraction=N>=1?N:-1}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markScenePrePassDirty(){this._internalMarkAllSubMeshesAsTexturesDirty(),this._internalMarkScenePrePassDirty()}isCompatible(){return!0}constructor(N){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(N,"PBRSubSurface",130,new J,Z),this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isDispersionEnabled=!1,this.isDispersionEnabled=!1,this._isScatteringEnabled=!1,this.isScatteringEnabled=!1,this._scatteringDiffusionProfileIndex=0,this.refractionIntensity=1,this.translucencyIntensity=1,this.useAlbedoToTintRefraction=!1,this.useAlbedoToTintTranslucency=!1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1.5,this.indexOfRefraction=1.5,this._volumeIndexOfRefraction=-1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.useThicknessAsDepth=!1,this.tintColor=h.b.White(),this.tintColorAtDistance=1,this.dispersion=0,this.diffusionDistance=h.b.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._refractionIntensityTexture=null,this.refractionIntensityTexture=null,this._translucencyIntensityTexture=null,this.translucencyIntensityTexture=null,this.translucencyColor=null,this._translucencyColorTexture=null,this.translucencyColorTexture=null,this._useGltfStyleTextures=!0,this.useGltfStyleTextures=!0,this._scene=N.va(),this.registerForExtraEvents=!0,this._internalMarkAllSubMeshesAsTexturesDirty=N._dirtyCallbacks[1],this._internalMarkScenePrePassDirty=N._dirtyCallbacks[32]}isReadyForSubMesh(N,Z){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return!0;if(N._areTexturesDirty&&Z.texturesEnabled){if(this._thicknessTexture&&A.c.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;if(this._translucencyColorTexture&&A.c.TranslucencyColorTextureEnabled&&!this._translucencyColorTexture.isReadyOrNotBlocking())return!1;if(this._translucencyIntensityTexture&&A.c.TranslucencyIntensityTextureEnabled&&!this._translucencyIntensityTexture.isReadyOrNotBlocking())return!1;const N=this._getRefractionTexture(Z);if(N&&A.c.RefractionTextureEnabled&&!N.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(N,Z){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return N.SUBSURFACE=!1,N.SS_DISPERSION=!1,N.SS_TRANSLUCENCY=!1,N.SS_SCATTERING=!1,N.SS_REFRACTION=!1,N.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,N.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,N.SS_THICKNESSANDMASK_TEXTURE=!1,N.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,N.SS_HAS_THICKNESS=!1,N.SS_REFRACTIONINTENSITY_TEXTURE=!1,N.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,N.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,N.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,N.SS_REFRACTIONMAP_3D=!1,N.SS_REFRACTIONMAP_OPPOSITEZ=!1,N.SS_LODINREFRACTIONALPHA=!1,N.SS_GAMMAREFRACTION=!1,N.SS_RGBDREFRACTION=!1,N.SS_LINEARSPECULARREFRACTION=!1,N.SS_LINKREFRACTIONTOTRANSPARENCY=!1,N.SS_ALBEDOFORREFRACTIONTINT=!1,N.SS_ALBEDOFORTRANSLUCENCYTINT=!1,N.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,N.SS_USE_THICKNESS_AS_DEPTH=!1,N.SS_USE_GLTF_TEXTURES=!1,N.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,void(N.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0);if(N._areTexturesDirty){if(N.SUBSURFACE=!0,N.SS_DISPERSION=this._isDispersionEnabled,N.SS_TRANSLUCENCY=this._isTranslucencyEnabled,N.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,N.SS_SCATTERING=this._isScatteringEnabled,N.SS_THICKNESSANDMASK_TEXTURE=!1,N.SS_REFRACTIONINTENSITY_TEXTURE=!1,N.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,N.SS_HAS_THICKNESS=!1,N.SS_USE_GLTF_TEXTURES=!1,N.SS_REFRACTION=!1,N.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,N.SS_REFRACTIONMAP_3D=!1,N.SS_GAMMAREFRACTION=!1,N.SS_RGBDREFRACTION=!1,N.SS_LINEARSPECULARREFRACTION=!1,N.SS_REFRACTIONMAP_OPPOSITEZ=!1,N.SS_LODINREFRACTIONALPHA=!1,N.SS_LINKREFRACTIONTOTRANSPARENCY=!1,N.SS_ALBEDOFORREFRACTIONTINT=!1,N.SS_ALBEDOFORTRANSLUCENCYTINT=!1,N.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,N.SS_USE_THICKNESS_AS_DEPTH=!1,N.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,N._areTexturesDirty&&Z.texturesEnabled&&(this._thicknessTexture&&A.c.ThicknessTextureEnabled&&(0,g.J)(this._thicknessTexture,N,"SS_THICKNESSANDMASK_TEXTURE"),this._refractionIntensityTexture&&A.c.RefractionIntensityTextureEnabled&&(0,g.J)(this._refractionIntensityTexture,N,"SS_REFRACTIONINTENSITY_TEXTURE"),this._translucencyIntensityTexture&&A.c.TranslucencyIntensityTextureEnabled&&(0,g.J)(this._translucencyIntensityTexture,N,"SS_TRANSLUCENCYINTENSITY_TEXTURE"),this._translucencyColorTexture&&A.c.TranslucencyColorTextureEnabled&&(0,g.J)(this._translucencyColorTexture,N,"SS_TRANSLUCENCYCOLOR_TEXTURE")),N.SS_HAS_THICKNESS=this.maximumThickness-this.minimumThickness!==0,N.SS_USE_GLTF_TEXTURES=this._useGltfStyleTextures,N.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._refractionIntensityTexture,N.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._translucencyIntensityTexture,this._isRefractionEnabled&&Z.texturesEnabled){const d=this._getRefractionTexture(Z);d&&A.c.RefractionTextureEnabled&&(N.SS_REFRACTION=!0,N.SS_REFRACTIONMAP_3D=d.isCube,N.SS_GAMMAREFRACTION=d.gammaSpace,N.SS_RGBDREFRACTION=d.isRGBD,N.SS_LINEARSPECULARREFRACTION=d.linearSpecularLOD,N.SS_REFRACTIONMAP_OPPOSITEZ=this._scene.useRightHandedSystem&&d.isCube?!d.invertZ:d.invertZ,N.SS_LODINREFRACTIONALPHA=d.lodLevelInAlpha,N.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency,N.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction,N.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=d.isCube&&d.boundingBoxSize,N.SS_USE_THICKNESS_AS_DEPTH=this.useThicknessAsDepth)}this._isTranslucencyEnabled&&(N.SS_ALBEDOFORTRANSLUCENCYTINT=this.useAlbedoToTintTranslucency)}}hardBindForSubMesh(N,Z,d,X){if(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled)if(0===this.maximumThickness&&0===this.minimumThickness)N.updateFloat2("vThicknessParam",0,0);else{X.getRenderingMesh().getWorldMatrix().decompose(e.h.kd[0]);const Z=Math.max(Math.abs(e.h.kd[0].x),Math.abs(e.h.kd[0].y),Math.abs(e.h.kd[0].z));N.updateFloat2("vThicknessParam",this.minimumThickness*Z,(this.maximumThickness-this.minimumThickness)*Z)}}bindForSubMesh(N,Z,d,X){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return;const I=X.materialDefines,m=this._material.isFrozen,z=this._material.realTimeFiltering,w=I.LODBASEDMICROSFURACE,S=this._getRefractionTexture(Z);if(!N.useUbo||!m||!N.isSync){if(this._thicknessTexture&&A.c.ThicknessTextureEnabled&&(N.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),(0,g.t)(this._thicknessTexture,N,"thickness")),this._refractionIntensityTexture&&A.c.RefractionIntensityTextureEnabled&&I.SS_REFRACTIONINTENSITY_TEXTURE&&(N.updateFloat2("vRefractionIntensityInfos",this._refractionIntensityTexture.coordinatesIndex,this._refractionIntensityTexture.level),(0,g.t)(this._refractionIntensityTexture,N,"refractionIntensity")),this._translucencyColorTexture&&A.c.TranslucencyColorTextureEnabled&&I.SS_TRANSLUCENCYCOLOR_TEXTURE&&(N.updateFloat2("vTranslucencyColorInfos",this._translucencyColorTexture.coordinatesIndex,this._translucencyColorTexture.level),(0,g.t)(this._translucencyColorTexture,N,"translucencyColor")),this._translucencyIntensityTexture&&A.c.TranslucencyIntensityTextureEnabled&&I.SS_TRANSLUCENCYINTENSITY_TEXTURE&&(N.updateFloat2("vTranslucencyIntensityInfos",this._translucencyIntensityTexture.coordinatesIndex,this._translucencyIntensityTexture.level),(0,g.t)(this._translucencyIntensityTexture,N,"translucencyIntensity")),S&&A.c.RefractionTextureEnabled){N.Cd("refractionMatrix",S.getRefractionTextureMatrix());let Z=1;S.isCube||S.depth&&(Z=S.depth);const d=S.getSize().width,X=this.volumeIndexOfRefraction;if(N.updateFloat4("vRefractionInfos",S.level,1/X,Z,this._invertRefractionY?-1:1),N.updateFloat4("vRefractionMicrosurfaceInfos",d,S.lodGenerationScale,S.lodGenerationOffset,1/this.indexOfRefraction),z&&N.updateFloat2("vRefractionFilteringInfo",d,Math.log2(d)),S.boundingBoxSize){const Z=S;N.updateVector3("vRefractionPosition",Z.boundingBoxPosition),N.updateVector3("vRefractionSize",Z.boundingBoxSize)}}this._isScatteringEnabled&&N.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex),N.updateColor3("vDiffusionDistance",this.diffusionDistance),N.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintColorAtDistance)),N.updateColor4("vTranslucencyColor",this.translucencyColor??this.tintColor,0),N.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0),N.updateFloat("dispersion",this.dispersion)}Z.texturesEnabled&&(this._thicknessTexture&&A.c.ThicknessTextureEnabled&&N.setTexture("thicknessSampler",this._thicknessTexture),this._refractionIntensityTexture&&A.c.RefractionIntensityTextureEnabled&&I.SS_REFRACTIONINTENSITY_TEXTURE&&N.setTexture("refractionIntensitySampler",this._refractionIntensityTexture),this._translucencyIntensityTexture&&A.c.TranslucencyIntensityTextureEnabled&&I.SS_TRANSLUCENCYINTENSITY_TEXTURE&&N.setTexture("translucencyIntensitySampler",this._translucencyIntensityTexture),this._translucencyColorTexture&&A.c.TranslucencyColorTextureEnabled&&I.SS_TRANSLUCENCYCOLOR_TEXTURE&&N.setTexture("translucencyColorSampler",this._translucencyColorTexture),S&&A.c.RefractionTextureEnabled&&(w?N.setTexture("refractionSampler",S):(N.setTexture("refractionSampler",S._lodTextureMid||S),N.setTexture("refractionSamplerLow",S._lodTextureLow||S),N.setTexture("refractionSamplerHigh",S._lodTextureHigh||S))))}_getRefractionTexture(N){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?N.environmentTexture:null}get disableAlphaBlending(){return this._isRefractionEnabled&&this._linkRefractionWithTransparency}fillRenderTargetTextures(N){A.c.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&N.push(this._refractionTexture)}hasTexture(N){return this._thicknessTexture===N||(this._refractionTexture===N||(this._refractionIntensityTexture===N||(this._translucencyIntensityTexture===N||this._translucencyColorTexture===N)))}hasRenderTargetTextures(){return!!(A.c.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)}getActiveTextures(N){this._thicknessTexture&&N.push(this._thicknessTexture),this._refractionTexture&&N.push(this._refractionTexture),this._translucencyColorTexture&&N.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&N.push(this._translucencyIntensityTexture)}getAnimatables(N){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&N.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&N.push(this._refractionTexture),this._translucencyColorTexture&&this._translucencyColorTexture.animations&&this._translucencyColorTexture.animations.length>0&&N.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.animations&&this._translucencyIntensityTexture.animations.length>0&&N.push(this._translucencyIntensityTexture)}dispose(N){N&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose(),this._translucencyColorTexture&&this._translucencyColorTexture.dispose(),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.dispose())}getClassName(){return"PBRSubSurfaceConfiguration"}addFallbacks(N,Z,d){return N.SS_SCATTERING&&Z.addFallback(d++,"SS_SCATTERING"),N.SS_TRANSLUCENCY&&Z.addFallback(d++,"SS_TRANSLUCENCY"),d}getSamplers(N){N.push("thicknessSampler","refractionIntensitySampler","translucencyIntensitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh","translucencyColorSampler")}getUniforms(){return{ubo:[{name:"vRefractionMicrosurfaceInfos",size:4,type:"vec4"},{name:"vRefractionFilteringInfo",size:2,type:"vec2"},{name:"vTranslucencyIntensityInfos",size:2,type:"vec2"},{name:"vRefractionInfos",size:4,type:"vec4"},{name:"refractionMatrix",size:16,type:"mat4"},{name:"vThicknessInfos",size:2,type:"vec2"},{name:"vRefractionIntensityInfos",size:2,type:"vec2"},{name:"thicknessMatrix",size:16,type:"mat4"},{name:"refractionIntensityMatrix",size:16,type:"mat4"},{name:"translucencyIntensityMatrix",size:16,type:"mat4"},{name:"vThicknessParam",size:2,type:"vec2"},{name:"vDiffusionDistance",size:3,type:"vec3"},{name:"vTintColor",size:4,type:"vec4"},{name:"vSubSurfaceIntensity",size:3,type:"vec3"},{name:"vRefractionPosition",size:3,type:"vec3"},{name:"vRefractionSize",size:3,type:"vec3"},{name:"scatteringDiffusionProfile",size:1,type:"float"},{name:"dispersion",size:1,type:"float"},{name:"vTranslucencyColor",size:4,type:"vec4"},{name:"vTranslucencyColorInfos",size:2,type:"vec2"},{name:"translucencyColorMatrix",size:16,type:"mat4"}]}}}(0,X.d)([(0,I.I)(),(0,I.b)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"isRefractionEnabled",void 0),(0,X.d)([(0,I.I)(),(0,I.b)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"isTranslucencyEnabled",void 0),(0,X.d)([(0,I.I)(),(0,I.b)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"isDispersionEnabled",void 0),(0,X.d)([(0,I.I)(),(0,I.b)("_markScenePrePassDirty")],F.prototype,"isScatteringEnabled",void 0),(0,X.d)([(0,I.I)()],F.prototype,"_scatteringDiffusionProfileIndex",void 0),(0,X.d)([(0,I.I)()],F.prototype,"refractionIntensity",void 0),(0,X.d)([(0,I.I)()],F.prototype,"translucencyIntensity",void 0),(0,X.d)([(0,I.I)()],F.prototype,"useAlbedoToTintRefraction",void 0),(0,X.d)([(0,I.I)()],F.prototype,"useAlbedoToTintTranslucency",void 0),(0,X.d)([(0,I.A)(),(0,I.b)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"thicknessTexture",void 0),(0,X.d)([(0,I.A)(),(0,I.b)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"refractionTexture",void 0),(0,X.d)([(0,I.I)(),(0,I.b)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"indexOfRefraction",void 0),(0,X.d)([(0,I.I)()],F.prototype,"_volumeIndexOfRefraction",void 0),(0,X.d)([(0,I.b)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"volumeIndexOfRefraction",null),(0,X.d)([(0,I.I)(),(0,I.b)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"invertRefractionY",void 0),(0,X.d)([(0,I.I)(),(0,I.b)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"linkRefractionWithTransparency",void 0),(0,X.d)([(0,I.I)()],F.prototype,"minimumThickness",void 0),(0,X.d)([(0,I.I)()],F.prototype,"maximumThickness",void 0),(0,X.d)([(0,I.I)()],F.prototype,"useThicknessAsDepth",void 0),(0,X.d)([(0,I.m)()],F.prototype,"tintColor",void 0),(0,X.d)([(0,I.I)()],F.prototype,"tintColorAtDistance",void 0),(0,X.d)([(0,I.I)()],F.prototype,"dispersion",void 0),(0,X.d)([(0,I.m)()],F.prototype,"diffusionDistance",void 0),(0,X.d)([(0,I.I)(),(0,I.b)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"useMaskFromThicknessTexture",void 0),(0,X.d)([(0,I.A)(),(0,I.b)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"refractionIntensityTexture",void 0),(0,X.d)([(0,I.A)(),(0,I.b)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"translucencyIntensityTexture",void 0),(0,X.d)([(0,I.m)()],F.prototype,"translucencyColor",void 0),(0,X.d)([(0,I.A)(),(0,I.b)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"translucencyColorTexture",void 0),(0,X.d)([(0,I.I)(),(0,I.b)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"useGltfStyleTextures",void 0);var G=d(1308),x=d(1288),t=d(1312);const q={effect:null,subMesh:null};class Y extends B.b{constructor(N){super(N),this.PBR=!0,this.NUM_SAMPLES="0",this.REALTIME_FILTERING=!1,this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.ALBEDO=!1,this.GAMMAALBEDO=!1,this.ALBEDODIRECTUV=0,this.VERTEXCOLOR=!1,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.AMBIENTINGRAYSCALE=!1,this.OPACITY=!1,this.VERTEXALPHA=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHABLEND=!1,this.ALPHAFROMALBEDO=!1,this.ALPHATESTVALUE="0.5",this.SPECULAROVERALPHA=!1,this.RADIANCEOVERALPHA=!1,this.ALPHAFRESNEL=!1,this.LINEARALPHAFRESNEL=!1,this.PREMULTIPLYALPHA=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.GAMMAEMISSIVE=!1,this.REFLECTIVITY=!1,this.REFLECTIVITY_GAMMA=!1,this.REFLECTIVITYDIRECTUV=0,this.SPECULARTERM=!1,this.MICROSURFACEFROMREFLECTIVITYMAP=!1,this.MICROSURFACEAUTOMATIC=!1,this.LODBASEDMICROSFURACE=!1,this.MICROSURFACEMAP=!1,this.MICROSURFACEMAPDIRECTUV=0,this.METALLICWORKFLOW=!1,this.ROUGHNESSSTOREINMETALMAPALPHA=!1,this.ROUGHNESSSTOREINMETALMAPGREEN=!1,this.METALLNESSSTOREINMETALMAPBLUE=!1,this.AOSTOREINMETALMAPRED=!1,this.METALLIC_REFLECTANCE=!1,this.METALLIC_REFLECTANCE_GAMMA=!1,this.METALLIC_REFLECTANCEDIRECTUV=0,this.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=!1,this.REFLECTANCE=!1,this.REFLECTANCE_GAMMA=!1,this.REFLECTANCEDIRECTUV=0,this.ENVIRONMENTBRDF=!1,this.ENVIRONMENTBRDF_RGBD=!1,this.NORMAL=!1,this.TANGENT=!1,this.BUMP=!1,this.BUMPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.NORMALXYSCALE=!0,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.USELIGHTMAPASSHADOWMAP=!1,this.GAMMALIGHTMAP=!1,this.RGBDLIGHTMAP=!1,this.REFLECTION=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.INVERTCUBICMAP=!1,this.USESPHERICALFROMREFLECTIONMAP=!1,this.USEIRRADIANCEMAP=!1,this.USESPHERICALINVERTEX=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.LODINREFLECTIONALPHA=!1,this.GAMMAREFLECTION=!1,this.RGBDREFLECTION=!1,this.LINEARSPECULARREFLECTION=!1,this.RADIANCEOCCLUSION=!1,this.HORIZONOCCLUSION=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.NONUNIFORMSCALING=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.EXPOSURE=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.USEPHYSICALLIGHTFALLOFF=!1,this.USEGLTFLIGHTFALLOFF=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.LOGARITHMICDEPTH=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.FORCENORMALFORWARD=!1,this.SPECULARAA=!1,this.UNLIT=!1,this.DECAL_AFTER_DETAIL=!1,this.DEBUGMODE=0,this.rebuild()}reset(){super.reset(),this.ALPHATESTVALUE="0.5",this.PBR=!0,this.NORMALXYSCALE=!0}}class s extends M.c{get realTimeFiltering(){return this._realTimeFiltering}set realTimeFiltering(N){this._realTimeFiltering=N,this.fe(1)}get realTimeFilteringQuality(){return this._realTimeFilteringQuality}set realTimeFilteringQuality(N){this._realTimeFilteringQuality=N,this.fe(1)}get canRenderToMRT(){return!0}_attachImageProcessingConfiguration(N){N!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=N||this.va().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}constructor(N,Z){super(N,Z,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||s.ForceGLSL),this._directIntensity=1,this._emissiveIntensity=1,this._environmentIntensity=1,this._specularIntensity=1,this._lightingInfos=new e.q(this._directIntensity,this._emissiveIntensity,this._environmentIntensity,this._specularIntensity),this._disableBumpMap=!1,this._albedoTexture=null,this._ambientTexture=null,this._ambientTextureStrength=1,this._ambientTextureImpactOnAnalyticalLights=s.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._reflectivityTexture=null,this._metallicTexture=null,this._metallic=null,this._roughness=null,this._metallicF0Factor=1,this._metallicReflectanceColor=h.b.White(),this._useOnlyMetallicFromMetallicReflectanceTexture=!1,this._metallicReflectanceTexture=null,this._reflectanceTexture=null,this._microSurfaceTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._ambientColor=new h.b(0,0,0),this._albedoColor=new h.b(1,1,1),this._reflectivityColor=new h.b(1,1,1),this._reflectionColor=new h.b(1,1,1),this._emissiveColor=new h.b(0,0,0),this._microSurface=.9,this._useLightmapAsShadowmap=!1,this._useHorizonOcclusion=!0,this._useRadianceOcclusion=!0,this._useAlphaFromAlbedoTexture=!1,this._useSpecularOverAlpha=!0,this._useMicroSurfaceFromReflectivityMapAlpha=!1,this._useRoughnessFromMetallicTextureAlpha=!0,this._useRoughnessFromMetallicTextureGreen=!1,this._useMetallnessFromMetallicTextureBlue=!1,this._useAmbientOcclusionFromMetallicTextureRed=!1,this._useAmbientInGrayScale=!1,this._useAutoMicroSurfaceFromReflectivityMap=!1,this._lightFalloff=s.LIGHTFALLOFF_PHYSICAL,this._useRadianceOverAlpha=!0,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this._parallaxScaleBias=.05,this._disableLighting=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._alphaCutOff=.4,this._forceAlphaTest=!1,this._useAlphaFresnel=!1,this._useLinearAlphaFresnel=!1,this._environmentBRDFTexture=null,this._forceIrradianceInFragment=!1,this._realTimeFiltering=!1,this._realTimeFilteringQuality=8,this._forceNormalForward=!1,this._enableSpecularAntiAliasing=!1,this._imageProcessingObserver=null,this._renderTargets=new z.h(16),this._globalAmbientColor=new h.b(0,0,0),this._unlit=!1,this._applyDecalMapAfterDetailMap=!1,this._debugMode=0,this._shadersLoaded=!1,this._breakShaderLoadedCheck=!1,this.debugMode=0,this.debugLimit=-1,this.debugFactor=1,this._cacheHasRenderTargetTextures=!1,this.brdf=new T(this),this.clearCoat=new V(this),this.iridescence=new K(this),this.anisotropy=new P(this),this.sheen=new b(this),this.subSurface=new F(this),this.detailMap=new G.d(this),this._attachImageProcessingConfiguration(null),this.getRenderTargetTextures=()=>(this._renderTargets.reset(),A.c.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets),this._environmentBRDFTexture=(0,w.b)(this.va()),this.prePassConfiguration=new k.b}get hasRenderTargetTextures(){return!!(A.c.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures}get isPrePassCapable(){return!this.disableDepthWrite}getClassName(){return"PBRBaseMaterial"}get _disableAlphaBlending(){var N;return this._transparencyMode===s.PBRMATERIAL_OPAQUE||this._transparencyMode===s.PBRMATERIAL_ALPHATEST||(null===(N=this.subSurface)||void 0===N?void 0:N.disableAlphaBlending)}needAlphaBlending(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())}needAlphaTesting(){var N;return!!this._forceAlphaTest||(null===(N=this.subSurface)||void 0===N||!N.disableAlphaBlending)&&(this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===s.PBRMATERIAL_ALPHATEST))}_shouldUseAlphaFromAlbedoTexture(){return null!=this._albedoTexture&&this._albedoTexture.Wc&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==s.PBRMATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._albedoTexture&&this._albedoTexture.Wc||null!=this._opacityTexture}getAlphaTestTexture(){return this._albedoTexture}isReadyForSubMesh(N,Z,d){this._uniformBufferLayoutBuilt||this.buildUniformLayout();const X=Z._drawWrapper;if(X.effect&&this.isFrozen&&X._wasPreviouslyReady&&X._wasPreviouslyUsingInstances===d)return!0;Z.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),Z.materialDefines=new Y(this._eventInfo.defineNames));const I=Z.materialDefines;if(this._isReadyForSubMesh(Z))return!0;const z=this.va(),w=z.getEngine();if(I._areTexturesDirty&&(this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,z.texturesEnabled)){if(this._albedoTexture&&A.c.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&A.c.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&A.c.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;const N=this._getReflectionTexture();if(N&&A.c.ReflectionTextureEnabled){if(!N.isReadyOrNotBlocking())return!1;var S;if(N.irradianceTexture){if(!N.irradianceTexture.isReadyOrNotBlocking())return!1}else if(!N.sphericalPolynomial&&null!==(S=N.getInternalTexture())&&void 0!==S&&S._sphericalPolynomialPromise)return!1}if(this._lightmapTexture&&A.c.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&A.c.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(A.c.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._metallicReflectanceTexture&&!this._metallicReflectanceTexture.isReadyOrNotBlocking())return!1;if(this._reflectanceTexture&&!this._reflectanceTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(w.getCaps().standardDerivatives&&this._bumpTexture&&A.c.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;if(this._environmentBRDFTexture&&A.c.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=I,this._eventInfo.subMesh=Z,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(I._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;w.getCaps().standardDerivatives||N.isVerticesDataPresent(j.d.NormalKind)||(N.createNormals(!0),m.e.Warn("PBRMaterial: Normals have been created for the mesh: "+N.name));const e=Z.effect,B=I._areLightsDisposed;let D=this._prepareEffect(N,I,this.onCompiled,this.onError,d,null,Z.getRenderingMesh().hasThinInstances),v=!1;if(D)if(this._onEffectCreatedObservable&&(q.effect=D,q.subMesh=Z,this._onEffectCreatedObservable.notifyObservers(q)),this.allowShaderHotSwapping&&e&&!D.isReady()){if(D=e,I.markAsUnprocessed(),v=this.isFrozen,B)return I._areLightsDisposed=!0,!1}else z.resetCachedMaterial(),Z.setEffect(D,I,this._materialContext);return!(!Z.effect||!Z.effect.isReady())&&(I._renderId=z.getRenderId(),X._wasPreviouslyReady=!v,X._wasPreviouslyUsingInstances=!!d,this._checkScenePerformancePriority(),!0)}isMetallicWorkflow(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)}_prepareEffect(N,Z){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,m=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,w=arguments.length>6?arguments[6]:void 0;if(this._prepareDefines(N,Z,m,z,w),!Z.isDirty)return null;Z.markAsProcessed();const S=this.va().getEngine(),e=new n.e;let B=0;Z.USESPHERICALINVERTEX&&e.addFallback(B++,"USESPHERICALINVERTEX"),Z.FOG&&e.addFallback(B,"FOG"),Z.SPECULARAA&&e.addFallback(B,"SPECULARAA"),Z.POINTSIZE&&e.addFallback(B,"POINTSIZE"),Z.LOGARITHMICDEPTH&&e.addFallback(B,"LOGARITHMICDEPTH"),Z.PARALLAX&&e.addFallback(B,"PARALLAX"),Z.PARALLAX_RHS&&e.addFallback(B,"PARALLAX_RHS"),Z.PARALLAXOCCLUSION&&e.addFallback(B++,"PARALLAXOCCLUSION"),Z.ENVIRONMENTBRDF&&e.addFallback(B++,"ENVIRONMENTBRDF"),Z.TANGENT&&e.addFallback(B++,"TANGENT"),Z.BUMP&&e.addFallback(B++,"BUMP"),B=(0,g.u)(Z,e,this._maxSimultaneousLights,B++),Z.SPECULARTERM&&e.addFallback(B++,"SPECULARTERM"),Z.USESPHERICALFROMREFLECTIONMAP&&e.addFallback(B++,"USESPHERICALFROMREFLECTIONMAP"),Z.USEIRRADIANCEMAP&&e.addFallback(B++,"USEIRRADIANCEMAP"),Z.LIGHTMAP&&e.addFallback(B++,"LIGHTMAP"),Z.NORMAL&&e.addFallback(B++,"NORMAL"),Z.AMBIENT&&e.addFallback(B++,"AMBIENT"),Z.EMISSIVE&&e.addFallback(B++,"EMISSIVE"),Z.VERTEXCOLOR&&e.addFallback(B++,"VERTEXCOLOR"),Z.MORPHTARGETS&&e.addFallback(B++,"MORPHTARGETS"),Z.MULTIVIEW&&e.addFallback(0,"MULTIVIEW");const D=[j.d.PositionKind];Z.NORMAL&&D.push(j.d.NormalKind),Z.TANGENT&&D.push(j.d.TangentKind);for(let d=1;d<=6;++d)Z["UV"+d]&&D.push(`uv${1===d?"":d}`);Z.VERTEXCOLOR&&D.push(j.d.ColorKind),(0,g.x)(D,N,Z,e),(0,g.y)(D,Z),(0,g.B)(D,N,Z),(0,g.w)(D,N,Z);let v="pbr";const T=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vReflectionFilteringInfo","vMetallicReflectanceInfos","vReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","albedoMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","reflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vTangentSpaceParams","boneTextureWidth","vDebugMode","morphTargetTextureInfo","morphTargetTextureIndices"],h=["albedoSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler","reflectanceSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],C=["Material","Scene","Mesh"],M={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:Z.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=e,this._eventInfo.fallbackRank=B,this._eventInfo.defines=Z,this._eventInfo.uniforms=T,this._eventInfo.attributes=D,this._eventInfo.samplers=h,this._eventInfo.uniformBuffersNames=C,this._eventInfo.customCode=void 0,this._eventInfo.mesh=N,this._eventInfo.indexParameters=M,this._callbackPluginEventGeneric(128,this._eventInfo),t.d.AddUniformsAndSamplers(T,h),k.b.AddUniforms(T),k.b.AddSamplers(h),(0,x.e)(T),U.b&&(U.b.PrepareUniforms(T,Z),U.b.PrepareSamplers(h,Z)),(0,g.U)({uniformsNames:T,uniformBuffersNames:C,samplers:h,defines:Z,maxSimultaneousLights:this._maxSimultaneousLights});const Q={};this.customShaderNameResolve&&(v=this.customShaderNameResolve(v,T,C,h,Z,D,Q));const A=Z.toString(),E=S.createEffect(v,{attributes:D,uniformsNames:T,uniformBuffersNames:C,samplers:h,defines:A,fallbacks:e,onCompiled:X,onError:I,indexParameters:M,processFinalCode:Q.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:Z.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this.shaderLanguage?await Promise.all([Promise.all([d.e(15),d.e(44)]).then(d.bind(d,12340)),Promise.all([d.e(16),d.e(45)]).then(d.bind(d,12358))]):await Promise.all([Promise.all([d.e(21),d.e(46)]).then(d.bind(d,12363)),Promise.all([d.e(23),d.e(47)]).then(d.bind(d,12373))]),this._shadersLoaded=!0}},S);return this._eventInfo.customCode=void 0,E}_prepareDefines(N,Z){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,I=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const m=this.va(),z=m.getEngine();(0,g.G)(m,N,Z,!0,this._maxSimultaneousLights,this._disableLighting),Z._needNormals=!0,(0,g.O)(m,Z);const w=this.needAlphaBlendingForMesh(N)&&this.va().useOrderIndependentTransparency;if((0,g.T)(m,Z,this.canRenderToMRT&&!w),(0,g.P)(m,Z,w),t.d.PrepareDefines(z.currentRenderPassId,N,Z),Z.METALLICWORKFLOW=this.isMetallicWorkflow(),Z._areTexturesDirty){Z._needUVs=!1;for(let N=1;N<=6;++N)Z["MAINUV"+N]=!1;if(m.texturesEnabled){Z.ALBEDODIRECTUV=0,Z.AMBIENTDIRECTUV=0,Z.OPACITYDIRECTUV=0,Z.EMISSIVEDIRECTUV=0,Z.REFLECTIVITYDIRECTUV=0,Z.MICROSURFACEMAPDIRECTUV=0,Z.METALLIC_REFLECTANCEDIRECTUV=0,Z.REFLECTANCEDIRECTUV=0,Z.BUMPDIRECTUV=0,Z.LIGHTMAPDIRECTUV=0,z.getCaps().textureLOD&&(Z.LODBASEDMICROSFURACE=!0),this._albedoTexture&&A.c.DiffuseTextureEnabled?((0,g.J)(this._albedoTexture,Z,"ALBEDO"),Z.GAMMAALBEDO=this._albedoTexture.gammaSpace):Z.ALBEDO=!1,this._ambientTexture&&A.c.AmbientTextureEnabled?((0,g.J)(this._ambientTexture,Z,"AMBIENT"),Z.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):Z.AMBIENT=!1,this._opacityTexture&&A.c.OpacityTextureEnabled?((0,g.J)(this._opacityTexture,Z,"OPACITY"),Z.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):Z.OPACITY=!1;const N=this._getReflectionTexture();if(N&&A.c.ReflectionTextureEnabled){switch(Z.REFLECTION=!0,Z.GAMMAREFLECTION=N.gammaSpace,Z.RGBDREFLECTION=N.isRGBD,Z.LODINREFLECTIONALPHA=N.lodLevelInAlpha,Z.LINEARSPECULARREFLECTION=N.linearSpecularLOD,this.realTimeFiltering&&this.realTimeFilteringQuality>0?(Z.NUM_SAMPLES=""+this.realTimeFilteringQuality,z._features.needTypeSuffixInShaderConstants&&(Z.NUM_SAMPLES=Z.NUM_SAMPLES+"u"),Z.REALTIME_FILTERING=!0):Z.REALTIME_FILTERING=!1,Z.INVERTCUBICMAP=N.coordinatesMode===Q.c.INVCUBIC_MODE,Z.REFLECTIONMAP_3D=N.isCube,Z.REFLECTIONMAP_OPPOSITEZ=Z.REFLECTIONMAP_3D&&this.va().useRightHandedSystem?!N.invertZ:N.invertZ,Z.REFLECTIONMAP_CUBIC=!1,Z.REFLECTIONMAP_EXPLICIT=!1,Z.REFLECTIONMAP_PLANAR=!1,Z.REFLECTIONMAP_PROJECTION=!1,Z.REFLECTIONMAP_SKYBOX=!1,Z.REFLECTIONMAP_SPHERICAL=!1,Z.REFLECTIONMAP_EQUIRECTANGULAR=!1,Z.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,Z.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,N.coordinatesMode){case Q.c.EXPLICIT_MODE:Z.REFLECTIONMAP_EXPLICIT=!0;break;case Q.c.PLANAR_MODE:Z.REFLECTIONMAP_PLANAR=!0;break;case Q.c.PROJECTION_MODE:Z.REFLECTIONMAP_PROJECTION=!0;break;case Q.c.SKYBOX_MODE:Z.REFLECTIONMAP_SKYBOX=!0;break;case Q.c.SPHERICAL_MODE:Z.REFLECTIONMAP_SPHERICAL=!0;break;case Q.c.EQUIRECTANGULAR_MODE:Z.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case Q.c.FIXED_EQUIRECTANGULAR_MODE:Z.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case Q.c.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:Z.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case Q.c.CUBIC_MODE:case Q.c.INVCUBIC_MODE:default:Z.REFLECTIONMAP_CUBIC=!0,Z.USE_LOCAL_REFLECTIONMAP_CUBIC=!!N.boundingBoxSize}N.coordinatesMode!==Q.c.SKYBOX_MODE&&(N.irradianceTexture?(Z.USEIRRADIANCEMAP=!0,Z.USESPHERICALFROMREFLECTIONMAP=!1):N.isCube&&(Z.USESPHERICALFROMREFLECTIONMAP=!0,Z.USEIRRADIANCEMAP=!1,this._forceIrradianceInFragment||this.realTimeFiltering||this._twoSidedLighting||z.getCaps().maxVaryingVectors<=8?Z.USESPHERICALINVERTEX=!1:Z.USESPHERICALINVERTEX=!0))}else Z.REFLECTION=!1,Z.REFLECTIONMAP_3D=!1,Z.REFLECTIONMAP_SPHERICAL=!1,Z.REFLECTIONMAP_PLANAR=!1,Z.REFLECTIONMAP_CUBIC=!1,Z.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,Z.REFLECTIONMAP_PROJECTION=!1,Z.REFLECTIONMAP_SKYBOX=!1,Z.REFLECTIONMAP_EXPLICIT=!1,Z.REFLECTIONMAP_EQUIRECTANGULAR=!1,Z.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,Z.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,Z.INVERTCUBICMAP=!1,Z.USESPHERICALFROMREFLECTIONMAP=!1,Z.USEIRRADIANCEMAP=!1,Z.USESPHERICALINVERTEX=!1,Z.REFLECTIONMAP_OPPOSITEZ=!1,Z.LODINREFLECTIONALPHA=!1,Z.GAMMAREFLECTION=!1,Z.RGBDREFLECTION=!1,Z.LINEARSPECULARREFLECTION=!1;this._lightmapTexture&&A.c.LightmapTextureEnabled?((0,g.J)(this._lightmapTexture,Z,"LIGHTMAP"),Z.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,Z.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,Z.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):Z.LIGHTMAP=!1,this._emissiveTexture&&A.c.EmissiveTextureEnabled?((0,g.J)(this._emissiveTexture,Z,"EMISSIVE"),Z.GAMMAEMISSIVE=this._emissiveTexture.gammaSpace):Z.EMISSIVE=!1,A.c.SpecularTextureEnabled?(this._metallicTexture?((0,g.J)(this._metallicTexture,Z,"REFLECTIVITY"),Z.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,Z.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,Z.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,Z.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed,Z.REFLECTIVITY_GAMMA=!1):this._reflectivityTexture?((0,g.J)(this._reflectivityTexture,Z,"REFLECTIVITY"),Z.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,Z.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap,Z.REFLECTIVITY_GAMMA=this._reflectivityTexture.gammaSpace):Z.REFLECTIVITY=!1,this._metallicReflectanceTexture||this._reflectanceTexture?(Z.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=this._useOnlyMetallicFromMetallicReflectanceTexture,this._metallicReflectanceTexture?((0,g.J)(this._metallicReflectanceTexture,Z,"METALLIC_REFLECTANCE"),Z.METALLIC_REFLECTANCE_GAMMA=this._metallicReflectanceTexture.gammaSpace):Z.METALLIC_REFLECTANCE=!1,this._reflectanceTexture&&(!this._metallicReflectanceTexture||this._metallicReflectanceTexture&&this._useOnlyMetallicFromMetallicReflectanceTexture)?((0,g.J)(this._reflectanceTexture,Z,"REFLECTANCE"),Z.REFLECTANCE_GAMMA=this._reflectanceTexture.gammaSpace):Z.REFLECTANCE=!1):(Z.METALLIC_REFLECTANCE=!1,Z.REFLECTANCE=!1),this._microSurfaceTexture?(0,g.J)(this._microSurfaceTexture,Z,"MICROSURFACEMAP"):Z.MICROSURFACEMAP=!1):(Z.REFLECTIVITY=!1,Z.MICROSURFACEMAP=!1),z.getCaps().standardDerivatives&&this._bumpTexture&&A.c.BumpTextureEnabled&&!this._disableBumpMap?((0,g.J)(this._bumpTexture,Z,"BUMP"),this._useParallax&&this._albedoTexture&&A.c.DiffuseTextureEnabled?(Z.PARALLAX=!0,Z.PARALLAX_RHS=m.useRightHandedSystem,Z.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):Z.PARALLAX=!1,Z.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):(Z.BUMP=!1,Z.PARALLAX=!1,Z.PARALLAX_RHS=!1,Z.PARALLAXOCCLUSION=!1,Z.OBJECTSPACE_NORMALMAP=!1),this._environmentBRDFTexture&&A.c.ReflectionTextureEnabled?(Z.ENVIRONMENTBRDF=!0,Z.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(Z.ENVIRONMENTBRDF=!1,Z.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?Z.ALPHAFROMALBEDO=!0:Z.ALPHAFROMALBEDO=!1}Z.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===s.LIGHTFALLOFF_STANDARD?(Z.USEPHYSICALLIGHTFALLOFF=!1,Z.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===s.LIGHTFALLOFF_GLTF?(Z.USEPHYSICALLIGHTFALLOFF=!1,Z.USEGLTFLIGHTFALLOFF=!0):(Z.USEPHYSICALLIGHTFALLOFF=!0,Z.USEGLTFLIGHTFALLOFF=!1),Z.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.ne&&this._twoSidedLighting?Z.TWOSIDEDLIGHTING=!0:Z.TWOSIDEDLIGHTING=!1,Z.SPECULARAA=z.getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(Z._areTexturesDirty||Z._areMiscDirty)&&(Z.ALPHATESTVALUE=`${this._alphaCutOff}${this._alphaCutOff%1===0?".":""}`,Z.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,Z.ALPHABLEND=this.needAlphaBlendingForMesh(N),Z.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,Z.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),Z._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(Z),Z.FORCENORMALFORWARD=this._forceNormalForward,Z.RADIANCEOCCLUSION=this._useRadianceOcclusion,Z.HORIZONOCCLUSION=this._useHorizonOcclusion,Z._areMiscDirty&&((0,g.M)(N,m,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(N)||this._forceAlphaTest,Z,this._applyDecalMapAfterDetailMap),Z.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!N.isVerticesDataPresent(j.d.NormalKind),Z.DEBUGMODE=this._debugMode),(0,g.F)(m,z,this,Z,!!d,X,I),this._eventInfo.defines=Z,this._eventInfo.mesh=N,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,g.D)(N,Z,!0,!0,!0,this._transparencyMode!==s.PBRMATERIAL_OPAQUE),this._callbackPluginEventPrepareDefines(this._eventInfo)}forceCompilation(N,Z,d){const X={clipPlane:!1,useInstances:!1,...d};this._uniformBufferLayoutBuilt||this.buildUniformLayout(),this._callbackPluginEventGeneric(4,this._eventInfo);(()=>{if(this._breakShaderLoadedCheck)return;const d=new Y(this._eventInfo.defineNames),I=this._prepareEffect(N,d,void 0,void 0,X.useInstances,X.clipPlane,N.hasThinInstances);this._onEffectCreatedObservable&&(q.effect=I,q.subMesh=null,this._onEffectCreatedObservable.notifyObservers(q)),I.isReady()?Z&&Z(this):I.onCompileObservable.add((()=>{Z&&Z(this)}))})()}buildUniformLayout(){const N=this._uniformBuffer;N.addUniform("vAlbedoInfos",2),N.addUniform("vAmbientInfos",4),N.addUniform("vOpacityInfos",2),N.addUniform("vEmissiveInfos",2),N.addUniform("vLightmapInfos",2),N.addUniform("vReflectivityInfos",3),N.addUniform("vMicroSurfaceSamplerInfos",2),N.addUniform("vReflectionInfos",2),N.addUniform("vReflectionFilteringInfo",2),N.addUniform("vReflectionPosition",3),N.addUniform("vReflectionSize",3),N.addUniform("vBumpInfos",3),N.addUniform("albedoMatrix",16),N.addUniform("ambientMatrix",16),N.addUniform("opacityMatrix",16),N.addUniform("emissiveMatrix",16),N.addUniform("lightmapMatrix",16),N.addUniform("reflectivityMatrix",16),N.addUniform("microSurfaceSamplerMatrix",16),N.addUniform("bumpMatrix",16),N.addUniform("vTangentSpaceParams",2),N.addUniform("reflectionMatrix",16),N.addUniform("vReflectionColor",3),N.addUniform("vAlbedoColor",4),N.addUniform("vLightingIntensity",4),N.addUniform("vReflectionMicrosurfaceInfos",3),N.addUniform("pointSize",1),N.addUniform("vReflectivityColor",4),N.addUniform("vEmissiveColor",3),N.addUniform("vAmbientColor",3),N.addUniform("vDebugMode",2),N.addUniform("vMetallicReflectanceFactors",4),N.addUniform("vMetallicReflectanceInfos",2),N.addUniform("metallicReflectanceMatrix",16),N.addUniform("vReflectanceInfos",2),N.addUniform("reflectanceMatrix",16),N.addUniform("vSphericalL00",3),N.addUniform("vSphericalL1_1",3),N.addUniform("vSphericalL10",3),N.addUniform("vSphericalL11",3),N.addUniform("vSphericalL2_2",3),N.addUniform("vSphericalL2_1",3),N.addUniform("vSphericalL20",3),N.addUniform("vSphericalL21",3),N.addUniform("vSphericalL22",3),N.addUniform("vSphericalX",3),N.addUniform("vSphericalY",3),N.addUniform("vSphericalZ",3),N.addUniform("vSphericalXX_ZZ",3),N.addUniform("vSphericalYY_ZZ",3),N.addUniform("vSphericalZZ",3),N.addUniform("vSphericalXY",3),N.addUniform("vSphericalYZ",3),N.addUniform("vSphericalZX",3),super.buildUniformLayout()}bindForSubMesh(N,Z,d){const X=this.va(),I=d.materialDefines;if(!I)return;const m=d.effect;if(!m)return;this._activeEffect=m,Z.getMeshUniformBuffer().bindToEffect(m,"Mesh"),Z.transferToEffect(N);const z=X.getEngine();this._uniformBuffer.bindToEffect(m,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,X,Z,N,this.isFrozen),t.d.Bind(z.currentRenderPassId,this._activeEffect,Z,N),this._eventInfo.subMesh=d,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),I.OBJECTSPACE_NORMALMAP&&(N.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const w=this._mustRebind(X,m,d,Z.visibility);(0,g.e)(Z,this._activeEffect,this.prePassConfiguration);let e=null;const j=this._uniformBuffer;if(w){if(this.bindViewProjection(m),e=this._getReflectionTexture(),!j.useUbo||!this.isFrozen||!j.isSync||d._drawWrapper._forceRebindOnNextCall){var B;if(X.texturesEnabled){if(this._albedoTexture&&A.c.DiffuseTextureEnabled&&(j.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),(0,g.t)(this._albedoTexture,j,"albedo")),this._ambientTexture&&A.c.AmbientTextureEnabled&&(j.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),(0,g.t)(this._ambientTexture,j,"ambient")),this._opacityTexture&&A.c.OpacityTextureEnabled&&(j.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,g.t)(this._opacityTexture,j,"opacity")),e&&A.c.ReflectionTextureEnabled){if(j.Cd("reflectionMatrix",e.getReflectionTextureMatrix()),j.updateFloat2("vReflectionInfos",e.level,0),e.boundingBoxSize){const N=e;j.updateVector3("vReflectionPosition",N.boundingBoxPosition),j.updateVector3("vReflectionSize",N.boundingBoxSize)}if(this.realTimeFiltering){const N=e.getSize().width;j.updateFloat2("vReflectionFilteringInfo",N,Math.log2(N))}if(!I.USEIRRADIANCEMAP){const N=e.sphericalPolynomial;if(I.USESPHERICALFROMREFLECTIONMAP&&N)if(I.SPHERICAL_HARMONICS){const Z=N.preScaledHarmonics;j.updateVector3("vSphericalL00",Z.l00),j.updateVector3("vSphericalL1_1",Z.l1_1),j.updateVector3("vSphericalL10",Z.l10),j.updateVector3("vSphericalL11",Z.l11),j.updateVector3("vSphericalL2_2",Z.l2_2),j.updateVector3("vSphericalL2_1",Z.l2_1),j.updateVector3("vSphericalL20",Z.l20),j.updateVector3("vSphericalL21",Z.l21),j.updateVector3("vSphericalL22",Z.l22)}else j.updateFloat3("vSphericalX",N.x.x,N.x.y,N.x.z),j.updateFloat3("vSphericalY",N.y.x,N.y.y,N.y.z),j.updateFloat3("vSphericalZ",N.z.x,N.z.y,N.z.z),j.updateFloat3("vSphericalXX_ZZ",N.xx.x-N.zz.x,N.xx.y-N.zz.y,N.xx.z-N.zz.z),j.updateFloat3("vSphericalYY_ZZ",N.yy.x-N.zz.x,N.yy.y-N.zz.y,N.yy.z-N.zz.z),j.updateFloat3("vSphericalZZ",N.zz.x,N.zz.y,N.zz.z),j.updateFloat3("vSphericalXY",N.xy.x,N.xy.y,N.xy.z),j.updateFloat3("vSphericalYZ",N.yz.x,N.yz.y,N.yz.z),j.updateFloat3("vSphericalZX",N.zx.x,N.zx.y,N.zx.z)}j.updateFloat3("vReflectionMicrosurfaceInfos",e.getSize().width,e.lodGenerationScale,e.lodGenerationOffset)}this._emissiveTexture&&A.c.EmissiveTextureEnabled&&(j.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,g.t)(this._emissiveTexture,j,"emissive")),this._lightmapTexture&&A.c.LightmapTextureEnabled&&(j.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,g.t)(this._lightmapTexture,j,"lightmap")),A.c.SpecularTextureEnabled&&(this._metallicTexture?(j.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),(0,g.t)(this._metallicTexture,j,"reflectivity")):this._reflectivityTexture&&(j.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),(0,g.t)(this._reflectivityTexture,j,"reflectivity")),this._metallicReflectanceTexture&&(j.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level),(0,g.t)(this._metallicReflectanceTexture,j,"metallicReflectance")),this._reflectanceTexture&&I.REFLECTANCE&&(j.updateFloat2("vReflectanceInfos",this._reflectanceTexture.coordinatesIndex,this._reflectanceTexture.level),(0,g.t)(this._reflectanceTexture,j,"reflectance")),this._microSurfaceTexture&&(j.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),(0,g.t)(this._microSurfaceTexture,j,"microSurfaceSampler"))),this._bumpTexture&&z.getCaps().standardDerivatives&&A.c.BumpTextureEnabled&&!this._disableBumpMap&&(j.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),(0,g.t)(this._bumpTexture,j,"bump"),X._mirroredCameraPosition?j.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):j.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&j.updateFloat("pointSize",this.pointSize),I.METALLICWORKFLOW){var D;h.i.wd[0].r=void 0===this._metallic||null===this._metallic?1:this._metallic,h.i.wd[0].g=void 0===this._roughness||null===this._roughness?1:this._roughness,j.updateColor4("vReflectivityColor",h.i.wd[0],1);const N=(null===(D=this.subSurface)||void 0===D?void 0:D._indexOfRefraction)??1.5,Z=1,d=Math.pow((N-Z)/(N+Z),2);this._metallicReflectanceColor.scaleToRef(d*this._metallicF0Factor,h.i.wd[0]);const X=this._metallicF0Factor;j.updateColor4("vMetallicReflectanceFactors",h.i.wd[0],X)}else j.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);j.updateColor3("vEmissiveColor",A.c.EmissiveTextureEnabled?this._emissiveColor:h.b.BlackReadOnly),j.updateColor3("vReflectionColor",this._reflectionColor),!I.SS_REFRACTION&&null!==(B=this.subSurface)&&void 0!==B&&B._linkRefractionWithTransparency?j.updateColor4("vAlbedoColor",this._albedoColor,1):j.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*X.environmentIntensity,this._lightingInfos.w=this._specularIntensity,j.updateVector4("vLightingIntensity",this._lightingInfos),X.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor),j.updateColor3("vAmbientColor",this._globalAmbientColor),j.updateFloat2("vDebugMode",this.debugLimit,this.debugFactor)}X.texturesEnabled&&(this._albedoTexture&&A.c.DiffuseTextureEnabled&&j.setTexture("albedoSampler",this._albedoTexture),this._ambientTexture&&A.c.AmbientTextureEnabled&&j.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&A.c.OpacityTextureEnabled&&j.setTexture("opacitySampler",this._opacityTexture),e&&A.c.ReflectionTextureEnabled&&(I.LODBASEDMICROSFURACE?j.setTexture("reflectionSampler",e):(j.setTexture("reflectionSampler",e._lodTextureMid||e),j.setTexture("reflectionSamplerLow",e._lodTextureLow||e),j.setTexture("reflectionSamplerHigh",e._lodTextureHigh||e)),I.USEIRRADIANCEMAP&&j.setTexture("irradianceSampler",e.irradianceTexture)),I.ENVIRONMENTBRDF&&j.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&A.c.EmissiveTextureEnabled&&j.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&A.c.LightmapTextureEnabled&&j.setTexture("lightmapSampler",this._lightmapTexture),A.c.SpecularTextureEnabled&&(this._metallicTexture?j.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&j.setTexture("reflectivitySampler",this._reflectivityTexture),this._metallicReflectanceTexture&&j.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture),this._reflectanceTexture&&I.REFLECTANCE&&j.setTexture("reflectanceSampler",this._reflectanceTexture),this._microSurfaceTexture&&j.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&z.getCaps().standardDerivatives&&A.c.BumpTextureEnabled&&!this._disableBumpMap&&j.setTexture("bumpSampler",this._bumpTexture)),this.va().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(Z)&&this.va().depthPeelingRenderer.bind(m),this._eventInfo.subMesh=d,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,x.i)(this._activeEffect,this,X),this.bindEyePosition(m)}else X.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(w||!this.isFrozen){var v;if(X.lightsEnabled&&!this._disableLighting&&(0,g.i)(X,Z,this._activeEffect,I,this._maxSimultaneousLights),(X.fogEnabled&&Z.applyFog&&X.fogMode!==S.e.FOGMODE_NONE||e||this.subSurface.refractionTexture||Z.receiveShadows||I.PREPASS)&&this.bindView(m),(0,g.f)(X,Z,this._activeEffect,!0),I.NUM_MORPH_INFLUENCERS&&(0,g.n)(Z,this._activeEffect),I.BAKED_VERTEX_ANIMATION_TEXTURE)null===(v=Z.bakedVertexAnimationManager)||void 0===v||v.bind(m,I.INSTANCES);this._imageProcessingConfiguration.bind(this._activeEffect),(0,g.k)(I,this._activeEffect,X)}this._afterBind(Z,this._activeEffect,d),j.update()}getAnimatables(){const N=super.getAnimatables();return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&N.push(this._albedoTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&N.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&N.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&N.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&N.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?N.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&N.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&N.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&N.push(this._lightmapTexture),this._metallicReflectanceTexture&&this._metallicReflectanceTexture.animations&&this._metallicReflectanceTexture.animations.length>0&&N.push(this._metallicReflectanceTexture),this._reflectanceTexture&&this._reflectanceTexture.animations&&this._reflectanceTexture.animations.length>0&&N.push(this._reflectanceTexture),this._microSurfaceTexture&&this._microSurfaceTexture.animations&&this._microSurfaceTexture.animations.length>0&&N.push(this._microSurfaceTexture),N}_getReflectionTexture(){return this._reflectionTexture?this._reflectionTexture:this.va().environmentTexture}getActiveTextures(){const N=super.getActiveTextures();return this._albedoTexture&&N.push(this._albedoTexture),this._ambientTexture&&N.push(this._ambientTexture),this._opacityTexture&&N.push(this._opacityTexture),this._reflectionTexture&&N.push(this._reflectionTexture),this._emissiveTexture&&N.push(this._emissiveTexture),this._reflectivityTexture&&N.push(this._reflectivityTexture),this._metallicTexture&&N.push(this._metallicTexture),this._metallicReflectanceTexture&&N.push(this._metallicReflectanceTexture),this._reflectanceTexture&&N.push(this._reflectanceTexture),this._microSurfaceTexture&&N.push(this._microSurfaceTexture),this._bumpTexture&&N.push(this._bumpTexture),this._lightmapTexture&&N.push(this._lightmapTexture),N}hasTexture(N){return!!super.hasTexture(N)||(this._albedoTexture===N||(this._ambientTexture===N||(this._opacityTexture===N||(this._reflectionTexture===N||(this._emissiveTexture===N||(this._reflectivityTexture===N||(this._metallicTexture===N||(this._metallicReflectanceTexture===N||(this._reflectanceTexture===N||(this._microSurfaceTexture===N||(this._bumpTexture===N||this._lightmapTexture===N)))))))))))}setPrePassRenderer(){var N;if(null===(N=this.subSurface)||void 0===N||!N.isScatteringEnabled)return!1;const Z=this.va().enableSubSurfaceForPrePass();return Z&&(Z.enabled=!0),!0}dispose(N,Z){var d,X,I,m,z,w,S,e,j,B,D,v;(this._breakShaderLoadedCheck=!0,Z)&&(this._environmentBRDFTexture&&this.va().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),null===(d=this._albedoTexture)||void 0===d||d.dispose(),null===(X=this._ambientTexture)||void 0===X||X.dispose(),null===(I=this._opacityTexture)||void 0===I||I.dispose(),null===(m=this._reflectionTexture)||void 0===m||m.dispose(),null===(z=this._emissiveTexture)||void 0===z||z.dispose(),null===(w=this._metallicTexture)||void 0===w||w.dispose(),null===(S=this._reflectivityTexture)||void 0===S||S.dispose(),null===(e=this._bumpTexture)||void 0===e||e.dispose(),null===(j=this._lightmapTexture)||void 0===j||j.dispose(),null===(B=this._metallicReflectanceTexture)||void 0===B||B.dispose(),null===(D=this._reflectanceTexture)||void 0===D||D.dispose(),null===(v=this._microSurfaceTexture)||void 0===v||v.dispose());this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(N,Z)}}s.PBRMATERIAL_OPAQUE=C.e.MATERIAL_OPAQUE,s.PBRMATERIAL_ALPHATEST=C.e.MATERIAL_ALPHATEST,s.PBRMATERIAL_ALPHABLEND=C.e.MATERIAL_ALPHABLEND,s.PBRMATERIAL_ALPHATESTANDBLEND=C.e.MATERIAL_ALPHATESTANDBLEND,s.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,s.LIGHTFALLOFF_PHYSICAL=0,s.LIGHTFALLOFF_GLTF=1,s.LIGHTFALLOFF_STANDARD=2,s.ForceGLSL=!1,(0,X.d)([(0,I.t)()],s.prototype,"_imageProcessingConfiguration",void 0),(0,X.d)([(0,I.b)("_markAllSubMeshesAsMiscDirty")],s.prototype,"debugMode",void 0)},11766:(N,Z,d)=>{"use strict";d.d(Z,{e:()=>D});var X=d(942),I=d(949),m=d(1133),z=d(960),w=d(1002),S=d(938),e=d(978),j=d(958),B=d(1094);d(1444);class D extends w.b{set boundingBoxSize(N){if(this._boundingBoxSize&&this._boundingBoxSize.equals(N))return;this._boundingBoxSize=N;const Z=this.va();Z&&Z.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(N){this._rotationY=N,this.setReflectionTextureMatrix(z.c.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(N,Z,d){let X="";return N.forEach((N=>X+=N)),new D(X,Z,null,d,N)}static CreateFromPrefilteredData(N,Z){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,X=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const I=Z.useDelayedTextureLoading;Z.useDelayedTextureLoading=!1;const m=new D(N,Z,null,!1,null,null,null,void 0,!0,d,X);return Z.useDelayedTextureLoading=I,m}constructor(N,Z){var d;let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,I=arguments.length>3&&void 0!==arguments[3]&&arguments[3],m=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,w=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,e=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,B=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,D=arguments.length>8&&void 0!==arguments[8]&&arguments[8],v=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,T=arguments.length>10&&void 0!==arguments[10]&&arguments[10],k=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,h=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,U=arguments.length>13?arguments[13]:void 0,C=arguments.length>14?arguments[14]:void 0;super(Z),this.onLoadObservable=new j.d,this.boundingBoxPosition=z.n.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new z.c,this._buffer=null,this.name=N,this.url=N,this._noMipmap=I,this.Wc=!1,this.isCube=!0,this._textureMatrix=z.c.Identity(),this.coordinatesMode=S.c.CUBIC_MODE;let M=null,Q=null;null===X||Array.isArray(X)?(this._noMipmap=I,this._format=B,this._createPolynomials=T,M=X,this._loaderOptions=U,this._useSRGBBuffer=C,this._lodScale=k,this._lodOffset=h):(M=X.extensions??null,this._noMipmap=X.noMipmap??!1,m=X.files??null,Q=X.buffer??null,this._format=X.format??5,D=X.prefiltered??!1,v=X.forcedExtension??null,this._createPolynomials=X.createPolynomials??!1,this._lodScale=X.lodScale??.8,this._lodOffset=X.lodOffset??0,this._loaderOptions=X.loaderOptions,this._useSRGBBuffer=X.useSRGBBuffer,w=X.X??null,e=X.onError??null),(N||m)&&this.updateURL(N,v,w,D,e,M,null===(d=this.va())||void 0===d?void 0:d.useDelayedTextureLoading,m,Q)}getClassName(){return"CubeTexture"}updateURL(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,X=arguments.length>3&&void 0!==arguments[3]&&arguments[3],I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,z=arguments.length>6&&void 0!==arguments[6]&&arguments[6],w=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,S=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=N),this.url=N,Z&&(this._forcedExtension=Z);const e=N.lastIndexOf("."),j=Z||(e>-1?N.substring(e).toLowerCase():""),B=0===j.indexOf(".dds"),D=0===j.indexOf(".env"),v=0===j.indexOf(".basis");if(D?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=X,X&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),w)this._files=w;else if(v||D||B||m||(m=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,m){for(let Z=0;Z<m.length;Z++)this._files.push(N+m[Z]);this._extensions=m}this._buffer=S,z?(this.delayLoadState=4,this._delayedOnLoad=d,this._delayedOnError=I):this._loadTexture(d,I)}delayLoad(N){4===this.delayLoadState&&(N&&(this._forcedExtension=N),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(N){var Z,d;if(N.updateFlag===this._textureMatrix.updateFlag)return;N.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(d=this.va())||void 0===d||d.markAllMaterialsAsDirty(1,(N=>-1!==N.getActiveTextures().indexOf(this))));if(this._textureMatrix=N,null===(Z=this.va())||void 0===Z||!Z.useRightHandedSystem)return;const X=z.h.kd[0],I=z.h.Quaternion[0],m=z.h.kd[1];this._textureMatrix.decompose(X,I,m),I.z*=-1,I.w*=-1,z.c.ComposeToRef(X,I,m,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var N;return null!==(N=this.va())&&void 0!==N&&N.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const d=this.va(),X=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const I=()=>{var Z;(this.onLoadObservable.notifyObservers(this),X)&&(X.dispose(),null===(Z=this.va())||void 0===Z||Z.markAllMaterialsAsDirty(1));N&&N()},z=(N,d)=>{this._loadingError=!0,this._errorObject={message:N,exception:d},Z&&Z(N,d),S.c.OnTextureLoadErrorObservable.notifyObservers(this)};var w;this._texture?this._texture.isReady?m.g.SetImmediate((()=>I())):this._texture.onLoadedObservable.add((()=>I())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,d,this._lodScale,this._lodOffset,N,z,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,d,this._files,this._noMipmap,N,z,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(w=this._texture)||void 0===w||w.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(N,Z,d){const X=B.c.Parse((()=>{let X=!1;return N.prefiltered&&(X=N.prefiltered),new D(d+(N.url??N.name),Z,N.extensions,!1,N.files||null,null,null,void 0,X,N.forcedExtension)}),N,Z);if(N.boundingBoxPosition&&(X.boundingBoxPosition=z.n._c(N.boundingBoxPosition)),N.boundingBoxSize&&(X.boundingBoxSize=z.n._c(N.boundingBoxSize)),N.animations)for(let I=0;I<N.animations.length;I++){const Z=N.animations[I],d=(0,e.d)("BABYLON.Animation");d&&X.animations.push(d.Parse(Z))}return X}clone(){let N=0;const Z=B.c.Clone((()=>{const Z=new D(this.url,this.va()||this._getEngine(),this._extensions,this._noMipmap,this._files);return N=Z.uniqueId,Z}),this);return Z.uniqueId=N,Z}}(0,X.d)([(0,I.I)()],D.prototype,"url",void 0),(0,X.d)([(0,I.H)()],D.prototype,"boundingBoxPosition",void 0),(0,X.d)([(0,I.H)()],D.prototype,"boundingBoxSize",null),(0,X.d)([(0,I.I)("rotationY")],D.prototype,"rotationY",null),(0,X.d)([(0,I.I)("files")],D.prototype,"_files",void 0),(0,X.d)([(0,I.I)("forcedExtension")],D.prototype,"_forcedExtension",void 0),(0,X.d)([(0,I.I)("extensions")],D.prototype,"_extensions",void 0),(0,X.d)([(0,I.u)("textureMatrix")],D.prototype,"_textureMatrix",void 0),(0,X.d)([(0,I.u)("textureMatrixRefraction")],D.prototype,"_textureMatrixRefraction",void 0),S.c._CubeTextureParser=D.Parse,(0,e.h)("BABYLON.CubeTexture",D)},12076:(N,Z,d)=>{"use strict";d.d(Z,{d:()=>S});var X=d(1051),I=d(938),m=d(1143),z=d(1324),w=d(1080);z.ThinEngine.prototype.createDynamicTexture=function(N,Z,d,X){const I=new w.d(this,4);return I.baseWidth=N,I.baseHeight=Z,d&&(N=this.needPOTTextures?(0,m.f)(N,this._caps.maxTextureSize):N,Z=this.needPOTTextures?(0,m.f)(Z,this._caps.maxTextureSize):Z),I.width=N,I.height=Z,I.isReady=!1,I.generateMipMaps=d,I.samplingMode=X,this.updateTextureSamplingMode(X,I),this._internalTexturesCache.push(I),I},z.ThinEngine.prototype.updateDynamicTexture=function(N,Z,d){let X=arguments.length>3&&void 0!==arguments[3]&&arguments[3],I=arguments.length>4?arguments[4]:void 0,m=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!N)return;const z=this._gl,w=z.TEXTURE_2D,S=this._bindTextureDirectly(w,N,!0,m);this._unpackFlipY(void 0===d?N.invertY:d),X&&z.pixelStorei(z.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const e=this._getWebGLTextureType(N.type),j=this._getInternalFormat(I||N.format),B=this._getRGBABufferInternalSizedFormat(N.type,j);z.texImage2D(w,0,B,j,e,Z),N.generateMipMaps&&z.generateMipmap(w),S||this._bindTextureDirectly(w,null),X&&z.pixelStorei(z.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),I&&(N.format=I),N._dynamicTextureSource=Z,N._premulAlpha=X,N.invertY=d||!1,N.isReady=!0};class S extends I.c{constructor(N,Z,d){let X=arguments.length>3&&void 0!==arguments[3]&&arguments[3],m=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,w=arguments.length>6?arguments[6]:void 0;const S=!d||d._isScene;super(null,S?d:null===d||void 0===d?void 0:d.Td,S?!X:d,w,m,void 0,void 0,void 0,void 0,z),this.name=N,this.wrapU=I.c.CLAMP_ADDRESSMODE,this.wrapV=I.c.CLAMP_ADDRESSMODE,this._generateMipMaps=X;const e=this._getEngine();if(!e)return;if(Z.getContext)this._canvas=Z,this._ownCanvas=!1,this._texture=e.createDynamicTexture(this._canvas.width,this._canvas.height,X,m);else{this._canvas=e.createCanvas(1,1),this._ownCanvas=!0;const N=Z;N.width||0===N.width?this._texture=e.createDynamicTexture(N.width,N.height,X,m):this._texture=e.createDynamicTexture(Z,Z,X,m)}const j=this.getSize();this._canvas.width!==j.width&&(this._canvas.width=j.width),this._canvas.height!==j.height&&(this._canvas.height=j.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(N){this._canvas.width=N.width,this._canvas.height=N.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(N.width,N.height,this._generateMipMaps,this.samplingMode)}scale(N){const Z=this.getSize();Z.width*=N,Z.height*=N,this._recreate(Z)}scaleTo(N,Z){const d=this.getSize();d.width=N,d.height=Z,this._recreate(d)}getContext(){return this._context}clear(N){const Z=this.getSize();N&&(this._context.fillStyle=N),this._context.clearRect(0,0,Z.width,Z.height)}update(N){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],d=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===N||N,Z,this._format||void 0,void 0,d)}drawText(N,Z,d,X,I,m,z){let w=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const S=this.getSize();if(m&&(this._context.fillStyle=m,this._context.fillRect(0,0,S.width,S.height)),this._context.font=X,null===Z||void 0===Z){const d=this._context.measureText(N);Z=(S.width-d.width)/2}if(null===d||void 0===d){const N=parseInt(X.replace(/\D/g,""));d=S.height/2+N/3.65}this._context.fillStyle=I||"",this._context.fillText(N,Z,d),w&&this.update(z)}dispose(){var N,Z;(super.dispose(),this._ownCanvas)&&(null===(N=this._canvas)||void 0===N||null===(Z=N.remove)||void 0===Z||Z.call(N));this._canvas=null,this._context=null}clone(){const N=this.va();if(!N)return this;const Z=this.getSize(),d=new S(this.name,Z,N,this._generateMipMaps);return d.Wc=this.Wc,d.level=this.level,d.wrapU=this.wrapU,d.wrapV=this.wrapV,d}serialize(){const N=this.va();N&&!N.isReady()&&X.e.Warn("The scene must be ready before serializing the dynamic texture");const Z=super.serialize();return S._IsCanvasElement(this._canvas)&&(Z.base64String=this._canvas.toDataURL()),Z.invertY=this._invertY,Z.samplingMode=this.samplingMode,Z}static _IsCanvasElement(N){return void 0!==N.toDataURL}_rebuild(){this.update()}}},11474:(N,Z,d)=>{"use strict";d.d(Z,{e:()=>I});var X=d(938);class I extends X.c{constructor(N,Z,d,I,m){let z=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],w=arguments.length>6&&void 0!==arguments[6]&&arguments[6],S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,e=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,j=arguments.length>9?arguments[9]:void 0,B=arguments.length>10?arguments[10]:void 0;super(null,m,!z,w,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,j),this.format=I,this._engine&&(this._engine._caps.textureFloatLinearFiltering||1!==e||(S=1),this._engine._caps.textureHalfFloatLinearFiltering||2!==e||(S=1),this._texture=this._engine.createRawTexture(N,Z,d,I,z,w,S,null,e,j??0,B??!1),this.wrapU=X.c.CLAMP_ADDRESSMODE,this.wrapV=X.c.CLAMP_ADDRESSMODE)}update(N){this._getEngine().updateRawTexture(this._texture,N,this._texture.format,this._texture.invertY,null,this._texture.type,this._texture._useSRGBBuffer)}clone(){if(!this._texture)return super.clone();const N=new I(null,this.getSize().width,this.getSize().height,this.format,this.va(),this._texture.generateMipMaps,this._invertY,this.samplingMode,this._texture.type,this._texture._creationFlags,this._useSRGBBuffer);return N._texture=this._texture,this._texture.incrementReferences(),N}static CreateLuminanceTexture(N,Z,d,X){return new I(N,Z,d,1,X,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateLuminanceAlphaTexture(N,Z,d,X){return new I(N,Z,d,2,X,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateAlphaTexture(N,Z,d,X){return new I(N,Z,d,0,X,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateRGBTexture(N,Z,d,X){return new I(N,Z,d,4,X,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBATexture(N,Z,d,X){return new I(N,Z,d,5,X,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBAStorageTexture(N,Z,d,X){return new I(N,Z,d,5,X,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,1,arguments.length>8&&void 0!==arguments[8]&&arguments[8])}static CreateRTexture(N,Z,d,m){let z=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],w=arguments.length>5&&void 0!==arguments[5]&&arguments[5],S=arguments.length>6&&void 0!==arguments[6]?arguments[6]:X.c.TRILINEAR_SAMPLINGMODE;return new I(N,Z,d,6,m,z,w,S,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1)}static CreateRStorageTexture(N,Z,d,m){let z=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],w=arguments.length>5&&void 0!==arguments[5]&&arguments[5],S=arguments.length>6&&void 0!==arguments[6]?arguments[6]:X.c.TRILINEAR_SAMPLINGMODE;return new I(N,Z,d,6,m,z,w,S,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,1)}}},11374:(N,Z,d)=>{"use strict";d.d(Z,{b:()=>z});var X=d(1249),I=d(1100),m=d(978);class z extends X.e{get vg(){return this._subMaterials}set vg(N){this._subMaterials=N,this._hookArray(N)}getChildren(){return this.vg}constructor(N,Z){super(N,Z,!0),this._waitingSubMaterialsUniqueIds=[],this.va().addMultiMaterial(this),this.vg=[],this._storeEffectOnSubMeshes=!0}_hookArray(N){var Z=this;const d=N.push;N.push=function(){for(var X=arguments.length,I=new Array(X),m=0;m<X;m++)I[m]=arguments[m];const z=d.apply(N,I);return Z._markAllSubMeshesAsTexturesDirty(),z};const X=N.splice;N.splice=(Z,d)=>{const I=X.apply(N,[Z,d]);return this._markAllSubMeshesAsTexturesDirty(),I}}getSubMaterial(N){return N<0||N>=this.vg.length?this.va().defaultMaterial:this.vg[N]}getActiveTextures(){return super.getActiveTextures().concat(...this.vg.map((N=>N?N.getActiveTextures():[])))}hasTexture(N){if(super.hasTexture(N))return!0;for(let d=0;d<this.vg.length;d++){var Z;if(null!==(Z=this.vg[d])&&void 0!==Z&&Z.hasTexture(N))return!0}return!1}getClassName(){return"MultiMaterial"}isReadyForSubMesh(N,Z,d){for(let X=0;X<this.vg.length;X++){const I=this.vg[X];if(I){if(I._storeEffectOnSubMeshes){if(!I.isReadyForSubMesh(N,Z,d))return!1;continue}if(!I.isReady(N))return!1}}return!0}clone(N,Z){const d=new z(N,this.va());for(let X=0;X<this.vg.length;X++){let I=null;const m=this.vg[X];I=Z&&m?m.clone(N+"-"+m.name):this.vg[X],d.vg.push(I)}return d}serialize(){const N={};N.name=this.name,N.id=this.id,N.uniqueId=this.uniqueId,I.e&&(N.tags=I.e.GetTags(this)),N.materialsUniqueIds=[],N.materials=[];for(let Z=0;Z<this.vg.length;Z++){const d=this.vg[Z];d?(N.materialsUniqueIds.push(d.uniqueId),N.materials.push(d.id)):(N.materialsUniqueIds.push(null),N.materials.push(null))}return N}dispose(N,Z,d){const X=this.va();if(!X)return;if(d)for(let m=0;m<this.vg.length;m++){const d=this.vg[m];d&&d.dispose(N,Z)}const I=X.multiMaterials.indexOf(this);I>=0&&X.multiMaterials.splice(I,1),super.dispose(N,Z)}static ParseMultiMaterial(N,Z){const d=new z(N.name,Z);return d.id=N.id,d._loadedUniqueId=N.uniqueId,I.e&&I.e.AddTagsTo(d,N.tags),N.materialsUniqueIds?d._waitingSubMaterialsUniqueIds=N.materialsUniqueIds:N.materials.forEach((N=>d.vg.push(Z.getLastMaterialById(N)))),d}}(0,m.h)("BABYLON.MultiMaterial",z)},11376:(N,Z,d)=>{"use strict";d.d(Z,{e:()=>j,i:()=>e});var X=d(960),I=d(1108),m=d(11321),z=d(11345),w=d(1119);d(11379);function S(N){let Z=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const d=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],m=[];let S=[];const e=N.width||N.size||1,j=N.height||N.size||1,B=N.depth||N.size||1,D=N.wrap||!1;let v=void 0===N.topBaseAt?1:N.topBaseAt,T=void 0===N.bottomBaseAt?0:N.bottomBaseAt;v=(v+4)%4,T=(T+4)%4;let k=[2,0,3,1][v],h=[2,0,1,3][T],U=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(D){Z=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],U=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let N=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],d=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const X=[17,18,19,16],I=[22,23,20,21];for(;k>0;)N.unshift(N.pop()),X.unshift(X.pop()),k--;for(;h>0;)d.unshift(d.pop()),I.unshift(I.pop()),h--;N=N.flat(),d=d.flat(),U=U.concat(N).concat(d),Z.push(X[0],X[2],X[3],X[0],X[1],X[2]),Z.push(I[0],I[2],I[3],I[0],I[1],I[2])}const C=[e/2,j/2,B/2];S=U.reduce(((N,Z,d)=>N.concat(Z*C[d%3])),[]);const M=0===N.sideOrientation?0:N.sideOrientation||z.c.DEFAULTSIDE,Q=N.faceUV||new Array(6),A=N.faceColors,n=[];for(let z=0;z<6;z++)void 0===Q[z]&&(Q[z]=new X.q(0,0,1,1)),A&&void 0===A[z]&&(A[z]=new I.e(1,1,1,1));for(let X=0;X<6;X++)if(m.push(Q[X].z,w.b?1-Q[X].w:Q[X].w),m.push(Q[X].x,w.b?1-Q[X].w:Q[X].w),m.push(Q[X].x,w.b?1-Q[X].y:Q[X].y),m.push(Q[X].z,w.b?1-Q[X].y:Q[X].y),A)for(let N=0;N<4;N++)n.push(A[X].r,A[X].g,A[X].b,A[X].a);z.c._ComputeSides(M,S,Z,d,m,N.frontUVs,N.backUVs);const g=new z.c;if(g.indices=Z,g.xa=S,g.ya=d,g.Aa=m,A){const N=M===z.c.DOUBLESIDE?n.concat(n):n;g.za=N}return g}function e(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const X=new m.b(N,d);Z.sideOrientation=m.b._GetDefaultSideOrientation(Z.sideOrientation),X._originalBuilderSideOrientation=Z.sideOrientation;return S(Z).Ca(X,Z.updatable),X}const j={CreateBox:e};z.c.CreateBox=S,m.b.CreateBox=function(N,Z){return e(N,{size:Z,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},11489:(N,Z,d)=>{"use strict";d.d(Z,{e:()=>w});var X=d(11321),I=d(11345),m=d(1119);function z(N){const Z=[],d=[],X=[],z=[],w=N.i||.5,S=N.Vk||64,e=N.arc&&(N.arc<=0||N.arc>1)?1:N.arc||1,j=0===N.sideOrientation?0:N.sideOrientation||I.c.DEFAULTSIDE;Z.push(0,0,0),z.push(.5,.5);const B=2*Math.PI*e,D=1===e?B/S:B/(S-1);let v=0;for(let I=0;I<S;I++){const N=Math.cos(v),d=Math.sin(v),X=(N+1)/2,I=(1-d)/2;Z.push(w*N,w*d,0),z.push(X,m.b?1-I:I),v+=D}1===e&&(Z.push(Z[3],Z[4],Z[5]),z.push(z[2],m.b?1-z[3]:z[3]));const T=Z.length/3;for(let I=1;I<T-1;I++)d.push(I+1,0,I);I.c.ComputeNormals(Z,d,X),I.c._ComputeSides(j,Z,d,X,z,N.frontUVs,N.backUVs);const k=new I.c;return k.indices=d,k.xa=Z,k.ya=X,k.Aa=z,k}function w(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const I=new X.b(N,d);Z.sideOrientation=X.b._GetDefaultSideOrientation(Z.sideOrientation),I._originalBuilderSideOrientation=Z.sideOrientation;return z(Z).Ca(I,Z.updatable),I}I.c.mb=z,X.b.mb=function(N,Z,d){return w(N,{i:Z,Vk:d,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},11379:(N,Z,d)=>{"use strict";d.d(Z,{g:()=>h,d:()=>C,k:()=>U});var X=d(960),I=d(1108),m=d(11321),z=d(11345),w=d(1169);m.b._GroundMeshParser=(N,Z)=>S.Parse(N,Z);class S extends m.b{constructor(N,Z){super(N,Z),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=N,this._subdivisionsY=N,this.subdivide(N);const d=this;d.createOrUpdateSubmeshesOctree&&d.createOrUpdateSubmeshesOctree(Z)}getHeightAtCoordinates(N,Z){const d=this.getWorldMatrix(),I=X.h.Matrix[5];d.invertToRef(I);const m=X.h.kd[8];if(X.n.TransformCoordinatesFromFloatsToRef(N,0,Z,I,m),N=m.x,Z=m.z,N<this._minX||N>=this._maxX||Z<=this._minZ||Z>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const z=this._getFacetAt(N,Z),w=-(z.x*N+z.z*Z+z.w)/z.y;return X.n.TransformCoordinatesFromFloatsToRef(0,w,0,d,m),m.y}getNormalAtCoordinates(N,Z){const d=new X.n(0,1,0);return this.getNormalAtCoordinatesToRef(N,Z,d),d}getNormalAtCoordinatesToRef(N,Z,d){const I=this.getWorldMatrix(),m=X.h.Matrix[5];I.invertToRef(m);const z=X.h.kd[8];if(X.n.TransformCoordinatesFromFloatsToRef(N,0,Z,m,z),N=z.x,Z=z.z,N<this._minX||N>this._maxX||Z<this._minZ||Z>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const w=this._getFacetAt(N,Z);return X.n.TransformNormalFromFloatsToRef(w.x,w.y,w.z,I,d),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(N,Z){const d=Math.floor((N+this._maxX)*this._subdivisionsX/this._width),X=Math.floor(-(Z+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),I=this._heightQuads[X*this._subdivisionsX+d];let m;return m=Z<I.slope.x*N+I.slope.y?I.facet1:I.facet2,m}_initHeightQuads(){const N=this._subdivisionsX,Z=this._subdivisionsY;this._heightQuads=new Array;for(let d=0;d<Z;d++)for(let Z=0;Z<N;Z++){const I={slope:X.l.Zero(),facet1:new X.q(0,0,0,0),facet2:new X.q(0,0,0,0)};this._heightQuads[d*N+Z]=I}return this}_computeHeightQuads(){const N=this.getVerticesData(w.d.PositionKind);if(!N)return this;const Z=X.h.kd[3],d=X.h.kd[2],I=X.h.kd[1],m=X.h.kd[0],z=X.h.kd[4],S=X.h.kd[5],e=X.h.kd[6],j=X.h.kd[7],B=X.h.kd[8];let D=0,v=0,T=0,k=0,h=0,U=0,C=0;const M=this._subdivisionsX,Q=this._subdivisionsY;for(let w=0;w<Q;w++)for(let Q=0;Q<M;Q++){D=3*Q,v=w*(M+1)*3,T=(w+1)*(M+1)*3,Z.x=N[v+D],Z.y=N[v+D+1],Z.z=N[v+D+2],d.x=N[v+D+3],d.y=N[v+D+4],d.z=N[v+D+5],I.x=N[T+D],I.y=N[T+D+1],I.z=N[T+D+2],m.x=N[T+D+3],m.y=N[T+D+4],m.z=N[T+D+5],k=(m.z-Z.z)/(m.x-Z.x),h=Z.z-k*Z.x,d.subtractToRef(Z,z),I.subtractToRef(Z,S),m.subtractToRef(Z,e),X.n.CrossToRef(e,S,j),X.n.CrossToRef(z,e,B),j.normalize(),B.normalize(),U=-(j.x*Z.x+j.y*Z.y+j.z*Z.z),C=-(B.x*d.x+B.y*d.y+B.z*d.z);const A=this._heightQuads[w*M+Q];A.slope.fd(k,h),A.facet1.fd(j.x,j.y,j.z,U),A.facet2.fd(B.x,B.y,B.z,C)}return this}serialize(N){super.serialize(N),N.subdivisionsX=this._subdivisionsX,N.subdivisionsY=this._subdivisionsY,N.minX=this._minX,N.maxX=this._maxX,N.gj=this._minZ,N.maxZ=this._maxZ,N.width=this._width,N.height=this._height}static Parse(N,Z){const d=new S(N.name,Z);return d._subdivisionsX=N.subdivisionsX||1,d._subdivisionsY=N.subdivisionsY||1,d._minX=N.minX,d._maxX=N.maxX,d._minZ=N.gj,d._maxZ=N.maxZ,d._width=N.width,d._height=N.height,d}}var e=d(1133),j=d(986),B=d(966),D=d(1119);function v(N){const Z=[],d=[],I=[],m=[];let w,S;const e=N.width||N.size||1,j=N.height||N.size||1,B=0|(N.subdivisionsX||N.subdivisions||1),v=0|(N.subdivisionsY||N.subdivisions||1);for(w=0;w<=v;w++)for(S=0;S<=B;S++){const N=new X.n(S*e/B-e/2,0,(v-w)*j/v-j/2),Z=new X.n(0,1,0);d.push(N.x,N.y,N.z),I.push(Z.x,Z.y,Z.z),m.push(S/B,D.b?w/v:1-w/v)}for(w=0;w<v;w++)for(S=0;S<B;S++)Z.push(S+1+(w+1)*(B+1)),Z.push(S+1+w*(B+1)),Z.push(S+w*(B+1)),Z.push(S+(w+1)*(B+1)),Z.push(S+1+(w+1)*(B+1)),Z.push(S+w*(B+1));const T=new z.c;return T.indices=Z,T.xa=d,T.ya=I,T.Aa=m,T}function T(N){const Z=void 0!==N.xmin&&null!==N.xmin?N.xmin:-1,d=void 0!==N.zmin&&null!==N.zmin?N.zmin:-1,I=void 0!==N.xmax&&null!==N.xmax?N.xmax:1,m=void 0!==N.zmax&&null!==N.zmax?N.zmax:1,w=N.subdivisions||{w:1,h:1},S=N.precision||{w:1,h:1},e=[],j=[],B=[],D=[];let v,T,k,h;w.h=w.h<1?1:w.h,w.w=w.w<1?1:w.w,S.w=S.w<1?1:S.w,S.h=S.h<1?1:S.h;const U=(I-Z)/w.w,C=(m-d)/w.h;function M(N,Z,d,I){const m=j.length/3,z=S.w+1;for(v=0;v<S.h;v++)for(T=0;T<S.w;T++){const N=[m+T+v*z,m+(T+1)+v*z,m+(T+1)+(v+1)*z,m+T+(v+1)*z];e.push(N[1]),e.push(N[2]),e.push(N[3]),e.push(N[0]),e.push(N[1]),e.push(N[3])}const w=X.n.Zero(),k=new X.n(0,1,0);for(v=0;v<=S.h;v++)for(w.z=v*(I-Z)/S.h+Z,T=0;T<=S.w;T++)w.x=T*(d-N)/S.w+N,w.y=0,j.push(w.x,w.y,w.z),B.push(k.x,k.y,k.z),D.push(T/S.w,v/S.h)}for(k=0;k<w.h;k++)for(h=0;h<w.w;h++)M(Z+h*U,d+k*C,Z+(h+1)*U,d+(k+1)*C);const Q=new z.c;return Q.indices=e,Q.xa=j,Q.ya=B,Q.Aa=D,Q}function k(N){const Z=[],d=[],m=[],w=[];let S,e;const j=N.colorFilter||new I.b(.3,.59,.11),D=N.alphaFilter||0;let v=!1;if(N.minHeight>N.maxHeight){v=!0;const Z=N.maxHeight;N.maxHeight=N.minHeight,N.minHeight=Z}for(S=0;S<=N.subdivisions;S++)for(e=0;e<=N.subdivisions;e++){const Z=new X.n(e*N.width/N.subdivisions-N.width/2,0,(N.subdivisions-S)*N.height/N.subdivisions-N.height/2),I=4*(((Z.x+N.width/2)/N.width*(N.bufferWidth-1)|0)+((1-(Z.z+N.height/2)/N.height)*(N.bufferHeight-1)|0)*N.bufferWidth);let z=N.buffer[I]/255,T=N.buffer[I+1]/255,k=N.buffer[I+2]/255;const h=N.buffer[I+3]/255;v&&(z=1-z,T=1-T,k=1-k);const U=z*j.r+T*j.g+k*j.b;Z.y=h>=D?N.minHeight+(N.maxHeight-N.minHeight)*U:N.minHeight-B.b,N.heightBuffer&&(N.heightBuffer[S*(N.subdivisions+1)+e]=Z.y),d.push(Z.x,Z.y,Z.z),m.push(0,0,0),w.push(e/N.subdivisions,1-S/N.subdivisions)}for(S=0;S<N.subdivisions;S++)for(e=0;e<N.subdivisions;e++){const X=e+1+(S+1)*(N.subdivisions+1),I=e+1+S*(N.subdivisions+1),m=e+S*(N.subdivisions+1),z=e+(S+1)*(N.subdivisions+1),w=d[3*X+1]>=N.minHeight,j=d[3*I+1]>=N.minHeight,B=d[3*m+1]>=N.minHeight;w&&j&&B&&(Z.push(X),Z.push(I),Z.push(m));d[3*z+1]>=N.minHeight&&w&&B&&(Z.push(z),Z.push(X),Z.push(m))}z.c.ComputeNormals(d,Z,m);const T=new z.c;return T.indices=Z,T.xa=d,T.ya=m,T.Aa=w,T}function h(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const d=new S(N,arguments.length>2?arguments[2]:void 0);d._setReady(!1),d._subdivisionsX=Z.subdivisionsX||Z.subdivisions||1,d._subdivisionsY=Z.subdivisionsY||Z.subdivisions||1,d._width=Z.width||1,d._height=Z.height||1,d._maxX=d._width/2,d._maxZ=d._height/2,d._minX=-d._maxX,d._minZ=-d._maxZ;return v(Z).Ca(d,Z.updatable),d._setReady(!0),d}function U(N,Z){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const X=new m.b(N,d);return T(Z).Ca(X,Z.updatable),X}function C(N,Z){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const m=d.width||10,z=d.height||10,w=d.subdivisions||1,B=d.minHeight||0,D=d.maxHeight||1,v=d.colorFilter||new I.b(.3,.59,.11),T=d.alphaFilter||0,h=d.updatable,U=d.onReady;X=X||j.e.LastCreatedScene;const C=new S(N,X);let M;C._subdivisionsX=w,C._subdivisionsY=w,C._width=m,C._height=z,C._maxX=C._width/2,C._maxZ=C._height/2,C._minX=-C._maxX,C._minZ=-C._maxZ,C._setReady(!1),d.passHeightBufferInCallback&&(M=new Float32Array((w+1)*(w+1)));const Q=(N,Z,d)=>{k({width:m,height:z,subdivisions:w,minHeight:B,maxHeight:D,colorFilter:v,buffer:N,bufferWidth:Z,bufferHeight:d,alphaFilter:T,heightBuffer:M}).Ca(C,h),U&&U(C,M),C._setReady(!0)};if("string"===typeof Z){const N=N=>{var Z;const d=N.width,I=N.height;if(X.u)return;const m=null===(Z=X)||void 0===Z?void 0:Z.getEngine().resizeImageBitmap(N,d,I);Q(m,d,I)};e.g.LoadImage(Z,N,d.onError?d.onError:()=>{},X.offlineProvider)}else Q(Z.data,Z.width,Z.height);return C}z.c.CreateGround=v,z.c.CreateTiledGround=T,z.c.CreateGroundFromHeightMap=k,m.b.CreateGround=(N,Z,d,X,I,m)=>h(N,{width:Z,height:d,subdivisions:X,updatable:m},I),m.b.CreateTiledGround=(N,Z,d,X,I,m,z,w,S)=>U(N,{xmin:Z,zmin:d,xmax:X,zmax:I,subdivisions:m,precision:z,updatable:S},w),m.b.CreateGroundFromHeightMap=(N,Z,d,X,I,m,z,w,S,e,j)=>C(N,Z,{width:d,height:X,subdivisions:I,minHeight:m,maxHeight:z,updatable:S,onReady:e,alphaFilter:j},w)},12074:(N,Z,d)=>{"use strict";d.d(Z,{d:()=>P,h:()=>K,l:()=>r});var X=d(960),I=d(11321),m=d(11345),z=d(1108),w=d(1169),S=d(11748),e=d(1249),j=d(1094),B=d(1131),D=d(938),v=d(978),T=d(1303),k=d(1017),h=d(1297),U=d(986),C=d(1288),M=d(1285);const Q={effect:null,subMesh:null};class A extends h.c{constructor(N,Z,d){let I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(N,Z,!(arguments.length>4&&void 0!==arguments[4])||arguments[4]),this._textures={},this._textureArrays={},this._externalTextures={},this._floats={},this._ints={},this._uints={},this._floatsArrays={},this._colors3={},this._colors3Arrays={},this._colors4={},this._colors4Arrays={},this._vectors2={},this._vectors3={},this._vectors4={},this._quaternions={},this._quaternionsArrays={},this._matrices={},this._matrixArrays={},this._matrices3x3={},this._matrices2x2={},this._vectors2Arrays={},this._vectors3Arrays={},this._vectors4Arrays={},this._uniformBuffers={},this._textureSamplers={},this._storageBuffers={},this._cachedWorldViewMatrix=new X.c,this._cachedWorldViewProjectionMatrix=new X.c,this._multiview=!1,this._materialHelperNeedsPreviousMatrices=!1,this._shaderPath=d,this._options={needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","ld","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],externalTextures:[],samplerObjects:[],storageBuffers:[],defines:[],useClipPlane:!1,...I}}get shaderPath(){return this._shaderPath}set shaderPath(N){this._shaderPath=N}get options(){return this._options}get isMultiview(){return this._multiview}getClassName(){return"ShaderMaterial"}needAlphaBlending(){return this.alpha<1||this._options.needAlphaBlending}needAlphaTesting(){return this._options.needAlphaTesting}_checkUniform(N){-1===this._options.uniforms.indexOf(N)&&this._options.uniforms.push(N)}setTexture(N,Z){return-1===this._options.samplers.indexOf(N)&&this._options.samplers.push(N),this._textures[N]=Z,this}removeTexture(N){delete this._textures[N]}setTextureArray(N,Z){return-1===this._options.samplers.indexOf(N)&&this._options.samplers.push(N),this._checkUniform(N),this._textureArrays[N]=Z,this}setExternalTexture(N,Z){return-1===this._options.externalTextures.indexOf(N)&&this._options.externalTextures.push(N),this._externalTextures[N]=Z,this}setFloat(N,Z){return this._checkUniform(N),this._floats[N]=Z,this}setInt(N,Z){return this._checkUniform(N),this._ints[N]=Z,this}setUInt(N,Z){return this._checkUniform(N),this._uints[N]=Z,this}setFloats(N,Z){return this._checkUniform(N),this._floatsArrays[N]=Z,this}setColor3(N,Z){return this._checkUniform(N),this._colors3[N]=Z,this}setColor3Array(N,Z){return this._checkUniform(N),this._colors3Arrays[N]=Z.reduce(((N,Z)=>(Z.toArray(N,N.length),N)),[]),this}setColor4(N,Z){return this._checkUniform(N),this._colors4[N]=Z,this}setColor4Array(N,Z){return this._checkUniform(N),this._colors4Arrays[N]=Z.reduce(((N,Z)=>(Z.toArray(N,N.length),N)),[]),this}setVector2(N,Z){return this._checkUniform(N),this._vectors2[N]=Z,this}setVector3(N,Z){return this._checkUniform(N),this._vectors3[N]=Z,this}setVector4(N,Z){return this._checkUniform(N),this._vectors4[N]=Z,this}setQuaternion(N,Z){return this._checkUniform(N),this._quaternions[N]=Z,this}setQuaternionArray(N,Z){return this._checkUniform(N),this._quaternionsArrays[N]=Z.reduce(((N,Z)=>(Z.toArray(N,N.length),N)),[]),this}setMatrix(N,Z){return this._checkUniform(N),this._matrices[N]=Z,this}setMatrices(N,Z){this._checkUniform(N);const d=new Float32Array(16*Z.length);for(let X=0;X<Z.length;X++){Z[X].copyToArray(d,16*X)}return this._matrixArrays[N]=d,this}setMatrix3x3(N,Z){return this._checkUniform(N),this._matrices3x3[N]=Z,this}setMatrix2x2(N,Z){return this._checkUniform(N),this._matrices2x2[N]=Z,this}setArray2(N,Z){return this._checkUniform(N),this._vectors2Arrays[N]=Z,this}setArray3(N,Z){return this._checkUniform(N),this._vectors3Arrays[N]=Z,this}setArray4(N,Z){return this._checkUniform(N),this._vectors4Arrays[N]=Z,this}setUniformBuffer(N,Z){return-1===this._options.uniformBuffers.indexOf(N)&&this._options.uniformBuffers.push(N),this._uniformBuffers[N]=Z,this}setTextureSampler(N,Z){return-1===this._options.samplerObjects.indexOf(N)&&this._options.samplerObjects.push(N),this._textureSamplers[N]=Z,this}setStorageBuffer(N,Z){return-1===this._options.storageBuffers.indexOf(N)&&this._options.storageBuffers.push(N),this._storageBuffers[N]=Z,this}setDefine(N,Z){const d=N.trimEnd()+" ",X=this.options.defines.findIndex((Z=>Z===N||Z.startsWith(d)));return X>=0&&this.options.defines.splice(X,1),("boolean"!==typeof Z||Z)&&this.options.defines.push(d+Z),this}isReadyForSubMesh(N,Z,d){return this.isReady(N,d,Z)}isReady(N,Z,d){var X;const I=d&&this._storeEffectOnSubMeshes;if(this.isFrozen){const N=I?d._drawWrapper:this._drawWrapper;if(N.effect&&N._wasPreviouslyReady&&N._wasPreviouslyUsingInstances===Z)return!0}const m=this.va(),z=m.getEngine(),S=[],e=[],j=new T.e;let D=this._shaderPath,v=this._options.uniforms,k=this._options.uniformBuffers,h=this._options.samplers;z.getCaps().multiview&&m.activeCamera&&m.activeCamera.outputRenderTarget&&m.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,S.push("#define MULTIVIEW"),-1!==v.indexOf("viewProjection")&&-1===v.indexOf("viewProjectionR")&&v.push("viewProjectionR"));for(let w=0;w<this._options.defines.length;w++){const N=0===this._options.defines[w].indexOf("#define")?this._options.defines[w]:`#define ${this._options.defines[w]}`;S.push(N)}for(let w=0;w<this._options.attributes.length;w++)e.push(this._options.attributes[w]);if(N&&N.isVerticesDataPresent(w.d.ColorKind)&&(-1===e.indexOf(w.d.ColorKind)&&e.push(w.d.ColorKind),S.push("#define VERTEXCOLOR")),Z&&(S.push("#define INSTANCES"),(0,M.V)(e,this._materialHelperNeedsPreviousMatrices),null!==N&&void 0!==N&&N.hasThinInstances&&(S.push("#define THIN_INSTANCES"),N&&N.isVerticesDataPresent(w.d.ColorInstanceKind)&&(e.push(w.d.ColorInstanceKind),S.push("#define INSTANCESCOLOR")))),N&&N.useBones&&N.computeBonesUsingShaders&&N.skeleton){e.push(w.d.MatricesIndicesKind),e.push(w.d.MatricesWeightsKind),N.numBoneInfluencers>4&&(e.push(w.d.MatricesIndicesExtraKind),e.push(w.d.MatricesWeightsExtraKind));const Z=N.skeleton;S.push("#define NUM_BONE_INFLUENCERS "+N.numBoneInfluencers),j.addCPUSkinningFallback(0,N),Z.isUsingTextureForMatrices?(S.push("#define BONETEXTURE"),-1===v.indexOf("boneTextureWidth")&&v.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(S.push("#define BonesPerMesh "+(Z.bones.length+1)),-1===v.indexOf("mBones")&&v.push("mBones"))}else S.push("#define NUM_BONE_INFLUENCERS 0");let U=0;const A=N?N.morphTargetManager:null;if(A){const N=A.supportsUVs&&-1!==S.indexOf("#define UV1"),Z=A.supportsTangents&&-1!==S.indexOf("#define TANGENT"),d=A.supportsNormals&&-1!==S.indexOf("#define NORMAL");U=A.numMaxInfluencers||A.numInfluencers,N&&S.push("#define MORPHTARGETS_UV"),Z&&S.push("#define MORPHTARGETS_TANGENT"),d&&S.push("#define MORPHTARGETS_NORMAL"),U>0&&S.push("#define MORPHTARGETS"),A.isUsingTextureForTargets&&(S.push("#define MORPHTARGETS_TEXTURE"),-1===v.indexOf("morphTargetTextureIndices")&&v.push("morphTargetTextureIndices"),-1===this._options.samplers.indexOf("morphTargets")&&this._options.samplers.push("morphTargets")),S.push("#define NUM_MORPH_INFLUENCERS "+U);for(let X=0;X<U;X++)e.push(w.d.PositionKind+X),d&&e.push(w.d.NormalKind+X),Z&&e.push(w.d.TangentKind+X),N&&e.push(w.d.UVKind+"_"+X);U>0&&(v=v.slice(),v.push("morphTargetInfluences"),v.push("morphTargetCount"),v.push("morphTargetTextureInfo"),v.push("morphTargetTextureIndices"))}else S.push("#define NUM_MORPH_INFLUENCERS 0");if(N){const Z=N.bakedVertexAnimationManager;Z&&Z.isEnabled&&(S.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),-1===v.indexOf("bakedVertexAnimationSettings")&&v.push("bakedVertexAnimationSettings"),-1===v.indexOf("bakedVertexAnimationTextureSizeInverted")&&v.push("bakedVertexAnimationTextureSizeInverted"),-1===v.indexOf("bakedVertexAnimationTime")&&v.push("bakedVertexAnimationTime"),-1===this._options.samplers.indexOf("bakedVertexAnimationTexture")&&this._options.samplers.push("bakedVertexAnimationTexture")),(0,M.w)(e,N,S)}for(const w in this._textures)if(!this._textures[w].isReady())return!1;N&&this._shouldTurnAlphaTestOn(N)&&S.push("#define ALPHATEST"),!1!==this._options.useClipPlane&&((0,C.e)(v),(0,C.l)(this,m,S)),m.fogEnabled&&null!==N&&void 0!==N&&N.applyFog&&m.fogMode!==B.e.FOGMODE_NONE&&(S.push("#define FOG"),-1===v.indexOf("view")&&v.push("view"),-1===v.indexOf("vFogInfos")&&v.push("vFogInfos"),-1===v.indexOf("vFogColor")&&v.push("vFogColor")),this._useLogarithmicDepth&&(S.push("#define LOGARITHMICDEPTH"),-1===v.indexOf("logarithmicDepthConstant")&&v.push("logarithmicDepthConstant")),this.customShaderNameResolve&&(v=v.slice(),k=k.slice(),h=h.slice(),D=this.customShaderNameResolve(this.name,v,k,h,S,e));const n=I?d._getDrawWrapper(void 0,!0):this._drawWrapper,g=(null===n||void 0===n?void 0:n.effect)??null,E=(null===n||void 0===n?void 0:n.defines)??null,V=S.join("\n");let O=g;return E!==V&&(O=z.createEffect(D,{attributes:e,uniformsNames:v,uniformBuffersNames:k,samplers:h,defines:V,fallbacks:j,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousMorphTargets:U},shaderLanguage:this._options.shaderLanguage,extraInitializationsAsync:this._options.extraInitializationsAsync},z),I?d.setEffect(O,V,this._materialContext):n&&n.setEffect(O,V),this._onEffectCreatedObservable&&(Q.effect=O,Q.subMesh=d??(null===N||void 0===N?void 0:N.Sd[0])??null,this._onEffectCreatedObservable.notifyObservers(Q))),n._wasPreviouslyUsingInstances=!!Z,!((null===(X=O)||void 0===X||!X.isReady())??1)&&(g!==O&&m.resetCachedMaterial(),n._wasPreviouslyReady=!0,!0)}bindOnlyWorldMatrix(N,Z){const d=this.va(),X=Z??this.getEffect();X&&(-1!==this._options.uniforms.indexOf("world")&&X.setMatrix("world",N),-1!==this._options.uniforms.indexOf("worldView")&&(N.multiplyToRef(d.getViewMatrix(),this._cachedWorldViewMatrix),X.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==this._options.uniforms.indexOf("worldViewProjection")&&(N.multiplyToRef(d.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),X.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)),-1!==this._options.uniforms.indexOf("view")&&X.setMatrix("view",d.getViewMatrix()))}bindForSubMesh(N,Z,d){var X;this.bind(N,Z,null===(X=d._drawWrapperOverride)||void 0===X?void 0:X.effect,d)}bind(N,Z,d,X){const I=X&&this._storeEffectOnSubMeshes,m=d??(I?X.effect:this.getEffect());if(!m)return;const z=this.va();this._activeEffect=m,this.bindOnlyWorldMatrix(N,d);const w=this._options.uniformBuffers;let S=!1;if(m&&w&&w.length>0&&z.getEngine().supportsUniformBuffers)for(let B=0;B<w.length;++B){switch(w[B]){case"Mesh":Z&&(Z.getMeshUniformBuffer().bindToEffect(m,"Mesh"),Z.transferToEffect(N));break;case"Scene":(0,M.q)(m,z.getSceneUniformBuffer()),z.finalizeSceneUbo(),S=!0}}const e=Z&&I?this._mustRebind(z,m,X,Z.visibility):z.getCachedMaterial()!==this;if(m&&e){let N;for(N in S||-1===this._options.uniforms.indexOf("view")||m.setMatrix("view",z.getViewMatrix()),S||-1===this._options.uniforms.indexOf("projection")||m.setMatrix("projection",z.getProjectionMatrix()),S||-1===this._options.uniforms.indexOf("viewProjection")||(m.setMatrix("viewProjection",z.getTransformMatrix()),this._multiview&&m.setMatrix("viewProjectionR",z._transformMatrixR)),z.activeCamera&&-1!==this._options.uniforms.indexOf("cameraPosition")&&m.setVector3("cameraPosition",z.activeCamera.globalPosition),(0,M.e)(Z,m),(0,C.i)(m,this,z),this._useLogarithmicDepth&&(0,M.k)(I?X.materialDefines:m.defines,m,z),Z&&(0,M.f)(z,Z,m),this._textures)m.setTexture(N,this._textures[N]);for(N in this._textureArrays)m.setTextureArray(N,this._textureArrays[N]);for(N in this._ints)m.setInt(N,this._ints[N]);for(N in this._uints)m.setUInt(N,this._uints[N]);for(N in this._floats)m.setFloat(N,this._floats[N]);for(N in this._floatsArrays)m.setArray(N,this._floatsArrays[N]);for(N in this._colors3)m.setColor3(N,this._colors3[N]);for(N in this._colors3Arrays)m.setArray3(N,this._colors3Arrays[N]);for(N in this._colors4){const Z=this._colors4[N];m.setFloat4(N,Z.r,Z.g,Z.b,Z.a)}for(N in this._colors4Arrays)m.setArray4(N,this._colors4Arrays[N]);for(N in this._vectors2)m.setVector2(N,this._vectors2[N]);for(N in this._vectors3)m.setVector3(N,this._vectors3[N]);for(N in this._vectors4)m.setVector4(N,this._vectors4[N]);for(N in this._quaternions)m.setQuaternion(N,this._quaternions[N]);for(N in this._matrices)m.setMatrix(N,this._matrices[N]);for(N in this._matrixArrays)m.setMatrices(N,this._matrixArrays[N]);for(N in this._matrices3x3)m.setMatrix3x3(N,this._matrices3x3[N]);for(N in this._matrices2x2)m.setMatrix2x2(N,this._matrices2x2[N]);for(N in this._vectors2Arrays)m.setArray2(N,this._vectors2Arrays[N]);for(N in this._vectors3Arrays)m.setArray3(N,this._vectors3Arrays[N]);for(N in this._vectors4Arrays)m.setArray4(N,this._vectors4Arrays[N]);for(N in this._quaternionsArrays)m.setArray4(N,this._quaternionsArrays[N]);for(N in this._uniformBuffers){const Z=this._uniformBuffers[N].getBuffer();Z&&m.bindUniformBuffer(Z,N)}const d=z.getEngine(),w=d.setExternalTexture;if(w)for(N in this._externalTextures)w.call(d,N,this._externalTextures[N]);const e=d.setTextureSampler;if(e)for(N in this._textureSamplers)e.call(d,N,this._textureSamplers[N]);const j=d.setStorageBuffer;if(j)for(N in this._storageBuffers)j.call(d,N,this._storageBuffers[N])}if(m&&Z&&(e||!this.isFrozen)){const N=Z.morphTargetManager;N&&N.numInfluencers>0&&(0,M.n)(Z,m);const d=Z.bakedVertexAnimationManager;if(d&&d.isEnabled){var j;const N=I?X._drawWrapper:this._drawWrapper;null===(j=Z.bakedVertexAnimationManager)||void 0===j||j.bind(m,!!N._wasPreviouslyUsingInstances)}}this._afterBind(Z,m,X)}getActiveTextures(){const N=super.getActiveTextures();for(const Z in this._textures)N.push(this._textures[Z]);for(const Z in this._textureArrays){const d=this._textureArrays[Z];for(let Z=0;Z<d.length;Z++)N.push(d[Z])}return N}hasTexture(N){if(super.hasTexture(N))return!0;for(const Z in this._textures)if(this._textures[Z]===N)return!0;for(const Z in this._textureArrays){const d=this._textureArrays[Z];for(let Z=0;Z<d.length;Z++)if(d[Z]===N)return!0}return!1}clone(N){const Z=j.c.Clone((()=>new A(N,this.va(),this._shaderPath,this._options,this._storeEffectOnSubMeshes)),this);Z.name=N,Z.id=N,"object"===typeof Z._shaderPath&&(Z._shaderPath={...Z._shaderPath}),this._options={...this._options},Object.keys(this._options).forEach((N=>{const Z=this._options[N];Array.isArray(Z)&&(this._options[N]=Z.slice(0))})),this.stencil.copyTo(Z.stencil);for(const d in this._textures)Z.setTexture(d,this._textures[d]);for(const d in this._textureArrays)Z.setTextureArray(d,this._textureArrays[d]);for(const d in this._externalTextures)Z.setExternalTexture(d,this._externalTextures[d]);for(const d in this._ints)Z.setInt(d,this._ints[d]);for(const d in this._uints)Z.setUInt(d,this._uints[d]);for(const d in this._floats)Z.setFloat(d,this._floats[d]);for(const d in this._floatsArrays)Z.setFloats(d,this._floatsArrays[d]);for(const d in this._colors3)Z.setColor3(d,this._colors3[d]);for(const d in this._colors3Arrays)Z._colors3Arrays[d]=this._colors3Arrays[d];for(const d in this._colors4)Z.setColor4(d,this._colors4[d]);for(const d in this._colors4Arrays)Z._colors4Arrays[d]=this._colors4Arrays[d];for(const d in this._vectors2)Z.setVector2(d,this._vectors2[d]);for(const d in this._vectors3)Z.setVector3(d,this._vectors3[d]);for(const d in this._vectors4)Z.setVector4(d,this._vectors4[d]);for(const d in this._quaternions)Z.setQuaternion(d,this._quaternions[d]);for(const d in this._quaternionsArrays)Z._quaternionsArrays[d]=this._quaternionsArrays[d];for(const d in this._matrices)Z.setMatrix(d,this._matrices[d]);for(const d in this._matrixArrays)Z._matrixArrays[d]=this._matrixArrays[d].slice();for(const d in this._matrices3x3)Z.setMatrix3x3(d,this._matrices3x3[d]);for(const d in this._matrices2x2)Z.setMatrix2x2(d,this._matrices2x2[d]);for(const d in this._vectors2Arrays)Z.setArray2(d,this._vectors2Arrays[d]);for(const d in this._vectors3Arrays)Z.setArray3(d,this._vectors3Arrays[d]);for(const d in this._vectors4Arrays)Z.setArray4(d,this._vectors4Arrays[d]);for(const d in this._uniformBuffers)Z.setUniformBuffer(d,this._uniformBuffers[d]);for(const d in this._textureSamplers)Z.setTextureSampler(d,this._textureSamplers[d]);for(const d in this._storageBuffers)Z.setStorageBuffer(d,this._storageBuffers[d]);return Z}dispose(N,Z,d){if(Z){let N;for(N in this._textures)this._textures[N].dispose();for(N in this._textureArrays){const Z=this._textureArrays[N];for(let N=0;N<Z.length;N++)Z[N].dispose()}}this._textures={},super.dispose(N,Z,d)}serialize(){const N=j.c.Serialize(this);let Z;for(Z in N.customType="BABYLON.ShaderMaterial",N.uniqueId=this.uniqueId,N.options=this._options,N.shaderPath=this._shaderPath,N.storeEffectOnSubMeshes=this._storeEffectOnSubMeshes,N.stencil=this.stencil.serialize(),N.textures={},this._textures)N.textures[Z]=this._textures[Z].serialize();for(Z in N.textureArrays={},this._textureArrays){N.textureArrays[Z]=[];const d=this._textureArrays[Z];for(let X=0;X<d.length;X++)N.textureArrays[Z].push(d[X].serialize())}for(Z in N.ints={},this._ints)N.ints[Z]=this._ints[Z];for(Z in N.uints={},this._uints)N.uints[Z]=this._uints[Z];for(Z in N.floats={},this._floats)N.floats[Z]=this._floats[Z];for(Z in N.floatsArrays={},this._floatsArrays)N.floatsArrays[Z]=this._floatsArrays[Z];for(Z in N.colors3={},this._colors3)N.colors3[Z]=this._colors3[Z].ed();for(Z in N.colors3Arrays={},this._colors3Arrays)N.colors3Arrays[Z]=this._colors3Arrays[Z];for(Z in N.colors4={},this._colors4)N.colors4[Z]=this._colors4[Z].ed();for(Z in N.colors4Arrays={},this._colors4Arrays)N.colors4Arrays[Z]=this._colors4Arrays[Z];for(Z in N.vectors2={},this._vectors2)N.vectors2[Z]=this._vectors2[Z].ed();for(Z in N.vectors3={},this._vectors3)N.vectors3[Z]=this._vectors3[Z].ed();for(Z in N.vectors4={},this._vectors4)N.vectors4[Z]=this._vectors4[Z].ed();for(Z in N.quaternions={},this._quaternions)N.quaternions[Z]=this._quaternions[Z].ed();for(Z in N.matrices={},this._matrices)N.matrices[Z]=this._matrices[Z].ed();for(Z in N.matrixArray={},this._matrixArrays)N.matrixArray[Z]=this._matrixArrays[Z];for(Z in N.matrices3x3={},this._matrices3x3)N.matrices3x3[Z]=this._matrices3x3[Z];for(Z in N.matrices2x2={},this._matrices2x2)N.matrices2x2[Z]=this._matrices2x2[Z];for(Z in N.vectors2Arrays={},this._vectors2Arrays)N.vectors2Arrays[Z]=this._vectors2Arrays[Z];for(Z in N.vectors3Arrays={},this._vectors3Arrays)N.vectors3Arrays[Z]=this._vectors3Arrays[Z];for(Z in N.vectors4Arrays={},this._vectors4Arrays)N.vectors4Arrays[Z]=this._vectors4Arrays[Z];for(Z in N.quaternionsArrays={},this._quaternionsArrays)N.quaternionsArrays[Z]=this._quaternionsArrays[Z];return N}static Parse(N,Z,d){const I=j.c.Parse((()=>new A(N.name,Z,N.shaderPath,N.options,N.storeEffectOnSubMeshes)),N,Z,d);let m;for(m in N.stencil&&I.stencil.parse(N.stencil,Z,d),N.textures)I.setTexture(m,D.c.Parse(N.textures[m],Z,d));for(m in N.textureArrays){const X=N.textureArrays[m],z=[];for(let N=0;N<X.length;N++)z.push(D.c.Parse(X[N],Z,d));I.setTextureArray(m,z)}for(m in N.ints)I.setInt(m,N.ints[m]);for(m in N.uints)I.setUInt(m,N.uints[m]);for(m in N.floats)I.setFloat(m,N.floats[m]);for(m in N.floatsArrays)I.setFloats(m,N.floatsArrays[m]);for(m in N.colors3)I.setColor3(m,z.b._c(N.colors3[m]));for(m in N.colors3Arrays){const Z=N.colors3Arrays[m].reduce(((N,Z,d)=>(d%3===0?N.push([Z]):N[N.length-1].push(Z),N)),[]).map((N=>z.b._c(N)));I.setColor3Array(m,Z)}for(m in N.colors4)I.setColor4(m,z.e._c(N.colors4[m]));for(m in N.colors4Arrays){const Z=N.colors4Arrays[m].reduce(((N,Z,d)=>(d%4===0?N.push([Z]):N[N.length-1].push(Z),N)),[]).map((N=>z.e._c(N)));I.setColor4Array(m,Z)}for(m in N.vectors2)I.setVector2(m,X.l._c(N.vectors2[m]));for(m in N.vectors3)I.setVector3(m,X.n._c(N.vectors3[m]));for(m in N.vectors4)I.setVector4(m,X.q._c(N.vectors4[m]));for(m in N.quaternions)I.setQuaternion(m,X.g._c(N.quaternions[m]));for(m in N.matrices)I.setMatrix(m,X.c._c(N.matrices[m]));for(m in N.matrixArray)I._matrixArrays[m]=new Float32Array(N.matrixArray[m]);for(m in N.matrices3x3)I.setMatrix3x3(m,N.matrices3x3[m]);for(m in N.matrices2x2)I.setMatrix2x2(m,N.matrices2x2[m]);for(m in N.vectors2Arrays)I.setArray2(m,N.vectors2Arrays[m]);for(m in N.vectors3Arrays)I.setArray3(m,N.vectors3Arrays[m]);for(m in N.vectors4Arrays)I.setArray4(m,N.vectors4Arrays[m]);for(m in N.quaternionsArrays)I.setArray4(m,N.quaternionsArrays[m]);return I}static ParseFromFileAsync(N,Z,d){let X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return new Promise(((I,m)=>{const z=new k.c;z.addEventListener("readystatechange",(()=>{if(4==z.readyState)if(200==z.status){const Z=JSON.parse(z.responseText),m=this.Parse(Z,d||U.e.LastCreatedScene,X);N&&(m.name=N),I(m)}else m("Unable to load the ShaderMaterial")})),z.open("GET",Z),z.send()}))}static ParseFromSnippetAsync(N,Z){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Promise(((X,I)=>{const m=new k.c;m.addEventListener("readystatechange",(()=>{if(4==m.readyState)if(200==m.status){const I=JSON.parse(JSON.parse(m.responseText).jsonPayload),z=JSON.parse(I.shaderMaterial),w=this.Parse(z,Z||U.e.LastCreatedScene,d);w.snippetId=N,X(w)}else I("Unable to load the snippet "+N)})),m.open("GET",this.SnippetUrl+"/"+N.replace(/#/g,"/")),m.send()}))}}A.SnippetUrl="https://snippet.babylonjs.com",A.CreateFromSnippetAsync=A.ParseFromSnippetAsync,(0,v.h)("BABYLON.ShaderMaterial",A),I.b._LinesMeshParser=(N,Z)=>n.Parse(N,Z);class n extends I.b{_isShaderMaterial(N){return"ShaderMaterial"===N.getClassName()}constructor(N){let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,X=arguments.length>5?arguments[5]:void 0,I=arguments.length>6?arguments[6]:void 0,m=arguments.length>7?arguments[7]:void 0;super(N,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Z,arguments.length>4?arguments[4]:void 0),this.useVertexColor=X,this.useVertexAlpha=I,this.color=new z.b(1,1,1),this.alpha=1,this._shaderLanguage=0,Z&&(this.color=Z.color.clone(),this.alpha=Z.alpha,this.useVertexColor=Z.useVertexColor,this.useVertexAlpha=Z.useVertexAlpha),this.intersectionThreshold=.1;const S={attributes:[w.d.PositionKind],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:[],useClipPlane:null,shaderLanguage:0};if(!1===I?S.needAlphaBlending=!1:S.defines.push("#define VERTEXALPHA"),X?(S.defines.push("#define VERTEXCOLOR"),S.attributes.push(w.d.ColorKind)):(S.uniforms.push("color"),this._color4=new z.e),m)this.material=m;else{this.va().getEngine().isWebGPU&&!n.ForceGLSL&&(this._shaderLanguage=1),S.shaderLanguage=this._shaderLanguage,S.extraInitializationsAsync=async()=>{1===this._shaderLanguage?await Promise.all([d.e(19).then(d.bind(d,12381)),d.e(48).then(d.bind(d,12383))]):await Promise.all([d.e(26).then(d.bind(d,12392)),d.e(49).then(d.bind(d,12394))])},this.material=new A("colorShader",this.va(),"color",S,!1),this.material.doNotSerialize=!0}}isReady(){return!!this._lineMaterial.isReady(this,!!this._userInstancedBuffersStorage||this.hasThinInstances)&&super.isReady()}getClassName(){return"LinesMesh"}get material(){return this._lineMaterial}set material(N){this._lineMaterial=N,this._lineMaterial.fillMode=e.e.LineListDrawMode}get checkCollisions(){return!1}set checkCollisions(N){}_bind(N,Z){if(!this._geometry)return this;const d=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(!this._userInstancedBuffersStorage||this.hasThinInstances?this._geometry._bind(Z,d):this._geometry._bind(Z,d,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects),!this.useVertexColor&&this._isShaderMaterial(this._lineMaterial)){const{r:N,g:Z,b:d}=this.color;this._color4.set(N,Z,d,this.alpha),this._lineMaterial.setColor4("color",this._color4)}return this}_draw(N,Z,d){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const X=this.va().getEngine();return this._unIndexed?X.drawArraysType(e.e.LineListDrawMode,N.verticesStart,N.verticesCount,d):X.drawElementsType(e.e.LineListDrawMode,N.indexStart,N.indexCount,d),this}dispose(N){(arguments.length>2?arguments[2]:void 0)||this._lineMaterial.dispose(!1,!1,!0),super.dispose(N)}clone(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,d=arguments.length>2?arguments[2]:void 0;return new n(N,this.va(),Z,this,d)}eb(N){const Z=new g(N,this);if(this.instancedBuffers){Z.instancedBuffers={};for(const N in this.instancedBuffers)Z.instancedBuffers[N]=this.instancedBuffers[N]}return Z}serialize(N){super.serialize(N),N.color=this.color.ed(),N.alpha=this.alpha}static Parse(N,Z){const d=new n(N.name,Z);return d.color=z.b._c(N.color),d.alpha=N.alpha,d}}n.ForceGLSL=!1;class g extends S.e{constructor(N,Z){super(N,Z),this.intersectionThreshold=Z.intersectionThreshold}getClassName(){return"InstancedLinesMesh"}}var E=d(1051);function V(N){const Z=[],d=[],X=N.lines,I=N.za,z=[];let w=0;for(let m=0;m<X.length;m++){const N=X[m];for(let X=0;X<N.length;X++){const{x:S,y:e,z:j}=N[X];if(d.push(S,e,j),I){const N=I[m],{r:Z,g:d,b:w,a:S}=N[X];z.push(Z,d,w,S)}X>0&&(Z.push(w-1),Z.push(w)),w++}}const S=new m.c;return S.indices=Z,S.xa=d,I&&(S.za=z),S}function O(N){const Z=N.dashSize||3,d=N.gapSize||1,I=N.dashNb||200,z=N.points,w=[],S=[],e=X.n.Zero();let j=0,B=0,D=0,v=0,T=0,k=0,h=0;for(h=0;h<z.length-1;h++)z[h+1].subtractToRef(z[h],e),j+=e.length();for(D=j/I,v=Z*D/(Z+d),h=0;h<z.length-1;h++){z[h+1].subtractToRef(z[h],e),B=Math.floor(e.length()/D),e.normalize();for(let N=0;N<B;N++)T=D*N,w.push(z[h].x+T*e.x,z[h].y+T*e.y,z[h].z+T*e.z),w.push(z[h].x+(T+v)*e.x,z[h].y+(T+v)*e.y,z[h].z+(T+v)*e.z),S.push(k,k+1),k+=2}const U=new m.c;return U.xa=w,U.indices=S,U}function K(N,Z){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const X=Z.instance,I=Z.lines,m=Z.za;if(X){const N=X.getVerticesData(w.d.PositionKind);let Z,d;m&&(Z=X.getVerticesData(w.d.ColorKind));let z=0,S=0;for(let X=0;X<I.length;X++){const w=I[X];for(let I=0;I<w.length;I++)N[z]=w[I].x,N[z+1]=w[I].y,N[z+2]=w[I].z,m&&Z&&(d=m[X],Z[S]=d[I].r,Z[S+1]=d[I].g,Z[S+2]=d[I].b,Z[S+3]=d[I].a,S+=4),z+=3}return X.updateVerticesData(w.d.PositionKind,N,!1,!1),m&&Z&&X.updateVerticesData(w.d.ColorKind,Z,!1,!1),X.refreshBoundingInfo(),X}const z=new n(N,d,null,void 0,void 0,!!m,Z.useVertexAlpha,Z.material);return V(Z).Ca(z,Z.updatable),z}function r(N,Z){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const X=Z.za?[Z.za]:null;return K(N,{lines:[Z.points],updatable:Z.updatable,instance:Z.instance,za:X,useVertexAlpha:Z.useVertexAlpha,material:Z.material},d)}function P(N,Z){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const m=Z.points,z=Z.instance,w=Z.gapSize||1,S=Z.dashSize||3;if(z){const N=N=>{const Z=X.n.Zero(),d=N.length/6;let I=0,w=0,S=0,e=0,j=0,B=0,D=0,v=0;for(D=0;D<m.length-1;D++)m[D+1].subtractToRef(m[D],Z),I+=Z.length();S=I/d;const T=z._creationDataStorage.dashSize;for(e=T*S/(T+z._creationDataStorage.gapSize),D=0;D<m.length-1;D++)for(m[D+1].subtractToRef(m[D],Z),w=Math.floor(Z.length()/S),Z.normalize(),v=0;v<w&&B<N.length;)j=S*v,N[B]=m[D].x+j*Z.x,N[B+1]=m[D].y+j*Z.y,N[B+2]=m[D].z+j*Z.z,N[B+3]=m[D].x+(j+e)*Z.x,N[B+4]=m[D].y+(j+e)*Z.y,N[B+5]=m[D].z+(j+e)*Z.z,B+=6,v++;for(;B<N.length;)N[B]=m[D].x,N[B+1]=m[D].y,N[B+2]=m[D].z,B+=3};return(Z.dashNb||Z.dashSize||Z.gapSize||Z.useVertexAlpha||Z.material)&&E.e.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),z.updateMeshPositions(N,!1),z}const e=new n(N,d,null,void 0,void 0,void 0,Z.useVertexAlpha,Z.material);return O(Z).Ca(e,Z.updatable),e._creationDataStorage=new I.e,e._creationDataStorage.dashSize=S,e._creationDataStorage.gapSize=w,e}m.c.CreateLineSystem=V,m.c.CreateDashedLines=O,I.b.nb=function(N,Z){return r(N,{points:Z,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},I.b.CreateDashedLines=function(N,Z,d,X,I){return P(N,{points:Z,dashSize:d,gapSize:X,dashNb:I,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},11433:(N,Z,d)=>{"use strict";d.d(Z,{c:()=>w,e:()=>S});var X=d(11321),I=d(11345),m=d(1119);function z(N){const Z=[],d=[],X=[],z=[],w=N.width||N.size||1,S=N.height||N.size||1,e=0===N.sideOrientation?0:N.sideOrientation||I.c.DEFAULTSIDE,j=w/2,B=S/2;d.push(-j,-B,0),X.push(0,0,-1),z.push(0,m.b?1:0),d.push(j,-B,0),X.push(0,0,-1),z.push(1,m.b?1:0),d.push(j,B,0),X.push(0,0,-1),z.push(1,m.b?0:1),d.push(-j,B,0),X.push(0,0,-1),z.push(0,m.b?0:1),Z.push(0),Z.push(1),Z.push(2),Z.push(0),Z.push(2),Z.push(3),I.c._ComputeSides(e,d,Z,X,z,N.frontUVs,N.backUVs);const D=new I.c;return D.indices=Z,D.xa=d,D.ya=X,D.Aa=z,D}function w(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const I=new X.b(N,d);Z.sideOrientation=X.b._GetDefaultSideOrientation(Z.sideOrientation),I._originalBuilderSideOrientation=Z.sideOrientation;return z(Z).Ca(I,Z.updatable),Z.sourcePlane&&(I.translate(Z.sourcePlane.ld,-Z.sourcePlane.d),I.setDirection(Z.sourcePlane.ld.scale(-1))),I}const S={yg:w};I.c.yg=z,X.b.yg=(N,Z,d,X,I)=>w(N,{size:Z,width:Z,height:Z,sideOrientation:I,updatable:X},d)},11476:(N,Z,d)=>{"use strict";d.d(Z,{d:()=>S});var X=d(960),I=d(11321),m=d(11345),z=d(1119);function w(N){const Z=0|(N.segments||32),d=N.diameterX||N.diameter||1,I=N.diameterY||N.diameter||1,w=N.diameterZ||N.diameter||1,S=N.arc&&(N.arc<=0||N.arc>1)?1:N.arc||1,e=N.slice&&N.slice<=0?1:N.slice||1,j=0===N.sideOrientation?0:N.sideOrientation||m.c.DEFAULTSIDE,B=!!N.dedupTopBottomIndices,D=new X.n(d/2,I/2,w/2),v=2+Z,T=2*v,k=[],h=[],U=[],C=[];for(let m=0;m<=v;m++){const N=m/v,Z=N*Math.PI*e;for(let d=0;d<=T;d++){const I=d/T,m=I*Math.PI*2*S,w=X.c.RotationZ(-Z),e=X.c.RotationY(m),j=X.n.TransformCoordinates(X.n.Up(),w),B=X.n.TransformCoordinates(j,e),v=B.multiply(D),k=B.divide(D).normalize();h.push(v.x,v.y,v.z),U.push(k.x,k.y,k.z),C.push(I,z.b?1-N:N)}if(m>0){const N=h.length/3;for(let Z=N-2*(T+1);Z+T+2<N;Z++)B?(m>1&&(k.push(Z),k.push(Z+1),k.push(Z+T+1)),(m<v||e<1)&&(k.push(Z+T+1),k.push(Z+1),k.push(Z+T+2))):(k.push(Z),k.push(Z+1),k.push(Z+T+1),k.push(Z+T+1),k.push(Z+1),k.push(Z+T+2))}}m.c._ComputeSides(j,h,k,U,C,N.frontUVs,N.backUVs);const M=new m.c;return M.indices=k,M.xa=h,M.ya=U,M.Aa=C,M}function S(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const X=new I.b(N,d);Z.sideOrientation=I.b._GetDefaultSideOrientation(Z.sideOrientation),X._originalBuilderSideOrientation=Z.sideOrientation;return w(Z).Ca(X,Z.updatable),X}m.c.CreateSphere=w,I.b.CreateSphere=(N,Z,d,X,I,m)=>S(N,{segments:Z,diameterX:d,diameterY:d,diameterZ:d,sideOrientation:m,updatable:I},X)},11776:(N,Z,d)=>{"use strict";d.d(Z,{e:()=>B});var X=d(1133),I=d(10279),m=d(11353),z=d(1169),w=d(11345),S=d(1051);function e(N,Z,d,X,I){let m=null,z=null,w=null;try{let S;m=new N.Decoder,z=new N.DecoderBuffer,z.Init(Z,Z.byteLength);const e=m.GetEncodedGeometryType(z);switch(e){case N.TRIANGULAR_MESH:{const Z=new N.Mesh;if(S=m.DecodeBufferToMesh(z,Z),!S.ok()||0===Z.ptr)throw new Error(S.error_msg());const d=3*Z.num_faces(),I=4*d,e=N._malloc(I);try{m.GetTrianglesUInt32Array(Z,I,e);const z=new Uint32Array(d);z.set(new Uint32Array(N.HEAPF32.buffer,e,d)),X(z)}finally{N._free(e)}w=Z;break}case N.POINT_CLOUD:{const Z=new N.PointCloud;if(S=m.DecodeBufferToPointCloud(z,Z),!S.ok()||!Z.ptr)throw new Error(S.error_msg());w=Z;break}default:throw new Error(`Invalid geometry type ${e}`)}const j=w.num_points(),B=(Z,d,X,m)=>{const z=m.data_type(),w=m.num_components(),S=m.normalized(),e=m.byte_stride(),B=m.byte_offset(),D={[N.DT_FLOAT32]:{typedArrayConstructor:Float32Array,heap:N.HEAPF32},[N.DT_INT8]:{typedArrayConstructor:Int8Array,heap:N.HEAP8},[N.DT_INT16]:{typedArrayConstructor:Int16Array,heap:N.HEAP16},[N.DT_INT32]:{typedArrayConstructor:Int32Array,heap:N.HEAP32},[N.DT_UINT8]:{typedArrayConstructor:Uint8Array,heap:N.HEAPU8},[N.DT_UINT16]:{typedArrayConstructor:Uint16Array,heap:N.HEAPU16},[N.DT_UINT32]:{typedArrayConstructor:Uint32Array,heap:N.HEAPU32}}[z];if(!D)throw new Error(`Invalid data type ${z}`);const v=j*w,T=v*D.typedArrayConstructor.BYTES_PER_ELEMENT,k=N._malloc(T);try{Z.GetAttributeDataArrayForAllPoints(d,m,z,T,k);const N=new D.typedArrayConstructor(D.heap.buffer,k,v);I(X,N.slice(),w,B,e,S)}finally{N._free(k)}};if(d)for(const N in d){const Z=d[N],X=m.GetAttributeByUniqueId(w,Z);B(m,w,N,X)}else{const Z={position:N.POSITION,ld:N.NORMAL,color:N.COLOR,uv:N.TEX_COORD};for(const N in Z){const d=m.GetAttributeId(w,Z[N]);if(-1!==d){const Z=m.GetAttribute(w,d);B(m,w,N,Z)}}}return j}finally{w&&N.destroy(w),z&&N.destroy(z),m&&N.destroy(m)}}function j(){let N;onmessage=Z=>{const d=Z.data;switch(d.id){case"init":{const Z=d.decoder;Z.url&&importScripts(Z.url);const X=Z.wasmBinary?{wasmBinary:Z.wasmBinary}:{};N=DracoDecoderModule(X),postMessage({id:"initDone"});break}case"decodeMesh":if(!N)throw new Error("Draco decoder module is not available");N.then((N=>{const Z=e(N,d.dataView,d.attributes,(N=>{postMessage({id:"indices",data:N},[N.buffer])}),((N,Z,d,X,I,m)=>{postMessage({id:"attribute",kind:N,data:Z,size:d,byteOffset:X,byteStride:I,normalized:m},[Z.buffer])}));postMessage({id:"decodeMeshDone",totalVertices:Z})}))}}}class B{static get DecoderAvailable(){const N=B.Configuration.decoder;return!!(N.wasmUrl&&N.wasmBinaryUrl&&"object"===typeof WebAssembly||N.fallbackUrl)}static GetDefaultNumWorkers(){return"object"===typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1}static get Default(){return B._Default||(B._Default=new B),B._Default}static ResetDefault(N){B._Default&&(N||B._Default.dispose(),B._Default=null)}constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:B.DefaultNumWorkers;const Z=B.Configuration.decoder;if(Z.workerPool||"object"===typeof N&&N.workerPool)this._workerPoolPromise=Promise.resolve(Z.workerPool||N.workerPool);else{const d=Z.wasmBinary||"object"===typeof N&&N.wasmBinary,m="number"===typeof N?N:N.numWorkers,z=m&&"function"===typeof Worker&&"function"===typeof URL,w=z||!z&&!Z.jsModule,S=Z.wasmUrl&&Z.wasmBinaryUrl&&"object"===typeof WebAssembly?{url:w?X.g.GetBabylonScriptURL(Z.wasmUrl,!0):"",wasmBinaryPromise:d?Promise.resolve(d):X.g.LoadFileAsync(X.g.GetBabylonScriptURL(Z.wasmBinaryUrl,!0))}:{url:w?X.g.GetBabylonScriptURL(Z.fallbackUrl):"",wasmBinaryPromise:Promise.resolve(void 0)};z?this._workerPoolPromise=S.wasmBinaryPromise.then((N=>{const Z=`${e}(${j})()`,d=URL.createObjectURL(new Blob([Z],{type:"application/javascript"}));return new I.c(m,(()=>function(N,Z,d){return new Promise(((X,I)=>{const m=Z=>{N.removeEventListener("error",m),N.removeEventListener("message",z),I(Z)},z=Z=>{"initDone"===Z.data.id&&(N.removeEventListener("error",m),N.removeEventListener("message",z),X(N))};if(N.addEventListener("error",m),N.addEventListener("message",z),Z){const X=Z.slice(0);N.postMessage({id:"init",decoder:{url:d,wasmBinary:X}},[X])}else N.postMessage({id:"init",decoder:{url:d}})}))}(new Worker(d),N,S.url)))})):this._decoderModulePromise=S.wasmBinaryPromise.then((async N=>{if("undefined"===typeof DracoDecoderModule&&!Z.jsModule){if(!S.url)throw new Error("Draco decoder module is not available");await X.g.LoadBabylonScriptAsync(S.url)}return await(d=N,I=Z.jsModule,new Promise((N=>{(I||DracoDecoderModule)({wasmBinary:d}).then((Z=>{N({module:Z})}))})));var d,I}))}}dispose(){this._workerPoolPromise&&this._workerPoolPromise.then((N=>{N.dispose()})),delete this._workerPoolPromise,delete this._decoderModulePromise}async whenReadyAsync(){this._workerPoolPromise?await this._workerPoolPromise:this._decoderModulePromise&&await this._decoderModulePromise}decodeMeshToMeshDataAsync(N,Z,d){const X=N instanceof ArrayBuffer?new Int8Array(N):new Int8Array(N.buffer,N.byteOffset,N.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((N=>new Promise(((I,m)=>{N.push(((N,z)=>{let w=null;const e=[],j=Z=>{N.removeEventListener("error",j),N.removeEventListener("message",B),m(Z),z()},B=Z=>{const X=Z.data;switch(X.id){case"decodeMeshDone":N.removeEventListener("error",j),N.removeEventListener("message",B),I({indices:w,attributes:e,totalVertices:X.totalVertices}),z();break;case"indices":w=X.data;break;case"attribute":e.push({kind:X.kind,data:X.data,size:X.size,byteOffset:X.byteOffset,byteStride:X.byteStride,normalized:(m=X.kind,D=X.normalized,d&&void 0!==d[m]?(D!==d[m]&&S.e.Warn(`Normalized flag from Draco data (${D}) does not match normalized flag from glTF accessor (${d[m]}). Using flag from glTF accessor.`),d[m]):D)})}var m,D};N.addEventListener("error",j),N.addEventListener("message",B);const D=X.slice();N.postMessage({id:"decodeMesh",dataView:D,attributes:Z},[D.buffer])}))}))));if(this._decoderModulePromise)return this._decoderModulePromise.then((N=>{let d=null;const I=[],m=e(N.module,X,Z,(N=>{d=N}),((N,Z,d,X,m,z)=>{I.push({kind:N,data:Z,size:d,byteOffset:X,byteStride:m,normalized:z})}));return{indices:d,attributes:I,totalVertices:m}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(N,Z,d,X){const I=await this.decodeMeshToMeshDataAsync(d,X),w=new m.b(N,Z);I.indices&&w.setIndices(I.indices);for(const m of I.attributes)w.setVerticesBuffer(new z.d(Z.getEngine(),m.data,m.kind,!1,void 0,m.byteStride,void 0,m.byteOffset,m.size,void 0,m.normalized,!0),I.totalVertices);return w}async _decodeMeshToGeometryForGltfAsync(N,Z,d,X,I){const w=await this.decodeMeshToMeshDataAsync(d,X,I),S=new m.b(N,Z);w.indices&&S.setIndices(w.indices);for(const m of w.attributes)S.setVerticesBuffer(new z.d(Z.getEngine(),m.data,m.kind,!1,void 0,m.byteStride,void 0,m.byteOffset,m.size,void 0,m.normalized,!0),w.totalVertices);return S}async decodeMeshAsync(N,Z){const d=await this.decodeMeshToMeshDataAsync(N,Z),X=new w.c;d.indices&&(X.indices=d.indices);for(const I of d.attributes){const N=z.d.GetFloatData(I.data,I.size,z.d.GetDataType(I.data),I.byteOffset,I.byteStride,I.normalized,d.totalVertices);X.set(N,I.kind)}return X}}B.Configuration={decoder:{wasmUrl:`${X.g._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${X.g._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${X.g._DefaultCdnUrl}/draco_decoder_gltf.js`}},B.DefaultNumWorkers=B.GetDefaultNumWorkers(),B._Default=null},11366:(N,Z,d)=>{"use strict";d.d(Z,{b:()=>g});var X=d(942),I=d(958),m=d(960),z=d(1169),w=d(11345),S=d(11370),e=d(1163),j=d(1264),B=d(1157);class D{constructor(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new m.n(0,0,0),this._diffPositionForCollisions=new m.n(0,0,0),this._collisionResponse=!0}}var v=d(1041),T=d(1280),k=d(1108),h=d(966),U=d(1388),C=d(978),M=d(949),Q=d(1060);class A{constructor(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=m.n.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1}}class n{constructor(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new A,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=null,this._currentLODIsUpToDate=!1,this._collisionRetryCount=3,this._morphTargetManager=null,this._renderingGroupId=0,this._bakedVertexAnimationManager=null,this._material=null,this._positions=null,this._pointerOverDisableMeshTesting=!1,this._meshCollisionData=new D,this._enableDistantPicking=!1,this._rawBoundingInfo=null,this._sideOrientationHint=!1,this._inheritVisibility=!1}}class g extends S.c{static get BILLBOARDMODE_NONE(){return S.c.BILLBOARDMODE_NONE}static get BILLBOARDMODE_X(){return S.c.BILLBOARDMODE_X}static get BILLBOARDMODE_Y(){return S.c.BILLBOARDMODE_Y}static get BILLBOARDMODE_Z(){return S.c.BILLBOARDMODE_Z}static get BILLBOARDMODE_ALL(){return S.c.BILLBOARDMODE_ALL}static get BILLBOARDMODE_USE_POSITION(){return S.c.BILLBOARDMODE_USE_POSITION}get facetNb(){return this._internalAbstractMeshDataInfo._facetData.facetNb}get partitioningSubdivisions(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions}set partitioningSubdivisions(N){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=N}get partitioningBBoxRatio(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio}set partitioningBBoxRatio(N){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=N}get mustDepthSortFacets(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort}set mustDepthSortFacets(N){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=N}get facetDepthSortFrom(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom}set facetDepthSortFrom(N){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=N}get collisionRetryCount(){return this._internalAbstractMeshDataInfo._collisionRetryCount}set collisionRetryCount(N){this._internalAbstractMeshDataInfo._collisionRetryCount=N}get isFacetDataEnabled(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled}get morphTargetManager(){return this._internalAbstractMeshDataInfo._morphTargetManager}set morphTargetManager(N){this._internalAbstractMeshDataInfo._morphTargetManager!==N&&(this._internalAbstractMeshDataInfo._morphTargetManager=N,this._syncGeometryWithMorphTargetManager())}get bakedVertexAnimationManager(){return this._internalAbstractMeshDataInfo._bakedVertexAnimationManager}set bakedVertexAnimationManager(N){this._internalAbstractMeshDataInfo._bakedVertexAnimationManager!==N&&(this._internalAbstractMeshDataInfo._bakedVertexAnimationManager=N,this._markSubMeshesAsAttributesDirty())}_syncGeometryWithMorphTargetManager(){}_updateNonUniformScalingState(N){return!!super._updateNonUniformScalingState(N)&&(this._markSubMeshesAsMiscDirty(),!0)}get rawBoundingInfo(){return this._internalAbstractMeshDataInfo._rawBoundingInfo}set rawBoundingInfo(N){this._internalAbstractMeshDataInfo._rawBoundingInfo=N}set Kk(N){this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver=this.onCollideObservable.add(N)}set onCollisionPositionChange(N){this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(N)}get visibility(){return this._internalAbstractMeshDataInfo._visibility}set visibility(N){if(this._internalAbstractMeshDataInfo._visibility===N)return;const Z=this._internalAbstractMeshDataInfo._visibility;this._internalAbstractMeshDataInfo._visibility=N,(1===Z&&1!==N||1!==Z&&1===N)&&this._markSubMeshesAsDirty((N=>{N.markAsMiscDirty(),N.markAsPrePassDirty()}))}get inheritVisibility(){return this._internalAbstractMeshDataInfo._inheritVisibility}set inheritVisibility(N){this._internalAbstractMeshDataInfo._inheritVisibility=N}get isVisible(){if(!this._isVisible||!this.inheritVisibility||!this._parentNode)return this._isVisible;if(this._isVisible){let N=this._parentNode;for(;N;){const Z=N.isVisible;if("undefined"!==typeof Z)return Z;N=N.parent}}return this._isVisible}set isVisible(N){this._isVisible=N}get pointerOverDisableMeshTesting(){return this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting}set pointerOverDisableMeshTesting(N){this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting=N}get renderingGroupId(){return this._internalAbstractMeshDataInfo._renderingGroupId}set renderingGroupId(N){this._internalAbstractMeshDataInfo._renderingGroupId=N}get material(){return this._internalAbstractMeshDataInfo._material}set material(N){this._setMaterial(N)}_setMaterial(N){this._internalAbstractMeshDataInfo._material!==N&&(this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._material=N,N&&N.meshMap&&(N.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.Sd&&(this.resetDrawCache(),this._unBindEffect()))}getMaterialForRenderPass(N){var Z;return null===(Z=this._internalAbstractMeshDataInfo._materialForRenderPass)||void 0===Z?void 0:Z[N]}setMaterialForRenderPass(N,Z){this.resetDrawCache(N),this._internalAbstractMeshDataInfo._materialForRenderPass||(this._internalAbstractMeshDataInfo._materialForRenderPass=[]),this._internalAbstractMeshDataInfo._materialForRenderPass[N]=Z}get receiveShadows(){return this._internalAbstractMeshDataInfo._receiveShadows}set receiveShadows(N){this._internalAbstractMeshDataInfo._receiveShadows!==N&&(this._internalAbstractMeshDataInfo._receiveShadows=N,this._markSubMeshesAsLightDirty())}get hasVertexAlpha(){return this._internalAbstractMeshDataInfo._hasVertexAlpha}set hasVertexAlpha(N){this._internalAbstractMeshDataInfo._hasVertexAlpha!==N&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=N,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())}get useVertexColors(){return this._internalAbstractMeshDataInfo._useVertexColors}set useVertexColors(N){this._internalAbstractMeshDataInfo._useVertexColors!==N&&(this._internalAbstractMeshDataInfo._useVertexColors=N,this._markSubMeshesAsAttributesDirty())}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(N){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==N&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=N,this._markSubMeshesAsAttributesDirty())}get numBoneInfluencers(){return this._internalAbstractMeshDataInfo._numBoneInfluencers}set numBoneInfluencers(N){this._internalAbstractMeshDataInfo._numBoneInfluencers!==N&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=N,this._markSubMeshesAsAttributesDirty())}get applyFog(){return this._internalAbstractMeshDataInfo._applyFog}set applyFog(N){this._internalAbstractMeshDataInfo._applyFog!==N&&(this._internalAbstractMeshDataInfo._applyFog=N,this._markSubMeshesAsMiscDirty())}get enableDistantPicking(){return this._internalAbstractMeshDataInfo._enableDistantPicking}set enableDistantPicking(N){this._internalAbstractMeshDataInfo._enableDistantPicking=N}get layerMask(){return this._internalAbstractMeshDataInfo._layerMask}set layerMask(N){N!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=N,this._resyncLightSources())}get collisionMask(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask}set collisionMask(N){this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask=isNaN(N)?-1:N}get collisionResponse(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse}set collisionResponse(N){this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse=N}get collisionGroup(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup}set collisionGroup(N){this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup=isNaN(N)?-1:N}get surroundingMeshes(){return this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes}set surroundingMeshes(N){this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes=N}get lightSources(){return this._lightSources}set skeleton(N){const Z=this._internalAbstractMeshDataInfo._skeleton;Z&&Z.needInitialSkinMatrix&&Z._unregisterMeshWithPoseMatrix(this),N&&N.needInitialSkinMatrix&&N._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=N,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()}get skeleton(){return this._internalAbstractMeshDataInfo._skeleton}constructor(N){var Z;let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;switch(super(N,d,!1),Z=this,this._internalAbstractMeshDataInfo=new n,this._waitingMaterialId=null,this._waitingMorphTargetManagerId=null,this.se=g.Ti,this.onCollideObservable=new I.d,this.onCollisionPositionChangeObservable=new I.d,this.onMaterialChangedObservable=new I.d,this.definedFacingForward=!0,this._occlusionQuery=null,this._renderingGroup=null,this.alphaIndex=Number.MAX_VALUE,this._isVisible=!0,this.Fd=!0,this.isNearPickable=!1,this.isNearGrabbable=!1,this.showSubMeshesBoundingBox=!1,this.isBlocker=!1,this.enablePointerMoveEvents=!1,this.outlineColor=k.b.Red(),this.outlineWidth=.02,this.overlayColor=k.b.Red(),this.overlayAlpha=.5,this.useOctreeForRenderingSelection=!0,this.useOctreeForPicking=!0,this.useOctreeForCollisions=!0,this.ce=!1,this.Da=!1,this.actionManager=null,this.ellipsoid=new m.n(.5,1,.5),this.ellipsoidOffset=new m.n(0,0,0),this.edgesWidth=1,this.edgesColor=new k.e(1,0,0,1),this._edgesRenderer=null,this._masterMesh=null,this._boundingInfo=null,this._boundingInfoIsDirty=!0,this._renderId=0,this._intersectionsInProgress=new Array,this._unIndexed=!1,this._lightSources=new Array,this._waitingData={lods:null,actions:null,fi:null},this._bonesTransformMatrices=null,this._transformMatrixTexture=null,this.onRebuildObservable=new I.d,this._onCollisionPositionChange=function(N,d){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;d.subtractToRef(Z._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,Z._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),Z._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions.length()>Q.c.CollisionsEpsilon&&Z.position.addInPlace(Z._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),X&&Z.onCollideObservable.notifyObservers(X),Z.onCollisionPositionChangeObservable.notifyObservers(Z.position)},d=this.va(),d.Wd(this),this._resyncLightSources(),this._uniformBuffer=new B.e(this.va().getEngine(),void 0,void 0,N,!this.va().getEngine().isWebGPU),this._buildUniformLayout(),d.performancePriority){case 2:this.Da=!0;case 1:this.ce=!0,this.Fd=!1}}_buildUniformLayout(){this._uniformBuffer.addUniform("world",16),this._uniformBuffer.addUniform("visibility",1),this._uniformBuffer.create()}transferToEffect(N){const Z=this._uniformBuffer;Z.Cd("world",N),Z.updateFloat("visibility",this._internalAbstractMeshDataInfo._visibility),Z.update()}getMeshUniformBuffer(){return this._uniformBuffer}getClassName(){return"AbstractMesh"}toString(N){let Z="Name: "+this.name+", isInstance: "+("InstancedMesh"!==this.getClassName()?"YES":"NO");Z+=", # of submeshes: "+(this.Sd?this.Sd.length:0);const d=this._internalAbstractMeshDataInfo._skeleton;return d&&(Z+=", skeleton: "+d.name),N&&(Z+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],Z+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.fi?"YES":"NO")),Z}_getEffectiveParent(){return this._masterMesh&&this.billboardMode!==S.c.BILLBOARDMODE_NONE?this._masterMesh:super._getEffectiveParent()}_getActionManagerForTrigger(N){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.actionManager&&(Z||this.actionManager.isRecursive)){if(!N)return this.actionManager;if(this.actionManager.hasSpecificTrigger(N))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(N,!1):null}_rebuild(){if(this.onRebuildObservable.notifyObservers(this),null!==this._occlusionQuery&&(this._occlusionQuery=null),this.Sd){for(const N of this.Sd)N._rebuild();this.resetDrawCache()}}_resyncLightSources(){this._lightSources.length=0;for(const N of this.va().lights)N.isEnabled()&&N.canAffectMesh(this)&&this._lightSources.push(N);this._markSubMeshesAsLightDirty()}_resyncLightSource(N){const Z=N.isEnabled()&&N.canAffectMesh(this),d=this._lightSources.indexOf(N);let X=!1;if(-1===d){if(!Z)return;this._lightSources.push(N)}else{if(Z)return;X=!0,this._lightSources.splice(d,1)}this._markSubMeshesAsLightDirty(X)}_unBindEffect(){for(const N of this.Sd)N.setEffect(null)}_removeLightSource(N,Z){const d=this._lightSources.indexOf(N);-1!==d&&(this._lightSources.splice(d,1),this._markSubMeshesAsLightDirty(Z))}_markSubMeshesAsDirty(N){if(this.Sd)for(const Z of this.Sd)for(let d=0;d<Z._drawWrappers.length;++d){const X=Z._drawWrappers[d];X&&X.defines&&X.defines.markAllAsDirty&&N(X.defines)}}_markSubMeshesAsLightDirty(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._markSubMeshesAsDirty((Z=>Z.markAsLightDirty(N)))}_markSubMeshesAsAttributesDirty(){this._markSubMeshesAsDirty((N=>N.markAsAttributesDirty()))}_markSubMeshesAsMiscDirty(){this._markSubMeshesAsDirty((N=>N.markAsMiscDirty()))}fe(N){return this._currentRenderId=Number.MAX_VALUE,super.fe(N),this._isDirty=!0,this}resetDrawCache(N){if(this.Sd)for(const Z of this.Sd)Z.resetDrawCache(N)}get isBlocked(){return!1}getLOD(N){return this}getTotalVertices(){return 0}getTotalIndices(){return 0}ge(){return null}getVerticesData(N){return null}Ga(N,Z,d,X){return this}updateVerticesData(N,Z,d,X){return this}setIndices(N,Z){return this}isVerticesDataPresent(N){return!1}getBoundingInfo(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfoIsDirty&&(this._boundingInfoIsDirty=!1,this.Ea()),this._boundingInfo)}getRawBoundingInfo(){return this.rawBoundingInfo??this.getBoundingInfo()}setBoundingInfo(N){return this._boundingInfo=N,this}get hasBoundingInfo(){return null!==this._boundingInfo}buildBoundingInfo(N,Z,d){return this._boundingInfo=new j.e(N,Z,d),this._boundingInfo}normalizeToUnitCube(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],d=arguments.length>2?arguments[2]:void 0;return super.normalizeToUnitCube(N,Z,d)}get useBones(){return this.skeleton&&this.va().skeletonsEnabled&&this.isVerticesDataPresent(z.d.MatricesIndicesKind)&&this.isVerticesDataPresent(z.d.MatricesWeightsKind)}_preActivate(){}_preActivateForIntermediateRendering(N){}_activate(N,Z){return this._renderId=N,!0}_postActivate(){}_freeze(){}_unFreeze(){}getWorldMatrix(){return this._masterMesh&&this.billboardMode===S.c.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():super.getWorldMatrix()}_getWorldMatrixDeterminant(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():super._getWorldMatrixDeterminant()}get isAnInstance(){return!1}get hasInstances(){return!1}get hasThinInstances(){return!1}movePOV(N,Z,d){return this.position.addInPlace(this.calcMovePOV(N,Z,d)),this}calcMovePOV(N,Z,d){const X=new m.c;(this.rotationQuaternion?this.rotationQuaternion:m.g.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(X);const I=m.n.Zero(),z=this.definedFacingForward?-1:1;return m.n.TransformCoordinatesFromFloatsToRef(N*z,Z,d*z,X,I),I}rotatePOV(N,Z,d){return this.rotation.addInPlace(this.calcRotatePOV(N,Z,d)),this}calcRotatePOV(N,Z,d){const X=this.definedFacingForward?1:-1;return new m.n(N*X,Z,d*X)}Fa(N,Z){if(N){const d=(0,T.f)(N,0,this.getTotalVertices(),Z);this._boundingInfo?this._boundingInfo.reConstruct(d.minimum,d.maximum):this._boundingInfo=new j.e(d.minimum,d.maximum)}if(this.Sd)for(let d=0;d<this.Sd.length;d++)this.Sd[d].refreshBoundingInfo(N);this.Ea()}_refreshBoundingInfoDirect(N){if(this._boundingInfo?this._boundingInfo.reConstruct(N.minimum,N.maximum):this._boundingInfo=new j.e(N.minimum,N.maximum),this.Sd)for(let Z=0;Z<this.Sd.length;Z++)this.Sd[Z].refreshBoundingInfo(null);this.Ea()}static _ApplySkeleton(N,Z,d,X,I,w,S){!function(N,Z,d,X,I,w,S){const e=m.h.kd[0],j=m.h.Matrix[0],B=m.h.Matrix[1],D=Z===z.d.NormalKind?m.n.TransformNormalFromFloatsToRef:m.n.TransformCoordinatesFromFloatsToRef;for(let z=0,v=0;z<N.length;z+=3,v+=4){let Z,T;for(j.reset(),Z=0;Z<4;Z++)T=I[v+Z],T>0&&(m.c.FromFloat32ArrayToRefScaled(d,Math.floor(16*X[v+Z]),T,B),j.addToSelf(B));if(w&&S)for(Z=0;Z<4;Z++)T=S[v+Z],T>0&&(m.c.FromFloat32ArrayToRefScaled(d,Math.floor(16*w[v+Z]),T,B),j.addToSelf(B));D(N[z],N[z+1],N[z+2],j,e),e.toArray(N,z)}}(N,Z,d,X,I,w,S)}_getData(N,Z){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:z.d.PositionKind;const X=N.cache,I=N=>{if(X){const Z=X._vertexData||(X._vertexData={});return Z[N]||this.copyVerticesData(N,Z),Z[N]}return this.getVerticesData(N)};if(Z||(Z=I(d)),!Z)return null;if(X?(X._outputData?X._outputData.set(Z):X._outputData=new Float32Array(Z),Z=X._outputData):(N.applyMorph&&this.morphTargetManager||N.applySkeleton&&this.skeleton)&&(Z=Z.slice()),N.applyMorph&&this.morphTargetManager&&function(N,Z,d){let X=null;switch(Z){case z.d.PositionKind:X=N=>N.getPositions();break;case z.d.NormalKind:X=N=>N.getNormals();break;case z.d.TangentKind:X=N=>N.getTangents();break;case z.d.UVKind:X=N=>N.getUVs();break;default:return}for(let I=0;I<N.length;I++){let Z=N[I];for(let m=0;m<d.numTargets;m++){const z=d.getTarget(m),w=z.influence;if(0!==w){const d=X(z);d&&(Z+=(d[I]-N[I])*w)}}N[I]=Z}}(Z,d,this.morphTargetManager),N.applySkeleton&&this.skeleton){const N=I(z.d.MatricesIndicesKind),X=I(z.d.MatricesWeightsKind);if(X&&N){const m=this.numBoneInfluencers>4,w=m?I(z.d.MatricesIndicesExtraKind):null,S=m?I(z.d.MatricesWeightsExtraKind):null,e=this.skeleton.getTransformMatrices(this);g._ApplySkeleton(Z,d,e,N,X,w,S)}}if(!1!==N.updatePositionsArray&&d===z.d.PositionKind){const N=this._internalAbstractMeshDataInfo._positions||[],d=N.length;if(N.length=Z.length/3,d<N.length)for(let Z=d;Z<N.length;Z++)N[Z]=new m.n;for(let X=0,I=0;X<N.length;X++,I+=3)N[X].fd(Z[I],Z[I+1],Z[I+2]);this._internalAbstractMeshDataInfo._positions=N}return Z}getNormalsData(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getData({applySkeleton:N,applyMorph:Z,updatePositionsArray:!1},null,z.d.NormalKind)}Hf(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this._getData({applySkeleton:N,applyMorph:Z,updatePositionsArray:!1},d,z.d.PositionKind)}Ea(){return this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=new j.e(m.n.Zero(),m.n.Zero(),this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}_updateSubMeshesBoundingInfo(N){if(!this.Sd)return this;const Z=this.Sd.length;for(let d=0;d<Z;d++){const X=this.Sd[d];(Z>1||!X.IsGlobal)&&X.updateBoundingInfo(N)}return this}_afterComputeWorldMatrix(){this.Da||(this._boundingInfoIsDirty=!0)}isInFrustum(N){return this.getBoundingInfo().isInFrustum(N,this.se)}isCompletelyInFrustum(N){return this.getBoundingInfo().isCompletelyInFrustum(N)}intersectsMesh(N){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],d=arguments.length>2?arguments[2]:void 0;const X=this.getBoundingInfo(),I=N.getBoundingInfo();if(X.intersects(I,Z))return!0;if(d)for(const m of this.getChildMeshes())if(m.intersectsMesh(N,Z,!0))return!0;return!1}intersectsPoint(N){return this.getBoundingInfo().intersectsPoint(N)}get checkCollisions(){return this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions}set checkCollisions(N){this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions=N}get collider(){return this._internalAbstractMeshDataInfo._meshCollisionData._collider}moveWithCollisions(N){this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions);const Z=this.va().collisionCoordinator;return this._internalAbstractMeshDataInfo._meshCollisionData._collider||(this._internalAbstractMeshDataInfo._meshCollisionData._collider=Z.createCollider()),this._internalAbstractMeshDataInfo._meshCollisionData._collider._radius=this.ellipsoid,Z.getNewPosition(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,N,this._internalAbstractMeshDataInfo._meshCollisionData._collider,this.collisionRetryCount,this,this._onCollisionPositionChange,this.uniqueId),this}_collideForSubMesh(N,Z,d){var X;if(this._generatePointsArray(),!this._positions)return this;if(!N._lastColliderWorldVertices||!N._lastColliderTransformMatrix.equals(Z)){N._lastColliderTransformMatrix=Z.clone(),N._lastColliderWorldVertices=[],N._trianglePlanes=[];const d=N.verticesStart,X=N.verticesStart+N.verticesCount;for(let I=d;I<X;I++)N._lastColliderWorldVertices.push(m.n.TransformCoordinates(this._positions[I],Z))}return d._collide(N._trianglePlanes,N._lastColliderWorldVertices,this.ge(),N.indexStart,N.indexStart+N.indexCount,N.verticesStart,!!N.Ha(),this,this._shouldConvertRHS(),7===(null===(X=N.Ha())||void 0===X?void 0:X.fillMode)),this}_processCollisionsForSubMeshes(N,Z){const d=this._scene.getCollidingSubMeshCandidates(this,N),X=d.length;for(let I=0;I<X;I++){const m=d.data[I];X>1&&!m._checkCollision(N)||this._collideForSubMesh(m,Z,N)}return this}_shouldConvertRHS(){return!1}_checkCollision(N){if(!this.getBoundingInfo()._checkCollision(N))return this;const Z=m.h.Matrix[0],d=m.h.Matrix[1];return m.c.ScalingToRef(1/N._radius.x,1/N._radius.y,1/N._radius.z,Z),this.worldMatrixFromCache.multiplyToRef(Z,d),this._processCollisionsForSubMeshes(N,d),this}_generatePointsArray(){return!1}intersects(N,Z,d){let X=arguments.length>3&&void 0!==arguments[3]&&arguments[3],I=arguments.length>4?arguments[4]:void 0,z=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const w=new e.c,S=this.getClassName(),j="InstancedLinesMesh"===S||"LinesMesh"===S||"GreasedLineMesh"===S?this.intersectionThreshold:0,B=this.getBoundingInfo();if(!this.Sd)return w;if(!z&&(!N.intersectsSphere(B.boundingSphere,j)||!N.intersectsBox(B.boundingBox,j)))return w;if(X)return w.hit=!z,w.pickedMesh=z?null:this,w.distance=z?0:m.n.Distance(N.origin,B.boundingSphere.center),w.subMeshId=0,w;if(!this._generatePointsArray())return w;let D=null;const v=this._scene.getIntersectingSubMeshCandidates(this,N),T=v.length;let k=!1;for(let m=0;m<T;m++){const N=v.data[m].Ha();if(N&&(7==N.fillMode||0==N.fillMode||1==N.fillMode||2==N.fillMode||4==N.fillMode)){k=!0;break}}if(!k)return w.hit=!0,w.pickedMesh=this,w.distance=m.n.Distance(N.origin,B.boundingSphere.center),w.subMeshId=-1,w;for(let m=0;m<T;m++){const X=v.data[m];if(T>1&&!z&&!X.canIntersects(N))continue;const I=X.intersects(N,this._positions,this.ge(),Z,d);if(I&&(Z||!D||I.distance<D.distance)&&(D=I,D.subMeshId=m,Z))break}if(D){const Z=I??this.getWorldMatrix(),d=m.h.kd[0],X=m.h.kd[1];m.n.TransformCoordinatesToRef(N.origin,Z,d),N.direction.scaleToRef(D.distance,X);const z=m.n.TransformNormal(X,Z).addInPlace(d);return w.hit=!0,w.distance=m.n.Distance(d,z),w.pickedPoint=z,w.pickedMesh=this,w.bu=D.bu||0,w.bv=D.bv||0,w.subMeshFaceId=D.faceId,w.faceId=D.faceId+v.data[D.subMeshId].indexStart/(-1!==this.getClassName().indexOf("LinesMesh")?2:3),w.subMeshId=D.subMeshId,w}return w}clone(N,Z,d){return null}releaseSubMeshes(){if(this.Sd)for(;this.Sd.length;)this.Sd[0].dispose();else this.Sd=[];return this}dispose(N){let Z,d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const X=this.va();for(this._scene.useMaterialMeshMap&&this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),X.freeActiveMeshes(),X.freeRenderingGroups(),X.renderingManager.maintainStateBetweenFrames&&X.renderingManager.restoreDispachedFlags(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.disposeWhenUnowned&&!this._scene.meshes.some((N=>N!==this&&N.actionManager===this.actionManager))&&this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),Z=0;Z<this._intersectionsInProgress.length;Z++){const N=this._intersectionsInProgress[Z],d=N._intersectionsInProgress.indexOf(this);N._intersectionsInProgress.splice(d,1)}this._intersectionsInProgress.length=0;X.lights.forEach((N=>{let Z=N.includedOnlyMeshes.indexOf(this);-1!==Z&&N.includedOnlyMeshes.splice(Z,1),Z=N.excludedMeshes.indexOf(this),-1!==Z&&N.excludedMeshes.splice(Z,1);const d=N.getShadowGenerators();if(d){const N=d.values();for(let d=N.next();!0!==d.done;d=N.next()){const N=d.value.getShadowMap();N&&N.renderList&&(Z=N.renderList.indexOf(this),-1!==Z&&N.renderList.splice(Z,1))}}})),"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes();const I=X.getEngine();if(null!==this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,I.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),I.wipeCaches(),X._d(this),this._parentContainer){const N=this._parentContainer.meshes.indexOf(this);N>-1&&this._parentContainer.meshes.splice(N,1),this._parentContainer=null}if(d&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!N)for(Z=0;Z<X.Od.length;Z++)X.Od[Z].k===this&&(X.Od[Z].dispose(),Z--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this._uniformBuffer.dispose(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),super.dispose(N,d)}_initFacetData(){const N=this._internalAbstractMeshDataInfo._facetData;N.facetNormals||(N.facetNormals=[]),N.facetPositions||(N.facetPositions=[]),N.facetPartitioning||(N.facetPartitioning=new Array),N.facetNb=this.ge().length/3|0,N.partitioningSubdivisions=N.partitioningSubdivisions?N.partitioningSubdivisions:10,N.partitioningBBoxRatio=N.partitioningBBoxRatio?N.partitioningBBoxRatio:1.01;for(let Z=0;Z<N.facetNb;Z++)N.facetNormals[Z]=m.n.Zero(),N.facetPositions[Z]=m.n.Zero();return N.facetDataEnabled=!0,this}updateFacetData(){const N=this._internalAbstractMeshDataInfo._facetData;N.facetDataEnabled||this._initFacetData();const Z=this.getVerticesData(z.d.PositionKind),d=this.ge(),X=this.getVerticesData(z.d.NormalKind),I=this.getBoundingInfo();if(N.facetDepthSort&&!N.facetDepthSortEnabled){if(N.facetDepthSortEnabled=!0,d instanceof Uint16Array)N.depthSortedIndices=new Uint16Array(d);else if(d instanceof Uint32Array)N.depthSortedIndices=new Uint32Array(d);else{let Z=!1;for(let N=0;N<d.length;N++)if(d[N]>65535){Z=!0;break}N.depthSortedIndices=Z?new Uint32Array(d):new Uint16Array(d)}if(N.facetDepthSortFunction=function(N,Z){return Z.sqDistance-N.sqDistance},!N.facetDepthSortFrom){const Z=this.va().activeCamera;N.facetDepthSortFrom=Z?Z.position:m.n.Zero()}N.depthSortedFacets=[];for(let Z=0;Z<N.facetNb;Z++){const d={ind:3*Z,sqDistance:0};N.depthSortedFacets.push(d)}N.invertedMatrix=m.c.Identity(),N.facetDepthSortOrigin=m.n.Zero()}N.bbSize.x=I.maximum.x-I.minimum.x>h.b?I.maximum.x-I.minimum.x:h.b,N.bbSize.y=I.maximum.y-I.minimum.y>h.b?I.maximum.y-I.minimum.y:h.b,N.bbSize.z=I.maximum.z-I.minimum.z>h.b?I.maximum.z-I.minimum.z:h.b;let S=N.bbSize.x>N.bbSize.y?N.bbSize.x:N.bbSize.y;if(S=S>N.bbSize.z?S:N.bbSize.z,N.subDiv.max=N.partitioningSubdivisions,N.subDiv.X=Math.floor(N.subDiv.max*N.bbSize.x/S),N.subDiv.Y=Math.floor(N.subDiv.max*N.bbSize.y/S),N.subDiv.Z=Math.floor(N.subDiv.max*N.bbSize.z/S),N.subDiv.X=N.subDiv.X<1?1:N.subDiv.X,N.subDiv.Y=N.subDiv.Y<1?1:N.subDiv.Y,N.subDiv.Z=N.subDiv.Z<1?1:N.subDiv.Z,N.facetParameters.facetNormals=this.getFacetLocalNormals(),N.facetParameters.facetPositions=this.getFacetLocalPositions(),N.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),N.facetParameters.bInfo=I,N.facetParameters.bbSize=N.bbSize,N.facetParameters.subDiv=N.subDiv,N.facetParameters.ratio=this.partitioningBBoxRatio,N.facetParameters.depthSort=N.facetDepthSort,N.facetDepthSort&&N.facetDepthSortEnabled&&(this.be(!0),this._worldMatrix.invertToRef(N.invertedMatrix),m.n.TransformCoordinatesToRef(N.facetDepthSortFrom,N.invertedMatrix,N.facetDepthSortOrigin),N.facetParameters.distanceTo=N.facetDepthSortOrigin),N.facetParameters.depthSortedFacets=N.depthSortedFacets,X&&w.c.ComputeNormals(Z,d,X,N.facetParameters),N.facetDepthSort&&N.facetDepthSortEnabled){N.depthSortedFacets.sort(N.facetDepthSortFunction);const Z=N.depthSortedIndices.length/3|0;for(let X=0;X<Z;X++){const Z=N.depthSortedFacets[X].ind;N.depthSortedIndices[3*X]=d[Z],N.depthSortedIndices[3*X+1]=d[Z+1],N.depthSortedIndices[3*X+2]=d[Z+2]}this.updateIndices(N.depthSortedIndices,void 0,!0)}return this}getFacetLocalNormals(){const N=this._internalAbstractMeshDataInfo._facetData;return N.facetNormals||this.updateFacetData(),N.facetNormals}getFacetLocalPositions(){const N=this._internalAbstractMeshDataInfo._facetData;return N.facetPositions||this.updateFacetData(),N.facetPositions}getFacetLocalPartitioning(){const N=this._internalAbstractMeshDataInfo._facetData;return N.facetPartitioning||this.updateFacetData(),N.facetPartitioning}getFacetPosition(N){const Z=m.n.Zero();return this.getFacetPositionToRef(N,Z),Z}getFacetPositionToRef(N,Z){const d=this.getFacetLocalPositions()[N],X=this.getWorldMatrix();return m.n.TransformCoordinatesToRef(d,X,Z),this}getFacetNormal(N){const Z=m.n.Zero();return this.getFacetNormalToRef(N,Z),Z}getFacetNormalToRef(N,Z){const d=this.getFacetLocalNormals()[N];return m.n.TransformNormalToRef(d,this.getWorldMatrix(),Z),this}getFacetsAtLocalCoordinates(N,Z,d){const X=this.getBoundingInfo(),I=this._internalAbstractMeshDataInfo._facetData,m=Math.floor((N-X.minimum.x*I.partitioningBBoxRatio)*I.subDiv.X*I.partitioningBBoxRatio/I.bbSize.x),z=Math.floor((Z-X.minimum.y*I.partitioningBBoxRatio)*I.subDiv.Y*I.partitioningBBoxRatio/I.bbSize.y),w=Math.floor((d-X.minimum.z*I.partitioningBBoxRatio)*I.subDiv.Z*I.partitioningBBoxRatio/I.bbSize.z);return m<0||m>I.subDiv.max||z<0||z>I.subDiv.max||w<0||w>I.subDiv.max?null:I.facetPartitioning[m+I.subDiv.max*z+I.subDiv.max*I.subDiv.max*w]}getClosestFacetAtCoordinates(N,Z,d,X){let I=arguments.length>4&&void 0!==arguments[4]&&arguments[4],z=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const w=this.getWorldMatrix(),S=m.h.Matrix[5];w.invertToRef(S);const e=m.h.kd[8];m.n.TransformCoordinatesFromFloatsToRef(N,Z,d,S,e);const j=this.getClosestFacetAtLocalCoordinates(e.x,e.y,e.z,X,I,z);return X&&m.n.TransformCoordinatesFromFloatsToRef(X.x,X.y,X.z,w,X),j}getClosestFacetAtLocalCoordinates(N,Z,d,X){let I=arguments.length>4&&void 0!==arguments[4]&&arguments[4],m=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],z=null,w=0,S=0,e=0,j=0,B=0,D=0,v=0,T=0;const k=this.getFacetLocalPositions(),h=this.getFacetLocalNormals(),U=this.getFacetsAtLocalCoordinates(N,Z,d);if(!U)return null;let C,M,Q,A=Number.MAX_VALUE,n=A;for(let g=0;g<U.length;g++)C=U[g],M=h[C],Q=k[C],j=(N-Q.x)*M.x+(Z-Q.y)*M.y+(d-Q.z)*M.z,(!I||I&&m&&j>=0||I&&!m&&j<=0)&&(j=M.x*Q.x+M.y*Q.y+M.z*Q.z,B=-(M.x*N+M.y*Z+M.z*d-j)/(M.x*M.x+M.y*M.y+M.z*M.z),D=N+M.x*B,v=Z+M.y*B,T=d+M.z*B,w=D-N,S=v-Z,e=T-d,n=w*w+S*S+e*e,n<A&&(A=n,z=C,X&&(X.x=D,X.y=v,X.z=T)));return z}getFacetDataParameters(){return this._internalAbstractMeshDataInfo._facetData.facetParameters}disableFacetData(){const N=this._internalAbstractMeshDataInfo._facetData;return N.facetDataEnabled&&(N.facetDataEnabled=!1,N.facetPositions=[],N.facetNormals=[],N.facetPartitioning=new Array,N.facetParameters=null,N.depthSortedIndices=new Uint32Array(0)),this}updateIndices(N,Z){return this}createNormals(N){const Z=this.getVerticesData(z.d.PositionKind),d=this.ge();let X;return X=this.isVerticesDataPresent(z.d.NormalKind)?this.getVerticesData(z.d.NormalKind):[],w.c.ComputeNormals(Z,d,X,{useRightHandedSystem:this.va().useRightHandedSystem}),this.Ga(z.d.NormalKind,X,N),this}alignWithNormal(N,Z){Z||(Z=U.d.Y);const d=m.h.kd[0],X=m.h.kd[1];return m.n.CrossToRef(Z,N,X),m.n.CrossToRef(N,X,d),this.rotationQuaternion?m.g.RotationQuaternionFromAxisToRef(d,N,X,this.rotationQuaternion):m.n.RotationFromAxisToRef(d,N,X,this.rotation),this}_checkOcclusionQuery(){return!1}disableEdgesRendering(){throw(0,v.b)("EdgesRenderer")}enableEdgesRendering(N,Z,d){throw(0,v.b)("EdgesRenderer")}vj(){return this._scene.Od.filter((N=>N.k===this))}}g.OCCLUSION_TYPE_NONE=0,g.OCCLUSION_TYPE_OPTIMISTIC=1,g.OCCLUSION_TYPE_STRICT=2,g.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,g.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,g.CULLINGSTRATEGY_STANDARD=0,g.Ti=1,g.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,g.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,(0,X.d)([M.f.filter((function(){for(var N=arguments.length,Z=new Array(N),d=0;d<N;d++)Z[d]=arguments[d];let[X,I,m,z,w]=Z;return!Array.isArray(X)&&!Array.isArray(I)&&!Array.isArray(m)&&!Array.isArray(z)&&!Array.isArray(w)}))],g,"_ApplySkeleton",null),(0,C.h)("BABYLON.AbstractMesh",g)},11353:(N,Z,d)=>{"use strict";d.d(Z,{b:()=>h});var X=d(960),I=d(1108),m=d(11345),z=d(1169),w=d(1252),S=d(11361),e=d(1264),j=d(1133),B=d(1100),D=d(1280),v=d(986),T=d(1119),k=d(1051);class h{get boundingBias(){return this._boundingBias}set boundingBias(N){this._boundingBias?this._boundingBias.p(N):this._boundingBias=N.clone(),this.Ea(!0,null)}static CreateGeometryForMesh(N){const Z=new h(h.RandomId(),N.va());return Z.Ca(N),Z}get meshes(){return this._meshes}constructor(N,Z,d){let X=arguments.length>3&&void 0!==arguments[3]&&arguments[3],I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this._positionsCache=[],this._parentContainer=null,this.useBoundingInfoFromGeometry=!1,this._scene=Z||v.e.LastCreatedScene,this._scene&&(this.id=N,this.uniqueId=this._scene.getUniqueId(),this._engine=this._scene.getEngine(),this._meshes=[],this._vertexBuffers={},this._indices=[],this._updatable=X,d?this.setAllVerticesData(d,X):this._totalVertices=0,this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),I&&(this.Ca(I),I.be(!0)))}get extend(){return this._extend}va(){return this._scene}getEngine(){return this._engine}isReady(){return 1===this.delayLoadState||0===this.delayLoadState}get doNotSerialize(){for(let N=0;N<this._meshes.length;N++)if(!this._meshes[N].doNotSerialize)return!1;return!0}_rebuild(){this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer"));const N=new Set;for(const Z in this._vertexBuffers)N.add(this._vertexBuffers[Z].getWrapperBuffer());N.forEach((N=>{N._rebuild()}))}setAllVerticesData(N,Z){N.applyToGeometry(this,Z),this._notifyUpdate()}Ga(N,Z){let d=arguments.length>2&&void 0!==arguments[2]&&arguments[2],X=arguments.length>3?arguments[3]:void 0;d&&Array.isArray(Z)&&(Z=new Float32Array(Z));const I=new z.d(this._engine,Z,N,{updatable:d,postponeInternalCreation:0===this._meshes.length,stride:X,label:"Geometry_"+this.id+"_"+N});this.setVerticesBuffer(I)}removeVerticesData(N){this._vertexBuffers[N]&&(this._vertexBuffers[N].dispose(),delete this._vertexBuffers[N]),this._vertexArrayObjects&&this._disposeVertexArrayObjects()}setVerticesBuffer(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,d=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const I=N.getKind();this._vertexBuffers[I]&&d&&this._vertexBuffers[I].dispose(),N._buffer&&N._buffer._increaseReferences(),this._vertexBuffers[I]=N;const m=this._meshes,w=m.length;if(I===z.d.PositionKind){this._totalVertices=Z??N._maxVerticesCount,this._updateExtend(N.getFloatData(this._totalVertices)),this._resetPointsArrayCache();const d=this._extend&&this._extend.minimum||new X.n(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),I=this._extend&&this._extend.maximum||new X.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);for(let N=0;N<w;N++){const Z=m[N];Z.buildBoundingInfo(d,I),Z._createGlobalSubMesh(Z.isUnIndexed),Z.be(!0),Z.synchronizeInstances()}}this._notifyUpdate(I)}updateVerticesDataDirectly(N,Z,d){let X=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const I=this.getVertexBuffer(N);I&&(I.updateDirectly(Z,d,X),this._notifyUpdate(N))}updateVerticesData(N,Z){let d=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const X=this.getVertexBuffer(N);X&&(X.update(Z),N===z.d.PositionKind&&this.Ea(d,Z),this._notifyUpdate(N))}Ea(N,Z){if(N&&this._updateExtend(Z),this._resetPointsArrayCache(),N){const N=this._meshes;for(const Z of N){Z.hasBoundingInfo?Z.getBoundingInfo().reConstruct(this._extend.minimum,this._extend.maximum):Z.buildBoundingInfo(this._extend.minimum,this._extend.maximum);const N=Z.Sd;for(const Z of N)Z.refreshBoundingInfo()}}}_bind(N,Z,d,X){if(!N)return;void 0===Z&&(Z=this._indexBuffer);const I=this.getVertexBuffers();if(!I)return;if(Z!=this._indexBuffer||!this._vertexArrayObjects&&!X)return void this._engine.bindBuffers(I,Z,N,d);const m=X||this._vertexArrayObjects,z=this._engine;m[N.key]||(m[N.key]=z.recordVertexArrayObject(I,Z,N,d)),z.bindVertexArrayObject(m[N.key],Z)}getTotalVertices(){return this.isReady()?this._totalVertices:0}getVerticesData(N,Z,d){const X=this.getVertexBuffer(N);return X?X.getFloatData(this._totalVertices,d||Z&&1!==this._meshes.length):null}copyVerticesData(N,Z){const d=this.getVertexBuffer(N);if(!d)return;Z[N]||(Z[N]=new Float32Array(this._totalVertices*d.getSize()));const X=d.getData();X&&function(N,Z,d,X,I,m,w,S){const e=Z*z.d.GetTypeByteLength(d),j=w*Z;if(S.length!==j)throw new Error("Output length is not valid");if(d===z.d.FLOAT&&I===e)if(N instanceof Array){const Z=X/4;S.set(N,Z)}else if(N instanceof ArrayBuffer){const Z=new Float32Array(N,X,j);S.set(Z)}else{const Z=N.byteOffset+X;if(Z%4)return k.e.Warn("CopyFloatData: copied misaligned data."),void S.set(new Float32Array(N.buffer.slice(Z,Z+4*j)));const d=new Float32Array(N.buffer,Z,j);S.set(d)}else z.d.ForEach(N,X,I,Z,d,j,m,((N,Z)=>S[Z]=N))}(X,d.getSize(),d.type,d.byteOffset,d.byteStride,d.normalized,this._totalVertices,Z[N])}isVertexBufferUpdatable(N){const Z=this._vertexBuffers[N];return!!Z&&Z.isUpdatable()}getVertexBuffer(N){return this.isReady()?this._vertexBuffers[N]:null}getVertexBuffers(){return this.isReady()?this._vertexBuffers:null}isVerticesDataPresent(N){return this._vertexBuffers?void 0!==this._vertexBuffers[N]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(N)}getVerticesDataKinds(){const N=[];let Z;if(!this._vertexBuffers&&this._delayInfo)for(Z in this._delayInfo)N.push(Z);else for(Z in this._vertexBuffers)N.push(Z);return N}updateIndices(N,Z){let d=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._indexBuffer)if(this._indexBufferIsUpdatable){const X=N.length!==this._indices.length;if(d||(this._indices=N.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,N,Z),X)for(const N of this._meshes)N._createGlobalSubMesh(!0)}else this.setIndices(N,null,!0)}setIndexBuffer(N,Z,d){this._indices=[],this._indexBufferIsUpdatable=!1,this._indexBuffer=N,this._totalVertices=Z,this._totalIndices=d,N.is32Bits||(N.is32Bits=this._totalIndices>65535);for(const X of this._meshes)X._createGlobalSubMesh(!0),X.synchronizeInstances();this._notifyUpdate()}setIndices(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,d=arguments.length>2&&void 0!==arguments[2]&&arguments[2],X=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=N,this._indexBufferIsUpdatable=d,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,d,"Geometry_"+this.id+"_IndexBuffer")),void 0!=Z&&(this._totalVertices=Z);for(const I of this._meshes)I._createGlobalSubMesh(!X),I.synchronizeInstances();this._notifyUpdate()}getTotalIndices(){return this.isReady()?void 0!==this._totalIndices?this._totalIndices:this._indices.length:0}ge(N,Z){if(!this.isReady())return null;const d=this._indices;return Z||N&&1!==this._meshes.length?d.slice():d}getIndexBuffer(){return this.isReady()?this._indexBuffer:null}_releaseVertexArrayObject(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;N&&this._vertexArrayObjects&&this._vertexArrayObjects[N.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[N.key]),delete this._vertexArrayObjects[N.key])}releaseForMesh(N,Z){const d=this._meshes,X=d.indexOf(N);-1!==X&&(d.splice(X,1),this._vertexArrayObjects&&N._invalidateInstanceVertexArrayObject(),N._geometry=null,0===d.length&&Z&&this.dispose())}Ca(N){if(N._geometry===this)return;const Z=N._geometry;Z&&Z.releaseForMesh(N),this._vertexArrayObjects&&N._invalidateInstanceVertexArrayObject();const d=this._meshes;N._geometry=this,N._internalAbstractMeshDataInfo._positions=null,this._scene.pushGeometry(this),d.push(N),this.isReady()?this._applyToMesh(N):this._boundingInfo&&N.setBoundingInfo(this._boundingInfo)}_updateExtend(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.useBoundingInfoFromGeometry&&this._boundingInfo)this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()};else{if(!N&&(N=this.getVerticesData(z.d.PositionKind),!N))return;this._extend=(0,D.f)(N,0,this._totalVertices,this.boundingBias,3)}}_applyToMesh(N){const Z=this._meshes.length;for(const d in this._vertexBuffers)1===Z&&this._vertexBuffers[d].create(),d===z.d.PositionKind&&(this._extend||this._updateExtend(),N.buildBoundingInfo(this._extend.minimum,this._extend.maximum),N._createGlobalSubMesh(N.isUnIndexed),N.Ea());1===Z&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer")),N._syncGeometryWithMorphTargetManager(),N.synchronizeInstances()}_notifyUpdate(N){this.onGeometryUpdated&&this.onGeometryUpdated(this,N),this._vertexArrayObjects&&this._disposeVertexArrayObjects();for(const Z of this._meshes)Z._markSubMeshesAsAttributesDirty()}load(N,Z){2!==this.delayLoadState&&(this.isReady()?Z&&Z():(this.delayLoadState=2,this._queueLoad(N,Z)))}_queueLoad(N,Z){this.delayLoadingFile&&(N.addPendingData(this),N._loadFile(this.delayLoadingFile,(d=>{if(!this._delayLoadingFunction)return;this._delayLoadingFunction(JSON.parse(d),this),this.delayLoadState=1,this._delayInfo=[],N.removePendingData(this);const X=this._meshes,I=X.length;for(let N=0;N<I;N++)this._applyToMesh(X[N]);Z&&Z()}),void 0,!0))}toLeftHanded(){const N=this.ge(!1);if(null!=N&&N.length>0){for(let Z=0;Z<N.length;Z+=3){const d=N[Z+0];N[Z+0]=N[Z+2],N[Z+2]=d}this.setIndices(N)}const Z=this.getVerticesData(z.d.PositionKind,!1);if(null!=Z&&Z.length>0){for(let N=0;N<Z.length;N+=3)Z[N+2]=-Z[N+2];this.Ga(z.d.PositionKind,Z,!1)}const d=this.getVerticesData(z.d.NormalKind,!1);if(null!=d&&d.length>0){for(let N=0;N<d.length;N+=3)d[N+2]=-d[N+2];this.Ga(z.d.NormalKind,d,!1)}}_resetPointsArrayCache(){this._positions=null}_generatePointsArray(){if(this._positions)return!0;const N=this.getVerticesData(z.d.PositionKind);if(!N||0===N.length)return!1;for(let Z=3*this._positionsCache.length,d=this._positionsCache.length;Z<N.length;Z+=3,++d)this._positionsCache[d]=X.n._c(N,Z);for(let Z=0,d=0;Z<N.length;Z+=3,++d)this._positionsCache[d].set(N[0+Z],N[1+Z],N[2+Z]);return this._positionsCache.length=N.length/3,this._positions=this._positionsCache,!0}u(){return this._isDisposed}_disposeVertexArrayObjects(){if(this._vertexArrayObjects){for(const d in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[d]);this._vertexArrayObjects={};const N=this._meshes,Z=N.length;for(let d=0;d<Z;d++)N[d]._invalidateInstanceVertexArrayObject()}}dispose(){const N=this._meshes,Z=N.length;let d;for(d=0;d<Z;d++)this.releaseForMesh(N[d]);this._meshes.length=0,this._disposeVertexArrayObjects();for(const X in this._vertexBuffers)this._vertexBuffers[X].dispose();if(this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._parentContainer){const N=this._parentContainer.geometries.indexOf(this);N>-1&&this._parentContainer.geometries.splice(N,1),this._parentContainer=null}this._isDisposed=!0}j(N){const Z=new m.c;Z.indices=[];const d=this.ge();if(d)for(let m=0;m<d.length;m++)Z.indices.push(d[m]);let X,I=!1,z=!1;for(X in this._vertexBuffers){const N=this.getVerticesData(X);if(N&&(N instanceof Float32Array?Z.set(new Float32Array(N),X):Z.set(N.slice(0),X),!z)){const N=this.getVertexBuffer(X);N&&(I=N.isUpdatable(),z=!I)}}const w=new h(N,this._scene,Z,I);for(X in w.delayLoadState=this.delayLoadState,w.delayLoadingFile=this.delayLoadingFile,w._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)w._delayInfo=w._delayInfo||[],w._delayInfo.push(X);return w._boundingInfo=new e.e(this._extend.minimum,this._extend.maximum),w}serialize(){const N={};return N.id=this.id,N.uniqueId=this.uniqueId,N.updatable=this._updatable,B.e&&B.e.HasTags(this)&&(N.tags=B.e.GetTags(this)),N}_toNumberArray(N){return Array.isArray(N)?N:Array.prototype.slice.call(N)}clearCachedData(){this._indices=[],this._resetPointsArrayCache();for(const N in this._vertexBuffers)Object.prototype.hasOwnProperty.call(this._vertexBuffers,N)&&(this._vertexBuffers[N]._buffer._data=null)}serializeVerticeData(){const N=this.serialize();return this.isVerticesDataPresent(z.d.PositionKind)&&(N.xa=this._toNumberArray(this.getVerticesData(z.d.PositionKind)),this.isVertexBufferUpdatable(z.d.PositionKind)&&(N.xa._updatable=!0)),this.isVerticesDataPresent(z.d.NormalKind)&&(N.ya=this._toNumberArray(this.getVerticesData(z.d.NormalKind)),this.isVertexBufferUpdatable(z.d.NormalKind)&&(N.ya._updatable=!0)),this.isVerticesDataPresent(z.d.TangentKind)&&(N.tangents=this._toNumberArray(this.getVerticesData(z.d.TangentKind)),this.isVertexBufferUpdatable(z.d.TangentKind)&&(N.tangents._updatable=!0)),this.isVerticesDataPresent(z.d.UVKind)&&(N.Aa=this._toNumberArray(this.getVerticesData(z.d.UVKind)),this.isVertexBufferUpdatable(z.d.UVKind)&&(N.Aa._updatable=!0)),this.isVerticesDataPresent(z.d.UV2Kind)&&(N.uvs2=this._toNumberArray(this.getVerticesData(z.d.UV2Kind)),this.isVertexBufferUpdatable(z.d.UV2Kind)&&(N.uvs2._updatable=!0)),this.isVerticesDataPresent(z.d.UV3Kind)&&(N.uvs3=this._toNumberArray(this.getVerticesData(z.d.UV3Kind)),this.isVertexBufferUpdatable(z.d.UV3Kind)&&(N.uvs3._updatable=!0)),this.isVerticesDataPresent(z.d.UV4Kind)&&(N.uvs4=this._toNumberArray(this.getVerticesData(z.d.UV4Kind)),this.isVertexBufferUpdatable(z.d.UV4Kind)&&(N.uvs4._updatable=!0)),this.isVerticesDataPresent(z.d.UV5Kind)&&(N.uvs5=this._toNumberArray(this.getVerticesData(z.d.UV5Kind)),this.isVertexBufferUpdatable(z.d.UV5Kind)&&(N.uvs5._updatable=!0)),this.isVerticesDataPresent(z.d.UV6Kind)&&(N.uvs6=this._toNumberArray(this.getVerticesData(z.d.UV6Kind)),this.isVertexBufferUpdatable(z.d.UV6Kind)&&(N.uvs6._updatable=!0)),this.isVerticesDataPresent(z.d.ColorKind)&&(N.za=this._toNumberArray(this.getVerticesData(z.d.ColorKind)),this.isVertexBufferUpdatable(z.d.ColorKind)&&(N.za._updatable=!0)),this.isVerticesDataPresent(z.d.MatricesIndicesKind)&&(N.matricesIndices=this._toNumberArray(this.getVerticesData(z.d.MatricesIndicesKind)),N.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(z.d.MatricesIndicesKind)&&(N.matricesIndices._updatable=!0)),this.isVerticesDataPresent(z.d.MatricesWeightsKind)&&(N.matricesWeights=this._toNumberArray(this.getVerticesData(z.d.MatricesWeightsKind)),this.isVertexBufferUpdatable(z.d.MatricesWeightsKind)&&(N.matricesWeights._updatable=!0)),N.indices=this._toNumberArray(this.ge()),N}static ExtractFromMesh(N,Z){const d=N._geometry;return d?d.j(Z):null}static RandomId(){return j.g.RandomId()}static _GetGeometryByLoadedUniqueId(N,Z){for(let d=0;d<Z.geometries.length;d++)if(Z.geometries[d]._loadedUniqueId===N)return Z.geometries[d];return null}static _ImportGeometry(N,Z){const d=Z.va(),X=N.geometryUniqueId,m=N.geometryId;if(X||m){const N=X?this._GetGeometryByLoadedUniqueId(X,d):d.getGeometryById(m);N&&N.Ca(Z)}else if(N instanceof ArrayBuffer){const d=Z._binaryInfo;if(d.positionsAttrDesc&&d.positionsAttrDesc.count>0){const X=new Float32Array(N,d.positionsAttrDesc.offset,d.positionsAttrDesc.count);Z.Ga(z.d.PositionKind,X,!1)}if(d.normalsAttrDesc&&d.normalsAttrDesc.count>0){const X=new Float32Array(N,d.normalsAttrDesc.offset,d.normalsAttrDesc.count);Z.Ga(z.d.NormalKind,X,!1)}if(d.tangetsAttrDesc&&d.tangetsAttrDesc.count>0){const X=new Float32Array(N,d.tangetsAttrDesc.offset,d.tangetsAttrDesc.count);Z.Ga(z.d.TangentKind,X,!1)}if(d.uvsAttrDesc&&d.uvsAttrDesc.count>0){const X=new Float32Array(N,d.uvsAttrDesc.offset,d.uvsAttrDesc.count);if(T.b)for(let N=1;N<X.length;N+=2)X[N]=1-X[N];Z.Ga(z.d.UVKind,X,!1)}if(d.uvs2AttrDesc&&d.uvs2AttrDesc.count>0){const X=new Float32Array(N,d.uvs2AttrDesc.offset,d.uvs2AttrDesc.count);if(T.b)for(let N=1;N<X.length;N+=2)X[N]=1-X[N];Z.Ga(z.d.UV2Kind,X,!1)}if(d.uvs3AttrDesc&&d.uvs3AttrDesc.count>0){const X=new Float32Array(N,d.uvs3AttrDesc.offset,d.uvs3AttrDesc.count);if(T.b)for(let N=1;N<X.length;N+=2)X[N]=1-X[N];Z.Ga(z.d.UV3Kind,X,!1)}if(d.uvs4AttrDesc&&d.uvs4AttrDesc.count>0){const X=new Float32Array(N,d.uvs4AttrDesc.offset,d.uvs4AttrDesc.count);if(T.b)for(let N=1;N<X.length;N+=2)X[N]=1-X[N];Z.Ga(z.d.UV4Kind,X,!1)}if(d.uvs5AttrDesc&&d.uvs5AttrDesc.count>0){const X=new Float32Array(N,d.uvs5AttrDesc.offset,d.uvs5AttrDesc.count);if(T.b)for(let N=1;N<X.length;N+=2)X[N]=1-X[N];Z.Ga(z.d.UV5Kind,X,!1)}if(d.uvs6AttrDesc&&d.uvs6AttrDesc.count>0){const X=new Float32Array(N,d.uvs6AttrDesc.offset,d.uvs6AttrDesc.count);if(T.b)for(let N=1;N<X.length;N+=2)X[N]=1-X[N];Z.Ga(z.d.UV6Kind,X,!1)}if(d.colorsAttrDesc&&d.colorsAttrDesc.count>0){const X=new Float32Array(N,d.colorsAttrDesc.offset,d.colorsAttrDesc.count);Z.Ga(z.d.ColorKind,X,!1,d.colorsAttrDesc.stride)}if(d.matricesIndicesAttrDesc&&d.matricesIndicesAttrDesc.count>0){const X=new Int32Array(N,d.matricesIndicesAttrDesc.offset,d.matricesIndicesAttrDesc.count),I=[];for(let N=0;N<X.length;N++){const Z=X[N];I.push(255&Z),I.push((65280&Z)>>8),I.push((16711680&Z)>>16),I.push(Z>>24&255)}Z.Ga(z.d.MatricesIndicesKind,I,!1)}if(d.matricesIndicesExtraAttrDesc&&d.matricesIndicesExtraAttrDesc.count>0){const X=new Int32Array(N,d.matricesIndicesExtraAttrDesc.offset,d.matricesIndicesExtraAttrDesc.count),I=[];for(let N=0;N<X.length;N++){const Z=X[N];I.push(255&Z),I.push((65280&Z)>>8),I.push((16711680&Z)>>16),I.push(Z>>24&255)}Z.Ga(z.d.MatricesIndicesExtraKind,I,!1)}if(d.matricesWeightsAttrDesc&&d.matricesWeightsAttrDesc.count>0){const X=new Float32Array(N,d.matricesWeightsAttrDesc.offset,d.matricesWeightsAttrDesc.count);Z.Ga(z.d.MatricesWeightsKind,X,!1)}if(d.indicesAttrDesc&&d.indicesAttrDesc.count>0){const X=new Int32Array(N,d.indicesAttrDesc.offset,d.indicesAttrDesc.count);Z.setIndices(X,null)}if(d.subMeshesAttrDesc&&d.subMeshesAttrDesc.count>0){const X=new Int32Array(N,d.subMeshesAttrDesc.offset,5*d.subMeshesAttrDesc.count);Z.Sd=[];for(let N=0;N<d.subMeshesAttrDesc.count;N++){const d=X[5*N+0],I=X[5*N+1],m=X[5*N+2],z=X[5*N+3],S=X[5*N+4];w.c.AddToMesh(d,I,m,z,S,Z)}}}else if(N.xa&&N.ya&&N.indices){if(Z.Ga(z.d.PositionKind,N.xa,N.xa._updatable),Z.Ga(z.d.NormalKind,N.ya,N.ya._updatable),N.tangents&&Z.Ga(z.d.TangentKind,N.tangents,N.tangents._updatable),N.Aa&&Z.Ga(z.d.UVKind,N.Aa,N.Aa._updatable),N.uvs2&&Z.Ga(z.d.UV2Kind,N.uvs2,N.uvs2._updatable),N.uvs3&&Z.Ga(z.d.UV3Kind,N.uvs3,N.uvs3._updatable),N.uvs4&&Z.Ga(z.d.UV4Kind,N.uvs4,N.uvs4._updatable),N.uvs5&&Z.Ga(z.d.UV5Kind,N.uvs5,N.uvs5._updatable),N.uvs6&&Z.Ga(z.d.UV6Kind,N.uvs6,N.uvs6._updatable),N.za&&Z.Ga(z.d.ColorKind,I.e.CheckColors4(N.za,N.xa.length/3),N.za._updatable),N.matricesIndices)if(N.matricesIndices._isExpanded)delete N.matricesIndices._isExpanded,Z.Ga(z.d.MatricesIndicesKind,N.matricesIndices,N.matricesIndices._updatable);else{const d=[];for(let Z=0;Z<N.matricesIndices.length;Z++){const X=N.matricesIndices[Z];d.push(255&X),d.push((65280&X)>>8),d.push((16711680&X)>>16),d.push(X>>24&255)}Z.Ga(z.d.MatricesIndicesKind,d,N.matricesIndices._updatable)}if(N.matricesIndicesExtra)if(N.matricesIndicesExtra._isExpanded)delete N.matricesIndices._isExpanded,Z.Ga(z.d.MatricesIndicesExtraKind,N.matricesIndicesExtra,N.matricesIndicesExtra._updatable);else{const d=[];for(let Z=0;Z<N.matricesIndicesExtra.length;Z++){const X=N.matricesIndicesExtra[Z];d.push(255&X),d.push((65280&X)>>8),d.push((16711680&X)>>16),d.push(X>>24&255)}Z.Ga(z.d.MatricesIndicesExtraKind,d,N.matricesIndicesExtra._updatable)}N.matricesWeights&&(h._CleanMatricesWeights(N,Z),Z.Ga(z.d.MatricesWeightsKind,N.matricesWeights,N.matricesWeights._updatable)),N.matricesWeightsExtra&&Z.Ga(z.d.MatricesWeightsExtraKind,N.matricesWeightsExtra,N.matricesWeights._updatable),Z.setIndices(N.indices,null)}if(N.Sd){Z.Sd=[];for(let d=0;d<N.Sd.length;d++){const X=N.Sd[d];w.c.AddToMesh(X.materialIndex,X.verticesStart,X.verticesCount,X.indexStart,X.indexCount,Z)}}Z._shouldGenerateFlatShading&&(Z.convertToFlatShadedMesh(),Z._shouldGenerateFlatShading=!1),Z.be(!0),d.onMeshImportedObservable.notifyObservers(Z)}static _CleanMatricesWeights(N,Z){const d=.001;if(!S.b.CleanBoneMatrixWeights)return;let X=0;if(!(N.skeletonId>-1))return;{const d=Z.va().getLastSkeletonById(N.skeletonId);if(!d)return;X=d.bones.length}const I=Z.getVerticesData(z.d.MatricesIndicesKind),m=Z.getVerticesData(z.d.MatricesIndicesExtraKind),w=N.matricesWeights,e=N.matricesWeightsExtra,j=N.numBoneInfluencer,B=w.length;for(let z=0;z<B;z+=4){let N=0,Z=-1;for(let X=0;X<4;X++){const I=w[z+X];N+=I,I<d&&Z<0&&(Z=X)}if(e)for(let X=0;X<4;X++){const I=e[z+X];N+=I,I<d&&Z<0&&(Z=X+4)}if((Z<0||Z>j-1)&&(Z=j-1),N>d){const Z=1/N;for(let N=0;N<4;N++)w[z+N]*=Z;if(e)for(let N=0;N<4;N++)e[z+N]*=Z}else Z>=4?(e[z+Z-4]=1-N,m[z+Z-4]=X):(w[z+Z]=1-N,I[z+Z]=X)}Z.Ga(z.d.MatricesIndicesKind,I),N.matricesWeightsExtra&&Z.Ga(z.d.MatricesIndicesExtraKind,m)}static Parse(N,Z,d){const I=new h(N.id,Z,void 0,N.updatable);return I._loadedUniqueId=N.uniqueId,B.e&&B.e.AddTagsTo(I,N.tags),N.delayLoadingFile?(I.delayLoadState=4,I.delayLoadingFile=d+N.delayLoadingFile,I._boundingInfo=new e.e(X.n._c(N.boundingBoxMinimum),X.n._c(N.boundingBoxMaximum)),I._delayInfo=[],N.hasUVs&&I._delayInfo.push(z.d.UVKind),N.hasUVs2&&I._delayInfo.push(z.d.UV2Kind),N.hasUVs3&&I._delayInfo.push(z.d.UV3Kind),N.hasUVs4&&I._delayInfo.push(z.d.UV4Kind),N.hasUVs5&&I._delayInfo.push(z.d.UV5Kind),N.hasUVs6&&I._delayInfo.push(z.d.UV6Kind),N.hasColors&&I._delayInfo.push(z.d.ColorKind),N.hasMatricesIndices&&I._delayInfo.push(z.d.MatricesIndicesKind),N.hasMatricesWeights&&I._delayInfo.push(z.d.MatricesWeightsKind),I._delayLoadingFunction=m.c.ImportVertexData):m.c.ImportVertexData(N,I),Z.pushGeometry(I,!0),I}}},11748:(N,Z,d)=>{"use strict";d.d(Z,{e:()=>D});var X=d(960),I=d(1051),m=d(11366),z=d(11321),w=d(1135),S=d(11370),e=d(1169),j=d(1133),B=d(978);z.b._instancedMeshFactory=(N,Z)=>{const d=new D(N,Z);if(Z.instancedBuffers){d.instancedBuffers={};for(const N in Z.instancedBuffers)d.instancedBuffers[N]=Z.instancedBuffers[N]}return d};class D extends m.b{constructor(N,Z){super(N,Z.va()),this._indexInSourceMeshInstanceArray=-1,this._distanceToCamera=0,Z.Jj(this),this._sourceMesh=Z,this._unIndexed=Z._unIndexed,this.position.p(Z.position),this.rotation.p(Z.rotation),this.od.p(Z.od),Z.rotationQuaternion&&(this.rotationQuaternion=Z.rotationQuaternion.clone()),this.animations=Z.animations.slice();for(const d of Z.getAnimationRanges())null!=d&&this.createAnimationRange(d.name,d.from,d.to);this.infiniteDistance=Z.infiniteDistance,this.setPivotMatrix(Z.getPivotMatrix()),this.refreshBoundingInfo(!0,!0),this._syncSubMeshes()}getClassName(){return"InstancedMesh"}get lightSources(){return this._sourceMesh._lightSources}_resyncLightSources(){}_resyncLightSource(){}_removeLightSource(){}get receiveShadows(){return this._sourceMesh.receiveShadows}set receiveShadows(N){var Z;(null===(Z=this._sourceMesh)||void 0===Z?void 0:Z.receiveShadows)!==N&&j.g.Warn("Setting receiveShadows on an instanced mesh has no effect")}get material(){return this._sourceMesh.material}set material(N){var Z;(null===(Z=this._sourceMesh)||void 0===Z?void 0:Z.material)!==N&&j.g.Warn("Setting material on an instanced mesh has no effect")}get visibility(){return this._sourceMesh.visibility}set visibility(N){var Z;(null===(Z=this._sourceMesh)||void 0===Z?void 0:Z.visibility)!==N&&j.g.Warn("Setting visibility on an instanced mesh has no effect")}get skeleton(){return this._sourceMesh.skeleton}set skeleton(N){var Z;(null===(Z=this._sourceMesh)||void 0===Z?void 0:Z.skeleton)!==N&&j.g.Warn("Setting skeleton on an instanced mesh has no effect")}get renderingGroupId(){return this._sourceMesh.renderingGroupId}set renderingGroupId(N){this._sourceMesh&&N!==this._sourceMesh.renderingGroupId&&I.e.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")}getTotalVertices(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0}getTotalIndices(){return this._sourceMesh.getTotalIndices()}get sourceMesh(){return this._sourceMesh}eb(N){return this._sourceMesh.eb(N)}isReady(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._sourceMesh.isReady(N,!0)}getVerticesData(N,Z,d){return this._sourceMesh.getVerticesData(N,Z,d)}copyVerticesData(N,Z){this._sourceMesh.copyVerticesData(N,Z)}Ga(N,Z,d,X){return this.sourceMesh&&this.sourceMesh.Ga(N,Z,d,X),this.sourceMesh}updateVerticesData(N,Z,d,X){return this.sourceMesh&&this.sourceMesh.updateVerticesData(N,Z,d,X),this.sourceMesh}setIndices(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.sourceMesh&&this.sourceMesh.setIndices(N,Z),this.sourceMesh}isVerticesDataPresent(N){return this._sourceMesh.isVerticesDataPresent(N)}ge(){return this._sourceMesh.ge()}get _positions(){return this._sourceMesh._positions}refreshBoundingInfo(){let N,Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;N="object"===typeof Z?Z:{applySkeleton:Z,applyMorph:d};const X=this._sourceMesh.de?this._sourceMesh.de.boundingBias:null;return this.Fa(this._sourceMesh._getData(N,null,e.d.PositionKind),X),this}_preActivate(){return this._currentLOD&&this._currentLOD._preActivate(),this}_activate(N,Z){if(super._activate(N,Z),this._sourceMesh.Sd||I.e.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!==this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,N),Z){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1}_postActivate(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)}getWorldMatrix(){if(this._currentLOD&&this._currentLOD.billboardMode!==S.c.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new X.c);const N=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,X.h.kd[7].p(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.p(this._currentLOD.be(!0)),this._currentLOD.position.p(X.h.kd[7]),this._currentLOD._masterMesh=N,this._billboardWorldMatrix}return super.getWorldMatrix()}get isAnInstance(){return!0}getLOD(N){if(!N)return this;const Z=this.sourceMesh.getLODLevels();if(Z&&0!==Z.length){const Z=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(N,Z.boundingSphere)}else this._currentLOD=this.sourceMesh;return this._currentLOD}_preActivateForIntermediateRendering(N){return this.sourceMesh._preActivateForIntermediateRendering(N)}_syncSubMeshes(){if(this.releaseSubMeshes(),this._sourceMesh.Sd)for(let N=0;N<this._sourceMesh.Sd.length;N++)this._sourceMesh.Sd[N].clone(this,this._sourceMesh);return this}_generatePointsArray(){return this._sourceMesh._generatePointsArray()}Ea(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}clone(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,d=arguments.length>2?arguments[2]:void 0;const X=((arguments.length>3?arguments[3]:void 0)||this._sourceMesh).eb(N);if(w.b.DeepCopy(this,X,["name","Sd","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","uj","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo"],[]),this.refreshBoundingInfo(),Z&&(X.parent=Z),!d)for(let I=0;I<this.va().meshes.length;I++){const N=this.va().meshes[I];N.parent===this&&N.clone(N.name,X)}return X.be(!0),this.onClonedObservable.notifyObservers(X),X}dispose(N){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._sourceMesh.Ij(this),super.dispose(N,Z)}_serializeAsParent(N){super._serializeAsParent(N),N.parentId=this._sourceMesh.uniqueId,N.parentInstanceIndex=this._indexInSourceMeshInstanceArray}instantiateHierarchy(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,Z=arguments.length>1?arguments[1]:void 0,d=arguments.length>2?arguments[2]:void 0;const X=this.clone("Clone of "+(this.name||this.id),N||this.parent,!0,Z&&Z.newSourcedMesh);X&&d&&d(this,X);for(const I of this.getChildTransformNodes(!0))I.instantiateHierarchy(X,Z,d);return X}}z.b.prototype.registerInstancedBuffer=function(N,Z){var d,X;if(null===(d=this._userInstancedBuffersStorage)||void 0===d||null===(X=d.vertexBuffers[N])||void 0===X||X.dispose(),!this.instancedBuffers){this.instancedBuffers={};for(const N of this.instances)N.instancedBuffers={}}this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this.instancedBuffers[N]=null,this._userInstancedBuffersStorage.strides[N]=Z,this._userInstancedBuffersStorage.sizes[N]=32*Z,this._userInstancedBuffersStorage.data[N]=new Float32Array(this._userInstancedBuffersStorage.sizes[N]),this._userInstancedBuffersStorage.vertexBuffers[N]=new e.d(this.getEngine(),this._userInstancedBuffersStorage.data[N],N,!0,!1,Z,!0);for(const I of this.instances)I.instancedBuffers[N]=null;this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()},z.b.prototype._processInstancedBuffers=function(N,Z){const d=N?N.length:0;for(const X in this.instancedBuffers){let I=this._userInstancedBuffersStorage.sizes[X];const m=this._userInstancedBuffersStorage.strides[X],z=(d+1)*m;for(;I<z;)I*=2;this._userInstancedBuffersStorage.data[X].length!=I&&(this._userInstancedBuffersStorage.data[X]=new Float32Array(I),this._userInstancedBuffersStorage.sizes[X]=I,this._userInstancedBuffersStorage.vertexBuffers[X]&&(this._userInstancedBuffersStorage.vertexBuffers[X].dispose(),this._userInstancedBuffersStorage.vertexBuffers[X]=null));const w=this._userInstancedBuffersStorage.data[X];let S=0;if(Z){const N=this.instancedBuffers[X];N.toArray?N.toArray(w,S):N.copyToArray?N.copyToArray(w,S):w[S]=N,S+=m}for(let Z=0;Z<d;Z++){const d=N[Z].instancedBuffers[X];d.toArray?d.toArray(w,S):d.copyToArray?d.copyToArray(w,S):w[S]=d,S+=m}this._userInstancedBuffersStorage.vertexBuffers[X]?this._userInstancedBuffersStorage.vertexBuffers[X].updateDirectly(w,0):(this._userInstancedBuffersStorage.vertexBuffers[X]=new e.d(this.getEngine(),this._userInstancedBuffersStorage.data[X],X,!0,!1,m,!0),this._invalidateInstanceVertexArrayObject())}},z.b.prototype._invalidateInstanceVertexArrayObject=function(){if(this._userInstancedBuffersStorage&&void 0!==this._userInstancedBuffersStorage.vertexArrayObjects){for(const N in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[N]);this._userInstancedBuffersStorage.vertexArrayObjects={}}},z.b.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(const N in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[N]&&this._userInstancedBuffersStorage.vertexBuffers[N].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}},(0,B.h)("BABYLON.InstancedMesh",D)},11321:(N,Z,d)=>{"use strict";d.d(Z,{b:()=>b,e:()=>O});var X=d(958),I=d(1133),m=d(1135),z=d(1100),w=d(11329),S=d(11335),e=d(960),j=d(1108),B=d(11343),D=d(1169),v=d(11345),T=d(11353),k=d(11366),h=d(1252),U=d(1249),C=d(11374),M=d(11361),Q=d(1094),A=d(1051),n=d(978),g=d(1041),E=d(1193);class V{constructor(N,Z){this.distanceOrScreenCoverage=N,this.mesh=Z}}class O{}class K{constructor(){this.visibleInstances={},this.batchCache=new r,this.batchCacheReplacementModeInFrozenMode=new r,this.instancesBufferSize=2048}}class r{constructor(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=[],this.hardwareInstancedRendering=[]}}class P{constructor(){this.instancesCount=0,this.matrixBuffer=null,this.previousMatrixBuffer=null,this.matrixBufferSize=512,this.matrixData=null,this.boundingVectors=[],this.worldMatrices=null}}class W{constructor(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._useLODScreenCoverage=!1,this._effectiveMaterial=null,this._forcedInstanceCount=0,this._overrideRenderingFillMode=null}}class b extends k.b{static _GetDefaultSideOrientation(N){return N||b.FRONTSIDE}get useLODScreenCoverage(){return this._internalMeshDataInfo._useLODScreenCoverage}set useLODScreenCoverage(N){this._internalMeshDataInfo._useLODScreenCoverage=N,this._sortLODLevels()}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(N){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==N&&(N&&this._internalMeshDataInfo._sourcePositions&&(this.Ga(D.d.PositionKind,this._internalMeshDataInfo._sourcePositions,!0),this._internalMeshDataInfo._sourceNormals&&this.Ga(D.d.NormalKind,this._internalMeshDataInfo._sourceNormals,!0),this._internalMeshDataInfo._sourcePositions=null,this._internalMeshDataInfo._sourceNormals=null),this._internalAbstractMeshDataInfo._computeBonesUsingShaders=N,this._markSubMeshesAsAttributesDirty())}get onBeforeRenderObservable(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new X.d),this._internalMeshDataInfo._onBeforeRenderObservable}get onBeforeBindObservable(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new X.d),this._internalMeshDataInfo._onBeforeBindObservable}get onAfterRenderObservable(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new X.d),this._internalMeshDataInfo._onAfterRenderObservable}get onBetweenPassObservable(){return this._internalMeshDataInfo._onBetweenPassObservable||(this._internalMeshDataInfo._onBetweenPassObservable=new X.d),this._internalMeshDataInfo._onBetweenPassObservable}get onBeforeDrawObservable(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new X.d),this._internalMeshDataInfo._onBeforeDrawObservable}set onBeforeDraw(N){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(N)}get hasInstances(){return this.instances.length>0}get hasThinInstances(){return(this.forcedInstanceCount||this._thinInstanceDataStorage.instancesCount||0)>0}get forcedInstanceCount(){return this._internalMeshDataInfo._forcedInstanceCount}set forcedInstanceCount(N){this._internalMeshDataInfo._forcedInstanceCount=N}get sideOrientation(){return this._internalMeshDataInfo._sideOrientation}set sideOrientation(N){this._internalMeshDataInfo._sideOrientation=N,this._internalAbstractMeshDataInfo._sideOrientationHint=this._scene.useRightHandedSystem&&1===N||!this._scene.useRightHandedSystem&&0===N}get overrideMaterialSideOrientation(){return this.sideOrientation}set overrideMaterialSideOrientation(N){this.sideOrientation=N,this.material&&(this.material.sideOrientation=null)}get overrideRenderingFillMode(){return this._internalMeshDataInfo._overrideRenderingFillMode}set overrideRenderingFillMode(N){this._internalMeshDataInfo._overrideRenderingFillMode=N}get material(){return this._internalAbstractMeshDataInfo._material}set material(N){N&&(this.material&&null===this.material.sideOrientation||this._internalAbstractMeshDataInfo._sideOrientationHint)&&(N.sideOrientation=null),this._setMaterial(N)}get source(){return this._internalMeshDataInfo._source}get cloneMeshMap(){return this._internalMeshDataInfo.meshMap}get isUnIndexed(){return this._unIndexed}set isUnIndexed(N){this._unIndexed!==N&&(this._unIndexed=N,this._markSubMeshesAsAttributesDirty())}get worldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesData}get previousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesPreviousData}get manualUpdateOfWorldMatrixInstancedBuffer(){return this._instanceDataStorage.manualUpdate}set manualUpdateOfWorldMatrixInstancedBuffer(N){this._instanceDataStorage.manualUpdate=N}get manualUpdateOfPreviousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.previousManualUpdate}set manualUpdateOfPreviousWorldMatrixInstancedBuffer(N){this._instanceDataStorage.previousManualUpdate=N}get forceWorldMatrixInstancedBufferUpdate(){return this._instanceDataStorage.forceMatrixUpdates}set forceWorldMatrixInstancedBufferUpdate(N){this._instanceDataStorage.forceMatrixUpdates=N}_copySource(N,Z){let d=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const X=this.va();if(N._geometry&&N._geometry.Ca(this),m.b.DeepCopy(N,this,["name","material","skeleton","instances","parent","uniqueId","source","metadata","morphTargetManager","hasInstances","worldMatrixInstancedBuffer","previousWorldMatrixInstancedBuffer","hasLODLevels","de","isBlocked","areNormalsFrozen","facetNb","isFacetDataEnabled","lightSources","useBones","isAnInstance","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","uj","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","cloneMeshMap","hasBoundingInfo","physicsBody","physicsImpostor"],["_poseMatrix"]),this._internalMeshDataInfo._source=N,X.useClonedMeshMap&&(N._internalMeshDataInfo.meshMap||(N._internalMeshDataInfo.meshMap={}),N._internalMeshDataInfo.meshMap[this.uniqueId]=this),this._originalBuilderSideOrientation=N._originalBuilderSideOrientation,this._creationDataStorage=N._creationDataStorage,N._ranges){const Z=N._ranges;for(const N in Z)Object.prototype.hasOwnProperty.call(Z,N)&&Z[N]&&this.createAnimationRange(N,Z[N].from,Z[N].to)}if(N.metadata&&N.metadata.clone?this.metadata=N.metadata.clone():this.metadata=N.metadata,this._internalMetadata=N._internalMetadata,z.e&&z.e.HasTags(N)&&z.e.AddTagsTo(this,z.e.GetTags(N,!0)),this.wg(N.isEnabled(!1)),this.parent=N.parent,this.setPivotMatrix(N.getPivotMatrix(),this._postMultiplyPivotMatrix),this.id=this.name+"."+N.id,this.material=N.material,!Z){const Z=N.getDescendants(!0);for(let N=0;N<Z.length;N++){const d=Z[N];d.clone&&d.clone(this.name+"."+d.name,this)}}if(N.morphTargetManager&&(this.morphTargetManager=N.morphTargetManager),X.getPhysicsEngine){const Z=X.getPhysicsEngine();if(d&&Z)if(1===Z.getPluginVersion()){const d=Z.getImpostorForPhysicsObject(N);d&&(this.physicsImpostor=d.clone(this))}else 2===Z.getPluginVersion()&&N.physicsBody&&N.physicsBody.clone(this)}for(let I=0;I<X.Od.length;I++){const Z=X.Od[I];Z.k===N&&Z.clone(Z.name,this)}this.skeleton=N.skeleton,this.refreshBoundingInfo(!0,!0),this.be(!0)}constructor(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,m=arguments.length>4?arguments[4]:void 0,z=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];super(N,Z),this._internalMeshDataInfo=new W,this.delayLoadState=0,this.instances=[],this._creationDataStorage=null,this._geometry=null,this._instanceDataStorage=new K,this._thinInstanceDataStorage=new P,this._shouldGenerateFlatShading=!1,this._originalBuilderSideOrientation=b.DEFAULTSIDE,this.ignoreCameraMaxZ=!1,Z=this.va(),this._scene.useRightHandedSystem?this.sideOrientation=0:this.sideOrientation=1,this._onBeforeDraw=(N,Z,d)=>{N&&d&&(this._uniformBuffer?this.transferToEffect(Z):d.bindOnlyWorldMatrix(Z))},I&&this._copySource(I,m,z),null!==d&&(this.parent=d),this._instanceDataStorage.hardwareInstancedRendering=this.getEngine().getCaps().instancedArrays,this._internalMeshDataInfo._onMeshReadyObserverAdded=N=>{N.unregisterOnNextCall=!0,this.isReady(!0)?this.onMeshReadyObservable.notifyObservers(this):this._internalMeshDataInfo._checkReadinessObserver||(this._internalMeshDataInfo._checkReadinessObserver=this._scene.onBeforeRenderObservable.add((()=>{this.isReady(!0)&&(this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),this._internalMeshDataInfo._checkReadinessObserver=null,this.onMeshReadyObservable.notifyObservers(this))})))},this.onMeshReadyObservable=new X.d(this._internalMeshDataInfo._onMeshReadyObserverAdded),I&&I.onClonedObservable.notifyObservers(this)}instantiateHierarchy(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,Z=arguments.length>1?arguments[1]:void 0,d=arguments.length>2?arguments[2]:void 0;const X=0===this.getTotalVertices()||Z&&Z.doNotInstantiate&&(!0===Z.doNotInstantiate||Z.doNotInstantiate(this))?this.clone("Clone of "+(this.name||this.id),N||this.parent,!0):this.eb("instance of "+(this.name||this.id));X.parent=N||this.parent,X.position=this.position.clone(),X.od=this.od.clone(),this.rotationQuaternion?X.rotationQuaternion=this.rotationQuaternion.clone():X.rotation=this.rotation.clone(),d&&d(this,X);for(const I of this.getChildTransformNodes(!0))"InstancedMesh"===I.getClassName()&&"Mesh"===X.getClassName()&&I.sourceMesh===this?I.instantiateHierarchy(X,{doNotInstantiate:Z&&Z.doNotInstantiate||!1,newSourcedMesh:X},d):I.instantiateHierarchy(X,Z,d);return X}getClassName(){return"Mesh"}get _isMesh(){return!0}toString(N){let Z=super.toString(N);if(Z+=", n vertices: "+this.getTotalVertices(),Z+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(let d=0;d<this.animations.length;d++)Z+=", animation[0]: "+this.animations[d].toString(N);if(N)if(this._geometry){const N=this.ge(),d=this.getVerticesData(D.d.PositionKind);d&&N&&(Z+=", flat shading: "+(d.length/3===N.length?"YES":"NO"))}else Z+=", flat shading: UNKNOWN";return Z}_unBindEffect(){super._unBindEffect();for(const N of this.instances)N._unBindEffect()}get hasLODLevels(){return this._internalMeshDataInfo._LODLevels.length>0}getLODLevels(){return this._internalMeshDataInfo._LODLevels}_sortLODLevels(){const N=this._internalMeshDataInfo._useLODScreenCoverage?-1:1;this._internalMeshDataInfo._LODLevels.sort(((Z,d)=>Z.distanceOrScreenCoverage<d.distanceOrScreenCoverage?N:Z.distanceOrScreenCoverage>d.distanceOrScreenCoverage?-N:0))}addLODLevel(N,Z){if(Z&&Z._masterMesh)return A.e.Warn("You cannot use a mesh as LOD level twice"),this;const d=new V(N,Z);return this._internalMeshDataInfo._LODLevels.push(d),Z&&(Z._masterMesh=this),this._sortLODLevels(),this}getLODLevelAtDistance(N){const Z=this._internalMeshDataInfo;for(let d=0;d<Z._LODLevels.length;d++){const X=Z._LODLevels[d];if(X.distanceOrScreenCoverage===N)return X.mesh}return null}removeLODLevel(N){const Z=this._internalMeshDataInfo;for(let d=0;d<Z._LODLevels.length;d++)Z._LODLevels[d].mesh===N&&(Z._LODLevels.splice(d,1),N&&(N._masterMesh=null));return this._sortLODLevels(),this}getLOD(N,Z){const d=this._internalMeshDataInfo;if(!d._LODLevels||0===d._LODLevels.length)return this;const X=Z||this.getBoundingInfo().boundingSphere,I=N.mode===S.e.ORTHOGRAPHIC_CAMERA?N.gj:X.centerWorld.rc(N.globalPosition).length();let m=I,z=1;if(d._useLODScreenCoverage){const Z=N.screenArea;let d=X.radiusWorld*N.gj/I;d=d*d*Math.PI,m=d/Z,z=-1}if(z*d._LODLevels[d._LODLevels.length-1].distanceOrScreenCoverage>z*m)return this.onLODLevelSelection&&this.onLODLevelSelection(m,this,this),this;for(let w=0;w<d._LODLevels.length;w++){const N=d._LODLevels[w];if(z*N.distanceOrScreenCoverage<z*m){if(N.mesh){if(4===N.mesh.delayLoadState)return N.mesh._checkDelayState(),this;if(2===N.mesh.delayLoadState)return this;N.mesh._preActivate(),N.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)}return this.onLODLevelSelection&&this.onLODLevelSelection(m,this,N.mesh),N.mesh}}return this.onLODLevelSelection&&this.onLODLevelSelection(m,this,this),this}get de(){return this._geometry}getTotalVertices(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()}getVerticesData(N,Z,d,X){var I,m;if(!this._geometry)return null;let z=X||null===(I=this._userInstancedBuffersStorage)||void 0===I||null===(m=I.vertexBuffers[N])||void 0===m?void 0:m.getFloatData(this.instances.length+1,d||Z&&1!==this._geometry.meshes.length);return z||(z=this._geometry.getVerticesData(N,Z,d)),z}copyVerticesData(N,Z){this._geometry&&this._geometry.copyVerticesData(N,Z)}getVertexBuffer(N,Z){var d;return this._geometry?(Z||null===(d=this._userInstancedBuffersStorage)||void 0===d?void 0:d.vertexBuffers[N])??this._geometry.getVertexBuffer(N):null}isVerticesDataPresent(N,Z){var d;return this._geometry?!Z&&void 0!==(null===(d=this._userInstancedBuffersStorage)||void 0===d?void 0:d.vertexBuffers[N])||this._geometry.isVerticesDataPresent(N):!!this._delayInfo&&-1!==this._delayInfo.indexOf(N)}isVertexBufferUpdatable(N,Z){if(!this._geometry)return!!this._delayInfo&&-1!==this._delayInfo.indexOf(N);if(!Z){var d;const Z=null===(d=this._userInstancedBuffersStorage)||void 0===d?void 0:d.vertexBuffers[N];if(Z)return Z.isUpdatable()}return this._geometry.isVertexBufferUpdatable(N)}getVerticesDataKinds(N){if(!this._geometry){const N=[];return this._delayInfo&&this._delayInfo.forEach((function(Z){N.push(Z)})),N}const Z=this._geometry.getVerticesDataKinds();if(!N&&this._userInstancedBuffersStorage)for(const d in this._userInstancedBuffersStorage.vertexBuffers)-1===Z.indexOf(d)&&Z.push(d);return Z}getTotalIndices(){return this._geometry?this._geometry.getTotalIndices():0}ge(N,Z){return this._geometry?this._geometry.ge(N,Z):[]}get isBlocked(){return null!==this._masterMesh&&void 0!==this._masterMesh}isReady(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(2===this.delayLoadState)return!1;if(!super.isReady(N))return!1;if(!this.Sd||0===this.Sd.length)return!0;if(!N)return!0;const d=this.getEngine(),X=this.va(),I=Z||d.getCaps().instancedArrays&&(this.instances.length>0||this.hasThinInstances);this.be();const m=this.material||X.defaultMaterial;if(m)if(m._storeEffectOnSubMeshes)for(const D of this.Sd){const N=D.Ha();if(N)if(N._storeEffectOnSubMeshes){if(!N.isReadyForSubMesh(this,D,I))return!1}else if(!N.isReady(this,I))return!1}else if(!m.isReady(this,I))return!1;const z=d.currentRenderPassId;for(const D of this.lightSources){const N=D.getShadowGenerators();if(!N)continue;const Z=N.values();for(let X=Z.next();!0!==X.done;X=Z.next()){var w,S,e,j;const N=X.value;if(N&&(null===(w=N.getShadowMap())||void 0===w||!w.renderList||null!==(S=N.getShadowMap())&&void 0!==S&&S.renderList&&-1!==(null===(e=N.getShadowMap())||void 0===e||null===(j=e.renderList)||void 0===j?void 0:j.indexOf(this)))){const Z=N.getShadowMap().renderPassIds??[d.currentRenderPassId];for(let X=0;X<Z.length;++X){d.currentRenderPassId=Z[X];for(const Z of this.Sd){var B;if(!N.isReady(Z,I,(null===(B=Z.Ha())||void 0===B?void 0:B.needAlphaBlendingForMesh(this))??!1))return d.currentRenderPassId=z,!1}}d.currentRenderPassId=z}}}for(const D of this._internalMeshDataInfo._LODLevels)if(D.mesh&&!D.mesh.isReady(I))return!1;return!0}get areNormalsFrozen(){return this._internalMeshDataInfo._areNormalsFrozen}di(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this}unfreezeNormals(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this}set overridenInstanceCount(N){this._instanceDataStorage.overridenInstanceCount=N}_preActivate(){const N=this._internalMeshDataInfo,Z=this.va().getRenderId();return N._preActivateId===Z||(N._preActivateId=Z,this._instanceDataStorage.visibleInstances=null),this}_preActivateForIntermediateRendering(N){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=N),this}_registerInstanceForRenderId(N,Z){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:Z,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[Z]||(void 0!==this._instanceDataStorage.previousRenderId&&this._instanceDataStorage.isFrozen&&(this._instanceDataStorage.visibleInstances[this._instanceDataStorage.previousRenderId]=null),this._instanceDataStorage.previousRenderId=Z,this._instanceDataStorage.visibleInstances[Z]=new Array),this._instanceDataStorage.visibleInstances[Z].push(N),this}_afterComputeWorldMatrix(){super._afterComputeWorldMatrix(),this.hasThinInstances&&(this.Da||this.thinInstanceRefreshBoundingInfo(!1))}_postActivate(){this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup&&(this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer),this.edgesRenderer.customInstances.push(this.getWorldMatrix()))}refreshBoundingInfo(){let N,Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;N="object"===typeof Z?Z:{applySkeleton:Z,applyMorph:d};const X=this.de?this.de.boundingBias:null;return this.Fa(this._getData(N,null,D.d.PositionKind),X),this}_createGlobalSubMesh(N){const Z=this.getTotalVertices();if(!Z||!this.ge())return null;if(this.Sd&&this.Sd.length>0){const d=this.ge();if(!d)return null;const X=d.length;let I=!1;if(N)I=!0;else for(const N of this.Sd){if(N.indexStart+N.indexCount>X){I=!0;break}if(N.verticesStart+N.verticesCount>Z){I=!0;break}}if(!I)return this.Sd[0]}return this.releaseSubMeshes(),new h.c(0,0,Z,0,this.getTotalIndices(),this)}subdivide(N){if(N<1)return;const Z=this.getTotalIndices();let d=Z/N|0,X=0;for(;d%3!==0;)d++;this.releaseSubMeshes();for(let I=0;I<N&&!(X>=Z);I++)h.c.CreateFromIndices(0,X,I===N-1?Z-X:d,this,void 0,!1),X+=d;this.refreshBoundingInfo(),this.synchronizeInstances()}Ga(N,Z){let d=arguments.length>2&&void 0!==arguments[2]&&arguments[2],X=arguments.length>3?arguments[3]:void 0;if(this._geometry)this._geometry.Ga(N,Z,d,X);else{const X=new v.c;X.set(Z,N);const I=this.va();new T.b(T.b.RandomId(),I,X,d,this)}return this}removeVerticesData(N){this._geometry&&this._geometry.removeVerticesData(N)}markVerticesDataAsUpdatable(N){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const d=this.getVertexBuffer(N);d&&d.isUpdatable()!==Z&&this.Ga(N,this.getVerticesData(N),Z)}setVerticesBuffer(N){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._geometry||(this._geometry=T.b.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(N,null,Z),this}updateVerticesData(N,Z,d,X){return this._geometry?(X?(this.makeGeometryUnique(),this.updateVerticesData(N,Z,d,!1)):this._geometry.updateVerticesData(N,Z,d),this):this}updateMeshPositions(N){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const d=this.getVerticesData(D.d.PositionKind);if(!d)return this;if(N(d),this.updateVerticesData(D.d.PositionKind,d,!1,!1),Z){const N=this.ge(),Z=this.getVerticesData(D.d.NormalKind);if(!Z)return this;v.c.ComputeNormals(d,N,Z),this.updateVerticesData(D.d.NormalKind,Z,!1,!1)}return this}makeGeometryUnique(){if(!this._geometry)return this;if(1===this._geometry.meshes.length)return this;const N=this._geometry,Z=this._geometry.j(T.b.RandomId());return N.releaseForMesh(this,!0),Z.Ca(this),this}setIndexBuffer(N,Z,d){let X=this._geometry;X||(X=new T.b(T.b.RandomId(),this.va(),void 0,void 0,this)),X.setIndexBuffer(N,Z,d)}setIndices(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,d=arguments.length>2&&void 0!==arguments[2]&&arguments[2],X=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this._geometry)this._geometry.setIndices(N,Z,d,X);else{const Z=new v.c;Z.indices=N;const X=this.va();new T.b(T.b.RandomId(),X,Z,d,this)}return this}updateIndices(N,Z){let d=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this._geometry?(this._geometry.updateIndices(N,Z,d),this):this}toLeftHanded(){return this._geometry?(this._geometry.toLeftHanded(),this):this}_bind(N,Z,d){let X=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!this._geometry)return this;const I=this.va().getEngine();let m;if(this._unIndexed)if(this._getRenderingFillMode(d)===U.e.WireFrameFillMode)m=N._getLinesIndexBuffer(this.ge(),I);else m=null;else switch(this._getRenderingFillMode(d)){case U.e.PointFillMode:m=null;break;case U.e.WireFrameFillMode:m=N._getLinesIndexBuffer(this.ge(),I);break;default:case U.e.TriangleFillMode:m=this._geometry.getIndexBuffer()}return this._bindDirect(Z,m,X)}_bindDirect(N,Z){let d=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this._geometry?(this.morphTargetManager&&this.morphTargetManager.isUsingTextureForTargets&&this.morphTargetManager._bind(N),d&&this._userInstancedBuffersStorage&&!this.hasThinInstances?this._geometry._bind(N,Z,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects):this._geometry._bind(N,Z),this):this}_draw(N,Z,d){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);const X=this.va().getEngine();return this._unIndexed&&Z!==U.e.WireFrameFillMode||Z==U.e.PointFillMode?X.drawArraysType(Z,N.verticesStart,N.verticesCount,this.forcedInstanceCount||d):Z==U.e.WireFrameFillMode?X.drawElementsType(Z,0,N._linesIndexCount,this.forcedInstanceCount||d):X.drawElementsType(Z,N.indexStart,N.indexCount,this.forcedInstanceCount||d),this}registerBeforeRender(N){return this.onBeforeRenderObservable.add(N),this}unregisterBeforeRender(N){return this.onBeforeRenderObservable.removeCallback(N),this}registerAfterRender(N){return this.onAfterRenderObservable.add(N),this}unregisterAfterRender(N){return this.onAfterRenderObservable.removeCallback(N),this}_getInstancesRenderList(N){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._instanceDataStorage.isFrozen){if(Z)return this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.hardwareInstancedRendering[N]=!1,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.renderSelf[N]=!0,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode;if(this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch}const d=this.va(),X=d._isInIntermediateRendering(),I=X?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,m=this._instanceDataStorage.batchCache;if(m.mustReturn=!1,m.renderSelf[N]=Z||!I&&this.isEnabled()&&this.isVisible,m.visibleInstances[N]=null,this._instanceDataStorage.visibleInstances&&!Z){const Z=this._instanceDataStorage.visibleInstances,I=d.getRenderId(),z=X?Z.intermediateDefaultRenderId:Z.defaultRenderId;m.visibleInstances[N]=Z[I],!m.visibleInstances[N]&&z&&(m.visibleInstances[N]=Z[z])}return m.hardwareInstancedRendering[N]=!Z&&this._instanceDataStorage.hardwareInstancedRendering&&null!==m.visibleInstances[N]&&void 0!==m.visibleInstances[N],this._instanceDataStorage.previousBatch=m,m}_renderWithInstances(N,Z,d,X,I){const m=d.visibleInstances[N._id],z=m?m.length:0,w=this._instanceDataStorage,S=w.instancesBufferSize;let j=w.instancesBuffer,B=w.instancesPreviousBuffer;const v=16*(z+1)*4;for(;w.instancesBufferSize<v;)w.instancesBufferSize*=2;w.instancesData&&S==w.instancesBufferSize||(w.instancesData=new Float32Array(w.instancesBufferSize/4)),(this._scene.needsPreviousWorldMatrices&&!w.instancesPreviousData||S!=w.instancesBufferSize)&&(w.instancesPreviousData=new Float32Array(w.instancesBufferSize/4));let T=0,k=0;const h=d.renderSelf[N._id],U=!j||S!==w.instancesBufferSize||this._scene.needsPreviousWorldMatrices&&!w.instancesPreviousBuffer;if(this._instanceDataStorage.manualUpdate||w.isFrozen&&!U)k=(h?1:0)+z;else{const Z=this.getWorldMatrix();if(h&&(this._scene.needsPreviousWorldMatrices&&(w.masterMeshPreviousWorldMatrix?(w.masterMeshPreviousWorldMatrix.copyToArray(w.instancesPreviousData,T),w.masterMeshPreviousWorldMatrix.p(Z)):(w.masterMeshPreviousWorldMatrix=Z.clone(),w.masterMeshPreviousWorldMatrix.copyToArray(w.instancesPreviousData,T))),Z.copyToArray(w.instancesData,T),T+=16,k++),m){var C;if(b.INSTANCEDMESH_SORT_TRANSPARENT&&this._scene.activeCamera&&null!==(C=N.Ha())&&void 0!==C&&C.needAlphaBlendingForMesh(N.getRenderingMesh())){const N=this._scene.activeCamera.globalPosition;for(let Z=0;Z<m.length;Z++){const d=m[Z];d._distanceToCamera=e.n.Distance(d.getBoundingInfo().boundingSphere.centerWorld,N)}m.sort(((N,Z)=>N._distanceToCamera>Z._distanceToCamera?-1:N._distanceToCamera<Z._distanceToCamera?1:0))}for(let N=0;N<m.length;N++){const Z=m[N],d=Z.getWorldMatrix();d.copyToArray(w.instancesData,T),this._scene.needsPreviousWorldMatrices&&(Z._previousWorldMatrix?(Z._previousWorldMatrix.copyToArray(w.instancesPreviousData,T),Z._previousWorldMatrix.p(d)):(Z._previousWorldMatrix=d.clone(),Z._previousWorldMatrix.copyToArray(w.instancesPreviousData,T))),T+=16,k++}}}return U?(j&&j.dispose(),B&&B.dispose(),j=new D.b(I,w.instancesData,!0,16,!1,!0),w.instancesBuffer=j,this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this._userInstancedBuffersStorage.vertexBuffers.world0=j.createVertexBuffer("world0",0,4),this._userInstancedBuffersStorage.vertexBuffers.world1=j.createVertexBuffer("world1",4,4),this._userInstancedBuffersStorage.vertexBuffers.world2=j.createVertexBuffer("world2",8,4),this._userInstancedBuffersStorage.vertexBuffers.world3=j.createVertexBuffer("world3",12,4),this._scene.needsPreviousWorldMatrices&&(B=new D.b(I,w.instancesPreviousData,!0,16,!1,!0),w.instancesPreviousBuffer=B,this._userInstancedBuffersStorage.vertexBuffers.previousWorld0=B.createVertexBuffer("previousWorld0",0,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld1=B.createVertexBuffer("previousWorld1",4,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld2=B.createVertexBuffer("previousWorld2",8,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld3=B.createVertexBuffer("previousWorld3",12,4)),this._invalidateInstanceVertexArrayObject()):this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||(j.updateDirectly(w.instancesData,0,k),!this._scene.needsPreviousWorldMatrices||this._instanceDataStorage.manualUpdate&&!this._instanceDataStorage.previousManualUpdate||B.updateDirectly(w.instancesPreviousData,0,k)),this._processInstancedBuffers(m,h),this.va()._activeIndices.addCount(N.indexCount*k,!1),I._currentDrawContext&&(I._currentDrawContext.useInstancing=!0),this._bind(N,X,Z),this._draw(N,Z,k),!this._scene.needsPreviousWorldMatrices||U||!this._instanceDataStorage.manualUpdate||this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||this._instanceDataStorage.previousManualUpdate||B.updateDirectly(w.instancesData,0,k),I.unbindInstanceAttributes(),this}_renderWithThinInstances(N,Z,d,X){var I;const m=(null===(I=this._thinInstanceDataStorage)||void 0===I?void 0:I.instancesCount)??0;this.va()._activeIndices.addCount(N.indexCount*m,!1),X._currentDrawContext&&(X._currentDrawContext.useInstancing=!0),this._bind(N,d,Z),this._draw(N,Z,m),this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&this._thinInstanceDataStorage.matrixData&&(this._thinInstanceDataStorage.previousMatrixBuffer?this._thinInstanceDataStorage.previousMatrixBuffer.updateDirectly(this._thinInstanceDataStorage.matrixData,0,m):this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.matrixData,!1)),X.unbindInstanceAttributes()}_processInstancedBuffers(N,Z){}_processRendering(N,Z,d,X,I,m,z,w){const S=this.va(),e=S.getEngine();if(X=this._getRenderingFillMode(X),m&&Z.getRenderingMesh().hasThinInstances)return this._renderWithThinInstances(Z,X,d,e),this;if(m)this._renderWithInstances(Z,X,I,d,e);else{e._currentDrawContext&&(e._currentDrawContext.useInstancing=!1);let d=0;I.renderSelf[Z._id]&&(z&&z(!1,N.getWorldMatrix(),w),d++,this._draw(Z,X,this._instanceDataStorage.overridenInstanceCount));const m=I.visibleInstances[Z._id];if(m){const N=m.length;d+=N;for(let d=0;d<N;d++){const N=m[d].getWorldMatrix();z&&z(!0,N,w),this._draw(Z,X)}}S._activeIndices.addCount(Z.indexCount*d,!1)}return this}_rebuild(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._instanceDataStorage.instancesBuffer&&(N&&this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),this._userInstancedBuffersStorage){for(const Z in this._userInstancedBuffersStorage.vertexBuffers){const d=this._userInstancedBuffersStorage.vertexBuffers[Z];d&&(N&&d.dispose(),this._userInstancedBuffersStorage.vertexBuffers[Z]=null)}this._userInstancedBuffersStorage.vertexArrayObjects&&(this._userInstancedBuffersStorage.vertexArrayObjects={})}this._internalMeshDataInfo._effectiveMaterial=null,super._rebuild(N)}_freeze(){if(this.Sd){for(let N=0;N<this.Sd.length;N++)this._getInstancesRenderList(N);this._internalMeshDataInfo._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}}_unFreeze(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null}renderWithRenderPassId(N,Z,d,X){let I=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const m=this._scene.getEngine(),z=m.currentRenderPassId;if(void 0!==N&&(m.currentRenderPassId=N),X)(!I||I&&X.isInFrustum(this._scene._frustumPlanes))&&this.render(X,!!Z,d);else for(let w=0;w<this.Sd.length;w++){const N=this.Sd[w];(!I||I&&N.isInFrustum(this._scene._frustumPlanes))&&this.render(N,!!Z,d)}return void 0!==N&&(m.currentRenderPassId=z),this}directRender(){if(!this.Sd)return this;for(const N of this.Sd)this.render(N,!1);return this}render(N,Z,d){var X,I,m;const z=this.va();this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1;const w=(null===(X=z.activeCameras)||void 0===X?void 0:X.length)??0;if((w>1&&z.activeCamera===z.activeCameras[0]||w<=1)&&this._checkOcclusionQuery()&&!this._occlusionDataStorage.forceRenderingWhenOccluded)return this;const S=this._getInstancesRenderList(N._id,!!d);if(S.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const e=z.getEngine();let j=0,B=null;this.ignoreCameraMaxZ&&z.activeCamera&&!z._isInIntermediateRendering()&&(j=z.activeCamera.maxZ,B=z.activeCamera,z.activeCamera.maxZ=0,z.updateTransformMatrix(!0)),this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);const D=N.getRenderingMesh(),v=S.hardwareInstancedRendering[N._id]||D.hasThinInstances||!!this._userInstancedBuffersStorage&&!N.getMesh()._internalAbstractMeshDataInfo._actAsRegularMesh,T=this._instanceDataStorage,k=N.Ha();if(!k)return B&&(B.maxZ=j,z.updateTransformMatrix(!0)),this;if(T.isFrozen&&this._internalMeshDataInfo._effectiveMaterial&&this._internalMeshDataInfo._effectiveMaterial===k){if(k._storeEffectOnSubMeshes&&(null===(I=N._drawWrapper)||void 0===I||!I._wasPreviouslyReady)||!k._storeEffectOnSubMeshes&&!k._getDrawWrapper()._wasPreviouslyReady)return B&&(B.maxZ=j,z.updateTransformMatrix(!0)),this}else{if(k._storeEffectOnSubMeshes){if(!k.isReadyForSubMesh(this,N,v))return B&&(B.maxZ=j,z.updateTransformMatrix(!0)),this}else if(!k.isReady(this,v))return B&&(B.maxZ=j,z.updateTransformMatrix(!0)),this;this._internalMeshDataInfo._effectiveMaterial=k}let h;Z&&e.setAlphaMode(this._internalMeshDataInfo._effectiveMaterial.alphaMode),h=this._internalMeshDataInfo._effectiveMaterial._storeEffectOnSubMeshes?N._drawWrapper:this._internalMeshDataInfo._effectiveMaterial._getDrawWrapper();const C=(null===(m=h)||void 0===m?void 0:m.effect)??null;for(const U of z._beforeRenderingMeshStage)U.action(this,N,S,C);if(!h||!C)return B&&(B.maxZ=j,z.updateTransformMatrix(!0)),this;const M=d||this;let Q;if(T.isFrozen||!this._internalMeshDataInfo._effectiveMaterial.ne&&null===this._internalMeshDataInfo._effectiveMaterial.sideOrientation&&!this._internalMeshDataInfo._effectiveMaterial.twoSidedLighting)Q=T.sideOrientation;else{const N=M._getWorldMatrixDeterminant();Q=this._internalMeshDataInfo._effectiveMaterial._getEffectiveOrientation(this),N<0&&(Q=Q===U.e.ClockWiseSideOrientation?U.e.CounterClockWiseSideOrientation:U.e.ClockWiseSideOrientation),T.sideOrientation=Q}const A=this._internalMeshDataInfo._effectiveMaterial._preBind(h,Q);this._internalMeshDataInfo._effectiveMaterial.forceDepthWrite&&e.setDepthWrite(!0);const n=this._internalMeshDataInfo._effectiveMaterial,g=n.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),v||this._bind(N,C,g,!1);const E=M.getWorldMatrix();n._storeEffectOnSubMeshes?n.bindForSubMesh(E,this,N):n.bind(E,this),!n.ne&&n.separateCullingPass&&(e.setState(!0,n.zOffset,!1,!A,n.cullBackFaces,n.stencil,n.zOffsetUnits),this._processRendering(this,N,C,g,S,v,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),e.setState(!0,n.zOffset,!1,A,n.cullBackFaces,n.stencil,n.zOffsetUnits),this._internalMeshDataInfo._onBetweenPassObservable&&this._internalMeshDataInfo._onBetweenPassObservable.notifyObservers(N)),this._processRendering(this,N,C,g,S,v,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),this._internalMeshDataInfo._effectiveMaterial.unbind();for(const U of z._afterRenderingMeshStage)U.action(this,N,S,C);return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),B&&(B.maxZ=j,z.updateTransformMatrix(!0)),2!==z.performancePriority||T.isFrozen||this._freeze(),this}cleanMatrixWeights(){this.isVerticesDataPresent(D.d.MatricesWeightsKind)&&(this.isVerticesDataPresent(D.d.MatricesWeightsExtraKind)?this._normalizeSkinWeightsAndExtra():this._normalizeSkinFourWeights())}_normalizeSkinFourWeights(){const N=this.getVerticesData(D.d.MatricesWeightsKind),Z=N.length;for(let d=0;d<Z;d+=4){const Z=N[d]+N[d+1]+N[d+2]+N[d+3];if(0===Z)N[d]=1;else{const X=1/Z;N[d]*=X,N[d+1]*=X,N[d+2]*=X,N[d+3]*=X}}this.Ga(D.d.MatricesWeightsKind,N)}_normalizeSkinWeightsAndExtra(){const N=this.getVerticesData(D.d.MatricesWeightsExtraKind),Z=this.getVerticesData(D.d.MatricesWeightsKind),d=Z.length;for(let X=0;X<d;X+=4){let d=Z[X]+Z[X+1]+Z[X+2]+Z[X+3];if(d+=N[X]+N[X+1]+N[X+2]+N[X+3],0===d)Z[X]=1;else{const I=1/d;Z[X]*=I,Z[X+1]*=I,Z[X+2]*=I,Z[X+3]*=I,N[X]*=I,N[X+1]*=I,N[X+2]*=I,N[X+3]*=I}}this.Ga(D.d.MatricesWeightsKind,Z),this.Ga(D.d.MatricesWeightsKind,N)}validateSkinning(){const N=this.getVerticesData(D.d.MatricesWeightsExtraKind),Z=this.getVerticesData(D.d.MatricesWeightsKind);if(null===Z||null==this.skeleton)return{skinned:!1,valid:!0,qd:"not skinned"};const d=Z.length;let X=0,I=0,m=0,z=0;const w=null===N?4:8,S=[];for(let D=0;D<=w;D++)S[D]=0;for(let D=0;D<d;D+=4){let d=Z[D],e=d,j=0===e?0:1;for(let I=1;I<w;I++){const m=I<4?Z[D+I]:N[D+I-4];m>d&&X++,0!==m&&j++,e+=m,d=m}if(S[j]++,j>m&&(m=j),0===e)I++;else{const d=1/e;let X=0;for(let I=0;I<w;I++)X+=I<4?Math.abs(Z[D+I]-Z[D+I]*d):Math.abs(N[D+I-4]-N[D+I-4]*d);X>.001&&z++}}const e=this.skeleton.bones.length,j=this.getVerticesData(D.d.MatricesIndicesKind),B=this.getVerticesData(D.d.MatricesIndicesExtraKind);let v=0;for(let D=0;D<d;D+=4)for(let N=0;N<w;N++){const Z=N<4?j[D+N]:B[D+N-4];(Z>=e||Z<0)&&v++}return{skinned:!0,valid:0===I&&0===z&&0===v,qd:"Number of Weights = "+d/4+"\nMaximum influences = "+m+"\nMissing Weights = "+I+"\nNot Sorted = "+X+"\nNot Normalized = "+z+"\nWeightCounts = ["+S+"]\nNumber of bones = "+e+"\nBad Bone Indices = "+v}}_checkDelayState(){const N=this.va();return this._geometry?this._geometry.load(N):4===this.delayLoadState&&(this.delayLoadState=2,this._queueLoad(N)),this}_queueLoad(N){N.addPendingData(this);const Z=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return I.g.LoadFile(this.delayLoadingFile,(Z=>{Z instanceof ArrayBuffer?this._delayLoadingFunction(Z,this):this._delayLoadingFunction(JSON.parse(Z),this),this.instances.forEach((N=>{N.refreshBoundingInfo(),N._syncSubMeshes()})),this.delayLoadState=1,N.removePendingData(this)}),(()=>{}),N.offlineProvider,Z),this}isInFrustum(N){return 2!==this.delayLoadState&&(!!super.isInFrustum(N)&&(this._checkDelayState(),!0))}setMaterialById(N){const Z=this.va().materials;let d;for(d=Z.length-1;d>-1;d--)if(Z[d].id===N)return this.material=Z[d],this;const X=this.va().multiMaterials;for(d=X.length-1;d>-1;d--)if(X[d].id===N)return this.material=X[d],this;return this}getAnimatables(){const N=[];return this.material&&N.push(this.material),this.skeleton&&N.push(this.skeleton),N}bakeTransformIntoVertices(N){if(!this.isVerticesDataPresent(D.d.PositionKind))return this;const Z=this.Sd.splice(0);this._resetPointsArrayCache();let d=this.getVerticesData(D.d.PositionKind);const X=e.n.Zero();let I;for(I=0;I<d.length;I+=3)e.n.TransformCoordinatesFromFloatsToRef(d[I],d[I+1],d[I+2],N,X).toArray(d,I);if(this.Ga(D.d.PositionKind,d,this.getVertexBuffer(D.d.PositionKind).isUpdatable()),this.isVerticesDataPresent(D.d.NormalKind)){for(d=this.getVerticesData(D.d.NormalKind),I=0;I<d.length;I+=3)e.n.TransformNormalFromFloatsToRef(d[I],d[I+1],d[I+2],N,X).normalize().toArray(d,I);this.Ga(D.d.NormalKind,d,this.getVertexBuffer(D.d.NormalKind).isUpdatable())}if(this.isVerticesDataPresent(D.d.TangentKind)){for(d=this.getVerticesData(D.d.TangentKind),I=0;I<d.length;I+=4)e.n.TransformNormalFromFloatsToRef(d[I],d[I+1],d[I+2],N,X).normalize().toArray(d,I);this.Ga(D.d.TangentKind,d,this.getVertexBuffer(D.d.TangentKind).isUpdatable())}return N.determinant()<0&&this.flipFaces(),this.releaseSubMeshes(),this.Sd=Z,this}bakeCurrentTransformIntoVertices(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.bakeTransformIntoVertices(this.be(!0)),this.resetLocalMatrix(N),this}get _positions(){return this._internalAbstractMeshDataInfo._positions||this._geometry&&this._geometry._positions||null}_resetPointsArrayCache(){return this._geometry&&this._geometry._resetPointsArrayCache(),this}_generatePointsArray(){return!!this._geometry&&this._geometry._generatePointsArray()}clone(){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Z=arguments.length>2?arguments[2]:void 0,d=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return new b(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",this.va(),N,this,Z,d)}dispose(N){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);const d=this._internalMeshDataInfo;if(d._onBeforeDrawObservable&&d._onBeforeDrawObservable.clear(),d._onBeforeBindObservable&&d._onBeforeBindObservable.clear(),d._onBeforeRenderObservable&&d._onBeforeRenderObservable.clear(),d._onAfterRenderObservable&&d._onAfterRenderObservable.clear(),d._onBetweenPassObservable&&d._onBetweenPassObservable.clear(),this._scene.useClonedMeshMap){if(d.meshMap)for(const N in d.meshMap){const Z=d.meshMap[N];Z&&(Z._internalMeshDataInfo._source=null,d.meshMap[N]=void 0)}d._source&&d._source._internalMeshDataInfo.meshMap&&(d._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else{const N=this.va().meshes;for(const Z of N){const N=Z;N._internalMeshDataInfo&&N._internalMeshDataInfo._source&&N._internalMeshDataInfo._source===this&&(N._internalMeshDataInfo._source=null)}}d._source=null,this._instanceDataStorage.visibleInstances={},this._disposeInstanceSpecificData(),this._disposeThinInstanceSpecificData(),this._internalMeshDataInfo._checkReadinessObserver&&this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),super.dispose(N,Z)}_disposeInstanceSpecificData(){}_disposeThinInstanceSpecificData(){}_invalidateInstanceVertexArrayObject(){}applyDisplacementMap(N,Z,d,X,m,z){let w=arguments.length>6&&void 0!==arguments[6]&&arguments[6],S=arguments.length>7?arguments[7]:void 0;const e=this.va();return I.g.LoadImage(N,(N=>{const I=N.width,S=N.height,e=this.getEngine().createCanvas(I,S).getContext("2d");e.drawImage(N,0,0);const j=e.getImageData(0,0,I,S).data;this.applyDisplacementMapFromBuffer(j,I,S,Z,d,m,z,w),X&&X(this)}),S||(()=>{}),e.offlineProvider),this}applyDisplacementMapFromBuffer(N,Z,d,X,I,m,z){let w=arguments.length>7&&void 0!==arguments[7]&&arguments[7];if(!this.isVerticesDataPresent(D.d.PositionKind)||!this.isVerticesDataPresent(D.d.NormalKind)||!this.isVerticesDataPresent(D.d.UVKind))return A.e.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;const S=this.getVerticesData(D.d.PositionKind,!0,!0),j=this.getVerticesData(D.d.NormalKind),B=this.getVerticesData(D.d.UVKind);let T=e.n.Zero();const k=e.n.Zero(),h=e.l.Zero();m=m||e.l.Zero(),z=z||new e.l(1,1);for(let D=0;D<S.length;D+=3){e.n.FromArrayToRef(S,D,T),e.n.FromArrayToRef(j,D,k),e.l.FromArrayToRef(B,D/3*2,h);const w=4*((Math.abs(h.x*z.x+m.x%1)*(Z-1)%Z|0)+(Math.abs(h.y*z.y+m.y%1)*(d-1)%d|0)*Z),v=.3*(N[w]/255)+.59*(N[w+1]/255)+.11*(N[w+2]/255);k.normalize(),k.scaleInPlace(X+(I-X)*v),T=T.add(k),T.toArray(S,D)}return v.c.ComputeNormals(S,this.ge(),j),w?(this.Ga(D.d.PositionKind,S),this.Ga(D.d.NormalKind,j),this.Ga(D.d.UVKind,B)):(this.updateVerticesData(D.d.PositionKind,S),this.updateVerticesData(D.d.NormalKind,j)),this}_getFlattenedNormals(N,Z){const d=new Float32Array(3*N.length);let X=0;const I=this.sideOrientation===(this._scene.useRightHandedSystem?1:0);for(let m=0;m<N.length;m+=3){const z=e.n._c(Z,3*N[m]),w=e.n._c(Z,3*N[m+1]),S=e.n._c(Z,3*N[m+2]),j=z.rc(w),B=S.rc(w),D=e.n.Normalize(e.n.Cross(j,B));I&&D.scaleInPlace(-1);for(let N=0;N<3;N++)d[X++]=D.x,d[X++]=D.y,d[X++]=D.z}return d}_convertToUnIndexedMesh(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const Z=this.getVerticesDataKinds().filter((N=>{var Z;return!(null!==(Z=this.getVertexBuffer(N))&&void 0!==Z&&Z.getIsInstanced())})),d=this.ge(),X={},I=(N,Z)=>{const X=new Float32Array(d.length*Z);let I=0;for(let m=0;m<d.length;m++)for(let z=0;z<Z;z++)X[I++]=N[d[m]*Z+z];return X},m=this.getBoundingInfo(),z=this.de?this.Sd.slice(0):[];for(const w of Z)X[w]=this.getVerticesData(w);for(const w of Z){const Z=this.getVertexBuffer(w),m=Z.getSize();if(N&&w===D.d.NormalKind){const N=this._getFlattenedNormals(d,X[D.d.PositionKind]);this.Ga(D.d.NormalKind,N,Z.isUpdatable(),m)}else this.Ga(w,I(X[w],m),Z.isUpdatable(),m)}if(this.morphTargetManager){for(let Z=0;Z<this.morphTargetManager.numTargets;Z++){const X=this.morphTargetManager.getTarget(Z),m=X.getPositions();X.setPositions(I(m,3));const z=X.getNormals();z&&X.setNormals(N?this._getFlattenedNormals(d,m):I(z,3));const w=X.getTangents();w&&X.setTangents(I(w,3));const S=X.getUVs();S&&X.setUVs(I(S,2))}this.morphTargetManager.synchronize()}for(let w=0;w<d.length;w++)d[w]=w;this.setIndices(d),this._unIndexed=!0,this.releaseSubMeshes();for(const w of z){const N=w.getBoundingInfo();h.c.AddToMesh(w.materialIndex,w.indexStart,w.indexCount,w.indexStart,w.indexCount,this).setBoundingInfo(N)}return this.setBoundingInfo(m),this.synchronizeInstances(),this}convertToFlatShadedMesh(){return this._convertToUnIndexedMesh(!0)}convertToUnIndexedMesh(){return this._convertToUnIndexedMesh()}flipFaces(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const Z=v.c.ExtractFromMesh(this);let d;if(N&&this.isVerticesDataPresent(D.d.NormalKind)&&Z.ya){for(d=0;d<Z.ya.length;d++)Z.ya[d]*=-1;this.Ga(D.d.NormalKind,Z.ya,this.isVertexBufferUpdatable(D.d.NormalKind))}if(Z.indices){let N;for(d=0;d<Z.indices.length;d+=3)N=Z.indices[d+1],Z.indices[d+1]=Z.indices[d+2],Z.indices[d+2]=N;this.setIndices(Z.indices,null,this.isVertexBufferUpdatable(D.d.PositionKind),!0)}return this}increaseVertices(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const Z=v.c.ExtractFromMesh(this),d=Z.indices&&!Array.isArray(Z.indices)&&Array.from?Array.from(Z.indices):Z.indices,X=Z.xa&&!Array.isArray(Z.xa)&&Array.from?Array.from(Z.xa):Z.xa,I=Z.Aa&&!Array.isArray(Z.Aa)&&Array.from?Array.from(Z.Aa):Z.Aa,m=Z.ya&&!Array.isArray(Z.ya)&&Array.from?Array.from(Z.ya):Z.ya;if(d&&X){Z.indices=d,Z.xa=X,I&&(Z.Aa=I),m&&(Z.ya=m);const z=N+1,w=new Array;for(let N=0;N<z+1;N++)w[N]=new Array;let S,j;const B=new e.n(0,0,0),v=new e.n(0,0,0),T=new e.l(0,0),k=new Array,h=new Array,U=new Array;let C,M,Q,A=X.length;I&&(M=I.length),m&&(Q=m.length);for(let N=0;N<d.length;N+=3){h[0]=d[N],h[1]=d[N+1],h[2]=d[N+2];for(let N=0;N<3;N++)if(S=h[N],j=h[(N+1)%3],void 0===U[S]&&void 0===U[j]?(U[S]=new Array,U[j]=new Array):(void 0===U[S]&&(U[S]=new Array),void 0===U[j]&&(U[j]=new Array)),void 0===U[S][j]&&void 0===U[j][S]){U[S][j]=[],B.x=(X[3*j]-X[3*S])/z,B.y=(X[3*j+1]-X[3*S+1])/z,B.z=(X[3*j+2]-X[3*S+2])/z,m&&(v.x=(m[3*j]-m[3*S])/z,v.y=(m[3*j+1]-m[3*S+1])/z,v.z=(m[3*j+2]-m[3*S+2])/z),I&&(T.x=(I[2*j]-I[2*S])/z,T.y=(I[2*j+1]-I[2*S+1])/z),U[S][j].push(S);for(let N=1;N<z;N++)U[S][j].push(X.length/3),X[A++]=X[3*S]+N*B.x,X[A++]=X[3*S+1]+N*B.y,X[A++]=X[3*S+2]+N*B.z,m&&(m[Q++]=m[3*S]+N*v.x,m[Q++]=m[3*S+1]+N*v.y,m[Q++]=m[3*S+2]+N*v.z),I&&(I[M++]=I[2*S]+N*T.x,I[M++]=I[2*S+1]+N*T.y);U[S][j].push(j),U[j][S]=new Array,C=U[S][j].length;for(let N=0;N<C;N++)U[j][S][N]=U[S][j][C-1-N]}w[0][0]=d[N],w[1][0]=U[d[N]][d[N+1]][1],w[1][1]=U[d[N]][d[N+2]][1];for(let Z=2;Z<z;Z++){w[Z][0]=U[d[N]][d[N+1]][Z],w[Z][Z]=U[d[N]][d[N+2]][Z],B.x=(X[3*w[Z][Z]]-X[3*w[Z][0]])/Z,B.y=(X[3*w[Z][Z]+1]-X[3*w[Z][0]+1])/Z,B.z=(X[3*w[Z][Z]+2]-X[3*w[Z][0]+2])/Z,m&&(v.x=(m[3*w[Z][Z]]-m[3*w[Z][0]])/Z,v.y=(m[3*w[Z][Z]+1]-m[3*w[Z][0]+1])/Z,v.z=(m[3*w[Z][Z]+2]-m[3*w[Z][0]+2])/Z),I&&(T.x=(I[2*w[Z][Z]]-I[2*w[Z][0]])/Z,T.y=(I[2*w[Z][Z]+1]-I[2*w[Z][0]+1])/Z);for(let N=1;N<Z;N++)w[Z][N]=X.length/3,X[A++]=X[3*w[Z][0]]+N*B.x,X[A++]=X[3*w[Z][0]+1]+N*B.y,X[A++]=X[3*w[Z][0]+2]+N*B.z,m&&(m[Q++]=m[3*w[Z][0]]+N*v.x,m[Q++]=m[3*w[Z][0]+1]+N*v.y,m[Q++]=m[3*w[Z][0]+2]+N*v.z),I&&(I[M++]=I[2*w[Z][0]]+N*T.x,I[M++]=I[2*w[Z][0]+1]+N*T.y)}w[z]=U[d[N+1]][d[N+2]],k.push(w[0][0],w[1][0],w[1][1]);for(let N=1;N<z;N++){let Z;for(Z=0;Z<N;Z++)k.push(w[N][Z],w[N+1][Z],w[N+1][Z+1]),k.push(w[N][Z],w[N+1][Z+1],w[N][Z+1]);k.push(w[N][Z],w[N+1][Z],w[N+1][Z+1])}}Z.indices=k,Z.Ca(this,this.isVertexBufferUpdatable(D.d.PositionKind))}else A.e.Warn("Couldn't increase number of vertices : VertexData must contain at least indices and positions")}forceSharedVertices(){const N=v.c.ExtractFromMesh(this),Z=N.Aa,d=N.indices,X=N.xa,I=N.za,m=N.matricesIndices,z=N.matricesWeights,w=N.matricesIndicesExtra,S=N.matricesWeightsExtra;if(void 0===d||void 0===X||null===d||null===X)A.e.Warn("VertexData contains empty entries");else{const e=new Array,j=new Array,B=new Array,T=new Array,k=new Array,h=new Array,U=new Array,C=new Array;let M=new Array,Q=0;const A={};let n,g;for(let N=0;N<d.length;N+=3){g=[d[N],d[N+1],d[N+2]],M=[];for(let N=0;N<3;N++){M[N]="";for(let Z=0;Z<3;Z++)Math.abs(X[3*g[N]+Z])<1e-8&&(X[3*g[N]+Z]=0),M[N]+=X[3*g[N]+Z]+"|"}if(M[0]!=M[1]&&M[0]!=M[2]&&M[1]!=M[2])for(let N=0;N<3;N++){if(n=A[M[N]],void 0===n){A[M[N]]=Q,n=Q++;for(let Z=0;Z<3;Z++)e.push(X[3*g[N]+Z]);if(null!==I&&void 0!==I)for(let Z=0;Z<4;Z++)T.push(I[4*g[N]+Z]);if(null!==Z&&void 0!==Z)for(let d=0;d<2;d++)B.push(Z[2*g[N]+d]);if(null!==m&&void 0!==m)for(let Z=0;Z<4;Z++)k.push(m[4*g[N]+Z]);if(null!==z&&void 0!==z)for(let Z=0;Z<4;Z++)h.push(z[4*g[N]+Z]);if(null!==w&&void 0!==w)for(let Z=0;Z<4;Z++)U.push(w[4*g[N]+Z]);if(null!==S&&void 0!==S)for(let Z=0;Z<4;Z++)C.push(S[4*g[N]+Z])}j.push(n)}}const E=new Array;v.c.ComputeNormals(e,j,E),N.xa=e,N.indices=j,N.ya=E,null!==Z&&void 0!==Z&&(N.Aa=B),null!==I&&void 0!==I&&(N.za=T),null!==m&&void 0!==m&&(N.matricesIndices=k),null!==z&&void 0!==z&&(N.matricesWeights=h),null!==w&&void 0!==w&&(N.matricesIndicesExtra=U),null!==z&&void 0!==z&&(N.matricesWeightsExtra=C),N.Ca(this,this.isVertexBufferUpdatable(D.d.PositionKind))}}static _instancedMeshFactory(N,Z){throw(0,g.b)("InstancedMesh")}static _PhysicsImpostorParser(N,Z,d){throw(0,g.b)("PhysicsImpostor")}eb(N){const Z=b._instancedMeshFactory(N,this);return Z.parent=this.parent,Z}synchronizeInstances(){for(let N=0;N<this.instances.length;N++){this.instances[N]._syncSubMeshes()}return this}optimizeIndices(N){const Z=this.ge(),d=this.getVerticesData(D.d.PositionKind);if(!d||!Z)return this;const X=[];for(let I=0;I<d.length;I+=3)X.push(e.n._c(d,I));const m=[];return I.c.SyncAsyncForLoop(X.length,40,(N=>{const Z=X.length-1-N,d=X[Z];for(let I=0;I<Z;++I){const N=X[I];if(d.equals(N)){m[Z]=I;break}}}),(()=>{for(let N=0;N<Z.length;++N)Z[N]=m[Z[N]]||Z[N];const d=this.Sd.slice(0);this.setIndices(Z),this.Sd=d,N&&N(this)})),this}serialize(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};N.name=this.name,N.id=this.id,N.uniqueId=this.uniqueId,N.type=this.getClassName(),z.e&&z.e.HasTags(this)&&(N.tags=z.e.GetTags(this)),N.position=this.position.ed(),this.rotationQuaternion?N.rotationQuaternion=this.rotationQuaternion.ed():this.rotation&&(N.rotation=this.rotation.ed()),N.od=this.od.ed(),this._postMultiplyPivotMatrix?N.pivotMatrix=this.getPivotMatrix().ed():N.localMatrix=this.getPivotMatrix().ed(),N.isEnabled=this.isEnabled(!1),N.isVisible=this.isVisible,N.infiniteDistance=this.infiniteDistance,N.pickable=this.Fd,N.receiveShadows=this.receiveShadows,N.billboardMode=this.billboardMode,N.visibility=this.visibility,N.ce=this.ce,N.checkCollisions=this.checkCollisions,N.ellipsoid=this.ellipsoid.ed(),N.ellipsoidOffset=this.ellipsoidOffset.ed(),N.Da=this.Da,N.isBlocker=this.isBlocker,N.sideOrientation=this.sideOrientation,this.parent&&this.parent._serializeAsParent(N),N.isUnIndexed=this.isUnIndexed;const Z=this._geometry;if(Z&&this.Sd){N.geometryUniqueId=Z.uniqueId,N.geometryId=Z.id,N.Sd=[];for(let Z=0;Z<this.Sd.length;Z++){const d=this.Sd[Z];N.Sd.push({materialIndex:d.materialIndex,verticesStart:d.verticesStart,verticesCount:d.verticesCount,indexStart:d.indexStart,indexCount:d.indexCount})}}if(this.material?this.material.doNotSerialize||(N.materialUniqueId=this.material.uniqueId,N.materialId=this.material.id):(this.material=null,N.materialUniqueId=this._scene.defaultMaterial.uniqueId,N.materialId=this._scene.defaultMaterial.id),this.morphTargetManager&&(N.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(N.skeletonId=this.skeleton.id,N.numBoneInfluencers=this.numBoneInfluencers),this.va()._getComponent(E.e.NAME_PHYSICSENGINE)){const Z=this.getPhysicsImpostor();Z&&(N.physicsMass=Z.getParam("mass"),N.physicsFriction=Z.getParam("friction"),N.physicsRestitution=Z.getParam("mass"),N.physicsImpostor=Z.type)}this.metadata&&(N.metadata=this.metadata),N.instances=[];for(let d=0;d<this.instances.length;d++){const Z=this.instances[d];if(Z.doNotSerialize)continue;const X={name:Z.name,id:Z.id,isEnabled:Z.isEnabled(!1),isVisible:Z.isVisible,Fd:Z.Fd,checkCollisions:Z.checkCollisions,position:Z.position.ed(),od:Z.od.ed()};if(Z.parent&&Z.parent._serializeAsParent(X),Z.rotationQuaternion?X.rotationQuaternion=Z.rotationQuaternion.ed():Z.rotation&&(X.rotation=Z.rotation.ed()),this.va()._getComponent(E.e.NAME_PHYSICSENGINE)){const N=Z.getPhysicsImpostor();N&&(X.physicsMass=N.getParam("mass"),X.physicsFriction=N.getParam("friction"),X.physicsRestitution=N.getParam("mass"),X.physicsImpostor=N.type)}Z.metadata&&(X.metadata=Z.metadata),Z.actionManager&&(X.actions=Z.actionManager.serialize(Z.name)),N.instances.push(X),Q.c.AppendSerializedAnimations(Z,X),X.ranges=Z.serializeAnimationRanges()}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData&&(N.thinInstances={instancesCount:this._thinInstanceDataStorage.instancesCount,matrixData:Array.from(this._thinInstanceDataStorage.matrixData),matrixBufferSize:this._thinInstanceDataStorage.matrixBufferSize,enablePicking:this.thinInstanceEnablePicking},this._userThinInstanceBuffersStorage)){const Z={data:{},sizes:{},strides:{}};for(const N in this._userThinInstanceBuffersStorage.data)Z.data[N]=Array.from(this._userThinInstanceBuffersStorage.data[N]),Z.sizes[N]=this._userThinInstanceBuffersStorage.sizes[N],Z.strides[N]=this._userThinInstanceBuffersStorage.strides[N];N.thinInstances.userThinInstance=Z}return Q.c.AppendSerializedAnimations(this,N),N.ranges=this.serializeAnimationRanges(),N.layerMask=this.layerMask,N.alphaIndex=this.alphaIndex,N.hasVertexAlpha=this.hasVertexAlpha,N.overlayAlpha=this.overlayAlpha,N.overlayColor=this.overlayColor.ed(),N.renderOverlay=this.renderOverlay,N.applyFog=this.applyFog,this.actionManager&&(N.actions=this.actionManager.serialize(this.name)),N}_syncGeometryWithMorphTargetManager(){if(!this.de)return;this._markSubMeshesAsAttributesDirty();const N=this._internalAbstractMeshDataInfo._morphTargetManager;if(N&&N.vertexCount){if(N.vertexCount!==this.getTotalVertices())return A.e.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);if(N.isUsingTextureForTargets)return;for(let Z=0;Z<N.numInfluencers;Z++){const d=N.getActiveTarget(Z),X=d.getPositions();if(!X)return void A.e.Error("Invalid morph target. Target must have positions.");this.de.Ga(D.d.PositionKind+Z,X,!1,3);const I=d.getNormals();I&&this.de.Ga(D.d.NormalKind+Z,I,!1,3);const m=d.getTangents();m&&this.de.Ga(D.d.TangentKind+Z,m,!1,3);const z=d.getUVs();z&&this.de.Ga(D.d.UVKind+"_"+Z,z,!1,2)}}else{let N=0;for(;this.de.isVerticesDataPresent(D.d.PositionKind+N);)this.de.removeVerticesData(D.d.PositionKind+N),this.de.isVerticesDataPresent(D.d.NormalKind+N)&&this.de.removeVerticesData(D.d.NormalKind+N),this.de.isVerticesDataPresent(D.d.TangentKind+N)&&this.de.removeVerticesData(D.d.TangentKind+N),this.de.isVerticesDataPresent(D.d.UVKind+N)&&this.de.removeVerticesData(D.d.UVKind+"_"+N),N++}}static Parse(N,Z,d){let X;if(X=N.type&&"LinesMesh"===N.type?b._LinesMeshParser(N,Z):N.type&&"GroundMesh"===N.type?b._GroundMeshParser(N,Z):N.type&&"GoldbergMesh"===N.type?b._GoldbergMeshParser(N,Z):N.type&&"GreasedLineMesh"===N.type?b._GreasedLineMeshParser(N,Z):N.type&&"TrailMesh"===N.type?b._TrailMeshParser(N,Z):new b(N.name,Z),X.id=N.id,X._waitingParsedUniqueId=N.uniqueId,z.e&&z.e.AddTagsTo(X,N.tags),X.position=e.n._c(N.position),void 0!==N.metadata&&(X.metadata=N.metadata),N.rotationQuaternion?X.rotationQuaternion=e.g._c(N.rotationQuaternion):N.rotation&&(X.rotation=e.n._c(N.rotation)),X.od=e.n._c(N.od),N.localMatrix?X.setPreTransformMatrix(e.c._c(N.localMatrix)):N.pivotMatrix&&X.setPivotMatrix(e.c._c(N.pivotMatrix)),X.wg(N.isEnabled),X.isVisible=N.isVisible,X.infiniteDistance=N.infiniteDistance,X.ce=!!N.ce,X.showBoundingBox=N.showBoundingBox,X.showSubMeshesBoundingBox=N.showSubMeshesBoundingBox,void 0!==N.applyFog&&(X.applyFog=N.applyFog),void 0!==N.pickable&&(X.Fd=N.pickable),void 0!==N.alphaIndex&&(X.alphaIndex=N.alphaIndex),X.receiveShadows=N.receiveShadows,void 0!==N.billboardMode&&(X.billboardMode=N.billboardMode),void 0!==N.visibility&&(X.visibility=N.visibility),X.checkCollisions=N.checkCollisions,X.Da=!!N.Da,N.ellipsoid&&(X.ellipsoid=e.n._c(N.ellipsoid)),N.ellipsoidOffset&&(X.ellipsoidOffset=e.n._c(N.ellipsoidOffset)),null!=N.overrideMaterialSideOrientation&&(X.sideOrientation=N.overrideMaterialSideOrientation),void 0!==N.sideOrientation&&(X.sideOrientation=N.sideOrientation),void 0!==N.isBlocker&&(X.isBlocker=N.isBlocker),X._shouldGenerateFlatShading=N.useFlatShading,N.fi&&(X._waitingData.fi=N.fi),void 0!==N.parentId&&(X._waitingParentId=N.parentId),void 0!==N.parentInstanceIndex&&(X._waitingParentInstanceIndex=N.parentInstanceIndex),void 0!==N.actions&&(X._waitingData.actions=N.actions),void 0!==N.overlayAlpha&&(X.overlayAlpha=N.overlayAlpha),void 0!==N.overlayColor&&(X.overlayColor=j.b._c(N.overlayColor)),void 0!==N.renderOverlay&&(X.renderOverlay=N.renderOverlay),X.isUnIndexed=!!N.isUnIndexed,X.hasVertexAlpha=N.hasVertexAlpha,N.delayLoadingFile?(X.delayLoadState=4,X.delayLoadingFile=d+N.delayLoadingFile,X.buildBoundingInfo(e.n._c(N.boundingBoxMinimum),e.n._c(N.boundingBoxMaximum)),N._binaryInfo&&(X._binaryInfo=N._binaryInfo),X._delayInfo=[],N.hasUVs&&X._delayInfo.push(D.d.UVKind),N.hasUVs2&&X._delayInfo.push(D.d.UV2Kind),N.hasUVs3&&X._delayInfo.push(D.d.UV3Kind),N.hasUVs4&&X._delayInfo.push(D.d.UV4Kind),N.hasUVs5&&X._delayInfo.push(D.d.UV5Kind),N.hasUVs6&&X._delayInfo.push(D.d.UV6Kind),N.hasColors&&X._delayInfo.push(D.d.ColorKind),N.hasMatricesIndices&&X._delayInfo.push(D.d.MatricesIndicesKind),N.hasMatricesWeights&&X._delayInfo.push(D.d.MatricesWeightsKind),X._delayLoadingFunction=T.b._ImportGeometry,M.b.ForceFullSceneLoadingForIncremental&&X._checkDelayState()):T.b._ImportGeometry(N,X),N.materialUniqueId?X._waitingMaterialId=N.materialUniqueId:N.materialId&&(X._waitingMaterialId=N.materialId),N.morphTargetManagerId>-1&&(X._waitingMorphTargetManagerId=N.morphTargetManagerId),void 0!==N.skeletonId&&null!==N.skeletonId&&(X.skeleton=Z.getLastSkeletonById(N.skeletonId),N.numBoneInfluencers&&(X.numBoneInfluencers=N.numBoneInfluencers)),N.animations){for(let Z=0;Z<N.animations.length;Z++){const d=N.animations[Z],I=(0,n.d)("BABYLON.Animation");I&&X.animations.push(I.Parse(d))}B.e.ParseAnimationRanges(X,N,Z)}if(N.autoAnimate&&Z.beginAnimation(X,N.autoAnimateFrom,N.autoAnimateTo,N.autoAnimateLoop,N.autoAnimateSpeed||1),N.layerMask&&!isNaN(N.layerMask)?X.layerMask=Math.abs(parseInt(N.layerMask)):X.layerMask=268435455,N.physicsImpostor&&(X.physicsImpostor=b._PhysicsImpostorParser(Z,X,N)),N.lodMeshIds&&(X._waitingData.lods={ids:N.lodMeshIds,distances:N.lodDistances?N.lodDistances:null,coverages:N.lodCoverages?N.lodCoverages:null}),N.instances)for(let I=0;I<N.instances.length;I++){const d=N.instances[I],m=X.eb(d.name);if(d.id&&(m.id=d.id),z.e&&(d.tags?z.e.AddTagsTo(m,d.tags):z.e.AddTagsTo(m,N.tags)),m.position=e.n._c(d.position),void 0!==d.metadata&&(m.metadata=d.metadata),void 0!==d.parentId&&(m._waitingParentId=d.parentId),void 0!==d.parentInstanceIndex&&(m._waitingParentInstanceIndex=d.parentInstanceIndex),void 0!==d.isEnabled&&null!==d.isEnabled&&m.wg(d.isEnabled),void 0!==d.isVisible&&null!==d.isVisible&&(m.isVisible=d.isVisible),void 0!==d.Fd&&null!==d.Fd&&(m.Fd=d.Fd),d.rotationQuaternion?m.rotationQuaternion=e.g._c(d.rotationQuaternion):d.rotation&&(m.rotation=e.n._c(d.rotation)),m.od=e.n._c(d.od),void 0!=d.checkCollisions&&null!=d.checkCollisions&&(m.checkCollisions=d.checkCollisions),void 0!=d.pickable&&null!=d.pickable&&(m.Fd=d.pickable),void 0!=d.showBoundingBox&&null!=d.showBoundingBox&&(m.showBoundingBox=d.showBoundingBox),void 0!=d.showSubMeshesBoundingBox&&null!=d.showSubMeshesBoundingBox&&(m.showSubMeshesBoundingBox=d.showSubMeshesBoundingBox),void 0!=d.alphaIndex&&null!=d.showSubMeshesBoundingBox&&(m.alphaIndex=d.alphaIndex),d.physicsImpostor&&(m.physicsImpostor=b._PhysicsImpostorParser(Z,m,d)),void 0!==d.actions&&(m._waitingData.actions=d.actions),d.animations){for(let N=0;N<d.animations.length;N++){const Z=d.animations[N],X=(0,n.d)("BABYLON.Animation");X&&m.animations.push(X.Parse(Z))}B.e.ParseAnimationRanges(m,d,Z),d.autoAnimate&&Z.beginAnimation(m,d.autoAnimateFrom,d.autoAnimateTo,d.autoAnimateLoop,d.autoAnimateSpeed||1)}}if(N.thinInstances){const Z=N.thinInstances;if(X.thinInstanceEnablePicking=!!Z.enablePicking,Z.matrixData?(X.Tj("matrix",new Float32Array(Z.matrixData),16,!1),X._thinInstanceDataStorage.matrixBufferSize=Z.matrixBufferSize,X._thinInstanceDataStorage.instancesCount=Z.instancesCount):X._thinInstanceDataStorage.matrixBufferSize=Z.matrixBufferSize,N.thinInstances.userThinInstance){const Z=N.thinInstances.userThinInstance;for(const N in Z.data)X.Tj(N,new Float32Array(Z.data[N]),Z.strides[N],!1),X._userThinInstanceBuffersStorage.sizes[N]=Z.sizes[N]}}return X}setPositionsForCPUSkinning(){const N=this._internalMeshDataInfo;if(!N._sourcePositions){const Z=this.getVerticesData(D.d.PositionKind);if(!Z)return N._sourcePositions;N._sourcePositions=new Float32Array(Z),this.isVertexBufferUpdatable(D.d.PositionKind)||this.Ga(D.d.PositionKind,Z,!0)}return N._sourcePositions}setNormalsForCPUSkinning(){const N=this._internalMeshDataInfo;if(!N._sourceNormals){const Z=this.getVerticesData(D.d.NormalKind);if(!Z)return N._sourceNormals;N._sourceNormals=new Float32Array(Z),this.isVertexBufferUpdatable(D.d.NormalKind)||this.Ga(D.d.NormalKind,Z,!0)}return N._sourceNormals}applySkeleton(N){if(!this.de)return this;if(this.de._softwareSkinningFrameId==this.va().getFrameId())return this;if(this.de._softwareSkinningFrameId=this.va().getFrameId(),!this.isVerticesDataPresent(D.d.PositionKind))return this;if(!this.isVerticesDataPresent(D.d.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(D.d.MatricesWeightsKind))return this;const Z=this.isVerticesDataPresent(D.d.NormalKind),d=this._internalMeshDataInfo;if(!d._sourcePositions){const N=this.Sd.slice();this.setPositionsForCPUSkinning(),this.Sd=N}Z&&!d._sourceNormals&&this.setNormalsForCPUSkinning();let X=this.getVerticesData(D.d.PositionKind);if(!X)return this;X instanceof Float32Array||(X=new Float32Array(X));let I=this.getVerticesData(D.d.NormalKind);if(Z){if(!I)return this;I instanceof Float32Array||(I=new Float32Array(I))}const m=this.getVerticesData(D.d.MatricesIndicesKind),z=this.getVerticesData(D.d.MatricesWeightsKind);if(!z||!m)return this;const w=this.numBoneInfluencers>4,S=w?this.getVerticesData(D.d.MatricesIndicesExtraKind):null,j=w?this.getVerticesData(D.d.MatricesWeightsExtraKind):null,B=N.getTransformMatrices(this),v=e.n.Zero(),T=new e.c,k=new e.c;let h,U=0;for(let D=0;D<X.length;D+=3,U+=4){let N;for(h=0;h<4;h++)N=z[U+h],N>0&&(e.c.FromFloat32ArrayToRefScaled(B,Math.floor(16*m[U+h]),N,k),T.addToSelf(k));if(w)for(h=0;h<4;h++)N=j[U+h],N>0&&(e.c.FromFloat32ArrayToRefScaled(B,Math.floor(16*S[U+h]),N,k),T.addToSelf(k));e.n.TransformCoordinatesFromFloatsToRef(d._sourcePositions[D],d._sourcePositions[D+1],d._sourcePositions[D+2],T,v),v.toArray(X,D),Z&&(e.n.TransformNormalFromFloatsToRef(d._sourceNormals[D],d._sourceNormals[D+1],d._sourceNormals[D+2],T,v),v.toArray(I,D)),T.reset()}return this.updateVerticesData(D.d.PositionKind,X),Z&&this.updateVerticesData(D.d.NormalKind,I),this}static MinMax(N){let Z=null,d=null;return N.forEach((function(N){const X=N.getBoundingInfo().boundingBox;Z&&d?(Z.minimizeInPlace(X.minimumWorld),d.maximizeInPlace(X.maximumWorld)):(Z=X.minimumWorld,d=X.maximumWorld)})),Z&&d?{min:Z,max:d}:{min:e.n.Zero(),max:e.n.Zero()}}static Center(N){const Z=N instanceof Array?b.MinMax(N):N;return e.n.Center(Z.min,Z.max)}static MergeMeshes(N){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],d=arguments.length>2?arguments[2]:void 0,X=arguments.length>3?arguments[3]:void 0,I=arguments.length>4?arguments[4]:void 0,m=arguments.length>5?arguments[5]:void 0;return(0,w.m)(b._MergeMeshesCoroutine(N,Z,d,X,I,m,!1))}static MergeMeshesAsync(N){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],d=arguments.length>2?arguments[2]:void 0,X=arguments.length>3?arguments[3]:void 0,I=arguments.length>4?arguments[4]:void 0,m=arguments.length>5?arguments[5]:void 0;return(0,w.k)(b._MergeMeshesCoroutine(N,Z,d,X,I,m,!0),(0,w.d)())}static*_MergeMeshesCoroutine(N){let Z,d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],X=arguments.length>2?arguments[2]:void 0,I=arguments.length>3?arguments[3]:void 0,m=arguments.length>4?arguments[4]:void 0,z=arguments.length>5?arguments[5]:void 0,w=arguments.length>6?arguments[6]:void 0;if(0===(N=N.filter(Boolean)).length)return null;if(!X){let d=0;for(Z=0;Z<N.length;Z++)if(d+=N[Z].getTotalVertices(),d>=65536)return A.e.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}z&&(m=!1);const S=new Array,e=new Array,j=new Array,B=N[0].sideOrientation;for(Z=0;Z<N.length;Z++){const d=N[Z];if(d.isAnInstance)return A.e.Warn("Cannot merge instance meshes."),null;if(B!==d.sideOrientation)return A.e.Warn("Cannot merge meshes with different sideOrientation values."),null;if(m&&j.push(d.getTotalIndices()),z)if(d.material){const N=d.material;if(N instanceof C.b){for(let Z=0;Z<N.vg.length;Z++)S.indexOf(N.vg[Z])<0&&S.push(N.vg[Z]);for(let Z=0;Z<d.Sd.length;Z++)e.push(S.indexOf(N.vg[d.Sd[Z].materialIndex])),j.push(d.Sd[Z].indexCount)}else{S.indexOf(N)<0&&S.push(N);for(let Z=0;Z<d.Sd.length;Z++)e.push(S.indexOf(N)),j.push(d.Sd[Z].indexCount)}}else for(let N=0;N<d.Sd.length;N++)e.push(0),j.push(d.Sd[N].indexCount)}const D=N[0],T=N=>{const Z=N.be(!0);return{vertexData:v.c.ExtractFromMesh(N,!1,!1),transform:Z}},{vertexData:k,transform:U}=T(D);w&&(yield);const M=new Array(N.length-1);for(let v=1;v<N.length;v++)M[v-1]=T(N[v]),w&&(yield);const Q=k._mergeCoroutine(U,M,X,w,!d);let n=Q.next();for(;!n.done;)w&&(yield),n=Q.next();const g=n.value;I||(I=new b(D.name+"_merged",D.va()));const E=g._applyToCoroutine(I,void 0,w);let V=E.next();for(;!V.done;)w&&(yield),V=E.next();if(I.checkCollisions=D.checkCollisions,I.sideOrientation=D.sideOrientation,d)for(Z=0;Z<N.length;Z++)N[Z].dispose();if(m||z){I.releaseSubMeshes(),Z=0;let N=0;for(;Z<j.length;)h.c.CreateFromIndices(0,N,j[Z],I,void 0,!1),N+=j[Z],Z++;for(const Z of I.Sd)Z.refreshBoundingInfo();I.be(!0)}if(z){const N=new C.b(D.name+"_merged",D.va());N.vg=S;for(let Z=0;Z<I.Sd.length;Z++)I.Sd[Z].materialIndex=e[Z];I.material=N}else I.material=D.material;return I}Jj(N){N._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(N)}Ij(N){const Z=N._indexInSourceMeshInstanceArray;if(-1!=Z){if(Z!==this.instances.length-1){const N=this.instances[this.instances.length-1];this.instances[Z]=N,N._indexInSourceMeshInstanceArray=Z}N._indexInSourceMeshInstanceArray=-1,this.instances.pop()}}_shouldConvertRHS(){return this._scene.useRightHandedSystem&&this.sideOrientation===U.e.CounterClockWiseSideOrientation}_getRenderingFillMode(N){const Z=this.va();return Z.forcePointsCloud?U.e.PointFillMode:Z.forceWireframe?U.e.WireFrameFillMode:this.overrideRenderingFillMode??N}setMaterialByID(N){return this.setMaterialById(N)}static CreateRibbon(N,Z,d,X,I,m,z,w,S){throw new Error("Import MeshBuilder to populate this function")}static mb(N,Z,d,X,I,m){throw new Error("Import MeshBuilder to populate this function")}static CreateBox(N,Z,d,X,I){throw new Error("Import MeshBuilder to populate this function")}static CreateSphere(N,Z,d,X,I,m){throw new Error("Import MeshBuilder to populate this function")}static CreateHemisphere(N,Z,d,X){throw new Error("Import MeshBuilder to populate this function")}static CreateCylinder(N,Z,d,X,I,m,z,w,S){throw new Error("Import MeshBuilder to populate this function")}static CreateTorus(N,Z,d,X,I,m,z){throw new Error("Import MeshBuilder to populate this function")}static CreateTorusKnot(N,Z,d,X,I,m,z,w,S,e){throw new Error("Import MeshBuilder to populate this function")}static nb(N,Z,d,X,I){throw new Error("Import MeshBuilder to populate this function")}static CreateDashedLines(N,Z,d,X,I,m,z,w){throw new Error("Import MeshBuilder to populate this function")}static CreatePolygon(N,Z,d,X,I,m,z){throw new Error("Import MeshBuilder to populate this function")}static ExtrudePolygon(N,Z,d,X,I,m,z,w){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShape(N,Z,d,X,I,m,z,w,S,e){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShapeCustom(N,Z,d,X,I,m,z,w,S,e,j,B){throw new Error("Import MeshBuilder to populate this function")}static CreateLathe(N,Z,d,X,I,m,z){throw new Error("Import MeshBuilder to populate this function")}static yg(N,Z,d,X,I){throw new Error("Import MeshBuilder to populate this function")}static CreateGround(N,Z,d,X,I,m){throw new Error("Import MeshBuilder to populate this function")}static CreateTiledGround(N,Z,d,X,I,m,z,w,S){throw new Error("Import MeshBuilder to populate this function")}static CreateGroundFromHeightMap(N,Z,d,X,I,m,z,w,S,e,j){throw new Error("Import MeshBuilder to populate this function")}static CreateTube(N,Z,d,X,I,m,z,w,S,e){throw new Error("Import MeshBuilder to populate this function")}static CreatePolyhedron(N,Z,d){throw new Error("Import MeshBuilder to populate this function")}static CreateIcoSphere(N,Z,d){throw new Error("Import MeshBuilder to populate this function")}static CreateDecal(N,Z,d,X,I,m){throw new Error("Import MeshBuilder to populate this function")}static CreateCapsule(N,Z,d){throw new Error("Import MeshBuilder to populate this function")}static ExtendToGoldberg(N){throw new Error("Import MeshBuilder to populate this function")}}b.FRONTSIDE=v.c.FRONTSIDE,b.BACKSIDE=v.c.BACKSIDE,b.DOUBLESIDE=v.c.DOUBLESIDE,b.DEFAULTSIDE=v.c.DEFAULTSIDE,b.NO_CAP=0,b.CAP_START=1,b.CAP_END=2,b.CAP_ALL=3,b.NO_FLIP=0,b.FLIP_TILE=1,b.ROTATE_TILE=2,b.FLIP_ROW=3,b.ROTATE_ROW=4,b.FLIP_N_ROTATE_TILE=5,b.FLIP_N_ROTATE_ROW=6,b.CENTER=0,b.LEFT=1,b.RIGHT=2,b.TOP=3,b.BOTTOM=4,b.INSTANCEDMESH_SORT_TRANSPARENT=!1,b._GroundMeshParser=(N,Z)=>{throw(0,g.b)("GroundMesh")},b._GoldbergMeshParser=(N,Z)=>{throw(0,g.b)("GoldbergMesh")},b._LinesMeshParser=(N,Z)=>{throw(0,g.b)("LinesMesh")},b._GreasedLineMeshParser=(N,Z)=>{throw(0,g.b)("GreasedLineMesh")},b._GreasedLineRibbonMeshParser=(N,Z)=>{throw(0,g.b)("GreasedLineRibbonMesh")},b._TrailMeshParser=(N,Z)=>{throw(0,g.b)("TrailMesh")},(0,n.h)("BABYLON.Mesh",b)},11345:(N,Z,d)=>{"use strict";d.d(Z,{c:()=>T});var X=d(942),I=d(960),m=d(1169),z=d(1041),w=d(1108),S=d(1051),e=d(949),j=d(11329),B=d(1023),D=d(1252);class v{}class T{constructor(){this.uniqueId=0,this.metadata={},this._applyTo=(0,j.g)(this._applyToCoroutine.bind(this)),this.uniqueId=T._UniqueIDGenerator,T._UniqueIDGenerator++}set(N,Z){switch(N.length||S.e.Warn(`Setting vertex data kind '${Z}' with an empty array`),Z){case m.d.PositionKind:this.xa=N;break;case m.d.NormalKind:this.ya=N;break;case m.d.TangentKind:this.tangents=N;break;case m.d.UVKind:this.Aa=N;break;case m.d.UV2Kind:this.uvs2=N;break;case m.d.UV3Kind:this.uvs3=N;break;case m.d.UV4Kind:this.uvs4=N;break;case m.d.UV5Kind:this.uvs5=N;break;case m.d.UV6Kind:this.uvs6=N;break;case m.d.ColorKind:this.za=N;break;case m.d.MatricesIndicesKind:this.matricesIndices=N;break;case m.d.MatricesWeightsKind:this.matricesWeights=N;break;case m.d.MatricesIndicesExtraKind:this.matricesIndicesExtra=N;break;case m.d.MatricesWeightsExtraKind:this.matricesWeightsExtra=N}}Ca(N,Z){return this._applyTo(N,Z,!1),this}applyToGeometry(N,Z){return this._applyTo(N,Z,!1),this}updateMesh(N){return this._update(N),this}updateGeometry(N){return this._update(N),this}*_applyToCoroutine(N){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],d=arguments.length>2?arguments[2]:void 0;if(this.xa&&(N.Ga(m.d.PositionKind,this.xa,Z),d&&(yield)),this.ya&&(N.Ga(m.d.NormalKind,this.ya,Z),d&&(yield)),this.tangents&&(N.Ga(m.d.TangentKind,this.tangents,Z),d&&(yield)),this.Aa&&(N.Ga(m.d.UVKind,this.Aa,Z),d&&(yield)),this.uvs2&&(N.Ga(m.d.UV2Kind,this.uvs2,Z),d&&(yield)),this.uvs3&&(N.Ga(m.d.UV3Kind,this.uvs3,Z),d&&(yield)),this.uvs4&&(N.Ga(m.d.UV4Kind,this.uvs4,Z),d&&(yield)),this.uvs5&&(N.Ga(m.d.UV5Kind,this.uvs5,Z),d&&(yield)),this.uvs6&&(N.Ga(m.d.UV6Kind,this.uvs6,Z),d&&(yield)),this.za&&(N.Ga(m.d.ColorKind,this.za,Z),this.hasVertexAlpha&&void 0!==N.hasVertexAlpha&&(N.hasVertexAlpha=!0),d&&(yield)),this.matricesIndices&&(N.Ga(m.d.MatricesIndicesKind,this.matricesIndices,Z),d&&(yield)),this.matricesWeights&&(N.Ga(m.d.MatricesWeightsKind,this.matricesWeights,Z),d&&(yield)),this.matricesIndicesExtra&&(N.Ga(m.d.MatricesIndicesExtraKind,this.matricesIndicesExtra,Z),d&&(yield)),this.matricesWeightsExtra&&(N.Ga(m.d.MatricesWeightsExtraKind,this.matricesWeightsExtra,Z),d&&(yield)),this.indices?(N.setIndices(this.indices,null,Z),d&&(yield)):N.setIndices([],null),N.Sd&&this.materialInfos&&this.materialInfos.length>1){const Z=N;Z.Sd=[];for(const N of this.materialInfos)new D.c(N.materialIndex,N.verticesStart,N.verticesCount,N.indexStart,N.indexCount,Z)}return this}_update(N,Z,d){return this.xa&&N.updateVerticesData(m.d.PositionKind,this.xa,Z,d),this.ya&&N.updateVerticesData(m.d.NormalKind,this.ya,Z,d),this.tangents&&N.updateVerticesData(m.d.TangentKind,this.tangents,Z,d),this.Aa&&N.updateVerticesData(m.d.UVKind,this.Aa,Z,d),this.uvs2&&N.updateVerticesData(m.d.UV2Kind,this.uvs2,Z,d),this.uvs3&&N.updateVerticesData(m.d.UV3Kind,this.uvs3,Z,d),this.uvs4&&N.updateVerticesData(m.d.UV4Kind,this.uvs4,Z,d),this.uvs5&&N.updateVerticesData(m.d.UV5Kind,this.uvs5,Z,d),this.uvs6&&N.updateVerticesData(m.d.UV6Kind,this.uvs6,Z,d),this.za&&N.updateVerticesData(m.d.ColorKind,this.za,Z,d),this.matricesIndices&&N.updateVerticesData(m.d.MatricesIndicesKind,this.matricesIndices,Z,d),this.matricesWeights&&N.updateVerticesData(m.d.MatricesWeightsKind,this.matricesWeights,Z,d),this.matricesIndicesExtra&&N.updateVerticesData(m.d.MatricesIndicesExtraKind,this.matricesIndicesExtra,Z,d),this.matricesWeightsExtra&&N.updateVerticesData(m.d.MatricesWeightsExtraKind,this.matricesWeightsExtra,Z,d),this.indices&&N.setIndices(this.indices,null),this}static _TransformVector3Coordinates(N,Z){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:N.length;const m=I.h.kd[0],z=I.h.kd[1];for(let w=d;w<d+X;w+=3)I.n.FromArrayToRef(N,w,m),I.n.TransformCoordinatesToRef(m,Z,z),N[w]=z.x,N[w+1]=z.y,N[w+2]=z.z}static _TransformVector3Normals(N,Z){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:N.length;const m=I.h.kd[0],z=I.h.kd[1];for(let w=d;w<d+X;w+=3)I.n.FromArrayToRef(N,w,m),I.n.TransformNormalToRef(m,Z,z),N[w]=z.x,N[w+1]=z.y,N[w+2]=z.z}static _TransformVector4Normals(N,Z){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:N.length;const m=I.h.Vector4[0],z=I.h.Vector4[1];for(let w=d;w<d+X;w+=4)I.q.FromArrayToRef(N,w,m),I.q.TransformNormalToRef(m,Z,z),N[w]=z.x,N[w+1]=z.y,N[w+2]=z.z,N[w+3]=z.w}static _FlipFaces(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:N.length;for(let X=Z;X<Z+d;X+=3){const Z=N[X+1];N[X+1]=N[X+2],N[X+2]=Z}}transform(N){const Z=N.determinant()<0;return this.xa&&T._TransformVector3Coordinates(this.xa,N),this.ya&&T._TransformVector3Normals(this.ya,N),this.tangents&&T._TransformVector4Normals(this.tangents,N),Z&&this.indices&&T._FlipFaces(this.indices),this}splitBasedOnMaterialID(){if(!this.materialInfos||this.materialInfos.length<2)return[this];const N=[];for(const Z of this.materialInfos){const d=new T;if(this.xa&&(d.xa=this.xa.slice(3*Z.verticesStart,3*(Z.verticesCount+Z.verticesStart))),this.ya&&(d.ya=this.ya.slice(3*Z.verticesStart,3*(Z.verticesCount+Z.verticesStart))),this.tangents&&(d.tangents=this.tangents.slice(4*Z.verticesStart,4*(Z.verticesCount+Z.verticesStart))),this.za&&(d.za=this.za.slice(4*Z.verticesStart,4*(Z.verticesCount+Z.verticesStart))),this.Aa&&(d.Aa=this.Aa.slice(2*Z.verticesStart,2*(Z.verticesCount+Z.verticesStart))),this.uvs2&&(d.uvs2=this.uvs2.slice(2*Z.verticesStart,2*(Z.verticesCount+Z.verticesStart))),this.uvs3&&(d.uvs3=this.uvs3.slice(2*Z.verticesStart,2*(Z.verticesCount+Z.verticesStart))),this.uvs4&&(d.uvs4=this.uvs4.slice(2*Z.verticesStart,2*(Z.verticesCount+Z.verticesStart))),this.uvs5&&(d.uvs5=this.uvs5.slice(2*Z.verticesStart,2*(Z.verticesCount+Z.verticesStart))),this.uvs6&&(d.uvs6=this.uvs6.slice(2*Z.verticesStart,2*(Z.verticesCount+Z.verticesStart))),this.matricesIndices&&(d.matricesIndices=this.matricesIndices.slice(4*Z.verticesStart,4*(Z.verticesCount+Z.verticesStart))),this.matricesIndicesExtra&&(d.matricesIndicesExtra=this.matricesIndicesExtra.slice(4*Z.verticesStart,4*(Z.verticesCount+Z.verticesStart))),this.matricesWeights&&(d.matricesWeights=this.matricesWeights.slice(4*Z.verticesStart,4*(Z.verticesCount+Z.verticesStart))),this.matricesWeightsExtra&&(d.matricesWeightsExtra=this.matricesWeightsExtra.slice(4*Z.verticesStart,4*(Z.verticesCount+Z.verticesStart))),this.indices){d.indices=[];for(let N=Z.indexStart;N<Z.indexStart+Z.indexCount;N++)d.indices.push(this.indices[N]-Z.verticesStart)}const X=new v;X.indexStart=0,X.indexCount=d.indices?d.indices.length:0,X.materialIndex=Z.materialIndex,X.verticesStart=0,X.verticesCount=(d.xa?d.xa.length:0)/3,d.materialInfos=[X],N.push(d)}return N}merge(N){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],d=arguments.length>2&&void 0!==arguments[2]&&arguments[2],X=arguments.length>3&&void 0!==arguments[3]&&arguments[3],I=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const m=Array.isArray(N)?N.map((N=>({vertexData:N}))):[{vertexData:N}];return(0,j.m)(this._mergeCoroutine(void 0,m,Z,!1,d,X,I))}*_mergeCoroutine(N,Z){var d,X;let I=arguments.length>2&&void 0!==arguments[2]&&arguments[2],z=arguments.length>3?arguments[3]:void 0,w=arguments.length>4?arguments[4]:void 0,S=arguments.length>5&&void 0!==arguments[5]&&arguments[5],e=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this._validate();let j=Z.map((N=>N.vertexData)),B=this;if(e)for(const m of j)m&&(m._validate(),!this.ya&&m.ya&&(this.ya=new Float32Array(this.xa.length)),!this.tangents&&m.tangents&&(this.tangents=new Float32Array(this.xa.length/3*4)),!this.Aa&&m.Aa&&(this.Aa=new Float32Array(this.xa.length/3*2)),!this.uvs2&&m.uvs2&&(this.uvs2=new Float32Array(this.xa.length/3*2)),!this.uvs3&&m.uvs3&&(this.uvs3=new Float32Array(this.xa.length/3*2)),!this.uvs4&&m.uvs4&&(this.uvs4=new Float32Array(this.xa.length/3*2)),!this.uvs5&&m.uvs5&&(this.uvs5=new Float32Array(this.xa.length/3*2)),!this.uvs6&&m.uvs6&&(this.uvs6=new Float32Array(this.xa.length/3*2)),!this.za&&m.za&&(this.za=new Float32Array(this.xa.length/3*4),this.za.fill(1)),!this.matricesIndices&&m.matricesIndices&&(this.matricesIndices=new Float32Array(this.xa.length/3*4)),!this.matricesWeights&&m.matricesWeights&&(this.matricesWeights=new Float32Array(this.xa.length/3*4)),!this.matricesIndicesExtra&&m.matricesIndicesExtra&&(this.matricesIndicesExtra=new Float32Array(this.xa.length/3*4)),!this.matricesWeightsExtra&&m.matricesWeightsExtra&&(this.matricesWeightsExtra=new Float32Array(this.xa.length/3*4)));for(const m of j)if(m)if(e)this.ya&&!m.ya&&(m.ya=new Float32Array(m.xa.length)),this.tangents&&!m.tangents&&(m.tangents=new Float32Array(m.xa.length/3*4)),this.Aa&&!m.Aa&&(m.Aa=new Float32Array(m.xa.length/3*2)),this.uvs2&&!m.uvs2&&(m.uvs2=new Float32Array(m.xa.length/3*2)),this.uvs3&&!m.uvs3&&(m.uvs3=new Float32Array(m.xa.length/3*2)),this.uvs4&&!m.uvs4&&(m.uvs4=new Float32Array(m.xa.length/3*2)),this.uvs5&&!m.uvs5&&(m.uvs5=new Float32Array(m.xa.length/3*2)),this.uvs6&&!m.uvs6&&(m.uvs6=new Float32Array(m.xa.length/3*2)),this.za&&!m.za&&(m.za=new Float32Array(m.xa.length/3*4),m.za.fill(1)),this.matricesIndices&&!m.matricesIndices&&(m.matricesIndices=new Float32Array(m.xa.length/3*4)),this.matricesWeights&&!m.matricesWeights&&(m.matricesWeights=new Float32Array(m.xa.length/3*4)),this.matricesIndicesExtra&&!m.matricesIndicesExtra&&(m.matricesIndicesExtra=new Float32Array(m.xa.length/3*4)),this.matricesWeightsExtra&&!m.matricesWeightsExtra&&(m.matricesWeightsExtra=new Float32Array(m.xa.length/3*4));else if(m._validate(),!this.ya!==!m.ya||!this.tangents!==!m.tangents||!this.Aa!==!m.Aa||!this.uvs2!==!m.uvs2||!this.uvs3!==!m.uvs3||!this.uvs4!==!m.uvs4||!this.uvs5!==!m.uvs5||!this.uvs6!==!m.uvs6||!this.za!==!m.za||!this.matricesIndices!==!m.matricesIndices||!this.matricesWeights!==!m.matricesWeights||!this.matricesIndicesExtra!==!m.matricesIndicesExtra||!this.matricesWeightsExtra!==!m.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(S){let d=0,X=0,I=0;const m=[];let z=null;const w=[];for(const Z of this.splitBasedOnMaterialID())w.push({vertexData:Z,transform:N});for(const N of Z)if(N.vertexData)for(const Z of N.vertexData.splitBasedOnMaterialID())w.push({vertexData:Z,transform:N.transform});w.sort(((N,Z)=>{const d=N.vertexData.materialInfos?N.vertexData.materialInfos[0].materialIndex:0,X=Z.vertexData.materialInfos?Z.vertexData.materialInfos[0].materialIndex:0;return d>X?1:d===X?0:-1}));for(const N of w){const Z=N.vertexData;if(d=Z.materialInfos?Z.materialInfos[0].materialIndex:0,z&&z.materialIndex===d)z.indexCount+=Z.indices.length,z.verticesCount+=Z.xa.length/3;else{const N=new v;N.materialIndex=d,N.indexStart=X,N.indexCount=Z.indices.length,N.verticesStart=I,N.verticesCount=Z.xa.length/3,m.push(N),z=N}X+=Z.indices.length,I+=Z.xa.length/3}const S=w.splice(0,1)[0];B=S.vertexData,N=S.transform,j=w.map((N=>N.vertexData)),Z=w,this.materialInfos=m}const D=j.reduce(((N,Z)=>{var d;return N+((null===(d=Z.indices)||void 0===d?void 0:d.length)??0)}),(null===(d=B.indices)||void 0===d?void 0:d.length)??0);let k=w||j.some((N=>N.indices===B.indices))?null===(X=B.indices)||void 0===X?void 0:X.slice():B.indices;if(D>0){var h;let d=(null===(h=k)||void 0===h?void 0:h.length)??0;if(k||(k=new Array(D)),k.length!==D){if(Array.isArray(k))k.length=D;else{const N=I||k instanceof Uint32Array?new Uint32Array(D):new Uint16Array(D);N.set(k),k=N}N&&N.determinant()<0&&T._FlipFaces(k,0,d)}let X=B.xa?B.xa.length/3:0;for(const{vertexData:N,transform:I}of Z)if(N.indices){for(let Z=0;Z<N.indices.length;Z++)k[d+Z]=N.indices[Z]+X;I&&I.determinant()<0&&T._FlipFaces(k,d,N.indices.length),X+=N.xa.length/3,d+=N.indices.length,z&&(yield)}}return this.indices=k,this.xa=T._MergeElement(m.d.PositionKind,B.xa,N,Z.map((N=>[N.vertexData.xa,N.transform]))),z&&(yield),B.ya&&(this.ya=T._MergeElement(m.d.NormalKind,B.ya,N,Z.map((N=>[N.vertexData.ya,N.transform]))),z&&(yield)),B.tangents&&(this.tangents=T._MergeElement(m.d.TangentKind,B.tangents,N,Z.map((N=>[N.vertexData.tangents,N.transform]))),z&&(yield)),B.Aa&&(this.Aa=T._MergeElement(m.d.UVKind,B.Aa,N,Z.map((N=>[N.vertexData.Aa,N.transform]))),z&&(yield)),B.uvs2&&(this.uvs2=T._MergeElement(m.d.UV2Kind,B.uvs2,N,Z.map((N=>[N.vertexData.uvs2,N.transform]))),z&&(yield)),B.uvs3&&(this.uvs3=T._MergeElement(m.d.UV3Kind,B.uvs3,N,Z.map((N=>[N.vertexData.uvs3,N.transform]))),z&&(yield)),B.uvs4&&(this.uvs4=T._MergeElement(m.d.UV4Kind,B.uvs4,N,Z.map((N=>[N.vertexData.uvs4,N.transform]))),z&&(yield)),B.uvs5&&(this.uvs5=T._MergeElement(m.d.UV5Kind,B.uvs5,N,Z.map((N=>[N.vertexData.uvs5,N.transform]))),z&&(yield)),B.uvs6&&(this.uvs6=T._MergeElement(m.d.UV6Kind,B.uvs6,N,Z.map((N=>[N.vertexData.uvs6,N.transform]))),z&&(yield)),B.za&&(this.za=T._MergeElement(m.d.ColorKind,B.za,N,Z.map((N=>[N.vertexData.za,N.transform]))),(void 0!==B.hasVertexAlpha||Z.some((N=>void 0!==N.vertexData.hasVertexAlpha)))&&(this.hasVertexAlpha=B.hasVertexAlpha||Z.some((N=>N.vertexData.hasVertexAlpha))),z&&(yield)),B.matricesIndices&&(this.matricesIndices=T._MergeElement(m.d.MatricesIndicesKind,B.matricesIndices,N,Z.map((N=>[N.vertexData.matricesIndices,N.transform]))),z&&(yield)),B.matricesWeights&&(this.matricesWeights=T._MergeElement(m.d.MatricesWeightsKind,B.matricesWeights,N,Z.map((N=>[N.vertexData.matricesWeights,N.transform]))),z&&(yield)),B.matricesIndicesExtra&&(this.matricesIndicesExtra=T._MergeElement(m.d.MatricesIndicesExtraKind,B.matricesIndicesExtra,N,Z.map((N=>[N.vertexData.matricesIndicesExtra,N.transform]))),z&&(yield)),B.matricesWeightsExtra&&(this.matricesWeightsExtra=T._MergeElement(m.d.MatricesWeightsExtraKind,B.matricesWeightsExtra,N,Z.map((N=>[N.vertexData.matricesWeightsExtra,N.transform])))),this}static _MergeElement(N,Z,d,X){const I=X.filter((N=>null!==N[0]&&void 0!==N[0]));if(!Z&&0==I.length)return Z;if(!Z)return this._MergeElement(N,I[0][0],I[0][1],I.slice(1));const z=I.reduce(((N,Z)=>N+Z[0].length),Z.length),w=N===m.d.PositionKind?T._TransformVector3Coordinates:N===m.d.NormalKind?T._TransformVector3Normals:N===m.d.TangentKind?T._TransformVector4Normals:()=>{};if(Z instanceof Float32Array){const N=new Float32Array(z);N.set(Z),d&&w(N,d,0,Z.length);let X=Z.length;for(const[Z,d]of I)N.set(Z,X),d&&w(N,d,X,Z.length),X+=Z.length;return N}{const N=new Array(z);for(let d=0;d<Z.length;d++)N[d]=Z[d];d&&w(N,d,0,Z.length);let X=Z.length;for(const[Z,d]of I){for(let d=0;d<Z.length;d++)N[X+d]=Z[d];d&&w(N,d,X,Z.length),X+=Z.length}return N}}_validate(){if(!this.xa)throw new B.f("Positions are required",B.c.MeshInvalidPositionsError);const N=(N,Z)=>{const d=m.d.DeduceStride(N);if(Z.length%d!==0)throw new Error("The "+N+"s array count must be a multiple of "+d);return Z.length/d},Z=N(m.d.PositionKind,this.xa),d=(d,X)=>{const I=N(d,X);if(I!==Z)throw new Error("The "+d+"s element count ("+I+") does not match the positions count ("+Z+")")};this.ya&&d(m.d.NormalKind,this.ya),this.tangents&&d(m.d.TangentKind,this.tangents),this.Aa&&d(m.d.UVKind,this.Aa),this.uvs2&&d(m.d.UV2Kind,this.uvs2),this.uvs3&&d(m.d.UV3Kind,this.uvs3),this.uvs4&&d(m.d.UV4Kind,this.uvs4),this.uvs5&&d(m.d.UV5Kind,this.uvs5),this.uvs6&&d(m.d.UV6Kind,this.uvs6),this.za&&d(m.d.ColorKind,this.za),this.matricesIndices&&d(m.d.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&d(m.d.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&d(m.d.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&d(m.d.MatricesWeightsExtraKind,this.matricesWeightsExtra)}clone(){const N=this.serialize();return T.Parse(N)}serialize(){const N={};if(this.xa&&(N.xa=Array.from(this.xa)),this.ya&&(N.ya=Array.from(this.ya)),this.tangents&&(N.tangents=Array.from(this.tangents)),this.Aa&&(N.Aa=Array.from(this.Aa)),this.uvs2&&(N.uvs2=Array.from(this.uvs2)),this.uvs3&&(N.uvs3=Array.from(this.uvs3)),this.uvs4&&(N.uvs4=Array.from(this.uvs4)),this.uvs5&&(N.uvs5=Array.from(this.uvs5)),this.uvs6&&(N.uvs6=Array.from(this.uvs6)),this.za&&(N.za=Array.from(this.za),N.hasVertexAlpha=this.hasVertexAlpha),this.matricesIndices&&(N.matricesIndices=Array.from(this.matricesIndices),N.matricesIndices._isExpanded=!0),this.matricesWeights&&(N.matricesWeights=Array.from(this.matricesWeights)),this.matricesIndicesExtra&&(N.matricesIndicesExtra=Array.from(this.matricesIndicesExtra),N.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(N.matricesWeightsExtra=Array.from(this.matricesWeightsExtra)),N.indices=Array.from(this.indices),this.materialInfos){N.materialInfos=[];for(const Z of this.materialInfos){const d={indexStart:Z.indexStart,indexCount:Z.indexCount,materialIndex:Z.materialIndex,verticesStart:Z.verticesStart,verticesCount:Z.verticesCount};N.materialInfos.push(d)}}return N}static ExtractFromMesh(N,Z,d){return T._ExtractFrom(N,Z,d)}static ExtractFromGeometry(N,Z,d){return T._ExtractFrom(N,Z,d)}static _ExtractFrom(N,Z,d){const X=new T;if(N.isVerticesDataPresent(m.d.PositionKind)&&(X.xa=N.getVerticesData(m.d.PositionKind,Z,d)),N.isVerticesDataPresent(m.d.NormalKind)&&(X.ya=N.getVerticesData(m.d.NormalKind,Z,d)),N.isVerticesDataPresent(m.d.TangentKind)&&(X.tangents=N.getVerticesData(m.d.TangentKind,Z,d)),N.isVerticesDataPresent(m.d.UVKind)&&(X.Aa=N.getVerticesData(m.d.UVKind,Z,d)),N.isVerticesDataPresent(m.d.UV2Kind)&&(X.uvs2=N.getVerticesData(m.d.UV2Kind,Z,d)),N.isVerticesDataPresent(m.d.UV3Kind)&&(X.uvs3=N.getVerticesData(m.d.UV3Kind,Z,d)),N.isVerticesDataPresent(m.d.UV4Kind)&&(X.uvs4=N.getVerticesData(m.d.UV4Kind,Z,d)),N.isVerticesDataPresent(m.d.UV5Kind)&&(X.uvs5=N.getVerticesData(m.d.UV5Kind,Z,d)),N.isVerticesDataPresent(m.d.UV6Kind)&&(X.uvs6=N.getVerticesData(m.d.UV6Kind,Z,d)),N.isVerticesDataPresent(m.d.ColorKind)){const I=N.de||N,z=I.getVertexBuffer(m.d.ColorKind),w=I.getVerticesData(m.d.ColorKind,Z,d);if(3===z.getSize()){const N=new Float32Array(4*w.length/3);for(let Z=0,d=0;Z<w.length;Z+=3,d+=4)N[d]=w[Z],N[d+1]=w[Z+1],N[d+2]=w[Z+2],N[d+3]=1;X.za=N}else{if(4!==z.getSize())throw new Error(`Unexpected number of color components: ${z.getSize()}`);X.za=w}}return N.isVerticesDataPresent(m.d.MatricesIndicesKind)&&(X.matricesIndices=N.getVerticesData(m.d.MatricesIndicesKind,Z,d)),N.isVerticesDataPresent(m.d.MatricesWeightsKind)&&(X.matricesWeights=N.getVerticesData(m.d.MatricesWeightsKind,Z,d)),N.isVerticesDataPresent(m.d.MatricesIndicesExtraKind)&&(X.matricesIndicesExtra=N.getVerticesData(m.d.MatricesIndicesExtraKind,Z,d)),N.isVerticesDataPresent(m.d.MatricesWeightsExtraKind)&&(X.matricesWeightsExtra=N.getVerticesData(m.d.MatricesWeightsExtraKind,Z,d)),X.indices=N.ge(Z,d),X}static CreateRibbon(N){throw(0,z.b)("ribbonBuilder")}static CreateBox(N){throw(0,z.b)("boxBuilder")}static CreateTiledBox(N){throw(0,z.b)("tiledBoxBuilder")}static CreateTiledPlane(N){throw(0,z.b)("tiledPlaneBuilder")}static CreateSphere(N){throw(0,z.b)("sphereBuilder")}static CreateCylinder(N){throw(0,z.b)("cylinderBuilder")}static CreateTorus(N){throw(0,z.b)("torusBuilder")}static CreateLineSystem(N){throw(0,z.b)("linesBuilder")}static CreateDashedLines(N){throw(0,z.b)("linesBuilder")}static CreateGround(N){throw(0,z.b)("groundBuilder")}static CreateTiledGround(N){throw(0,z.b)("groundBuilder")}static CreateGroundFromHeightMap(N){throw(0,z.b)("groundBuilder")}static yg(N){throw(0,z.b)("planeBuilder")}static mb(N){throw(0,z.b)("discBuilder")}static CreatePolygon(N,Z,d,X,I,m,w){throw(0,z.b)("polygonBuilder")}static CreateIcoSphere(N){throw(0,z.b)("icoSphereBuilder")}static CreatePolyhedron(N){throw(0,z.b)("polyhedronBuilder")}static CreateCapsule(){arguments.length>0&&void 0!==arguments[0]||I.n.Up();throw(0,z.b)("capsuleBuilder")}static CreateTorusKnot(N){throw(0,z.b)("torusKnotBuilder")}static ComputeNormals(N,Z,d,X){let m=0,z=0,w=0,S=0,e=0,j=0,B=0,D=0,v=0,T=0,k=0,h=0,U=0,C=0,M=0,Q=0,A=0,n=0,g=0,E=0,V=!1,O=!1,K=!1,r=!1,P=1,W=0,b=null;X&&(V=!!X.facetNormals,O=!!X.facetPositions,K=!!X.facetPartitioning,P=!0===X.useRightHandedSystem?-1:1,W=X.ratio||0,r=!!X.depthSort,b=X.distanceTo,r&&void 0===b&&(b=I.n.Zero()));let J=0,F=0,G=0,x=0;for(K&&X&&X.bbSize&&(J=X.subDiv.X*W/X.bbSize.x,F=X.subDiv.Y*W/X.bbSize.y,G=X.subDiv.Z*W/X.bbSize.z,x=X.subDiv.max*X.subDiv.max,X.facetPartitioning.length=0),m=0;m<N.length;m++)d[m]=0;const t=Z.length/3|0;for(m=0;m<t;m++){if(h=3*Z[3*m],U=h+1,C=h+2,M=3*Z[3*m+1],Q=M+1,A=M+2,n=3*Z[3*m+2],g=n+1,E=n+2,z=N[h]-N[M],w=N[U]-N[Q],S=N[C]-N[A],e=N[n]-N[M],j=N[g]-N[Q],B=N[E]-N[A],D=P*(w*B-S*j),v=P*(S*e-z*B),T=P*(z*j-w*e),k=Math.sqrt(D*D+v*v+T*T),k=0===k?1:k,D/=k,v/=k,T/=k,V&&X&&(X.facetNormals[m].x=D,X.facetNormals[m].y=v,X.facetNormals[m].z=T),O&&X&&(X.facetPositions[m].x=(N[h]+N[M]+N[n])/3,X.facetPositions[m].y=(N[U]+N[Q]+N[g])/3,X.facetPositions[m].z=(N[C]+N[A]+N[E])/3),K&&X){const Z=Math.floor((X.facetPositions[m].x-X.bInfo.minimum.x*W)*J),d=Math.floor((X.facetPositions[m].y-X.bInfo.minimum.y*W)*F),I=Math.floor((X.facetPositions[m].z-X.bInfo.minimum.z*W)*G),z=Math.floor((N[h]-X.bInfo.minimum.x*W)*J),w=Math.floor((N[U]-X.bInfo.minimum.y*W)*F),S=Math.floor((N[C]-X.bInfo.minimum.z*W)*G),e=Math.floor((N[M]-X.bInfo.minimum.x*W)*J),j=Math.floor((N[Q]-X.bInfo.minimum.y*W)*F),B=Math.floor((N[A]-X.bInfo.minimum.z*W)*G),D=Math.floor((N[n]-X.bInfo.minimum.x*W)*J),v=Math.floor((N[g]-X.bInfo.minimum.y*W)*F),T=Math.floor((N[E]-X.bInfo.minimum.z*W)*G),k=z+X.subDiv.max*w+x*S,V=e+X.subDiv.max*j+x*B,O=D+X.subDiv.max*v+x*T,K=Z+X.subDiv.max*d+x*I;X.facetPartitioning[K]=X.facetPartitioning[K]?X.facetPartitioning[K]:new Array,X.facetPartitioning[k]=X.facetPartitioning[k]?X.facetPartitioning[k]:new Array,X.facetPartitioning[V]=X.facetPartitioning[V]?X.facetPartitioning[V]:new Array,X.facetPartitioning[O]=X.facetPartitioning[O]?X.facetPartitioning[O]:new Array,X.facetPartitioning[k].push(m),V!=k&&X.facetPartitioning[V].push(m),O!=V&&O!=k&&X.facetPartitioning[O].push(m),K!=k&&K!=V&&K!=O&&X.facetPartitioning[K].push(m)}if(r&&X&&X.facetPositions){const N=X.depthSortedFacets[m];N.ind=3*m,N.sqDistance=I.n.DistanceSquared(X.facetPositions[m],b)}d[h]+=D,d[U]+=v,d[C]+=T,d[M]+=D,d[Q]+=v,d[A]+=T,d[n]+=D,d[g]+=v,d[E]+=T}for(m=0;m<d.length/3;m++)D=d[3*m],v=d[3*m+1],T=d[3*m+2],k=Math.sqrt(D*D+v*v+T*T),k=0===k?1:k,D/=k,v/=k,T/=k,d[3*m]=D,d[3*m+1]=v,d[3*m+2]=T}static _ComputeSides(N,Z,d,X,m,z,w){const S=d.length,e=X.length;let j,B;switch(N=N||T.DEFAULTSIDE){case T.FRONTSIDE:break;case T.BACKSIDE:for(j=0;j<S;j+=3){const N=d[j];d[j]=d[j+2],d[j+2]=N}for(B=0;B<e;B++)X[B]=-X[B];break;case T.DOUBLESIDE:{const N=Z.length,D=N/3;for(let d=0;d<N;d++)Z[N+d]=Z[d];for(j=0;j<S;j+=3)d[j+S]=d[j+2]+D,d[j+1+S]=d[j+1]+D,d[j+2+S]=d[j]+D;for(B=0;B<e;B++)X[e+B]=-X[B];const v=m.length;let T=0;for(T=0;T<v;T++)m[T+v]=m[T];for(z=z||new I.q(0,0,1,1),w=w||new I.q(0,0,1,1),T=0,j=0;j<v/2;j++)m[T]=z.x+(z.z-z.x)*m[T],m[T+1]=z.y+(z.w-z.y)*m[T+1],m[T+v]=w.x+(w.z-w.x)*m[T+v],m[T+v+1]=w.y+(w.w-w.y)*m[T+v+1],T+=2;break}}}static Parse(N){const Z=new T,d=N.xa;d&&Z.set(d,m.d.PositionKind);const X=N.ya;X&&Z.set(X,m.d.NormalKind);const I=N.tangents;I&&Z.set(I,m.d.TangentKind);const z=N.Aa;z&&Z.set(z,m.d.UVKind);const S=N.uvs2;S&&Z.set(S,m.d.UV2Kind);const e=N.uvs3;e&&Z.set(e,m.d.UV3Kind);const j=N.uvs4;j&&Z.set(j,m.d.UV4Kind);const B=N.uvs5;B&&Z.set(B,m.d.UV5Kind);const D=N.uvs6;D&&Z.set(D,m.d.UV6Kind);const k=N.za;k&&(Z.set(w.e.CheckColors4(k,d.length/3),m.d.ColorKind),void 0!==N.hasVertexAlpha&&(Z.hasVertexAlpha=N.hasVertexAlpha));const h=N.matricesIndices;h&&Z.set(h,m.d.MatricesIndicesKind);const U=N.matricesWeights;U&&Z.set(U,m.d.MatricesWeightsKind);const C=N.indices;C&&(Z.indices=C);const M=N.materialInfos;if(M){Z.materialInfos=[];for(const N of M){const d=new v;d.indexCount=N.indexCount,d.indexStart=N.indexStart,d.verticesCount=N.verticesCount,d.verticesStart=N.verticesStart,d.materialIndex=N.materialIndex,Z.materialInfos.push(d)}}return Z}static ImportVertexData(N,Z){const d=T.Parse(N);Z.setAllVerticesData(d,N.updatable)}}T.FRONTSIDE=0,T.BACKSIDE=1,T.DOUBLESIDE=2,T.DEFAULTSIDE=0,T._UniqueIDGenerator=0,(0,X.d)([e.f.filter((function(){for(var N=arguments.length,Z=new Array(N),d=0;d<N;d++)Z[d]=arguments[d];let[X]=Z;return!Array.isArray(X)}))],T,"_TransformVector3Coordinates",null),(0,X.d)([e.f.filter((function(){for(var N=arguments.length,Z=new Array(N),d=0;d<N;d++)Z[d]=arguments[d];let[X]=Z;return!Array.isArray(X)}))],T,"_TransformVector3Normals",null),(0,X.d)([e.f.filter((function(){for(var N=arguments.length,Z=new Array(N),d=0;d<N;d++)Z[d]=arguments[d];let[X]=Z;return!Array.isArray(X)}))],T,"_TransformVector4Normals",null),(0,X.d)([e.f.filter((function(){for(var N=arguments.length,Z=new Array(N),d=0;d<N;d++)Z[d]=arguments[d];let[X]=Z;return!Array.isArray(X)}))],T,"_FlipFaces",null)},12067:(N,Z,d)=>{"use strict";d.d(Z,{b:()=>kN});var X=d(960),I=d(11321),m=d(1169),z=d(11345),w=d(1119);function S(N){let Z=N.pathArray;const d=N.closeArray||!1,X=N.closePath||!1,I=N.invertUV||!1,S=Math.floor(Z[0].length/2);let e=N.offset||S;e=e>S?S:Math.floor(e);const j=0===N.sideOrientation?0:N.sideOrientation||z.c.DEFAULTSIDE,B=N.Aa,D=N.za,v=[],T=[],k=[],h=[],U=[],C=[],M=[],Q=[];let A;const n=[],g=[];let E,V,O;if(Z.length<2){const N=[],d=[];for(V=0;V<Z[0].length-e;V++)N.push(Z[0][V]),d.push(Z[0][V+e]);Z=[N,d]}let K=0;const r=X?1:0,P=d?1:0;let W,b,J,F,G,x;for(A=Z[0].length,E=0;E<Z.length+P;E++){for(M[E]=0,U[E]=[0],W=E===Z.length?Z[0]:Z[E],b=W.length,A=A<b?A:b,O=0;O<b;)v.push(W[O].x,W[O].y,W[O].z),O>0&&(J=W[O].rc(W[O-1]).length(),F=J+M[E],U[E].push(F),M[E]=F),O++;X&&(O--,v.push(W[0].x,W[0].y,W[0].z),J=W[O].rc(W[0]).length(),F=J+M[E],U[E].push(F),M[E]=F),n[E]=b+r,g[E]=K,K+=b+r}let t,q,Y=null,s=null;for(V=0;V<A+r;V++)for(Q[V]=0,C[V]=[0],E=0;E<Z.length-1+P;E++)G=Z[E],x=E===Z.length-1?Z[0]:Z[E+1],V===A?(Y=G[0],s=x[0]):(Y=G[V],s=x[V]),J=s.rc(Y).length(),F=J+Q[V],C[V].push(F),Q[V]=F;if(B)for(E=0;E<B.length;E++)h.push(B[E].x,w.b?1-B[E].y:B[E].y);else for(E=0;E<Z.length+P;E++)for(V=0;V<A+r;V++)t=0!=M[E]?U[E][V]/M[E]:0,q=0!=Q[V]?C[V][E]/Q[V]:0,I?h.push(q,t):h.push(t,w.b?1-q:q);E=0;let L=0,H=n[E]-1,i=n[E+1]-1,p=H<i?H:i,y=g[1]-g[0];const l=n.length-1;for(;L<=p&&E<l;)T.push(L,L+y,L+1),T.push(L+y+1,L+1,L+y),L+=1,L===p&&(E++,y=g[E+1]-g[E],H=n[E]-1,i=n[E+1]-1,L=g[E],p=H<i?H+L:i+L);if(z.c.ComputeNormals(v,T,k),X){let N=0,d=0;for(E=0;E<Z.length;E++){N=3*g[E],d=E+1<Z.length?3*(g[E+1]-1):k.length-3,k[N]=.5*(k[N]+k[d]),k[N+1]=.5*(k[N+1]+k[d+1]),k[N+2]=.5*(k[N+2]+k[d+2]);const X=Math.sqrt(k[N]*k[N]+k[N+1]*k[N+1]+k[N+2]*k[N+2]);k[N]/=X,k[N+1]/=X,k[N+2]/=X,k[d]=k[N],k[d+1]=k[N+1],k[d+2]=k[N+2]}}if(d){let N=3*g[0],d=3*g[Z.length];for(V=0;V<A+r;V++){k[N]=.5*(k[N]+k[d]),k[N+1]=.5*(k[N+1]+k[d+1]),k[N+2]=.5*(k[N+2]+k[d+2]);const Z=Math.sqrt(k[N]*k[N]+k[N+1]*k[N+1]+k[N+2]*k[N+2]);k[N]/=Z,k[N+1]/=Z,k[N+2]/=Z,k[d]=k[N],k[d+1]=k[N+1],k[d+2]=k[N+2],N+=3,d+=3}}z.c._ComputeSides(j,v,T,k,h,N.frontUVs,N.backUVs);let u=null;if(D){u=new Float32Array(4*D.length);for(let N=0;N<D.length;N++)u[4*N]=D[N].r,u[4*N+1]=D[N].g,u[4*N+2]=D[N].b,u[4*N+3]=D[N].a}const a=new z.c,c=new Float32Array(v),R=new Float32Array(k),f=new Float32Array(h);return a.indices=T,a.xa=c,a.ya=R,a.Aa=f,u&&a.set(u,m.d.ColorKind),X&&(a._idx=g),a}function e(N,Z){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const e=Z.pathArray,j=Z.closeArray,B=Z.closePath,D=I.b._GetDefaultSideOrientation(Z.sideOrientation),v=Z.instance,T=Z.updatable;if(v){const N=X.h.kd[0].hd(Number.MAX_VALUE),d=X.h.kd[1].hd(-Number.MAX_VALUE),S=Z=>{let X=e[0].length;const m=v;let z=0;const w=m._originalBuilderSideOrientation===I.b.DOUBLESIDE?2:1;for(let I=1;I<=w;++I)for(let w=0;w<e.length;++w){const I=e[w],S=I.length;X=X<S?X:S;for(let m=0;m<X;++m){const X=I[m];Z[z]=X.x,Z[z+1]=X.y,Z[z+2]=X.z,N.minimizeInPlaceFromFloats(X.x,X.y,X.z),d.maximizeInPlaceFromFloats(X.x,X.y,X.z),z+=3}if(m._creationDataStorage&&m._creationDataStorage.closePath){const N=I[0];Z[z]=N.x,Z[z+1]=N.y,Z[z+2]=N.z,z+=3}}},j=v.getVerticesData(m.d.PositionKind);if(S(j),v.hasBoundingInfo?v.getBoundingInfo().reConstruct(N,d,v._worldMatrix):v.buildBoundingInfo(N,d,v._worldMatrix),v.updateVerticesData(m.d.PositionKind,j,!1,!1),Z.za){const N=v.getVerticesData(m.d.ColorKind);for(let d=0,X=0;d<Z.za.length;d++,X+=4){const I=Z.za[d];N[X]=I.r,N[X+1]=I.g,N[X+2]=I.b,N[X+3]=I.a}v.updateVerticesData(m.d.ColorKind,N,!1,!1)}if(Z.Aa){const N=v.getVerticesData(m.d.UVKind);for(let d=0;d<Z.Aa.length;d++)N[2*d]=Z.Aa[d].x,N[2*d+1]=w.b?1-Z.Aa[d].y:Z.Aa[d].y;v.updateVerticesData(m.d.UVKind,N,!1,!1)}if(!v.areNormalsFrozen||v.isFacetDataEnabled){const N=v.ge(),Z=v.getVerticesData(m.d.NormalKind),d=v.isFacetDataEnabled?v.getFacetDataParameters():null;if(z.c.ComputeNormals(j,N,Z,d),v._creationDataStorage&&v._creationDataStorage.closePath){let N=0,d=0;for(let X=0;X<e.length;X++)N=3*v._creationDataStorage.idx[X],d=X+1<e.length?3*(v._creationDataStorage.idx[X+1]-1):Z.length-3,Z[N]=.5*(Z[N]+Z[d]),Z[N+1]=.5*(Z[N+1]+Z[d+1]),Z[N+2]=.5*(Z[N+2]+Z[d+2]),Z[d]=Z[N],Z[d+1]=Z[N+1],Z[d+2]=Z[N+2]}v.areNormalsFrozen||v.updateVerticesData(m.d.NormalKind,Z,!1,!1)}return v}{const X=new I.b(N,d);X._originalBuilderSideOrientation=D,X._creationDataStorage=new I.e;const m=S(Z);return B&&(X._creationDataStorage.idx=m._idx),X._creationDataStorage.closePath=B,X._creationDataStorage.closeArray=j,m.Ca(X,T),X}}z.c.CreateRibbon=S,I.b.CreateRibbon=function(N,Z){return e(N,{pathArray:Z,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var j=d(11489),B=d(11376),D=d(1108);function v(N){const Z=N.pattern||I.b.NO_FLIP,d=N.tileWidth||N.tileSize||1,X=N.tileHeight||N.tileSize||1,m=N.alignHorizontal||0,w=N.alignVertical||0,S=N.width||N.size||1,e=Math.floor(S/d);let j=S-e*d;const B=N.height||N.size||1,D=Math.floor(B/X);let v=B-D*X;const T=d*e/2,k=X*D/2;let h=0,U=0,C=0,M=0,Q=0,A=0;if(j>0||v>0){switch(C=-T,M=-k,Q=T,A=k,m){case I.b.CENTER:j/=2,C-=j,Q+=j;break;case I.b.LEFT:Q+=j,h=-j/2;break;case I.b.RIGHT:C-=j,h=j/2}switch(w){case I.b.CENTER:v/=2,M-=v,A+=v;break;case I.b.BOTTOM:A+=v,U=-v/2;break;case I.b.TOP:M-=v,U=v/2}}const n=[],g=[],E=[];E[0]=[0,0,1,0,1,1,0,1],E[1]=[0,0,1,0,1,1,0,1],Z!==I.b.ROTATE_TILE&&Z!==I.b.ROTATE_ROW||(E[1]=[1,1,0,1,0,0,1,0]),Z!==I.b.FLIP_TILE&&Z!==I.b.FLIP_ROW||(E[1]=[1,0,0,0,0,1,1,1]),Z!==I.b.FLIP_N_ROTATE_TILE&&Z!==I.b.FLIP_N_ROTATE_ROW||(E[1]=[0,1,1,1,1,0,0,0]);let V=[];const O=[],K=[];let r=0;for(let z=0;z<D;z++)for(let N=0;N<e;N++)n.push(N*d-T+h,z*X-k+U,0),n.push((N+1)*d-T+h,z*X-k+U,0),n.push((N+1)*d-T+h,(z+1)*X-k+U,0),n.push(N*d-T+h,(z+1)*X-k+U,0),K.push(r,r+1,r+3,r+1,r+2,r+3),V=Z===I.b.FLIP_TILE||Z===I.b.ROTATE_TILE||Z===I.b.FLIP_N_ROTATE_TILE?V.concat(E[(N%2+z%2)%2]):Z===I.b.FLIP_ROW||Z===I.b.ROTATE_ROW||Z===I.b.FLIP_N_ROTATE_ROW?V.concat(E[z%2]):V.concat(E[0]),O.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),g.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),r+=4;if(j>0||v>0){const N=v>0&&(w===I.b.CENTER||w===I.b.TOP),z=v>0&&(w===I.b.CENTER||w===I.b.BOTTOM),S=j>0&&(m===I.b.CENTER||m===I.b.RIGHT),B=j>0&&(m===I.b.CENTER||m===I.b.LEFT);let E,P,W,b,J=[];if(N&&S&&(n.push(C+h,M+U,0),n.push(-T+h,M+U,0),n.push(-T+h,M+v+U,0),n.push(C+h,M+v+U,0),K.push(r,r+1,r+3,r+1,r+2,r+3),r+=4,E=1-j/d,P=1-v/X,W=1,b=1,J=[E,P,W,P,W,b,E,b],Z===I.b.ROTATE_ROW&&(J=[1-E,1-P,1-W,1-P,1-W,1-b,1-E,1-b]),Z===I.b.FLIP_ROW&&(J=[1-E,P,1-W,P,1-W,b,1-E,b]),Z===I.b.FLIP_N_ROTATE_ROW&&(J=[E,1-P,W,1-P,W,1-b,E,1-b]),V=V.concat(J),O.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),g.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),N&&B&&(n.push(T+h,M+U,0),n.push(Q+h,M+U,0),n.push(Q+h,M+v+U,0),n.push(T+h,M+v+U,0),K.push(r,r+1,r+3,r+1,r+2,r+3),r+=4,E=0,P=1-v/X,W=j/d,b=1,J=[E,P,W,P,W,b,E,b],(Z===I.b.ROTATE_ROW||Z===I.b.ROTATE_TILE&&e%2===0)&&(J=[1-E,1-P,1-W,1-P,1-W,1-b,1-E,1-b]),(Z===I.b.FLIP_ROW||Z===I.b.FLIP_TILE&&e%2===0)&&(J=[1-E,P,1-W,P,1-W,b,1-E,b]),(Z===I.b.FLIP_N_ROTATE_ROW||Z===I.b.FLIP_N_ROTATE_TILE&&e%2===0)&&(J=[E,1-P,W,1-P,W,1-b,E,1-b]),V=V.concat(J),O.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),g.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),z&&S&&(n.push(C+h,k+U,0),n.push(-T+h,k+U,0),n.push(-T+h,A+U,0),n.push(C+h,A+U,0),K.push(r,r+1,r+3,r+1,r+2,r+3),r+=4,E=1-j/d,P=0,W=1,b=v/X,J=[E,P,W,P,W,b,E,b],(Z===I.b.ROTATE_ROW&&D%2===1||Z===I.b.ROTATE_TILE&&D%1===0)&&(J=[1-E,1-P,1-W,1-P,1-W,1-b,1-E,1-b]),(Z===I.b.FLIP_ROW&&D%2===1||Z===I.b.FLIP_TILE&&D%2===0)&&(J=[1-E,P,1-W,P,1-W,b,1-E,b]),(Z===I.b.FLIP_N_ROTATE_ROW&&D%2===1||Z===I.b.FLIP_N_ROTATE_TILE&&D%2===0)&&(J=[E,1-P,W,1-P,W,1-b,E,1-b]),V=V.concat(J),O.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),g.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),z&&B&&(n.push(T+h,k+U,0),n.push(Q+h,k+U,0),n.push(Q+h,A+U,0),n.push(T+h,A+U,0),K.push(r,r+1,r+3,r+1,r+2,r+3),r+=4,E=0,P=0,W=j/d,b=v/X,J=[E,P,W,P,W,b,E,b],(Z===I.b.ROTATE_ROW&&D%2===1||Z===I.b.ROTATE_TILE&&(D+e)%2===1)&&(J=[1-E,1-P,1-W,1-P,1-W,1-b,1-E,1-b]),(Z===I.b.FLIP_ROW&&D%2===1||Z===I.b.FLIP_TILE&&(D+e)%2===1)&&(J=[1-E,P,1-W,P,1-W,b,1-E,b]),(Z===I.b.FLIP_N_ROTATE_ROW&&D%2===1||Z===I.b.FLIP_N_ROTATE_TILE&&(D+e)%2===1)&&(J=[E,1-P,W,1-P,W,1-b,E,1-b]),V=V.concat(J),O.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),g.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),N){const N=[];E=0,P=1-v/X,W=1,b=1,N[0]=[E,P,W,P,W,b,E,b],N[1]=[E,P,W,P,W,b,E,b],Z!==I.b.ROTATE_TILE&&Z!==I.b.ROTATE_ROW||(N[1]=[1-E,1-P,1-W,1-P,1-W,1-b,1-E,1-b]),Z!==I.b.FLIP_TILE&&Z!==I.b.FLIP_ROW||(N[1]=[1-E,P,1-W,P,1-W,b,1-E,b]),Z!==I.b.FLIP_N_ROTATE_TILE&&Z!==I.b.FLIP_N_ROTATE_ROW||(N[1]=[E,1-P,W,1-P,W,1-b,E,1-b]);for(let X=0;X<e;X++)n.push(X*d-T+h,M+U,0),n.push((X+1)*d-T+h,M+U,0),n.push((X+1)*d-T+h,M+v+U,0),n.push(X*d-T+h,M+v+U,0),K.push(r,r+1,r+3,r+1,r+2,r+3),r+=4,V=Z===I.b.FLIP_TILE||Z===I.b.ROTATE_TILE||Z===I.b.FLIP_N_ROTATE_TILE?V.concat(N[(X+1)%2]):Z===I.b.FLIP_ROW||Z===I.b.ROTATE_ROW||Z===I.b.FLIP_N_ROTATE_ROW?V.concat(N[1]):V.concat(N[0]),O.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),g.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(z){const N=[];E=0,P=0,W=1,b=v/X,N[0]=[E,P,W,P,W,b,E,b],N[1]=[E,P,W,P,W,b,E,b],Z!==I.b.ROTATE_TILE&&Z!==I.b.ROTATE_ROW||(N[1]=[1-E,1-P,1-W,1-P,1-W,1-b,1-E,1-b]),Z!==I.b.FLIP_TILE&&Z!==I.b.FLIP_ROW||(N[1]=[1-E,P,1-W,P,1-W,b,1-E,b]),Z!==I.b.FLIP_N_ROTATE_TILE&&Z!==I.b.FLIP_N_ROTATE_ROW||(N[1]=[E,1-P,W,1-P,W,1-b,E,1-b]);for(let X=0;X<e;X++)n.push(X*d-T+h,A-v+U,0),n.push((X+1)*d-T+h,A-v+U,0),n.push((X+1)*d-T+h,A+U,0),n.push(X*d-T+h,A+U,0),K.push(r,r+1,r+3,r+1,r+2,r+3),r+=4,V=Z===I.b.FLIP_TILE||Z===I.b.ROTATE_TILE||Z===I.b.FLIP_N_ROTATE_TILE?V.concat(N[(X+D)%2]):Z===I.b.FLIP_ROW||Z===I.b.ROTATE_ROW||Z===I.b.FLIP_N_ROTATE_ROW?V.concat(N[D%2]):V.concat(N[0]),O.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),g.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(S){const N=[];E=1-j/d,P=0,W=1,b=1,N[0]=[E,P,W,P,W,b,E,b],N[1]=[E,P,W,P,W,b,E,b],Z!==I.b.ROTATE_TILE&&Z!==I.b.ROTATE_ROW||(N[1]=[1-E,1-P,1-W,1-P,1-W,1-b,1-E,1-b]),Z!==I.b.FLIP_TILE&&Z!==I.b.FLIP_ROW||(N[1]=[1-E,P,1-W,P,1-W,b,1-E,b]),Z!==I.b.FLIP_N_ROTATE_TILE&&Z!==I.b.FLIP_N_ROTATE_ROW||(N[1]=[E,1-P,W,1-P,W,1-b,E,1-b]);for(let d=0;d<D;d++)n.push(C+h,d*X-k+U,0),n.push(C+j+h,d*X-k+U,0),n.push(C+j+h,(d+1)*X-k+U,0),n.push(C+h,(d+1)*X-k+U,0),K.push(r,r+1,r+3,r+1,r+2,r+3),r+=4,V=Z===I.b.FLIP_TILE||Z===I.b.ROTATE_TILE||Z===I.b.FLIP_N_ROTATE_TILE?V.concat(N[(d+1)%2]):Z===I.b.FLIP_ROW||Z===I.b.ROTATE_ROW||Z===I.b.FLIP_N_ROTATE_ROW?V.concat(N[d%2]):V.concat(N[0]),O.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),g.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(B){const N=[];E=0,P=0,W=j/X,b=1,N[0]=[E,P,W,P,W,b,E,b],N[1]=[E,P,W,P,W,b,E,b],Z!==I.b.ROTATE_TILE&&Z!==I.b.ROTATE_ROW||(N[1]=[1-E,1-P,1-W,1-P,1-W,1-b,1-E,1-b]),Z!==I.b.FLIP_TILE&&Z!==I.b.FLIP_ROW||(N[1]=[1-E,P,1-W,P,1-W,b,1-E,b]),Z!==I.b.FLIP_N_ROTATE_TILE&&Z!==I.b.FLIP_N_ROTATE_ROW||(N[1]=[E,1-P,W,1-P,W,1-b,E,1-b]);for(let d=0;d<D;d++)n.push(Q-j+h,d*X-k+U,0),n.push(Q+h,d*X-k+U,0),n.push(Q+h,(d+1)*X-k+U,0),n.push(Q-j+h,(d+1)*X-k+U,0),K.push(r,r+1,r+3,r+1,r+2,r+3),r+=4,V=Z===I.b.FLIP_TILE||Z===I.b.ROTATE_TILE||Z===I.b.FLIP_N_ROTATE_TILE?V.concat(N[(d+e)%2]):Z===I.b.FLIP_ROW||Z===I.b.ROTATE_ROW||Z===I.b.FLIP_N_ROTATE_ROW?V.concat(N[d%2]):V.concat(N[0]),O.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),g.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const P=0===N.sideOrientation?0:N.sideOrientation||z.c.DEFAULTSIDE;z.c._ComputeSides(P,n,K,g,V,N.frontUVs,N.backUVs);const W=new z.c;W.indices=K,W.xa=n,W.ya=g,W.Aa=V;const b=P===z.c.DOUBLESIDE?O.concat(O):O;return W.za=b,W}function T(N,Z){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const X=new I.b(N,d);Z.sideOrientation=I.b._GetDefaultSideOrientation(Z.sideOrientation),X._originalBuilderSideOrientation=Z.sideOrientation;return v(Z).Ca(X,Z.updatable),X}function k(N){const Z=N.faceUV||new Array(6),d=N.faceColors,m=N.pattern||I.b.NO_FLIP,S=N.width||N.size||1,e=N.height||N.size||1,j=N.depth||N.size||1,B=N.tileWidth||N.tileSize||1,T=N.tileHeight||N.tileSize||1,k=N.alignHorizontal||0,h=N.alignVertical||0,U=0===N.sideOrientation?0:N.sideOrientation||z.c.DEFAULTSIDE;for(let I=0;I<6;I++)void 0===Z[I]&&(Z[I]=new X.q(0,0,1,1)),d&&void 0===d[I]&&(d[I]=new D.e(1,1,1,1));const C=S/2,M=e/2,Q=j/2,A=[];for(let X=0;X<2;X++)A[X]=v({pattern:m,tileWidth:B,tileHeight:T,width:S,height:e,alignVertical:h,alignHorizontal:k,sideOrientation:U});for(let X=2;X<4;X++)A[X]=v({pattern:m,tileWidth:B,tileHeight:T,width:j,height:e,alignVertical:h,alignHorizontal:k,sideOrientation:U});let n=h;h===I.b.BOTTOM?n=I.b.TOP:h===I.b.TOP&&(n=I.b.BOTTOM);for(let X=4;X<6;X++)A[X]=v({pattern:m,tileWidth:B,tileHeight:T,width:S,height:j,alignVertical:n,alignHorizontal:k,sideOrientation:U});let g=[],E=[],V=[],O=[];const K=[],r=[],P=[],W=[];let b=0,J=0;for(let I=0;I<6;I++){const N=A[I].xa.length;r[I]=[],P[I]=[];for(let Z=0;Z<N/3;Z++)r[I].push(new X.n(A[I].xa[3*Z],A[I].xa[3*Z+1],A[I].xa[3*Z+2])),P[I].push(new X.n(A[I].ya[3*Z],A[I].ya[3*Z+1],A[I].ya[3*Z+2]));b=A[I].Aa.length,W[I]=[];for(let d=0;d<b;d+=2)W[I][d]=Z[I].x+(Z[I].z-Z[I].x)*A[I].Aa[d],W[I][d+1]=Z[I].y+(Z[I].w-Z[I].y)*A[I].Aa[d+1],w.b&&(W[I][d+1]=1-W[I][d+1]);if(V=V.concat(W[I]),O=O.concat(A[I].indices.map((N=>N+J))),J+=r[I].length,d)for(let Z=0;Z<4;Z++)K.push(d[I].r,d[I].g,d[I].b,d[I].a)}const F=new X.n(0,0,Q),G=X.c.RotationY(Math.PI);g=r[0].map((N=>X.n.TransformNormal(N,G).add(F))).map((N=>[N.x,N.y,N.z])).reduce(((N,Z)=>N.concat(Z)),[]),E=P[0].map((N=>X.n.TransformNormal(N,G))).map((N=>[N.x,N.y,N.z])).reduce(((N,Z)=>N.concat(Z)),[]),g=g.concat(r[1].map((N=>N.rc(F))).map((N=>[N.x,N.y,N.z])).reduce(((N,Z)=>N.concat(Z)),[])),E=E.concat(P[1].map((N=>[N.x,N.y,N.z])).reduce(((N,Z)=>N.concat(Z)),[]));const x=new X.n(C,0,0),t=X.c.RotationY(-Math.PI/2);g=g.concat(r[2].map((N=>X.n.TransformNormal(N,t).add(x))).map((N=>[N.x,N.y,N.z])).reduce(((N,Z)=>N.concat(Z)),[])),E=E.concat(P[2].map((N=>X.n.TransformNormal(N,t))).map((N=>[N.x,N.y,N.z])).reduce(((N,Z)=>N.concat(Z)),[]));const q=X.c.RotationY(Math.PI/2);g=g.concat(r[3].map((N=>X.n.TransformNormal(N,q).rc(x))).map((N=>[N.x,N.y,N.z])).reduce(((N,Z)=>N.concat(Z)),[])),E=E.concat(P[3].map((N=>X.n.TransformNormal(N,q))).map((N=>[N.x,N.y,N.z])).reduce(((N,Z)=>N.concat(Z)),[]));const Y=new X.n(0,M,0),s=X.c.RotationX(Math.PI/2);g=g.concat(r[4].map((N=>X.n.TransformNormal(N,s).add(Y))).map((N=>[N.x,N.y,N.z])).reduce(((N,Z)=>N.concat(Z)),[])),E=E.concat(P[4].map((N=>X.n.TransformNormal(N,s))).map((N=>[N.x,N.y,N.z])).reduce(((N,Z)=>N.concat(Z)),[]));const L=X.c.RotationX(-Math.PI/2);g=g.concat(r[5].map((N=>X.n.TransformNormal(N,L).rc(Y))).map((N=>[N.x,N.y,N.z])).reduce(((N,Z)=>N.concat(Z)),[])),E=E.concat(P[5].map((N=>X.n.TransformNormal(N,L))).map((N=>[N.x,N.y,N.z])).reduce(((N,Z)=>N.concat(Z)),[])),z.c._ComputeSides(U,g,O,E,V);const H=new z.c;if(H.indices=O,H.xa=g,H.ya=E,H.Aa=V,d){const N=U===z.c.DOUBLESIDE?K.concat(K):K;H.za=N}return H}function h(N,Z){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const X=new I.b(N,d);Z.sideOrientation=I.b._GetDefaultSideOrientation(Z.sideOrientation),X._originalBuilderSideOrientation=Z.sideOrientation;return k(Z).Ca(X,Z.updatable),X}z.c.CreateTiledPlane=v;z.c.CreateTiledBox=k;var U=d(11476),C=d(1131),M=d(1388);function Q(N){const Z=N.height||2;let d=0===N.diameterTop?0:N.diameterTop||N.diameter||1,m=0===N.diameterBottom?0:N.diameterBottom||N.diameter||1;d=d||1e-5,m=m||1e-5;const S=0|(N.Vk||24),e=0|(N.subdivisions||1),j=!!N.hasRings,B=!!N.enclose,v=0===N.cap?0:N.cap||I.b.CAP_ALL,T=N.arc&&(N.arc<=0||N.arc>1)?1:N.arc||1,k=0===N.sideOrientation?0:N.sideOrientation||z.c.DEFAULTSIDE,h=N.faceUV||new Array(3),U=N.faceColors,C=2+(1+(1!==T&&B?2:0))*(j?e:1);let Q;for(Q=0;Q<C;Q++)U&&void 0===U[Q]&&(U[Q]=new D.e(1,1,1,1));for(Q=0;Q<C;Q++)h&&void 0===h[Q]&&(h[Q]=new X.q(0,0,1,1));const A=[],n=[],g=[],E=[],V=[],O=2*Math.PI*T/S;let K,r,P;const W=(m-d)/2/Z,b=X.n.Zero(),J=X.n.Zero(),F=X.n.Zero(),G=X.n.Zero(),x=X.n.Zero(),t=M.d.Y;let q,Y,s,L=1,H=1,i=0,p=0;for(q=0;q<=e;q++)for(r=q/e,P=(r*(d-m)+m)/2,L=j&&0!==q&&q!==e?2:1,s=0;s<L;s++){for(j&&(H+=s),B&&(H+=2*s),Y=0;Y<=S;Y++)K=Y*O,b.x=Math.cos(-K)*P,b.y=-Z/2+r*Z,b.z=Math.sin(-K)*P,0===d&&q===e?(J.x=g[g.length-3*(S+1)],J.y=g[g.length-3*(S+1)+1],J.z=g[g.length-3*(S+1)+2]):(J.x=b.x,J.z=b.z,J.y=Math.sqrt(J.x*J.x+J.z*J.z)*W,J.normalize()),0===Y&&(F.p(b),G.p(J)),n.push(b.x,b.y,b.z),g.push(J.x,J.y,J.z),p=j?i!==H?h[H].y:h[H].w:h[H].y+(h[H].w-h[H].y)*r,E.push(h[H].x+(h[H].z-h[H].x)*Y/S,w.b?1-p:p),U&&V.push(U[H].r,U[H].g,U[H].b,U[H].a);1!==T&&B&&(n.push(b.x,b.y,b.z),n.push(0,b.y,0),n.push(0,b.y,0),n.push(F.x,F.y,F.z),X.n.CrossToRef(t,J,x),x.normalize(),g.push(x.x,x.y,x.z,x.x,x.y,x.z),X.n.CrossToRef(G,t,x),x.normalize(),g.push(x.x,x.y,x.z,x.x,x.y,x.z),p=j?i!==H?h[H+1].y:h[H+1].w:h[H+1].y+(h[H+1].w-h[H+1].y)*r,E.push(h[H+1].x,w.b?1-p:p),E.push(h[H+1].z,w.b?1-p:p),p=j?i!==H?h[H+2].y:h[H+2].w:h[H+2].y+(h[H+2].w-h[H+2].y)*r,E.push(h[H+2].x,w.b?1-p:p),E.push(h[H+2].z,w.b?1-p:p),U&&(V.push(U[H+1].r,U[H+1].g,U[H+1].b,U[H+1].a),V.push(U[H+1].r,U[H+1].g,U[H+1].b,U[H+1].a),V.push(U[H+2].r,U[H+2].g,U[H+2].b,U[H+2].a),V.push(U[H+2].r,U[H+2].g,U[H+2].b,U[H+2].a))),i!==H&&(i=H)}const y=1!==T&&B?S+4:S;for(q=0,H=0;H<e;H++){let N=0,Z=0,d=0,X=0;for(Y=0;Y<S;Y++)N=q*(y+1)+Y,Z=(q+1)*(y+1)+Y,d=q*(y+1)+(Y+1),X=(q+1)*(y+1)+(Y+1),A.push(N,Z,d),A.push(X,d,Z);1!==T&&B&&(A.push(N+2,Z+2,d+2),A.push(X+2,d+2,Z+2),A.push(N+4,Z+4,d+4),A.push(X+4,d+4,Z+4)),q=j?q+2:q+1}const l=N=>{const I=N?d/2:m/2;if(0===I)return;let z,e,j;const B=N?h[C-1]:h[0];let D=null;U&&(D=N?U[C-1]:U[0]);const v=n.length/3,k=N?Z/2:-Z/2,M=new X.n(0,k,0);n.push(M.x,M.y,M.z),g.push(0,N?1:-1,0);const Q=B.y+.5*(B.w-B.y);E.push(B.x+.5*(B.z-B.x),w.b?1-Q:Q),D&&V.push(D.r,D.g,D.b,D.a);const O=new X.l(.5,.5);for(j=0;j<=S;j++){z=2*Math.PI*j*T/S;const Z=Math.cos(-z),d=Math.sin(-z);e=new X.n(Z*I,k,d*I);const m=new X.l(Z*O.x+.5,d*O.y+.5);n.push(e.x,e.y,e.z),g.push(0,N?1:-1,0);const v=B.y+(B.w-B.y)*m.y;E.push(B.x+(B.z-B.x)*m.x,w.b?1-v:v),D&&V.push(D.r,D.g,D.b,D.a)}for(j=0;j<S;j++)N?(A.push(v),A.push(v+(j+2)),A.push(v+(j+1))):(A.push(v),A.push(v+(j+1)),A.push(v+(j+2)))};v!==I.b.CAP_START&&v!==I.b.CAP_ALL||l(!1),v!==I.b.CAP_END&&v!==I.b.CAP_ALL||l(!0),z.c._ComputeSides(k,n,A,g,E,N.frontUVs,N.backUVs);const u=new z.c;return u.indices=A,u.xa=n,u.ya=g,u.Aa=E,U&&(u.za=V),u}function A(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=arguments.length>2?arguments[2]:void 0;const X=new I.b(N,d);Z.sideOrientation=I.b._GetDefaultSideOrientation(Z.sideOrientation),X._originalBuilderSideOrientation=Z.sideOrientation;return Q(Z).Ca(X,Z.updatable),X}function n(N){const Z=[],d=[],I=[],m=[],S=N.diameter||1,e=N.thickness||.5,j=0|(N.Vk||16),B=0===N.sideOrientation?0:N.sideOrientation||z.c.DEFAULTSIDE,D=j+1;for(let z=0;z<=j;z++){const N=z/j,B=z*Math.PI*2/j-Math.PI/2,v=X.c.Translation(S/2,0,0).multiply(X.c.RotationY(B));for(let S=0;S<=j;S++){const B=1-S/j,T=S*Math.PI*2/j+Math.PI,k=Math.cos(T),h=Math.sin(T);let U=new X.n(k,h,0),C=U.scale(e/2);const M=new X.l(N,B);C=X.n.TransformCoordinates(C,v),U=X.n.TransformNormal(U,v),d.push(C.x,C.y,C.z),I.push(U.x,U.y,U.z),m.push(M.x,w.b?1-M.y:M.y);const Q=(z+1)%D,A=(S+1)%D;Z.push(z*D+S),Z.push(z*D+A),Z.push(Q*D+S),Z.push(z*D+A),Z.push(Q*D+A),Z.push(Q*D+S)}}z.c._ComputeSides(B,d,Z,I,m,N.frontUVs,N.backUVs);const v=new z.c;return v.indices=Z,v.xa=d,v.ya=I,v.Aa=m,v}function g(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=arguments.length>2?arguments[2]:void 0;const X=new I.b(N,d);Z.sideOrientation=I.b._GetDefaultSideOrientation(Z.sideOrientation),X._originalBuilderSideOrientation=Z.sideOrientation;return n(Z).Ca(X,Z.updatable),X}z.c.CreateCylinder=Q,I.b.CreateCylinder=(N,Z,d,X,m,z,w,S,e)=>{void 0!==w&&w instanceof C.e||(void 0!==w&&(e=S||I.b.DEFAULTSIDE,S=w),w=z,z=1);return A(N,{height:Z,diameterTop:d,diameterBottom:X,Vk:m,subdivisions:z,sideOrientation:e,updatable:S},w)};function E(N){const Z=[],d=[],I=[],m=[],S=N.i||2,e=N.tube||.5,j=N.radialSegments||32,B=N.tubularSegments||32,D=N.p||2,v=N.q||3,T=0===N.sideOrientation?0:N.sideOrientation||z.c.DEFAULTSIDE,k=N=>{const Z=Math.cos(N),d=Math.sin(N),I=v/D*N,m=Math.cos(I),z=S*(2+m)*.5*Z,w=S*(2+m)*d*.5,e=S*Math.sin(I)*.5;return new X.n(z,w,e)};let h,U;for(h=0;h<=j;h++){const N=h%j/j*2*D*Math.PI,Z=k(N),I=k(N+.01),z=I.rc(Z);let S=I.add(Z);const v=X.n.Cross(z,S);for(S=X.n.Cross(v,z),v.normalize(),S.normalize(),U=0;U<B;U++){const N=U%B/B*2*Math.PI,X=-e*Math.cos(N),I=e*Math.sin(N);d.push(Z.x+X*S.x+I*v.x),d.push(Z.y+X*S.y+I*v.y),d.push(Z.z+X*S.z+I*v.z),m.push(h/j),m.push(w.b?1-U/B:U/B)}}for(h=0;h<j;h++)for(U=0;U<B;U++){const N=(U+1)%B,d=h*B+U,X=(h+1)*B+U,I=(h+1)*B+N,m=h*B+N;Z.push(m),Z.push(X),Z.push(d),Z.push(m),Z.push(I),Z.push(X)}z.c.ComputeNormals(d,Z,I),z.c._ComputeSides(T,d,Z,I,m,N.frontUVs,N.backUVs);const C=new z.c;return C.indices=Z,C.xa=d,C.ya=I,C.Aa=m,C}function V(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=arguments.length>2?arguments[2]:void 0;const X=new I.b(N,d);Z.sideOrientation=I.b._GetDefaultSideOrientation(Z.sideOrientation),X._originalBuilderSideOrientation=Z.sideOrientation;return E(Z).Ca(X,Z.updatable),X}z.c.CreateTorus=n,I.b.CreateTorus=(N,Z,d,X,I,m,z)=>g(N,{diameter:Z,thickness:d,Vk:X,sideOrientation:z,updatable:m},I);z.c.CreateTorusKnot=E,I.b.CreateTorusKnot=(N,Z,d,X,I,m,z,w,S,e)=>V(N,{i:Z,tube:d,radialSegments:X,tubularSegments:I,p:m,q:z,sideOrientation:e,updatable:S},w);var O=d(12074),K=d(1051),r=d(1395),P=d(966),W=d(986);class b extends X.l{constructor(N,Z){super(N.x,N.y),this.index=Z}}class J{constructor(){this.elements=[]}add(N){const Z=[];return N.forEach((N=>{const d=new b(N,this.elements.length);Z.push(d),this.elements.push(d)})),Z}computeBounds(){const N=new X.l(this.elements[0].x,this.elements[0].y),Z=new X.l(this.elements[0].x,this.elements[0].y);return this.elements.forEach((d=>{d.x<N.x?N.x=d.x:d.x>Z.x&&(Z.x=d.x),d.y<N.y?N.y=d.y:d.y>Z.y&&(Z.y=d.y)})),{min:N,max:Z,width:Z.x-N.x,height:Z.y-N.y}}}class F{_addToepoint(N){for(const Z of N)this._epoints.push(Z.x,Z.y)}constructor(N,Z,d){let X,I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;this._points=new J,this._outlinepoints=new J,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=I,this._name=N,this._scene=d||W.e.LastCreatedScene,X=Z instanceof r.f?Z.getPoints():Z,this._addToepoint(X),this._points.add(X),this._outlinepoints.add(X),"undefined"===typeof this.bjsEarcut&&K.e.Warn("Earcut was not found, the polygon will not be built.")}addHole(N){this._points.add(N);const Z=new J;return Z.add(N),this._holes.push(Z),this._eholes.push(this._epoints.length/2),this._addToepoint(N),this}build(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const X=new I.b(this._name,this._scene),z=this.buildVertexData(Z,d);return X.Ga(m.d.PositionKind,z.xa,N),X.Ga(m.d.NormalKind,z.ya,N),X.Ga(m.d.UVKind,z.Aa,N),X.setIndices(z.indices),X}buildVertexData(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const d=new z.c,X=[],I=[],m=[],w=this._points.computeBounds();this._points.elements.forEach((N=>{X.push(0,1,0),I.push(N.x,0,N.y),m.push((N.x-w.min.x)/w.width,(N.y-w.min.y)/w.height)}));const S=[],e=this.bjsEarcut(this._epoints,this._eholes,2);for(let z=0;z<e.length;z++)S.push(e[z]);if(N>0){const d=I.length/3;this._points.elements.forEach((Z=>{X.push(0,-1,0),I.push(Z.x,-N,Z.y),m.push(1-(Z.x-w.min.x)/w.width,1-(Z.y-w.min.y)/w.height)}));const z=S.length;for(let N=0;N<z;N+=3){const Z=S[N+0],X=S[N+1],I=S[N+2];S.push(I+d),S.push(X+d),S.push(Z+d)}this._addSide(I,X,m,S,w,this._outlinepoints,N,!1,Z),this._holes.forEach((d=>{this._addSide(I,X,m,S,w,d,N,!0,Z)}))}return d.indices=S,d.xa=I,d.ya=X,d.Aa=m,d}_addSide(N,Z,d,I,m,z,w,S,e){let j=N.length/3,B=0;for(let D=0;D<z.elements.length;D++){const v=z.elements[D],T=z.elements[(D+1)%z.elements.length];N.push(v.x,0,v.y),N.push(v.x,-w,v.y),N.push(T.x,0,T.y),N.push(T.x,-w,T.y);const k=z.elements[(D+z.elements.length-1)%z.elements.length],h=z.elements[(D+2)%z.elements.length];let U=new X.n(-(T.y-v.y),0,T.x-v.x),C=new X.n(-(v.y-k.y),0,v.x-k.x),M=new X.n(-(h.y-T.y),0,h.x-T.x);S||(U=U.scale(-1),C=C.scale(-1),M=M.scale(-1));const Q=U.normalizeToNew();let A=C.normalizeToNew(),n=M.normalizeToNew();const g=X.n.Dot(A,Q);A=g>e?g<P.b-1?new X.n(v.x,0,v.y).rc(new X.n(T.x,0,T.y)).normalize():C.add(U).normalize():Q;const E=X.n.Dot(M,U);n=E>e?E<P.b-1?new X.n(T.x,0,T.y).rc(new X.n(v.x,0,v.y)).normalize():M.add(U).normalize():Q,d.push(B/m.width,0),d.push(B/m.width,1),B+=U.length(),d.push(B/m.width,0),d.push(B/m.width,1),Z.push(A.x,A.y,A.z),Z.push(A.x,A.y,A.z),Z.push(n.x,n.y,n.z),Z.push(n.x,n.y,n.z),S?(I.push(j),I.push(j+2),I.push(j+1),I.push(j+1),I.push(j+2),I.push(j+3)):(I.push(j),I.push(j+1),I.push(j+2),I.push(j+1),I.push(j+3),I.push(j+2)),j+=4}}}function G(N,Z,d,I,S,e,j){const B=d||new Array(3),v=I,T=[],k=j||!1;for(let m=0;m<3;m++)void 0===B[m]&&(B[m]=new X.q(0,0,1,1)),v&&void 0===v[m]&&(v[m]=new D.e(1,1,1,1));const h=N.getVerticesData(m.d.PositionKind),U=N.getVerticesData(m.d.NormalKind),C=N.getVerticesData(m.d.UVKind),M=N.ge(),Q=h.length/9;let A=0,n=0,g=0,E=0,V=0;const O=[0];if(k)for(let X=Q;X<h.length/3;X+=4)n=h[3*(X+2)]-h[3*X],g=h[3*(X+2)+2]-h[3*X+2],E=Math.sqrt(n*n+g*g),V+=E,O.push(V);let K=0,r=0;for(let X=0;X<U.length;X+=3)Math.abs(U[X+1])<.001&&(r=1),Math.abs(U[X+1]-1)<.001&&(r=0),Math.abs(U[X+1]+1)<.001&&(r=2),K=X/3,1===r?(A=K-Q,C[2*K]=A%4<1.5?k?B[r].x+(B[r].z-B[r].x)*O[Math.floor(A/4)]/V:B[r].x:k?B[r].x+(B[r].z-B[r].x)*O[Math.floor(A/4)+1]/V:B[r].z,C[2*K+1]=A%2===0?w.b?1-B[r].w:B[r].w:w.b?1-B[r].y:B[r].y):(C[2*K]=(1-C[2*K])*B[r].x+C[2*K]*B[r].z,C[2*K+1]=(1-C[2*K+1])*B[r].y+C[2*K+1]*B[r].w,w.b&&(C[2*K+1]=1-C[2*K+1])),v&&T.push(v[r].r,v[r].g,v[r].b,v[r].a);z.c._ComputeSides(Z,h,M,U,C,S,e);const P=new z.c;if(P.indices=M,P.xa=h,P.ya=U,P.Aa=C,v){const N=Z===z.c.DOUBLESIDE?T.concat(T):T;P.za=N}return P}function x(N,Z){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,m=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;Z.sideOrientation=I.b._GetDefaultSideOrientation(Z.sideOrientation);const z=Z.shape,w=Z.holes||[],S=Z.depth||0,e=Z.smoothingThreshold||2,j=[];let B=[];for(let I=0;I<z.length;I++)j[I]=new X.l(z[I].x,z[I].z);j[0].equalsWithEpsilon(j[j.length-1],1e-8)&&j.pop();const D=new F(N,j,d||W.e.LastCreatedScene,m);for(let I=0;I<w.length;I++){B=[];for(let N=0;N<w[I].length;N++)B.push(new X.l(w[I][N].x,w[I][N].z));D.addHole(B)}const v=D.build(!1,S,e);v._originalBuilderSideOrientation=Z.sideOrientation;return G(v,Z.sideOrientation,Z.faceUV,Z.faceColors,Z.frontUVs,Z.backUVs,Z.wrap).Ca(v,Z.updatable),v}function t(N,Z){return x(N,Z,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut)}function q(N,Z){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const X=Z.path,m=Z.shape,z=Z.scale||1,w=Z.rotation||0,S=0===Z.cap?0:Z.cap||I.b.NO_CAP,e=Z.updatable,j=I.b._GetDefaultSideOrientation(Z.sideOrientation),B=Z.instance||null,D=Z.invertUV||!1,v=Z.closeShape||!1;return s(N,m,X,z,w,null,null,Z.closePath||!1,v,S,!1,d,!!e,j,B,D,Z.frontUVs||null,Z.backUVs||null,Z.firstNormal||null,!!Z.adjustFrame)}function Y(N,Z){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const X=Z.path,m=Z.shape,z=Z.scaleFunction||(()=>1),w=Z.rotationFunction||(()=>0),S=Z.closePath||Z.ribbonCloseArray||!1,e=Z.closeShape||Z.ribbonClosePath||!1,j=0===Z.cap?0:Z.cap||I.b.NO_CAP,B=Z.updatable,D=Z.firstNormal||null,v=Z.adjustFrame||!1;return s(N,m,X,null,null,z,w,S,e,j,!0,d,!!B,I.b._GetDefaultSideOrientation(Z.sideOrientation),Z.instance||null,Z.invertUV||!1,Z.frontUVs||null,Z.backUVs||null,D,v)}function s(N,Z,d,m,z,w,S,j,B,D,v,T,k,h,U,C,M,Q,A,n){const g=(N,Z,d,m,z,w,S,e,j,B,D)=>{const v=d.getTangents(),T=d.getNormals(),k=d.getBinormals(),h=d.getDistances();if(D)for(let I=0;I<v.length;I++)if(0==v[I].x&&0==v[I].y&&0==v[I].z&&v[I].p(v[I-1]),0==T[I].x&&0==T[I].y&&0==T[I].z&&T[I].p(T[I-1]),0==k[I].x&&0==k[I].y&&0==k[I].z&&k[I].p(k[I-1]),I>0){let N=v[I-1];X.n.Dot(N,v[I])<0&&v[I].scaleInPlace(-1),N=T[I-1],X.n.Dot(N,T[I])<0&&T[I].scaleInPlace(-1),N=k[I-1],X.n.Dot(N,k[I])<0&&k[I].scaleInPlace(-1)}let U=0;const C=B&&e?e:()=>null!==w?w:0,M=B&&S?S:()=>null!==z?z:1;let Q=j===I.b.NO_CAP||j===I.b.CAP_END?0:2;const A=X.h.Matrix[0];for(let I=0;I<Z.length;I++){const d=[],z=C(I,h[I]),w=M(I,h[I]);X.c.RotationAxisToRef(v[I],U,A);for(let m=0;m<N.length;m++){const z=v[I].scale(N[m].z).add(T[I].scale(N[m].x)).add(k[I].scale(N[m].y)),S=X.n.Zero();X.n.TransformCoordinatesToRef(z,A,S),S.scaleInPlace(w).addInPlace(Z[I]),d[m]=S}m[Q]=d,U+=z,Q++}const n=N=>{const Z=Array(),d=X.n.Zero();let I;for(I=0;I<N.length;I++)d.addInPlace(N[I]);for(d.scaleInPlace(1/N.length),I=0;I<N.length;I++)Z.push(d);return Z};switch(j){case I.b.NO_CAP:break;case I.b.CAP_START:m[0]=n(m[2]),m[1]=m[2];break;case I.b.CAP_END:m[Q]=m[Q-1],m[Q+1]=n(m[Q-1]);break;case I.b.CAP_ALL:m[0]=n(m[2]),m[1]=m[2],m[Q]=m[Q-1],m[Q+1]=n(m[Q-1])}return m};let E,V;if(U){const N=U._creationDataStorage;return E=A?N.path3D.update(d,A):N.path3D.update(d),V=g(Z,d,N.path3D,N.pathArray,m,z,w,S,N.cap,v,n),U=e("",{pathArray:V,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:U},T||void 0)}E=A?new r.g(d,A):new r.g(d);V=g(Z,d,E,new Array,m,z,w,S,D=D<0||D>3?0:D,v,n);const O=e(N,{pathArray:V,closeArray:j,closePath:B,updatable:k,sideOrientation:h,invertUV:C,frontUVs:M||void 0,backUVs:Q||void 0},T);return O._creationDataStorage.pathArray=V,O._creationDataStorage.path3D=E,O._creationDataStorage.cap=D,O}z.c.CreatePolygon=G,I.b.CreatePolygon=function(N,Z,d,X,I,m){return x(N,{shape:Z,holes:X,updatable:I,sideOrientation:m},d,arguments.length>6&&void 0!==arguments[6]?arguments[6]:earcut)},I.b.ExtrudePolygon=function(N,Z,d,X,I,m,z){return t(N,{shape:Z,holes:I,depth:d,updatable:m,sideOrientation:z},X,arguments.length>7&&void 0!==arguments[7]?arguments[7]:earcut)};function L(N,Z){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const m=Z.arc?Z.arc<=0||Z.arc>1?1:Z.arc:1,z=void 0===Z.closed||Z.closed,w=Z.shape,S=Z.i||1,j=Z.Vk||64,B=Z.clip||0,D=Z.updatable,v=I.b._GetDefaultSideOrientation(Z.sideOrientation),T=Z.cap||I.b.NO_CAP,k=2*Math.PI,h=[],U=Z.invertUV||!1;let C=0,M=0;const Q=k/j*m;let A,n;for(C=0;C<=j-B;C++){for(n=[],T!=I.b.CAP_START&&T!=I.b.CAP_ALL||(n.push(new X.n(0,w[0].y,0)),n.push(new X.n(Math.cos(C*Q)*w[0].x*S,w[0].y,Math.sin(C*Q)*w[0].x*S))),M=0;M<w.length;M++)A=new X.n(Math.cos(C*Q)*w[M].x*S,w[M].y,Math.sin(C*Q)*w[M].x*S),n.push(A);T!=I.b.CAP_END&&T!=I.b.CAP_ALL||(n.push(new X.n(Math.cos(C*Q)*w[w.length-1].x*S,w[w.length-1].y,Math.sin(C*Q)*w[w.length-1].x*S)),n.push(new X.n(0,w[w.length-1].y,0))),h.push(n)}return e(N,{pathArray:h,closeArray:z,sideOrientation:v,updatable:D,invertUV:U,frontUVs:Z.frontUVs,backUVs:Z.backUVs},d)}I.b.ExtrudeShape=function(N,Z,d,X,m,z){let w=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,S=arguments.length>7?arguments[7]:void 0,e=arguments.length>8?arguments[8]:void 0,j=arguments.length>9?arguments[9]:void 0;return q(N,{shape:Z,path:d,scale:X,rotation:m,cap:0===z?0:z||I.b.NO_CAP,sideOrientation:e,instance:j,updatable:S},w)},I.b.ExtrudeShapeCustom=(N,Z,d,X,m,z,w,S,e,j,B,D)=>Y(N,{shape:Z,path:d,scaleFunction:X,rotationFunction:m,ribbonCloseArray:z,ribbonClosePath:w,cap:0===S?0:S||I.b.NO_CAP,sideOrientation:B,instance:D,updatable:j},e);I.b.CreateLathe=(N,Z,d,X,I,m,z)=>L(N,{shape:Z,i:d,Vk:X,sideOrientation:z,updatable:m},I);var H=d(11433),i=d(11379);function p(N,Z){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const m=Z.path;let z=Z.instance,w=1;void 0!==Z.i?w=Z.i:z&&(w=z._creationDataStorage.i);const S=Z.Vk||64,j=Z.radiusFunction||null;let B=Z.cap||I.b.NO_CAP;const D=Z.invertUV||!1,v=Z.updatable,T=I.b._GetDefaultSideOrientation(Z.sideOrientation);Z.arc=Z.arc&&(Z.arc<=0||Z.arc>1)?1:Z.arc||1;const k=(N,Z,d,m,z,w,S,e)=>{const j=Z.getTangents(),B=Z.getNormals(),D=Z.getDistances(),v=2*Math.PI/z*e,T=w||(()=>m);let k,h,U,C;const M=X.h.Matrix[0];let Q=S===I.b.NO_CAP||S===I.b.CAP_END?0:2;for(let I=0;I<N.length;I++){h=T(I,D[I]),k=Array(),U=B[I];for(let Z=0;Z<z;Z++)X.c.RotationAxisToRef(j[I],v*Z,M),C=k[Z]?k[Z]:X.n.Zero(),X.n.TransformCoordinatesToRef(U,M,C),C.scaleInPlace(h).addInPlace(N[I]),k[Z]=C;d[Q]=k,Q++}const A=(Z,d)=>{const X=Array();for(let I=0;I<Z;I++)X.push(N[d]);return X};switch(S){case I.b.NO_CAP:break;case I.b.CAP_START:d[0]=A(z,0),d[1]=d[2].slice(0);break;case I.b.CAP_END:d[Q]=d[Q-1].slice(0),d[Q+1]=A(z,N.length-1);break;case I.b.CAP_ALL:d[0]=A(z,0),d[1]=d[2].slice(0),d[Q]=d[Q-1].slice(0),d[Q+1]=A(z,N.length-1)}return d};let h,U;if(z){const N=z._creationDataStorage,d=Z.arc||N.arc;return h=N.path3D.update(m),U=k(m,h,N.pathArray,w,N.Vk,j,N.cap,d),z=e("",{pathArray:U,instance:z}),N.path3D=h,N.pathArray=U,N.arc=d,N.i=w,z}h=new r.g(m);B=B<0||B>3?0:B,U=k(m,h,new Array,w,S,j,B,Z.arc);const C=e(N,{pathArray:U,closePath:!0,closeArray:!1,updatable:v,sideOrientation:T,invertUV:D,frontUVs:Z.frontUVs,backUVs:Z.backUVs},d);return C._creationDataStorage.pathArray=U,C._creationDataStorage.path3D=h,C._creationDataStorage.Vk=S,C._creationDataStorage.cap=B,C._creationDataStorage.arc=Z.arc,C._creationDataStorage.i=w,C}function y(N){const Z=[];Z[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},Z[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},Z[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},Z[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},Z[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},Z[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},Z[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},Z[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},Z[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},Z[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},Z[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},Z[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},Z[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},Z[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},Z[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const d=N.type&&(N.type<0||N.type>=Z.length)?0:N.type||0,I=N.size,m=N.sizeX||I||1,S=N.sizeY||I||1,e=N.sizeZ||I||1,j=N.custom||Z[d],B=j.face.length,v=N.faceUV||new Array(B),T=N.faceColors,k=void 0===N.flat||N.flat,h=0===N.sideOrientation?0:N.sideOrientation||z.c.DEFAULTSIDE,U=[],C=[],M=[],Q=[],A=[];let n=0,g=0;const E=[];let V,O,K,r,P,W,b=0,J=0;if(k)for(J=0;J<B;J++)T&&void 0===T[J]&&(T[J]=new D.e(1,1,1,1)),v&&void 0===v[J]&&(v[J]=new X.q(0,0,1,1));if(k)for(J=0;J<B;J++){const N=j.face[J].length;for(K=2*Math.PI/N,r=.5*Math.tan(K/2),P=.5,b=0;b<N;b++)U.push(j.vertex[j.face[J][b]][0]*m,j.vertex[j.face[J][b]][1]*S,j.vertex[j.face[J][b]][2]*e),E.push(n),n++,V=v[J].x+(v[J].z-v[J].x)*(.5+r),O=v[J].y+(v[J].w-v[J].y)*(P-.5),Q.push(V,w.b?1-O:O),W=r*Math.cos(K)-P*Math.sin(K),P=r*Math.sin(K)+P*Math.cos(K),r=W,T&&A.push(T[J].r,T[J].g,T[J].b,T[J].a);for(b=0;b<N-2;b++)C.push(E[0+g],E[b+2+g],E[b+1+g]);g+=N}else{for(b=0;b<j.vertex.length;b++)U.push(j.vertex[b][0]*m,j.vertex[b][1]*S,j.vertex[b][2]*e),Q.push(0,w.b?1:0);for(J=0;J<B;J++)for(b=0;b<j.face[J].length-2;b++)C.push(j.face[J][0],j.face[J][b+2],j.face[J][b+1])}z.c.ComputeNormals(U,C,M),z.c._ComputeSides(h,U,C,M,Q,N.frontUVs,N.backUVs);const F=new z.c;return F.xa=U,F.indices=C,F.ya=M,F.Aa=Q,T&&k&&(F.za=A),F}function l(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const X=new I.b(N,d);Z.sideOrientation=I.b._GetDefaultSideOrientation(Z.sideOrientation),X._originalBuilderSideOrientation=Z.sideOrientation;return y(Z).Ca(X,Z.updatable),X}I.b.CreateTube=(N,Z,d,X,I,m,z,w,S,e)=>p(N,{path:Z,i:d,Vk:X,radiusFunction:I,arc:1,cap:m,updatable:w,sideOrientation:S,instance:e},z);function u(N){const Z=N.sideOrientation||z.c.DEFAULTSIDE,d=N.i||1,I=void 0===N.flat||N.flat,m=0|(N.subdivisions||4),S=N.radiusX||d,e=N.radiusY||d,j=N.radiusZ||d,B=(1+Math.sqrt(5))/2,D=[-1,B,-0,1,B,0,-1,-B,0,1,-B,0,0,-1,-B,0,1,-B,0,-1,B,0,1,B,B,0,1,B,0,-1,-B,0,1,-B,0,-1],v=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],T=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],k=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],h=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],U=[],C=[],M=[],Q=[];let A=0;const n=new Array(3),g=new Array(3);let E;for(E=0;E<3;E++)n[E]=X.n.Zero(),g[E]=X.l.Zero();for(let z=0;z<20;z++){for(E=0;E<3;E++){const N=v[3*z+E];n[E].fd(D[3*T[N]],D[3*T[N]+1],D[3*T[N]+2]),n[E].normalize(),g[E].fd(.134765625*k[2*N]+.05859375+-.0390625*h[z],.2333984375*k[2*N+1]+.025390625+.01953125*h[z])}const N=(N,Z,d,z)=>{const B=X.n.Lerp(n[0],n[2],Z/m),D=X.n.Lerp(n[1],n[2],Z/m),v=m===Z?n[2]:X.n.Lerp(B,D,N/(m-Z));let T;if(v.normalize(),I){const N=X.n.Lerp(n[0],n[2],z/m),Z=X.n.Lerp(n[1],n[2],z/m);T=X.n.Lerp(N,Z,d/(m-z))}else T=new X.n(v.x,v.y,v.z);T.x/=S,T.y/=e,T.z/=j,T.normalize();const k=X.l.Lerp(g[0],g[2],Z/m),h=X.l.Lerp(g[1],g[2],Z/m),E=m===Z?g[2]:X.l.Lerp(k,h,N/(m-Z));C.push(v.x*S,v.y*e,v.z*j),M.push(T.x,T.y,T.z),Q.push(E.x,w.b?1-E.y:E.y),U.push(A),A++};for(let Z=0;Z<m;Z++)for(let d=0;d+Z<m;d++)N(d,Z,d+1/3,Z+1/3),N(d+1,Z,d+1/3,Z+1/3),N(d,Z+1,d+1/3,Z+1/3),d+Z+1<m&&(N(d+1,Z,d+2/3,Z+2/3),N(d+1,Z+1,d+2/3,Z+2/3),N(d,Z+1,d+2/3,Z+2/3))}z.c._ComputeSides(Z,C,U,M,Q,N.frontUVs,N.backUVs);const V=new z.c;return V.indices=U,V.xa=C,V.ya=M,V.Aa=Q,V}function a(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const X=new I.b(N,d);Z.sideOrientation=I.b._GetDefaultSideOrientation(Z.sideOrientation),X._originalBuilderSideOrientation=Z.sideOrientation;return u(Z).Ca(X,Z.updatable),X}z.c.CreatePolyhedron=y,I.b.CreatePolyhedron=(N,Z,d)=>l(N,Z,d);z.c.CreateIcoSphere=u,I.b.CreateIcoSphere=(N,Z,d)=>a(N,Z,d);var c=d(994);const R=new X.n(1,0,0),f=new X.n(-1,0,0),o=new X.n(0,1,0),NN=new X.n(0,-1,0),ZN=new X.n(0,0,1),dN=new X.n(0,0,-1);class XN{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:X.n.Zero(),Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:X.n.Up(),d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:X.l.Zero(),I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,m=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,w=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,e=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=N,this.ld=Z,this.uv=d,this.vertexIdx=I,this.vertexIdxForBones=m,this.localPositionOverride=z,this.localNormalOverride=w,this.matrixIndicesOverride=S,this.matrixWeightsOverride=e}clone(){var N,Z,d,X;return new XN(this.position.clone(),this.ld.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(N=this.localPositionOverride)||void 0===N?void 0:N.slice(),null===(Z=this.localNormalOverride)||void 0===Z?void 0:Z.slice(),null===(d=this.matrixIndicesOverride)||void 0===d?void 0:d.slice(),null===(X=this.matrixWeightsOverride)||void 0===X?void 0:X.slice())}}function IN(N,Z,d){var S,e,j,B;const D=!!Z.skeleton,v=d.localMode||D,T=Z.ge(),k=D?Z.Hf(!0,!0):Z.getVerticesData(m.d.PositionKind),h=D?Z.getNormalsData(!0,!0):Z.getVerticesData(m.d.NormalKind),U=v?D?Z.getVerticesData(m.d.PositionKind):k:null,C=v?D?Z.getVerticesData(m.d.NormalKind):h:null,M=Z.getVerticesData(m.d.UVKind),Q=D?Z.getVerticesData(m.d.MatricesIndicesKind):null,A=D?Z.getVerticesData(m.d.MatricesWeightsKind):null,n=D?Z.getVerticesData(m.d.MatricesIndicesExtraKind):null,g=D?Z.getVerticesData(m.d.MatricesWeightsExtraKind):null,E=d.position||X.n.Zero();let V=d.ld||X.n.Up();const O=d.size||X.n.One(),K=d.angle||0;if(!V){const N=new X.n(0,0,1),d=Z.va().activeCamera,I=X.n.TransformCoordinates(N,d.getWorldMatrix());V=d.globalPosition.rc(I)}const r=-Math.atan2(V.z,V.x)-Math.PI/2,P=Math.sqrt(V.x*V.x+V.z*V.z),W=Math.atan2(V.y,P),b=new z.c;b.indices=[],b.xa=[],b.ya=[],b.Aa=[],b.matricesIndices=D?[]:null,b.matricesWeights=D?[]:null,b.matricesIndicesExtra=n?[]:null,b.matricesWeightsExtra=g?[]:null;let J=0;const F=(N,Z)=>{const I=new XN;if(!T||!k||!h)return I;const m=T[N];if(I.vertexIdx=3*m,I.vertexIdxForBones=4*m,I.position=new X.n(k[3*m],k[3*m+1],k[3*m+2]),X.n.TransformCoordinatesToRef(I.position,Z,I.position),I.ld=new X.n(h[3*m],h[3*m+1],h[3*m+2]),X.n.TransformNormalToRef(I.ld,Z,I.ld),d.captureUVS&&M){const N=M[2*m+1];I.uv=new X.l(M[2*m],w.b?1-N:N)}return I},G=[0,0,0,0],x=(N,Z)=>{if(0===N.length)return N;const d=.5*Math.abs(X.n.Dot(O,Z)),I=(N,Z,d,X)=>{for(let I=0;I<X;++I)if(N[d+I]===Z)return d+I;return-1},m=(N,m)=>{const z=X.n.GetClipFactor(N.position,m.position,Z,d);let w=G,S=G;if(Q&&A){const Z=N.matrixIndicesOverride?0:N.vertexIdxForBones,d=N.matrixIndicesOverride??Q,X=N.matrixWeightsOverride??A,e=m.matrixIndicesOverride?0:m.vertexIdxForBones,j=m.matrixIndicesOverride??Q,B=m.matrixWeightsOverride??A;w=[0,0,0,0],S=[0,0,0,0];let D=0;for(let N=0;N<4;++N)if(X[Z+N]>0){const m=I(j,d[Z+N],e,4);w[D]=d[Z+N],S[D]=(0,c.o)(X[Z+N],m>=0?B[m]:0,z),D++}for(let N=0;N<4&&D<4;++N){const X=j[e+N];-1===I(d,X,Z,4)&&(w[D]=X,S[D]=(0,c.o)(0,B[e+N],z),D++)}const v=S[0]+S[1]+S[2]+S[3];S[0]/=v,S[1]/=v,S[2]/=v,S[3]/=v}const e=N.localPositionOverride?N.localPositionOverride[0]:(null===U||void 0===U?void 0:U[N.vertexIdx])??0,j=N.localPositionOverride?N.localPositionOverride[1]:(null===U||void 0===U?void 0:U[N.vertexIdx+1])??0,B=N.localPositionOverride?N.localPositionOverride[2]:(null===U||void 0===U?void 0:U[N.vertexIdx+2])??0,D=m.localPositionOverride?m.localPositionOverride[0]:(null===U||void 0===U?void 0:U[m.vertexIdx])??0,v=m.localPositionOverride?m.localPositionOverride[1]:(null===U||void 0===U?void 0:U[m.vertexIdx+1])??0,T=m.localPositionOverride?m.localPositionOverride[2]:(null===U||void 0===U?void 0:U[m.vertexIdx+2])??0,k=N.localNormalOverride?N.localNormalOverride[0]:(null===C||void 0===C?void 0:C[N.vertexIdx])??0,h=N.localNormalOverride?N.localNormalOverride[1]:(null===C||void 0===C?void 0:C[N.vertexIdx+1])??0,M=N.localNormalOverride?N.localNormalOverride[2]:(null===C||void 0===C?void 0:C[N.vertexIdx+2])??0,n=k+((m.localNormalOverride?m.localNormalOverride[0]:(null===C||void 0===C?void 0:C[m.vertexIdx])??0)-k)*z,g=h+((m.localNormalOverride?m.localNormalOverride[1]:(null===C||void 0===C?void 0:C[m.vertexIdx+1])??0)-h)*z,E=M+((m.localNormalOverride?m.localNormalOverride[2]:(null===C||void 0===C?void 0:C[m.vertexIdx+2])??0)-M)*z,V=Math.sqrt(n*n+g*g+E*E);return new XN(X.n.Lerp(N.position,m.position,z),X.n.Lerp(N.ld,m.ld,z).normalize(),X.l.Lerp(N.uv,m.uv,z),-1,-1,U?[e+(D-e)*z,j+(v-j)*z,B+(T-B)*z]:null,C?[n/V,g/V,E/V]:null,w,S)};let z=null;N.length>3&&(z=[]);for(let w=0;w<N.length;w+=3){let I=0,S=null,e=null,j=null,B=null;const D=X.n.Dot(N[w].position,Z)-d>0,v=X.n.Dot(N[w+1].position,Z)-d>0,T=X.n.Dot(N[w+2].position,Z)-d>0;switch(I=(D?1:0)+(v?1:0)+(T?1:0),I){case 0:N.length>3?(z.push(N[w]),z.push(N[w+1]),z.push(N[w+2])):z=N;break;case 1:if(z=z??new Array,D&&(S=N[w+1],e=N[w+2],j=m(N[w],S),B=m(N[w],e)),v){S=N[w],e=N[w+2],j=m(N[w+1],S),B=m(N[w+1],e),z.push(j),z.push(e.clone()),z.push(S.clone()),z.push(e.clone()),z.push(j.clone()),z.push(B);break}T&&(S=N[w],e=N[w+1],j=m(N[w+2],S),B=m(N[w+2],e)),S&&e&&j&&B&&(z.push(S.clone()),z.push(e.clone()),z.push(j),z.push(B),z.push(j.clone()),z.push(e.clone()));break;case 2:z=z??new Array,D||(S=N[w].clone(),e=m(S,N[w+1]),j=m(S,N[w+2]),z.push(S),z.push(e),z.push(j)),v||(S=N[w+1].clone(),e=m(S,N[w+2]),j=m(S,N[w]),z.push(S),z.push(e),z.push(j)),T||(S=N[w+2].clone(),e=m(S,N[w]),j=m(S,N[w+1]),z.push(S),z.push(e),z.push(j))}}return z},t=Z instanceof I.b?Z:null,q=null===t||void 0===t?void 0:t._thinInstanceDataStorage.matrixData,Y=(null===t||void 0===t?void 0:t.Pj)||1,s=X.h.Matrix[0];s.p(X.c.IdentityReadOnly);for(let I=0;I<Y;++I){if(null!==t&&void 0!==t&&t.hasThinInstances&&q){const N=16*I;s.setRowFromFloats(0,q[N+0],q[N+1],q[N+2],q[N+3]),s.setRowFromFloats(1,q[N+4],q[N+5],q[N+6],q[N+7]),s.setRowFromFloats(2,q[N+8],q[N+9],q[N+10],q[N+11]),s.setRowFromFloats(3,q[N+12],q[N+13],q[N+14],q[N+15])}const N=X.c.RotationYawPitchRoll(r,W,K).multiply(X.c.Translation(E.x,E.y,E.z)),m=X.c.Invert(N),z=Z.getWorldMatrix(),S=s.multiply(z).multiply(m),e=new Array(3);for(let Z=0;Z<T.length;Z+=3){let N=e;if(N[0]=F(Z,S),N[1]=F(Z+1,S),N[2]=F(Z+2,S),!(d.cullBackFaces&&-N[0].ld.z<=0&&-N[1].ld.z<=0&&-N[2].ld.z<=0)&&(N=x(N,R),N&&(N=x(N,f),N&&(N=x(N,o),N&&(N=x(N,NN),N&&(N=x(N,ZN),N&&(N=x(N,dN),N)))))))for(let Z=0;Z<N.length;Z++){const X=N[Z];if(b.indices.push(J),v?(X.localPositionOverride?(b.xa[3*J]=X.localPositionOverride[0],b.xa[3*J+1]=X.localPositionOverride[1],b.xa[3*J+2]=X.localPositionOverride[2]):U&&(b.xa[3*J]=U[X.vertexIdx],b.xa[3*J+1]=U[X.vertexIdx+1],b.xa[3*J+2]=U[X.vertexIdx+2]),X.localNormalOverride?(b.ya[3*J]=X.localNormalOverride[0],b.ya[3*J+1]=X.localNormalOverride[1],b.ya[3*J+2]=X.localNormalOverride[2]):C&&(b.ya[3*J]=C[X.vertexIdx],b.ya[3*J+1]=C[X.vertexIdx+1],b.ya[3*J+2]=C[X.vertexIdx+2])):(X.position.toArray(b.xa,3*J),X.ld.toArray(b.ya,3*J)),b.matricesIndices&&b.matricesWeights&&(X.matrixIndicesOverride?(b.matricesIndices[4*J]=X.matrixIndicesOverride[0],b.matricesIndices[4*J+1]=X.matrixIndicesOverride[1],b.matricesIndices[4*J+2]=X.matrixIndicesOverride[2],b.matricesIndices[4*J+3]=X.matrixIndicesOverride[3]):(Q&&(b.matricesIndices[4*J]=Q[X.vertexIdxForBones],b.matricesIndices[4*J+1]=Q[X.vertexIdxForBones+1],b.matricesIndices[4*J+2]=Q[X.vertexIdxForBones+2],b.matricesIndices[4*J+3]=Q[X.vertexIdxForBones+3]),n&&b.matricesIndicesExtra&&(b.matricesIndicesExtra[4*J]=n[X.vertexIdxForBones],b.matricesIndicesExtra[4*J+1]=n[X.vertexIdxForBones+1],b.matricesIndicesExtra[4*J+2]=n[X.vertexIdxForBones+2],b.matricesIndicesExtra[4*J+3]=n[X.vertexIdxForBones+3])),X.matrixWeightsOverride?(b.matricesWeights[4*J]=X.matrixWeightsOverride[0],b.matricesWeights[4*J+1]=X.matrixWeightsOverride[1],b.matricesWeights[4*J+2]=X.matrixWeightsOverride[2],b.matricesWeights[4*J+3]=X.matrixWeightsOverride[3]):(A&&(b.matricesWeights[4*J]=A[X.vertexIdxForBones],b.matricesWeights[4*J+1]=A[X.vertexIdxForBones+1],b.matricesWeights[4*J+2]=A[X.vertexIdxForBones+2],b.matricesWeights[4*J+3]=A[X.vertexIdxForBones+3]),g&&b.matricesWeightsExtra&&(b.matricesWeightsExtra[4*J]=g[X.vertexIdxForBones],b.matricesWeightsExtra[4*J+1]=g[X.vertexIdxForBones+1],b.matricesWeightsExtra[4*J+2]=g[X.vertexIdxForBones+2],b.matricesWeightsExtra[4*J+3]=g[X.vertexIdxForBones+3]))),d.captureUVS)X.uv.toArray(b.Aa,2*J);else{b.Aa.push(.5+X.position.x/O.x);const N=.5+X.position.y/O.y;b.Aa.push(w.b?1-N:N)}J++}}}0===b.indices.length&&(b.indices=null),0===b.xa.length&&(b.xa=null),0===b.ya.length&&(b.ya=null),0===b.Aa.length&&(b.Aa=null),0===(null===(S=b.matricesIndices)||void 0===S?void 0:S.length)&&(b.matricesIndices=null),0===(null===(e=b.matricesWeights)||void 0===e?void 0:e.length)&&(b.matricesWeights=null),0===(null===(j=b.matricesIndicesExtra)||void 0===j?void 0:j.length)&&(b.matricesIndicesExtra=null),0===(null===(B=b.matricesWeightsExtra)||void 0===B?void 0:B.length)&&(b.matricesWeightsExtra=null);const L=new I.b(N,Z.va());return b.Ca(L),v?(L.skeleton=Z.skeleton,L.parent=Z):(L.position=E.clone(),L.rotation=new X.n(W,r,K)),L.be(!0),L.refreshBoundingInfo(!0,!0),L}function mN(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,Vk:16,height:1,i:.25,capSubdivisions:6};const Z=0|Math.max(N.subdivisions?N.subdivisions:2,1),d=0|Math.max(N.Vk?N.Vk:16,3),I=Math.max(N.height?N.height:1,0),m=Math.max(N.i?N.i:.25,0),S=0|Math.max(N.capSubdivisions?N.capSubdivisions:6,1),e=d,j=Z,B=Math.max(N.radiusTop?N.radiusTop:m,0),D=Math.max(N.radiusBottom?N.radiusBottom:m,0),v=I-(B+D),T=2*Math.PI,k=Math.max(N.topCapSubdivisions?N.topCapSubdivisions:S,1),h=Math.max(N.bottomCapSubdivisions?N.bottomCapSubdivisions:S,1),U=Math.acos((D-B)/I);let C=[];const M=[],Q=[],A=[];let n=0;const g=[],E=.5*v,V=.5*Math.PI;let O,K;const r=X.n.Zero(),P=X.n.Zero(),W=Math.cos(U),b=Math.sin(U),J=new X.l(B*b,E+B*W).rc(new X.l(D*b,D*W-E)).length(),F=B*U+J+D*(V-U);let G=0;for(K=0;K<=k;K++){const N=[],Z=V-U*(K/k);G+=B*U/k;const d=Math.cos(Z),X=Math.sin(Z),I=d*B;for(O=0;O<=e;O++){const Z=O/e,m=Z*T+0,z=Math.sin(m),S=Math.cos(m);P.x=I*z,P.y=E+X*B,P.z=I*S,M.push(P.x,P.y,P.z),r.set(d*z,X,d*S),Q.push(r.x,r.y,r.z),A.push(Z,w.b?G/F:1-G/F),N.push(n),n++}g.push(N)}const x=I-B-D+W*B-W*D,t=b*(D-B)/x;for(K=1;K<=j;K++){const N=[];G+=J/j;const Z=b*(K*(D-B)/j+B);for(O=0;O<=e;O++){const d=O/e,X=d*T+0,I=Math.sin(X),m=Math.cos(X);P.x=Z*I,P.y=E+W*B-K*x/j,P.z=Z*m,M.push(P.x,P.y,P.z),r.set(I,t,m).normalize(),Q.push(r.x,r.y,r.z),A.push(d,w.b?G/F:1-G/F),N.push(n),n++}g.push(N)}for(K=1;K<=h;K++){const N=[],Z=V-U-(Math.PI-U)*(K/h);G+=D*U/h;const d=Math.cos(Z),X=Math.sin(Z),I=d*D;for(O=0;O<=e;O++){const Z=O/e,m=Z*T+0,z=Math.sin(m),S=Math.cos(m);P.x=I*z,P.y=X*D-E,P.z=I*S,M.push(P.x,P.y,P.z),r.set(d*z,X,d*S),Q.push(r.x,r.y,r.z),A.push(Z,w.b?G/F:1-G/F),N.push(n),n++}g.push(N)}for(O=0;O<e;O++)for(K=0;K<k+j+h;K++){const N=g[K][O],Z=g[K+1][O],d=g[K+1][O+1],X=g[K][O+1];C.push(N),C.push(Z),C.push(X),C.push(Z),C.push(d),C.push(X)}if(C=C.reverse(),N.orientation&&!N.orientation.equals(X.n.Up())){const Z=new X.c;N.orientation.clone().scale(.5*Math.PI).cross(X.n.Up()).toQuaternion().toRotationMatrix(Z);const d=X.n.Zero();for(let N=0;N<M.length;N+=3)d.set(M[N],M[N+1],M[N+2]),X.n.TransformCoordinatesToRef(d.clone(),Z,d),M[N]=d.x,M[N+1]=d.y,M[N+2]=d.z}const q=new z.c;return q.xa=M,q.ya=Q,q.Aa=A,q.indices=C,q}function zN(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:X.n.Up(),subdivisions:2,Vk:16,height:1,i:.25,capSubdivisions:6,updatable:!1},d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const m=new I.b(N,d);return mN(Z).Ca(m,Z.updatable),m}I.b.CreateDecal=(N,Z,d,X,I,m)=>IN(N,Z,{position:d,ld:X,size:I,angle:m});I.b.CreateCapsule=(N,Z,d)=>zN(N,Z,d),z.c.CreateCapsule=mN;class wN{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=N,this.y=Z,N!==Math.floor(N)&&(N=Math.floor(N),K.e.Warn("x is not an integer, floor(x) used")),Z!==Math.floor(Z)&&(Z=Math.floor(Z),K.e.Warn("y is not an integer, floor(y) used"))}clone(){return new wN(this.x,this.y)}rotate60About(N){const Z=this.x;return this.x=N.x+N.y-this.y,this.y=Z+this.y-N.x,this}rotateNeg60About(N){const Z=this.x;return this.x=Z+this.y-N.y,this.y=N.x+N.y-Z,this}rotate120(N,Z){N!==Math.floor(N)&&(N=Math.floor(N),K.e.Warn("m not an integer only floor(m) used")),Z!==Math.floor(Z)&&(Z=Math.floor(Z),K.e.Warn("n not an integer only floor(n) used"));const d=this.x;return this.x=N-d-this.y,this.y=Z+d,this}rotateNeg120(N,Z){N!==Math.floor(N)&&(N=Math.floor(N),K.e.Warn("m is not an integer, floor(m) used")),Z!==Math.floor(Z)&&(Z=Math.floor(Z),K.e.Warn("n is not an integer,   floor(n) used"));const d=this.x;return this.x=this.y-Z,this.y=N+Z-d-this.y,this}toCartesianOrigin(N,Z){const d=X.n.Zero();return d.x=N.x+2*this.x*Z+this.y*Z,d.y=N.y+Math.sqrt(3)*this.y*Z,d}static Zero(){return new wN(0,0)}}class SN{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new eN("icosahedron","Regular",[[0,P.f,-1],[-P.f,1,0],[-1,0,-P.f],[1,0,-P.f],[P.f,1,0],[0,P.f,1],[-1,0,P.f],[-P.f,-1,0],[0,-P.f,-1],[P.f,-1,0],[1,0,P.f],[0,-P.f,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let N=12;const Z={},d=this.m,X=this.n;let I,m,z,w,S,e=d,j=1,B=0;0!==X&&(e=(0,c.h)(d,X)),j=d/e,B=X/e;const D=wN.Zero(),v=new wN(d,X),T=new wN(-X,d+X),k=wN.Zero(),h=wN.Zero(),U=wN.Zero();let C,M,Q,A,n=[];const g=[],E=this.vertByDist,V=(d,X,I,m)=>{C=d+"|"+I,M=X+"|"+m,C in Z||M in Z?C in Z&&!(M in Z)?Z[M]=Z[C]:M in Z&&!(C in Z)&&(Z[C]=Z[M]):(Z[C]=N,Z[M]=N,N++),E[I][0]>2?g[Z[C]]=[-E[I][0],E[I][1],Z[C]]:g[Z[C]]=[n[E[I][0]],E[I][1],Z[C]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let O=0;O<20;O++){if(n=this.IDATA.face[O],z=n[2],w=n[1],S=n[0],Q=D.x+"|"+D.y,C=O+"|"+Q,C in Z||(Z[C]=z,g[z]=[n[E[Q][0]],E[Q][1]]),Q=v.x+"|"+v.y,C=O+"|"+Q,C in Z||(Z[C]=w,g[w]=[n[E[Q][0]],E[Q][1]]),Q=T.x+"|"+T.y,C=O+"|"+Q,C in Z||(Z[C]=S,g[S]=[n[E[Q][0]],E[Q][1]]),I=this.IDATA.edgematch[O][0],m=this.IDATA.edgematch[O][1],"B"===m)for(let N=1;N<e;N++)h.x=d-N*(j+B),h.y=X+N*j,U.x=-N*B,U.y=N*(j+B),Q=h.x+"|"+h.y,A=U.x+"|"+U.y,V(O,I,Q,A);if("O"===m)for(let N=1;N<e;N++)U.x=-N*B,U.y=N*(j+B),k.x=N*j,k.y=N*B,Q=U.x+"|"+U.y,A=k.x+"|"+k.y,V(O,I,Q,A);if(I=this.IDATA.edgematch[O][2],m=this.IDATA.edgematch[O][3],m&&"A"===m)for(let N=1;N<e;N++)k.x=N*j,k.y=N*B,h.x=d-(e-N)*(j+B),h.y=X+(e-N)*j,Q=k.x+"|"+k.y,A=h.x+"|"+h.y,V(O,I,Q,A);for(let d=0;d<this.vertices.length;d++)Q=this.vertices[d].x+"|"+this.vertices[d].y,C=O+"|"+Q,C in Z||(Z[C]=N++,E[Q][0]>2?g[Z[C]]=[-E[Q][0],E[Q][1],Z[C]]:g[Z[C]]=[n[E[Q][0]],E[Q][1],Z[C]])}this.closestTo=g,this.vecToidx=Z}calcCoeffs(){const N=this.m,Z=this.n,d=Math.sqrt(3)/3,X=N*N+Z*Z+N*Z;this.coau=(N+Z)/X,this.cobu=-Z/X,this.coav=-d*(N-Z)/X,this.cobv=d*(2*N+Z)/X}createInnerFacets(){const N=this.m,Z=this.n;for(let d=0;d<Z+N+1;d++)for(let N=this.min[d];N<this.max[d]+1;N++)N<this.max[d]&&N<this.max[d+1]+1&&this.innerFacets.push(["|"+N+"|"+d,"|"+N+"|"+(d+1),"|"+(N+1)+"|"+d]),d>0&&N<this.max[d-1]&&N+1<this.max[d]+1&&this.innerFacets.push(["|"+N+"|"+d,"|"+(N+1)+"|"+d,"|"+(N+1)+"|"+(d-1)])}edgeVecsABOB(){const N=this.m,Z=this.n,d=new wN(-Z,N+Z);for(let X=1;X<N+Z;X++){const N=new wN(this.min[X],X),Z=new wN(this.min[X-1],X-1),I=new wN(this.min[X+1],X+1),m=N.clone(),z=Z.clone(),w=I.clone();m.rotate60About(d),z.rotate60About(d),w.rotate60About(d);const S=new wN(this.max[m.y],m.y),e=new wN(this.max[m.y-1],m.y-1),j=new wN(this.max[m.y-1]-1,m.y-1);m.x===S.x&&m.y===S.y||(m.x!==e.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([N,e,j]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([N,j,S])):m.y===w.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([N,Z,e]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([N,e,I])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([N,Z,e]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([N,e,S])))}}mapABOBtoOBOA(){const N=new wN(0,0);for(let Z=0;Z<this.isoVecsABOB.length;Z++){const d=[];for(let X=0;X<3;X++)N.x=this.isoVecsABOB[Z][X].x,N.y=this.isoVecsABOB[Z][X].y,0===this.vertexTypes[Z][X]&&N.rotateNeg120(this.m,this.n),d.push(N.clone());this.isoVecsOBOA.push(d)}}mapABOBtoBAOA(){const N=new wN(0,0);for(let Z=0;Z<this.isoVecsABOB.length;Z++){const d=[];for(let X=0;X<3;X++)N.x=this.isoVecsABOB[Z][X].x,N.y=this.isoVecsABOB[Z][X].y,1===this.vertexTypes[Z][X]&&N.rotate120(this.m,this.n),d.push(N.clone());this.isoVecsBAOA.push(d)}}MapToFace(N,Z){const d=this.IDATA.face[N],I=d[2],m=d[1],z=d[0],w=X.n._c(this.IDATA.vertex[I]),S=X.n._c(this.IDATA.vertex[m]),e=X.n._c(this.IDATA.vertex[z]),j=S.rc(w),B=e.rc(w),D=j.scale(this.coau).add(B.scale(this.cobu)),v=j.scale(this.coav).add(B.scale(this.cobv)),T=[];let k,h=X.h.kd[0];for(let X=0;X<this.cartesian.length;X++)h=D.scale(this.cartesian[X].x).add(v.scale(this.cartesian[X].y)).add(w),T[X]=[h.x,h.y,h.z],k=N+"|"+this.vertices[X].x+"|"+this.vertices[X].y,Z.vertex[this.vecToidx[k]]=[h.x,h.y,h.z]}build(N,Z){const d=[],X=wN.Zero(),I=new wN(N,Z),m=new wN(-Z,N+Z);d.push(X,I,m);for(let Q=Z;Q<N+1;Q++)for(let Z=0;Z<N+1-Q;Z++)d.push(new wN(Z,Q));if(Z>0){const X=(0,c.h)(N,Z),I=N/X,m=Z/X;for(let w=1;w<X;w++)d.push(new wN(w*I,w*m)),d.push(new wN(-w*m,w*(I+m))),d.push(new wN(N-w*(I+m),Z+w*I));const z=N/Z;for(let w=1;w<Z;w++)for(let X=0;X<w*z;X++)d.push(new wN(X,w)),d.push(new wN(X,w).rotate120(N,Z)),d.push(new wN(X,w).rotateNeg120(N,Z))}d.sort(((N,Z)=>N.x-Z.x)),d.sort(((N,Z)=>N.y-Z.y));const z=new Array(N+Z+1),w=new Array(N+Z+1);for(let Q=0;Q<z.length;Q++)z[Q]=1/0,w[Q]=-1/0;let S=0,e=0;const j=d.length;for(let Q=0;Q<j;Q++)e=d[Q].x,S=d[Q].y,z[S]=Math.min(e,z[S]),w[S]=Math.max(e,w[S]);const B=(d,X)=>{const I=d.clone();return"A"===X&&I.rotateNeg120(N,Z),"B"===X&&I.rotate120(N,Z),I.x<0?I.y:I.x+I.y},D=[],v=[],T=[],k=[],h={},U=[];let C=-1,M=-1;for(let Q=0;Q<j;Q++)D[Q]=d[Q].toCartesianOrigin(new wN(0,0),.5),v[Q]=B(d[Q],"O"),T[Q]=B(d[Q],"A"),k[Q]=B(d[Q],"B"),v[Q]===T[Q]&&T[Q]===k[Q]?(C=3,M=v[Q]):v[Q]===T[Q]?(C=4,M=v[Q]):T[Q]===k[Q]?(C=5,M=T[Q]):k[Q]===v[Q]&&(C=6,M=v[Q]),v[Q]<T[Q]&&v[Q]<k[Q]&&(C=2,M=v[Q]),T[Q]<v[Q]&&T[Q]<k[Q]&&(C=1,M=T[Q]),k[Q]<T[Q]&&k[Q]<v[Q]&&(C=0,M=k[Q]),U.push([C,M,d[Q].x,d[Q].y]);U.sort(((N,Z)=>N[2]-Z[2])),U.sort(((N,Z)=>N[3]-Z[3])),U.sort(((N,Z)=>N[1]-Z[1])),U.sort(((N,Z)=>N[0]-Z[0]));for(let Q=0;Q<U.length;Q++)h[U[Q][2]+"|"+U[Q][3]]=[U[Q][0],U[Q][1],Q];return this.m=N,this.n=Z,this.vertices=d,this.vertByDist=h,this.cartesian=D,this.min=z,this.max=w,this}}class eN{constructor(N,Z,d,X){this.name=N,this.category=Z,this.vertex=d,this.face=X}}class jN extends eN{innerToData(N,Z){for(let d=0;d<Z.innerFacets.length;d++)this.face.push(Z.innerFacets[d].map((d=>Z.vecToidx[N+d])))}mapABOBtoDATA(N,Z){const d=Z.IDATA.edgematch[N][0];for(let X=0;X<Z.isoVecsABOB.length;X++){const I=[];for(let m=0;m<3;m++)0===Z.vertexTypes[X][m]?I.push(N+"|"+Z.isoVecsABOB[X][m].x+"|"+Z.isoVecsABOB[X][m].y):I.push(d+"|"+Z.isoVecsABOB[X][m].x+"|"+Z.isoVecsABOB[X][m].y);this.face.push([Z.vecToidx[I[0]],Z.vecToidx[I[1]],Z.vecToidx[I[2]]])}}mapOBOAtoDATA(N,Z){const d=Z.IDATA.edgematch[N][0];for(let X=0;X<Z.isoVecsOBOA.length;X++){const I=[];for(let m=0;m<3;m++)1===Z.vertexTypes[X][m]?I.push(N+"|"+Z.isoVecsOBOA[X][m].x+"|"+Z.isoVecsOBOA[X][m].y):I.push(d+"|"+Z.isoVecsOBOA[X][m].x+"|"+Z.isoVecsOBOA[X][m].y);this.face.push([Z.vecToidx[I[0]],Z.vecToidx[I[1]],Z.vecToidx[I[2]]])}}mapBAOAtoDATA(N,Z){const d=Z.IDATA.edgematch[N][2];for(let X=0;X<Z.isoVecsBAOA.length;X++){const I=[];for(let m=0;m<3;m++)1===Z.vertexTypes[X][m]?I.push(N+"|"+Z.isoVecsBAOA[X][m].x+"|"+Z.isoVecsBAOA[X][m].y):I.push(d+"|"+Z.isoVecsBAOA[X][m].x+"|"+Z.isoVecsBAOA[X][m].y);this.face.push([Z.vecToidx[I[0]],Z.vecToidx[I[1]],Z.vecToidx[I[2]]])}}orderData(N){const Z=[];for(let m=0;m<13;m++)Z[m]=[];const d=N.closestTo;for(let m=0;m<d.length;m++)d[m][0]>-1?d[m][1]>0&&Z[d[m][0]].push([m,d[m][1]]):Z[12].push([m,d[m][0]]);const X=[];for(let m=0;m<12;m++)X[m]=m;let I=12;for(let m=0;m<12;m++){Z[m].sort(((N,Z)=>N[1]-Z[1]));for(let N=0;N<Z[m].length;N++)X[Z[m][N][0]]=I++}for(let m=0;m<Z[12].length;m++)X[Z[12][m][0]]=I++;for(let m=0;m<this.vertex.length;m++)this.vertex[m].push(X[m]);this.vertex.sort(((N,Z)=>N[3]-Z[3]));for(let m=0;m<this.vertex.length;m++)this.vertex[m].pop();for(let m=0;m<this.face.length;m++)for(let N=0;N<this.face[m].length;N++)this.face[m][N]=X[this.face[m][N]];this.sharedNodes=Z[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(N,Z){const d=[],X=[];let I=Z.pop();X.push(I);let m=this.face[I].indexOf(N);m=(m+2)%3;let z=this.face[I][m];d.push(z);let w=0;for(;Z.length>0;)I=Z[w],this.face[I].indexOf(z)>-1?(m=(this.face[I].indexOf(z)+1)%3,z=this.face[I][m],d.push(z),X.push(I),Z.splice(w,1),w=0):w++;return this.adjacentFaces.push(d),X}toGoldbergPolyhedronData(){const N=new eN("GeoDual","Goldberg",[],[]);N.name="GD dual";const Z=this.vertex.length,d=new Array(Z);for(let S=0;S<Z;S++)d[S]=[];for(let S=0;S<this.face.length;S++)for(let N=0;N<3;N++)d[this.face[S][N]].push(S);let X=0,I=0,m=0,z=[],w=[];this.adjacentFaces=[];for(let S=0;S<d.length;S++)N.face[S]=this.setOrder(S,d[S].concat([])),d[S].forEach((Z=>{X=0,I=0,m=0,z=this.face[Z];for(let N=0;N<3;N++)w=this.vertex[z[N]],X+=w[0],I+=w[1],m+=w[2];N.vertex[Z]=[X/3,I/3,m/3]}));return N}static BuildGeodesicData(N){const Z=new jN("Geodesic-m-n","Geodesic",[[0,P.f,-1],[-P.f,1,0],[-1,0,-P.f],[1,0,-P.f],[P.f,1,0],[0,P.f,1],[-1,0,P.f],[-P.f,-1,0],[0,-P.f,-1],[P.f,-1,0],[1,0,P.f],[0,-P.f,1]],[]);N.setIndices(),N.calcCoeffs(),N.createInnerFacets(),N.edgeVecsABOB(),N.mapABOBtoOBOA(),N.mapABOBtoBAOA();for(let d=0;d<N.IDATA.face.length;d++)N.MapToFace(d,Z),Z.innerToData(d,N),"B"===N.IDATA.edgematch[d][1]&&Z.mapABOBtoDATA(d,N),"O"===N.IDATA.edgematch[d][1]&&Z.mapOBOAtoDATA(d,N),"A"===N.IDATA.edgematch[d][3]&&Z.mapBAOAtoDATA(d,N);Z.orderData(N);return Z.vertex=Z.vertex.map((function(N){const Z=N[0],d=N[1],X=N[2],I=Math.sqrt(Z*Z+d*d+X*X);return N[0]*=1/I,N[1]*=1/I,N[2]*=1/I,N})),Z}}I.b._GoldbergMeshParser=(N,Z)=>BN.Parse(N,Z);class BN extends I.b{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(N,Z){return void 0===Z?(N>this.goldbergData.nbUnsharedFaces-1&&(K.e.Warn("Maximum number of unshared faces used"),N=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+N):(N>11&&(K.e.Warn("Last pole used"),N=11),Z>this.goldbergData.nbFacesAtPole-1&&(K.e.Warn("Maximum number of faces at a pole used"),Z=this.goldbergData.nbFacesAtPole-1),12+N*this.goldbergData.nbFacesAtPole+Z)}_changeGoldbergFaceColors(N){for(let d=0;d<N.length;d++){const Z=N[d][0],X=N[d][1],I=N[d][2];for(let N=Z;N<X+1;N++)this.goldbergData.faceColors[N]=I}const Z=[];for(let d=0;d<12;d++)for(let N=0;N<5;N++)Z.push(this.goldbergData.faceColors[d].r,this.goldbergData.faceColors[d].g,this.goldbergData.faceColors[d].b,this.goldbergData.faceColors[d].a);for(let d=12;d<this.goldbergData.faceColors.length;d++)for(let N=0;N<6;N++)Z.push(this.goldbergData.faceColors[d].r,this.goldbergData.faceColors[d].g,this.goldbergData.faceColors[d].b,this.goldbergData.faceColors[d].a);return Z}setGoldbergFaceColors(N){const Z=this._changeGoldbergFaceColors(N);this.Ga(m.d.ColorKind,Z)}updateGoldbergFaceColors(N){const Z=this._changeGoldbergFaceColors(N);this.updateVerticesData(m.d.ColorKind,Z)}_changeGoldbergFaceUVs(N){const Z=this.getVerticesData(m.d.UVKind);for(let d=0;d<N.length;d++){const X=N[d][0],I=N[d][1],m=N[d][2],z=N[d][3],w=N[d][4],S=[],e=[];let j,B;for(let N=0;N<5;N++)j=m.x+z*Math.cos(w+N*Math.PI/2.5),B=m.y+z*Math.sin(w+N*Math.PI/2.5),j<0&&(j=0),j>1&&(j=1),S.push(j,B);for(let N=0;N<6;N++)j=m.x+z*Math.cos(w+N*Math.PI/3),B=m.y+z*Math.sin(w+N*Math.PI/3),j<0&&(j=0),j>1&&(j=1),e.push(j,B);for(let N=X;N<Math.min(12,I+1);N++)for(let d=0;d<5;d++)Z[10*N+2*d]=S[2*d],Z[10*N+2*d+1]=S[2*d+1];for(let N=Math.max(12,X);N<I+1;N++)for(let d=0;d<6;d++)Z[12*N-24+2*d]=e[2*d],Z[12*N-23+2*d]=e[2*d+1]}return Z}setGoldbergFaceUVs(N){const Z=this._changeGoldbergFaceUVs(N);this.Ga(m.d.UVKind,Z)}updateGoldbergFaceUVs(N){const Z=this._changeGoldbergFaceUVs(N);this.updateVerticesData(m.d.UVKind,Z)}placeOnGoldbergFaceAt(N,Z,d){const I=X.n.RotationFromAxis(this.goldbergData.faceXaxis[Z],this.goldbergData.faceYaxis[Z],this.goldbergData.faceZaxis[Z]);N.rotation=I,N.position=this.goldbergData.faceCenters[Z].add(this.goldbergData.faceXaxis[Z].scale(d.x)).add(this.goldbergData.faceYaxis[Z].scale(d.y)).add(this.goldbergData.faceZaxis[Z].scale(d.z))}serialize(N){super.serialize(N),N.type="GoldbergMesh";const Z={};if(Z.adjacentFaces=this.goldbergData.adjacentFaces,Z.nbSharedFaces=this.goldbergData.nbSharedFaces,Z.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,Z.nbFaces=this.goldbergData.nbFaces,Z.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){Z.faceColors=[];for(const N of this.goldbergData.faceColors)Z.faceColors.push(N.ed())}if(this.goldbergData.faceCenters){Z.faceCenters=[];for(const N of this.goldbergData.faceCenters)Z.faceCenters.push(N.ed())}if(this.goldbergData.faceZaxis){Z.faceZaxis=[];for(const N of this.goldbergData.faceZaxis)Z.faceZaxis.push(N.ed())}if(this.goldbergData.faceYaxis){Z.faceYaxis=[];for(const N of this.goldbergData.faceYaxis)Z.faceYaxis.push(N.ed())}if(this.goldbergData.faceXaxis){Z.faceXaxis=[];for(const N of this.goldbergData.faceXaxis)Z.faceXaxis.push(N.ed())}N.goldbergData=Z}static Parse(N,Z){const d=N.goldbergData;d.faceColors=d.faceColors.map((N=>D.e._c(N))),d.faceCenters=d.faceCenters.map((N=>X.n._c(N))),d.faceZaxis=d.faceZaxis.map((N=>X.n._c(N))),d.faceXaxis=d.faceXaxis.map((N=>X.n._c(N))),d.faceYaxis=d.faceYaxis.map((N=>X.n._c(N)));const I=new BN(N.name,Z);return I.goldbergData=d,I}}var DN=d(11370);class vN{constructor(N){this._paths=[],this._tempPaths=[],this._holes=[],this._resolution=N}moveTo(N,Z){this._currentPath=new r.f(N,Z),this._tempPaths.push(this._currentPath)}lineTo(N,Z){this._currentPath.addLineTo(N,Z)}quadraticCurveTo(N,Z,d,X){this._currentPath.addQuadraticCurveTo(N,Z,d,X,this._resolution)}bezierCurveTo(N,Z,d,X,I,m){this._currentPath.addBezierCurveTo(N,Z,d,X,I,m,this._resolution)}extractHoles(){for(const N of this._tempPaths)N.area()>0?this._holes.push(N):this._paths.push(N);if(!this._paths.length&&this._holes.length){const N=this._holes;this._holes=this._paths,this._paths=N}this._tempPaths.length=0}get paths(){return this._paths}get holes(){return this._holes}}function TN(N,Z,d,X,I,m){const z=m.glyphs[N]||m.glyphs["?"];if(!z)return null;const w=new vN(I);if(z.o){const N=z.o.split(" ");for(let I=0,m=N.length;I<m;){switch(N[I++]){case"m":{const m=parseInt(N[I++])*Z+d,z=parseInt(N[I++])*Z+X;w.moveTo(m,z);break}case"l":{const m=parseInt(N[I++])*Z+d,z=parseInt(N[I++])*Z+X;w.lineTo(m,z);break}case"q":{const m=parseInt(N[I++])*Z+d,z=parseInt(N[I++])*Z+X,S=parseInt(N[I++])*Z+d,e=parseInt(N[I++])*Z+X;w.quadraticCurveTo(S,e,m,z);break}case"b":{const m=parseInt(N[I++])*Z+d,z=parseInt(N[I++])*Z+X,S=parseInt(N[I++])*Z+d,e=parseInt(N[I++])*Z+X,j=parseInt(N[I++])*Z+d,B=parseInt(N[I++])*Z+X;w.bezierCurveTo(S,e,j,B,m,z);break}}}}return w.extractHoles(),{offsetX:z.ha*Z,shapePath:w}}const kN={CreateBox:B.i,CreateTiledBox:h,CreateSphere:U.d,mb:j.e,CreateIcoSphere:a,CreateRibbon:e,CreateCylinder:A,CreateTorus:g,CreateTorusKnot:V,CreateLineSystem:O.h,nb:O.l,CreateDashedLines:O.d,ExtrudeShape:q,ExtrudeShapeCustom:Y,CreateLathe:L,CreateTiledPlane:T,yg:H.c,CreateGround:i.g,CreateTiledGround:i.k,CreateGroundFromHeightMap:i.d,CreatePolygon:x,ExtrudePolygon:t,CreateTube:p,CreatePolyhedron:l,CreateGeodesic:function(N,Z){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,X=Z.m||1;X!==Math.floor(X)&&(X=Math.floor(X),K.e.Warn("m not an integer only floor(m) used"));let I=Z.n||0;if(I!==Math.floor(I)&&(I=Math.floor(I),K.e.Warn("n not an integer only floor(n) used")),I>X){const N=I;I=X,X=N,K.e.Warn("n > m therefore m and n swapped")}const m=new SN;return m.build(X,I),l(N,{custom:jN.BuildGeodesicData(m),size:Z.size,sizeX:Z.sizeX,sizeY:Z.sizeY,sizeZ:Z.sizeZ,faceUV:Z.faceUV,faceColors:Z.faceColors,flat:Z.flat,updatable:Z.updatable,sideOrientation:Z.sideOrientation,frontUVs:Z.frontUVs,backUVs:Z.backUVs},d)},CreateGoldberg:function(N,Z){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const m=Z.size,S=Z.sizeX||m||1,e=Z.sizeY||m||1,j=Z.sizeZ||m||1;let B=Z.m||1;B!==Math.floor(B)&&(B=Math.floor(B),K.e.Warn("m not an integer only floor(m) used"));let v=Z.n||0;if(v!==Math.floor(v)&&(v=Math.floor(v),K.e.Warn("n not an integer only floor(n) used")),v>B){const N=v;v=B,B=N,K.e.Warn("n > m therefore m and n swapped")}const T=new SN;T.build(B,v);const k=jN.BuildGeodesicData(T),h=k.toGoldbergPolyhedronData(),U=new BN(N,d);Z.sideOrientation=I.b._GetDefaultSideOrientation(Z.sideOrientation),U._originalBuilderSideOrientation=Z.sideOrientation;(function(N,Z){const d=N.size,I=N.sizeX||d||1,m=N.sizeY||d||1,S=N.sizeZ||d||1,e=0===N.sideOrientation?0:N.sideOrientation||z.c.DEFAULTSIDE,j=[],B=[],D=[],v=[];let T=1/0,k=-1/0,h=1/0,U=-1/0;for(let X=0;X<Z.vertex.length;X++)T=Math.min(T,Z.vertex[X][0]*I),k=Math.max(k,Z.vertex[X][0]*I),h=Math.min(h,Z.vertex[X][1]*m),U=Math.max(U,Z.vertex[X][1]*m);let C=0;for(let z=0;z<Z.face.length;z++){const N=Z.face[z],d=X.n._c(Z.vertex[N[0]]),e=X.n._c(Z.vertex[N[2]]),M=X.n._c(Z.vertex[N[1]]),Q=e.rc(d),A=M.rc(d),n=X.n.Cross(A,Q).normalize();for(let X=0;X<N.length;X++){D.push(n.x,n.y,n.z);const d=Z.vertex[N[X]];j.push(d[0]*I,d[1]*m,d[2]*S);const z=(d[1]*m-h)/(U-h);v.push((d[0]*I-T)/(k-T),w.b?1-z:z)}for(let Z=0;Z<N.length-2;Z++)B.push(C,C+Z+2,C+Z+1);C+=N.length}z.c._ComputeSides(e,j,B,D,v);const M=new z.c;return M.xa=j,M.indices=B,M.ya=D,M.Aa=v,M})(Z,h).Ca(U,Z.updatable),U.goldbergData.nbSharedFaces=k.sharedNodes,U.goldbergData.nbUnsharedFaces=k.poleNodes,U.goldbergData.adjacentFaces=k.adjacentFaces,U.goldbergData.nbFaces=U.goldbergData.nbSharedFaces+U.goldbergData.nbUnsharedFaces,U.goldbergData.nbFacesAtPole=(U.goldbergData.nbUnsharedFaces-12)/12;for(let I=0;I<k.vertex.length;I++)U.goldbergData.faceCenters.push(X.n._c(k.vertex[I])),U.goldbergData.faceCenters[I].x*=S,U.goldbergData.faceCenters[I].y*=e,U.goldbergData.faceCenters[I].z*=j,U.goldbergData.faceColors.push(new D.e(1,1,1,1));for(let I=0;I<h.face.length;I++){const N=h.face[I],Z=X.n._c(h.vertex[N[0]]),d=X.n._c(h.vertex[N[2]]),m=X.n._c(h.vertex[N[1]]),z=d.rc(Z),w=m.rc(Z),S=X.n.Cross(w,z).normalize(),e=X.n.Cross(w,S).normalize();U.goldbergData.faceXaxis.push(w.normalize()),U.goldbergData.faceYaxis.push(S),U.goldbergData.faceZaxis.push(e)}return U},CreateDecal:IN,CreateCapsule:zN,CreateText:function(N,Z,d){let m=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{size:50,resolution:8,depth:1},z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,w=arguments.length>5&&void 0!==arguments[5]?arguments[5]:earcut;const S=function(N,Z,d,X){const I=Array.from(N),m=Z/X.resolution,z=(X.boundingBox.yMax-X.boundingBox.yMin+X.underlineThickness)*m,w=[];let S=0,e=0;for(let j=0;j<I.length;j++){const N=I[j];if("\n"===N)S=0,e-=z;else{const Z=TN(N,m,S,e,d,X);Z&&(S+=Z.offsetX,w.push(Z.shapePath))}}return w}(Z,m.size||50,m.resolution||8,d),e=[];let j=0;for(const T of S){if(!T.paths.length)continue;const Z=T.holes.slice();for(const d of T.paths){var B,D;const S=[],v=[],T=d.getPoints();for(const N of T)v.push(new X.n(N.x,0,N.y));const k=Z.slice();for(const N of k){const I=N.getPoints();let m=!1;for(const N of I)if(d.isPointInside(N)){m=!0;break}if(!m)continue;const z=[];for(const N of I)z.push(new X.n(N.x,0,N.y));S.push(z),Z.splice(Z.indexOf(N),1)}if(!S.length&&Z.length)for(const N of Z){const Z=N.getPoints(),d=[];for(const N of Z)d.push(new X.n(N.x,0,N.y));S.push(d)}const h=t(N,{shape:v,holes:S.length?S:void 0,depth:m.depth||1,faceUV:m.faceUV||(null===(B=m.perLetterFaceUV)||void 0===B?void 0:B.call(m,j)),faceColors:m.faceColors||(null===(D=m.perLetterFaceColors)||void 0===D?void 0:D.call(m,j)),sideOrientation:I.b._GetDefaultSideOrientation(m.sideOrientation||I.b.DOUBLESIDE)},z,w);e.push(h),j++}}const v=I.b.MergeMeshes(e,!0,!0);if(v){const Z=v.getBoundingInfo().boundingBox;v.position.x+=-(Z.minimumWorld.x+Z.maximumWorld.x)/2,v.position.y+=-(Z.minimumWorld.y+Z.maximumWorld.y)/2,v.position.z+=-(Z.minimumWorld.z+Z.maximumWorld.z)/2+Z.extendSize.z,v.name=N;const d=new DN.c("pivot",z);d.rotation.x=-Math.PI/2,v.parent=d,v.bakeCurrentTransformIntoVertices(),v.parent=null,d.dispose()}return v}}},11773:(N,Z,d)=>{"use strict";var X=d(11321),I=d(1169),m=d(960),z=d(1051),w=d(1264);X.b.prototype.thinInstanceAdd=function(N){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.va().getEngine().getCaps().instancedArrays)return z.e.Error("Thin Instances are not supported on this device as Instanced Array extension not supported"),-1;this._thinInstanceUpdateBufferSize("matrix",Array.isArray(N)?N.length:1);const d=this._thinInstanceDataStorage.instancesCount;if(Array.isArray(N))for(let X=0;X<N.length;++X)this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,N[X],X===N.length-1&&Z);else this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,N,Z);return d},X.b.prototype.thinInstanceAddSelf=function(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.thinInstanceAdd(m.c.IdentityReadOnly,N)},X.b.prototype.thinInstanceRegisterAttribute=function(N,Z){N===I.d.ColorKind&&(N=I.d.ColorInstanceKind),this.removeVerticesData(N),this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.strides[N]=Z,this._userThinInstanceBuffersStorage.sizes[N]=Z*Math.max(32,this._thinInstanceDataStorage.instancesCount),this._userThinInstanceBuffersStorage.data[N]=new Float32Array(this._userThinInstanceBuffersStorage.sizes[N]),this._userThinInstanceBuffersStorage.vertexBuffers[N]=new I.d(this.getEngine(),this._userThinInstanceBuffersStorage.data[N],N,!0,!1,Z,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[N])},X.b.prototype.thinInstanceSetMatrixAt=function(N,Z){let d=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!this._thinInstanceDataStorage.matrixData||N>=this._thinInstanceDataStorage.instancesCount)return!1;const X=this._thinInstanceDataStorage.matrixData;return Z.copyToArray(X,16*N),this._thinInstanceDataStorage.worldMatrices&&(this._thinInstanceDataStorage.worldMatrices[N]=Z),d&&(this.Sj("matrix"),this.Da||this.thinInstanceRefreshBoundingInfo(!1)),!0},X.b.prototype.thinInstanceSetAttributeAt=function(N,Z,d){let X=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return N===I.d.ColorKind&&(N=I.d.ColorInstanceKind),!(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.data[N]||Z>=this._thinInstanceDataStorage.instancesCount)&&(this._thinInstanceUpdateBufferSize(N,0),this._userThinInstanceBuffersStorage.data[N].set(d,Z*this._userThinInstanceBuffersStorage.strides[N]),X&&this.Sj(N),!0)},Object.defineProperty(X.b.prototype,"Pj",{get:function(){return this._thinInstanceDataStorage.instancesCount},set:function(N){var Z;const d=this._thinInstanceDataStorage.matrixData??(null===(Z=this.source)||void 0===Z?void 0:Z._thinInstanceDataStorage.matrixData);N<=(d?d.length/16:0)&&(this._thinInstanceDataStorage.instancesCount=N)},enumerable:!0,configurable:!0}),X.b.prototype._thinInstanceCreateMatrixBuffer=function(N,Z){let d=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const X=new I.b(this.getEngine(),Z,!d,16,!1,!0);for(let I=0;I<4;I++)this.setVerticesBuffer(X.createVertexBuffer(N+I,4*I,4));return X},X.b.prototype.Tj=function(N,Z){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,X=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];var m;if(d=d||16,"matrix"===N)null===(m=this._thinInstanceDataStorage.matrixBuffer)||void 0===m||m.dispose(),this._thinInstanceDataStorage.matrixBuffer=null,this._thinInstanceDataStorage.matrixBufferSize=Z?Z.length:32*d,this._thinInstanceDataStorage.matrixData=Z,this._thinInstanceDataStorage.worldMatrices=null,null!==Z?(this._thinInstanceDataStorage.instancesCount=Z.length/d,this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",Z,X),this.Da||this.thinInstanceRefreshBoundingInfo(!1)):(this._thinInstanceDataStorage.instancesCount=0,this.Da||this.refreshBoundingInfo());else if("previousMatrix"===N){var z;null===(z=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===z||z.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=null,this._thinInstanceDataStorage.previousMatrixData=Z,null!==Z&&(this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",Z,X))}else{var w;if(N===I.d.ColorKind&&(N=I.d.ColorInstanceKind),null===Z)null!==(w=this._userThinInstanceBuffersStorage)&&void 0!==w&&w.data[N]&&(this.removeVerticesData(N),delete this._userThinInstanceBuffersStorage.data[N],delete this._userThinInstanceBuffersStorage.strides[N],delete this._userThinInstanceBuffersStorage.sizes[N],delete this._userThinInstanceBuffersStorage.vertexBuffers[N]);else this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.data[N]=Z,this._userThinInstanceBuffersStorage.strides[N]=d,this._userThinInstanceBuffersStorage.sizes[N]=Z.length,this._userThinInstanceBuffersStorage.vertexBuffers[N]=new I.d(this.getEngine(),Z,N,!X,!1,d,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[N])}},X.b.prototype.Sj=function(N){var Z;if("matrix"===N)this.Oj&&this._thinInstanceDataStorage.matrixBuffer&&!this._thinInstanceDataStorage.matrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(N),null===(Z=this._thinInstanceDataStorage.matrixBuffer)||void 0===Z||Z.updateDirectly(this._thinInstanceDataStorage.matrixData,0,this._thinInstanceDataStorage.instancesCount);else if("previousMatrix"===N){var d;this.Oj&&this._thinInstanceDataStorage.previousMatrixBuffer&&!this._thinInstanceDataStorage.previousMatrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(N),null===(d=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===d||d.updateDirectly(this._thinInstanceDataStorage.previousMatrixData,0,this._thinInstanceDataStorage.instancesCount)}else{var X;N===I.d.ColorKind&&(N=I.d.ColorInstanceKind),null!==(X=this._userThinInstanceBuffersStorage)&&void 0!==X&&X.vertexBuffers[N]&&(this.Oj&&!this._userThinInstanceBuffersStorage.vertexBuffers[N].isUpdatable()&&this._thinInstanceRecreateBuffer(N),this._userThinInstanceBuffersStorage.vertexBuffers[N].updateDirectly(this._userThinInstanceBuffersStorage.data[N],0))}},X.b.prototype.thinInstancePartialBufferUpdate=function(N,Z,d){var X;"matrix"===N?this._thinInstanceDataStorage.matrixBuffer&&this._thinInstanceDataStorage.matrixBuffer.updateDirectly(Z,d):(N===I.d.ColorKind&&(N=I.d.ColorInstanceKind),null!==(X=this._userThinInstanceBuffersStorage)&&void 0!==X&&X.vertexBuffers[N]&&this._userThinInstanceBuffersStorage.vertexBuffers[N].updateDirectly(Z,d))},X.b.prototype.thinInstanceGetWorldMatrices=function(){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return[];const N=this._thinInstanceDataStorage.matrixData;if(!this._thinInstanceDataStorage.worldMatrices){this._thinInstanceDataStorage.worldMatrices=[];for(let Z=0;Z<this._thinInstanceDataStorage.instancesCount;++Z)this._thinInstanceDataStorage.worldMatrices[Z]=m.c._c(N,16*Z)}return this._thinInstanceDataStorage.worldMatrices},X.b.prototype.thinInstanceRefreshBoundingInfo=function(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],d=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return;const X=this._thinInstanceDataStorage.boundingVectors;if(N||!this.rawBoundingInfo){X.length=0,this.refreshBoundingInfo(Z,d);const N=this.getBoundingInfo();this.rawBoundingInfo=new w.e(N.minimum,N.maximum)}const I=this.getBoundingInfo(),z=this._thinInstanceDataStorage.matrixData;if(0===X.length)for(let m=0;m<I.boundingBox.vectors.length;++m)X.push(I.boundingBox.vectors[m].clone());m.h.kd[0].hd(Number.POSITIVE_INFINITY),m.h.kd[1].hd(Number.NEGATIVE_INFINITY);for(let w=0;w<this._thinInstanceDataStorage.instancesCount;++w){m.c.FromArrayToRef(z,16*w,m.h.Matrix[0]);for(let N=0;N<X.length;++N)m.n.TransformCoordinatesToRef(X[N],m.h.Matrix[0],m.h.kd[2]),m.h.kd[0].minimizeInPlace(m.h.kd[2]),m.h.kd[1].maximizeInPlace(m.h.kd[2])}I.reConstruct(m.h.kd[0],m.h.kd[1]),this.Ea()},X.b.prototype._thinInstanceRecreateBuffer=function(N){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var d;if("matrix"===N)null===(d=this._thinInstanceDataStorage.matrixBuffer)||void 0===d||d.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",this._thinInstanceDataStorage.matrixData,Z);else if("previousMatrix"===N){var X;if(this._scene.needsPreviousWorldMatrices)null===(X=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===X||X.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.previousMatrixData??this._thinInstanceDataStorage.matrixData,Z)}else{var m;N===I.d.ColorKind&&(N=I.d.ColorInstanceKind),null===(m=this._userThinInstanceBuffersStorage.vertexBuffers[N])||void 0===m||m.dispose(),this._userThinInstanceBuffersStorage.vertexBuffers[N]=new I.d(this.getEngine(),this._userThinInstanceBuffersStorage.data[N],N,!Z,!1,this._userThinInstanceBuffersStorage.strides[N],!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[N])}},X.b.prototype._thinInstanceUpdateBufferSize=function(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;N===I.d.ColorKind&&(N=I.d.ColorInstanceKind);const d="matrix"===N;if(!d&&(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.strides[N]))return;const X=d?16:this._userThinInstanceBuffersStorage.strides[N],m=d?this._thinInstanceDataStorage.matrixBufferSize:this._userThinInstanceBuffersStorage.sizes[N];let z=d?this._thinInstanceDataStorage.matrixData:this._userThinInstanceBuffersStorage.data[N];const w=(this._thinInstanceDataStorage.instancesCount+Z)*X;let S=m;for(;S<w;)S*=2;if(!z||m!=S){if(z){const N=new Float32Array(S);N.set(z,0),z=N}else z=new Float32Array(S);var e,j,B;if(d){if(null===(e=this._thinInstanceDataStorage.matrixBuffer)||void 0===e||e.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",z,!1),this._thinInstanceDataStorage.matrixData=z,this._thinInstanceDataStorage.matrixBufferSize=S,this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData)null===(j=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===j||j.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",z,!1)}else null===(B=this._userThinInstanceBuffersStorage.vertexBuffers[N])||void 0===B||B.dispose(),this._userThinInstanceBuffersStorage.data[N]=z,this._userThinInstanceBuffersStorage.sizes[N]=S,this._userThinInstanceBuffersStorage.vertexBuffers[N]=new I.d(this.getEngine(),z,N,!0,!1,X,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[N])}},X.b.prototype._thinInstanceInitializeUserStorage=function(){this._userThinInstanceBuffersStorage||(this._userThinInstanceBuffersStorage={data:{},sizes:{},vertexBuffers:{},strides:{}})},X.b.prototype._disposeThinInstanceSpecificData=function(){var N;null!==(N=this._thinInstanceDataStorage)&&void 0!==N&&N.matrixBuffer&&(this._thinInstanceDataStorage.matrixBuffer.dispose(),this._thinInstanceDataStorage.matrixBuffer=null)}},11370:(N,Z,d)=>{"use strict";d.d(Z,{c:()=>B});var X=d(942),I=d(949),m=d(1094),z=d(958),w=d(960),S=d(11343),e=d(978);const j=w.c.Compose(w.n.One(),w.g.FromEulerAngles(0,Math.PI,0),w.n.Zero());class B extends S.e{get billboardMode(){return this._billboardMode}set billboardMode(N){this._billboardMode!==N&&(this._billboardMode=N,this._cache.useBillboardPosition=0!==(this._billboardMode&B.BILLBOARDMODE_USE_POSITION),this._computeUseBillboardPath())}get preserveParentRotationForBillboard(){return this._preserveParentRotationForBillboard}set preserveParentRotationForBillboard(N){N!==this._preserveParentRotationForBillboard&&(this._preserveParentRotationForBillboard=N,this._computeUseBillboardPath())}_computeUseBillboardPath(){this._cache.useBillboardPath=this._billboardMode!==B.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}get infiniteDistance(){return this._infiniteDistance}set infiniteDistance(N){this._infiniteDistance!==N&&(this._infiniteDistance=N)}constructor(N){let Z=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(N,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,!1),this._forward=new w.n(0,0,1),this._up=new w.n(0,1,0),this._right=new w.n(1,0,0),this._position=w.n.Zero(),this._rotation=w.n.Zero(),this._rotationQuaternion=null,this._scaling=w.n.One(),this._transformToBoneReferal=null,this._isAbsoluteSynced=!1,this._billboardMode=B.BILLBOARDMODE_NONE,this._preserveParentRotationForBillboard=!1,this.scalingDeterminant=1,this._infiniteDistance=!1,this.ignoreNonUniformScaling=!1,this.reIntegrateRotationIntoRotationQuaternion=!1,this._poseMatrix=null,this.Rj=w.c.Zero(),this._usePivotMatrix=!1,this._absolutePosition=w.n.Zero(),this._absoluteScaling=w.n.Zero(),this._absoluteRotationQuaternion=w.g.Identity(),this._pivotMatrix=w.c.Identity(),this._postMultiplyPivotMatrix=!1,this._isWorldMatrixFrozen=!1,this._indexInSceneTransformNodesArray=-1,this.onAfterWorldMatrixUpdateObservable=new z.d,this._nonUniformScaling=!1,Z&&this.va().addTransformNode(this)}getClassName(){return"ob"}get position(){return this._position}set position(N){this._position=N,this._markAsDirtyInternal()}isUsingPivotMatrix(){return this._usePivotMatrix}isUsingPostMultiplyPivotMatrix(){return this._postMultiplyPivotMatrix}get rotation(){return this._rotation}set rotation(N){this._rotation=N,this._rotationQuaternion=null,this._markAsDirtyInternal()}get od(){return this._scaling}set od(N){this._scaling=N,this._markAsDirtyInternal()}get rotationQuaternion(){return this._rotationQuaternion}set rotationQuaternion(N){this._rotationQuaternion=N,N&&this._rotation.hd(0),this._markAsDirtyInternal()}_markAsDirtyInternal(){this._isDirty||(this._isDirty=!0,this.customMarkAsDirty&&this.customMarkAsDirty())}get forward(){return w.n.TransformNormalFromFloatsToRef(0,0,this.va().useRightHandedSystem?-1:1,this.getWorldMatrix(),this._forward),this._forward.normalize()}get up(){return w.n.TransformNormalFromFloatsToRef(0,1,0,this.getWorldMatrix(),this._up),this._up.normalize()}get right(){return w.n.TransformNormalFromFloatsToRef(this.va().useRightHandedSystem?-1:1,0,0,this.getWorldMatrix(),this._right),this._right.normalize()}updatePoseMatrix(N){return this._poseMatrix?(this._poseMatrix.p(N),this):(this._poseMatrix=N.clone(),this)}getPoseMatrix(){return this._poseMatrix||(this._poseMatrix=w.c.Identity()),this._poseMatrix}_isSynchronized(){const N=this._cache;return this._billboardMode===N.billboardMode&&this._billboardMode===B.BILLBOARDMODE_NONE&&(!N.pivotMatrixUpdated&&(!this._infiniteDistance&&(!this._position._isDirty&&(!this._scaling._isDirty&&!(this._rotationQuaternion&&this._rotationQuaternion._isDirty||this._rotation._isDirty)))))}_initCache(){super._initCache();const N=this._cache;N.localMatrixUpdated=!1,N.billboardMode=-1,N.infiniteDistance=!1,N.useBillboardPosition=!1,N.useBillboardPath=!1}get absolutePosition(){return this.getAbsolutePosition()}get absoluteScaling(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling}get absoluteRotationQuaternion(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion}setPreTransformMatrix(N){return this.setPivotMatrix(N,!1)}setPivotMatrix(N){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._pivotMatrix.p(N),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=Z,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=w.c.Invert(this._pivotMatrix)),this}getPivotMatrix(){return this._pivotMatrix}instantiateHierarchy(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,Z=arguments.length>1?arguments[1]:void 0,d=arguments.length>2?arguments[2]:void 0;const X=this.clone("Clone of "+(this.name||this.id),N||this.parent,!0);X&&d&&d(this,X);for(const I of this.getChildTransformNodes(!0))I.instantiateHierarchy(X,Z,d);return X}fi(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return N?arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(this._rotation.hd(0),this._rotationQuaternion=this._rotationQuaternion||w.g.Identity(),N.decompose(this._scaling,this._rotationQuaternion,this._position),this.be(!0)):(this._worldMatrix=N,this._absolutePosition.fd(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._afterComputeWorldMatrix()):(this._isWorldMatrixFrozen=!1,this.be(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this}unfreezeWorldMatrix(){return this._isWorldMatrixFrozen=!1,this.be(!0),this}get uj(){return this._isWorldMatrixFrozen}getAbsolutePosition(){return this.be(),this._absolutePosition}setAbsolutePosition(N){if(!N)return this;let Z,d,X;if(void 0===N.x){if(arguments.length<3)return this;Z=arguments[0],d=arguments[1],X=arguments[2]}else Z=N.x,d=N.y,X=N.z;if(this.parent){const N=w.h.Matrix[0];this.parent.getWorldMatrix().invertToRef(N),w.n.TransformCoordinatesFromFloatsToRef(Z,d,X,N,this.position)}else this.position.x=Z,this.position.y=d,this.position.z=X;return this._absolutePosition.p(N),this}setPositionWithLocalVector(N){return this.be(),this.position=w.n.TransformNormal(N,this.Rj),this}getPositionExpressedInLocalSpace(){this.be();const N=w.h.Matrix[0];return this.Rj.invertToRef(N),w.n.TransformNormal(this.position,N)}locallyTranslate(N){return this.be(!0),this.position=w.n.TransformCoordinates(N,this.Rj),this}lookAt(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const m=B._LookAtVectorCache,z=0===I?this.position:this.getAbsolutePosition();if(N.subtractToRef(z,m),this.setDirection(m,Z,d,X),1===I&&this.parent)if(this.rotationQuaternion){const N=w.h.Matrix[0];this.rotationQuaternion.toRotationMatrix(N);const Z=w.h.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(Z),Z.invert(),N.multiplyToRef(Z,N),this.rotationQuaternion.fromRotationMatrix(N)}else{const N=w.h.Quaternion[0];w.g.FromEulerVectorToRef(this.rotation,N);const Z=w.h.Matrix[0];N.toRotationMatrix(Z);const d=w.h.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(d),d.invert(),Z.multiplyToRef(d,Z),N.fromRotationMatrix(Z),N.toEulerAnglesToRef(this.rotation)}return this}bf(N){const Z=w.n.Zero();return this.getDirectionToRef(N,Z),Z}getDirectionToRef(N,Z){return w.n.TransformNormalToRef(N,this.getWorldMatrix(),Z),this}setDirection(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const I=-Math.atan2(N.z,N.x)+Math.PI/2,m=Math.sqrt(N.x*N.x+N.z*N.z),z=-Math.atan2(N.y,m);return this.rotationQuaternion?w.g.RotationYawPitchRollToRef(I+Z,z+d,X,this.rotationQuaternion):(this.rotation.x=z+d,this.rotation.y=I+Z,this.rotation.z=X),this}setPivotPoint(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;0==this.va().getRenderId()&&this.be(!0);const d=this.getWorldMatrix();if(1==Z){const Z=w.h.Matrix[0];d.invertToRef(Z),N=w.n.TransformCoordinates(N,Z)}return this.setPivotMatrix(w.c.Translation(-N.x,-N.y,-N.z),!0)}getPivotPoint(){const N=w.n.Zero();return this.getPivotPointToRef(N),N}getPivotPointToRef(N){return N.x=-this._pivotMatrix.m[12],N.y=-this._pivotMatrix.m[13],N.z=-this._pivotMatrix.m[14],this}getAbsolutePivotPoint(){const N=w.n.Zero();return this.getAbsolutePivotPointToRef(N),N}getAbsolutePivotPointToRef(N){return this.getPivotPointToRef(N),w.n.TransformCoordinatesToRef(N,this.getWorldMatrix(),N),this}fe(N){if(this._isDirty)return this;if(this._children)for(const Z of this._children)Z.fe(N);return super.fe(N)}setParent(N){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],d=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!N&&!this.parent)return this;const X=w.h.Quaternion[0],I=w.h.kd[0],m=w.h.kd[1],z=w.h.Matrix[1];w.c.IdentityToRef(z);const S=w.h.Matrix[0];this.be(!0);let e=this.rotationQuaternion;return e||(e=B._TmpRotation,w.g.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,e)),w.c.ComposeToRef(this.od,e,this.position,S),this.parent&&S.multiplyToRef(this.parent.be(!0),S),N&&(N.be(!0).invertToRef(z),S.multiplyToRef(z,S)),S.decompose(m,X,I,Z?this:void 0),this.rotationQuaternion?this.rotationQuaternion.p(X):X.toEulerAnglesToRef(this.rotation),this.od.p(m),this.position.p(I),this.parent=N,d&&this.setPivotMatrix(w.c.Identity()),this}addChild(N){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return N.setParent(this,Z),this}removeChild(N){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return N.setParent(null,Z),this}get nonUniformScaling(){return this._nonUniformScaling}_updateNonUniformScalingState(N){return this._nonUniformScaling!==N&&(this._nonUniformScaling=N,!0)}attachToBone(N,Z){return this._currentParentWhenAttachingToBone=this.parent,this._transformToBoneReferal=Z,this.parent=N,N.getSkeleton().prepare(!0),N.getFinalMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this}detachFromBone(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=N?this._currentParentWhenAttachingToBone:null,this):(N&&(this.parent=this._currentParentWhenAttachingToBone),this)}rotate(N,Z,d){let X;if(N.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.hd(0)),d&&0!==d){if(this.parent){const d=this.parent.getWorldMatrix(),X=w.h.Matrix[0];d.invertToRef(X),N=w.n.TransformNormal(N,X),d.determinant()<0&&(Z*=-1)}X=w.g.RotationAxisToRef(N,Z,B._RotationAxisCache),X.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else X=w.g.RotationAxisToRef(N,Z,B._RotationAxisCache),this.rotationQuaternion.multiplyToRef(X,this.rotationQuaternion);return this}rotateAround(N,Z,d){Z.normalize(),this.rotationQuaternion||(this.rotationQuaternion=w.g.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.hd(0));const X=w.h.kd[0],I=w.h.kd[1],m=w.h.kd[2],z=w.h.Quaternion[0],S=w.h.Matrix[0],e=w.h.Matrix[1],j=w.h.Matrix[2],B=w.h.Matrix[3];return N.subtractToRef(this.position,X),w.c.TranslationToRef(X.x,X.y,X.z,S),w.c.TranslationToRef(-X.x,-X.y,-X.z,e),w.c.RotationAxisToRef(Z,d,j),e.multiplyToRef(j,B),B.multiplyToRef(S,B),B.decompose(I,z,m),this.position.addInPlace(m),z.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this}translate(N,Z,d){const X=N.scale(Z);if(d&&0!==d)this.setAbsolutePosition(this.getAbsolutePosition().add(X));else{const N=this.getPositionExpressedInLocalSpace().add(X);this.setPositionWithLocalVector(N)}return this}addRotation(N,Z,d){let X;this.rotationQuaternion?X=this.rotationQuaternion:(X=w.h.Quaternion[1],w.g.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,X));const I=w.h.Quaternion[0];return w.g.RotationYawPitchRollToRef(Z,N,d,I),X.multiplyInPlace(I),this.rotationQuaternion||X.toEulerAnglesToRef(this.rotation),this}_getEffectiveParent(){return this.parent}isWorldMatrixCameraDependent(){return this._infiniteDistance&&!this.parent||this._billboardMode!==B.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}be(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;const d=this.va().getRenderId();if(!this._isDirty&&!N&&(this._currentRenderId===d||this.isSynchronized()))return this._currentRenderId=d,this._worldMatrix;Z=Z||this.va().activeCamera,this._updateCache();const X=this._cache;X.pivotMatrixUpdated=!1,X.billboardMode=this.billboardMode,X.infiniteDistance=this.infiniteDistance,X.parent=this._parentNode,this._currentRenderId=d,this._childUpdateId+=1,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;const I=this._getEffectiveParent(),m=B._TmpScaling;let z,S=this._position;if(this._infiniteDistance&&!this.parent&&Z){const N=Z.getWorldMatrix(),d=new w.n(N.m[12],N.m[13],N.m[14]);S=B._TmpTranslation,S.fd(this._position.x+d.x,this._position.y+d.y,this._position.z+d.z)}if(m.fd(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant),this._rotationQuaternion){if(this._rotationQuaternion._isDirty=!1,z=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion){this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(w.g.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.fd(0,0,0))}}else z=B._TmpRotation,w.g.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,z);if(this._usePivotMatrix){const N=w.h.Matrix[1];w.c.ScalingToRef(m.x,m.y,m.z,N);const Z=w.h.Matrix[0];z.toRotationMatrix(Z),this._pivotMatrix.multiplyToRef(N,w.h.Matrix[4]),w.h.Matrix[4].multiplyToRef(Z,this.Rj),this._postMultiplyPivotMatrix&&this.Rj.multiplyToRef(this._pivotMatrixInverse,this.Rj),this.Rj.addTranslationFromFloats(S.x,S.y,S.z)}else w.c.ComposeToRef(m,z,S,this.Rj);if(I&&I.getWorldMatrix){if(N&&I.be(N),X.useBillboardPath){if(this._transformToBoneReferal){const N=this.parent;N.getSkeleton().prepare(),N.getFinalMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),w.h.Matrix[7])}else w.h.Matrix[7].p(I.getWorldMatrix());const N=w.h.kd[5],Z=w.h.kd[6],d=w.h.Quaternion[0];w.h.Matrix[7].decompose(Z,d,N),w.c.ScalingToRef(Z.x,Z.y,Z.z,w.h.Matrix[7]),w.h.Matrix[7].setTranslation(N),B.BillboardUseParentOrientation&&(this._position.applyRotationQuaternionToRef(d,N),this.Rj.setTranslation(N)),this.Rj.multiplyToRef(w.h.Matrix[7],this._worldMatrix)}else if(this._transformToBoneReferal){const N=this.parent;N.getSkeleton().prepare(),this.Rj.multiplyToRef(N.getFinalMatrix(),w.h.Matrix[6]),w.h.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)}else this.Rj.multiplyToRef(I.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.p(this.Rj);if(X.useBillboardPath&&Z&&this.billboardMode&&!X.useBillboardPosition){const N=w.h.kd[0];if(this._worldMatrix.getTranslationToRef(N),w.h.Matrix[1].p(Z.getViewMatrix()),this._scene.useRightHandedSystem&&w.h.Matrix[1].multiplyToRef(j,w.h.Matrix[1]),w.h.Matrix[1].setTranslationFromFloats(0,0,0),w.h.Matrix[1].invertToRef(w.h.Matrix[0]),(this.billboardMode&B.BILLBOARDMODE_ALL)!==B.BILLBOARDMODE_ALL){w.h.Matrix[0].decompose(void 0,w.h.Quaternion[0],void 0);const N=w.h.kd[1];w.h.Quaternion[0].toEulerAnglesToRef(N),(this.billboardMode&B.BILLBOARDMODE_X)!==B.BILLBOARDMODE_X&&(N.x=0),(this.billboardMode&B.BILLBOARDMODE_Y)!==B.BILLBOARDMODE_Y&&(N.y=0),(this.billboardMode&B.BILLBOARDMODE_Z)!==B.BILLBOARDMODE_Z&&(N.z=0),w.c.RotationYawPitchRollToRef(N.y,N.x,N.z,w.h.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(w.h.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(w.h.kd[0])}else if(X.useBillboardPath&&Z&&X.useBillboardPosition){const N=w.h.kd[0];this._worldMatrix.getTranslationToRef(N);const d=Z.globalPosition;this._worldMatrix.invertToRef(w.h.Matrix[1]);const X=w.h.kd[1];w.n.TransformCoordinatesToRef(d,w.h.Matrix[1],X),X.normalize();const I=-Math.atan2(X.z,X.x)+Math.PI/2,m=Math.sqrt(X.x*X.x+X.z*X.z),z=-Math.atan2(X.y,m);if(w.g.RotationYawPitchRollToRef(I,z,0,w.h.Quaternion[0]),(this.billboardMode&B.BILLBOARDMODE_ALL)!==B.BILLBOARDMODE_ALL){const N=w.h.kd[1];w.h.Quaternion[0].toEulerAnglesToRef(N),(this.billboardMode&B.BILLBOARDMODE_X)!==B.BILLBOARDMODE_X&&(N.x=0),(this.billboardMode&B.BILLBOARDMODE_Y)!==B.BILLBOARDMODE_Y&&(N.y=0),(this.billboardMode&B.BILLBOARDMODE_Z)!==B.BILLBOARDMODE_Z&&(N.z=0),w.c.RotationYawPitchRollToRef(N.y,N.x,N.z,w.h.Matrix[0])}else w.c.FromQuaternionToRef(w.h.Quaternion[0],w.h.Matrix[0]);this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(w.h.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(w.h.kd[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):I&&I._nonUniformScaling?this._updateNonUniformScalingState(I._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.fd(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=w.c.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix}resetLocalMatrix(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.be(),N){const N=this.getChildren();for(let Z=0;Z<N.length;++Z){const d=N[Z];if(d){d.be();const N=w.h.Matrix[0];d.Rj.multiplyToRef(this.Rj,N);const Z=w.h.Quaternion[0];N.decompose(d.od,Z,d.position),d.rotationQuaternion?d.rotationQuaternion.p(Z):Z.toEulerAnglesToRef(d.rotation)}}}this.od.fd(1,1,1),this.position.fd(0,0,0),this.rotation.fd(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=w.g.Identity()),this._worldMatrix=w.c.Identity()}_afterComputeWorldMatrix(){}registerAfterWorldMatrixUpdate(N){return this.onAfterWorldMatrixUpdateObservable.add(N),this}unregisterAfterWorldMatrixUpdate(N){return this.onAfterWorldMatrixUpdateObservable.removeCallback(N),this}getPositionInCameraSpace(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return N||(N=this.va().activeCamera),w.n.TransformCoordinates(this.getAbsolutePosition(),N.getViewMatrix())}getDistanceToCamera(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return N||(N=this.va().activeCamera),this.getAbsolutePosition().rc(N.globalPosition).length()}clone(N,Z,d){const X=m.c.Clone((()=>new B(N,this.va())),this);if(X.name=N,X.id=N,Z&&(X.parent=Z),!d){const Z=this.getDescendants(!0);for(let d=0;d<Z.length;d++){const I=Z[d];I.clone&&I.clone(N+"."+I.name,X)}}return X}serialize(N){const Z=m.c.Serialize(this,N);return Z.type=this.getClassName(),Z.uniqueId=this.uniqueId,this.parent&&this.parent._serializeAsParent(Z),Z.localMatrix=this.getPivotMatrix().ed(),Z.isEnabled=this.isEnabled(),m.c.AppendSerializedAnimations(this,Z),Z.ranges=this.serializeAnimationRanges(),Z}static Parse(N,Z,d){const X=m.c.Parse((()=>new B(N.name,Z)),N,Z,d);if(N.localMatrix?X.setPreTransformMatrix(w.c._c(N.localMatrix)):N.pivotMatrix&&X.setPivotMatrix(w.c._c(N.pivotMatrix)),X.wg(N.isEnabled),X._waitingParsedUniqueId=N.uniqueId,void 0!==N.parentId&&(X._waitingParentId=N.parentId),void 0!==N.parentInstanceIndex&&(X._waitingParentInstanceIndex=N.parentInstanceIndex),N.animations){for(let Z=0;Z<N.animations.length;Z++){const d=N.animations[Z],I=(0,e.d)("BABYLON.Animation");I&&X.animations.push(I.Parse(d))}S.e.ParseAnimationRanges(X,N,Z)}return N.autoAnimate&&Z.beginAnimation(X,N.autoAnimateFrom,N.autoAnimateTo,N.autoAnimateLoop,N.autoAnimateSpeed||1),X}getChildTransformNodes(N,Z){const d=[];return this._getDescendants(d,N,(N=>(!Z||Z(N))&&N instanceof B)),d}dispose(N){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.va().stopAnimation(this),this.va().removeTransformNode(this),this._parentContainer){const N=this._parentContainer.transformNodes.indexOf(this);N>-1&&this._parentContainer.transformNodes.splice(N,1),this._parentContainer=null}if(this.onAfterWorldMatrixUpdateObservable.clear(),N){const N=this.getChildTransformNodes(!0);for(const Z of N)Z.parent=null,Z.be(!0)}super.dispose(N,Z)}normalizeToUnitCube(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],d=arguments.length>2?arguments[2]:void 0,X=null,I=null;Z&&(this.rotationQuaternion?(I=this.rotationQuaternion.clone(),this.rotationQuaternion.fd(0,0,0,1)):this.rotation&&(X=this.rotation.clone(),this.rotation.fd(0,0,0)));const m=this.getHierarchyBoundingVectors(N,d),z=m.max.rc(m.min),w=Math.max(z.x,z.y,z.z);if(0===w)return this;const S=1/w;return this.od.scaleInPlace(S),Z&&(this.rotationQuaternion&&I?this.rotationQuaternion.p(I):this.rotation&&X&&this.rotation.p(X)),this}_syncAbsoluteScalingAndRotation(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)}}B.BILLBOARDMODE_NONE=0,B.BILLBOARDMODE_X=1,B.BILLBOARDMODE_Y=2,B.BILLBOARDMODE_Z=4,B.BILLBOARDMODE_ALL=7,B.BILLBOARDMODE_USE_POSITION=128,B.BillboardUseParentOrientation=!1,B._TmpRotation=w.g.Zero(),B._TmpScaling=w.n.Zero(),B._TmpTranslation=w.n.Zero(),B._LookAtVectorCache=new w.n(0,0,0),B._RotationAxisCache=new w.g,(0,X.d)([(0,I.H)("position")],B.prototype,"_position",void 0),(0,X.d)([(0,I.H)("rotation")],B.prototype,"_rotation",void 0),(0,X.d)([(0,I.y)("rotationQuaternion")],B.prototype,"_rotationQuaternion",void 0),(0,X.d)([(0,I.H)("od")],B.prototype,"_scaling",void 0),(0,X.d)([(0,I.I)("billboardMode")],B.prototype,"_billboardMode",void 0),(0,X.d)([(0,I.I)()],B.prototype,"scalingDeterminant",void 0),(0,X.d)([(0,I.I)("infiniteDistance")],B.prototype,"_infiniteDistance",void 0),(0,X.d)([(0,I.I)()],B.prototype,"ignoreNonUniformScaling",void 0),(0,X.d)([(0,I.I)()],B.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0)},11728:(N,Z,d)=>{"use strict";d.d(Z,{b:()=>z});var X=d(938),I=d(10256);let m=0;const z=N=>{if(!N.environmentBRDFTexture){const Z=N.useDelayedTextureLoading;N.useDelayedTextureLoading=!1;const d=N._blockEntityCollection;N._blockEntityCollection=!1;const z=X.c.CreateFromBase64String("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR42u29yY5tWXIlZnbuiSaTbZFUkZRKrCKhElASQA0EoQABgn6hJvoXzfUP+gP9hWb6Bg00IgRoQJaKqUxmZmTEe8/v0uB2u7Fm2T7HIyIrnz88uPvt3f2a2WrMbOvf/u3PvvzP/sUf/N6//i8vf/lv/3v5H//d//Sb//Uq/5u8yf8hV/m/5Cp/L1f5hVzlG7nKJ7mKyJuIXN/hPwqXI/g++zq6rPI5u8z+WqfLre+zy7PrVv9L8brsMiGvk8XLmM/sdfHXal4e3ad6GXPdyu2ij8u/+uv/5cuf/OSLfdtEfvUr+dnf/d0X//t3H/7bf/hP//N/928h/0Yg/4VA/kogfyGQP5Wr/IFAvhbIlwK5CGQTPP+9z5uPeePJSW+yo2+s/GtN30Rnv1E+f5zxof9R/lSXv/nr//mrr3+i+5dfyX7ZZQP07Tffys//8R/l/9TtX7790T/7r/8G8pdy+/8XAvnnAvkzgfwzgfyxQP5AIL8vkJ8K5KsmMVzu1U7p5PA5AXxOAJ8TwPf7sX/51ZeXfcemqnp9w/W77/S7X/6T/vzf/7383RWCX3/z05/9i3/13/0PX//eX/2FyP8tIv+PiPy9iPy/IvIzEfm5iPxCRH4lIt/c/393//9BRD6KyKf7f488fP74/PH544dJAF9cLl98IZfLBZtuqterXr/7Dt9982v95S9+Lv+gF/3i7Spv/8lf/vnf/vGf/dF/JfKnIvLnIvLvReQ/NEngn0TklyLy6/v/34jIt00iGJOBlxAsdvv54/PH5493SQCXy9t2ueh2ueimKorrFbjq9eNH+fDtb+TXv/ol/vHyhX4Fxfbx7euPf/Lnf/PfiPyeiPyhiPxxkwB+fk8AvxzQgJcIrGTwFsiAEXH4/PH54/PHUgLY7whgu2C7bLqpQgHB2xvePn6SDx8+6G9+84384vKF/IPu8iVU9Y/+7C/+jWxffiHytYj8VER+X0T+oEEBvxqQwCMJeIngo5EI3goIwVMIPn98/vj8ESaAbbtu2ybbvl8u2ybbdtluSECA65u8ffqIDx8+6G++/VZ/efkV/sO261dQXP7wT/7kX8vl8qXIFyLylbySwe/dE0CLAr65B/9vGn0gQwRMMqgmhM/J4fPH548eAezbZd/lsm3YtssNAYiqiogAAkCvb5/k46cP8u2HD/rrb7+R/2/b9Wu9yJe//8d/9Ney6S5yEZFdRL68/38khG/uKOCnAwoYkcCoEXwkEgGDDq7CeQfyOTl8/vhd1QCum26ybZtu2yabbrKpQvXue1yvuF6v+vbpTT5+/CDffviAX1++1V9sO77WXb/66R/+4V/dgkbllQi+aBLBV/dE8LWRALwkYCWCNyMZXElkwLTMeMkga/P4/PH547ccAVwuctkvdxSw6bbdtYDbTfSZBN7e8PHTR/3u4wf55vKd/nL7DX6mu3791U9//5+/gkNFZGuSgZUQvnKowKgLWLTAQgRtEniTuEfwaELw0MJvf3LQzynud+53uG+X6y3gN9kul+2y6XVT1U27JCDAFVc8ksAn/e7jR/nN5YP+avtWfq6Xy9f7Vz/9w1dgRYngiyYhfNkkgzYBWHTg44AEMmqQUYQKOmDaiCIa8TmsfmzB+DnZDQjgcpGLbti2y3bZHjRAdRMVvb/dcYU8kcDbPQlsH/CrbddfbF98+RPZfvLFnAQeieCRDC5DMvju/vmD4JkEvjRQgKULeGggowdHkAHTYxihg89vu88I5UeGAPSOAFTlrgPopiqbKPSmCKreUoAAkCcSePukHz590m8vH+WbD9/JP335k6/+tA86KxFchv8jMvhiogE4JQm8XhfKqOAqx5qRPyeGzx8/cgSwbXcUoLJtim27C4Oi93+4v6VxQwKAvl2v+Hj9pB8+fZJvt4/yzfbF9lPdv/wJnsE2BogmyeCRED40tGFvksIXiSbgiYSRRpDNDZ6BDI6ghM+J4fPHeyKAO+zX7cb9t4tedMMNAQju5V+f1uAtBSiu1zsduMrHy5t8ePsk3376KN98sX/xE5FPAnm7/782o0DiUINXMkCXCB7/P94/e87AWUmARQWVvgMuKej9t1RLBp+Tw+ePgwngsutFFdu26WXbbl+rSvdfbnqAiuA23QcBgCugV1zl7e1NPm5v+LC96XfbJ/1W9y++fgXjA3bDYXV+MuhRwSPwL3JLMFYC+HS/LU8HYrGwIhwyNOF12SvgM4SgztdifP85MXz+KGsA2C6X7aJ6bXSAOwrY5OYIqGy3d5uq4P5GhABXuV6veLvRAf10fZMPb2/y3b7vX7+g+9v98/WOBq7GG7RNAlYy+Dgkhhb+Xxp0sE8IAC4SGAP/TbgVJK/PoJPBnAiwPKxsXfbbnRg+i3s/JAK4Q/4b9NfLtomBAqCickMBjy7BuywAUVyv8na94tMjCVzf9KNcLl/0SeA6oAEYb1i9g+FtSALb/bKL8/+t+wxXFMyswqiHoK4ToIgKqslgpg1qUC0QoYbvJZg/B/q5v4szHmPX7YEAsD0CX25OwEUVm9xag1+agKg+nxQArnKjAtDr9U0+Xd/k4/UqH7bL5YsewrcBBiMJZPRAp6TwQgWfjM9vgRbgUYGL8AvLWH2gqhesCokeUmCSwPsnhs8fP2YNYMO2XeSmAWxy2VQaXeDmDIhApf33rD4PTUCuV+DtCn27XuXT5ir8VmCJ2G5BpBM8/r/dEcJb8/0lEQMtJHA5TAlqNuLRhJChhEpSqFabH3di+G1AGj+W1/dyAR4IYJNNnuLf6+tWC9CHHiAtFhAIFLjK2/Uqn65X+SS67aK+3QeTDoy/IG2ogQ7fb/dAtz5vBgrYGqrwNtCHsVfgIvwK07OTQBURVNCBFpKCOjqCHn5L/67TgTN+fpySAC56nwSUi256kXsSuFGAVyLoUIDo8/Pz7fdoErr/v17lk162HbgHvFpIYDfoAJJfW4sGPjkU4VNAF8ZEcLmLhdc7kljdY1y1Dq9yLiI4IiRqcLujb138KIPn80ejATwRwIbtBvn1cqv+2J78/5EI5N4cJA8qIPcmwRsKAHDF9WYP6mV7VmrgLuTpxYTcMEW0LAmoQxFsuvAI8tv/a/C5fV2ZMMiKg++FCM7RDPRu8ebWY7VG6VJi+Bzk35MI2LsAckMAgwvQ0gC5DQjd3ABg2HQLAPpEAlZ1Bu7VV7MGHDFRAbo3VKsTbAY9sPWC/uvx86gBbDK3D1eEQS8pbAeSgSwmhepnJb6uBv/o/PzHLzxWA/X7TH77De5j6AGQi6o0CUGfCOD2X7cXAlCFQABtEsGLDtxuOyQB2UTQBKZe5GUPXgkUYCUAbZJRhBDeuq8xBf+bgwbehDm+BFQi2IJksOocvA8ysIMfxluVcRsY/eB3JzH8GFDAXQO48X/dcIf9jyDHptIigDsFkEe066tBSETQUYF7ElDdYEBytN4+rk9UcBPfrKaZqFHWcw3i4J8/X4ev2//bSXqAhwTay6OEIPLD2Ipt8OtAGzxkwLw9WVFRjTc/qC6H3+YK/b1oAA0KuOizHfieCLaHHiAb5NYTIC9EMEbZrVEQt1xwhVy1UfBh8PUOquMizwaap3tQXfY5B//tea/NZdfhsvbz+PURQTDSGWB87VX/7WSd4KxjUqrIgE0IUkoKGnhIvwvawpGf6eECXJ7tv4qbA7DJgwpsKthEmmYgfaAAffYF3HLxo0vwNjJ0SwRWMG4db4eh1gPNm18vQ+us/0eGmxDemu/fnM/X4evq/8342ksGHgLY5LyT/zg0wM8lcMjgGFXwqIOVFJBQw99eCvF9oZL9Mfl3QwAvIXDsBRC9R+fz8x0FPBLB0xJEpwUobrfAkARgIAF41h3wQgP6QAmX5E/7eI43IxGwwf/moIkRyWRJQIPgt9CA9b39nzt4bYUWjAlCjWDPgv8IEjgLJfzuaAsrv9VdVG4OwOXW/fdoA35qAdL0BDwvf6AAUVHd8LIEu94A3K+Q+2YxaB84MOH62P//qoo38fCRDERE2zf0JfmDa+MieElAjcDPKz+mRKCOtdgGtXaBjgNJ4H2owSpNeAW/rRH4CaHSpMwnBYYycjgSJwfie9CR6mPu20Uv8kABF206AvXlBMiIBPSlB9wjBW1fwEuSb94296VCqgMaGCt/G1BbExi3IG+r3a3J6P48Gv/J0YmEYoiGY7V/SxwFCwGoE/xa0AJ0CEiV9QPCJb1OJ5F1VTjEY2/MO9AEJvj1BJTQpqLfTlGwjABuzT962e4IoKnyrdh3+/6mzDVJ4PHOxj0JqGKoy20+wBMN6D1gLWi9NQHfVP5MEEPzjGYy8BMAOnTAJgEr8HUIejRo5xrA5xkR5AngmiSHs+zDDAmMgWzTg55GSJEmHE8IvWPAoYTfhWak/Wn/bQ0CGLSAjv83SUEfKp5q24LXuQICpzrjrgWoza8xVE00CQCORdhMJuTUT/rjuls0gO4Iby8BIEgK6gS7BsGuTtDrScH/fR68biUHNVGBnxjeNyHEvQe/ve3LZQqgG3rof6cEclsNflG9J4KtaQ8WHcVBHS1BtHE4QP9OBMS98mpbKTeDW7dJwRsnHpMBTFJpV4I+b0kY/NqInVFSyBLANbnMSgBM8F+Fqfxq/h657/Up+GaBnwV9hRqc9bZ/vA6vu+T9E8KPJWns94UfTeCj2QXwCHS9dNL8Xf3Ho/rfewSeFODGDV69AU0y6NFAE1DP3qK++rdB7/1HRxf86gT376zOr99T/h/ioBiXWQkgQgVeIrCC/WomhDmQK+hASI2ARQZKooHMLdCJwGEBBXC3+uERwg+VOHZ9ioAt9H80AI06wGgJ3nQA3BoCut6AhxYwgcPOFnxuFnrphk+NIKIGrWPQtgz3b0i7Y6D5rs1GKqTop0nQX52vmQC4BkjA+r4a7Kx9WLENGeegkhSETBCrNXIMdi/444Rw1n6E96ry7OPuj8UfLxtQ78NA2iSBbg7gIiIbdDLsb5agPhLC3RkYKv8NDbS2YGsatNRAG2oQwf9ZIOydgy1MAzBkAw8UwEEIDzSAqdPQ6za0PkeJAMH3Z0wXniUSZoHvBXU2mcjQgv56TedIKglCpIoQfgwCIjOytd8WgN0bfxoR8Fn9Gx0Aj5Zgq0lIZbsH/ibSJoFnS+C98g9ooHEELI3gliy25yONIiE6pb0NfBlyNEYyENoodkKwgl6I6s8kARgJ4ZoEfuYWHLEJa0LhSBXm7kImGeSfVdoJ1DO2G7WXsehAptupSOoyrCSF904k+6vt98X/ZcM98Hsd4JYIXhQAIg3/f9AAUYhsLQKAtkHVBnzjCKhOoYl2ym+iBtvzDzQ2DLXJ4PUmbJHAVnBQX4jkxfvHhNDqAdHXGQJgv0aSDGItgOseHIU+K9hXnIJzkoGlEKzNHagTdJ6VWEUH4iCKH4fd2AwDPaYBm4Wgng4gQ9V/CoGiuNmD04AQtNGMGzSAAQ2I2pzfogY9LRh7BrbOh4+D30sAencljFu2CUFrwY8UAWRfWwGvVOVfbx2uIILM0pwDv082dUTw8hYs8L+uIWiHGpWgClnAa1lMPJogovvvbePPs/q3Xr++kgCsfgB5oQF9WYKPJqEn6G+OE3i5AqouF59FQOmahQC8rlPLj38kg1c2f30vw+XaoIX24/pMGIgSBoZqoH3wo0sIIGlA9PWcCPrAtpPB8eBf6x1o6cHra+2+tpIFP4PgBfxZtZUJfo4qxELT948D9ucK8Mt9+ccjIQw6QJcEbrD/1g340ATuDgDkFfx6twSf1f9xvuBECYxq/7ythQQGm+5JDx6Brw4CkMGT3wgscCUoQ4sU2t6DR2ciBjTgtcpenQoZVX9NuL4Owc+dVaDursYVkVALX+shjSBKBuvCYDUZjE5BdNkxdHAUBexyHwB6NP7Iyw7sxUDViwge1t+mz8B/LAvVx/c3PeBBCToB8IUGOgqA3iV4yUg6UAOxaUFHDx6CYS8SorMOue0CCJGAf5YfRhoAI+A1CvwxqNkAY5yAIx2EQmkFfeWOXi+nEdSQQA0ZHMEItiagJArQxDXIrj8nCfQi4HZPAttrIahso9oPQ/2/JwV5JQU8zw+7I4D7/sBn4EO6rjw0FR+i3Z9fHtahzsFvJgM0X+tmVH5vaYiNDGAigewAz+gyNLThnjCURQFR1b9d3lZvnVqmj9mEPDKIUIC4KCCjBXywS4N+otp/Hk3QVthOkwEKlV9PQwXjT7s/zwF4Qf9toAAzFdjuaEB6S7D1//U5FIQu2MevO0rQQH8ZmoXE6B/IkgE60XCjVoq8gt2iCG0S8L5GdxkM1cGsfsCMArSCAnrr7dzAZxCEEpepvB8tqHJ/q+bmJGGts/AcAXFOMMeTwC7Pw0B6CtCtA2vWgonqBQJFSwH0JQK29OB2kvgj2HHXAoyeAIsCQO0kMNECAhFMqCBf8mElAkyBbX1tJQP2RJ/ha0gpAfS9l+/5n00CkrQpq0MZbOdAuxmMvHswog62jZj7BnYQe19b14kxNq2D/ehX/p68HEcF+x3yP7z/V/A/q/5DA3i5A/dzA5pdgbKp3v3/wQF4Bb70WkCTHGRAA6+KL0bFl6FJaFw0ImZwm6igSwbbwPn9RMBWf3sN2JgA/BVh/Rg0kQBgePf6HglAHLFQwqQQOwDjbdVxNZjR4iM6Qa3WxwvNxh0JFb3g/WzFQQS8b/ttKcDWoABtUMAd8j9hf0MB2uDXhzX4CHj03L9DBU3Qjz0C0l4mLSLQPicOOwZoVCB6P6dA7nDbGkVuxcNr8PU2JQO4wX5trEqmccZaHU4q8oCDFOpzAnOwqyMIMktNNNAHouDGxO37DgArQZzlmp/14W1QlqHTMaIIx7SCx0+5yza7AKJ3IXBrNAHVDcMZAU/BT/vgv/ULPOA+XiLggAREDF2g0ci6xNDRglegd7P7TWWH5oJfayliEg7bScQRBVgI4Ookg/F6rvpLWP29swREqA3CaG8/FpKqS8DTAV4TiBqIqtxfzaQRLys5I0XEFIFrPbZRQb+16Fgi2LvJv8EFUPW1gGfQv1T/F/d/HBnccP7rAwnIIyHI4ArgWeGbU4eHy6Tx/EeTZIb5bo/BsMBjmjBE08f/RB0PHYBd9eVRAGY7cHRwiBf8WeCPHY1bgBTa9xKTELzEkQX9CPtl0gJiqsAmCT7I8xbjivh3JGFI+D2nBcSJQJ8agDX+O9iBL7UfG4bzAkcaICrbtYHz1ycSmGmAjJfL3CMgT3tQpmrfB7gxSzC1DnvdhQMieG47u75+kTouKNkM8c/+vq/Q7ZYjO/hhVvRq8F/9gGfhP8aqE9EIdR6LTwJ1h0BItyDqB8iFwuNqASscRnYioxOg9ApvnYA35f8e9Ohbfe8J4rknoFkO0lmA2gmAG0YK0DkB4ieEjiLoMD8wBzom27ANZkzIoU8EMHk/uo1mzeVoEoRWKn8L/62EYAX/lsB7D/LXg74uAMr9oGivJ0CNJCGD6i9DhZdQF+gtOp4S+NODRzsDVbhdgv4BqTMNyIL9SCKwL9/FGPp5oQKxIf8A/UX6r231H7YIqLML0Ae2GtrADOvRQH5b/MPE9dt9BGLNG8jVTAQvIaK5TtvvvWQgDvyXIClUA78S9Nfg7VtIBlO7cbsEYkQDMot+ygQ7QwmOawTHnAM2XUSnJvPIYRYMmYPS+sv3J+cfP3d04JYIXsF/EwMbBKB9Q9AY+BiSwFj9mzrSXmcJhFPVHySTbgHJCPvRQ/z7G/SVUETsg0ZF+i3CRoCjhf7y1A9mOiDD7TwdwEoEXjLwAv+avLE2B7Jnb+OqDpBoAchoQJskxKnss0vu7Q2YhcDv4ySeLOg9GsCKiUIihP7yfW7zbTsBh0TQfN0iAWn9f72Z56/Ax9P7j5OAH/Qvv3/QxKfk0DgDuP+R3USg3bzBC7bO/QT9Eeh9QvDPG7glBQzJwK740lAFFgFk8P88CqDGAa223YckWYhr+c0BPdwetl2ocnsfzePAWcVnnAIp6gDVhDLyfV4nqFEDPxHsbWD3k4BDkN+pARqKMLYBPzYEvxp9xmCHQQdgWH/9EtH2TIFpu3AH/cdGydv1j0TQbRrq+D/mLcX3ZACZ15bF378CG0My6Kq/zoGOQwhASDFwFbxyNGBuSxbCEhQ/uEPe/6gAERWQObCVVfjPpQX+rexxYhYFxIkgpgX7Y/vPs+Pvxf9vwt8kAs7i32t3QCP+3SPaTwIytQXP38u0PESm+YER+o9B3vr8mETAUfDrEkPI80ck0FZ0dXh9U+HRbhey0cAc2H7A4y4egoD6y8JfkBiigLdFP8v2W00E8deT2IeAKujZ/QAVKpAtKI20gLWksHedfgPcb+0+NEHefd9vB9rayi8h7J91gBbaw20MsnWAF5xHkyDUCOoXp+yrOwwxcKj0aL6fFppaaKDv6OpHR5sgx5BAlK/+fYhuP1D196o8e7lFBaKqv5YIMnFQpd0FGVR35RJCnCDaABaXBtgbiSwtICMtalKC+1JQ6bx/PLcDPQL91QFodQNKpwOgF/9eqcBxBBqRcKAAVk+ArQOMx1RYGgB6naDhlK+uQQwJYx4meQbxtNnYQwMjt/d4f3M9ZE4UOld1LAh99fbfzOxiEkKFCkTJIUIMUeVnJ/9sDt8/e1NEJOi9oVHDGYhgnSLss9DX2IAqw1zALUncKcDr0FB5NP+0cBQNrEezDiyiADPkt9qGpwoPdL0AGPx/NOKeyf3b9WJNdfcFv6bKd2cLMJVfJ6Y3B6wB9WFUfWWEwKMfGiQL+3bz9XGQz2EHKhF41GCtZyDi/gUCsNhYoAr3UNJ58YidHKqnMb/6AB5J4N73/4L+t7mAkeeP3P+1LNSB/l0SkMEd8DcEuUlguEw6t2AU/PCE/q++Akw6QFf1u6SBrj1ZnnhG50AfkoGIdf7gJv1KcSfgzWWkQ9U33Z3tHXYASKJ9e/YhU90rvD+q9Ej69/wxYJVs506Eg/r3DkMDzEdDBRGgcZay49XihLA30P+l8N+hf1f57/0AoxbQbwYaan/rBMirE9Dk+sBzTkC8JNDEUlv5McB8PP19Y01Gayep+hC/2zvQ/2HGLAurowsNGlA1cnqGGzeH5weiYLZm7h3QQC4O2tXdhvMMk1ZS5ebpgI8eMrPvPGkwaxayk8Yc6PMOBPEdC1XZ+2UfbfOPtxLMQQAG9BcZFoF0gp/RKjxe7+oAw9T7ZPWhgedodgz0gf5KBtrtIZhQAZpAV1Bi36w6t98qVfH7hqGI318lLCjLCUFlxRHwqYEH9a2qb4XjWvDT7kBwfbZA5P0+PNuRuW1yf4yNQH3zzwv6b70QOJ0G9OT/dhoYRUGT15uQH/71MjQLtQlxfDuiCXrtM+SkA+icQdH6sU/xz7Ze7FlubV4TpoTQ2osdpaEjtqADmEU7OkBEFoLeC3IWFFeswJXKXzkboNL+wzcFHU8hTGKIboO7CLi1/P+5F+gydQhuvRbwEgxvtACmANikhLTbj0gCYk8KdlYgmj+4Ymaod7TwahwadICuX0Cm2fE5iNHPK0x/CDV66Kyg1MnqjNFBnhBoLQCgUULfaVe5nq/6EQWY67bXCszUb+7232fVPz51iGB12owK9peyP1T4raMFF/OEYJP792mgXYfZ04GHMAhBkCSmSj+dKqRPgVFGHbpLEGMiGFeQWfSgrY52VxaeDUPSNJI0P7NoisG729HHl78z6hxfs9rV3m4JjgM/lsui2qmThjCfDFSb+I9vwUqG5wwL55U7C+6ot8B+7N2o6r3q37T9trfpjgmTvv7PSQATLLeRAOZhIJHBQfDQQJPBdUwEbVW3+L08EcEE/9G4ANrCeWcnPKRHDupbNynMx5AA9IRYLmrc/YLSiD5EaEBS/s/TgnU9ILcH19n+CpHwegLejx7Mn/d25fdN+e9U/1vgb7bqf08MOtf8EXxaoh+GY8L6gDfhvs4i6HQ7seYI2sv1GchdMsBIG3xlvxcCRzdgCPTn+6q/TW00VE8Q9FaFv+R2VlOM1vm/hhjhDCdgNflVKME5B47I9xT8z0YgPAJ8myb/LqHy36j/Mwqw9AALxuO1JVjiuQAYLcFzIhiEPe05fk8tRjGw7yWQbsfuLAT2VqOId1osnr0F49VM8INACPHDoBz4B5mqqSnUgyh3ArjXxfQH5BbgUS8gP7aU+w0zHD9GGD0CGHf+P1p/DeivlhU4BbxR9a2kYFR58YaDZCUR2P0DMmgED2eg77puegy6PgDphEB0CwlG/i9d+/Hs34pBEQrBn0W51mqGnJAk3ACCHeiqkQ1XFQA5AlKH7Lk8yJKWY3/nym14h2C3JvxeMwD9ZVMz0BPMi1n1RbKl1cYhIVblF3G0ATsRiCMUvoK9//OgcwYMoe+ZKOLlC6/Xk50br9NFz9fanqA8UIYSpCwlBO4kHc4WLLBfBHVaKwKgLQjmP4Un61Vq+3s7Bsyi0WztmLjJwJwFeE0I2vD/1Q6MVwefxfUf32skCPbCnxQqf+QMPEUDHZ7vGeyj020JgkPXXwsldA7SYR1RE3h94NvNtugswcgxXEkIcBPCGZ1rmrgDC0A4K88nm2fn/eTnpQtWyZfybRoK8Dro4zYDIMGsf7saTBzvX0SMbkAD6o9CYbsfMK38cJKD9l2FJt9/VGs0h5Gib33pxMKWNsigFUh3G2un+/N1WUglI/EEx8fq27vUNnwsiOoKecL7kQS8VnWAGCFUgn6dBtQhv40CmIYggwK0uwDHRGAuBXVdfwzHUjZzATLMAoyJ4FmBhzaWBlrHld9CCWpPHRqofBqMReMGTJ78q9rDes1Tv7/0m0v0AFHXNR6P6g30SHivin7V1BOhh3iWPwvps/yE836L2XiwnUT8x2iHgfqhnwn667QHEE8oLQjEvtEW7GYBZDrDVkwNIO4G5GiBDf9fGoFM6n+vbEtzXwP6u9AduaWnGYSLAlVdl/AU+ikrSeEIKgwdaZ4AACAASURBVKj4/wtgHcHtdO2nWKcBkPfxcvnNQvsj2Me9f02r76T8q0IBn9OLKfz1HX8yVXQYGoAB/2UeBQ5/5kCL6+H/OGGoRnLSwdd3oH8r7KkGTbgIxEwVWvnF8KOpHnyzfF9Jod5Px+IF1h8owyitDw/XEgRb5bPqbt1uvn7qBIQ16vtS/u+DP3cR7CH0WWJgd5mTJKYgNzoGjQrfvu99NDBC+bnyW1x/qhTatv2OaMKgJWPvv5kwnMgxHYGFRtJW8VMl3uP+MgoqSZyWFKr7+KIDw1d6+IiOgZI4+d5iYL3imzbgyO+tph9t2oSBxOM3ugHtPoFZ1LM0hF4kXNEBssvVgPdjdXZWK7uKvyS3q1Xb1WQwtVDqSUggq+Vw3t56JA2cz7PXOwGNW1ecwxPhfe3QEUsDsFaAz8jg0nf+iZMAHNg/XSazDuC18Iq1HBRrOsAQ8NLB+16g614jmuSgs3bROxE55D+WDDQNA4ivdMJ9M1b309UqknaDU8ObV9/PwmMPATvTMAxpABLBzugUtV9bLdhNDQA+7B9tQJ06/7QNDHGSwtgZOCIA47InIoDdROQGtt0U1HI3GaoUnCnC/rzBMQJteN17+VaAzYNA7e+PFqHQUyXPUYB7iQYa5ZFjq1Zqpx8Uqu/XT7+6BWC1Xaj0GlBIwMoHu7UzcI/6/Acb8KIq+hzmGWmAYnADrIpvKP7TZeLaf0LAeQkGgebbq9FToI44p654F47tekKkI0L5PQNZPsDwPBpy/ni+wKMN76Vav4+2cFZFf8+JwAraMt0DFB7beA/u4Zz/a+RXx0M/ct4/jwaNAS8G17eSwmta0Fhx0VRxJkHMivso+onMXr+YwdWKbgioy1jp4x4AzIKg5lEA7wvHEYCRmdx11TAuT6lDLVl4KvXkAET9P4RT8H2u+lg9EPQIpw+/NpJ7RwE8HaDv/Mu4f3OdNkq/EfAiEiOANjEALvcWL9gfFV4NZbgbQc6qPky4Pm35QZxtH1f4j+P/jXuaYPcWwIEH/fmEPBoAO4m4LGxV3txOQqDU+dXgey+UwSzuqP++uImO/u/6ogCb7wTc1n61sL+vZi87rxnrNas+giTg6QLzaUCjIp6JfhwtGI7AjBBB9JjDY4ePYVR6ZPgN4owVv6Q2N5hhVHwNeYrM+w6dN6K1sMHZm/Ce7bHe3dzKr1xw1w4JrSQMZtgnoQHlr18fzunAszD4qurNUg/TDqzx/lfCaO6t4tACMUQ6P6htWjDPC1hCoZ8kpODzJ70MUR9AODcgwyqyPhmE+wfHYB/hvSqt6qeXUShhXH+d9SR8DzrDaZZdpSp/HxqLMQuATgDU/qDPRgOIeT8cvz/h/XC6BtE7ACLOWPE0KIS4UUjmZaJ2grBphiWgT41BUVWZfP3AnEIT6OrfoF122l2rMycBoU5i/OXoUZ4/aglsXwLzHNU++FVF3qikOj5HXm2PBitT1WuvJRAB+6O//W0/PY8vQH5IrAsMs/WuVmAdHBrQgrbOxJShXwRSsu08h8JMBpo0+aDTALwV4tbswgzHrftG/dJKIAQb5h9KCssWIMeto+GYqG12/HWGjx8kzqNJaa0noMWOr2KwW01AMwJoNvhMQda2/RKQP/3ecABM3g9uD6BY68Ntz9+nDOMb5iV+hIE+dP/Zs/wwJhJ9mgBnohBuStABUXjugF3hkXF9ZZJAjefKdHZCc389LoStKvIl7QIEb1d9RyciQgFDI9Cjyccc/23Aam7/PZJBhgDgin5CtQvbCzX8ip9YgIFtOAt+w0owp/hOiCWgEGbVHuYjRigPGR/YOnEoqPDoV5z5YqB3mRq2ox5ICmSSgAP1Ne+XV2NE+/vuFbCTRADxtS70VRBCjgBk2OyDUQiUgfl77b7DwaHm2rAZ7osRSOOUoHgKfNBSLI767+oDYrfwZvqChSpGfj3pFwZFsCJg2jeIQQBUiyI4WgD68ww4qO8khuWkkIuDrxWv2nv+UTBpJYiPd0KemTA8qqFiuUF1jWS3BoG6pADJq751JqBI0wvAVPyMQvjcX1zbELltKK+zBiXRFiRxG+b7q3M9xuLdzR8g0gCGNzSM5gNYfqGO9CBT8OHct6oB3KsSDBisUnwsFuISQaRHxDSv0vptt2oeLHMERfRn/FG/Cx01EpgIQG8LP+/i37PKw53xn6sYCM4/JwSRrCnIeB1ZkLsawDhaPKv/njU3wnZ/dBdGE8+YTHSG8+ofGgIjsC19YnwdM/KAnTSsqj6ig7uGgIPw3nYFzhhIIvriAxFP9CQd4HSlnzgxONIdrE7A8ZDPx9fjib8ifgegNIliRgdx95+E1T7+3nQVNNhEzDgGA3T2rEDLduwtPpuuouPcs8swwXFjdTaMKt+jA5gUAQPcf95KJQxYU0cYxEDvsBSmYuukp7AwnqniC9Afa5z8vboI68ImT0t26CvwBzSggkj447r9IojvCn7U92J/Hw0QSdwZKNNjxPCfSxRqnATkdwpOwh88oc4J8KTSm/wdbZjrc+4iFP8YO0/5JJDCfaijK5xVXevqfg6zGRrQf83chvX4aRfAE//6vv5+6490U4ADdO7QgM/5bcHP/n4OtCQhBEFeDWSvos8DPq8/IwzLzjpa8/U6MMSkBklDm8e0mn3QIY7XG1Om8wzN48y7HwhOK3P0/ZwUQHHv4psbdoVeb9VlAjChBCdtDDpOKTh9ZfcagOYq31RFjN4/gwBYzp8lAwYNwBELhZoxECeZxMlAzWGdCRV0fQWGHo8+8Kx+AAxnCIzowAxy9KvNepWfsfp4RR9kUrD88CPVTuXRybhqqTHcnxEGndsgub1Gdug8yz9fHt3Hpl57x/mfCOC29FOSQ7/noAZR5W3Ob24UMpuPYAYiQrQgk1gnFoUIKr4vKFpV15pHUJO3Y5rfH3UFHU4bGkU+NKJ9f2hJyOMxDBDpjAgwiYqvk5TqNl9EH2Arb6fA3yaA4cBtPWewhkEcIQJBlGzYp6zRmr1v+e3Fv27xpzvyI44NGDkCIi7CGNV9Dw0M8NtHC2vUwHINumCGNG8erxOwtQINsW88Tlwdoc+F85nI559ngEDpt2F/Uu3hiXYrkN/pBFS26hYDAkFgErMK67y9mGBA3L5ore5izf8b3n805MOq/t7XU4WHv1DUF/5gugCSOAIW/59uMwl6CHWAib8bvfxWl9/rBGEMTTwDfG+ezEYG4yk6FvRPuPwE+wvc39IRjENWM+/cm5b0W4Pf4WuKUnw/vD6eDbB1ETs5vl77Dhnm/51g6wPWwQAqxnivgQaeS3gy/u/1H4hpTPrIgHAN0mSgXUX13YP5PMIuQAfBr/f70cdeE+QoCX3i8nFMLcAjInBoAIYqt1LhC1WdtvmSab28AYffaeivCB+ohdYQgfUa/WS4ToMsNLHLc9nnvPZLwn1/EefPVf+U/xvnCVSEQEkEQEnEQJO7S7RvYDxNeNYKrG7DKMhtsQ8cMmhgPKKKj+F7CiHYFR5KIIPxOmg5IVAtu3ACQSPh7CzUQOgAej5CWEkIe3vgxz0ROGO//qYfz/dnLT+ZxDr4QW0eNCJBorCFOVC312Ec2TiY5Bk0cAaQmiA1VH1MOwDHQ0kHdEDDf+2UTWhS4Z8diQMicLx8MLBfverLcP/jQzF0P8EJj5+NGK9RCz755S6F/f1+X/gxeP+Wsedv+vF8/54aSPJYFjIQd624MDz/UDLQnr8HU3ztKHRf8Qeno1vyAQJBaLcMtTV3cvgP56COCqd/QP9xLgBkH4BxO13n4hNUDtACC6G1S3zqooZ6Ba4lp/zcAFb7iERKQwQcF39IFJjdXECGADw0IE4gg674pYAnk4HoHPx54tD5daO5vxrugSkMjgiiqc7TVKAT6AT8R4ckbHEQCYR/IZBxJgA+XZjsR7vaoRpIxWqeqfXuGC2CxwudicwePEB1kNkaZCuwyF0DuKv/4sz9mzP/Qxdg3BDkBTMC8Q+loD6UGBzx0Kz6eAX/KArOQTlPHFoI4vVtf4rNuLrca9edRn4xBP7k8w+9AgZCgBfEUZWfEs8iFNZ3UO7TqmkjCO/rWdgco/yIqHcQWaC2EGTzgz5y/iXQAvyx3riyxxV/JeBriaGB9OrTA5g9/eokM+37GszqfA/UZk9iW5UnCtBqBl3XoNN6Ag/+zy6A5evPAp+TIFDn15gQw9rjrOzFX0s2JBVAxa/nP1a6AsNWYGjPNGPLTQgBsNUFvOA3Ht9o/rGDN0tWOCcxJGp+f7++kkP7PxcGv1+GjkaLt/fawpwwerQxBJNW4b+PJsYEgiAYYdEAGIlDNaAbRkIgK3ut0jKByp+8yz23X6GttmBmjwDvChgiYLP5V/zhH6/110sGcKo5CkggCngxnIPoPja0j2B+1BRkiYJiviaLJqghDI63G2nAgAxMCuDdnoD0wIQm+urMB3VuAwbBrFGgGgnhAFqg9+ujKsLxB3qGCQNEEtPinIQlAj4WgIw7/iXc9V/x/yUWFs2KH504bAh4aYWf4TrTLGTy9YbftyLeVOWNfYNyt/ji29mQnqMAltU3ioTtbX343yv/1u0YPUBz6zB702tQucnX0gWaFh6DgPdmhXaapGotw0SFz1qDiTMdd8h45HfcqCPRUhA3+NmKz1l9teCPaMd4urGaewRitNBDdahR5c3AfQmDCFT9vmtQEwqAYXX4XI2n23Z9B/Yb1FL+LWox6wHGbZSo6FR1LzyG+3hriSZvWT6jfXhl2cmQZJDrAbuYAqAHo1GA/EOgD8eGcU7A8eDvH4fQBuAhBL/Zp/vamPTrRENDGLTV/7E1WEPLDlP/PwzU4YhusIMUgfIPAr6Dhv5R4y2r8ldFwiFoYHnmr8TAHbhRQSZOctH598ZYhqt6wP7q/ouqe77RJxvzFYaji/z4vna4v5cUMDXqDAJ5ytktqtBDckyjvJg04hl16LB0xFfyMfD77PZjErGQRRjYIfSvoAXntks0ok8MsUC4KARWnYPlJBeIgLeFrUgDOHYCag0/XNAbWgRwQuLAsaQwIhC1g7+jCNKuT38JfnYSyTi+QQEwwHeT4/dWHYxJPxfOj5oAnRQqgU3YgGZSOaDyK3n/qkDYBKptzR3oD6B4fyRKjp2AzSl80YR/3P+/1vBjX18Jbu+YsrMRgbqPP8zrDLTAaupphfeZtyPs9BPztpLSBZjowF3woYRwBwOWaqbev15b7X4RWsiqYiY6ZkFEIoUwUA2OrkeEQE8HYNyD/rl3m88jCGgO/nPW3xy8x4Q/HBcM1dYg5q8N+B/SBSYhtD0EY1PRGLDoKIBHF3yLz4H/gSYQJRETgqeB2d4vC8L2NVnQn4PoVJJAcP0inahAfdXVI8CFszjRagCTtRdV7Sr895NBpRKXIT64RMFw/iw5eChhEvmmyUIH+k+Qu3cLzOAN6ILlFvgWnx3YWFDz0f38ze9GlfP6UQ3ojEY0gtqRIEbA5/WgQFhsEuIeL75uTzvqHktAWfj/OD6sQXssROcGiRgFn0QVkld7OznMDT7CJKzhMIqxW9B+LCOQdH4uyxIcE49VTSeLj0wKjzcp2oDXQA8YoDEGBLMW0BJw+eAxXejPV/IXd59/tp5rVyYXDw5BlRetSpQAcvgfOwVM8ObzBq/AQ2wX4lwkQV3vNhYFfn2LFgaoDU1ogqsfqGkJYmrj9Tr22KQwBLzbLuzDeA9yzyJjVRfwegWq0H+FThDPA6ZhZwX2M2Kh4waovCzAWJTzD/qY00c+6PM8coz08VNqglzx54LfHuTJK7z2rwX35ABLg1DzsZ7Qv7l/f2yXDlbf4C/irg0MJ0aCuD0wP74MrxfdFlX7tq+vtRdCpvt599EG9Yz3V+P+Oj/n4zLruZHcJ7oMt/MNp9eD6HEeFb6/TMfbWo85Pb79HJo8t3371/PuIAZqMvjPC34nVV6ZB4hEuA7AzA5cfU0y2n6ux89D/35/n2/vWY5Bf0qwf3tPLISO1Tap9qzFB6eap/beqI94NCCbGwgqOItY3CGl446CaQ8i2Q9g0AvmgJOnBoAA0gu17tsKtKS7D4udgCYERy2QIceCX/P7mBW+g/7D9S6Mn50CS0eAoQPDcBjopIA5+EcxEjLweRjXq0UbLIjcBxsGx2IZvlf0ATjz/6qypAmY7bhrk4ahsIis6ccXKHdueAfUgk+RWPCLh42c6zEeKyJpRTdRAOqBbl/Wq/uT+q+Fx3FoTIuCzc6+hN8j4veGjuAnhSE5gKnco3A3XwYlq2sq+lmP4yEOpqEoG0M+mGDYuYT0pKCFHgLHKt3T7T9p8GcWH+n1UwGa8X6kQt2x4CeqPexegT6o/Z4Cr313PHdgrsS2ZReLfpKIf+IMFnmVmwxQ9AhithYT73+p2s+JIVfrjwiHnpAZrSsr9CMstQXP1+1+510N/q8E/YoekMN9OMFvi5LvkRDsy9rgFCOoPdpgaQIWBZjf5KCSQszZJ1ivTvLokpen6tsJAVND0NFqb6GUGg2Im4Dyx9Pn7/0dm4pADAslJzTv+dKNrAPQ0wyySm7bj1RQgbAXsRa4R+mBJzpaQmHLmy0BLoL+Nh2ZRca8uUc6P37k97n451fvTieAE8BdZ2ItqFEK6oOJIYPsiU4woo140Oh+H/UC++gatHYcOFT+2y3AYvD1rM/fpxdUcsAi70c0OxAEP45X/hymE9XeoC0zfYhbcqfbhs09HpwnKMDR6g0mmYyKth/UcLl9ITGQ8N1S6s+gA1HvQCc2pluPvN2Br8SyZyfyxPP/VhCi1L1HWX2CQCuAE8TIq/sBYdANZmTIwqq0sb0HIzhhugBeUpBZLFyA8y+EErsBUYDZHYN9QAAooQwOws+uQlhdESSSqk5Qsh8LSYI6LDS1AbmOvLlRBqQIeITvM36+TP63VfE5hFClCTr9zEyVFwS3STQBy66DMHB+PJWIrfgGnYBx2dTboPa2X49GaBVlePA7CFx4iaGi4ns0aLVjMGvtPTDtmO4XEE8E5Kb/8qYai+NHl60LgAICcUCoJPVeiYG6Pxw/X9VFNVbFn9FNPzXoIRDTyzcpREYB5Fm1EQQn3KRi9wKApR8Tz48SwxnV3qM0q7ZhpdKvr0zfY+gO4oQf+EGPFYW/Xf5hwWsUgxiBbShGoGIx+D2eH1h2EeR3UQMH4zMaUKr4033nzkSkfQADelFbLOQCalxdxvN8mInhPas9bxtGJw29Fx3Y8429MAS0fL33Oeo7qFZeiToCC3B/VSNYuU0fgDnkhxGgMFdxiYEY7MYel+OHPH30IMeVFK1C79l+QdXVpFqHlMAXEf3EYDyfkkGdNvJ8f3RAXU0jpgM7jMNA5yCrtfzOicKG/M9bgEkEjqqPPDEcDfqVwGZv6zcO9avDfOhf4OmLFd9OLBHHdxp51HvOBlnAoQksYjASA1xnIhPsapTCPjbsGB2YevpPpgM73EYeSYIftgPgte6CWesVBB9QEgfnWYMgoeC8ql69bWoRIqYHvSIv/u26bj/jdqZ9KSGk74JRo6QS9PuTiSHm6Z62kLUGH0UO4rwWrhtRETkR4iKRdI8giJ2D2nUCMjsA0TXiVDb98NAf/rCMlajA9wesWHZrAe1dlwRyVI2jx4KkyUHSx7YDe6YD4tOC6XW01puEdAJwaEJzf1uATHi6ZlSCpBQscsh6C1xRcWEG4bCFeKcAVhVlDu54JQIkTT21hptIT/Afk0kMcS9BKfjBJozcDXCrtgbWXxbMAw3INQIxtQJPAGwXmYaBbYh4SCsuKwLOAQ5awKskCMmRg8P3xwlBfbosQaDqyZqBkyQe1CLQACoTgN4qbyHsPwkTiF2pYaj6MAXBmUosQHnUEYCsBL3MW39SNKMJ5PfoBsT33DVJCEbFnBCMOkHfvj6Xq8uw+dgRIhGgAiUqf5QgKDFyhe8nnYrlqn9sG1GoAfirubygX4H+8IM1CmQrMFAJ5ExzKIp54nPoVU2Auh6eBShDlTV4u5c4HE/fVvjFrsII0Ik6QX+Iq68jB19ziLoKC27FYe0gC+j1RSS+BgB7AvAM3m8HLdy5fV60C8RMVuhD1ieQB32MCCq0QPJuvuw5IHF/geMKwOPdpmsxBwVEfGEOgeincJqNmuSFIPhPq/xM81CWIIi+gCFBqDX3QPYd2OcCRo6GZBoA3AM+00aesAOQ7/2Pe/vBCXoguD4OBD1WfPwClzcui12AuH+gC0gEwW72KfjBCQRBr05D0IQc7N8PzOCMehPWK384MPVDJQim7yDdoiRTItzzFV/ZOX9sYFetP0fsQzb6O7wOoFjxk89YoQXv+BmSN+yYHYO+BsDRAXHhuJXsEFbdIEGZQWUkNVNzGA9NZUVBIQL7jASR0AclE4Pb7JN3BO72mG92+o8UG3nybj+mASh0FsLKn9GPxDrEcS2Au35BzHO1BksriIJdpqWjKR1wlpR4fN977rZqI+XbYjYDgVDpcYQalOYKMiuQbB3G6Pu/HlMbi9a0EMkksXtjvvXTfgMKAEZRN/i/O7yD8Da2S2Bdh3ICWfp8yuMkYl5a4df4vVWt4UF0yyqEnaT6swYyWB8/j111Y1ERS9oB0SLMtBGDEBD1PEHwtdjUEAHnqmoHU4wCDAoAS+lHwtu9eQLUAgmxVvAuMB9cELMV3m8EUtcBYYI9nkNIEEJYrQeUHfnzzRyC39j8CgSkir/E0P2odnAmAqDnDIhqrtV9BDNS2POjv/0pwKr6z1h/PMz3uf9ykFYq9TtoAXSwpz0HljdvBCVAPY6t7osv6gFhMpkX13rcfXQMIpuTsfTibkfOPRAC2meLRipI4mDPwMD5x+v3+Ey+qEfACwoUEkKQSMZxYJDz9R68PyP43yvo2aYf881rNQbZgRU/jp80QnW/hdXqJxMvCFxXQSNHpE8QiF4XI+wFfQcw7VL2Md7RRajsKgh2D+6SLAKPF356+/7yXYBTUgFy/38StUjFHweD+iiHh8/LV/i/TSvGk4L5x7F6AsIKbgb4C0YjgdGRIToGUx7cgS3JKP8pRcgak95BJGQbjaJdBYQ1qHYnYHL8F45QgHx2gLMQ2cDxBD/4SeR0LSDi5XzPQNjM4ySE/HGG6g+ugltLNSARn281BPtNO72eJLjdX4ITSEgpQvJYFEUg24f1qAYQNQdxx6Q/RcB85j9f+03zf2QV33IDPHegNgPABTfqFR8cZK9TA7/ll0EQbUUHW8Gr1d+MSadia+LRHwhunv87yWoJ3h/pRDwJAbDNQQFd2P2mH4kP/wDT/ZeN3CK3+ZjvgVpw4r20AMafb58j4N1UMknuj6iCx883PU9g2VHVH5JX2eEcPghSgRBCKPzK0Q3fknwPN0Hk0CyC0zBkz//7duEetgFjVtypASDI4CsknYJgYDhqsBxxy29+eyxrAZX75EEf8f+CkOcijMDDHx4ASYGGu8WHgPwpHJc0qOG8FgFTuVk0cRZVePFwHEIUEu8xSHoL5qWg4I7/HgOKXe2dcnu2SSdCGIDTA+AcxY1zYL6Q6AAFu+/1GvjKPSeEoJV3NiM4Dz9C6oWkEav+NWjPWXNOIkKgNTi2I8LeBgaZHJxqrC4oNXoB9pzzMws/OW3ghSyQJgjbygOVEDhoj4nHLld8HPD6UUMFVLIgKrTL7cFoBRLQgEdXIseZ2/HhFPKbk4d5tYWwwR0nIFQSD2P5gQhs6meVfB+Bkyz2fOIvX/zxqsSODuAGIOLtPNnmIPCrv6Kqvgz3q4tCwNl9lWYfnsdHj2HTgQw5IBHwULmfSu1jEV3gDFSxTBmqSEVqiYK2IkWcRiAkwV/cyW9YhqHXDw9dkNQAcO6HFNJT7oChfrPUYc3KY17zAd+evAwF2w5SCKLV4EuCEKsKfjBVWHu9Q9Arh4CoBqEMWYBsNX7YgKP/69uC3M7/mOOz232QT+ox4iCyJGEFP4oBHd+GVvXBwX35nqp7qeIbV6L6tdZub3ueJ+gBIKgC6S5gOQFxDoGr+Bv2nzqbknd7ph/EmXzO0o+kZdc/wqvQkAOUffVMzKtYgx5Vob1/+HAfCdzHSiXHenX35/2JTr3KZ9Ruj2lYiMhLIFoNyMq9hFroeYMTE0bSLbhb4l3YlFPa6hMd2jk8dmrDgdQCnC4/+ANFlYTB6ATlx2GDGXP1rvL+SnWHw+cJes5/rRWt4H2pw9GklD4uSMpwasIQiaYR92gIyFX5S8dtRZt/nCAH48VXW3hRE/HKOsGquj8EM85Q9cfeAV4XwNGAlmIFIwPYrfLKuxV476RRetzcdeAsRSZhiHizCKEIOHn3EMOWy5X4uIJnXX6sFiBFLaBm/THOQAkVJK9j6TKwiSDTBWpwHkSPQJX7U959uAkoaTUuug6oQCBz1Zlxm0OJSIoIw04M+7zCGuYiznCfHww9AN6Ir+HXA7lfn2oBSJ2FOOh8SzINfmcAyITq8JX/sOMPx6A9LeYtVfwgCBZhdu25OB9/XmWWNPUEPD5dUuJ68wd1AqD2+w1PI9KxE9BW5t3z/igdYGWiL7L+wPv9jgVY8f0ZcbCKCuLAHN+c5wa69Zpr0J9t2KnpAGzyiAIPiFalJ8/xXrrA6Y+/8NoDnWCPNwFJzf5DpVkHte8hx76P+HU1+HEytEeSEIzAsu5r6wPJGu6oLz8VrKofXLce+ywIHhNa/Dmw8LrptWXZ4NKZm4pr/QQ7Qk8ehMrPtAF7PQCD309QgRgRZMKgAbFREAfBBXNalbHA9cEHMo4IgIUuPjjBWEUFEQpYTkhVO43eRiynJw9Jjj8TOUIlJExK+0wA4gWgQvcFBHAc7P4/u78/Ff4CC5ATB3P3oUwFClYgcALcxzp/B9Ez4DUV8RjBbsCBrMH4dLNwIDaCGhA6o3pXksdBvYBsktrXDgNJKAFy1Z+ZGIy5NXgXoBT8a3ZgVSPIUAMV6DjLxhsV8wX4n4ibbONObHNyCr8Z4FinNFjg8ziiF5zSV8A99u7Zdf5OisvVaAAAG3VJREFU/kIPAJLWX3hUIFD6o7MD4WkHIMXBk4IftSrPNBJVk0OoC7ice8HGS8XBKDoz/YFBLaQi392lGpCMJfhD9xVkx5Xbj73P9V4m1j0v73x9FjDDPlYvATkgFAVWcdNvJBamliOjAwRV0EpeRymAe717kMYRyy/j5FwFBX0fP7Dyx8gq8wn2ZXi8GfGYR+lFcGJSxa3Y84WgzBHetlU4cvKY44Ps4iP9fsgsPGEhQTAcHqwwGCj61SoPexKwasXFqtxq8qhD9SixoBBYcJEDNzmIoi3J7QkoJActVHocTVpPBCDhElAvMDK1PT/Sq3DwB/ygmyB9GNhYDH4so4Foy48kkPtZfZEv1PQTxYpyX0EI3Bu+/5krcN8fgwVdwWu2JNVNWAk+PcOOPMNdGFyAZ5Aj6gicgzNfwuHZg0HrLxBWfjSRl88fVCo/apX/IBrIvf65ZxtEoK9Bec4KZIPLe76osQns46NwW0pUPCPAyMc4A/KXOwZzFLGbAqD5xhhbgBcWfoJBAlarcCSQgdQJ+Movnih4gjZQTw51rz588y/ZgxVUEAQ8soCfX8OR26JwujCLGFAMsOjnwGrlPuQw9D/PPv8BYVR7pG/eeFtQpsLzR2KFI8SwKj9KlX++HeLOPuSBKrKeHBi7L4b+Kx184+ptAp4Trcscv69oARVYzWgaK01H1X0K3zNSmARKtxXYHvwJuT+8gLGGWgpHcWOmBeljFB2Ckg6wiAYOqfxEK3GMCAj6kIiTWdCBCXhkjUKMgJcLk271N9uLSbtvvK0S69OXAvoA5z94VsFubbmZvx4QAnXgBnJxENyQjy38wef81uPhxMpPJIQzr5ckuUTKe0wZyN57iFTWga8GvCwlh5UqvYgmaNV9XSxEVWs40kkosFwA70RgNOu8mLZfR6wDiwRa35y7j08NksqPQhcfkRBK/J8R75Iz+9C8gJpqzwiIeZII3QnYOkJWbVEI5jNuA+o2BwK82ifwnpSgHwaC+GNAdmW2VXfC+vPu6wR6lBj84C9WfvivZyUhZMJlJhjSukDlFJ3g4AvGJfC1iEpQJ/CaEd7G9wds7p71+odruKrHip/C7RdsxeVjzIxhoNkFGOW/+sk/YVAGtltfzZAIfzix8gcHhZCXpcGN2u69qWqD9OlRFAy7x2fQBhHUiETB+DocqvArYt98f+AEAXApsEmEcNLC0t2uPHCqPQIXwHYDfI4/9+8LMpchqr5HK39MJSrBXwnutNqjovjHFdq+fcHLp7YLR4mGgduW5hFpAXUoL4cTTuW5HJSkB5PC0S7A+8c+837DyoM1J9iv/po/o3BunlDqPjOSO/YbLFd+FGy9sxKFeT8b+nLNPrkAyD53FtT27yUS32yqUaEGTMBiASGcZ0FmK8nWxbvjC1q6WQC4VdWdAcBY8eFoAzIrC0b7Wt8wlPcIdE1FhUWeKU1Igv8Q/0dl4k/NnYSxdlDon8diUDeuQB4c8XVzcahRgyyZmNC+LAgeCfSVALde8/t1DCYawNoePGT83wlOpFUdOZKwxn89OsMEf0X8CxJCBN/dwKbFwkSMgx0ACJJDJD4iC1JEYh6XcEqVHpx4+J4I4UiAl26r5x64sttvSlAn3LBuQCz6edU8C+J5epBrC4YP52EFDgHrCw1B0eU9bOaTgh3wmYvQV3Oqqcf53XnVNXUBELX1xtSgFrirlII5d3HFulxBCNEfZx0h7K2f34XwdHpuYQcguN189Ow/nPXclaUcqMH5leCXjKOjbv3F0a7i2ZaRHmBe5zwnhA9S736ZC8AH8LHkg/T5znYgmES1dtuzGo92qwHIquiWX+4KgVLd8utv9Ml1BQNhEJW/FOgweiTguCUoQHkEwYhjfQIgm8eAzPKzHqAG5xGiiPyxeGRRaYetUpDVpHVC1T9bHGyaknb/TQTnuG7rDYwYCUT7/cMjtILzA+Go/FPw581F/mWeTkDuBsBCAK8ki+A29nMzPn4Rzjv6QV7xWW4fzQFUxb9jQQ1qc28kMi4mDl1NBr4usIsz5ltZqNm7AeJXfuTHd7nioLEyPBISU+8/tP1AC4Il/n+YGmjg2NiBRdl6yCw//zG5ph7bqaBuz8B4VMU/TqSsNPbwCeZA1cdxyG9SgKzRZPL+GXFOiH1/SFZ9wX8M3zUgvH8a4rMBjZj/h1W9MrwTiN6MlsCKiI4gycBzgV/xUaQGjGDHwHiYi0VIzeEAasCpNuL76AC7BIEl7i4AIxnAfoMxk35eJbZ68wWEUChs8IPz/EEE9BkUoNA4RCWSLJkY1h0Y/dG9bVCtUVPe7QRhtStXG4nOECDfUxc4Uw/Ik8JkA9o9+a83IrfHH11EdFUWc4phNgVFWkPsIHBnCvCCYBSgqEN9qtoXuwHhByYoJJA7BxIkkRwpDGgAHo+vQ3ZGOwCFJCJKUAx4MBpFZWvReeLgtBBkDDQu2OJxXa7SE/P4ZiUPHABjY1DsFIhPAaygWewiXK72hHjow/k8gCL6gKES8qcDZ7A+EhYlWCPGCX1wXIwzkQEKt8cP6iqkC0FEhFj/ZYtvXCtwuBLcDT5wXN+9H6ZEIkTwV/x/s78fXFX3siWHEKrC3tw7EFZ31Ll7ttknQyEMGgAqCaVe1bGk8r8nFWCQQR0h7CY0dsU/mIeIuA1AGCo02Q0YVXxub36sG1Qgfo0CBBUXxap+ECFEycQVyViBEBFPt14TK9rZHB9EwMG7DPXOv0OVHkdtx7OSCXfb3av4CFZGTwQBwT7/hKPHE4PzpJ4L4+FM9r1n8B+B+9R9I4Fu9brYUZgCunZWNxdQgIs8mASBQ4F8hJpEiaf4GPihk8FdAxin/kybjZjTj+mAQy6ihZ9whDvHAWB6BKrBXQr+5SBfqPaINwiz12UIwoTmbPACZY/fshBBBKNlW8ZCHwH/cVKSOZMm4Mxk4OwE9JeB+EFkn1IzcPQoiSB4vGgNeJSoik1A7m0TCmE/HrggB+/1M12C1Z18ACGoIeH1pH2IhAqFWgBq+kDFEWAvA3X8tpW0cnSD5WAOriOHhnYraF1eLTkS8P/QsHUBdtMPnOrMaANJE9AZiaKWII5Ue/8PTHn/UcCSTgIF2xN4zdmAQYIAKeBFl6FiO0aKfq5jcImHfPwTxcEdRmD3LcFoAva1Hdjm9UgGggI9YOoPkOBYLsT8HlG3nucMDGkOOJ8CkNOELdSO7D5qqAeJYBb2GpABgRi2gxLITgrOQ9C937HgB+0i7MeRx3gfPWCXLtgbLJAu/gCFBPzRX8eADJqCvA3FViC/BlOQC4LZyrBq8BdQAOUKoKjqR7v7EFfVFMojPgEoSlJesNIePyLHwW9NRgq7E6HvUN8A0yj0wyWDHRZ3J2A1jHdMyu3hCGwSDwdRir7h9VP7AKLgPoMCgKziOFLtrUm8aIFHlgxYfz8WBYUU55iAXauo+evJaIK/NTgRJM9sUcZRzcCnMdNKMJc7usnAyrpxHYkTRHK+n1HxS01LheAHqRWwKIDqLvQC0+PupHZgBawfVGsiniTVHwZHRqbUI/D4Cd+ftgyLAR1ehkIiqaKFw7MJEwUIuK5zsu4svoFYCFKgBJZACBuppOId2RDkPZas8H9kULcA9a0KTCQDGtpnzT+RMJiOGseHl4BQ1C29AWUXIIf/OIwwqoNEK3SCuA7FRiBrE9B4/PcrGJ1OQNj83F4Xbol/TgVHfMiIZLAdcaVkgh8sLrd+liNQH/FqsNTfj15m1J0X+ffZuq/gTY7QnvIfJz6UzBJLs83ItQpt3RfZz5iuGfNPajpngUm0R8DoA5jDlzsOTAwZjzsC3Jjxg7H914PjlcskGdghgx9HG4OOQH34uwQyzz61/0qiYNQjXxECuWYbGM/DrjtPH/Mw/K+gBLLSA+cEfPr4MroArzcDuybbr8Zc72i2UnzeHnTgzD4Ug78SzIvCoARVOQxaFFR3TzWnkkHUVFShEuqKxZnKz4p4YYcf8ZhYhuu8wFgSHcuuwCJagI4bgchJQK/qe9c/RT6nGcg6KGREJpb+MI0EY/b0jcsni3AJBeCQNsBOFVYoApcM2Aom4VFgIRdHpeIG8D3YaxBD+qCiQ+rBOSVnci8hzkAG1t/pgHA4uwDzmu8xFKkkkIqCfkIRs204r/hiDgutoAAcowBMZ9+KS0CcXVBOHCvJw2jMQSJyeoeExF2DuTuRcuWAo9sefyUQ6/oBaIjPtiRH1KvQKvygAHb171d+vc4GRMDPoxN/kL5pwlVh1mBQ1quQJAJ5j0TgOAis+h8d3mnC8xTKE34+8sDNjyVXE6nFMN+H39TQDmocHScENvN74LoGScGU4f7g6IG3n3C3qnG6JBS+Z5tHOOzRYQx+u7MZmAl0OSsRLAS/VIKfRAWU92+12aaVPksGDBWQuCMvgNy2M2Mt8EwqbjosZAec5xLEAmXmcFTHiOWARWglpNpjdEtBQRxJJU5VL5/7F1X86XntXgUK4q+KggsUoIIK8oA+kgy4+zLaACqQGTVOX6MBWdehL6BxHn+tlyBMDGAqufd7WOX5WTJwKYDfXJJP2GXDPk7Tj5Ed7BOG7DMFaBRAJgI/+H2Ngeb2SKb0zkoGlQBHkefDr7xMA5HZeJPtKIzyApI9gmnPgf1c3mulfhe0gFekDCdNFnrOwi4Gs6eTACNjB+Uegcgojog4V25P8bctRYY6RL8AJklE9ACFAGZdBEahd4d4CmghFhbzcwaXYH5qTlS6DY+KfNH5Avzjo2JJ0poDkSCMxLn73H/eB+ifvgvyIFCWAji7BWC8hd0qj0FziMdrS70BlVbgamIgcmotGZDNPwm0L9l5iHv7WRoAFx57ScFS2r2iwot8oKu8l+TOCOg2mZ2nFdjTgOFQENzKkJ8OjEnsE8f6AzyXwT6MNF3RDRnuj0Lwo6wTlBMDIyqaz6G+RiLJMg/KUrQV/rh9uH0tWduwoxmky0kSMQ+rnXxZsGadgnxfgk1pCnsIsGYltvfdzTOBIclIsN8MLAGcz5gBwj94AE8DuC9Molip/JGwB57nRyJiyD3pyk6q5ij+3TzRLohcqyqCEQBTepF15+WVmW8SEr5jMUUkx3oMIsrH3ndwAQganKzyMpOJNxMQooGBYwcByw7axIhgPRGEr6GSGJhkAELoQ1YRg+dPeD5IIRDIqq5PA2Jh0Rq0YcS8XBi0ghGRFpCtWTdum5+yLOsQf2EuYY8AfnbQZDgCjHxBSKwTGpt8QCIDVH3/4H5OwEvldhliINwAFLsEyyIfGKV+vm3eEehVqKTdNxtDiPoLHCRiuwTJxCECxMDqDjTvZ63KaPKvRgV2i/F3ohm88V8LN8hgJcXD5pVGIPPNn9EBqSQC0I4AMxBUcQNCkarkFgSn/oCs9GCVep4eUG5BRAOcQOCWlGSc3If0IFqRfURQGRrKewPKEJ9sLnIowKCcw+f48N6UHjqYtgInaCCkBbPSj8VEkCr2g8U43wY1xX/BNkwreQrzg+oaJghOCGTU8RBxuIp6VFOGoEXgEsBLIgV6gBgxoLSI5CgiYNT+GBHsU01GthrceiMUtv9KgAYktgVNeGrBbtiOQVi9x8WjiAW7UNUnm4Vet7WtsFgDCDYEwQ/EVL1PnQf/xCDLTowTh4c4HPRDoQaiwhKIAae4B7xgCBydI/CDPOrevK0FR4p6w3VfoXgQiB3T1N8Y1PCD0X19JqcHGfzB5WkQE4p/kdeXBcEVUXEIFqSij82lMyrWq/7c+LFHA7z5/dwOHHg8s/Y8C2CmhbmALtare+4UWLfb25BmXABKABTniC8gRAP2yvDAiUAsElnrxFzITQa/sAFecAOY7zPV/8jMQHSbWAiUPGkQNABhw85xrSCv+mMSzFR8+7mjw01A8f4F8S/td4jnDHYxpT8/OEyV3gz2+GTfdAeAszswfJNGlQhEIjB0Bls0BKn4Iw7WKu9f1gmSagmvqleEwJwnZwjO7npz1HdCJ1hS/mlBcRXyF3i/M7NxqJFoeH27z7nnJaBmpUZKHsTbGUc1ALEoIGsGYl9ixS50gjAT/VhB8IzvGTrBVfWEz1MzAkRFTtecW731VdjNQPukVdhdn0Y8d/a7WYH6i/TBPBzUFwAlHwtGHOQISrgb1AMUgDETTA3+THAdeRJhg59V/Ektofa9I8wxVICkC7QQSAd2O3cftzPzdMK6aA4iZI4ILfYRbb9RgqICt2AxVnYZ4kkBvHOBxT/zN9ybHx/f5Ql2fkGCX6ANm6F8WCfqAS+Eq5AGcHJd2IFHagTMHAAj+mWBnDXuc81CjhsAi5dL2K8QCYI1aJ/PJtSSxEFXASv7C2I3ZB9/a0j/7nDn/j1pHsz9Jr8fNpxPBUAUUYD4wz5GBlmyAiORjtAIGDFwzSUwqiNZ1d1tPiB7/Q9VeI9KeJU16/knkEeQJEALjY4rkp74fCZiMDSA/PgvT/aT2gYgp5E/P29AKBQAo6TRth5T4VesQFb0i4K7RA2MZpgyFXCEQHCOixuYMPgy2L7+45ezSSKt2oUkURlpXkEMOLSiXPuDQZjk63N5bmzOSxQdLHX7AhwUEA0BAeQPJIQzkAuFlOK/GtyLdiGDKEBdllQ7YouxV2Xdwza9So4Kp5Z0yAgUhTlJgFzSFrznIHYIwKcCu2/L3LsCg6UI1b1/CA+ApIV5/32HqOIjdQusE4azip5Wc1b0q/QGIAlaWEJbXP3r/L+AEipw/+BtkQVY9fIM2i/ZhgVEgJO6DZ1ksVtlYdoQAPhVO0oKmYBmnAYco4DRCRB3TwCziptaE0auER9/VzRqKNOEYINOQg2m1l9GpGNQAhh1v6UmxNQh2M4+LmlUzll0OTjYQOaGlZAEMCrdhmBphaMBwBADrSQQc3//He8KgFETT7p6BHnjj2X9EXsDjrgBS6ihoAmcSQVYmE4JgYWFpp1waAQRoqDzxDhU+HxSnZHz/9JEY6Y5MJA+cwoWrt99+U3Mc/9g/NQTFaigAEtwB1yBzwzucZSX7RZEILhR1d5GDCsBLVUdIQvsldZfEJt5i/MHx2hGJZFkVVyK242iFeh58oBUFqIQbkfp2DV2X0CkAYgv1sU+P+I/HmBu8nErugdRnUWhfp+A/ddlbEH3uQlBsNobUEMHasK1HOYn8BEEvCUaiuigXRIKj+sGOPA4KAWz9/s7WxcgB4+a6/fI2osEwv4yOENAiPf+wQhbc/5f0gGisWuQaRFmGoIqguARWsBQgTTocDLMT5OJUQnhqdCEig+/EShKSEgTVV0MBMnz04BcshPnLk/+OaV0/dwKzB4QUt1NB6uTDfGOP+cNm9mEsBAFiM7AQh9AKVEU75vy68jeOxrUC4mDEuYO0oLqoSdHaEF2eXYYSm0V+oEOwpLmYFOF3Z4CmAeBTIGueiIw2xoKPzDBJVBXQ5g5O8/twwA+QguIjJt3+g0NQEcDfUXgO5gsqlTBLkQLdl86K3CWneitQ8sg/5oWAUJP2C3V3RoEyji5n4b9lB4t9pz2CA+cAFn1Z9I/uzYsU/ELtEBOCHYQQqGcFejV+yeuRJX31zsKV5IGjway9z6PLDxKwNEPsBuOEiqw57jGgOtZ1Y++T50AuMFl7hPIbhskiOwsATtRoc7rS7dXrpcgrMCGJca6ELJo+Y0be0BW5ZKGcFz4y8W9BduwcDnK9iO5fagsKpp9ANnvDPxeP8THNyIVFo1AMas8Qk5v2Ytm0LCCYAXqn+wQsPTBh/5Bcnne14Os3uCQt28vsK1WUESJFviBgAW//3u9PLxusXchcCR2WsNzv/ImvgZzzkUByDUAIrjTvmSHAowpJBQE4SUlxMxnARlQbIqkArVAJ6pBBvELCCKlkyCDAP45BYfEPfcUpfMch3Vn4bheYK4E66BxAxHSVd5INgEPgU/NBCDfNQ8Ho1CoINAPQAW/QT8OCIZlNFCB84XhoDChFByHGjx35v9BLgyhmojqHYb5QYXnuAecvua0hZe6BV9f7v4ibvgvamrmAc1TmaEir0LQ9h97eYAYVoM/nWA60i8Q3Ifezha9BqaaL3zvqd6IAuwwLSCCuCLuJWch4h30giPtyiAphKEBcCu9BV5wwzkMxID8rhMwdwMhcSFgrBT3RUTQboAUg3+p+Qe1IGarOioVnazmefV3lHpwA0AcLWCahUiXwePHWJsP+GH1gnp/we5KfOhJAbsj0H/BIEb04TbrTPsAyb2LLu93KwfCvn5PLAwrOXAa72eEQRo1CNdw5IprsAZ3hApy9zlcITG2vpCihsRSYxNS+J4vdBZ6B52eqRcQ/QXmSjAWSfa/5GA5qEg4iJFtm624AqXLrSA2gx8p1Mdqcghv41S0lSp/xAYs9gakQc4Ie2RTUYwYgt748mV+FU1Xgp14eW3XYZ6cdqGTNHwHICTwEeTPl0jEZwIgP9gDEaogeg5IHWCF+1eoAhvEKPB/EAeTRsM/pSAP5wjWEUMM1/NJRhwJbpJSgK7S7zF3EOsI5jBQBK9DV80Z8Y0COzvmWzJXgDl40KEC6cqvqgi4OB5cpgLFYK/1CvDiItXqC6/S87wfAUfPtxqfGNzlYaOjlf1IsHPPvffHgDAoEeEST4ZLZUd/RSo91/BjXY5ggWgQ4In3fyj4mUqPrInHOCLKO3wUwRsfyXpt1nEIRLrqcWeTuk7bigsbid1zD4iDRQtnIdQsyIXnFCn1I9D7ADgxEhOvR5AJosoUbu1FkJyYCi9OhQERoIx+4AX/YqUXQhtYEwKN4Cy1HntLMmtaAQpqfrT/UCoLSxeswjA5UWPPi0mjajUWxMTdVusNvt/ChMdmILK5IRMFu90BMEzFYHdg2GAgeYVHMMJIBTA7EFTx/5fpgTFXz9w/en0ZjD8kCDoKPNGwlB01BmoWQbh+AxR689mBponGJOr9OwmMu3dtJ/ylW1Tik4ElUPmR9RqII+pVhD9ychABMQ51gOIZg+/G+5mGIzLB1JJC5WhzYjhJ7IWmLDpA8jzsAafUPkB2WnFBF4iSxkq1ty7f25rv/+EQLOxs2oUdTSA9HIR9swdBlCcFe9owPC3XWDDC0ISVzsEVbSCF/sWdA5Fu4HJqankp2SeQCYYrImNalfmhpVxYrGkUS4LeSUjg8dD7+D7w/ybIfy7vlB9/HJ978zr7/45Qgajzj+4EjIK/ULHPRAOlKr/aG0AFcqCyu0GcW45Igh6JMJmhA49/U+cEssHNJhtXDC1MOya3j/sAiAGcrEtqtgjBD6wEzSDc7D8o6C8rIqAZyPk+NQoNLAZ1hR64Yl1FBY648smUYKnSg1Xwk/0DyRyArByMUobyByhCcPnOaPyoegREFS4jNfYAw+IHCjdC1J2WDZBke/OyN85J24WiXwDYPoJyYuCD238ulvuzwt6KgHf0shWKsqCFFGjB/w8HU8eeTED9wAAAAABJRU5ErkJggg==","EnvironmentBRDFTexture"+m++,N,!0,!1,X.c.BILINEAR_SAMPLINGMODE);N._blockEntityCollection=d;const w=N.getEngine().getLoadedTexturesCache(),S=w.indexOf(z.getInternalTexture());-1!==S&&w.splice(S,1),z.isRGBD=!0,z.wrapU=X.c.CLAMP_ADDRESSMODE,z.wrapV=X.c.CLAMP_ADDRESSMODE,N.environmentBRDFTexture=z,N.useDelayedTextureLoading=Z,I.b.ExpandRGBDTexture(z);const e=N.getEngine().onContextRestoredObservable.add((()=>{z.isRGBD=!0;const Z=N.onBeforeRenderObservable.add((()=>{z.isReady()&&(N.onBeforeRenderObservable.remove(Z),I.b.ExpandRGBDTexture(z))}))}));N.pd.add((()=>{N.getEngine().onContextRestoredObservable.remove(e)}))}return N.environmentBRDFTexture}},11329:(N,Z,d)=>{"use strict";function X(N,Z,d){try{const X=N.next();X.done?Z(X):X.value?X.value.then((()=>{X.value=void 0,Z(X)}),d):Z(X)}catch(X){d(X)}}function I(){let N,Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:25;return(d,I,m)=>{const z=performance.now();void 0===N||z-N>Z?(N=z,setTimeout((()=>{X(d,I,m)}),0)):X(d,I,m)}}function m(N,Z,d,X,I){const m=()=>{let z;const w=N=>{N.done?d(N.value):void 0===z?z=!0:m()};do{z=void 0,I&&I.aborted?X(new Error("Aborted")):Z(N,w,X),void 0===z&&(z=!1)}while(z)};m()}function z(N,Z){let d;return m(N,X,(N=>d=N),(N=>{throw N}),Z),d}function w(N,Z,d){return new Promise(((X,I)=>{m(N,Z,X,I,d)}))}function S(N,Z){return function(){return z(N(...arguments),Z)}}d.d(Z,{d:()=>I,g:()=>S,k:()=>w,m:()=>z})},10279:(N,Z,d)=>{"use strict";d.d(Z,{c:()=>I});class X{constructor(N){this._pendingActions=new Array,this._workerInfos=N.map((N=>({workerPromise:Promise.resolve(N),idle:!0})))}dispose(){for(const N of this._workerInfos)N.workerPromise.then((N=>{N.terminate()}));this._workerInfos.length=0,this._pendingActions.length=0}push(N){this._executeOnIdleWorker(N)||this._pendingActions.push(N)}_executeOnIdleWorker(N){for(const Z of this._workerInfos)if(Z.idle)return this._execute(Z,N),!0;return!1}_execute(N,Z){N.idle=!1,N.workerPromise.then((d=>{Z(d,(()=>{const Z=this._pendingActions.shift();Z?this._execute(N,Z):N.idle=!0}))}))}}class I extends X{constructor(N,Z){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:I.DefaultOptions;super([]),this._maxWorkers=N,this._createWorkerAsync=Z,this._options=d}push(N){if(!this._executeOnIdleWorker(N))if(this._workerInfos.length<this._maxWorkers){const Z={workerPromise:this._createWorkerAsync(),idle:!1};this._workerInfos.push(Z),this._execute(Z,N)}else this._pendingActions.push(N)}_execute(N,Z){N.timeoutId&&(clearTimeout(N.timeoutId),delete N.timeoutId),super._execute(N,((d,X)=>{Z(d,(()=>{X(),N.idle&&(N.timeoutId=setTimeout((()=>{N.workerPromise.then((N=>{N.terminate()}));const Z=this._workerInfos.indexOf(N);-1!==Z&&this._workerInfos.splice(Z,1)}),this._options.idleTimeElapsedBeforeRelease))}))}))}}I.DefaultOptions={idleTimeElapsedBeforeRelease:1e3}},11470:(N,Z,d)=>{"use strict";d.d(Z,{e:()=>UN});var X=d(960),I=d(1293);class m extends I.b{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var z=d(1108),w=(d(1350),d(978));class S{get noiseTexture(){return this._noiseTexture}set noiseTexture(N){this._noiseTexture!==N&&(this._noiseTexture=N,this._reset())}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(N){this._isAnimationSheetEnabled!=N&&(this._isAnimationSheetEnabled=N,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(N){this._useLogarithmicDepth=N&&this.va().getEngine().getCaps().fragmentDepthSupported}va(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:X.n.Zero()}set direction1(N){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=N)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:X.n.Zero()}set direction2(N){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=N)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:X.n.Zero()}set minEmitBox(N){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=N)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:X.n.Zero()}set maxEmitBox(N){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=N)}get billboardMode(){return this._billboardMode}set billboardMode(N){this._billboardMode!==N&&(this._billboardMode=N,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(N){this._isBillboardBased!==N&&(this._isBillboardBased=N,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(N){this._attachImageProcessingConfiguration(N)}_attachImageProcessingConfiguration(N){N!==this._imageProcessingConfiguration&&(!N&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=N)}_reset(){}_removeGradientAndTexture(N,Z,d){if(!Z)return this;let X=0;for(const I of Z){if(I.gradient===N){Z.splice(X,1);break}X++}return d&&d.dispose(),this}constructor(N){this.animations=[],this.renderingGroupId=0,this.k=X.n.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this.targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new X.n(10,10,10),this.onAnimationEnd=null,this.blendMode=S.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new X.l(0,0),this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.og=new X.n(0,0,0),this._useLogarithmicDepth=!1,this.gravity=X.n.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new z.e(1,1,1,1),this.color2=new z.e(1,1,1,1),this.colorDead=new z.e(0,0,0,1),this.textureMask=new z.e(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new m,this.id=N,this.name=N}createPointEmitter(N,Z){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new X.n(0,1,0),arguments.length>2&&void 0!==arguments[2]||new X.n(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new X.n(0,1,0),arguments.length>4&&void 0!==arguments[4]||new X.n(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new X.n(0,1,0),arguments.length>3&&void 0!==arguments[3]||new X.n(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(N,Z,d,X){throw new Error("Method not implemented.")}}S.BLENDMODE_ONEONE=0,S.BLENDMODE_STANDARD=1,S.BLENDMODE_ADD=2,S.BLENDMODE_MULTIPLY=3,S.BLENDMODE_MULTIPLYADD=4,(0,w.h)("BABYLON.BaseParticleSystem",S);var e=d(994),j=d(1135);class B{constructor(){this.direction1=new X.n(0,1,0),this.direction2=new X.n(0,1,0),this.minEmitBox=new X.n(-.5,-.5,-.5),this.maxEmitBox=new X.n(.5,.5,.5)}startDirectionFunction(N,Z,d,I){const m=(0,e.s)(this.direction1.x,this.direction2.x),z=(0,e.s)(this.direction1.y,this.direction2.y),w=(0,e.s)(this.direction1.z,this.direction2.z);if(I)return Z.x=m,Z.y=z,void(Z.z=w);X.n.TransformNormalFromFloatsToRef(m,z,w,N,Z)}startPositionFunction(N,Z,d,I){const m=(0,e.s)(this.minEmitBox.x,this.maxEmitBox.x),z=(0,e.s)(this.minEmitBox.y,this.maxEmitBox.y),w=(0,e.s)(this.minEmitBox.z,this.maxEmitBox.z);if(I)return Z.x=m,Z.y=z,void(Z.z=w);X.n.TransformCoordinatesFromFloatsToRef(m,z,w,N,Z)}clone(){const N=new B;return j.b.DeepCopy(this,N),N}applyToShader(N){N.setVector3("direction1",this.direction1),N.setVector3("direction2",this.direction2),N.setVector3("minEmitBox",this.minEmitBox),N.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(N){N.addUniform("direction1",3),N.addUniform("direction2",3),N.addUniform("minEmitBox",3),N.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const N={};return N.type=this.getClassName(),N.direction1=this.direction1.ed(),N.direction2=this.direction2.ed(),N.minEmitBox=this.minEmitBox.ed(),N.maxEmitBox=this.maxEmitBox.ed(),N}parse(N){X.n.FromArrayToRef(N.direction1,0,this.direction1),X.n.FromArrayToRef(N.direction2,0,this.direction2),X.n.FromArrayToRef(N.minEmitBox,0,this.minEmitBox),X.n.FromArrayToRef(N.maxEmitBox,0,this.maxEmitBox)}}class D{get i(){return this._radius}set i(N){this._radius=N,this._buildHeight()}get angle(){return this._angle}set angle(N){this._angle=N,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=d,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=Z,this.i=N}startDirectionFunction(N,Z,d,I){I?X.h.kd[0].p(d.sg).normalize():d.position.subtractToRef(N.getTranslation(),X.h.kd[0]).normalize();const m=(0,e.s)(0,this.directionRandomizer),z=(0,e.s)(0,this.directionRandomizer),w=(0,e.s)(0,this.directionRandomizer);Z.x=X.h.kd[0].x+m,Z.y=X.h.kd[0].y+z,Z.z=X.h.kd[0].z+w,Z.normalize()}startPositionFunction(N,Z,d,I){const m=(0,e.s)(0,2*Math.PI);let z;this.emitFromSpawnPointOnly?z=1e-4:(z=(0,e.s)(0,this.heightRange),z=1-z*z);let w=this._radius-(0,e.s)(0,this._radius*this.radiusRange);w*=z;const S=w*Math.sin(m),j=w*Math.cos(m),B=z*this._height;if(I)return Z.x=S,Z.y=B,void(Z.z=j);X.n.TransformCoordinatesFromFloatsToRef(S,B,j,N,Z)}clone(){const N=new D(this._radius,this._angle,this.directionRandomizer);return j.b.DeepCopy(this,N),N}applyToShader(N){N.setFloat2("i",this._radius,this.radiusRange),N.setFloat("coneAngle",this._angle),N.setFloat2("height",this._height,this.heightRange),N.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(N){N.addUniform("i",2),N.addUniform("coneAngle",1),N.addUniform("height",2),N.addUniform("directionRandomizer",1)}getEffectDefines(){let N="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(N+="\n#define CONEEMITTERSPAWNPOINT"),N}getClassName(){return"ConeParticleEmitter"}serialize(){const N={};return N.type=this.getClassName(),N.i=this._radius,N.angle=this._angle,N.directionRandomizer=this.directionRandomizer,N.radiusRange=this.radiusRange,N.heightRange=this.heightRange,N.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,N}parse(N){this.i=N.i,this.angle=N.angle,this.directionRandomizer=N.directionRandomizer,this.radiusRange=void 0!==N.radiusRange?N.radiusRange:1,this.heightRange=void 0!==N.radiusRange?N.heightRange:1,this.emitFromSpawnPointOnly=void 0!==N.emitFromSpawnPointOnly&&N.emitFromSpawnPointOnly}}class v extends D{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new X.n(0,1,0),I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new X.n(0,1,0);super(N,Z),this.direction1=d,this.direction2=I}startDirectionFunction(N,Z){const d=(0,e.s)(this.direction1.x,this.direction2.x),I=(0,e.s)(this.direction1.y,this.direction2.y),m=(0,e.s)(this.direction1.z,this.direction2.z);X.n.TransformNormalFromFloatsToRef(d,I,m,N,Z)}clone(){const N=new v(this.i,this.angle,this.direction1,this.direction2);return j.b.DeepCopy(this,N),N}applyToShader(N){N.setFloat("i",this.i),N.setFloat("radiusRange",this.radiusRange),N.setVector3("direction1",this.direction1),N.setVector3("direction2",this.direction2)}buildUniformLayout(N){N.addUniform("i",1),N.addUniform("radiusRange",1),N.addUniform("direction1",3),N.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const N=super.serialize();return N.direction1=this.direction1.ed(),N.direction2=this.direction2.ed(),N}parse(N){super.parse(N),this.direction1.p(N.direction1),this.direction2.p(N.direction2)}}class T{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.i=N,this.height=Z,this.radiusRange=d,this.directionRandomizer=I,this._tempVector=X.n.Zero()}startDirectionFunction(N,Z,d,I,m){d.position.subtractToRef(N.getTranslation(),this._tempVector),this._tempVector.normalize(),X.n.TransformNormalToRef(this._tempVector,m,this._tempVector);const z=(0,e.s)(-this.directionRandomizer/2,this.directionRandomizer/2);let w=Math.atan2(this._tempVector.x,this._tempVector.z);w+=(0,e.s)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=z,this._tempVector.x=Math.sin(w),this._tempVector.z=Math.cos(w),this._tempVector.normalize(),I?Z.p(this._tempVector):X.n.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,N,Z)}startPositionFunction(N,Z,d,I){const m=(0,e.s)(-this.height/2,this.height/2),z=(0,e.s)(0,2*Math.PI),w=(0,e.s)((1-this.radiusRange)*(1-this.radiusRange),1),S=Math.sqrt(w)*this.i,j=S*Math.cos(z),B=S*Math.sin(z);I?Z.fd(j,m,B):X.n.TransformCoordinatesFromFloatsToRef(j,m,B,N,Z)}clone(){const N=new T(this.i,this.directionRandomizer);return j.b.DeepCopy(this,N),N}applyToShader(N){N.setFloat("i",this.i),N.setFloat("height",this.height),N.setFloat("radiusRange",this.radiusRange),N.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(N){N.addUniform("i",1),N.addUniform("height",1),N.addUniform("radiusRange",1),N.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const N={};return N.type=this.getClassName(),N.i=this.i,N.height=this.height,N.radiusRange=this.radiusRange,N.directionRandomizer=this.directionRandomizer,N}parse(N){this.i=N.i,this.height=N.height,this.radiusRange=N.radiusRange,this.directionRandomizer=N.directionRandomizer}}class k extends T{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new X.n(0,1,0),m=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new X.n(0,1,0);super(N,Z,d),this.direction1=I,this.direction2=m}startDirectionFunction(N,Z,d,I){const m=(0,e.s)(this.direction1.x,this.direction2.x),z=(0,e.s)(this.direction1.y,this.direction2.y),w=(0,e.s)(this.direction1.z,this.direction2.z);I?Z.fd(m,z,w):X.n.TransformNormalFromFloatsToRef(m,z,w,N,Z)}clone(){const N=new k(this.i,this.height,this.radiusRange,this.direction1,this.direction2);return j.b.DeepCopy(this,N),N}applyToShader(N){N.setFloat("i",this.i),N.setFloat("height",this.height),N.setFloat("radiusRange",this.radiusRange),N.setVector3("direction1",this.direction1),N.setVector3("direction2",this.direction2)}buildUniformLayout(N){N.addUniform("i",1),N.addUniform("height",1),N.addUniform("radiusRange",1),N.addUniform("direction1",3),N.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const N=super.serialize();return N.direction1=this.direction1.ed(),N.direction2=this.direction2.ed(),N}parse(N){super.parse(N),X.n.FromArrayToRef(N.direction1,0,this.direction1),X.n.FromArrayToRef(N.direction2,0,this.direction2)}}class h{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.i=N,this.radiusRange=Z,this.directionRandomizer=d}startDirectionFunction(N,Z,d,I){const m=d.position.rc(N.getTranslation()).normalize(),z=(0,e.s)(0,this.directionRandomizer),w=(0,e.s)(0,this.directionRandomizer),S=(0,e.s)(0,this.directionRandomizer);m.x+=z,m.y+=w,m.z+=S,m.normalize(),I?Z.p(m):X.n.TransformNormalFromFloatsToRef(m.x,m.y,m.z,N,Z)}startPositionFunction(N,Z,d,I){const m=this.i-(0,e.s)(0,this.i*this.radiusRange),z=(0,e.s)(0,1),w=(0,e.s)(0,2*Math.PI),S=Math.acos(2*z-1),j=m*Math.cos(w)*Math.sin(S),B=m*Math.cos(S),D=m*Math.sin(w)*Math.sin(S);I?Z.fd(j,Math.abs(B),D):X.n.TransformCoordinatesFromFloatsToRef(j,Math.abs(B),D,N,Z)}clone(){const N=new h(this.i,this.directionRandomizer);return j.b.DeepCopy(this,N),N}applyToShader(N){N.setFloat("i",this.i),N.setFloat("radiusRange",this.radiusRange),N.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(N){N.addUniform("i",1),N.addUniform("radiusRange",1),N.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const N={};return N.type=this.getClassName(),N.i=this.i,N.radiusRange=this.radiusRange,N.directionRandomizer=this.directionRandomizer,N}parse(N){this.i=N.i,this.radiusRange=N.radiusRange,this.directionRandomizer=N.directionRandomizer}}class U{constructor(){this.direction1=new X.n(0,1,0),this.direction2=new X.n(0,1,0)}startDirectionFunction(N,Z,d,I){const m=(0,e.s)(this.direction1.x,this.direction2.x),z=(0,e.s)(this.direction1.y,this.direction2.y),w=(0,e.s)(this.direction1.z,this.direction2.z);I?Z.fd(m,z,w):X.n.TransformNormalFromFloatsToRef(m,z,w,N,Z)}startPositionFunction(N,Z,d,I){I?Z.fd(0,0,0):X.n.TransformCoordinatesFromFloatsToRef(0,0,0,N,Z)}clone(){const N=new U;return j.b.DeepCopy(this,N),N}applyToShader(N){N.setVector3("direction1",this.direction1),N.setVector3("direction2",this.direction2)}buildUniformLayout(N){N.addUniform("direction1",3),N.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const N={};return N.type=this.getClassName(),N.direction1=this.direction1.ed(),N.direction2=this.direction2.ed(),N}parse(N){X.n.FromArrayToRef(N.direction1,0,this.direction1),X.n.FromArrayToRef(N.direction2,0,this.direction2)}}class C{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.i=N,this.radiusRange=Z,this.directionRandomizer=d}startDirectionFunction(N,Z,d,I){const m=d.position.rc(N.getTranslation()).normalize(),z=(0,e.s)(0,this.directionRandomizer),w=(0,e.s)(0,this.directionRandomizer),S=(0,e.s)(0,this.directionRandomizer);m.x+=z,m.y+=w,m.z+=S,m.normalize(),I?Z.p(m):X.n.TransformNormalFromFloatsToRef(m.x,m.y,m.z,N,Z)}startPositionFunction(N,Z,d,I){const m=this.i-(0,e.s)(0,this.i*this.radiusRange),z=(0,e.s)(0,1),w=(0,e.s)(0,2*Math.PI),S=Math.acos(2*z-1),j=m*Math.cos(w)*Math.sin(S),B=m*Math.cos(S),D=m*Math.sin(w)*Math.sin(S);I?Z.fd(j,B,D):X.n.TransformCoordinatesFromFloatsToRef(j,B,D,N,Z)}clone(){const N=new C(this.i,this.directionRandomizer);return j.b.DeepCopy(this,N),N}applyToShader(N){N.setFloat("i",this.i),N.setFloat("radiusRange",this.radiusRange),N.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(N){N.addUniform("i",1),N.addUniform("radiusRange",1),N.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const N={};return N.type=this.getClassName(),N.i=this.i,N.radiusRange=this.radiusRange,N.directionRandomizer=this.directionRandomizer,N}parse(N){this.i=N.i,this.radiusRange=N.radiusRange,this.directionRandomizer=N.directionRandomizer}}class M extends C{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new X.n(0,1,0),d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new X.n(0,1,0);super(N),this.direction1=Z,this.direction2=d}startDirectionFunction(N,Z){const d=(0,e.s)(this.direction1.x,this.direction2.x),I=(0,e.s)(this.direction1.y,this.direction2.y),m=(0,e.s)(this.direction1.z,this.direction2.z);X.n.TransformNormalFromFloatsToRef(d,I,m,N,Z)}clone(){const N=new M(this.i,this.direction1,this.direction2);return j.b.DeepCopy(this,N),N}applyToShader(N){N.setFloat("i",this.i),N.setFloat("radiusRange",this.radiusRange),N.setVector3("direction1",this.direction1),N.setVector3("direction2",this.direction2)}buildUniformLayout(N){N.addUniform("i",1),N.addUniform("radiusRange",1),N.addUniform("direction1",3),N.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const N=super.serialize();return N.direction1=this.direction1.ed(),N.direction2=this.direction2.ed(),N}parse(N){super.parse(N),this.direction1.p(N.direction1),this.direction2.p(N.direction2)}}class Q{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{}}startDirectionFunction(N,Z,d,I){const m=X.h.kd[0];if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,d,m);const N=X.h.kd[1];m.subtractToRef(d.position,N),N.scaleToRef(1/d.lifeTime,m)}else m.set(0,0,0);I?Z.p(m):X.n.TransformNormalToRef(m,N,Z)}startPositionFunction(N,Z,d,I){const m=X.h.kd[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,d,m):m.set(0,0,0),I?Z.p(m):X.n.TransformCoordinatesToRef(m,N,Z)}clone(){const N=new Q;return j.b.DeepCopy(this,N),N}applyToShader(N){}buildUniformLayout(N){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const N={};return N.type=this.getClassName(),N.particlePositionGenerator=this.particlePositionGenerator,N.particleDestinationGenerator=this.particleDestinationGenerator,N}parse(N){N.particlePositionGenerator&&(this.particlePositionGenerator=N.particlePositionGenerator),N.particleDestinationGenerator&&(this.particleDestinationGenerator=N.particleDestinationGenerator)}}var A=d(1169);class n{get mesh(){return this.qe}set mesh(N){this.qe!==N&&(this.qe=N,N?(this._indices=N.ge(),this._positions=N.getVerticesData(A.d.PositionKind),this._normals=N.getVerticesData(A.d.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=X.n.Zero(),this.qe=null,this.direction1=new X.n(0,1,0),this.direction2=new X.n(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=N}startDirectionFunction(N,Z,d,I){if(this.useMeshNormalsForDirection&&this._normals)return void X.n.TransformNormalToRef(this._storedNormal,N,Z);const m=(0,e.s)(this.direction1.x,this.direction2.x),z=(0,e.s)(this.direction1.y,this.direction2.y),w=(0,e.s)(this.direction1.z,this.direction2.z);I?Z.fd(m,z,w):X.n.TransformNormalFromFloatsToRef(m,z,w,N,Z)}startPositionFunction(N,Z,d,I){if(!this._indices||!this._positions)return;const m=3*Math.random()*(this._indices.length/3)|0,z=Math.random(),w=Math.random()*(1-z),S=1-z-w,e=this._indices[m],j=this._indices[m+1],B=this._indices[m+2],D=X.h.kd[0],v=X.h.kd[1],T=X.h.kd[2],k=X.h.kd[3];X.n.FromArrayToRef(this._positions,3*e,D),X.n.FromArrayToRef(this._positions,3*j,v),X.n.FromArrayToRef(this._positions,3*B,T),k.x=z*D.x+w*v.x+S*T.x,k.y=z*D.y+w*v.y+S*T.y,k.z=z*D.z+w*v.z+S*T.z,I?Z.fd(k.x,k.y,k.z):X.n.TransformCoordinatesFromFloatsToRef(k.x,k.y,k.z,N,Z),this.useMeshNormalsForDirection&&this._normals&&(X.n.FromArrayToRef(this._normals,3*e,D),X.n.FromArrayToRef(this._normals,3*j,v),X.n.FromArrayToRef(this._normals,3*B,T),this._storedNormal.x=z*D.x+w*v.x+S*T.x,this._storedNormal.y=z*D.y+w*v.y+S*T.y,this._storedNormal.z=z*D.z+w*v.z+S*T.z)}clone(){const N=new n(this.mesh);return j.b.DeepCopy(this,N),N}applyToShader(N){N.setVector3("direction1",this.direction1),N.setVector3("direction2",this.direction2)}buildUniformLayout(N){N.addUniform("direction1",3),N.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var N;const Z={};return Z.type=this.getClassName(),Z.direction1=this.direction1.ed(),Z.direction2=this.direction2.ed(),Z.meshId=null===(N=this.mesh)||void 0===N?void 0:N.id,Z.useMeshNormalsForDirection=this.useMeshNormalsForDirection,Z}parse(N,Z){X.n.FromArrayToRef(N.direction1,0,this.direction1),X.n.FromArrayToRef(N.direction2,0,this.direction2),N.meshId&&Z&&(this.mesh=Z.getLastMeshById(N.meshId)),this.useMeshNormalsForDirection=N.useMeshNormalsForDirection}}var g=d(1065);class E{_isUbo(N){return void 0!==N.addUniform}constructor(N){this._isUbo(N)?(this.setMatrix3x3=N.updateMatrix3x3.bind(N),this.setMatrix2x2=N.updateMatrix2x2.bind(N),this.setFloat=N.updateFloat.bind(N),this.setFloat2=N.updateFloat2.bind(N),this.setFloat3=N.updateFloat3.bind(N),this.setFloat4=N.updateFloat4.bind(N),this.setFloatArray=N.updateFloatArray.bind(N),this.setArray=N.updateArray.bind(N),this.setIntArray=N.updateIntArray.bind(N),this.setMatrix=N.Cd.bind(N),this.setMatrices=N.updateMatrices.bind(N),this.setVector3=N.updateVector3.bind(N),this.setVector4=N.updateVector4.bind(N),this.setColor3=N.updateColor3.bind(N),this.setColor4=N.updateColor4.bind(N),this.setDirectColor4=N.updateDirectColor4.bind(N),this.setInt=N.updateInt.bind(N),this.setInt2=N.updateInt2.bind(N),this.setInt3=N.updateInt3.bind(N),this.setInt4=N.updateInt4.bind(N)):(this.setMatrix3x3=N.setMatrix3x3.bind(N),this.setMatrix2x2=N.setMatrix2x2.bind(N),this.setFloat=N.setFloat.bind(N),this.setFloat2=N.setFloat2.bind(N),this.setFloat3=N.setFloat3.bind(N),this.setFloat4=N.setFloat4.bind(N),this.setFloatArray=N.setFloatArray.bind(N),this.setArray=N.setArray.bind(N),this.setIntArray=N.setIntArray.bind(N),this.setMatrix=N.setMatrix.bind(N),this.setMatrices=N.setMatrices.bind(N),this.setVector3=N.setVector3.bind(N),this.setVector4=N.setVector4.bind(N),this.setColor3=N.setColor3.bind(N),this.setColor4=N.setColor4.bind(N),this.setDirectColor4=N.setDirectColor4.bind(N),this.setInt=N.setInt.bind(N),this.setInt2=N.setInt2.bind(N),this.setInt3=N.setInt3.bind(N),this.setInt4=N.setInt4.bind(N))}}var V=d(1069);const O="gpuUpdateParticlesPixelShader",K="#version 300 es\nvoid main() {discard;}\n";V.c.ShadersStore[O]=K;const r="gpuUpdateParticlesVertexShader",P="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";V.c.ShadersStore[r]=P;(0,w.h)("BABYLON.WebGL2ParticleSystem",class{constructor(N,Z){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=N,this._engine=Z,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","i","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var N;return(null===(N=this._updateEffect)||void 0===N?void 0:N.isReady())??!1}createUpdateBuffer(N){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof Q&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=N,this._updateEffect=new g.d("gpuUpdateParticles",this._updateEffectOptions,this._engine),new E(this._updateEffect)}createVertexBuffers(N,Z){this._updateVAO.push(this._createUpdateVAO(N)),this._renderVAO.push(this._engine.recordVertexArrayObject(Z,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=Z}createParticleBuffer(N){return N}bindDrawBuffers(N,Z,d){d?this._engine.bindBuffers(this._renderVertexBuffers,d,Z):this._engine.bindVertexArrayObject(this._renderVAO[N],null)}preUpdateParticleBuffer(){const N=this._engine;if(this._engine.enableEffect(this._updateEffect),!N.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(N,Z,d){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[N],null);const X=this._engine;X.bindTransformFeedbackBuffer(Z.getBuffer()),X.setRasterizerState(!1),X.beginTransformFeedback(!0),X.drawArraysType(3,0,d),X.endTransformFeedback(),X.setRasterizerState(!0),X.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let N=0;N<this._updateVAO.length;N++)this._engine.releaseVertexArrayObject(this._updateVAO[N]);this._updateVAO.length=0;for(let N=0;N<this._renderVAO.length;N++)this._engine.releaseVertexArrayObject(this._renderVAO[N]);this._renderVAO.length=0}_createUpdateVAO(N){const Z={};Z.position=N.createVertexBuffer("position",0,3);let d=3;Z.age=N.createVertexBuffer("age",d,1),d+=1,Z.size=N.createVertexBuffer("size",d,3),d+=3,Z.life=N.createVertexBuffer("life",d,1),d+=1,Z.seed=N.createVertexBuffer("seed",d,4),d+=4,Z.direction=N.createVertexBuffer("direction",d,3),d+=3,this._parent.particleEmitterType instanceof Q&&(Z.initialPosition=N.createVertexBuffer("initialPosition",d,3),d+=3),this._parent._colorGradientsTexture||(Z.color=N.createVertexBuffer("color",d,4),d+=4),this._parent._isBillboardBased||(Z.initialDirection=N.createVertexBuffer("initialDirection",d,3),d+=3),this._parent.noiseTexture&&(Z.noiseCoordinates1=N.createVertexBuffer("noiseCoordinates1",d,3),d+=3,Z.noiseCoordinates2=N.createVertexBuffer("noiseCoordinates2",d,3),d+=3),this._parent._angularSpeedGradientsTexture?(Z.angle=N.createVertexBuffer("angle",d,1),d+=1):(Z.angle=N.createVertexBuffer("angle",d,2),d+=2),this._parent._isAnimationSheetEnabled&&(Z.cellIndex=N.createVertexBuffer("cellIndex",d,1),d+=1,this._parent.spriteRandomStartCell&&(Z.cellStartOffset=N.createVertexBuffer("cellStartOffset",d,1),d+=1));const X=this._engine.recordVertexArrayObject(Z,null,this._updateEffect);return this._engine.bindArrayBuffer(null),X}});class W{constructor(N,Z){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,X=arguments.length>3?arguments[3]:void 0;this._engine=N,this._label=X,this._engine._storageBuffers.push(this),this._create(Z,d)}_create(N,Z){this._bufferSize=N,this._creationFlags=Z,this._buffer=this._engine.createStorageBuffer(N,Z,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(N,Z,d){this._buffer&&this._engine.updateStorageBuffer(this._buffer,N,Z,d)}read(N,Z,d,X){return this._engine.readFromStorageBuffer(this._buffer,N,Z,d,X)}dispose(){const N=this._engine._storageBuffers,Z=N.indexOf(this);-1!==Z&&(N[Z]=N[N.length-1],N.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var b=d(942),J=d(949),F=d(1094),G=d(938),x=d(1230),t=d(1051),q=d(1082),Y=d(1222);class s{constructor(){this._gpuTimeInFrameId=-1,this.counter=new Y.b}_addDuration(N,Z){N<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==N?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(Z,!1),this._gpuTimeInFrameId=N):this.counter.addCount(Z,!1))}}class L{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(N,Z,d){let X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=N,this._engine=Z,this.uniqueId=x.d.UniqueId,Z.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new s),this._engine.getCaps().supportComputeShaders?X.bindingsMapping?(this._context=Z.createComputeContext(),this._shaderPath=d,this._options={bindingsMapping:{},defines:[],...X}):t.e.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):t.e.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(N,Z){let d=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const X=this._bindings[N];this._bindings[N]={type:d?0:4,object:Z,indexInGroupEntries:null===X||void 0===X?void 0:X.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!X||X.object!==Z||X.type!==this._bindings[N].type)}setStorageTexture(N,Z){const d=this._bindings[N];this._contextIsDirty||(this._contextIsDirty=!d||d.object!==Z),this._bindings[N]={type:1,object:Z,indexInGroupEntries:null===d||void 0===d?void 0:d.indexInGroupEntries}}setExternalTexture(N,Z){const d=this._bindings[N];this._contextIsDirty||(this._contextIsDirty=!d||d.object!==Z),this._bindings[N]={type:6,object:Z,indexInGroupEntries:null===d||void 0===d?void 0:d.indexInGroupEntries}}setVideoTexture(N,Z){return!!Z.externalTexture&&(this.setExternalTexture(N,Z.externalTexture),!0)}setUniformBuffer(N,Z){const d=this._bindings[N];this._contextIsDirty||(this._contextIsDirty=!d||d.object!==Z),this._bindings[N]={type:L._BufferIsDataBuffer(Z)?7:2,object:Z,indexInGroupEntries:null===d||void 0===d?void 0:d.indexInGroupEntries}}setStorageBuffer(N,Z){const d=this._bindings[N];this._contextIsDirty||(this._contextIsDirty=!d||d.object!==Z),this._bindings[N]={type:L._BufferIsDataBuffer(Z)?7:3,object:Z,indexInGroupEntries:null===d||void 0===d?void 0:d.indexInGroupEntries}}setTextureSampler(N,Z){const d=this._bindings[N];this._contextIsDirty||(this._contextIsDirty=!d||!Z.compareSampler(d.object)),this._bindings[N]={type:5,object:Z,indexInGroupEntries:null===d||void 0===d?void 0:d.indexInGroupEntries}}isReady(){let N=this._effect;for(const I in this._bindings){const N=this._bindings[I],Z=N.type,d=N.object;switch(Z){case 0:case 4:case 1:if(!d.isReady())return!1;break;case 6:if(!d.isReady())return!1;break}}const Z=[],d=this._shaderPath;if(this._options.defines)for(let I=0;I<this._options.defines.length;I++)Z.push(this._options.defines[I]);const X=Z.join("\n");return this._cachedDefines!==X&&(this._cachedDefines=X,N=this._engine.createComputeEffect(d,{defines:X,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=N),!!N.isReady()}dispatch(N,Z,d){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,N,Z,d,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const d=L._BufferIsDataBuffer(N)?N:N.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,d,Z,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const Z in this._bindings){const d=this._bindings[Z];if(!this._options.bindingsMapping[Z])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+Z+"'");switch(d.type){case 0:{const X=this._samplers[Z],I=d.object;var N;if(!X||!I._texture||!X.compareSampler(I._texture))this._samplers[Z]=(new q.e).setParameters(I.wrapU,I.wrapV,I.wrapR,I.anisotropicFilteringLevel,I._texture.samplingMode,null===(N=I._texture)||void 0===N?void 0:N._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const N=d.object;N.getBuffer()!==d.buffer&&(d.buffer=N.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}dispatchWhenReady(N,Z,d){let X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return new Promise((I=>{const m=()=>{this.dispatch(N,Z,d)?I():setTimeout(m,X)};m()}))}serialize(){const N=F.c.Serialize(this);N.options=this._options,N.shaderPath=this._shaderPath,N.Bj={},N.textures={};for(const Z in this._bindings){const d=this._bindings[Z],X=d.object;switch(d.type){case 0:case 4:case 1:{const I=X.serialize();I&&(N.textures[Z]=I,N.Bj[Z]={type:d.type});break}}}return N}static Parse(N,Z,d){const X=F.c.Parse((()=>new L(N.name,Z.getEngine(),N.shaderPath,N.options)),N,Z,d);for(const I in N.textures){const m=N.Bj[I],z=G.c.Parse(N.textures[I],Z,d);0===m.type?X.setTexture(I,z):4===m.type?X.setTexture(I,z,!1):X.setStorageTexture(I,z)}return X}static _BufferIsDataBuffer(N){return void 0!==N.underlyingResource}}(0,b.d)([(0,J.I)()],L.prototype,"name",void 0),(0,b.d)([(0,J.I)()],L.prototype,"fastMode",void 0),(0,w.h)("BABYLON.ComputeShader",L);var H=d(1157);const i="gpuUpdateParticlesComputeShader",p="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";V.c.ShadersStoreWGSL[i]=p;(0,w.h)("BABYLON.ComputeShaderParticleSystem",class{constructor(N,Z){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=N,this._engine=Z}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var N;return(null===(N=this._updateComputeShader)||void 0===N?void 0:N.isReady())??!1}createUpdateBuffer(N){var Z;const d={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(d.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(d.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(d.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(d.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(d.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(d.noiseTexture={group:1,binding:11}),this._updateComputeShader=new L("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:d,defines:N.split("\n")}),null===(Z=this._simParamsComputeShader)||void 0===Z||Z.dispose(),this._simParamsComputeShader=new H.e(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new E(this._simParamsComputeShader)}createVertexBuffers(N,Z){this._renderVertexBuffers.push(Z)}createParticleBuffer(N){const Z=new W(this._engine,4*N.length,11,"ComputeShaderParticleSystemBuffer");return Z.update(N),this._bufferComputeShader.push(Z),Z.getBuffer()}bindDrawBuffers(N,Z,d){this._engine.bindBuffers(this._renderVertexBuffers[N],d,Z)}preUpdateParticleBuffer(){}updateParticleBuffer(N,Z,d){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[N]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^N]),this._updateComputeShader.dispatch(Math.ceil(d/64))}releaseBuffers(){var N;for(let Z=0;Z<this._bufferComputeShader.length;++Z)this._bufferComputeShader[Z].dispose();this._bufferComputeShader.length=0,null===(N=this._simParamsComputeShader)||void 0===N||N.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class y{constructor(N,Z,d){this.gradient=N,this.color1=Z,this.color2=d}getColorToRef(N){this.color2?z.e.LerpToRef(this.color1,this.color2,Math.random(),N):N.p(this.color1)}}class l{constructor(N,Z){this.gradient=N,this.color=Z}}class u{constructor(N,Z,d){this.gradient=N,this.factor1=Z,this.factor2=d}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class a{static GetCurrentGradient(N,Z,d){if(Z[0].gradient>N)return void d(Z[0],Z[0],1);for(let I=0;I<Z.length-1;I++){const X=Z[I],m=Z[I+1];if(N>=X.gradient&&N<=m.gradient){return void d(X,m,(N-X.gradient)/(m.gradient-X.gradient))}}const X=Z.length-1;d(Z[X],Z[X],1)}}var c=d(958),R=d(11474),f=d(986);class o{constructor(N){this.particleSystem=N,this.position=X.n.Zero(),this.direction=X.n.Zero(),this.color=new z.e(0,0,0,0),this.colorStep=new z.e(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new X.l(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new z.e(0,0,0,0),this._currentColor2=new z.e(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=o._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let N=this.age,Z=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===Z?(Z=1,N=this._randomCellOffset):N+=this._randomCellOffset);const d=this._initialEndSpriteCellID-this._initialStartSpriteCellID+1;let X;X=this._initialSpriteCellLoop?(0,e.e)(N*Z%this.lifeTime/this.lifeTime):(0,e.e)(N*Z/this.lifeTime),this.cellIndex=this._initialStartSpriteCellID+X*d|0}_inheritParticleInfoToSubEmitter(N){if(N.particleSystem.k.position){const Z=N.particleSystem.k;if(Z.position.p(this.position),N.inheritDirection){const N=X.h.kd[0];this.direction.normalizeToRef(N),Z.setDirection(N,0,Math.PI/2)}}else{N.particleSystem.k.p(this.position)}this.direction.scaleToRef(N.inheritedVelocityAmount/2,X.h.kd[0]),N.particleSystem._inheritedVelocityOffset.p(X.h.kd[0])}_inheritParticleInfoToSubEmitters(){this._attachedSubEmitters&&this._attachedSubEmitters.length>0&&this._attachedSubEmitters.forEach((N=>{this._inheritParticleInfoToSubEmitter(N)}))}_reset(){this.age=0,this.id=o._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(N){N.position.p(this.position),this._initialDirection?N._initialDirection?N._initialDirection.p(this._initialDirection):N._initialDirection=this._initialDirection.clone():N._initialDirection=null,N.direction.p(this.direction),this.sg&&(N.sg?N.sg.p(this.sg):N.sg=this.sg.clone()),N.color.p(this.color),N.colorStep.p(this.colorStep),N.lifeTime=this.lifeTime,N.age=this.age,N._randomCellOffset=this._randomCellOffset,N.size=this.size,N.scale.p(this.scale),N.angle=this.angle,N.angularSpeed=this.angularSpeed,N.particleSystem=this.particleSystem,N.cellIndex=this.cellIndex,N.id=this.id,N._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(N._currentColorGradient=this._currentColorGradient,N._currentColor1.p(this._currentColor1),N._currentColor2.p(this._currentColor2)),this._currentSizeGradient&&(N._currentSizeGradient=this._currentSizeGradient,N._currentSize1=this._currentSize1,N._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(N._currentAngularSpeedGradient=this._currentAngularSpeedGradient,N._currentAngularSpeed1=this._currentAngularSpeed1,N._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(N._currentVelocityGradient=this._currentVelocityGradient,N._currentVelocity1=this._currentVelocity1,N._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(N._currentLimitVelocityGradient=this._currentLimitVelocityGradient,N._currentLimitVelocity1=this._currentLimitVelocity1,N._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(N._currentDragGradient=this._currentDragGradient,N._currentDrag1=this._currentDrag1,N._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(N._initialStartSpriteCellID=this._initialStartSpriteCellID,N._initialEndSpriteCellID=this._initialEndSpriteCellID,N._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(N.remapData&&this.remapData?N.remapData.p(this.remapData):N.remapData=new X.q(0,0,0,0)),this._randomNoiseCoordinates1&&(N._randomNoiseCoordinates1?(N._randomNoiseCoordinates1.p(this._randomNoiseCoordinates1),N._randomNoiseCoordinates2.p(this._randomNoiseCoordinates2)):(N._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),N._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}o._Count=0;var NN=d(1283),ZN=(d(1345),d(1288)),dN=d(1285),XN=d(1155);class IN extends S{set onDispose(N){this._onDisposeObserver&&this.pd.remove(this._onDisposeObserver),this._onDisposeObserver=this.pd.add(N)}get useRampGradients(){return this._useRampGradients}set useRampGradients(N){this._useRampGradients!==N&&(this._useRampGradients=N,this._resetEffect())}get particles(){return this.wj}get shaderLanguage(){return this._shaderLanguage}getActiveCount(){return this.wj.length}getClassName(){return"je"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var N;let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(N=this._customWrappers[Z])||void 0===N?void 0:N.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[N]??this._customWrappers[0]}setCustomEffect(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[Z]=new NN.b(this._engine),this._customWrappers[Z].effect=N,this._customWrappers[Z].drawContext&&(this._customWrappers[Z].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new c.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}constructor(N,Z,d){let I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,m=arguments.length>4&&void 0!==arguments[4]&&arguments[4],w=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01;super(N),this._emitterInverseWorldMatrix=X.c.Identity(),this._inheritedVelocityOffset=new X.n,this.pd=new c.d,this.onStoppedObservable=new c.d,this.wj=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new z.e(0,0,0,0),this._colorDiff=new z.e(0,0,0,0),this._scaledDirection=X.n.Zero(),this._scaledGravity=X.n.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this.isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=N=>{},this.recycleParticle=N=>{const Z=this.wj.pop();Z!==N&&Z.copyTo(N),this._stockParticles.push(Z)},this._createParticle=()=>{let N;return 0!==this._stockParticles.length?(N=this._stockParticles.pop(),N._reset()):N=new o(this),this._prepareParticle(N),N},this._shadersLoaded=!1,this._capacity=Z,this._epsilon=w,this._isAnimationSheetEnabled=m,d&&"Scene"!==d.getClassName()?(this._engine=d,this.defaultProjectionMatrix=X.c.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=d||f.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Od.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._attachImageProcessingConfiguration(null),this._customWrappers={0:new NN.b(this._engine)},this._customWrappers[0].effect=I,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new B;let S=null;this.updateFunction=N=>{let Z=null;var d;this.noiseTexture&&(Z=this.noiseTexture.getSize(),null===(d=this.noiseTexture.getContent())||void 0===d||d.then((N=>{S=N})));const I=N===this.wj;for(let m=0;m<N.length;m++){const d=N[m];let w=this._scaledUpdateSpeed;const j=d.age;if(d.age+=w,d.age>d.lifeTime){const N=d.age-j;w=(d.lifeTime-j)*w/N,d.age=d.lifeTime}const B=d.age/d.lifeTime;this._colorGradients&&this._colorGradients.length>0?a.GetCurrentGradient(B,this._colorGradients,((N,Z,X)=>{N!==d._currentColorGradient&&(d._currentColor1.p(d._currentColor2),Z.getColorToRef(d._currentColor2),d._currentColorGradient=N),z.e.LerpToRef(d._currentColor1,d._currentColor2,X,d.color)})):(d.colorStep.scaleToRef(w,this._scaledColorStep),d.color.addInPlace(this._scaledColorStep),d.color.a<0&&(d.color.a=0)),this._angularSpeedGradients&&this._angularSpeedGradients.length>0&&a.GetCurrentGradient(B,this._angularSpeedGradients,((N,Z,X)=>{N!==d._currentAngularSpeedGradient&&(d._currentAngularSpeed1=d._currentAngularSpeed2,d._currentAngularSpeed2=Z.getFactor(),d._currentAngularSpeedGradient=N),d.angularSpeed=(0,e.o)(d._currentAngularSpeed1,d._currentAngularSpeed2,X)})),d.angle+=d.angularSpeed*w;let D=w;if(this._velocityGradients&&this._velocityGradients.length>0&&a.GetCurrentGradient(B,this._velocityGradients,((N,Z,X)=>{N!==d._currentVelocityGradient&&(d._currentVelocity1=d._currentVelocity2,d._currentVelocity2=Z.getFactor(),d._currentVelocityGradient=N),D*=(0,e.o)(d._currentVelocity1,d._currentVelocity2,X)})),d.direction.scaleToRef(D,this._scaledDirection),this._limitVelocityGradients&&this._limitVelocityGradients.length>0&&a.GetCurrentGradient(B,this._limitVelocityGradients,((N,Z,X)=>{N!==d._currentLimitVelocityGradient&&(d._currentLimitVelocity1=d._currentLimitVelocity2,d._currentLimitVelocity2=Z.getFactor(),d._currentLimitVelocityGradient=N);const I=(0,e.o)(d._currentLimitVelocity1,d._currentLimitVelocity2,X);d.direction.length()>I&&d.direction.scaleInPlace(this.limitVelocityDamping)})),this._dragGradients&&this._dragGradients.length>0&&a.GetCurrentGradient(B,this._dragGradients,((N,Z,X)=>{N!==d._currentDragGradient&&(d._currentDrag1=d._currentDrag2,d._currentDrag2=Z.getFactor(),d._currentDragGradient=N);const I=(0,e.o)(d._currentDrag1,d._currentDrag2,X);this._scaledDirection.scaleInPlace(1-I)})),this.isLocal&&d.sg?(d.sg.addInPlace(this._scaledDirection),X.n.TransformCoordinatesToRef(d.sg,this._emitterWorldMatrix,d.position)):d.position.addInPlace(this._scaledDirection),S&&Z&&d._randomNoiseCoordinates1){const N=this._fetchR(d._randomNoiseCoordinates1.x,d._randomNoiseCoordinates1.y,Z.width,Z.height,S),I=this._fetchR(d._randomNoiseCoordinates1.z,d._randomNoiseCoordinates2.x,Z.width,Z.height,S),m=this._fetchR(d._randomNoiseCoordinates2.y,d._randomNoiseCoordinates2.z,Z.width,Z.height,S),z=X.h.kd[0],e=X.h.kd[1];z.fd((2*N-1)*this.noiseStrength.x,(2*I-1)*this.noiseStrength.y,(2*m-1)*this.noiseStrength.z),z.scaleToRef(w,e),d.direction.addInPlace(e)}this.gravity.scaleToRef(w,this._scaledGravity),d.direction.addInPlace(this._scaledGravity),this._sizeGradients&&this._sizeGradients.length>0&&a.GetCurrentGradient(B,this._sizeGradients,((N,Z,X)=>{N!==d._currentSizeGradient&&(d._currentSize1=d._currentSize2,d._currentSize2=Z.getFactor(),d._currentSizeGradient=N),d.size=(0,e.o)(d._currentSize1,d._currentSize2,X)})),this._useRampGradients&&(this._colorRemapGradients&&this._colorRemapGradients.length>0&&a.GetCurrentGradient(B,this._colorRemapGradients,((N,Z,X)=>{const I=(0,e.o)(N.factor1,Z.factor1,X),m=(0,e.o)(N.factor2,Z.factor2,X);d.remapData.x=I,d.remapData.y=m-I})),this._alphaRemapGradients&&this._alphaRemapGradients.length>0&&a.GetCurrentGradient(B,this._alphaRemapGradients,((N,Z,X)=>{const I=(0,e.o)(N.factor1,Z.factor1,X),m=(0,e.o)(N.factor2,Z.factor2,X);d.remapData.z=I,d.remapData.w=m-I}))),this._isAnimationSheetEnabled&&d.updateCellIndex(),d._inheritParticleInfoToSubEmitters(),d.age>=d.lifeTime&&(this._emitFromParticle(d),d._attachedSubEmitters&&(d._attachedSubEmitters.forEach((N=>{N.particleSystem.disposeOnStop=!0,N.particleSystem.stop()})),d._attachedSubEmitters=null),this.recycleParticle(d),I&&m--)}}}serialize(N){throw new Error("Method not implemented.")}clone(N,Z){throw new Error("Method not implemented.")}_addFactorGradient(N,Z,d,X){const I=new u(Z,d,X);N.push(I),N.sort(((N,Z)=>N.gradient<Z.gradient?-1:N.gradient>Z.gradient?1:0))}_removeFactorGradient(N,Z){if(!N)return;let d=0;for(const X of N){if(X.gradient===Z){N.splice(d,1);break}d++}}addLifeTimeGradient(N,Z,d){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,N,Z,d),this}removeLifeTimeGradient(N){return this._removeFactorGradient(this._lifeTimeGradients,N),this}addSizeGradient(N,Z,d){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,N,Z,d),this}removeSizeGradient(N){return this._removeFactorGradient(this._sizeGradients,N),this}addColorRemapGradient(N,Z,d){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,N,Z,d),this}removeColorRemapGradient(N){return this._removeFactorGradient(this._colorRemapGradients,N),this}addAlphaRemapGradient(N,Z,d){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,N,Z,d),this}removeAlphaRemapGradient(N){return this._removeFactorGradient(this._alphaRemapGradients,N),this}addAngularSpeedGradient(N,Z,d){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,N,Z,d),this}removeAngularSpeedGradient(N){return this._removeFactorGradient(this._angularSpeedGradients,N),this}addVelocityGradient(N,Z,d){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,N,Z,d),this}removeVelocityGradient(N){return this._removeFactorGradient(this._velocityGradients,N),this}addLimitVelocityGradient(N,Z,d){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,N,Z,d),this}removeLimitVelocityGradient(N){return this._removeFactorGradient(this._limitVelocityGradients,N),this}addDragGradient(N,Z,d){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,N,Z,d),this}removeDragGradient(N){return this._removeFactorGradient(this._dragGradients,N),this}addEmitRateGradient(N,Z,d){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,N,Z,d),this}removeEmitRateGradient(N){return this._removeFactorGradient(this._emitRateGradients,N),this}addStartSizeGradient(N,Z,d){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,N,Z,d),this}removeStartSizeGradient(N){return this._removeFactorGradient(this._startSizeGradients,N),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const N=new Uint8Array(4*this._rawTextureWidth),Z=z.i.wd[0];for(let d=0;d<this._rawTextureWidth;d++){const X=d/this._rawTextureWidth;a.GetCurrentGradient(X,this._rampGradients,((X,I,m)=>{z.b.LerpToRef(X.color,I.color,m,Z),N[4*d]=255*Z.r,N[4*d+1]=255*Z.g,N[4*d+2]=255*Z.b,N[4*d+3]=255}))}this._rampGradientsTexture=R.e.CreateRGBATexture(N,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((N,Z)=>N.gradient<Z.gradient?-1:N.gradient>Z.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(N,Z){this._rampGradients||(this._rampGradients=[]);const d=new l(N,Z);return this._rampGradients.push(d),this._syncRampGradientTexture(),this}removeRampGradient(N){return this._removeGradientAndTexture(N,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(N,Z,d){this._colorGradients||(this._colorGradients=[]);const X=new y(N,Z,d);return this._colorGradients.push(X),this._colorGradients.sort(((N,Z)=>N.gradient<Z.gradient?-1:N.gradient>Z.gradient?1:0)),this}removeColorGradient(N){if(!this._colorGradients)return this;let Z=0;for(const d of this._colorGradients){if(d.gradient===N){this._colorGradients.splice(Z,1);break}Z++}return this}resetDrawCache(){for(const N of this._drawWrappers)if(N)for(const Z of N)null===Z||void 0===Z||Z.dispose();this._drawWrappers=[]}_fetchR(N,Z,d,X,I){return I[4*(((N=.5*Math.abs(N)+.5)*d%d|0)+((Z=.5*Math.abs(Z)+.5)*X%X|0)*d)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const N=this._engine,Z=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*Z),this._vertexBuffer=new A.b(N,this._vertexData,!0,Z);let d=0;const X=this._vertexBuffer.createVertexBuffer(A.d.PositionKind,d,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[A.d.PositionKind]=X,d+=3;const I=this._vertexBuffer.createVertexBuffer(A.d.ColorKind,d,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[A.d.ColorKind]=I,d+=4;const m=this._vertexBuffer.createVertexBuffer("angle",d,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=m,d+=1;const z=this._vertexBuffer.createVertexBuffer("size",d,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=z,d+=2,this._isAnimationSheetEnabled){const N=this._vertexBuffer.createVertexBuffer("cellIndex",d,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=N,d+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const N=this._vertexBuffer.createVertexBuffer("direction",d,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=N,d+=3}if(this._useRampGradients){const N=this._vertexBuffer.createVertexBuffer("remapData",d,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=N,d+=4}let w;if(this._useInstancing){const Z=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new A.b(N,Z,!1,2),w=this._spriteBuffer.createVertexBuffer("offset",0,2)}else w=this._vertexBuffer.createVertexBuffer("offset",d,2,this._vertexBufferSize,this._useInstancing),d+=2;this._vertexBuffers.offset=w,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const N=[],Z=[];let d=0;for(let X=0;X<this._capacity;X++)N.push(d),N.push(d+1),N.push(d+2),N.push(d),N.push(d+2),N.push(d+3),Z.push(d,d+1,d+1,d+2,d+2,d+3,d+3,d,d,d+3),d+=4;this._indexBuffer=this._engine.createIndexBuffer(N),this._linesIndexBuffer=this._engine.createIndexBuffer(Z)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(N)setTimeout((()=>{this.start(0)}),N);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var Z;-1!==(null===(Z=this.k)||void 0===Z?void 0:Z.getClassName().indexOf("Mesh"))&&this.k.be(!0);const N=this.noiseTexture;if(N&&N.onGeneratedObservable)N.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let Z=0;Z<this.preWarmCycles;Z++)this.animate(!0),N.render()}))}));else for(let Z=0;Z<this.preWarmCycles;Z++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop)}}stop(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(N))}_postStop(N){}reset(){this._stockParticles.length=0,this.wj.length=0}_appendParticleVertex(N,Z,d,I){let m=N*this._vertexBufferSize;if(this._vertexData[m++]=Z.position.x+this.og.x,this._vertexData[m++]=Z.position.y+this.og.y,this._vertexData[m++]=Z.position.z+this.og.z,this._vertexData[m++]=Z.color.r,this._vertexData[m++]=Z.color.g,this._vertexData[m++]=Z.color.b,this._vertexData[m++]=Z.color.a,this._vertexData[m++]=Z.angle,this._vertexData[m++]=Z.scale.x*Z.size,this._vertexData[m++]=Z.scale.y*Z.size,this._isAnimationSheetEnabled&&(this._vertexData[m++]=Z.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[m++]=Z.direction.x,this._vertexData[m++]=Z.direction.y,this._vertexData[m++]=Z.direction.z);else if(Z._initialDirection){let N=Z._initialDirection;this.isLocal&&(X.n.TransformNormalToRef(N,this._emitterWorldMatrix,X.h.kd[0]),N=X.h.kd[0]),0===N.x&&0===N.z&&(N.x=.001),this._vertexData[m++]=N.x,this._vertexData[m++]=N.y,this._vertexData[m++]=N.z}else{let N=Z.direction;this.isLocal&&(X.n.TransformNormalToRef(N,this._emitterWorldMatrix,X.h.kd[0]),N=X.h.kd[0]),0===N.x&&0===N.z&&(N.x=.001),this._vertexData[m++]=N.x,this._vertexData[m++]=N.y,this._vertexData[m++]=N.z}this._useRampGradients&&Z.remapData&&(this._vertexData[m++]=Z.remapData.x,this._vertexData[m++]=Z.remapData.y,this._vertexData[m++]=Z.remapData.z,this._vertexData[m++]=Z.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===d?d=this._epsilon:1===d&&(d=1-this._epsilon),0===I?I=this._epsilon:1===I&&(I=1-this._epsilon)),this._vertexData[m++]=d,this._vertexData[m++]=I)}_prepareParticle(N){}_update(N){if(this._alive=this.wj.length>0,this.k.position){const N=this.k;this._emitterWorldMatrix=N.getWorldMatrix()}else{const N=this.k;this._emitterWorldMatrix=X.c.Translation(N.x,N.y,N.z)}let Z;this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.wj);for(let d=0;d<N&&this.wj.length!==this._capacity;d++){if(Z=this._createParticle(),this.wj.push(Z),this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0){const N=(0,e.e)(this._actualFrame/this.targetStopDuration);a.GetCurrentGradient(N,this._lifeTimeGradients,((d,X)=>{const I=d,m=X,z=I.getFactor(),w=m.getFactor(),S=(N-I.gradient)/(m.gradient-I.gradient);Z.lifeTime=(0,e.o)(z,w,S)}))}else Z.lifeTime=(0,e.s)(this.minLifeTime,this.maxLifeTime);const N=(0,e.s)(this.minEmitPower,this.maxEmitPower);if(this.startPositionFunction?this.startPositionFunction(this._emitterWorldMatrix,Z.position,Z,this.isLocal):this.particleEmitterType.startPositionFunction(this._emitterWorldMatrix,Z.position,Z,this.isLocal),this.isLocal&&(Z.sg?Z.sg.p(Z.position):Z.sg=Z.position.clone(),X.n.TransformCoordinatesToRef(Z.sg,this._emitterWorldMatrix,Z.position)),this.startDirectionFunction?this.startDirectionFunction(this._emitterWorldMatrix,Z.direction,Z,this.isLocal):this.particleEmitterType.startDirectionFunction(this._emitterWorldMatrix,Z.direction,Z,this.isLocal,this._emitterInverseWorldMatrix),0===N?Z._initialDirection?Z._initialDirection.p(Z.direction):Z._initialDirection=Z.direction.clone():Z._initialDirection=null,Z.direction.scaleInPlace(N),this._sizeGradients&&0!==this._sizeGradients.length?(Z._currentSizeGradient=this._sizeGradients[0],Z._currentSize1=Z._currentSizeGradient.getFactor(),Z.size=Z._currentSize1,this._sizeGradients.length>1?Z._currentSize2=this._sizeGradients[1].getFactor():Z._currentSize2=Z._currentSize1):Z.size=(0,e.s)(this.minSize,this.maxSize),Z.scale.fd((0,e.s)(this.minScaleX,this.maxScaleX),(0,e.s)(this.minScaleY,this.maxScaleY)),this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration){const N=this._actualFrame/this.targetStopDuration;a.GetCurrentGradient(N,this._startSizeGradients,((N,d,X)=>{N!==this._currentStartSizeGradient&&(this._currentStartSize1=this._currentStartSize2,this._currentStartSize2=d.getFactor(),this._currentStartSizeGradient=N);const I=(0,e.o)(this._currentStartSize1,this._currentStartSize2,X);Z.scale.scaleInPlace(I)}))}if(this._angularSpeedGradients&&0!==this._angularSpeedGradients.length?(Z._currentAngularSpeedGradient=this._angularSpeedGradients[0],Z.angularSpeed=Z._currentAngularSpeedGradient.getFactor(),Z._currentAngularSpeed1=Z.angularSpeed,this._angularSpeedGradients.length>1?Z._currentAngularSpeed2=this._angularSpeedGradients[1].getFactor():Z._currentAngularSpeed2=Z._currentAngularSpeed1):Z.angularSpeed=(0,e.s)(this.minAngularSpeed,this.maxAngularSpeed),Z.angle=(0,e.s)(this.minInitialRotation,this.maxInitialRotation),this._velocityGradients&&this._velocityGradients.length>0&&(Z._currentVelocityGradient=this._velocityGradients[0],Z._currentVelocity1=Z._currentVelocityGradient.getFactor(),this._velocityGradients.length>1?Z._currentVelocity2=this._velocityGradients[1].getFactor():Z._currentVelocity2=Z._currentVelocity1),this._limitVelocityGradients&&this._limitVelocityGradients.length>0&&(Z._currentLimitVelocityGradient=this._limitVelocityGradients[0],Z._currentLimitVelocity1=Z._currentLimitVelocityGradient.getFactor(),this._limitVelocityGradients.length>1?Z._currentLimitVelocity2=this._limitVelocityGradients[1].getFactor():Z._currentLimitVelocity2=Z._currentLimitVelocity1),this._dragGradients&&this._dragGradients.length>0&&(Z._currentDragGradient=this._dragGradients[0],Z._currentDrag1=Z._currentDragGradient.getFactor(),this._dragGradients.length>1?Z._currentDrag2=this._dragGradients[1].getFactor():Z._currentDrag2=Z._currentDrag1),this._colorGradients&&0!==this._colorGradients.length)Z._currentColorGradient=this._colorGradients[0],Z._currentColorGradient.getColorToRef(Z.color),Z._currentColor1.p(Z.color),this._colorGradients.length>1?this._colorGradients[1].getColorToRef(Z._currentColor2):Z._currentColor2.p(Z.color);else{const N=(0,e.s)(0,1);z.e.LerpToRef(this.color1,this.color2,N,Z.color),this.colorDead.subtractToRef(Z.color,this._colorDiff),this._colorDiff.scaleToRef(1/Z.lifeTime,Z.colorStep)}this._isAnimationSheetEnabled&&(Z._initialStartSpriteCellID=this.startSpriteCellID,Z._initialEndSpriteCellID=this.endSpriteCellID,Z._initialSpriteCellLoop=this.spriteCellLoop),Z.direction.addInPlace(this._inheritedVelocityOffset),this._useRampGradients&&(Z.remapData=new X.q(0,1,0,1)),this.noiseTexture&&(Z._randomNoiseCoordinates1?(Z._randomNoiseCoordinates1.fd(Math.random(),Math.random(),Math.random()),Z._randomNoiseCoordinates2.fd(Math.random(),Math.random(),Math.random())):(Z._randomNoiseCoordinates1=new X.n(Math.random(),Math.random(),Math.random()),Z._randomNoiseCoordinates2=new X.n(Math.random(),Math.random(),Math.random()))),Z._inheritParticleInfoToSubEmitters()}}static _GetAttributeNamesOrOptions(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],d=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const X=[A.d.PositionKind,A.d.ColorKind,"angle","offset","size"];return N&&X.push("cellIndex"),Z||X.push("direction"),d&&X.push("remapData"),X}static _GetEffectCreationOptions(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],d=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const X=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,ZN.e)(X),N&&X.push("particlesInfos"),Z&&X.push("logarithmicDepthConstant"),d&&(X.push("vFogInfos"),X.push("vFogColor")),X}fillDefines(N,Z){let d=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,ZN.l)(this,this._scene,N),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&N.push("#define FOG")),this._isAnimationSheetEnabled&&N.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&N.push("#define LOGARITHMICDEPTH"),Z===S.BLENDMODE_MULTIPLY&&N.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&N.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(N.push("#define BILLBOARD"),this.billboardMode){case 2:N.push("#define BILLBOARDY");break;case 8:case 9:N.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&N.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:N.push("#define BILLBOARDMODE_ALL")}d&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),N.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(N,Z,d){Z.push(...IN._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),N.push(...IN._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),d.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,XN.f)(N,this._imageProcessingConfigurationDefines),(0,XN.b)(d,this._imageProcessingConfigurationDefines))}_getWrapper(N){const Z=this._getCustomDrawWrapper(N);if(null!==Z&&void 0!==Z&&Z.effect)return Z;const d=[];this.fillDefines(d,N);const X=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let I=this._drawWrappers[X];I||(I=this._drawWrappers[X]=[]);let m=I[N];m||(m=new NN.b(this._engine),m.drawContext&&(m.drawContext.useInstancing=this._useInstancing),I[N]=m);const z=d.join("\n");if(m.defines!==z){const N=[],Z=[],d=[];this.fillUniformsAttributesAndSamplerNames(Z,N,d),m.setEffect(this._engine.createEffect("particles",N,Z,d,z,void 0,void 0,void 0,void 0,this._shaderLanguage),z)}return m}animate(){var N;let Z,d=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started){if(!d&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(d?this.preWarmStepOffset:(null===(N=this._scene)||void 0===N?void 0:N.getAnimationRatio())||1),this.manualEmitCount>-1)Z=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let N=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const Z=this._actualFrame/this.targetStopDuration;a.GetCurrentGradient(Z,this._emitRateGradients,((Z,d,X)=>{Z!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=d.getFactor(),this._currentEmitRateGradient=Z),N=(0,e.o)(this._currentEmitRate1,this._currentEmitRate2,X)}))}Z=N*this._scaledUpdateSpeed|0,this._newPartsExcess+=N*this._scaledUpdateSpeed-Z}if(this._newPartsExcess>1&&(Z+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?Z=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(Z),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!d){let N=0;for(let Z=0;Z<this.wj.length;Z++){const d=this.wj[Z];this._appendParticleVertices(N,d),N+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.wj.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(N,Z){this._appendParticleVertex(N++,Z,0,0),this._useInstancing||(this._appendParticleVertex(N++,Z,1,0),this._appendParticleVertex(N++,Z,1,1),this._appendParticleVertex(N++,Z,0,1))}rebuild(){var N;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(N=this._spriteBuffer)||void 0===N||N._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!IN.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(d.bind(d,11523)),Promise.resolve().then(d.bind(d,11514))])):await Promise.all([Promise.resolve().then(d.bind(d,11508)),Promise.resolve().then(d.bind(d,11503))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.k||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==S.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(S.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(S.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(N){const Z=this._getWrapper(N),d=Z.effect,I=this._engine;I.enableEffect(Z);const m=this.defaultViewMatrix??this._scene.getViewMatrix();if(d.setTexture("diffuseSampler",this.particleTexture),d.setMatrix("view",m),d.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const N=this.particleTexture.getBaseSize();d.setFloat3("particlesInfos",this.spriteCellWidth/N.width,this.spriteCellHeight/N.height,this.spriteCellWidth/N.width)}if(d.setVector2("translationPivot",this.translationPivot),d.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const N=this._scene.activeCamera;d.setVector3("eyePosition",N.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),d.setTexture("rampSampler",this._rampGradientsTexture));const z=d.defines;var w,e,j,B,D,v;(this._scene&&((0,ZN.i)(d,this,this._scene),this.applyFog&&(0,dN.f)(this._scene,void 0,d)),z.indexOf("#define BILLBOARDMODE_ALL")>=0&&(m.invertToRef(X.h.Matrix[0]),d.setMatrix("invView",X.h.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(w=this._scene)&&void 0!==w&&w.forceWireframe?I.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,d):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,d)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(e=this._scene)&&void 0!==e&&e.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?I.bindBuffers(this._vertexBuffers,null!==(j=this._scene)&&void 0!==j&&j.forceWireframe?this._linesIndexBuffer:this._indexBuffer,d):I.bindBuffers(this._vertexBuffers,null!==(B=this._scene)&&void 0!==B&&B.forceWireframe?this._linesIndexBufferUseInstancing:null,d);switch(this.useLogarithmicDepth&&this._scene&&(0,dN.k)(z,d,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(d),N){case S.BLENDMODE_ADD:I.setAlphaMode(1);break;case S.BLENDMODE_ONEONE:I.setAlphaMode(6);break;case S.BLENDMODE_STANDARD:I.setAlphaMode(2);break;case S.BLENDMODE_MULTIPLY:I.setAlphaMode(4)}(this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(d),this._useInstancing)?null!==(D=this._scene)&&void 0!==D&&D.forceWireframe?I.drawElementsType(6,0,10,this.wj.length):I.drawArraysType(7,0,4,this.wj.length):null!==(v=this._scene)&&void 0!==v&&v.forceWireframe?I.drawElementsType(1,0,10*this.wj.length):I.drawElementsType(0,0,6*this.wj.length);return this.wj.length}render(){if(!this.isReady()||!this.wj.length)return 0;const N=this._engine;N.setState&&(N.setState(!1),this.forceDepthWrite&&N.setDepthWrite(!0));let Z=0;return Z=this.blendMode===S.BLENDMODE_MULTIPLYADD?this._render(S.BLENDMODE_MULTIPLY)+this._render(S.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),Z}_onDispose(){}dispose(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],d=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),N&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),N&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(Z,d),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const N=this._scene.Od.indexOf(this);N>-1&&this._scene.Od.splice(N,1),this._scene._activeParticleSystems.dispose()}this.pd.notifyObservers(this),this.pd.clear(),this.onStoppedObservable.clear(),this.reset()}}IN.ForceGLSL=!1;var mN,zN=d(1041);!function(N){N[N.ATTACHED=0]="ATTACHED",N[N.END=1]="END"}(mN||(mN={}));class wN{constructor(N){if(this.particleSystem=N,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!N.k||!N.k.dispose){const Z=(0,w.d)("BABYLON.AbstractMesh");N.k=new Z("SubemitterSystemEmitter",N.va()),N._disposeEmitterOnDispose=!0}}clone(){let N=this.particleSystem.k;if(N){if(N instanceof X.n)N=N.clone();else if(-1!==N.getClassName().indexOf("Mesh")){N=new((0,w.d)("BABYLON.Mesh"))("",N.va()),N.isVisible=!1}}else N=new X.n;const Z=new wN(this.particleSystem.clone(this.particleSystem.name,N));return Z.particleSystem.name+="Clone",Z.type=this.type,Z.inheritDirection=this.inheritDirection,Z.inheritedVelocityAmount=this.inheritedVelocityAmount,Z.particleSystem._disposeEmitterOnDispose=!0,Z.particleSystem.disposeOnStop=!0,Z}serialize(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const Z={};return Z.type=this.type,Z.inheritDirection=this.inheritDirection,Z.inheritedVelocityAmount=this.inheritedVelocityAmount,Z.particleSystem=this.particleSystem.serialize(N),Z}static _ParseParticleSystem(N,Z,d){throw(0,zN.b)("ParseParticle")}static Parse(N,Z,d){const X=N.particleSystem,I=new wN(wN._ParseParticleSystem(X,Z,d,!0));return I.type=N.type,I.inheritDirection=N.inheritDirection,I.inheritedVelocityAmount=N.inheritedVelocityAmount,I.particleSystem._isSubEmitter=!0,I}dispose(){this.particleSystem.dispose()}}var SN=d(1060);function eN(N,Z){const d=new U;return d.direction1=N,d.direction2=Z,d}function jN(){return new h(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function BN(){return new C(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function DN(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new X.n(0,1,0),d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new X.n(0,1,0);return new M(N,Z,d)}function vN(){return new T(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function TN(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new X.n(0,1,0),m=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new X.n(0,1,0);return new k(N,Z,d,I,m)}function kN(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new D(N,Z)}function hN(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new X.n(0,1,0),I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new X.n(0,1,0);return new v(N,Z,d,I)}class UN extends IN{constructor(){super(...arguments),this._disposeEmitterOnDispose=!1,this._emitFromParticle=N=>{if(!this._subEmitters||0===this._subEmitters.length)return;const Z=Math.floor(Math.random()*this._subEmitters.length);this._subEmitters[Z].forEach((Z=>{if(1===Z.type){const d=Z.clone();N._inheritParticleInfoToSubEmitter(d),d.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(d.particleSystem),d.particleSystem.start()}}))}}createPointEmitter(N,Z){const d=eN(N,Z);return this.particleEmitterType=d,d}createHemisphericEmitter(){const N=jN(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=N,N}createSphereEmitter(){const N=BN(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=N,N}createDirectedSphereEmitter(){const N=DN(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new X.n(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new X.n(0,1,0));return this.particleEmitterType=N,N}createCylinderEmitter(){const N=vN(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=N,N}createDirectedCylinderEmitter(){const N=TN(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new X.n(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new X.n(0,1,0));return this.particleEmitterType=N,N}createConeEmitter(){const N=kN(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=N,N}createDirectedConeEmitter(){const N=hN(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new X.n(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new X.n(0,1,0));return this.particleEmitterType=N,N}createBoxEmitter(N,Z,d,X){const I=new B;return this.particleEmitterType=I,this.direction1=N,this.direction2=Z,this.minEmitBox=d,this.maxEmitBox=X,I}_prepareSubEmitterInternalArray(){this._subEmitters=new Array,this.subEmitters&&this.subEmitters.forEach((N=>{N instanceof UN?this._subEmitters.push([new wN(N)]):N instanceof wN?this._subEmitters.push([N]):N instanceof Array&&this._subEmitters.push(N)}))}_stopSubEmitters(){this.activeSubSystems&&(this.activeSubSystems.forEach((N=>{N.stop(!0)})),this.activeSubSystems=[])}_removeFromRoot(){if(!this._rootParticleSystem)return;const N=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==N&&this._rootParticleSystem.activeSubSystems.splice(N,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(N){N&&this._stopSubEmitters()}_prepareParticle(N){if(this._subEmitters&&this._subEmitters.length>0){const Z=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];N._attachedSubEmitters=[],Z.forEach((Z=>{if(0===Z.type){const d=Z.clone();N._attachedSubEmitters.push(d),d.particleSystem.start()}}))}}_onDispose(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];var d;(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),N)&&(null===(d=this.particles)||void 0===d||d.forEach((N=>{if(N._attachedSubEmitters)for(let Z=N._attachedSubEmitters.length-1;Z>=0;Z-=1)N._attachedSubEmitters[Z].dispose()})));if(Z&&this.activeSubSystems)for(let X=this.activeSubSystems.length-1;X>=0;X-=1)this.activeSubSystems[X].dispose();if(this._subEmitters&&this._subEmitters.length){for(let N=0;N<this._subEmitters.length;N++)for(const Z of this._subEmitters[N])Z.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.k&&this.k.dispose&&this.k.dispose(!0)}static _Parse(N,Z,d,I){let m;m=d instanceof SN.c?null:d;const S=(0,w.d)("BABYLON.Texture");if(S&&m&&(N.texture?Z.particleTexture=S.Parse(N.texture,m,I):N.textureName&&(Z.particleTexture=new S(I+N.textureName,m,!1,void 0===N.invertY||N.invertY),Z.particleTexture.name=N.textureName)),N.emitterId||0===N.emitterId||void 0!==N.k?N.emitterId&&m?Z.k=m.getLastMeshById(N.emitterId):Z.k=X.n._c(N.k):Z.k=X.n.Zero(),Z.isLocal=!!N.isLocal,void 0!==N.renderingGroupId&&(Z.renderingGroupId=N.renderingGroupId),void 0!==N.isBillboardBased&&(Z.isBillboardBased=N.isBillboardBased),void 0!==N.billboardMode&&(Z.billboardMode=N.billboardMode),void 0!==N.useLogarithmicDepth&&(Z.useLogarithmicDepth=N.useLogarithmicDepth),N.animations){for(let d=0;d<N.animations.length;d++){const X=N.animations[d],I=(0,w.d)("BABYLON.Animation");I&&Z.animations.push(I.Parse(X))}Z.beginAnimationOnStart=N.beginAnimationOnStart,Z.beginAnimationFrom=N.beginAnimationFrom,Z.beginAnimationTo=N.beginAnimationTo,Z.beginAnimationLoop=N.beginAnimationLoop}if(N.autoAnimate&&m&&m.beginAnimation(Z,N.autoAnimateFrom,N.autoAnimateTo,N.autoAnimateLoop,N.autoAnimateSpeed||1),Z.startDelay=0|N.startDelay,Z.minAngularSpeed=N.minAngularSpeed,Z.maxAngularSpeed=N.maxAngularSpeed,Z.minSize=N.minSize,Z.maxSize=N.maxSize,N.minScaleX&&(Z.minScaleX=N.minScaleX,Z.maxScaleX=N.maxScaleX,Z.minScaleY=N.minScaleY,Z.maxScaleY=N.maxScaleY),void 0!==N.preWarmCycles&&(Z.preWarmCycles=N.preWarmCycles,Z.preWarmStepOffset=N.preWarmStepOffset),void 0!==N.minInitialRotation&&(Z.minInitialRotation=N.minInitialRotation,Z.maxInitialRotation=N.maxInitialRotation),Z.minLifeTime=N.minLifeTime,Z.maxLifeTime=N.maxLifeTime,Z.minEmitPower=N.minEmitPower,Z.maxEmitPower=N.maxEmitPower,Z.emitRate=N.emitRate,Z.gravity=X.n._c(N.gravity),N.noiseStrength&&(Z.noiseStrength=X.n._c(N.noiseStrength)),Z.color1=z.e._c(N.color1),Z.color2=z.e._c(N.color2),Z.colorDead=z.e._c(N.colorDead),Z.updateSpeed=N.updateSpeed,Z.targetStopDuration=N.targetStopDuration,Z.blendMode=N.blendMode,N.colorGradients)for(const X of N.colorGradients)Z.addColorGradient(X.gradient,z.e._c(X.color1),X.color2?z.e._c(X.color2):void 0);if(N.rampGradients){for(const d of N.rampGradients)Z.addRampGradient(d.gradient,z.b._c(d.color));Z.useRampGradients=N.useRampGradients}if(N.colorRemapGradients)for(const X of N.colorRemapGradients)Z.addColorRemapGradient(X.gradient,void 0!==X.factor1?X.factor1:X.factor,X.factor2);if(N.alphaRemapGradients)for(const X of N.alphaRemapGradients)Z.addAlphaRemapGradient(X.gradient,void 0!==X.factor1?X.factor1:X.factor,X.factor2);if(N.sizeGradients)for(const X of N.sizeGradients)Z.addSizeGradient(X.gradient,void 0!==X.factor1?X.factor1:X.factor,X.factor2);if(N.angularSpeedGradients)for(const X of N.angularSpeedGradients)Z.addAngularSpeedGradient(X.gradient,void 0!==X.factor1?X.factor1:X.factor,X.factor2);if(N.velocityGradients)for(const X of N.velocityGradients)Z.addVelocityGradient(X.gradient,void 0!==X.factor1?X.factor1:X.factor,X.factor2);if(N.dragGradients)for(const X of N.dragGradients)Z.addDragGradient(X.gradient,void 0!==X.factor1?X.factor1:X.factor,X.factor2);if(N.emitRateGradients)for(const X of N.emitRateGradients)Z.addEmitRateGradient(X.gradient,void 0!==X.factor1?X.factor1:X.factor,X.factor2);if(N.startSizeGradients)for(const X of N.startSizeGradients)Z.addStartSizeGradient(X.gradient,void 0!==X.factor1?X.factor1:X.factor,X.factor2);if(N.lifeTimeGradients)for(const X of N.lifeTimeGradients)Z.addLifeTimeGradient(X.gradient,void 0!==X.factor1?X.factor1:X.factor,X.factor2);if(N.limitVelocityGradients){for(const d of N.limitVelocityGradients)Z.addLimitVelocityGradient(d.gradient,void 0!==d.factor1?d.factor1:d.factor,d.factor2);Z.limitVelocityDamping=N.limitVelocityDamping}if(N.noiseTexture&&m){const d=(0,w.d)("BABYLON.ProceduralTexture");Z.noiseTexture=d.Parse(N.noiseTexture,m,I)}let e;if(N.particleEmitterType){switch(N.particleEmitterType.type){case"SphereParticleEmitter":e=new C;break;case"SphereDirectedParticleEmitter":e=new M;break;case"ConeEmitter":case"ConeParticleEmitter":e=new D;break;case"ConeDirectedParticleEmitter":e=new v;break;case"CylinderParticleEmitter":e=new T;break;case"CylinderDirectedParticleEmitter":e=new k;break;case"HemisphericParticleEmitter":e=new h;break;case"PointParticleEmitter":e=new U;break;case"MeshParticleEmitter":e=new n;break;case"CustomParticleEmitter":e=new Q;break;default:e=new B}e.parse(N.particleEmitterType,m)}else e=new B,e.parse(N,m);Z.particleEmitterType=e,Z.startSpriteCellID=N.startSpriteCellID,Z.endSpriteCellID=N.endSpriteCellID,Z.spriteCellLoop=N.spriteCellLoop??!0,Z.spriteCellWidth=N.spriteCellWidth,Z.spriteCellHeight=N.spriteCellHeight,Z.spriteCellChangeSpeed=N.spriteCellChangeSpeed,Z.spriteRandomStartCell=N.spriteRandomStartCell,Z.disposeOnStop=N.disposeOnStop??!1,Z.manualEmitCount=N.manualEmitCount??-1}static Parse(N,Z,d){let I=arguments.length>3&&void 0!==arguments[3]&&arguments[3],m=arguments.length>4?arguments[4]:void 0;const w=N.name;let S,e,j=null,B=null;if(Z instanceof SN.c?S=Z:(e=Z,S=e.getEngine()),N.customShader&&S.createEffectForParticles){B=N.customShader;const Z=B.shaderOptions.defines.length>0?B.shaderOptions.defines.join("\n"):"";j=S.createEffectForParticles(B.shaderPath.fragmentElement,B.shaderOptions.uniforms,B.shaderOptions.samplers,Z)}const D=new UN(w,m||N.he,Z,j,N.isAnimationSheetEnabled);if(D.customShader=B,D._rootUrl=d,N.id&&(D.id=N.id),N.subEmitters){D.subEmitters=[];for(const X of N.subEmitters){const N=[];for(const I of X)N.push(wN.Parse(I,Z,d));D.subEmitters.push(N)}}return UN._Parse(N,D,Z,d),N.textureMask&&(D.textureMask=z.e._c(N.textureMask)),N.og&&(D.og=X.n._c(N.og)),N.preventAutoStart&&(D.preventAutoStart=N.preventAutoStart),I||D.preventAutoStart||D.start(),D}serialize(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const Z={};if(UN._Serialize(Z,this,N),Z.textureMask=this.textureMask.ed(),Z.customShader=this.customShader,Z.preventAutoStart=this.preventAutoStart,Z.og=this.og.ed(),this.subEmitters){Z.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const d of this._subEmitters){const X=[];for(const Z of d)X.push(Z.serialize(N));Z.subEmitters.push(X)}}return Z}static _Serialize(N,Z,d){if(N.name=Z.name,N.id=Z.id,N.he=Z.getCapacity(),N.disposeOnStop=Z.disposeOnStop,N.manualEmitCount=Z.manualEmitCount,Z.k.position){const d=Z.k;N.emitterId=d.id}else{const d=Z.k;N.k=d.ed()}Z.particleEmitterType&&(N.particleEmitterType=Z.particleEmitterType.serialize()),Z.particleTexture&&(d?N.texture=Z.particleTexture.serialize():(N.textureName=Z.particleTexture.name,N.invertY=!!Z.particleTexture._invertY)),N.isLocal=Z.isLocal,F.c.AppendSerializedAnimations(Z,N),N.beginAnimationOnStart=Z.beginAnimationOnStart,N.beginAnimationFrom=Z.beginAnimationFrom,N.beginAnimationTo=Z.beginAnimationTo,N.beginAnimationLoop=Z.beginAnimationLoop,N.startDelay=Z.startDelay,N.renderingGroupId=Z.renderingGroupId,N.isBillboardBased=Z.isBillboardBased,N.billboardMode=Z.billboardMode,N.minAngularSpeed=Z.minAngularSpeed,N.maxAngularSpeed=Z.maxAngularSpeed,N.minSize=Z.minSize,N.maxSize=Z.maxSize,N.minScaleX=Z.minScaleX,N.maxScaleX=Z.maxScaleX,N.minScaleY=Z.minScaleY,N.maxScaleY=Z.maxScaleY,N.minEmitPower=Z.minEmitPower,N.maxEmitPower=Z.maxEmitPower,N.minLifeTime=Z.minLifeTime,N.maxLifeTime=Z.maxLifeTime,N.emitRate=Z.emitRate,N.gravity=Z.gravity.ed(),N.noiseStrength=Z.noiseStrength.ed(),N.color1=Z.color1.ed(),N.color2=Z.color2.ed(),N.colorDead=Z.colorDead.ed(),N.updateSpeed=Z.updateSpeed,N.targetStopDuration=Z.targetStopDuration,N.blendMode=Z.blendMode,N.preWarmCycles=Z.preWarmCycles,N.preWarmStepOffset=Z.preWarmStepOffset,N.minInitialRotation=Z.minInitialRotation,N.maxInitialRotation=Z.maxInitialRotation,N.startSpriteCellID=Z.startSpriteCellID,N.spriteCellLoop=Z.spriteCellLoop,N.endSpriteCellID=Z.endSpriteCellID,N.spriteCellChangeSpeed=Z.spriteCellChangeSpeed,N.spriteCellWidth=Z.spriteCellWidth,N.spriteCellHeight=Z.spriteCellHeight,N.spriteRandomStartCell=Z.spriteRandomStartCell,N.isAnimationSheetEnabled=Z.isAnimationSheetEnabled,N.useLogarithmicDepth=Z.useLogarithmicDepth;const X=Z.getColorGradients();if(X){N.colorGradients=[];for(const Z of X){const d={gradient:Z.gradient,color1:Z.color1.ed()};Z.color2?d.color2=Z.color2.ed():d.color2=Z.color1.ed(),N.colorGradients.push(d)}}const I=Z.getRampGradients();if(I){N.rampGradients=[];for(const Z of I){const d={gradient:Z.gradient,color:Z.color.ed()};N.rampGradients.push(d)}N.useRampGradients=Z.useRampGradients}const m=Z.getColorRemapGradients();if(m){N.colorRemapGradients=[];for(const Z of m){const d={gradient:Z.gradient,factor1:Z.factor1};void 0!==Z.factor2?d.factor2=Z.factor2:d.factor2=Z.factor1,N.colorRemapGradients.push(d)}}const z=Z.getAlphaRemapGradients();if(z){N.alphaRemapGradients=[];for(const Z of z){const d={gradient:Z.gradient,factor1:Z.factor1};void 0!==Z.factor2?d.factor2=Z.factor2:d.factor2=Z.factor1,N.alphaRemapGradients.push(d)}}const w=Z.getSizeGradients();if(w){N.sizeGradients=[];for(const Z of w){const d={gradient:Z.gradient,factor1:Z.factor1};void 0!==Z.factor2?d.factor2=Z.factor2:d.factor2=Z.factor1,N.sizeGradients.push(d)}}const S=Z.getAngularSpeedGradients();if(S){N.angularSpeedGradients=[];for(const Z of S){const d={gradient:Z.gradient,factor1:Z.factor1};void 0!==Z.factor2?d.factor2=Z.factor2:d.factor2=Z.factor1,N.angularSpeedGradients.push(d)}}const e=Z.getVelocityGradients();if(e){N.velocityGradients=[];for(const Z of e){const d={gradient:Z.gradient,factor1:Z.factor1};void 0!==Z.factor2?d.factor2=Z.factor2:d.factor2=Z.factor1,N.velocityGradients.push(d)}}const j=Z.getDragGradients();if(j){N.dragGradients=[];for(const Z of j){const d={gradient:Z.gradient,factor1:Z.factor1};void 0!==Z.factor2?d.factor2=Z.factor2:d.factor2=Z.factor1,N.dragGradients.push(d)}}const B=Z.getEmitRateGradients();if(B){N.emitRateGradients=[];for(const Z of B){const d={gradient:Z.gradient,factor1:Z.factor1};void 0!==Z.factor2?d.factor2=Z.factor2:d.factor2=Z.factor1,N.emitRateGradients.push(d)}}const D=Z.getStartSizeGradients();if(D){N.startSizeGradients=[];for(const Z of D){const d={gradient:Z.gradient,factor1:Z.factor1};void 0!==Z.factor2?d.factor2=Z.factor2:d.factor2=Z.factor1,N.startSizeGradients.push(d)}}const v=Z.getLifeTimeGradients();if(v){N.lifeTimeGradients=[];for(const Z of v){const d={gradient:Z.gradient,factor1:Z.factor1};void 0!==Z.factor2?d.factor2=Z.factor2:d.factor2=Z.factor1,N.lifeTimeGradients.push(d)}}const T=Z.getLimitVelocityGradients();if(T){N.limitVelocityGradients=[];for(const Z of T){const d={gradient:Z.gradient,factor1:Z.factor1};void 0!==Z.factor2?d.factor2=Z.factor2:d.factor2=Z.factor1,N.limitVelocityGradients.push(d)}N.limitVelocityDamping=Z.limitVelocityDamping}Z.noiseTexture&&(N.noiseTexture=Z.noiseTexture.serialize())}clone(N,Z){let d=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const X={...this._customWrappers};let I=null;const m=this._engine;if(m.createEffectForParticles&&null!=this.customShader){I=this.customShader;const N=I.shaderOptions.defines.length>0?I.shaderOptions.defines.join("\n"):"",Z=m.createEffectForParticles(I.shaderPath.fragmentElement,I.shaderOptions.uniforms,I.shaderOptions.samplers,N);X[0]?X[0].effect=Z:this.setCustomEffect(Z,0)}const z=this.serialize(d),w=UN.Parse(z,this._scene||this._engine,this._rootUrl);return w.name=N,w.customShader=I,w._customWrappers=X,void 0===Z&&(Z=this.k),this.noiseTexture&&(w.noiseTexture=this.noiseTexture.clone()),w.k=Z,this.preventAutoStart||w.start(),w}}UN.BILLBOARDMODE_Y=2,UN.BILLBOARDMODE_ALL=7,UN.BILLBOARDMODE_STRETCHED=8,UN.BILLBOARDMODE_STRETCHED_LOCAL=9,wN._ParseParticleSystem=UN.Parse;var CN=d(1150),MN=d(1131),QN=d(1321);QN.c.prototype.createTransformFeedback=function(){const N=this._gl.createTransformFeedback();if(!N)throw new Error("Unable to create Transform Feedback");return N},QN.c.prototype.deleteTransformFeedback=function(N){this._gl.deleteTransformFeedback(N)},QN.c.prototype.bindTransformFeedback=function(N){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,N)},QN.c.prototype.beginTransformFeedback=function(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(N?this._gl.POINTS:this._gl.TRIANGLES)},QN.c.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},QN.c.prototype.setTranformFeedbackVaryings=function(N,Z){this._gl.transformFeedbackVaryings(N,Z,this._gl.INTERLEAVED_ATTRIBS)},QN.c.prototype.bindTransformFeedbackBuffer=function(N){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,N?N.underlyingResource:null)},QN.c.prototype.readTransformFeedbackBuffer=function(N){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,N)};const AN="clipPlaneFragmentDeclaration2",nN="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";V.c.IncludesShadersStore[AN]=nN;d(10841),d(10734),d(10661),d(10846),d(10871),d(10873),d(10905),d(10908);const gN="gpuRenderParticlesPixelShader",EN="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";V.c.ShadersStore[gN]=EN;const VN="clipPlaneVertexDeclaration2",ON="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";V.c.IncludesShadersStore[VN]=ON;d(10712),d(10782),d(10784),d(10800);const KN="gpuRenderParticlesVertexShader",rN="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";V.c.ShadersStore[KN]=rN;class PN extends S{static get IsSupported(){if(!f.e.LastCreatedEngine)return!1;const N=f.e.LastCreatedEngine.getCaps();return N.supportTransformFeedbacks||N.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(N){this._maxActiveParticleCount=Math.min(N,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(N){this.maxActiveParticleCount=N}createPointEmitter(N,Z){const d=eN(N,Z);return this.particleEmitterType=d,d}createHemisphericEmitter(){const N=jN(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=N,N}createSphereEmitter(){const N=BN(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=N,N}createDirectedSphereEmitter(){const N=DN(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new X.n(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new X.n(0,1,0));return this.particleEmitterType=N,N}createCylinderEmitter(){const N=vN(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=N,N}createDirectedCylinderEmitter(){const N=TN(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new X.n(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new X.n(0,1,0));return this.particleEmitterType=N,N}createConeEmitter(){const N=kN(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=N,N}createDirectedConeEmitter(){const N=hN(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new X.n(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new X.n(0,1,0));return this.particleEmitterType=N,N}createBoxEmitter(N,Z,d,X){const I=new B;return this.particleEmitterType=I,this.direction1=N,this.direction2=Z,this.minEmitBox=d,this.maxEmitBox=X,I}isReady(){if(!this.k||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==UN.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(UN.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(UN.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";N?setTimeout((()=>{this.start(0)}),N):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var N;let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(N=this._customWrappers[Z])||void 0===N?void 0:N.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[N]??this._customWrappers[0]}setCustomEffect(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[Z]=new NN.b(this._engine),this._customWrappers[Z].effect=N}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new c.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(N,Z,d){return super._removeGradientAndTexture(N,Z,d),this._releaseBuffers(),this}addColorGradient(N,Z){this._colorGradients||(this._colorGradients=[]);const d=new y(N,Z);return this._colorGradients.push(d),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(N&&this._colorGradients.sort(((N,Z)=>N.gradient<Z.gradient?-1:N.gradient>Z.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(N){return this._removeGradientAndTexture(N,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const Z in this._drawWrappers){var N;null===(N=this._drawWrappers[Z].drawContext)||void 0===N||N.reset()}}_addFactorGradient(N,Z,d){const X=new u(Z,d);N.push(X),this._releaseBuffers()}addSizeGradient(N,Z){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,N,Z),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(N){return this._removeGradientAndTexture(N,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(N,Z){if(!N)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&N.sort(((N,Z)=>N.gradient<Z.gradient?-1:N.gradient>Z.gradient?1:0));const d=this;d[Z]&&(d[Z].dispose(),d[Z]=null)}addAngularSpeedGradient(N,Z){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,N,Z),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(N){return this._removeGradientAndTexture(N,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(N,Z){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,N,Z),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(N){return this._removeGradientAndTexture(N,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(N,Z){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,N,Z),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(N){return this._removeGradientAndTexture(N,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(N,Z){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,N,Z),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(N){return this._removeGradientAndTexture(N,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(N){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(N,Z,d){let I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,m=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(N),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.pd=new c.d,this.onStoppedObservable=new c.d,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._onBeforeDrawParticlesObservable=null,d&&"Scene"!==d.getClassName()?(this._engine=d,this.defaultProjectionMatrix=X.c.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=d||f.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Od.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,w.d)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,w.d)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,w.d)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,w.d)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new NN.b(this._engine)},this._customWrappers[0].effect=I,this._drawWrappers={0:new NN.b(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(Z=Z??{}).randomTextureSize||delete Z.randomTextureSize;const z={he:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...Z},S=Z;isFinite(S)&&(z.he=S),this._capacity=z.he,this._maxActiveParticleCount=z.he,this._currentActiveCount=0,this._isAnimationSheetEnabled=m,this.particleEmitterType=new B;const e=Math.min(this._engine.getCaps().maxTextureSize,z.randomTextureSize);let j=[];for(let X=0;X<e;++X)j.push(Math.random()),j.push(Math.random()),j.push(Math.random()),j.push(Math.random());this._randomTexture=new R.e(new Float32Array(j),e,1,5,d,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,j=[];for(let X=0;X<e;++X)j.push(Math.random()),j.push(Math.random()),j.push(Math.random()),j.push(Math.random());this._randomTexture2=new R.e(new Float32Array(j),e,1,5,d,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=e}_reset(){this._releaseBuffers()}_createVertexBuffers(N,Z,d){const X={};X.position=Z.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let I=3;X.age=Z.createVertexBuffer("age",I,1,this._attributesStrideSize,!0),I+=1,X.size=Z.createVertexBuffer("size",I,3,this._attributesStrideSize,!0),I+=3,X.life=Z.createVertexBuffer("life",I,1,this._attributesStrideSize,!0),I+=1,I+=4,this.billboardMode===UN.BILLBOARDMODE_STRETCHED&&(X.direction=Z.createVertexBuffer("direction",I,3,this._attributesStrideSize,!0)),I+=3,this._platform.alignDataInBuffer&&(I+=1),this.particleEmitterType instanceof Q&&(I+=3,this._platform.alignDataInBuffer&&(I+=1)),this._colorGradientsTexture||(X.color=Z.createVertexBuffer("color",I,4,this._attributesStrideSize,!0),I+=4),this._isBillboardBased||(X.initialDirection=Z.createVertexBuffer("initialDirection",I,3,this._attributesStrideSize,!0),I+=3,this._platform.alignDataInBuffer&&(I+=1)),this.noiseTexture&&(X.noiseCoordinates1=Z.createVertexBuffer("noiseCoordinates1",I,3,this._attributesStrideSize,!0),I+=3,this._platform.alignDataInBuffer&&(I+=1),X.noiseCoordinates2=Z.createVertexBuffer("noiseCoordinates2",I,3,this._attributesStrideSize,!0),I+=3,this._platform.alignDataInBuffer&&(I+=1)),X.angle=Z.createVertexBuffer("angle",I,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?I++:I+=2,this._isAnimationSheetEnabled&&(X.cellIndex=Z.createVertexBuffer("cellIndex",I,1,this._attributesStrideSize,!0),I+=1,this.spriteRandomStartCell&&(X.cellStartOffset=Z.createVertexBuffer("cellStartOffset",I,1,this._attributesStrideSize,!0),I+=1)),X.offset=d.createVertexBuffer("offset",0,2),X.uv=d.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(X),this._platform.createVertexBuffers(N,X),this.resetDrawCache()}_initialize(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!N)return;const Z=this._engine,d=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof Q&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const I=this.particleEmitterType instanceof Q,m=X.h.kd[0];let z=0;for(let X=0;X<this._capacity;X++)if(d.push(0),d.push(0),d.push(0),d.push(0),d.push(0),d.push(0),d.push(0),d.push(0),d.push(Math.random()),d.push(Math.random()),d.push(Math.random()),d.push(Math.random()),I?(this.particleEmitterType.particleDestinationGenerator(X,null,m),d.push(m.x),d.push(m.y),d.push(m.z)):(d.push(0),d.push(0),d.push(0)),this._platform.alignDataInBuffer&&d.push(0),z+=16,I&&(this.particleEmitterType.particlePositionGenerator(X,null,m),d.push(m.x),d.push(m.y),d.push(m.z),this._platform.alignDataInBuffer&&d.push(0),z+=4),this._colorGradientsTexture||(d.push(0),d.push(0),d.push(0),d.push(0),z+=4),this.isBillboardBased||(d.push(0),d.push(0),d.push(0),this._platform.alignDataInBuffer&&d.push(0),z+=4),this.noiseTexture&&(d.push(Math.random()),d.push(Math.random()),d.push(Math.random()),this._platform.alignDataInBuffer&&d.push(0),d.push(Math.random()),d.push(Math.random()),d.push(Math.random()),this._platform.alignDataInBuffer&&d.push(0),z+=8),d.push(0),z+=1,this._angularSpeedGradientsTexture||(d.push(0),z+=1),this._isAnimationSheetEnabled&&(d.push(0),z+=1,this.spriteRandomStartCell&&(d.push(0),z+=1)),this._platform.alignDataInBuffer){let N=3-(z+3&3);for(z+=N;N-- >0;)d.push(0)}const w=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),S=this._platform.createParticleBuffer(d),e=this._platform.createParticleBuffer(d);this._buffer0=new A.b(Z,S,!1,this._attributesStrideSize),this._buffer1=new A.b(Z,e,!1,this._attributesStrideSize),this._spriteBuffer=new A.b(Z,w,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let N=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(N+="\n#define BILLBOARD"),this._colorGradientsTexture&&(N+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(N+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(N+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(N+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(N+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(N+="\n#define DRAGGRADIENTS"),this.isAnimationSheetEnabled&&(N+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(N+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(N+="\n#define NOISE"),this.isLocal&&(N+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===N||(this._cachedUpdateDefines=N,this._updateBuffer=this._platform.createUpdateBuffer(N)),this._platform.isUpdateBufferReady()}_getWrapper(N){const Z=this._getCustomDrawWrapper(N);if(null!==Z&&void 0!==Z&&Z.effect)return Z;const d=[];this.fillDefines(d,N);let X=this._drawWrappers[N];X||(X=new NN.b(this._engine),X.drawContext&&(X.drawContext.useInstancing=!0),this._drawWrappers[N]=X);const I=d.join("\n");if(X.defines!==I){const N=[],Z=[],d=[];this.fillUniformsAttributesAndSamplerNames(Z,N,d),X.setEffect(this._engine.createEffect("gpuRenderParticles",N,Z,d,I),I)}return X}static _GetAttributeNamesOrOptions(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],d=arguments.length>2&&void 0!==arguments[2]&&arguments[2],X=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const I=[A.d.PositionKind,"age","life","size","angle"];return N||I.push(A.d.ColorKind),Z&&I.push("cellIndex"),d||I.push("initialDirection"),X&&I.push("direction"),I.push("offset",A.d.UVKind),I}static _GetEffectCreationOptions(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],d=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const X=["emitterWM","og","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,ZN.e)(X),N&&X.push("sheetInfos"),Z&&X.push("logarithmicDepthConstant"),d&&(X.push("vFogInfos"),X.push("vFogColor")),X}fillDefines(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,d=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,ZN.l)(this,this._scene,N),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==MN.e.FOGMODE_NONE&&N.push("#define FOG")),Z===UN.BLENDMODE_MULTIPLY&&N.push("#define BLENDMULTIPLYMODE"),this.isLocal&&N.push("#define LOCAL"),this.useLogarithmicDepth&&N.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(N.push("#define BILLBOARD"),this.billboardMode){case UN.BILLBOARDMODE_Y:N.push("#define BILLBOARDY");break;case UN.BILLBOARDMODE_STRETCHED:N.push("#define BILLBOARDSTRETCHED");break;case UN.BILLBOARDMODE_ALL:N.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&N.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&N.push("#define ANIMATESHEET"),d&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),N.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(N,Z,d){Z.push(...PN._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===UN.BILLBOARDMODE_STRETCHED)),N.push(...PN._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),d.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(CN.b.PrepareUniforms(N,this._imageProcessingConfigurationDefines),CN.b.PrepareSamplers(d,this._imageProcessingConfigurationDefines))}animate(){var N;let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(Z?this.preWarmStepOffset:(null===(N=this._scene)||void 0===N?void 0:N.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(N,Z){const d=this[Z];if(!N||!N.length||d)return;const X=new Float32Array(this._rawTextureWidth);for(let I=0;I<this._rawTextureWidth;I++){const Z=I/this._rawTextureWidth;a.GetCurrentGradient(Z,N,((N,Z,d)=>{X[I]=(0,e.o)(N.factor1,Z.factor1,d)}))}this[Z]=R.e.CreateRTexture(X,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[Z].name=Z.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const N=new Uint8Array(4*this._rawTextureWidth),Z=z.i.yd[0];for(let d=0;d<this._rawTextureWidth;d++){const X=d/this._rawTextureWidth;a.GetCurrentGradient(X,this._colorGradients,((X,I,m)=>{z.e.LerpToRef(X.color1,I.color1,m,Z),N[4*d]=255*Z.r,N[4*d+1]=255*Z.g,N[4*d+2]=255*Z.b,N[4*d+3]=255*Z.a}))}this._colorGradientsTexture=R.e.CreateRGBATexture(N,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(N,Z){var d,I,m,z;const w=this._getWrapper(N),S=w.effect;this._engine.enableEffect(w);const e=(null===(d=this._scene)||void 0===d?void 0:d.getViewMatrix())||X.c.IdentityReadOnly;if(S.setMatrix("view",e),S.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),S.setTexture("diffuseSampler",this.particleTexture),S.setVector2("translationPivot",this.translationPivot),S.setVector3("og",this.og),this.isLocal&&S.setMatrix("emitterWM",Z),this._colorGradientsTexture?S.setTexture("colorGradientSampler",this._colorGradientsTexture):S.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const N=this.particleTexture.getBaseSize();S.setFloat3("sheetInfos",this.spriteCellWidth/N.width,this.spriteCellHeight/N.height,N.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const N=this._scene.activeCamera;S.setVector3("eyePosition",N.globalPosition)}const j=S.defines;if(this._scene&&((0,ZN.i)(S,this,this._scene),this.applyFog&&(0,dN.f)(this._scene,void 0,S)),j.indexOf("#define BILLBOARDMODE_ALL")>=0){const N=e.clone();N.invert(),S.setMatrix("invView",N)}switch(this.useLogarithmicDepth&&this._scene&&(0,dN.k)(j,S,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(S),N){case UN.BLENDMODE_ADD:this._engine.setAlphaMode(1);break;case UN.BLENDMODE_ONEONE:this._engine.setAlphaMode(6);break;case UN.BLENDMODE_STANDARD:this._engine.setAlphaMode(2);break;case UN.BLENDMODE_MULTIPLY:this._engine.setAlphaMode(4)}return this._platform.bindDrawBuffers(this._targetIndex,S,null!==(I=this._scene)&&void 0!==I&&I.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(S),null!==(m=this._scene)&&void 0!==m&&m.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(z=this._scene)&&void 0!==z&&z.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(N){if(!this.k||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!N)if(this.k.position){N=this.k.getWorldMatrix()}else{const Z=this.k;N=X.h.Matrix[0],X.c.TranslationToRef(Z.x,Z.y,Z.z,N)}this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this.isLocal||this._updateBuffer.setMatrix("emitterWM",N),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const Z=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=Z}render(){let N,Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!Z&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let N=0;N<this.preWarmCycles;N++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>1){const N=0|this._accumulatedCount;this._accumulatedCount-=N,this._currentActiveCount+=N}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.k.position){N=this.k.getWorldMatrix()}else{const Z=this.k;N=X.h.Matrix[0],X.c.TranslationToRef(Z.x,Z.y,Z.z,N)}const I=this._engine;this.updateInAnimate||this._update(N);let m=0;return Z||d||(I.setState(!1),this.forceDepthWrite&&I.setDepthWrite(!0),m=this.blendMode===UN.BLENDMODE_MULTIPLYADD?this._render(UN.BLENDMODE_MULTIPLY,N)+this._render(UN.BLENDMODE_ADD,N):this._render(this.blendMode,N),this._engine.setAlphaMode(0)),m}rebuild(){const N=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(N,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,N()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const Z in this._drawWrappers){this._drawWrappers[Z].dispose()}if(this._drawWrappers={},this._scene){const N=this._scene.Od.indexOf(this);N>-1&&this._scene.Od.splice(N,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let Z=0;Z<this._renderVertexBuffers.length;++Z){const N=this._renderVertexBuffers[Z];for(const Z in N)N[Z].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),N&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),N&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.pd.notifyObservers(this),this.pd.clear()}clone(N,Z){let d=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const X={...this._customWrappers};let I=null;const m=this._engine;if(m.createEffectForParticles&&null!=this.customShader){I=this.customShader;const N=I.shaderOptions.defines.length>0?I.shaderOptions.defines.join("\n"):"";X[0]=m.createEffectForParticles(I.shaderPath.fragmentElement,I.shaderOptions.uniforms,I.shaderOptions.samplers,N,void 0,void 0,void 0,this)}const z=this.serialize(d),w=PN.Parse(z,this._scene||this._engine,this._rootUrl);return w.name=N,w.customShader=I,w._customWrappers=X,void 0===Z&&(Z=this.k),this.noiseTexture&&(w.noiseTexture=this.noiseTexture.clone()),w.k=Z,w}serialize(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const Z={};return UN._Serialize(Z,this,N),Z.activeParticleCount=this.activeParticleCount,Z.randomTextureSize=this._randomTextureSize,Z.customShader=this.customShader,Z}static Parse(N,Z,d){let X=arguments.length>3&&void 0!==arguments[3]&&arguments[3],I=arguments.length>4?arguments[4]:void 0;const m=N.name;let z,w;Z instanceof SN.c?z=Z:(w=Z,z=w.getEngine());const S=new PN(m,{he:I||N.he,randomTextureSize:N.randomTextureSize},Z,null,N.isAnimationSheetEnabled);if(S._rootUrl=d,N.customShader&&z.createEffectForParticles){const Z=N.customShader,d=Z.shaderOptions.defines.length>0?Z.shaderOptions.defines.join("\n"):"",X=z.createEffectForParticles(Z.shaderPath.fragmentElement,Z.shaderOptions.uniforms,Z.shaderOptions.samplers,d,void 0,void 0,void 0,S);S.setCustomEffect(X,0),S.customShader=Z}return N.id&&(S.id=N.id),N.activeParticleCount&&(S.activeParticleCount=N.activeParticleCount),UN._Parse(N,S,Z,d),N.preventAutoStart&&(S.preventAutoStart=N.preventAutoStart),X||S.preventAutoStart||S.start(),S}}var WN=d(1133),bN=d(11476),JN=d(1122);class FN{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(N){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const Z of this.systems)Z.k=N;this._emitterNode=N}setEmitterAsSphere(N,Z,d){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:N,renderingGroupId:Z};const X=(0,bN.d)("emitterSphere",{diameter:N.diameter,segments:N.segments},d);X.renderingGroupId=Z;const I=new JN.d("emitterSphereMaterial",d);I.emissiveColor=N.color,X.material=I;for(const m of this.systems)m.k=X;this._emitterNode=X}start(N){for(const Z of this.systems)N&&(Z.k=N),Z.start()}dispose(){for(const N of this.systems)N.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const Z={systems:[]};for(const d of this.systems)Z.systems.push(d.serialize(N));return this._emitterNode&&(Z.k=this._emitterCreationOptions),Z}static Parse(N,Z){let d=arguments.length>2&&void 0!==arguments[2]&&arguments[2],X=arguments.length>3?arguments[3]:void 0;const I=new FN,m=this.BaseAssetsUrl+"/textures/";Z=Z||f.e.LastCreatedScene;for(const z of N.systems)I.systems.push(d?PN.Parse(z,Z,m,!0,X):UN.Parse(z,Z,m,!0,X));if(N.k){const d=N.k.options;if("Sphere"===N.k.kind)I.setEmitterAsSphere({diameter:d.diameter,segments:d.segments,color:z.b._c(d.color)},N.k.renderingGroupId,Z)}return I}}FN.BaseAssetsUrl="https://assets.babylonjs.com/particles";var GN=d(1017);class xN{static CreateDefault(N){let Z,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,X=arguments.length>2?arguments[2]:void 0;return Z=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new PN("default system",{he:d},X):new UN("default system",d,X),Z.k=N,Z.particleTexture=new G.c("https://assets.babylonjs.com/textures/flare.png",Z.va()),Z.createConeEmitter(.1,Math.PI/4),Z.color1=new z.e(1,1,1,1),Z.color2=new z.e(1,1,1,1),Z.colorDead=new z.e(1,1,1,0),Z.minSize=.1,Z.maxSize=.1,Z.minEmitPower=2,Z.maxEmitPower=2,Z.updateSpeed=1/60,Z.emitRate=30,Z}static CreateAsync(N,Z){let d=arguments.length>2&&void 0!==arguments[2]&&arguments[2],X=arguments.length>3?arguments[3]:void 0;Z||(Z=f.e.LastCreatedScene);const I={};return Z.addPendingData(I),new Promise(((m,z)=>{if(d&&!PN.IsSupported)return Z.removePendingData(I),z("Particle system with GPU is not supported.");WN.g.LoadFile(`${xN.BaseAssetsUrl}/systems/${N}.json`,(N=>{Z.removePendingData(I);const z=JSON.parse(N.toString());return m(FN.Parse(z,Z,d,X))}),void 0,void 0,void 0,(()=>(Z.removePendingData(I),z(`An error occurred with the creation of your particle system. Check if your type '${N}' exists.`))))}))}static ExportSet(N){const Z=new FN;for(const d of N)Z.systems.push(d);return Z}static ParseFromFileAsync(N,Z,d){let X=arguments.length>3&&void 0!==arguments[3]&&arguments[3],I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",m=arguments.length>5?arguments[5]:void 0;return new Promise(((z,w)=>{const S=new GN.c;S.addEventListener("readystatechange",(()=>{if(4==S.readyState)if(200==S.status){const Z=JSON.parse(S.responseText);let w;w=X?PN.Parse(Z,d,I,!1,m):UN.Parse(Z,d,I,!1,m),N&&(w.name=N),z(w)}else w("Unable to load the particle system")})),S.open("GET",Z),S.send()}))}static ParseFromSnippetAsync(N,Z){let d=arguments.length>2&&void 0!==arguments[2]&&arguments[2],X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",I=arguments.length>4?arguments[4]:void 0;if("_BLANK"===N){const N=this.CreateDefault(null);return N.start(),Promise.resolve(N)}return new Promise(((m,z)=>{const w=new GN.c;w.addEventListener("readystatechange",(()=>{if(4==w.readyState)if(200==w.status){const z=JSON.parse(JSON.parse(w.responseText).jsonPayload),S=JSON.parse(z.particleSystem);let e;e=d?PN.Parse(S,Z,X,!1,I):UN.Parse(S,Z,X,!1,I),e.snippetId=N,m(e)}else z("Unable to load the snippet "+N)})),w.open("GET",this.SnippetUrl+"/"+N.replace(/#/g,"/")),w.send()}))}}xN.BaseAssetsUrl=FN.BaseAssetsUrl,xN.SnippetUrl="https://snippet.babylonjs.com",xN.CreateFromSnippetAsync=xN.ParseFromSnippetAsync;var tN=d(11321),qN=d(1193),YN=d(11482);(0,YN.e)(qN.e.NAME_PARTICLESYSTEM,((N,Z,d,X)=>{const I=(0,YN.i)(qN.e.NAME_PARTICLESYSTEM);if(I&&void 0!==N.Od&&null!==N.Od)for(let m=0,z=N.Od.length;m<z;m++){const z=N.Od[m];d.Od.push(I(z,Z,X))}})),(0,YN.b)(qN.e.NAME_PARTICLESYSTEM,((N,Z,d)=>{if(N.activeParticleCount){return PN.Parse(N,Z,d)}return UN.Parse(N,Z,d)})),SN.c.prototype.createEffectForParticles=function(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",m=arguments.length>4?arguments[4]:void 0,z=arguments.length>5?arguments[5]:void 0,w=arguments.length>6?arguments[6]:void 0,S=arguments.length>7?arguments[7]:void 0,e=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,j=[],B=[];const D=[];return S?S.fillUniformsAttributesAndSamplerNames(B,j,D):(j=UN._GetAttributeNamesOrOptions(),B=UN._GetEffectCreationOptions()),-1===I.indexOf(" BILLBOARD")&&(I+="\n#define BILLBOARD\n"),null!==S&&void 0!==S&&S.isAnimationSheetEnabled&&-1===I.indexOf(" ANIMATESHEET")&&(I+="\n#define ANIMATESHEET\n"),-1===X.indexOf("diffuseSampler")&&X.push("diffuseSampler"),this.createEffect({vertex:(null===S||void 0===S?void 0:S.vertexShaderName)??"particles",fragmentElement:N},j,B.concat(Z),D.concat(X),I,m,z,w,void 0,e,(async()=>{0===e?await Promise.resolve().then(d.bind(d,11508)):await Promise.resolve().then(d.bind(d,11523))}))},tN.b.prototype.getEmittedParticleSystems=function(){const N=[];for(let Z=0;Z<this.va().Od.length;Z++){const d=this.va().Od[Z];d.k===this&&N.push(d)}return N},tN.b.prototype.getHierarchyEmittedParticleSystems=function(){const N=[],Z=this.getDescendants();Z.push(this);for(let d=0;d<this.va().Od.length;d++){const X=this.va().Od[d],I=X.k;I.position&&-1!==Z.indexOf(I)&&N.push(X)}return N};d(1264),d(1273),d(11366);d(11345),d(11489),d(1388),d(1252),d(11374);d(1382);var sN;d(11496),d(1002);!function(N){N[N.Color=2]="Color",N[N.UV=1]="UV",N[N.Random=0]="Random",N[N.Stated=3]="Stated"}(sN||(sN={}));d(11503),d(11508),d(11514),d(11523)},10576:(N,Z,d)=>{"use strict";const X="clipPlaneFragment",I="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";d(1069).c.IncludesShadersStoreWGSL[X]=I},10562:(N,Z,d)=>{"use strict";const X="clipPlaneFragmentDeclaration",I="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";d(1069).c.IncludesShadersStoreWGSL[X]=I},10464:(N,Z,d)=>{"use strict";const X="clipPlaneVertex",I="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";d(1069).c.IncludesShadersStoreWGSL[X]=I},10386:(N,Z,d)=>{"use strict";const X="clipPlaneVertexDeclaration",I="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";d(1069).c.IncludesShadersStoreWGSL[X]=I},10618:(N,Z,d)=>{"use strict";const X="fogFragment",I="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";d(1069).c.IncludesShadersStoreWGSL[X]=I},10571:(N,Z,d)=>{"use strict";const X="fogFragmentDeclaration",I="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";d(1069).c.IncludesShadersStoreWGSL[X]=I},10470:(N,Z,d)=>{"use strict";const X="fogVertex",I="#ifdef FOG\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#endif\n";d(1069).c.IncludesShadersStoreWGSL[X]=I},10391:(N,Z,d)=>{"use strict";const X="fogVertexDeclaration",I="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";d(1069).c.IncludesShadersStoreWGSL[X]=I},10326:(N,Z,d)=>{"use strict";const X="helperFunctions",I="const PI: f32=3.1415926535897932384626433832795;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3<f32>=vec3<f32> (0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(0.0),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);} \nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3<f32>=inMatrix[0];let i1: vec3<f32>=inMatrix[1];let i2: vec3<f32>=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3<f32>)->vec3<f32>\n{let nearZeroSection: vec3<f32>=0.0773993808*color;let remainingSection: vec3<f32>=pow(0.947867299*(color+vec3<f32>(0.055)),vec3<f32>(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3<f32>(0.04045)));}\nfn toGammaSpaceExact(color: vec3<f32>)->vec3<f32>\n{let nearZeroSection: vec3<f32>=12.92*color;let remainingSection: vec3<f32>=1.055*pow(color,vec3<f32>(0.41666))-vec3<f32>(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3<f32>(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3<f32>)->vec3<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3<f32>(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3<f32>(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3<f32>)->vec3<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3<f32>(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3<f32>)->vec3<f32>\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3<f32>)->f32\n{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3<f32>)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3<f32> =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(clamp(rgb,vec3<f32>(0.,0.,0.),vec3<f32>(1.,1.,1.)),D); }\nfn fromRGBD(rgbd: vec4<f32>)->vec3<f32> {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3<f32>,origVec: vec3<f32>,cubeSize: vec3<f32>,cubePos: vec3<f32>)->vec3<f32> {let invOrigVec: vec3<f32>=vec3<f32>(1.0,1.0,1.0)/origVec;let halfSize: vec3<f32>=cubeSize*0.5;let intersecAtMaxPlane: vec3<f32>=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3<f32>=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3<f32>=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3<f32>=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\n";d(1069).c.IncludesShadersStoreWGSL[X]=I},10538:(N,Z,d)=>{"use strict";const X="imageProcessingDeclaration",I="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";d(1069).c.IncludesShadersStoreWGSL[X]=I},10547:(N,Z,d)=>{"use strict";const X="imageProcessingFunctions",I="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";d(1069).c.IncludesShadersStoreWGSL[X]=I},10410:(N,Z,d)=>{"use strict";const X="logDepthDeclaration",I="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";d(1069).c.IncludesShadersStoreWGSL[X]=I},10610:(N,Z,d)=>{"use strict";const X="logDepthFragment",I="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";d(1069).c.IncludesShadersStoreWGSL[X]=I},10489:(N,Z,d)=>{"use strict";const X="logDepthVertex",I="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";d(1069).c.IncludesShadersStoreWGSL[X]=I},11514:(N,Z,d)=>{"use strict";d.r(Z),d.d(Z,{particlesPixelShaderWGSL:()=>z});var X=d(1069);d(10562),d(10538),d(10410),d(10326),d(10547),d(10571),d(10576),d(10610),d(10618);const I="particlesPixelShader",m="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";X.c.ShadersStoreWGSL[I]=m;const z={name:I,shader:m}},11523:(N,Z,d)=>{"use strict";d.r(Z),d.d(Z,{particlesVertexShaderWGSL:()=>z});var X=d(1069);d(10386),d(10391),d(10410),d(10464),d(10470),d(10489);const I="particlesVertexShader",m="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return input.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";X.c.ShadersStoreWGSL[I]=m;const z={name:I,shader:m}},10873:(N,Z,d)=>{"use strict";const X="clipPlaneFragment",I="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";d(1069).c.IncludesShadersStore[X]=I},10864:(N,Z,d)=>{"use strict";const X="clipPlaneFragmentDeclaration",I="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";d(1069).c.IncludesShadersStore[X]=I},10782:(N,Z,d)=>{"use strict";const X="clipPlaneVertex",I="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";d(1069).c.IncludesShadersStore[X]=I},10709:(N,Z,d)=>{"use strict";const X="clipPlaneVertexDeclaration",I="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";d(1069).c.IncludesShadersStore[X]=I},10908:(N,Z,d)=>{"use strict";const X="fogFragment",I="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";d(1069).c.IncludesShadersStore[X]=I},10871:(N,Z,d)=>{"use strict";const X="fogFragmentDeclaration",I="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";d(1069).c.IncludesShadersStore[X]=I},10784:(N,Z,d)=>{"use strict";const X="fogVertex",I="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";d(1069).c.IncludesShadersStore[X]=I},10712:(N,Z,d)=>{"use strict";const X="fogVertexDeclaration",I="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";d(1069).c.IncludesShadersStore[X]=I},10661:(N,Z,d)=>{"use strict";const X="helperFunctions",I="const float PI=3.1415926535897932384626433832795;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.0;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(clamp(rgb,0.,1.),D); }\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.0,1.0,1.0)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\n";d(1069).c.IncludesShadersStore[X]=I},10841:(N,Z,d)=>{"use strict";const X="imageProcessingDeclaration",I="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";d(1069).c.IncludesShadersStore[X]=I},10846:(N,Z,d)=>{"use strict";const X="imageProcessingFunctions",I="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";d(1069).c.IncludesShadersStore[X]=I},10734:(N,Z,d)=>{"use strict";const X="logDepthDeclaration",I="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";d(1069).c.IncludesShadersStore[X]=I},10905:(N,Z,d)=>{"use strict";const X="logDepthFragment",I="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";d(1069).c.IncludesShadersStore[X]=I},10800:(N,Z,d)=>{"use strict";const X="logDepthVertex",I="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";d(1069).c.IncludesShadersStore[X]=I},11503:(N,Z,d)=>{"use strict";d.r(Z),d.d(Z,{particlesPixelShader:()=>z});var X=d(1069);d(10864),d(10841),d(10734),d(10661),d(10846),d(10871),d(10873),d(10905),d(10908);const I="particlesPixelShader",m="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";X.c.ShadersStore[I]=m;const z={name:I,shader:m}},11508:(N,Z,d)=>{"use strict";d.r(Z),d.d(Z,{particlesVertexShader:()=>z});var X=d(1069);d(10709),d(10712),d(10734),d(10782),d(10784),d(10800);const I="particlesVertexShader",m="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";X.c.ShadersStore[I]=m;const z={name:I,shader:m}},11343:(N,Z,d)=>{"use strict";d.d(Z,{e:()=>B});var X=d(942),I=d(960),m=d(949),z=d(958),w=d(986),S=d(1041),e=d(1094);class j{constructor(){this._doNotSerialize=!1,this._isDisposed=!1,this._sceneRootNodesIndex=-1,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._onEnabledStateChangedObservable=new z.d,this._onClonedObservable=new z.d}}class B{static AddNodeConstructor(N,Z){this._NodeConstructors[N]=Z}static Construct(N,Z,d,X){const I=this._NodeConstructors[N];return I?I(Z,d,X):null}set accessibilityTag(N){this._accessibilityTag=N,this.onAccessibilityTagChangedObservable.notifyObservers(N)}get accessibilityTag(){return this._accessibilityTag}get doNotSerialize(){return!!this._nodeDataStorage._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize}set doNotSerialize(N){this._nodeDataStorage._doNotSerialize=N}u(){return this._nodeDataStorage._isDisposed}set parent(N){if(this._parentNode===N)return;const Z=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){const Z=this._parentNode._children.indexOf(this);-1!==Z&&this._parentNode._children.splice(Z,1),N||this._nodeDataStorage._isDisposed||this._addToSceneRootNodes()}this._parentNode=N,this._isDirty=!0,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),Z||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}get parent(){return this._parentNode}_serializeAsParent(N){N.parentId=this.uniqueId}_addToSceneRootNodes(){-1===this._nodeDataStorage._sceneRootNodesIndex&&(this._nodeDataStorage._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))}_removeFromSceneRootNodes(){if(-1!==this._nodeDataStorage._sceneRootNodesIndex){const N=this._scene.rootNodes,Z=N.length-1;N[this._nodeDataStorage._sceneRootNodesIndex]=N[Z],N[this._nodeDataStorage._sceneRootNodesIndex]._nodeDataStorage._sceneRootNodesIndex=this._nodeDataStorage._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._nodeDataStorage._sceneRootNodesIndex=-1}}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(N){this._animationPropertiesOverride=N}getClassName(){return"Node"}set onDispose(N){this._onDisposeObserver&&this.pd.remove(this._onDisposeObserver),this._onDisposeObserver=this.pd.add(N)}get onEnabledStateChangedObservable(){return this._nodeDataStorage._onEnabledStateChangedObservable}get onClonedObservable(){return this._nodeDataStorage._onClonedObservable}constructor(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,d=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._isDirty=!1,this._nodeDataStorage=new j,this.state="",this.metadata=null,this.reservedDataStore=null,this._accessibilityTag=null,this.onAccessibilityTagChangedObservable=new z.d,this._parentContainer=null,this.animations=[],this._ranges={},this.onReady=null,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._waitingParentInstanceIndex=null,this._waitingParsedUniqueId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=I.c.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._animationPropertiesOverride=null,this._isNode=!0,this.pd=new z.d,this._onDisposeObserver=null,this._behaviors=new Array,this.name=N,this.id=N,this._scene=Z||w.e.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache(),d&&this._addToSceneRootNodes()}va(){return this._scene}getEngine(){return this._scene.getEngine()}addBehavior(N){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return-1!==this._behaviors.indexOf(N)||(N.init(),this._scene.isLoading&&!Z?this._scene.onDataLoadedObservable.addOnce((()=>{N.attach(this)})):N.attach(this),this._behaviors.push(N)),this}removeBehavior(N){const Z=this._behaviors.indexOf(N);return-1===Z||(this._behaviors[Z].detach(),this._behaviors.splice(Z,1)),this}get behaviors(){return this._behaviors}getBehaviorByName(N){for(const Z of this._behaviors)if(Z.name===N)return Z;return null}getWorldMatrix(){return this._currentRenderId!==this._scene.getRenderId()&&this.be(),this._worldMatrix}_getWorldMatrixDeterminant(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant}get worldMatrixFromCache(){return this._worldMatrix}_initCache(){this._cache={}}updateCache(N){!N&&this.isSynchronized()||this._updateCache()}_getActionManagerForTrigger(N){return this.parent?this.parent._getActionManagerForTrigger(N,!1):null}_updateCache(N){}_isSynchronized(){return!0}_markSyncedWithParent(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)}isSynchronizedWithParent(){return!this._parentNode||!this._parentNode._isDirty&&this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()}isSynchronized(){return!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()}isReady(){return this._nodeDataStorage._isReady}fe(N){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}isEnabled(){return!1===(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])?this._nodeDataStorage._isEnabled:!!this._nodeDataStorage._isEnabled&&this._nodeDataStorage._isParentEnabled}_syncParentEnabledState(){this._nodeDataStorage._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children&&this._children.forEach((N=>{N._syncParentEnabledState()}))}wg(N){this._nodeDataStorage._isEnabled!==N&&(this._nodeDataStorage._isEnabled=N,this._syncParentEnabledState(),this._nodeDataStorage._onEnabledStateChangedObservable.notifyObservers(N))}isDescendantOf(N){return!!this.parent&&(this.parent===N||this.parent.isDescendantOf(N))}_getDescendants(N){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],d=arguments.length>2?arguments[2]:void 0;if(this._children)for(let X=0;X<this._children.length;X++){const I=this._children[X];d&&!d(I)||N.push(I),Z||I._getDescendants(N,!1,d)}}getDescendants(N,Z){const d=[];return this._getDescendants(d,N,Z),d}getChildMeshes(N,Z){const d=[];return this._getDescendants(d,N,(N=>(!Z||Z(N))&&void 0!==N.se)),d}getChildren(N){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.getDescendants(Z,N)}_setReady(N){N!==this._nodeDataStorage._isReady&&(N?(this.onReady&&this.onReady(this),this._nodeDataStorage._isReady=!0):this._nodeDataStorage._isReady=!1)}getAnimationByName(N){for(let Z=0;Z<this.animations.length;Z++){const d=this.animations[Z];if(d.name===N)return d}return null}createAnimationRange(N,Z,d){if(!this._ranges[N]){this._ranges[N]=B._AnimationRangeFactory(N,Z,d);for(let X=0,I=this.animations.length;X<I;X++)this.animations[X]&&this.animations[X].createRange(N,Z,d)}}deleteAnimationRange(N){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let d=0,X=this.animations.length;d<X;d++)this.animations[d]&&this.animations[d].deleteRange(N,Z);this._ranges[N]=null}getAnimationRange(N){return this._ranges[N]||null}clone(N,Z,d){const X=e.c.Clone((()=>new B(N,this.va())),this);if(Z&&(X.parent=Z),!d){const Z=this.getDescendants(!0);for(let d=0;d<Z.length;d++){const I=Z[d];I.clone(N+"."+I.name,X)}}return X}getAnimationRanges(){const N=[];let Z;for(Z in this._ranges)N.push(this._ranges[Z]);return N}beginAnimation(N,Z,d,X){const I=this.getAnimationRange(N);return I?this._scene.beginAnimation(this,I.from,I.to,Z,d,X):null}serializeAnimationRanges(){const N=[];for(const Z in this._ranges){const d=this._ranges[Z];if(!d)continue;const X={};X.name=Z,X.from=d.from,X.to=d.to,N.push(X)}return N}be(N){return this._worldMatrix||(this._worldMatrix=I.c.Identity()),this._worldMatrix}dispose(N){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._nodeDataStorage._isDisposed=!0,!N){const d=this.getDescendants(!0);for(const X of d)X.dispose(N,Z)}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.pd.notifyObservers(this),this.pd.clear(),this.onEnabledStateChangedObservable.clear(),this.onClonedObservable.clear();for(const d of this._behaviors)d.detach();this._behaviors.length=0,this.metadata=null}static ParseAnimationRanges(N,Z,d){if(Z.ranges)for(let X=0;X<Z.ranges.length;X++){const d=Z.ranges[X];N.createAnimationRange(d.name,d.from,d.to)}}getHierarchyBoundingVectors(){let N,Z,d=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.va().incrementRenderId(),this.be(!0);const m=this;if(m.getBoundingInfo&&m.Sd){const d=m.getBoundingInfo();N=d.boundingBox.minimumWorld.clone(),Z=d.boundingBox.maximumWorld.clone()}else N=new I.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),Z=new I.n(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(d){const d=this.getDescendants(!1);for(const m of d){const d=m;if(d.be(!0),X&&!X(d))continue;if(!d.getBoundingInfo||0===d.getTotalVertices())continue;const z=d.getBoundingInfo().boundingBox,w=z.minimumWorld,S=z.maximumWorld;I.n.CheckExtends(w,N,Z),I.n.CheckExtends(S,N,Z)}}return{min:N,max:Z}}}B._AnimationRangeFactory=(N,Z,d)=>{throw(0,S.b)("AnimationRange")},B._NodeConstructors={},(0,X.d)([(0,m.I)()],B.prototype,"name",void 0),(0,X.d)([(0,m.I)()],B.prototype,"id",void 0),(0,X.d)([(0,m.I)()],B.prototype,"uniqueId",void 0),(0,X.d)([(0,m.I)()],B.prototype,"state",void 0),(0,X.d)([(0,m.I)()],B.prototype,"metadata",void 0)},11682:(N,Z,d)=>{"use strict";class X{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((N,Z)=>{this._resolve=N,this._reject=Z}))}}var I=d(960),m=d(1108),z=d(1133),w=d(11335),S=d(11684),e=d(11709),j=d(958),B=d(11474),D=d(11715),v=d(11723),T=d(986),k=d(1051),h=d(1135);class U{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(N){this._useTextureToStoreBoneMatrices=N,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(N){this._animationPropertiesOverride=N}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(N,Z,d){this.name=N,this.id=Z,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=I.c.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new j.d,this.bones=[],this._scene=d||T.e.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const X=this._scene.getEngine().getCaps();this._canUseTextureForBones=X.textureFloat&&X.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((N=>!N.getParent()))}getTransformMatrices(N){if(this.needInitialSkinMatrix){if(!N)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return N._bonesTransformMatrices||this.prepare(!0),N._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(N){return this.needInitialSkinMatrix&&N._transformMatrixTexture?N._transformMatrixTexture:this._transformMatrixTexture}va(){return this._scene}toString(N){let Z=`Name: ${this.name}, nBones: ${this.bones.length}`;if(Z+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,N){Z+=", Ranges: {";let N=!0;for(const d in this._ranges)N&&(Z+=", ",N=!1),Z+=d;Z+="}"}return Z}getBoneIndexByName(N){for(let Z=0,d=this.bones.length;Z<d;Z++)if(this.bones[Z].name===N)return Z;return-1}createAnimationRange(N,Z,d){if(!this._ranges[N]){this._ranges[N]=new v.d(N,Z,d);for(let X=0,I=this.bones.length;X<I;X++)this.bones[X].animations[0]&&this.bones[X].animations[0].createRange(N,Z,d)}}deleteAnimationRange(N){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let d=0,X=this.bones.length;d<X;d++)this.bones[d].animations[0]&&this.bones[d].animations[0].deleteRange(N,Z);this._ranges[N]=null}getAnimationRange(N){return this._ranges[N]||null}getAnimationRanges(){const N=[];let Z;for(Z in this._ranges)N.push(this._ranges[Z]);return N}copyAnimationRange(N,Z){let d=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[Z]||!N.getAnimationRange(Z))return!1;let X=!0;const I=this._getHighestAnimationFrame()+1,m={},z=N.bones;let w,S;for(S=0,w=z.length;S<w;S++)m[z[S].name]=z[S];this.bones.length!==z.length&&(k.e.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${z.length}`),X=!1);const e=d&&this.dimensionsAtRest&&N.dimensionsAtRest?this.dimensionsAtRest.divide(N.dimensionsAtRest):null;for(S=0,w=this.bones.length;S<w;S++){const N=this.bones[S].name,z=m[N];z?X=X&&this.bones[S].copyAnimationRange(z,Z,I,d,e):(k.e.Warn("copyAnimationRange: not same rig, missing source bone "+N),X=!1)}const j=N.getAnimationRange(Z);return j&&(this._ranges[Z]=new v.d(Z,j.from+I,j.to+I)),X}returnToRest(){for(const N of this.bones)-1!==N._index&&N.returnToRest()}_getHighestAnimationFrame(){let N=0;for(let Z=0,d=this.bones.length;Z<d;Z++)if(this.bones[Z].animations[0]){const d=this.bones[Z].animations[0].getHighestFrame();N<d&&(N=d)}return N}beginAnimation(N,Z,d,X){const I=this.getAnimationRange(N);return I?this._scene.beginAnimation(this,I.from,I.to,Z,d,X):null}static MakeAnimationAdditive(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,d=arguments.length>2?arguments[2]:void 0;const X=N.getAnimationRange(d);if(!X)return null;const I=N._scene.getAllAnimatablesByTarget(N);let m=null;for(let w=0;w<I.length;w++){const N=I[w];if(N.fromFrame===(null===X||void 0===X?void 0:X.from)&&N.toFrame===(null===X||void 0===X?void 0:X.to)){m=N;break}}const z=N.getAnimatables();for(let w=0;w<z.length;w++){const N=z[w].animations;if(N)for(let X=0;X<N.length;X++)D.b.MakeAnimationAdditive(N[X],Z,d)}return m&&(m.isAdditive=!0),N}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(N){this._meshesWithPoseMatrix.push(N)}_unregisterMeshWithPoseMatrix(N){const Z=this._meshesWithPoseMatrix.indexOf(N);Z>-1&&this._meshesWithPoseMatrix.splice(Z,1)}_computeTransformMatrices(N,Z){this.onBeforeComputeObservable.notifyObservers(this);for(let d=0;d<this.bones.length;d++){const X=this.bones[d];X._childUpdateId++;const I=X.getParent();if(I?X.getLocalMatrix().multiplyToRef(I.getFinalMatrix(),X.getFinalMatrix()):Z?X.getLocalMatrix().multiplyToRef(Z,X.getFinalMatrix()):X.getFinalMatrix().p(X.getLocalMatrix()),-1!==X._index){const Z=null===X._index?d:X._index;X.getAbsoluteInverseBindMatrix().multiplyToArray(X.getFinalMatrix(),N,16*Z)}}this._identity.copyToArray(N,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const N=this.va().getRenderId();if(this._currentRenderId===N)return;this._currentRenderId=N}if(this._numBonesWithLinkedTransformNode>0)for(const N of this.bones)if(N._linkedTransformNode){const Z=N._linkedTransformNode;N.position=Z.position,Z.rotationQuaternion?N.rotationQuaternion=Z.rotationQuaternion:N.rotation=Z.rotation,N.od=Z.od}if(this.needInitialSkinMatrix)for(const N of this._meshesWithPoseMatrix){const Z=N.getPoseMatrix();let d=this._isDirty;if(N._bonesTransformMatrices&&N._bonesTransformMatrices.length===16*(this.bones.length+1)||(N._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),d=!0),d){if(this._synchronizedWithMesh!==N){this._synchronizedWithMesh=N;for(const N of this.bones)if(!N.getParent()){N.getBindMatrix().multiplyToRef(Z,I.h.Matrix[1]),N._updateAbsoluteBindMatrices(I.h.Matrix[1])}if(this.isUsingTextureForMatrices){const Z=4*(this.bones.length+1);N._transformMatrixTexture&&N._transformMatrixTexture.getSize().width===Z||(N._transformMatrixTexture&&N._transformMatrixTexture.dispose(),N._transformMatrixTexture=B.e.CreateRGBATexture(N._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(N._bonesTransformMatrices,Z),this.isUsingTextureForMatrices&&N._transformMatrixTexture&&N._transformMatrixTexture.update(N._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=B.e.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let N=0;N<this.bones.length;N++)this._animatables.push(this.bones[N])}return this._animatables}clone(N,Z){const d=new U(N,Z||N,this._scene);d.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let X=0;X<this.bones.length;X++){const N=this.bones[X];let Z=null;const I=N.getParent();if(I){const N=this.bones.indexOf(I);Z=d.bones[N]}const m=new e.c(N.name,d,Z,N.getBindMatrix().clone(),N.getRestMatrix().clone());m._index=N._index,N._linkedTransformNode&&m.linkTransformNode(N._linkedTransformNode),h.b.DeepCopy(N.animations,m.animations)}if(this._ranges){d._ranges={};for(const N in this._ranges){const Z=this._ranges[N];Z&&(d._ranges[N]=Z.clone())}}return this._isDirty=!0,d.prepare(!0),d}enableBlending(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;this.bones.forEach((Z=>{Z.animations.forEach((Z=>{Z.enableBlending=!0,Z.blendingSpeed=N}))}))}dispose(){if(this._meshesWithPoseMatrix.length=0,this.va().stopAnimation(this),this.va().removeSkeleton(this),this._parentContainer){const N=this._parentContainer.skeletons.indexOf(this);N>-1&&this._parentContainer.skeletons.splice(N,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const N={};N.name=this.name,N.id=this.id,this.dimensionsAtRest&&(N.dimensionsAtRest=this.dimensionsAtRest.ed()),N.bones=[],N.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let d=0;d<this.bones.length;d++){var Z;const X=this.bones[d],I=X.getParent(),m={parentBoneIndex:I?this.bones.indexOf(I):-1,index:X.getIndex(),name:X.name,id:X.id,matrix:X.getBindMatrix().ed(),rest:X.getRestMatrix().ed(),linkedTransformNodeId:null===(Z=X.getTransformNode())||void 0===Z?void 0:Z.id};N.bones.push(m),X.length&&(m.length=X.length),X.metadata&&(m.metadata=X.metadata),X.animations&&X.animations.length>0&&(m.animation=X.animations[0].serialize()),N.ranges=[];for(const Z in this._ranges){const d=this._ranges[Z];if(!d)continue;const X={};X.name=Z,X.from=d.from,X.to=d.to,N.ranges.push(X)}}return N}static Parse(N,Z){const d=new U(N.name,N.id,Z);let X;for(N.dimensionsAtRest&&(d.dimensionsAtRest=I.n._c(N.dimensionsAtRest)),d.needInitialSkinMatrix=N.needInitialSkinMatrix,X=0;X<N.bones.length;X++){const Z=N.bones[X],m=N.bones[X].index;let z=null;Z.parentBoneIndex>-1&&(z=d.bones[Z.parentBoneIndex]);const w=Z.rest?I.c._c(Z.rest):null,S=new e.c(Z.name,d,z,I.c._c(Z.matrix),w,null,m);void 0!==Z.id&&null!==Z.id&&(S.id=Z.id),Z.length&&(S.length=Z.length),Z.metadata&&(S.metadata=Z.metadata),Z.animation&&S.animations.push(D.b.Parse(Z.animation)),void 0!==Z.linkedTransformNodeId&&null!==Z.linkedTransformNodeId&&(d._hasWaitingData=!0,S._waitingTransformNodeId=Z.linkedTransformNodeId)}if(N.ranges)for(X=0;X<N.ranges.length;X++){const Z=N.ranges[X];d.createAnimationRange(Z.name,Z.from,Z.to)}return d}computeAbsoluteMatrices(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||N)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(N)}getPoseMatrix(){let N=null;return this._meshesWithPoseMatrix.length>0&&(N=this._meshesWithPoseMatrix[0].getPoseMatrix()),N}sortBones(){const N=[],Z=new Array(this.bones.length);for(let d=0;d<this.bones.length;d++)this._sortBones(d,N,Z);this.bones=N}_sortBones(N,Z,d){if(d[N])return;d[N]=!0;const X=this.bones[N];if(!X)return;void 0===X._index&&(X._index=N);const I=X.getParent();I&&this._sortBones(this.bones.indexOf(I),Z,d),Z.push(X)}setCurrentPoseAsRest(){this.bones.forEach((N=>{N.setCurrentPoseAsRest()}))}}var C=d(1249),M=d(942),Q=d(949),A=d(11728),n=d(11733),g=d(978),E=d(1094);class V extends n.b{get refractionTexture(){return this.subSurface.refractionTexture}set refractionTexture(N){this.subSurface.refractionTexture=N,N?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)}get indexOfRefraction(){return this.subSurface.indexOfRefraction}set indexOfRefraction(N){this.subSurface.indexOfRefraction=N}get invertRefractionY(){return this.subSurface.invertRefractionY}set invertRefractionY(N){this.subSurface.invertRefractionY=N}get linkRefractionWithTransparency(){return this.subSurface.linkRefractionWithTransparency}set linkRefractionWithTransparency(N){this.subSurface.linkRefractionWithTransparency=N,N&&(this.subSurface.isRefractionEnabled=!0)}get usePhysicalLightFalloff(){return this._lightFalloff===n.b.LIGHTFALLOFF_PHYSICAL}set usePhysicalLightFalloff(N){N!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=N?n.b.LIGHTFALLOFF_PHYSICAL:n.b.LIGHTFALLOFF_STANDARD)}get useGLTFLightFalloff(){return this._lightFalloff===n.b.LIGHTFALLOFF_GLTF}set useGLTFLightFalloff(N){N!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=N?n.b.LIGHTFALLOFF_GLTF:n.b.LIGHTFALLOFF_STANDARD)}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(N){this._attachImageProcessingConfiguration(N),this._markAllSubMeshesAsTexturesDirty()}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(N){this.imageProcessingConfiguration.colorCurvesEnabled=N}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(N){this.imageProcessingConfiguration.colorGradingEnabled=N}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(N){this._imageProcessingConfiguration.toneMappingEnabled=N}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(N){this._imageProcessingConfiguration.exposure=N}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(N){this._imageProcessingConfiguration.contrast=N}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(N){this._imageProcessingConfiguration.colorGradingTexture=N}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(N){this._imageProcessingConfiguration.colorCurves=N}constructor(N,Z){super(N,Z,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.directIntensity=1,this.emissiveIntensity=1,this.environmentIntensity=1,this.specularIntensity=1,this.disableBumpMap=!1,this.ambientTextureStrength=1,this.ambientTextureImpactOnAnalyticalLights=V.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this.metallicF0Factor=1,this.metallicReflectanceColor=m.b.White(),this.useOnlyMetallicFromMetallicReflectanceTexture=!1,this.ambientColor=new m.b(0,0,0),this.albedoColor=new m.b(1,1,1),this.reflectivityColor=new m.b(1,1,1),this.reflectionColor=new m.b(1,1,1),this.emissiveColor=new m.b(0,0,0),this.microSurface=1,this.useLightmapAsShadowmap=!1,this.useAlphaFromAlbedoTexture=!1,this.forceAlphaTest=!1,this.alphaCutOff=.4,this.useSpecularOverAlpha=!0,this.useMicroSurfaceFromReflectivityMapAlpha=!1,this.useRoughnessFromMetallicTextureAlpha=!0,this.useRoughnessFromMetallicTextureGreen=!1,this.useMetallnessFromMetallicTextureBlue=!1,this.useAmbientOcclusionFromMetallicTextureRed=!1,this.useAmbientInGrayScale=!1,this.useAutoMicroSurfaceFromReflectivityMap=!1,this.useRadianceOverAlpha=!0,this.useObjectSpaceNormalMap=!1,this.useParallax=!1,this.useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this.disableLighting=!1,this.forceIrradianceInFragment=!1,this.maxSimultaneousLights=4,this.invertNormalMapX=!1,this.invertNormalMapY=!1,this.twoSidedLighting=!1,this.useAlphaFresnel=!1,this.useLinearAlphaFresnel=!1,this.environmentBRDFTexture=null,this.forceNormalForward=!1,this.enableSpecularAntiAliasing=!1,this.useHorizonOcclusion=!0,this.useRadianceOcclusion=!0,this.unlit=!1,this.applyDecalMapAfterDetailMap=!1,this._environmentBRDFTexture=(0,A.b)(this.va())}getClassName(){return"PBRMaterial"}clone(N){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const X=E.c.Clone((()=>new V(N,this.va())),this,{cloneTexturesOnlyOnce:Z});return X.id=N,X.name=N,this.stencil.copyTo(X.stencil),this._clonePlugins(X,d),X}serialize(){const N=super.serialize();return N.customType="BABYLON.PBRMaterial",N}static Parse(N,Z,d){const X=E.c.Parse((()=>new V(N.name,Z)),N,Z,d);return N.stencil&&X.stencil.parse(N.stencil,Z,d),C.e._ParsePlugins(N,X,Z,d),N.clearCoat&&X.clearCoat.parse(N.clearCoat,Z,d),N.anisotropy&&X.anisotropy.parse(N.anisotropy,Z,d),N.brdf&&X.brdf.parse(N.brdf,Z,d),N.sheen&&X.sheen.parse(N.sheen,Z,d),N.subSurface&&X.subSurface.parse(N.subSurface,Z,d),N.iridescence&&X.iridescence.parse(N.iridescence,Z,d),X}}V.PBRMATERIAL_OPAQUE=n.b.PBRMATERIAL_OPAQUE,V.PBRMATERIAL_ALPHATEST=n.b.PBRMATERIAL_ALPHATEST,V.PBRMATERIAL_ALPHABLEND=n.b.PBRMATERIAL_ALPHABLEND,V.PBRMATERIAL_ALPHATESTANDBLEND=n.b.PBRMATERIAL_ALPHATESTANDBLEND,V.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=n.b.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,(0,M.d)([(0,Q.I)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"directIntensity",void 0),(0,M.d)([(0,Q.I)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"emissiveIntensity",void 0),(0,M.d)([(0,Q.I)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"environmentIntensity",void 0),(0,M.d)([(0,Q.I)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"specularIntensity",void 0),(0,M.d)([(0,Q.I)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"disableBumpMap",void 0),(0,M.d)([(0,Q.A)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"albedoTexture",void 0),(0,M.d)([(0,Q.A)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"ambientTexture",void 0),(0,M.d)([(0,Q.I)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"ambientTextureStrength",void 0),(0,M.d)([(0,Q.I)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),(0,M.d)([(0,Q.A)(),(0,Q.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],V.prototype,"opacityTexture",void 0),(0,M.d)([(0,Q.A)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"reflectionTexture",void 0),(0,M.d)([(0,Q.A)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"emissiveTexture",void 0),(0,M.d)([(0,Q.A)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"reflectivityTexture",void 0),(0,M.d)([(0,Q.A)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"metallicTexture",void 0),(0,M.d)([(0,Q.I)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"metallic",void 0),(0,M.d)([(0,Q.I)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"roughness",void 0),(0,M.d)([(0,Q.I)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"metallicF0Factor",void 0),(0,M.d)([(0,Q.m)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"metallicReflectanceColor",void 0),(0,M.d)([(0,Q.I)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"useOnlyMetallicFromMetallicReflectanceTexture",void 0),(0,M.d)([(0,Q.A)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"metallicReflectanceTexture",void 0),(0,M.d)([(0,Q.A)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"reflectanceTexture",void 0),(0,M.d)([(0,Q.A)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"microSurfaceTexture",void 0),(0,M.d)([(0,Q.A)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"bumpTexture",void 0),(0,M.d)([(0,Q.A)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty",null)],V.prototype,"lightmapTexture",void 0),(0,M.d)([(0,Q.m)("ambient"),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"ambientColor",void 0),(0,M.d)([(0,Q.m)("albedo"),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"albedoColor",void 0),(0,M.d)([(0,Q.m)("reflectivity"),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"reflectivityColor",void 0),(0,M.d)([(0,Q.m)("reflection"),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"reflectionColor",void 0),(0,M.d)([(0,Q.m)("emissive"),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"emissiveColor",void 0),(0,M.d)([(0,Q.I)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"microSurface",void 0),(0,M.d)([(0,Q.I)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"useLightmapAsShadowmap",void 0),(0,M.d)([(0,Q.I)(),(0,Q.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],V.prototype,"useAlphaFromAlbedoTexture",void 0),(0,M.d)([(0,Q.I)(),(0,Q.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],V.prototype,"forceAlphaTest",void 0),(0,M.d)([(0,Q.I)(),(0,Q.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],V.prototype,"alphaCutOff",void 0),(0,M.d)([(0,Q.I)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"useSpecularOverAlpha",void 0),(0,M.d)([(0,Q.I)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),(0,M.d)([(0,Q.I)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),(0,M.d)([(0,Q.I)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"useRoughnessFromMetallicTextureGreen",void 0),(0,M.d)([(0,Q.I)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"useMetallnessFromMetallicTextureBlue",void 0),(0,M.d)([(0,Q.I)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),(0,M.d)([(0,Q.I)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"useAmbientInGrayScale",void 0),(0,M.d)([(0,Q.I)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),(0,M.d)([(0,Q.I)()],V.prototype,"usePhysicalLightFalloff",null),(0,M.d)([(0,Q.I)()],V.prototype,"useGLTFLightFalloff",null),(0,M.d)([(0,Q.I)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"useRadianceOverAlpha",void 0),(0,M.d)([(0,Q.I)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"useObjectSpaceNormalMap",void 0),(0,M.d)([(0,Q.I)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"useParallax",void 0),(0,M.d)([(0,Q.I)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"useParallaxOcclusion",void 0),(0,M.d)([(0,Q.I)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"parallaxScaleBias",void 0),(0,M.d)([(0,Q.I)(),(0,Q.b)("_markAllSubMeshesAsLightsDirty")],V.prototype,"disableLighting",void 0),(0,M.d)([(0,Q.I)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"forceIrradianceInFragment",void 0),(0,M.d)([(0,Q.I)(),(0,Q.b)("_markAllSubMeshesAsLightsDirty")],V.prototype,"maxSimultaneousLights",void 0),(0,M.d)([(0,Q.I)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"invertNormalMapX",void 0),(0,M.d)([(0,Q.I)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"invertNormalMapY",void 0),(0,M.d)([(0,Q.I)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"twoSidedLighting",void 0),(0,M.d)([(0,Q.I)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"useAlphaFresnel",void 0),(0,M.d)([(0,Q.I)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"useLinearAlphaFresnel",void 0),(0,M.d)([(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"environmentBRDFTexture",void 0),(0,M.d)([(0,Q.I)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"forceNormalForward",void 0),(0,M.d)([(0,Q.I)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"enableSpecularAntiAliasing",void 0),(0,M.d)([(0,Q.I)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"useHorizonOcclusion",void 0),(0,M.d)([(0,Q.I)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"useRadianceOcclusion",void 0),(0,M.d)([(0,Q.I)(),(0,Q.b)("_markAllSubMeshesAsMiscDirty")],V.prototype,"unlit",void 0),(0,M.d)([(0,Q.I)(),(0,Q.b)("_markAllSubMeshesAsMiscDirty")],V.prototype,"applyDecalMapAfterDetailMap",void 0),(0,g.h)("BABYLON.PBRMaterial",V);var O=d(938),K=d(11370),r=d(1169),P=d(11353),W=d(11366),b=d(11321);class J{get influence(){return this._influence}set influence(N){if(this._influence===N)return;const Z=this._influence;this._influence=N,this.onInfluenceChanged.hasObservers()&&this.onInfluenceChanged.notifyObservers(0===Z||0===N)}get animationPropertiesOverride(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride}set animationPropertiesOverride(N){this._animationPropertiesOverride=N}constructor(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.name=N,this.animations=[],this._positions=null,this._normals=null,this._tangents=null,this._uvs=null,this._uniqueId=0,this.onInfluenceChanged=new j.d,this._onDataLayoutChanged=new j.d,this._animationPropertiesOverride=null,this.id=N,this._scene=d||T.e.LastCreatedScene,this.influence=Z,this._scene&&(this._uniqueId=this._scene.getUniqueId())}get uniqueId(){return this._uniqueId}get hasPositions(){return!!this._positions}get hasNormals(){return!!this._normals}get hasTangents(){return!!this._tangents}get hasUVs(){return!!this._uvs}setPositions(N){const Z=this.hasPositions;this._positions=N,Z!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)}getPositions(){return this._positions}setNormals(N){const Z=this.hasNormals;this._normals=N,Z!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)}getNormals(){return this._normals}setTangents(N){const Z=this.hasTangents;this._tangents=N,Z!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)}getTangents(){return this._tangents}setUVs(N){const Z=this.hasUVs;this._uvs=N,Z!==this.hasUVs&&this._onDataLayoutChanged.notifyObservers(void 0)}getUVs(){return this._uvs}clone(){const N=E.c.Clone((()=>new J(this.name,this.influence,this._scene)),this);return N._positions=this._positions,N._normals=this._normals,N._tangents=this._tangents,N._uvs=this._uvs,N}serialize(){const N={};return N.name=this.name,N.influence=this.influence,N.xa=Array.prototype.slice.call(this.getPositions()),null!=this.id&&(N.id=this.id),this.hasNormals&&(N.ya=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(N.tangents=Array.prototype.slice.call(this.getTangents())),this.hasUVs&&(N.Aa=Array.prototype.slice.call(this.getUVs())),E.c.AppendSerializedAnimations(this,N),N}getClassName(){return"MorphTarget"}static Parse(N,Z){const d=new J(N.name,N.influence);if(d.setPositions(N.xa),null!=N.id&&(d.id=N.id),N.ya&&d.setNormals(N.ya),N.tangents&&d.setTangents(N.tangents),N.Aa&&d.setUVs(N.Aa),N.animations){for(let Z=0;Z<N.animations.length;Z++){const X=N.animations[Z],I=(0,g.d)("BABYLON.Animation");I&&d.animations.push(I.Parse(X))}N.autoAnimate&&Z&&Z.beginAnimation(d,N.autoAnimateFrom,N.autoAnimateTo,N.autoAnimateLoop,N.autoAnimateSpeed||1)}return d}static FromMesh(N,Z,d){Z||(Z=N.name);const X=new J(Z,d,N.va());return X.setPositions(N.getVerticesData(r.d.PositionKind)),N.isVerticesDataPresent(r.d.NormalKind)&&X.setNormals(N.getVerticesData(r.d.NormalKind)),N.isVerticesDataPresent(r.d.TangentKind)&&X.setTangents(N.getVerticesData(r.d.TangentKind)),N.isVerticesDataPresent(r.d.UVKind)&&X.setUVs(N.getVerticesData(r.d.UVKind)),X}}(0,M.d)([(0,Q.I)()],J.prototype,"id",void 0);var F=d(1125),G=d(1449);class x{set areUpdatesFrozen(N){N?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(!0)))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new F.h(16),this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,N||(N=T.e.LastCreatedScene),this._scene=N,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const N=this._scene.getEngine().getCaps();this._canUseTextureForTargets=N.canUseGLVertexID&&N.textureFloat&&N.maxVertexTextureImageUnits>0&&N.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return this._numMaxInfluencers}set numMaxInfluencers(N){this._numMaxInfluencers!==N&&(this._numMaxInfluencers=N,this._syncActiveTargets(!0))}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(N){this._useTextureToStoreTargets=N}get isUsingTextureForTargets(){var N;return x.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(N=this._scene)&&void 0!==N&&N.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(N){return this._activeTargets.data[N]}getTarget(N){return this._targets[N]}getTargetByName(N){for(const Z of this._targets)if(Z.name===N)return Z;return null}addTarget(N){this._targets.push(N),this._targetInfluenceChangedObservers.push(N.onInfluenceChanged.add((N=>{this._syncActiveTargets(N)}))),this._targetDataLayoutChangedObservers.push(N._onDataLayoutChanged.add((()=>{this._syncActiveTargets(!0)}))),this._syncActiveTargets(!0)}removeTarget(N){const Z=this._targets.indexOf(N);Z>=0&&(this._targets.splice(Z,1),N.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(Z,1)[0]),N._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(Z,1)[0]),this._syncActiveTargets(!0)),this._scene&&this._scene.stopAnimation(N)}_bind(N){N.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),N.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),N.setTexture("morphTargets",this._targetStoreTexture),N.setInt("morphTargetCount",this.numInfluencers)}clone(){const N=new x(this._scene);for(const Z of this._targets)N.addTarget(Z.clone());return N.enableNormalMorphing=this.enableNormalMorphing,N.enableTangentMorphing=this.enableTangentMorphing,N.enableUVMorphing=this.enableUVMorphing,N}serialize(){const N={};N.id=this.uniqueId,N.targets=[];for(const Z of this._targets)N.targets.push(Z.serialize());return N}_syncActiveTargets(N){if(this.areUpdatesFrozen)return;let Z=0;this._activeTargets.reset(),this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._vertexCount=0,this._scene&&this._targets.length>this._scene.getEngine().getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let d=-1;for(const X of this._targets){if(d++,0===X.influence&&this.optimizeInfluencers)continue;if(this._activeTargets.length>=x.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(X),this._morphTargetTextureIndices[Z]=d,this._tempInfluences[Z++]=X.influence,this._supportsNormals=this._supportsNormals&&X.hasNormals,this._supportsTangents=this._supportsTangents&&X.hasTangents,this._supportsUVs=this._supportsUVs&&X.hasUVs;const N=X.getPositions();if(N){const Z=N.length/3;if(0===this._vertexCount)this._vertexCount=Z;else if(this._vertexCount!==Z)return void k.e.Error("Incompatible target. Targets must all have the same vertices count.")}}this._morphTargetTextureIndices.length!==Z&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,Z)),this._influences&&this._influences.length===Z||(this._influences=new Float32Array(Z));for(let X=0;X<Z;X++)this._influences[X]=this._tempInfluences[X];N&&this.synchronize()}synchronize(){if(this._scene&&!this.areUpdatesFrozen){if(this.isUsingTextureForTargets&&(this._vertexCount||this.numMaxInfluencers>0)){this._textureVertexStride=1,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const N=this._scene.getEngine().getCaps().maxTextureSize;this._textureWidth>N&&(this._textureHeight=Math.ceil(this._textureWidth/N),this._textureWidth=N);let Z=!0;if(this._targetStoreTexture){const N=this._targetStoreTexture.getSize();N.width===this._textureWidth&&N.height===this._textureHeight&&this._targetStoreTexture.depth===this._targets.length&&(Z=!1)}if(Z){this._targetStoreTexture&&this._targetStoreTexture.dispose();const N=this._targets.length,Z=new Float32Array(N*this._textureWidth*this._textureHeight*4);let d=0;for(let X=0;X<N;X++){const N=this._targets[X],I=N.getPositions(),m=N.getNormals(),z=N.getUVs(),w=N.getTangents();if(!I)return void(0===X&&k.e.Error("Invalid morph target. Target must have positions."));d=X*this._textureWidth*this._textureHeight*4;for(let X=0;X<this._vertexCount;X++)Z[d]=I[3*X],Z[d+1]=I[3*X+1],Z[d+2]=I[3*X+2],d+=4,this._supportsNormals&&m&&(Z[d]=m[3*X],Z[d+1]=m[3*X+1],Z[d+2]=m[3*X+2],d+=4),this._supportsUVs&&z&&(Z[d]=z[2*X],Z[d+1]=z[2*X+1],d+=4),this._supportsTangents&&w&&(Z[d]=w[3*X],Z[d+1]=w[3*X+1],Z[d+2]=w[3*X+2],d+=4)}this._targetStoreTexture=G.d.CreateRGBATexture(Z,this._textureWidth,this._textureHeight,N,this._scene,!1,!1,1,1)}}for(const N of this._scene.meshes)N.morphTargetManager===this&&N._syncGeometryWithMorphTargetManager()}}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const N=this._parentContainer.morphTargetManagers.indexOf(this);N>-1&&this._parentContainer.morphTargetManagers.splice(N,1),this._parentContainer=null}for(const N of this._targets)this._scene.stopAnimation(N)}}static Parse(N,Z){const d=new x(Z);for(const X of N.targets)d.addTarget(J.Parse(X,Z));return d}}x.EnableTextureStorage=!0,x.MaxActiveMorphTargetsInVertexAttributeMode=8;var t=d(11740),q=d(1008),Y=d(1264);function s(N,Z,d,X){return I.n._c(Z,d).scaleInPlace(X)}class L{constructor(N,Z,d,X){this.type=N,this.name=Z,this.getValue=d,this.getStride=X}_buildAnimation(N,Z,d){const X=new D.b(N,this.name,Z,this.type);return X.setKeys(d),X}}class H extends L{buildAnimations(N,Z,d,X,I){I(N._babylonTransformNode,this._buildAnimation(Z,d,X))}}const i={translation:[new H(D.b.ANIMATIONTYPE_VECTOR3,"position",s,(()=>3))],rotation:[new H(D.b.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",(function(N,Z,d,X){return I.g._c(Z,d).scaleInPlace(X)}),(()=>4))],scale:[new H(D.b.ANIMATIONTYPE_VECTOR3,"od",s,(()=>3))],weights:[new class extends L{buildAnimations(N,Z,d,X,I){if(N._numMorphTargets)for(let m=0;m<N._numMorphTargets;m++){const z=new D.b(`${Z}_${m}`,this.name,d,this.type);if(z.setKeys(X.map((N=>({frame:N.frame,inTangent:N.inTangent?N.inTangent[m]:void 0,value:N.value[m],outTangent:N.outTangent?N.outTangent[m]:void 0,interpolation:N.interpolation})))),N._primitiveBabylonMeshes)for(const Z of N._primitiveBabylonMeshes)if(Z.morphTargetManager){const N=Z.morphTargetManager.getTarget(m),d=z.clone();N.animations.push(d),I(N,d)}}}}(D.b.ANIMATIONTYPE_FLOAT,"influence",(function(N,Z,d,X){const I=new Array(N._numMorphTargets);for(let m=0;m<I.length;m++)I[m]=Z[d++]*X;return I}),(N=>N._numMorphTargets))]},p=new Map,y=p;function l(N,Z,d){u(N)&&k.e.Warn(`Extension with the name '${N}' already exists`),p.set(N,{isGLTFExtension:Z,factory:d})}function u(N){return p.delete(N)}function a(){const N=N=>N&&"object"===typeof N;for(var Z=arguments.length,d=new Array(Z),X=0;X<Z;X++)d[X]=arguments[X];return d.reduce(((Z,d)=>(Object.keys(d).forEach((X=>{const I=Z[X],m=d[X];Array.isArray(I)&&Array.isArray(m)?Z[X]=I.concat(...m):N(I)&&N(m)?Z[X]=a(I,m):Z[X]=m})),Z)),{})}class c{static Get(N,Z,d){if(!Z||void 0==d||!Z[d])throw new Error(`${N}: Failed to find index (${d})`);return Z[d]}static TryGet(N,Z){return N&&void 0!=Z&&N[Z]?N[Z]:null}static Assign(N){if(N)for(let Z=0;Z<N.length;Z++)N[Z].index=Z}}class R{static RegisterExtension(N,Z){l(N,!1,Z)}static UnregisterExtension(N){return u(N)}get bj(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(N){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=N}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((N=>N.dispose&&N.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}importMeshAsync(N,Z,d,X,I,m){let z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return Promise.resolve().then((()=>{this._babylonScene=Z,this._assetContainer=d,this._loadData(X);let m=null;if(N){const Z={};if(this._gltf.nodes)for(const N of this._gltf.nodes)N.name&&(Z[N.name]=N.index);m=(N instanceof Array?N:[N]).map((N=>{const d=Z[N];if(void 0===d)throw new Error(`Failed to find node '${N}'`);return d}))}return this._loadAsync(I,z,m,(()=>({meshes:this._getMeshes(),Od:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}loadAsync(N,Z,d,X){let I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return Promise.resolve().then((()=>(this._babylonScene=N,this._loadData(Z),this._loadAsync(d,I,null,(()=>{})))))}_loadAsync(N,Z,d,X){return Promise.resolve().then((async()=>{this._rootUrl=N,this._uniqueRootUrl=!N.startsWith("file:")&&Z?N:`${N}${Date.now()}/`,this._fileName=Z,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const I=`${t.l[t.l.LOADING]} => ${t.l[t.l.READY]}`,m=`${t.l[t.l.LOADING]} => ${t.l[t.l.COMPLETE]}`;this._parent._startPerformanceCounter(I),this._parent._startPerformanceCounter(m),this._parent._setState(t.l.LOADING),this._extensionsOnLoading();const w=new Array;if(!this.parent.loadOnlyMaterials)if(d)w.push(this.loadSceneAsync("/nodes",{nodes:d,index:-1}));else if(void 0!=this._gltf.Td||this._gltf.scenes&&this._gltf.scenes[0]){const N=c.Get("/scene",this._gltf.scenes,this._gltf.Td||0);w.push(this.loadSceneAsync(`/scenes/${N.index}`,N))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let N=0;N<this._gltf.materials.length;++N){const Z=this._gltf.materials[N],d="/materials/"+N,X=C.e.TriangleFillMode;w.push(this._loadMaterialAsync(d,Z,null,X,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&w.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&w.push(this._compileShadowGeneratorsAsync());return Promise.all(w).then((()=>(this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.wg(!0),this._extensionsOnReady(),this._parent._setState(t.l.READY),this._startAnimations(),X()))).then((N=>(this._parent._endPerformanceCounter(I),z.g.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(m),this._parent._setState(t.l.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(N=>{this._parent.onErrorObservable.notifyObservers(N),this._parent.onErrorObservable.clear(),this.dispose()}))})),N)))})).catch((N=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(N),this._parent.onErrorObservable.clear(),this.dispose()),N}))}_loadData(N){if(this._gltf=N.json,this._setupData(),N.bin){const Z=this._gltf.buffers;if(Z&&Z[0]&&!Z[0].uri){const d=Z[0];(d.byteLength<N.bin.byteLength-3||d.byteLength>N.bin.byteLength)&&k.e.Warn(`Binary buffer length (${d.byteLength}) from JSON does not match chunk length (${N.bin.byteLength})`),this._bin=N.bin}else k.e.Warn("Unexpected BIN chunk")}}_setupData(){if(c.Assign(this._gltf.accessors),c.Assign(this._gltf.animations),c.Assign(this._gltf.buffers),c.Assign(this._gltf.bufferViews),c.Assign(this._gltf.cameras),c.Assign(this._gltf.images),c.Assign(this._gltf.materials),c.Assign(this._gltf.meshes),c.Assign(this._gltf.nodes),c.Assign(this._gltf.samplers),c.Assign(this._gltf.scenes),c.Assign(this._gltf.skins),c.Assign(this._gltf.textures),this._gltf.nodes){const N={};for(const d of this._gltf.nodes)if(d.children)for(const Z of d.children)N[Z]=d.index;const Z=this._createRootNode();for(const d of this._gltf.nodes){const X=N[d.index];d.parent=void 0===X?Z:this._gltf.nodes[X]}}}async _loadExtensionsAsync(){const N=[];if(y.forEach(((Z,d)=>{var X;!1===(null===(X=this.parent.extensionOptions[d])||void 0===X?void 0:X.enabled)?Z.isGLTFExtension&&this.isExtensionUsed(d)&&k.e.Warn(`Extension ${d} is used but has been explicitly disabled.`):Z.isGLTFExtension&&!this.isExtensionUsed(d)||N.push((async()=>{const N=await Z.factory(this);return N.name!==d&&k.e.Warn(`The name of the glTF loader extension instance does not match the registered name: ${N.name} !== ${d}`),this._parent.onExtensionLoadedObservable.notifyObservers(N),N})())})),this._extensions.push(...await Promise.all(N)),this._extensions.sort(((N,Z)=>(N.order||Number.MAX_VALUE)-(Z.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const d of this._gltf.extensionsRequired){if(!this._extensions.some((N=>N.name===d&&N.enabled))){var Z;if(!1===(null===(Z=this.parent.extensionOptions[d])||void 0===Z?void 0:Z.enabled))throw new Error(`Required extension ${d} is disabled`);throw new Error(`Required extension ${d} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const N=new b.b("__root__",this._babylonScene);this._rootBabylonMesh=N,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.wg(!1);const Z={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case t.i.AUTO:this._babylonScene.useRightHandedSystem||(Z.rotation=[0,1,0,0],Z.scale=[1,1,-1],R._LoadTransform(Z,this._rootBabylonMesh));break;case t.i.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(N),Z}loadSceneAsync(N,Z){const d=this._extensionsLoadSceneAsync(N,Z);if(d)return d;const X=new Array;if(this.logOpen(`${N} ${Z.name||""}`),Z.nodes)for(const I of Z.nodes){const Z=c.Get(`${N}/nodes/${I}`,this._gltf.nodes,I);X.push(this.loadNodeAsync(`/nodes/${Z.index}`,Z,(N=>{N.parent=this._rootBabylonMesh})))}for(const I of this._postSceneLoadActions)I();return X.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(X).then((()=>{}))}_forEachPrimitive(N,Z){if(N._primitiveBabylonMeshes)for(const d of N._primitiveBabylonMeshes)Z(d)}_getGeometries(){const N=[],Z=this._gltf.nodes;if(Z)for(const d of Z)this._forEachPrimitive(d,(Z=>{const d=Z.de;d&&-1===N.indexOf(d)&&N.push(d)}));return N}_getMeshes(){const N=[];this._rootBabylonMesh instanceof W.b&&N.push(this._rootBabylonMesh);const Z=this._gltf.nodes;if(Z)for(const d of Z)this._forEachPrimitive(d,(Z=>{N.push(Z)}));return N}_getTransformNodes(){const N=[],Z=this._gltf.nodes;if(Z)for(const d of Z)d._babylonTransformNode&&"ob"===d._babylonTransformNode.getClassName()&&N.push(d._babylonTransformNode),d._babylonTransformNodeForSkin&&N.push(d._babylonTransformNodeForSkin);return N}_getSkeletons(){const N=[],Z=this._gltf.skins;if(Z)for(const d of Z)d._data&&N.push(d._data.babylonSkeleton);return N}_getAnimationGroups(){const N=[],Z=this._gltf.animations;if(Z)for(const d of Z)d._babylonAnimationGroup&&N.push(d._babylonAnimationGroup);return N}_startAnimations(){switch(this._parent.animationStartMode){case t.h.NONE:break;case t.h.FIRST:{const N=this._getAnimationGroups();0!==N.length&&N[0].start(!0);break}case t.h.ALL:{const N=this._getAnimationGroups();for(const Z of N)Z.start(!0);break}default:return void k.e.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(N,Z){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const X=this._extensionsLoadNodeAsync(N,Z,d);if(X)return X;if(Z._babylonTransformNode)throw new Error(`${N}: Invalid recursive node hierarchy`);const I=new Array;this.logOpen(`${N} ${Z.name||""}`);const m=X=>{if(R.AddPointerMetadata(X,N),R._LoadTransform(Z,X),void 0!=Z.camera){const d=c.Get(`${N}/camera`,this._gltf.cameras,Z.camera);I.push(this.loadCameraAsync(`/cameras/${d.index}`,d,(N=>{N.parent=X})))}if(Z.children)for(const d of Z.children){const Z=c.Get(`${N}/children/${d}`,this._gltf.nodes,d);I.push(this.loadNodeAsync(`/nodes/${Z.index}`,Z,(N=>{N.parent=X})))}d(X)},z=void 0!=Z.mesh,w=this._parent.loadSkins&&void 0!=Z.skin;if(!z||w){const N=Z.name||`node${Z.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const d=new K.c(N,this._babylonScene);d._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==Z.mesh?Z._babylonTransformNode=d:Z._babylonTransformNodeForSkin=d,m(d)}if(z)if(w){const d=c.Get(`${N}/mesh`,this._gltf.meshes,Z.mesh);I.push(this._loadMeshAsync(`/meshes/${d.index}`,Z,d,(d=>{const X=Z._babylonTransformNodeForSkin;d.metadata=a(X.metadata,d.metadata||{});const m=c.Get(`${N}/skin`,this._gltf.skins,Z.skin);I.push(this._loadSkinAsync(`/skins/${m.index}`,Z,m,(N=>{this._forEachPrimitive(Z,(Z=>{Z.skeleton=N})),this._postSceneLoadActions.push((()=>{if(void 0!=m.skeleton){const N=c.Get(`/skins/${m.index}/skeleton`,this._gltf.nodes,m.skeleton).parent;Z.index===N.index?d.parent=X.parent:d.parent=N._babylonTransformNode}else d.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:X,skinnedNode:d})}))})))})))}else{const d=c.Get(`${N}/mesh`,this._gltf.meshes,Z.mesh);I.push(this._loadMeshAsync(`/meshes/${d.index}`,Z,d,m))}return this.logClose(),Promise.all(I).then((()=>(this._forEachPrimitive(Z,(N=>{N.de&&N.de.useBoundingInfoFromGeometry?N.Ea():N.refreshBoundingInfo(!0,!0)})),Z._babylonTransformNode)))}_loadMeshAsync(N,Z,d,X){const I=d.primitives;if(!I||!I.length)throw new Error(`${N}: Primitives are missing`);void 0==I[0].index&&c.Assign(I);const m=new Array;this.logOpen(`${N} ${d.name||""}`);const z=Z.name||`node${Z.index}`;if(1===I.length){const X=d.primitives[0];m.push(this._loadMeshPrimitiveAsync(`${N}/primitives/${X.index}`,z,Z,d,X,(N=>{Z._babylonTransformNode=N,Z._primitiveBabylonMeshes=[N]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,Z._babylonTransformNode=new K.c(z,this._babylonScene),Z._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,Z._primitiveBabylonMeshes=[];for(const X of I)m.push(this._loadMeshPrimitiveAsync(`${N}/primitives/${X.index}`,`${z}_primitive${X.index}`,Z,d,X,(N=>{N.parent=Z._babylonTransformNode,Z._primitiveBabylonMeshes.push(N)})))}return X(Z._babylonTransformNode),this.logClose(),Promise.all(m).then((()=>Z._babylonTransformNode))}_loadMeshPrimitiveAsync(N,Z,d,X,I,m){const z=this._extensionsLoadMeshPrimitiveAsync(N,Z,d,X,I,m);if(z)return z;this.logOpen(`${N}`);const w=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==d.skin&&!X.primitives[0].targets;let S,e;if(w&&I._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,S=I._instanceData.babylonSourceMesh.eb(Z),S._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,e=I._instanceData.promise;else{const m=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const z=new b.b(Z,this._babylonScene);z._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,z.sideOrientation=this._babylonScene.useRightHandedSystem?C.e.CounterClockWiseSideOrientation:C.e.ClockWiseSideOrientation,this._createMorphTargets(N,d,X,I,z),m.push(this._loadVertexDataAsync(N,I,z).then((Z=>this._loadMorphTargetsAsync(N,I,z,Z).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,Z.Ca(z),Z._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const j=R._GetDrawMode(N,I.mode);if(void 0==I.material){let N=this._defaultBabylonMaterialData[j];N||(N=this._createDefaultMaterial("__GLTFLoader._default",j),this._parent.onMaterialLoadedObservable.notifyObservers(N),this._defaultBabylonMaterialData[j]=N),z.material=N}else if(!this.parent.skipMaterials){const Z=c.Get(`${N}/material`,this._gltf.materials,I.material);m.push(this._loadMaterialAsync(`/materials/${Z.index}`,Z,z,j,(N=>{z.material=N})))}e=Promise.all(m),w&&(I._instanceData={babylonSourceMesh:z,promise:e}),S=z}return R.AddPointerMetadata(S,N),this._parent.onMeshLoadedObservable.notifyObservers(S),m(S),this.logClose(),e.then((()=>S))}_loadVertexDataAsync(N,Z,d){const X=this._extensionsLoadVertexDataAsync(N,Z,d);if(X)return X;const m=Z.attributes;if(!m)throw new Error(`${N}: Attributes are missing`);const z=new Array,w=new P.b(d.name,this._babylonScene);if(void 0==Z.indices)d.isUnIndexed=!0;else{const d=c.Get(`${N}/indices`,this._gltf.accessors,Z.indices);z.push(this._loadIndicesAccessorAsync(`/accessors/${d.index}`,d).then((N=>{w.setIndices(N)})))}const S=(Z,X,S)=>{if(void 0==m[Z])return;d._delayInfo=d._delayInfo||[],-1===d._delayInfo.indexOf(X)&&d._delayInfo.push(X);const e=c.Get(`${N}/attributes/${Z}`,this._gltf.accessors,m[Z]);z.push(this._loadVertexAccessorAsync(`/accessors/${e.index}`,e,X).then((N=>{if(N.getKind()===r.d.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!d.skeleton&&e.min&&e.max){const N=I.h.kd[0].fd(...e.min),Z=I.h.kd[1].fd(...e.max);if(e.normalized&&5126!==e.componentType){let d=1;switch(e.componentType){case 5120:d=127;break;case 5121:d=255;break;case 5122:d=32767;break;case 5123:d=65535}const X=1/d;N.scaleInPlace(X),Z.scaleInPlace(X)}w._boundingInfo=new Y.e(N,Z),w.useBoundingInfoFromGeometry=!0}w.setVerticesBuffer(N,e.count)}))),X==r.d.MatricesIndicesExtraKind&&(d.numBoneInfluencers=8),S&&S(e)};return S("POSITION",r.d.PositionKind),S("NORMAL",r.d.NormalKind),S("TANGENT",r.d.TangentKind),S("TEXCOORD_0",r.d.UVKind),S("TEXCOORD_1",r.d.UV2Kind),S("TEXCOORD_2",r.d.UV3Kind),S("TEXCOORD_3",r.d.UV4Kind),S("TEXCOORD_4",r.d.UV5Kind),S("TEXCOORD_5",r.d.UV6Kind),S("JOINTS_0",r.d.MatricesIndicesKind),S("WEIGHTS_0",r.d.MatricesWeightsKind),S("JOINTS_1",r.d.MatricesIndicesExtraKind),S("WEIGHTS_1",r.d.MatricesWeightsExtraKind),S("COLOR_0",r.d.ColorKind,(N=>{"VEC4"===N.type&&(d.hasVertexAlpha=!0)})),Promise.all(z).then((()=>w))}_createMorphTargets(N,Z,d,X,I){if(!X.targets||!this._parent.loadMorphTargets)return;if(void 0==Z._numMorphTargets)Z._numMorphTargets=X.targets.length;else if(X.targets.length!==Z._numMorphTargets)throw new Error(`${N}: Primitives do not have the same number of targets`);const m=d.extras?d.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,I.morphTargetManager=new x(this._babylonScene),I.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,I.morphTargetManager.areUpdatesFrozen=!0;for(let z=0;z<X.targets.length;z++){const N=Z.weights?Z.weights[z]:d.weights?d.weights[z]:0,X=m?m[z]:`morphTarget${z}`;I.morphTargetManager.addTarget(new J(X,N,I.va()))}}_loadMorphTargetsAsync(N,Z,d,X){if(!Z.targets||!this._parent.loadMorphTargets)return Promise.resolve();const I=new Array,m=d.morphTargetManager;for(let z=0;z<m.numTargets;z++){const d=m.getTarget(z);I.push(this._loadMorphTargetVertexDataAsync(`${N}/targets/${z}`,X,Z.targets[z],d))}return Promise.all(I).then((()=>{m.areUpdatesFrozen=!1}))}_loadMorphTargetVertexDataAsync(N,Z,d,X){const I=new Array,m=(X,m,z)=>{if(void 0==d[X])return;const w=Z.getVertexBuffer(m);if(!w)return;const S=c.Get(`${N}/${X}`,this._gltf.accessors,d[X]);I.push(this._loadFloatAccessorAsync(`/accessors/${S.index}`,S).then((N=>{z(w,N)})))};return m("POSITION",r.d.PositionKind,((N,Z)=>{const d=new Float32Array(Z.length);N.forEach(Z.length,((N,X)=>{d[X]=Z[X]+N})),X.setPositions(d)})),m("NORMAL",r.d.NormalKind,((N,Z)=>{const d=new Float32Array(Z.length);N.forEach(d.length,((N,X)=>{d[X]=Z[X]+N})),X.setNormals(d)})),m("TANGENT",r.d.TangentKind,((N,Z)=>{const d=new Float32Array(Z.length/3*4);let I=0;N.forEach(Z.length/3*4,((N,X)=>{(X+1)%4!==0&&(d[I]=Z[I]+N,I++)})),X.setTangents(d)})),Promise.all(I).then((()=>{}))}static _LoadTransform(N,Z){if(void 0!=N.skin)return;let d=I.n.Zero(),X=I.g.Identity(),m=I.n.One();if(N.matrix){I.c._c(N.matrix).decompose(m,X,d)}else N.translation&&(d=I.n._c(N.translation)),N.rotation&&(X=I.g._c(N.rotation)),N.scale&&(m=I.n._c(N.scale));Z.position=d,Z.rotationQuaternion=X,Z.od=m}_loadSkinAsync(N,Z,d,X){if(!this._parent.loadSkins)return Promise.resolve();const I=this._extensionsLoadSkinAsync(N,Z,d);if(I)return I;if(d._data)return X(d._data.babylonSkeleton),d._data.promise;const m=`skeleton${d.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const z=new U(d.name||m,m,this._babylonScene);z._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(N,d,z);const w=this._loadSkinInverseBindMatricesDataAsync(N,d).then((N=>{this._updateBoneMatrices(z,N)}));return d._data={babylonSkeleton:z,promise:w},X(z),w}_loadBones(N,Z,d){if(void 0==Z.skeleton||this._parent.alwaysComputeSkeletonRootNode){const d=this._findSkeletonRootNode(`${N}/joints`,Z.joints);if(d)if(void 0===Z.skeleton)Z.skeleton=d.index;else{const X=(N,Z)=>{for(;Z.parent;Z=Z.parent)if(Z.parent===N)return!0;return!1},I=c.Get(`${N}/skeleton`,this._gltf.nodes,Z.skeleton);I===d||X(I,d)||(k.e.Warn(`${N}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),Z.skeleton=d.index)}else k.e.Warn(`${N}: Failed to find common root`)}const X={};for(const I of Z.joints){const m=c.Get(`${N}/joints/${I}`,this._gltf.nodes,I);this._loadBone(m,Z,d,X)}}_findSkeletonRootNode(N,Z){if(0===Z.length)return null;const d={};for(const I of Z){const Z=[];let X=c.Get(`${N}/${I}`,this._gltf.nodes,I);for(;-1!==X.index;)Z.unshift(X),X=X.parent;d[I]=Z}let X=null;for(let I=0;;++I){let N=d[Z[0]];if(I>=N.length)return X;const m=N[I];for(let z=1;z<Z.length;++z)if(N=d[Z[z]],I>=N.length||m!==N[I])return X;X=m}}_loadBone(N,Z,d,X){N._isJoint=!0;let I=X[N.index];if(I)return I;let m=null;N.index!==Z.skeleton&&(N.parent&&-1!==N.parent.index?m=this._loadBone(N.parent,Z,d,X):void 0!==Z.skeleton&&k.e.Warn(`/skins/${Z.index}/skeleton: Skeleton node is not a common root`));const z=Z.joints.indexOf(N.index);return I=new e.c(N.name||`joint${N.index}`,d,m,this._getNodeMatrix(N),null,null,z),X[N.index]=I,this._postSceneLoadActions.push((()=>{I.linkTransformNode(N._babylonTransformNode)})),I}_loadSkinInverseBindMatricesDataAsync(N,Z){if(void 0==Z.inverseBindMatrices)return Promise.resolve(null);const d=c.Get(`${N}/inverseBindMatrices`,this._gltf.accessors,Z.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${d.index}`,d)}_updateBoneMatrices(N,Z){for(const d of N.bones){const N=I.c.Identity(),X=d._index;Z&&-1!==X&&(I.c.FromArrayToRef(Z,16*X,N),N.invertToRef(N));const m=d.getParent();m&&N.multiplyToRef(m.getAbsoluteInverseBindMatrix(),N),d.Cd(N,!1,!1),d._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(N){return N.matrix?I.c._c(N.matrix):I.c.Compose(N.scale?I.n._c(N.scale):I.n.One(),N.rotation?I.g._c(N.rotation):I.g.Identity(),N.translation?I.n._c(N.translation):I.n.Zero())}loadCameraAsync(N,Z){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const X=this._extensionsLoadCameraAsync(N,Z,d);if(X)return X;const m=new Array;this.logOpen(`${N} ${Z.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const z=new S.b(Z.name||`camera${Z.index}`,I.n.Zero(),this._babylonScene,!1);switch(z._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,z.ignoreParentScaling=!0,Z._babylonCamera=z,z.rotation.set(0,Math.PI,0),Z.type){case"perspective":{const d=Z.perspective;if(!d)throw new Error(`${N}: Camera perspective properties are missing`);z.fov=d.yfov,z.gj=d.znear,z.maxZ=d.zfar||0;break}case"orthographic":if(!Z.orthographic)throw new Error(`${N}: Camera orthographic properties are missing`);z.mode=w.e.ORTHOGRAPHIC_CAMERA,z.orthoLeft=-Z.orthographic.xmag,z.orthoRight=Z.orthographic.xmag,z.orthoBottom=-Z.orthographic.ymag,z.orthoTop=Z.orthographic.ymag,z.gj=Z.orthographic.znear,z.maxZ=Z.orthographic.zfar;break;default:throw new Error(`${N}: Invalid camera type (${Z.type})`)}return R.AddPointerMetadata(z,N),this._parent.onCameraLoadedObservable.notifyObservers(z),d(z),this.logClose(),Promise.all(m).then((()=>z))}_loadAnimationsAsync(){const N=this._gltf.animations;if(!N)return Promise.resolve();const Z=new Array;for(let d=0;d<N.length;d++){const X=N[d];Z.push(this.loadAnimationAsync(`/animations/${X.index}`,X).then((N=>{0===N.targetedAnimations.length&&N.dispose()})))}return Promise.all(Z).then((()=>{}))}loadAnimationAsync(N,Z){const X=this._extensionsLoadAnimationAsync(N,Z);return X||d.e(43).then(d.bind(d,12335)).then((d=>{let{AnimationGroup:X}=d;this._babylonScene._blockEntityCollection=!!this._assetContainer;const I=new X(Z.name||`animation${Z.index}`,this._babylonScene);I._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,Z._babylonAnimationGroup=I;const m=new Array;c.Assign(Z.channels),c.Assign(Z.samplers);for(const z of Z.channels)m.push(this._loadAnimationChannelAsync(`${N}/channels/${z.index}`,N,Z,z,((N,Z)=>{N.animations=N.animations||[],N.animations.push(Z),I.addTargetedAnimation(Z,N)})));return Promise.all(m).then((()=>(I.normalize(0),I)))}))}_loadAnimationChannelAsync(N,Z,d,X,I){const m=this._extensionsLoadAnimationChannelAsync(N,Z,d,X,I);if(m)return m;if(void 0==X.target.node)return Promise.resolve();const z=c.Get(`${N}/target/node`,this._gltf.nodes,X.target.node),w=X.target.path,S="weights"===w;if(S&&!z._numMorphTargets||!S&&!z._babylonTransformNode)return Promise.resolve();if(!this._parent.loadNodeAnimations&&!S&&!z._isJoint)return Promise.resolve();let e;switch(w){case"translation":e=i.translation;break;case"rotation":e=i.rotation;break;case"scale":e=i.scale;break;case"weights":e=i.weights;break;default:throw new Error(`${N}/target/path: Invalid value (${X.target.path})`)}const j={object:z,info:e};return this._loadAnimationChannelFromTargetInfoAsync(N,Z,d,X,j,I)}_loadAnimationChannelFromTargetInfoAsync(N,Z,d,X,I,m){const z=this.parent.targetFps,w=1/z,S=c.Get(`${N}/sampler`,d.samplers,X.sampler);return this._loadAnimationSamplerAsync(`${Z}/samplers/${X.sampler}`,S).then((N=>{let Z=0;const S=I.object,e=I.info;for(const I of e){const e=I.getStride(S),j=N.input,B=N.output,D=new Array(j.length);let v=0;switch(N.interpolation){case"STEP":for(let N=0;N<j.length;N++){const Z=I.getValue(S,B,v,1);v+=e,D[N]={frame:j[N]*z,value:Z,interpolation:1}}break;case"CUBICSPLINE":for(let N=0;N<j.length;N++){const Z=I.getValue(S,B,v,w);v+=e;const d=I.getValue(S,B,v,1);v+=e;const X=I.getValue(S,B,v,w);v+=e,D[N]={frame:j[N]*z,inTangent:Z,value:d,outTangent:X}}break;case"LINEAR":for(let N=0;N<j.length;N++){const Z=I.getValue(S,B,v,1);v+=e,D[N]={frame:j[N]*z,value:Z}}}if(v>0){const N=`${d.name||`animation${d.index}`}_channel${X.index}_${Z}`;I.buildAnimations(S,N,z,D,((N,d)=>{++Z,m(N,d)}))}}}))}_loadAnimationSamplerAsync(N,Z){if(Z._data)return Z._data;const d=Z.interpolation||"LINEAR";switch(d){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${N}/interpolation: Invalid value (${Z.interpolation})`)}const X=c.Get(`${N}/input`,this._gltf.accessors,Z.input),I=c.Get(`${N}/output`,this._gltf.accessors,Z.output);return Z._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${X.index}`,X),this._loadFloatAccessorAsync(`/accessors/${I.index}`,I)]).then((N=>{let[Z,X]=N;return{input:Z,interpolation:d,output:X}})),Z._data}loadBufferAsync(N,Z,d,X){const I=this._extensionsLoadBufferAsync(N,Z,d,X);if(I)return I;if(!Z._data)if(Z.uri)Z._data=this.loadUriAsync(`${N}/uri`,Z,Z.uri);else{if(!this._bin)throw new Error(`${N}: Uri is missing or the binary glTF is missing its binary chunk`);Z._data=this._bin.readAsync(0,Z.byteLength)}return Z._data.then((Z=>{try{return new Uint8Array(Z.buffer,Z.byteOffset+d,X)}catch(I){throw new Error(`${N}: ${I.message}`)}}))}loadBufferViewAsync(N,Z){const d=this._extensionsLoadBufferViewAsync(N,Z);if(d)return d;if(Z._data)return Z._data;const X=c.Get(`${N}/buffer`,this._gltf.buffers,Z.buffer);return Z._data=this.loadBufferAsync(`/buffers/${X.index}`,X,Z.byteOffset||0,Z.byteLength),Z._data}_loadAccessorAsync(N,Z,d){if(Z._data)return Z._data;const X=R._GetNumComponents(N,Z.type),I=X*r.d.GetTypeByteLength(Z.componentType),m=X*Z.count;if(void 0==Z.bufferView)Z._data=Promise.resolve(new d(m));else{const z=c.Get(`${N}/bufferView`,this._gltf.bufferViews,Z.bufferView);Z._data=this.loadBufferViewAsync(`/bufferViews/${z.index}`,z).then((w=>{if(5126!==Z.componentType||Z.normalized||z.byteStride&&z.byteStride!==I){const N=new d(m);return r.d.ForEach(w,Z.byteOffset||0,z.byteStride||I,X,Z.componentType,N.length,Z.normalized||!1,((Z,d)=>{N[d]=Z})),N}return R._GetTypedArray(N,Z.componentType,w,Z.byteOffset,m)}))}if(Z.sparse){const m=Z.sparse;Z._data=Z._data.then((z=>{const w=z,S=c.Get(`${N}/sparse/indices/bufferView`,this._gltf.bufferViews,m.indices.bufferView),e=c.Get(`${N}/sparse/values/bufferView`,this._gltf.bufferViews,m.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${S.index}`,S),this.loadBufferViewAsync(`/bufferViews/${e.index}`,e)]).then((z=>{let[S,e]=z;const j=R._GetTypedArray(`${N}/sparse/indices`,m.indices.componentType,S,m.indices.byteOffset,m.count),B=X*m.count;let D;if(5126!==Z.componentType||Z.normalized){const z=R._GetTypedArray(`${N}/sparse/values`,Z.componentType,e,m.values.byteOffset,B);D=new d(B),r.d.ForEach(z,0,I,X,Z.componentType,D.length,Z.normalized||!1,((N,Z)=>{D[Z]=N}))}else D=R._GetTypedArray(`${N}/sparse/values`,Z.componentType,e,m.values.byteOffset,B);let v=0;for(let N=0;N<j.length;N++){let Z=j[N]*X;for(let N=0;N<X;N++)w[Z++]=D[v++]}return w}))}))}return Z._data}_loadFloatAccessorAsync(N,Z){return this._loadAccessorAsync(N,Z,Float32Array)}_loadIndicesAccessorAsync(N,Z){if("SCALAR"!==Z.type)throw new Error(`${N}/type: Invalid value ${Z.type}`);if(5121!==Z.componentType&&5123!==Z.componentType&&5125!==Z.componentType)throw new Error(`${N}/componentType: Invalid value ${Z.componentType}`);if(Z._data)return Z._data;if(Z.sparse){const d=R._GetTypedArrayConstructor(`${N}/componentType`,Z.componentType);Z._data=this._loadAccessorAsync(N,Z,d)}else{const d=c.Get(`${N}/bufferView`,this._gltf.bufferViews,Z.bufferView);Z._data=this.loadBufferViewAsync(`/bufferViews/${d.index}`,d).then((d=>R._GetTypedArray(N,Z.componentType,d,Z.byteOffset,Z.count)))}return Z._data}_loadVertexBufferViewAsync(N){if(N._babylonBuffer)return N._babylonBuffer;const Z=this._babylonScene.getEngine();return N._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${N.index}`,N).then((N=>new r.b(Z,N,!1))),N._babylonBuffer}_loadVertexAccessorAsync(N,Z,d){var X;if(null!==(X=Z._babylonVertexBuffer)&&void 0!==X&&X[d])return Z._babylonVertexBuffer[d];Z._babylonVertexBuffer||(Z._babylonVertexBuffer={});const I=this._babylonScene.getEngine();if(Z.sparse||void 0==Z.bufferView)Z._babylonVertexBuffer[d]=this._loadFloatAccessorAsync(N,Z).then((N=>new r.d(I,N,d,!1)));else{const X=c.Get(`${N}/bufferView`,this._gltf.bufferViews,Z.bufferView);Z._babylonVertexBuffer[d]=this._loadVertexBufferViewAsync(X).then((m=>{const z=R._GetNumComponents(N,Z.type);return new r.d(I,m,d,!1,void 0,X.byteStride,void 0,Z.byteOffset,z,Z.componentType,Z.normalized,!0,void 0,!0)}))}return Z._babylonVertexBuffer[d]}_loadMaterialMetallicRoughnessPropertiesAsync(N,Z,d){if(!(d instanceof V))throw new Error(`${N}: Material type not supported`);const X=new Array;return Z&&(Z.baseColorFactor?(d.albedoColor=m.b._c(Z.baseColorFactor),d.alpha=Z.baseColorFactor[3]):d.albedoColor=m.b.White(),d.metallic=void 0==Z.metallicFactor?1:Z.metallicFactor,d.roughness=void 0==Z.roughnessFactor?1:Z.roughnessFactor,Z.baseColorTexture&&X.push(this.loadTextureInfoAsync(`${N}/baseColorTexture`,Z.baseColorTexture,(N=>{N.name=`${d.name} (Base Color)`,d.albedoTexture=N}))),Z.metallicRoughnessTexture&&(Z.metallicRoughnessTexture.nonColorData=!0,X.push(this.loadTextureInfoAsync(`${N}/metallicRoughnessTexture`,Z.metallicRoughnessTexture,(N=>{N.name=`${d.name} (Metallic Roughness)`,d.metallicTexture=N}))),d.useMetallnessFromMetallicTextureBlue=!0,d.useRoughnessFromMetallicTextureGreen=!0,d.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(X).then((()=>{}))}_loadMaterialAsync(N,Z,d,X){let I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const m=this._extensionsLoadMaterialAsync(N,Z,d,X,I);if(m)return m;Z._data=Z._data||{};let z=Z._data[X];if(!z){this.logOpen(`${N} ${Z.name||""}`);const d=this.createMaterial(N,Z,X);z={babylonMaterial:d,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(N,Z,d)},Z._data[X]=z,R.AddPointerMetadata(d,N),this._parent.onMaterialLoadedObservable.notifyObservers(d),this.logClose()}return d&&(z.babylonMeshes.push(d),d.pd.addOnce((()=>{const N=z.babylonMeshes.indexOf(d);-1!==N&&z.babylonMeshes.splice(N,1)}))),I(z.babylonMaterial),z.promise.then((()=>z.babylonMaterial))}_createDefaultMaterial(N,Z){this._babylonScene._blockEntityCollection=!!this._assetContainer;const d=new V(N,this._babylonScene);return d._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,d.fillMode=Z,d.enableSpecularAntiAliasing=!0,d.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,d.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,d.transparencyMode=V.PBRMATERIAL_OPAQUE,d.metallic=1,d.roughness=1,d}createMaterial(N,Z,d){const X=this._extensionsCreateMaterial(N,Z,d);if(X)return X;const I=Z.name||`material${Z.index}`;return this._createDefaultMaterial(I,d)}loadMaterialPropertiesAsync(N,Z,d){const X=this._extensionsLoadMaterialPropertiesAsync(N,Z,d);if(X)return X;const I=new Array;return I.push(this.loadMaterialBasePropertiesAsync(N,Z,d)),Z.pbrMetallicRoughness&&I.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${N}/pbrMetallicRoughness`,Z.pbrMetallicRoughness,d)),this.loadMaterialAlphaProperties(N,Z,d),Promise.all(I).then((()=>{}))}loadMaterialBasePropertiesAsync(N,Z,d){if(!(d instanceof V))throw new Error(`${N}: Material type not supported`);const X=new Array;return d.emissiveColor=Z.emissiveFactor?m.b._c(Z.emissiveFactor):new m.b(0,0,0),Z.doubleSided&&(d.ne=!1,d.twoSidedLighting=!0),Z.normalTexture&&(Z.normalTexture.nonColorData=!0,X.push(this.loadTextureInfoAsync(`${N}/normalTexture`,Z.normalTexture,(N=>{N.name=`${d.name} (Normal)`,d.bumpTexture=N}))),d.invertNormalMapX=!this._babylonScene.useRightHandedSystem,d.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=Z.normalTexture.scale&&d.bumpTexture&&(d.bumpTexture.level=Z.normalTexture.scale),d.forceIrradianceInFragment=!0),Z.occlusionTexture&&(Z.occlusionTexture.nonColorData=!0,X.push(this.loadTextureInfoAsync(`${N}/occlusionTexture`,Z.occlusionTexture,(N=>{N.name=`${d.name} (Occlusion)`,d.ambientTexture=N}))),d.useAmbientInGrayScale=!0,void 0!=Z.occlusionTexture.strength&&(d.ambientTextureStrength=Z.occlusionTexture.strength)),Z.emissiveTexture&&X.push(this.loadTextureInfoAsync(`${N}/emissiveTexture`,Z.emissiveTexture,(N=>{N.name=`${d.name} (Emissive)`,d.emissiveTexture=N}))),Promise.all(X).then((()=>{}))}loadMaterialAlphaProperties(N,Z,d){if(!(d instanceof V))throw new Error(`${N}: Material type not supported`);switch(Z.alphaMode||"OPAQUE"){case"OPAQUE":d.transparencyMode=V.PBRMATERIAL_OPAQUE,d.alpha=1;break;case"MASK":d.transparencyMode=V.PBRMATERIAL_ALPHATEST,d.alphaCutOff=void 0==Z.alphaCutoff?.5:Z.alphaCutoff,d.albedoTexture&&(d.albedoTexture.Wc=!0);break;case"BLEND":d.transparencyMode=V.PBRMATERIAL_ALPHABLEND,d.albedoTexture&&(d.albedoTexture.Wc=!0,d.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${N}/alphaMode: Invalid value (${Z.alphaMode})`)}}loadTextureInfoAsync(N,Z){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const X=this._extensionsLoadTextureInfoAsync(N,Z,d);if(X)return X;if(this.logOpen(`${N}`),Z.texCoord>=6)throw new Error(`${N}/texCoord: Invalid value (${Z.texCoord})`);const I=c.Get(`${N}/index`,this._gltf.textures,Z.index);I._textureInfo=Z;const m=this._loadTextureAsync(`/textures/${Z.index}`,I,(X=>{X.coordinatesIndex=Z.texCoord||0,R.AddPointerMetadata(X,N),this._parent.onTextureLoadedObservable.notifyObservers(X),d(X)}));return this.logClose(),m}_loadTextureAsync(N,Z){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const X=this._extensionsLoadTextureAsync(N,Z,d);if(X)return X;this.logOpen(`${N} ${Z.name||""}`);const I=void 0==Z.sampler?R.DefaultSampler:c.Get(`${N}/sampler`,this._gltf.samplers,Z.sampler),m=c.Get(`${N}/source`,this._gltf.images,Z.source),z=this._createTextureAsync(N,I,m,d,void 0,!Z._textureInfo.nonColorData);return this.logClose(),z}_createTextureAsync(N,Z,d){let I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},m=arguments.length>4?arguments[4]:void 0,z=arguments.length>5?arguments[5]:void 0;const w=this._loadSampler(`/samplers/${Z.index}`,Z),S=new Array,e=new X;this._babylonScene._blockEntityCollection=!!this._assetContainer;const j={noMipmap:w.noMipMaps,invertY:!1,samplingMode:w.samplingMode,X:()=>{this._disposed||e.resolve()},onError:(Z,d)=>{this._disposed||e.reject(new Error(`${N}: ${d&&d.message?d.message:Z||"Failed to load texture"}`))},mimeType:d.mimeType,loaderOptions:m,useSRGBBuffer:!!z&&this._parent.useSRGBBuffers},B=new O.c(null,this._babylonScene,j);return B._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,S.push(e.promise),S.push(this.loadImageAsync(`/images/${d.index}`,d).then((N=>{const Z=d.uri||`${this._fileName}#image${d.index}`,X=`data:${this._uniqueRootUrl}${Z}`;B.updateURL(X,N);const I=B.getInternalTexture();I&&(I.label=d.name)}))),B.wrapU=w.wrapU,B.wrapV=w.wrapV,I(B),this._parent.useGltfTextureNames&&(B.name=d.name||d.uri||`image${d.index}`),Promise.all(S).then((()=>B))}_loadSampler(N,Z){return Z._data||(Z._data={noMipMaps:9728===Z.minFilter||9729===Z.minFilter,samplingMode:R._GetTextureSamplingMode(N,Z),wrapU:R._GetTextureWrapMode(`${N}/wrapS`,Z.wrapS),wrapV:R._GetTextureWrapMode(`${N}/wrapT`,Z.wrapT)}),Z._data}loadImageAsync(N,Z){if(!Z._data){if(this.logOpen(`${N} ${Z.name||""}`),Z.uri)Z._data=this.loadUriAsync(`${N}/uri`,Z,Z.uri);else{const d=c.Get(`${N}/bufferView`,this._gltf.bufferViews,Z.bufferView);Z._data=this.loadBufferViewAsync(`/bufferViews/${d.index}`,d)}this.logClose()}return Z._data}loadUriAsync(N,Z,d){const X=this._extensionsLoadUriAsync(N,Z,d);if(X)return X;if(!R._ValidateUri(d))throw new Error(`${N}: '${d}' is invalid`);if((0,q.j)(d)){const Z=new Uint8Array((0,q.d)(d));return this.log(`${N}: Decoded ${d.substring(0,64)}... (${Z.length} bytes)`),Promise.resolve(Z)}return this.log(`${N}: Loading ${d}`),this._parent.preprocessUrlAsync(this._rootUrl+d).then((Z=>new Promise(((X,I)=>{this._parent._loadFile(this._babylonScene,Z,(Z=>{this._disposed||(this.log(`${N}: Loaded ${d} (${Z.byteLength} bytes)`),X(new Uint8Array(Z)))}),!0,(Z=>{I(new q.m(`${N}: Failed to load '${d}'${Z?": "+Z.status+" "+Z.statusText:""}`,Z))}))}))))}static AddPointerMetadata(N,Z){N.metadata=N.metadata||{};const d=N._internalMetadata=N._internalMetadata||{},X=d.bj=d.bj||{};(X.pointers=X.pointers||[]).push(Z)}static _GetTextureWrapMode(N,Z){switch(Z=void 0==Z?10497:Z){case 33071:return O.c.CLAMP_ADDRESSMODE;case 33648:return O.c.MIRROR_ADDRESSMODE;case 10497:return O.c.WRAP_ADDRESSMODE;default:return k.e.Warn(`${N}: Invalid value (${Z})`),O.c.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(N,Z){const d=void 0==Z.magFilter?9729:Z.magFilter,X=void 0==Z.minFilter?9987:Z.minFilter;if(9729===d)switch(X){case 9728:return O.c.LINEAR_NEAREST;case 9729:return O.c.LINEAR_LINEAR;case 9984:return O.c.LINEAR_NEAREST_MIPNEAREST;case 9985:return O.c.LINEAR_LINEAR_MIPNEAREST;case 9986:return O.c.LINEAR_NEAREST_MIPLINEAR;case 9987:return O.c.LINEAR_LINEAR_MIPLINEAR;default:return k.e.Warn(`${N}/minFilter: Invalid value (${X})`),O.c.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==d&&k.e.Warn(`${N}/magFilter: Invalid value (${d})`),X){case 9728:return O.c.NEAREST_NEAREST;case 9729:return O.c.NEAREST_LINEAR;case 9984:return O.c.NEAREST_NEAREST_MIPNEAREST;case 9985:return O.c.NEAREST_LINEAR_MIPNEAREST;case 9986:return O.c.NEAREST_NEAREST_MIPLINEAR;case 9987:return O.c.NEAREST_LINEAR_MIPLINEAR;default:return k.e.Warn(`${N}/minFilter: Invalid value (${X})`),O.c.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(N,Z){switch(Z){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`${N}: Invalid component type ${Z}`)}}static _GetTypedArray(N,Z,d,X,I){const m=d.buffer;X=d.byteOffset+(X||0);const z=R._GetTypedArrayConstructor(`${N}/componentType`,Z),w=r.d.GetTypeByteLength(Z);return X%w!==0?(k.e.Warn(`${N}: Copying buffer as byte offset (${X}) is not a multiple of component type byte length (${w})`),new z(m.slice(X,X+I*w),0)):new z(m,X,I)}static _GetNumComponents(N,Z){switch(Z){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${N}: Invalid type (${Z})`)}static _ValidateUri(N){return z.g.IsBase64(N)||-1===N.indexOf("..")}static _GetDrawMode(N,Z){switch(void 0==Z&&(Z=4),Z){case 0:return C.e.PointListDrawMode;case 1:return C.e.LineListDrawMode;case 2:return C.e.LineLoopDrawMode;case 3:return C.e.LineStripDrawMode;case 4:return C.e.TriangleFillMode;case 5:return C.e.TriangleStripDrawMode;case 6:return C.e.TriangleFanDrawMode}throw new Error(`${N}: Invalid mesh primitive mode (${Z})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const N=new Array;if(this._gltf.materials)for(const Z of this._gltf.materials)if(Z._data)for(const d in Z._data){const X=Z._data[d];for(const Z of X.babylonMeshes){Z.be(!0);const d=X.babylonMaterial;N.push(d.forceCompilationAsync(Z)),N.push(d.forceCompilationAsync(Z,{useInstances:!0})),this._parent.useClipPlane&&(N.push(d.forceCompilationAsync(Z,{clipPlane:!0})),N.push(d.forceCompilationAsync(Z,{clipPlane:!0,useInstances:!0})))}}return Promise.all(N).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const N=new Array,Z=this._babylonScene.lights;for(const d of Z){const Z=d.getShadowGenerator();Z&&N.push(Z.forceCompilationAsync())}return Promise.all(N).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(N){for(const Z of this._extensions)Z.enabled&&N(Z)}_applyExtensions(N,Z,d){for(const X of this._extensions)if(X.enabled){const I=`${X.name}.${Z}`,m=N;m._activeLoaderExtensionFunctions=m._activeLoaderExtensionFunctions||{};const z=m._activeLoaderExtensionFunctions;if(!z[I]){z[I]=!0;try{const N=d(X);if(N)return N}finally{delete z[I]}}}return null}_extensionsOnLoading(){this._forEachExtensions((N=>N.onLoading&&N.onLoading()))}_extensionsOnReady(){this._forEachExtensions((N=>N.onReady&&N.onReady()))}_extensionsLoadSceneAsync(N,Z){return this._applyExtensions(Z,"loadScene",(d=>d.loadSceneAsync&&d.loadSceneAsync(N,Z)))}_extensionsLoadNodeAsync(N,Z,d){return this._applyExtensions(Z,"loadNode",(X=>X.loadNodeAsync&&X.loadNodeAsync(N,Z,d)))}_extensionsLoadCameraAsync(N,Z,d){return this._applyExtensions(Z,"loadCamera",(X=>X.loadCameraAsync&&X.loadCameraAsync(N,Z,d)))}_extensionsLoadVertexDataAsync(N,Z,d){return this._applyExtensions(Z,"loadVertexData",(X=>X._loadVertexDataAsync&&X._loadVertexDataAsync(N,Z,d)))}_extensionsLoadMeshPrimitiveAsync(N,Z,d,X,I,m){return this._applyExtensions(I,"loadMeshPrimitive",(z=>z._loadMeshPrimitiveAsync&&z._loadMeshPrimitiveAsync(N,Z,d,X,I,m)))}_extensionsLoadMaterialAsync(N,Z,d,X,I){return this._applyExtensions(Z,"loadMaterial",(m=>m._loadMaterialAsync&&m._loadMaterialAsync(N,Z,d,X,I)))}_extensionsCreateMaterial(N,Z,d){return this._applyExtensions(Z,"createMaterial",(X=>X.createMaterial&&X.createMaterial(N,Z,d)))}_extensionsLoadMaterialPropertiesAsync(N,Z,d){return this._applyExtensions(Z,"loadMaterialProperties",(X=>X.loadMaterialPropertiesAsync&&X.loadMaterialPropertiesAsync(N,Z,d)))}_extensionsLoadTextureInfoAsync(N,Z,d){return this._applyExtensions(Z,"loadTextureInfo",(X=>X.loadTextureInfoAsync&&X.loadTextureInfoAsync(N,Z,d)))}_extensionsLoadTextureAsync(N,Z,d){return this._applyExtensions(Z,"loadTexture",(X=>X._loadTextureAsync&&X._loadTextureAsync(N,Z,d)))}_extensionsLoadAnimationAsync(N,Z){return this._applyExtensions(Z,"loadAnimation",(d=>d.loadAnimationAsync&&d.loadAnimationAsync(N,Z)))}_extensionsLoadAnimationChannelAsync(N,Z,d,X,I){return this._applyExtensions(d,"loadAnimationChannel",(m=>m._loadAnimationChannelAsync&&m._loadAnimationChannelAsync(N,Z,d,X,I)))}_extensionsLoadSkinAsync(N,Z,d){return this._applyExtensions(d,"loadSkin",(X=>X._loadSkinAsync&&X._loadSkinAsync(N,Z,d)))}_extensionsLoadUriAsync(N,Z,d){return this._applyExtensions(Z,"loadUri",(X=>X._loadUriAsync&&X._loadUriAsync(N,Z,d)))}_extensionsLoadBufferViewAsync(N,Z){return this._applyExtensions(Z,"loadBufferView",(d=>d.loadBufferViewAsync&&d.loadBufferViewAsync(N,Z)))}_extensionsLoadBufferAsync(N,Z,d,X){return this._applyExtensions(Z,"loadBuffer",(I=>I.loadBufferAsync&&I.loadBufferAsync(N,Z,d,X)))}static LoadExtensionAsync(N,Z,d,X){if(!Z.extensions)return null;const I=Z.extensions[d];return I?X(`${N}/extensions/${d}`,I):null}static LoadExtraAsync(N,Z,d,X){if(!Z.extras)return null;const I=Z.extras[d];return I?X(`${N}/extras/${d}`,I):null}isExtensionUsed(N){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(N)}logOpen(N){this._parent._logOpen(N)}logClose(){this._parent._logClose()}log(N){this._parent._log(N)}startPerformanceCounter(N){this._parent._startPerformanceCounter(N)}endPerformanceCounter(N){this._parent._endPerformanceCounter(N)}}R.DefaultSampler={index:-1},t.d._CreateGLTF2Loader=N=>new R(N);var f=d(1378),o=d(10248),NN=d(11766);class ZN extends NN.e{constructor(N,Z,d){let X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,m=arguments.length>5&&void 0!==arguments[5]&&arguments[5],z=arguments.length>6&&void 0!==arguments[6]&&arguments[6],w=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,S=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",N),this._texture=N.getEngine().createRawCubeTexture(Z,d,X,I,m,z,w,S)}update(N,Z,d,X){let I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,N,Z,d,X,I)}updateRGBDAsync(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,o.f)(this._texture,N,Z,d,X).then((()=>{}))}clone(){return E.c.Clone((()=>{const N=this.va(),Z=this._texture,d=new ZN(N,Z._bufferViewArray,Z.width,Z.format,Z.type,Z.generateMipMaps,Z.invertY,Z.samplingMode,Z._compression);return 13===Z.source&&d.updateRGBDAsync(Z._bufferViewArrayArray,Z._sphericalPolynomial,Z._lodGenerationScale,Z._lodGenerationOffset),d}),this)}}const dN="EXT_lights_image_based";class XN{constructor(N){this.name=dN,this._loader=N,this.enabled=this._loader.isExtensionUsed(dN)}dispose(){this._loader=null,delete this._lights}onLoading(){const N=this._loader.bj.extensions;if(N&&N[this.name]){const Z=N[this.name];this._lights=Z.lights}}loadSceneAsync(N,Z){return R.LoadExtensionAsync(N,Z,this.name,((d,X)=>{this._loader._allMaterialsDirtyRequired=!0;const I=new Array;I.push(this._loader.loadSceneAsync(N,Z)),this._loader.logOpen(`${d}`);const m=c.Get(`${d}/light`,this._lights,X.gb);return I.push(this._loadLightAsync(`/extensions/${this.name}/lights/${X.gb}`,m).then((N=>{this._loader.babylonScene.environmentTexture=N}))),this._loader.logClose(),Promise.all(I).then((()=>{}))}))}_loadLightAsync(N,Z){if(!Z._loaded){const d=new Array;this._loader.logOpen(`${N}`);const X=new Array(Z.specularImages.length);for(let I=0;I<Z.specularImages.length;I++){const m=Z.specularImages[I];X[I]=new Array(m.length);for(let Z=0;Z<m.length;Z++){const z=`${N}/specularImages/${I}/${Z}`;this._loader.logOpen(`${z}`);const w=m[Z],S=c.Get(z,this._loader.bj.images,w);d.push(this._loader.loadImageAsync(`/images/${w}`,S).then((N=>{X[I][Z]=N}))),this._loader.logClose()}}this._loader.logClose(),Z._loaded=Promise.all(d).then((()=>{const d=new ZN(this._loader.babylonScene,null,Z.specularImageSize);if(d.name=Z.name||"environment",Z._babylonTexture=d,void 0!=Z.kj&&(d.level=Z.kj),Z.rotation){let N=I.g._c(Z.rotation);this._loader.babylonScene.useRightHandedSystem||(N=I.g.Inverse(N)),I.c.FromQuaternionToRef(N,d.getReflectionTextureMatrix())}if(!Z.irradianceCoefficients)throw new Error(`${N}: Irradiance coefficients are missing`);const m=f.d._c(Z.irradianceCoefficients);m.scaleInPlace(Z.kj),m.convertIrradianceToLambertianRadiance();const z=f.e.FromHarmonics(m),w=(X.length-1)/Math.log2(Z.specularImageSize);return d.updateRGBDAsync(X,z,w)}))}return Z._loaded.then((()=>Z._babylonTexture))}}u(dN),l(dN,!0,(N=>new XN(N)));d(11773);const IN="EXT_mesh_gpu_instancing";class mN{constructor(N){this.name=IN,this._loader=N,this.enabled=this._loader.isExtensionUsed(IN)}dispose(){this._loader=null}loadNodeAsync(N,Z,d){return R.LoadExtensionAsync(N,Z,this.name,((N,X)=>{this._loader._disableInstancedMesh++;const m=this._loader.loadNodeAsync(`/nodes/${Z.index}`,Z,d);if(this._loader._disableInstancedMesh--,!Z._primitiveBabylonMeshes)return m;const z=new Array;let w=0;const S=Z=>{if(void 0==X.attributes[Z])return void z.push(Promise.resolve(null));const d=c.Get(`${N}/attributes/${Z}`,this._loader.bj.accessors,X.attributes[Z]);if(z.push(this._loader._loadFloatAccessorAsync(`/accessors/${d.bufferView}`,d)),0===w)w=d.count;else if(w!==d.count)throw new Error(`${N}/attributes: Instance buffer accessors do not have the same count.`)};return S("TRANSLATION"),S("ROTATION"),S("SCALE"),m.then((N=>Promise.all(z).then((d=>{let[X,m,z]=d;const S=new Float32Array(16*w);I.h.kd[0].fd(0,0,0),I.h.Quaternion[0].fd(0,0,0,1),I.h.kd[1].fd(1,1,1);for(let N=0;N<w;++N)X&&I.n.FromArrayToRef(X,3*N,I.h.kd[0]),m&&I.g.FromArrayToRef(m,4*N,I.h.Quaternion[0]),z&&I.n.FromArrayToRef(z,3*N,I.h.kd[1]),I.c.ComposeToRef(I.h.kd[1],I.h.Quaternion[0],I.h.kd[0],I.h.Matrix[0]),I.h.Matrix[0].copyToArray(S,16*N);for(const N of Z._primitiveBabylonMeshes)N.Tj("matrix",S,16,!0);return N}))))}))}}u(IN),l(IN,!0,(N=>new mN(N)));class zN{static get Default(){return zN._Default||(zN._Default=new zN),zN._Default}constructor(){const N=zN.Configuration.decoder;this._decoderModulePromise=z.g.LoadBabylonScriptAsync(N.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}decodeGltfBufferAsync(N,Z,d,X,I){return this._decoderModulePromise.then((async()=>{MeshoptDecoder.useWorkers(1);const m=await MeshoptDecoder.decodeGltfBufferAsync(Z,d,N,X,I);return MeshoptDecoder.useWorkers(0),m}))}}zN.Configuration={decoder:{url:`${z.g._DefaultCdnUrl}/meshopt_decoder.js`}},zN._Default=null;const wN="EXT_meshopt_compression";class SN{constructor(N){this.name=wN,this.enabled=N.isExtensionUsed(wN),this._loader=N}dispose(){this._loader=null}loadBufferViewAsync(N,Z){return R.LoadExtensionAsync(N,Z,this.name,((d,X)=>{const I=Z;if(I._meshOptData)return I._meshOptData;const m=c.Get(`${N}/buffer`,this._loader.bj.buffers,X.buffer);return I._meshOptData=this._loader.loadBufferAsync(`/buffers/${m.index}`,m,X.byteOffset||0,X.byteLength).then((N=>zN.Default.decodeGltfBufferAsync(N,X.count,X.byteStride,X.mode,X.filter))),I._meshOptData}))}}u(wN),l(wN,!0,(N=>new SN(N)));const eN="EXT_texture_webp";class jN{constructor(N){this.name=eN,this._loader=N,this.enabled=N.isExtensionUsed(eN)}dispose(){this._loader=null}_loadTextureAsync(N,Z,d){return R.LoadExtensionAsync(N,Z,this.name,((X,I)=>{const m=void 0==Z.sampler?R.DefaultSampler:c.Get(`${N}/sampler`,this._loader.bj.samplers,Z.sampler),z=c.Get(`${X}/source`,this._loader.bj.images,I.source);return this._loader._createTextureAsync(N,m,z,(N=>{d(N)}),void 0,!Z._textureInfo.nonColorData)}))}}u(eN),l(eN,!0,(N=>new jN(N)));const BN="EXT_texture_avif";class DN{constructor(N){this.name=BN,this._loader=N,this.enabled=N.isExtensionUsed(BN)}dispose(){this._loader=null}_loadTextureAsync(N,Z,d){return R.LoadExtensionAsync(N,Z,this.name,((X,I)=>{const m=void 0==Z.sampler?R.DefaultSampler:c.Get(`${N}/sampler`,this._loader.bj.samplers,Z.sampler),z=c.Get(`${X}/source`,this._loader.bj.images,I.source);return this._loader._createTextureAsync(N,m,z,(N=>{d(N)}),void 0,!Z._textureInfo.nonColorData)}))}}u(BN),l(BN,!0,(N=>new DN(N)));var vN=d(11776);const TN="KHR_draco_mesh_compression";class kN{constructor(N){this.name=TN,this.useNormalizedFlagFromAccessor=!0,this._loader=N,this.enabled=vN.e.DecoderAvailable&&this._loader.isExtensionUsed(TN)}dispose(){delete this.dracoCompression,this._loader=null}_loadVertexDataAsync(N,Z,d){return R.LoadExtensionAsync(N,Z,this.name,((X,I)=>{if(void 0!=Z.mode&&4!==Z.mode&&5!==Z.mode)throw new Error(`${N}: Unsupported mode ${Z.mode}`);const m={},z={},w=(N,X)=>{const w=I.attributes[N];if(void 0!=w&&(d._delayInfo=d._delayInfo||[],-1===d._delayInfo.indexOf(X)&&d._delayInfo.push(X),m[X]=w,this.useNormalizedFlagFromAccessor)){const d=c.TryGet(this._loader.bj.accessors,Z.attributes[N]);d&&(z[X]=d.normalized||!1)}};w("POSITION",r.d.PositionKind),w("NORMAL",r.d.NormalKind),w("TANGENT",r.d.TangentKind),w("TEXCOORD_0",r.d.UVKind),w("TEXCOORD_1",r.d.UV2Kind),w("TEXCOORD_2",r.d.UV3Kind),w("TEXCOORD_3",r.d.UV4Kind),w("TEXCOORD_4",r.d.UV5Kind),w("TEXCOORD_5",r.d.UV6Kind),w("JOINTS_0",r.d.MatricesIndicesKind),w("WEIGHTS_0",r.d.MatricesWeightsKind),w("COLOR_0",r.d.ColorKind);const S=c.Get(X,this._loader.bj.bufferViews,I.bufferView);return S._dracoBabylonGeometry||(S._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${S.index}`,S).then((Z=>(this.dracoCompression||vN.e.Default)._decodeMeshToGeometryForGltfAsync(d.name,this._loader.babylonScene,Z,m,z).catch((Z=>{throw new Error(`${N}: ${Z.message}`)}))))),S._dracoBabylonGeometry}))}}u(TN),l(TN,!0,(N=>new kN(N)));var hN=d(11785),UN=d(11343),CN=d(11753),MN=d(11788);UN.e.AddNodeConstructor("Light_Type_0",((N,Z)=>()=>new QN(N,I.n.Zero(),Z)));class QN extends MN.c{get shadowAngle(){return this._shadowAngle}set shadowAngle(N){this._shadowAngle=N,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(N){const Z=this.needCube();if(this._direction=N,this.needCube()!==Z&&this._shadowGenerators){const N=this._shadowGenerators.values();for(let Z=N.next();!0!==Z.done;Z=N.next()){Z.value.recreateShadowMap()}}}constructor(N,Z,d){super(N,d),this._shadowAngle=Math.PI/2,this.position=Z}getClassName(){return"PointLight"}getTypeID(){return CN.d.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(N){if(this.direction)return super.getShadowDirection(N);switch(N){case 0:return new I.n(1,0,0);case 1:return new I.n(-1,0,0);case 2:return new I.n(0,-1,0);case 3:return new I.n(0,1,0);case 4:return new I.n(0,0,1);case 5:return new I.n(0,0,-1)}return I.n.Zero()}_setDefaultShadowProjectionMatrix(N,Z,d){const X=this.va().activeCamera;if(!X)return;const m=void 0!==this.shadowMinZ?this.shadowMinZ:X.gj,z=void 0!==this.shadowMaxZ?this.shadowMaxZ:X.maxZ,w=this.va().getEngine().useReverseDepthBuffer;I.c.PerspectiveFovLHToRef(this.shadowAngle,1,w?z:m,w?m:z,N,!0,this._scene.getEngine().isNDCHalfZRange,void 0,w)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(N,Z){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,Z):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,Z),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,Z),this}transferToNodeMaterialEffect(N,Z){return this.computeTransformedInformation()?N.setFloat3(Z,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):N.setFloat3(Z,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(N,Z){N["POINTLIGHT"+Z]=!0}}(0,M.d)([(0,Q.I)()],QN.prototype,"shadowAngle",null),(0,g.h)("BABYLON.PointLight",QN),UN.e.AddNodeConstructor("Light_Type_2",((N,Z)=>()=>new AN(N,I.n.Zero(),I.n.Zero(),0,0,Z)));class AN extends MN.c{get angle(){return this._angle}set angle(N){this._angle=N,this._cosHalfAngle=Math.cos(.5*N),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(N){this._innerAngle=N,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(N){this._shadowAngleScale=N,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(N){this._projectionTextureLightNear=N,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(N){this._projectionTextureLightFar=N,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(N){this._projectionTextureUpDirection=N,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(N){this._projectionTexture!==N&&(this._projectionTexture=N,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(AN._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):AN._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(N){return void 0!==N.onGeneratedObservable}static _IsTexture(N){return void 0!==N.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(N){this._projectionTextureProjectionLightMatrix=N,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(N,Z,d,X,m,z){super(N,z),this._innerAngle=0,this._projectionTextureMatrix=I.c.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=I.n.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=I.n.Zero(),this._projectionTextureViewLightMatrix=I.c.Zero(),this._projectionTextureProjectionLightMatrix=I.c.Zero(),this._projectionTextureScalingMatrix=I.c.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=Z,this.direction=d,this.angle=X,this.exponent=m}getClassName(){return"SpotLight"}getTypeID(){return CN.d.LIGHTTYPEID_SPOTLIGHT}_setDirection(N){super._setDirection(N),this._projectionTextureViewLightDirty=!0}_setPosition(N){super._setPosition(N),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(N,Z,d){const X=this.va().activeCamera;if(!X)return;this._shadowAngleScale=this._shadowAngleScale||1;const m=this._shadowAngleScale*this._angle,z=void 0!==this.shadowMinZ?this.shadowMinZ:X.gj,w=void 0!==this.shadowMaxZ?this.shadowMaxZ:X.maxZ,S=this.va().getEngine().useReverseDepthBuffer;I.c.PerspectiveFovLHToRef(m,1,S?w:z,S?z:w,N,!0,this._scene.getEngine().isNDCHalfZRange,void 0,S)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),I.c.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const N=this.projectionTextureLightFar,Z=this.projectionTextureLightNear,d=N/(N-Z),X=-d*Z,m=1/Math.tan(this._angle/2);I.c.FromValuesToRef(m/1,0,0,0,0,m,0,0,0,0,d,1,0,0,X,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof O.c){const N=this._projectionTexture.uScale/2,Z=this._projectionTexture.vScale/2;I.c.FromValuesToRef(N,0,0,0,0,Z,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(N,Z){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),N.setMatrix("textureProjectionMatrix"+Z,this._projectionTextureMatrix),N.setTexture("projectionLightTexture"+Z,this.projectionTexture)),this}transferToEffect(N,Z){let d;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,Z),d=I.n.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,Z),d=I.n.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",d.x,d.y,d.z,this._cosHalfAngle,Z),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,Z),this}transferToNodeMaterialEffect(N,Z){let d;return d=this.computeTransformedInformation()?I.n.Normalize(this.transformedDirection):I.n.Normalize(this.direction),this.va().useRightHandedSystem?N.setFloat3(Z,-d.x,-d.y,-d.z):N.setFloat3(Z,d.x,d.y,d.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose()}getDepthMinZ(N){const Z=this._scene.getEngine(),d=void 0!==this.shadowMinZ?this.shadowMinZ:N.gj;return Z.useReverseDepthBuffer&&Z.isNDCHalfZRange?d:this._scene.getEngine().isNDCHalfZRange?0:d}getDepthMaxZ(N){const Z=this._scene.getEngine(),d=void 0!==this.shadowMaxZ?this.shadowMaxZ:N.maxZ;return Z.useReverseDepthBuffer&&Z.isNDCHalfZRange?0:d}prepareLightSpecificDefines(N,Z){N["SPOTLIGHT"+Z]=!0,N["PROJECTEDLIGHTTEXTURE"+Z]=!(!this.projectionTexture||!this.projectionTexture.isReady())}}(0,M.d)([(0,Q.I)()],AN.prototype,"angle",null),(0,M.d)([(0,Q.I)()],AN.prototype,"innerAngle",null),(0,M.d)([(0,Q.I)()],AN.prototype,"shadowAngleScale",null),(0,M.d)([(0,Q.I)()],AN.prototype,"exponent",void 0),(0,M.d)([(0,Q.I)()],AN.prototype,"projectionTextureLightNear",null),(0,M.d)([(0,Q.I)()],AN.prototype,"projectionTextureLightFar",null),(0,M.d)([(0,Q.I)()],AN.prototype,"projectionTextureUpDirection",null),(0,M.d)([(0,Q.A)("projectedLightTexture")],AN.prototype,"_projectionTexture",void 0),(0,g.h)("BABYLON.SpotLight",AN);const nN="KHR_lights_punctual";class gN{constructor(N){this.name=nN,this._loader=N,this.enabled=this._loader.isExtensionUsed(nN)}dispose(){this._loader=null,delete this._lights}onLoading(){const N=this._loader.bj.extensions;if(N&&N[this.name]){const Z=N[this.name];this._lights=Z.lights,c.Assign(this._lights)}}loadNodeAsync(N,Z,d){return R.LoadExtensionAsync(N,Z,this.name,((X,z)=>(this._loader._allMaterialsDirtyRequired=!0,this._loader.loadNodeAsync(N,Z,(N=>{let Z;const w=c.Get(X,this._lights,z.gb),S=w.name||N.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,w.type){case"directional":{const N=new hN.d(S,I.n.Backward(),this._loader.babylonScene);N.position.hd(0),Z=N;break}case"point":Z=new QN(S,I.n.Zero(),this._loader.babylonScene);break;case"spot":{const N=new AN(S,I.n.Zero(),I.n.Backward(),0,1,this._loader.babylonScene);N.angle=2*(w.spot&&w.spot.outerConeAngle||Math.PI/4),N.innerAngle=2*(w.spot&&w.spot.innerConeAngle||0),Z=N;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${X}: Invalid light type (${w.type})`)}Z._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,w._babylonLight=Z,Z.falloffType=CN.d.FALLOFF_GLTF,Z.Uh=w.color?m.b._c(w.color):m.b.White(),Z.kj=void 0==w.kj?1:w.kj,Z.range=void 0==w.range?Number.MAX_VALUE:w.range,Z.parent=N,this._loader._babylonLights.push(Z),R.AddPointerMetadata(Z,X),d(N)})))))}}u(nN),l(nN,!0,(N=>new gN(N)));const EN="KHR_materials_pbrSpecularGlossiness";class VN{constructor(N){this.name=EN,this.order=200,this._loader=N,this.enabled=this._loader.isExtensionUsed(EN)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,Z,d){return R.LoadExtensionAsync(N,Z,this.name,((X,I)=>{const m=new Array;return m.push(this._loader.loadMaterialBasePropertiesAsync(N,Z,d)),m.push(this._loadSpecularGlossinessPropertiesAsync(X,I,d)),this._loader.loadMaterialAlphaProperties(N,Z,d),Promise.all(m).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(N,Z,d){if(!(d instanceof V))throw new Error(`${N}: Material type not supported`);const X=new Array;return d.metallic=null,d.roughness=null,Z.diffuseFactor?(d.albedoColor=m.b._c(Z.diffuseFactor),d.alpha=Z.diffuseFactor[3]):d.albedoColor=m.b.White(),d.reflectivityColor=Z.specularFactor?m.b._c(Z.specularFactor):m.b.White(),d.microSurface=void 0==Z.glossinessFactor?1:Z.glossinessFactor,Z.diffuseTexture&&X.push(this._loader.loadTextureInfoAsync(`${N}/diffuseTexture`,Z.diffuseTexture,(N=>{N.name=`${d.name} (Diffuse)`,d.albedoTexture=N}))),Z.specularGlossinessTexture&&(X.push(this._loader.loadTextureInfoAsync(`${N}/specularGlossinessTexture`,Z.specularGlossinessTexture,(N=>{N.name=`${d.name} (Specular Glossiness)`,d.reflectivityTexture=N,d.reflectivityTexture.Wc=!0}))),d.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(X).then((()=>{}))}}u(EN),l(EN,!0,(N=>new VN(N)));const ON="KHR_materials_unlit";class KN{constructor(N){this.name=ON,this.order=210,this._loader=N,this.enabled=this._loader.isExtensionUsed(ON)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,Z,d){return R.LoadExtensionAsync(N,Z,this.name,(()=>this._loadUnlitPropertiesAsync(N,Z,d)))}_loadUnlitPropertiesAsync(N,Z,d){if(!(d instanceof V))throw new Error(`${N}: Material type not supported`);const X=new Array;d.unlit=!0;const I=Z.pbrMetallicRoughness;return I&&(I.baseColorFactor?(d.albedoColor=m.b._c(I.baseColorFactor),d.alpha=I.baseColorFactor[3]):d.albedoColor=m.b.White(),I.baseColorTexture&&X.push(this._loader.loadTextureInfoAsync(`${N}/baseColorTexture`,I.baseColorTexture,(N=>{N.name=`${d.name} (Base Color)`,d.albedoTexture=N})))),Z.doubleSided&&(d.ne=!1,d.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(N,Z,d),Promise.all(X).then((()=>{}))}}u(ON),l(ON,!0,(N=>new KN(N)));const rN="KHR_materials_clearcoat";class PN{constructor(N){this.name=rN,this.order=190,this._loader=N,this.enabled=this._loader.isExtensionUsed(rN)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,Z,d){return R.LoadExtensionAsync(N,Z,this.name,((X,I)=>{const m=new Array;return m.push(this._loader.loadMaterialPropertiesAsync(N,Z,d)),m.push(this._loadClearCoatPropertiesAsync(X,I,d)),Promise.all(m).then((()=>{}))}))}_loadClearCoatPropertiesAsync(N,Z,d){if(!(d instanceof V))throw new Error(`${N}: Material type not supported`);const X=new Array;return d.clearCoat.isEnabled=!0,d.clearCoat.useRoughnessFromMainTexture=!1,d.clearCoat.remapF0OnInterfaceChange=!1,void 0!=Z.clearcoatFactor?d.clearCoat.kj=Z.clearcoatFactor:d.clearCoat.kj=0,Z.clearcoatTexture&&X.push(this._loader.loadTextureInfoAsync(`${N}/clearcoatTexture`,Z.clearcoatTexture,(N=>{N.name=`${d.name} (ClearCoat)`,d.clearCoat.texture=N}))),void 0!=Z.clearcoatRoughnessFactor?d.clearCoat.roughness=Z.clearcoatRoughnessFactor:d.clearCoat.roughness=0,Z.clearcoatRoughnessTexture&&(Z.clearcoatRoughnessTexture.nonColorData=!0,X.push(this._loader.loadTextureInfoAsync(`${N}/clearcoatRoughnessTexture`,Z.clearcoatRoughnessTexture,(N=>{N.name=`${d.name} (ClearCoat Roughness)`,d.clearCoat.textureRoughness=N})))),Z.clearcoatNormalTexture&&(Z.clearcoatNormalTexture.nonColorData=!0,X.push(this._loader.loadTextureInfoAsync(`${N}/clearcoatNormalTexture`,Z.clearcoatNormalTexture,(N=>{N.name=`${d.name} (ClearCoat Normal)`,d.clearCoat.bumpTexture=N}))),d.invertNormalMapX=!d.va().useRightHandedSystem,d.invertNormalMapY=d.va().useRightHandedSystem,void 0!=Z.clearcoatNormalTexture.scale&&(d.clearCoat.bumpTexture.level=Z.clearcoatNormalTexture.scale)),Promise.all(X).then((()=>{}))}}u(rN),l(rN,!0,(N=>new PN(N)));const WN="KHR_materials_iridescence";class bN{constructor(N){this.name=WN,this.order=195,this._loader=N,this.enabled=this._loader.isExtensionUsed(WN)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,Z,d){return R.LoadExtensionAsync(N,Z,this.name,((X,I)=>{const m=new Array;return m.push(this._loader.loadMaterialPropertiesAsync(N,Z,d)),m.push(this._loadIridescencePropertiesAsync(X,I,d)),Promise.all(m).then((()=>{}))}))}_loadIridescencePropertiesAsync(N,Z,d){if(!(d instanceof V))throw new Error(`${N}: Material type not supported`);const X=new Array;return d.iridescence.isEnabled=!0,d.iridescence.kj=Z.iridescenceFactor??0,d.iridescence.indexOfRefraction=Z.iridescenceIor??Z.iridescenceIOR??1.3,d.iridescence.minimumThickness=Z.iridescenceThicknessMinimum??100,d.iridescence.maximumThickness=Z.iridescenceThicknessMaximum??400,Z.iridescenceTexture&&X.push(this._loader.loadTextureInfoAsync(`${N}/iridescenceTexture`,Z.iridescenceTexture,(N=>{N.name=`${d.name} (Iridescence)`,d.iridescence.texture=N}))),Z.iridescenceThicknessTexture&&X.push(this._loader.loadTextureInfoAsync(`${N}/iridescenceThicknessTexture`,Z.iridescenceThicknessTexture,(N=>{N.name=`${d.name} (Iridescence Thickness)`,d.iridescence.thicknessTexture=N}))),Promise.all(X).then((()=>{}))}}u(WN),l(WN,!0,(N=>new bN(N)));const JN="KHR_materials_anisotropy";class FN{constructor(N){this.name=JN,this.order=195,this._loader=N,this.enabled=this._loader.isExtensionUsed(JN)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,Z,d){return R.LoadExtensionAsync(N,Z,this.name,((X,I)=>{const m=new Array;return m.push(this._loader.loadMaterialPropertiesAsync(N,Z,d)),m.push(this._loadIridescencePropertiesAsync(X,I,d)),Promise.all(m).then((()=>{}))}))}_loadIridescencePropertiesAsync(N,Z,d){if(!(d instanceof V))throw new Error(`${N}: Material type not supported`);const X=new Array;return d.anisotropy.isEnabled=!0,d.anisotropy.kj=Z.anisotropyStrength??0,d.anisotropy.angle=Z.anisotropyRotation??0,Z.anisotropyTexture&&(Z.anisotropyTexture.nonColorData=!0,X.push(this._loader.loadTextureInfoAsync(`${N}/anisotropyTexture`,Z.anisotropyTexture,(N=>{N.name=`${d.name} (Anisotropy Intensity)`,d.anisotropy.texture=N})))),Promise.all(X).then((()=>{}))}}u(JN),l(JN,!0,(N=>new FN(N)));const GN="KHR_materials_emissive_strength";class xN{constructor(N){this.name=GN,this.order=170,this._loader=N,this.enabled=this._loader.isExtensionUsed(GN)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,Z,d){return R.LoadExtensionAsync(N,Z,this.name,((X,I)=>this._loader.loadMaterialPropertiesAsync(N,Z,d).then((()=>{this._loadEmissiveProperties(X,I,d)}))))}_loadEmissiveProperties(N,Z,d){if(!(d instanceof V))throw new Error(`${N}: Material type not supported`);void 0!==Z.emissiveStrength&&(d.emissiveIntensity=Z.emissiveStrength)}}u(GN),l(GN,!0,(N=>new xN(N)));const tN="KHR_materials_sheen";class qN{constructor(N){this.name=tN,this.order=190,this._loader=N,this.enabled=this._loader.isExtensionUsed(tN)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,Z,d){return R.LoadExtensionAsync(N,Z,this.name,((X,I)=>{const m=new Array;return m.push(this._loader.loadMaterialPropertiesAsync(N,Z,d)),m.push(this._loadSheenPropertiesAsync(X,I,d)),Promise.all(m).then((()=>{}))}))}_loadSheenPropertiesAsync(N,Z,d){if(!(d instanceof V))throw new Error(`${N}: Material type not supported`);const X=new Array;return d.sheen.isEnabled=!0,d.sheen.kj=1,void 0!=Z.sheenColorFactor?d.sheen.color=m.b._c(Z.sheenColorFactor):d.sheen.color=m.b.Black(),Z.sheenColorTexture&&X.push(this._loader.loadTextureInfoAsync(`${N}/sheenColorTexture`,Z.sheenColorTexture,(N=>{N.name=`${d.name} (Sheen Color)`,d.sheen.texture=N}))),void 0!==Z.sheenRoughnessFactor?d.sheen.roughness=Z.sheenRoughnessFactor:d.sheen.roughness=0,Z.sheenRoughnessTexture&&(Z.sheenRoughnessTexture.nonColorData=!0,X.push(this._loader.loadTextureInfoAsync(`${N}/sheenRoughnessTexture`,Z.sheenRoughnessTexture,(N=>{N.name=`${d.name} (Sheen Roughness)`,d.sheen.textureRoughness=N})))),d.sheen.albedoScaling=!0,d.sheen.useRoughnessFromMainTexture=!1,Promise.all(X).then((()=>{}))}}u(tN),l(tN,!0,(N=>new qN(N)));const YN="KHR_materials_specular";class sN{constructor(N){this.name=YN,this.order=190,this._loader=N,this.enabled=this._loader.isExtensionUsed(YN)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,Z,d){return R.LoadExtensionAsync(N,Z,this.name,((X,I)=>{const m=new Array;return m.push(this._loader.loadMaterialPropertiesAsync(N,Z,d)),m.push(this._loadSpecularPropertiesAsync(X,I,d)),Promise.all(m).then((()=>{}))}))}_loadSpecularPropertiesAsync(N,Z,d){if(!(d instanceof V))throw new Error(`${N}: Material type not supported`);const X=new Array;return void 0!==Z.specularFactor&&(d.metallicF0Factor=Z.specularFactor),void 0!==Z.specularColorFactor&&(d.metallicReflectanceColor=m.b._c(Z.specularColorFactor)),Z.specularTexture&&(Z.specularTexture.nonColorData=!0,X.push(this._loader.loadTextureInfoAsync(`${N}/specularTexture`,Z.specularTexture,(N=>{N.name=`${d.name} (Specular)`,d.metallicReflectanceTexture=N,d.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),Z.specularColorTexture&&X.push(this._loader.loadTextureInfoAsync(`${N}/specularColorTexture`,Z.specularColorTexture,(N=>{N.name=`${d.name} (Specular Color)`,d.reflectanceTexture=N}))),Promise.all(X).then((()=>{}))}}u(YN),l(YN,!0,(N=>new sN(N)));const LN="KHR_materials_ior";class HN{constructor(N){this.name=LN,this.order=180,this._loader=N,this.enabled=this._loader.isExtensionUsed(LN)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,Z,d){return R.LoadExtensionAsync(N,Z,this.name,((X,I)=>{const m=new Array;return m.push(this._loader.loadMaterialPropertiesAsync(N,Z,d)),m.push(this._loadIorPropertiesAsync(X,I,d)),Promise.all(m).then((()=>{}))}))}_loadIorPropertiesAsync(N,Z,d){if(!(d instanceof V))throw new Error(`${N}: Material type not supported`);return void 0!==Z.ior?d.indexOfRefraction=Z.ior:d.indexOfRefraction=HN._DEFAULT_IOR,Promise.resolve()}}HN._DEFAULT_IOR=1.5,u(LN),l(LN,!0,(N=>new HN(N)));const iN="KHR_materials_variants";class pN{constructor(N){this.name=iN,this._loader=N,this.enabled=this._loader.isExtensionUsed(iN)}dispose(){this._loader=null}static GetAvailableVariants(N){const Z=this._GetExtensionMetadata(N);return Z?Object.keys(Z.variants):[]}getAvailableVariants(N){return pN.GetAvailableVariants(N)}static SelectVariant(N,Z){const d=this._GetExtensionMetadata(N);if(!d)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${iN} extension`);const X=N=>{const Z=d.variants[N];if(Z)for(const d of Z)d.mesh.material=d.material};if(Z instanceof Array)for(const I of Z)X(I);else X(Z);d.lastSelected=Z}selectVariant(N,Z){pN.SelectVariant(N,Z)}static Reset(N){const Z=this._GetExtensionMetadata(N);if(!Z)throw new Error(`Cannot reset on a glTF mesh that does not have the ${iN} extension`);for(const d of Z.original)d.mesh.material=d.material;Z.lastSelected=null}reset(N){pN.Reset(N)}static GetLastSelectedVariant(N){const Z=this._GetExtensionMetadata(N);if(!Z)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${iN} extension`);return Z.lastSelected}getLastSelectedVariant(N){return pN.GetLastSelectedVariant(N)}static _GetExtensionMetadata(N){var Z,d;return(null===N||void 0===N||null===(Z=N._internalMetadata)||void 0===Z||null===(d=Z.bj)||void 0===d?void 0:d[iN])||null}onLoading(){const N=this._loader.bj.extensions;if(N&&N[this.name]){const Z=N[this.name];this._variants=Z.variants}}_loadMeshPrimitiveAsync(N,Z,d,X,I,m){return R.LoadExtensionAsync(N,I,this.name,((z,w)=>{const S=new Array;return S.push(this._loader._loadMeshPrimitiveAsync(N,Z,d,X,I,(Z=>{if(m(Z),Z instanceof b.b){const d=R._GetDrawMode(N,I.mode),X=this._loader.rootBabylonMesh,m=X?X._internalMetadata=X._internalMetadata||{}:{},e=m.bj=m.bj||{},j=e[iN]=e[iN]||{lastSelected:null,original:[],variants:{}};j.original.push({mesh:Z,material:Z.material});for(let N=0;N<w.mappings.length;++N){const I=w.mappings[N],m=c.Get(`${z}/mappings/${N}/material`,this._loader.bj.materials,I.material);S.push(this._loader._loadMaterialAsync(`#/materials/${I.material}`,m,Z,d,(N=>{for(let d=0;d<I.variants.length;++d){const m=I.variants[d],z=c.Get(`/extensions/${iN}/variants/${m}`,this._variants,m);j.variants[z.name]=j.variants[z.name]||[],j.variants[z.name].push({mesh:Z,material:N}),Z.onClonedObservable.add((N=>{const d=N;let I=null,m=d;do{if(m=m.parent,!m)return;I=pN._GetExtensionMetadata(m)}while(null===I);if(X&&I===pN._GetExtensionMetadata(X)){m._internalMetadata={};for(const N in X._internalMetadata)m._internalMetadata[N]=X._internalMetadata[N];m._internalMetadata.bj=[];for(const N in X._internalMetadata.bj)m._internalMetadata.bj[N]=X._internalMetadata.bj[N];m._internalMetadata.bj[iN]={lastSelected:null,original:[],variants:{}};for(const N of I.original)m._internalMetadata.bj[iN].original.push({mesh:N.mesh,material:N.material});for(const N in I.variants)if(Object.prototype.hasOwnProperty.call(I.variants,N)){m._internalMetadata.bj[iN].variants[N]=[];for(const Z of I.variants[N])m._internalMetadata.bj[iN].variants[N].push({mesh:Z.mesh,material:Z.material})}I=m._internalMetadata.bj[iN]}for(const X of I.original)X.mesh===Z&&(X.mesh=d);for(const X of I.variants[z.name])X.mesh===Z&&(X.mesh=d)}))}})))}}}))),Promise.all(S).then((N=>{let[Z]=N;return Z}))}))}}u(iN),l(iN,!0,(N=>new pN(N)));var yN=d(1419);class lN{}lN.AUTOSAMPLERSUFFIX="Sampler",lN.DISABLEUA="#define DISABLE_UNIFORMITY_ANALYSIS",lN.ALPHA_DISABLE=0,lN.ALPHA_ADD=1,lN.ALPHA_COMBINE=2,lN.ALPHA_SUBTRACT=3,lN.ALPHA_MULTIPLY=4,lN.ALPHA_MAXIMIZED=5,lN.ALPHA_ONEONE=6,lN.ALPHA_PREMULTIPLIED=7,lN.ALPHA_PREMULTIPLIED_PORTERDUFF=8,lN.ALPHA_INTERPOLATE=9,lN.ALPHA_SCREENMODE=10,lN.ALPHA_ONEONE_ONEONE=11,lN.ALPHA_ALPHATOCOLOR=12,lN.ALPHA_REVERSEONEMINUS=13,lN.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,lN.ALPHA_ONEONE_ONEZERO=15,lN.ALPHA_EXCLUSION=16,lN.ALPHA_LAYER_ACCUMULATE=17,lN.ALPHA_EQUATION_ADD=0,lN.ALPHA_EQUATION_SUBSTRACT=1,lN.ALPHA_EQUATION_REVERSE_SUBTRACT=2,lN.ALPHA_EQUATION_MAX=3,lN.ALPHA_EQUATION_MIN=4,lN.ALPHA_EQUATION_DARKEN=5,lN.DELAYLOADSTATE_NONE=0,lN.DELAYLOADSTATE_LOADED=1,lN.DELAYLOADSTATE_LOADING=2,lN.DELAYLOADSTATE_NOTLOADED=4,lN.NEVER=512,lN.ALWAYS=519,lN.LESS=513,lN.EQUAL=514,lN.LEQUAL=515,lN.GREATER=516,lN.GEQUAL=518,lN.NOTEQUAL=517,lN.KEEP=7680,lN.ZERO=0,lN.REPLACE=7681,lN.INCR=7682,lN.DECR=7683,lN.INVERT=5386,lN.INCR_WRAP=34055,lN.DECR_WRAP=34056,lN.TEXTURE_CLAMP_ADDRESSMODE=0,lN.TEXTURE_WRAP_ADDRESSMODE=1,lN.TEXTURE_MIRROR_ADDRESSMODE=2,lN.TEXTURE_CREATIONFLAG_STORAGE=1,lN.TEXTUREFORMAT_ALPHA=0,lN.TEXTUREFORMAT_LUMINANCE=1,lN.TEXTUREFORMAT_LUMINANCE_ALPHA=2,lN.TEXTUREFORMAT_RGB=4,lN.TEXTUREFORMAT_RGBA=5,lN.TEXTUREFORMAT_RED=6,lN.TEXTUREFORMAT_R=6,lN.TEXTUREFORMAT_RG=7,lN.TEXTUREFORMAT_RED_INTEGER=8,lN.TEXTUREFORMAT_R_INTEGER=8,lN.TEXTUREFORMAT_RG_INTEGER=9,lN.TEXTUREFORMAT_RGB_INTEGER=10,lN.TEXTUREFORMAT_RGBA_INTEGER=11,lN.TEXTUREFORMAT_BGRA=12,lN.TEXTUREFORMAT_DEPTH24_STENCIL8=13,lN.TEXTUREFORMAT_DEPTH32_FLOAT=14,lN.TEXTUREFORMAT_DEPTH16=15,lN.TEXTUREFORMAT_DEPTH24=16,lN.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17,lN.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18,lN.TEXTUREFORMAT_STENCIL8=19,lN.TEXTUREFORMAT_UNDEFINED=4294967295,lN.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492,lN.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493,lN.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495,lN.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494,lN.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779,lN.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919,lN.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778,lN.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918,lN.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777,lN.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776,lN.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917,lN.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916,lN.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808,lN.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840,lN.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196,lN.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492,lN.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493,lN.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494,lN.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495,lN.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496,lN.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497,lN.TEXTURETYPE_UNSIGNED_BYTE=0,lN.TEXTURETYPE_UNSIGNED_INT=0,lN.TEXTURETYPE_FLOAT=1,lN.TEXTURETYPE_HALF_FLOAT=2,lN.TEXTURETYPE_BYTE=3,lN.TEXTURETYPE_SHORT=4,lN.TEXTURETYPE_UNSIGNED_SHORT=5,lN.TEXTURETYPE_INT=6,lN.TEXTURETYPE_UNSIGNED_INTEGER=7,lN.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,lN.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,lN.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,lN.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,lN.TEXTURETYPE_UNSIGNED_INT_24_8=12,lN.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,lN.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,lN.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,lN.TEXTURETYPE_UNDEFINED=16,lN.TEXTURE_2D=3553,lN.TEXTURE_2D_ARRAY=35866,lN.TEXTURE_CUBE_MAP=34067,lN.TEXTURE_CUBE_MAP_ARRAY=3735928559,lN.TEXTURE_3D=32879,lN.TEXTURE_NEAREST_SAMPLINGMODE=1,lN.TEXTURE_NEAREST_NEAREST=1,lN.TEXTURE_BILINEAR_SAMPLINGMODE=2,lN.TEXTURE_LINEAR_LINEAR=2,lN.TEXTURE_TRILINEAR_SAMPLINGMODE=3,lN.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,lN.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,lN.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,lN.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,lN.TEXTURE_NEAREST_LINEAR=7,lN.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,lN.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,lN.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,lN.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,lN.TEXTURE_LINEAR_NEAREST=12,lN.TEXTURE_EXPLICIT_MODE=0,lN.TEXTURE_SPHERICAL_MODE=1,lN.TEXTURE_PLANAR_MODE=2,lN.TEXTURE_CUBIC_MODE=3,lN.TEXTURE_PROJECTION_MODE=4,lN.TEXTURE_SKYBOX_MODE=5,lN.TEXTURE_INVCUBIC_MODE=6,lN.TEXTURE_EQUIRECTANGULAR_MODE=7,lN.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,lN.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,lN.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,lN.TEXTURE_FILTERING_QUALITY_HIGH=64,lN.TEXTURE_FILTERING_QUALITY_MEDIUM=16,lN.TEXTURE_FILTERING_QUALITY_LOW=8,lN.SCALEMODE_FLOOR=1,lN.SCALEMODE_NEAREST=2,lN.SCALEMODE_CEILING=3,lN.MATERIAL_TextureDirtyFlag=1,lN.MATERIAL_LightDirtyFlag=2,lN.MATERIAL_FresnelDirtyFlag=4,lN.MATERIAL_AttributesDirtyFlag=8,lN.MATERIAL_MiscDirtyFlag=16,lN.MATERIAL_PrePassDirtyFlag=32,lN.MATERIAL_AllDirtyFlag=63,lN.MATERIAL_TriangleFillMode=0,lN.MATERIAL_WireFrameFillMode=1,lN.MATERIAL_PointFillMode=2,lN.MATERIAL_PointListDrawMode=3,lN.MATERIAL_LineListDrawMode=4,lN.MATERIAL_LineLoopDrawMode=5,lN.MATERIAL_LineStripDrawMode=6,lN.MATERIAL_TriangleStripDrawMode=7,lN.MATERIAL_TriangleFanDrawMode=8,lN.MATERIAL_ClockWiseSideOrientation=0,lN.MATERIAL_CounterClockWiseSideOrientation=1,lN.ACTION_NothingTrigger=0,lN.ACTION_OnPickTrigger=1,lN.ACTION_OnLeftPickTrigger=2,lN.ACTION_OnRightPickTrigger=3,lN.ACTION_OnCenterPickTrigger=4,lN.ACTION_OnPickDownTrigger=5,lN.ACTION_OnDoublePickTrigger=6,lN.ACTION_OnPickUpTrigger=7,lN.ACTION_OnPickOutTrigger=16,lN.ACTION_OnLongPressTrigger=8,lN.ACTION_OnPointerOverTrigger=9,lN.ACTION_OnPointerOutTrigger=10,lN.ACTION_OnEveryFrameTrigger=11,lN.ACTION_OnIntersectionEnterTrigger=12,lN.ACTION_OnIntersectionExitTrigger=13,lN.ACTION_OnKeyDownTrigger=14,lN.ACTION_OnKeyUpTrigger=15,lN.PARTICLES_BILLBOARDMODE_Y=2,lN.PARTICLES_BILLBOARDMODE_ALL=7,lN.PARTICLES_BILLBOARDMODE_STRETCHED=8,lN.PARTICLES_BILLBOARDMODE_STRETCHED_LOCAL=9,lN.MESHES_CULLINGSTRATEGY_STANDARD=0,lN.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,lN.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,lN.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,lN.SCENELOADER_NO_LOGGING=0,lN.SCENELOADER_MINIMAL_LOGGING=1,lN.SCENELOADER_SUMMARY_LOGGING=2,lN.SCENELOADER_DETAILED_LOGGING=3,lN.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,lN.PREPASS_POSITION_TEXTURE_TYPE=1,lN.PREPASS_VELOCITY_TEXTURE_TYPE=2,lN.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,lN.PREPASS_COLOR_TEXTURE_TYPE=4,lN.PREPASS_DEPTH_TEXTURE_TYPE=5,lN.PREPASS_NORMAL_TEXTURE_TYPE=6,lN.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7,lN.PREPASS_WORLD_NORMAL_TEXTURE_TYPE=8,lN.PREPASS_LOCAL_POSITION_TEXTURE_TYPE=9,lN.PREPASS_SCREENSPACE_DEPTH_TEXTURE_TYPE=10,lN.PREPASS_VELOCITY_LINEAR_TEXTURE_TYPE=11,lN.PREPASS_ALBEDO_TEXTURE_TYPE=12,lN.BUFFER_CREATIONFLAG_READ=1,lN.BUFFER_CREATIONFLAG_WRITE=2,lN.BUFFER_CREATIONFLAG_READWRITE=3,lN.BUFFER_CREATIONFLAG_UNIFORM=4,lN.BUFFER_CREATIONFLAG_VERTEX=8,lN.BUFFER_CREATIONFLAG_INDEX=16,lN.BUFFER_CREATIONFLAG_STORAGE=32,lN.BUFFER_CREATIONFLAG_INDIRECT=64,lN.RENDERPASS_MAIN=0,lN.INPUT_ALT_KEY=18,lN.INPUT_CTRL_KEY=17,lN.INPUT_META_KEY1=91,lN.INPUT_META_KEY2=92,lN.INPUT_META_KEY3=93,lN.INPUT_SHIFT_KEY=16,lN.SNAPSHOTRENDERING_STANDARD=0,lN.SNAPSHOTRENDERING_FAST=1,lN.PERSPECTIVE_CAMERA=0,lN.ORTHOGRAPHIC_CAMERA=1,lN.FOVMODE_VERTICAL_FIXED=0,lN.FOVMODE_HORIZONTAL_FIXED=1,lN.RIG_MODE_NONE=0,lN.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,lN.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,lN.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,lN.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,lN.RIG_MODE_STEREOSCOPIC_INTERLACED=14,lN.RIG_MODE_VR=20,lN.RIG_MODE_CUSTOM=22,lN.MAX_SUPPORTED_UV_SETS=6,lN.GL_ALPHA_EQUATION_ADD=32774,lN.GL_ALPHA_EQUATION_MIN=32775,lN.GL_ALPHA_EQUATION_MAX=32776,lN.GL_ALPHA_EQUATION_SUBTRACT=32778,lN.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779,lN.GL_ALPHA_FUNCTION_SRC=768,lN.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769,lN.GL_ALPHA_FUNCTION_SRC_ALPHA=770,lN.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771,lN.GL_ALPHA_FUNCTION_DST_ALPHA=772,lN.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773,lN.GL_ALPHA_FUNCTION_DST_COLOR=774,lN.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775,lN.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776,lN.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769,lN.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770,lN.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771,lN.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772,lN.GL_ALPHA_FUNCTION_SRC1_COLOR=35065,lN.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_COLOR=35066,lN.GL_ALPHA_FUNCTION_SRC1_ALPHA=34185,lN.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_ALPHA=35067,lN.SnippetUrl="https://snippet.babylonjs.com",lN.FOGMODE_NONE=0,lN.FOGMODE_EXP=1,lN.FOGMODE_EXP2=2,lN.FOGMODE_LINEAR=3,lN.BYTE=5120,lN.UNSIGNED_BYTE=5121,lN.SHORT=5122,lN.UNSIGNED_SHORT=5123,lN.INT=5124,lN.UNSIGNED_INT=5125,lN.FLOAT=5126,lN.PositionKind="position",lN.NormalKind="ld",lN.TangentKind="tangent",lN.UVKind="uv",lN.UV2Kind="uv2",lN.UV3Kind="uv3",lN.UV4Kind="uv4",lN.UV5Kind="uv5",lN.UV6Kind="uv6",lN.ColorKind="color",lN.ColorInstanceKind="instanceColor",lN.MatricesIndicesKind="matricesIndices",lN.MatricesWeightsKind="matricesWeights",lN.MatricesIndicesExtraKind="matricesIndicesExtra",lN.MatricesWeightsExtraKind="matricesWeightsExtra";class uN{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:lN.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(N,Z){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...uN._GetDefaultOptions(),...N},this._scene=Z,this._scene._transmissionHelper=this,this.onErrorObservable=new j.d,this._scene.pd.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(N){if(!Object.keys(N).filter((Z=>this._options[Z]!==N[Z])).length)return;const Z={...this._options,...N},d=this._options;this._options=Z,Z.renderSize===d.renderSize&&Z.renderTargetTextureType===d.renderTargetTextureType&&Z.generateMipmaps===d.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=Z.samples,this._opaqueRenderTarget.lodGenerationScale=Z.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=Z.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(N){return!!N&&!!(N instanceof V&&N.subSurface.isRefractionEnabled)}_addMesh(N){this._materialObservers[N.uniqueId]=N.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),z.g.SetImmediate((()=>{this._shouldRenderAsTransmission(N.material)?(N.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(N)&&this._transparentMeshesCache.push(N)):-1===this._opaqueMeshesCache.indexOf(N)&&this._opaqueMeshesCache.push(N)}))}_removeMesh(N){N.onMaterialChangedObservable.remove(this._materialObservers[N.uniqueId]),delete this._materialObservers[N.uniqueId];let Z=this._transparentMeshesCache.indexOf(N);-1!==Z&&this._transparentMeshesCache.splice(Z,1),Z=this._opaqueMeshesCache.indexOf(N),-1!==Z&&this._opaqueMeshesCache.splice(Z,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(N){const Z=this._transparentMeshesCache.indexOf(N),d=this._opaqueMeshesCache.indexOf(N);this._shouldRenderAsTransmission(N.material)?(N.material instanceof V&&(N.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==d?(this._opaqueMeshesCache.splice(d,1),this._transparentMeshesCache.push(N)):-1===Z&&this._transparentMeshesCache.push(N)):-1!==Z?(this._transparentMeshesCache.splice(Z,1),this._opaqueMeshesCache.push(N)):-1===d&&this._opaqueMeshesCache.push(N)}_isRenderTargetValid(){var N;return null!==(null===(N=this._opaqueRenderTarget)||void 0===N?void 0:N.getInternalTexture())}_setupRenderTargets(){var N;let Z,d;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new yN.e("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(N=this._options.clearColor)||void 0===N?void 0:N.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((N=>{d=this._scene.environmentIntensity,this._scene.environmentIntensity=1,Z=this._scene.imageProcessingConfiguration.applyByPostProcess,this._options.clearColor?N.clearColor.p(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(N.clearColor,this._scene.getEngine().useExactSrgbConversions),this._scene.imageProcessingConfiguration._applyByPostProcess=!0})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=d,this._scene.imageProcessingConfiguration._applyByPostProcess=Z})),this._transparentMeshesCache.forEach((N=>{this._shouldRenderAsTransmission(N.material)&&(N.material.refractionTexture=this._opaqueRenderTarget)}))}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const aN="KHR_materials_transmission";class cN{constructor(N){this.name=aN,this.order=175,this._loader=N,this.enabled=this._loader.isExtensionUsed(aN),this.enabled&&(N.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,Z,d){return R.LoadExtensionAsync(N,Z,this.name,((X,I)=>{const m=new Array;return m.push(this._loader.loadMaterialPropertiesAsync(N,Z,d)),m.push(this._loadTransparentPropertiesAsync(X,Z,d,I)),Promise.all(m).then((()=>{}))}))}_loadTransparentPropertiesAsync(N,Z,d,X){if(!(d instanceof V))throw new Error(`${N}: Material type not supported`);const I=d;if(I.subSurface.isRefractionEnabled=!0,I.subSurface.volumeIndexOfRefraction=1,I.subSurface.useAlbedoToTintRefraction=!0,void 0===X.transmissionFactor)return I.subSurface.refractionIntensity=0,I.subSurface.isRefractionEnabled=!1,Promise.resolve();{var m;I.subSurface.refractionIntensity=X.transmissionFactor;const N=I.va();if(I.subSurface.refractionIntensity&&!N._transmissionHelper)new uN({},I.va());else if(I.subSurface.refractionIntensity&&(null===(m=N._transmissionHelper)||void 0===m||!m._isRenderTargetValid())){var z;null===(z=N._transmissionHelper)||void 0===z||z._setupRenderTargets()}}return I.subSurface.minimumThickness=0,I.subSurface.maximumThickness=0,X.transmissionTexture?(X.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${N}/transmissionTexture`,X.transmissionTexture,void 0).then((N=>{N.name=`${d.name} (Transmission)`,I.subSurface.refractionIntensityTexture=N,I.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}u(aN),l(aN,!0,(N=>new cN(N)));const RN="KHR_materials_diffuse_transmission";class fN{constructor(N){this.name=RN,this.order=174,this._loader=N,this.enabled=this._loader.isExtensionUsed(RN),this.enabled&&(N.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,Z,d){return R.LoadExtensionAsync(N,Z,this.name,((X,I)=>{const m=new Array;return m.push(this._loader.loadMaterialPropertiesAsync(N,Z,d)),m.push(this._loadTranslucentPropertiesAsync(X,Z,d,I)),Promise.all(m).then((()=>{}))}))}_loadTranslucentPropertiesAsync(N,Z,d,X){if(!(d instanceof V))throw new Error(`${N}: Material type not supported`);const I=d;if(I.subSurface.isTranslucencyEnabled=!0,I.subSurface.volumeIndexOfRefraction=1,I.subSurface.minimumThickness=0,I.subSurface.maximumThickness=0,I.subSurface.useAlbedoToTintTranslucency=!1,void 0===X.diffuseTransmissionFactor)return I.subSurface.translucencyIntensity=0,I.subSurface.isTranslucencyEnabled=!1,Promise.resolve();I.subSurface.translucencyIntensity=X.diffuseTransmissionFactor;const z=new Array;return I.subSurface.useGltfStyleTextures=!0,X.diffuseTransmissionTexture&&(X.diffuseTransmissionTexture.nonColorData=!0,z.push(this._loader.loadTextureInfoAsync(`${N}/diffuseTransmissionTexture`,X.diffuseTransmissionTexture).then((N=>{N.name=`${d.name} (Diffuse Transmission)`,I.subSurface.translucencyIntensityTexture=N})))),void 0!==X.diffuseTransmissionColorFactor?I.subSurface.translucencyColor=m.b._c(X.diffuseTransmissionColorFactor):I.subSurface.translucencyColor=m.b.White(),X.diffuseTransmissionColorTexture&&z.push(this._loader.loadTextureInfoAsync(`${N}/diffuseTransmissionColorTexture`,X.diffuseTransmissionColorTexture).then((N=>{N.name=`${d.name} (Diffuse Transmission Color)`,I.subSurface.translucencyColorTexture=N}))),Promise.all(z).then((()=>{}))}}u(RN),l(RN,!0,(N=>new fN(N)));const oN="KHR_materials_volume";class NZ{constructor(N){this.name=oN,this.order=173,this._loader=N,this.enabled=this._loader.isExtensionUsed(oN),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(N,Z,d){return R.LoadExtensionAsync(N,Z,this.name,((X,I)=>{const m=new Array;return m.push(this._loader.loadMaterialPropertiesAsync(N,Z,d)),m.push(this._loadVolumePropertiesAsync(X,Z,d,I)),Promise.all(m).then((()=>{}))}))}_loadVolumePropertiesAsync(N,Z,d,X){if(!(d instanceof V))throw new Error(`${N}: Material type not supported`);if(!d.subSurface.isRefractionEnabled&&!d.subSurface.isTranslucencyEnabled||!X.thicknessFactor)return Promise.resolve();d.subSurface.volumeIndexOfRefraction=d.indexOfRefraction;const I=void 0!==X.attenuationDistance?X.attenuationDistance:Number.MAX_VALUE;return d.subSurface.tintColorAtDistance=I,void 0!==X.attenuationColor&&3==X.attenuationColor.length&&d.subSurface.tintColor.fd(X.attenuationColor[0],X.attenuationColor[1],X.attenuationColor[2]),d.subSurface.minimumThickness=0,d.subSurface.maximumThickness=X.thicknessFactor,d.subSurface.useThicknessAsDepth=!0,X.thicknessTexture?(X.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${N}/thicknessTexture`,X.thicknessTexture).then((N=>{N.name=`${d.name} (Thickness)`,d.subSurface.thicknessTexture=N,d.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}u(oN),l(oN,!0,(N=>new NZ(N)));const ZZ="KHR_materials_dispersion";class dZ{constructor(N){this.name=ZZ,this.order=174,this._loader=N,this.enabled=this._loader.isExtensionUsed(ZZ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,Z,d){return R.LoadExtensionAsync(N,Z,this.name,((X,I)=>{const m=new Array;return m.push(this._loader.loadMaterialPropertiesAsync(N,Z,d)),m.push(this._loadDispersionPropertiesAsync(X,Z,d,I)),Promise.all(m).then((()=>{}))}))}_loadDispersionPropertiesAsync(N,Z,d,X){if(!(d instanceof V))throw new Error(`${N}: Material type not supported`);return d.subSurface.isRefractionEnabled&&X.dispersion?(d.subSurface.isDispersionEnabled=!0,d.subSurface.dispersion=X.dispersion,Promise.resolve()):Promise.resolve()}}u(ZZ),l(ZZ,!0,(N=>new dZ(N)));const XZ="KHR_mesh_quantization";class IZ{constructor(N){this.name=XZ,this.enabled=N.isExtensionUsed(XZ)}dispose(){}}u(XZ),l(XZ,!0,(N=>new IZ(N)));const mZ="KHR_texture_basisu";class zZ{constructor(N){this.name=mZ,this._loader=N,this.enabled=N.isExtensionUsed(mZ)}dispose(){this._loader=null}_loadTextureAsync(N,Z,d){return R.LoadExtensionAsync(N,Z,this.name,((X,I)=>{const m=void 0==Z.sampler?R.DefaultSampler:c.Get(`${N}/sampler`,this._loader.bj.samplers,Z.sampler),z=c.Get(`${X}/source`,this._loader.bj.images,I.source);return this._loader._createTextureAsync(N,m,z,(N=>{d(N)}),Z._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!Z._textureInfo.nonColorData)}))}}u(mZ),l(mZ,!0,(N=>new zZ(N)));const wZ="KHR_texture_transform";class SZ{constructor(N){this.name=wZ,this._loader=N,this.enabled=this._loader.isExtensionUsed(wZ)}dispose(){this._loader=null}loadTextureInfoAsync(N,Z,d){return R.LoadExtensionAsync(N,Z,this.name,((X,I)=>this._loader.loadTextureInfoAsync(N,Z,(N=>{if(!(N instanceof O.c))throw new Error(`${X}: Texture type not supported`);I.offset&&(N.uOffset=I.offset[0],N.vOffset=I.offset[1]),N.uRotationCenter=0,N.vRotationCenter=0,I.rotation&&(N.wAng=-I.rotation),I.scale&&(N.uScale=I.scale[0],N.vScale=I.scale[1]),void 0!=I.texCoord&&(N.coordinatesIndex=I.texCoord),d(N)}))))}}u(wZ),l(wZ,!0,(N=>new SZ(N)));const eZ="KHR_xmp_json_ld";class jZ{constructor(N){this.name=eZ,this.order=100,this._loader=N,this.enabled=this._loader.isExtensionUsed(eZ)}dispose(){this._loader=null}onLoading(){var N,Z,d;if(null===this._loader.rootBabylonMesh)return;const X=null===(N=this._loader.bj.extensions)||void 0===N?void 0:N.KHR_xmp_json_ld,I=null===(Z=this._loader.bj.asset)||void 0===Z||null===(d=Z.extensions)||void 0===d?void 0:d.KHR_xmp_json_ld;if(X&&I){const N=+I.packet;X.packets&&N<X.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=X.packets[N])}}}function BZ(N,Z,d,X){return m.b._c(Z,d).scale(X)}function DZ(N,Z,d,X){return Z[d]*X}function vZ(N,Z,d,X){return-Z[d]*X}function TZ(N,Z,d,X){return Z[d+1]*X}function kZ(N,Z,d,X){return Z[d]*X*2}function hZ(N){return{scale:[new CZ(D.b.ANIMATIONTYPE_FLOAT,`${N}.uScale`,DZ,(()=>2)),new CZ(D.b.ANIMATIONTYPE_FLOAT,`${N}.vScale`,TZ,(()=>2))],offset:[new CZ(D.b.ANIMATIONTYPE_FLOAT,`${N}.uOffset`,DZ,(()=>2)),new CZ(D.b.ANIMATIONTYPE_FLOAT,`${N}.vOffset`,TZ,(()=>2))],rotation:[new CZ(D.b.ANIMATIONTYPE_FLOAT,`${N}.wAng`,vZ,(()=>1))]}}u(eZ),l(eZ,!0,(N=>new jZ(N)));class UZ extends L{buildAnimations(N,Z,d,X,I){I(N._babylonCamera,this._buildAnimation(Z,d,X))}}class CZ extends L{buildAnimations(N,Z,d,X,I){for(const m in N._data)I(N._data[m].babylonMaterial,this._buildAnimation(Z,d,X))}}class MZ extends L{buildAnimations(N,Z,d,X,I){I(N._babylonLight,this._buildAnimation(Z,d,X))}}const QZ={__array__:{__target__:!0,...i}},AZ={__array__:{__target__:!0,orthographic:{xmag:[new UZ(D.b.ANIMATIONTYPE_FLOAT,"orthoLeft",vZ,(()=>1)),new UZ(D.b.ANIMATIONTYPE_FLOAT,"orthoRight",TZ,(()=>1))],ymag:[new UZ(D.b.ANIMATIONTYPE_FLOAT,"orthoBottom",vZ,(()=>1)),new UZ(D.b.ANIMATIONTYPE_FLOAT,"orthoTop",TZ,(()=>1))],zfar:[new UZ(D.b.ANIMATIONTYPE_FLOAT,"maxZ",DZ,(()=>1))],znear:[new UZ(D.b.ANIMATIONTYPE_FLOAT,"gj",DZ,(()=>1))]},perspective:{yfov:[new UZ(D.b.ANIMATIONTYPE_FLOAT,"fov",DZ,(()=>1))],zfar:[new UZ(D.b.ANIMATIONTYPE_FLOAT,"maxZ",DZ,(()=>1))],znear:[new UZ(D.b.ANIMATIONTYPE_FLOAT,"gj",DZ,(()=>1))]}}},nZ={nodes:QZ,materials:{__array__:{__target__:!0,pbrMetallicRoughness:{baseColorFactor:[new CZ(D.b.ANIMATIONTYPE_COLOR3,"albedoColor",BZ,(()=>4)),new CZ(D.b.ANIMATIONTYPE_FLOAT,"alpha",(function(N,Z,d,X){return Z[d+3]*X}),(()=>4))],metallicFactor:[new CZ(D.b.ANIMATIONTYPE_FLOAT,"metallic",DZ,(()=>1))],roughnessFactor:[new CZ(D.b.ANIMATIONTYPE_FLOAT,"roughness",DZ,(()=>1))],baseColorTexture:{extensions:{KHR_texture_transform:hZ("albedoTexture")}},metallicRoughnessTexture:{extensions:{KHR_texture_transform:hZ("metallicTexture")}}},emissiveFactor:[new CZ(D.b.ANIMATIONTYPE_COLOR3,"emissiveColor",BZ,(()=>3))],normalTexture:{scale:[new CZ(D.b.ANIMATIONTYPE_FLOAT,"bumpTexture.level",DZ,(()=>1))],extensions:{KHR_texture_transform:hZ("bumpTexture")}},occlusionTexture:{strength:[new CZ(D.b.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",DZ,(()=>1))],extensions:{KHR_texture_transform:hZ("ambientTexture")}},emissiveTexture:{extensions:{KHR_texture_transform:hZ("emissiveTexture")}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:[new CZ(D.b.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",DZ,(()=>1))],anisotropyRotation:[new CZ(D.b.ANIMATIONTYPE_FLOAT,"anisotropy.angle",DZ,(()=>1))],anisotropyTexture:{extensions:{KHR_texture_transform:hZ("anisotropy.texture")}}},KHR_materials_clearcoat:{clearcoatFactor:[new CZ(D.b.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",DZ,(()=>1))],clearcoatRoughnessFactor:[new CZ(D.b.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",DZ,(()=>1))],clearcoatTexture:{extensions:{KHR_texture_transform:hZ("clearCoat.texture")}},clearcoatNormalTexture:{scale:[new CZ(D.b.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",DZ,(()=>1))],extensions:{KHR_texture_transform:hZ("clearCoat.bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:hZ("clearCoat.textureRoughness")}}},KHR_materials_dispersion:{dispersion:[new CZ(D.b.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",DZ,(()=>1))]},KHR_materials_emissive_strength:{emissiveStrength:[new CZ(D.b.ANIMATIONTYPE_FLOAT,"emissiveIntensity",DZ,(()=>1))]},KHR_materials_ior:{ior:[new CZ(D.b.ANIMATIONTYPE_FLOAT,"indexOfRefraction",DZ,(()=>1))]},KHR_materials_iridescence:{iridescenceFactor:[new CZ(D.b.ANIMATIONTYPE_FLOAT,"iridescence.intensity",DZ,(()=>1))],iridescenceIor:[new CZ(D.b.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",DZ,(()=>1))],iridescenceThicknessMinimum:[new CZ(D.b.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",DZ,(()=>1))],iridescenceThicknessMaximum:[new CZ(D.b.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",DZ,(()=>1))],iridescenceTexture:{extensions:{KHR_texture_transform:hZ("iridescence.texture")}},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:hZ("iridescence.thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:[new CZ(D.b.ANIMATIONTYPE_COLOR3,"sheen.color",BZ,(()=>3))],sheenRoughnessFactor:[new CZ(D.b.ANIMATIONTYPE_FLOAT,"sheen.roughness",DZ,(()=>1))],sheenColorTexture:{extensions:{KHR_texture_transform:hZ("sheen.texture")}},sheenRoughnessTexture:{extensions:{KHR_texture_transform:hZ("sheen.textureRoughness")}}},KHR_materials_specular:{specularFactor:[new CZ(D.b.ANIMATIONTYPE_FLOAT,"metallicF0Factor",DZ,(()=>1))],specularColorFactor:[new CZ(D.b.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",BZ,(()=>3))],specularTexture:{extensions:{KHR_texture_transform:hZ("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:hZ("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:[new CZ(D.b.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",DZ,(()=>1))],transmissionTexture:{extensions:{KHR_texture_transform:hZ("subSurface.refractionIntensityTexture")}}},KHR_materials_volume:{attenuationColor:[new CZ(D.b.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",BZ,(()=>3))],attenuationDistance:[new CZ(D.b.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",DZ,(()=>1))],thicknessFactor:[new CZ(D.b.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",DZ,(()=>1))],thicknessTexture:{extensions:{KHR_texture_transform:hZ("subSurface.thicknessTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:[new CZ(D.b.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",DZ,(()=>1))],diffuseTransmissionTexture:{extensions:{KHR_texture_transform:hZ("subSurface.translucencyIntensityTexture")}},diffuseTransmissionColorFactor:[new CZ(D.b.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",BZ,(()=>3))],diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:hZ("subSurface.translucencyColorTexture")}}}}}},cameras:AZ,extensions:{KHR_lights_punctual:{lights:{__array__:{__target__:!0,color:[new MZ(D.b.ANIMATIONTYPE_COLOR3,"diffuse",BZ,(()=>3))],kj:[new MZ(D.b.ANIMATIONTYPE_FLOAT,"intensity",DZ,(()=>1))],range:[new MZ(D.b.ANIMATIONTYPE_FLOAT,"range",DZ,(()=>1))],spot:{innerConeAngle:[new MZ(D.b.ANIMATIONTYPE_FLOAT,"innerAngle",kZ,(()=>1))],outerConeAngle:[new MZ(D.b.ANIMATIONTYPE_FLOAT,"angle",kZ,(()=>1))]}}}}}};class gZ{constructor(N,Z){this._gltf=N,this._infoTree=Z}convert(N){let Z,d=this._gltf,X=this._infoTree;if(!N.startsWith("/"))throw new Error("Path must start with a /");const I=N.split("/");I.shift();for(const m of I){if(X.__array__)X=X.__array__;else if(X=X[m],!X)throw new Error(`Path ${N} is invalid`);if(void 0===d)throw new Error(`Path ${N} is invalid`);d=d[m],X.__target__&&(Z=d)}return{object:Z,info:X}}}const EZ="KHR_animation_pointer";class VZ extends gZ{constructor(N){super(N,nZ)}}class OZ{constructor(N){this.name=EZ,this._loader=N,this._pathToObjectConverter=new VZ(this._loader.bj)}get enabled(){return this._loader.isExtensionUsed(EZ)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(N,Z,d,X,I){var m;const z=null===(m=X.target.extensions)||void 0===m?void 0:m.KHR_animation_pointer;if(!z||!this._pathToObjectConverter)return null;"pointer"!==X.target.path&&k.e.Warn(`${N}/target/path: Value (${X.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=X.target.node&&k.e.Warn(`${N}/target/node: Value (${X.target.node}) must not be present when using the ${this.name} extension`);const w=`${N}/extensions/${this.name}`,S=z.pointer;if(!S)throw new Error(`${w}: Pointer is missing`);try{const m=this._pathToObjectConverter.convert(S);return this._loader._loadAnimationChannelFromTargetInfoAsync(N,Z,d,X,m,I)}catch(e){return k.e.Warn(`${w}/pointer: Invalid pointer (${S}) skipped`),null}}}u(EZ),l(EZ,!0,(N=>new OZ(N)));class KZ{constructor(N,Z,d){this.frame=N,this.action=Z,this.onlyOnce=d,this.isDone=!1}_clone(){return new KZ(this.frame,this.action,this.onlyOnce)}}var rZ=d(1041),PZ=d(1060);class WZ{get loop(){return this._loop}set loop(N){N!==this._loop&&(this._loop=N,this.updateOptions({loop:N}))}get currentTime(){var N;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(N=PZ.c.audioEngine)&&void 0!==N&&N.audioContext&&(this.isPlaying||this.isPaused)){const N=this.isPaused?0:PZ.c.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+N}return 0}get spatialSound(){return this._spatialSound}set spatialSound(N){if(N==this._spatialSound)return;const Z=this.isPlaying;this.pause(),N?(this._spatialSound=N,this._updateSpatialParameters()):this._disableSpatialSound(),Z&&this.play()}constructor(N,Z,d){var X;let m=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,w=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new j.d,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=I.n.Zero(),this._localDirection=new I.n(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=N,d=d||T.e.LastCreatedScene)if(this._scene=d,WZ._SceneComponentInitialization(d),this._readyToPlayCallback=m,this._customAttenuationFunction=(N,Z,d,X,I)=>Z<d?N*(1-Z/d):0,w&&(this.autoplay=w.autoplay||!1,this._loop=w.loop||!1,void 0!==w.volume&&(this._volume=w.volume),this._spatialSound=w.spatialSound??!1,this.maxDistance=w.maxDistance??100,this.useCustomAttenuation=w.useCustomAttenuation??!1,this.rolloffFactor=w.rolloffFactor||1,this.refDistance=w.refDistance||1,this.distanceModel=w.distanceModel||"linear",this._playbackRate=w.playbackRate||1,this._streaming=w.streaming??!1,this._length=w.length,this._offset=w.offset),null!==(X=PZ.c.audioEngine)&&void 0!==X&&X.canUseWebAudio&&PZ.c.audioEngine.audioContext){this._soundGain=PZ.c.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let N=!0;if(Z)try{"string"===typeof Z?(this._urlType="String",this._url=Z):Z instanceof ArrayBuffer?this._urlType="ArrayBuffer":Z instanceof HTMLMediaElement?this._urlType="MediaElement":Z instanceof MediaStream?this._urlType="MediaStream":Z instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(Z)&&(this._urlType="Array");let d=[],X=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=PZ.c.audioEngine.audioContext.createMediaElementSource(Z),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=PZ.c.audioEngine.audioContext.createMediaStreamSource(Z),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":Z.byteLength>0&&(X=!0,this._soundLoaded(Z));break;case"AudioBuffer":this._audioBufferLoaded(Z);break;case"String":d.push(Z);case"Array":0===d.length&&(d=Z);for(let N=0;N<d.length;N++){const Z=d[N];if(X=w&&w.skipCodecCheck||-1!==Z.indexOf(".mp3",Z.length-4)&&PZ.c.audioEngine.isMP3supported||-1!==Z.indexOf(".ogg",Z.length-4)&&PZ.c.audioEngine.isOGGsupported||-1!==Z.indexOf(".wav",Z.length-4)||-1!==Z.indexOf(".m4a",Z.length-4)||-1!==Z.indexOf(".mp4",Z.length-4)||-1!==Z.indexOf("blob:"),X){this._streaming?(this._htmlAudioElement=new Audio(Z),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,z.g.SetCorsBehavior(Z,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(Z,(N=>{this._soundLoaded(N)}),void 0,!0,!0,(N=>{N&&k.e.Error("XHR "+N.status+" error on: "+Z+"."),k.e.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:N=!1}N?X||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):k.e.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(S){k.e.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),PZ.c.audioEngine&&!PZ.c.audioEngine.WarnedWebAudioUnsupported&&(k.e.Error("Web Audio is not supported by your browser."),PZ.c.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var N;null!==(N=PZ.c.audioEngine)&&void 0!==N&&N.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(N){var Z;null!==(Z=PZ.c.audioEngine)&&void 0!==Z&&Z.audioContext&&(this._audioBuffer=N,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(N){var Z;null!==(Z=PZ.c.audioEngine)&&void 0!==Z&&Z.audioContext&&PZ.c.audioEngine.audioContext.decodeAudioData(N,(N=>{this._audioBufferLoaded(N)}),(N=>{k.e.Error("Error while decoding audio data for: "+this.name+" / Error: "+N)}))}setAudioBuffer(N){var Z;null!==(Z=PZ.c.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&(this._audioBuffer=N,this._isReadyToPlay=!0)}updateOptions(N){N&&(this.loop=N.loop??this.loop,this.maxDistance=N.maxDistance??this.maxDistance,this.useCustomAttenuation=N.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=N.rolloffFactor??this.rolloffFactor,this.refDistance=N.refDistance??this.refDistance,this.distanceModel=N.distanceModel??this.distanceModel,this._playbackRate=N.playbackRate??this._playbackRate,this._length=N.length??void 0,this.spatialSound=N.spatialSound??this._spatialSound,this._setOffset(N.offset??void 0),this.setVolume(N.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var N;null!==(N=PZ.c.audioEngine)&&void 0!==N&&N.canUseWebAudio&&PZ.c.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??PZ.c.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var N;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(N=this._soundPanner)||void 0===N||N.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var N;null!==(N=PZ.c.audioEngine)&&void 0!==N&&N.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(N){var Z;null!==(Z=PZ.c.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(N),this._isOutputConnected=!0)}setDirectionalCone(N,Z,d){Z<N?k.e.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=N,this._coneOuterAngle=Z,this._coneOuterGain=d,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(N){if(N!=this._coneInnerAngle){var Z;if(this._coneOuterAngle<N)return void k.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=N,null!==(Z=PZ.c.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(N){if(N!=this._coneOuterAngle){var Z;if(N<this._coneInnerAngle)return void k.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=N,null!==(Z=PZ.c.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(N){var Z;N.equals(this._position)||(this._position.p(N),null!==(Z=PZ.c.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(N){var Z;this._localDirection=N,null!==(Z=PZ.c.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const N=this._connectedTransformNode.getWorldMatrix(),Z=I.n.TransformNormal(this._localDirection,N);Z.normalize(),this._soundPanner.orientationX.value=Z.x,this._soundPanner.orientationY.value=Z.y,this._soundPanner.orientationZ.value=Z.z}updateDistanceFromListener(){var N;if(null!==(N=PZ.c.audioEngine)&&void 0!==N&&N.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const N=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.rc(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,N,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(N){this._customAttenuationFunction=N}play(N,Z,d){var X;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(X=PZ.c.audioEngine)&&void 0!==X&&X.audioContext)try{var I,m;this._clearTimeoutsAndObservers();let X=N?(null===(I=PZ.c.audioEngine)||void 0===I?void 0:I.audioContext.currentTime)+N:null===(m=PZ.c.audioEngine)||void 0===m?void 0:m.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=PZ.c.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const N=()=>{var d;if(null!==(d=PZ.c.audioEngine)&&void 0!==d&&d.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=Z??0;const d=this._htmlAudioElement.play();void 0!==d&&d.catch((()=>{var Z,d;(null===(Z=PZ.c.audioEngine)||void 0===Z||Z.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(d=PZ.c.audioEngine)||void 0===d?void 0:d.onAudioUnlockedObservable.addOnce((()=>{N()})))}))}else{var X;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(X=PZ.c.audioEngine)||void 0===X?void 0:X.onAudioUnlockedObservable.addOnce((()=>{N()}))}};N()}}else{var z;const I=()=>{var I;if(null!==(I=PZ.c.audioEngine)&&void 0!==I&&I.audioContext){var m;if(d=d||this._length,void 0!==Z&&this._setOffset(Z),this._soundSource){const N=this._soundSource;N.onended=()=>{N.disconnect()}}if(this._soundSource=null===(m=PZ.c.audioEngine)||void 0===m?void 0:m.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var z;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==Z&&(this._soundSource.loopStart=Z),void 0!==d&&(this._soundSource.loopEnd=(0|Z)+d),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},X=N?(null===(z=PZ.c.audioEngine)||void 0===z?void 0:z.audioContext.currentTime)+N:PZ.c.audioEngine.audioContext.currentTime;const I=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(X,I,this.loop?void 0:d)}}};"suspended"===(null===(z=PZ.c.audioEngine)||void 0===z?void 0:z.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var N;"suspended"===(null===(N=PZ.c.audioEngine)||void 0===N?void 0:N.audioContext.state)?(PZ.c.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=PZ.c.audioEngine.onAudioUnlockedObservable.addOnce((()=>{I()})))):I()}),500):I()}this._startTime=X,this.isPlaying=!0,this.isPaused=!1}catch(w){k.e.Error("Error while trying to play audio: "+this.name+", "+w.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(N){var Z;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var d;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(d=this._streamingSource)||void 0===d||d.disconnect();this.isPlaying=!1}else if(null!==(Z=PZ.c.audioEngine)&&void 0!==Z&&Z.audioContext&&this._soundSource){const Z=N?PZ.c.audioEngine.audioContext.currentTime+N:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(Z)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var N;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var Z;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(Z=this._streamingSource)||void 0===Z||Z.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(N=PZ.c.audioEngine)&&void 0!==N&&N.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=PZ.c.audioEngine.audioContext.currentTime-this._startTime)}setVolume(N,Z){var d;null!==(d=PZ.c.audioEngine)&&void 0!==d&&d.canUseWebAudio&&this._soundGain&&(Z&&PZ.c.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(PZ.c.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,PZ.c.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(N,PZ.c.audioEngine.audioContext.currentTime+Z)):this._soundGain.gain.value=N),this._volume=N}setPlaybackRate(N){this._playbackRate=N,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(N){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=N,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=N=>this._onRegisterAfterWorldMatrixUpdate(N),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(N){var Z;if(N.getBoundingInfo){const Z=N.getBoundingInfo();this.setPosition(Z.boundingSphere.centerWorld)}else this.setPosition(N.absolutePosition);null!==(Z=PZ.c.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const N=()=>{this._isReadyToPlay?(d._audioBuffer=this.getAudioBuffer(),d._isReadyToPlay=!0,d.autoplay&&d.play(0,this._offset,this._length)):setTimeout(N,300)},Z={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},d=new WZ(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,Z);return this.useCustomAttenuation&&d.setAttenuationFunction(this._customAttenuationFunction),d.setPosition(this._position),d.setPlaybackRate(this._playbackRate),N(),d}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const N={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(N.connectedMeshId=this._connectedTransformNode.id),N.position=this._position.ed(),N.refDistance=this.refDistance,N.distanceModel=this.distanceModel,N.isDirectional=this._isDirectional,N.localDirectionToMesh=this._localDirection.ed(),N.coneInnerAngle=this._coneInnerAngle,N.coneOuterAngle=this._coneOuterAngle,N.coneOuterGain=this._coneOuterGain),N}static Parse(N,Z,d,X){const m=N.name;let z;z=N.url?d+N.url:d+m;const w={autoplay:N.autoplay,loop:N.loop,volume:N.volume,spatialSound:N.spatialSound,maxDistance:N.maxDistance,rolloffFactor:N.rolloffFactor,refDistance:N.refDistance,distanceModel:N.distanceModel,playbackRate:N.playbackRate};let S;if(X){const N=()=>{X._isReadyToPlay?(S._audioBuffer=X.getAudioBuffer(),S._isReadyToPlay=!0,S.autoplay&&S.play(0,S._offset,S._length)):setTimeout(N,300)};S=new WZ(m,new ArrayBuffer(0),Z,null,w),N()}else S=new WZ(m,z,Z,(()=>{Z.removePendingData(S)}),w),Z.addPendingData(S);if(N.position){const Z=I.n._c(N.position);S.setPosition(Z)}if(N.isDirectional&&(S.setDirectionalCone(N.coneInnerAngle||360,N.coneOuterAngle||360,N.coneOuterGain||0),N.localDirectionToMesh)){const Z=I.n._c(N.localDirectionToMesh);S.setLocalDirectionToMesh(Z)}if(N.connectedMeshId){const d=Z.getMeshById(N.connectedMeshId);d&&S.attachToMesh(d)}return N.metadata&&(S.metadata=N.metadata),S}_setOffset(N){this._offset!==N&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=N)}_clearTimeoutsAndObservers(){var N;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(N=PZ.c.audioEngine)||void 0===N||N.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}WZ._SceneComponentInitialization=N=>{throw(0,rZ.b)("AudioSceneComponent")},(0,g.h)("BABYLON.Sound",WZ);class bZ{constructor(N,Z,d){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],Z.length!==d.length)throw new Error("Sounds length does not equal weights length");this.loop=N,this._weights=d;let X=0;for(const m of d)X+=m;const I=X>0?1/X:0;for(let m=0;m<this._weights.length;m++)this._weights[m]*=I;this._sounds=Z;for(const m of this._sounds)m.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(N){if(N!==this._coneInnerAngle){if(this._coneOuterAngle<N)return void k.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=N;for(const Z of this._sounds)Z.directionalConeInnerAngle=N}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(N){if(N!==this._coneOuterAngle){if(N<this._coneInnerAngle)return void k.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=N;for(const Z of this._sounds)Z.directionalConeOuterAngle=N}}get volume(){return this._volume}set volume(N){if(N!==this._volume)for(const Z of this._sounds)Z.setVolume(N)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(N){if(!this.isPaused){this.stop();const N=Math.random();let Z=0;for(let d=0;d<this._weights.length;d++)if(Z+=this._weights[d],N<=Z){this._currentIndex=d;break}}const Z=this._sounds[this._currentIndex??0];Z.isReady()?Z.play(0,this.isPaused?void 0:N):Z.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class JZ{constructor(N){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(N=N||T.e.LastCreatedScene)&&(this._scene=N,this.soundCollection=[],this._options=Z,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var N;null!==(N=PZ.c.audioEngine)&&void 0!==N&&N.canUseWebAudio&&PZ.c.audioEngine.audioContext&&(this._outputAudioNode=PZ.c.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(PZ.c.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(PZ.c.audioEngine&&PZ.c.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(N){var Z;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(Z=PZ.c.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&this._outputAudioNode&&N.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==N.soundTrackId&&(-1===N.soundTrackId?this._scene.mainSoundTrack.removeSound(N):this._scene.soundTracks&&this._scene.soundTracks[N.soundTrackId].removeSound(N)),this.soundCollection.push(N),N.soundTrackId=this.id}removeSound(N){const Z=this.soundCollection.indexOf(N);-1!==Z&&this.soundCollection.splice(Z,1)}setVolume(N){var Z;null!==(Z=PZ.c.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=N)}switchPanningModelToHRTF(){var N;if(null!==(N=PZ.c.audioEngine)&&void 0!==N&&N.canUseWebAudio)for(let Z=0;Z<this.soundCollection.length;Z++)this.soundCollection[Z].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var N;if(null!==(N=PZ.c.audioEngine)&&void 0!==N&&N.canUseWebAudio)for(let Z=0;Z<this.soundCollection.length;Z++)this.soundCollection[Z].switchPanningModelToEqualPower()}connectToAnalyser(N){var Z;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=N,null!==(Z=PZ.c.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,PZ.c.audioEngine.masterGain))}}var FZ=d(1193),GZ=d(1131),xZ=(d(1446),d(1077));(0,d(11482).e)(FZ.e.NAME_AUDIO,((N,Z,d,X)=>{let I,m=[];if(d.Qd=d.Qd||[],void 0!==N.Qd&&null!==N.Qd)for(let w=0,S=N.Qd.length;w<S;w++){var z;const S=N.Qd[w];null!==(z=PZ.c.audioEngine)&&void 0!==z&&z.canUseWebAudio?(S.url||(S.url=S.name),m[S.url]?d.Qd.push(WZ.Parse(S,Z,X,m[S.url])):(I=WZ.Parse(S,Z,X),m[S.url]=I,d.Qd.push(I))):d.Qd.push(new WZ(S.name,null,Z))}m=[]})),Object.defineProperty(GZ.e.prototype,"mainSoundTrack",{get:function(){let N=this._getComponent(FZ.e.NAME_AUDIO);return N||(N=new tZ(this),this.Nd(N)),this._mainSoundTrack||(this._mainSoundTrack=new JZ(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),GZ.e.prototype.getSoundByName=function(N){let Z;for(Z=0;Z<this.mainSoundTrack.soundCollection.length;Z++)if(this.mainSoundTrack.soundCollection[Z].name===N)return this.mainSoundTrack.soundCollection[Z];if(this.soundTracks)for(let d=0;d<this.soundTracks.length;d++)for(Z=0;Z<this.soundTracks[d].soundCollection.length;Z++)if(this.soundTracks[d].soundCollection[Z].name===N)return this.soundTracks[d].soundCollection[Z];return null},Object.defineProperty(GZ.e.prototype,"audioEnabled",{get:function(){let N=this._getComponent(FZ.e.NAME_AUDIO);return N||(N=new tZ(this),this.Nd(N)),N.audioEnabled},set:function(N){let Z=this._getComponent(FZ.e.NAME_AUDIO);Z||(Z=new tZ(this),this.Nd(Z)),N?Z.enableAudio():Z.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(GZ.e.prototype,"headphone",{get:function(){let N=this._getComponent(FZ.e.NAME_AUDIO);return N||(N=new tZ(this),this.Nd(N)),N.headphone},set:function(N){let Z=this._getComponent(FZ.e.NAME_AUDIO);Z||(Z=new tZ(this),this.Nd(Z)),N?Z.switchAudioModeForHeadphones():Z.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(GZ.e.prototype,"audioListenerPositionProvider",{get:function(){let N=this._getComponent(FZ.e.NAME_AUDIO);return N||(N=new tZ(this),this.Nd(N)),N.audioListenerPositionProvider},set:function(N){let Z=this._getComponent(FZ.e.NAME_AUDIO);if(Z||(Z=new tZ(this),this.Nd(Z)),N&&"function"!==typeof N)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");Z.audioListenerPositionProvider=N},enumerable:!0,configurable:!0}),Object.defineProperty(GZ.e.prototype,"audioListenerRotationProvider",{get:function(){let N=this._getComponent(FZ.e.NAME_AUDIO);return N||(N=new tZ(this),this.Nd(N)),N.audioListenerRotationProvider},set:function(N){let Z=this._getComponent(FZ.e.NAME_AUDIO);if(Z||(Z=new tZ(this),this.Nd(Z)),N&&"function"!==typeof N)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");Z.audioListenerRotationProvider=N},enumerable:!0,configurable:!0}),Object.defineProperty(GZ.e.prototype,"audioPositioningRefreshRate",{get:function(){let N=this._getComponent(FZ.e.NAME_AUDIO);return N||(N=new tZ(this),this.Nd(N)),N.audioPositioningRefreshRate},set:function(N){let Z=this._getComponent(FZ.e.NAME_AUDIO);Z||(Z=new tZ(this),this.Nd(Z)),Z.audioPositioningRefreshRate=N},enumerable:!0,configurable:!0});class tZ{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(N){this.name=FZ.e.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new I.n,this._cachedCameraPosition=new I.n,this._lastCheck=0,this._invertMatrixTemp=new I.c,this._cameraDirectionTemp=new I.n,(N=N||T.e.LastCreatedScene)&&(this.Td=N,N.soundTracks=[],N.Qd=[])}register(){this.Td._afterRenderStage.registerStep(FZ.e.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(N){if(N.Qd=[],this.Td.soundTracks)for(let Z=0;Z<this.Td.soundTracks.length;Z++){const d=this.Td.soundTracks[Z];for(let Z=0;Z<d.soundCollection.length;Z++)N.Qd.push(d.soundCollection[Z].serialize())}}addFromContainer(N){N.Qd&&N.Qd.forEach((N=>{N.play(),N.autoplay=!0,this.Td.mainSoundTrack.addSound(N)}))}removeFromContainer(N){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];N.Qd&&N.Qd.forEach((N=>{N.stop(),N.autoplay=!1,this.Td.mainSoundTrack.removeSound(N),Z&&N.dispose()}))}dispose(){const N=this.Td;if(N._mainSoundTrack&&N.mainSoundTrack.dispose(),N.soundTracks)for(let Z=0;Z<N.soundTracks.length;Z++)N.soundTracks[Z].dispose()}disableAudio(){const N=this.Td;let Z;for(this._audioEnabled=!1,PZ.c.audioEngine&&PZ.c.audioEngine.audioContext&&PZ.c.audioEngine.audioContext.suspend(),Z=0;Z<N.mainSoundTrack.soundCollection.length;Z++)N.mainSoundTrack.soundCollection[Z].pause();if(N.soundTracks)for(Z=0;Z<N.soundTracks.length;Z++)for(let d=0;d<N.soundTracks[Z].soundCollection.length;d++)N.soundTracks[Z].soundCollection[d].pause()}enableAudio(){const N=this.Td;let Z;for(this._audioEnabled=!0,PZ.c.audioEngine&&PZ.c.audioEngine.audioContext&&PZ.c.audioEngine.audioContext.resume(),Z=0;Z<N.mainSoundTrack.soundCollection.length;Z++)N.mainSoundTrack.soundCollection[Z].isPaused&&N.mainSoundTrack.soundCollection[Z].play();if(N.soundTracks)for(Z=0;Z<N.soundTracks.length;Z++)for(let d=0;d<N.soundTracks[Z].soundCollection.length;d++)N.soundTracks[Z].soundCollection[d].isPaused&&N.soundTracks[Z].soundCollection[d].play()}switchAudioModeForHeadphones(){const N=this.Td;if(this._headphone=!0,N.mainSoundTrack.switchPanningModelToHRTF(),N.soundTracks)for(let Z=0;Z<N.soundTracks.length;Z++)N.soundTracks[Z].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const N=this.Td;if(this._headphone=!1,N.mainSoundTrack.switchPanningModelToEqualPower(),N.soundTracks)for(let Z=0;Z<N.soundTracks.length;Z++)N.soundTracks[Z].switchPanningModelToEqualPower()}_afterRender(){const N=xZ.d.Now;if(this._lastCheck&&N-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=N;const Z=this.Td;if(!this._audioEnabled||!Z._mainSoundTrack||!Z.soundTracks||0===Z._mainSoundTrack.soundCollection.length&&1===Z.soundTracks.length)return;const d=PZ.c.audioEngine;if(d&&d.audioContext){let N,X=Z.activeCamera;if(Z.activeCameras&&Z.activeCameras.length>0&&(X=Z.activeCameras[0]),this.audioListenerPositionProvider){const N=this.audioListenerPositionProvider();d.audioContext.listener.setPosition(N.x||0,N.y||0,N.z||0)}else X?this._cachedCameraPosition.equals(X.globalPosition)||(this._cachedCameraPosition.p(X.globalPosition),d.audioContext.listener.setPosition(X.globalPosition.x,X.globalPosition.y,X.globalPosition.z)):d.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const N=this.audioListenerRotationProvider();d.audioContext.listener.setOrientation(N.x||0,N.y||0,N.z||0,0,1,0)}else X?(X.rigCameras&&X.rigCameras.length>0&&(X=X.rigCameras[0]),X.getViewMatrix().invertToRef(this._invertMatrixTemp),I.n.TransformNormalToRef(tZ._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.p(this._cameraDirectionTemp),d.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):d.audioContext.listener.setOrientation(0,0,0,0,1,0);for(N=0;N<Z.mainSoundTrack.soundCollection.length;N++){const d=Z.mainSoundTrack.soundCollection[N];d.useCustomAttenuation&&d.updateDistanceFromListener()}if(Z.soundTracks)for(N=0;N<Z.soundTracks.length;N++)for(let d=0;d<Z.soundTracks[N].soundCollection.length;d++){const X=Z.soundTracks[N].soundCollection[d];X.useCustomAttenuation&&X.updateDistanceFromListener()}}}}tZ._CameraDirection=new I.n(0,0,-1),WZ._SceneComponentInitialization=N=>{let Z=N._getComponent(FZ.e.NAME_AUDIO);Z||(Z=new tZ(N),N.Nd(Z))};const qZ="MSFT_audio_emitter";class YZ{constructor(N){this.name=qZ,this._loader=N,this.enabled=this._loader.isExtensionUsed(qZ)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const N=this._loader.bj.extensions;if(N&&N[this.name]){const Z=N[this.name];this._clips=Z.clips,this._emitters=Z.emitters,c.Assign(this._clips),c.Assign(this._emitters)}}loadSceneAsync(N,Z){return R.LoadExtensionAsync(N,Z,this.name,((d,X)=>{const I=new Array;I.push(this._loader.loadSceneAsync(N,Z));for(const N of X.emitters){const Z=c.Get(`${d}/emitters`,this._emitters,N);if(void 0!=Z.refDistance||void 0!=Z.maxDistance||void 0!=Z.rolloffFactor||void 0!=Z.distanceModel||void 0!=Z.innerAngle||void 0!=Z.outerAngle)throw new Error(`${d}: Direction or Distance properties are not allowed on emitters attached to a scene`);I.push(this._loadEmitterAsync(`${d}/emitters/${Z.index}`,Z))}return Promise.all(I).then((()=>{}))}))}loadNodeAsync(N,Z,d){return R.LoadExtensionAsync(N,Z,this.name,((N,X)=>{const m=new Array;return this._loader.loadNodeAsync(N,Z,(Z=>{for(const d of X.emitters){const X=c.Get(`${N}/emitters`,this._emitters,d);m.push(this._loadEmitterAsync(`${N}/emitters/${X.index}`,X).then((()=>{for(const N of X._babylonSounds)N.attachToMesh(Z),void 0==X.innerAngle&&void 0==X.outerAngle||(N.setLocalDirectionToMesh(I.n.Forward()),N.setDirectionalCone(2*z.g.ToDegrees(void 0==X.innerAngle?Math.PI:X.innerAngle),2*z.g.ToDegrees(void 0==X.outerAngle?Math.PI:X.outerAngle),0))})))}d(Z)})).then((N=>Promise.all(m).then((()=>N))))}))}loadAnimationAsync(N,Z){return R.LoadExtensionAsync(N,Z,this.name,((d,X)=>this._loader.loadAnimationAsync(N,Z).then((I=>{const m=new Array;c.Assign(X.events);for(const z of X.events)m.push(this._loadAnimationEventAsync(`${d}/events/${z.index}`,N,Z,z,I));return Promise.all(m).then((()=>I))}))))}_loadClipAsync(N,Z){if(Z._objectURL)return Z._objectURL;let d;if(Z.uri)d=this._loader.loadUriAsync(N,Z,Z.uri);else{const X=c.Get(`${N}/bufferView`,this._loader.bj.bufferViews,Z.bufferView);d=this._loader.loadBufferViewAsync(`/bufferViews/${X.index}`,X)}return Z._objectURL=d.then((N=>URL.createObjectURL(new Blob([N],{type:Z.mimeType})))),Z._objectURL}_loadEmitterAsync(N,Z){if(Z._babylonSounds=Z._babylonSounds||[],!Z._babylonData){const N=new Array,d=Z.name||`emitter${Z.index}`,X={loop:!1,autoplay:!1,volume:void 0==Z.volume?1:Z.volume};for(let m=0;m<Z.clips.length;m++){const I=`/extensions/${this.name}/clips`,z=c.Get(I,this._clips,Z.clips[m].clip);N.push(this._loadClipAsync(`${I}/${Z.clips[m].clip}`,z).then((N=>{const I=Z._babylonSounds[m]=new WZ(d,N,this._loader.babylonScene,null,X);I.refDistance=Z.refDistance||1,I.maxDistance=Z.maxDistance||256,I.rolloffFactor=Z.rolloffFactor||1,I.distanceModel=Z.distanceModel||"exponential"})))}const I=Promise.all(N).then((()=>{const N=Z.clips.map((N=>N.weight||1)),d=new bZ(Z.loop||!1,Z._babylonSounds,N);Z.innerAngle&&(d.directionalConeInnerAngle=2*z.g.ToDegrees(Z.innerAngle)),Z.outerAngle&&(d.directionalConeOuterAngle=2*z.g.ToDegrees(Z.outerAngle)),Z.volume&&(d.volume=Z.volume),Z._babylonData.sound=d}));Z._babylonData={loaded:I}}return Z._babylonData.loaded}_getEventAction(N,Z,d,X,I){switch(d){case"play":return N=>{const d=(I||0)+(N-X);Z.play(d)};case"stop":return()=>{Z.stop()};case"pause":return()=>{Z.pause()};default:throw new Error(`${N}: Unsupported action ${d}`)}}_loadAnimationEventAsync(N,Z,d,X,I){if(0==I.targetedAnimations.length)return Promise.resolve();const m=I.targetedAnimations[0],z=X.k,w=c.Get(`/extensions/${this.name}/emitters`,this._emitters,z);return this._loadEmitterAsync(N,w).then((()=>{const Z=w._babylonData.sound;if(Z){const d=new KZ(X.time,this._getEventAction(N,Z,X.action,X.time,X.startOffset));m.animation.addEvent(d),I.onAnimationGroupEndObservable.add((()=>{Z.stop()})),I.onAnimationGroupPauseObservable.add((()=>{Z.pause()}))}}))}}u(qZ),l(qZ,!0,(N=>new YZ(N)));const sZ="MSFT_lod";class LZ{constructor(N){var Z;this.name=sZ,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new j.d,this.onMaterialLODsLoadedObservable=new j.d,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=N,this.maxLODsToLoad=(null===(Z=this._loader.parent.extensionOptions[sZ])||void 0===Z?void 0:Z.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(sZ)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let N=0;N<this._nodePromiseLODs.length;N++){const Z=Promise.all(this._nodePromiseLODs[N]).then((()=>{0!==N&&(this._loader.endPerformanceCounter(`Node LOD ${N}`),this._loader.log(`Loaded node LOD ${N}`)),this.onNodeLODsLoadedObservable.notifyObservers(N),N!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${N+1}`),this._loadBufferLOD(this._nodeBufferLODs,N+1),this._nodeSignalLODs[N]&&this._nodeSignalLODs[N].resolve())}));this._loader._completePromises.push(Z)}for(let N=0;N<this._materialPromiseLODs.length;N++){const Z=Promise.all(this._materialPromiseLODs[N]).then((()=>{0!==N&&(this._loader.endPerformanceCounter(`Material LOD ${N}`),this._loader.log(`Loaded material LOD ${N}`)),this.onMaterialLODsLoadedObservable.notifyObservers(N),N!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${N+1}`),this._loadBufferLOD(this._materialBufferLODs,N+1),this._materialSignalLODs[N]&&this._materialSignalLODs[N].resolve())}));this._loader._completePromises.push(Z)}}loadSceneAsync(N,Z){const d=this._loader.loadSceneAsync(N,Z);return this._loadBufferLOD(this._bufferLODs,0),d}loadNodeAsync(N,Z,d){return R.LoadExtensionAsync(N,Z,this.name,((N,I)=>{let m;const z=this._getLODs(N,Z,this._loader.bj.nodes,I.ids);this._loader.logOpen(`${N}`);for(let Z=0;Z<z.length;Z++){const N=z[Z];0!==Z&&(this._nodeIndexLOD=Z,this._nodeSignalLODs[Z]=this._nodeSignalLODs[Z]||new X);const I=N=>{d(N),N.wg(!1)},w=this._loader.loadNodeAsync(`/nodes/${N.index}`,N,I).then((N=>{if(0!==Z){const N=z[Z-1];N._babylonTransformNode&&(this._disposeTransformNode(N._babylonTransformNode),delete N._babylonTransformNode)}return N.wg(!0),N}));this._nodePromiseLODs[Z]=this._nodePromiseLODs[Z]||[],0===Z?m=w:(this._nodeIndexLOD=null,this._nodePromiseLODs[Z].push(w))}return this._loader.logClose(),m}))}_loadMaterialAsync(N,Z,d,X,I){return this._nodeIndexLOD?null:R.LoadExtensionAsync(N,Z,this.name,((N,m)=>{let z;const w=this._getLODs(N,Z,this._loader.bj.materials,m.ids);this._loader.logOpen(`${N}`);for(let Z=0;Z<w.length;Z++){const N=w[Z];0!==Z&&(this._materialIndexLOD=Z);const m=this._loader._loadMaterialAsync(`/materials/${N.index}`,N,d,X,(N=>{0===Z&&I(N)})).then((N=>{if(0!==Z){I(N);const d=w[Z-1]._data;d[X]&&(this._disposeMaterials([d[X].babylonMaterial]),delete d[X])}return N}));this._materialPromiseLODs[Z]=this._materialPromiseLODs[Z]||[],0===Z?z=m:(this._materialIndexLOD=null,this._materialPromiseLODs[Z].push(m))}return this._loader.logClose(),z}))}_loadUriAsync(N,Z,d){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const I=this._nodeIndexLOD-1;return this._nodeSignalLODs[I]=this._nodeSignalLODs[I]||new X,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((()=>this._loader.loadUriAsync(N,Z,d)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const I=this._materialIndexLOD-1;return this._materialSignalLODs[I]=this._materialSignalLODs[I]||new X,this._materialSignalLODs[I].promise.then((()=>this._loader.loadUriAsync(N,Z,d)))}return null}loadBufferAsync(N,Z,d,I){if(this._loader.parent.useRangeRequests&&!Z.uri){if(!this._loader.bin)throw new Error(`${N}: Uri is missing or the binary glTF is missing its binary chunk`);const Z=(N,Z)=>{const m=d,z=m+I-1;let w=N[Z];return w?(w.start=Math.min(w.start,m),w.end=Math.max(w.end,z)):(w={start:m,end:z,loaded:new X},N[Z]=w),w.loaded.promise.then((N=>new Uint8Array(N.buffer,N.byteOffset+d-w.start,I)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?Z(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?Z(this._materialBufferLODs,this._materialIndexLOD):Z(this._bufferLODs,0)}return null}_loadBufferLOD(N,Z){const d=N[Z];d&&(this._loader.log(`Loading buffer range [${d.start}-${d.end}]`),this._loader.bin.readAsync(d.start,d.end-d.start+1).then((N=>{d.loaded.resolve(N)}),(N=>{d.loaded.reject(N)})))}_getLODs(N,Z,d,X){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const I=[];for(let m=X.length-1;m>=0;m--)if(I.push(c.Get(`${N}/ids/${X[m]}`,d,X[m])),I.length===this.maxLODsToLoad)return I;return I.push(Z),I}_disposeTransformNode(N){const Z=[],d=N.material;d&&Z.push(d);for(const I of N.getChildMeshes())I.material&&Z.push(I.material);N.dispose();const X=Z.filter((N=>this._loader.babylonScene.meshes.every((Z=>Z.material!=N))));this._disposeMaterials(X)}_disposeMaterials(N){const Z={};for(const d of N){for(const N of d.getActiveTextures())Z[N.uniqueId]=N;d.dispose()}for(const d in Z)for(const N of this._loader.babylonScene.materials)N.hasTexture(Z[d])&&delete Z[d];for(const d in Z)Z[d].dispose()}}u(sZ),l(sZ,!0,(N=>new LZ(N)));const HZ="MSFT_minecraftMesh";class iZ{constructor(N){this.name=HZ,this._loader=N,this.enabled=this._loader.isExtensionUsed(HZ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,Z,d){return R.LoadExtraAsync(N,Z,this.name,((X,I)=>{if(I){if(!(d instanceof V))throw new Error(`${X}: Material type not supported`);const I=this._loader.loadMaterialPropertiesAsync(N,Z,d);return d.needAlphaBlending()&&(d.forceDepthWrite=!0,d.separateCullingPass=!0),d.ne=d.forceDepthWrite,d.twoSidedLighting=!0,I}return null}))}}u(HZ),l(HZ,!0,(N=>new iZ(N)));const pZ="MSFT_sRGBFactors";class yZ{constructor(N){this.name=pZ,this._loader=N,this.enabled=this._loader.isExtensionUsed(pZ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,Z,d){return R.LoadExtraAsync(N,Z,this.name,((X,I)=>{if(I){if(!(d instanceof V))throw new Error(`${X}: Material type not supported`);const I=this._loader.loadMaterialPropertiesAsync(N,Z,d),m=d.va().getEngine().useExactSrgbConversions;return d.albedoTexture||d.albedoColor.toLinearSpaceToRef(d.albedoColor,m),d.reflectivityTexture||d.reflectivityColor.toLinearSpaceToRef(d.reflectivityColor,m),I}return null}))}}u(pZ),l(pZ,!0,(N=>new yZ(N)));var lZ,uZ=d(1004);!function(N){N[N.Input=0]="Input",N[N.Output=1]="Output"}(lZ||(lZ={}));class aZ{constructor(N,Z,d){this._ownerBlock=d,this._connectedPoint=[],this.uniqueId=(0,uZ.e)(),this.connectedPointIds=[],this.name=N,this._connectionType=Z}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(N){if(this._connectionType===N._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||N._isSingularConnection()&&N._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(N),N._connectedPoint.push(this)}serialize(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};N.uniqueId=this.uniqueId,N.name=this.name,N._connectionType=this._connectionType,N.connectedPointIds=[],N.className=this.getClassName();for(const Z of this._connectedPoint)N.connectedPointIds.push(Z.uniqueId)}getClassName(){return"FGConnection"}deserialize(N){this.uniqueId=N.uniqueId,this.name=N.name,this._connectionType=N._connectionType,this.connectedPointIds=N.connectedPointIds}static Parse(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},Z=arguments.length>1?arguments[1]:void 0;const d=new(z.g.Instantiate(N.className))(N.name,N._connectionType,Z);return d.deserialize(N),d}}class cZ{constructor(N){this.value=this._toInt(N)}_toInt(N){return 0|N}add(N){return new cZ(this.value+N.value)}rc(N){return new cZ(this.value-N.value)}multiply(N){return new cZ(Math.imul(this.value,N.value))}divide(N){return new cZ(this.value/N.value)}getClassName(){return cZ.ClassName}equals(N){return this.value===N.value}static Parse(N){return new cZ(N.value)}}cZ.ClassName="FlowGraphInteger",(0,g.h)("FlowGraphInteger",cZ);class RZ{constructor(N,Z){this.typeName=N,this.defaultValue=Z}serialize(N){N.typeName=this.typeName,N.defaultValue=this.defaultValue}static Parse(N){return new RZ(N.typeName,N.defaultValue)}}const fZ=new RZ("any",void 0),oZ=(new RZ("string",""),new RZ("number",0)),Nd=new RZ("boolean",!1),Zd=new RZ("Vector2",I.l.Zero()),dd=new RZ("kd",I.n.Zero()),Xd=(new RZ("Vector4",I.q.Zero()),new RZ("Matrix",I.c.Identity())),Id=(new RZ("wd",m.b.Black()),new RZ("yd",new m.e(0,0,0,0)),new RZ("Quaternion",I.g.Identity()),new RZ("FlowGraphInteger",new cZ(0)));class md extends aZ{constructor(N,Z,d,X){super(N,Z,d),this.richType=X}_isSingularConnection(){return 0===this.connectionType}setValue(N,Z){Z._setConnectionValue(this,N)}connectTo(N){super.connectTo(N)}_getValueOrDefault(N){return N._hasConnectionValue(this)?N._getConnectionValue(this):this.richType.defaultValue}getValue(N){return 1===this.connectionType?(N._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(N),this._getValueOrDefault(N)):this.isConnected()?this._connectedPoint[0].getValue(N):this._getValueOrDefault(N)}getClassName(){return"FGDataConnection"}serialize(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(N),N.richType={},this.richType.serialize(N.richType)}static Parse(N,Z){const d=aZ.Parse(N,Z);return d.richType=RZ.Parse(N.richType),d}}function zd(N){return"Mesh"===N||"AbstractMesh"===N||"GroundMesh"===N||"InstanceMesh"===N||"LinesMesh"===N||"GoldbergMesh"===N||"GreasedLineMesh"===N||"TrailMesh"===N}function wd(N){return"Vector2"===N||"kd"===N||"Vector4"===N||"Quaternion"===N||"wd"===N||"yd"===N}function Sd(N,Z,d){var X;const I=(null===Z||void 0===Z||null===(X=Z.getClassName)||void 0===X?void 0:X.call(Z))??"";zd(I)?d[N]={name:Z.name,className:I}:wd(I)?d[N]={value:Z.ed(),className:I}:d[N]=Z}function ed(N,Z,d){const X=Z[N];let z;const w=null===X||void 0===X?void 0:X.className;return z=zd(w)?d.getMeshByName(X.name):wd(w)?function(N,Z){if("Vector2"===N)return I.l._c(Z);if("kd"===N)return I.n._c(Z);if("Vector4"===N)return I.q._c(Z);if("Quaternion"===N)return I.g._c(Z);if("wd"===N)return new m.b(Z[0],Z[1],Z[2]);if("yd"===N)return new m.e(Z[0],Z[1],Z[2],Z[3]);throw new Error(`Unknown vector class name ${N}`)}(w,X.value):"Matrix"===w?I.c._c(X.value):w===cZ.ClassName?cZ.Parse(X):X&&void 0!==X.value?X.value:X,z}(0,g.h)("FGDataConnection",md);class jd{constructor(N){var Z;this.config=N,this.uniqueId=(0,uZ.e)(),this.name=(null===(Z=this.config)||void 0===Z?void 0:Z.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(N){}registerDataInput(N,Z){const d=new md(N,0,this,Z);return this.dataInputs.push(d),d}registerDataOutput(N,Z){const d=new md(N,1,this,Z);return this.dataOutputs.push(d),d}getDataInput(N){return this.dataInputs.find((Z=>Z.name===N))}getDataOutput(N){return this.dataOutputs.find((Z=>Z.name===N))}serialize(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};N.uniqueId=this.uniqueId,N.config={},this.config&&(N.config.name=this.config.name),N.dataInputs=[],N.dataOutputs=[],N.className=this.getClassName();for(const Z of this.dataInputs){const d={};Z.serialize(d),N.dataInputs.push(d)}for(const Z of this.dataOutputs){const d={};Z.serialize(d),N.dataOutputs.push(d)}}getClassName(){return"FGBlock"}static Parse(N,Z){const d=z.g.Instantiate(N.className),X={},I=Z.valueParseFunction??ed;if(N.config)for(const z in N.config)X[z]=I(z,N.config,Z.Td);var m;("FGSetPropertyBlock"===(m=N.className)||"FGGetPropertyBlock"===m||"FGPlayAnimationBlock"===m||"FGMeshPickEventBlock"===m)&&(X.pathConverter=Z.pathConverter);const w=new d(X);w.uniqueId=N.uniqueId;for(let z=0;z<N.dataInputs.length;z++){const Z=w.getDataInput(N.dataInputs[z].name);if(!Z)throw new Error("Could not find data input with name "+N.dataInputs[z].name+" in block "+N.className);Z.deserialize(N.dataInputs[z])}for(let z=0;z<N.dataOutputs.length;z++){const Z=w.getDataOutput(N.dataOutputs[z].name);if(!Z)throw new Error("Could not find data output with name "+N.dataOutputs[z].name+" in block "+N.className);Z.deserialize(N.dataOutputs[z])}return w.metadata=N.metadata,w.deserialize&&w.deserialize(N),w}}class Bd extends aZ{_isSingularConnection(){return 1===this.connectionType}_activateSignal(N){var Z;0===this.connectionType?(N._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(N,this),N._increaseExecutionId()):null===(Z=this._connectedPoint[0])||void 0===Z||Z._activateSignal(N)}}(0,g.h)("FlowGraphSignalConnection",Bd);class Dd extends jd{constructor(N){super(N),this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in")}_registerSignalInput(N){const Z=new Bd(N,0,this);return this.signalInputs.push(Z),Z}_registerSignalOutput(N){const Z=new Bd(N,1,this);return this.signalOutputs.push(Z),Z}getSignalInput(N){return this.signalInputs.find((Z=>Z.name===N))}getSignalOutput(N){return this.signalOutputs.find((Z=>Z.name===N))}serialize(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(N),N.signalInputs=[],N.signalOutputs=[];for(const Z of this.signalInputs){const d={};Z.serialize(d),N.signalInputs.push(d)}for(const Z of this.signalOutputs){const d={};Z.serialize(d),N.signalOutputs.push(d)}}deserialize(N){for(let Z=0;Z<N.signalInputs.length;Z++){const d=this.getSignalInput(N.signalInputs[Z].name);if(!d)throw new Error("Could not find signal input with name "+N.signalInputs[Z].name+" in block "+N.className);d.deserialize(N.signalInputs[Z])}for(let Z=0;Z<N.signalOutputs.length;Z++){const d=this.getSignalOutput(N.signalOutputs[Z].name);if(!d)throw new Error("Could not find signal output with name "+N.signalOutputs[Z].name+" in block "+N.className);d.deserialize(N.signalOutputs[Z])}}getClassName(){return"FGExecutionBlock"}}class vd extends Dd{constructor(N){super(N),this.out=this._registerSignalOutput("out"),this.done=this._registerSignalOutput("done")}_startPendingTasks(N){this._preparePendingTasks(N),N._addPendingBlock(this)}}class Td extends vd{_execute(N){N._notifyExecuteNode(this),this.out._activateSignal(N)}}class kd{constructor(N){this.uniqueId=(0,uZ.e)(),this._userVariables={},this._executionVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new j.d,this._configuration=N}hasVariable(N){return N in this._userVariables}setVariable(N,Z){this._userVariables[N]=Z}getVariable(N){return this._userVariables[N]}get userVariables(){return this._userVariables}_getUniqueIdPrefixedName(N,Z){return`${N.uniqueId}_${Z}`}_setExecutionVariable(N,Z,d){this._executionVariables[this._getUniqueIdPrefixedName(N,Z)]=d}_getExecutionVariable(N,Z,d){return this._hasExecutionVariable(N,Z)?this._executionVariables[this._getUniqueIdPrefixedName(N,Z)]:d}_deleteExecutionVariable(N,Z){delete this._executionVariables[this._getUniqueIdPrefixedName(N,Z)]}_hasExecutionVariable(N,Z){return this._getUniqueIdPrefixedName(N,Z)in this._executionVariables}_hasConnectionValue(N){return N.uniqueId in this._connectionValues}_setConnectionValue(N,Z){this._connectionValues[N.uniqueId]=Z}_getConnectionValue(N){return this._connectionValues[N.uniqueId]}get configuration(){return this._configuration}_addPendingBlock(N){this._pendingBlocks.push(N)}_removePendingBlock(N){const Z=this._pendingBlocks.indexOf(N);-1!==Z&&this._pendingBlocks.splice(Z,1)}_clearPendingBlocks(){for(const N of this._pendingBlocks)N._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(N){this.onNodeExecutedObservable.notifyObservers(N)}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Sd;N.uniqueId=this.uniqueId,N._userVariables={};for(const d in this._userVariables)Z(d,this._userVariables[d],N._userVariables);N._connectionValues={};for(const d in this._connectionValues)Z(d,this._connectionValues[d],N._connectionValues)}getClassName(){return"FGContext"}static Parse(N,Z){const d=Z.graph.createContext(),X=Z.valueParseFunction??ed;d.uniqueId=N.uniqueId;for(const I in N._userVariables){const Z=X(I,N._userVariables,d._configuration.Td);d._userVariables[I]=Z}for(const I in N._connectionValues){const Z=X(I,N._connectionValues,d._configuration.Td);d._connectionValues[I]=Z}return d}}(0,M.d)([(0,Q.I)()],kd.prototype,"uniqueId",void 0);var hd,Ud,Cd=d(1199);function Md(N,Z){return!(!N.parent||N.parent!==Z&&!Md(N.parent,Z))}class Qd extends Td{constructor(N){super(N),this.config=N}_getReferencedMesh(){const N=this.config.pathConverter.convert(this.config.path),Z=N.info.getObject(N.object);if(!Z||!(Z instanceof W.b))throw new Error("Mesh pick event block requires a valid mesh");return Z}_preparePendingTasks(N){let Z=N._getExecutionVariable(this,"meshPickObserver");if(!Z){const d=this._getReferencedMesh();N._setExecutionVariable(this,"mesh",d),Z=d.va().onPointerObservable.add((Z=>{var X,I,m;Z.type===Cd.d.POINTERPICK&&null!==(X=Z.pickInfo)&&void 0!==X&&X.pickedMesh&&((null===(I=Z.pickInfo)||void 0===I?void 0:I.pickedMesh)===d||Md(null===(m=Z.pickInfo)||void 0===m?void 0:m.pickedMesh,d))&&this._execute(N)}));const X=d.pd.add((()=>this._onDispose));N._setExecutionVariable(this,"meshPickObserver",Z),N._setExecutionVariable(this,"meshDisposeObserver",X)}}_onDispose(N){this._cancelPendingTasks(N),N._removePendingBlock(this)}_cancelPendingTasks(N){const Z=N._getExecutionVariable(this,"mesh"),d=N._getExecutionVariable(this,"meshPickObserver"),X=N._getExecutionVariable(this,"meshDisposeObserver");Z.va().onPointerObservable.remove(d),Z.pd.remove(X),N._deleteExecutionVariable(this,"mesh"),N._deleteExecutionVariable(this,"meshPickObserver"),N._deleteExecutionVariable(this,"meshDisposeObserver")}getClassName(){return Qd.ClassName}serialize(N){super.serialize(N),N.config.path=this.config.path}}Qd.ClassName="FGMeshPickEventBlock",(0,g.h)(Qd.ClassName,Qd),function(N){N[N.Stopped=0]="Stopped",N[N.Started=1]="Started"}(hd||(hd={}));class Ad{constructor(N){this._eventBlocks=[],this._executionContexts=[],this.state=0,this._scene=N.Td,this._coordinator=N.coordinator,this._sceneDisposeObserver=this._scene.pd.add((()=>this.dispose()))}createContext(){const N=new kd({Td:this._scene,coordinator:this._coordinator});return this._executionContexts.push(N),N}getContext(N){return this._executionContexts[N]}addEventBlock(N){this._eventBlocks.push(N)}start(){if(1!==this.state){this.state=1,0===this._executionContexts.length&&this.createContext();for(const N of this._executionContexts){const Z=this._getContextualOrder();for(const d of Z)d._startPendingTasks(N)}}}_getContextualOrder(){const N=[];for(const Z of this._eventBlocks)if(Z.getClassName()===Qd.ClassName){const d=Z._getReferencedMesh();let X=0;for(;X<N.length;X++){const Z=N[X]._getReferencedMesh();if(d&&Z&&Md(d,Z))break}N.splice(X,0,Z)}else N.push(Z);return N}dispose(){if(0!==this.state){this.state=0;for(const N of this._executionContexts)N._clearPendingBlocks();this._executionContexts.length=0,this._eventBlocks.length=0,this._scene.pd.remove(this._sceneDisposeObserver),this._sceneDisposeObserver=null}}visitAllBlocks(N){const Z=[],d=new Set;for(const X of this._eventBlocks)Z.push(X),d.add(X.uniqueId);for(;Z.length>0;){const X=Z.pop();N(X);for(const N of X.dataInputs)for(const X of N._connectedPoint)d.has(X._ownerBlock.uniqueId)||(Z.push(X._ownerBlock),d.add(X._ownerBlock.uniqueId));if(X instanceof Dd)for(const N of X.signalOutputs)for(const X of N._connectedPoint)d.has(X._ownerBlock.uniqueId)||(Z.push(X._ownerBlock),d.add(X._ownerBlock.uniqueId))}}serialize(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},Z=arguments.length>1?arguments[1]:void 0;N.allBlocks=[],this.visitAllBlocks((Z=>{const d={};Z.serialize(d),N.allBlocks.push(d)})),N.executionContexts=[];for(const d of this._executionContexts){const X={};d.serialize(X,Z),N.executionContexts.push(X)}}static GetDataOutConnectionByUniqueId(N,Z){for(const d of N)for(const N of d.dataOutputs)if(N.uniqueId===Z)return N;throw new Error("Could not find data out connection with unique id "+Z)}static GetSignalInConnectionByUniqueId(N,Z){for(const d of N)if(d instanceof Dd)for(const N of d.signalInputs)if(N.uniqueId===Z)return N;throw new Error("Could not find signal in connection with unique id "+Z)}static Parse(N,Z){const d=Z.coordinator.createGraph(),X=[],I=Z.valueParseFunction??ed;for(const m of N.allBlocks){const N=jd.Parse(m,{Td:Z.coordinator.config.Td,pathConverter:Z.pathConverter,valueParseFunction:I});X.push(N),N instanceof Td&&d.addEventBlock(N)}for(const m of X){for(const N of m.dataInputs)for(const Z of N.connectedPointIds){const d=Ad.GetDataOutConnectionByUniqueId(X,Z);N.connectTo(d)}if(m instanceof Dd)for(const N of m.signalOutputs)for(const Z of N.connectedPointIds){const d=Ad.GetSignalInConnectionByUniqueId(X,Z);N.connectTo(d)}}for(const m of N.executionContexts)kd.Parse(m,{graph:d,valueParseFunction:I});return d}}class nd{constructor(N){this.config=N,this._flowGraphs=[],this._customEventsMap=new Map,this.config.Td.pd.add((()=>{this.dispose()}));(nd.SceneCoordinators.get(this.config.Td)??[]).push(this)}createGraph(){const N=new Ad({Td:this.config.Td,coordinator:this});return this._flowGraphs.push(N),N}removeGraph(N){const Z=this._flowGraphs.indexOf(N);-1!==Z&&(N.dispose(),this._flowGraphs.splice(Z,1))}start(){this._flowGraphs.forEach((N=>N.start()))}dispose(){this._flowGraphs.forEach((N=>N.dispose())),this._flowGraphs.length=0;const N=nd.SceneCoordinators.get(this.config.Td)??[],Z=N.indexOf(this);-1!==Z&&N.splice(Z,1)}serialize(N,Z){N._flowGraphs=[],this._flowGraphs.forEach((d=>{const X={};d.serialize(X,Z),N._flowGraphs.push(X)}))}static Parse(N,Z){var d;const X=Z.valueParseFunction??ed,I=new nd({Td:Z.Td});return null===(d=N._flowGraphs)||void 0===d||d.forEach((N=>{Ad.Parse(N,{coordinator:I,valueParseFunction:X,pathConverter:Z.pathConverter})})),I}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(N){let Z=this._customEventsMap.get(N);return Z||(Z=new j.d,this._customEventsMap.set(N,Z)),Z}notifyCustomEvent(N,Z){const d=this._customEventsMap.get(N);d&&d.notifyObservers(Z)}}nd.SceneCoordinators=new Map;class gd extends Td{_preparePendingTasks(N){if(!N._getExecutionVariable(this,"sceneReadyObserver")){const Z=N.configuration.Td.onReadyObservable.add((()=>{this._execute(N)}));N._setExecutionVariable(this,"sceneReadyObserver",Z)}}_cancelPendingTasks(N){const Z=N._getExecutionVariable(this,"sceneReadyObserver");N.configuration.Td.onReadyObservable.remove(Z),N._deleteExecutionVariable(this,"sceneReadyObserver")}getClassName(){return gd.ClassName}}gd.ClassName="FGSceneReadyEventBlock",(0,g.h)("FGSceneReadyEventBlock",gd);class Ed extends Td{_preparePendingTasks(N){if(!N._getExecutionVariable(this,"sceneBeforeRender")){const Z=N.configuration.Td.onBeforeRenderObservable.add((()=>{this._execute(N)}));N._setExecutionVariable(this,"sceneBeforeRender",Z)}}_cancelPendingTasks(N){const Z=N._getExecutionVariable(this,"sceneBeforeRender");N.configuration.Td.onBeforeRenderObservable.remove(Z),N._deleteExecutionVariable(this,"sceneBeforeRender")}getClassName(){return Ed.ClassName}}Ed.ClassName="FGSceneTickEventBlock",(0,g.h)(Ed.ClassName,Ed);class Vd extends Dd{constructor(N){super(N),this.out=this._registerSignalOutput("out")}}class Od extends Vd{constructor(N){super(N),this.message=this.registerDataInput("message",fZ)}_execute(N){const Z=this.message.getValue(N);k.e.Log(Z),this.out._activateSignal(N)}getClassName(){return Od.ClassName}}Od.ClassName="FGConsoleLogBlock",(0,g.h)(Od.ClassName,Od),function(N){N[N.INIT=0]="INIT",N[N.STARTED=1]="STARTED",N[N.ENDED=2]="ENDED"}(Ud||(Ud={}));class Kd{constructor(N){this.onEachCountObservable=new j.d,this.onTimerAbortedObservable=new j.d,this.onTimerEndedObservable=new j.d,this.onStateChangedObservable=new j.d,this._observer=null,this._breakOnNextTick=!1,this._tick=N=>{const Z=Date.now();this._timer=Z-this._startTime;const d={startTime:this._startTime,currentTime:Z,deltaTime:this._timer,completeRate:this._timer/this._timeToEnd,payload:N},X=this._breakOnNextTick||this._breakCondition(d);X||this._timer>=this._timeToEnd?this._stop(d,X):this.onEachCountObservable.notifyObservers(d)},this._setState(0),this._contextObservable=N.contextObservable,this._observableParameters=N.observableParameters??{},this._breakCondition=N.breakCondition??(()=>!1),this._timeToEnd=N.timeout,N.onEnded&&this.onTimerEndedObservable.add(N.onEnded),N.ui&&this.onEachCountObservable.add(N.ui),N.onAborted&&this.onTimerAbortedObservable.add(N.onAborted)}set breakCondition(N){this._breakCondition=N}clearObservables(){this.onEachCountObservable.clear(),this.onTimerAbortedObservable.clear(),this.onTimerEndedObservable.clear(),this.onStateChangedObservable.clear()}start(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._timeToEnd;if(1===this._state)throw new Error("Timer already started. Please stop it before starting again");this._timeToEnd=N,this._startTime=Date.now(),this._timer=0,this._observer=this._contextObservable.add(this._tick,this._observableParameters.mask,this._observableParameters.insertFirst,this._observableParameters.scope),this._setState(1)}stop(){1===this._state&&(this._breakOnNextTick=!0)}dispose(){this._observer&&this._contextObservable.remove(this._observer),this.clearObservables()}_setState(N){this._state=N,this.onStateChangedObservable.notifyObservers(this._state)}_stop(N){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._contextObservable.remove(this._observer),this._setState(2),Z?this.onTimerAbortedObservable.notifyObservers(N):this.onTimerEndedObservable.notifyObservers(N)}}class rd extends vd{constructor(N){super(N),this.timeout=this.registerDataInput("timeout",oZ)}_preparePendingTasks(N){const Z=this.timeout.getValue(N);if(void 0!==Z&&Z>=0){const d=N._getExecutionVariable(this,"runningTimers")||[],X=N.configuration.Td,I=new Kd({timeout:Z,contextObservable:X.onBeforeRenderObservable,onEnded:()=>this._onEnded(I,N)});I.start(),d.push(I),N._setExecutionVariable(this,"runningTimers",d)}}_execute(N){this._startPendingTasks(N),this.out._activateSignal(N)}_onEnded(N,Z){const d=Z._getExecutionVariable(this,"runningTimers")||[],X=d.indexOf(N);-1!==X?d.splice(X,1):z.g.Warn("FlowGraphTimerBlock: Timer ended but was not found in the running timers list"),Z._removePendingBlock(this),this.done._activateSignal(Z)}_cancelPendingTasks(N){const Z=N._getExecutionVariable(this,"runningTimers")||[];for(const d of Z)d.dispose();N._deleteExecutionVariable(this,"runningTimers")}getClassName(){return rd.ClassName}}rd.ClassName="FGTimerBlock",(0,g.h)("FGTimerBlock",rd);class Pd extends Vd{constructor(N){super(N),this.config=N;for(let Z=0;Z<this.config.eventData.length;Z++){const N=this.config.eventData[Z];this.registerDataInput(N,fZ)}}_execute(N){const Z=this.config.eventId,d=this.dataInputs.map((Z=>Z.getValue(N)));N.configuration.coordinator.notifyCustomEvent(Z,d),this.out._activateSignal(N)}getClassName(){return Pd.ClassName}}Pd.ClassName="FGSendCustomEventBlock",(0,g.h)("FGSendCustomEventBlock",Pd);class Wd extends Td{constructor(N){super(N),this.config=N;for(let Z=0;Z<this.config.eventData.length;Z++){const N=this.config.eventData[Z];this.registerDataOutput(N,fZ)}}_preparePendingTasks(N){const Z=N.configuration.coordinator.getCustomEventObservable(this.config.eventId);this._eventObserver=Z.add((Z=>{for(let d=0;d<Z.length;d++)this.dataOutputs[d].setValue(Z[d],N);this._execute(N)}))}_cancelPendingTasks(N){const Z=N.configuration.coordinator.getCustomEventObservable(this.config.eventId);Z?Z.remove(this._eventObserver):z.g.Warn(`FlowGraphReceiveCustomEventBlock: Missing observable for event ${this.config.eventId}`)}getClassName(){return Wd.ClassName}serialize(N){super.serialize(N),N.eventId=this.config.eventId,N.eventData=this.config.eventData}}Wd.ClassName="FGReceiveCustomEventBlock",(0,g.h)(Wd.ClassName,Wd);class bd extends Dd{constructor(N){super(N),this.config=N,this.outFlows=[];for(let Z=0;Z<this.config.numberOutputFlows;Z++)this.outFlows.push(this._registerSignalOutput(`${Z}`))}_execute(N){for(let Z=0;Z<this.config.numberOutputFlows;Z++)this.outFlows[Z]._activateSignal(N)}getClassName(){return bd.ClassName}}bd.ClassName="FGSequenceBlock",(0,g.h)(bd.ClassName,bd);const Jd=new RegExp(/\{(\w+)\}/g);class Fd{constructor(N,Z){this.path=N,this.ownerBlock=Z,this.templatedInputs=[];let d=Jd.exec(N);for(;d;){const[,X]=d;this.templatedInputs.push(Z.registerDataInput(X,Id)),d=Jd.exec(N)}}getAccessor(N,Z){let d=this.path;for(const X of this.templatedInputs){const N=X.getValue(Z).value;d=d.replace(`{${X.name}}`,N.toString())}return N.convert(d)}}class Gd extends jd{constructor(N){super(N),this.config=N,this.value=this.registerDataOutput("value",fZ),this.templateComponent=new Fd(N.path,this)}_updateOutputs(N){const Z=this.templateComponent.getAccessor(this.config.pathConverter,N),d=Z.info.get(Z.object);this.value.setValue(d,N)}getClassName(){return Gd.ClassName}serialize(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(N),N.config.path=this.config.path}}Gd.ClassName="FGGetPropertyBlock",(0,g.h)(Gd.ClassName,Gd);class xd extends Vd{constructor(N){super(N),this.config=N,this.a=this.registerDataInput("a",fZ),this.templateComponent=new Fd(N.path,this)}_execute(N){const Z=this.a.getValue(N),d=this.templateComponent.getAccessor(this.config.pathConverter,N);d.info.set(Z,d.object),this.out._activateSignal(N)}serialize(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(N),N.config.path=this.config.path}getClassName(){return xd.ClassName}}xd.ClassName="FGSetPropertyBlock",(0,g.h)("FGSetPropertyBlock",xd);const td="cachedOperationValue",qd="cachedExecutionId";class Yd extends jd{constructor(N,Z){super(Z),this.value=this.registerDataOutput("value",N)}_updateOutputs(N){const Z=N._getExecutionVariable(this,qd),d=N._getExecutionVariable(this,td);if(void 0!==d&&Z===N.executionId)this.value.setValue(d,N);else{const Z=this._doOperation(N);N._setExecutionVariable(this,td,Z),N._setExecutionVariable(this,qd,N.executionId),this.value.setValue(Z,N)}}}class sd extends Yd{constructor(N,Z,d,X,I,m){super(d,m),this._operation=X,this._className=I,this.a=this.registerDataInput("a",N),this.b=this.registerDataInput("b",Z)}_doOperation(N){return this._operation(this.a.getValue(N),this.b.getValue(N))}getClassName(){return this._className}}class Ld extends Yd{constructor(N,Z,d,X){super(N,X),this._operation=Z,this._className=d}_doOperation(N){return this._operation()}getClassName(){return this._className}}class Hd extends Yd{constructor(N,Z,d,X,I){super(Z,I),this._operation=d,this._className=X,this.a=this.registerDataInput("a",N)}_doOperation(N){return this._operation(this.a.getValue(N))}getClassName(){return this._className}}class id extends Yd{constructor(N,Z,d,X,I,m,z){super(X,z),this._operation=I,this._className=m,this.a=this.registerDataInput("a",N),this.b=this.registerDataInput("b",Z),this.c=this.registerDataInput("c",d)}_doOperation(N){return this._operation(this.a.getValue(N),this.b.getValue(N),this.c.getValue(N))}getClassName(){return this._className}}function pd(N){return N.getClassName?N.getClassName():""}function yd(N,Z){return"Vector2"===N&&"Vector2"===Z||"kd"===N&&"kd"===Z||"Vector4"===N&&"Vector4"===Z}function ld(N,Z){return"Matrix"===N&&"Matrix"===Z}function ud(N,Z){return"FlowGraphInteger"===N&&"FlowGraphInteger"===Z}class ad extends sd{constructor(N){super(fZ,fZ,fZ,((N,Z)=>this._polymorphicAdd(N,Z)),ad.ClassName,N)}_polymorphicAdd(N,Z){const d=pd(N),X=pd(Z);return yd(d,X)||ld(d,X)||ud(d,X)?N.add(Z):N+Z}}ad.ClassName="FGAddBlock",(0,g.h)(ad.ClassName,ad);class cd extends sd{constructor(N){super(fZ,fZ,fZ,((N,Z)=>this._polymorphicAdd(N,Z)),cd.ClassName,N)}_polymorphicAdd(N,Z){const d=pd(N),X=pd(Z);return yd(d,X)||ud(d,X)?N.rc(Z):ld(d,X)?N.add(Z.scale(-1)):N-Z}}cd.ClassName="FGSubBlock",(0,g.h)(cd.ClassName,cd);class Rd extends sd{constructor(N){super(fZ,fZ,fZ,((N,Z)=>this._polymorphicMultiply(N,Z)),Rd.ClassName,N)}_polymorphicMultiply(N,Z){const d=pd(N),X=pd(Z);return yd(d,X)||ud(d,X)?N.multiply(Z):ld(d,X)?I.c.FromValues(N.m[0]*Z.m[0],N.m[4]*Z.m[4],N.m[8]*Z.m[8],N.m[12]*Z.m[12],N.m[1]*Z.m[1],N.m[5]*Z.m[5],N.m[9]*Z.m[9],N.m[13]*Z.m[13],N.m[2]*Z.m[2],N.m[6]*Z.m[6],N.m[10]*Z.m[10],N.m[14]*Z.m[14],N.m[3]*Z.m[3],N.m[7]*Z.m[7],N.m[11]*Z.m[11],N.m[15]*Z.m[15]):N*Z}}Rd.ClassName="FGMultiplyBlock",(0,g.h)(Rd.ClassName,Rd);class fd extends sd{constructor(N){super(fZ,fZ,fZ,((N,Z)=>this._polymorphicDivide(N,Z)),fd.ClassName,N)}_polymorphicDivide(N,Z){const d=pd(N),X=pd(Z);return yd(d,X)||ud(d,X)?N.divide(Z):ld(d,X)?I.c.FromValues(N.m[0]/Z.m[0],N.m[4]/Z.m[4],N.m[8]/Z.m[8],N.m[12]/Z.m[12],N.m[1]/Z.m[1],N.m[5]/Z.m[5],N.m[9]/Z.m[9],N.m[13]/Z.m[13],N.m[2]/Z.m[2],N.m[6]/Z.m[6],N.m[10]/Z.m[10],N.m[14]/Z.m[14],N.m[3]/Z.m[3],N.m[7]/Z.m[7],N.m[11]/Z.m[11],N.m[15]/Z.m[15]):N/Z}}fd.ClassName="FGDivideBlock",(0,g.h)(fd.ClassName,fd);class od extends Ld{constructor(N){super(oZ,(()=>Math.random()),od.ClassName,N)}}od.ClassName="FGRandomBlock",(0,g.h)(od.ClassName,od);class NX extends sd{constructor(N){super(fZ,fZ,oZ,((N,Z)=>this._polymorphicDot(N,Z)),NX.ClassName,N)}_polymorphicDot(N,Z){switch(pd(N)){case"Vector2":return I.l.Dot(N,Z);case"kd":return I.n.Dot(N,Z);case"Vector4":return I.q.Dot(N,Z);default:throw new Error(`Cannot get dot product of ${N} and ${Z}`)}}}NX.ClassName="FGDotBlock",(0,g.h)(NX.ClassName,NX);class ZX extends Ld{constructor(N){super(oZ,(()=>Math.E),ZX.ClassName,N)}}ZX.ClassName="FGEBlock",(0,g.h)(ZX.ClassName,ZX);class dX extends Ld{constructor(N){super(oZ,(()=>Math.PI),dX.ClassName,N)}}dX.ClassName="FGPIBlock",(0,g.h)(dX.ClassName,dX);class XX extends Ld{constructor(N){super(oZ,(()=>Number.POSITIVE_INFINITY),XX.ClassName,N)}}XX.ClassName="FGInfBlock",(0,g.h)(XX.ClassName,XX);class IX extends Ld{constructor(N){super(oZ,(()=>Number.NaN),IX.ClassName,N)}}function mX(N,Z){switch(pd(N)){case"FlowGraphInteger":return new cZ(Z(N.value));case"Vector2":return new I.l(Z(N.x),Z(N.y));case"kd":return new I.n(Z(N.x),Z(N.y),Z(N.z));case"Vector4":return new I.q(Z(N.x),Z(N.y),Z(N.z),Z(N.w));case"Matrix":return I.c.FromValues(Z(N.m[0]),Z(N.m[4]),Z(N.m[8]),Z(N.m[12]),Z(N.m[1]),Z(N.m[5]),Z(N.m[9]),Z(N.m[13]),Z(N.m[2]),Z(N.m[6]),Z(N.m[10]),Z(N.m[14]),Z(N.m[3]),Z(N.m[7]),Z(N.m[11]),Z(N.m[15]));default:return Z(N)}}IX.ClassName="FGNaNBlock",(0,g.h)(IX.ClassName,IX);class zX extends Hd{constructor(N){super(fZ,fZ,(N=>this._polymorphicAbs(N)),zX.ClassName,N)}_polymorphicAbs(N){return mX(N,Math.abs)}}zX.ClassName="FGAbsBlock",(0,g.h)(zX.ClassName,zX);class wX extends Hd{constructor(N){super(fZ,fZ,(N=>this._polymorphicSign(N)),wX.ClassName,N)}_polymorphicSign(N){return mX(N,Math.sign)}}wX.ClassName="FGSignBlock",(0,g.h)(wX.ClassName,wX);class SX extends Hd{constructor(N){super(fZ,fZ,(N=>this._polymorphicTrunc(N)),SX.ClassName,N)}_polymorphicTrunc(N){return mX(N,Math.trunc)}}SX.ClassName="FGTruncBlock",(0,g.h)(SX.ClassName,SX);class eX extends Hd{constructor(N){super(fZ,fZ,(N=>this._polymorphicFloor(N)),eX.ClassName,N)}_polymorphicFloor(N){return mX(N,Math.floor)}}eX.ClassName="FGFloorBlock",(0,g.h)(eX.ClassName,eX);class jX extends Hd{constructor(N){super(fZ,fZ,(N=>this._polymorphicCeiling(N)),jX.ClassName,N)}_polymorphicCeiling(N){return mX(N,Math.ceil)}}jX.ClassName="FGCeilBlock",(0,g.h)(jX.ClassName,jX);class BX extends Hd{constructor(N){super(fZ,fZ,(N=>this._polymorphicFract(N)),BX.ClassName,N)}_polymorphicFract(N){return mX(N,(N=>N-Math.floor(N)))}}BX.ClassName="FGFractBlock",(0,g.h)(BX.ClassName,BX);class DX extends Hd{constructor(N){super(fZ,fZ,(N=>this._polymorphicNeg(N)),DX.ClassName,N)}_polymorphicNeg(N){return mX(N,(N=>-N))}}function vX(N,Z,d){switch(pd(N)){case"FlowGraphInteger":return new cZ(d(N.value,Z.value));case"Vector2":return new I.l(d(N.x,Z.x),d(N.y,Z.y));case"kd":return new I.n(d(N.x,Z.x),d(N.y,Z.y),d(N.z,Z.z));case"Vector4":return new I.q(d(N.x,Z.x),d(N.y,Z.y),d(N.z,Z.z),d(N.w,Z.w));case"Matrix":return I.c.FromValues(d(N.m[0],Z.m[0]),d(N.m[4],Z.m[4]),d(N.m[8],Z.m[8]),d(N.m[12],Z.m[12]),d(N.m[1],Z.m[1]),d(N.m[5],Z.m[5]),d(N.m[9],Z.m[9]),d(N.m[13],Z.m[13]),d(N.m[2],Z.m[2]),d(N.m[6],Z.m[6]),d(N.m[10],Z.m[10]),d(N.m[14],Z.m[14]),d(N.m[3],Z.m[3]),d(N.m[7],Z.m[7]),d(N.m[11],Z.m[11]),d(N.m[15],Z.m[15]));default:return d(N,Z)}}DX.ClassName="FGNegBlock",(0,g.h)(DX.ClassName,DX);class TX extends sd{constructor(N){super(fZ,fZ,fZ,((N,Z)=>this._polymorphicRemainder(N,Z)),TX.ClassName,N)}_polymorphicRemainder(N,Z){return vX(N,Z,((N,Z)=>N%Z))}}TX.ClassName="FGRemainderBlock",(0,g.h)(TX.ClassName,TX);class kX extends sd{constructor(N){super(fZ,fZ,fZ,((N,Z)=>this._polymorphicMin(N,Z)),kX.ClassName,N)}_polymorphicMin(N,Z){return vX(N,Z,Math.min)}}kX.ClassName="FGMinBlock",(0,g.h)(kX.ClassName,kX);class hX extends sd{constructor(N){super(fZ,fZ,fZ,((N,Z)=>this._polymorphicMax(N,Z)),hX.ClassName,N)}_polymorphicMax(N,Z){return vX(N,Z,Math.max)}}function UX(N,Z,d){return Math.min(Math.max(N,Math.min(Z,d)),Math.max(Z,d))}function CX(N,Z,d,X){switch(pd(N)){case"FlowGraphInteger":return new cZ(X(N.value,Z.value,d.value));case"Vector2":return new I.l(X(N.x,Z.x,d.x),X(N.y,Z.y,d.y));case"kd":return new I.n(X(N.x,Z.x,d.x),X(N.y,Z.y,d.y),X(N.z,Z.z,d.z));case"Vector4":return new I.q(X(N.x,Z.x,d.x),X(N.y,Z.y,d.y),X(N.z,Z.z,d.z),X(N.w,Z.w,d.w));case"Matrix":return I.c.FromValues(X(N.m[0],Z.m[0],d.m[0]),X(N.m[4],Z.m[4],d.m[4]),X(N.m[8],Z.m[8],d.m[8]),X(N.m[12],Z.m[12],d.m[12]),X(N.m[1],Z.m[1],d.m[1]),X(N.m[5],Z.m[5],d.m[5]),X(N.m[9],Z.m[9],d.m[9]),X(N.m[13],Z.m[13],d.m[13]),X(N.m[2],Z.m[2],d.m[2]),X(N.m[6],Z.m[6],d.m[6]),X(N.m[10],Z.m[10],d.m[10]),X(N.m[14],Z.m[14],d.m[14]),X(N.m[3],Z.m[3],d.m[3]),X(N.m[7],Z.m[7],d.m[7]),X(N.m[11],Z.m[11],d.m[11]),X(N.m[15],Z.m[15],d.m[15]));default:return X(N,Z,d)}}hX.ClassName="FGMaxBlock",(0,g.h)(hX.ClassName,hX);class MX extends id{constructor(N){super(fZ,fZ,fZ,fZ,((N,Z,d)=>this._polymorphicClamp(N,Z,d)),MX.ClassName,N)}_polymorphicClamp(N,Z,d){return CX(N,Z,d,UX)}}function QX(N){return Math.min(Math.max(N,0),1)}MX.ClassName="FGClampBlock",(0,g.h)(MX.ClassName,MX);class AX extends Hd{constructor(N){super(fZ,fZ,(N=>this._polymorphicSaturate(N)),AX.ClassName,N)}_polymorphicSaturate(N){return mX(N,QX)}}AX.ClassName="FGSaturateBlock",(0,g.h)(AX.ClassName,AX);class nX extends id{constructor(N){super(fZ,fZ,fZ,fZ,((N,Z,d)=>this._polymorphicInterpolate(N,Z,d)),nX.ClassName,N)}_interpolate(N,Z,d){return(1-d)*N+d*Z}_polymorphicInterpolate(N,Z,d){return CX(N,Z,d,this._interpolate)}}nX.ClassName="FGInterpolateBlock",(0,g.h)(nX.ClassName,nX);class gX extends sd{constructor(N){super(fZ,fZ,Nd,((N,Z)=>this._polymorphicEq(N,Z)),gX.ClassName,N)}_polymorphicEq(N,Z){const d=pd(N),X=pd(Z);return yd(d,X)||ld(d,X)||ud(d,X)?N.equals(Z):N===Z}}function EX(N,Z,d){const X=pd(N);if(X===pd(Z)){if(""===X)return d(N,Z);if("FlowGraphInteger"===X)return d(N.value,Z.value);throw new Error(`Cannot compare ${N} and ${Z}`)}throw new Error(`${N} and ${Z} are of different types.`)}gX.ClassName="FGEqBlock",(0,g.h)(gX.ClassName,gX);class VX extends sd{constructor(N){super(fZ,fZ,Nd,((N,Z)=>this._polymorphicLessThan(N,Z)),VX.ClassName,N)}_polymorphicLessThan(N,Z){return EX(N,Z,((N,Z)=>N<Z))}}VX.ClassName="FGLessThanBlock",(0,g.h)(VX.ClassName,VX);class OX extends sd{constructor(N){super(fZ,fZ,Nd,((N,Z)=>this._polymorphicLessThanOrEqual(N,Z)),OX.ClassName,N)}_polymorphicLessThanOrEqual(N,Z){return EX(N,Z,((N,Z)=>N<=Z))}}OX.ClassName="FGLessThanOrEqualBlock";class KX extends sd{constructor(N){super(fZ,fZ,Nd,((N,Z)=>this._polymorphicGreaterThan(N,Z)),KX.ClassName,N)}_polymorphicGreaterThan(N,Z){return EX(N,Z,((N,Z)=>N>Z))}}KX.ClassName="FGGreaterThanBlock",(0,g.h)(KX.ClassName,KX);class rX extends sd{constructor(N){super(fZ,fZ,Nd,((N,Z)=>this._polymorphicGreaterThanOrEqual(N,Z)),rX.ClassName,N)}_polymorphicGreaterThanOrEqual(N,Z){return EX(N,Z,((N,Z)=>N>=Z))}}rX.ClassName="FGGreaterThanOrEqualBlock",(0,g.h)(rX.ClassName,rX);class PX extends Hd{constructor(N){super(fZ,Nd,(N=>this._polymorphicIsNan(N)),PX.ClassName,N)}_polymorphicIsNan(N){const Z=pd(N);if(""===Z)return isNaN(N);if("FlowGraphInteger"===Z)return isNaN(N.value);throw new Error(`Cannot get NaN of ${N}`)}}PX.ClassName="FGIsNanBlock",(0,g.h)(PX.ClassName,PX);class WX extends Hd{constructor(N){super(fZ,Nd,(N=>this._polymorphicIsInf(N)),WX.ClassName,N)}_polymorphicIsInf(N){const Z=pd(N);if(""===Z)return!isFinite(N);if("FlowGraphInteger"===Z)return!isFinite(N.value);throw new Error(`Cannot get isInf of ${N}`)}}WX.ClassName="FGIsInfBlock";class bX extends Hd{constructor(N){super(fZ,fZ,(N=>this._polymorphicDegToRad(N)),bX.ClassName,N)}_degToRad(N){return N*Math.PI/180}_polymorphicDegToRad(N){return mX(N,this._degToRad)}}bX.ClassName="FGDegToRadBlock",(0,g.h)(bX.ClassName,bX);class JX extends Hd{constructor(N){super(fZ,fZ,(N=>this._polymorphicRadToDeg(N)),JX.ClassName,N)}_radToDeg(N){return 180*N/Math.PI}_polymorphicRadToDeg(N){return mX(N,this._radToDeg)}}JX.ClassName="FGRadToDegBlock",(0,g.h)(JX.ClassName,JX);class FX extends Hd{constructor(N){super(fZ,fZ,(N=>this._polymorphicSin(N)),FX.ClassName,N)}_polymorphicSin(N){return mX(N,Math.sin)}}FX.ClassName="FGSinBlock",(0,g.h)(FX.ClassName,FX);class GX extends Hd{constructor(N){super(fZ,fZ,(N=>this._polymorphicCos(N)),GX.ClassName,N)}_polymorphicCos(N){return mX(N,Math.cos)}}GX.ClassName="FGCosBlock",(0,g.h)(GX.ClassName,GX);class xX extends Hd{constructor(N){super(fZ,fZ,(N=>this._polymorphicTan(N)),xX.ClassName,N)}_polymorphicTan(N){return mX(N,Math.tan)}}xX.ClassName="FGTanBlock",(0,g.h)(xX.ClassName,xX);class tX extends Hd{constructor(N){super(fZ,fZ,(N=>this._polymorphicAsin(N)),tX.ClassName,N)}_polymorphicAsin(N){return mX(N,Math.asin)}}tX.ClassName="FGAsinBlock",(0,g.h)(tX.ClassName,tX);class qX extends Hd{constructor(N){super(fZ,fZ,(N=>this._polymorphicAcos(N)),qX.ClassName,N)}_polymorphicAcos(N){return mX(N,Math.acos)}}qX.ClassName="FGAcosBlock",(0,g.h)(qX.ClassName,qX);class YX extends Hd{constructor(N){super(fZ,fZ,(N=>this._polymorphicAtan(N)),YX.ClassName,N)}_polymorphicAtan(N){return mX(N,Math.atan)}}YX.ClassName="FGAtanBlock",(0,g.h)(YX.ClassName,YX);class sX extends sd{constructor(N){super(fZ,fZ,fZ,((N,Z)=>this._polymorphicAtan2(N,Z)),sX.ClassName,N)}_polymorphicAtan2(N,Z){return vX(N,Z,Math.atan2)}}sX.ClassName="FGAtan2Block",(0,g.h)(sX.ClassName,sX);class LX extends Hd{constructor(N){super(fZ,fZ,(N=>this._polymorphicSinh(N)),LX.ClassName,N)}_polymorphicSinh(N){return mX(N,Math.sinh)}}LX.ClassName="FGSinhBlock",(0,g.h)(LX.ClassName,LX);class HX extends Hd{constructor(N){super(fZ,fZ,(N=>this._polymorphicCosh(N)),HX.ClassName,N)}_polymorphicCosh(N){return mX(N,Math.cosh)}}HX.ClassName="FGCoshBlock",(0,g.h)(HX.ClassName,HX);class iX extends Hd{constructor(N){super(fZ,fZ,(N=>this._polymorphicTanh(N)),iX.ClassName,N)}_polymorphicTanh(N){return mX(N,Math.tanh)}}iX.ClassName="FGTanhBlock",(0,g.h)(iX.ClassName,iX);class pX extends Hd{constructor(N){super(fZ,oZ,(N=>this._polymorphicAsinh(N)),pX.ClassName,N)}_polymorphicAsinh(N){return mX(N,Math.asinh)}}pX.ClassName="FGAsinhBlock",(0,g.h)(pX.ClassName,pX);class yX extends Hd{constructor(N){super(fZ,oZ,(N=>this._polymorphicAcosh(N)),yX.ClassName,N)}_polymorphicAcosh(N){return mX(N,Math.acosh)}}yX.ClassName="FGAcoshBlock",(0,g.h)(yX.ClassName,yX);class lX extends Hd{constructor(N){super(fZ,oZ,(N=>this._polymorphicAtanh(N)),lX.ClassName,N)}_polymorphicAtanh(N){return mX(N,Math.atanh)}}lX.ClassName="FGAtanhBlock",(0,g.h)(lX.ClassName,lX);class uX extends Hd{constructor(N){super(fZ,oZ,(N=>this._polymorphicExp(N)),uX.ClassName,N)}_polymorphicExp(N){return mX(N,Math.exp)}}uX.ClassName="FGExpBlock",(0,g.h)(uX.ClassName,uX);class aX extends Hd{constructor(N){super(fZ,oZ,(N=>this._polymorphicLog(N)),aX.ClassName,N)}_polymorphicLog(N){return mX(N,Math.log)}}aX.ClassName="FGLogBlock",(0,g.h)(aX.ClassName,aX);class cX extends Hd{constructor(N){super(fZ,oZ,(N=>this._polymorphicLog2(N)),cX.ClassName,N)}_polymorphicLog2(N){return mX(N,Math.log2)}}cX.ClassName="FGLog2Block",(0,g.h)(cX.ClassName,cX);class RX extends Hd{constructor(N){super(fZ,oZ,(N=>this._polymorphicLog10(N)),RX.ClassName,N)}_polymorphicLog10(N){return mX(N,Math.log10)}}RX.ClassName="FGLog10Block",(0,g.h)(RX.ClassName,RX);class fX extends Hd{constructor(N){super(fZ,oZ,(N=>this._polymorphicSqrt(N)),fX.ClassName,N)}_polymorphicSqrt(N){return mX(N,Math.sqrt)}}fX.ClassName="FGSqrtBlock",(0,g.h)(fX.ClassName,fX);class oX extends Hd{constructor(N){super(fZ,oZ,(N=>this._polymorphicCubeRoot(N)),oX.ClassName,N)}_polymorphicCubeRoot(N){return mX(N,Math.cbrt)}}oX.ClassName="FGCubeRootBlock",(0,g.h)(oX.ClassName,oX);class NI extends sd{constructor(N){super(fZ,oZ,oZ,((N,Z)=>this._polymorphicPow(N,Z)),NI.ClassName,N)}_polymorphicPow(N,Z){return vX(N,Z,Math.pow)}}NI.ClassName="FGPowBlock",(0,g.h)(NI.ClassName,NI);class ZI extends Hd{constructor(N){super(fZ,oZ,(N=>this._polymorphicLength(N)),ZI.ClassName,N)}_polymorphicLength(N){switch(pd(N)){case"Vector2":case"kd":case"Vector4":return N.length();default:throw new Error(`Cannot compute length of value ${N}`)}}}ZI.ClassName="FGLengthBlock",(0,g.h)(ZI.ClassName,ZI);class dI extends Hd{constructor(N){super(fZ,fZ,(N=>this._polymorphicNormalize(N)),dI.ClassName,N)}_polymorphicNormalize(N){switch(pd(N)){case"Vector2":case"kd":case"Vector4":return N.normalize();default:throw new Error(`Cannot normalize value ${N}`)}}}dI.ClassName="FGNormalizeBlock",(0,g.h)(dI.ClassName,dI);class XI extends sd{constructor(N){super(dd,dd,dd,((N,Z)=>I.n.Cross(N,Z)),XI.ClassName,N)}}XI.ClassName="FGCrossBlock",(0,g.h)(XI.ClassName,XI);class II extends sd{constructor(N){super(Zd,oZ,Zd,((N,Z)=>I.l.Transform(N,I.c.RotationZ(Z))),II.ClassName,N)}}II.ClassName="FGRotate2DBlock",(0,g.h)(II.ClassName,II);class mI extends id{constructor(N){super(dd,dd,oZ,dd,((N,Z,d)=>I.n.TransformCoordinates(N,I.c.RotationAxis(Z,d))),mI.ClassName,N)}}mI.ClassName="FGRotate3DBlock",(0,g.h)(mI.ClassName,mI);class zI extends Hd{constructor(N){super(Xd,Xd,(N=>I.c.Transpose(N)),zI.ClassName,N)}}zI.ClassName="FGTransposeBlock",(0,g.h)(zI.ClassName,zI);class wI extends Hd{constructor(N){super(Xd,oZ,(N=>N.determinant()),wI.ClassName,N)}}wI.ClassName="FGDeterminantBlock",(0,g.h)(wI.ClassName,wI);class SI extends Hd{constructor(N){super(Xd,Xd,(N=>I.c.Invert(N)),SI.ClassName,N)}}SI.ClassName="FGInvertMatrixBlock",(0,g.h)(SI.ClassName,SI);class eI extends sd{constructor(N){super(Xd,Xd,Xd,((N,Z)=>Z.multiply(N)),eI.ClassName,N)}}eI.ClassName="FGMatMulBlock",(0,g.h)(eI.ClassName,eI);class jI extends Hd{constructor(N){super(Id,Id,(N=>new cZ(~N.value)),jI.ClassName,N)}}jI.ClassName="FGBitwiseNotBlock",(0,g.h)(jI.ClassName,jI);class BI extends sd{constructor(N){super(Id,Id,Id,((N,Z)=>new cZ(N.value&Z.value)),BI.ClassName,N)}}BI.ClassName="FGBitwiseAndBlock",(0,g.h)(BI.ClassName,BI);class DI extends sd{constructor(N){super(Id,Id,Id,((N,Z)=>new cZ(N.value|Z.value)),DI.ClassName,N)}}DI.ClassName="FGBitwiseOrBlock",(0,g.h)(DI.ClassName,DI);class vI extends sd{constructor(N){super(Id,Id,Id,((N,Z)=>new cZ(N.value^Z.value)),vI.ClassName,N)}}vI.ClassName="FGBitwiseXorBlock",(0,g.h)(vI.ClassName,vI);class TI extends sd{constructor(N){super(Id,Id,Id,((N,Z)=>new cZ(N.value<<Z.value)),TI.ClassName,N)}}TI.ClassName="FGBitwiseLeftShiftBlock",(0,g.h)(TI.ClassName,TI);class kI extends sd{constructor(N){super(Id,Id,Id,((N,Z)=>new cZ(N.value>>Z.value)),kI.ClassName,N)}}kI.ClassName="FGBitwiseRightShiftBlock",(0,g.h)(kI.ClassName,kI);class hI extends Hd{constructor(N){super(Id,Id,(N=>new cZ(Math.clz32(N.value))),hI.ClassName,N)}}hI.ClassName="FGCountLeadingZerosBlock",(0,g.h)(hI.ClassName,hI);class UI extends Hd{constructor(N){super(Id,Id,(N=>new cZ(N.value?31-Math.clz32(N.value&-N.value):32)),UI.ClassName,N)}}UI.ClassName="FGCountTrailingZerosBlock",(0,g.h)(UI.ClassName,UI);class CI extends Hd{constructor(N){super(Id,Id,(N=>new cZ(function(N){let Z=0;for(;N;)Z+=1&N,N>>=1;return Z}(N.value))),CI.ClassName,N)}}CI.ClassName="FGCountOneBitsBlock",(0,g.h)(CI.ClassName,CI);class MI extends Vd{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{startIndex:new cZ(0)};super(N),this.config=N,this.reset=this._registerSignalInput("reset"),this.n=this.registerDataInput("n",Id),this.value=this.registerDataOutput("value",Id)}_execute(N,Z){if(Z===this.reset)this.value.setValue(this.config.startIndex,N);else{const Z=this.value.getValue(N);Z.value<this.n.getValue(N).value&&(this.value.setValue(new cZ(Z.value+1),N),this.out._activateSignal(N))}}getClassName(){return MI.ClassName}}MI.ClassName="FGDoNBlock",(0,g.h)(MI.ClassName,MI);class QI extends jd{constructor(N){super(N),this.config=N,this.output=this.registerDataOutput(N.variableName,fZ)}_updateOutputs(N){const Z=this.config.variableName;N.hasVariable(Z)&&this.output.setValue(N.getVariable(Z),N)}getClassName(){return QI.ClassName}serialize(N){super.serialize(N),N.config.variableName=this.config.variableName}}QI.ClassName="FGGetVariableBlock",(0,g.h)(QI.ClassName,QI);class AI extends Vd{constructor(N){super(N),this.config=N,this.input=this.registerDataInput(N.variableName,fZ)}_execute(N){const Z=this.config.variableName,d=this.input.getValue(N);N.setVariable(Z,d),this.out._activateSignal(N)}getClassName(){return AI.ClassName}}AI.ClassName="FGSetVariableBlock",(0,g.h)(AI.ClassName,AI);class nI extends Vd{constructor(N){super(N),this.config=N,this.condition=this.registerDataInput("condition",Nd),this.loopBody=this._registerSignalOutput("loopBody")}_execute(N,Z){var d;let X=this.condition.getValue(N);for(null!==(d=this.config)&&void 0!==d&&d.isDo&&!X&&this.loopBody._activateSignal(N);X;)this.loopBody._activateSignal(N),X=this.condition.getValue(N);this.out._activateSignal(N)}getClassName(){return nI.ClassName}serialize(N){var Z;super.serialize(N),N.isDo=null===(Z=this.config)||void 0===Z?void 0:Z.isDo}}nI.ClassName="FGWhileLoopBlock",(0,g.h)(nI.ClassName,nI);const gI={"lifecycle/onStart":gd.ClassName,"lifecycle/onTick":Ed.ClassName,log:Od.ClassName,"flow/delay":rd.ClassName,"customEvent/send":Pd.ClassName,"customEvent/receive":Wd.ClassName,"flow/sequence":bd.ClassName,"world/get":Gd.ClassName,"world/set":xd.ClassName,"flow/doN":MI.ClassName,"variable/get":QI.ClassName,"variable/set":AI.ClassName,"flow/whileLoop":nI.ClassName,"math/random":od.ClassName,"math/e":ZX.ClassName,"math/pi":dX.ClassName,"math/inf":XX.ClassName,"math/nan":IX.ClassName,"math/abs":zX.ClassName,"math/sign":wX.ClassName,"math/trunc":SX.ClassName,"math/floor":eX.ClassName,"math/ceil":jX.ClassName,"math/fract":BX.ClassName,"math/neg":DX.ClassName,"math/add":ad.ClassName,"math/sub":cd.ClassName,"math/mul":Rd.ClassName,"math/div":fd.ClassName,"math/rem":TX.ClassName,"math/min":kX.ClassName,"math/max":hX.ClassName,"math/clamp":MX.ClassName,"math/saturate":AX.ClassName,"math/mix":nX.ClassName,"math/eq":gX.ClassName,"math/lt":VX.ClassName,"math/le":OX.ClassName,"math/gt":KX.ClassName,"math/ge":rX.ClassName,"math/isnan":PX.ClassName,"math/isinf":WX.ClassName,"math/rad":bX.ClassName,"math/deg":JX.ClassName,"math/sin":FX.ClassName,"math/cos":GX.ClassName,"math/tan":xX.ClassName,"math/asin":tX.ClassName,"math/acos":qX.ClassName,"math/atan":YX.ClassName,"math/atan2":sX.ClassName,"math/sinh":LX.ClassName,"math/cosh":HX.ClassName,"math/tanh":iX.ClassName,"math/asinh":pX.ClassName,"math/acosh":yX.ClassName,"math/atanh":lX.ClassName,"math/exp":uX.ClassName,"math/log":aX.ClassName,"math/log2":cX.ClassName,"math/log10":RX.ClassName,"math/sqrt":fX.ClassName,"math/cbrt":oX.ClassName,"math/pow":NI.ClassName,"math/length":ZI.ClassName,"math/normalize":dI.ClassName,"math/dot":NX.ClassName,"math/cross":XI.ClassName,"math/rotate2d":II.ClassName,"math/rotate3d":mI.ClassName,"math/transpose":zI.ClassName,"math/determinant":wI.ClassName,"math/inverse":SI.ClassName,"math/matmul":eI.ClassName,"math/not":jI.ClassName,"math/and":BI.ClassName,"math/or":DI.ClassName,"math/xor":vI.ClassName,"math/asr":kI.ClassName,"math/lsl":TI.ClassName,"math/clz":hI.ClassName,"math/ctz":UI.ClassName,"math/popcnt":CI.ClassName},EI={float2:"Vector2",float3:"kd",float4:"Vector4",float4x4:"Matrix",int:"FlowGraphInteger"};function VI(N,Z,d){if(void 0!==N.type){const X=Z.types&&Z.types[N.type];if(!X)throw new Error(`${d}: Unknown type: ${N.type}`);const I=X.signature;if(!I)throw new Error(`${d}: Type ${N.type} has no signature`);const m=EI[I];return{value:N.value,className:m}}return N.value}function OI(N,Z,d){const X=gI[Z.type];if(!X)throw new Error(`/extensions/KHR_interactivity/nodes/${N}: Unknown block type: ${Z.type}`);const I=N.toString(),m=function(N,Z,d){const X={},I=N.configuration??[];for(const m of I)if("customEvent"===m.id){const N=Z.customEvents&&Z.customEvents[m.value];if(!N)throw new Error(`/extensions/KHR_interactivity/nodes/${d}: Unknown custom event: ${m.value}`);X.eventId=N.id,X.eventData=N.values.map((N=>N.id))}else if("variable"===m.id){const N=Z.variables&&Z.variables[m.value];if(!N)throw new Error(`/extensions/KHR_interactivity/nodes/${d}: Unknown variable: ${m.value}`);X.variableName=N.id}else if("path"===m.id){const N=m.value;X.path=N}else X[m.id]=VI(m,Z,`/extensions/KHR_interactivity/nodes/${d}`);return X}(Z,d,I);return{className:X,config:m,uniqueId:I,metadata:Z.metadata,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[]}}class KI extends gZ{constructor(N){super(N,PI)}}const rI={__array__:{__target__:!0,translation:{type:"kd",get:N=>N._babylonTransformNode.position,set:(N,Z)=>{Z._babylonTransformNode.position=N},getObject:N=>N._babylonTransformNode}}},PI={nodes:rI},WI="KHR_interactivity";class bI{constructor(N){this._loader=N,this.name=WI,this.enabled=this._loader.isExtensionUsed(WI),this._pathConverter=new KI(this._loader.bj)}dispose(){this._loader=null,delete this._pathConverter}onReady(){var N;if(!this._loader.babylonScene||!this._pathConverter)return;const Z=this._loader.babylonScene,d=function(N){const Z={uniqueId:(0,uZ.e)(),_userVariables:{},_connectionValues:{}},d=[Z],X=[];for(let m=0;m<N.nodes.length;m++){const Z=OI(m,N.nodes[m],N);X.push(Z)}for(let m=0;m<N.nodes.length;m++){const d=N.nodes[m],I=X[m],z=d.flows??[];for(const N of z){const Z=N.id,d={uniqueId:(0,uZ.e)(),name:Z,_connectionType:1,connectedPointIds:[]};I.signalOutputs.push(d);const z=N.node,w=N.socket,S=X[z];if(!S)throw new Error(`/extensions/KHR_interactivity/nodes/${m}: Could not find node with id ${z} that connects its input with with node ${m}'s output ${Z}`);let e=S.signalInputs.find((N=>N.name===w));e||(e={uniqueId:(0,uZ.e)(),name:w,_connectionType:0,connectedPointIds:[]},S.signalInputs.push(e)),e.connectedPointIds.push(d.uniqueId),d.connectedPointIds.push(e.uniqueId)}const w=d.values??[];for(const S of w){const d=S.id,z={uniqueId:(0,uZ.e)(),name:d,_connectionType:0,connectedPointIds:[]};if(I.dataInputs.push(z),void 0!==S.value){const d=VI(S,N,`/extensions/KHR_interactivity/nodes/${m}`);Z._connectionValues[z.uniqueId]=d}else{if(void 0===S.node||void 0===S.socket)throw new Error(`/extensions/KHR_interactivity/nodes/${m}: Invalid socket ${d} in node ${m}`);{const N=S.node,Z=S.socket,I=X[N];if(!I)throw new Error(`/extensions/KHR_interactivity/nodes/${m}: Could not find node with id ${N} that connects its output with node${m}'s input ${d}`);let w=I.dataOutputs.find((N=>N.name===Z));w||(w={uniqueId:(0,uZ.e)(),name:Z,_connectionType:1,connectedPointIds:[]},I.dataOutputs.push(w)),z.connectedPointIds.push(w.uniqueId),w.connectedPointIds.push(z.uniqueId)}}}}const I=N.variables??[];for(let m=0;m<I.length;m++){const d=I[m],X=d.id;Z._userVariables[X]=VI(d,N,`/extensions/KHR_interactivity/variables/${m}`)}return{allBlocks:X,executionContexts:d}}(null===(N=this._loader.bj.extensions)||void 0===N?void 0:N.KHR_interactivity),X=new nd({Td:Z});Ad.Parse(d,{coordinator:X,pathConverter:this._pathConverter}),X.start()}}u(WI),l(WI,!0,(N=>new bI(N)));const JI="KHR_node_visibility";class FI{constructor(N){this.name=JI,this._loader=N,this.enabled=N.isExtensionUsed(JI)}async onReady(){var N;null===(N=this._loader.bj.nodes)||void 0===N||N.forEach((N=>{var Z,d,X,I;(null===(Z=N._primitiveBabylonMeshes)||void 0===Z||Z.forEach((N=>{N.inheritVisibility=!0})),null!==(d=N.extensions)&&void 0!==d&&d.KHR_node_visibility)&&(!1===(null===(X=N.extensions)||void 0===X?void 0:X.KHR_node_visibility.visible)&&(N._babylonTransformNode&&(N._babylonTransformNode.isVisible=!1),null===(I=N._primitiveBabylonMeshes)||void 0===I||I.forEach((N=>{N.isVisible=!1}))))}))}dispose(){this._loader=null}}u(JI),l(JI,!0,(N=>new FI(N)));const GI="ExtrasAsMetadata";class xI{_assignExtras(N,Z){if(Z.extras&&Object.keys(Z.extras).length>0){const d=N.metadata=N.metadata||{};(d.bj=d.bj||{}).extras=Z.extras}}constructor(N){this.name=GI,this.enabled=!0,this._loader=N}dispose(){this._loader=null}loadNodeAsync(N,Z,d){return this._loader.loadNodeAsync(N,Z,(N=>{this._assignExtras(N,Z),d(N)}))}loadCameraAsync(N,Z,d){return this._loader.loadCameraAsync(N,Z,(N=>{this._assignExtras(N,Z),d(N)}))}createMaterial(N,Z,d){const X=this._loader.createMaterial(N,Z,d);return this._assignExtras(X,Z),X}}u(GI),l(GI,!1,(N=>new xI(N)))},11740:(N,Z,d)=>{"use strict";d.d(Z,{d:()=>W,h:()=>E,i:()=>g,l:()=>V});var X=d(958),I=d(1133),m=d(11429),z=d(11321),w=d(11370),S=d(11366),e=d(1051),j=d(986),B=d(11748),D=d(11753),v=d(11335);class T{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.Od=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.Qd=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(N){this._environmentTexture=N}getNodes(){let N=[];return N=N.concat(this.meshes),N=N.concat(this.lights),N=N.concat(this.cameras),N=N.concat(this.transformNodes),this.skeletons.forEach((Z=>N=N.concat(Z.bones))),N}}class k extends T{}class h{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){this.rootNodes.slice(0).forEach((N=>{N.dispose()})),this.rootNodes.length=0,this.skeletons.slice(0).forEach((N=>{N.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((N=>{N.dispose()})),this.animationGroups.length=0}}class U extends T{constructor(N){super(),this._wasAddedToScene=!1,(N=N||j.e.LastCreatedScene)&&(this.Td=N,this.proceduralTextures=[],N.pd.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=N.getEngine().onContextRestoredObservable.add((()=>{for(const N of this.geometries)N._rebuild();for(const N of this.meshes)N._rebuild();for(const N of this.Od)N.rebuild();for(const N of this.textures)N._rebuild()})))}_topologicalSort(N){const Z=new Map;for(const z of N)Z.set(z.uniqueId,z);const d={dependsOn:new Map,dependedBy:new Map};for(const z of N){const N=z.uniqueId;d.dependsOn.set(N,new Set),d.dependedBy.set(N,new Set)}for(const z of N){const N=z.uniqueId,X=d.dependsOn.get(N);if(z instanceof B.e){const I=z.sourceMesh;Z.has(I.uniqueId)&&(X.add(I.uniqueId),d.dependedBy.get(I.uniqueId).add(N))}const I=d.dependedBy.get(N);for(const m of z.getDescendants()){const X=m.uniqueId;if(Z.has(X)){I.add(X);d.dependsOn.get(X).add(N)}}}const X=[],I=[];for(const z of N){const N=z.uniqueId;0===d.dependsOn.get(N).size&&(I.push(z),Z.delete(N))}const m=I;for(;m.length>0;){const N=m.shift();X.push(N);const I=d.dependedBy.get(N.uniqueId);for(const X of Array.from(I.values())){const I=d.dependsOn.get(X);I.delete(N.uniqueId),0===I.size&&Z.get(X)&&(m.push(Z.get(X)),Z.delete(X))}}return Z.size>0&&(e.e.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),Z.forEach((N=>e.e.Error(N.name)))),X}_addNodeAndDescendantsToList(N,Z,d,X){if(d&&(!X||X(d))&&!Z.has(d.uniqueId)){N.push(d),Z.add(d.uniqueId);for(const I of d.getDescendants(!0))this._addNodeAndDescendantsToList(N,Z,I,X)}}_isNodeInContainer(N){return N instanceof S.b&&-1!==this.meshes.indexOf(N)||(N instanceof w.c&&-1!==this.transformNodes.indexOf(N)||(N instanceof D.d&&-1!==this.lights.indexOf(N)||N instanceof v.e&&-1!==this.cameras.indexOf(N)))}_isValidHierarchy(){for(const N of this.meshes)if(N.parent&&!this._isNodeInContainer(N.parent))return e.e.Warn(`Node ${N.name} has a parent that is not in the container.`),!1;for(const N of this.transformNodes)if(N.parent&&!this._isNodeInContainer(N.parent))return e.e.Warn(`Node ${N.name} has a parent that is not in the container.`),!1;for(const N of this.lights)if(N.parent&&!this._isNodeInContainer(N.parent))return e.e.Warn(`Node ${N.name} has a parent that is not in the container.`),!1;for(const N of this.cameras)if(N.parent&&!this._isNodeInContainer(N.parent))return e.e.Warn(`Node ${N.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(N){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],d=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||I.g.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const X={},m={},w=new h,S=[],e=[],j={doNotInstantiate:!0,...d},B=[],D=new Set;for(const I of this.transformNodes)null===I.parent&&this._addNodeAndDescendantsToList(B,D,I,j.predicate);for(const I of this.meshes)null===I.parent&&this._addNodeAndDescendantsToList(B,D,I,j.predicate);const v=this._topologicalSort(B),T=(d,I)=>{if(((Z,d)=>{if(X[Z.uniqueId]=d.uniqueId,m[d.uniqueId]=d,N&&(d.name=N(Z.name)),d instanceof z.b){const N=d;if(N.morphTargetManager){const d=Z.morphTargetManager;N.morphTargetManager=d.clone();for(let Z=0;Z<d.numTargets;Z++){const I=d.getTarget(Z),z=N.morphTargetManager.getTarget(Z);X[I.uniqueId]=z.uniqueId,m[z.uniqueId]=z}}}})(d,I),d.parent){const N=X[d.parent.uniqueId],Z=m[N];I.parent=Z||d.parent}if(I.position&&d.position&&I.position.p(d.position),I.rotationQuaternion&&d.rotationQuaternion&&I.rotationQuaternion.p(d.rotationQuaternion),I.rotation&&d.rotation&&I.rotation.p(d.rotation),I.od&&d.od&&I.od.p(d.od),I.material){const z=I;if(z.material)if(Z){const Z=d.material;if(-1===e.indexOf(Z)){let d=Z.clone(N?N(Z.name):"Clone of "+Z.name);if(e.push(Z),X[Z.uniqueId]=d.uniqueId,m[d.uniqueId]=d,"MultiMaterial"===Z.getClassName()){const I=Z;for(const Z of I.vg)Z&&(d=Z.clone(N?N(Z.name):"Clone of "+Z.name),e.push(Z),X[Z.uniqueId]=d.uniqueId,m[d.uniqueId]=d);I.vg=I.vg.map((N=>N&&m[X[N.uniqueId]]))}}"InstancedMesh"!==z.getClassName()&&(z.material=m[X[Z.uniqueId]])}else"MultiMaterial"===z.material.getClassName()?-1===this.Td.multiMaterials.indexOf(z.material)&&this.Td.addMultiMaterial(z.material):-1===this.Td.materials.indexOf(z.material)&&this.Td.addMaterial(z.material)}null===I.parent&&w.rootNodes.push(I)};return v.forEach((N=>{if("InstancedMesh"===N.getClassName()){const Z=N,d=Z.sourceMesh,I=X[d.uniqueId],z=("number"===typeof I?m[I]:d).eb(Z.name);T(Z,z)}else{let Z=!0;"ob"===N.getClassName()||"Node"===N.getClassName()||N.skeleton||!N.getTotalVertices||0===N.getTotalVertices()?Z=!1:j.doNotInstantiate&&(Z="function"===typeof j.doNotInstantiate?!j.doNotInstantiate(N):!j.doNotInstantiate);const d=Z?N.eb(`instance of ${N.name}`):N.clone(`Clone of ${N.name}`,null,!0);if(!d)throw new Error(`Could not clone or instantiate node on Asset Container ${N.name}`);T(N,d)}})),this.skeletons.forEach((Z=>{if(j.predicate&&!j.predicate(Z))return;const d=Z.clone(N?N(Z.name):"Clone of "+Z.name);for(const N of this.meshes)if(N.skeleton===Z&&!N.isAnInstance){const Z=m[X[N.uniqueId]];if(!Z||Z.isAnInstance)continue;if(Z.skeleton=d,-1!==S.indexOf(d))continue;S.push(d);for(const N of d.bones)N._linkedTransformNode&&(N._linkedTransformNode=m[X[N._linkedTransformNode.uniqueId]])}w.skeletons.push(d)})),this.animationGroups.forEach((Z=>{if(j.predicate&&!j.predicate(Z))return;const d=Z.clone(N?N(Z.name):"Clone of "+Z.name,(N=>m[X[N.uniqueId]]||N));w.animationGroups.push(d)})),w}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||I.g.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.Td.environmentTexture=this.environmentTexture);for(const N of this.Td._serializableComponents)N.addFromContainer(this);this.Td.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const Z=[];this.cameras.forEach((d=>{N&&!N(d)||(this.Td.addCamera(d),Z.push(d))})),this.lights.forEach((d=>{N&&!N(d)||(this.Td.addLight(d),Z.push(d))})),this.meshes.forEach((d=>{N&&!N(d)||(this.Td.Wd(d),Z.push(d))})),this.skeletons.forEach((Z=>{N&&!N(Z)||this.Td.addSkeleton(Z)})),this.animations.forEach((Z=>{N&&!N(Z)||this.Td.addAnimation(Z)})),this.animationGroups.forEach((Z=>{N&&!N(Z)||this.Td.addAnimationGroup(Z)})),this.multiMaterials.forEach((Z=>{N&&!N(Z)||this.Td.addMultiMaterial(Z)})),this.materials.forEach((Z=>{N&&!N(Z)||this.Td.addMaterial(Z)})),this.morphTargetManagers.forEach((Z=>{N&&!N(Z)||this.Td.addMorphTargetManager(Z)})),this.geometries.forEach((Z=>{N&&!N(Z)||this.Td.addGeometry(Z)})),this.transformNodes.forEach((d=>{N&&!N(d)||(this.Td.addTransformNode(d),Z.push(d))})),this.actionManagers.forEach((Z=>{N&&!N(Z)||this.Td.addActionManager(Z)})),this.textures.forEach((Z=>{N&&!N(Z)||this.Td.addTexture(Z)})),this.reflectionProbes.forEach((Z=>{N&&!N(Z)||this.Td.addReflectionProbe(Z)}));for(const d of Z)d.parent&&-1===this.Td.getNodes().indexOf(d.parent)&&(d.setParent?d.setParent(null):d.parent=null)}removeAllFromScene(){this._isValidHierarchy()||I.g.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.Td.environmentTexture&&(this.Td.environmentTexture=null);for(const N of this.Td._serializableComponents)N.removeFromContainer(this)}removeFromScene(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.cameras.forEach((Z=>{N&&!N(Z)||this.Td.removeCamera(Z)})),this.lights.forEach((Z=>{N&&!N(Z)||this.Td.removeLight(Z)})),this.meshes.forEach((Z=>{N&&!N(Z)||this.Td._d(Z,!0)})),this.skeletons.forEach((Z=>{N&&!N(Z)||this.Td.removeSkeleton(Z)})),this.animations.forEach((Z=>{N&&!N(Z)||this.Td.removeAnimation(Z)})),this.animationGroups.forEach((Z=>{N&&!N(Z)||this.Td.removeAnimationGroup(Z)})),this.multiMaterials.forEach((Z=>{N&&!N(Z)||this.Td.removeMultiMaterial(Z)})),this.materials.forEach((Z=>{N&&!N(Z)||this.Td.removeMaterial(Z)})),this.morphTargetManagers.forEach((Z=>{N&&!N(Z)||this.Td.removeMorphTargetManager(Z)})),this.geometries.forEach((Z=>{N&&!N(Z)||this.Td.removeGeometry(Z)})),this.transformNodes.forEach((Z=>{N&&!N(Z)||this.Td.removeTransformNode(Z)})),this.actionManagers.forEach((Z=>{N&&!N(Z)||this.Td.removeActionManager(Z)})),this.textures.forEach((Z=>{N&&!N(Z)||this.Td.removeTexture(Z)})),this.reflectionProbes.forEach((Z=>{N&&!N(Z)||this.Td.removeReflectionProbe(Z)}))}dispose(){this.cameras.slice(0).forEach((N=>{N.dispose()})),this.cameras.length=0,this.lights.slice(0).forEach((N=>{N.dispose()})),this.lights.length=0,this.meshes.slice(0).forEach((N=>{N.dispose()})),this.meshes.length=0,this.skeletons.slice(0).forEach((N=>{N.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((N=>{N.dispose()})),this.animationGroups.length=0,this.multiMaterials.slice(0).forEach((N=>{N.dispose()})),this.multiMaterials.length=0,this.materials.slice(0).forEach((N=>{N.dispose()})),this.materials.length=0,this.geometries.slice(0).forEach((N=>{N.dispose()})),this.geometries.length=0,this.transformNodes.slice(0).forEach((N=>{N.dispose()})),this.transformNodes.length=0,this.actionManagers.slice(0).forEach((N=>{N.dispose()})),this.actionManagers.length=0,this.textures.slice(0).forEach((N=>{N.dispose()})),this.textures.length=0,this.reflectionProbes.slice(0).forEach((N=>{N.dispose()})),this.reflectionProbes.length=0,this.morphTargetManagers.slice(0).forEach((N=>{N.dispose()})),this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const N of this.Td._serializableComponents)N.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.Td.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(N,Z,d){if(N&&Z)for(const X of N){let N=!0;if(d)for(const Z of d)if(X===Z){N=!1;break}N&&(Z.push(X),X._parentContainer=this)}}moveAllFromScene(N){this._wasAddedToScene=!1,void 0===N&&(N=new k);for(const Z in this)Object.prototype.hasOwnProperty.call(this,Z)&&(this[Z]=this[Z]||("_environmentTexture"===Z?null:[]),this._moveAssets(this.Td[Z],this[Z],N[Z]));this.environmentTexture=this.Td.environmentTexture,this.removeAllFromScene()}createRootMesh(){const N=new z.b("assetContainerRootMesh",this.Td);return this.meshes.forEach((Z=>{Z.parent||N.addChild(Z)})),this.meshes.unshift(N),N}mergeAnimationsTo(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:j.e.LastCreatedScene,Z=arguments.length>1?arguments[1]:void 0,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!N)return e.e.Error("No scene available to merge animations to"),[];const X=d||(Z=>{let d=null;const X=Z.animations.length?Z.animations[0].targetProperty:"",I=Z.name.split(".").join("").split("_primitive")[0];switch(X){case"position":case"rotationQuaternion":d=N.getTransformNodeByName(Z.name)||N.getTransformNodeByName(I);break;case"influence":d=N.getMorphTargetByName(Z.name)||N.getMorphTargetByName(I);break;default:d=N.getNodeByName(Z.name)||N.getNodeByName(I)}return d});this.getNodes().forEach((N=>{const Z=X(N);if(null!==Z){for(const d of N.animations){const N=Z.animations.filter((N=>N.targetProperty===d.targetProperty));for(const d of N){const N=Z.animations.indexOf(d,0);N>-1&&Z.animations.splice(N,1)}}Z.animations=Z.animations.concat(N.animations)}}));const I=[];return this.animationGroups.slice().forEach((N=>{I.push(N.clone(N.name,X)),N.animatables.forEach((N=>{N.stop()}))})),Z.forEach((Z=>{const d=X(Z.target);d&&(N.beginAnimation(d,Z.fromFrame,Z.toFrame,Z.loopAnimation,Z.speedRatio,Z.onAnimationEnd?Z.onAnimationEnd:void 0,void 0,!0,void 0,Z.onAnimationLoop?Z.onAnimationLoop:void 0),N.stopAnimation(Z.target))})),I}populateRootNodes(){this.rootNodes.length=0,this.meshes.forEach((N=>{N.parent||-1!==this.rootNodes.indexOf(N)||this.rootNodes.push(N)})),this.transformNodes.forEach((N=>{N.parent||-1!==this.rootNodes.indexOf(N)||this.rootNodes.push(N)})),this.lights.forEach((N=>{N.parent||-1!==this.rootNodes.indexOf(N)||this.rootNodes.push(N)})),this.cameras.forEach((N=>{N.parent||-1!==this.rootNodes.indexOf(N)||this.rootNodes.push(N)}))}addAllAssetsToContainer(N){if(!N)return;const Z=[],d=new Set;for(Z.push(N);Z.length>0;){const N=Z.pop();if(N instanceof z.b?(N.de&&-1===this.geometries.indexOf(N.de)&&this.geometries.push(N.de),this.meshes.push(N)):N instanceof w.c?this.transformNodes.push(N):N instanceof D.d?this.lights.push(N):N instanceof v.e&&this.cameras.push(N),N instanceof S.b){if(N.material&&-1===this.materials.indexOf(N.material)){this.materials.push(N.material);for(const Z of N.material.getActiveTextures())-1===this.textures.indexOf(Z)&&this.textures.push(Z)}N.skeleton&&-1===this.skeletons.indexOf(N.skeleton)&&this.skeletons.push(N.skeleton),N.morphTargetManager&&-1===this.morphTargetManagers.indexOf(N.morphTargetManager)&&this.morphTargetManagers.push(N.morphTargetManager)}for(const X of N.getChildren())d.has(X)||Z.push(X);d.add(N)}this.populateRootNodes()}}var C=d(1030);class M{constructor(N){this.byteOffset=0,this.buffer=N}loadAsync(N){return this.buffer.readAsync(this.byteOffset,N).then((N=>{this._dataView=new DataView(N.buffer,N.byteOffset,N.byteLength),this._dataByteOffset=0}))}readUint32(){const N=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,N}readUint8Array(N){const Z=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,N);return this._dataByteOffset+=N,this.byteOffset+=N,Z}readString(N){return(0,C.i)(this.readUint8Array(N))}skipBytes(N){this._dataByteOffset+=N,this.byteOffset+=N}}var Q=d(11761);const A="Z2xURg",n={name:"bj",extensions:{".gltf":{isBinary:!1},".glb":{isBinary:!0}},canDirectLoad:N=>-1!==N.indexOf("asset")&&-1!==N.indexOf("version")||N.startsWith("data:base64,"+A)||N.startsWith("data:;base64,"+A)||N.startsWith("data:application/octet-stream;base64,"+A)||N.startsWith("data:model/gltf-binary;base64,"+A)};var g,E,V,O=d(1008),K=d(1023);function r(N,Z,d){try{return Promise.resolve(new Uint8Array(N,Z,d))}catch(X){return Promise.reject(X)}}!function(N){N[N.AUTO=0]="AUTO",N[N.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(g||(g={})),function(N){N[N.NONE=0]="NONE",N[N.FIRST=1]="FIRST",N[N.ALL=2]="ALL"}(E||(E={})),function(N){N[N.LOADING=0]="LOADING",N[N.READY=1]="READY",N[N.COMPLETE=2]="COMPLETE"}(V||(V={}));class P{constructor(){this.coordinateSystemMode=g.AUTO,this.animationStartMode=E.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=N=>Promise.resolve(N),this.extensionOptions={}}p(N){N&&(this.onParsed=N.onParsed,this.coordinateSystemMode=N.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=N.animationStartMode??this.animationStartMode,this.loadNodeAnimations=N.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=N.loadSkins??this.loadSkins,this.loadMorphTargets=N.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=N.compileMaterials??this.compileMaterials,this.useClipPlane=N.useClipPlane??this.useClipPlane,this.compileShadowGenerators=N.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=N.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=N.useRangeRequests??this.useRangeRequests,this.createInstances=N.createInstances??this.createInstances,this.alwaysComputeBoundingBox=N.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=N.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=N.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=N.skipMaterials??this.skipMaterials,this.useSRGBBuffers=N.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=N.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=N.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=N.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=N.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=N.customRootNode,this.onMeshLoaded=N.onMeshLoaded,this.onSkinLoaded=N.onSkinLoaded,this.onTextureLoaded=N.onTextureLoaded,this.onMaterialLoaded=N.onMaterialLoaded,this.onCameraLoaded=N.onCameraLoaded,this.extensionOptions=N.extensionOptions??this.extensionOptions)}}class W extends P{constructor(N){super(),this.onParsedObservable=new X.d,this.onMeshLoadedObservable=new X.d,this.onSkinLoadedObservable=new X.d,this.onTextureLoadedObservable=new X.d,this.onMaterialLoadedObservable=new X.d,this.onCameraLoadedObservable=new X.d,this.onCompleteObservable=new X.d,this.onErrorObservable=new X.d,this.pd=new X.d,this.onExtensionLoadedObservable=new X.d,this.validate=!1,this.onValidatedObservable=new X.d,this._loader=null,this._state=null,this._requests=new Array,this.name=n.name,this.extensions=n.extensions,this.onLoaderStateChangedObservable=new X.d,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.p(N)}set onParsed(N){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),N&&(this._onParsedObserver=this.onParsedObservable.add(N))}set onMeshLoaded(N){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),N&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(N))}set onSkinLoaded(N){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),N&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((Z=>N(Z.node,Z.skinnedNode))))}set onTextureLoaded(N){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),N&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(N))}set onMaterialLoaded(N){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),N&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(N))}set onCameraLoaded(N){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),N&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(N))}set onComplete(N){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(N)}set onError(N){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(N)}set onDispose(N){this._onDisposeObserver&&this.pd.remove(this._onDisposeObserver),this._onDisposeObserver=this.pd.add(N)}set onExtensionLoaded(N){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(N)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(N){this._loggingEnabled!==N&&(this._loggingEnabled=N,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(N){this._capturePerformanceCounters!==N&&(this._capturePerformanceCounters=N,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(N){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(N)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const N of this._requests)N.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=N=>Promise.resolve(N),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.pd.notifyObservers(void 0),this.pd.clear()}loadFile(N,Z,d,m,z,w,S,j){if(ArrayBuffer.isView(Z))return this._loadBinary(N,Z,d,m,S,j),null;this._progressCallback=z;const B=Z.name||I.g.GetFilename(Z);if(w){if(this.useRangeRequests){this.validate&&e.e.Warn("glTF validation is not supported when range requests are enabled");const d={abort:()=>{},onCompleteObservable:new X.d},I={readAsync:(d,X)=>new Promise(((I,m)=>{this._loadFile(N,Z,(N=>{I(new Uint8Array(N))}),!0,(N=>{m(N)}),(N=>{N.setRequestHeader("Range",`bytes=${d}-${d+X-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new M(I)).then((N=>{d.onCompleteObservable.notifyObservers(d),m(N)}),S?N=>S(void 0,N):void 0),d}return this._loadFile(N,Z,(Z=>{this._validate(N,new Uint8Array(Z,0,Z.byteLength),d,B),this._unpackBinaryAsync(new M({readAsync:(N,d)=>r(Z,N,d),byteLength:Z.byteLength})).then((N=>{m(N)}),S?N=>S(void 0,N):void 0)}),!0,S)}return this._loadFile(N,Z,(Z=>{try{this._validate(N,Z,d,B),m({json:this._parseJson(Z)})}catch{S&&S()}}),!1,S)}_loadBinary(N,Z,d,X,I,m){this._validate(N,new Uint8Array(Z.buffer,Z.byteOffset,Z.byteLength),d,m),this._unpackBinaryAsync(new M({readAsync:(N,d)=>function(N,Z,d){try{if(Z<0||Z>=N.byteLength)throw new RangeError("Offset is out of range.");if(Z+d>N.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(N.buffer,N.byteOffset+Z,d))}catch(X){return Promise.reject(X)}}(Z,N,d),byteLength:Z.byteLength})).then((N=>{X(N)}),I?N=>I(void 0,N):void 0)}importMeshAsync(N,Z,d,X,I,m){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(d),this.onParsedObservable.clear(),this._log(`Loading ${m||""}`),this._loader=this._getLoader(d),this._loader.importMeshAsync(N,Z,null,d,X,I,m))))}loadAsync(N,Z,d,X,I){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(Z),this.onParsedObservable.clear(),this._log(`Loading ${I||""}`),this._loader=this._getLoader(Z),this._loader.loadAsync(N,Z,d,X,I))))}loadAssetContainerAsync(N,Z,d,X,I){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(Z),this.onParsedObservable.clear(),this._log(`Loading ${I||""}`),this._loader=this._getLoader(Z);const m=new U(N),z=[];this.onMaterialLoadedObservable.add((N=>{z.push(N)}));const w=[];this.onTextureLoadedObservable.add((N=>{w.push(N)}));const S=[];this.onCameraLoadedObservable.add((N=>{S.push(N)}));const e=[];return this.onMeshLoadedObservable.add((N=>{N.morphTargetManager&&e.push(N.morphTargetManager)})),this._loader.importMeshAsync(null,N,m,Z,d,X,I).then((N=>(Array.prototype.push.apply(m.geometries,N.geometries),Array.prototype.push.apply(m.meshes,N.meshes),Array.prototype.push.apply(m.Od,N.Od),Array.prototype.push.apply(m.skeletons,N.skeletons),Array.prototype.push.apply(m.animationGroups,N.animationGroups),Array.prototype.push.apply(m.materials,z),Array.prototype.push.apply(m.textures,w),Array.prototype.push.apply(m.lights,N.lights),Array.prototype.push.apply(m.transformNodes,N.transformNodes),Array.prototype.push.apply(m.cameras,S),Array.prototype.push.apply(m.morphTargetManagers,e),m)))}))}canDirectLoad(N){return n.canDirectLoad(N)}directLoad(N,Z){if(Z.startsWith("base64,"+A)||Z.startsWith(";base64,"+A)||Z.startsWith("application/octet-stream;base64,"+A)||Z.startsWith("model/gltf-binary;base64,"+A)){const d=(0,O.d)(Z);return this._validate(N,new Uint8Array(d,0,d.byteLength)),this._unpackBinaryAsync(new M({readAsync:(N,Z)=>r(d,N,Z),byteLength:d.byteLength}))}return this._validate(N,Z),Promise.resolve({json:this._parseJson(Z)})}createPlugin(N){return new W(N[n.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((N,Z)=>{this.onCompleteObservable.addOnce((()=>{N()})),this.onErrorObservable.addOnce((N=>{Z(N)}))}))}_setState(N){this._state!==N&&(this._state=N,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(V[this._state]))}_loadFile(N,Z,d,X,I,m){const z=N._loadFile(Z,d,(N=>{this._onProgress(N,z)}),!0,X,I,m);return z.onCompleteObservable.add((()=>{z._lengthComputable=!0,z._total=z._loaded})),this._requests.push(z),z}_onProgress(N,Z){if(!this._progressCallback)return;Z._lengthComputable=N.lengthComputable,Z._loaded=N.loaded,Z._total=N.total;let d=!0,X=0,I=0;for(const m of this._requests){if(void 0===m._lengthComputable||void 0===m._loaded||void 0===m._total)return;d=d&&m._lengthComputable,X+=m._loaded,I+=m._total}this._progressCallback({lengthComputable:d,loaded:X,total:d?I:0})}_validate(N,Z){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),Q.e.ValidateAsync(Z,d,X,(Z=>this.preprocessUrlAsync(d+Z).then((Z=>N._loadFileAsync(Z,void 0,!0,!0).then((N=>new Uint8Array(N,0,N.byteLength))))))).then((N=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(N),this.onValidatedObservable.clear()}),(N=>{this._endPerformanceCounter("Validate JSON"),I.g.Warn(`Failed to validate: ${N.message}`),this.onValidatedObservable.clear()})))}_getLoader(N){const Z=N.json.asset||{};this._log(`Asset version: ${Z.version}`),Z.minVersion&&this._log(`Asset minimum version: ${Z.minVersion}`),Z.generator&&this._log(`Asset generator: ${Z.generator}`);const d=W._parseVersion(Z.version);if(!d)throw new Error("Invalid version: "+Z.version);if(void 0!==Z.minVersion){const N=W._parseVersion(Z.minVersion);if(!N)throw new Error("Invalid minimum version: "+Z.minVersion);if(W._compareVersion(N,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+Z.minVersion)}const X={1:W._CreateGLTF1Loader,2:W._CreateGLTF2Loader}[d.major];if(!X)throw new Error("Unsupported version: "+Z.version);return X(this)}_parseJson(N){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${N.length}`);const Z=JSON.parse(N);return this._endPerformanceCounter("Parse JSON"),Z}_unpackBinaryAsync(N){return this._startPerformanceCounter("Unpack Binary"),N.loadAsync(20).then((()=>{const Z=N.readUint32();if(1179937895!==Z)throw new K.f("Unexpected magic: "+Z,K.c.GLTFLoaderUnexpectedMagicError);const d=N.readUint32();this.loggingEnabled&&this._log(`Binary version: ${d}`);const X=N.readUint32();let I;switch(this.useRangeRequests||X===N.buffer.byteLength||e.e.Warn(`Length in header does not match actual data length: ${X} != ${N.buffer.byteLength}`),d){case 1:I=this._unpackBinaryV1Async(N,X);break;case 2:I=this._unpackBinaryV2Async(N,X);break;default:throw new Error("Unsupported version: "+d)}return this._endPerformanceCounter("Unpack Binary"),I}))}_unpackBinaryV1Async(N,Z){const d=N.readUint32(),X=N.readUint32();if(0!==X)throw new Error(`Unexpected content format: ${X}`);const I=Z-N.byteOffset,m={json:this._parseJson(N.readString(d)),bin:null};if(0!==I){const Z=N.byteOffset;m.bin={readAsync:(d,X)=>N.buffer.readAsync(Z+d,X),byteLength:I}}return Promise.resolve(m)}_unpackBinaryV2Async(N,Z){const d=1313821514,X=5130562,I=N.readUint32();if(N.readUint32()!==d)throw new Error("First chunk format is not JSON");return N.byteOffset+I===Z?N.loadAsync(I).then((()=>({json:this._parseJson(N.readString(I)),bin:null}))):N.loadAsync(I+8).then((()=>{const m={json:this._parseJson(N.readString(I)),bin:null},z=()=>{const I=N.readUint32();switch(N.readUint32()){case d:throw new Error("Unexpected JSON chunk");case X:{const Z=N.byteOffset;m.bin={readAsync:(d,X)=>N.buffer.readAsync(Z+d,X),byteLength:I},N.skipBytes(I);break}default:N.skipBytes(I)}return N.byteOffset!==Z?N.loadAsync(8).then(z):Promise.resolve(m)};return z()}))}static _parseVersion(N){if("1.0"===N||"1.0.1"===N)return{major:1,minor:0};const Z=(N+"").match(/^(\d+)\.(\d+)/);return Z?{major:parseInt(Z[1]),minor:parseInt(Z[2])}:null}static _compareVersion(N,Z){return N.major>Z.major?1:N.major<Z.major?-1:N.minor>Z.minor?1:N.minor<Z.minor?-1:0}_logOpen(N){this._log(N),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(N){const Z=W._logSpaces.substring(0,2*this._logIndentLevel);e.e.Log(`${Z}${N}`)}_logDisabled(N){}_startPerformanceCounterEnabled(N){I.g.StartPerformanceCounter(N)}_startPerformanceCounterDisabled(N){}_endPerformanceCounterEnabled(N){I.g.EndPerformanceCounter(N)}_endPerformanceCounterDisabled(N){}}W.IncrementalLoading=!0,W.HomogeneousCoordinates=!1,W._logSpaces="                                ",(0,m.h)(new W)},11761:(N,Z,d)=>{"use strict";d.d(Z,{e:()=>z});var X=d(1133);function I(N,Z,d,X){const I={externalResourceFunction:X};return d&&(I.uri="file:"===Z?d:Z+d),ArrayBuffer.isView(N)?GLTFValidator.validateBytes(N,I):GLTFValidator.validateString(N,I)}function m(){const N=[];onmessage=Z=>{const d=Z.data;switch(d.id){case"init":importScripts(d.url);break;case"validate":I(d.data,d.rootUrl,d.fileName,(Z=>new Promise(((d,X)=>{const I=N.length;N.push({resolve:d,reject:X}),postMessage({id:"getExternalResource",index:I,uri:Z})})))).then((N=>{postMessage({id:"validate.resolve",value:N})}),(N=>{postMessage({id:"validate.reject",reason:N})}));break;case"getExternalResource.resolve":N[d.index].resolve(d.value);break;case"getExternalResource.reject":N[d.index].reject(d.reason)}}}class z{static ValidateAsync(N,Z,d,z){return"function"===typeof Worker?new Promise(((w,S)=>{const e=`${I}(${m})()`,j=URL.createObjectURL(new Blob([e],{type:"application/javascript"})),B=new Worker(j),D=N=>{B.removeEventListener("error",D),B.removeEventListener("message",v),S(N)},v=N=>{const Z=N.data;switch(Z.id){case"getExternalResource":z(Z.uri).then((N=>{B.postMessage({id:"getExternalResource.resolve",index:Z.index,value:N},[N.buffer])}),(N=>{B.postMessage({id:"getExternalResource.reject",index:Z.index,reason:N})}));break;case"validate.resolve":B.removeEventListener("error",D),B.removeEventListener("message",v),w(Z.value),B.terminate();break;case"validate.reject":B.removeEventListener("error",D),B.removeEventListener("message",v),S(Z.reason),B.terminate()}};if(B.addEventListener("error",D),B.addEventListener("message",v),B.postMessage({id:"init",url:X.g.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(N)){const X=N.slice();B.postMessage({id:"validate",data:X,rootUrl:Z,fileName:d},[X.buffer])}else B.postMessage({id:"validate",data:N,rootUrl:Z,fileName:d})})):(this._LoadScriptPromise||(this._LoadScriptPromise=X.g.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>I(N,Z,d,z))))}}z.Configuration={url:`${X.g._DefaultCdnUrl}/gltf_validator.js`}},12080:(N,Z,d)=>{"use strict";d.d(Z,{b:()=>g});var X=d(942),I=d(949),m=d(1094),z=d(960),w=d(1293),S=d(1297),e=d(1169),j=d(1131),B=d(978),D=d(1069);d(10864),d(10734),d(10871),d(10661),d(10873),d(10905),d(10908);const v="imageProcessingCompatibility",T="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";D.c.IncludesShadersStore[v]=T;const k="skyPixelShader",h="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";D.c.ShadersStore[k]=h;d(10709),d(10712),d(10782),d(10800),d(10784);const U="skyVertexShader",C="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";D.c.ShadersStore[U]=C;var M=d(1303),Q=d(1288),A=d(1285);class n extends w.b{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class g extends S.c{constructor(N,Z){super(N,Z),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new z.n(0,100,0),this.useSunPosition=!1,this.cameraOffset=z.n.Zero(),this.up=z.n.Up(),this.dithering=!1,this._cameraPosition=z.n.Zero(),this._skyOrientation=new z.g}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(N,Z){const d=Z._drawWrapper;if(this.isFrozen&&d.effect&&d._wasPreviouslyReady)return!0;Z.materialDefines||(Z.materialDefines=new n);const X=Z.materialDefines,I=this.va();if(this._isReadyForSubMesh(Z))return!0;if((0,A.M)(N,I,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,X),(0,A.D)(N,X,!0,!1),X.IMAGEPROCESSINGPOSTPROCESS!==I.imageProcessingConfiguration.applyByPostProcess&&X.markAsMiscDirty(),X.DITHER!==this.dithering&&X.markAsMiscDirty(),X.isDirty){X.markAsProcessed(),I.resetCachedMaterial();const N=new M.e;X.FOG&&N.addFallback(1,"FOG"),X.IMAGEPROCESSINGPOSTPROCESS=I.imageProcessingConfiguration.applyByPostProcess,X.DITHER=this.dithering;const d=[e.d.PositionKind];X.VERTEXCOLOR&&d.push(e.d.ColorKind);const m="sky",z=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,Q.e)(z);const w=X.toString();Z.setEffect(I.getEngine().createEffect(m,d,z,[],w,N,this.onCompiled,this.onError),X,this._materialContext)}return!(!Z.effect||!Z.effect.isReady())&&(X._renderId=I.getRenderId(),d._wasPreviouslyReady=!0,!0)}bindForSubMesh(N,Z,d){const X=this.va(),I=d.materialDefines;if(!I)return;const m=d.effect;if(!m)return;this._activeEffect=m,this.bindOnlyWorldMatrix(N),this._activeEffect.setMatrix("viewProjection",X.getTransformMatrix()),this._mustRebind(X,m,d)&&((0,Q.i)(m,this,X),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,A.k)(I,m,X)),X.fogEnabled&&Z.applyFog&&X.fogMode!==j.e.FOGMODE_NONE&&this._activeEffect.setMatrix("view",X.getViewMatrix()),(0,A.f)(X,Z,this._activeEffect);const w=X.activeCamera;if(w){const N=w.getWorldMatrix();this._cameraPosition.x=N.m[12],this._cameraPosition.y=N.m[13],this._cameraPosition.z=N.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const N=Math.PI*(this.inclination-.5),Z=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(Z)*Math.cos(N),this.sunPosition.y=this.distance*Math.sin(-N),this.sunPosition.z=this.distance*Math.sin(Z)*Math.cos(N),z.g.FromUnitVectorsToRef(z.n.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(Z,this._activeEffect,d)}getAnimatables(){return[]}dispose(N){super.dispose(N)}clone(N){return m.c.Clone((()=>new g(N,this.va())),this)}serialize(){const N=super.serialize();return N.customType="BABYLON.SkyMaterial",N}getClassName(){return"SkyMaterial"}static Parse(N,Z,d){return m.c.Parse((()=>new g(N.name,Z)),N,Z,d)}}(0,X.d)([(0,I.I)()],g.prototype,"luminance",void 0),(0,X.d)([(0,I.I)()],g.prototype,"turbidity",void 0),(0,X.d)([(0,I.I)()],g.prototype,"rayleigh",void 0),(0,X.d)([(0,I.I)()],g.prototype,"mieCoefficient",void 0),(0,X.d)([(0,I.I)()],g.prototype,"mieDirectionalG",void 0),(0,X.d)([(0,I.I)()],g.prototype,"distance",void 0),(0,X.d)([(0,I.I)()],g.prototype,"inclination",void 0),(0,X.d)([(0,I.I)()],g.prototype,"azimuth",void 0),(0,X.d)([(0,I.H)()],g.prototype,"sunPosition",void 0),(0,X.d)([(0,I.I)()],g.prototype,"useSunPosition",void 0),(0,X.d)([(0,I.H)()],g.prototype,"cameraOffset",void 0),(0,X.d)([(0,I.H)()],g.prototype,"up",void 0),(0,X.d)([(0,I.I)()],g.prototype,"dithering",void 0),(0,B.h)("BABYLON.SkyMaterial",g)},11030:(N,Z,d)=>{"use strict";function X(N,Z){Z.headers=N.headers||{},Z.statusMessage=N.statusText,Z.statusCode=N.status,Z.data=N.response}function I(N,Z,d){return new Promise((function(I,m){d=d||{};var z,w,S,e=new XMLHttpRequest,j=d.body,B=d.headers||{};for(z in d.timeout&&(e.timeout=d.timeout),e.ontimeout=e.onerror=function(N){N.timeout="timeout"==N.type,m(N)},e.open(N,Z.href||Z),e.onload=function(){for(S=e.getAllResponseHeaders().trim().split(/[\r\n]+/),X(e,e);w=S.shift();)w=w.split(": "),e.headers[w.shift().toLowerCase()]=w.join(": ");if((w=e.headers["content-type"])&&~w.indexOf("application/json"))try{e.data=JSON.parse(e.data,d.reviver)}catch(N){return X(e,N),m(N)}(e.status>=400?m:I)(e)},typeof FormData<"u"&&j instanceof FormData||j&&"object"==typeof j&&(B["content-type"]="application/json",j=JSON.stringify(j)),e.withCredentials=!!d.withCredentials,B)e.setRequestHeader(z,B[z]);e.send(j)}))}d.r(Z),d.d(Z,{del:()=>S,get:()=>m,patch:()=>w,post:()=>z,put:()=>e,send:()=>I});var m=I.bind(I,"GET"),z=I.bind(I,"POST"),w=I.bind(I,"PATCH"),S=I.bind(I,"DELETE"),e=I.bind(I,"PUT")},12181:(N,Z,d)=>{"use strict";d.d(Z,{d:()=>B});const X=.5*(Math.sqrt(3)-1),I=(3-Math.sqrt(3))/6,m=1/3,z=1/6,w=(Math.sqrt(5)-1)/4,S=(5-Math.sqrt(5))/20,e=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),j=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const B=class{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const Z="function"==typeof N?N:function(N){let Z=0,d=0,X=0,I=1;const m=function(){let N=4022871197;return function(Z){Z=Z.toString();for(let d=0;d<Z.length;d++){N+=Z.charCodeAt(d);let X=.02519603282416938*N;N=X>>>0,X-=N,X*=N,N=X>>>0,X-=N,N+=4294967296*X}return 2.3283064365386963e-10*(N>>>0)}}();Z=m(" "),d=m(" "),X=m(" "),Z-=m(N),Z<0&&(Z+=1);d-=m(N),d<0&&(d+=1);X-=m(N),X<0&&(X+=1);return function(){const N=2091639*Z+2.3283064365386963e-10*I;return Z=d,d=X,X=N-(I=0|N)}}(N);this.p=function(N){const Z=new Uint8Array(256);for(let d=0;d<256;d++)Z[d]=d;for(let d=0;d<255;d++){const X=d+~~(N()*(256-d)),I=Z[d];Z[d]=Z[X],Z[X]=I}return Z}(Z),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let d=0;d<512;d++)this.perm[d]=this.p[255&d],this.permMod12[d]=this.perm[d]%12}noise2D(N,Z){const d=this.permMod12,m=this.perm;let z=0,w=0,S=0;const j=(N+Z)*X,B=Math.floor(N+j),D=Math.floor(Z+j),v=(B+D)*I,T=N-(B-v),k=Z-(D-v);let h,U;T>k?(h=1,U=0):(h=0,U=1);const C=T-h+I,M=k-U+I,Q=T-1+2*I,A=k-1+2*I,n=255&B,g=255&D;let E=.5-T*T-k*k;if(E>=0){const N=3*d[n+m[g]];E*=E,z=E*E*(e[N]*T+e[N+1]*k)}let V=.5-C*C-M*M;if(V>=0){const N=3*d[n+h+m[g+U]];V*=V,w=V*V*(e[N]*C+e[N+1]*M)}let O=.5-Q*Q-A*A;if(O>=0){const N=3*d[n+1+m[g+1]];O*=O,S=O*O*(e[N]*Q+e[N+1]*A)}return 70*(z+w+S)}noise3D(N,Z,d){const X=this.permMod12,I=this.perm;let w,S,j,B;const D=(N+Z+d)*m,v=Math.floor(N+D),T=Math.floor(Z+D),k=Math.floor(d+D),h=(v+T+k)*z,U=N-(v-h),C=Z-(T-h),M=d-(k-h);let Q,A,n,g,E,V;U>=C?C>=M?(Q=1,A=0,n=0,g=1,E=1,V=0):U>=M?(Q=1,A=0,n=0,g=1,E=0,V=1):(Q=0,A=0,n=1,g=1,E=0,V=1):C<M?(Q=0,A=0,n=1,g=0,E=1,V=1):U<M?(Q=0,A=1,n=0,g=0,E=1,V=1):(Q=0,A=1,n=0,g=1,E=1,V=0);const O=U-Q+z,K=C-A+z,r=M-n+z,P=U-g+2*z,W=C-E+2*z,b=M-V+2*z,J=U-1+.5,F=C-1+.5,G=M-1+.5,x=255&v,t=255&T,q=255&k;let Y=.6-U*U-C*C-M*M;if(Y<0)w=0;else{const N=3*X[x+I[t+I[q]]];Y*=Y,w=Y*Y*(e[N]*U+e[N+1]*C+e[N+2]*M)}let s=.6-O*O-K*K-r*r;if(s<0)S=0;else{const N=3*X[x+Q+I[t+A+I[q+n]]];s*=s,S=s*s*(e[N]*O+e[N+1]*K+e[N+2]*r)}let L=.6-P*P-W*W-b*b;if(L<0)j=0;else{const N=3*X[x+g+I[t+E+I[q+V]]];L*=L,j=L*L*(e[N]*P+e[N+1]*W+e[N+2]*b)}let H=.6-J*J-F*F-G*G;if(H<0)B=0;else{const N=3*X[x+1+I[t+1+I[q+1]]];H*=H,B=H*H*(e[N]*J+e[N+1]*F+e[N+2]*G)}return 32*(w+S+j+B)}noise4D(N,Z,d,X){const I=this.perm;let m,z,e,B,D;const v=(N+Z+d+X)*w,T=Math.floor(N+v),k=Math.floor(Z+v),h=Math.floor(d+v),U=Math.floor(X+v),C=(T+k+h+U)*S,M=N-(T-C),Q=Z-(k-C),A=d-(h-C),n=X-(U-C);let g=0,E=0,V=0,O=0;M>Q?g++:E++,M>A?g++:V++,M>n?g++:O++,Q>A?E++:V++,Q>n?E++:O++,A>n?V++:O++;const K=g>=3?1:0,r=E>=3?1:0,P=V>=3?1:0,W=O>=3?1:0,b=g>=2?1:0,J=E>=2?1:0,F=V>=2?1:0,G=O>=2?1:0,x=g>=1?1:0,t=E>=1?1:0,q=V>=1?1:0,Y=O>=1?1:0,s=M-K+S,L=Q-r+S,H=A-P+S,i=n-W+S,p=M-b+2*S,y=Q-J+2*S,l=A-F+2*S,u=n-G+2*S,a=M-x+3*S,c=Q-t+3*S,R=A-q+3*S,f=n-Y+3*S,o=M-1+4*S,NN=Q-1+4*S,ZN=A-1+4*S,dN=n-1+4*S,XN=255&T,IN=255&k,mN=255&h,zN=255&U;let wN=.6-M*M-Q*Q-A*A-n*n;if(wN<0)m=0;else{const N=I[XN+I[IN+I[mN+I[zN]]]]%32*4;wN*=wN,m=wN*wN*(j[N]*M+j[N+1]*Q+j[N+2]*A+j[N+3]*n)}let SN=.6-s*s-L*L-H*H-i*i;if(SN<0)z=0;else{const N=I[XN+K+I[IN+r+I[mN+P+I[zN+W]]]]%32*4;SN*=SN,z=SN*SN*(j[N]*s+j[N+1]*L+j[N+2]*H+j[N+3]*i)}let eN=.6-p*p-y*y-l*l-u*u;if(eN<0)e=0;else{const N=I[XN+b+I[IN+J+I[mN+F+I[zN+G]]]]%32*4;eN*=eN,e=eN*eN*(j[N]*p+j[N+1]*y+j[N+2]*l+j[N+3]*u)}let jN=.6-a*a-c*c-R*R-f*f;if(jN<0)B=0;else{const N=I[XN+x+I[IN+t+I[mN+q+I[zN+Y]]]]%32*4;jN*=jN,B=jN*jN*(j[N]*a+j[N+1]*c+j[N+2]*R+j[N+3]*f)}let BN=.6-o*o-NN*NN-ZN*ZN-dN*dN;if(BN<0)D=0;else{const N=I[XN+1+I[IN+1+I[mN+1+I[zN+1]]]]%32*4;BN*=BN,D=BN*BN*(j[N]*o+j[N+1]*NN+j[N+2]*ZN+j[N+3]*dN)}return 27*(m+z+e+B+D)}}}}]);